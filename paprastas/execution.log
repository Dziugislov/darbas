[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for AD in column D: 8.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 273.01s
[INFO] Best parameters: Short SMA = 106, Long SMA = 160
[INFO] Best Sharpe ratio: 0.627696, Trades: 22
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_AD_best_106/160 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @AD
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.51 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $555,481.00
[INFO] Market Buy & Hold P&L: $-24,520.00
[INFO] Outperformance: $580,001.00
[INFO] Sharpe ratio (entire period, annualized): 0.632989
[INFO] Sharpe ratio (in-sample, annualized): 0.627696
[INFO] Sharpe ratio (out-of-sample, annualized): 0.644916
[INFO] Maximum Drawdown: $102,820.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 14
[INFO] Out-of-sample period trades: 8
[INFO] Total trades: 22
[INFO] In-sample P&L: $318,183.00
[INFO] Out-of-sample P&L: $140,738.00
[INFO] 
Best parameters from GA: Short SMA = 106, Long SMA = 160, Sharpe = 0.627696
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 22
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9874 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] Trades range: 10.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3635 to 2.7332
[INFO] Scaled Long SMA range: -2.7723 to 1.5199
[INFO] Scaled Sharpe ratio range: -3.8904 to 2.8778
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 14
[INFO] Using 14 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=14...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 877 elements
[INFO] Kmeans Cluster 1: 670 elements
[INFO] Kmeans Cluster 2: 786 elements
[INFO] Kmeans Cluster 3: 543 elements
[INFO] Kmeans Cluster 4: 834 elements
[INFO] Kmeans Cluster 5: 903 elements
[INFO] Kmeans Cluster 6: 756 elements
[INFO] Kmeans Cluster 7: 558 elements
[INFO] Kmeans Cluster 8: 587 elements
[INFO] Kmeans Cluster 9: 670 elements
[INFO] Kmeans Cluster 10: 645 elements
[INFO] Kmeans Cluster 11: 787 elements
[INFO] Kmeans Cluster 12: 915 elements
[INFO] Kmeans Cluster 13: 343 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=53.91, Long SMA=114.68, Sharpe=-0.1051
[INFO] Centroid 1: Short SMA=173.51, Long SMA=214.13, Sharpe=-0.0912
[INFO] Centroid 2: Short SMA=121.44, Long SMA=180.75, Sharpe=0.2628
[INFO] Centroid 3: Short SMA=64.66, Long SMA=101.53, Sharpe=-0.3494
[INFO] Centroid 4: Short SMA=92.79, Long SMA=232.87, Sharpe=0.1570
[INFO] Centroid 5: Short SMA=238.86, Long SMA=279.00, Sharpe=-0.0988
[INFO] Centroid 6: Short SMA=35.84, Long SMA=269.98, Sharpe=0.0831
[INFO] Centroid 7: Short SMA=46.03, Long SMA=156.47, Sharpe=0.0800
[INFO] Centroid 8: Short SMA=26.69, Long SMA=63.56, Sharpe=0.1484
[INFO] Centroid 9: Short SMA=45.70, Long SMA=213.50, Sharpe=-0.0649
[INFO] Centroid 10: Short SMA=203.69, Long SMA=249.23, Sharpe=0.0537
[INFO] Centroid 11: Short SMA=112.34, Long SMA=165.10, Sharpe=0.4434
[INFO] Centroid 12: Short SMA=145.50, Long SMA=260.56, Sharpe=0.0211
[INFO] Centroid 13: Short SMA=17.64, Long SMA=194.79, Sharpe=0.2660
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=22
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=110, Long SMA=164, Sharpe=0.3641, Trades=20
[INFO] Kmeans Top 2: Short SMA=124, Long SMA=186, Sharpe=0.2571, Trades=20
[INFO] Kmeans Top 3: Short SMA=18, Long SMA=198, Sharpe=0.2279, Trades=26
[INFO] Kmeans Top 4: Short SMA=92, Long SMA=234, Sharpe=0.2055, Trades=14
[INFO] Kmeans Top 5: Short SMA=28, Long SMA=62, Sharpe=0.1981, Trades=52
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}
[INFO]   Rounded: (54, 115)
[INFO]   Nearest: (54.0, 114.0)
[INFO]   Rounded: (174, 214)
[INFO]   Rounded: (121, 181)
[INFO]   Nearest: (122.0, 180.0)
[INFO]   Rounded: (65, 102)
[INFO]   Nearest: (64.0, 102.0)
[INFO]   Rounded: (93, 233)
[INFO]   Nearest: (92.0, 232.0)
[INFO]   Rounded: (239, 279)
[INFO]   Nearest: (238.0, 278.0)
[INFO]   Rounded: (36, 270)
[INFO]   Rounded: (46, 156)
[INFO]   Rounded: (27, 64)
[INFO]   Nearest: (26.0, 64.0)
[INFO]   Rounded: (46, 214)
[INFO]   Rounded: (204, 249)
[INFO]   Nearest: (204.0, 250.0)
[INFO]   Rounded: (112, 165)
[INFO]   Nearest: (112.0, 166.0)
[INFO]   Rounded: (146, 261)
[INFO]   Nearest: (146.0, 260.0)
[INFO]   Rounded: (18, 195)
[INFO]   Nearest: (18.0, 194.0)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(110/164) - Original Sharpe: 0.3641, Trades: 20
[INFO] Kmeans cluster 2: SMA(124/186) - Original Sharpe: 0.2571, Trades: 20
[INFO] Kmeans cluster 3: SMA(18/198) - Original Sharpe: 0.2279, Trades: 26
[INFO] Kmeans cluster 4: SMA(92/234) - Original Sharpe: 0.2055, Trades: 14
[INFO] Kmeans cluster 5: SMA(28/62) - Original Sharpe: 0.1981, Trades: 52
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (110/164) - Sharpe: 0.3641
[INFO] cluster 2: (124/186) - Sharpe: 0.2571
[INFO] cluster 3: (18/198) - Sharpe: 0.2279
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            0.551202
1    2021-11-14 2021-11-14            43     0.620829            0.620829
2    2022-01-14 2022-01-14            41     0.058063            0.058063
3    2022-03-14 2022-03-14            44     1.979608            0.617939
4    2022-05-14 2022-05-14            43    -1.220633            1.436266
5    2022-07-14 2022-07-14            44     0.448047            0.448047
6    2022-09-14 2022-09-14            43     0.790083            0.790083
7    2022-11-14 2022-11-14            43    -1.736792           -1.736792
8    2023-01-14 2023-01-14            41     2.493082            1.362225
9    2023-03-14 2023-03-14            44    -0.132668           -0.930875
10   2023-05-14 2023-05-14            44     0.580825           -0.318252
11   2023-07-14 2023-07-14            44     4.541233            4.541233
12   2023-09-14 2023-09-14            43     0.691612            0.691612
13   2023-11-14 2023-11-14            42    -2.563801           -3.132506
14   2024-01-14 2024-01-14            43     4.073536            0.533978
15   2024-03-14 2024-03-14            42    -0.424007            2.349392
16   2024-05-14 2024-05-14            44    -1.116674            0.442488
17   2024-07-14 2024-07-14            45     3.495207           -2.774511
18   2024-09-14 2024-09-14            43    -2.003748           -1.831898
19   2024-11-14 2024-11-14            33     3.170976            1.715690
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          2.0 |              0.6 |         -1.4 | False         
[INFO] 2022-05-14   |         -1.2 |              1.4 |          2.6 | True          
[INFO] 2022-07-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          2.5 |              1.4 |         -1.1 | False         
[INFO] 2023-03-14   |         -0.1 |             -0.9 |         -0.8 | False         
[INFO] 2023-05-14   |          0.6 |             -0.3 |         -0.9 | False         
[INFO] 2023-07-14   |          4.5 |              4.5 |          0.0 | Excluded      
[INFO] 2023-09-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -2.6 |             -3.1 |         -0.5 | False         
[INFO] 2024-01-14   |          4.1 |              0.5 |         -3.6 | False         
[INFO] 2024-03-14   |         -0.4 |              2.3 |          2.7 | True          
[INFO] 2024-05-14   |         -1.1 |              0.4 |          1.5 | True          
[INFO] 2024-07-14   |          3.5 |             -2.8 |         -6.3 | False         
[INFO] 2024-09-14   |         -2.0 |             -1.8 |          0.2 | True          
[INFO] 2024-11-14   |          3.2 |              1.7 |         -1.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-07-14, 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 4 of 12 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans win rate 33.3% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(110/164) - Original Sharpe: 0.3641
[INFO] Added cluster 2 to portfolio: SMA(124/186) - Original Sharpe: 0.2571
[INFO] Added cluster 3 to portfolio: SMA(18/198) - Original Sharpe: 0.2279
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2165
[INFO] Kmeans Best out-of-sample Sharpe: 0.6449
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 22
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9874 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] Trades range: 10.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3635 to 2.7332
[INFO] Scaled Long SMA range: -2.7723 to 1.5199
[INFO] Scaled Sharpe ratio range: -3.8904 to 2.8778
[INFO] Scaled Trades range: -0.7421 to 14.7138
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9874 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5641
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1407 elements
[INFO] Cluster 1: 186 elements
[INFO] Cluster 2: 1299 elements
[INFO] Cluster 3: 1315 elements
[INFO] Cluster 4: 974 elements
[INFO] Cluster 5: 187 elements
[INFO] Cluster 6: 506 elements
[INFO] Cluster 7: 208 elements
[INFO] Cluster 8: 34 elements
[INFO] Cluster 9: 388 elements
[INFO] Cluster 10: 682 elements
[INFO] Cluster 11: 953 elements
[INFO] Cluster 12: 531 elements
[INFO] Cluster 13: 518 elements
[INFO] Cluster 14: 541 elements
[INFO] Cluster 15: 145 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=224, Long SMA=268, Sharpe=-0.0729, Trades=18
[INFO] Cluster 1 cluster: Short SMA=32, Long SMA=40, Sharpe=0.3634, Trades=100
[INFO] Cluster 2 cluster: Short SMA=112, Long SMA=174, Sharpe=0.3795, Trades=18
[INFO] Cluster 3 cluster: Short SMA=144, Long SMA=252, Sharpe=0.0174, Trades=11
[INFO] Cluster 4 cluster: Short SMA=46, Long SMA=190, Sharpe=-0.1063, Trades=22
[INFO] Cluster 5 cluster: Short SMA=138, Long SMA=146, Sharpe=-0.0134, Trades=48
[INFO] Cluster 6 cluster: Short SMA=22, Long SMA=72, Sharpe=0.1815, Trades=52
[INFO] Cluster 7 cluster: Short SMA=78, Long SMA=88, Sharpe=-0.1356, Trades=65
[INFO] Cluster 8 cluster: Short SMA=38, Long SMA=40, Sharpe=0.4677, Trades=200
[INFO] Cluster 9 cluster: Short SMA=18, Long SMA=208, Sharpe=0.2323, Trades=28
[INFO] Cluster 10 cluster: Short SMA=40, Long SMA=122, Sharpe=-0.1151, Trades=28
[INFO] Cluster 11 cluster: Short SMA=80, Long SMA=242, Sharpe=0.1084, Trades=14
[INFO] Cluster 12 cluster: Short SMA=172, Long SMA=214, Sharpe=-0.1394, Trades=19
[INFO] Cluster 13 cluster: Short SMA=30, Long SMA=266, Sharpe=-0.0347, Trades=20
[INFO] Cluster 14 cluster: Short SMA=60, Long SMA=110, Sharpe=-0.3545, Trades=35
[INFO] Cluster 15 cluster: Short SMA=230, Long SMA=234, Sharpe=-0.1039, Trades=47
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=22
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=40, Sharpe=0.4677, Trades=200
[INFO] Top 2: Short SMA=112, Long SMA=174, Sharpe=0.3795, Trades=18
[INFO] Top 3: Short SMA=32, Long SMA=40, Sharpe=0.3634, Trades=100
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 9874 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/40) - Original Sharpe: 0.4677, Trades: 200
[INFO] Hierarchical cluster 2: SMA(112/174) - Original Sharpe: 0.3795, Trades: 18
[INFO] Hierarchical cluster 3: SMA(32/40) - Original Sharpe: 0.3634, Trades: 100
[INFO] Hierarchical cluster 4: SMA(18/208) - Original Sharpe: 0.2323, Trades: 28
[INFO] Hierarchical cluster 5: SMA(22/72) - Original Sharpe: 0.1815, Trades: 52
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/40) - Sharpe: 0.4677
[INFO] cluster 2: (112/174) - Sharpe: 0.3795
[INFO] cluster 3: (32/40) - Sharpe: 0.3634
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            1.055816
1    2021-11-14 2021-11-14            43     0.620829           -3.391430
2    2022-01-14 2022-01-14            41     0.058063           -1.138184
3    2022-03-14 2022-03-14            44     1.979608           -2.309447
4    2022-05-14 2022-05-14            43    -1.220633            0.197042
5    2022-07-14 2022-07-14            44     0.448047           -1.716850
6    2022-09-14 2022-09-14            43     0.790083            0.844593
7    2022-11-14 2022-11-14            43    -1.736792            0.716913
8    2023-01-14 2023-01-14            41     2.493082           -2.144162
9    2023-03-14 2023-03-14            44    -0.132668            0.826408
10   2023-05-14 2023-05-14            44     0.580825           -3.066739
11   2023-07-14 2023-07-14            44     4.541233            2.249561
12   2023-09-14 2023-09-14            43     0.691612            0.008725
13   2023-11-14 2023-11-14            42    -2.563801           -2.231887
14   2024-01-14 2024-01-14            43     4.073536           -2.672153
15   2024-03-14 2024-03-14            42    -0.424007           -1.170125
16   2024-05-14 2024-05-14            44    -1.116674           -3.003691
17   2024-07-14 2024-07-14            45     3.495207           -4.037267
18   2024-09-14 2024-09-14            43    -2.003748            0.787045
19   2024-11-14 2024-11-14            33     3.170976            4.487936
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              1.1 |          0.5 | True          
[INFO] 2021-11-14   |          0.6 |             -3.4 |         -4.0 | False         
[INFO] 2022-01-14   |          0.1 |             -1.1 |         -1.2 | False         
[INFO] 2022-03-14   |          2.0 |             -2.3 |         -4.3 | False         
[INFO] 2022-05-14   |         -1.2 |              0.2 |          1.4 | True          
[INFO] 2022-07-14   |          0.4 |             -1.7 |         -2.1 | False         
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |              0.7 |          2.4 | True          
[INFO] 2023-01-14   |          2.5 |             -2.1 |         -4.6 | False         
[INFO] 2023-03-14   |         -0.1 |              0.8 |          0.9 | True          
[INFO] 2023-05-14   |          0.6 |             -3.1 |         -3.7 | False         
[INFO] 2023-07-14   |          4.5 |              2.2 |         -2.3 | False         
[INFO] 2023-09-14   |          0.7 |              0.0 |         -0.7 | False         
[INFO] 2023-11-14   |         -2.6 |             -2.2 |          0.4 | True          
[INFO] 2024-01-14   |          4.1 |             -2.7 |         -6.8 | False         
[INFO] 2024-03-14   |         -0.4 |             -1.2 |         -0.8 | False         
[INFO] 2024-05-14   |         -1.1 |             -3.0 |         -1.9 | False         
[INFO] 2024-07-14   |          3.5 |             -4.0 |         -7.5 | False         
[INFO] 2024-09-14   |         -2.0 |              0.8 |          2.8 | True          
[INFO] 2024-11-14   |          3.2 |              4.5 |          1.3 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 19 periods (36.84% win rate)
[INFO] Updating Excel file with Hierarchical results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical win rate 36.8% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/40) - Original Sharpe: 0.4677
[INFO] Added cluster 2 to portfolio: SMA(112/174) - Original Sharpe: 0.3795
[INFO] Added cluster 3 to portfolio: SMA(32/40) - Original Sharpe: 0.3634
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.7571
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6449
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BO in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 243.16s
[INFO] Best parameters: Short SMA = 48, Long SMA = 54
[INFO] Best Sharpe ratio: 1.148397, Trades: 89
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_BO_best_48/54 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BO
[INFO] Big Point Value (from data): 600.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 13.60 contracts
[INFO] Maximum Position Size: 31 contracts
[INFO] Strategy Total P&L: $553,098.00
[INFO] Market Buy & Hold P&L: $8,556.00
[INFO] Outperformance: $544,542.00
[INFO] Sharpe ratio (entire period, annualized): 0.651163
[INFO] Sharpe ratio (in-sample, annualized): 1.148397
[INFO] Sharpe ratio (out-of-sample, annualized): -0.439751
[INFO] Maximum Drawdown: $162,660.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 63
[INFO] Out-of-sample period trades: 26
[INFO] Total trades: 89
[INFO] In-sample P&L: $556,682.00
[INFO] Out-of-sample P&L: $-96,936.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 54, Sharpe = 1.148397
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 89
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9834 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3624 to 2.7150
[INFO] Scaled Long SMA range: -2.7630 to 1.5177
[INFO] Scaled Sharpe ratio range: -2.5920 to 4.1745
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 20
[INFO] Using 20 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=20...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 450 elements
[INFO] Kmeans Cluster 1: 549 elements
[INFO] Kmeans Cluster 2: 453 elements
[INFO] Kmeans Cluster 3: 390 elements
[INFO] Kmeans Cluster 4: 622 elements
[INFO] Kmeans Cluster 5: 513 elements
[INFO] Kmeans Cluster 6: 321 elements
[INFO] Kmeans Cluster 7: 624 elements
[INFO] Kmeans Cluster 8: 553 elements
[INFO] Kmeans Cluster 9: 725 elements
[INFO] Kmeans Cluster 10: 635 elements
[INFO] Kmeans Cluster 11: 811 elements
[INFO] Kmeans Cluster 12: 549 elements
[INFO] Kmeans Cluster 13: 572 elements
[INFO] Kmeans Cluster 14: 414 elements
[INFO] Kmeans Cluster 15: 109 elements
[INFO] Kmeans Cluster 16: 119 elements
[INFO] Kmeans Cluster 17: 627 elements
[INFO] Kmeans Cluster 18: 292 elements
[INFO] Kmeans Cluster 19: 506 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=70.72, Long SMA=161.40, Sharpe=-0.3203
[INFO] Centroid 1: Short SMA=92.54, Long SMA=217.49, Sharpe=0.0305
[INFO] Centroid 2: Short SMA=98.76, Long SMA=251.44, Sharpe=0.1973
[INFO] Centroid 3: Short SMA=32.91, Long SMA=66.44, Sharpe=0.7578
[INFO] Centroid 4: Short SMA=190.33, Long SMA=224.68, Sharpe=0.1779
[INFO] Centroid 5: Short SMA=29.39, Long SMA=94.92, Sharpe=0.4577
[INFO] Centroid 6: Short SMA=252.96, Long SMA=278.97, Sharpe=0.1798
[INFO] Centroid 7: Short SMA=84.26, Long SMA=122.11, Sharpe=-0.0898
[INFO] Centroid 8: Short SMA=26.39, Long SMA=200.87, Sharpe=0.0900
[INFO] Centroid 9: Short SMA=119.14, Long SMA=164.16, Sharpe=-0.1200
[INFO] Centroid 10: Short SMA=223.03, Long SMA=269.38, Sharpe=0.4453
[INFO] Centroid 11: Short SMA=34.42, Long SMA=270.56, Sharpe=0.2537
[INFO] Centroid 12: Short SMA=141.23, Long SMA=246.47, Sharpe=-0.0178
[INFO] Centroid 13: Short SMA=176.10, Long SMA=272.19, Sharpe=0.1555
[INFO] Centroid 14: Short SMA=28.72, Long SMA=146.13, Sharpe=0.2817
[INFO] Centroid 15: Short SMA=275.39, Long SMA=293.23, Sharpe=-0.1450
[INFO] Centroid 16: Short SMA=18.30, Long SMA=32.30, Sharpe=-0.0340
[INFO] Centroid 17: Short SMA=151.77, Long SMA=192.32, Sharpe=0.0205
[INFO] Centroid 18: Short SMA=63.64, Long SMA=95.98, Sharpe=0.1224
[INFO] Centroid 19: Short SMA=59.74, Long SMA=204.05, Sharpe=-0.1333
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=54, Sharpe=1.1484, Trades=89
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=34, Long SMA=66, Sharpe=0.7147, Trades=40
[INFO] Kmeans Top 2: Short SMA=222, Long SMA=270, Sharpe=0.5040, Trades=14
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=100, Sharpe=0.4464, Trades=30
[INFO] Kmeans Top 4: Short SMA=34, Long SMA=270, Sharpe=0.3813, Trades=10
[INFO] Kmeans Top 5: Short SMA=100, Long SMA=252, Sharpe=0.2484, Trades=10
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19}
[INFO]   Rounded: (71, 161)
[INFO]   Nearest: (70.0, 162.0)
[INFO]   Rounded: (93, 217)
[INFO]   Nearest: (92.0, 218.0)
[INFO]   Rounded: (99, 251)
[INFO]   Nearest: (98.0, 252.0)
[INFO]   Rounded: (33, 66)
[INFO]   Nearest: (32.0, 66.0)
[INFO]   Rounded: (190, 225)
[INFO]   Nearest: (190.0, 224.0)
[INFO]   Rounded: (29, 95)
[INFO]   Nearest: (30.0, 94.0)
[INFO]   Rounded: (253, 279)
[INFO]   Nearest: (252.0, 278.0)
[INFO]   Rounded: (84, 122)
[INFO]   Rounded: (26, 201)
[INFO]   Nearest: (26.0, 200.0)
[INFO]   Rounded: (119, 164)
[INFO]   Nearest: (120.0, 164.0)
[INFO]   Rounded: (223, 269)
[INFO]   Nearest: (224.0, 270.0)
[INFO]   Rounded: (34, 271)
[INFO]   Nearest: (34.0, 270.0)
[INFO]   Rounded: (141, 246)
[INFO]   Nearest: (142.0, 246.0)
[INFO]   Rounded: (176, 272)
[INFO]   Rounded: (29, 146)
[INFO]   Nearest: (28.0, 146.0)
[INFO]   Rounded: (275, 293)
[INFO]   Nearest: (276.0, 294.0)
[INFO]   Rounded: (18, 32)
[INFO]   Rounded: (152, 192)
[INFO]   Rounded: (64, 96)
[INFO]   Rounded: (60, 204)
[INFO] Successfully plotted 20 out of 20 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 54
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(34/66) - Original Sharpe: 0.7147, Trades: 40
[INFO] Kmeans cluster 2: SMA(222/270) - Original Sharpe: 0.5040, Trades: 14
[INFO] Kmeans cluster 3: SMA(28/100) - Original Sharpe: 0.4464, Trades: 30
[INFO] Kmeans cluster 4: SMA(34/270) - Original Sharpe: 0.3813, Trades: 10
[INFO] Kmeans cluster 5: SMA(100/252) - Original Sharpe: 0.2484, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/54)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/66) - Sharpe: 0.7147
[INFO] cluster 2: (222/270) - Sharpe: 0.5040
[INFO] cluster 3: (28/100) - Sharpe: 0.4464
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -3.408887           -4.707395
1    2021-11-10 2021-11-10            41    -4.249630           -2.782165
2    2022-01-10 2022-01-10            41     1.218137            1.939137
3    2022-03-10 2022-03-10            42     2.126254            2.126254
4    2022-05-10 2022-05-10            41    -5.000926           -4.174328
5    2022-07-10 2022-07-10            44    -0.790260           -0.790260
6    2022-09-10 2022-09-10            43     1.268514            3.138868
7    2022-11-10 2022-11-10            40    -2.869549           -2.585532
8    2023-01-10 2023-01-10            41     1.869806            2.621060
9    2023-03-10 2023-03-10            42     1.878823            2.222624
10   2023-05-10 2023-05-10            40    -1.601658           -1.740458
11   2023-07-10 2023-07-10            44     0.545769            1.585851
12   2023-09-10 2023-09-10            44     0.229410            2.312997
13   2023-11-10 2023-11-10            40     0.831968            0.831968
14   2024-01-10 2024-01-10            41     1.354455            1.633020
15   2024-03-10 2024-03-10            43    -1.598528           -2.607613
16   2024-05-10 2024-05-10            40     1.637085           -1.616171
17   2024-07-10 2024-07-10            43    -1.484568            1.507953
18   2024-09-10 2024-09-10            44     1.814989           -0.699935
19   2024-11-10 2024-11-10            35    -2.317816           -4.332633
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -3.4 |             -4.7 |         -1.3 | False         
[INFO] 2021-11-10   |         -4.2 |             -2.8 |          1.4 | True          
[INFO] 2022-01-10   |          1.2 |              1.9 |          0.7 | True          
[INFO] 2022-03-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -5.0 |             -4.2 |          0.8 | True          
[INFO] 2022-07-10   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2022-09-10   |          1.3 |              3.1 |          1.8 | True          
[INFO] 2022-11-10   |         -2.9 |             -2.6 |          0.3 | True          
[INFO] 2023-01-10   |          1.9 |              2.6 |          0.7 | True          
[INFO] 2023-03-10   |          1.9 |              2.2 |          0.3 | True          
[INFO] 2023-05-10   |         -1.6 |             -1.7 |         -0.1 | False         
[INFO] 2023-07-10   |          0.5 |              1.6 |          1.1 | True          
[INFO] 2023-09-10   |          0.2 |              2.3 |          2.1 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.4 |              1.6 |          0.2 | True          
[INFO] 2024-03-10   |         -1.6 |             -2.6 |         -1.0 | False         
[INFO] 2024-05-10   |          1.6 |             -1.6 |         -3.2 | False         
[INFO] 2024-07-10   |         -1.5 |              1.5 |          3.0 | True          
[INFO] 2024-09-10   |          1.8 |             -0.7 |         -2.5 | False         
[INFO] 2024-11-10   |         -2.3 |             -4.3 |         -2.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-10, 2022-07-10, 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 11 of 17 periods (64.71% win rate)
[INFO] Updating Excel file with Kmeans results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans win rate 64.7% in row 4
[INFO] Added best Sharpe parameters 48/54 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 54
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/66) - Original Sharpe: 0.7147
[INFO] Added cluster 2 to portfolio: SMA(222/270) - Original Sharpe: 0.5040
[INFO] Added cluster 3 to portfolio: SMA(28/100) - Original Sharpe: 0.4464
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BO_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.2042
[INFO] Kmeans Best out-of-sample Sharpe: -0.4398
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BO
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 89
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9834 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3624 to 2.7150
[INFO] Scaled Long SMA range: -2.7630 to 1.5177
[INFO] Scaled Sharpe ratio range: -2.5920 to 4.1745
[INFO] Scaled Trades range: -0.7949 to 15.6625
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9834 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5858
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 429 elements
[INFO] Cluster 1: 1324 elements
[INFO] Cluster 2: 961 elements
[INFO] Cluster 3: 439 elements
[INFO] Cluster 4: 1486 elements
[INFO] Cluster 5: 901 elements
[INFO] Cluster 6: 127 elements
[INFO] Cluster 7: 835 elements
[INFO] Cluster 8: 444 elements
[INFO] Cluster 9: 878 elements
[INFO] Cluster 10: 446 elements
[INFO] Cluster 11: 18 elements
[INFO] Cluster 12: 808 elements
[INFO] Cluster 13: 245 elements
[INFO] Cluster 14: 493 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=94, Long SMA=104, Sharpe=0.1172, Trades=47
[INFO] Cluster 1 cluster: Short SMA=180, Long SMA=240, Sharpe=0.3220, Trades=16
[INFO] Cluster 2 cluster: Short SMA=38, Long SMA=200, Sharpe=-0.0395, Trades=24
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=64, Sharpe=0.7807, Trades=42
[INFO] Cluster 4 cluster: Short SMA=112, Long SMA=198, Sharpe=-0.0846, Trades=18
[INFO] Cluster 5 cluster: Short SMA=124, Long SMA=256, Sharpe=0.0727, Trades=10
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=32, Sharpe=0.1013, Trades=106
[INFO] Cluster 7 cluster: Short SMA=28, Long SMA=124, Sharpe=0.4727, Trades=26
[INFO] Cluster 8 cluster: Short SMA=254, Long SMA=284, Sharpe=0.2692, Trades=24
[INFO] Cluster 9 cluster: Short SMA=32, Long SMA=268, Sharpe=0.3417, Trades=14
[INFO] Cluster 10 cluster: Short SMA=218, Long SMA=274, Sharpe=0.5041, Trades=14
[INFO] Cluster 12 cluster: Short SMA=80, Long SMA=150, Sharpe=-0.3651, Trades=22
[INFO] Cluster 13 cluster: Short SMA=228, Long SMA=236, Sharpe=0.5224, Trades=40
[INFO] Cluster 14 cluster: Short SMA=80, Long SMA=120, Sharpe=-0.0554, Trades=23
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=54, Sharpe=1.1484, Trades=89
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=34, Long SMA=64, Sharpe=0.7807, Trades=42
[INFO] Top 2: Short SMA=228, Long SMA=236, Sharpe=0.5224, Trades=40
[INFO] Top 3: Short SMA=218, Long SMA=274, Sharpe=0.5041, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 9816 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 54
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(34/64) - Original Sharpe: 0.7807, Trades: 42
[INFO] Hierarchical cluster 2: SMA(228/236) - Original Sharpe: 0.5224, Trades: 40
[INFO] Hierarchical cluster 3: SMA(218/274) - Original Sharpe: 0.5041, Trades: 14
[INFO] Hierarchical cluster 4: SMA(28/124) - Original Sharpe: 0.4727, Trades: 26
[INFO] Hierarchical cluster 5: SMA(32/268) - Original Sharpe: 0.3417, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/54)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/64) - Sharpe: 0.7807
[INFO] cluster 2: (228/236) - Sharpe: 0.5224
[INFO] cluster 3: (218/274) - Sharpe: 0.5041
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -3.408887           -1.341874
1    2021-11-10 2021-11-10            41    -4.249630           -1.497369
2    2022-01-10 2022-01-10            41     1.218137            3.686338
3    2022-03-10 2022-03-10            42     2.126254            1.167442
4    2022-05-10 2022-05-10            41    -5.000926           -4.719224
5    2022-07-10 2022-07-10            44    -0.790260            0.786337
6    2022-09-10 2022-09-10            43     1.268514            3.353134
7    2022-11-10 2022-11-10            40    -2.869549           -2.263436
8    2023-01-10 2023-01-10            41     1.869806           -2.621060
9    2023-03-10 2023-03-10            42     1.878823            2.403800
10   2023-05-10 2023-05-10            40    -1.601658            0.687140
11   2023-07-10 2023-07-10            44     0.545769           -0.166408
12   2023-09-10 2023-09-10            44     0.229410            3.548579
13   2023-11-10 2023-11-10            40     0.831968            0.831968
14   2024-01-10 2024-01-10            41     1.354455            1.898116
15   2024-03-10 2024-03-10            43    -1.598528           -4.883279
16   2024-05-10 2024-05-10            40     1.637085           -0.639947
17   2024-07-10 2024-07-10            43    -1.484568            1.431807
18   2024-09-10 2024-09-10            44     1.814989           -2.772432
19   2024-11-10 2024-11-10            35    -2.317816            3.596789
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -3.4 |             -1.3 |          2.1 | True          
[INFO] 2021-11-10   |         -4.2 |             -1.5 |          2.7 | True          
[INFO] 2022-01-10   |          1.2 |              3.7 |          2.5 | True          
[INFO] 2022-03-10   |          2.1 |              1.2 |         -0.9 | False         
[INFO] 2022-05-10   |         -5.0 |             -4.7 |          0.3 | True          
[INFO] 2022-07-10   |         -0.8 |              0.8 |          1.6 | True          
[INFO] 2022-09-10   |          1.3 |              3.4 |          2.1 | True          
[INFO] 2022-11-10   |         -2.9 |             -2.3 |          0.6 | True          
[INFO] 2023-01-10   |          1.9 |             -2.6 |         -4.5 | False         
[INFO] 2023-03-10   |          1.9 |              2.4 |          0.5 | True          
[INFO] 2023-05-10   |         -1.6 |              0.7 |          2.3 | True          
[INFO] 2023-07-10   |          0.5 |             -0.2 |         -0.7 | False         
[INFO] 2023-09-10   |          0.2 |              3.5 |          3.3 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.4 |              1.9 |          0.5 | True          
[INFO] 2024-03-10   |         -1.6 |             -4.9 |         -3.3 | False         
[INFO] 2024-05-10   |          1.6 |             -0.6 |         -2.2 | False         
[INFO] 2024-07-10   |         -1.5 |              1.4 |          2.9 | True          
[INFO] 2024-09-10   |          1.8 |             -2.8 |         -4.6 | False         
[INFO] 2024-11-10   |         -2.3 |              3.6 |          5.9 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 13 of 19 periods (68.42% win rate)
[INFO] Updating Excel file with Hierarchical results for BO...
[INFO] Excel file updated successfully. Added BO with Hierarchical win rate 68.4% in row 4
[INFO] Added best Sharpe parameters 48/54 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 54
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/64) - Original Sharpe: 0.7807
[INFO] Added cluster 2 to portfolio: SMA(228/236) - Original Sharpe: 0.5224
[INFO] Added cluster 3 to portfolio: SMA(218/274) - Original Sharpe: 0.5041
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BO_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1664
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4398
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for BO...
[INFO] Excel file updated successfully. Added BO with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BO
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BP in column D: 8.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 259.63s
[INFO] Best parameters: Short SMA = 42, Long SMA = 58
[INFO] Best Sharpe ratio: 0.774978, Trades: 55
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_BP_best_42/58 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BP
[INFO] Big Point Value (from data): 62500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.80 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $603,751.00
[INFO] Market Buy & Hold P&L: $-29,593.75
[INFO] Outperformance: $633,344.75
[INFO] Sharpe ratio (entire period, annualized): 0.716232
[INFO] Sharpe ratio (in-sample, annualized): 0.774978
[INFO] Sharpe ratio (out-of-sample, annualized): 0.572860
[INFO] Maximum Drawdown: $88,641.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 39
[INFO] Out-of-sample period trades: 16
[INFO] Total trades: 55
[INFO] In-sample P&L: $424,013.75
[INFO] Out-of-sample P&L: $128,250.00
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 58, Sharpe = 0.774978
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 62500.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5932 to 0.7750
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 58
[INFO] Sharpe Ratio: 0.774978
[INFO] Number of Trades: 55
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5932 to 0.7750
[INFO] Trades range: 11.0 to 357.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.8418 to 3.9473
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 19
[INFO] Using 19 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=19...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 216 elements
[INFO] Kmeans Cluster 1: 606 elements
[INFO] Kmeans Cluster 2: 543 elements
[INFO] Kmeans Cluster 3: 475 elements
[INFO] Kmeans Cluster 4: 822 elements
[INFO] Kmeans Cluster 5: 496 elements
[INFO] Kmeans Cluster 6: 515 elements
[INFO] Kmeans Cluster 7: 377 elements
[INFO] Kmeans Cluster 8: 692 elements
[INFO] Kmeans Cluster 9: 703 elements
[INFO] Kmeans Cluster 10: 823 elements
[INFO] Kmeans Cluster 11: 150 elements
[INFO] Kmeans Cluster 12: 585 elements
[INFO] Kmeans Cluster 13: 912 elements
[INFO] Kmeans Cluster 14: 199 elements
[INFO] Kmeans Cluster 15: 560 elements
[INFO] Kmeans Cluster 16: 540 elements
[INFO] Kmeans Cluster 17: 557 elements
[INFO] Kmeans Cluster 18: 814 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=22.69, Long SMA=284.93, Sharpe=0.3859
[INFO] Centroid 1: Short SMA=127.60, Long SMA=250.03, Sharpe=-0.1218
[INFO] Centroid 2: Short SMA=88.54, Long SMA=129.22, Sharpe=0.1349
[INFO] Centroid 3: Short SMA=129.86, Long SMA=281.76, Sharpe=0.0397
[INFO] Centroid 4: Short SMA=77.39, Long SMA=138.57, Sharpe=-0.0548
[INFO] Centroid 5: Short SMA=250.92, Long SMA=275.77, Sharpe=-0.1289
[INFO] Centroid 6: Short SMA=27.48, Long SMA=164.40, Sharpe=0.1927
[INFO] Centroid 7: Short SMA=37.97, Long SMA=76.46, Sharpe=0.3084
[INFO] Centroid 8: Short SMA=182.29, Long SMA=256.25, Sharpe=0.2302
[INFO] Centroid 9: Short SMA=216.88, Long SMA=278.29, Sharpe=0.0273
[INFO] Centroid 10: Short SMA=71.04, Long SMA=269.92, Sharpe=0.1165
[INFO] Centroid 11: Short SMA=72.69, Long SMA=95.52, Sharpe=-0.2972
[INFO] Centroid 12: Short SMA=147.90, Long SMA=183.46, Sharpe=-0.1399
[INFO] Centroid 13: Short SMA=106.80, Long SMA=200.46, Sharpe=0.0449
[INFO] Centroid 14: Short SMA=23.08, Long SMA=44.25, Sharpe=0.0417
[INFO] Centroid 15: Short SMA=182.09, Long SMA=212.09, Sharpe=0.1084
[INFO] Centroid 16: Short SMA=29.12, Long SMA=245.24, Sharpe=0.1945
[INFO] Centroid 17: Short SMA=29.64, Long SMA=94.58, Sharpe=0.4985
[INFO] Centroid 18: Short SMA=52.49, Long SMA=203.32, Sharpe=0.0180
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=58, Sharpe=0.7750, Trades=55
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=30, Long SMA=94, Sharpe=0.5469, Trades=27
[INFO] Kmeans Top 2: Short SMA=38, Long SMA=72, Sharpe=0.4093, Trades=37
[INFO] Kmeans Top 3: Short SMA=22, Long SMA=286, Sharpe=0.3407, Trades=16
[INFO] Kmeans Top 4: Short SMA=28, Long SMA=164, Sharpe=0.2965, Trades=17
[INFO] Kmeans Top 5: Short SMA=72, Long SMA=270, Sharpe=0.2116, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18}
[INFO]   Rounded: (23, 285)
[INFO]   Nearest: (22.0, 284.0)
[INFO]   Rounded: (128, 250)
[INFO]   Rounded: (89, 129)
[INFO]   Nearest: (88.0, 130.0)
[INFO]   Rounded: (130, 282)
[INFO]   Rounded: (77, 139)
[INFO]   Nearest: (78.0, 138.0)
[INFO]   Rounded: (251, 276)
[INFO]   Nearest: (250.0, 276.0)
[INFO]   Rounded: (27, 164)
[INFO]   Nearest: (28.0, 164.0)
[INFO]   Rounded: (38, 76)
[INFO]   Rounded: (182, 256)
[INFO]   Rounded: (217, 278)
[INFO]   Nearest: (216.0, 278.0)
[INFO]   Rounded: (71, 270)
[INFO]   Nearest: (72.0, 270.0)
[INFO]   Rounded: (73, 96)
[INFO]   Nearest: (72.0, 96.0)
[INFO]   Rounded: (148, 183)
[INFO]   Nearest: (148.0, 184.0)
[INFO]   Rounded: (107, 200)
[INFO]   Nearest: (106.0, 200.0)
[INFO]   Rounded: (23, 44)
[INFO]   Nearest: (24.0, 44.0)
[INFO]   Rounded: (182, 212)
[INFO]   Rounded: (29, 245)
[INFO]   Nearest: (30.0, 246.0)
[INFO]   Rounded: (30, 95)
[INFO]   Nearest: (30.0, 94.0)
[INFO]   Rounded: (52, 203)
[INFO]   Nearest: (52.0, 204.0)
[INFO] Successfully plotted 19 out of 19 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 58
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(30/94) - Original Sharpe: 0.5469, Trades: 27
[INFO] Kmeans cluster 2: SMA(38/72) - Original Sharpe: 0.4093, Trades: 37
[INFO] Kmeans cluster 3: SMA(22/286) - Original Sharpe: 0.3407, Trades: 16
[INFO] Kmeans cluster 4: SMA(28/164) - Original Sharpe: 0.2965, Trades: 17
[INFO] Kmeans cluster 5: SMA(72/270) - Original Sharpe: 0.2116, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/58)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (30/94) - Sharpe: 0.5469
[INFO] cluster 2: (38/72) - Sharpe: 0.4093
[INFO] cluster 3: (22/286) - Sharpe: 0.3407
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.987883            1.835055
1    2021-11-14 2021-11-14            43    -2.596797           -2.596797
2    2022-01-14 2022-01-14            41    -0.015731            0.109777
3    2022-03-14 2022-03-14            44     3.605243            3.630872
4    2022-05-14 2022-05-14            43     1.166814            1.166814
5    2022-07-14 2022-07-14            44     2.275295            2.275295
6    2022-09-14 2022-09-14            43     0.019017            0.019017
7    2022-11-14 2022-11-14            43    -0.093903           -0.722090
8    2023-01-14 2023-01-14            41     1.898865           -3.744722
9    2023-03-14 2023-03-14            44    -0.658221           -1.273529
10   2023-05-14 2023-05-14            44     4.055520            4.055520
11   2023-07-14 2023-07-14            44    -5.179654           -4.802253
12   2023-09-14 2023-09-14            43     1.327473           -0.204453
13   2023-11-14 2023-11-14            42    -1.340773           -0.862910
14   2024-01-14 2024-01-14            43    -2.266886           -0.188653
15   2024-03-14 2024-03-14            42     2.522025           -3.785640
16   2024-05-14 2024-05-14            44    -0.336600            0.295703
17   2024-07-14 2024-07-14            45     0.798888            0.798888
18   2024-09-14 2024-09-14            43     0.601562           -1.491092
19   2024-11-14 2024-11-14            33     1.741863            2.278971
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              1.8 |          0.8 | True          
[INFO] 2021-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -0.0 |              0.1 |          0.1 | True          
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.1 |             -0.7 |         -0.6 | False         
[INFO] 2023-01-14   |          1.9 |             -3.7 |         -5.6 | False         
[INFO] 2023-03-14   |         -0.7 |             -1.3 |         -0.6 | False         
[INFO] 2023-05-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -5.2 |             -4.8 |          0.4 | True          
[INFO] 2023-09-14   |          1.3 |             -0.2 |         -1.5 | False         
[INFO] 2023-11-14   |         -1.3 |             -0.9 |          0.4 | True          
[INFO] 2024-01-14   |         -2.3 |             -0.2 |          2.1 | True          
[INFO] 2024-03-14   |          2.5 |             -3.8 |         -6.3 | False         
[INFO] 2024-05-14   |         -0.3 |              0.3 |          0.6 | True          
[INFO] 2024-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.6 |             -1.5 |         -2.1 | False         
[INFO] 2024-11-14   |          1.7 |              2.3 |          0.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 7 of 13 periods (53.85% win rate)
[INFO] Updating Excel file with Kmeans results for BP...
[INFO] Excel file updated successfully. Added BP with Kmeans win rate 53.8% in row 5
[INFO] Added best Sharpe parameters 42/58 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 58
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(30/94) - Original Sharpe: 0.5469
[INFO] Added cluster 2 to portfolio: SMA(38/72) - Original Sharpe: 0.4093
[INFO] Added cluster 3 to portfolio: SMA(22/286) - Original Sharpe: 0.3407
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BP_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1435
[INFO] Kmeans Best out-of-sample Sharpe: 0.5729
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for BP...
[INFO] Excel file updated successfully. Added BP with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BP
[INFO] Big Point Value: 62500.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5932 to 0.7750
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 58
[INFO] Sharpe Ratio: 0.774978
[INFO] Number of Trades: 55
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5932 to 0.7750
[INFO] Trades range: 11.0 to 357.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.8418 to 3.9473
[INFO] Scaled Trades range: -0.5447 to 17.8407
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4399
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1216 elements
[INFO] Cluster 1: 579 elements
[INFO] Cluster 2: 987 elements
[INFO] Cluster 3: 1083 elements
[INFO] Cluster 4: 901 elements
[INFO] Cluster 5: 1289 elements
[INFO] Cluster 6: 1077 elements
[INFO] Cluster 7: 339 elements
[INFO] Cluster 8: 2094 elements
[INFO] Cluster 9: 180 elements
[INFO] Cluster 10: 93 elements
[INFO] Cluster 11: 13 elements
[INFO] Cluster 12: 476 elements
[INFO] Cluster 13: 258 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=230, Long SMA=274, Sharpe=-0.1700, Trades=15
[INFO] Cluster 1 cluster: Short SMA=72, Long SMA=114, Sharpe=-0.1211, Trades=23
[INFO] Cluster 2 cluster: Short SMA=146, Long SMA=204, Sharpe=-0.1365, Trades=12
[INFO] Cluster 3 cluster: Short SMA=50, Long SMA=148, Sharpe=0.1137, Trades=17
[INFO] Cluster 4 cluster: Short SMA=124, Long SMA=276, Sharpe=0.0210, Trades=13
[INFO] Cluster 5 cluster: Short SMA=54, Long SMA=258, Sharpe=0.0625, Trades=15
[INFO] Cluster 6 cluster: Short SMA=184, Long SMA=238, Sharpe=0.1091, Trades=12
[INFO] Cluster 7 cluster: Short SMA=34, Long SMA=64, Sharpe=0.4405, Trades=45
[INFO] Cluster 8 cluster: Short SMA=82, Long SMA=190, Sharpe=0.1083, Trades=16
[INFO] Cluster 9 cluster: Short SMA=28, Long SMA=44, Sharpe=-0.0661, Trades=75
[INFO] Cluster 10 cluster: Short SMA=36, Long SMA=40, Sharpe=0.0745, Trades=121
[INFO] Cluster 12 cluster: Short SMA=28, Long SMA=102, Sharpe=0.5284, Trades=25
[INFO] Cluster 13 cluster: Short SMA=24, Long SMA=284, Sharpe=0.3257, Trades=14
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=58, Sharpe=0.7750, Trades=55
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=28, Long SMA=102, Sharpe=0.5284, Trades=25
[INFO] Top 2: Short SMA=34, Long SMA=64, Sharpe=0.4405, Trades=45
[INFO] Top 3: Short SMA=24, Long SMA=284, Sharpe=0.3257, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 10572 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 58
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(28/102) - Original Sharpe: 0.5284, Trades: 25
[INFO] Hierarchical cluster 2: SMA(34/64) - Original Sharpe: 0.4405, Trades: 45
[INFO] Hierarchical cluster 3: SMA(24/284) - Original Sharpe: 0.3257, Trades: 14
[INFO] Hierarchical cluster 4: SMA(50/148) - Original Sharpe: 0.1137, Trades: 17
[INFO] Hierarchical cluster 5: SMA(184/238) - Original Sharpe: 0.1091, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/58)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (28/102) - Sharpe: 0.5284
[INFO] cluster 2: (34/64) - Sharpe: 0.4405
[INFO] cluster 3: (24/284) - Sharpe: 0.3257
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.987883            2.348998
1    2021-11-14 2021-11-14            43    -2.596797           -2.596797
2    2022-01-14 2022-01-14            41    -0.015731            2.767010
3    2022-03-14 2022-03-14            44     3.605243            3.605243
4    2022-05-14 2022-05-14            43     1.166814            1.166814
5    2022-07-14 2022-07-14            44     2.275295            2.275295
6    2022-09-14 2022-09-14            43     0.019017            0.019017
7    2022-11-14 2022-11-14            43    -0.093903            0.442098
8    2023-01-14 2023-01-14            41     1.898865           -2.541634
9    2023-03-14 2023-03-14            44    -0.658221           -2.550419
10   2023-05-14 2023-05-14            44     4.055520            4.055520
11   2023-07-14 2023-07-14            44    -5.179654           -4.089935
12   2023-09-14 2023-09-14            43     1.327473            0.279474
13   2023-11-14 2023-11-14            42    -1.340773           -1.447438
14   2024-01-14 2024-01-14            43    -2.266886           -0.346392
15   2024-03-14 2024-03-14            42     2.522025           -4.192801
16   2024-05-14 2024-05-14            44    -0.336600            0.364496
17   2024-07-14 2024-07-14            45     0.798888            0.798888
18   2024-09-14 2024-09-14            43     0.601562           -0.926730
19   2024-11-14 2024-11-14            33     1.741863            1.765809
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              2.3 |          1.3 | True          
[INFO] 2021-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -0.0 |              2.8 |          2.8 | True          
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.1 |              0.4 |          0.5 | True          
[INFO] 2023-01-14   |          1.9 |             -2.5 |         -4.4 | False         
[INFO] 2023-03-14   |         -0.7 |             -2.6 |         -1.9 | False         
[INFO] 2023-05-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -5.2 |             -4.1 |          1.1 | True          
[INFO] 2023-09-14   |          1.3 |              0.3 |         -1.0 | False         
[INFO] 2023-11-14   |         -1.3 |             -1.4 |         -0.1 | False         
[INFO] 2024-01-14   |         -2.3 |             -0.3 |          2.0 | True          
[INFO] 2024-03-14   |          2.5 |             -4.2 |         -6.7 | False         
[INFO] 2024-05-14   |         -0.3 |              0.4 |          0.7 | True          
[INFO] 2024-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.6 |             -0.9 |         -1.5 | False         
[INFO] 2024-11-14   |          1.7 |              1.8 |          0.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 13 periods (53.85% win rate)
[INFO] Updating Excel file with Hierarchical results for BP...
[INFO] Excel file updated successfully. Added BP with Hierarchical win rate 53.8% in row 5
[INFO] Added best Sharpe parameters 42/58 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 58
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(28/102) - Original Sharpe: 0.5284
[INFO] Added cluster 2 to portfolio: SMA(34/64) - Original Sharpe: 0.4405
[INFO] Added cluster 3 to portfolio: SMA(24/284) - Original Sharpe: 0.3257
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BP_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2148
[INFO] Hierarchical Best out-of-sample Sharpe: 0.5729
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for BP...
[INFO] Excel file updated successfully. Added BP with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BP
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BRN in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 267.25s
[INFO] Best parameters: Short SMA = 10, Long SMA = 26
[INFO] Best Sharpe ratio: 1.115955, Trades: 106
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_BRN_best_10/26 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BRN=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.82 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $738,554.00
[INFO] Market Buy & Hold P&L: $-13,990.00
[INFO] Outperformance: $752,544.00
[INFO] Sharpe ratio (entire period, annualized): 0.960879
[INFO] Sharpe ratio (in-sample, annualized): 1.115955
[INFO] Sharpe ratio (out-of-sample, annualized): 0.618723
[INFO] Maximum Drawdown: $146,756.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 66
[INFO] Out-of-sample period trades: 40
[INFO] Total trades: 106
[INFO] In-sample P&L: $658,590.00
[INFO] Out-of-sample P&L: $165,200.00
[INFO] 
Best parameters from GA: Short SMA = 10, Long SMA = 26, Sharpe = 1.115955
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8116 to 1.1160
[INFO] 
Best parameters:
[INFO] Short SMA: 10
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 1.115955
[INFO] Number of Trades: 106
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8116 to 1.1160
[INFO] Trades range: 11.0 to 325.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6772 to 3.5491
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 794 elements
[INFO] Kmeans Cluster 1: 386 elements
[INFO] Kmeans Cluster 2: 811 elements
[INFO] Kmeans Cluster 3: 667 elements
[INFO] Kmeans Cluster 4: 792 elements
[INFO] Kmeans Cluster 5: 688 elements
[INFO] Kmeans Cluster 6: 586 elements
[INFO] Kmeans Cluster 7: 520 elements
[INFO] Kmeans Cluster 8: 718 elements
[INFO] Kmeans Cluster 9: 751 elements
[INFO] Kmeans Cluster 10: 674 elements
[INFO] Kmeans Cluster 11: 511 elements
[INFO] Kmeans Cluster 12: 814 elements
[INFO] Kmeans Cluster 13: 433 elements
[INFO] Kmeans Cluster 14: 653 elements
[INFO] Kmeans Cluster 15: 419 elements
[INFO] Kmeans Cluster 16: 368 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=77.40, Long SMA=201.60, Sharpe=0.0183
[INFO] Centroid 1: Short SMA=26.07, Long SMA=50.88, Sharpe=0.6522
[INFO] Centroid 2: Short SMA=210.24, Long SMA=258.63, Sharpe=0.2596
[INFO] Centroid 3: Short SMA=78.89, Long SMA=269.54, Sharpe=0.1081
[INFO] Centroid 4: Short SMA=96.24, Long SMA=155.58, Sharpe=-0.2159
[INFO] Centroid 5: Short SMA=29.10, Long SMA=200.05, Sharpe=0.3864
[INFO] Centroid 6: Short SMA=249.27, Long SMA=284.29, Sharpe=0.0448
[INFO] Centroid 7: Short SMA=29.97, Long SMA=140.05, Sharpe=0.2373
[INFO] Centroid 8: Short SMA=141.18, Long SMA=251.12, Sharpe=0.3458
[INFO] Centroid 9: Short SMA=31.42, Long SMA=266.87, Sharpe=0.3688
[INFO] Centroid 10: Short SMA=138.06, Long SMA=188.69, Sharpe=0.0971
[INFO] Centroid 11: Short SMA=98.18, Long SMA=263.72, Sharpe=-0.1217
[INFO] Centroid 12: Short SMA=175.23, Long SMA=211.27, Sharpe=0.4909
[INFO] Centroid 13: Short SMA=163.07, Long SMA=286.74, Sharpe=0.0761
[INFO] Centroid 14: Short SMA=36.49, Long SMA=87.78, Sharpe=0.3938
[INFO] Centroid 15: Short SMA=92.04, Long SMA=128.18, Sharpe=-0.4364
[INFO] Centroid 16: Short SMA=69.82, Long SMA=107.89, Sharpe=-0.1054
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=10, Long SMA=26, Sharpe=1.1160, Trades=106
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=26, Long SMA=52, Sharpe=0.5696, Trades=59
[INFO] Kmeans Top 2: Short SMA=32, Long SMA=266, Sharpe=0.5451, Trades=17
[INFO] Kmeans Top 3: Short SMA=30, Long SMA=200, Sharpe=0.4433, Trades=19
[INFO] Kmeans Top 4: Short SMA=174, Long SMA=212, Sharpe=0.4413, Trades=21
[INFO] Kmeans Top 5: Short SMA=36, Long SMA=90, Sharpe=0.4235, Trades=35
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (77, 202)
[INFO]   Nearest: (78.0, 202.0)
[INFO]   Rounded: (26, 51)
[INFO]   Nearest: (26.0, 50.0)
[INFO]   Rounded: (210, 259)
[INFO]   Nearest: (210.0, 258.0)
[INFO]   Rounded: (79, 270)
[INFO]   Nearest: (78.0, 270.0)
[INFO]   Rounded: (96, 156)
[INFO]   Rounded: (29, 200)
[INFO]   Nearest: (30.0, 200.0)
[INFO]   Rounded: (249, 284)
[INFO]   Nearest: (250.0, 284.0)
[INFO]   Rounded: (30, 140)
[INFO]   Rounded: (141, 251)
[INFO]   Nearest: (142.0, 252.0)
[INFO]   Rounded: (31, 267)
[INFO]   Nearest: (32.0, 266.0)
[INFO]   Rounded: (138, 189)
[INFO]   Nearest: (138.0, 188.0)
[INFO]   Rounded: (98, 264)
[INFO]   Rounded: (175, 211)
[INFO]   Nearest: (176.0, 212.0)
[INFO]   Rounded: (163, 287)
[INFO]   Nearest: (164.0, 286.0)
[INFO]   Rounded: (36, 88)
[INFO]   Rounded: (92, 128)
[INFO]   Rounded: (70, 108)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 10, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(26/52) - Original Sharpe: 0.5696, Trades: 59
[INFO] Kmeans cluster 2: SMA(32/266) - Original Sharpe: 0.5451, Trades: 17
[INFO] Kmeans cluster 3: SMA(30/200) - Original Sharpe: 0.4433, Trades: 19
[INFO] Kmeans cluster 4: SMA(174/212) - Original Sharpe: 0.4413, Trades: 21
[INFO] Kmeans cluster 5: SMA(36/90) - Original Sharpe: 0.4235, Trades: 35
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (10/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (26/52) - Sharpe: 0.5696
[INFO] cluster 2: (32/266) - Sharpe: 0.5451
[INFO] cluster 3: (30/200) - Sharpe: 0.4433
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     4.800806            2.796250
1    2021-11-14 2021-11-14            44     2.049644           -1.839573
2    2022-01-14 2022-01-14            41     3.528418            3.315988
3    2022-03-14 2022-03-14            44     0.138982           -0.351255
4    2022-05-14 2022-05-14            43     1.388289           -0.570280
5    2022-07-14 2022-07-14            44    -3.155014            0.083238
6    2022-09-14 2022-09-14            43    -0.180219           -0.773597
7    2022-11-14 2022-11-14            43    -1.334805           -3.023680
8    2023-01-14 2023-01-14            41    -0.581478            2.162050
9    2023-03-14 2023-03-14            43    -0.524319            0.315569
10   2023-05-14 2023-05-14            44    -1.200228           -1.320560
11   2023-07-14 2023-07-14            44     0.362193            3.449807
12   2023-09-14 2023-09-14            43    -2.369631           -1.493159
13   2023-11-14 2023-11-14            42     1.581330           -1.044077
14   2024-01-14 2024-01-14            43     1.622963           -0.836360
15   2024-03-14 2024-03-14            42     4.138827            0.424545
16   2024-05-14 2024-05-14            44    -0.527309           -0.087039
17   2024-07-14 2024-07-14            45     1.437611           -0.186995
18   2024-09-14 2024-09-14            43    -0.271801           -0.852956
19   2024-11-14 2024-11-14            33     1.096941           -2.043336
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          4.8 |              2.8 |         -2.0 | False         
[INFO] 2021-11-14   |          2.0 |             -1.8 |         -3.8 | False         
[INFO] 2022-01-14   |          3.5 |              3.3 |         -0.2 | False         
[INFO] 2022-03-14   |          0.1 |             -0.4 |         -0.5 | False         
[INFO] 2022-05-14   |          1.4 |             -0.6 |         -2.0 | False         
[INFO] 2022-07-14   |         -3.2 |              0.1 |          3.3 | True          
[INFO] 2022-09-14   |         -0.2 |             -0.8 |         -0.6 | False         
[INFO] 2022-11-14   |         -1.3 |             -3.0 |         -1.7 | False         
[INFO] 2023-01-14   |         -0.6 |              2.2 |          2.8 | True          
[INFO] 2023-03-14   |         -0.5 |              0.3 |          0.8 | True          
[INFO] 2023-05-14   |         -1.2 |             -1.3 |         -0.1 | False         
[INFO] 2023-07-14   |          0.4 |              3.4 |          3.0 | True          
[INFO] 2023-09-14   |         -2.4 |             -1.5 |          0.9 | True          
[INFO] 2023-11-14   |          1.6 |             -1.0 |         -2.6 | False         
[INFO] 2024-01-14   |          1.6 |             -0.8 |         -2.4 | False         
[INFO] 2024-03-14   |          4.1 |              0.4 |         -3.7 | False         
[INFO] 2024-05-14   |         -0.5 |             -0.1 |          0.4 | True          
[INFO] 2024-07-14   |          1.4 |             -0.2 |         -1.6 | False         
[INFO] 2024-09-14   |         -0.3 |             -0.9 |         -0.6 | False         
[INFO] 2024-11-14   |          1.1 |             -2.0 |         -3.1 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 6 of 20 periods (30.00% win rate)
[INFO] Updating Excel file with Kmeans results for BRN...
[INFO] Excel file updated successfully. Added BRN with Kmeans win rate 30.0% in row 6
[INFO] Added best Sharpe parameters 10/26 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 10, Long SMA: 26
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(26/52) - Original Sharpe: 0.5696
[INFO] Added cluster 2 to portfolio: SMA(32/266) - Original Sharpe: 0.5451
[INFO] Added cluster 3 to portfolio: SMA(30/200) - Original Sharpe: 0.4433
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BRN_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0574
[INFO] Kmeans Best out-of-sample Sharpe: 0.6187
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for BRN...
[INFO] Excel file updated successfully. Added BRN with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BRN
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8116 to 1.1160
[INFO] 
Best parameters:
[INFO] Short SMA: 10
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 1.115955
[INFO] Number of Trades: 106
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8116 to 1.1160
[INFO] Trades range: 11.0 to 325.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6772 to 3.5491
[INFO] Scaled Trades range: -0.7653 to 15.8184
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5971
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 269 elements
[INFO] Cluster 1: 1090 elements
[INFO] Cluster 2: 1353 elements
[INFO] Cluster 3: 1311 elements
[INFO] Cluster 4: 910 elements
[INFO] Cluster 5: 897 elements
[INFO] Cluster 6: 514 elements
[INFO] Cluster 7: 91 elements
[INFO] Cluster 8: 441 elements
[INFO] Cluster 9: 1150 elements
[INFO] Cluster 10: 1256 elements
[INFO] Cluster 11: 659 elements
[INFO] Cluster 12: 634 elements
[INFO] Cluster 13: 10 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=104, Long SMA=110, Sharpe=-0.2329, Trades=65
[INFO] Cluster 1 cluster: Short SMA=236, Long SMA=272, Sharpe=0.1162, Trades=23
[INFO] Cluster 2 cluster: Short SMA=88, Long SMA=264, Sharpe=0.0091, Trades=13
[INFO] Cluster 3 cluster: Short SMA=88, Long SMA=140, Sharpe=-0.2838, Trades=25
[INFO] Cluster 4 cluster: Short SMA=32, Long SMA=112, Sharpe=0.4612, Trades=35
[INFO] Cluster 5 cluster: Short SMA=28, Long SMA=204, Sharpe=0.3088, Trades=21
[INFO] Cluster 6 cluster: Short SMA=178, Long SMA=196, Sharpe=0.2180, Trades=37
[INFO] Cluster 7 cluster: Short SMA=24, Long SMA=30, Sharpe=0.7979, Trades=117
[INFO] Cluster 8 cluster: Short SMA=30, Long SMA=56, Sharpe=0.6557, Trades=59
[INFO] Cluster 9 cluster: Short SMA=154, Long SMA=240, Sharpe=0.3866, Trades=13
[INFO] Cluster 10 cluster: Short SMA=98, Long SMA=194, Sharpe=0.0460, Trades=17
[INFO] Cluster 11 cluster: Short SMA=174, Long SMA=278, Sharpe=0.0921, Trades=14
[INFO] Cluster 12 cluster: Short SMA=32, Long SMA=274, Sharpe=0.4765, Trades=18
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=10, Long SMA=26, Sharpe=1.1160, Trades=106
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=24, Long SMA=30, Sharpe=0.7979, Trades=117
[INFO] Top 2: Short SMA=30, Long SMA=56, Sharpe=0.6557, Trades=59
[INFO] Top 3: Short SMA=32, Long SMA=274, Sharpe=0.4765, Trades=18
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 10575 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 10, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(24/30) - Original Sharpe: 0.7979, Trades: 117
[INFO] Hierarchical cluster 2: SMA(30/56) - Original Sharpe: 0.6557, Trades: 59
[INFO] Hierarchical cluster 3: SMA(32/274) - Original Sharpe: 0.4765, Trades: 18
[INFO] Hierarchical cluster 4: SMA(32/112) - Original Sharpe: 0.4612, Trades: 35
[INFO] Hierarchical cluster 5: SMA(154/240) - Original Sharpe: 0.3866, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (10/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/30) - Sharpe: 0.7979
[INFO] cluster 2: (30/56) - Sharpe: 0.6557
[INFO] cluster 3: (32/274) - Sharpe: 0.4765
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     4.800806            2.366526
1    2021-11-14 2021-11-14            44     2.049644           -2.380335
2    2022-01-14 2022-01-14            41     3.528418            3.131964
3    2022-03-14 2022-03-14            44     0.138982           -0.303407
4    2022-05-14 2022-05-14            43     1.388289           -1.312296
5    2022-07-14 2022-07-14            44    -3.155014            3.751949
6    2022-09-14 2022-09-14            43    -0.180219           -0.794556
7    2022-11-14 2022-11-14            43    -1.334805           -4.574308
8    2023-01-14 2023-01-14            41    -0.581478            0.437068
9    2023-03-14 2023-03-14            43    -0.524319           -0.187735
10   2023-05-14 2023-05-14            44    -1.200228           -2.516770
11   2023-07-14 2023-07-14            44     0.362193            6.601123
12   2023-09-14 2023-09-14            43    -2.369631           -1.195179
13   2023-11-14 2023-11-14            42     1.581330           -0.812879
14   2024-01-14 2024-01-14            43     1.622963            2.044810
15   2024-03-14 2024-03-14            42     4.138827            0.509805
16   2024-05-14 2024-05-14            44    -0.527309           -1.804989
17   2024-07-14 2024-07-14            45     1.437611            0.028730
18   2024-09-14 2024-09-14            43    -0.271801           -1.131098
19   2024-11-14 2024-11-14            33     1.096941           -3.302078
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          4.8 |              2.4 |         -2.4 | False         
[INFO] 2021-11-14   |          2.0 |             -2.4 |         -4.4 | False         
[INFO] 2022-01-14   |          3.5 |              3.1 |         -0.4 | False         
[INFO] 2022-03-14   |          0.1 |             -0.3 |         -0.4 | False         
[INFO] 2022-05-14   |          1.4 |             -1.3 |         -2.7 | False         
[INFO] 2022-07-14   |         -3.2 |              3.8 |          7.0 | True          
[INFO] 2022-09-14   |         -0.2 |             -0.8 |         -0.6 | False         
[INFO] 2022-11-14   |         -1.3 |             -4.6 |         -3.3 | False         
[INFO] 2023-01-14   |         -0.6 |              0.4 |          1.0 | True          
[INFO] 2023-03-14   |         -0.5 |             -0.2 |          0.3 | True          
[INFO] 2023-05-14   |         -1.2 |             -2.5 |         -1.3 | False         
[INFO] 2023-07-14   |          0.4 |              6.6 |          6.2 | True          
[INFO] 2023-09-14   |         -2.4 |             -1.2 |          1.2 | True          
[INFO] 2023-11-14   |          1.6 |             -0.8 |         -2.4 | False         
[INFO] 2024-01-14   |          1.6 |              2.0 |          0.4 | True          
[INFO] 2024-03-14   |          4.1 |              0.5 |         -3.6 | False         
[INFO] 2024-05-14   |         -0.5 |             -1.8 |         -1.3 | False         
[INFO] 2024-07-14   |          1.4 |              0.0 |         -1.4 | False         
[INFO] 2024-09-14   |         -0.3 |             -1.1 |         -0.8 | False         
[INFO] 2024-11-14   |          1.1 |             -3.3 |         -4.4 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 20 periods (30.00% win rate)
[INFO] Updating Excel file with Hierarchical results for BRN...
[INFO] Excel file updated successfully. Added BRN with Hierarchical win rate 30.0% in row 6
[INFO] Added best Sharpe parameters 10/26 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 10, Long SMA: 26
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/30) - Original Sharpe: 0.7979
[INFO] Added cluster 2 to portfolio: SMA(30/56) - Original Sharpe: 0.6557
[INFO] Added cluster 3 to portfolio: SMA(32/274) - Original Sharpe: 0.4765
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BRN_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0533
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6187
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for BRN...
[INFO] Excel file updated successfully. Added BRN with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BRN
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for C in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 274.79s
[INFO] Best parameters: Short SMA = 118, Long SMA = 134
[INFO] Best Sharpe ratio: 0.630269, Trades: 52
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_C_best_118/134 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CC
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 10.33 contracts
[INFO] Maximum Position Size: 18 contracts
[INFO] Strategy Total P&L: $777,426.00
[INFO] Market Buy & Hold P&L: $114,720.00
[INFO] Outperformance: $662,706.00
[INFO] Sharpe ratio (entire period, annualized): 0.965941
[INFO] Sharpe ratio (in-sample, annualized): 0.630269
[INFO] Sharpe ratio (out-of-sample, annualized): 1.618642
[INFO] Maximum Drawdown: $143,374.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 39
[INFO] Out-of-sample period trades: 13
[INFO] Total trades: 52
[INFO] In-sample P&L: $325,636.00
[INFO] Out-of-sample P&L: $439,720.00
[INFO] 
Best parameters from GA: Short SMA = 118, Long SMA = 134, Sharpe = 0.630269
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.7127 to 0.6303
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.630269
[INFO] Number of Trades: 52
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.7127 to 0.6303
[INFO] Trades range: 12.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.9917 to 2.9163
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 844 elements
[INFO] Kmeans Cluster 1: 502 elements
[INFO] Kmeans Cluster 2: 401 elements
[INFO] Kmeans Cluster 3: 973 elements
[INFO] Kmeans Cluster 4: 428 elements
[INFO] Kmeans Cluster 5: 795 elements
[INFO] Kmeans Cluster 6: 258 elements
[INFO] Kmeans Cluster 7: 517 elements
[INFO] Kmeans Cluster 8: 812 elements
[INFO] Kmeans Cluster 9: 781 elements
[INFO] Kmeans Cluster 10: 649 elements
[INFO] Kmeans Cluster 11: 601 elements
[INFO] Kmeans Cluster 12: 889 elements
[INFO] Kmeans Cluster 13: 864 elements
[INFO] Kmeans Cluster 14: 631 elements
[INFO] Kmeans Cluster 15: 640 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=78.35, Long SMA=188.88, Sharpe=-0.1396
[INFO] Centroid 1: Short SMA=63.08, Long SMA=95.90, Sharpe=-0.2092
[INFO] Centroid 2: Short SMA=27.74, Long SMA=93.39, Sharpe=-0.7757
[INFO] Centroid 3: Short SMA=240.05, Long SMA=274.22, Sharpe=0.0213
[INFO] Centroid 4: Short SMA=26.26, Long SMA=275.54, Sharpe=-0.5900
[INFO] Centroid 5: Short SMA=39.36, Long SMA=157.92, Sharpe=-0.3975
[INFO] Centroid 6: Short SMA=18.95, Long SMA=57.57, Sharpe=-1.2889
[INFO] Centroid 7: Short SMA=108.20, Long SMA=144.71, Sharpe=0.1642
[INFO] Centroid 8: Short SMA=186.96, Long SMA=224.45, Sharpe=-0.0733
[INFO] Centroid 9: Short SMA=79.69, Long SMA=276.24, Sharpe=-0.2919
[INFO] Centroid 10: Short SMA=171.12, Long SMA=284.88, Sharpe=-0.0984
[INFO] Centroid 11: Short SMA=27.68, Long SMA=220.22, Sharpe=-0.4458
[INFO] Centroid 12: Short SMA=92.16, Long SMA=243.53, Sharpe=-0.0748
[INFO] Centroid 13: Short SMA=140.60, Long SMA=184.47, Sharpe=-0.2636
[INFO] Centroid 14: Short SMA=56.61, Long SMA=98.97, Sharpe=-0.4850
[INFO] Centroid 15: Short SMA=148.68, Long SMA=251.15, Sharpe=0.1152
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6303, Trades=52
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=148, Long SMA=252, Sharpe=0.2447, Trades=12
[INFO] Kmeans Top 2: Short SMA=110, Long SMA=144, Sharpe=0.1770, Trades=30
[INFO] Kmeans Top 3: Short SMA=188, Long SMA=224, Sharpe=0.1098, Trades=20
[INFO] Kmeans Top 4: Short SMA=90, Long SMA=242, Sharpe=-0.0238, Trades=12
[INFO] Kmeans Top 5: Short SMA=240, Long SMA=274, Sharpe=-0.0311, Trades=19
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (78, 189)
[INFO]   Nearest: (78.0, 188.0)
[INFO]   Rounded: (63, 96)
[INFO]   Nearest: (64.0, 96.0)
[INFO]   Rounded: (28, 93)
[INFO]   Nearest: (28.0, 94.0)
[INFO]   Rounded: (240, 274)
[INFO]   Rounded: (26, 276)
[INFO]   Rounded: (39, 158)
[INFO]   Nearest: (40.0, 158.0)
[INFO]   Rounded: (19, 58)
[INFO]   Nearest: (18.0, 58.0)
[INFO]   Rounded: (108, 145)
[INFO]   Nearest: (108.0, 144.0)
[INFO]   Rounded: (187, 224)
[INFO]   Nearest: (186.0, 224.0)
[INFO]   Rounded: (80, 276)
[INFO]   Rounded: (171, 285)
[INFO]   Nearest: (172.0, 284.0)
[INFO]   Rounded: (28, 220)
[INFO]   Rounded: (92, 244)
[INFO]   Rounded: (141, 184)
[INFO]   Nearest: (140.0, 184.0)
[INFO]   Rounded: (57, 99)
[INFO]   Nearest: (56.0, 98.0)
[INFO]   Rounded: (149, 251)
[INFO]   Nearest: (148.0, 252.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(148/252) - Original Sharpe: 0.2447, Trades: 12
[INFO] Kmeans cluster 2: SMA(110/144) - Original Sharpe: 0.1770, Trades: 30
[INFO] Kmeans cluster 3: SMA(188/224) - Original Sharpe: 0.1098, Trades: 20
[INFO] Kmeans cluster 4: SMA(90/242) - Original Sharpe: -0.0238, Trades: 12
[INFO] Kmeans cluster 5: SMA(240/274) - Original Sharpe: -0.0311, Trades: 19
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (148/252) - Sharpe: 0.2447
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.387066            3.629474
1    2021-11-10 2021-11-10            41    -1.369000           -0.327685
2    2022-01-10 2022-01-10            41     1.348855           -0.384580
3    2022-03-10 2022-03-10            42     3.066197           -0.725249
4    2022-05-10 2022-05-10            41     0.256065            1.952060
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.313270           -1.707478
8    2023-01-10 2023-01-10            41     0.018666           -0.018666
9    2023-03-10 2023-03-10            42     3.526516            0.435712
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.369719           -0.538285
19   2024-11-10 2024-11-10            35     2.120478            4.371729
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.4 |              3.6 |          3.2 | True          
[INFO] 2021-11-10   |         -1.4 |             -0.3 |          1.1 | True          
[INFO] 2022-01-10   |          1.3 |             -0.4 |         -1.7 | False         
[INFO] 2022-03-10   |          3.1 |             -0.7 |         -3.8 | False         
[INFO] 2022-05-10   |          0.3 |              2.0 |          1.7 | True          
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |             -1.7 |         -2.0 | False         
[INFO] 2023-01-10   |          0.0 |             -0.0 |         -0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              0.4 |         -3.1 | False         
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |             -0.5 |          0.9 | True          
[INFO] 2024-11-10   |          2.1 |              4.4 |          2.3 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-10, 2022-09-10, 2023-01-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 5 of 9 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for C...
[INFO] Excel file updated successfully. Added C with Kmeans win rate 55.6% in row 7
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(148/252) - Original Sharpe: 0.2447
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'C_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 1.6563
[INFO] Kmeans Best out-of-sample Sharpe: 1.6186
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for C...
[INFO] Excel file updated successfully. Added C with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\C
[INFO] Big Point Value: 10.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.7127 to 0.6303
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.630269
[INFO] Number of Trades: 52
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.7127 to 0.6303
[INFO] Trades range: 12.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.9917 to 2.9163
[INFO] Scaled Trades range: -0.6807 to 13.5867
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5249
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 575 elements
[INFO] Cluster 1: 1128 elements
[INFO] Cluster 2: 985 elements
[INFO] Cluster 3: 1351 elements
[INFO] Cluster 4: 1237 elements
[INFO] Cluster 5: 883 elements
[INFO] Cluster 6: 100 elements
[INFO] Cluster 7: 255 elements
[INFO] Cluster 8: 1272 elements
[INFO] Cluster 9: 181 elements
[INFO] Cluster 10: 373 elements
[INFO] Cluster 11: 433 elements
[INFO] Cluster 12: 576 elements
[INFO] Cluster 13: 802 elements
[INFO] Cluster 14: 131 elements
[INFO] Cluster 15: 303 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=66, Long SMA=86, Sharpe=-0.6347, Trades=54
[INFO] Cluster 1 cluster: Short SMA=78, Long SMA=210, Sharpe=-0.1367, Trades=14
[INFO] Cluster 2 cluster: Short SMA=36, Long SMA=256, Sharpe=-0.4848, Trades=20
[INFO] Cluster 3 cluster: Short SMA=160, Long SMA=266, Sharpe=0.0765, Trades=13
[INFO] Cluster 4 cluster: Short SMA=228, Long SMA=264, Sharpe=-0.0018, Trades=19
[INFO] Cluster 5 cluster: Short SMA=34, Long SMA=182, Sharpe=-0.3949, Trades=24
[INFO] Cluster 6 cluster: Short SMA=52, Long SMA=54, Sharpe=-0.2684, Trades=153
[INFO] Cluster 7 cluster: Short SMA=18, Long SMA=54, Sharpe=-1.4770, Trades=76
[INFO] Cluster 8 cluster: Short SMA=130, Long SMA=210, Sharpe=-0.2930, Trades=14
[INFO] Cluster 9 cluster: Short SMA=148, Long SMA=152, Sharpe=-0.4494, Trades=70
[INFO] Cluster 10 cluster: Short SMA=24, Long SMA=100, Sharpe=-0.8285, Trades=40
[INFO] Cluster 11 cluster: Short SMA=106, Long SMA=150, Sharpe=0.4000, Trades=24
[INFO] Cluster 12 cluster: Short SMA=90, Long SMA=284, Sharpe=-0.2294, Trades=13
[INFO] Cluster 13 cluster: Short SMA=54, Long SMA=126, Sharpe=-0.5763, Trades=26
[INFO] Cluster 14 cluster: Short SMA=250, Long SMA=254, Sharpe=0.0028, Trades=54
[INFO] Cluster 15 cluster: Short SMA=168, Long SMA=186, Sharpe=-0.2956, Trades=35
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6303, Trades=52
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=106, Long SMA=150, Sharpe=0.4000, Trades=24
[INFO] Top 2: Short SMA=160, Long SMA=266, Sharpe=0.0765, Trades=13
[INFO] Top 3: Short SMA=250, Long SMA=254, Sharpe=0.0028, Trades=54
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(106/150) - Original Sharpe: 0.4000, Trades: 24
[INFO] Hierarchical cluster 2: SMA(160/266) - Original Sharpe: 0.0765, Trades: 13
[INFO] Hierarchical cluster 3: SMA(250/254) - Original Sharpe: 0.0028, Trades: 54
[INFO] Hierarchical cluster 4: SMA(228/264) - Original Sharpe: -0.0018, Trades: 19
[INFO] Hierarchical cluster 5: SMA(78/210) - Original Sharpe: -0.1367, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (106/150) - Sharpe: 0.4000
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.387066            2.091215
1    2021-11-10 2021-11-10            41    -1.369000           -1.292429
2    2022-01-10 2022-01-10            41     1.348855            2.060581
3    2022-03-10 2022-03-10            42     3.066197            3.066197
4    2022-05-10 2022-05-10            41     0.256065           -0.748708
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.313270            0.013980
8    2023-01-10 2023-01-10            41     0.018666            0.018666
9    2023-03-10 2023-03-10            42     3.526516            3.526516
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.369719           -0.538285
19   2024-11-10 2024-11-10            35     2.120478            4.371729
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.4 |              2.1 |          1.7 | True          
[INFO] 2021-11-10   |         -1.4 |             -1.3 |          0.1 | True          
[INFO] 2022-01-10   |          1.3 |              2.1 |          0.8 | True          
[INFO] 2022-03-10   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2022-05-10   |          0.3 |             -0.7 |         -1.0 | False         
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |              0.0 |         -0.3 | False         
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |             -0.5 |          0.9 | True          
[INFO] 2024-11-10   |          2.1 |              4.4 |          2.3 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-10, 2022-07-10, 2022-09-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 7
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 7 periods (71.43% win rate)
[INFO] Updating Excel file with Hierarchical results for C...
[INFO] Excel file updated successfully. Added C with Hierarchical win rate 71.4% in row 7
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(106/150) - Original Sharpe: 0.4000
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'C_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 1.8822
[INFO] Hierarchical Best out-of-sample Sharpe: 1.6186
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for C...
[INFO] Excel file updated successfully. Added C with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\C
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CC in column D: 40.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 246.21s
[INFO] Best parameters: Short SMA = 118, Long SMA = 134
[INFO] Best Sharpe ratio: 0.608029, Trades: 52
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_CC_best_118/134 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CC
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 10.33 contracts
[INFO] Maximum Position Size: 18 contracts
[INFO] Strategy Total P&L: $762,710.00
[INFO] Market Buy & Hold P&L: $114,720.00
[INFO] Outperformance: $647,990.00
[INFO] Sharpe ratio (entire period, annualized): 0.947776
[INFO] Sharpe ratio (in-sample, annualized): 0.608029
[INFO] Sharpe ratio (out-of-sample, annualized): 1.607980
[INFO] Maximum Drawdown: $144,700.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 39
[INFO] Out-of-sample period trades: 13
[INFO] Total trades: 52
[INFO] In-sample P&L: $314,170.00
[INFO] Out-of-sample P&L: $436,860.00
[INFO] 
Best parameters from GA: Short SMA = 118, Long SMA = 134, Sharpe = 0.608029
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10.0
[INFO] Slippage: 40.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.7425 to 0.6080
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.608029
[INFO] Number of Trades: 52
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.7425 to 0.6080
[INFO] Trades range: 12.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.9880 to 2.8413
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 843 elements
[INFO] Kmeans Cluster 1: 650 elements
[INFO] Kmeans Cluster 2: 624 elements
[INFO] Kmeans Cluster 3: 259 elements
[INFO] Kmeans Cluster 4: 516 elements
[INFO] Kmeans Cluster 5: 425 elements
[INFO] Kmeans Cluster 6: 867 elements
[INFO] Kmeans Cluster 7: 912 elements
[INFO] Kmeans Cluster 8: 396 elements
[INFO] Kmeans Cluster 9: 599 elements
[INFO] Kmeans Cluster 10: 968 elements
[INFO] Kmeans Cluster 11: 647 elements
[INFO] Kmeans Cluster 12: 805 elements
[INFO] Kmeans Cluster 13: 797 elements
[INFO] Kmeans Cluster 14: 511 elements
[INFO] Kmeans Cluster 15: 766 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=78.09, Long SMA=189.10, Sharpe=-0.1478
[INFO] Centroid 1: Short SMA=171.12, Long SMA=284.88, Sharpe=-0.1034
[INFO] Centroid 2: Short SMA=55.93, Long SMA=97.70, Sharpe=-0.5067
[INFO] Centroid 3: Short SMA=18.92, Long SMA=57.47, Sharpe=-1.3205
[INFO] Centroid 4: Short SMA=108.19, Long SMA=144.95, Sharpe=0.1491
[INFO] Centroid 5: Short SMA=26.01, Long SMA=275.42, Sharpe=-0.6012
[INFO] Centroid 6: Short SMA=140.86, Long SMA=184.28, Sharpe=-0.2737
[INFO] Centroid 7: Short SMA=92.62, Long SMA=243.70, Sharpe=-0.0848
[INFO] Centroid 8: Short SMA=27.49, Long SMA=92.92, Sharpe=-0.8004
[INFO] Centroid 9: Short SMA=27.61, Long SMA=220.20, Sharpe=-0.4570
[INFO] Centroid 10: Short SMA=240.16, Long SMA=274.45, Sharpe=0.0124
[INFO] Centroid 11: Short SMA=148.60, Long SMA=250.86, Sharpe=0.1087
[INFO] Centroid 12: Short SMA=187.71, Long SMA=224.75, Sharpe=-0.0828
[INFO] Centroid 13: Short SMA=39.38, Long SMA=157.65, Sharpe=-0.4102
[INFO] Centroid 14: Short SMA=63.98, Long SMA=97.76, Sharpe=-0.2331
[INFO] Centroid 15: Short SMA=78.80, Long SMA=276.98, Sharpe=-0.3005
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6080, Trades=52
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=148, Long SMA=250, Sharpe=0.2347, Trades=12
[INFO] Kmeans Top 2: Short SMA=110, Long SMA=144, Sharpe=0.1652, Trades=30
[INFO] Kmeans Top 3: Short SMA=188, Long SMA=224, Sharpe=0.1021, Trades=20
[INFO] Kmeans Top 4: Short SMA=240, Long SMA=274, Sharpe=-0.0378, Trades=19
[INFO] Kmeans Top 5: Short SMA=92, Long SMA=242, Sharpe=-0.0537, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (78, 189)
[INFO]   Nearest: (78.0, 190.0)
[INFO]   Rounded: (171, 285)
[INFO]   Nearest: (172.0, 284.0)
[INFO]   Rounded: (56, 98)
[INFO]   Rounded: (19, 57)
[INFO]   Nearest: (18.0, 58.0)
[INFO]   Rounded: (108, 145)
[INFO]   Nearest: (108.0, 144.0)
[INFO]   Rounded: (26, 275)
[INFO]   Nearest: (26.0, 276.0)
[INFO]   Rounded: (141, 184)
[INFO]   Nearest: (140.0, 184.0)
[INFO]   Rounded: (93, 244)
[INFO]   Nearest: (92.0, 244.0)
[INFO]   Rounded: (27, 93)
[INFO]   Nearest: (28.0, 92.0)
[INFO]   Rounded: (28, 220)
[INFO]   Rounded: (240, 274)
[INFO]   Rounded: (149, 251)
[INFO]   Nearest: (148.0, 250.0)
[INFO]   Rounded: (188, 225)
[INFO]   Nearest: (188.0, 224.0)
[INFO]   Rounded: (39, 158)
[INFO]   Nearest: (40.0, 158.0)
[INFO]   Rounded: (64, 98)
[INFO]   Rounded: (79, 277)
[INFO]   Nearest: (78.0, 276.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(148/250) - Original Sharpe: 0.2347, Trades: 12
[INFO] Kmeans cluster 2: SMA(110/144) - Original Sharpe: 0.1652, Trades: 30
[INFO] Kmeans cluster 3: SMA(188/224) - Original Sharpe: 0.1021, Trades: 20
[INFO] Kmeans cluster 4: SMA(240/274) - Original Sharpe: -0.0378, Trades: 19
[INFO] Kmeans cluster 5: SMA(92/242) - Original Sharpe: -0.0537, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (148/250) - Sharpe: 0.2347
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.295900            3.122022
1    2021-11-10 2021-11-10            41    -1.394418           -0.327685
2    2022-01-10 2022-01-10            41     1.323900           -0.821143
3    2022-03-10 2022-03-10            42     3.066197           -0.751124
4    2022-05-10 2022-05-10            41     0.194831            1.952060
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.282908           -1.707478
8    2023-01-10 2023-01-10            41     0.018666           -0.018666
9    2023-03-10 2023-03-10            42     3.526516            0.409294
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.376819           -0.538285
19   2024-11-10 2024-11-10            35     2.115676            4.371729
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.3 |              3.1 |          2.8 | True          
[INFO] 2021-11-10   |         -1.4 |             -0.3 |          1.1 | True          
[INFO] 2022-01-10   |          1.3 |             -0.8 |         -2.1 | False         
[INFO] 2022-03-10   |          3.1 |             -0.8 |         -3.9 | False         
[INFO] 2022-05-10   |          0.2 |              2.0 |          1.8 | True          
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |             -1.7 |         -2.0 | False         
[INFO] 2023-01-10   |          0.0 |             -0.0 |         -0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              0.4 |         -3.1 | False         
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |             -0.5 |          0.9 | True          
[INFO] 2024-11-10   |          2.1 |              4.4 |          2.3 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-10, 2022-09-10, 2023-01-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 5 of 9 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for CC...
[INFO] Excel file updated successfully. Added CC with Kmeans win rate 55.6% in row 8
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(148/250) - Original Sharpe: 0.2347
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 1.6137
[INFO] Kmeans Best out-of-sample Sharpe: 1.6080
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for CC...
[INFO] Excel file updated successfully. Added CC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CC
[INFO] Big Point Value: 10.0
[INFO] Slippage: 40.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.7425 to 0.6080
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.608029
[INFO] Number of Trades: 52
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.7425 to 0.6080
[INFO] Trades range: 12.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.9880 to 2.8413
[INFO] Scaled Trades range: -0.6807 to 13.5867
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5223
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1569 elements
[INFO] Cluster 1: 1218 elements
[INFO] Cluster 2: 100 elements
[INFO] Cluster 3: 1222 elements
[INFO] Cluster 4: 1192 elements
[INFO] Cluster 5: 1155 elements
[INFO] Cluster 6: 798 elements
[INFO] Cluster 7: 272 elements
[INFO] Cluster 8: 808 elements
[INFO] Cluster 9: 245 elements
[INFO] Cluster 10: 361 elements
[INFO] Cluster 11: 691 elements
[INFO] Cluster 12: 466 elements
[INFO] Cluster 13: 233 elements
[INFO] Cluster 14: 255 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=136, Long SMA=202, Sharpe=-0.3100, Trades=16
[INFO] Cluster 1 cluster: Short SMA=168, Long SMA=264, Sharpe=-0.0248, Trades=13
[INFO] Cluster 2 cluster: Short SMA=52, Long SMA=54, Sharpe=-0.3314, Trades=153
[INFO] Cluster 3 cluster: Short SMA=62, Long SMA=236, Sharpe=-0.2179, Trades=18
[INFO] Cluster 4 cluster: Short SMA=52, Long SMA=114, Sharpe=-0.5187, Trades=30
[INFO] Cluster 5 cluster: Short SMA=228, Long SMA=264, Sharpe=-0.0085, Trades=19
[INFO] Cluster 6 cluster: Short SMA=102, Long SMA=284, Sharpe=-0.3421, Trades=15
[INFO] Cluster 7 cluster: Short SMA=204, Long SMA=208, Sharpe=-0.0648, Trades=64
[INFO] Cluster 8 cluster: Short SMA=32, Long SMA=184, Sharpe=-0.4175, Trades=24
[INFO] Cluster 9 cluster: Short SMA=70, Long SMA=80, Sharpe=-0.4392, Trades=70
[INFO] Cluster 10 cluster: Short SMA=20, Long SMA=106, Sharpe=-0.8254, Trades=44
[INFO] Cluster 11 cluster: Short SMA=90, Long SMA=168, Sharpe=-0.1294, Trades=18
[INFO] Cluster 12 cluster: Short SMA=26, Long SMA=270, Sharpe=-0.5511, Trades=21
[INFO] Cluster 13 cluster: Short SMA=118, Long SMA=138, Sharpe=0.4583, Trades=42
[INFO] Cluster 14 cluster: Short SMA=18, Long SMA=54, Sharpe=-1.5093, Trades=76
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6080, Trades=52
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=118, Long SMA=138, Sharpe=0.4583, Trades=42
[INFO] Top 2: Short SMA=228, Long SMA=264, Sharpe=-0.0085, Trades=19
[INFO] Top 3: Short SMA=168, Long SMA=264, Sharpe=-0.0248, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(118/138) - Original Sharpe: 0.4583, Trades: 42
[INFO] Hierarchical cluster 2: SMA(228/264) - Original Sharpe: -0.0085, Trades: 19
[INFO] Hierarchical cluster 3: SMA(168/264) - Original Sharpe: -0.0248, Trades: 13
[INFO] Hierarchical cluster 4: SMA(204/208) - Original Sharpe: -0.0648, Trades: 64
[INFO] Hierarchical cluster 5: SMA(90/168) - Original Sharpe: -0.1294, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (118/138) - Sharpe: 0.4583
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.295900            0.073511
1    2021-11-10 2021-11-10            41    -1.394418            2.331710
2    2022-01-10 2022-01-10            41     1.323900            3.615792
3    2022-03-10 2022-03-10            42     3.066197            3.066197
4    2022-05-10 2022-05-10            41     0.194831            0.965634
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.282908            0.282908
8    2023-01-10 2023-01-10            41     0.018666            0.018666
9    2023-03-10 2023-03-10            42     3.526516            3.526516
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.376819           -1.085191
19   2024-11-10 2024-11-10            35     2.115676            4.371729
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.3 |              0.1 |         -0.2 | False         
[INFO] 2021-11-10   |         -1.4 |              2.3 |          3.7 | True          
[INFO] 2022-01-10   |          1.3 |              3.6 |          2.3 | True          
[INFO] 2022-03-10   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2022-05-10   |          0.2 |              1.0 |          0.8 | True          
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |             -1.1 |          0.3 | True          
[INFO] 2024-11-10   |          2.1 |              4.4 |          2.3 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-10, 2022-07-10, 2022-09-10, 2022-11-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 6
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 6 periods (83.33% win rate)
[INFO] Updating Excel file with Hierarchical results for CC...
[INFO] Excel file updated successfully. Added CC with Hierarchical win rate 83.3% in row 8
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(118/138) - Original Sharpe: 0.4583
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 2.0587
[INFO] Hierarchical Best out-of-sample Sharpe: 1.6080
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for CC...
[INFO] Excel file updated successfully. Added CC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CC
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CD in column D: 7.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 253.92s
[INFO] Best parameters: Short SMA = 38, Long SMA = 44
[INFO] Best Sharpe ratio: 0.791094, Trades: 100
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_CD_best_38/44 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CD
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 12.56 contracts
[INFO] Maximum Position Size: 24 contracts
[INFO] Strategy Total P&L: $198,897.00
[INFO] Market Buy & Hold P&L: $-25,775.00
[INFO] Outperformance: $224,672.00
[INFO] Sharpe ratio (entire period, annualized): 0.265370
[INFO] Sharpe ratio (in-sample, annualized): 0.791094
[INFO] Sharpe ratio (out-of-sample, annualized): -0.999272
[INFO] Maximum Drawdown: $290,984.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 67
[INFO] Out-of-sample period trades: 33
[INFO] Total trades: 100
[INFO] In-sample P&L: $408,450.00
[INFO] Out-of-sample P&L: $-214,288.00
[INFO] 
Best parameters from GA: Short SMA = 38, Long SMA = 44, Sharpe = 0.791094
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 7.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7997 to 0.7911
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 44
[INFO] Sharpe Ratio: 0.791094
[INFO] Number of Trades: 100
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7997 to 0.7911
[INFO] Trades range: 10.0 to 354.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6320 to 3.9805
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 569 elements
[INFO] Kmeans Cluster 1: 1027 elements
[INFO] Kmeans Cluster 2: 343 elements
[INFO] Kmeans Cluster 3: 752 elements
[INFO] Kmeans Cluster 4: 242 elements
[INFO] Kmeans Cluster 5: 598 elements
[INFO] Kmeans Cluster 6: 635 elements
[INFO] Kmeans Cluster 7: 909 elements
[INFO] Kmeans Cluster 8: 690 elements
[INFO] Kmeans Cluster 9: 515 elements
[INFO] Kmeans Cluster 10: 761 elements
[INFO] Kmeans Cluster 11: 650 elements
[INFO] Kmeans Cluster 12: 599 elements
[INFO] Kmeans Cluster 13: 700 elements
[INFO] Kmeans Cluster 14: 551 elements
[INFO] Kmeans Cluster 15: 676 elements
[INFO] Kmeans Cluster 16: 368 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=167.69, Long SMA=229.53, Sharpe=-0.2115
[INFO] Centroid 1: Short SMA=60.14, Long SMA=275.39, Sharpe=-0.0014
[INFO] Centroid 2: Short SMA=23.21, Long SMA=51.05, Sharpe=0.4438
[INFO] Centroid 3: Short SMA=74.06, Long SMA=125.92, Sharpe=-0.1647
[INFO] Centroid 4: Short SMA=253.68, Long SMA=283.58, Sharpe=0.2113
[INFO] Centroid 5: Short SMA=31.39, Long SMA=163.92, Sharpe=0.1775
[INFO] Centroid 6: Short SMA=27.71, Long SMA=237.93, Sharpe=0.0986
[INFO] Centroid 7: Short SMA=135.58, Long SMA=272.55, Sharpe=-0.0717
[INFO] Centroid 8: Short SMA=112.53, Long SMA=222.36, Sharpe=-0.0510
[INFO] Centroid 9: Short SMA=77.90, Long SMA=112.99, Sharpe=-0.4079
[INFO] Centroid 10: Short SMA=58.69, Long SMA=204.28, Sharpe=-0.0841
[INFO] Centroid 11: Short SMA=110.60, Long SMA=167.83, Sharpe=0.0366
[INFO] Centroid 12: Short SMA=195.79, Long SMA=280.66, Sharpe=-0.2860
[INFO] Centroid 13: Short SMA=34.11, Long SMA=93.06, Sharpe=0.0775
[INFO] Centroid 14: Short SMA=207.21, Long SMA=237.18, Sharpe=-0.4073
[INFO] Centroid 15: Short SMA=145.68, Long SMA=185.07, Sharpe=0.2178
[INFO] Centroid 16: Short SMA=250.61, Long SMA=280.42, Sharpe=-0.0304
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=44, Sharpe=0.7911, Trades=100
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=24, Long SMA=52, Sharpe=0.4683, Trades=60
[INFO] Kmeans Top 2: Short SMA=30, Long SMA=164, Sharpe=0.2990, Trades=32
[INFO] Kmeans Top 3: Short SMA=252, Long SMA=284, Sharpe=0.2814, Trades=22
[INFO] Kmeans Top 4: Short SMA=148, Long SMA=186, Sharpe=0.2194, Trades=20
[INFO] Kmeans Top 5: Short SMA=32, Long SMA=94, Sharpe=0.1320, Trades=42
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (168, 230)
[INFO]   Rounded: (60, 275)
[INFO]   Nearest: (60.0, 276.0)
[INFO]   Rounded: (23, 51)
[INFO]   Nearest: (24.0, 52.0)
[INFO]   Rounded: (74, 126)
[INFO]   Rounded: (254, 284)
[INFO]   Rounded: (31, 164)
[INFO]   Nearest: (32.0, 164.0)
[INFO]   Rounded: (28, 238)
[INFO]   Rounded: (136, 273)
[INFO]   Nearest: (136.0, 272.0)
[INFO]   Rounded: (113, 222)
[INFO]   Nearest: (112.0, 222.0)
[INFO]   Rounded: (78, 113)
[INFO]   Nearest: (78.0, 112.0)
[INFO]   Rounded: (59, 204)
[INFO]   Nearest: (58.0, 204.0)
[INFO]   Rounded: (111, 168)
[INFO]   Nearest: (110.0, 168.0)
[INFO]   Rounded: (196, 281)
[INFO]   Nearest: (196.0, 280.0)
[INFO]   Rounded: (34, 93)
[INFO]   Nearest: (34.0, 94.0)
[INFO]   Rounded: (207, 237)
[INFO]   Nearest: (208.0, 238.0)
[INFO]   Rounded: (146, 185)
[INFO]   Nearest: (146.0, 186.0)
[INFO]   Rounded: (251, 280)
[INFO]   Nearest: (250.0, 280.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 44
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(24/52) - Original Sharpe: 0.4683, Trades: 60
[INFO] Kmeans cluster 2: SMA(30/164) - Original Sharpe: 0.2990, Trades: 32
[INFO] Kmeans cluster 3: SMA(252/284) - Original Sharpe: 0.2814, Trades: 22
[INFO] Kmeans cluster 4: SMA(148/186) - Original Sharpe: 0.2194, Trades: 20
[INFO] Kmeans cluster 5: SMA(32/94) - Original Sharpe: 0.1320, Trades: 42
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/44)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/52) - Sharpe: 0.4683
[INFO] cluster 2: (30/164) - Sharpe: 0.2990
[INFO] cluster 3: (252/284) - Sharpe: 0.2814
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -4.559447           -2.571999
1    2021-11-14 2021-11-14            43    -2.832319           -3.646357
2    2022-01-14 2022-01-14            41    -0.950707           -1.705115
3    2022-03-14 2022-03-14            44    -3.892117           -2.204385
4    2022-05-14 2022-05-14            43     0.644192            0.656289
5    2022-07-14 2022-07-14            44    -4.160323            0.096062
6    2022-09-14 2022-09-14            43     1.032024            0.987674
7    2022-11-14 2022-11-14            43    -0.748377            0.509859
8    2023-01-14 2023-01-14            41    -4.124943            1.400904
9    2023-03-14 2023-03-14            44     0.052422           -2.729197
10   2023-05-14 2023-05-14            44    -2.505249           -0.761482
11   2023-07-14 2023-07-14            44    -2.114246           -2.098918
12   2023-09-14 2023-09-14            43     1.988935            1.250362
13   2023-11-14 2023-11-14            42    -3.835381           -5.525968
14   2024-01-14 2024-01-14            43    -1.838269            1.383215
15   2024-03-14 2024-03-14            42     1.898357            0.106820
16   2024-05-14 2024-05-14            44     1.248914            0.274846
17   2024-07-14 2024-07-14            45     0.220219           -0.948971
18   2024-09-14 2024-09-14            43     0.081170            0.825524
19   2024-11-14 2024-11-14            33     3.870625            3.959554
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -4.6 |             -2.6 |          2.0 | True          
[INFO] 2021-11-14   |         -2.8 |             -3.6 |         -0.8 | False         
[INFO] 2022-01-14   |         -1.0 |             -1.7 |         -0.7 | False         
[INFO] 2022-03-14   |         -3.9 |             -2.2 |          1.7 | True          
[INFO] 2022-05-14   |          0.6 |              0.7 |          0.1 | True          
[INFO] 2022-07-14   |         -4.2 |              0.1 |          4.3 | True          
[INFO] 2022-09-14   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.7 |              0.5 |          1.2 | True          
[INFO] 2023-01-14   |         -4.1 |              1.4 |          5.5 | True          
[INFO] 2023-03-14   |          0.1 |             -2.7 |         -2.8 | False         
[INFO] 2023-05-14   |         -2.5 |             -0.8 |          1.7 | True          
[INFO] 2023-07-14   |         -2.1 |             -2.1 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.0 |              1.3 |         -0.7 | False         
[INFO] 2023-11-14   |         -3.8 |             -5.5 |         -1.7 | False         
[INFO] 2024-01-14   |         -1.8 |              1.4 |          3.2 | True          
[INFO] 2024-03-14   |          1.9 |              0.1 |         -1.8 | False         
[INFO] 2024-05-14   |          1.2 |              0.3 |         -0.9 | False         
[INFO] 2024-07-14   |          0.2 |             -0.9 |         -1.1 | False         
[INFO] 2024-09-14   |          0.1 |              0.8 |          0.7 | True          
[INFO] 2024-11-14   |          3.9 |              4.0 |          0.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-09-14, 2023-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 10 of 18 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for CD...
[INFO] Excel file updated successfully. Added CD with Kmeans win rate 55.6% in row 9
[INFO] Added best Sharpe parameters 38/44 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 44
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/52) - Original Sharpe: 0.4683
[INFO] Added cluster 2 to portfolio: SMA(30/164) - Original Sharpe: 0.2990
[INFO] Added cluster 3 to portfolio: SMA(252/284) - Original Sharpe: 0.2814
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.2588
[INFO] Kmeans Best out-of-sample Sharpe: -0.9993
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for CD...
[INFO] Excel file updated successfully. Added CD with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CD
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 7.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7997 to 0.7911
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 44
[INFO] Sharpe Ratio: 0.791094
[INFO] Number of Trades: 100
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7997 to 0.7911
[INFO] Trades range: 10.0 to 354.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6320 to 3.9805
[INFO] Scaled Trades range: -0.8077 to 15.1655
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5960
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 175 elements
[INFO] Cluster 1: 1074 elements
[INFO] Cluster 2: 1634 elements
[INFO] Cluster 3: 327 elements
[INFO] Cluster 4: 1500 elements
[INFO] Cluster 5: 1164 elements
[INFO] Cluster 6: 648 elements
[INFO] Cluster 7: 1144 elements
[INFO] Cluster 8: 324 elements
[INFO] Cluster 9: 577 elements
[INFO] Cluster 10: 49 elements
[INFO] Cluster 11: 84 elements
[INFO] Cluster 12: 501 elements
[INFO] Cluster 13: 763 elements
[INFO] Cluster 14: 621 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=98, Long SMA=102, Sharpe=-0.1446, Trades=90
[INFO] Cluster 1 cluster: Short SMA=74, Long SMA=120, Sharpe=-0.3658, Trades=36
[INFO] Cluster 2 cluster: Short SMA=192, Long SMA=250, Sharpe=-0.3288, Trades=20
[INFO] Cluster 3 cluster: Short SMA=22, Long SMA=60, Sharpe=0.4993, Trades=56
[INFO] Cluster 4 cluster: Short SMA=80, Long SMA=194, Sharpe=0.0469, Trades=14
[INFO] Cluster 5 cluster: Short SMA=66, Long SMA=268, Sharpe=-0.1688, Trades=14
[INFO] Cluster 6 cluster: Short SMA=250, Long SMA=282, Sharpe=0.3350, Trades=22
[INFO] Cluster 7 cluster: Short SMA=134, Long SMA=266, Sharpe=-0.0651, Trades=10
[INFO] Cluster 8 cluster: Short SMA=132, Long SMA=156, Sharpe=-0.0129, Trades=42
[INFO] Cluster 9 cluster: Short SMA=32, Long SMA=94, Sharpe=0.1320, Trades=42
[INFO] Cluster 10 cluster: Short SMA=36, Long SMA=38, Sharpe=0.4816, Trades=180
[INFO] Cluster 11 cluster: Short SMA=76, Long SMA=82, Sharpe=-0.4844, Trades=78
[INFO] Cluster 12 cluster: Short SMA=28, Long SMA=162, Sharpe=0.1321, Trades=32
[INFO] Cluster 13 cluster: Short SMA=28, Long SMA=236, Sharpe=0.0965, Trades=24
[INFO] Cluster 14 cluster: Short SMA=142, Long SMA=188, Sharpe=0.1518, Trades=20
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=44, Sharpe=0.7911, Trades=100
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=22, Long SMA=60, Sharpe=0.4993, Trades=56
[INFO] Top 2: Short SMA=36, Long SMA=38, Sharpe=0.4816, Trades=180
[INFO] Top 3: Short SMA=250, Long SMA=282, Sharpe=0.3350, Trades=22
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 44
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(22/60) - Original Sharpe: 0.4993, Trades: 56
[INFO] Hierarchical cluster 2: SMA(36/38) - Original Sharpe: 0.4816, Trades: 180
[INFO] Hierarchical cluster 3: SMA(250/282) - Original Sharpe: 0.3350, Trades: 22
[INFO] Hierarchical cluster 4: SMA(142/188) - Original Sharpe: 0.1518, Trades: 20
[INFO] Hierarchical cluster 5: SMA(28/162) - Original Sharpe: 0.1321, Trades: 32
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/44)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (22/60) - Sharpe: 0.4993
[INFO] cluster 2: (36/38) - Sharpe: 0.4816
[INFO] cluster 3: (250/282) - Sharpe: 0.3350
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -4.559447           -3.435400
1    2021-11-14 2021-11-14            43    -2.832319           -3.676994
2    2022-01-14 2022-01-14            41    -0.950707           -2.235707
3    2022-03-14 2022-03-14            44    -3.892117           -3.537304
4    2022-05-14 2022-05-14            43     0.644192           -0.246906
5    2022-07-14 2022-07-14            44    -4.160323           -0.798423
6    2022-09-14 2022-09-14            43     1.032024            0.987674
7    2022-11-14 2022-11-14            43    -0.748377           -1.148468
8    2023-01-14 2023-01-14            41    -4.124943           -0.519436
9    2023-03-14 2023-03-14            44     0.052422           -2.661865
10   2023-05-14 2023-05-14            44    -2.505249            2.547046
11   2023-07-14 2023-07-14            44    -2.114246           -0.246350
12   2023-09-14 2023-09-14            43     1.988935            0.563636
13   2023-11-14 2023-11-14            42    -3.835381           -1.006677
14   2024-01-14 2024-01-14            43    -1.838269            0.517647
15   2024-03-14 2024-03-14            42     1.898357            1.286554
16   2024-05-14 2024-05-14            44     1.248914           -1.004047
17   2024-07-14 2024-07-14            45     0.220219           -2.768029
18   2024-09-14 2024-09-14            43     0.081170            0.028867
19   2024-11-14 2024-11-14            33     3.870625            4.196551
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -4.6 |             -3.4 |          1.2 | True          
[INFO] 2021-11-14   |         -2.8 |             -3.7 |         -0.9 | False         
[INFO] 2022-01-14   |         -1.0 |             -2.2 |         -1.2 | False         
[INFO] 2022-03-14   |         -3.9 |             -3.5 |          0.4 | True          
[INFO] 2022-05-14   |          0.6 |             -0.2 |         -0.8 | False         
[INFO] 2022-07-14   |         -4.2 |             -0.8 |          3.4 | True          
[INFO] 2022-09-14   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.7 |             -1.1 |         -0.4 | False         
[INFO] 2023-01-14   |         -4.1 |             -0.5 |          3.6 | True          
[INFO] 2023-03-14   |          0.1 |             -2.7 |         -2.8 | False         
[INFO] 2023-05-14   |         -2.5 |              2.5 |          5.0 | True          
[INFO] 2023-07-14   |         -2.1 |             -0.2 |          1.9 | True          
[INFO] 2023-09-14   |          2.0 |              0.6 |         -1.4 | False         
[INFO] 2023-11-14   |         -3.8 |             -1.0 |          2.8 | True          
[INFO] 2024-01-14   |         -1.8 |              0.5 |          2.3 | True          
[INFO] 2024-03-14   |          1.9 |              1.3 |         -0.6 | False         
[INFO] 2024-05-14   |          1.2 |             -1.0 |         -2.2 | False         
[INFO] 2024-07-14   |          0.2 |             -2.8 |         -3.0 | False         
[INFO] 2024-09-14   |          0.1 |              0.0 |         -0.1 | False         
[INFO] 2024-11-14   |          3.9 |              4.2 |          0.3 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 9 of 19 periods (47.37% win rate)
[INFO] Updating Excel file with Hierarchical results for CD...
[INFO] Excel file updated successfully. Added CD with Hierarchical win rate 47.4% in row 9
[INFO] Added best Sharpe parameters 38/44 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 44
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(22/60) - Original Sharpe: 0.4993
[INFO] Added cluster 2 to portfolio: SMA(36/38) - Original Sharpe: 0.4816
[INFO] Added cluster 3 to portfolio: SMA(250/282) - Original Sharpe: 0.3350
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CD_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.6300
[INFO] Hierarchical Best out-of-sample Sharpe: -0.9993
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for CD...
[INFO] Excel file updated successfully. Added CD with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CD
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CL in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 271.55s
[INFO] Best parameters: Short SMA = 48, Long SMA = 50
[INFO] Best Sharpe ratio: 0.878812, Trades: 162
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_CL_best_48/50 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CL
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.78 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $355,616.00
[INFO] Market Buy & Hold P&L: $-27,500.00
[INFO] Outperformance: $383,116.00
[INFO] Sharpe ratio (entire period, annualized): 0.399775
[INFO] Sharpe ratio (in-sample, annualized): 0.878812
[INFO] Sharpe ratio (out-of-sample, annualized): -0.653072
[INFO] Maximum Drawdown: $261,660.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 108
[INFO] Out-of-sample period trades: 54
[INFO] Total trades: 162
[INFO] In-sample P&L: $513,068.00
[INFO] Out-of-sample P&L: $-173,232.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.878812
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6266 to 0.8788
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.878812
[INFO] Number of Trades: 162
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6266 to 0.8788
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.0216 to 3.8079
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 334 elements
[INFO] Kmeans Cluster 1: 873 elements
[INFO] Kmeans Cluster 2: 1084 elements
[INFO] Kmeans Cluster 3: 397 elements
[INFO] Kmeans Cluster 4: 748 elements
[INFO] Kmeans Cluster 5: 1009 elements
[INFO] Kmeans Cluster 6: 796 elements
[INFO] Kmeans Cluster 7: 643 elements
[INFO] Kmeans Cluster 8: 744 elements
[INFO] Kmeans Cluster 9: 658 elements
[INFO] Kmeans Cluster 10: 434 elements
[INFO] Kmeans Cluster 11: 582 elements
[INFO] Kmeans Cluster 12: 683 elements
[INFO] Kmeans Cluster 13: 855 elements
[INFO] Kmeans Cluster 14: 745 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=95.83, Long SMA=129.59, Sharpe=-0.3328
[INFO] Centroid 1: Short SMA=37.37, Long SMA=213.77, Sharpe=0.2103
[INFO] Centroid 2: Short SMA=177.04, Long SMA=249.80, Sharpe=0.1623
[INFO] Centroid 3: Short SMA=28.60, Long SMA=56.86, Sharpe=0.4972
[INFO] Centroid 4: Short SMA=41.87, Long SMA=152.27, Sharpe=0.0969
[INFO] Centroid 5: Short SMA=40.44, Long SMA=95.11, Sharpe=0.2782
[INFO] Centroid 6: Short SMA=217.01, Long SMA=258.16, Sharpe=0.0154
[INFO] Centroid 7: Short SMA=130.78, Long SMA=281.77, Sharpe=-0.0205
[INFO] Centroid 8: Short SMA=121.20, Long SMA=182.75, Sharpe=0.1631
[INFO] Centroid 9: Short SMA=82.06, Long SMA=215.69, Sharpe=0.3299
[INFO] Centroid 10: Short SMA=253.96, Long SMA=288.16, Sharpe=-0.1930
[INFO] Centroid 11: Short SMA=164.20, Long SMA=196.90, Sharpe=0.3379
[INFO] Centroid 12: Short SMA=33.87, Long SMA=274.68, Sharpe=0.3504
[INFO] Centroid 13: Short SMA=95.37, Long SMA=261.21, Sharpe=0.1491
[INFO] Centroid 14: Short SMA=94.51, Long SMA=149.21, Sharpe=-0.0875
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8788, Trades=162
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=30, Long SMA=56, Sharpe=0.5547, Trades=58
[INFO] Kmeans Top 2: Short SMA=34, Long SMA=276, Sharpe=0.3777, Trades=14
[INFO] Kmeans Top 3: Short SMA=36, Long SMA=214, Sharpe=0.3275, Trades=20
[INFO] Kmeans Top 4: Short SMA=160, Long SMA=194, Sharpe=0.2808, Trades=19
[INFO] Kmeans Top 5: Short SMA=84, Long SMA=218, Sharpe=0.2598, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (96, 130)
[INFO]   Rounded: (37, 214)
[INFO]   Nearest: (38.0, 214.0)
[INFO]   Rounded: (177, 250)
[INFO]   Nearest: (178.0, 250.0)
[INFO]   Rounded: (29, 57)
[INFO]   Nearest: (28.0, 56.0)
[INFO]   Rounded: (42, 152)
[INFO]   Rounded: (40, 95)
[INFO]   Nearest: (40.0, 96.0)
[INFO]   Rounded: (217, 258)
[INFO]   Nearest: (218.0, 258.0)
[INFO]   Rounded: (131, 282)
[INFO]   Nearest: (130.0, 282.0)
[INFO]   Rounded: (121, 183)
[INFO]   Nearest: (122.0, 182.0)
[INFO]   Rounded: (82, 216)
[INFO]   Rounded: (254, 288)
[INFO]   Rounded: (164, 197)
[INFO]   Nearest: (164.0, 196.0)
[INFO]   Rounded: (34, 275)
[INFO]   Nearest: (34.0, 274.0)
[INFO]   Rounded: (95, 261)
[INFO]   Nearest: (96.0, 262.0)
[INFO]   Rounded: (95, 149)
[INFO]   Nearest: (94.0, 150.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(30/56) - Original Sharpe: 0.5547, Trades: 58
[INFO] Kmeans cluster 2: SMA(34/276) - Original Sharpe: 0.3777, Trades: 14
[INFO] Kmeans cluster 3: SMA(36/214) - Original Sharpe: 0.3275, Trades: 20
[INFO] Kmeans cluster 4: SMA(160/194) - Original Sharpe: 0.2808, Trades: 19
[INFO] Kmeans cluster 5: SMA(84/218) - Original Sharpe: 0.2598, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (30/56) - Sharpe: 0.5547
[INFO] cluster 2: (34/276) - Sharpe: 0.3777
[INFO] cluster 3: (36/214) - Sharpe: 0.3275
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.084997            2.724553
1    2021-11-14 2021-11-14            43    -3.371493           -1.415131
2    2022-01-14 2022-01-14            41     0.999580            3.143245
3    2022-03-14 2022-03-14            44    -2.172742            0.042149
4    2022-05-14 2022-05-14            43    -2.742027           -1.298446
5    2022-07-14 2022-07-14            44     1.611941            0.959537
6    2022-09-14 2022-09-14            43    -0.389136           -3.963593
7    2022-11-14 2022-11-14            43    -1.067985           -2.767453
8    2023-01-14 2023-01-14            41     3.157482            2.820878
9    2023-03-14 2023-03-14            43    -3.021412            0.183254
10   2023-05-14 2023-05-14            44    -0.333860           -1.092776
11   2023-07-14 2023-07-14            44     5.741367            4.759448
12   2023-09-14 2023-09-14            43    -1.017661           -1.405318
13   2023-11-14 2023-11-14            42     1.520442           -1.133870
14   2024-01-14 2024-01-14            43    -0.905207           -1.757094
15   2024-03-14 2024-03-14            42     0.235563            0.235563
16   2024-05-14 2024-05-14            44    -5.318006           -2.053244
17   2024-07-14 2024-07-14            45    -0.143393           -1.784422
18   2024-09-14 2024-09-14            43    -1.755618           -0.072879
19   2024-11-14 2024-11-14            33    -0.116449           -1.830592
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |              2.7 |          4.8 | True          
[INFO] 2021-11-14   |         -3.4 |             -1.4 |          2.0 | True          
[INFO] 2022-01-14   |          1.0 |              3.1 |          2.1 | True          
[INFO] 2022-03-14   |         -2.2 |              0.0 |          2.2 | True          
[INFO] 2022-05-14   |         -2.7 |             -1.3 |          1.4 | True          
[INFO] 2022-07-14   |          1.6 |              1.0 |         -0.6 | False         
[INFO] 2022-09-14   |         -0.4 |             -4.0 |         -3.6 | False         
[INFO] 2022-11-14   |         -1.1 |             -2.8 |         -1.7 | False         
[INFO] 2023-01-14   |          3.2 |              2.8 |         -0.4 | False         
[INFO] 2023-03-14   |         -3.0 |              0.2 |          3.2 | True          
[INFO] 2023-05-14   |         -0.3 |             -1.1 |         -0.8 | False         
[INFO] 2023-07-14   |          5.7 |              4.8 |         -0.9 | False         
[INFO] 2023-09-14   |         -1.0 |             -1.4 |         -0.4 | False         
[INFO] 2023-11-14   |          1.5 |             -1.1 |         -2.6 | False         
[INFO] 2024-01-14   |         -0.9 |             -1.8 |         -0.9 | False         
[INFO] 2024-03-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -2.1 |          3.2 | True          
[INFO] 2024-07-14   |         -0.1 |             -1.8 |         -1.7 | False         
[INFO] 2024-09-14   |         -1.8 |             -0.1 |          1.7 | True          
[INFO] 2024-11-14   |         -0.1 |             -1.8 |         -1.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 8 of 19 periods (42.11% win rate)
[INFO] Updating Excel file with Kmeans results for CL...
[INFO] Excel file updated successfully. Added CL with Kmeans win rate 42.1% in row 10
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(30/56) - Original Sharpe: 0.5547
[INFO] Added cluster 2 to portfolio: SMA(34/276) - Original Sharpe: 0.3777
[INFO] Added cluster 3 to portfolio: SMA(36/214) - Original Sharpe: 0.3275
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CL_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0868
[INFO] Kmeans Best out-of-sample Sharpe: -0.6531
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for CL...
[INFO] Excel file updated successfully. Added CL with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CL
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6266 to 0.8788
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.878812
[INFO] Number of Trades: 162
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6266 to 0.8788
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.0216 to 3.8079
[INFO] Scaled Trades range: -0.7951 to 15.7640
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6071
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 12
[INFO] Using 12 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 12 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 350 elements
[INFO] Cluster 1: 1251 elements
[INFO] Cluster 2: 1763 elements
[INFO] Cluster 3: 471 elements
[INFO] Cluster 4: 1553 elements
[INFO] Cluster 5: 1550 elements
[INFO] Cluster 6: 484 elements
[INFO] Cluster 7: 60 elements
[INFO] Cluster 8: 869 elements
[INFO] Cluster 9: 1035 elements
[INFO] Cluster 10: 1056 elements
[INFO] Cluster 11: 143 elements
[INFO] Using 12 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=96, Long SMA=122, Sharpe=-0.3430, Trades=32
[INFO] Cluster 1 cluster: Short SMA=128, Long SMA=272, Sharpe=0.0103, Trades=12
[INFO] Cluster 2 cluster: Short SMA=64, Long SMA=254, Sharpe=0.2186, Trades=16
[INFO] Cluster 3 cluster: Short SMA=32, Long SMA=52, Sharpe=0.4978, Trades=66
[INFO] Cluster 4 cluster: Short SMA=190, Long SMA=256, Sharpe=0.1832, Trades=16
[INFO] Cluster 5 cluster: Short SMA=38, Long SMA=184, Sharpe=0.2524, Trades=20
[INFO] Cluster 6 cluster: Short SMA=256, Long SMA=286, Sharpe=-0.1241, Trades=23
[INFO] Cluster 7 cluster: Short SMA=34, Long SMA=36, Sharpe=0.1731, Trades=162
[INFO] Cluster 8 cluster: Short SMA=40, Long SMA=98, Sharpe=0.4006, Trades=32
[INFO] Cluster 9 cluster: Short SMA=140, Long SMA=196, Sharpe=0.1871, Trades=19
[INFO] Cluster 10 cluster: Short SMA=98, Long SMA=156, Sharpe=-0.1792, Trades=21
[INFO] Cluster 11 cluster: Short SMA=168, Long SMA=174, Sharpe=0.5897, Trades=53
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8788, Trades=162
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=168, Long SMA=174, Sharpe=0.5897, Trades=53
[INFO] Top 2: Short SMA=32, Long SMA=52, Sharpe=0.4978, Trades=66
[INFO] Top 3: Short SMA=40, Long SMA=98, Sharpe=0.4006, Trades=32
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 12 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(168/174) - Original Sharpe: 0.5897, Trades: 53
[INFO] Hierarchical cluster 2: SMA(32/52) - Original Sharpe: 0.4978, Trades: 66
[INFO] Hierarchical cluster 3: SMA(40/98) - Original Sharpe: 0.4006, Trades: 32
[INFO] Hierarchical cluster 4: SMA(38/184) - Original Sharpe: 0.2524, Trades: 20
[INFO] Hierarchical cluster 5: SMA(64/254) - Original Sharpe: 0.2186, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (168/174) - Sharpe: 0.5897
[INFO] cluster 2: (32/52) - Sharpe: 0.4978
[INFO] cluster 3: (40/98) - Sharpe: 0.4006
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.084997            1.645124
1    2021-11-14 2021-11-14            43    -3.371493           -1.967620
2    2022-01-14 2022-01-14            41     0.999580            2.526296
3    2022-03-14 2022-03-14            44    -2.172742            0.042149
4    2022-05-14 2022-05-14            43    -2.742027           -1.275636
5    2022-07-14 2022-07-14            44     1.611941            1.068754
6    2022-09-14 2022-09-14            43    -0.389136           -0.276589
7    2022-11-14 2022-11-14            43    -1.067985           -1.532262
8    2023-01-14 2023-01-14            41     3.157482            2.742145
9    2023-03-14 2023-03-14            43    -3.021412            0.771404
10   2023-05-14 2023-05-14            44    -0.333860           -1.335240
11   2023-07-14 2023-07-14            44     5.741367            0.500598
12   2023-09-14 2023-09-14            43    -1.017661           -3.099830
13   2023-11-14 2023-11-14            42     1.520442            0.892051
14   2024-01-14 2024-01-14            43    -0.905207            2.389497
15   2024-03-14 2024-03-14            42     0.235563            1.000762
16   2024-05-14 2024-05-14            44    -5.318006           -3.401003
17   2024-07-14 2024-07-14            45    -0.143393            0.092788
18   2024-09-14 2024-09-14            43    -1.755618            0.961730
19   2024-11-14 2024-11-14            33    -0.116449           -1.830592
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |              1.6 |          3.7 | True          
[INFO] 2021-11-14   |         -3.4 |             -2.0 |          1.4 | True          
[INFO] 2022-01-14   |          1.0 |              2.5 |          1.5 | True          
[INFO] 2022-03-14   |         -2.2 |              0.0 |          2.2 | True          
[INFO] 2022-05-14   |         -2.7 |             -1.3 |          1.4 | True          
[INFO] 2022-07-14   |          1.6 |              1.1 |         -0.5 | False         
[INFO] 2022-09-14   |         -0.4 |             -0.3 |          0.1 | True          
[INFO] 2022-11-14   |         -1.1 |             -1.5 |         -0.4 | False         
[INFO] 2023-01-14   |          3.2 |              2.7 |         -0.5 | False         
[INFO] 2023-03-14   |         -3.0 |              0.8 |          3.8 | True          
[INFO] 2023-05-14   |         -0.3 |             -1.3 |         -1.0 | False         
[INFO] 2023-07-14   |          5.7 |              0.5 |         -5.2 | False         
[INFO] 2023-09-14   |         -1.0 |             -3.1 |         -2.1 | False         
[INFO] 2023-11-14   |          1.5 |              0.9 |         -0.6 | False         
[INFO] 2024-01-14   |         -0.9 |              2.4 |          3.3 | True          
[INFO] 2024-03-14   |          0.2 |              1.0 |          0.8 | True          
[INFO] 2024-05-14   |         -5.3 |             -3.4 |          1.9 | True          
[INFO] 2024-07-14   |         -0.1 |              0.1 |          0.2 | True          
[INFO] 2024-09-14   |         -1.8 |              1.0 |          2.8 | True          
[INFO] 2024-11-14   |         -0.1 |             -1.8 |         -1.7 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Hierarchical cluster wins (rounded comparison): 12 of 20 periods (60.00% win rate)
[INFO] Updating Excel file with Hierarchical results for CL...
[INFO] Excel file updated successfully. Added CL with Hierarchical win rate 60.0% in row 10
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(168/174) - Original Sharpe: 0.5897
[INFO] Added cluster 2 to portfolio: SMA(32/52) - Original Sharpe: 0.4978
[INFO] Added cluster 3 to portfolio: SMA(40/98) - Original Sharpe: 0.4006
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CL_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0504
[INFO] Hierarchical Best out-of-sample Sharpe: -0.6531
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for CL...
[INFO] Excel file updated successfully. Added CL with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CL
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CT in column D: 16.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 248.00s
[INFO] Best parameters: Short SMA = 34, Long SMA = 46
[INFO] Best Sharpe ratio: 0.962456, Trades: 81
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_CT_best_34/46 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CT
[INFO] Big Point Value (from data): 500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.39 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $473,067.00
[INFO] Market Buy & Hold P&L: $-135.00
[INFO] Outperformance: $473,202.00
[INFO] Sharpe ratio (entire period, annualized): 0.734813
[INFO] Sharpe ratio (in-sample, annualized): 0.962456
[INFO] Sharpe ratio (out-of-sample, annualized): 0.233362
[INFO] Maximum Drawdown: $139,161.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 60
[INFO] Out-of-sample period trades: 21
[INFO] Total trades: 81
[INFO] In-sample P&L: $500,879.00
[INFO] Out-of-sample P&L: $55,046.00
[INFO] 
Best parameters from GA: Short SMA = 34, Long SMA = 46, Sharpe = 0.962456
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 500.0
[INFO] Slippage: 16.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6979 to 0.9625
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.962456
[INFO] Number of Trades: 81
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6979 to 0.9625
[INFO] Trades range: 10.0 to 339.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6852 to 3.9097
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 19
[INFO] Using 19 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=19...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 478 elements
[INFO] Kmeans Cluster 1: 642 elements
[INFO] Kmeans Cluster 2: 542 elements
[INFO] Kmeans Cluster 3: 747 elements
[INFO] Kmeans Cluster 4: 473 elements
[INFO] Kmeans Cluster 5: 665 elements
[INFO] Kmeans Cluster 6: 670 elements
[INFO] Kmeans Cluster 7: 358 elements
[INFO] Kmeans Cluster 8: 524 elements
[INFO] Kmeans Cluster 9: 605 elements
[INFO] Kmeans Cluster 10: 1030 elements
[INFO] Kmeans Cluster 11: 217 elements
[INFO] Kmeans Cluster 12: 552 elements
[INFO] Kmeans Cluster 13: 224 elements
[INFO] Kmeans Cluster 14: 787 elements
[INFO] Kmeans Cluster 15: 536 elements
[INFO] Kmeans Cluster 16: 409 elements
[INFO] Kmeans Cluster 17: 564 elements
[INFO] Kmeans Cluster 18: 562 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=27.06, Long SMA=146.54, Sharpe=0.4136
[INFO] Centroid 1: Short SMA=55.66, Long SMA=253.08, Sharpe=0.0900
[INFO] Centroid 2: Short SMA=236.41, Long SMA=275.68, Sharpe=-0.3305
[INFO] Centroid 3: Short SMA=154.63, Long SMA=220.93, Sharpe=-0.0974
[INFO] Centroid 4: Short SMA=99.53, Long SMA=136.28, Sharpe=-0.1923
[INFO] Centroid 5: Short SMA=205.84, Long SMA=255.14, Sharpe=-0.1532
[INFO] Centroid 6: Short SMA=103.92, Long SMA=198.56, Sharpe=-0.3383
[INFO] Centroid 7: Short SMA=31.89, Long SMA=60.14, Sharpe=0.0702
[INFO] Centroid 8: Short SMA=24.35, Long SMA=205.27, Sharpe=0.2424
[INFO] Centroid 9: Short SMA=166.55, Long SMA=276.73, Sharpe=-0.0468
[INFO] Centroid 10: Short SMA=108.36, Long SMA=269.62, Sharpe=-0.1418
[INFO] Centroid 11: Short SMA=270.76, Long SMA=286.82, Sharpe=-0.0215
[INFO] Centroid 12: Short SMA=33.25, Long SMA=277.92, Sharpe=0.3007
[INFO] Centroid 13: Short SMA=32.01, Long SMA=57.54, Sharpe=0.5025
[INFO] Centroid 14: Short SMA=46.58, Long SMA=97.90, Sharpe=0.2563
[INFO] Centroid 15: Short SMA=171.78, Long SMA=199.52, Sharpe=0.1191
[INFO] Centroid 16: Short SMA=60.88, Long SMA=141.80, Sharpe=0.0591
[INFO] Centroid 17: Short SMA=115.72, Long SMA=155.12, Sharpe=-0.4399
[INFO] Centroid 18: Short SMA=64.39, Long SMA=201.14, Sharpe=-0.1931
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=46, Sharpe=0.9625, Trades=81
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=28, Long SMA=146, Sharpe=0.5181, Trades=22
[INFO] Kmeans Top 2: Short SMA=30, Long SMA=54, Sharpe=0.4747, Trades=49
[INFO] Kmeans Top 3: Short SMA=34, Long SMA=278, Sharpe=0.3905, Trades=14
[INFO] Kmeans Top 4: Short SMA=24, Long SMA=206, Sharpe=0.3543, Trades=18
[INFO] Kmeans Top 5: Short SMA=46, Long SMA=98, Sharpe=0.2952, Trades=34
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18}
[INFO]   Rounded: (27, 147)
[INFO]   Nearest: (28.0, 146.0)
[INFO]   Rounded: (56, 253)
[INFO]   Nearest: (56.0, 254.0)
[INFO]   Rounded: (236, 276)
[INFO]   Rounded: (155, 221)
[INFO]   Nearest: (154.0, 220.0)
[INFO]   Rounded: (100, 136)
[INFO]   Rounded: (206, 255)
[INFO]   Nearest: (206.0, 256.0)
[INFO]   Rounded: (104, 199)
[INFO]   Nearest: (104.0, 198.0)
[INFO]   Rounded: (32, 60)
[INFO]   Rounded: (24, 205)
[INFO]   Nearest: (24.0, 206.0)
[INFO]   Rounded: (167, 277)
[INFO]   Nearest: (166.0, 276.0)
[INFO]   Rounded: (108, 270)
[INFO]   Rounded: (271, 287)
[INFO]   Nearest: (270.0, 286.0)
[INFO]   Rounded: (33, 278)
[INFO]   Nearest: (34.0, 278.0)
[INFO]   Rounded: (32, 58)
[INFO]   Rounded: (47, 98)
[INFO]   Nearest: (46.0, 98.0)
[INFO]   Rounded: (172, 200)
[INFO]   Rounded: (61, 142)
[INFO]   Nearest: (60.0, 142.0)
[INFO]   Rounded: (116, 155)
[INFO]   Nearest: (116.0, 156.0)
[INFO]   Rounded: (64, 201)
[INFO]   Nearest: (64.0, 202.0)
[INFO] Successfully plotted 19 out of 19 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(28/146) - Original Sharpe: 0.5181, Trades: 22
[INFO] Kmeans cluster 2: SMA(30/54) - Original Sharpe: 0.4747, Trades: 49
[INFO] Kmeans cluster 3: SMA(34/278) - Original Sharpe: 0.3905, Trades: 14
[INFO] Kmeans cluster 4: SMA(24/206) - Original Sharpe: 0.3543, Trades: 18
[INFO] Kmeans cluster 5: SMA(46/98) - Original Sharpe: 0.2952, Trades: 34
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (28/146) - Sharpe: 0.5181
[INFO] cluster 2: (30/54) - Sharpe: 0.4747
[INFO] cluster 3: (34/278) - Sharpe: 0.3905
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     4.813792            4.813792
1    2021-11-10 2021-11-10            41    -1.040578           -0.589296
2    2022-01-10 2022-01-10            41    -1.414548            0.287208
3    2022-03-10 2022-03-10            42     3.891271            3.891271
4    2022-05-10 2022-05-10            41    -1.433874           -3.115806
5    2022-07-10 2022-07-10            44    -4.366290           -6.326074
6    2022-09-10 2022-09-10            43    -3.101727           -2.089204
7    2022-11-10 2022-11-10            40     2.171378            0.462203
8    2023-01-10 2023-01-10            41     0.013687            1.650712
9    2023-03-10 2023-03-10            42    -1.173054            0.034927
10   2023-05-10 2023-05-10            40     0.876456           -2.111869
11   2023-07-10 2023-07-10            44    -0.240108           -2.613844
12   2023-09-10 2023-09-10            44     1.293828           -2.076790
13   2023-11-10 2023-11-10            40    -0.460322           -0.527037
14   2024-01-10 2024-01-10            41     3.165454           -1.623768
15   2024-03-10 2024-03-10            43    -1.060941           -4.797037
16   2024-05-10 2024-05-10            40     2.090657            2.090657
17   2024-07-10 2024-07-10            43     1.137725            1.137725
18   2024-09-10 2024-09-10            44    -3.483824           -2.684606
19   2024-11-10 2024-11-10            35     0.406321            2.580368
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -1.0 |             -0.6 |          0.4 | True          
[INFO] 2022-01-10   |         -1.4 |              0.3 |          1.7 | True          
[INFO] 2022-03-10   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.4 |             -3.1 |         -1.7 | False         
[INFO] 2022-07-10   |         -4.4 |             -6.3 |         -1.9 | False         
[INFO] 2022-09-10   |         -3.1 |             -2.1 |          1.0 | True          
[INFO] 2022-11-10   |          2.2 |              0.5 |         -1.7 | False         
[INFO] 2023-01-10   |          0.0 |              1.7 |          1.7 | True          
[INFO] 2023-03-10   |         -1.2 |              0.0 |          1.2 | True          
[INFO] 2023-05-10   |          0.9 |             -2.1 |         -3.0 | False         
[INFO] 2023-07-10   |         -0.2 |             -2.6 |         -2.4 | False         
[INFO] 2023-09-10   |          1.3 |             -2.1 |         -3.4 | False         
[INFO] 2023-11-10   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2024-01-10   |          3.2 |             -1.6 |         -4.8 | False         
[INFO] 2024-03-10   |         -1.1 |             -4.8 |         -3.7 | False         
[INFO] 2024-05-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -3.5 |             -2.7 |          0.8 | True          
[INFO] 2024-11-10   |          0.4 |              2.6 |          2.2 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2022-03-10, 2023-11-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Kmeans cluster wins (rounded comparison): 7 of 15 periods (46.67% win rate)
[INFO] Updating Excel file with Kmeans results for CT...
[INFO] Excel file updated successfully. Added CT with Kmeans win rate 46.7% in row 11
[INFO] Added best Sharpe parameters 34/46 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 46
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(28/146) - Original Sharpe: 0.5181
[INFO] Added cluster 2 to portfolio: SMA(30/54) - Original Sharpe: 0.4747
[INFO] Added cluster 3 to portfolio: SMA(34/278) - Original Sharpe: 0.3905
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CT_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1092
[INFO] Kmeans Best out-of-sample Sharpe: 0.2334
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for CT...
[INFO] Excel file updated successfully. Added CT with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CT
[INFO] Big Point Value: 500.0
[INFO] Slippage: 16.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6979 to 0.9625
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.962456
[INFO] Number of Trades: 81
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6979 to 0.9625
[INFO] Trades range: 10.0 to 339.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6852 to 3.9097
[INFO] Scaled Trades range: -0.7533 to 16.0364
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5572
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1858 elements
[INFO] Cluster 1: 729 elements
[INFO] Cluster 2: 1549 elements
[INFO] Cluster 3: 1347 elements
[INFO] Cluster 4: 54 elements
[INFO] Cluster 5: 1072 elements
[INFO] Cluster 6: 194 elements
[INFO] Cluster 7: 612 elements
[INFO] Cluster 8: 236 elements
[INFO] Cluster 9: 729 elements
[INFO] Cluster 10: 220 elements
[INFO] Cluster 11: 1224 elements
[INFO] Cluster 12: 127 elements
[INFO] Cluster 13: 491 elements
[INFO] Cluster 14: 143 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=100, Long SMA=180, Sharpe=-0.4176, Trades=18
[INFO] Cluster 1 cluster: Short SMA=62, Long SMA=156, Sharpe=0.0262, Trades=18
[INFO] Cluster 2 cluster: Short SMA=174, Long SMA=252, Sharpe=-0.0633, Trades=12
[INFO] Cluster 3 cluster: Short SMA=42, Long SMA=262, Sharpe=0.1080, Trades=16
[INFO] Cluster 4 cluster: Short SMA=34, Long SMA=36, Sharpe=0.5073, Trades=165
[INFO] Cluster 5 cluster: Short SMA=46, Long SMA=98, Sharpe=0.2952, Trades=34
[INFO] Cluster 6 cluster: Short SMA=272, Long SMA=288, Sharpe=-0.0010, Trades=38
[INFO] Cluster 7 cluster: Short SMA=174, Long SMA=200, Sharpe=-0.0372, Trades=30
[INFO] Cluster 8 cluster: Short SMA=220, Long SMA=224, Sharpe=-0.1036, Trades=61
[INFO] Cluster 9 cluster: Short SMA=26, Long SMA=160, Sharpe=0.4910, Trades=22
[INFO] Cluster 10 cluster: Short SMA=34, Long SMA=44, Sharpe=0.7171, Trades=89
[INFO] Cluster 11 cluster: Short SMA=116, Long SMA=272, Sharpe=-0.0739, Trades=12
[INFO] Cluster 12 cluster: Short SMA=130, Long SMA=134, Sharpe=-0.1275, Trades=50
[INFO] Cluster 13 cluster: Short SMA=236, Long SMA=276, Sharpe=-0.5507, Trades=20
[INFO] Cluster 14 cluster: Short SMA=32, Long SMA=54, Sharpe=0.5346, Trades=55
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=46, Sharpe=0.9625, Trades=81
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=34, Long SMA=44, Sharpe=0.7171, Trades=89
[INFO] Top 2: Short SMA=32, Long SMA=54, Sharpe=0.5346, Trades=55
[INFO] Top 3: Short SMA=34, Long SMA=36, Sharpe=0.5073, Trades=165
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(34/44) - Original Sharpe: 0.7171, Trades: 89
[INFO] Hierarchical cluster 2: SMA(32/54) - Original Sharpe: 0.5346, Trades: 55
[INFO] Hierarchical cluster 3: SMA(34/36) - Original Sharpe: 0.5073, Trades: 165
[INFO] Hierarchical cluster 4: SMA(26/160) - Original Sharpe: 0.4910, Trades: 22
[INFO] Hierarchical cluster 5: SMA(46/98) - Original Sharpe: 0.2952, Trades: 34
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/44) - Sharpe: 0.7171
[INFO] cluster 2: (32/54) - Sharpe: 0.5346
[INFO] cluster 3: (34/36) - Sharpe: 0.5073
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     4.813792            4.813792
1    2021-11-10 2021-11-10            41    -1.040578           -2.614695
2    2022-01-10 2022-01-10            41    -1.414548           -2.075992
3    2022-03-10 2022-03-10            42     3.891271            3.263468
4    2022-05-10 2022-05-10            41    -1.433874           -0.397559
5    2022-07-10 2022-07-10            44    -4.366290           -5.011317
6    2022-09-10 2022-09-10            43    -3.101727           -2.706425
7    2022-11-10 2022-11-10            40     2.171378            1.421161
8    2023-01-10 2023-01-10            41     0.013687           -0.527891
9    2023-03-10 2023-03-10            42    -1.173054           -1.255638
10   2023-05-10 2023-05-10            40     0.876456            0.612893
11   2023-07-10 2023-07-10            44    -0.240108            0.018808
12   2023-09-10 2023-09-10            44     1.293828            1.602452
13   2023-11-10 2023-11-10            40    -0.460322           -1.384046
14   2024-01-10 2024-01-10            41     3.165454            3.150241
15   2024-03-10 2024-03-10            43    -1.060941           -1.200221
16   2024-05-10 2024-05-10            40     2.090657            2.090657
17   2024-07-10 2024-07-10            43     1.137725            1.137725
18   2024-09-10 2024-09-10            44    -3.483824           -4.304560
19   2024-11-10 2024-11-10            35     0.406321            1.865197
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -1.0 |             -2.6 |         -1.6 | False         
[INFO] 2022-01-10   |         -1.4 |             -2.1 |         -0.7 | False         
[INFO] 2022-03-10   |          3.9 |              3.3 |         -0.6 | False         
[INFO] 2022-05-10   |         -1.4 |             -0.4 |          1.0 | True          
[INFO] 2022-07-10   |         -4.4 |             -5.0 |         -0.6 | False         
[INFO] 2022-09-10   |         -3.1 |             -2.7 |          0.4 | True          
[INFO] 2022-11-10   |          2.2 |              1.4 |         -0.8 | False         
[INFO] 2023-01-10   |          0.0 |             -0.5 |         -0.5 | False         
[INFO] 2023-03-10   |         -1.2 |             -1.3 |         -0.1 | False         
[INFO] 2023-05-10   |          0.9 |              0.6 |         -0.3 | False         
[INFO] 2023-07-10   |         -0.2 |              0.0 |          0.2 | True          
[INFO] 2023-09-10   |          1.3 |              1.6 |          0.3 | True          
[INFO] 2023-11-10   |         -0.5 |             -1.4 |         -0.9 | False         
[INFO] 2024-01-10   |          3.2 |              3.2 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -1.1 |             -1.2 |         -0.1 | False         
[INFO] 2024-05-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -3.5 |             -4.3 |         -0.8 | False         
[INFO] 2024-11-10   |          0.4 |              1.9 |          1.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2024-01-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 16 periods (31.25% win rate)
[INFO] Updating Excel file with Hierarchical results for CT...
[INFO] Excel file updated successfully. Added CT with Hierarchical win rate 31.2% in row 11
[INFO] Added best Sharpe parameters 34/46 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 46
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/44) - Original Sharpe: 0.7171
[INFO] Added cluster 2 to portfolio: SMA(32/54) - Original Sharpe: 0.5346
[INFO] Added cluster 3 to portfolio: SMA(34/36) - Original Sharpe: 0.5073
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CT_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1096
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2334
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for CT...
[INFO] Excel file updated successfully. Added CT with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CT
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for DX in column D: 9.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 378.89s
[INFO] Best parameters: Short SMA = 38, Long SMA = 46
[INFO] Best Sharpe ratio: 0.858167, Trades: 78
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_DX_best_38/46 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @DX
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 11.44 contracts
[INFO] Maximum Position Size: 27 contracts
[INFO] Strategy Total P&L: $299,542.00
[INFO] Market Buy & Hold P&L: $34,961.00
[INFO] Outperformance: $264,581.00
[INFO] Sharpe ratio (entire period, annualized): 0.447473
[INFO] Sharpe ratio (in-sample, annualized): 0.858167
[INFO] Sharpe ratio (out-of-sample, annualized): -0.499666
[INFO] Maximum Drawdown: $282,207.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 58
[INFO] Out-of-sample period trades: 20
[INFO] Total trades: 78
[INFO] In-sample P&L: $454,390.00
[INFO] Out-of-sample P&L: $-114,613.00
[INFO] 
Best parameters from GA: Short SMA = 38, Long SMA = 46, Sharpe = 0.858167
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7443 to 0.8582
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.858167
[INFO] Number of Trades: 78
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10189 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7443 to 0.8582
[INFO] Trades range: 10.0 to 340.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3620 to 2.7774
[INFO] Scaled Long SMA range: -2.7580 to 1.4307
[INFO] Scaled Sharpe ratio range: -2.5342 to 2.5444
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 321 elements
[INFO] Kmeans Cluster 1: 672 elements
[INFO] Kmeans Cluster 2: 592 elements
[INFO] Kmeans Cluster 3: 646 elements
[INFO] Kmeans Cluster 4: 677 elements
[INFO] Kmeans Cluster 5: 852 elements
[INFO] Kmeans Cluster 6: 687 elements
[INFO] Kmeans Cluster 7: 487 elements
[INFO] Kmeans Cluster 8: 252 elements
[INFO] Kmeans Cluster 9: 452 elements
[INFO] Kmeans Cluster 10: 542 elements
[INFO] Kmeans Cluster 11: 621 elements
[INFO] Kmeans Cluster 12: 1008 elements
[INFO] Kmeans Cluster 13: 861 elements
[INFO] Kmeans Cluster 14: 830 elements
[INFO] Kmeans Cluster 15: 689 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=26.81, Long SMA=60.53, Sharpe=0.0346
[INFO] Centroid 1: Short SMA=125.03, Long SMA=164.14, Sharpe=-0.0299
[INFO] Centroid 2: Short SMA=92.10, Long SMA=128.71, Sharpe=0.4631
[INFO] Centroid 3: Short SMA=190.38, Long SMA=223.00, Sharpe=-0.1138
[INFO] Centroid 4: Short SMA=31.03, Long SMA=269.46, Sharpe=0.4710
[INFO] Centroid 5: Short SMA=39.26, Long SMA=163.16, Sharpe=0.3921
[INFO] Centroid 6: Short SMA=157.24, Long SMA=208.93, Sharpe=-0.3473
[INFO] Centroid 7: Short SMA=106.61, Long SMA=279.00, Sharpe=-0.3036
[INFO] Centroid 8: Short SMA=33.63, Long SMA=56.20, Sharpe=0.5239
[INFO] Centroid 9: Short SMA=114.25, Long SMA=218.86, Sharpe=-0.1919
[INFO] Centroid 10: Short SMA=73.56, Long SMA=268.35, Sharpe=0.0091
[INFO] Centroid 11: Short SMA=81.56, Long SMA=200.58, Sharpe=0.1512
[INFO] Centroid 12: Short SMA=46.16, Long SMA=104.36, Sharpe=0.2306
[INFO] Centroid 13: Short SMA=181.85, Long SMA=274.37, Sharpe=-0.3961
[INFO] Centroid 14: Short SMA=244.92, Long SMA=276.04, Sharpe=-0.2238
[INFO] Centroid 15: Short SMA=37.40, Long SMA=218.49, Sharpe=0.3706
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=46, Sharpe=0.8582, Trades=78
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=34, Long SMA=56, Sharpe=0.6949, Trades=48
[INFO] Kmeans Top 2: Short SMA=92, Long SMA=128, Sharpe=0.6173, Trades=27
[INFO] Kmeans Top 3: Short SMA=32, Long SMA=270, Sharpe=0.4542, Trades=13
[INFO] Kmeans Top 4: Short SMA=40, Long SMA=164, Sharpe=0.3637, Trades=21
[INFO] Kmeans Top 5: Short SMA=36, Long SMA=218, Sharpe=0.2764, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (27, 61)
[INFO]   Nearest: (26.0, 60.0)
[INFO]   Rounded: (125, 164)
[INFO]   Nearest: (126.0, 164.0)
[INFO]   Rounded: (92, 129)
[INFO]   Nearest: (92.0, 128.0)
[INFO]   Rounded: (190, 223)
[INFO]   Nearest: (190.0, 224.0)
[INFO]   Rounded: (31, 269)
[INFO]   Nearest: (32.0, 270.0)
[INFO]   Rounded: (39, 163)
[INFO]   Nearest: (40.0, 164.0)
[INFO]   Rounded: (157, 209)
[INFO]   Nearest: (158.0, 208.0)
[INFO]   Rounded: (107, 279)
[INFO]   Nearest: (106.0, 278.0)
[INFO]   Rounded: (34, 56)
[INFO]   Rounded: (114, 219)
[INFO]   Nearest: (114.0, 218.0)
[INFO]   Rounded: (74, 268)
[INFO]   Rounded: (82, 201)
[INFO]   Nearest: (82.0, 200.0)
[INFO]   Rounded: (46, 104)
[INFO]   Rounded: (182, 274)
[INFO]   Rounded: (245, 276)
[INFO]   Nearest: (244.0, 276.0)
[INFO]   Rounded: (37, 218)
[INFO]   Nearest: (38.0, 218.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(34/56) - Original Sharpe: 0.6949, Trades: 48
[INFO] Kmeans cluster 2: SMA(92/128) - Original Sharpe: 0.6173, Trades: 27
[INFO] Kmeans cluster 3: SMA(32/270) - Original Sharpe: 0.4542, Trades: 13
[INFO] Kmeans cluster 4: SMA(40/164) - Original Sharpe: 0.3637, Trades: 21
[INFO] Kmeans cluster 5: SMA(36/218) - Original Sharpe: 0.2764, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2816
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/56) - Sharpe: 0.6949
[INFO] cluster 2: (92/128) - Sharpe: 0.6173
[INFO] cluster 3: (32/270) - Sharpe: 0.4542
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Out-of-sample period starts on: 2021-09-24
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-24 2021-09-24            43     3.830825            3.830825
1    2021-11-24 2021-11-24            42    -0.750030           -0.975845
2    2022-01-24 2022-01-24            43    -1.158438            2.691163
3    2022-03-24 2022-03-24            42     2.899845            2.899845
4    2022-05-24 2022-05-24            44    -0.772793            3.060061
5    2022-07-24 2022-07-24            45     4.284626            3.795241
6    2022-09-24 2022-09-24            43    -1.964998           -2.254418
7    2022-11-24 2022-11-24            41     2.719154           -2.719154
8    2023-01-24 2023-01-24            43    -4.933460           -2.480509
9    2023-03-24 2023-03-24            43    -4.230774           -2.493262
10   2023-05-24 2023-05-24            43    -5.713874           -1.915060
11   2023-07-24 2023-07-24            45    -1.713757           -1.686787
12   2023-09-24 2023-09-24            44    -0.948650           -1.105717
13   2023-11-24 2023-11-24            41    -0.015249           -2.689251
14   2024-01-24 2024-01-24            43    -1.669992           -0.684859
15   2024-03-24 2024-03-24            43    -3.457983           -0.723513
16   2024-05-24 2024-05-24            43    -0.337335           -0.477164
17   2024-07-24 2024-07-24            44     0.689877           -1.836061
18   2024-09-24 2024-09-24            44     0.685285           -3.135928
19   2024-11-24 2024-11-24            26     1.390507            1.915487
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-24   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2021-11-24   |         -0.8 |             -1.0 |         -0.2 | False         
[INFO] 2022-01-24   |         -1.2 |              2.7 |          3.9 | True          
[INFO] 2022-03-24   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-05-24   |         -0.8 |              3.1 |          3.9 | True          
[INFO] 2022-07-24   |          4.3 |              3.8 |         -0.5 | False         
[INFO] 2022-09-24   |         -2.0 |             -2.3 |         -0.3 | False         
[INFO] 2022-11-24   |          2.7 |             -2.7 |         -5.4 | False         
[INFO] 2023-01-24   |         -4.9 |             -2.5 |          2.4 | True          
[INFO] 2023-03-24   |         -4.2 |             -2.5 |          1.7 | True          
[INFO] 2023-05-24   |         -5.7 |             -1.9 |          3.8 | True          
[INFO] 2023-07-24   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-09-24   |         -0.9 |             -1.1 |         -0.2 | False         
[INFO] 2023-11-24   |         -0.0 |             -2.7 |         -2.7 | False         
[INFO] 2024-01-24   |         -1.7 |             -0.7 |          1.0 | True          
[INFO] 2024-03-24   |         -3.5 |             -0.7 |          2.8 | True          
[INFO] 2024-05-24   |         -0.3 |             -0.5 |         -0.2 | False         
[INFO] 2024-07-24   |          0.7 |             -1.8 |         -2.5 | False         
[INFO] 2024-09-24   |          0.7 |             -3.1 |         -3.8 | False         
[INFO] 2024-11-24   |          1.4 |              1.9 |          0.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-24, 2022-03-24, 2023-07-24
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 8 of 17 periods (47.06% win rate)
[INFO] Updating Excel file with Kmeans results for DX...
[INFO] Excel file updated successfully. Added DX with Kmeans win rate 47.1% in row 12
[INFO] Added best Sharpe parameters 38/46 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 46
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/56) - Original Sharpe: 0.6949
[INFO] Added cluster 2 to portfolio: SMA(92/128) - Original Sharpe: 0.6173
[INFO] Added cluster 3 to portfolio: SMA(32/270) - Original Sharpe: 0.4542
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'DX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0236
[INFO] Kmeans Best out-of-sample Sharpe: -0.4997
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for DX...
[INFO] Excel file updated successfully. Added DX with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\DX
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7443 to 0.8582
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.858167
[INFO] Number of Trades: 78
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10189 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7443 to 0.8582
[INFO] Trades range: 10.0 to 340.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3620 to 2.7774
[INFO] Scaled Long SMA range: -2.7580 to 1.4307
[INFO] Scaled Sharpe ratio range: -2.5342 to 2.5444
[INFO] Scaled Trades range: -0.6914 to 16.4374
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10189 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5345
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 19
[INFO] Using 19 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 19 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1255 elements
[INFO] Cluster 1: 864 elements
[INFO] Cluster 2: 842 elements
[INFO] Cluster 3: 956 elements
[INFO] Cluster 4: 929 elements
[INFO] Cluster 5: 690 elements
[INFO] Cluster 6: 248 elements
[INFO] Cluster 7: 277 elements
[INFO] Cluster 8: 805 elements
[INFO] Cluster 9: 530 elements
[INFO] Cluster 10: 584 elements
[INFO] Cluster 11: 15 elements
[INFO] Cluster 12: 61 elements
[INFO] Cluster 13: 287 elements
[INFO] Cluster 14: 813 elements
[INFO] Cluster 15: 173 elements
[INFO] Cluster 16: 369 elements
[INFO] Cluster 17: 81 elements
[INFO] Cluster 18: 410 elements
[INFO] Using 18 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=40, Long SMA=174, Sharpe=0.3338, Trades=19
[INFO] Cluster 1 cluster: Short SMA=50, Long SMA=118, Sharpe=0.1927, Trades=27
[INFO] Cluster 2 cluster: Short SMA=186, Long SMA=226, Sharpe=-0.3994, Trades=21
[INFO] Cluster 3 cluster: Short SMA=236, Long SMA=274, Sharpe=-0.3974, Trades=19
[INFO] Cluster 4 cluster: Short SMA=74, Long SMA=212, Sharpe=0.2385, Trades=15
[INFO] Cluster 5 cluster: Short SMA=118, Long SMA=176, Sharpe=-0.0854, Trades=14
[INFO] Cluster 6 cluster: Short SMA=32, Long SMA=42, Sharpe=0.4922, Trades=79
[INFO] Cluster 7 cluster: Short SMA=36, Long SMA=62, Sharpe=0.5289, Trades=48
[INFO] Cluster 8 cluster: Short SMA=34, Long SMA=262, Sharpe=0.4673, Trades=13
[INFO] Cluster 9 cluster: Short SMA=104, Long SMA=278, Sharpe=-0.3956, Trades=11
[INFO] Cluster 10 cluster: Short SMA=176, Long SMA=282, Sharpe=-0.4394, Trades=11
[INFO] Cluster 12 cluster: Short SMA=28, Long SMA=32, Sharpe=0.1402, Trades=137
[INFO] Cluster 13 cluster: Short SMA=92, Long SMA=122, Sharpe=0.5068, Trades=27
[INFO] Cluster 14 cluster: Short SMA=136, Long SMA=214, Sharpe=-0.4544, Trades=14
[INFO] Cluster 15 cluster: Short SMA=162, Long SMA=168, Sharpe=-0.2535, Trades=44
[INFO] Cluster 16 cluster: Short SMA=68, Long SMA=278, Sharpe=0.0002, Trades=11
[INFO] Cluster 17 cluster: Short SMA=258, Long SMA=262, Sharpe=-0.2417, Trades=55
[INFO] Cluster 18 cluster: Short SMA=38, Long SMA=84, Sharpe=0.2898, Trades=39
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=46, Sharpe=0.8582, Trades=78
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=36, Long SMA=62, Sharpe=0.5289, Trades=48
[INFO] Top 2: Short SMA=92, Long SMA=122, Sharpe=0.5068, Trades=27
[INFO] Top 3: Short SMA=32, Long SMA=42, Sharpe=0.4922, Trades=79
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 18 valid clusters with clusters
[INFO] Filtering to 10174 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(36/62) - Original Sharpe: 0.5289, Trades: 48
[INFO] Hierarchical cluster 2: SMA(92/122) - Original Sharpe: 0.5068, Trades: 27
[INFO] Hierarchical cluster 3: SMA(32/42) - Original Sharpe: 0.4922, Trades: 79
[INFO] Hierarchical cluster 4: SMA(34/262) - Original Sharpe: 0.4673, Trades: 13
[INFO] Hierarchical cluster 5: SMA(40/174) - Original Sharpe: 0.3338, Trades: 19
[INFO] Trimmed warm-up period. Evaluation data length: 2816
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (36/62) - Sharpe: 0.5289
[INFO] cluster 2: (92/122) - Sharpe: 0.5068
[INFO] cluster 3: (32/42) - Sharpe: 0.4922
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Out-of-sample period starts on: 2021-09-24
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-24 2021-09-24            43     3.830825            3.643094
1    2021-11-24 2021-11-24            42    -0.750030           -1.636644
2    2022-01-24 2022-01-24            43    -1.158438            0.914830
3    2022-03-24 2022-03-24            42     2.899845            2.899845
4    2022-05-24 2022-05-24            44    -0.772793            2.084450
5    2022-07-24 2022-07-24            45     4.284626            3.653737
6    2022-09-24 2022-09-24            43    -1.964998           -2.678423
7    2022-11-24 2022-11-24            41     2.719154            2.719154
8    2023-01-24 2023-01-24            43    -4.933460           -3.543914
9    2023-03-24 2023-03-24            43    -4.230774           -2.673643
10   2023-05-24 2023-05-24            43    -5.713874           -2.949962
11   2023-07-24 2023-07-24            45    -1.713757           -2.033366
12   2023-09-24 2023-09-24            44    -0.948650           -0.843733
13   2023-11-24 2023-11-24            41    -0.015249           -1.923944
14   2024-01-24 2024-01-24            43    -1.669992           -1.130183
15   2024-03-24 2024-03-24            43    -3.457983           -1.406599
16   2024-05-24 2024-05-24            43    -0.337335           -2.245151
17   2024-07-24 2024-07-24            44     0.689877           -0.344439
18   2024-09-24 2024-09-24            44     0.685285           -1.824281
19   2024-11-24 2024-11-24            26     1.390507            2.808070
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-24   |          3.8 |              3.6 |         -0.2 | False         
[INFO] 2021-11-24   |         -0.8 |             -1.6 |         -0.8 | False         
[INFO] 2022-01-24   |         -1.2 |              0.9 |          2.1 | True          
[INFO] 2022-03-24   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-05-24   |         -0.8 |              2.1 |          2.9 | True          
[INFO] 2022-07-24   |          4.3 |              3.7 |         -0.6 | False         
[INFO] 2022-09-24   |         -2.0 |             -2.7 |         -0.7 | False         
[INFO] 2022-11-24   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2023-01-24   |         -4.9 |             -3.5 |          1.4 | True          
[INFO] 2023-03-24   |         -4.2 |             -2.7 |          1.5 | True          
[INFO] 2023-05-24   |         -5.7 |             -2.9 |          2.8 | True          
[INFO] 2023-07-24   |         -1.7 |             -2.0 |         -0.3 | False         
[INFO] 2023-09-24   |         -0.9 |             -0.8 |          0.1 | True          
[INFO] 2023-11-24   |         -0.0 |             -1.9 |         -1.9 | False         
[INFO] 2024-01-24   |         -1.7 |             -1.1 |          0.6 | True          
[INFO] 2024-03-24   |         -3.5 |             -1.4 |          2.1 | True          
[INFO] 2024-05-24   |         -0.3 |             -2.2 |         -1.9 | False         
[INFO] 2024-07-24   |          0.7 |             -0.3 |         -1.0 | False         
[INFO] 2024-09-24   |          0.7 |             -1.8 |         -2.5 | False         
[INFO] 2024-11-24   |          1.4 |              2.8 |          1.4 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-24, 2022-11-24
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 9 of 18 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for DX...
[INFO] Excel file updated successfully. Added DX with Hierarchical win rate 50.0% in row 12
[INFO] Added best Sharpe parameters 38/46 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 46
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(36/62) - Original Sharpe: 0.5289
[INFO] Added cluster 2 to portfolio: SMA(92/122) - Original Sharpe: 0.5068
[INFO] Added cluster 3 to portfolio: SMA(32/42) - Original Sharpe: 0.4922
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'DX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2010
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4997
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for DX...
[INFO] Excel file updated successfully. Added DX with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\DX
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for EC in column D: 9.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 326.77s
[INFO] Best parameters: Short SMA = 102, Long SMA = 106
[INFO] Best Sharpe ratio: 1.205170, Trades: 61
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_EC_best_102/106 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @EC
[INFO] Big Point Value (from data): 125000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 6.80 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $719,557.00
[INFO] Market Buy & Hold P&L: $-67,087.50
[INFO] Outperformance: $786,644.50
[INFO] Sharpe ratio (entire period, annualized): 0.852974
[INFO] Sharpe ratio (in-sample, annualized): 1.205170
[INFO] Sharpe ratio (out-of-sample, annualized): 0.038724
[INFO] Maximum Drawdown: $200,630.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 45
[INFO] Out-of-sample period trades: 16
[INFO] Total trades: 61
[INFO] In-sample P&L: $643,237.25
[INFO] Out-of-sample P&L: $8,927.75
[INFO] 
Best parameters from GA: Short SMA = 102, Long SMA = 106, Sharpe = 1.205170
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5845 to 1.2052
[INFO] 
Best parameters:
[INFO] Short SMA: 102
[INFO] Long SMA: 106
[INFO] Sharpe Ratio: 1.205170
[INFO] Number of Trades: 61
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10425 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5845 to 1.2052
[INFO] Trades range: 10.0 to 346.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3845 to 2.7910
[INFO] Scaled Long SMA range: -2.7782 to 1.4049
[INFO] Scaled Sharpe ratio range: -2.3779 to 3.4455
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 809 elements
[INFO] Kmeans Cluster 1: 720 elements
[INFO] Kmeans Cluster 2: 659 elements
[INFO] Kmeans Cluster 3: 776 elements
[INFO] Kmeans Cluster 4: 629 elements
[INFO] Kmeans Cluster 5: 959 elements
[INFO] Kmeans Cluster 6: 798 elements
[INFO] Kmeans Cluster 7: 843 elements
[INFO] Kmeans Cluster 8: 493 elements
[INFO] Kmeans Cluster 9: 569 elements
[INFO] Kmeans Cluster 10: 710 elements
[INFO] Kmeans Cluster 11: 458 elements
[INFO] Kmeans Cluster 12: 701 elements
[INFO] Kmeans Cluster 13: 346 elements
[INFO] Kmeans Cluster 14: 955 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=32.31, Long SMA=265.23, Sharpe=0.4440
[INFO] Centroid 1: Short SMA=175.92, Long SMA=225.05, Sharpe=-0.1966
[INFO] Centroid 2: Short SMA=48.96, Long SMA=107.35, Sharpe=0.3767
[INFO] Centroid 3: Short SMA=110.24, Long SMA=163.82, Sharpe=0.2894
[INFO] Centroid 4: Short SMA=250.10, Long SMA=281.87, Sharpe=-0.1422
[INFO] Centroid 5: Short SMA=202.94, Long SMA=263.32, Sharpe=-0.3505
[INFO] Centroid 6: Short SMA=103.58, Long SMA=238.21, Sharpe=0.0883
[INFO] Centroid 7: Short SMA=36.52, Long SMA=162.30, Sharpe=0.4453
[INFO] Centroid 8: Short SMA=34.24, Long SMA=74.00, Sharpe=0.1247
[INFO] Centroid 9: Short SMA=84.94, Long SMA=129.10, Sharpe=0.6172
[INFO] Centroid 10: Short SMA=138.64, Long SMA=279.22, Sharpe=-0.2567
[INFO] Centroid 11: Short SMA=73.53, Long SMA=279.49, Sharpe=0.2047
[INFO] Centroid 12: Short SMA=149.72, Long SMA=186.56, Sharpe=-0.0124
[INFO] Centroid 13: Short SMA=31.29, Long SMA=56.59, Sharpe=0.4826
[INFO] Centroid 14: Short SMA=52.58, Long SMA=210.91, Sharpe=0.3493
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=102, Long SMA=106, Sharpe=1.2052, Trades=61
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=32, Long SMA=58, Sharpe=0.6769, Trades=51
[INFO] Kmeans Top 2: Short SMA=86, Long SMA=128, Sharpe=0.6118, Trades=21
[INFO] Kmeans Top 3: Short SMA=32, Long SMA=266, Sharpe=0.4456, Trades=15
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=162, Sharpe=0.4332, Trades=19
[INFO] Kmeans Top 5: Short SMA=48, Long SMA=108, Sharpe=0.3672, Trades=25
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (32, 265)
[INFO]   Nearest: (32.0, 266.0)
[INFO]   Rounded: (176, 225)
[INFO]   Nearest: (176.0, 226.0)
[INFO]   Rounded: (49, 107)
[INFO]   Nearest: (48.0, 108.0)
[INFO]   Rounded: (110, 164)
[INFO]   Rounded: (250, 282)
[INFO]   Rounded: (203, 263)
[INFO]   Nearest: (202.0, 264.0)
[INFO]   Rounded: (104, 238)
[INFO]   Rounded: (37, 162)
[INFO]   Nearest: (36.0, 162.0)
[INFO]   Rounded: (34, 74)
[INFO]   Rounded: (85, 129)
[INFO]   Nearest: (84.0, 130.0)
[INFO]   Rounded: (139, 279)
[INFO]   Nearest: (138.0, 280.0)
[INFO]   Rounded: (74, 279)
[INFO]   Nearest: (74.0, 280.0)
[INFO]   Rounded: (150, 187)
[INFO]   Nearest: (150.0, 186.0)
[INFO]   Rounded: (31, 57)
[INFO]   Nearest: (32.0, 56.0)
[INFO]   Rounded: (53, 211)
[INFO]   Nearest: (52.0, 210.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 102, Long SMA: 106
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(32/58) - Original Sharpe: 0.6769, Trades: 51
[INFO] Kmeans cluster 2: SMA(86/128) - Original Sharpe: 0.6118, Trades: 21
[INFO] Kmeans cluster 3: SMA(32/266) - Original Sharpe: 0.4456, Trades: 15
[INFO] Kmeans cluster 4: SMA(36/162) - Original Sharpe: 0.4332, Trades: 19
[INFO] Kmeans cluster 5: SMA(48/108) - Original Sharpe: 0.3672, Trades: 25
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (102/106)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (32/58) - Sharpe: 0.6769
[INFO] cluster 2: (86/128) - Sharpe: 0.6118
[INFO] cluster 3: (32/266) - Sharpe: 0.4456
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     3.487734            3.487734
1    2021-11-14 2021-11-14            43     0.321475            0.321475
2    2022-01-14 2022-01-14            41     3.270794            3.504317
3    2022-03-14 2022-03-14            44     3.649515            3.649515
4    2022-05-14 2022-05-14            43     1.818210            1.818210
5    2022-07-14 2022-07-14            44     0.788062            0.788062
6    2022-09-14 2022-09-14            43    -1.170570           -1.170570
7    2022-11-14 2022-11-14            43    -2.242409           -1.293478
8    2023-01-14 2023-01-14            41    -0.989824           -1.812539
9    2023-03-14 2023-03-14            44     0.488570           -1.237820
10   2023-05-14 2023-05-14            44    -0.377326            0.244265
11   2023-07-14 2023-07-14            44    -3.130408           -3.406679
12   2023-09-14 2023-09-14            43     2.281930           -0.863828
13   2023-11-14 2023-11-14            42    -1.565980           -3.320618
14   2024-01-14 2024-01-14            43     1.745773           -4.000730
15   2024-03-14 2024-03-14            42    -3.416207           -2.268437
16   2024-05-14 2024-05-14            44    -0.027797           -2.086487
17   2024-07-14 2024-07-14            45    -0.762846           -0.689629
18   2024-09-14 2024-09-14            43    -3.897937           -0.791730
19   2024-11-14 2024-11-14            33     0.919641            2.299996
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-01-14   |          3.3 |              3.5 |          0.2 | True          
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -2.2 |             -1.3 |          0.9 | True          
[INFO] 2023-01-14   |         -1.0 |             -1.8 |         -0.8 | False         
[INFO] 2023-03-14   |          0.5 |             -1.2 |         -1.7 | False         
[INFO] 2023-05-14   |         -0.4 |              0.2 |          0.6 | True          
[INFO] 2023-07-14   |         -3.1 |             -3.4 |         -0.3 | False         
[INFO] 2023-09-14   |          2.3 |             -0.9 |         -3.2 | False         
[INFO] 2023-11-14   |         -1.6 |             -3.3 |         -1.7 | False         
[INFO] 2024-01-14   |          1.7 |             -4.0 |         -5.7 | False         
[INFO] 2024-03-14   |         -3.4 |             -2.3 |          1.1 | True          
[INFO] 2024-05-14   |         -0.0 |             -2.1 |         -2.1 | False         
[INFO] 2024-07-14   |         -0.8 |             -0.7 |          0.1 | True          
[INFO] 2024-09-14   |         -3.9 |             -0.8 |          3.1 | True          
[INFO] 2024-11-14   |          0.9 |              2.3 |          1.4 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 7 of 14 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for EC...
[INFO] Excel file updated successfully. Added EC with Kmeans win rate 50.0% in row 13
[INFO] Added best Sharpe parameters 102/106 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 102, Long SMA: 106
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(32/58) - Original Sharpe: 0.6769
[INFO] Added cluster 2 to portfolio: SMA(86/128) - Original Sharpe: 0.6118
[INFO] Added cluster 3 to portfolio: SMA(32/266) - Original Sharpe: 0.4456
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'EC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0551
[INFO] Kmeans Best out-of-sample Sharpe: 0.0387
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for EC...
[INFO] Excel file updated successfully. Added EC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EC
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5845 to 1.2052
[INFO] 
Best parameters:
[INFO] Short SMA: 102
[INFO] Long SMA: 106
[INFO] Sharpe Ratio: 1.205170
[INFO] Number of Trades: 61
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10425 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5845 to 1.2052
[INFO] Trades range: 10.0 to 346.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3845 to 2.7910
[INFO] Scaled Long SMA range: -2.7782 to 1.4049
[INFO] Scaled Sharpe ratio range: -2.3779 to 3.4455
[INFO] Scaled Trades range: -0.6847 to 16.6990
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10425 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6116
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1433 elements
[INFO] Cluster 1: 638 elements
[INFO] Cluster 2: 1058 elements
[INFO] Cluster 3: 1244 elements
[INFO] Cluster 4: 420 elements
[INFO] Cluster 5: 1226 elements
[INFO] Cluster 6: 645 elements
[INFO] Cluster 7: 943 elements
[INFO] Cluster 8: 1258 elements
[INFO] Cluster 9: 84 elements
[INFO] Cluster 10: 35 elements
[INFO] Cluster 11: 606 elements
[INFO] Cluster 12: 105 elements
[INFO] Cluster 13: 531 elements
[INFO] Cluster 14: 199 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=164, Long SMA=274, Sharpe=-0.1414, Trades=14
[INFO] Cluster 1 cluster: Short SMA=218, Long SMA=242, Sharpe=-0.2670, Trades=26
[INFO] Cluster 2 cluster: Short SMA=160, Long SMA=200, Sharpe=-0.0167, Trades=19
[INFO] Cluster 3 cluster: Short SMA=94, Long SMA=252, Sharpe=0.0816, Trades=11
[INFO] Cluster 4 cluster: Short SMA=30, Long SMA=60, Sharpe=0.6263, Trades=55
[INFO] Cluster 5 cluster: Short SMA=44, Long SMA=138, Sharpe=0.3941, Trades=21
[INFO] Cluster 6 cluster: Short SMA=46, Long SMA=92, Sharpe=0.0187, Trades=35
[INFO] Cluster 7 cluster: Short SMA=36, Long SMA=262, Sharpe=0.3682, Trades=15
[INFO] Cluster 8 cluster: Short SMA=58, Long SMA=196, Sharpe=0.2588, Trades=17
[INFO] Cluster 9 cluster: Short SMA=36, Long SMA=40, Sharpe=0.2239, Trades=121
[INFO] Cluster 10 cluster: Short SMA=18, Long SMA=22, Sharpe=-0.0424, Trades=205
[INFO] Cluster 11 cluster: Short SMA=110, Long SMA=164, Sharpe=0.2148, Trades=15
[INFO] Cluster 12 cluster: Short SMA=144, Long SMA=148, Sharpe=0.0335, Trades=57
[INFO] Cluster 13 cluster: Short SMA=248, Long SMA=284, Sharpe=-0.2121, Trades=18
[INFO] Cluster 14 cluster: Short SMA=92, Long SMA=116, Sharpe=0.7751, Trades=29
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=102, Long SMA=106, Sharpe=1.2052, Trades=61
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=92, Long SMA=116, Sharpe=0.7751, Trades=29
[INFO] Top 2: Short SMA=30, Long SMA=60, Sharpe=0.6263, Trades=55
[INFO] Top 3: Short SMA=44, Long SMA=138, Sharpe=0.3941, Trades=21
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10425 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 102, Long SMA: 106
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(92/116) - Original Sharpe: 0.7751, Trades: 29
[INFO] Hierarchical cluster 2: SMA(30/60) - Original Sharpe: 0.6263, Trades: 55
[INFO] Hierarchical cluster 3: SMA(44/138) - Original Sharpe: 0.3941, Trades: 21
[INFO] Hierarchical cluster 4: SMA(36/262) - Original Sharpe: 0.3682, Trades: 15
[INFO] Hierarchical cluster 5: SMA(58/196) - Original Sharpe: 0.2588, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (102/106)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (92/116) - Sharpe: 0.7751
[INFO] cluster 2: (30/60) - Sharpe: 0.6263
[INFO] cluster 3: (44/138) - Sharpe: 0.3941
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     3.487734            3.487734
1    2021-11-14 2021-11-14            43     0.321475            0.321475
2    2022-01-14 2022-01-14            41     3.270794            2.359379
3    2022-03-14 2022-03-14            44     3.649515            3.649515
4    2022-05-14 2022-05-14            43     1.818210            1.818210
5    2022-07-14 2022-07-14            44     0.788062            0.788062
6    2022-09-14 2022-09-14            43    -1.170570           -1.170570
7    2022-11-14 2022-11-14            43    -2.242409            0.523447
8    2023-01-14 2023-01-14            41    -0.989824           -1.975544
9    2023-03-14 2023-03-14            44     0.488570           -1.237820
10   2023-05-14 2023-05-14            44    -0.377326           -5.239124
11   2023-07-14 2023-07-14            44    -3.130408           -4.120644
12   2023-09-14 2023-09-14            43     2.281930            0.043677
13   2023-11-14 2023-11-14            42    -1.565980           -2.028326
14   2024-01-14 2024-01-14            43     1.745773           -0.688559
15   2024-03-14 2024-03-14            42    -3.416207           -4.164954
16   2024-05-14 2024-05-14            44    -0.027797           -2.086487
17   2024-07-14 2024-07-14            45    -0.762846           -1.552764
18   2024-09-14 2024-09-14            43    -3.897937           -3.953594
19   2024-11-14 2024-11-14            33     0.919641            2.842034
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-01-14   |          3.3 |              2.4 |         -0.9 | False         
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -2.2 |              0.5 |          2.7 | True          
[INFO] 2023-01-14   |         -1.0 |             -2.0 |         -1.0 | False         
[INFO] 2023-03-14   |          0.5 |             -1.2 |         -1.7 | False         
[INFO] 2023-05-14   |         -0.4 |             -5.2 |         -4.8 | False         
[INFO] 2023-07-14   |         -3.1 |             -4.1 |         -1.0 | False         
[INFO] 2023-09-14   |          2.3 |              0.0 |         -2.3 | False         
[INFO] 2023-11-14   |         -1.6 |             -2.0 |         -0.4 | False         
[INFO] 2024-01-14   |          1.7 |             -0.7 |         -2.4 | False         
[INFO] 2024-03-14   |         -3.4 |             -4.2 |         -0.8 | False         
[INFO] 2024-05-14   |         -0.0 |             -2.1 |         -2.1 | False         
[INFO] 2024-07-14   |         -0.8 |             -1.6 |         -0.8 | False         
[INFO] 2024-09-14   |         -3.9 |             -4.0 |         -0.1 | False         
[INFO] 2024-11-14   |          0.9 |              2.8 |          1.9 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 14 periods (14.29% win rate)
[INFO] Updating Excel file with Hierarchical results for EC...
[INFO] Excel file updated successfully. Added EC with Hierarchical win rate 14.3% in row 13
[INFO] Added best Sharpe parameters 102/106 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 102, Long SMA: 106
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(92/116) - Original Sharpe: 0.7751
[INFO] Added cluster 2 to portfolio: SMA(30/60) - Original Sharpe: 0.6263
[INFO] Added cluster 3 to portfolio: SMA(44/138) - Original Sharpe: 0.3941
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'EC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3120
[INFO] Hierarchical Best out-of-sample Sharpe: 0.0387
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for EC...
[INFO] Excel file updated successfully. Added EC with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EC
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for EMD in column D: 55.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 250.95s
[INFO] Best parameters: Short SMA = 216, Long SMA = 222
[INFO] Best Sharpe ratio: 0.453823, Trades: 36
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_EMD_best_216/222 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @EMD
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 2.80 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $195,360.00
[INFO] Market Buy & Hold P&L: $161,780.00
[INFO] Outperformance: $33,580.00
[INFO] Sharpe ratio (entire period, annualized): 0.255399
[INFO] Sharpe ratio (in-sample, annualized): 0.453823
[INFO] Sharpe ratio (out-of-sample, annualized): -0.167302
[INFO] Maximum Drawdown: $265,775.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 20
[INFO] Out-of-sample period trades: 16
[INFO] Total trades: 36
[INFO] In-sample P&L: $302,580.00
[INFO] Out-of-sample P&L: $-52,280.00
[INFO] 
Best parameters from GA: Short SMA = 216, Long SMA = 222, Sharpe = 0.453823
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 55.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] 
Best parameters:
[INFO] Short SMA: 216
[INFO] Long SMA: 222
[INFO] Sharpe Ratio: 0.453823
[INFO] Number of Trades: 36
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10530 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] Trades range: 10.0 to 335.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3944 to 2.7966
[INFO] Scaled Long SMA range: -2.7981 to 1.4094
[INFO] Scaled Sharpe ratio range: -4.0417 to 3.3900
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 661 elements
[INFO] Kmeans Cluster 1: 837 elements
[INFO] Kmeans Cluster 2: 780 elements
[INFO] Kmeans Cluster 3: 473 elements
[INFO] Kmeans Cluster 4: 315 elements
[INFO] Kmeans Cluster 5: 764 elements
[INFO] Kmeans Cluster 6: 552 elements
[INFO] Kmeans Cluster 7: 534 elements
[INFO] Kmeans Cluster 8: 900 elements
[INFO] Kmeans Cluster 9: 158 elements
[INFO] Kmeans Cluster 10: 850 elements
[INFO] Kmeans Cluster 11: 784 elements
[INFO] Kmeans Cluster 12: 240 elements
[INFO] Kmeans Cluster 13: 728 elements
[INFO] Kmeans Cluster 14: 398 elements
[INFO] Kmeans Cluster 15: 863 elements
[INFO] Kmeans Cluster 16: 693 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=178.99, Long SMA=223.25, Sharpe=-0.1102
[INFO] Centroid 1: Short SMA=106.73, Long SMA=171.32, Sharpe=-0.0101
[INFO] Centroid 2: Short SMA=44.37, Long SMA=271.76, Sharpe=-0.1259
[INFO] Centroid 3: Short SMA=243.92, Long SMA=281.53, Sharpe=-0.6133
[INFO] Centroid 4: Short SMA=25.10, Long SMA=60.07, Sharpe=0.0886
[INFO] Centroid 5: Short SMA=83.58, Long SMA=135.14, Sharpe=-0.1517
[INFO] Centroid 6: Short SMA=35.04, Long SMA=81.22, Sharpe=-0.1024
[INFO] Centroid 7: Short SMA=231.35, Long SMA=274.83, Sharpe=-0.4531
[INFO] Centroid 8: Short SMA=45.29, Long SMA=201.86, Sharpe=-0.1002
[INFO] Centroid 9: Short SMA=209.11, Long SMA=223.62, Sharpe=0.1065
[INFO] Centroid 10: Short SMA=127.61, Long SMA=260.83, Sharpe=-0.1547
[INFO] Centroid 11: Short SMA=146.79, Long SMA=189.56, Sharpe=-0.2197
[INFO] Centroid 12: Short SMA=14.35, Long SMA=250.31, Sharpe=0.0665
[INFO] Centroid 13: Short SMA=32.34, Long SMA=145.90, Sharpe=0.0741
[INFO] Centroid 14: Short SMA=57.49, Long SMA=89.73, Sharpe=-0.3148
[INFO] Centroid 15: Short SMA=84.44, Long SMA=251.30, Sharpe=-0.0010
[INFO] Centroid 16: Short SMA=175.62, Long SMA=269.93, Sharpe=-0.2511
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=216, Long SMA=222, Sharpe=0.4538, Trades=36
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=14, Long SMA=250, Sharpe=0.0756, Trades=24
[INFO] Kmeans Top 2: Short SMA=212, Long SMA=226, Sharpe=0.0500, Trades=30
[INFO] Kmeans Top 3: Short SMA=106, Long SMA=174, Sharpe=0.0356, Trades=14
[INFO] Kmeans Top 4: Short SMA=84, Long SMA=250, Sharpe=0.0319, Trades=12
[INFO] Kmeans Top 5: Short SMA=32, Long SMA=146, Sharpe=0.0074, Trades=24
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (179, 223)
[INFO]   Nearest: (178.0, 224.0)
[INFO]   Rounded: (107, 171)
[INFO]   Nearest: (106.0, 172.0)
[INFO]   Rounded: (44, 272)
[INFO]   Rounded: (244, 282)
[INFO]   Rounded: (25, 60)
[INFO]   Nearest: (26.0, 60.0)
[INFO]   Rounded: (84, 135)
[INFO]   Nearest: (84.0, 136.0)
[INFO]   Rounded: (35, 81)
[INFO]   Nearest: (36.0, 82.0)
[INFO]   Rounded: (231, 275)
[INFO]   Nearest: (232.0, 274.0)
[INFO]   Rounded: (45, 202)
[INFO]   Nearest: (46.0, 202.0)
[INFO]   Rounded: (209, 224)
[INFO]   Nearest: (210.0, 224.0)
[INFO]   Rounded: (128, 261)
[INFO]   Nearest: (128.0, 260.0)
[INFO]   Rounded: (147, 190)
[INFO]   Nearest: (146.0, 190.0)
[INFO]   Rounded: (14, 250)
[INFO]   Rounded: (32, 146)
[INFO]   Rounded: (57, 90)
[INFO]   Nearest: (58.0, 90.0)
[INFO]   Rounded: (84, 251)
[INFO]   Nearest: (84.0, 252.0)
[INFO]   Rounded: (176, 270)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 216, Long SMA: 222
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] File size: 287237 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(14/250) - Original Sharpe: 0.0756, Trades: 24
[INFO] Kmeans cluster 2: SMA(212/226) - Original Sharpe: 0.0500, Trades: 30
[INFO] Kmeans cluster 3: SMA(106/174) - Original Sharpe: 0.0356, Trades: 14
[INFO] Kmeans cluster 4: SMA(84/250) - Original Sharpe: 0.0319, Trades: 12
[INFO] Kmeans cluster 5: SMA(32/146) - Original Sharpe: 0.0074, Trades: 24
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (216/222)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 216, Long SMA: 222
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] Error: No Kmeans cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EMD
[INFO] Big Point Value: 100.0
[INFO] Slippage: 55.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] 
Best parameters:
[INFO] Short SMA: 216
[INFO] Long SMA: 222
[INFO] Sharpe Ratio: 0.453823
[INFO] Number of Trades: 36
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10530 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] Trades range: 10.0 to 335.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3944 to 2.7966
[INFO] Scaled Long SMA range: -2.7981 to 1.4094
[INFO] Scaled Sharpe ratio range: -4.0417 to 3.3900
[INFO] Scaled Trades range: -0.6701 to 14.8618
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10530 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4875
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 650 elements
[INFO] Cluster 1: 1295 elements
[INFO] Cluster 2: 646 elements
[INFO] Cluster 3: 273 elements
[INFO] Cluster 4: 581 elements
[INFO] Cluster 5: 1236 elements
[INFO] Cluster 6: 1380 elements
[INFO] Cluster 7: 995 elements
[INFO] Cluster 8: 161 elements
[INFO] Cluster 9: 763 elements
[INFO] Cluster 10: 511 elements
[INFO] Cluster 11: 56 elements
[INFO] Cluster 12: 902 elements
[INFO] Cluster 13: 335 elements
[INFO] Cluster 14: 746 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=190, Long SMA=220, Sharpe=-0.1510, Trades=22
[INFO] Cluster 1 cluster: Short SMA=158, Long SMA=272, Sharpe=-0.1801, Trades=11
[INFO] Cluster 2 cluster: Short SMA=26, Long SMA=156, Sharpe=0.1988, Trades=26
[INFO] Cluster 3 cluster: Short SMA=132, Long SMA=138, Sharpe=-0.3372, Trades=62
[INFO] Cluster 4 cluster: Short SMA=64, Long SMA=112, Sharpe=-0.1686, Trades=30
[INFO] Cluster 5 cluster: Short SMA=136, Long SMA=212, Sharpe=-0.2037, Trades=14
[INFO] Cluster 6 cluster: Short SMA=46, Long SMA=202, Sharpe=-0.0330, Trades=14
[INFO] Cluster 7 cluster: Short SMA=236, Long SMA=278, Sharpe=-0.6740, Trades=15
[INFO] Cluster 8 cluster: Short SMA=30, Long SMA=40, Sharpe=-0.0680, Trades=101
[INFO] Cluster 9 cluster: Short SMA=44, Long SMA=276, Sharpe=-0.0841, Trades=15
[INFO] Cluster 10 cluster: Short SMA=112, Long SMA=154, Sharpe=-0.0367, Trades=22
[INFO] Cluster 11 cluster: Short SMA=38, Long SMA=40, Sharpe=-0.3599, Trades=172
[INFO] Cluster 12 cluster: Short SMA=90, Long SMA=234, Sharpe=-0.0169, Trades=12
[INFO] Cluster 13 cluster: Short SMA=22, Long SMA=64, Sharpe=0.1226, Trades=54
[INFO] Cluster 14 cluster: Short SMA=58, Long SMA=114, Sharpe=-0.1113, Trades=30
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=216, Long SMA=222, Sharpe=0.4538, Trades=36
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=26, Long SMA=156, Sharpe=0.1988, Trades=26
[INFO] Top 2: Short SMA=22, Long SMA=64, Sharpe=0.1226, Trades=54
[INFO] Top 3: Short SMA=90, Long SMA=234, Sharpe=-0.0169, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10530 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 216, Long SMA: 222
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] File size: 287237 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(26/156) - Original Sharpe: 0.1988, Trades: 26
[INFO] Hierarchical cluster 2: SMA(22/64) - Original Sharpe: 0.1226, Trades: 54
[INFO] Hierarchical cluster 3: SMA(90/234) - Original Sharpe: -0.0169, Trades: 12
[INFO] Hierarchical cluster 4: SMA(46/202) - Original Sharpe: -0.0330, Trades: 14
[INFO] Hierarchical cluster 5: SMA(112/154) - Original Sharpe: -0.0367, Trades: 22
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (216/222)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 216, Long SMA: 222
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EMD
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for ES in column D: 13.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 252.84s
[INFO] Best parameters: Short SMA = 162, Long SMA = 274
[INFO] Best Sharpe ratio: 0.900987, Trades: 9
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_ES_best_162/274 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @ES
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.31 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $510,692.50
[INFO] Market Buy & Hold P&L: $187,962.50
[INFO] Outperformance: $322,730.00
[INFO] Sharpe ratio (entire period, annualized): 0.672117
[INFO] Sharpe ratio (in-sample, annualized): 0.900987
[INFO] Sharpe ratio (out-of-sample, annualized): 0.183475
[INFO] Maximum Drawdown: $136,852.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 7
[INFO] Out-of-sample period trades: 2
[INFO] Total trades: 9
[INFO] In-sample P&L: $574,895.00
[INFO] Out-of-sample P&L: $54,647.50
[INFO] 
Best parameters from GA: Short SMA = 162, Long SMA = 274, Sharpe = 0.900987
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3535 to 0.9010
[INFO] 
Best parameters:
[INFO] Short SMA: 162
[INFO] Long SMA: 274
[INFO] Sharpe Ratio: 0.900987
[INFO] Number of Trades: 9
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7619 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3535 to 0.8709
[INFO] Trades range: 10.0 to 333.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1625 to 2.6459
[INFO] Scaled Long SMA range: -2.4904 to 1.6638
[INFO] Scaled Sharpe ratio range: -4.7529 to 3.5059
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 684 elements
[INFO] Kmeans Cluster 1: 305 elements
[INFO] Kmeans Cluster 2: 416 elements
[INFO] Kmeans Cluster 3: 603 elements
[INFO] Kmeans Cluster 4: 517 elements
[INFO] Kmeans Cluster 5: 412 elements
[INFO] Kmeans Cluster 6: 584 elements
[INFO] Kmeans Cluster 7: 434 elements
[INFO] Kmeans Cluster 8: 576 elements
[INFO] Kmeans Cluster 9: 898 elements
[INFO] Kmeans Cluster 10: 535 elements
[INFO] Kmeans Cluster 11: 273 elements
[INFO] Kmeans Cluster 12: 137 elements
[INFO] Kmeans Cluster 13: 477 elements
[INFO] Kmeans Cluster 14: 454 elements
[INFO] Kmeans Cluster 15: 314 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=43.51, Long SMA=142.41, Sharpe=0.3174
[INFO] Centroid 1: Short SMA=193.91, Long SMA=225.56, Sharpe=0.6995
[INFO] Centroid 2: Short SMA=141.62, Long SMA=195.63, Sharpe=0.4170
[INFO] Centroid 3: Short SMA=235.36, Long SMA=267.88, Sharpe=0.3811
[INFO] Centroid 4: Short SMA=52.25, Long SMA=205.92, Sharpe=0.2753
[INFO] Centroid 5: Short SMA=55.69, Long SMA=101.02, Sharpe=0.1302
[INFO] Centroid 6: Short SMA=50.34, Long SMA=266.18, Sharpe=0.3072
[INFO] Centroid 7: Short SMA=21.24, Long SMA=193.61, Sharpe=0.4320
[INFO] Centroid 8: Short SMA=133.73, Long SMA=168.00, Sharpe=0.3042
[INFO] Centroid 9: Short SMA=87.37, Long SMA=142.80, Sharpe=0.2149
[INFO] Centroid 10: Short SMA=36.76, Long SMA=73.60, Sharpe=0.2868
[INFO] Centroid 11: Short SMA=26.51, Long SMA=75.29, Sharpe=0.4728
[INFO] Centroid 12: Short SMA=41.09, Long SMA=63.30, Sharpe=-0.0575
[INFO] Centroid 13: Short SMA=187.78, Long SMA=219.38, Sharpe=0.5578
[INFO] Centroid 14: Short SMA=24.23, Long SMA=268.98, Sharpe=0.4521
[INFO] Centroid 15: Short SMA=252.01, Long SMA=287.02, Sharpe=0.5255
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=162, Long SMA=274, Sharpe=0.9010, Trades=9
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=194, Long SMA=226, Sharpe=0.6423, Trades=14
[INFO] Kmeans Top 2: Short SMA=184, Long SMA=216, Sharpe=0.6063, Trades=16
[INFO] Kmeans Top 3: Short SMA=254, Long SMA=288, Sharpe=0.4949, Trades=13
[INFO] Kmeans Top 4: Short SMA=234, Long SMA=266, Sharpe=0.4533, Trades=12
[INFO] Kmeans Top 5: Short SMA=22, Long SMA=270, Sharpe=0.4300, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (44, 142)
[INFO]   Rounded: (194, 226)
[INFO]   Rounded: (142, 196)
[INFO]   Rounded: (235, 268)
[INFO]   Nearest: (236.0, 268.0)
[INFO]   Rounded: (52, 206)
[INFO]   Rounded: (56, 101)
[INFO]   Nearest: (56.0, 102.0)
[INFO]   Rounded: (50, 266)
[INFO]   Rounded: (21, 194)
[INFO]   Nearest: (22.0, 194.0)
[INFO]   Rounded: (134, 168)
[INFO]   Rounded: (87, 143)
[INFO]   Nearest: (88.0, 142.0)
[INFO]   Rounded: (37, 74)
[INFO]   Nearest: (36.0, 74.0)
[INFO]   Rounded: (27, 75)
[INFO]   Nearest: (26.0, 76.0)
[INFO]   Rounded: (41, 63)
[INFO]   Nearest: (42.0, 64.0)
[INFO]   Rounded: (188, 219)
[INFO]   Nearest: (188.0, 220.0)
[INFO]   Rounded: (24, 269)
[INFO]   Nearest: (24.0, 268.0)
[INFO]   Rounded: (252, 287)
[INFO]   Nearest: (252.0, 288.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 162, Long SMA: 274
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(194/226) - Original Sharpe: 0.6423, Trades: 14
[INFO] Kmeans cluster 2: SMA(184/216) - Original Sharpe: 0.6063, Trades: 16
[INFO] Kmeans cluster 3: SMA(254/288) - Original Sharpe: 0.4949, Trades: 13
[INFO] Kmeans cluster 4: SMA(234/266) - Original Sharpe: 0.4533, Trades: 12
[INFO] Kmeans cluster 5: SMA(22/270) - Original Sharpe: 0.4300, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (162/274)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (194/226) - Sharpe: 0.6423
[INFO] cluster 2: (184/216) - Sharpe: 0.6063
[INFO] cluster 3: (254/288) - Sharpe: 0.4949
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.911391            0.911391
1    2021-11-14 2021-11-14            43    -0.628261           -0.628261
2    2022-01-14 2022-01-14            41    -2.812439           -2.812439
3    2022-03-14 2022-03-14            44    -0.960414           -0.960414
4    2022-05-14 2022-05-14            43     0.052587            1.853175
5    2022-07-14 2022-07-14            44    -0.911692            0.683717
6    2022-09-14 2022-09-14            43    -0.232210           -0.232210
7    2022-11-14 2022-11-14            43     0.093646            0.093646
8    2023-01-14 2023-01-14            41     1.619125            1.619125
9    2023-03-14 2023-03-14            44    -1.939764           -2.931540
10   2023-05-14 2023-05-14            44     2.318419           -3.124826
11   2023-07-14 2023-07-14            44    -0.689668           -0.859616
12   2023-09-14 2023-09-14            43    -1.587437           -1.513156
13   2023-11-14 2023-11-14            42     3.878695            3.878695
14   2024-01-14 2024-01-14            43     3.930264            3.930264
15   2024-03-14 2024-03-14            42    -0.498348           -0.498348
16   2024-05-14 2024-05-14            44     4.604239            4.604239
17   2024-07-14 2024-07-14            45    -0.424050           -0.424050
18   2024-09-14 2024-09-14            43     2.451837            2.451837
19   2024-11-14 2024-11-14            33    -1.823399           -1.823399
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.1 |              1.9 |          1.8 | True          
[INFO] 2022-07-14   |         -0.9 |              0.7 |          1.6 | True          
[INFO] 2022-09-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -1.9 |             -2.9 |         -1.0 | False         
[INFO] 2023-05-14   |          2.3 |             -3.1 |         -5.4 | False         
[INFO] 2023-07-14   |         -0.7 |             -0.9 |         -0.2 | False         
[INFO] 2023-09-14   |         -1.6 |             -1.5 |          0.1 | True          
[INFO] 2023-11-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 6
[INFO] Kmeans cluster wins (rounded comparison): 3 of 6 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for ES...
[INFO] Excel file updated successfully. Added ES with Kmeans win rate 50.0% in row 14
[INFO] Added best Sharpe parameters 162/274 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 162, Long SMA: 274
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(194/226) - Original Sharpe: 0.6423
[INFO] Added cluster 2 to portfolio: SMA(184/216) - Original Sharpe: 0.6063
[INFO] Added cluster 3 to portfolio: SMA(254/288) - Original Sharpe: 0.4949
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ES_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1714
[INFO] Kmeans Best out-of-sample Sharpe: 0.1835
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for ES...
[INFO] Excel file updated successfully. Added ES with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ES
[INFO] Big Point Value: 50.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3535 to 0.9010
[INFO] 
Best parameters:
[INFO] Short SMA: 162
[INFO] Long SMA: 274
[INFO] Sharpe Ratio: 0.900987
[INFO] Number of Trades: 9
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7619 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3535 to 0.8709
[INFO] Trades range: 10.0 to 333.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1625 to 2.6459
[INFO] Scaled Long SMA range: -2.4904 to 1.6638
[INFO] Scaled Sharpe ratio range: -4.7529 to 3.5059
[INFO] Scaled Trades range: -0.6029 to 16.9141
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 7619 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6710
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 13
[INFO] Using 13 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 13 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 196 elements
[INFO] Cluster 1: 810 elements
[INFO] Cluster 2: 910 elements
[INFO] Cluster 3: 732 elements
[INFO] Cluster 4: 525 elements
[INFO] Cluster 5: 624 elements
[INFO] Cluster 6: 841 elements
[INFO] Cluster 7: 1050 elements
[INFO] Cluster 8: 332 elements
[INFO] Cluster 9: 11 elements
[INFO] Cluster 10: 544 elements
[INFO] Cluster 11: 924 elements
[INFO] Cluster 12: 120 elements
[INFO] Using 12 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=26, Long SMA=36, Sharpe=-0.0820, Trades=86
[INFO] Cluster 1 cluster: Short SMA=196, Long SMA=228, Sharpe=0.7660, Trades=16
[INFO] Cluster 2 cluster: Short SMA=140, Long SMA=186, Sharpe=0.2878, Trades=14
[INFO] Cluster 3 cluster: Short SMA=20, Long SMA=226, Sharpe=0.4466, Trades=16
[INFO] Cluster 4 cluster: Short SMA=30, Long SMA=68, Sharpe=0.3184, Trades=42
[INFO] Cluster 5 cluster: Short SMA=34, Long SMA=120, Sharpe=0.2913, Trades=20
[INFO] Cluster 6 cluster: Short SMA=240, Long SMA=274, Sharpe=0.4151, Trades=13
[INFO] Cluster 7 cluster: Short SMA=52, Long SMA=196, Sharpe=0.3511, Trades=10
[INFO] Cluster 8 cluster: Short SMA=68, Long SMA=92, Sharpe=0.1463, Trades=30
[INFO] Cluster 10 cluster: Short SMA=48, Long SMA=276, Sharpe=0.4199, Trades=11
[INFO] Cluster 11 cluster: Short SMA=88, Long SMA=140, Sharpe=0.2240, Trades=16
[INFO] Cluster 12 cluster: Short SMA=128, Long SMA=132, Sharpe=0.2659, Trades=40
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=162, Long SMA=274, Sharpe=0.9010, Trades=9
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=196, Long SMA=228, Sharpe=0.7660, Trades=16
[INFO] Top 2: Short SMA=20, Long SMA=226, Sharpe=0.4466, Trades=16
[INFO] Top 3: Short SMA=48, Long SMA=276, Sharpe=0.4199, Trades=11
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 12 valid clusters with clusters
[INFO] Filtering to 7608 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 162, Long SMA: 274
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(196/228) - Original Sharpe: 0.7660, Trades: 16
[INFO] Hierarchical cluster 2: SMA(20/226) - Original Sharpe: 0.4466, Trades: 16
[INFO] Hierarchical cluster 3: SMA(48/276) - Original Sharpe: 0.4199, Trades: 11
[INFO] Hierarchical cluster 4: SMA(240/274) - Original Sharpe: 0.4151, Trades: 13
[INFO] Hierarchical cluster 5: SMA(52/196) - Original Sharpe: 0.3511, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (162/274)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (196/228) - Sharpe: 0.7660
[INFO] cluster 2: (20/226) - Sharpe: 0.4466
[INFO] cluster 3: (48/276) - Sharpe: 0.4199
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.911391            0.911391
1    2021-11-14 2021-11-14            43    -0.628261           -0.628261
2    2022-01-14 2022-01-14            41    -2.812439           -2.736084
3    2022-03-14 2022-03-14            44    -0.960414           -1.216748
4    2022-05-14 2022-05-14            43     0.052587            1.170710
5    2022-07-14 2022-07-14            44    -0.911692           -0.911692
6    2022-09-14 2022-09-14            43    -0.232210           -0.232210
7    2022-11-14 2022-11-14            43     0.093646            0.093646
8    2023-01-14 2023-01-14            41     1.619125           -0.264532
9    2023-03-14 2023-03-14            44    -1.939764           -1.223209
10   2023-05-14 2023-05-14            44     2.318419            4.202434
11   2023-07-14 2023-07-14            44    -0.689668           -0.689668
12   2023-09-14 2023-09-14            43    -1.587437           -3.202803
13   2023-11-14 2023-11-14            42     3.878695            3.440762
14   2024-01-14 2024-01-14            43     3.930264            3.930264
15   2024-03-14 2024-03-14            42    -0.498348           -0.498348
16   2024-05-14 2024-05-14            44     4.604239            4.604239
17   2024-07-14 2024-07-14            45    -0.424050           -0.424050
18   2024-09-14 2024-09-14            43     2.451837            2.451837
19   2024-11-14 2024-11-14            33    -1.823399           -1.823399
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.8 |             -2.7 |          0.1 | True          
[INFO] 2022-03-14   |         -1.0 |             -1.2 |         -0.2 | False         
[INFO] 2022-05-14   |          0.1 |              1.2 |          1.1 | True          
[INFO] 2022-07-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.6 |             -0.3 |         -1.9 | False         
[INFO] 2023-03-14   |         -1.9 |             -1.2 |          0.7 | True          
[INFO] 2023-05-14   |          2.3 |              4.2 |          1.9 | True          
[INFO] 2023-07-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.6 |             -3.2 |         -1.6 | False         
[INFO] 2023-11-14   |          3.9 |              3.4 |         -0.5 | False         
[INFO] 2024-01-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-07-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 8 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for ES...
[INFO] Excel file updated successfully. Added ES with Hierarchical win rate 50.0% in row 14
[INFO] Added best Sharpe parameters 162/274 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 162, Long SMA: 274
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(196/228) - Original Sharpe: 0.7660
[INFO] Added cluster 2 to portfolio: SMA(20/226) - Original Sharpe: 0.4466
[INFO] Added cluster 3 to portfolio: SMA(48/276) - Original Sharpe: 0.4199
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ES_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1621
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1835
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for ES...
[INFO] Excel file updated successfully. Added ES with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ES
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FC in column D: 25.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 245.29s
[INFO] Best parameters: Short SMA = 212, Long SMA = 214
[INFO] Best Sharpe ratio: 0.759717, Trades: 91
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_FC_best_212/214 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FC
[INFO] Big Point Value (from data): 500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.42 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $335,425.00
[INFO] Market Buy & Hold P&L: $4,212.50
[INFO] Outperformance: $331,212.50
[INFO] Sharpe ratio (entire period, annualized): 0.465159
[INFO] Sharpe ratio (in-sample, annualized): 0.759717
[INFO] Sharpe ratio (out-of-sample, annualized): -0.209532
[INFO] Maximum Drawdown: $225,162.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 56
[INFO] Out-of-sample period trades: 35
[INFO] Total trades: 91
[INFO] In-sample P&L: $438,112.50
[INFO] Out-of-sample P&L: $-52,725.00
[INFO] 
Best parameters from GA: Short SMA = 212, Long SMA = 214, Sharpe = 0.759717
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 500.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4652 to 0.7597
[INFO] 
Best parameters:
[INFO] Short SMA: 212
[INFO] Long SMA: 214
[INFO] Sharpe Ratio: 0.759717
[INFO] Number of Trades: 91
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4652 to 0.7597
[INFO] Trades range: 10.0 to 377.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6102 to 4.0054
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 14
[INFO] Using 14 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=14...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 571 elements
[INFO] Kmeans Cluster 1: 665 elements
[INFO] Kmeans Cluster 2: 857 elements
[INFO] Kmeans Cluster 3: 733 elements
[INFO] Kmeans Cluster 4: 908 elements
[INFO] Kmeans Cluster 5: 249 elements
[INFO] Kmeans Cluster 6: 839 elements
[INFO] Kmeans Cluster 7: 794 elements
[INFO] Kmeans Cluster 8: 885 elements
[INFO] Kmeans Cluster 9: 1073 elements
[INFO] Kmeans Cluster 10: 859 elements
[INFO] Kmeans Cluster 11: 679 elements
[INFO] Kmeans Cluster 12: 627 elements
[INFO] Kmeans Cluster 13: 846 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=159.60, Long SMA=238.26, Sharpe=0.3566
[INFO] Centroid 1: Short SMA=136.65, Long SMA=189.50, Sharpe=-0.0116
[INFO] Centroid 2: Short SMA=35.90, Long SMA=112.26, Sharpe=0.1815
[INFO] Centroid 3: Short SMA=73.46, Long SMA=220.69, Sharpe=0.2426
[INFO] Centroid 4: Short SMA=135.35, Long SMA=264.37, Sharpe=0.1407
[INFO] Centroid 5: Short SMA=21.35, Long SMA=44.03, Sharpe=-0.1745
[INFO] Centroid 6: Short SMA=61.47, Long SMA=280.81, Sharpe=-0.1128
[INFO] Centroid 7: Short SMA=46.33, Long SMA=175.47, Sharpe=-0.0448
[INFO] Centroid 8: Short SMA=44.17, Long SMA=243.08, Sharpe=0.0629
[INFO] Centroid 9: Short SMA=202.75, Long SMA=261.87, Sharpe=0.1545
[INFO] Centroid 10: Short SMA=96.24, Long SMA=151.19, Sharpe=0.0862
[INFO] Centroid 11: Short SMA=149.18, Long SMA=189.78, Sharpe=0.2298
[INFO] Centroid 12: Short SMA=246.74, Long SMA=279.58, Sharpe=-0.0364
[INFO] Centroid 13: Short SMA=51.23, Long SMA=97.85, Sharpe=0.3680
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=212, Long SMA=214, Sharpe=0.7597, Trades=91
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=50, Long SMA=98, Sharpe=0.3860, Trades=32
[INFO] Kmeans Top 2: Short SMA=154, Long SMA=240, Sharpe=0.3633, Trades=13
[INFO] Kmeans Top 3: Short SMA=76, Long SMA=220, Sharpe=0.3352, Trades=18
[INFO] Kmeans Top 4: Short SMA=34, Long SMA=120, Sharpe=0.2809, Trades=26
[INFO] Kmeans Top 5: Short SMA=132, Long SMA=264, Sharpe=0.2339, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}
[INFO]   Rounded: (160, 238)
[INFO]   Rounded: (137, 189)
[INFO]   Nearest: (136.0, 190.0)
[INFO]   Rounded: (36, 112)
[INFO]   Rounded: (73, 221)
[INFO]   Nearest: (74.0, 220.0)
[INFO]   Rounded: (135, 264)
[INFO]   Nearest: (136.0, 264.0)
[INFO]   Rounded: (21, 44)
[INFO]   Nearest: (22.0, 44.0)
[INFO]   Rounded: (61, 281)
[INFO]   Nearest: (62.0, 280.0)
[INFO]   Rounded: (46, 175)
[INFO]   Nearest: (46.0, 176.0)
[INFO]   Rounded: (44, 243)
[INFO]   Nearest: (44.0, 244.0)
[INFO]   Rounded: (203, 262)
[INFO]   Nearest: (202.0, 262.0)
[INFO]   Rounded: (96, 151)
[INFO]   Nearest: (96.0, 152.0)
[INFO]   Rounded: (149, 190)
[INFO]   Nearest: (150.0, 190.0)
[INFO]   Rounded: (247, 280)
[INFO]   Nearest: (246.0, 280.0)
[INFO]   Rounded: (51, 98)
[INFO]   Nearest: (52.0, 98.0)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 212, Long SMA: 214
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(50/98) - Original Sharpe: 0.3860, Trades: 32
[INFO] Kmeans cluster 2: SMA(154/240) - Original Sharpe: 0.3633, Trades: 13
[INFO] Kmeans cluster 3: SMA(76/220) - Original Sharpe: 0.3352, Trades: 18
[INFO] Kmeans cluster 4: SMA(34/120) - Original Sharpe: 0.2809, Trades: 26
[INFO] Kmeans cluster 5: SMA(132/264) - Original Sharpe: 0.2339, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (212/214)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (50/98) - Sharpe: 0.3860
[INFO] cluster 2: (154/240) - Sharpe: 0.3633
[INFO] cluster 3: (76/220) - Sharpe: 0.3352
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.243014            0.879785
1    2021-11-10 2021-11-10            41    -1.727839           -1.729910
2    2022-01-10 2022-01-10            41    -1.491477           -3.639945
3    2022-03-10 2022-03-10            42    -2.601234            0.995020
4    2022-05-10 2022-05-10            41     0.452239            0.452239
5    2022-07-10 2022-07-10            44    -0.869854           -2.209515
6    2022-09-10 2022-09-10            43     2.218651            2.242787
7    2022-11-10 2022-11-10            40    -1.000002           -0.987037
8    2023-01-10 2023-01-10            41    -0.351051            6.618744
9    2023-03-10 2023-03-10            42     1.488556            0.686008
10   2023-05-10 2023-05-10            40    -0.521278            3.248021
11   2023-07-10 2023-07-10            44     2.056252            2.056252
12   2023-09-10 2023-09-10            44    -4.792962           -3.979653
13   2023-11-10 2023-11-10            40    -0.611143           -0.753717
14   2024-01-10 2024-01-10            41     4.588013           -5.934986
15   2024-03-10 2024-03-10            43    -2.405032            2.365266
16   2024-05-10 2024-05-10            40    -0.870401           -0.330357
17   2024-07-10 2024-07-10            43     2.708529            1.561002
18   2024-09-10 2024-09-10            44     0.264177           -0.060595
19   2024-11-10 2024-11-10            35     3.696891           -5.408667
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.2 |              0.9 |          1.1 | True          
[INFO] 2021-11-10   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2022-01-10   |         -1.5 |             -3.6 |         -2.1 | False         
[INFO] 2022-03-10   |         -2.6 |              1.0 |          3.6 | True          
[INFO] 2022-05-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.9 |             -2.2 |         -1.3 | False         
[INFO] 2022-09-10   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2022-11-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2023-01-10   |         -0.4 |              6.6 |          7.0 | True          
[INFO] 2023-03-10   |          1.5 |              0.7 |         -0.8 | False         
[INFO] 2023-05-10   |         -0.5 |              3.2 |          3.7 | True          
[INFO] 2023-07-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -4.8 |             -4.0 |          0.8 | True          
[INFO] 2023-11-10   |         -0.6 |             -0.8 |         -0.2 | False         
[INFO] 2024-01-10   |          4.6 |             -5.9 |        -10.5 | False         
[INFO] 2024-03-10   |         -2.4 |              2.4 |          4.8 | True          
[INFO] 2024-05-10   |         -0.9 |             -0.3 |          0.6 | True          
[INFO] 2024-07-10   |          2.7 |              1.6 |         -1.1 | False         
[INFO] 2024-09-10   |          0.3 |             -0.1 |         -0.4 | False         
[INFO] 2024-11-10   |          3.7 |             -5.4 |         -9.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-10, 2022-05-10, 2022-09-10, 2022-11-10, 2023-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Kmeans cluster wins (rounded comparison): 7 of 15 periods (46.67% win rate)
[INFO] Updating Excel file with Kmeans results for FC...
[INFO] Excel file updated successfully. Added FC with Kmeans win rate 46.7% in row 15
[INFO] Added best Sharpe parameters 212/214 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 212, Long SMA: 214
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(50/98) - Original Sharpe: 0.3860
[INFO] Added cluster 2 to portfolio: SMA(154/240) - Original Sharpe: 0.3633
[INFO] Added cluster 3 to portfolio: SMA(76/220) - Original Sharpe: 0.3352
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0594
[INFO] Kmeans Best out-of-sample Sharpe: -0.2095
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FC...
[INFO] Excel file updated successfully. Added FC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FC
[INFO] Big Point Value: 500.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4652 to 0.7597
[INFO] 
Best parameters:
[INFO] Short SMA: 212
[INFO] Long SMA: 214
[INFO] Sharpe Ratio: 0.759717
[INFO] Number of Trades: 91
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4652 to 0.7597
[INFO] Trades range: 10.0 to 377.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6102 to 4.0054
[INFO] Scaled Trades range: -0.8971 to 17.2706
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5547
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 326 elements
[INFO] Cluster 1: 919 elements
[INFO] Cluster 2: 1979 elements
[INFO] Cluster 3: 656 elements
[INFO] Cluster 4: 1006 elements
[INFO] Cluster 5: 918 elements
[INFO] Cluster 6: 70 elements
[INFO] Cluster 7: 168 elements
[INFO] Cluster 8: 1019 elements
[INFO] Cluster 9: 783 elements
[INFO] Cluster 10: 1407 elements
[INFO] Cluster 11: 344 elements
[INFO] Cluster 12: 540 elements
[INFO] Cluster 13: 450 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=114, Long SMA=118, Sharpe=0.3756, Trades=67
[INFO] Cluster 1 cluster: Short SMA=68, Long SMA=280, Sharpe=-0.0013, Trades=17
[INFO] Cluster 2 cluster: Short SMA=86, Long SMA=158, Sharpe=0.0641, Trades=26
[INFO] Cluster 3 cluster: Short SMA=246, Long SMA=278, Sharpe=-0.0197, Trades=21
[INFO] Cluster 4 cluster: Short SMA=32, Long SMA=226, Sharpe=0.0782, Trades=30
[INFO] Cluster 5 cluster: Short SMA=198, Long SMA=274, Sharpe=0.2383, Trades=14
[INFO] Cluster 6 cluster: Short SMA=22, Long SMA=26, Sharpe=0.3610, Trades=164
[INFO] Cluster 7 cluster: Short SMA=18, Long SMA=44, Sharpe=-0.2977, Trades=78
[INFO] Cluster 8 cluster: Short SMA=44, Long SMA=110, Sharpe=0.3944, Trades=28
[INFO] Cluster 9 cluster: Short SMA=156, Long SMA=206, Sharpe=0.3760, Trades=25
[INFO] Cluster 10 cluster: Short SMA=134, Long SMA=256, Sharpe=0.2288, Trades=11
[INFO] Cluster 11 cluster: Short SMA=18, Long SMA=80, Sharpe=0.1791, Trades=46
[INFO] Cluster 12 cluster: Short SMA=70, Long SMA=220, Sharpe=0.1632, Trades=20
[INFO] Cluster 13 cluster: Short SMA=162, Long SMA=210, Sharpe=0.1342, Trades=23
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=212, Long SMA=214, Sharpe=0.7597, Trades=91
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=44, Long SMA=110, Sharpe=0.3944, Trades=28
[INFO] Top 2: Short SMA=156, Long SMA=206, Sharpe=0.3760, Trades=25
[INFO] Top 3: Short SMA=114, Long SMA=118, Sharpe=0.3756, Trades=67
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 212, Long SMA: 214
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(44/110) - Original Sharpe: 0.3944, Trades: 28
[INFO] Hierarchical cluster 2: SMA(156/206) - Original Sharpe: 0.3760, Trades: 25
[INFO] Hierarchical cluster 3: SMA(114/118) - Original Sharpe: 0.3756, Trades: 67
[INFO] Hierarchical cluster 4: SMA(22/26) - Original Sharpe: 0.3610, Trades: 164
[INFO] Hierarchical cluster 5: SMA(198/274) - Original Sharpe: 0.2383, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (212/214)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (44/110) - Sharpe: 0.3944
[INFO] cluster 2: (156/206) - Sharpe: 0.3760
[INFO] cluster 3: (114/118) - Sharpe: 0.3756
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.243014            3.490743
1    2021-11-10 2021-11-10            41    -1.727839           -0.795208
2    2022-01-10 2022-01-10            41    -1.491477           -2.731299
3    2022-03-10 2022-03-10            42    -2.601234            0.737268
4    2022-05-10 2022-05-10            41     0.452239            0.452239
5    2022-07-10 2022-07-10            44    -0.869854           -2.085288
6    2022-09-10 2022-09-10            43     2.218651            1.990950
7    2022-11-10 2022-11-10            40    -1.000002           -0.264243
8    2023-01-10 2023-01-10            41    -0.351051            3.921839
9    2023-03-10 2023-03-10            42     1.488556            1.108271
10   2023-05-10 2023-05-10            40    -0.521278            2.919350
11   2023-07-10 2023-07-10            44     2.056252            2.056252
12   2023-09-10 2023-09-10            44    -4.792962           -3.784998
13   2023-11-10 2023-11-10            40    -0.611143           -2.294150
14   2024-01-10 2024-01-10            41     4.588013           -4.755814
15   2024-03-10 2024-03-10            43    -2.405032            0.431485
16   2024-05-10 2024-05-10            40    -0.870401            1.364240
17   2024-07-10 2024-07-10            43     2.708529            2.140633
18   2024-09-10 2024-09-10            44     0.264177            1.010761
19   2024-11-10 2024-11-10            35     3.696891           -6.450101
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.2 |              3.5 |          3.7 | True          
[INFO] 2021-11-10   |         -1.7 |             -0.8 |          0.9 | True          
[INFO] 2022-01-10   |         -1.5 |             -2.7 |         -1.2 | False         
[INFO] 2022-03-10   |         -2.6 |              0.7 |          3.3 | True          
[INFO] 2022-05-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.9 |             -2.1 |         -1.2 | False         
[INFO] 2022-09-10   |          2.2 |              2.0 |         -0.2 | False         
[INFO] 2022-11-10   |         -1.0 |             -0.3 |          0.7 | True          
[INFO] 2023-01-10   |         -0.4 |              3.9 |          4.3 | True          
[INFO] 2023-03-10   |          1.5 |              1.1 |         -0.4 | False         
[INFO] 2023-05-10   |         -0.5 |              2.9 |          3.4 | True          
[INFO] 2023-07-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -4.8 |             -3.8 |          1.0 | True          
[INFO] 2023-11-10   |         -0.6 |             -2.3 |         -1.7 | False         
[INFO] 2024-01-10   |          4.6 |             -4.8 |         -9.4 | False         
[INFO] 2024-03-10   |         -2.4 |              0.4 |          2.8 | True          
[INFO] 2024-05-10   |         -0.9 |              1.4 |          2.3 | True          
[INFO] 2024-07-10   |          2.7 |              2.1 |         -0.6 | False         
[INFO] 2024-09-10   |          0.3 |              1.0 |          0.7 | True          
[INFO] 2024-11-10   |          3.7 |             -6.5 |        -10.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-10, 2023-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 18 periods (55.56% win rate)
[INFO] Updating Excel file with Hierarchical results for FC...
[INFO] Excel file updated successfully. Added FC with Hierarchical win rate 55.6% in row 15
[INFO] Added best Sharpe parameters 212/214 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 212, Long SMA: 214
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(44/110) - Original Sharpe: 0.3944
[INFO] Added cluster 2 to portfolio: SMA(156/206) - Original Sharpe: 0.3760
[INFO] Added cluster 3 to portfolio: SMA(114/118) - Original Sharpe: 0.3756
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1107
[INFO] Hierarchical Best out-of-sample Sharpe: -0.2095
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FC...
[INFO] Excel file updated successfully. Added FC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FC
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FDAX in column D: 27.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 300.44s
[INFO] Best parameters: Short SMA = 160, Long SMA = 262
[INFO] Best Sharpe ratio: 0.607501, Trades: 11
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_FDAX_best_160/262 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FDAX
[INFO] Big Point Value (from data): 25.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 1.84 contracts
[INFO] Maximum Position Size: 3 contracts
[INFO] Strategy Total P&L: $341,785.00
[INFO] Market Buy & Hold P&L: $221,350.00
[INFO] Outperformance: $120,435.00
[INFO] Sharpe ratio (entire period, annualized): 0.414119
[INFO] Sharpe ratio (in-sample, annualized): 0.607501
[INFO] Sharpe ratio (out-of-sample, annualized): -0.028574
[INFO] Maximum Drawdown: $183,656.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 7
[INFO] Out-of-sample period trades: 4
[INFO] Total trades: 11
[INFO] In-sample P&L: $450,899.00
[INFO] Out-of-sample P&L: $-9,264.00
[INFO] 
Best parameters from GA: Short SMA = 160, Long SMA = 262, Sharpe = 0.607501
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 25.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9414 to 0.6075
[INFO] 
Best parameters:
[INFO] Short SMA: 160
[INFO] Long SMA: 262
[INFO] Sharpe Ratio: 0.607501
[INFO] Number of Trades: 11
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10240 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9414 to 0.6075
[INFO] Trades range: 10.0 to 339.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3672 to 2.8326
[INFO] Scaled Long SMA range: -2.7807 to 1.4497
[INFO] Scaled Sharpe ratio range: -4.1879 to 3.3270
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 679 elements
[INFO] Kmeans Cluster 1: 737 elements
[INFO] Kmeans Cluster 2: 609 elements
[INFO] Kmeans Cluster 3: 879 elements
[INFO] Kmeans Cluster 4: 562 elements
[INFO] Kmeans Cluster 5: 582 elements
[INFO] Kmeans Cluster 6: 919 elements
[INFO] Kmeans Cluster 7: 867 elements
[INFO] Kmeans Cluster 8: 298 elements
[INFO] Kmeans Cluster 9: 431 elements
[INFO] Kmeans Cluster 10: 783 elements
[INFO] Kmeans Cluster 11: 916 elements
[INFO] Kmeans Cluster 12: 338 elements
[INFO] Kmeans Cluster 13: 694 elements
[INFO] Kmeans Cluster 14: 387 elements
[INFO] Kmeans Cluster 15: 559 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=114.63, Long SMA=221.69, Sharpe=-0.0214
[INFO] Centroid 1: Short SMA=43.51, Long SMA=94.09, Sharpe=-0.1982
[INFO] Centroid 2: Short SMA=176.29, Long SMA=240.51, Sharpe=0.4005
[INFO] Centroid 3: Short SMA=223.66, Long SMA=267.98, Sharpe=-0.0364
[INFO] Centroid 4: Short SMA=24.98, Long SMA=265.96, Sharpe=-0.3061
[INFO] Centroid 5: Short SMA=26.82, Long SMA=152.79, Sharpe=-0.2562
[INFO] Centroid 6: Short SMA=66.75, Long SMA=260.38, Sharpe=-0.1562
[INFO] Centroid 7: Short SMA=93.51, Long SMA=162.59, Sharpe=-0.1920
[INFO] Centroid 8: Short SMA=266.22, Long SMA=286.58, Sharpe=-0.4064
[INFO] Centroid 9: Short SMA=80.60, Long SMA=129.12, Sharpe=0.0207
[INFO] Centroid 10: Short SMA=120.46, Long SMA=275.32, Sharpe=0.1432
[INFO] Centroid 11: Short SMA=45.92, Long SMA=203.29, Sharpe=-0.1205
[INFO] Centroid 12: Short SMA=60.33, Long SMA=90.14, Sharpe=-0.4528
[INFO] Centroid 13: Short SMA=142.78, Long SMA=174.75, Sharpe=-0.0905
[INFO] Centroid 14: Short SMA=24.44, Long SMA=56.74, Sharpe=0.0551
[INFO] Centroid 15: Short SMA=173.70, Long SMA=221.78, Sharpe=0.1506
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=160, Long SMA=262, Sharpe=0.6075, Trades=11
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=176, Long SMA=240, Sharpe=0.4758, Trades=10
[INFO] Kmeans Top 2: Short SMA=168, Long SMA=218, Sharpe=0.1553, Trades=16
[INFO] Kmeans Top 3: Short SMA=120, Long SMA=276, Sharpe=0.1483, Trades=13
[INFO] Kmeans Top 4: Short SMA=84, Long SMA=128, Sharpe=0.0682, Trades=22
[INFO] Kmeans Top 5: Short SMA=224, Long SMA=268, Sharpe=0.0403, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (115, 222)
[INFO]   Nearest: (114.0, 222.0)
[INFO]   Rounded: (44, 94)
[INFO]   Rounded: (176, 241)
[INFO]   Nearest: (176.0, 240.0)
[INFO]   Rounded: (224, 268)
[INFO]   Rounded: (25, 266)
[INFO]   Nearest: (24.0, 266.0)
[INFO]   Rounded: (27, 153)
[INFO]   Nearest: (26.0, 152.0)
[INFO]   Rounded: (67, 260)
[INFO]   Nearest: (66.0, 260.0)
[INFO]   Rounded: (94, 163)
[INFO]   Nearest: (94.0, 162.0)
[INFO]   Rounded: (266, 287)
[INFO]   Nearest: (266.0, 286.0)
[INFO]   Rounded: (81, 129)
[INFO]   Nearest: (80.0, 130.0)
[INFO]   Rounded: (120, 275)
[INFO]   Nearest: (120.0, 276.0)
[INFO]   Rounded: (46, 203)
[INFO]   Nearest: (46.0, 204.0)
[INFO]   Rounded: (60, 90)
[INFO]   Rounded: (143, 175)
[INFO]   Nearest: (142.0, 174.0)
[INFO]   Rounded: (24, 57)
[INFO]   Nearest: (24.0, 56.0)
[INFO]   Rounded: (174, 222)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 160, Long SMA: 262
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(176/240) - Original Sharpe: 0.4758, Trades: 10
[INFO] Kmeans cluster 2: SMA(168/218) - Original Sharpe: 0.1553, Trades: 16
[INFO] Kmeans cluster 3: SMA(120/276) - Original Sharpe: 0.1483, Trades: 13
[INFO] Kmeans cluster 4: SMA(84/128) - Original Sharpe: 0.0682, Trades: 22
[INFO] Kmeans cluster 5: SMA(224/268) - Original Sharpe: 0.0403, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2794
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (160/262)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (176/240) - Sharpe: 0.4758
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Out-of-sample period starts on: 2021-09-20
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-20 2021-09-20            45     1.874942            1.874942
1    2021-11-20 2021-11-20            41    -1.542081           -1.542081
2    2022-01-20 2022-01-20            42    -2.017855           -2.017855
3    2022-03-20 2022-03-20            42     1.424244            0.528227
4    2022-05-20 2022-05-20            43     0.980542            0.980542
5    2022-07-20 2022-07-20            44     1.402100            1.402100
6    2022-09-20 2022-09-20            44    -3.031215           -3.031215
7    2022-11-20 2022-11-20            43    -1.359366           -1.359366
8    2023-01-20 2023-01-20            41    -2.575891           -3.017874
9    2023-03-20 2023-03-20            42     4.502487            4.502487
10   2023-05-20 2023-05-20            43    -0.783470           -0.783470
11   2023-07-20 2023-07-20            44    -1.705868           -1.705868
12   2023-09-20 2023-09-20            43     0.424324            0.424324
13   2023-11-20 2023-11-20            42     2.238515            2.238515
14   2024-01-20 2024-01-20            42     1.404552           -1.877798
15   2024-03-20 2024-03-20            40     1.567381            0.235971
16   2024-05-20 2024-05-20            45    -1.796289           -1.796289
17   2024-07-20 2024-07-20            44     0.668910            0.668910
18   2024-09-20 2024-09-20            43     0.376154            0.376154
19   2024-11-20 2024-11-20            26     2.631388            2.631388
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-20   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-20   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-01-20   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-03-20   |          1.4 |              0.5 |         -0.9 | False         
[INFO] 2022-05-20   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-07-20   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-09-20   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-11-20   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2023-01-20   |         -2.6 |             -3.0 |         -0.4 | False         
[INFO] 2023-03-20   |          4.5 |              4.5 |          0.0 | Excluded      
[INFO] 2023-05-20   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-07-20   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2023-11-20   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-01-20   |          1.4 |             -1.9 |         -3.3 | False         
[INFO] 2024-03-20   |          1.6 |              0.2 |         -1.4 | False         
[INFO] 2024-05-20   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 2024-07-20   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-20   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-20, 2021-11-20, 2022-01-20, 2022-05-20, 2022-07-20, 2022-09-20, 2022-11-20, 2023-03-20, 2023-05-20, 2023-07-20, 2023-09-20, 2023-11-20, 2024-05-20, 2024-07-20, 2024-09-20, 2024-11-20
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 4
[INFO] Kmeans cluster wins (rounded comparison): 0 of 4 periods (0.00% win rate)
[INFO] Updating Excel file with Kmeans results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Kmeans win rate 0.0% in row 16
[INFO] Added best Sharpe parameters 160/262 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 160, Long SMA: 262
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(176/240) - Original Sharpe: 0.4758
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FDAX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.2890
[INFO] Kmeans Best out-of-sample Sharpe: -0.0286
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FDAX
[INFO] Big Point Value: 25.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9414 to 0.6075
[INFO] 
Best parameters:
[INFO] Short SMA: 160
[INFO] Long SMA: 262
[INFO] Sharpe Ratio: 0.607501
[INFO] Number of Trades: 11
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10240 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9414 to 0.6075
[INFO] Trades range: 10.0 to 339.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3672 to 2.8326
[INFO] Scaled Long SMA range: -2.7807 to 1.4497
[INFO] Scaled Sharpe ratio range: -4.1879 to 3.3270
[INFO] Scaled Trades range: -0.6811 to 15.7386
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10240 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5273
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1068 elements
[INFO] Cluster 1: 308 elements
[INFO] Cluster 2: 544 elements
[INFO] Cluster 3: 626 elements
[INFO] Cluster 4: 856 elements
[INFO] Cluster 5: 1136 elements
[INFO] Cluster 6: 705 elements
[INFO] Cluster 7: 1029 elements
[INFO] Cluster 8: 452 elements
[INFO] Cluster 9: 248 elements
[INFO] Cluster 10: 1171 elements
[INFO] Cluster 11: 32 elements
[INFO] Cluster 12: 728 elements
[INFO] Cluster 13: 80 elements
[INFO] Cluster 14: 995 elements
[INFO] Cluster 15: 262 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=222, Long SMA=266, Sharpe=0.0003, Trades=15
[INFO] Cluster 1 cluster: Short SMA=172, Long SMA=180, Sharpe=-0.0124, Trades=46
[INFO] Cluster 2 cluster: Short SMA=30, Long SMA=62, Sharpe=-0.2682, Trades=58
[INFO] Cluster 3 cluster: Short SMA=74, Long SMA=138, Sharpe=-0.1319, Trades=24
[INFO] Cluster 4 cluster: Short SMA=126, Long SMA=276, Sharpe=0.1421, Trades=13
[INFO] Cluster 5 cluster: Short SMA=128, Long SMA=220, Sharpe=-0.0155, Trades=12
[INFO] Cluster 6 cluster: Short SMA=22, Long SMA=250, Sharpe=-0.3000, Trades=18
[INFO] Cluster 7 cluster: Short SMA=38, Long SMA=122, Sharpe=-0.1542, Trades=32
[INFO] Cluster 8 cluster: Short SMA=178, Long SMA=234, Sharpe=0.4827, Trades=12
[INFO] Cluster 9 cluster: Short SMA=268, Long SMA=286, Sharpe=-0.4305, Trades=21
[INFO] Cluster 10 cluster: Short SMA=62, Long SMA=194, Sharpe=-0.0502, Trades=12
[INFO] Cluster 11 cluster: Short SMA=26, Long SMA=28, Sharpe=0.0520, Trades=200
[INFO] Cluster 12 cluster: Short SMA=126, Long SMA=166, Sharpe=-0.0289, Trades=18
[INFO] Cluster 13 cluster: Short SMA=30, Long SMA=36, Sharpe=0.0546, Trades=120
[INFO] Cluster 14 cluster: Short SMA=66, Long SMA=260, Sharpe=-0.1709, Trades=15
[INFO] Cluster 15 cluster: Short SMA=64, Long SMA=94, Sharpe=-0.4644, Trades=40
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=160, Long SMA=262, Sharpe=0.6075, Trades=11
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=178, Long SMA=234, Sharpe=0.4827, Trades=12
[INFO] Top 2: Short SMA=126, Long SMA=276, Sharpe=0.1421, Trades=13
[INFO] Top 3: Short SMA=30, Long SMA=36, Sharpe=0.0546, Trades=120
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 10240 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 160, Long SMA: 262
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(178/234) - Original Sharpe: 0.4827, Trades: 12
[INFO] Hierarchical cluster 2: SMA(126/276) - Original Sharpe: 0.1421, Trades: 13
[INFO] Hierarchical cluster 3: SMA(30/36) - Original Sharpe: 0.0546, Trades: 120
[INFO] Hierarchical cluster 4: SMA(26/28) - Original Sharpe: 0.0520, Trades: 200
[INFO] Hierarchical cluster 5: SMA(222/266) - Original Sharpe: 0.0003, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2794
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (160/262)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (178/234) - Sharpe: 0.4827
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Out-of-sample period starts on: 2021-09-20
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-20 2021-09-20            45     1.874942            1.874942
1    2021-11-20 2021-11-20            41    -1.542081           -1.542081
2    2022-01-20 2022-01-20            42    -2.017855           -2.017855
3    2022-03-20 2022-03-20            42     1.424244            0.528227
4    2022-05-20 2022-05-20            43     0.980542            0.980542
5    2022-07-20 2022-07-20            44     1.402100            1.402100
6    2022-09-20 2022-09-20            44    -3.031215           -3.031215
7    2022-11-20 2022-11-20            43    -1.359366           -1.359366
8    2023-01-20 2023-01-20            41    -2.575891           -3.017874
9    2023-03-20 2023-03-20            42     4.502487            4.502487
10   2023-05-20 2023-05-20            43    -0.783470           -0.783470
11   2023-07-20 2023-07-20            44    -1.705868           -1.705868
12   2023-09-20 2023-09-20            43     0.424324            0.424324
13   2023-11-20 2023-11-20            42     2.238515            2.238515
14   2024-01-20 2024-01-20            42     1.404552           -2.492715
15   2024-03-20 2024-03-20            40     1.567381            0.636222
16   2024-05-20 2024-05-20            45    -1.796289           -1.796289
17   2024-07-20 2024-07-20            44     0.668910            0.668910
18   2024-09-20 2024-09-20            43     0.376154            0.376154
19   2024-11-20 2024-11-20            26     2.631388            2.631388
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-20   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-20   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-01-20   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-03-20   |          1.4 |              0.5 |         -0.9 | False         
[INFO] 2022-05-20   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-07-20   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-09-20   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-11-20   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2023-01-20   |         -2.6 |             -3.0 |         -0.4 | False         
[INFO] 2023-03-20   |          4.5 |              4.5 |          0.0 | Excluded      
[INFO] 2023-05-20   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-07-20   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2023-11-20   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-01-20   |          1.4 |             -2.5 |         -3.9 | False         
[INFO] 2024-03-20   |          1.6 |              0.6 |         -1.0 | False         
[INFO] 2024-05-20   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 2024-07-20   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-20   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-20, 2021-11-20, 2022-01-20, 2022-05-20, 2022-07-20, 2022-09-20, 2022-11-20, 2023-03-20, 2023-05-20, 2023-07-20, 2023-09-20, 2023-11-20, 2024-05-20, 2024-07-20, 2024-09-20, 2024-11-20
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 4
[INFO] Hierarchical cluster wins (rounded comparison): 0 of 4 periods (0.00% win rate)
[INFO] Updating Excel file with Hierarchical results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Hierarchical win rate 0.0% in row 16
[INFO] Added best Sharpe parameters 160/262 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 160, Long SMA: 262
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(178/234) - Original Sharpe: 0.4827
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FDAX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2930
[INFO] Hierarchical Best out-of-sample Sharpe: -0.0286
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FDAX
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FESX in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 254.46s
[INFO] Best parameters: Short SMA = 106, Long SMA = 108
[INFO] Best Sharpe ratio: 0.401709, Trades: 83
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_FESX_best_106/108 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FESX
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 12.10 contracts
[INFO] Maximum Position Size: 27 contracts
[INFO] Strategy Total P&L: $187,176.00
[INFO] Market Buy & Hold P&L: $27,270.00
[INFO] Outperformance: $159,906.00
[INFO] Sharpe ratio (entire period, annualized): 0.239297
[INFO] Sharpe ratio (in-sample, annualized): 0.401709
[INFO] Sharpe ratio (out-of-sample, annualized): -0.147499
[INFO] Maximum Drawdown: $198,118.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 56
[INFO] Out-of-sample period trades: 27
[INFO] Total trades: 83
[INFO] In-sample P&L: $221,772.00
[INFO] Out-of-sample P&L: $-34,192.00
[INFO] 
Best parameters from GA: Short SMA = 106, Long SMA = 108, Sharpe = 0.401709
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9619 to 0.4017
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 108
[INFO] Sharpe Ratio: 0.401709
[INFO] Number of Trades: 83
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9868 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9619 to 0.4017
[INFO] Trades range: 10.0 to 337.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3348 to 2.8905
[INFO] Scaled Long SMA range: -2.7505 to 1.4945
[INFO] Scaled Sharpe ratio range: -5.5305 to 2.9544
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 13
[INFO] Using 13 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=13...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 871 elements
[INFO] Kmeans Cluster 1: 753 elements
[INFO] Kmeans Cluster 2: 907 elements
[INFO] Kmeans Cluster 3: 862 elements
[INFO] Kmeans Cluster 4: 180 elements
[INFO] Kmeans Cluster 5: 1135 elements
[INFO] Kmeans Cluster 6: 660 elements
[INFO] Kmeans Cluster 7: 600 elements
[INFO] Kmeans Cluster 8: 807 elements
[INFO] Kmeans Cluster 9: 742 elements
[INFO] Kmeans Cluster 10: 682 elements
[INFO] Kmeans Cluster 11: 811 elements
[INFO] Kmeans Cluster 12: 858 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=229.77, Long SMA=267.13, Sharpe=-0.0412
[INFO] Centroid 1: Short SMA=57.05, Long SMA=189.52, Sharpe=-0.2421
[INFO] Centroid 2: Short SMA=107.83, Long SMA=258.22, Sharpe=0.1260
[INFO] Centroid 3: Short SMA=35.69, Long SMA=260.00, Sharpe=-0.2163
[INFO] Centroid 4: Short SMA=272.03, Long SMA=290.76, Sharpe=-0.3275
[INFO] Centroid 5: Short SMA=136.92, Long SMA=193.67, Sharpe=0.0044
[INFO] Centroid 6: Short SMA=65.98, Long SMA=107.07, Sharpe=0.0878
[INFO] Centroid 7: Short SMA=34.35, Long SMA=101.10, Sharpe=-0.3894
[INFO] Centroid 8: Short SMA=87.05, Long SMA=268.92, Sharpe=-0.0780
[INFO] Centroid 9: Short SMA=41.46, Long SMA=191.15, Sharpe=-0.0398
[INFO] Centroid 10: Short SMA=35.82, Long SMA=78.36, Sharpe=-0.1545
[INFO] Centroid 11: Short SMA=93.22, Long SMA=148.44, Sharpe=-0.1246
[INFO] Centroid 12: Short SMA=180.66, Long SMA=221.25, Sharpe=0.1138
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=108, Sharpe=0.4017, Trades=83
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=182, Long SMA=222, Sharpe=0.2353, Trades=17
[INFO] Kmeans Top 2: Short SMA=108, Long SMA=258, Sharpe=0.1268, Trades=13
[INFO] Kmeans Top 3: Short SMA=42, Long SMA=192, Sharpe=0.0697, Trades=17
[INFO] Kmeans Top 4: Short SMA=136, Long SMA=192, Sharpe=0.0647, Trades=15
[INFO] Kmeans Top 5: Short SMA=82, Long SMA=268, Sharpe=0.0340, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12}
[INFO]   Rounded: (230, 267)
[INFO]   Nearest: (230.0, 268.0)
[INFO]   Rounded: (57, 190)
[INFO]   Nearest: (58.0, 190.0)
[INFO]   Rounded: (108, 258)
[INFO]   Rounded: (36, 260)
[INFO]   Rounded: (272, 291)
[INFO]   Nearest: (272.0, 290.0)
[INFO]   Rounded: (137, 194)
[INFO]   Nearest: (136.0, 194.0)
[INFO]   Rounded: (66, 107)
[INFO]   Nearest: (66.0, 108.0)
[INFO]   Rounded: (34, 101)
[INFO]   Nearest: (34.0, 102.0)
[INFO]   Rounded: (87, 269)
[INFO]   Nearest: (88.0, 268.0)
[INFO]   Rounded: (41, 191)
[INFO]   Nearest: (42.0, 192.0)
[INFO]   Rounded: (36, 78)
[INFO]   Rounded: (93, 148)
[INFO]   Nearest: (94.0, 148.0)
[INFO]   Rounded: (181, 221)
[INFO]   Nearest: (180.0, 222.0)
[INFO] Successfully plotted 13 out of 13 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 108
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(182/222) - Original Sharpe: 0.2353, Trades: 17
[INFO] Kmeans cluster 2: SMA(108/258) - Original Sharpe: 0.1268, Trades: 13
[INFO] Kmeans cluster 3: SMA(42/192) - Original Sharpe: 0.0697, Trades: 17
[INFO] Kmeans cluster 4: SMA(136/192) - Original Sharpe: 0.0647, Trades: 15
[INFO] Kmeans cluster 5: SMA(82/268) - Original Sharpe: 0.0340, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/108)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (182/222) - Sharpe: 0.2353
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.819258            1.819258
1    2021-11-16 2021-11-16            42    -0.990182           -1.393676
2    2022-01-16 2022-01-16            42    -3.234063           -3.234063
3    2022-03-16 2022-03-16            41     1.259415           -0.156682
4    2022-05-16 2022-05-16            45     1.642319            1.642319
5    2022-07-16 2022-07-16            44     0.816637           -0.103327
6    2022-09-16 2022-09-16            43    -1.315674           -2.305190
7    2022-11-16 2022-11-16            42    -4.141997           -2.687382
8    2023-01-16 2023-01-16            43    -0.549165           -2.259325
9    2023-03-16 2023-03-16            40     2.960185            2.960185
10   2023-05-16 2023-05-16            44     0.373260            0.373260
11   2023-07-16 2023-07-16            45    -1.929853           -1.162382
12   2023-09-16 2023-09-16            43    -1.339093            0.025666
13   2023-11-16 2023-11-16            40    -1.599206            1.599206
14   2024-01-16 2024-01-16            44     7.610619            5.312809
15   2024-03-16 2024-03-16            40     1.356364            1.356364
16   2024-05-16 2024-05-16            43    -1.239630           -1.239630
17   2024-07-16 2024-07-16            44    -2.440824           -1.421227
18   2024-09-16 2024-09-16            45     0.297766           -0.309976
19   2024-11-16 2024-11-16            28    -0.195314            2.935028
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-16   |         -1.0 |             -1.4 |         -0.4 | False         
[INFO] 2022-01-16   |         -3.2 |             -3.2 |          0.0 | Excluded      
[INFO] 2022-03-16   |          1.3 |             -0.2 |         -1.5 | False         
[INFO] 2022-05-16   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2022-07-16   |          0.8 |             -0.1 |         -0.9 | False         
[INFO] 2022-09-16   |         -1.3 |             -2.3 |         -1.0 | False         
[INFO] 2022-11-16   |         -4.1 |             -2.7 |          1.4 | True          
[INFO] 2023-01-16   |         -0.5 |             -2.3 |         -1.8 | False         
[INFO] 2023-03-16   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-05-16   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2023-07-16   |         -1.9 |             -1.2 |          0.7 | True          
[INFO] 2023-09-16   |         -1.3 |              0.0 |          1.3 | True          
[INFO] 2023-11-16   |         -1.6 |              1.6 |          3.2 | True          
[INFO] 2024-01-16   |          7.6 |              5.3 |         -2.3 | False         
[INFO] 2024-03-16   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2024-05-16   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2024-07-16   |         -2.4 |             -1.4 |          1.0 | True          
[INFO] 2024-09-16   |          0.3 |             -0.3 |         -0.6 | False         
[INFO] 2024-11-16   |         -0.2 |              2.9 |          3.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-01-16, 2022-05-16, 2023-03-16, 2023-05-16, 2024-03-16, 2024-05-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 6 of 13 periods (46.15% win rate)
[INFO] Updating Excel file with Kmeans results for FESX...
[INFO] Excel file updated successfully. Added FESX with Kmeans win rate 46.2% in row 17
[INFO] Added best Sharpe parameters 106/108 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 108
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(182/222) - Original Sharpe: 0.2353
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FESX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1503
[INFO] Kmeans Best out-of-sample Sharpe: -0.1475
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FESX...
[INFO] Excel file updated successfully. Added FESX with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FESX
[INFO] Big Point Value: 10.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9619 to 0.4017
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 108
[INFO] Sharpe Ratio: 0.401709
[INFO] Number of Trades: 83
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9868 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9619 to 0.4017
[INFO] Trades range: 10.0 to 337.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3348 to 2.8905
[INFO] Scaled Long SMA range: -2.7505 to 1.4945
[INFO] Scaled Sharpe ratio range: -5.5305 to 2.9544
[INFO] Scaled Trades range: -0.6994 to 15.5517
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9868 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4669
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 309 elements
[INFO] Cluster 1: 859 elements
[INFO] Cluster 2: 1198 elements
[INFO] Cluster 3: 954 elements
[INFO] Cluster 4: 616 elements
[INFO] Cluster 5: 794 elements
[INFO] Cluster 6: 1019 elements
[INFO] Cluster 7: 1170 elements
[INFO] Cluster 8: 57 elements
[INFO] Cluster 9: 819 elements
[INFO] Cluster 10: 347 elements
[INFO] Cluster 11: 102 elements
[INFO] Cluster 12: 465 elements
[INFO] Cluster 13: 778 elements
[INFO] Cluster 14: 381 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=44, Long SMA=52, Sharpe=-0.2228, Trades=85
[INFO] Cluster 1 cluster: Short SMA=62, Long SMA=264, Sharpe=-0.1246, Trades=18
[INFO] Cluster 2 cluster: Short SMA=170, Long SMA=228, Sharpe=0.0562, Trades=15
[INFO] Cluster 3 cluster: Short SMA=232, Long SMA=270, Sharpe=-0.1150, Trades=15
[INFO] Cluster 4 cluster: Short SMA=58, Long SMA=112, Sharpe=-0.1311, Trades=30
[INFO] Cluster 5 cluster: Short SMA=38, Long SMA=182, Sharpe=-0.0169, Trades=17
[INFO] Cluster 6 cluster: Short SMA=78, Long SMA=180, Sharpe=-0.1514, Trades=15
[INFO] Cluster 7 cluster: Short SMA=130, Long SMA=182, Sharpe=0.1138, Trades=17
[INFO] Cluster 8 cluster: Short SMA=24, Long SMA=28, Sharpe=-0.5109, Trades=161
[INFO] Cluster 9 cluster: Short SMA=102, Long SMA=262, Sharpe=0.1478, Trades=14
[INFO] Cluster 10 cluster: Short SMA=26, Long SMA=124, Sharpe=-0.6861, Trades=35
[INFO] Cluster 11 cluster: Short SMA=282, Long SMA=292, Sharpe=-0.3850, Trades=21
[INFO] Cluster 12 cluster: Short SMA=64, Long SMA=104, Sharpe=0.0424, Trades=30
[INFO] Cluster 13 cluster: Short SMA=36, Long SMA=254, Sharpe=-0.2339, Trades=21
[INFO] Cluster 14 cluster: Short SMA=20, Long SMA=78, Sharpe=-0.2953, Trades=50
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=108, Sharpe=0.4017, Trades=83
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=102, Long SMA=262, Sharpe=0.1478, Trades=14
[INFO] Top 2: Short SMA=130, Long SMA=182, Sharpe=0.1138, Trades=17
[INFO] Top 3: Short SMA=170, Long SMA=228, Sharpe=0.0562, Trades=15
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 9868 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 108
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(102/262) - Original Sharpe: 0.1478, Trades: 14
[INFO] Hierarchical cluster 2: SMA(130/182) - Original Sharpe: 0.1138, Trades: 17
[INFO] Hierarchical cluster 3: SMA(170/228) - Original Sharpe: 0.0562, Trades: 15
[INFO] Hierarchical cluster 4: SMA(64/104) - Original Sharpe: 0.0424, Trades: 30
[INFO] Hierarchical cluster 5: SMA(38/182) - Original Sharpe: -0.0169, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/108)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 108
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FESX
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FGBL in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 247.23s
[INFO] Best parameters: Short SMA = 36, Long SMA = 62
[INFO] Best Sharpe ratio: 1.001266, Trades: 41
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_FGBL_best_36/62 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FGBL
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.50 contracts
[INFO] Maximum Position Size: 13 contracts
[INFO] Strategy Total P&L: $427,442.00
[INFO] Market Buy & Hold P&L: $23,030.00
[INFO] Outperformance: $404,412.00
[INFO] Sharpe ratio (entire period, annualized): 0.670529
[INFO] Sharpe ratio (in-sample, annualized): 1.001266
[INFO] Sharpe ratio (out-of-sample, annualized): -0.101266
[INFO] Maximum Drawdown: $157,502.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 28
[INFO] Out-of-sample period trades: 13
[INFO] Total trades: 41
[INFO] In-sample P&L: $532,570.00
[INFO] Out-of-sample P&L: $-23,060.00
[INFO] 
Best parameters from GA: Short SMA = 36, Long SMA = 62, Sharpe = 1.001266
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.2062 to 1.0013
[INFO] 
Best parameters:
[INFO] Short SMA: 36
[INFO] Long SMA: 62
[INFO] Sharpe Ratio: 1.001266
[INFO] Number of Trades: 41
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10508 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.2062 to 1.0013
[INFO] Trades range: 10.0 to 294.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3925 to 2.8029
[INFO] Scaled Long SMA range: -2.7982 to 1.4140
[INFO] Scaled Sharpe ratio range: -3.6757 to 3.4265
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 14
[INFO] Using 14 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=14...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 1085 elements
[INFO] Kmeans Cluster 1: 747 elements
[INFO] Kmeans Cluster 2: 494 elements
[INFO] Kmeans Cluster 3: 855 elements
[INFO] Kmeans Cluster 4: 1079 elements
[INFO] Kmeans Cluster 5: 1161 elements
[INFO] Kmeans Cluster 6: 531 elements
[INFO] Kmeans Cluster 7: 786 elements
[INFO] Kmeans Cluster 8: 780 elements
[INFO] Kmeans Cluster 9: 535 elements
[INFO] Kmeans Cluster 10: 1115 elements
[INFO] Kmeans Cluster 11: 658 elements
[INFO] Kmeans Cluster 12: 539 elements
[INFO] Kmeans Cluster 13: 143 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=54.85, Long SMA=140.96, Sharpe=0.3025
[INFO] Centroid 1: Short SMA=128.73, Long SMA=257.40, Sharpe=0.6244
[INFO] Centroid 2: Short SMA=253.98, Long SMA=280.46, Sharpe=0.4272
[INFO] Centroid 3: Short SMA=33.76, Long SMA=207.74, Sharpe=0.1257
[INFO] Centroid 4: Short SMA=87.11, Long SMA=264.39, Sharpe=0.4778
[INFO] Centroid 5: Short SMA=105.58, Long SMA=184.45, Sharpe=0.4027
[INFO] Centroid 6: Short SMA=31.40, Long SMA=83.54, Sharpe=0.6989
[INFO] Centroid 7: Short SMA=37.64, Long SMA=265.52, Sharpe=0.3554
[INFO] Centroid 8: Short SMA=153.44, Long SMA=191.84, Sharpe=0.5578
[INFO] Centroid 9: Short SMA=91.32, Long SMA=123.63, Sharpe=0.1272
[INFO] Centroid 10: Short SMA=180.92, Long SMA=246.27, Sharpe=0.4063
[INFO] Centroid 11: Short SMA=218.52, Long SMA=270.09, Sharpe=0.6013
[INFO] Centroid 12: Short SMA=36.22, Long SMA=91.65, Sharpe=0.4933
[INFO] Centroid 13: Short SMA=19.87, Long SMA=35.29, Sharpe=0.2508
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=36, Long SMA=62, Sharpe=1.0013, Trades=41
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=32, Long SMA=84, Sharpe=0.7351, Trades=35
[INFO] Kmeans Top 2: Short SMA=130, Long SMA=256, Sharpe=0.6754, Trades=13
[INFO] Kmeans Top 3: Short SMA=154, Long SMA=192, Sharpe=0.5788, Trades=15
[INFO] Kmeans Top 4: Short SMA=88, Long SMA=264, Sharpe=0.5721, Trades=17
[INFO] Kmeans Top 5: Short SMA=38, Long SMA=86, Sharpe=0.5641, Trades=31
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}
[INFO]   Rounded: (55, 141)
[INFO]   Nearest: (54.0, 140.0)
[INFO]   Rounded: (129, 257)
[INFO]   Nearest: (128.0, 258.0)
[INFO]   Rounded: (254, 280)
[INFO]   Rounded: (34, 208)
[INFO]   Rounded: (87, 264)
[INFO]   Nearest: (88.0, 264.0)
[INFO]   Rounded: (106, 184)
[INFO]   Rounded: (31, 84)
[INFO]   Nearest: (32.0, 84.0)
[INFO]   Rounded: (38, 266)
[INFO]   Rounded: (153, 192)
[INFO]   Nearest: (154.0, 192.0)
[INFO]   Rounded: (91, 124)
[INFO]   Nearest: (92.0, 124.0)
[INFO]   Rounded: (181, 246)
[INFO]   Nearest: (180.0, 246.0)
[INFO]   Rounded: (219, 270)
[INFO]   Nearest: (218.0, 270.0)
[INFO]   Rounded: (36, 92)
[INFO]   Rounded: (20, 35)
[INFO]   Nearest: (20.0, 36.0)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 36, Long SMA: 62
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(32/84) - Original Sharpe: 0.7351, Trades: 35
[INFO] Kmeans cluster 2: SMA(130/256) - Original Sharpe: 0.6754, Trades: 13
[INFO] Kmeans cluster 3: SMA(154/192) - Original Sharpe: 0.5788, Trades: 15
[INFO] Kmeans cluster 4: SMA(88/264) - Original Sharpe: 0.5721, Trades: 17
[INFO] Kmeans cluster 5: SMA(38/86) - Original Sharpe: 0.5641, Trades: 31
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (36/62)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (32/84) - Sharpe: 0.7351
[INFO] cluster 2: (130/256) - Sharpe: 0.6754
[INFO] cluster 3: (154/192) - Sharpe: 0.5788
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -1.923691            0.601267
1    2021-11-16 2021-11-16            42    -5.059052           -4.333444
2    2022-01-16 2022-01-16            42     2.440556           -0.473342
3    2022-03-16 2022-03-16            41     3.634012            3.634012
4    2022-05-16 2022-05-16            45     1.252348            1.252348
5    2022-07-16 2022-07-16            44    -7.003364            0.121073
6    2022-09-16 2022-09-16            43     0.563233            0.766386
7    2022-11-16 2022-11-16            42    -3.204331            0.767905
8    2023-01-16 2023-01-16            43     0.674222           -0.057239
9    2023-03-16 2023-03-16            40     2.331121            1.097823
10   2023-05-16 2023-05-16            44     0.759333           -0.474171
11   2023-07-16 2023-07-16            45     1.110941            1.110941
12   2023-09-16 2023-09-16            43    -0.006381           -0.006381
13   2023-11-16 2023-11-16            40     1.543347           -3.727921
14   2024-01-16 2024-01-16            44    -1.381398            1.288907
15   2024-03-16 2024-03-16            40     0.255891           -2.375102
16   2024-05-16 2024-05-16            43     0.307612           -0.307612
17   2024-07-16 2024-07-16            44     2.232450            2.713495
18   2024-09-16 2024-09-16            45    -2.889253            0.637109
19   2024-11-16 2024-11-16            28     0.360194           -6.750030
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -1.9 |              0.6 |          2.5 | True          
[INFO] 2021-11-16   |         -5.1 |             -4.3 |          0.8 | True          
[INFO] 2022-01-16   |          2.4 |             -0.5 |         -2.9 | False         
[INFO] 2022-03-16   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -7.0 |              0.1 |          7.1 | True          
[INFO] 2022-09-16   |          0.6 |              0.8 |          0.2 | True          
[INFO] 2022-11-16   |         -3.2 |              0.8 |          4.0 | True          
[INFO] 2023-01-16   |          0.7 |             -0.1 |         -0.8 | False         
[INFO] 2023-03-16   |          2.3 |              1.1 |         -1.2 | False         
[INFO] 2023-05-16   |          0.8 |             -0.5 |         -1.3 | False         
[INFO] 2023-07-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-16   |          1.5 |             -3.7 |         -5.2 | False         
[INFO] 2024-01-16   |         -1.4 |              1.3 |          2.7 | True          
[INFO] 2024-03-16   |          0.3 |             -2.4 |         -2.7 | False         
[INFO] 2024-05-16   |          0.3 |             -0.3 |         -0.6 | False         
[INFO] 2024-07-16   |          2.2 |              2.7 |          0.5 | True          
[INFO] 2024-09-16   |         -2.9 |              0.6 |          3.5 | True          
[INFO] 2024-11-16   |          0.4 |             -6.8 |         -7.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16, 2023-07-16, 2023-09-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 8 of 16 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Kmeans win rate 50.0% in row 18
[INFO] Added best Sharpe parameters 36/62 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 36, Long SMA: 62
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(32/84) - Original Sharpe: 0.7351
[INFO] Added cluster 2 to portfolio: SMA(130/256) - Original Sharpe: 0.6754
[INFO] Added cluster 3 to portfolio: SMA(154/192) - Original Sharpe: 0.5788
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBL_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0807
[INFO] Kmeans Best out-of-sample Sharpe: -0.1013
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBL
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.2062 to 1.0013
[INFO] 
Best parameters:
[INFO] Short SMA: 36
[INFO] Long SMA: 62
[INFO] Sharpe Ratio: 1.001266
[INFO] Number of Trades: 41
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10508 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.2062 to 1.0013
[INFO] Trades range: 10.0 to 294.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3925 to 2.8029
[INFO] Scaled Long SMA range: -2.7982 to 1.4140
[INFO] Scaled Sharpe ratio range: -3.6757 to 3.4265
[INFO] Scaled Trades range: -0.7803 to 14.9447
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10508 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5242
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 13
[INFO] Using 13 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 13 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1698 elements
[INFO] Cluster 1: 293 elements
[INFO] Cluster 2: 1167 elements
[INFO] Cluster 3: 925 elements
[INFO] Cluster 4: 808 elements
[INFO] Cluster 5: 198 elements
[INFO] Cluster 6: 1018 elements
[INFO] Cluster 7: 1242 elements
[INFO] Cluster 8: 978 elements
[INFO] Cluster 9: 1159 elements
[INFO] Cluster 10: 665 elements
[INFO] Cluster 11: 25 elements
[INFO] Cluster 12: 332 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=74, Long SMA=266, Sharpe=0.3773, Trades=13
[INFO] Cluster 1 cluster: Short SMA=244, Long SMA=250, Sharpe=0.3929, Trades=51
[INFO] Cluster 2 cluster: Short SMA=36, Long SMA=216, Sharpe=0.0414, Trades=21
[INFO] Cluster 3 cluster: Short SMA=228, Long SMA=276, Sharpe=0.6494, Trades=14
[INFO] Cluster 4 cluster: Short SMA=28, Long SMA=82, Sharpe=0.6245, Trades=41
[INFO] Cluster 5 cluster: Short SMA=34, Long SMA=42, Sharpe=0.3725, Trades=93
[INFO] Cluster 6 cluster: Short SMA=46, Long SMA=136, Sharpe=0.3508, Trades=19
[INFO] Cluster 7 cluster: Short SMA=102, Long SMA=182, Sharpe=0.4307, Trades=15
[INFO] Cluster 8 cluster: Short SMA=136, Long SMA=252, Sharpe=0.6571, Trades=13
[INFO] Cluster 9 cluster: Short SMA=176, Long SMA=234, Sharpe=0.4220, Trades=16
[INFO] Cluster 10 cluster: Short SMA=82, Long SMA=126, Sharpe=0.2320, Trades=26
[INFO] Cluster 11 cluster: Short SMA=26, Long SMA=28, Sharpe=0.1484, Trades=179
[INFO] Cluster 12 cluster: Short SMA=168, Long SMA=182, Sharpe=0.6099, Trades=37
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=36, Long SMA=62, Sharpe=1.0013, Trades=41
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=136, Long SMA=252, Sharpe=0.6571, Trades=13
[INFO] Top 2: Short SMA=228, Long SMA=276, Sharpe=0.6494, Trades=14
[INFO] Top 3: Short SMA=28, Long SMA=82, Sharpe=0.6245, Trades=41
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 10508 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 36, Long SMA: 62
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(136/252) - Original Sharpe: 0.6571, Trades: 13
[INFO] Hierarchical cluster 2: SMA(228/276) - Original Sharpe: 0.6494, Trades: 14
[INFO] Hierarchical cluster 3: SMA(28/82) - Original Sharpe: 0.6245, Trades: 41
[INFO] Hierarchical cluster 4: SMA(168/182) - Original Sharpe: 0.6099, Trades: 37
[INFO] Hierarchical cluster 5: SMA(102/182) - Original Sharpe: 0.4307, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (36/62)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (136/252) - Sharpe: 0.6571
[INFO] cluster 2: (228/276) - Sharpe: 0.6494
[INFO] cluster 3: (28/82) - Sharpe: 0.6245
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -1.923691           -0.018320
1    2021-11-16 2021-11-16            42    -5.059052           -3.724061
2    2022-01-16 2022-01-16            42     2.440556            0.954928
3    2022-03-16 2022-03-16            41     3.634012            3.634012
4    2022-05-16 2022-05-16            45     1.252348            1.252348
5    2022-07-16 2022-07-16            44    -7.003364            0.768348
6    2022-09-16 2022-09-16            43     0.563233            0.862288
7    2022-11-16 2022-11-16            42    -3.204331           -0.172853
8    2023-01-16 2023-01-16            43     0.674222           -0.057239
9    2023-03-16 2023-03-16            40     2.331121            0.590304
10   2023-05-16 2023-05-16            44     0.759333            0.340652
11   2023-07-16 2023-07-16            45     1.110941            1.110941
12   2023-09-16 2023-09-16            43    -0.006381           -0.006381
13   2023-11-16 2023-11-16            40     1.543347           -3.719542
14   2024-01-16 2024-01-16            44    -1.381398            1.424848
15   2024-03-16 2024-03-16            40     0.255891            0.237557
16   2024-05-16 2024-05-16            43     0.307612            0.307612
17   2024-07-16 2024-07-16            44     2.232450            2.574762
18   2024-09-16 2024-09-16            45    -2.889253           -2.889130
19   2024-11-16 2024-11-16            28     0.360194           -2.871422
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -1.9 |             -0.0 |          1.9 | True          
[INFO] 2021-11-16   |         -5.1 |             -3.7 |          1.4 | True          
[INFO] 2022-01-16   |          2.4 |              1.0 |         -1.4 | False         
[INFO] 2022-03-16   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -7.0 |              0.8 |          7.8 | True          
[INFO] 2022-09-16   |          0.6 |              0.9 |          0.3 | True          
[INFO] 2022-11-16   |         -3.2 |             -0.2 |          3.0 | True          
[INFO] 2023-01-16   |          0.7 |             -0.1 |         -0.8 | False         
[INFO] 2023-03-16   |          2.3 |              0.6 |         -1.7 | False         
[INFO] 2023-05-16   |          0.8 |              0.3 |         -0.5 | False         
[INFO] 2023-07-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-16   |          1.5 |             -3.7 |         -5.2 | False         
[INFO] 2024-01-16   |         -1.4 |              1.4 |          2.8 | True          
[INFO] 2024-03-16   |          0.3 |              0.2 |         -0.1 | False         
[INFO] 2024-05-16   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-16   |          2.2 |              2.6 |          0.4 | True          
[INFO] 2024-09-16   |         -2.9 |             -2.9 |          0.0 | Excluded      
[INFO] 2024-11-16   |          0.4 |             -2.9 |         -3.3 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16, 2023-07-16, 2023-09-16, 2024-05-16, 2024-09-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 14 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Hierarchical win rate 50.0% in row 18
[INFO] Added best Sharpe parameters 36/62 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 36, Long SMA: 62
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(136/252) - Original Sharpe: 0.6571
[INFO] Added cluster 2 to portfolio: SMA(228/276) - Original Sharpe: 0.6494
[INFO] Added cluster 3 to portfolio: SMA(28/82) - Original Sharpe: 0.6245
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBL_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2906
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1013
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBL
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FGBM in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 251.58s
[INFO] Best parameters: Short SMA = 222, Long SMA = 234
[INFO] Best Sharpe ratio: 1.126980, Trades: 33
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_FGBM_best_222/234 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FGBM
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 22.84 contracts
[INFO] Maximum Position Size: 41 contracts
[INFO] Strategy Total P&L: $669,998.00
[INFO] Market Buy & Hold P&L: $3,260.00
[INFO] Outperformance: $666,738.00
[INFO] Sharpe ratio (entire period, annualized): 1.001723
[INFO] Sharpe ratio (in-sample, annualized): 1.126980
[INFO] Sharpe ratio (out-of-sample, annualized): 0.717761
[INFO] Maximum Drawdown: $90,124.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 21
[INFO] Out-of-sample period trades: 12
[INFO] Total trades: 33
[INFO] In-sample P&L: $582,388.00
[INFO] Out-of-sample P&L: $163,678.00
[INFO] 
Best parameters from GA: Short SMA = 222, Long SMA = 234, Sharpe = 1.126980
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] 
Best parameters:
[INFO] Short SMA: 222
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.126980
[INFO] Number of Trades: 33
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10257 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3726 to 2.8264
[INFO] Scaled Long SMA range: -2.7886 to 1.4556
[INFO] Scaled Sharpe ratio range: -4.6012 to 3.8231
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 809 elements
[INFO] Kmeans Cluster 1: 578 elements
[INFO] Kmeans Cluster 2: 544 elements
[INFO] Kmeans Cluster 3: 387 elements
[INFO] Kmeans Cluster 4: 796 elements
[INFO] Kmeans Cluster 5: 549 elements
[INFO] Kmeans Cluster 6: 770 elements
[INFO] Kmeans Cluster 7: 417 elements
[INFO] Kmeans Cluster 8: 265 elements
[INFO] Kmeans Cluster 9: 549 elements
[INFO] Kmeans Cluster 10: 768 elements
[INFO] Kmeans Cluster 11: 631 elements
[INFO] Kmeans Cluster 12: 660 elements
[INFO] Kmeans Cluster 13: 672 elements
[INFO] Kmeans Cluster 14: 399 elements
[INFO] Kmeans Cluster 15: 692 elements
[INFO] Kmeans Cluster 16: 771 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=151.07, Long SMA=190.07, Sharpe=0.4692
[INFO] Centroid 1: Short SMA=34.12, Long SMA=138.47, Sharpe=0.3299
[INFO] Centroid 2: Short SMA=25.03, Long SMA=251.64, Sharpe=0.4298
[INFO] Centroid 3: Short SMA=36.60, Long SMA=60.19, Sharpe=0.2408
[INFO] Centroid 4: Short SMA=77.60, Long SMA=130.36, Sharpe=0.1354
[INFO] Centroid 5: Short SMA=250.72, Long SMA=282.25, Sharpe=0.3921
[INFO] Centroid 6: Short SMA=118.24, Long SMA=276.09, Sharpe=0.4379
[INFO] Centroid 7: Short SMA=203.59, Long SMA=236.35, Sharpe=0.8353
[INFO] Centroid 8: Short SMA=86.68, Long SMA=112.51, Sharpe=-0.1030
[INFO] Centroid 9: Short SMA=217.60, Long SMA=268.23, Sharpe=0.6423
[INFO] Centroid 10: Short SMA=84.52, Long SMA=216.55, Sharpe=0.4245
[INFO] Centroid 11: Short SMA=33.60, Long SMA=80.43, Sharpe=0.4722
[INFO] Centroid 12: Short SMA=167.29, Long SMA=238.70, Sharpe=0.6220
[INFO] Centroid 13: Short SMA=112.32, Long SMA=173.31, Sharpe=0.3015
[INFO] Centroid 14: Short SMA=102.44, Long SMA=247.80, Sharpe=0.5769
[INFO] Centroid 15: Short SMA=52.25, Long SMA=270.69, Sharpe=0.2896
[INFO] Centroid 16: Short SMA=41.15, Long SMA=189.09, Sharpe=0.2681
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=222, Long SMA=234, Sharpe=1.1270, Trades=33
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=204, Long SMA=236, Sharpe=0.8825, Trades=25
[INFO] Kmeans Top 2: Short SMA=214, Long SMA=268, Sharpe=0.7057, Trades=16
[INFO] Kmeans Top 3: Short SMA=168, Long SMA=240, Sharpe=0.6188, Trades=12
[INFO] Kmeans Top 4: Short SMA=100, Long SMA=250, Sharpe=0.5679, Trades=13
[INFO] Kmeans Top 5: Short SMA=152, Long SMA=190, Sharpe=0.4516, Trades=17
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (151, 190)
[INFO]   Nearest: (152.0, 190.0)
[INFO]   Rounded: (34, 138)
[INFO]   Rounded: (25, 252)
[INFO]   Nearest: (26.0, 252.0)
[INFO]   Rounded: (37, 60)
[INFO]   Nearest: (36.0, 60.0)
[INFO]   Rounded: (78, 130)
[INFO]   Rounded: (251, 282)
[INFO]   Nearest: (250.0, 282.0)
[INFO]   Rounded: (118, 276)
[INFO]   Rounded: (204, 236)
[INFO]   Rounded: (87, 113)
[INFO]   Nearest: (86.0, 112.0)
[INFO]   Rounded: (218, 268)
[INFO]   Rounded: (85, 217)
[INFO]   Nearest: (84.0, 216.0)
[INFO]   Rounded: (34, 80)
[INFO]   Rounded: (167, 239)
[INFO]   Nearest: (168.0, 238.0)
[INFO]   Rounded: (112, 173)
[INFO]   Nearest: (112.0, 174.0)
[INFO]   Rounded: (102, 248)
[INFO]   Rounded: (52, 271)
[INFO]   Nearest: (52.0, 270.0)
[INFO]   Rounded: (41, 189)
[INFO]   Nearest: (42.0, 190.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 222, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(204/236) - Original Sharpe: 0.8825, Trades: 25
[INFO] Kmeans cluster 2: SMA(214/268) - Original Sharpe: 0.7057, Trades: 16
[INFO] Kmeans cluster 3: SMA(168/240) - Original Sharpe: 0.6188, Trades: 12
[INFO] Kmeans cluster 4: SMA(100/250) - Original Sharpe: 0.5679, Trades: 13
[INFO] Kmeans cluster 5: SMA(152/190) - Original Sharpe: 0.4516, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (222/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (204/236) - Sharpe: 0.8825
[INFO] cluster 2: (214/268) - Sharpe: 0.7057
[INFO] cluster 3: (168/240) - Sharpe: 0.6188
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.487748            1.487748
1    2021-11-16 2021-11-16            42     1.336541           -0.268995
2    2022-01-16 2022-01-16            42     0.385142           -0.429066
3    2022-03-16 2022-03-16            41     2.717615            2.717615
4    2022-05-16 2022-05-16            45     1.180567            1.180567
5    2022-07-16 2022-07-16            44     3.343289            3.343289
6    2022-09-16 2022-09-16            43     1.239321            1.239321
7    2022-11-16 2022-11-16            42     0.648774            0.648774
8    2023-01-16 2023-01-16            43     0.128552            0.128552
9    2023-03-16 2023-03-16            40    -0.229572           -0.229572
10   2023-05-16 2023-05-16            44     2.110030            2.110030
11   2023-07-16 2023-07-16            45     0.849981            0.849981
12   2023-09-16 2023-09-16            43    -0.445153           -0.445153
13   2023-11-16 2023-11-16            40    -3.244508           -2.400116
14   2024-01-16 2024-01-16            44     3.758682            2.919459
15   2024-03-16 2024-03-16            40     0.479300            0.919407
16   2024-05-16 2024-05-16            43    -0.511733            1.593191
17   2024-07-16 2024-07-16            44    -0.791530            2.495984
18   2024-09-16 2024-09-16            45     0.783900            1.572348
19   2024-11-16 2024-11-16            28    -0.078821           -0.078821
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2021-11-16   |          1.3 |             -0.3 |         -1.6 | False         
[INFO] 2022-01-16   |          0.4 |             -0.4 |         -0.8 | False         
[INFO] 2022-03-16   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-16   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2022-09-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-11-16   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-01-16   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-03-16   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-05-16   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-07-16   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-11-16   |         -3.2 |             -2.4 |          0.8 | True          
[INFO] 2024-01-16   |          3.8 |              2.9 |         -0.9 | False         
[INFO] 2024-03-16   |          0.5 |              0.9 |          0.4 | True          
[INFO] 2024-05-16   |         -0.5 |              1.6 |          2.1 | True          
[INFO] 2024-07-16   |         -0.8 |              2.5 |          3.3 | True          
[INFO] 2024-09-16   |          0.8 |              1.6 |          0.8 | True          
[INFO] 2024-11-16   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-03-16, 2022-05-16, 2022-07-16, 2022-09-16, 2022-11-16, 2023-01-16, 2023-03-16, 2023-05-16, 2023-07-16, 2023-09-16, 2024-11-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Kmeans cluster wins (rounded comparison): 5 of 8 periods (62.50% win rate)
[INFO] Updating Excel file with Kmeans results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Kmeans win rate 62.5% in row 19
[INFO] Added best Sharpe parameters 222/234 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 222, Long SMA: 234
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(204/236) - Original Sharpe: 0.8825
[INFO] Added cluster 2 to portfolio: SMA(214/268) - Original Sharpe: 0.7057
[INFO] Added cluster 3 to portfolio: SMA(168/240) - Original Sharpe: 0.6188
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBM_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.8589
[INFO] Kmeans Best out-of-sample Sharpe: 0.7178
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBM
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] 
Best parameters:
[INFO] Short SMA: 222
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.126980
[INFO] Number of Trades: 33
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10257 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3726 to 2.8264
[INFO] Scaled Long SMA range: -2.7886 to 1.4556
[INFO] Scaled Sharpe ratio range: -4.6012 to 3.8231
[INFO] Scaled Trades range: -0.7504 to 15.6375
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10257 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5627
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1758 elements
[INFO] Cluster 1: 278 elements
[INFO] Cluster 2: 1162 elements
[INFO] Cluster 3: 1245 elements
[INFO] Cluster 4: 1072 elements
[INFO] Cluster 5: 442 elements
[INFO] Cluster 6: 21 elements
[INFO] Cluster 7: 1234 elements
[INFO] Cluster 8: 373 elements
[INFO] Cluster 9: 258 elements
[INFO] Cluster 10: 914 elements
[INFO] Cluster 11: 218 elements
[INFO] Cluster 12: 898 elements
[INFO] Cluster 13: 307 elements
[INFO] Cluster 14: 77 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=102, Long SMA=252, Sharpe=0.5666, Trades=13
[INFO] Cluster 1 cluster: Short SMA=170, Long SMA=178, Sharpe=0.4352, Trades=51
[INFO] Cluster 2 cluster: Short SMA=40, Long SMA=264, Sharpe=0.3752, Trades=19
[INFO] Cluster 3 cluster: Short SMA=178, Long SMA=254, Sharpe=0.6205, Trades=13
[INFO] Cluster 4 cluster: Short SMA=32, Long SMA=90, Sharpe=0.4920, Trades=35
[INFO] Cluster 5 cluster: Short SMA=246, Long SMA=262, Sharpe=0.5293, Trades=30
[INFO] Cluster 6 cluster: Short SMA=22, Long SMA=24, Sharpe=-0.0539, Trades=191
[INFO] Cluster 7 cluster: Short SMA=52, Long SMA=184, Sharpe=0.3463, Trades=16
[INFO] Cluster 8 cluster: Short SMA=86, Long SMA=118, Sharpe=-0.1486, Trades=32
[INFO] Cluster 9 cluster: Short SMA=54, Long SMA=62, Sharpe=0.4676, Trades=73
[INFO] Cluster 10 cluster: Short SMA=142, Long SMA=190, Sharpe=0.2780, Trades=21
[INFO] Cluster 11 cluster: Short SMA=206, Long SMA=230, Sharpe=1.0178, Trades=29
[INFO] Cluster 12 cluster: Short SMA=78, Long SMA=142, Sharpe=0.2311, Trades=20
[INFO] Cluster 13 cluster: Short SMA=244, Long SMA=288, Sharpe=0.2866, Trades=14
[INFO] Cluster 14 cluster: Short SMA=28, Long SMA=32, Sharpe=-0.2510, Trades=115
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=222, Long SMA=234, Sharpe=1.1270, Trades=33
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=206, Long SMA=230, Sharpe=1.0178, Trades=29
[INFO] Top 2: Short SMA=178, Long SMA=254, Sharpe=0.6205, Trades=13
[INFO] Top 3: Short SMA=102, Long SMA=252, Sharpe=0.5666, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10257 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 222, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(206/230) - Original Sharpe: 1.0178, Trades: 29
[INFO] Hierarchical cluster 2: SMA(178/254) - Original Sharpe: 0.6205, Trades: 13
[INFO] Hierarchical cluster 3: SMA(102/252) - Original Sharpe: 0.5666, Trades: 13
[INFO] Hierarchical cluster 4: SMA(246/262) - Original Sharpe: 0.5293, Trades: 30
[INFO] Hierarchical cluster 5: SMA(32/90) - Original Sharpe: 0.4920, Trades: 35
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (222/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (206/230) - Sharpe: 1.0178
[INFO] cluster 2: (178/254) - Sharpe: 0.6205
[INFO] cluster 3: (102/252) - Sharpe: 0.5666
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.487748            3.026023
1    2021-11-16 2021-11-16            42     1.336541           -0.713938
2    2022-01-16 2022-01-16            42     0.385142           -0.667267
3    2022-03-16 2022-03-16            41     2.717615            2.453804
4    2022-05-16 2022-05-16            45     1.180567            1.180567
5    2022-07-16 2022-07-16            44     3.343289            3.343289
6    2022-09-16 2022-09-16            43     1.239321            1.239321
7    2022-11-16 2022-11-16            42     0.648774            0.648774
8    2023-01-16 2023-01-16            43     0.128552            0.128552
9    2023-03-16 2023-03-16            40    -0.229572           -0.229572
10   2023-05-16 2023-05-16            44     2.110030            2.110030
11   2023-07-16 2023-07-16            45     0.849981            0.849981
12   2023-09-16 2023-09-16            43    -0.445153           -0.445153
13   2023-11-16 2023-11-16            40    -3.244508           -4.844270
14   2024-01-16 2024-01-16            44     3.758682            2.913837
15   2024-03-16 2024-03-16            40     0.479300            1.110740
16   2024-05-16 2024-05-16            43    -0.511733           -2.544027
17   2024-07-16 2024-07-16            44    -0.791530            2.335335
18   2024-09-16 2024-09-16            45     0.783900            1.992224
19   2024-11-16 2024-11-16            28    -0.078821            0.907583
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.5 |              3.0 |          1.5 | True          
[INFO] 2021-11-16   |          1.3 |             -0.7 |         -2.0 | False         
[INFO] 2022-01-16   |          0.4 |             -0.7 |         -1.1 | False         
[INFO] 2022-03-16   |          2.7 |              2.5 |         -0.2 | False         
[INFO] 2022-05-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-16   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2022-09-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-11-16   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-01-16   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-03-16   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-05-16   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-07-16   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-11-16   |         -3.2 |             -4.8 |         -1.6 | False         
[INFO] 2024-01-16   |          3.8 |              2.9 |         -0.9 | False         
[INFO] 2024-03-16   |          0.5 |              1.1 |          0.6 | True          
[INFO] 2024-05-16   |         -0.5 |             -2.5 |         -2.0 | False         
[INFO] 2024-07-16   |         -0.8 |              2.3 |          3.1 | True          
[INFO] 2024-09-16   |          0.8 |              2.0 |          1.2 | True          
[INFO] 2024-11-16   |         -0.1 |              0.9 |          1.0 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-16, 2022-07-16, 2022-09-16, 2022-11-16, 2023-01-16, 2023-03-16, 2023-05-16, 2023-07-16, 2023-09-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 11 periods (45.45% win rate)
[INFO] Updating Excel file with Hierarchical results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Hierarchical win rate 45.5% in row 19
[INFO] Added best Sharpe parameters 222/234 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 222, Long SMA: 234
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(206/230) - Original Sharpe: 1.0178
[INFO] Added cluster 2 to portfolio: SMA(178/254) - Original Sharpe: 0.6205
[INFO] Added cluster 3 to portfolio: SMA(102/252) - Original Sharpe: 0.5666
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBM_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.7214
[INFO] Hierarchical Best out-of-sample Sharpe: 0.7178
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBM
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FGBX in column D: 22.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 246.99s
[INFO] Best parameters: Short SMA = 50, Long SMA = 56
[INFO] Best Sharpe ratio: 1.001858, Trades: 82
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_FGBX_best_50/56 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FGBX=105XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.64 contracts
[INFO] Maximum Position Size: 8 contracts
[INFO] Strategy Total P&L: $350,036.00
[INFO] Market Buy & Hold P&L: $24,200.00
[INFO] Outperformance: $325,836.00
[INFO] Sharpe ratio (entire period, annualized): 0.452533
[INFO] Sharpe ratio (in-sample, annualized): 1.001858
[INFO] Sharpe ratio (out-of-sample, annualized): -0.816874
[INFO] Maximum Drawdown: $268,780.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 56
[INFO] Out-of-sample period trades: 26
[INFO] Total trades: 82
[INFO] In-sample P&L: $585,486.00
[INFO] Out-of-sample P&L: $-206,288.00
[INFO] 
Best parameters from GA: Short SMA = 50, Long SMA = 56, Sharpe = 1.001858
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3871 to 1.0019
[INFO] 
Best parameters:
[INFO] Short SMA: 50
[INFO] Long SMA: 56
[INFO] Sharpe Ratio: 1.001858
[INFO] Number of Trades: 82
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10582 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3871 to 1.0019
[INFO] Trades range: 10.0 to 301.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3994 to 2.7993
[INFO] Scaled Long SMA range: -2.7994 to 1.4003
[INFO] Scaled Sharpe ratio range: -4.8665 to 4.5092
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 742 elements
[INFO] Kmeans Cluster 1: 1077 elements
[INFO] Kmeans Cluster 2: 611 elements
[INFO] Kmeans Cluster 3: 835 elements
[INFO] Kmeans Cluster 4: 606 elements
[INFO] Kmeans Cluster 5: 650 elements
[INFO] Kmeans Cluster 6: 145 elements
[INFO] Kmeans Cluster 7: 551 elements
[INFO] Kmeans Cluster 8: 712 elements
[INFO] Kmeans Cluster 9: 444 elements
[INFO] Kmeans Cluster 10: 795 elements
[INFO] Kmeans Cluster 11: 434 elements
[INFO] Kmeans Cluster 12: 526 elements
[INFO] Kmeans Cluster 13: 966 elements
[INFO] Kmeans Cluster 14: 625 elements
[INFO] Kmeans Cluster 15: 863 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=30.19, Long SMA=208.80, Sharpe=0.3793
[INFO] Centroid 1: Short SMA=120.15, Long SMA=258.15, Sharpe=0.3409
[INFO] Centroid 2: Short SMA=40.47, Long SMA=89.73, Sharpe=0.4176
[INFO] Centroid 3: Short SMA=143.84, Long SMA=186.68, Sharpe=0.5404
[INFO] Centroid 4: Short SMA=221.34, Long SMA=262.40, Sharpe=0.0792
[INFO] Centroid 5: Short SMA=46.40, Long SMA=272.37, Sharpe=0.4017
[INFO] Centroid 6: Short SMA=28.54, Long SMA=42.00, Sharpe=0.1557
[INFO] Centroid 7: Short SMA=184.81, Long SMA=220.16, Sharpe=0.3490
[INFO] Centroid 8: Short SMA=98.13, Long SMA=157.58, Sharpe=0.3361
[INFO] Centroid 9: Short SMA=35.27, Long SMA=71.02, Sharpe=0.6441
[INFO] Centroid 10: Short SMA=86.19, Long SMA=214.87, Sharpe=0.4725
[INFO] Centroid 11: Short SMA=252.99, Long SMA=280.91, Sharpe=0.2726
[INFO] Centroid 12: Short SMA=55.82, Long SMA=275.78, Sharpe=0.2189
[INFO] Centroid 13: Short SMA=180.69, Long SMA=266.71, Sharpe=0.2152
[INFO] Centroid 14: Short SMA=81.02, Long SMA=132.51, Sharpe=0.1463
[INFO] Centroid 15: Short SMA=42.07, Long SMA=149.72, Sharpe=0.2554
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=50, Long SMA=56, Sharpe=1.0019, Trades=82
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=34, Long SMA=70, Sharpe=0.6271, Trades=44
[INFO] Kmeans Top 2: Short SMA=144, Long SMA=186, Sharpe=0.5508, Trades=15
[INFO] Kmeans Top 3: Short SMA=84, Long SMA=216, Sharpe=0.5209, Trades=13
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=210, Sharpe=0.4274, Trades=21
[INFO] Kmeans Top 5: Short SMA=120, Long SMA=258, Sharpe=0.4254, Trades=11
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (30, 209)
[INFO]   Nearest: (30.0, 208.0)
[INFO]   Rounded: (120, 258)
[INFO]   Rounded: (40, 90)
[INFO]   Rounded: (144, 187)
[INFO]   Nearest: (144.0, 186.0)
[INFO]   Rounded: (221, 262)
[INFO]   Nearest: (222.0, 262.0)
[INFO]   Rounded: (46, 272)
[INFO]   Rounded: (29, 42)
[INFO]   Nearest: (28.0, 42.0)
[INFO]   Rounded: (185, 220)
[INFO]   Nearest: (184.0, 220.0)
[INFO]   Rounded: (98, 158)
[INFO]   Rounded: (35, 71)
[INFO]   Nearest: (36.0, 72.0)
[INFO]   Rounded: (86, 215)
[INFO]   Nearest: (86.0, 214.0)
[INFO]   Rounded: (253, 281)
[INFO]   Nearest: (252.0, 280.0)
[INFO]   Rounded: (56, 276)
[INFO]   Rounded: (181, 267)
[INFO]   Nearest: (180.0, 266.0)
[INFO]   Rounded: (81, 133)
[INFO]   Nearest: (82.0, 132.0)
[INFO]   Rounded: (42, 150)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 50, Long SMA: 56
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(34/70) - Original Sharpe: 0.6271, Trades: 44
[INFO] Kmeans cluster 2: SMA(144/186) - Original Sharpe: 0.5508, Trades: 15
[INFO] Kmeans cluster 3: SMA(84/216) - Original Sharpe: 0.5209, Trades: 13
[INFO] Kmeans cluster 4: SMA(30/210) - Original Sharpe: 0.4274, Trades: 21
[INFO] Kmeans cluster 5: SMA(120/258) - Original Sharpe: 0.4254, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (50/56)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/70) - Sharpe: 0.6271
[INFO] cluster 2: (144/186) - Sharpe: 0.5508
[INFO] cluster 3: (84/216) - Sharpe: 0.5209
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -2.493074            0.236538
1    2021-11-16 2021-11-16            42    -3.189982           -1.312264
2    2022-01-16 2022-01-16            42     1.294092            2.772817
3    2022-03-16 2022-03-16            41     4.339011            4.300887
4    2022-05-16 2022-05-16            45     1.113246            1.113246
5    2022-07-16 2022-07-16            44    -3.870262           -0.334442
6    2022-09-16 2022-09-16            43    -0.767104            1.235835
7    2022-11-16 2022-11-16            42    -4.333365           -2.750398
8    2023-01-16 2023-01-16            43     2.406742           -0.523739
9    2023-03-16 2023-03-16            40     0.982602            1.972024
10   2023-05-16 2023-05-16            44    -4.191287            0.356339
11   2023-07-16 2023-07-16            45    -0.015977            0.862367
12   2023-09-16 2023-09-16            43     0.712175            0.712175
13   2023-11-16 2023-11-16            40    -3.685762           -4.653121
14   2024-01-16 2024-01-16            44    -0.038296            0.008280
15   2024-03-16 2024-03-16            40     0.200895           -0.143307
16   2024-05-16 2024-05-16            43     1.126451           -1.645449
17   2024-07-16 2024-07-16            44    -4.492154           -3.208385
18   2024-09-16 2024-09-16            45    -1.267614            0.841464
19   2024-11-16 2024-11-16            28    -1.014734           -7.196818
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -2.5 |              0.2 |          2.7 | True          
[INFO] 2021-11-16   |         -3.2 |             -1.3 |          1.9 | True          
[INFO] 2022-01-16   |          1.3 |              2.8 |          1.5 | True          
[INFO] 2022-03-16   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -3.9 |             -0.3 |          3.6 | True          
[INFO] 2022-09-16   |         -0.8 |              1.2 |          2.0 | True          
[INFO] 2022-11-16   |         -4.3 |             -2.8 |          1.5 | True          
[INFO] 2023-01-16   |          2.4 |             -0.5 |         -2.9 | False         
[INFO] 2023-03-16   |          1.0 |              2.0 |          1.0 | True          
[INFO] 2023-05-16   |         -4.2 |              0.4 |          4.6 | True          
[INFO] 2023-07-16   |         -0.0 |              0.9 |          0.9 | True          
[INFO] 2023-09-16   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-16   |         -3.7 |             -4.7 |         -1.0 | False         
[INFO] 2024-01-16   |         -0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-03-16   |          0.2 |             -0.1 |         -0.3 | False         
[INFO] 2024-05-16   |          1.1 |             -1.6 |         -2.7 | False         
[INFO] 2024-07-16   |         -4.5 |             -3.2 |          1.3 | True          
[INFO] 2024-09-16   |         -1.3 |              0.8 |          2.1 | True          
[INFO] 2024-11-16   |         -1.0 |             -7.2 |         -6.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16, 2023-09-16, 2024-01-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 11 of 16 periods (68.75% win rate)
[INFO] Updating Excel file with Kmeans results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Kmeans win rate 68.8% in row 20
[INFO] Added best Sharpe parameters 50/56 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 50, Long SMA: 56
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/70) - Original Sharpe: 0.6271
[INFO] Added cluster 2 to portfolio: SMA(144/186) - Original Sharpe: 0.5508
[INFO] Added cluster 3 to portfolio: SMA(84/216) - Original Sharpe: 0.5209
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0467
[INFO] Kmeans Best out-of-sample Sharpe: -0.8169
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBX
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3871 to 1.0019
[INFO] 
Best parameters:
[INFO] Short SMA: 50
[INFO] Long SMA: 56
[INFO] Sharpe Ratio: 1.001858
[INFO] Number of Trades: 82
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10582 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3871 to 1.0019
[INFO] Trades range: 10.0 to 301.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3994 to 2.7993
[INFO] Scaled Long SMA range: -2.7994 to 1.4003
[INFO] Scaled Sharpe ratio range: -4.8665 to 4.5092
[INFO] Scaled Trades range: -0.7931 to 14.9015
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10582 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6276
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 13
[INFO] Using 13 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 13 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1230 elements
[INFO] Cluster 1: 2146 elements
[INFO] Cluster 2: 1383 elements
[INFO] Cluster 3: 471 elements
[INFO] Cluster 4: 559 elements
[INFO] Cluster 5: 1009 elements
[INFO] Cluster 6: 1431 elements
[INFO] Cluster 7: 103 elements
[INFO] Cluster 8: 39 elements
[INFO] Cluster 9: 777 elements
[INFO] Cluster 10: 718 elements
[INFO] Cluster 11: 111 elements
[INFO] Cluster 12: 605 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=30, Long SMA=240, Sharpe=0.3913, Trades=21
[INFO] Cluster 1 cluster: Short SMA=64, Long SMA=136, Sharpe=0.2601, Trades=23
[INFO] Cluster 2 cluster: Short SMA=84, Long SMA=212, Sharpe=0.4982, Trades=13
[INFO] Cluster 3 cluster: Short SMA=184, Long SMA=198, Sharpe=0.1828, Trades=32
[INFO] Cluster 4 cluster: Short SMA=256, Long SMA=278, Sharpe=0.2620, Trades=24
[INFO] Cluster 5 cluster: Short SMA=176, Long SMA=272, Sharpe=0.1852, Trades=14
[INFO] Cluster 6 cluster: Short SMA=112, Long SMA=262, Sharpe=0.3285, Trades=15
[INFO] Cluster 7 cluster: Short SMA=46, Long SMA=52, Sharpe=0.8979, Trades=90
[INFO] Cluster 8 cluster: Short SMA=30, Long SMA=32, Sharpe=0.6229, Trades=180
[INFO] Cluster 9 cluster: Short SMA=32, Long SMA=80, Sharpe=0.5494, Trades=42
[INFO] Cluster 10 cluster: Short SMA=144, Long SMA=194, Sharpe=0.4713, Trades=17
[INFO] Cluster 11 cluster: Short SMA=24, Long SMA=34, Sharpe=0.0669, Trades=95
[INFO] Cluster 12 cluster: Short SMA=214, Long SMA=262, Sharpe=0.1846, Trades=14
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=50, Long SMA=56, Sharpe=1.0019, Trades=82
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=46, Long SMA=52, Sharpe=0.8979, Trades=90
[INFO] Top 2: Short SMA=30, Long SMA=32, Sharpe=0.6229, Trades=180
[INFO] Top 3: Short SMA=32, Long SMA=80, Sharpe=0.5494, Trades=42
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 10582 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 50, Long SMA: 56
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(46/52) - Original Sharpe: 0.8979, Trades: 90
[INFO] Hierarchical cluster 2: SMA(30/32) - Original Sharpe: 0.6229, Trades: 180
[INFO] Hierarchical cluster 3: SMA(32/80) - Original Sharpe: 0.5494, Trades: 42
[INFO] Hierarchical cluster 4: SMA(84/212) - Original Sharpe: 0.4982, Trades: 13
[INFO] Hierarchical cluster 5: SMA(144/194) - Original Sharpe: 0.4713, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (50/56)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (46/52) - Sharpe: 0.8979
[INFO] cluster 2: (30/32) - Sharpe: 0.6229
[INFO] cluster 3: (32/80) - Sharpe: 0.5494
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -2.493074           -2.812009
1    2021-11-16 2021-11-16            42    -3.189982           -2.042732
2    2022-01-16 2022-01-16            42     1.294092            0.877894
3    2022-03-16 2022-03-16            41     4.339011            4.386358
4    2022-05-16 2022-05-16            45     1.113246            1.113246
5    2022-07-16 2022-07-16            44    -3.870262           -5.604512
6    2022-09-16 2022-09-16            43    -0.767104            0.680596
7    2022-11-16 2022-11-16            42    -4.333365           -4.377924
8    2023-01-16 2023-01-16            43     2.406742            0.101682
9    2023-03-16 2023-03-16            40     0.982602            1.694273
10   2023-05-16 2023-05-16            44    -4.191287           -3.006764
11   2023-07-16 2023-07-16            45    -0.015977            0.687202
12   2023-09-16 2023-09-16            43     0.712175            0.963395
13   2023-11-16 2023-11-16            40    -3.685762           -0.141820
14   2024-01-16 2024-01-16            44    -0.038296           -1.046618
15   2024-03-16 2024-03-16            40     0.200895            1.016028
16   2024-05-16 2024-05-16            43     1.126451            1.630398
17   2024-07-16 2024-07-16            44    -4.492154           -0.113894
18   2024-09-16 2024-09-16            45    -1.267614           -1.924215
19   2024-11-16 2024-11-16            28    -1.014734           -7.759787
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -2.5 |             -2.8 |         -0.3 | False         
[INFO] 2021-11-16   |         -3.2 |             -2.0 |          1.2 | True          
[INFO] 2022-01-16   |          1.3 |              0.9 |         -0.4 | False         
[INFO] 2022-03-16   |          4.3 |              4.4 |          0.1 | True          
[INFO] 2022-05-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -3.9 |             -5.6 |         -1.7 | False         
[INFO] 2022-09-16   |         -0.8 |              0.7 |          1.5 | True          
[INFO] 2022-11-16   |         -4.3 |             -4.4 |         -0.1 | False         
[INFO] 2023-01-16   |          2.4 |              0.1 |         -2.3 | False         
[INFO] 2023-03-16   |          1.0 |              1.7 |          0.7 | True          
[INFO] 2023-05-16   |         -4.2 |             -3.0 |          1.2 | True          
[INFO] 2023-07-16   |         -0.0 |              0.7 |          0.7 | True          
[INFO] 2023-09-16   |          0.7 |              1.0 |          0.3 | True          
[INFO] 2023-11-16   |         -3.7 |             -0.1 |          3.6 | True          
[INFO] 2024-01-16   |         -0.0 |             -1.0 |         -1.0 | False         
[INFO] 2024-03-16   |          0.2 |              1.0 |          0.8 | True          
[INFO] 2024-05-16   |          1.1 |              1.6 |          0.5 | True          
[INFO] 2024-07-16   |         -4.5 |             -0.1 |          4.4 | True          
[INFO] 2024-09-16   |         -1.3 |             -1.9 |         -0.6 | False         
[INFO] 2024-11-16   |         -1.0 |             -7.8 |         -6.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 19 periods (57.89% win rate)
[INFO] Updating Excel file with Hierarchical results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Hierarchical win rate 57.9% in row 20
[INFO] Added best Sharpe parameters 50/56 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 50, Long SMA: 56
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(46/52) - Original Sharpe: 0.8979
[INFO] Added cluster 2 to portfolio: SMA(30/32) - Original Sharpe: 0.6229
[INFO] Added cluster 3 to portfolio: SMA(32/80) - Original Sharpe: 0.5494
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.4577
[INFO] Hierarchical Best out-of-sample Sharpe: -0.8169
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBX
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FV in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 265.10s
[INFO] Best parameters: Short SMA = 72, Long SMA = 80
[INFO] Best Sharpe ratio: 0.949806, Trades: 55
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_FV_best_72/80 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FV
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 19.39 contracts
[INFO] Maximum Position Size: 46 contracts
[INFO] Strategy Total P&L: $459,015.94
[INFO] Market Buy & Hold P&L: $-7,468.75
[INFO] Outperformance: $466,484.69
[INFO] Sharpe ratio (entire period, annualized): 0.704491
[INFO] Sharpe ratio (in-sample, annualized): 0.949806
[INFO] Sharpe ratio (out-of-sample, annualized): 0.150694
[INFO] Maximum Drawdown: $166,890.31
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 38
[INFO] Out-of-sample period trades: 17
[INFO] Total trades: 55
[INFO] In-sample P&L: $498,560.94
[INFO] Out-of-sample P&L: $35,012.81
[INFO] 
Best parameters from GA: Short SMA = 72, Long SMA = 80, Sharpe = 0.949806
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7879 to 0.9498
[INFO] 
Best parameters:
[INFO] Short SMA: 72
[INFO] Long SMA: 80
[INFO] Sharpe Ratio: 0.949806
[INFO] Number of Trades: 55
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7339 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7879 to 0.9498
[INFO] Trades range: 10.0 to 350.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1881 to 2.8942
[INFO] Scaled Long SMA range: -2.5863 to 1.9520
[INFO] Scaled Sharpe ratio range: -4.7689 to 3.0644
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 20
[INFO] Using 20 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=20...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 343 elements
[INFO] Kmeans Cluster 1: 452 elements
[INFO] Kmeans Cluster 2: 305 elements
[INFO] Kmeans Cluster 3: 517 elements
[INFO] Kmeans Cluster 4: 301 elements
[INFO] Kmeans Cluster 5: 90 elements
[INFO] Kmeans Cluster 6: 530 elements
[INFO] Kmeans Cluster 7: 642 elements
[INFO] Kmeans Cluster 8: 445 elements
[INFO] Kmeans Cluster 9: 226 elements
[INFO] Kmeans Cluster 10: 410 elements
[INFO] Kmeans Cluster 11: 403 elements
[INFO] Kmeans Cluster 12: 438 elements
[INFO] Kmeans Cluster 13: 190 elements
[INFO] Kmeans Cluster 14: 315 elements
[INFO] Kmeans Cluster 15: 327 elements
[INFO] Kmeans Cluster 16: 489 elements
[INFO] Kmeans Cluster 17: 213 elements
[INFO] Kmeans Cluster 18: 526 elements
[INFO] Kmeans Cluster 19: 177 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=27.22, Long SMA=77.30, Sharpe=0.2201
[INFO] Centroid 1: Short SMA=132.04, Long SMA=191.16, Sharpe=0.3567
[INFO] Centroid 2: Short SMA=263.75, Long SMA=280.47, Sharpe=0.0609
[INFO] Centroid 3: Short SMA=29.34, Long SMA=206.35, Sharpe=0.4968
[INFO] Centroid 4: Short SMA=94.74, Long SMA=117.80, Sharpe=0.0840
[INFO] Centroid 5: Short SMA=17.89, Long SMA=34.16, Sharpe=-0.3510
[INFO] Centroid 6: Short SMA=28.51, Long SMA=151.88, Sharpe=0.4909
[INFO] Centroid 7: Short SMA=189.36, Long SMA=224.40, Sharpe=0.0115
[INFO] Centroid 8: Short SMA=79.46, Long SMA=206.99, Sharpe=0.5111
[INFO] Centroid 9: Short SMA=31.65, Long SMA=283.31, Sharpe=0.2023
[INFO] Centroid 10: Short SMA=43.63, Long SMA=96.55, Sharpe=0.4378
[INFO] Centroid 11: Short SMA=67.88, Long SMA=177.61, Sharpe=0.3348
[INFO] Centroid 12: Short SMA=28.15, Long SMA=250.24, Sharpe=0.3688
[INFO] Centroid 13: Short SMA=21.68, Long SMA=53.98, Sharpe=-0.0503
[INFO] Centroid 14: Short SMA=228.11, Long SMA=248.73, Sharpe=-0.1463
[INFO] Centroid 15: Short SMA=160.03, Long SMA=202.76, Sharpe=0.1191
[INFO] Centroid 16: Short SMA=108.98, Long SMA=154.11, Sharpe=0.2188
[INFO] Centroid 17: Short SMA=137.76, Long SMA=167.65, Sharpe=0.5546
[INFO] Centroid 18: Short SMA=69.35, Long SMA=127.23, Sharpe=0.2526
[INFO] Centroid 19: Short SMA=55.25, Long SMA=82.32, Sharpe=0.6627
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=72, Long SMA=80, Sharpe=0.9498, Trades=55
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=56, Long SMA=82, Sharpe=0.7526, Trades=35
[INFO] Kmeans Top 2: Short SMA=78, Long SMA=208, Sharpe=0.5569, Trades=11
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=152, Sharpe=0.5195, Trades=23
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=206, Sharpe=0.5156, Trades=20
[INFO] Kmeans Top 5: Short SMA=140, Long SMA=168, Sharpe=0.5122, Trades=23
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19}
[INFO]   Rounded: (27, 77)
[INFO]   Nearest: (28.0, 78.0)
[INFO]   Rounded: (132, 191)
[INFO]   Nearest: (132.0, 192.0)
[INFO]   Rounded: (264, 280)
[INFO]   Rounded: (29, 206)
[INFO]   Nearest: (30.0, 206.0)
[INFO]   Rounded: (95, 118)
[INFO]   Nearest: (94.0, 118.0)
[INFO]   Rounded: (18, 34)
[INFO]   Rounded: (29, 152)
[INFO]   Nearest: (28.0, 152.0)
[INFO]   Rounded: (189, 224)
[INFO]   Nearest: (190.0, 224.0)
[INFO]   Rounded: (79, 207)
[INFO]   Nearest: (80.0, 206.0)
[INFO]   Rounded: (32, 283)
[INFO]   Nearest: (32.0, 284.0)
[INFO]   Rounded: (44, 97)
[INFO]   Nearest: (44.0, 96.0)
[INFO]   Rounded: (68, 178)
[INFO]   Rounded: (28, 250)
[INFO]   Rounded: (22, 54)
[INFO]   Rounded: (228, 249)
[INFO]   Nearest: (228.0, 248.0)
[INFO]   Rounded: (160, 203)
[INFO]   Nearest: (160.0, 202.0)
[INFO]   Rounded: (109, 154)
[INFO]   Nearest: (108.0, 154.0)
[INFO]   Rounded: (138, 168)
[INFO]   Rounded: (69, 127)
[INFO]   Nearest: (70.0, 128.0)
[INFO]   Rounded: (55, 82)
[INFO]   Nearest: (56.0, 82.0)
[INFO] Successfully plotted 20 out of 20 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 72, Long SMA: 80
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(56/82) - Original Sharpe: 0.7526, Trades: 35
[INFO] Kmeans cluster 2: SMA(78/208) - Original Sharpe: 0.5569, Trades: 11
[INFO] Kmeans cluster 3: SMA(28/152) - Original Sharpe: 0.5195, Trades: 23
[INFO] Kmeans cluster 4: SMA(30/206) - Original Sharpe: 0.5156, Trades: 20
[INFO] Kmeans cluster 5: SMA(140/168) - Original Sharpe: 0.5122, Trades: 23
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (72/80)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (56/82) - Sharpe: 0.7526
[INFO] cluster 2: (78/208) - Sharpe: 0.5569
[INFO] cluster 3: (28/152) - Sharpe: 0.5195
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.048416            0.517129
1    2021-11-14 2021-11-14            43     1.455706            1.455706
2    2022-01-14 2022-01-14            41     2.700861            2.700861
3    2022-03-14 2022-03-14            44     3.784695            3.784695
4    2022-05-14 2022-05-14            43     0.729933            0.729933
5    2022-07-14 2022-07-14            44     1.065131            2.635068
6    2022-09-14 2022-09-14            43     0.232152            0.520062
7    2022-11-14 2022-11-14            43    -2.056108           -1.193408
8    2023-01-14 2023-01-14            41    -0.637807           -1.848776
9    2023-03-14 2023-03-14            44    -0.502398           -0.967842
10   2023-05-14 2023-05-14            44    -0.910839           -2.378085
11   2023-07-14 2023-07-14            44     2.935724            2.601209
12   2023-09-14 2023-09-14            43     1.603056            1.603056
13   2023-11-14 2023-11-14            42    -2.819972           -3.724186
14   2024-01-14 2024-01-14            43    -2.527000           -1.516286
15   2024-03-14 2024-03-14            42     2.399643           -1.211960
16   2024-05-14 2024-05-14            44    -2.159756           -2.159756
17   2024-07-14 2024-07-14            45     4.444693            0.783134
18   2024-09-14 2024-09-14            43    -6.223105           -5.555221
19   2024-11-14 2024-11-14            33     0.476612            0.954542
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |              0.5 |          1.5 | True          
[INFO] 2021-11-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-01-14   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |              2.6 |          1.5 | True          
[INFO] 2022-09-14   |          0.2 |              0.5 |          0.3 | True          
[INFO] 2022-11-14   |         -2.1 |             -1.2 |          0.9 | True          
[INFO] 2023-01-14   |         -0.6 |             -1.8 |         -1.2 | False         
[INFO] 2023-03-14   |         -0.5 |             -1.0 |         -0.5 | False         
[INFO] 2023-05-14   |         -0.9 |             -2.4 |         -1.5 | False         
[INFO] 2023-07-14   |          2.9 |              2.6 |         -0.3 | False         
[INFO] 2023-09-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -2.8 |             -3.7 |         -0.9 | False         
[INFO] 2024-01-14   |         -2.5 |             -1.5 |          1.0 | True          
[INFO] 2024-03-14   |          2.4 |             -1.2 |         -3.6 | False         
[INFO] 2024-05-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |          4.4 |              0.8 |         -3.6 | False         
[INFO] 2024-09-14   |         -6.2 |             -5.6 |          0.6 | True          
[INFO] 2024-11-14   |          0.5 |              1.0 |          0.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-01-14, 2022-03-14, 2022-05-14, 2023-09-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 7 of 14 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for FV...
[INFO] Excel file updated successfully. Added FV with Kmeans win rate 50.0% in row 21
[INFO] Added best Sharpe parameters 72/80 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 72, Long SMA: 80
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(56/82) - Original Sharpe: 0.7526
[INFO] Added cluster 2 to portfolio: SMA(78/208) - Original Sharpe: 0.5569
[INFO] Added cluster 3 to portfolio: SMA(28/152) - Original Sharpe: 0.5195
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FV_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0089
[INFO] Kmeans Best out-of-sample Sharpe: 0.1507
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FV...
[INFO] Excel file updated successfully. Added FV with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FV
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7879 to 0.9498
[INFO] 
Best parameters:
[INFO] Short SMA: 72
[INFO] Long SMA: 80
[INFO] Sharpe Ratio: 0.949806
[INFO] Number of Trades: 55
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7339 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7879 to 0.9498
[INFO] Trades range: 10.0 to 350.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1881 to 2.8942
[INFO] Scaled Long SMA range: -2.5863 to 1.9520
[INFO] Scaled Sharpe ratio range: -4.7689 to 3.0644
[INFO] Scaled Trades range: -0.7160 to 14.6498
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 7339 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6175
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 21
[INFO] Using 21 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 21 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 506 elements
[INFO] Cluster 1: 64 elements
[INFO] Cluster 2: 922 elements
[INFO] Cluster 3: 279 elements
[INFO] Cluster 4: 263 elements
[INFO] Cluster 5: 303 elements
[INFO] Cluster 6: 518 elements
[INFO] Cluster 7: 520 elements
[INFO] Cluster 8: 167 elements
[INFO] Cluster 9: 732 elements
[INFO] Cluster 10: 22 elements
[INFO] Cluster 11: 324 elements
[INFO] Cluster 12: 622 elements
[INFO] Cluster 13: 271 elements
[INFO] Cluster 14: 49 elements
[INFO] Cluster 15: 141 elements
[INFO] Cluster 16: 100 elements
[INFO] Cluster 17: 498 elements
[INFO] Cluster 18: 328 elements
[INFO] Cluster 19: 406 elements
[INFO] Cluster 20: 304 elements
[INFO] Using 21 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=28, Long SMA=80, Sharpe=0.1770, Trades=43
[INFO] Cluster 1 cluster: Short SMA=20, Long SMA=28, Sharpe=-0.4579, Trades=126
[INFO] Cluster 2 cluster: Short SMA=82, Long SMA=146, Sharpe=0.1469, Trades=21
[INFO] Cluster 3 cluster: Short SMA=138, Long SMA=158, Sharpe=0.4842, Trades=27
[INFO] Cluster 4 cluster: Short SMA=54, Long SMA=82, Sharpe=0.6853, Trades=37
[INFO] Cluster 5 cluster: Short SMA=100, Long SMA=120, Sharpe=0.1293, Trades=35
[INFO] Cluster 6 cluster: Short SMA=32, Long SMA=128, Sharpe=0.5072, Trades=27
[INFO] Cluster 7 cluster: Short SMA=58, Long SMA=178, Sharpe=0.3053, Trades=17
[INFO] Cluster 8 cluster: Short SMA=16, Long SMA=48, Sharpe=-0.0103, Trades=70
[INFO] Cluster 9 cluster: Short SMA=180, Long SMA=224, Sharpe=0.0286, Trades=13
[INFO] Cluster 10 cluster: Short SMA=26, Long SMA=28, Sharpe=-0.3249, Trades=217
[INFO] Cluster 11 cluster: Short SMA=28, Long SMA=282, Sharpe=0.2345, Trades=10
[INFO] Cluster 12 cluster: Short SMA=30, Long SMA=230, Sharpe=0.5698, Trades=16
[INFO] Cluster 13 cluster: Short SMA=266, Long SMA=282, Sharpe=0.1466, Trades=12
[INFO] Cluster 14 cluster: Short SMA=94, Long SMA=96, Sharpe=0.3518, Trades=97
[INFO] Cluster 15 cluster: Short SMA=196, Long SMA=202, Sharpe=-0.1029, Trades=40
[INFO] Cluster 16 cluster: Short SMA=146, Long SMA=162, Sharpe=0.6841, Trades=31
[INFO] Cluster 17 cluster: Short SMA=84, Long SMA=208, Sharpe=0.5917, Trades=11
[INFO] Cluster 18 cluster: Short SMA=230, Long SMA=252, Sharpe=-0.1101, Trades=14
[INFO] Cluster 19 cluster: Short SMA=132, Long SMA=196, Sharpe=0.3053, Trades=15
[INFO] Cluster 20 cluster: Short SMA=28, Long SMA=174, Sharpe=0.5766, Trades=19
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=72, Long SMA=80, Sharpe=0.9498, Trades=55
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=54, Long SMA=82, Sharpe=0.6853, Trades=37
[INFO] Top 2: Short SMA=146, Long SMA=162, Sharpe=0.6841, Trades=31
[INFO] Top 3: Short SMA=84, Long SMA=208, Sharpe=0.5917, Trades=11
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 21 valid clusters with clusters
[INFO] Filtering to 7339 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 72, Long SMA: 80
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(54/82) - Original Sharpe: 0.6853, Trades: 37
[INFO] Hierarchical cluster 2: SMA(146/162) - Original Sharpe: 0.6841, Trades: 31
[INFO] Hierarchical cluster 3: SMA(84/208) - Original Sharpe: 0.5917, Trades: 11
[INFO] Hierarchical cluster 4: SMA(28/174) - Original Sharpe: 0.5766, Trades: 19
[INFO] Hierarchical cluster 5: SMA(30/230) - Original Sharpe: 0.5698, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (72/80)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (54/82) - Sharpe: 0.6853
[INFO] cluster 2: (146/162) - Sharpe: 0.6841
[INFO] cluster 3: (84/208) - Sharpe: 0.5917
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.048416            1.103726
1    2021-11-14 2021-11-14            43     1.455706            2.474631
2    2022-01-14 2022-01-14            41     2.700861            2.700861
3    2022-03-14 2022-03-14            44     3.784695            3.784695
4    2022-05-14 2022-05-14            43     0.729933            0.729933
5    2022-07-14 2022-07-14            44     1.065131            2.140031
6    2022-09-14 2022-09-14            43     0.232152            0.985801
7    2022-11-14 2022-11-14            43    -2.056108           -1.100452
8    2023-01-14 2023-01-14            41    -0.637807           -1.848776
9    2023-03-14 2023-03-14            44    -0.502398           -0.952689
10   2023-05-14 2023-05-14            44    -0.910839           -4.325111
11   2023-07-14 2023-07-14            44     2.935724            2.839927
12   2023-09-14 2023-09-14            43     1.603056            1.354237
13   2023-11-14 2023-11-14            42    -2.819972           -3.874531
14   2024-01-14 2024-01-14            43    -2.527000            1.894405
15   2024-03-14 2024-03-14            42     2.399643            0.618884
16   2024-05-14 2024-05-14            44    -2.159756           -3.118236
17   2024-07-14 2024-07-14            45     4.444693           -3.518849
18   2024-09-14 2024-09-14            43    -6.223105           -4.286841
19   2024-11-14 2024-11-14            33     0.476612           -0.954542
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |              1.1 |          2.1 | True          
[INFO] 2021-11-14   |          1.5 |              2.5 |          1.0 | True          
[INFO] 2022-01-14   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |              2.1 |          1.0 | True          
[INFO] 2022-09-14   |          0.2 |              1.0 |          0.8 | True          
[INFO] 2022-11-14   |         -2.1 |             -1.1 |          1.0 | True          
[INFO] 2023-01-14   |         -0.6 |             -1.8 |         -1.2 | False         
[INFO] 2023-03-14   |         -0.5 |             -1.0 |         -0.5 | False         
[INFO] 2023-05-14   |         -0.9 |             -4.3 |         -3.4 | False         
[INFO] 2023-07-14   |          2.9 |              2.8 |         -0.1 | False         
[INFO] 2023-09-14   |          1.6 |              1.4 |         -0.2 | False         
[INFO] 2023-11-14   |         -2.8 |             -3.9 |         -1.1 | False         
[INFO] 2024-01-14   |         -2.5 |              1.9 |          4.4 | True          
[INFO] 2024-03-14   |          2.4 |              0.6 |         -1.8 | False         
[INFO] 2024-05-14   |         -2.2 |             -3.1 |         -0.9 | False         
[INFO] 2024-07-14   |          4.4 |             -3.5 |         -7.9 | False         
[INFO] 2024-09-14   |         -6.2 |             -4.3 |          1.9 | True          
[INFO] 2024-11-14   |          0.5 |             -1.0 |         -1.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14, 2022-03-14, 2022-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 17 periods (41.18% win rate)
[INFO] Updating Excel file with Hierarchical results for FV...
[INFO] Excel file updated successfully. Added FV with Hierarchical win rate 41.2% in row 21
[INFO] Added best Sharpe parameters 72/80 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 72, Long SMA: 80
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(54/82) - Original Sharpe: 0.6853
[INFO] Added cluster 2 to portfolio: SMA(146/162) - Original Sharpe: 0.6841
[INFO] Added cluster 3 to portfolio: SMA(84/208) - Original Sharpe: 0.5917
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FV_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1614
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1507
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FV...
[INFO] Excel file updated successfully. Added FV with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FV
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for GC in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 275.82s
[INFO] Best parameters: Short SMA = 34, Long SMA = 40
[INFO] Best Sharpe ratio: 0.654126, Trades: 106
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_GC_best_34/40 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @GC
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.70 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $480,888.00
[INFO] Market Buy & Hold P&L: $96,090.00
[INFO] Outperformance: $384,798.00
[INFO] Sharpe ratio (entire period, annualized): 0.434125
[INFO] Sharpe ratio (in-sample, annualized): 0.654126
[INFO] Sharpe ratio (out-of-sample, annualized): -0.036014
[INFO] Maximum Drawdown: $135,992.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 76
[INFO] Out-of-sample period trades: 30
[INFO] Total trades: 106
[INFO] In-sample P&L: $375,178.00
[INFO] Out-of-sample P&L: $-9,644.00
[INFO] 
Best parameters from GA: Short SMA = 34, Long SMA = 40, Sharpe = 0.654126
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8556 to 0.6541
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 40
[INFO] Sharpe Ratio: 0.654126
[INFO] Number of Trades: 106
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8556 to 0.6541
[INFO] Trades range: 11.0 to 332.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.4157 to 3.6814
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 14
[INFO] Using 14 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=14...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 698 elements
[INFO] Kmeans Cluster 1: 1162 elements
[INFO] Kmeans Cluster 2: 1044 elements
[INFO] Kmeans Cluster 3: 998 elements
[INFO] Kmeans Cluster 4: 578 elements
[INFO] Kmeans Cluster 5: 383 elements
[INFO] Kmeans Cluster 6: 864 elements
[INFO] Kmeans Cluster 7: 727 elements
[INFO] Kmeans Cluster 8: 394 elements
[INFO] Kmeans Cluster 9: 947 elements
[INFO] Kmeans Cluster 10: 447 elements
[INFO] Kmeans Cluster 11: 580 elements
[INFO] Kmeans Cluster 12: 1074 elements
[INFO] Kmeans Cluster 13: 689 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=48.70, Long SMA=101.85, Sharpe=-0.5775
[INFO] Centroid 1: Short SMA=137.47, Long SMA=266.43, Sharpe=-0.2014
[INFO] Centroid 2: Short SMA=59.33, Long SMA=203.35, Sharpe=-0.0305
[INFO] Centroid 3: Short SMA=66.44, Long SMA=266.68, Sharpe=-0.0873
[INFO] Centroid 4: Short SMA=210.78, Long SMA=248.89, Sharpe=0.1165
[INFO] Centroid 5: Short SMA=260.98, Long SMA=286.20, Sharpe=-0.3427
[INFO] Centroid 6: Short SMA=204.50, Long SMA=266.65, Sharpe=-0.0888
[INFO] Centroid 7: Short SMA=38.43, Long SMA=259.06, Sharpe=-0.2928
[INFO] Centroid 8: Short SMA=26.52, Long SMA=57.57, Sharpe=0.2227
[INFO] Centroid 9: Short SMA=126.48, Long SMA=190.08, Sharpe=-0.1109
[INFO] Centroid 10: Short SMA=46.90, Long SMA=86.73, Sharpe=-0.1633
[INFO] Centroid 11: Short SMA=24.49, Long SMA=155.59, Sharpe=-0.3176
[INFO] Centroid 12: Short SMA=89.16, Long SMA=145.91, Sharpe=0.1810
[INFO] Centroid 13: Short SMA=162.92, Long SMA=202.08, Sharpe=-0.2545
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=40, Sharpe=0.6541, Trades=106
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=90, Long SMA=146, Sharpe=0.2775, Trades=19
[INFO] Kmeans Top 2: Short SMA=28, Long SMA=58, Sharpe=0.2495, Trades=50
[INFO] Kmeans Top 3: Short SMA=210, Long SMA=248, Sharpe=0.1314, Trades=19
[INFO] Kmeans Top 4: Short SMA=208, Long SMA=276, Sharpe=0.0182, Trades=15
[INFO] Kmeans Top 5: Short SMA=124, Long SMA=190, Sharpe=-0.1202, Trades=17
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}
[INFO]   Rounded: (49, 102)
[INFO]   Nearest: (48.0, 102.0)
[INFO]   Rounded: (137, 266)
[INFO]   Nearest: (138.0, 266.0)
[INFO]   Rounded: (59, 203)
[INFO]   Nearest: (60.0, 204.0)
[INFO]   Rounded: (66, 267)
[INFO]   Nearest: (66.0, 266.0)
[INFO]   Rounded: (211, 249)
[INFO]   Nearest: (210.0, 248.0)
[INFO]   Rounded: (261, 286)
[INFO]   Nearest: (260.0, 286.0)
[INFO]   Rounded: (205, 267)
[INFO]   Nearest: (204.0, 266.0)
[INFO]   Rounded: (38, 259)
[INFO]   Nearest: (38.0, 260.0)
[INFO]   Rounded: (27, 58)
[INFO]   Nearest: (26.0, 58.0)
[INFO]   Rounded: (126, 190)
[INFO]   Rounded: (47, 87)
[INFO]   Nearest: (46.0, 86.0)
[INFO]   Rounded: (24, 156)
[INFO]   Rounded: (89, 146)
[INFO]   Nearest: (90.0, 146.0)
[INFO]   Rounded: (163, 202)
[INFO]   Nearest: (162.0, 202.0)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 40
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(90/146) - Original Sharpe: 0.2775, Trades: 19
[INFO] Kmeans cluster 2: SMA(28/58) - Original Sharpe: 0.2495, Trades: 50
[INFO] Kmeans cluster 3: SMA(210/248) - Original Sharpe: 0.1314, Trades: 19
[INFO] Kmeans cluster 4: SMA(208/276) - Original Sharpe: 0.0182, Trades: 15
[INFO] Kmeans cluster 5: SMA(124/190) - Original Sharpe: -0.1202, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/40)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (90/146) - Sharpe: 0.2775
[INFO] cluster 2: (28/58) - Sharpe: 0.2495
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.475309           -2.905458
1    2021-11-14 2021-11-14            43    -2.403082           -0.784290
2    2022-01-14 2022-01-14            41     3.901083            4.362637
3    2022-03-14 2022-03-14            44     0.151957           -2.782601
4    2022-05-14 2022-05-14            43    -1.226083            0.000000
5    2022-07-14 2022-07-14            44    -0.992081            0.347667
6    2022-09-14 2022-09-14            43    -2.140694           -1.107448
7    2022-11-14 2022-11-14            43     2.716556            2.175446
8    2023-01-14 2023-01-14            41    -3.937365           -3.460921
9    2023-03-14 2023-03-14            43    -1.001656            0.375925
10   2023-05-14 2023-05-14            44    -1.986559           -1.442123
11   2023-07-14 2023-07-14            44     4.153690            4.834186
12   2023-09-14 2023-09-14            43    -0.209199           -0.325513
13   2023-11-14 2023-11-14            42     1.089419            0.088904
14   2024-01-14 2024-01-14            43    -4.104296           -1.183506
15   2024-03-14 2024-03-14            42     3.001304            3.001304
16   2024-05-14 2024-05-14            44    -0.938204           -0.494061
17   2024-07-14 2024-07-14            45     1.375742            2.806832
18   2024-09-14 2024-09-14            43    -0.392625           -0.392625
19   2024-11-14 2024-11-14            33     1.099525            1.622495
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.5 |             -2.9 |         -3.4 | False         
[INFO] 2021-11-14   |         -2.4 |             -0.8 |          1.6 | True          
[INFO] 2022-01-14   |          3.9 |              4.4 |          0.5 | True          
[INFO] 2022-03-14   |          0.2 |             -2.8 |         -3.0 | False         
[INFO] 2022-05-14   |         -1.2 |              0.0 |          1.2 | True          
[INFO] 2022-07-14   |         -1.0 |              0.3 |          1.3 | True          
[INFO] 2022-09-14   |         -2.1 |             -1.1 |          1.0 | True          
[INFO] 2022-11-14   |          2.7 |              2.2 |         -0.5 | False         
[INFO] 2023-01-14   |         -3.9 |             -3.5 |          0.4 | True          
[INFO] 2023-03-14   |         -1.0 |              0.4 |          1.4 | True          
[INFO] 2023-05-14   |         -2.0 |             -1.4 |          0.6 | True          
[INFO] 2023-07-14   |          4.2 |              4.8 |          0.6 | True          
[INFO] 2023-09-14   |         -0.2 |             -0.3 |         -0.1 | False         
[INFO] 2023-11-14   |          1.1 |              0.1 |         -1.0 | False         
[INFO] 2024-01-14   |         -4.1 |             -1.2 |          2.9 | True          
[INFO] 2024-03-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -0.9 |             -0.5 |          0.4 | True          
[INFO] 2024-07-14   |          1.4 |              2.8 |          1.4 | True          
[INFO] 2024-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |          1.1 |              1.6 |          0.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 13 of 18 periods (72.22% win rate)
[INFO] Updating Excel file with Kmeans results for GC...
[INFO] Excel file updated successfully. Added GC with Kmeans win rate 72.2% in row 22
[INFO] Added best Sharpe parameters 34/40 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 40
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(90/146) - Original Sharpe: 0.2775
[INFO] Added cluster 2 to portfolio: SMA(28/58) - Original Sharpe: 0.2495
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'GC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1683
[INFO] Kmeans Best out-of-sample Sharpe: -0.0360
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for GC...
[INFO] Excel file updated successfully. Added GC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\GC
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8556 to 0.6541
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 40
[INFO] Sharpe Ratio: 0.654126
[INFO] Number of Trades: 106
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8556 to 0.6541
[INFO] Trades range: 11.0 to 332.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.4157 to 3.6814
[INFO] Scaled Trades range: -0.7504 to 15.7636
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5600
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1223 elements
[INFO] Cluster 1: 925 elements
[INFO] Cluster 2: 1522 elements
[INFO] Cluster 3: 518 elements
[INFO] Cluster 4: 556 elements
[INFO] Cluster 5: 1394 elements
[INFO] Cluster 6: 319 elements
[INFO] Cluster 7: 390 elements
[INFO] Cluster 8: 1256 elements
[INFO] Cluster 9: 184 elements
[INFO] Cluster 10: 38 elements
[INFO] Cluster 11: 1145 elements
[INFO] Cluster 12: 367 elements
[INFO] Cluster 13: 748 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=86, Long SMA=150, Sharpe=0.2545, Trades=21
[INFO] Cluster 1 cluster: Short SMA=40, Long SMA=110, Sharpe=-0.6275, Trades=31
[INFO] Cluster 2 cluster: Short SMA=208, Long SMA=262, Sharpe=0.1122, Trades=17
[INFO] Cluster 3 cluster: Short SMA=56, Long SMA=126, Sharpe=-0.3046, Trades=27
[INFO] Cluster 4 cluster: Short SMA=160, Long SMA=182, Sharpe=-0.1507, Trades=29
[INFO] Cluster 5 cluster: Short SMA=62, Long SMA=268, Sharpe=-0.3966, Trades=15
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=64, Sharpe=0.2202, Trades=52
[INFO] Cluster 7 cluster: Short SMA=260, Long SMA=284, Sharpe=-0.4028, Trades=23
[INFO] Cluster 8 cluster: Short SMA=142, Long SMA=262, Sharpe=-0.0970, Trades=13
[INFO] Cluster 9 cluster: Short SMA=34, Long SMA=42, Sharpe=0.3663, Trades=98
[INFO] Cluster 10 cluster: Short SMA=28, Long SMA=30, Sharpe=-0.0026, Trades=192
[INFO] Cluster 11 cluster: Short SMA=64, Long SMA=210, Sharpe=-0.2315, Trades=19
[INFO] Cluster 12 cluster: Short SMA=16, Long SMA=220, Sharpe=-0.4046, Trades=33
[INFO] Cluster 13 cluster: Short SMA=126, Long SMA=204, Sharpe=-0.2346, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=40, Sharpe=0.6541, Trades=106
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=34, Long SMA=42, Sharpe=0.3663, Trades=98
[INFO] Top 2: Short SMA=86, Long SMA=150, Sharpe=0.2545, Trades=21
[INFO] Top 3: Short SMA=24, Long SMA=64, Sharpe=0.2202, Trades=52
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 40
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(34/42) - Original Sharpe: 0.3663, Trades: 98
[INFO] Hierarchical cluster 2: SMA(86/150) - Original Sharpe: 0.2545, Trades: 21
[INFO] Hierarchical cluster 3: SMA(24/64) - Original Sharpe: 0.2202, Trades: 52
[INFO] Hierarchical cluster 4: SMA(208/262) - Original Sharpe: 0.1122, Trades: 17
[INFO] Hierarchical cluster 5: SMA(28/30) - Original Sharpe: -0.0026, Trades: 192
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/40)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/42) - Sharpe: 0.3663
[INFO] cluster 2: (86/150) - Sharpe: 0.2545
[INFO] cluster 3: (24/64) - Sharpe: 0.2202
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.475309           -2.037282
1    2021-11-14 2021-11-14            43    -2.403082           -1.992351
2    2022-01-14 2022-01-14            41     3.901083            3.811462
3    2022-03-14 2022-03-14            44     0.151957           -1.816420
4    2022-05-14 2022-05-14            43    -1.226083            0.677273
5    2022-07-14 2022-07-14            44    -0.992081            0.153251
6    2022-09-14 2022-09-14            43    -2.140694           -1.501245
7    2022-11-14 2022-11-14            43     2.716556            4.034541
8    2023-01-14 2023-01-14            41    -3.937365           -4.293445
9    2023-03-14 2023-03-14            43    -1.001656            0.114612
10   2023-05-14 2023-05-14            44    -1.986559           -2.351168
11   2023-07-14 2023-07-14            44     4.153690            4.382896
12   2023-09-14 2023-09-14            43    -0.209199           -0.820127
13   2023-11-14 2023-11-14            42     1.089419            1.694509
14   2024-01-14 2024-01-14            43    -4.104296           -3.184898
15   2024-03-14 2024-03-14            42     3.001304            3.001304
16   2024-05-14 2024-05-14            44    -0.938204           -0.945229
17   2024-07-14 2024-07-14            45     1.375742            2.058325
18   2024-09-14 2024-09-14            43    -0.392625           -0.392625
19   2024-11-14 2024-11-14            33     1.099525            1.396065
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.5 |             -2.0 |         -2.5 | False         
[INFO] 2021-11-14   |         -2.4 |             -2.0 |          0.4 | True          
[INFO] 2022-01-14   |          3.9 |              3.8 |         -0.1 | False         
[INFO] 2022-03-14   |          0.2 |             -1.8 |         -2.0 | False         
[INFO] 2022-05-14   |         -1.2 |              0.7 |          1.9 | True          
[INFO] 2022-07-14   |         -1.0 |              0.2 |          1.2 | True          
[INFO] 2022-09-14   |         -2.1 |             -1.5 |          0.6 | True          
[INFO] 2022-11-14   |          2.7 |              4.0 |          1.3 | True          
[INFO] 2023-01-14   |         -3.9 |             -4.3 |         -0.4 | False         
[INFO] 2023-03-14   |         -1.0 |              0.1 |          1.1 | True          
[INFO] 2023-05-14   |         -2.0 |             -2.4 |         -0.4 | False         
[INFO] 2023-07-14   |          4.2 |              4.4 |          0.2 | True          
[INFO] 2023-09-14   |         -0.2 |             -0.8 |         -0.6 | False         
[INFO] 2023-11-14   |          1.1 |              1.7 |          0.6 | True          
[INFO] 2024-01-14   |         -4.1 |             -3.2 |          0.9 | True          
[INFO] 2024-03-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-07-14   |          1.4 |              2.1 |          0.7 | True          
[INFO] 2024-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |          1.1 |              1.4 |          0.3 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14, 2024-05-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 17 periods (64.71% win rate)
[INFO] Updating Excel file with Hierarchical results for GC...
[INFO] Excel file updated successfully. Added GC with Hierarchical win rate 64.7% in row 22
[INFO] Added best Sharpe parameters 34/40 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 40
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/42) - Original Sharpe: 0.3663
[INFO] Added cluster 2 to portfolio: SMA(86/150) - Original Sharpe: 0.2545
[INFO] Added cluster 3 to portfolio: SMA(24/64) - Original Sharpe: 0.2202
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'GC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0314
[INFO] Hierarchical Best out-of-sample Sharpe: -0.0360
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for GC...
[INFO] Excel file updated successfully. Added GC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\GC
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for HG in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 273.74s
[INFO] Best parameters: Short SMA = 202, Long SMA = 204
[INFO] Best Sharpe ratio: 0.957606, Trades: 77
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_HG_best_202/204 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @HG
[INFO] Big Point Value (from data): 25000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.53 contracts
[INFO] Maximum Position Size: 9 contracts
[INFO] Strategy Total P&L: $250,534.50
[INFO] Market Buy & Hold P&L: $900.00
[INFO] Outperformance: $249,634.50
[INFO] Sharpe ratio (entire period, annualized): 0.254714
[INFO] Sharpe ratio (in-sample, annualized): 0.957606
[INFO] Sharpe ratio (out-of-sample, annualized): -1.312122
[INFO] Maximum Drawdown: $353,420.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 55
[INFO] Out-of-sample period trades: 22
[INFO] Total trades: 77
[INFO] In-sample P&L: $522,067.00
[INFO] Out-of-sample P&L: $-320,532.50
[INFO] 
Best parameters from GA: Short SMA = 202, Long SMA = 204, Sharpe = 0.957606
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 25000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7723 to 0.9576
[INFO] 
Best parameters:
[INFO] Short SMA: 202
[INFO] Long SMA: 204
[INFO] Sharpe Ratio: 0.957606
[INFO] Number of Trades: 77
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9787 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7723 to 0.9576
[INFO] Trades range: 10.0 to 363.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3319 to 2.7995
[INFO] Scaled Long SMA range: -2.7689 to 1.5355
[INFO] Scaled Sharpe ratio range: -2.9750 to 2.2590
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 754 elements
[INFO] Kmeans Cluster 1: 668 elements
[INFO] Kmeans Cluster 2: 649 elements
[INFO] Kmeans Cluster 3: 374 elements
[INFO] Kmeans Cluster 4: 576 elements
[INFO] Kmeans Cluster 5: 779 elements
[INFO] Kmeans Cluster 6: 610 elements
[INFO] Kmeans Cluster 7: 746 elements
[INFO] Kmeans Cluster 8: 515 elements
[INFO] Kmeans Cluster 9: 639 elements
[INFO] Kmeans Cluster 10: 570 elements
[INFO] Kmeans Cluster 11: 410 elements
[INFO] Kmeans Cluster 12: 777 elements
[INFO] Kmeans Cluster 13: 693 elements
[INFO] Kmeans Cluster 14: 610 elements
[INFO] Kmeans Cluster 15: 417 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=118.41, Long SMA=174.05, Sharpe=-0.0927
[INFO] Centroid 1: Short SMA=135.92, Long SMA=244.38, Sharpe=0.5207
[INFO] Centroid 2: Short SMA=34.24, Long SMA=224.82, Sharpe=0.3093
[INFO] Centroid 3: Short SMA=32.20, Long SMA=71.48, Sharpe=0.4550
[INFO] Centroid 4: Short SMA=247.04, Long SMA=286.31, Sharpe=0.2608
[INFO] Centroid 5: Short SMA=40.85, Long SMA=276.92, Sharpe=0.3437
[INFO] Centroid 6: Short SMA=68.71, Long SMA=160.50, Sharpe=-0.3921
[INFO] Centroid 7: Short SMA=33.37, Long SMA=173.19, Sharpe=-0.0268
[INFO] Centroid 8: Short SMA=221.96, Long SMA=257.63, Sharpe=0.4975
[INFO] Centroid 9: Short SMA=90.04, Long SMA=254.25, Sharpe=0.6581
[INFO] Centroid 10: Short SMA=157.96, Long SMA=191.82, Sharpe=0.1927
[INFO] Centroid 11: Short SMA=57.16, Long SMA=87.96, Sharpe=-0.3883
[INFO] Centroid 12: Short SMA=189.71, Long SMA=239.19, Sharpe=0.6512
[INFO] Centroid 13: Short SMA=30.68, Long SMA=89.42, Sharpe=0.0716
[INFO] Centroid 14: Short SMA=96.10, Long SMA=128.69, Sharpe=-0.0352
[INFO] Centroid 15: Short SMA=92.40, Long SMA=213.11, Sharpe=0.2340
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=202, Long SMA=204, Sharpe=0.9576, Trades=77
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=188, Long SMA=238, Sharpe=0.7461, Trades=15
[INFO] Kmeans Top 2: Short SMA=90, Long SMA=254, Sharpe=0.7286, Trades=12
[INFO] Kmeans Top 3: Short SMA=136, Long SMA=242, Sharpe=0.5700, Trades=14
[INFO] Kmeans Top 4: Short SMA=222, Long SMA=258, Sharpe=0.5677, Trades=21
[INFO] Kmeans Top 5: Short SMA=34, Long SMA=224, Sharpe=0.5604, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (118, 174)
[INFO]   Rounded: (136, 244)
[INFO]   Rounded: (34, 225)
[INFO]   Nearest: (34.0, 224.0)
[INFO]   Rounded: (32, 71)
[INFO]   Nearest: (32.0, 72.0)
[INFO]   Rounded: (247, 286)
[INFO]   Nearest: (248.0, 286.0)
[INFO]   Rounded: (41, 277)
[INFO]   Nearest: (40.0, 276.0)
[INFO]   Rounded: (69, 161)
[INFO]   Nearest: (68.0, 160.0)
[INFO]   Rounded: (33, 173)
[INFO]   Nearest: (34.0, 174.0)
[INFO]   Rounded: (222, 258)
[INFO]   Rounded: (90, 254)
[INFO]   Rounded: (158, 192)
[INFO]   Rounded: (57, 88)
[INFO]   Nearest: (58.0, 88.0)
[INFO]   Rounded: (190, 239)
[INFO]   Nearest: (190.0, 240.0)
[INFO]   Rounded: (31, 89)
[INFO]   Nearest: (30.0, 90.0)
[INFO]   Rounded: (96, 129)
[INFO]   Nearest: (96.0, 128.0)
[INFO]   Rounded: (92, 213)
[INFO]   Nearest: (92.0, 214.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 202, Long SMA: 204
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(188/238) - Original Sharpe: 0.7461, Trades: 15
[INFO] Kmeans cluster 2: SMA(90/254) - Original Sharpe: 0.7286, Trades: 12
[INFO] Kmeans cluster 3: SMA(136/242) - Original Sharpe: 0.5700, Trades: 14
[INFO] Kmeans cluster 4: SMA(222/258) - Original Sharpe: 0.5677, Trades: 21
[INFO] Kmeans cluster 5: SMA(34/224) - Original Sharpe: 0.5604, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (202/204)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (188/238) - Sharpe: 0.7461
[INFO] cluster 2: (90/254) - Sharpe: 0.7286
[INFO] cluster 3: (136/242) - Sharpe: 0.5700
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.966360            0.966360
1    2021-11-14 2021-11-14            43     0.592419            0.592419
2    2022-01-14 2022-01-14            41    -1.051138            0.221630
3    2022-03-14 2022-03-14            44    -3.278609           -3.964165
4    2022-05-14 2022-05-14            43    -4.117036           -3.775670
5    2022-07-14 2022-07-14            44    -0.204524           -1.122513
6    2022-09-14 2022-09-14            43    -1.944732           -1.944732
7    2022-11-14 2022-11-14            43    -1.875063           -1.875063
8    2023-01-14 2023-01-14            41     1.193934            1.562784
9    2023-03-14 2023-03-14            43    -3.970882           -2.995813
10   2023-05-14 2023-05-14            44     1.555819            1.555819
11   2023-07-14 2023-07-14            44    -2.334756           -2.448787
12   2023-09-14 2023-09-14            43    -2.853678           -0.408483
13   2023-11-14 2023-11-14            42    -0.420702           -0.420702
14   2024-01-14 2024-01-14            43     0.886191           -2.896531
15   2024-03-14 2024-03-14            42    -0.888819            1.477394
16   2024-05-14 2024-05-14            44    -3.242588            0.187921
17   2024-07-14 2024-07-14            45    -2.418088           -2.418088
18   2024-09-14 2024-09-14            43    -0.682782           -0.682782
19   2024-11-14 2024-11-14            33    -1.722392            0.589928
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -1.1 |              0.2 |          1.3 | True          
[INFO] 2022-03-14   |         -3.3 |             -4.0 |         -0.7 | False         
[INFO] 2022-05-14   |         -4.1 |             -3.8 |          0.3 | True          
[INFO] 2022-07-14   |         -0.2 |             -1.1 |         -0.9 | False         
[INFO] 2022-09-14   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.2 |              1.6 |          0.4 | True          
[INFO] 2023-03-14   |         -4.0 |             -3.0 |          1.0 | True          
[INFO] 2023-05-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -2.3 |             -2.4 |         -0.1 | False         
[INFO] 2023-09-14   |         -2.9 |             -0.4 |          2.5 | True          
[INFO] 2023-11-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          0.9 |             -2.9 |         -3.8 | False         
[INFO] 2024-03-14   |         -0.9 |              1.5 |          2.4 | True          
[INFO] 2024-05-14   |         -3.2 |              0.2 |          3.4 | True          
[INFO] 2024-07-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.7 |              0.6 |          2.3 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-09-14, 2022-11-14, 2023-05-14, 2023-11-14, 2024-07-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 8 of 12 periods (66.67% win rate)
[INFO] Updating Excel file with Kmeans results for HG...
[INFO] Excel file updated successfully. Added HG with Kmeans win rate 66.7% in row 23
[INFO] Added best Sharpe parameters 202/204 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 202, Long SMA: 204
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(188/238) - Original Sharpe: 0.7461
[INFO] Added cluster 2 to portfolio: SMA(90/254) - Original Sharpe: 0.7286
[INFO] Added cluster 3 to portfolio: SMA(136/242) - Original Sharpe: 0.5700
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HG_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.9779
[INFO] Kmeans Best out-of-sample Sharpe: -1.3121
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for HG...
[INFO] Excel file updated successfully. Added HG with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HG
[INFO] Big Point Value: 25000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7723 to 0.9576
[INFO] 
Best parameters:
[INFO] Short SMA: 202
[INFO] Long SMA: 204
[INFO] Sharpe Ratio: 0.957606
[INFO] Number of Trades: 77
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9787 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7723 to 0.9576
[INFO] Trades range: 10.0 to 363.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3319 to 2.7995
[INFO] Scaled Long SMA range: -2.7689 to 1.5355
[INFO] Scaled Sharpe ratio range: -2.9750 to 2.2590
[INFO] Scaled Trades range: -0.8737 to 15.7098
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9787 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4944
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1838 elements
[INFO] Cluster 1: 201 elements
[INFO] Cluster 2: 545 elements
[INFO] Cluster 3: 1437 elements
[INFO] Cluster 4: 187 elements
[INFO] Cluster 5: 1056 elements
[INFO] Cluster 6: 882 elements
[INFO] Cluster 7: 627 elements
[INFO] Cluster 8: 661 elements
[INFO] Cluster 9: 681 elements
[INFO] Cluster 10: 17 elements
[INFO] Cluster 11: 425 elements
[INFO] Cluster 12: 471 elements
[INFO] Cluster 13: 759 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=90, Long SMA=164, Sharpe=0.0910, Trades=23
[INFO] Cluster 1 cluster: Short SMA=34, Long SMA=40, Sharpe=0.6767, Trades=112
[INFO] Cluster 2 cluster: Short SMA=30, Long SMA=80, Sharpe=0.2749, Trades=42
[INFO] Cluster 3 cluster: Short SMA=188, Long SMA=242, Sharpe=0.7861, Trades=17
[INFO] Cluster 4 cluster: Short SMA=200, Long SMA=202, Sharpe=0.6097, Trades=73
[INFO] Cluster 5 cluster: Short SMA=52, Long SMA=222, Sharpe=0.0955, Trades=22
[INFO] Cluster 6 cluster: Short SMA=100, Long SMA=256, Sharpe=0.7515, Trades=12
[INFO] Cluster 7 cluster: Short SMA=242, Long SMA=284, Sharpe=0.2553, Trades=15
[INFO] Cluster 8 cluster: Short SMA=22, Long SMA=158, Sharpe=0.0189, Trades=37
[INFO] Cluster 9 cluster: Short SMA=156, Long SMA=196, Sharpe=0.0797, Trades=24
[INFO] Cluster 11 cluster: Short SMA=64, Long SMA=124, Sharpe=-0.4103, Trades=31
[INFO] Cluster 12 cluster: Short SMA=60, Long SMA=86, Sharpe=-0.2581, Trades=46
[INFO] Cluster 13 cluster: Short SMA=42, Long SMA=278, Sharpe=0.2680, Trades=16
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=202, Long SMA=204, Sharpe=0.9576, Trades=77
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=188, Long SMA=242, Sharpe=0.7861, Trades=17
[INFO] Top 2: Short SMA=100, Long SMA=256, Sharpe=0.7515, Trades=12
[INFO] Top 3: Short SMA=34, Long SMA=40, Sharpe=0.6767, Trades=112
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 9770 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 202, Long SMA: 204
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(188/242) - Original Sharpe: 0.7861, Trades: 17
[INFO] Hierarchical cluster 2: SMA(100/256) - Original Sharpe: 0.7515, Trades: 12
[INFO] Hierarchical cluster 3: SMA(34/40) - Original Sharpe: 0.6767, Trades: 112
[INFO] Hierarchical cluster 4: SMA(200/202) - Original Sharpe: 0.6097, Trades: 73
[INFO] Hierarchical cluster 5: SMA(30/80) - Original Sharpe: 0.2749, Trades: 42
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (202/204)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (188/242) - Sharpe: 0.7861
[INFO] cluster 2: (100/256) - Sharpe: 0.7515
[INFO] cluster 3: (34/40) - Sharpe: 0.6767
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.966360            2.276826
1    2021-11-14 2021-11-14            43     0.592419            0.502170
2    2022-01-14 2022-01-14            41    -1.051138            0.602036
3    2022-03-14 2022-03-14            44    -3.278609           -3.909339
4    2022-05-14 2022-05-14            43    -4.117036           -3.185222
5    2022-07-14 2022-07-14            44    -0.204524           -2.337219
6    2022-09-14 2022-09-14            43    -1.944732           -2.878264
7    2022-11-14 2022-11-14            43    -1.875063           -3.532410
8    2023-01-14 2023-01-14            41     1.193934            1.156874
9    2023-03-14 2023-03-14            43    -3.970882           -1.043215
10   2023-05-14 2023-05-14            44     1.555819            2.538619
11   2023-07-14 2023-07-14            44    -2.334756            0.037859
12   2023-09-14 2023-09-14            43    -2.853678           -0.420524
13   2023-11-14 2023-11-14            42    -0.420702           -1.502303
14   2024-01-14 2024-01-14            43     0.886191           -3.576992
15   2024-03-14 2024-03-14            42    -0.888819            5.062115
16   2024-05-14 2024-05-14            44    -3.242588           -0.424624
17   2024-07-14 2024-07-14            45    -2.418088           -2.418088
18   2024-09-14 2024-09-14            43    -0.682782           -1.048989
19   2024-11-14 2024-11-14            33    -1.722392            2.007512
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              2.3 |          1.3 | True          
[INFO] 2021-11-14   |          0.6 |              0.5 |         -0.1 | False         
[INFO] 2022-01-14   |         -1.1 |              0.6 |          1.7 | True          
[INFO] 2022-03-14   |         -3.3 |             -3.9 |         -0.6 | False         
[INFO] 2022-05-14   |         -4.1 |             -3.2 |          0.9 | True          
[INFO] 2022-07-14   |         -0.2 |             -2.3 |         -2.1 | False         
[INFO] 2022-09-14   |         -1.9 |             -2.9 |         -1.0 | False         
[INFO] 2022-11-14   |         -1.9 |             -3.5 |         -1.6 | False         
[INFO] 2023-01-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -4.0 |             -1.0 |          3.0 | True          
[INFO] 2023-05-14   |          1.6 |              2.5 |          0.9 | True          
[INFO] 2023-07-14   |         -2.3 |              0.0 |          2.3 | True          
[INFO] 2023-09-14   |         -2.9 |             -0.4 |          2.5 | True          
[INFO] 2023-11-14   |         -0.4 |             -1.5 |         -1.1 | False         
[INFO] 2024-01-14   |          0.9 |             -3.6 |         -4.5 | False         
[INFO] 2024-03-14   |         -0.9 |              5.1 |          6.0 | True          
[INFO] 2024-05-14   |         -3.2 |             -0.4 |          2.8 | True          
[INFO] 2024-07-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -0.7 |             -1.0 |         -0.3 | False         
[INFO] 2024-11-14   |         -1.7 |              2.0 |          3.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-01-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 18 periods (55.56% win rate)
[INFO] Updating Excel file with Hierarchical results for HG...
[INFO] Excel file updated successfully. Added HG with Hierarchical win rate 55.6% in row 23
[INFO] Added best Sharpe parameters 202/204 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 202, Long SMA: 204
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(188/242) - Original Sharpe: 0.7861
[INFO] Added cluster 2 to portfolio: SMA(100/256) - Original Sharpe: 0.7515
[INFO] Added cluster 3 to portfolio: SMA(34/40) - Original Sharpe: 0.6767
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HG_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.6112
[INFO] Hierarchical Best out-of-sample Sharpe: -1.3121
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for HG...
[INFO] Excel file updated successfully. Added HG with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HG
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for HO in column D: 25.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 275.13s
[INFO] Best parameters: Short SMA = 22, Long SMA = 28
[INFO] Best Sharpe ratio: 0.889954, Trades: 121
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_HO_best_22/28 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @HO
[INFO] Big Point Value (from data): 42000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.17 contracts
[INFO] Maximum Position Size: 5 contracts
[INFO] Strategy Total P&L: $583,218.00
[INFO] Market Buy & Hold P&L: $86,142.00
[INFO] Outperformance: $497,076.00
[INFO] Sharpe ratio (entire period, annualized): 0.710110
[INFO] Sharpe ratio (in-sample, annualized): 0.889954
[INFO] Sharpe ratio (out-of-sample, annualized): 0.345997
[INFO] Maximum Drawdown: $227,841.80
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 80
[INFO] Out-of-sample period trades: 41
[INFO] Total trades: 121
[INFO] In-sample P&L: $523,733.40
[INFO] Out-of-sample P&L: $99,514.60
[INFO] 
Best parameters from GA: Short SMA = 22, Long SMA = 28, Sharpe = 0.889954
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7969 to 0.8900
[INFO] 
Best parameters:
[INFO] Short SMA: 22
[INFO] Long SMA: 28
[INFO] Sharpe Ratio: 0.889954
[INFO] Number of Trades: 121
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10027 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7969 to 0.8900
[INFO] Trades range: 10.0 to 331.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3615 to 2.7312
[INFO] Scaled Long SMA range: -2.7206 to 1.4041
[INFO] Scaled Sharpe ratio range: -4.1113 to 3.2767
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 13
[INFO] Using 13 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=13...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 915 elements
[INFO] Kmeans Cluster 1: 1185 elements
[INFO] Kmeans Cluster 2: 770 elements
[INFO] Kmeans Cluster 3: 847 elements
[INFO] Kmeans Cluster 4: 740 elements
[INFO] Kmeans Cluster 5: 391 elements
[INFO] Kmeans Cluster 6: 721 elements
[INFO] Kmeans Cluster 7: 759 elements
[INFO] Kmeans Cluster 8: 848 elements
[INFO] Kmeans Cluster 9: 590 elements
[INFO] Kmeans Cluster 10: 1208 elements
[INFO] Kmeans Cluster 11: 363 elements
[INFO] Kmeans Cluster 12: 690 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=40.84, Long SMA=106.33, Sharpe=0.0793
[INFO] Centroid 1: Short SMA=168.14, Long SMA=229.18, Sharpe=0.2489
[INFO] Centroid 2: Short SMA=223.55, Long SMA=267.17, Sharpe=-0.1825
[INFO] Centroid 3: Short SMA=133.14, Long SMA=190.23, Sharpe=0.4414
[INFO] Centroid 4: Short SMA=32.40, Long SMA=171.83, Sharpe=0.3019
[INFO] Centroid 5: Short SMA=121.48, Long SMA=151.37, Sharpe=0.1538
[INFO] Centroid 6: Short SMA=170.07, Long SMA=277.09, Sharpe=0.0278
[INFO] Centroid 7: Short SMA=84.35, Long SMA=127.87, Sharpe=-0.1343
[INFO] Centroid 8: Short SMA=82.10, Long SMA=281.01, Sharpe=0.0892
[INFO] Centroid 9: Short SMA=32.93, Long SMA=61.15, Sharpe=0.3459
[INFO] Centroid 10: Short SMA=40.92, Long SMA=248.77, Sharpe=0.3381
[INFO] Centroid 11: Short SMA=262.72, Long SMA=282.69, Sharpe=-0.4355
[INFO] Centroid 12: Short SMA=69.27, Long SMA=186.44, Sharpe=0.1294
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=22, Long SMA=28, Sharpe=0.8900, Trades=121
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=132, Long SMA=190, Sharpe=0.4144, Trades=19
[INFO] Kmeans Top 2: Short SMA=40, Long SMA=248, Sharpe=0.3798, Trades=14
[INFO] Kmeans Top 3: Short SMA=168, Long SMA=230, Sharpe=0.3701, Trades=16
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=58, Sharpe=0.3028, Trades=51
[INFO] Kmeans Top 5: Short SMA=32, Long SMA=172, Sharpe=0.2794, Trades=21
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12}
[INFO]   Rounded: (41, 106)
[INFO]   Nearest: (40.0, 106.0)
[INFO]   Rounded: (168, 229)
[INFO]   Nearest: (168.0, 230.0)
[INFO]   Rounded: (224, 267)
[INFO]   Nearest: (224.0, 268.0)
[INFO]   Rounded: (133, 190)
[INFO]   Nearest: (134.0, 190.0)
[INFO]   Rounded: (32, 172)
[INFO]   Rounded: (121, 151)
[INFO]   Nearest: (122.0, 152.0)
[INFO]   Rounded: (170, 277)
[INFO]   Nearest: (170.0, 278.0)
[INFO]   Rounded: (84, 128)
[INFO]   Rounded: (82, 281)
[INFO]   Nearest: (82.0, 282.0)
[INFO]   Rounded: (33, 61)
[INFO]   Nearest: (32.0, 62.0)
[INFO]   Rounded: (41, 249)
[INFO]   Nearest: (40.0, 248.0)
[INFO]   Rounded: (263, 283)
[INFO]   Nearest: (262.0, 282.0)
[INFO]   Rounded: (69, 186)
[INFO]   Nearest: (70.0, 186.0)
[INFO] Successfully plotted 13 out of 13 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 22, Long SMA: 28
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(132/190) - Original Sharpe: 0.4144, Trades: 19
[INFO] Kmeans cluster 2: SMA(40/248) - Original Sharpe: 0.3798, Trades: 14
[INFO] Kmeans cluster 3: SMA(168/230) - Original Sharpe: 0.3701, Trades: 16
[INFO] Kmeans cluster 4: SMA(30/58) - Original Sharpe: 0.3028, Trades: 51
[INFO] Kmeans cluster 5: SMA(32/172) - Original Sharpe: 0.2794, Trades: 21
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (22/28)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (132/190) - Sharpe: 0.4144
[INFO] cluster 2: (40/248) - Sharpe: 0.3798
[INFO] cluster 3: (168/230) - Sharpe: 0.3701
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     2.591859            2.591859
1    2021-11-14 2021-11-14            43     2.356142            0.322175
2    2022-01-14 2022-01-14            41     3.996440            3.996440
3    2022-03-14 2022-03-14            44     1.386441            3.521776
4    2022-05-14 2022-05-14            43    -1.122388           -0.011332
5    2022-07-14 2022-07-14            44    -2.969387           -0.053648
6    2022-09-14 2022-09-14            43    -2.635788            1.863145
7    2022-11-14 2022-11-14            43     0.035722           -0.930788
8    2023-01-14 2023-01-14            41     0.459261           -2.673060
9    2023-03-14 2023-03-14            43    -2.585156           -2.745144
10   2023-05-14 2023-05-14            44     1.833453           -3.809364
11   2023-07-14 2023-07-14            44     5.432989           -6.864078
12   2023-09-14 2023-09-14            43    -0.091949           -1.070583
13   2023-11-14 2023-11-14            42     0.208767           -0.526956
14   2024-01-14 2024-01-14            43    -1.397108            0.739290
15   2024-03-14 2024-03-14            42    -3.827908           -0.379143
16   2024-05-14 2024-05-14            44    -2.752596           -0.225747
17   2024-07-14 2024-07-14            45     2.695689            3.792217
18   2024-09-14 2024-09-14            43    -2.556363           -0.923356
19   2024-11-14 2024-11-14            33    -4.535438           -1.436543
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          2.4 |              0.3 |         -2.1 | False         
[INFO] 2022-01-14   |          4.0 |              4.0 |          0.0 | Excluded      
[INFO] 2022-03-14   |          1.4 |              3.5 |          2.1 | True          
[INFO] 2022-05-14   |         -1.1 |             -0.0 |          1.1 | True          
[INFO] 2022-07-14   |         -3.0 |             -0.1 |          2.9 | True          
[INFO] 2022-09-14   |         -2.6 |              1.9 |          4.5 | True          
[INFO] 2022-11-14   |          0.0 |             -0.9 |         -0.9 | False         
[INFO] 2023-01-14   |          0.5 |             -2.7 |         -3.2 | False         
[INFO] 2023-03-14   |         -2.6 |             -2.7 |         -0.1 | False         
[INFO] 2023-05-14   |          1.8 |             -3.8 |         -5.6 | False         
[INFO] 2023-07-14   |          5.4 |             -6.9 |        -12.3 | False         
[INFO] 2023-09-14   |         -0.1 |             -1.1 |         -1.0 | False         
[INFO] 2023-11-14   |          0.2 |             -0.5 |         -0.7 | False         
[INFO] 2024-01-14   |         -1.4 |              0.7 |          2.1 | True          
[INFO] 2024-03-14   |         -3.8 |             -0.4 |          3.4 | True          
[INFO] 2024-05-14   |         -2.8 |             -0.2 |          2.6 | True          
[INFO] 2024-07-14   |          2.7 |              3.8 |          1.1 | True          
[INFO] 2024-09-14   |         -2.6 |             -0.9 |          1.7 | True          
[INFO] 2024-11-14   |         -4.5 |             -1.4 |          3.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 10 of 18 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for HO...
[INFO] Excel file updated successfully. Added HO with Kmeans win rate 55.6% in row 24
[INFO] Added best Sharpe parameters 22/28 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 22, Long SMA: 28
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(132/190) - Original Sharpe: 0.4144
[INFO] Added cluster 2 to portfolio: SMA(40/248) - Original Sharpe: 0.3798
[INFO] Added cluster 3 to portfolio: SMA(168/230) - Original Sharpe: 0.3701
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HO_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.4590
[INFO] Kmeans Best out-of-sample Sharpe: 0.3460
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for HO...
[INFO] Excel file updated successfully. Added HO with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HO
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7969 to 0.8900
[INFO] 
Best parameters:
[INFO] Short SMA: 22
[INFO] Long SMA: 28
[INFO] Sharpe Ratio: 0.889954
[INFO] Number of Trades: 121
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10027 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7969 to 0.8900
[INFO] Trades range: 10.0 to 331.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3615 to 2.7312
[INFO] Scaled Long SMA range: -2.7206 to 1.4041
[INFO] Scaled Sharpe ratio range: -4.1113 to 3.2767
[INFO] Scaled Trades range: -0.7449 to 16.2358
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10027 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5757
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 975 elements
[INFO] Cluster 1: 877 elements
[INFO] Cluster 2: 703 elements
[INFO] Cluster 3: 458 elements
[INFO] Cluster 4: 105 elements
[INFO] Cluster 5: 692 elements
[INFO] Cluster 6: 806 elements
[INFO] Cluster 7: 1310 elements
[INFO] Cluster 8: 569 elements
[INFO] Cluster 9: 887 elements
[INFO] Cluster 10: 10 elements
[INFO] Cluster 11: 825 elements
[INFO] Cluster 12: 778 elements
[INFO] Cluster 13: 581 elements
[INFO] Cluster 14: 335 elements
[INFO] Cluster 15: 116 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=134, Long SMA=192, Sharpe=0.3896, Trades=19
[INFO] Cluster 1 cluster: Short SMA=82, Long SMA=126, Sharpe=-0.1105, Trades=28
[INFO] Cluster 2 cluster: Short SMA=88, Long SMA=176, Sharpe=0.2150, Trades=17
[INFO] Cluster 3 cluster: Short SMA=28, Long SMA=58, Sharpe=0.3370, Trades=57
[INFO] Cluster 4 cluster: Short SMA=26, Long SMA=32, Sharpe=0.3718, Trades=113
[INFO] Cluster 5 cluster: Short SMA=190, Long SMA=236, Sharpe=0.0277, Trades=20
[INFO] Cluster 6 cluster: Short SMA=148, Long SMA=244, Sharpe=0.2162, Trades=12
[INFO] Cluster 7 cluster: Short SMA=40, Long SMA=246, Sharpe=0.3602, Trades=14
[INFO] Cluster 8 cluster: Short SMA=72, Long SMA=280, Sharpe=0.0618, Trades=12
[INFO] Cluster 9 cluster: Short SMA=36, Long SMA=108, Sharpe=0.2171, Trades=34
[INFO] Cluster 11 cluster: Short SMA=36, Long SMA=174, Sharpe=0.2380, Trades=17
[INFO] Cluster 12 cluster: Short SMA=224, Long SMA=270, Sharpe=-0.2051, Trades=20
[INFO] Cluster 13 cluster: Short SMA=156, Long SMA=288, Sharpe=-0.0155, Trades=10
[INFO] Cluster 14 cluster: Short SMA=266, Long SMA=282, Sharpe=-0.6026, Trades=26
[INFO] Cluster 15 cluster: Short SMA=114, Long SMA=118, Sharpe=0.2394, Trades=72
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=22, Long SMA=28, Sharpe=0.8900, Trades=121
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=134, Long SMA=192, Sharpe=0.3896, Trades=19
[INFO] Top 2: Short SMA=26, Long SMA=32, Sharpe=0.3718, Trades=113
[INFO] Top 3: Short SMA=40, Long SMA=246, Sharpe=0.3602, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10017 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 22, Long SMA: 28
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(134/192) - Original Sharpe: 0.3896, Trades: 19
[INFO] Hierarchical cluster 2: SMA(26/32) - Original Sharpe: 0.3718, Trades: 113
[INFO] Hierarchical cluster 3: SMA(40/246) - Original Sharpe: 0.3602, Trades: 14
[INFO] Hierarchical cluster 4: SMA(28/58) - Original Sharpe: 0.3370, Trades: 57
[INFO] Hierarchical cluster 5: SMA(114/118) - Original Sharpe: 0.2394, Trades: 72
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (22/28)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (134/192) - Sharpe: 0.3896
[INFO] cluster 2: (26/32) - Sharpe: 0.3718
[INFO] cluster 3: (40/246) - Sharpe: 0.3602
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     2.591859            2.313891
1    2021-11-14 2021-11-14            43     2.356142           -0.055104
2    2022-01-14 2022-01-14            41     3.996440            3.996440
3    2022-03-14 2022-03-14            44     1.386441            3.353730
4    2022-05-14 2022-05-14            43    -1.122388           -0.033468
5    2022-07-14 2022-07-14            44    -2.969387           -1.656794
6    2022-09-14 2022-09-14            43    -2.635788            0.304531
7    2022-11-14 2022-11-14            43     0.035722           -2.511395
8    2023-01-14 2023-01-14            41     0.459261           -3.841342
9    2023-03-14 2023-03-14            43    -2.585156           -1.063513
10   2023-05-14 2023-05-14            44     1.833453           -2.050856
11   2023-07-14 2023-07-14            44     5.432989           -2.115157
12   2023-09-14 2023-09-14            43    -0.091949           -1.622641
13   2023-11-14 2023-11-14            42     0.208767           -0.490223
14   2024-01-14 2024-01-14            43    -1.397108            1.157047
15   2024-03-14 2024-03-14            42    -3.827908            0.801661
16   2024-05-14 2024-05-14            44    -2.752596           -1.311502
17   2024-07-14 2024-07-14            45     2.695689            3.487088
18   2024-09-14 2024-09-14            43    -2.556363           -1.075890
19   2024-11-14 2024-11-14            33    -4.535438           -3.004551
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          2.6 |              2.3 |         -0.3 | False         
[INFO] 2021-11-14   |          2.4 |             -0.1 |         -2.5 | False         
[INFO] 2022-01-14   |          4.0 |              4.0 |          0.0 | Excluded      
[INFO] 2022-03-14   |          1.4 |              3.4 |          2.0 | True          
[INFO] 2022-05-14   |         -1.1 |             -0.0 |          1.1 | True          
[INFO] 2022-07-14   |         -3.0 |             -1.7 |          1.3 | True          
[INFO] 2022-09-14   |         -2.6 |              0.3 |          2.9 | True          
[INFO] 2022-11-14   |          0.0 |             -2.5 |         -2.5 | False         
[INFO] 2023-01-14   |          0.5 |             -3.8 |         -4.3 | False         
[INFO] 2023-03-14   |         -2.6 |             -1.1 |          1.5 | True          
[INFO] 2023-05-14   |          1.8 |             -2.1 |         -3.9 | False         
[INFO] 2023-07-14   |          5.4 |             -2.1 |         -7.5 | False         
[INFO] 2023-09-14   |         -0.1 |             -1.6 |         -1.5 | False         
[INFO] 2023-11-14   |          0.2 |             -0.5 |         -0.7 | False         
[INFO] 2024-01-14   |         -1.4 |              1.2 |          2.6 | True          
[INFO] 2024-03-14   |         -3.8 |              0.8 |          4.6 | True          
[INFO] 2024-05-14   |         -2.8 |             -1.3 |          1.5 | True          
[INFO] 2024-07-14   |          2.7 |              3.5 |          0.8 | True          
[INFO] 2024-09-14   |         -2.6 |             -1.1 |          1.5 | True          
[INFO] 2024-11-14   |         -4.5 |             -3.0 |          1.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 19 periods (57.89% win rate)
[INFO] Updating Excel file with Hierarchical results for HO...
[INFO] Excel file updated successfully. Added HO with Hierarchical win rate 57.9% in row 24
[INFO] Added best Sharpe parameters 22/28 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 22, Long SMA: 28
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(134/192) - Original Sharpe: 0.3896
[INFO] Added cluster 2 to portfolio: SMA(26/32) - Original Sharpe: 0.3718
[INFO] Added cluster 3 to portfolio: SMA(40/246) - Original Sharpe: 0.3602
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HO_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.4466
[INFO] Hierarchical Best out-of-sample Sharpe: 0.3460
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for HO...
[INFO] Excel file updated successfully. Added HO with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HO
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for JY in column D: 9.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 257.55s
[INFO] Best parameters: Short SMA = 58, Long SMA = 60
[INFO] Best Sharpe ratio: 0.628631, Trades: 140
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_JY_best_58/60 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @JY
[INFO] Big Point Value (from data): 125000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.36 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $621,660.50
[INFO] Market Buy & Hold P&L: $-63,037.50
[INFO] Outperformance: $684,698.00
[INFO] Sharpe ratio (entire period, annualized): 0.689477
[INFO] Sharpe ratio (in-sample, annualized): 0.628631
[INFO] Sharpe ratio (out-of-sample, annualized): 0.827503
[INFO] Maximum Drawdown: $158,630.25
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 109
[INFO] Out-of-sample period trades: 31
[INFO] Total trades: 140
[INFO] In-sample P&L: $348,546.00
[INFO] Out-of-sample P&L: $201,967.50
[INFO] 
Best parameters from GA: Short SMA = 58, Long SMA = 60, Sharpe = 0.628631
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6534 to 0.6286
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 60
[INFO] Sharpe Ratio: 0.628631
[INFO] Number of Trades: 140
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10488 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6534 to 0.6286
[INFO] Trades range: 10.0 to 360.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3975 to 2.7853
[INFO] Scaled Long SMA range: -2.7975 to 1.4174
[INFO] Scaled Sharpe ratio range: -2.7947 to 4.8392
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 843 elements
[INFO] Kmeans Cluster 1: 557 elements
[INFO] Kmeans Cluster 2: 696 elements
[INFO] Kmeans Cluster 3: 295 elements
[INFO] Kmeans Cluster 4: 923 elements
[INFO] Kmeans Cluster 5: 370 elements
[INFO] Kmeans Cluster 6: 1013 elements
[INFO] Kmeans Cluster 7: 673 elements
[INFO] Kmeans Cluster 8: 738 elements
[INFO] Kmeans Cluster 9: 1119 elements
[INFO] Kmeans Cluster 10: 526 elements
[INFO] Kmeans Cluster 11: 903 elements
[INFO] Kmeans Cluster 12: 769 elements
[INFO] Kmeans Cluster 13: 694 elements
[INFO] Kmeans Cluster 14: 369 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=112.19, Long SMA=254.33, Sharpe=-0.1398
[INFO] Centroid 1: Short SMA=36.12, Long SMA=78.30, Sharpe=-0.0633
[INFO] Centroid 2: Short SMA=153.27, Long SMA=206.87, Sharpe=-0.4519
[INFO] Centroid 3: Short SMA=249.29, Long SMA=274.42, Sharpe=0.1166
[INFO] Centroid 4: Short SMA=61.50, Long SMA=245.26, Sharpe=-0.2482
[INFO] Centroid 5: Short SMA=68.91, Long SMA=97.29, Sharpe=-0.3596
[INFO] Centroid 6: Short SMA=85.42, Long SMA=145.96, Sharpe=-0.2187
[INFO] Centroid 7: Short SMA=26.51, Long SMA=160.50, Sharpe=-0.0741
[INFO] Centroid 8: Short SMA=173.53, Long SMA=217.32, Sharpe=-0.2754
[INFO] Centroid 9: Short SMA=219.78, Long SMA=271.94, Sharpe=-0.1409
[INFO] Centroid 10: Short SMA=31.60, Long SMA=77.93, Sharpe=0.1782
[INFO] Centroid 11: Short SMA=75.82, Long SMA=192.55, Sharpe=-0.3836
[INFO] Centroid 12: Short SMA=28.38, Long SMA=263.62, Sharpe=-0.0486
[INFO] Centroid 13: Short SMA=149.80, Long SMA=276.56, Sharpe=-0.2791
[INFO] Centroid 14: Short SMA=129.30, Long SMA=150.24, Sharpe=-0.0500
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=60, Sharpe=0.6286, Trades=140
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=250, Long SMA=274, Sharpe=0.3064, Trades=20
[INFO] Kmeans Top 2: Short SMA=32, Long SMA=78, Sharpe=0.2579, Trades=38
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=266, Sharpe=0.0496, Trades=12
[INFO] Kmeans Top 4: Short SMA=40, Long SMA=80, Sharpe=0.0041, Trades=32
[INFO] Kmeans Top 5: Short SMA=26, Long SMA=160, Sharpe=-0.0124, Trades=24
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (112, 254)
[INFO]   Rounded: (36, 78)
[INFO]   Rounded: (153, 207)
[INFO]   Nearest: (154.0, 206.0)
[INFO]   Rounded: (249, 274)
[INFO]   Nearest: (250.0, 274.0)
[INFO]   Rounded: (61, 245)
[INFO]   Nearest: (62.0, 246.0)
[INFO]   Rounded: (69, 97)
[INFO]   Nearest: (68.0, 98.0)
[INFO]   Rounded: (85, 146)
[INFO]   Nearest: (86.0, 146.0)
[INFO]   Rounded: (27, 160)
[INFO]   Nearest: (26.0, 160.0)
[INFO]   Rounded: (174, 217)
[INFO]   Nearest: (174.0, 218.0)
[INFO]   Rounded: (220, 272)
[INFO]   Rounded: (32, 78)
[INFO]   Rounded: (76, 193)
[INFO]   Nearest: (76.0, 192.0)
[INFO]   Rounded: (28, 264)
[INFO]   Rounded: (150, 277)
[INFO]   Nearest: (150.0, 276.0)
[INFO]   Rounded: (129, 150)
[INFO]   Nearest: (130.0, 150.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 60
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(250/274) - Original Sharpe: 0.3064, Trades: 20
[INFO] Kmeans cluster 2: SMA(32/78) - Original Sharpe: 0.2579, Trades: 38
[INFO] Kmeans cluster 3: SMA(28/266) - Original Sharpe: 0.0496, Trades: 12
[INFO] Kmeans cluster 4: SMA(40/80) - Original Sharpe: 0.0041, Trades: 32
[INFO] Kmeans cluster 5: SMA(26/160) - Original Sharpe: -0.0124, Trades: 24
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/60)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (250/274) - Sharpe: 0.3064
[INFO] cluster 2: (32/78) - Sharpe: 0.2579
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.150748            3.489457
1    2021-11-14 2021-11-14            43     1.384297           -0.080849
2    2022-01-14 2022-01-14            41     3.292417            3.110260
3    2022-03-14 2022-03-14            44     6.956797            5.852003
4    2022-05-14 2022-05-14            43     3.536297            3.536297
5    2022-07-14 2022-07-14            44     1.924049            1.924049
6    2022-09-14 2022-09-14            43    -1.464758           -1.464758
7    2022-11-14 2022-11-14            43     3.567745           -0.326510
8    2023-01-14 2023-01-14            41    -2.381255           -3.483249
9    2023-03-14 2023-03-14            44     2.565997            1.544248
10   2023-05-14 2023-05-14            44    -0.317342            1.331984
11   2023-07-14 2023-07-14            44     5.203187            5.203187
12   2023-09-14 2023-09-14            43     3.227294            2.420840
13   2023-11-14 2023-11-14            42    -5.199080           -3.215222
14   2024-01-14 2024-01-14            43    -5.390091           -1.453670
15   2024-03-14 2024-03-14            42     4.374593            4.374593
16   2024-05-14 2024-05-14            44     1.567034            1.567034
17   2024-07-14 2024-07-14            45    -2.564883           -4.268048
18   2024-09-14 2024-09-14            43    -3.192759            1.523489
19   2024-11-14 2024-11-14            33     1.332713            1.332713
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.2 |              3.5 |          5.7 | True          
[INFO] 2021-11-14   |          1.4 |             -0.1 |         -1.5 | False         
[INFO] 2022-01-14   |          3.3 |              3.1 |         -0.2 | False         
[INFO] 2022-03-14   |          7.0 |              5.9 |         -1.1 | False         
[INFO] 2022-05-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-11-14   |          3.6 |             -0.3 |         -3.9 | False         
[INFO] 2023-01-14   |         -2.4 |             -3.5 |         -1.1 | False         
[INFO] 2023-03-14   |          2.6 |              1.5 |         -1.1 | False         
[INFO] 2023-05-14   |         -0.3 |              1.3 |          1.6 | True          
[INFO] 2023-07-14   |          5.2 |              5.2 |          0.0 | Excluded      
[INFO] 2023-09-14   |          3.2 |              2.4 |         -0.8 | False         
[INFO] 2023-11-14   |         -5.2 |             -3.2 |          2.0 | True          
[INFO] 2024-01-14   |         -5.4 |             -1.5 |          3.9 | True          
[INFO] 2024-03-14   |          4.4 |              4.4 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.6 |             -4.3 |         -1.7 | False         
[INFO] 2024-09-14   |         -3.2 |              1.5 |          4.7 | True          
[INFO] 2024-11-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2022-07-14, 2022-09-14, 2023-07-14, 2024-03-14, 2024-05-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 5 of 13 periods (38.46% win rate)
[INFO] Updating Excel file with Kmeans results for JY...
[INFO] Excel file updated successfully. Added JY with Kmeans win rate 38.5% in row 25
[INFO] Added best Sharpe parameters 58/60 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 60
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(250/274) - Original Sharpe: 0.3064
[INFO] Added cluster 2 to portfolio: SMA(32/78) - Original Sharpe: 0.2579
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'JY_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 1.2048
[INFO] Kmeans Best out-of-sample Sharpe: 0.8275
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for JY...
[INFO] Excel file updated successfully. Added JY with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\JY
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6534 to 0.6286
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 60
[INFO] Sharpe Ratio: 0.628631
[INFO] Number of Trades: 140
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10488 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6534 to 0.6286
[INFO] Trades range: 10.0 to 360.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3975 to 2.7853
[INFO] Scaled Long SMA range: -2.7975 to 1.4174
[INFO] Scaled Sharpe ratio range: -2.7947 to 4.8392
[INFO] Scaled Trades range: -0.7089 to 17.7531
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10488 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5236
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1247 elements
[INFO] Cluster 1: 1419 elements
[INFO] Cluster 2: 93 elements
[INFO] Cluster 3: 746 elements
[INFO] Cluster 4: 851 elements
[INFO] Cluster 5: 533 elements
[INFO] Cluster 6: 427 elements
[INFO] Cluster 7: 25 elements
[INFO] Cluster 8: 934 elements
[INFO] Cluster 9: 694 elements
[INFO] Cluster 10: 871 elements
[INFO] Cluster 11: 846 elements
[INFO] Cluster 12: 255 elements
[INFO] Cluster 13: 241 elements
[INFO] Cluster 14: 769 elements
[INFO] Cluster 15: 176 elements
[INFO] Cluster 16: 361 elements
[INFO] Using 17 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=208, Long SMA=268, Sharpe=-0.0619, Trades=16
[INFO] Cluster 1 cluster: Short SMA=90, Long SMA=148, Sharpe=-0.2666, Trades=17
[INFO] Cluster 2 cluster: Short SMA=28, Long SMA=34, Sharpe=-0.3778, Trades=119
[INFO] Cluster 3 cluster: Short SMA=156, Long SMA=206, Sharpe=-0.4073, Trades=18
[INFO] Cluster 4 cluster: Short SMA=32, Long SMA=270, Sharpe=0.0564, Trades=12
[INFO] Cluster 5 cluster: Short SMA=34, Long SMA=82, Sharpe=0.1612, Trades=38
[INFO] Cluster 6 cluster: Short SMA=242, Long SMA=272, Sharpe=0.2217, Trades=20
[INFO] Cluster 7 cluster: Short SMA=24, Long SMA=26, Sharpe=-0.0761, Trades=210
[INFO] Cluster 8 cluster: Short SMA=110, Long SMA=258, Sharpe=-0.1295, Trades=14
[INFO] Cluster 9 cluster: Short SMA=30, Long SMA=124, Sharpe=-0.1173, Trades=26
[INFO] Cluster 10 cluster: Short SMA=162, Long SMA=256, Sharpe=-0.2484, Trades=14
[INFO] Cluster 11 cluster: Short SMA=76, Long SMA=192, Sharpe=-0.3432, Trades=18
[INFO] Cluster 12 cluster: Short SMA=138, Long SMA=154, Sharpe=0.0621, Trades=23
[INFO] Cluster 13 cluster: Short SMA=42, Long SMA=54, Sharpe=-0.1459, Trades=76
[INFO] Cluster 14 cluster: Short SMA=66, Long SMA=242, Sharpe=-0.1626, Trades=14
[INFO] Cluster 15 cluster: Short SMA=80, Long SMA=104, Sharpe=-0.4899, Trades=36
[INFO] Cluster 16 cluster: Short SMA=28, Long SMA=190, Sharpe=-0.1819, Trades=20
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=60, Sharpe=0.6286, Trades=140
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=242, Long SMA=272, Sharpe=0.2217, Trades=20
[INFO] Top 2: Short SMA=34, Long SMA=82, Sharpe=0.1612, Trades=38
[INFO] Top 3: Short SMA=138, Long SMA=154, Sharpe=0.0621, Trades=23
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 17 valid clusters with clusters
[INFO] Filtering to 10488 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 60
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(242/272) - Original Sharpe: 0.2217, Trades: 20
[INFO] Hierarchical cluster 2: SMA(34/82) - Original Sharpe: 0.1612, Trades: 38
[INFO] Hierarchical cluster 3: SMA(138/154) - Original Sharpe: 0.0621, Trades: 23
[INFO] Hierarchical cluster 4: SMA(32/270) - Original Sharpe: 0.0564, Trades: 12
[INFO] Hierarchical cluster 5: SMA(208/268) - Original Sharpe: -0.0619, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/60)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (242/272) - Sharpe: 0.2217
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.150748            3.484171
1    2021-11-14 2021-11-14            43     1.384297           -0.080849
2    2022-01-14 2022-01-14            41     3.292417            3.110260
3    2022-03-14 2022-03-14            44     6.956797            5.852003
4    2022-05-14 2022-05-14            43     3.536297            3.536297
5    2022-07-14 2022-07-14            44     1.924049            1.924049
6    2022-09-14 2022-09-14            43    -1.464758           -1.464758
7    2022-11-14 2022-11-14            43     3.567745           -2.394935
8    2023-01-14 2023-01-14            41    -2.381255            2.381255
9    2023-03-14 2023-03-14            44     2.565997            1.544248
10   2023-05-14 2023-05-14            44    -0.317342            1.331984
11   2023-07-14 2023-07-14            44     5.203187            4.937102
12   2023-09-14 2023-09-14            43     3.227294           -2.757384
13   2023-11-14 2023-11-14            42    -5.199080           -2.509051
14   2024-01-14 2024-01-14            43    -5.390091            1.238303
15   2024-03-14 2024-03-14            42     4.374593            4.374593
16   2024-05-14 2024-05-14            44     1.567034            1.567034
17   2024-07-14 2024-07-14            45    -2.564883           -4.863936
18   2024-09-14 2024-09-14            43    -3.192759            5.248937
19   2024-11-14 2024-11-14            33     1.332713            1.332713
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.2 |              3.5 |          5.7 | True          
[INFO] 2021-11-14   |          1.4 |             -0.1 |         -1.5 | False         
[INFO] 2022-01-14   |          3.3 |              3.1 |         -0.2 | False         
[INFO] 2022-03-14   |          7.0 |              5.9 |         -1.1 | False         
[INFO] 2022-05-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-11-14   |          3.6 |             -2.4 |         -6.0 | False         
[INFO] 2023-01-14   |         -2.4 |              2.4 |          4.8 | True          
[INFO] 2023-03-14   |          2.6 |              1.5 |         -1.1 | False         
[INFO] 2023-05-14   |         -0.3 |              1.3 |          1.6 | True          
[INFO] 2023-07-14   |          5.2 |              4.9 |         -0.3 | False         
[INFO] 2023-09-14   |          3.2 |             -2.8 |         -6.0 | False         
[INFO] 2023-11-14   |         -5.2 |             -2.5 |          2.7 | True          
[INFO] 2024-01-14   |         -5.4 |              1.2 |          6.6 | True          
[INFO] 2024-03-14   |          4.4 |              4.4 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.6 |             -4.9 |         -2.3 | False         
[INFO] 2024-09-14   |         -3.2 |              5.2 |          8.4 | True          
[INFO] 2024-11-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2022-07-14, 2022-09-14, 2024-03-14, 2024-05-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 14 periods (42.86% win rate)
[INFO] Updating Excel file with Hierarchical results for JY...
[INFO] Excel file updated successfully. Added JY with Hierarchical win rate 42.9% in row 25
[INFO] Added best Sharpe parameters 58/60 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 60
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(242/272) - Original Sharpe: 0.2217
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'JY_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 1.2211
[INFO] Hierarchical Best out-of-sample Sharpe: 0.8275
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for JY...
[INFO] Excel file updated successfully. Added JY with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\JY
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for KC in column D: 32.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 242.04s
[INFO] Best parameters: Short SMA = 126, Long SMA = 144
[INFO] Best Sharpe ratio: 0.627789, Trades: 31
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_KC_best_126/144 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @KC
[INFO] Big Point Value (from data): 375.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.46 contracts
[INFO] Maximum Position Size: 10 contracts
[INFO] Strategy Total P&L: $639,834.00
[INFO] Market Buy & Hold P&L: $47,625.00
[INFO] Outperformance: $592,209.00
[INFO] Sharpe ratio (entire period, annualized): 0.637021
[INFO] Sharpe ratio (in-sample, annualized): 0.627789
[INFO] Sharpe ratio (out-of-sample, annualized): 0.657694
[INFO] Maximum Drawdown: $199,510.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 23
[INFO] Out-of-sample period trades: 8
[INFO] Total trades: 31
[INFO] In-sample P&L: $366,396.50
[INFO] Out-of-sample P&L: $175,393.75
[INFO] 
Best parameters from GA: Short SMA = 126, Long SMA = 144, Sharpe = 0.627789
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 375.0
[INFO] Slippage: 32.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7635 to 0.6278
[INFO] 
Best parameters:
[INFO] Short SMA: 126
[INFO] Long SMA: 144
[INFO] Sharpe Ratio: 0.627789
[INFO] Number of Trades: 31
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9735 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7635 to 0.6278
[INFO] Trades range: 11.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3432 to 2.6986
[INFO] Scaled Long SMA range: -2.7329 to 1.5004
[INFO] Scaled Sharpe ratio range: -3.9207 to 2.9484
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 789 elements
[INFO] Kmeans Cluster 1: 631 elements
[INFO] Kmeans Cluster 2: 681 elements
[INFO] Kmeans Cluster 3: 535 elements
[INFO] Kmeans Cluster 4: 399 elements
[INFO] Kmeans Cluster 5: 270 elements
[INFO] Kmeans Cluster 6: 462 elements
[INFO] Kmeans Cluster 7: 909 elements
[INFO] Kmeans Cluster 8: 891 elements
[INFO] Kmeans Cluster 9: 1005 elements
[INFO] Kmeans Cluster 10: 798 elements
[INFO] Kmeans Cluster 11: 770 elements
[INFO] Kmeans Cluster 12: 320 elements
[INFO] Kmeans Cluster 13: 713 elements
[INFO] Kmeans Cluster 14: 562 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=44.95, Long SMA=236.45, Sharpe=0.0415
[INFO] Centroid 1: Short SMA=216.82, Long SMA=278.34, Sharpe=-0.1656
[INFO] Centroid 2: Short SMA=95.58, Long SMA=146.13, Sharpe=0.1721
[INFO] Centroid 3: Short SMA=104.88, Long SMA=154.44, Sharpe=0.3631
[INFO] Centroid 4: Short SMA=152.74, Long SMA=175.85, Sharpe=-0.1633
[INFO] Centroid 5: Short SMA=19.98, Long SMA=53.76, Sharpe=-0.3674
[INFO] Centroid 6: Short SMA=249.21, Long SMA=282.28, Sharpe=-0.3924
[INFO] Centroid 7: Short SMA=39.77, Long SMA=193.80, Sharpe=0.2526
[INFO] Centroid 8: Short SMA=114.24, Long SMA=206.45, Sharpe=0.0292
[INFO] Centroid 9: Short SMA=191.64, Long SMA=233.62, Sharpe=0.0927
[INFO] Centroid 10: Short SMA=50.86, Long SMA=110.29, Sharpe=0.2400
[INFO] Centroid 11: Short SMA=149.70, Long SMA=256.77, Sharpe=-0.0699
[INFO] Centroid 12: Short SMA=22.78, Long SMA=144.24, Sharpe=-0.0238
[INFO] Centroid 13: Short SMA=49.90, Long SMA=276.98, Sharpe=-0.1306
[INFO] Centroid 14: Short SMA=43.30, Long SMA=75.88, Sharpe=0.0351
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=126, Long SMA=144, Sharpe=0.6278, Trades=31
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=110, Long SMA=154, Sharpe=0.3291, Trades=21
[INFO] Kmeans Top 2: Short SMA=96, Long SMA=146, Sharpe=0.2414, Trades=21
[INFO] Kmeans Top 3: Short SMA=40, Long SMA=190, Sharpe=0.2141, Trades=17
[INFO] Kmeans Top 4: Short SMA=192, Long SMA=234, Sharpe=0.1589, Trades=13
[INFO] Kmeans Top 5: Short SMA=50, Long SMA=110, Sharpe=0.1529, Trades=23
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (45, 236)
[INFO]   Nearest: (44.0, 236.0)
[INFO]   Rounded: (217, 278)
[INFO]   Nearest: (216.0, 278.0)
[INFO]   Rounded: (96, 146)
[INFO]   Rounded: (105, 154)
[INFO]   Nearest: (104.0, 154.0)
[INFO]   Rounded: (153, 176)
[INFO]   Nearest: (152.0, 176.0)
[INFO]   Rounded: (20, 54)
[INFO]   Rounded: (249, 282)
[INFO]   Nearest: (250.0, 282.0)
[INFO]   Rounded: (40, 194)
[INFO]   Rounded: (114, 206)
[INFO]   Rounded: (192, 234)
[INFO]   Rounded: (51, 110)
[INFO]   Nearest: (50.0, 110.0)
[INFO]   Rounded: (150, 257)
[INFO]   Nearest: (150.0, 256.0)
[INFO]   Rounded: (23, 144)
[INFO]   Nearest: (22.0, 144.0)
[INFO]   Rounded: (50, 277)
[INFO]   Nearest: (50.0, 276.0)
[INFO]   Rounded: (43, 76)
[INFO]   Nearest: (44.0, 76.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 126, Long SMA: 144
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(110/154) - Original Sharpe: 0.3291, Trades: 21
[INFO] Kmeans cluster 2: SMA(96/146) - Original Sharpe: 0.2414, Trades: 21
[INFO] Kmeans cluster 3: SMA(40/190) - Original Sharpe: 0.2141, Trades: 17
[INFO] Kmeans cluster 4: SMA(192/234) - Original Sharpe: 0.1589, Trades: 13
[INFO] Kmeans cluster 5: SMA(50/110) - Original Sharpe: 0.1529, Trades: 23
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (126/144)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (110/154) - Sharpe: 0.3291
[INFO] cluster 2: (96/146) - Sharpe: 0.2414
[INFO] cluster 3: (40/190) - Sharpe: 0.2141
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     1.943138            1.943138
1    2021-11-10 2021-11-10            41     2.726433            2.726433
2    2022-01-10 2022-01-10            41    -0.979722           -0.979722
3    2022-03-10 2022-03-10            42    -1.932434           -1.932434
4    2022-05-10 2022-05-10            41     2.781394            1.573994
5    2022-07-10 2022-07-10            44    -0.902683           -0.902683
6    2022-09-10 2022-09-10            43     4.781663           -0.932051
7    2022-11-10 2022-11-10            40     0.520961            0.528681
8    2023-01-10 2023-01-10            41    -1.945501           -1.945501
9    2023-03-10 2023-03-10            42    -1.386296           -1.210087
10   2023-05-10 2023-05-10            40    -1.725343           -1.551839
11   2023-07-10 2023-07-10            44     0.054587            1.855695
12   2023-09-10 2023-09-10            44    -3.556132           -3.556132
13   2023-11-10 2023-11-10            40    -1.024655           -1.267062
14   2024-01-10 2024-01-10            41     1.405934            0.889526
15   2024-03-10 2024-03-10            43     1.924896            1.924896
16   2024-05-10 2024-05-10            40     2.925387            2.925387
17   2024-07-10 2024-07-10            43     0.254368            0.254368
18   2024-09-10 2024-09-10            44     0.943102            0.943102
19   2024-11-10 2024-11-10            35     5.162860            5.162860
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-01-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |          2.8 |              1.6 |         -1.2 | False         
[INFO] 2022-07-10   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2022-09-10   |          4.8 |             -0.9 |         -5.7 | False         
[INFO] 2022-11-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -1.4 |             -1.2 |          0.2 | True          
[INFO] 2023-05-10   |         -1.7 |             -1.6 |          0.1 | True          
[INFO] 2023-07-10   |          0.1 |              1.9 |          1.8 | True          
[INFO] 2023-09-10   |         -3.6 |             -3.6 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -1.0 |             -1.3 |         -0.3 | False         
[INFO] 2024-01-10   |          1.4 |              0.9 |         -0.5 | False         
[INFO] 2024-03-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-11-10   |          5.2 |              5.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2022-07-10, 2022-11-10, 2023-01-10, 2023-09-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 7
[INFO] Kmeans cluster wins (rounded comparison): 3 of 7 periods (42.86% win rate)
[INFO] Updating Excel file with Kmeans results for KC...
[INFO] Excel file updated successfully. Added KC with Kmeans win rate 42.9% in row 26
[INFO] Added best Sharpe parameters 126/144 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 126, Long SMA: 144
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(110/154) - Original Sharpe: 0.3291
[INFO] Added cluster 2 to portfolio: SMA(96/146) - Original Sharpe: 0.2414
[INFO] Added cluster 3 to portfolio: SMA(40/190) - Original Sharpe: 0.2141
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3496
[INFO] Kmeans Best out-of-sample Sharpe: 0.6577
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for KC...
[INFO] Excel file updated successfully. Added KC with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KC
[INFO] Big Point Value: 375.0
[INFO] Slippage: 32.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7635 to 0.6278
[INFO] 
Best parameters:
[INFO] Short SMA: 126
[INFO] Long SMA: 144
[INFO] Sharpe Ratio: 0.627789
[INFO] Number of Trades: 31
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9735 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7635 to 0.6278
[INFO] Trades range: 11.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3432 to 2.6986
[INFO] Scaled Long SMA range: -2.7329 to 1.5004
[INFO] Scaled Sharpe ratio range: -3.9207 to 2.9484
[INFO] Scaled Trades range: -0.5894 to 15.3908
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9735 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4846
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1487 elements
[INFO] Cluster 1: 1174 elements
[INFO] Cluster 2: 306 elements
[INFO] Cluster 3: 610 elements
[INFO] Cluster 4: 765 elements
[INFO] Cluster 5: 719 elements
[INFO] Cluster 6: 1006 elements
[INFO] Cluster 7: 19 elements
[INFO] Cluster 8: 751 elements
[INFO] Cluster 9: 321 elements
[INFO] Cluster 10: 991 elements
[INFO] Cluster 11: 924 elements
[INFO] Cluster 12: 459 elements
[INFO] Cluster 13: 71 elements
[INFO] Cluster 14: 132 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=90, Long SMA=218, Sharpe=0.0723, Trades=11
[INFO] Cluster 1 cluster: Short SMA=44, Long SMA=190, Sharpe=0.1102, Trades=21
[INFO] Cluster 2 cluster: Short SMA=98, Long SMA=104, Sharpe=0.1741, Trades=65
[INFO] Cluster 3 cluster: Short SMA=20, Long SMA=120, Sharpe=-0.0132, Trades=33
[INFO] Cluster 4 cluster: Short SMA=198, Long SMA=228, Sharpe=0.1370, Trades=19
[INFO] Cluster 5 cluster: Short SMA=206, Long SMA=280, Sharpe=-0.2068, Trades=11
[INFO] Cluster 6 cluster: Short SMA=158, Long SMA=246, Sharpe=0.0749, Trades=11
[INFO] Cluster 8 cluster: Short SMA=48, Long SMA=278, Sharpe=-0.2240, Trades=15
[INFO] Cluster 9 cluster: Short SMA=154, Long SMA=178, Sharpe=-0.2999, Trades=21
[INFO] Cluster 10 cluster: Short SMA=50, Long SMA=104, Sharpe=0.2832, Trades=27
[INFO] Cluster 11 cluster: Short SMA=84, Long SMA=150, Sharpe=0.3591, Trades=19
[INFO] Cluster 12 cluster: Short SMA=248, Long SMA=282, Sharpe=-0.3674, Trades=15
[INFO] Cluster 13 cluster: Short SMA=24, Long SMA=30, Sharpe=-0.2693, Trades=134
[INFO] Cluster 14 cluster: Short SMA=22, Long SMA=42, Sharpe=-0.5119, Trades=80
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=126, Long SMA=144, Sharpe=0.6278, Trades=31
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=84, Long SMA=150, Sharpe=0.3591, Trades=19
[INFO] Top 2: Short SMA=50, Long SMA=104, Sharpe=0.2832, Trades=27
[INFO] Top 3: Short SMA=98, Long SMA=104, Sharpe=0.1741, Trades=65
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 9716 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 126, Long SMA: 144
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(84/150) - Original Sharpe: 0.3591, Trades: 19
[INFO] Hierarchical cluster 2: SMA(50/104) - Original Sharpe: 0.2832, Trades: 27
[INFO] Hierarchical cluster 3: SMA(98/104) - Original Sharpe: 0.1741, Trades: 65
[INFO] Hierarchical cluster 4: SMA(198/228) - Original Sharpe: 0.1370, Trades: 19
[INFO] Hierarchical cluster 5: SMA(44/190) - Original Sharpe: 0.1102, Trades: 21
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (126/144)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (84/150) - Sharpe: 0.3591
[INFO] cluster 2: (50/104) - Sharpe: 0.2832
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     1.943138            1.943138
1    2021-11-10 2021-11-10            41     2.726433            2.726433
2    2022-01-10 2022-01-10            41    -0.979722           -0.979722
3    2022-03-10 2022-03-10            42    -1.932434            0.014714
4    2022-05-10 2022-05-10            41     2.781394           -0.347871
5    2022-07-10 2022-07-10            44    -0.902683           -0.875493
6    2022-09-10 2022-09-10            43     4.781663           -0.946681
7    2022-11-10 2022-11-10            40     0.520961            0.528681
8    2023-01-10 2023-01-10            41    -1.945501           -1.945501
9    2023-03-10 2023-03-10            42    -1.386296           -0.183990
10   2023-05-10 2023-05-10            40    -1.725343           -1.807713
11   2023-07-10 2023-07-10            44     0.054587            0.872772
12   2023-09-10 2023-09-10            44    -3.556132           -3.556132
13   2023-11-10 2023-11-10            40    -1.024655           -1.546431
14   2024-01-10 2024-01-10            41     1.405934            0.617414
15   2024-03-10 2024-03-10            43     1.924896            1.924896
16   2024-05-10 2024-05-10            40     2.925387            2.925387
17   2024-07-10 2024-07-10            43     0.254368            0.254368
18   2024-09-10 2024-09-10            44     0.943102            0.943102
19   2024-11-10 2024-11-10            35     5.162860            5.162860
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-01-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -1.9 |              0.0 |          1.9 | True          
[INFO] 2022-05-10   |          2.8 |             -0.3 |         -3.1 | False         
[INFO] 2022-07-10   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2022-09-10   |          4.8 |             -0.9 |         -5.7 | False         
[INFO] 2022-11-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -1.4 |             -0.2 |          1.2 | True          
[INFO] 2023-05-10   |         -1.7 |             -1.8 |         -0.1 | False         
[INFO] 2023-07-10   |          0.1 |              0.9 |          0.8 | True          
[INFO] 2023-09-10   |         -3.6 |             -3.6 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -1.0 |             -1.5 |         -0.5 | False         
[INFO] 2024-01-10   |          1.4 |              0.6 |         -0.8 | False         
[INFO] 2024-03-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-11-10   |          5.2 |              5.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-07-10, 2022-11-10, 2023-01-10, 2023-09-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Hierarchical cluster wins (rounded comparison): 3 of 8 periods (37.50% win rate)
[INFO] Updating Excel file with Hierarchical results for KC...
[INFO] Excel file updated successfully. Added KC with Hierarchical win rate 37.5% in row 26
[INFO] Added best Sharpe parameters 126/144 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 126, Long SMA: 144
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(84/150) - Original Sharpe: 0.3591
[INFO] Added cluster 2 to portfolio: SMA(50/104) - Original Sharpe: 0.2832
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3706
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6577
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for KC...
[INFO] Excel file updated successfully. Added KC with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KC
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for KW in column D: 18.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 241.29s
[INFO] Best parameters: Short SMA = 218, Long SMA = 300
[INFO] Best Sharpe ratio: 0.653288, Trades: 4
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_KW_best_218/300 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @KW
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.20 contracts
[INFO] Maximum Position Size: 19 contracts
[INFO] Strategy Total P&L: $596,198.00
[INFO] Market Buy & Hold P&L: $-29,750.00
[INFO] Outperformance: $625,948.00
[INFO] Sharpe ratio (entire period, annualized): 0.656604
[INFO] Sharpe ratio (in-sample, annualized): 0.653288
[INFO] Sharpe ratio (out-of-sample, annualized): 0.664140
[INFO] Maximum Drawdown: $122,145.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 3
[INFO] Out-of-sample period trades: 1
[INFO] Total trades: 4
[INFO] In-sample P&L: $336,968.50
[INFO] Out-of-sample P&L: $154,779.50
[INFO] 
Best parameters from GA: Short SMA = 218, Long SMA = 300, Sharpe = 0.653288
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8976 to 0.6533
[INFO] 
Best parameters:
[INFO] Short SMA: 218
[INFO] Long SMA: 300
[INFO] Sharpe Ratio: 0.653288
[INFO] Number of Trades: 4
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9044 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8976 to 0.5917
[INFO] Trades range: 10.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2918 to 2.7703
[INFO] Scaled Long SMA range: -2.6926 to 1.6018
[INFO] Scaled Sharpe ratio range: -3.4124 to 3.0154
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 479 elements
[INFO] Kmeans Cluster 1: 587 elements
[INFO] Kmeans Cluster 2: 716 elements
[INFO] Kmeans Cluster 3: 615 elements
[INFO] Kmeans Cluster 4: 400 elements
[INFO] Kmeans Cluster 5: 405 elements
[INFO] Kmeans Cluster 6: 773 elements
[INFO] Kmeans Cluster 7: 765 elements
[INFO] Kmeans Cluster 8: 770 elements
[INFO] Kmeans Cluster 9: 810 elements
[INFO] Kmeans Cluster 10: 635 elements
[INFO] Kmeans Cluster 11: 321 elements
[INFO] Kmeans Cluster 12: 326 elements
[INFO] Kmeans Cluster 13: 459 elements
[INFO] Kmeans Cluster 14: 514 elements
[INFO] Kmeans Cluster 15: 469 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=132.91, Long SMA=229.63, Sharpe=-0.2092
[INFO] Centroid 1: Short SMA=48.93, Long SMA=88.99, Sharpe=-0.3575
[INFO] Centroid 2: Short SMA=195.50, Long SMA=242.94, Sharpe=0.2638
[INFO] Centroid 3: Short SMA=84.35, Long SMA=126.45, Sharpe=-0.1534
[INFO] Centroid 4: Short SMA=25.86, Long SMA=64.97, Sharpe=-0.0977
[INFO] Centroid 5: Short SMA=150.52, Long SMA=258.97, Sharpe=0.0206
[INFO] Centroid 6: Short SMA=51.98, Long SMA=266.97, Sharpe=-0.1093
[INFO] Centroid 7: Short SMA=113.74, Long SMA=160.76, Sharpe=0.0755
[INFO] Centroid 8: Short SMA=157.76, Long SMA=193.38, Sharpe=-0.0658
[INFO] Centroid 9: Short SMA=71.73, Long SMA=200.28, Sharpe=-0.1405
[INFO] Centroid 10: Short SMA=37.96, Long SMA=162.68, Sharpe=-0.3741
[INFO] Centroid 11: Short SMA=16.24, Long SMA=190.26, Sharpe=-0.0764
[INFO] Centroid 12: Short SMA=228.62, Long SMA=254.55, Sharpe=0.0568
[INFO] Centroid 13: Short SMA=37.53, Long SMA=96.93, Sharpe=-0.5730
[INFO] Centroid 14: Short SMA=30.28, Long SMA=255.64, Sharpe=-0.3201
[INFO] Centroid 15: Short SMA=255.23, Long SMA=283.94, Sharpe=0.3024
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=218, Long SMA=300, Sharpe=0.6533, Trades=4
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=196, Long SMA=242, Sharpe=0.3293, Trades=12
[INFO] Kmeans Top 2: Short SMA=256, Long SMA=284, Sharpe=0.3119, Trades=14
[INFO] Kmeans Top 3: Short SMA=114, Long SMA=160, Sharpe=0.2059, Trades=16
[INFO] Kmeans Top 4: Short SMA=230, Long SMA=256, Sharpe=0.0238, Trades=14
[INFO] Kmeans Top 5: Short SMA=154, Long SMA=258, Sharpe=0.0237, Trades=10
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (133, 230)
[INFO]   Nearest: (132.0, 230.0)
[INFO]   Rounded: (49, 89)
[INFO]   Nearest: (48.0, 88.0)
[INFO]   Rounded: (195, 243)
[INFO]   Nearest: (196.0, 242.0)
[INFO]   Rounded: (84, 126)
[INFO]   Rounded: (26, 65)
[INFO]   Nearest: (26.0, 64.0)
[INFO]   Rounded: (151, 259)
[INFO]   Nearest: (150.0, 258.0)
[INFO]   Rounded: (52, 267)
[INFO]   Nearest: (52.0, 266.0)
[INFO]   Rounded: (114, 161)
[INFO]   Nearest: (114.0, 160.0)
[INFO]   Rounded: (158, 193)
[INFO]   Nearest: (158.0, 194.0)
[INFO]   Rounded: (72, 200)
[INFO]   Rounded: (38, 163)
[INFO]   Nearest: (38.0, 162.0)
[INFO]   Rounded: (16, 190)
[INFO]   Rounded: (229, 255)
[INFO]   Nearest: (228.0, 254.0)
[INFO]   Rounded: (38, 97)
[INFO]   Nearest: (38.0, 96.0)
[INFO]   Rounded: (30, 256)
[INFO]   Rounded: (255, 284)
[INFO]   Nearest: (256.0, 284.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 218, Long SMA: 300
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(196/242) - Original Sharpe: 0.3293, Trades: 12
[INFO] Kmeans cluster 2: SMA(256/284) - Original Sharpe: 0.3119, Trades: 14
[INFO] Kmeans cluster 3: SMA(114/160) - Original Sharpe: 0.2059, Trades: 16
[INFO] Kmeans cluster 4: SMA(230/256) - Original Sharpe: 0.0238, Trades: 14
[INFO] Kmeans cluster 5: SMA(154/258) - Original Sharpe: 0.0237, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (218/300)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (196/242) - Sharpe: 0.3293
[INFO] cluster 2: (256/284) - Sharpe: 0.3119
[INFO] cluster 3: (114/160) - Sharpe: 0.2059
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     3.716844            3.716844
1    2021-11-10 2021-11-10            41    -0.412472           -0.412472
2    2022-01-10 2022-01-10            41     4.290205            4.290205
3    2022-03-10 2022-03-10            42     0.696473            0.696473
4    2022-05-10 2022-05-10            41    -1.906913           -1.906913
5    2022-07-10 2022-07-10            44     0.008064            0.008064
6    2022-09-10 2022-09-10            43     0.059045            0.472348
7    2022-11-10 2022-11-10            40    -2.768953           -2.768953
8    2023-01-10 2023-01-10            41     0.901765           -3.972384
9    2023-03-10 2023-03-10            42    -2.058673           -0.696337
10   2023-05-10 2023-05-10            40     0.600971            1.910748
11   2023-07-10 2023-07-10            44     1.747552            1.342355
12   2023-09-10 2023-09-10            44     2.993555            3.381131
13   2023-11-10 2023-11-10            40     0.817504            0.817504
14   2024-01-10 2024-01-10            41     1.290468            1.290468
15   2024-03-10 2024-03-10            43    -2.221917           -2.221917
16   2024-05-10 2024-05-10            40     2.247863            2.247863
17   2024-07-10 2024-07-10            43     0.009942            1.410398
18   2024-09-10 2024-09-10            44     0.461751            1.831546
19   2024-11-10 2024-11-10            35     0.788268            0.788268
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2022-01-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-03-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-10   |          0.1 |              0.5 |          0.4 | True          
[INFO] 2022-11-10   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2023-01-10   |          0.9 |             -4.0 |         -4.9 | False         
[INFO] 2023-03-10   |         -2.1 |             -0.7 |          1.4 | True          
[INFO] 2023-05-10   |          0.6 |              1.9 |          1.3 | True          
[INFO] 2023-07-10   |          1.7 |              1.3 |         -0.4 | False         
[INFO] 2023-09-10   |          3.0 |              3.4 |          0.4 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.0 |              1.4 |          1.4 | True          
[INFO] 2024-09-10   |          0.5 |              1.8 |          1.3 | True          
[INFO] 2024-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2022-05-10, 2022-07-10, 2022-11-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Kmeans cluster wins (rounded comparison): 6 of 8 periods (75.00% win rate)
[INFO] Updating Excel file with Kmeans results for KW...
[INFO] Excel file updated successfully. Added KW with Kmeans win rate 75.0% in row 27
[INFO] Added best Sharpe parameters 218/300 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 218, Long SMA: 300
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(196/242) - Original Sharpe: 0.3293
[INFO] Added cluster 2 to portfolio: SMA(256/284) - Original Sharpe: 0.3119
[INFO] Added cluster 3 to portfolio: SMA(114/160) - Original Sharpe: 0.2059
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KW_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.9083
[INFO] Kmeans Best out-of-sample Sharpe: 0.6641
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for KW...
[INFO] Excel file updated successfully. Added KW with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KW
[INFO] Big Point Value: 50.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8976 to 0.6533
[INFO] 
Best parameters:
[INFO] Short SMA: 218
[INFO] Long SMA: 300
[INFO] Sharpe Ratio: 0.653288
[INFO] Number of Trades: 4
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9044 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8976 to 0.5917
[INFO] Trades range: 10.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2918 to 2.7703
[INFO] Scaled Long SMA range: -2.6926 to 1.6018
[INFO] Scaled Sharpe ratio range: -3.4124 to 3.0154
[INFO] Scaled Trades range: -0.6668 to 14.7729
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9044 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5618
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 13
[INFO] Using 13 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 13 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 413 elements
[INFO] Cluster 1: 1065 elements
[INFO] Cluster 2: 1172 elements
[INFO] Cluster 3: 909 elements
[INFO] Cluster 4: 812 elements
[INFO] Cluster 5: 920 elements
[INFO] Cluster 6: 251 elements
[INFO] Cluster 7: 65 elements
[INFO] Cluster 8: 854 elements
[INFO] Cluster 9: 504 elements
[INFO] Cluster 10: 665 elements
[INFO] Cluster 11: 980 elements
[INFO] Cluster 12: 434 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=136, Long SMA=146, Sharpe=-0.0149, Trades=48
[INFO] Cluster 1 cluster: Short SMA=40, Long SMA=270, Sharpe=-0.1961, Trades=16
[INFO] Cluster 2 cluster: Short SMA=54, Long SMA=210, Sharpe=-0.2354, Trades=14
[INFO] Cluster 3 cluster: Short SMA=70, Long SMA=130, Sharpe=-0.2297, Trades=25
[INFO] Cluster 4 cluster: Short SMA=212, Long SMA=244, Sharpe=0.2443, Trades=14
[INFO] Cluster 5 cluster: Short SMA=46, Long SMA=130, Sharpe=-0.3974, Trades=24
[INFO] Cluster 6 cluster: Short SMA=28, Long SMA=42, Sharpe=-0.2269, Trades=74
[INFO] Cluster 7 cluster: Short SMA=26, Long SMA=30, Sharpe=-0.3814, Trades=152
[INFO] Cluster 8 cluster: Short SMA=112, Long SMA=176, Sharpe=0.1014, Trades=14
[INFO] Cluster 9 cluster: Short SMA=40, Long SMA=76, Sharpe=-0.4941, Trades=46
[INFO] Cluster 10 cluster: Short SMA=194, Long SMA=248, Sharpe=0.3759, Trades=12
[INFO] Cluster 11 cluster: Short SMA=140, Long SMA=222, Sharpe=-0.2336, Trades=12
[INFO] Cluster 12 cluster: Short SMA=260, Long SMA=284, Sharpe=0.2159, Trades=16
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=218, Long SMA=300, Sharpe=0.6533, Trades=4
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=194, Long SMA=248, Sharpe=0.3759, Trades=12
[INFO] Top 2: Short SMA=212, Long SMA=244, Sharpe=0.2443, Trades=14
[INFO] Top 3: Short SMA=260, Long SMA=284, Sharpe=0.2159, Trades=16
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 9044 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 218, Long SMA: 300
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(194/248) - Original Sharpe: 0.3759, Trades: 12
[INFO] Hierarchical cluster 2: SMA(212/244) - Original Sharpe: 0.2443, Trades: 14
[INFO] Hierarchical cluster 3: SMA(260/284) - Original Sharpe: 0.2159, Trades: 16
[INFO] Hierarchical cluster 4: SMA(112/176) - Original Sharpe: 0.1014, Trades: 14
[INFO] Hierarchical cluster 5: SMA(136/146) - Original Sharpe: -0.0149, Trades: 48
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (218/300)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (194/248) - Sharpe: 0.3759
[INFO] cluster 2: (212/244) - Sharpe: 0.2443
[INFO] cluster 3: (260/284) - Sharpe: 0.2159
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     3.716844            3.716844
1    2021-11-10 2021-11-10            41    -0.412472           -0.412472
2    2022-01-10 2022-01-10            41     4.290205            4.290205
3    2022-03-10 2022-03-10            42     0.696473            0.696473
4    2022-05-10 2022-05-10            41    -1.906913           -1.906913
5    2022-07-10 2022-07-10            44     0.008064            0.008064
6    2022-09-10 2022-09-10            43     0.059045            0.059045
7    2022-11-10 2022-11-10            40    -2.768953           -2.768953
8    2023-01-10 2023-01-10            41     0.901765            2.256055
9    2023-03-10 2023-03-10            42    -2.058673           -0.946385
10   2023-05-10 2023-05-10            40     0.600971            1.394481
11   2023-07-10 2023-07-10            44     1.747552            4.450567
12   2023-09-10 2023-09-10            44     2.993555            3.087307
13   2023-11-10 2023-11-10            40     0.817504            0.817504
14   2024-01-10 2024-01-10            41     1.290468            1.290468
15   2024-03-10 2024-03-10            43    -2.221917           -2.221917
16   2024-05-10 2024-05-10            40     2.247863            2.247863
17   2024-07-10 2024-07-10            43     0.009942            0.009942
18   2024-09-10 2024-09-10            44     0.461751            0.461751
19   2024-11-10 2024-11-10            35     0.788268            0.788268
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2022-01-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-03-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-10   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-11-10   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2023-01-10   |          0.9 |              2.3 |          1.4 | True          
[INFO] 2023-03-10   |         -2.1 |             -0.9 |          1.2 | True          
[INFO] 2023-05-10   |          0.6 |              1.4 |          0.8 | True          
[INFO] 2023-07-10   |          1.7 |              4.5 |          2.8 | True          
[INFO] 2023-09-10   |          3.0 |              3.1 |          0.1 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2024-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2022-05-10, 2022-07-10, 2022-09-10, 2022-11-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 5
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 5 periods (100.00% win rate)
[INFO] Updating Excel file with Hierarchical results for KW...
[INFO] Excel file updated successfully. Added KW with Hierarchical win rate 100.0% in row 27
[INFO] Added best Sharpe parameters 218/300 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 218, Long SMA: 300
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(194/248) - Original Sharpe: 0.3759
[INFO] Added cluster 2 to portfolio: SMA(212/244) - Original Sharpe: 0.2443
[INFO] Added cluster 3 to portfolio: SMA(260/284) - Original Sharpe: 0.2159
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KW_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.8482
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6641
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for KW...
[INFO] Excel file updated successfully. Added KW with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KW
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LC in column D: 13.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 241.96s
[INFO] Best parameters: Short SMA = 132, Long SMA = 256
[INFO] Best Sharpe ratio: 0.667366, Trades: 14
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_LC_best_132/256 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LC
[INFO] Big Point Value (from data): 400.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.44 contracts
[INFO] Maximum Position Size: 19 contracts
[INFO] Strategy Total P&L: $356,156.00
[INFO] Market Buy & Hold P&L: $19,030.00
[INFO] Outperformance: $337,126.00
[INFO] Sharpe ratio (entire period, annualized): 0.433210
[INFO] Sharpe ratio (in-sample, annualized): 0.667366
[INFO] Sharpe ratio (out-of-sample, annualized): -0.118494
[INFO] Maximum Drawdown: $172,019.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 9
[INFO] Out-of-sample period trades: 5
[INFO] Total trades: 14
[INFO] In-sample P&L: $373,813.00
[INFO] Out-of-sample P&L: $-28,163.00
[INFO] 
Best parameters from GA: Short SMA = 132, Long SMA = 256, Sharpe = 0.667366
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 400.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7424 to 0.6674
[INFO] 
Best parameters:
[INFO] Short SMA: 132
[INFO] Long SMA: 256
[INFO] Sharpe Ratio: 0.667366
[INFO] Number of Trades: 14
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7424 to 0.6674
[INFO] Trades range: 12.0 to 373.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6486 to 2.9007
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 592 elements
[INFO] Kmeans Cluster 1: 656 elements
[INFO] Kmeans Cluster 2: 901 elements
[INFO] Kmeans Cluster 3: 546 elements
[INFO] Kmeans Cluster 4: 781 elements
[INFO] Kmeans Cluster 5: 787 elements
[INFO] Kmeans Cluster 6: 781 elements
[INFO] Kmeans Cluster 7: 955 elements
[INFO] Kmeans Cluster 8: 560 elements
[INFO] Kmeans Cluster 9: 615 elements
[INFO] Kmeans Cluster 10: 483 elements
[INFO] Kmeans Cluster 11: 861 elements
[INFO] Kmeans Cluster 12: 743 elements
[INFO] Kmeans Cluster 13: 535 elements
[INFO] Kmeans Cluster 14: 231 elements
[INFO] Kmeans Cluster 15: 558 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=133.06, Long SMA=171.68, Sharpe=-0.0789
[INFO] Centroid 1: Short SMA=183.95, Long SMA=225.75, Sharpe=0.0667
[INFO] Centroid 2: Short SMA=228.55, Long SMA=278.26, Sharpe=-0.4973
[INFO] Centroid 3: Short SMA=35.36, Long SMA=75.94, Sharpe=0.1060
[INFO] Centroid 4: Short SMA=82.94, Long SMA=219.07, Sharpe=-0.0959
[INFO] Centroid 5: Short SMA=90.73, Long SMA=144.12, Sharpe=-0.3301
[INFO] Centroid 6: Short SMA=57.88, Long SMA=117.72, Sharpe=-0.1084
[INFO] Centroid 7: Short SMA=31.67, Long SMA=235.51, Sharpe=0.0033
[INFO] Centroid 8: Short SMA=170.31, Long SMA=277.74, Sharpe=-0.1967
[INFO] Centroid 9: Short SMA=115.46, Long SMA=260.72, Sharpe=0.1107
[INFO] Centroid 10: Short SMA=30.21, Long SMA=73.13, Sharpe=0.3568
[INFO] Centroid 11: Short SMA=45.20, Long SMA=174.95, Sharpe=-0.2284
[INFO] Centroid 12: Short SMA=59.60, Long SMA=284.75, Sharpe=-0.2288
[INFO] Centroid 13: Short SMA=141.07, Long SMA=244.81, Sharpe=0.4297
[INFO] Centroid 14: Short SMA=256.76, Long SMA=269.72, Sharpe=-0.2780
[INFO] Centroid 15: Short SMA=155.51, Long SMA=196.11, Sharpe=0.2570
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=132, Long SMA=256, Sharpe=0.6674, Trades=14
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=140, Long SMA=246, Sharpe=0.6600, Trades=14
[INFO] Kmeans Top 2: Short SMA=30, Long SMA=74, Sharpe=0.4100, Trades=34
[INFO] Kmeans Top 3: Short SMA=150, Long SMA=194, Sharpe=0.2206, Trades=24
[INFO] Kmeans Top 4: Short SMA=32, Long SMA=236, Sharpe=0.1492, Trades=20
[INFO] Kmeans Top 5: Short SMA=42, Long SMA=78, Sharpe=0.1457, Trades=32
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (133, 172)
[INFO]   Nearest: (134.0, 172.0)
[INFO]   Rounded: (184, 226)
[INFO]   Rounded: (229, 278)
[INFO]   Nearest: (228.0, 278.0)
[INFO]   Rounded: (35, 76)
[INFO]   Nearest: (36.0, 76.0)
[INFO]   Rounded: (83, 219)
[INFO]   Nearest: (82.0, 220.0)
[INFO]   Rounded: (91, 144)
[INFO]   Nearest: (90.0, 144.0)
[INFO]   Rounded: (58, 118)
[INFO]   Rounded: (32, 236)
[INFO]   Rounded: (170, 278)
[INFO]   Rounded: (115, 261)
[INFO]   Nearest: (116.0, 260.0)
[INFO]   Rounded: (30, 73)
[INFO]   Nearest: (30.0, 74.0)
[INFO]   Rounded: (45, 175)
[INFO]   Nearest: (46.0, 174.0)
[INFO]   Rounded: (60, 285)
[INFO]   Nearest: (60.0, 284.0)
[INFO]   Rounded: (141, 245)
[INFO]   Nearest: (142.0, 244.0)
[INFO]   Rounded: (257, 270)
[INFO]   Nearest: (256.0, 270.0)
[INFO]   Rounded: (156, 196)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 132, Long SMA: 256
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(140/246) - Original Sharpe: 0.6600, Trades: 14
[INFO] Kmeans cluster 2: SMA(30/74) - Original Sharpe: 0.4100, Trades: 34
[INFO] Kmeans cluster 3: SMA(150/194) - Original Sharpe: 0.2206, Trades: 24
[INFO] Kmeans cluster 4: SMA(32/236) - Original Sharpe: 0.1492, Trades: 20
[INFO] Kmeans cluster 5: SMA(42/78) - Original Sharpe: 0.1457, Trades: 32
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (132/256)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (140/246) - Sharpe: 0.6600
[INFO] cluster 2: (30/74) - Sharpe: 0.4100
[INFO] cluster 3: (150/194) - Sharpe: 0.2206
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.063439           -1.378957
1    2021-11-10 2021-11-10            41    -1.314198           -3.048126
2    2022-01-10 2022-01-10            41    -5.643048           -2.945744
3    2022-03-10 2022-03-10            42    -0.325669            0.906784
4    2022-05-10 2022-05-10            41     0.167451            0.167451
5    2022-07-10 2022-07-10            44    -0.540213            1.440221
6    2022-09-10 2022-09-10            43    -0.837964           -0.837964
7    2022-11-10 2022-11-10            40     0.541236            1.020531
8    2023-01-10 2023-01-10            41     1.733004            1.733004
9    2023-03-10 2023-03-10            42     1.762416            1.762416
10   2023-05-10 2023-05-10            40     4.337990            4.337990
11   2023-07-10 2023-07-10            44     1.358879            1.358879
12   2023-09-10 2023-09-10            44    -2.443328           -1.496093
13   2023-11-10 2023-11-10            40    -0.939135           -0.939135
14   2024-01-10 2024-01-10            41     4.199481            3.515262
15   2024-03-10 2024-03-10            43    -1.906869           -1.933445
16   2024-05-10 2024-05-10            40    -2.345527           -2.343545
17   2024-07-10 2024-07-10            43    -1.402768           -2.601232
18   2024-09-10 2024-09-10            44     1.583600           -0.820547
19   2024-11-10 2024-11-10            35     2.423431            2.423431
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.1 |             -1.4 |         -0.3 | False         
[INFO] 2021-11-10   |         -1.3 |             -3.0 |         -1.7 | False         
[INFO] 2022-01-10   |         -5.6 |             -2.9 |          2.7 | True          
[INFO] 2022-03-10   |         -0.3 |              0.9 |          1.2 | True          
[INFO] 2022-05-10   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.5 |              1.4 |          1.9 | True          
[INFO] 2022-09-10   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.5 |              1.0 |          0.5 | True          
[INFO] 2023-01-10   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-10   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2023-05-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2023-07-10   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -2.4 |             -1.5 |          0.9 | True          
[INFO] 2023-11-10   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-01-10   |          4.2 |              3.5 |         -0.7 | False         
[INFO] 2024-03-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2024-05-10   |         -2.3 |             -2.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |         -1.4 |             -2.6 |         -1.2 | False         
[INFO] 2024-09-10   |          1.6 |             -0.8 |         -2.4 | False         
[INFO] 2024-11-10   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-10, 2022-09-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-11-10, 2024-03-10, 2024-05-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Kmeans cluster wins (rounded comparison): 5 of 10 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for LC...
[INFO] Excel file updated successfully. Added LC with Kmeans win rate 50.0% in row 28
[INFO] Added best Sharpe parameters 132/256 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 132, Long SMA: 256
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(140/246) - Original Sharpe: 0.6600
[INFO] Added cluster 2 to portfolio: SMA(30/74) - Original Sharpe: 0.4100
[INFO] Added cluster 3 to portfolio: SMA(150/194) - Original Sharpe: 0.2206
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1812
[INFO] Kmeans Best out-of-sample Sharpe: -0.1185
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for LC...
[INFO] Excel file updated successfully. Added LC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LC
[INFO] Big Point Value: 400.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7424 to 0.6674
[INFO] 
Best parameters:
[INFO] Short SMA: 132
[INFO] Long SMA: 256
[INFO] Sharpe Ratio: 0.667366
[INFO] Number of Trades: 14
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7424 to 0.6674
[INFO] Trades range: 12.0 to 373.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6486 to 2.9007
[INFO] Scaled Trades range: -0.7810 to 17.3722
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6075
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1116 elements
[INFO] Cluster 1: 254 elements
[INFO] Cluster 2: 262 elements
[INFO] Cluster 3: 1007 elements
[INFO] Cluster 4: 1013 elements
[INFO] Cluster 5: 764 elements
[INFO] Cluster 6: 1010 elements
[INFO] Cluster 7: 1258 elements
[INFO] Cluster 8: 19 elements
[INFO] Cluster 9: 946 elements
[INFO] Cluster 10: 760 elements
[INFO] Cluster 11: 1267 elements
[INFO] Cluster 12: 89 elements
[INFO] Cluster 13: 820 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=164, Long SMA=272, Sharpe=-0.0693, Trades=13
[INFO] Cluster 1 cluster: Short SMA=144, Long SMA=148, Sharpe=-0.1692, Trades=68
[INFO] Cluster 2 cluster: Short SMA=34, Long SMA=42, Sharpe=0.4892, Trades=90
[INFO] Cluster 3 cluster: Short SMA=134, Long SMA=238, Sharpe=0.4729, Trades=14
[INFO] Cluster 4 cluster: Short SMA=228, Long SMA=278, Sharpe=-0.5234, Trades=19
[INFO] Cluster 5 cluster: Short SMA=32, Long SMA=80, Sharpe=0.3535, Trades=36
[INFO] Cluster 6 cluster: Short SMA=164, Long SMA=196, Sharpe=-0.1115, Trades=30
[INFO] Cluster 7 cluster: Short SMA=58, Long SMA=126, Sharpe=-0.1559, Trades=26
[INFO] Cluster 9 cluster: Short SMA=30, Long SMA=228, Sharpe=-0.0325, Trades=22
[INFO] Cluster 10 cluster: Short SMA=56, Long SMA=284, Sharpe=-0.1312, Trades=19
[INFO] Cluster 11 cluster: Short SMA=84, Long SMA=168, Sharpe=-0.3266, Trades=20
[INFO] Cluster 12 cluster: Short SMA=262, Long SMA=266, Sharpe=-0.0947, Trades=63
[INFO] Cluster 13 cluster: Short SMA=84, Long SMA=226, Sharpe=-0.0775, Trades=16
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=132, Long SMA=256, Sharpe=0.6674, Trades=14
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=34, Long SMA=42, Sharpe=0.4892, Trades=90
[INFO] Top 2: Short SMA=134, Long SMA=238, Sharpe=0.4729, Trades=14
[INFO] Top 3: Short SMA=32, Long SMA=80, Sharpe=0.3535, Trades=36
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 10566 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 132, Long SMA: 256
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(34/42) - Original Sharpe: 0.4892, Trades: 90
[INFO] Hierarchical cluster 2: SMA(134/238) - Original Sharpe: 0.4729, Trades: 14
[INFO] Hierarchical cluster 3: SMA(32/80) - Original Sharpe: 0.3535, Trades: 36
[INFO] Hierarchical cluster 4: SMA(30/228) - Original Sharpe: -0.0325, Trades: 22
[INFO] Hierarchical cluster 5: SMA(164/272) - Original Sharpe: -0.0693, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (132/256)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/42) - Sharpe: 0.4892
[INFO] cluster 2: (134/238) - Sharpe: 0.4729
[INFO] cluster 3: (32/80) - Sharpe: 0.3535
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.063439           -1.183667
1    2021-11-10 2021-11-10            41    -1.314198           -0.909732
2    2022-01-10 2022-01-10            41    -5.643048           -4.852552
3    2022-03-10 2022-03-10            42    -0.325669            0.613106
4    2022-05-10 2022-05-10            41     0.167451           -0.551570
5    2022-07-10 2022-07-10            44    -0.540213            2.674512
6    2022-09-10 2022-09-10            43    -0.837964           -0.318117
7    2022-11-10 2022-11-10            40     0.541236            0.928369
8    2023-01-10 2023-01-10            41     1.733004            1.733004
9    2023-03-10 2023-03-10            42     1.762416            1.762416
10   2023-05-10 2023-05-10            40     4.337990            4.337990
11   2023-07-10 2023-07-10            44     1.358879            0.560481
12   2023-09-10 2023-09-10            44    -2.443328           -1.101454
13   2023-11-10 2023-11-10            40    -0.939135            0.939135
14   2024-01-10 2024-01-10            41     4.199481            0.289498
15   2024-03-10 2024-03-10            43    -1.906869           -2.150693
16   2024-05-10 2024-05-10            40    -2.345527           -4.152621
17   2024-07-10 2024-07-10            43    -1.402768           -1.112716
18   2024-09-10 2024-09-10            44     1.583600           -3.240776
19   2024-11-10 2024-11-10            35     2.423431            3.101628
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.1 |             -1.2 |         -0.1 | False         
[INFO] 2021-11-10   |         -1.3 |             -0.9 |          0.4 | True          
[INFO] 2022-01-10   |         -5.6 |             -4.9 |          0.7 | True          
[INFO] 2022-03-10   |         -0.3 |              0.6 |          0.9 | True          
[INFO] 2022-05-10   |          0.2 |             -0.6 |         -0.8 | False         
[INFO] 2022-07-10   |         -0.5 |              2.7 |          3.2 | True          
[INFO] 2022-09-10   |         -0.8 |             -0.3 |          0.5 | True          
[INFO] 2022-11-10   |          0.5 |              0.9 |          0.4 | True          
[INFO] 2023-01-10   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-10   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2023-05-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2023-07-10   |          1.4 |              0.6 |         -0.8 | False         
[INFO] 2023-09-10   |         -2.4 |             -1.1 |          1.3 | True          
[INFO] 2023-11-10   |         -0.9 |              0.9 |          1.8 | True          
[INFO] 2024-01-10   |          4.2 |              0.3 |         -3.9 | False         
[INFO] 2024-03-10   |         -1.9 |             -2.2 |         -0.3 | False         
[INFO] 2024-05-10   |         -2.3 |             -4.2 |         -1.9 | False         
[INFO] 2024-07-10   |         -1.4 |             -1.1 |          0.3 | True          
[INFO] 2024-09-10   |          1.6 |             -3.2 |         -4.8 | False         
[INFO] 2024-11-10   |          2.4 |              3.1 |          0.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-01-10, 2023-03-10, 2023-05-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 17 periods (58.82% win rate)
[INFO] Updating Excel file with Hierarchical results for LC...
[INFO] Excel file updated successfully. Added LC with Hierarchical win rate 58.8% in row 28
[INFO] Added best Sharpe parameters 132/256 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 132, Long SMA: 256
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/42) - Original Sharpe: 0.4892
[INFO] Added cluster 2 to portfolio: SMA(134/238) - Original Sharpe: 0.4729
[INFO] Added cluster 3 to portfolio: SMA(32/80) - Original Sharpe: 0.3535
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0167
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1185
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for LC...
[INFO] Excel file updated successfully. Added LC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LC
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LH in column D: 17.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 263.45s
[INFO] Best parameters: Short SMA = 22, Long SMA = 32
[INFO] Best Sharpe ratio: 1.140809, Trades: 90
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_LH_best_22/32 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LH
[INFO] Big Point Value (from data): 400.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.56 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $871,258.00
[INFO] Market Buy & Hold P&L: $-13,970.00
[INFO] Outperformance: $885,228.00
[INFO] Sharpe ratio (entire period, annualized): 0.831820
[INFO] Sharpe ratio (in-sample, annualized): 1.140809
[INFO] Sharpe ratio (out-of-sample, annualized): 0.115284
[INFO] Maximum Drawdown: $109,300.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 60
[INFO] Out-of-sample period trades: 30
[INFO] Total trades: 90
[INFO] In-sample P&L: $656,660.00
[INFO] Out-of-sample P&L: $28,587.00
[INFO] 
Best parameters from GA: Short SMA = 22, Long SMA = 32, Sharpe = 1.140809
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 400.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8288 to 1.1408
[INFO] 
Best parameters:
[INFO] Short SMA: 22
[INFO] Long SMA: 32
[INFO] Sharpe Ratio: 1.140809
[INFO] Number of Trades: 90
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8288 to 1.1408
[INFO] Trades range: 14.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8198 to 3.1932
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 457 elements
[INFO] Kmeans Cluster 1: 754 elements
[INFO] Kmeans Cluster 2: 825 elements
[INFO] Kmeans Cluster 3: 531 elements
[INFO] Kmeans Cluster 4: 352 elements
[INFO] Kmeans Cluster 5: 760 elements
[INFO] Kmeans Cluster 6: 175 elements
[INFO] Kmeans Cluster 7: 496 elements
[INFO] Kmeans Cluster 8: 617 elements
[INFO] Kmeans Cluster 9: 678 elements
[INFO] Kmeans Cluster 10: 1127 elements
[INFO] Kmeans Cluster 11: 686 elements
[INFO] Kmeans Cluster 12: 935 elements
[INFO] Kmeans Cluster 13: 519 elements
[INFO] Kmeans Cluster 14: 375 elements
[INFO] Kmeans Cluster 15: 781 elements
[INFO] Kmeans Cluster 16: 517 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=26.46, Long SMA=274.52, Sharpe=0.0230
[INFO] Centroid 1: Short SMA=110.02, Long SMA=237.49, Sharpe=0.4106
[INFO] Centroid 2: Short SMA=63.56, Long SMA=105.89, Sharpe=-0.1611
[INFO] Centroid 3: Short SMA=171.95, Long SMA=278.26, Sharpe=-0.1994
[INFO] Centroid 4: Short SMA=17.68, Long SMA=147.22, Sharpe=0.2938
[INFO] Centroid 5: Short SMA=172.38, Long SMA=204.90, Sharpe=0.2896
[INFO] Centroid 6: Short SMA=18.59, Long SMA=38.99, Sharpe=0.6336
[INFO] Centroid 7: Short SMA=80.35, Long SMA=199.44, Sharpe=0.2338
[INFO] Centroid 8: Short SMA=30.32, Long SMA=217.35, Sharpe=0.1455
[INFO] Centroid 9: Short SMA=148.23, Long SMA=261.38, Sharpe=0.0978
[INFO] Centroid 10: Short SMA=121.22, Long SMA=170.70, Sharpe=0.5376
[INFO] Centroid 11: Short SMA=52.19, Long SMA=167.05, Sharpe=-0.2209
[INFO] Centroid 12: Short SMA=72.99, Long SMA=271.98, Sharpe=0.3590
[INFO] Centroid 13: Short SMA=237.66, Long SMA=288.14, Sharpe=-0.4974
[INFO] Centroid 14: Short SMA=23.88, Long SMA=72.96, Sharpe=0.1861
[INFO] Centroid 15: Short SMA=227.42, Long SMA=258.14, Sharpe=-0.2053
[INFO] Centroid 16: Short SMA=65.08, Long SMA=106.43, Sharpe=-0.4375
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=22, Long SMA=32, Sharpe=1.1408, Trades=90
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=20, Long SMA=40, Sharpe=0.8334, Trades=68
[INFO] Kmeans Top 2: Short SMA=120, Long SMA=170, Sharpe=0.4600, Trades=24
[INFO] Kmeans Top 3: Short SMA=110, Long SMA=238, Sharpe=0.4271, Trades=16
[INFO] Kmeans Top 4: Short SMA=172, Long SMA=206, Sharpe=0.3916, Trades=29
[INFO] Kmeans Top 5: Short SMA=72, Long SMA=272, Sharpe=0.3208, Trades=17
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (26, 275)
[INFO]   Nearest: (26.0, 274.0)
[INFO]   Rounded: (110, 237)
[INFO]   Nearest: (110.0, 238.0)
[INFO]   Rounded: (64, 106)
[INFO]   Rounded: (172, 278)
[INFO]   Rounded: (18, 147)
[INFO]   Nearest: (18.0, 148.0)
[INFO]   Rounded: (172, 205)
[INFO]   Nearest: (172.0, 204.0)
[INFO]   Rounded: (19, 39)
[INFO]   Nearest: (18.0, 38.0)
[INFO]   Rounded: (80, 199)
[INFO]   Nearest: (80.0, 200.0)
[INFO]   Rounded: (30, 217)
[INFO]   Nearest: (30.0, 218.0)
[INFO]   Rounded: (148, 261)
[INFO]   Nearest: (148.0, 262.0)
[INFO]   Rounded: (121, 171)
[INFO]   Nearest: (122.0, 170.0)
[INFO]   Rounded: (52, 167)
[INFO]   Nearest: (52.0, 168.0)
[INFO]   Rounded: (73, 272)
[INFO]   Nearest: (72.0, 272.0)
[INFO]   Rounded: (238, 288)
[INFO]   Rounded: (24, 73)
[INFO]   Nearest: (24.0, 72.0)
[INFO]   Rounded: (227, 258)
[INFO]   Nearest: (228.0, 258.0)
[INFO]   Rounded: (65, 106)
[INFO]   Nearest: (66.0, 106.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 22, Long SMA: 32
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(20/40) - Original Sharpe: 0.8334, Trades: 68
[INFO] Kmeans cluster 2: SMA(120/170) - Original Sharpe: 0.4600, Trades: 24
[INFO] Kmeans cluster 3: SMA(110/238) - Original Sharpe: 0.4271, Trades: 16
[INFO] Kmeans cluster 4: SMA(172/206) - Original Sharpe: 0.3916, Trades: 29
[INFO] Kmeans cluster 5: SMA(72/272) - Original Sharpe: 0.3208, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (22/32)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (20/40) - Sharpe: 0.8334
[INFO] cluster 2: (120/170) - Sharpe: 0.4600
[INFO] cluster 3: (110/238) - Sharpe: 0.4271
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.008190           -1.553157
1    2021-11-10 2021-11-10            41    -1.506080            1.558040
2    2022-01-10 2022-01-10            41     3.633237           -4.225110
3    2022-03-10 2022-03-10            42     2.678211           -3.023362
4    2022-05-10 2022-05-10            41    -2.014869            1.224138
5    2022-07-10 2022-07-10            44    -0.459145            0.876005
6    2022-09-10 2022-09-10            43    -0.916318           -2.119217
7    2022-11-10 2022-11-10            40     1.019050           -1.124632
8    2023-01-10 2023-01-10            41     1.244469            1.053218
9    2023-03-10 2023-03-10            42    -0.603135            1.329636
10   2023-05-10 2023-05-10            40    -0.113382           -1.483471
11   2023-07-10 2023-07-10            44    -1.828979           -0.557974
12   2023-09-10 2023-09-10            44    -0.222549           -1.260768
13   2023-11-10 2023-11-10            40    -2.248900           -1.915411
14   2024-01-10 2024-01-10            41     1.763493            0.781942
15   2024-03-10 2024-03-10            43    -2.111027           -2.564174
16   2024-05-10 2024-05-10            40     3.837640           -3.821002
17   2024-07-10 2024-07-10            43    -1.589393           -0.273109
18   2024-09-10 2024-09-10            44     3.096245           -3.096245
19   2024-11-10 2024-11-10            35     0.304872           -3.697005
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.0 |             -1.6 |         -0.6 | False         
[INFO] 2021-11-10   |         -1.5 |              1.6 |          3.1 | True          
[INFO] 2022-01-10   |          3.6 |             -4.2 |         -7.8 | False         
[INFO] 2022-03-10   |          2.7 |             -3.0 |         -5.7 | False         
[INFO] 2022-05-10   |         -2.0 |              1.2 |          3.2 | True          
[INFO] 2022-07-10   |         -0.5 |              0.9 |          1.4 | True          
[INFO] 2022-09-10   |         -0.9 |             -2.1 |         -1.2 | False         
[INFO] 2022-11-10   |          1.0 |             -1.1 |         -2.1 | False         
[INFO] 2023-01-10   |          1.2 |              1.1 |         -0.1 | False         
[INFO] 2023-03-10   |         -0.6 |              1.3 |          1.9 | True          
[INFO] 2023-05-10   |         -0.1 |             -1.5 |         -1.4 | False         
[INFO] 2023-07-10   |         -1.8 |             -0.6 |          1.2 | True          
[INFO] 2023-09-10   |         -0.2 |             -1.3 |         -1.1 | False         
[INFO] 2023-11-10   |         -2.2 |             -1.9 |          0.3 | True          
[INFO] 2024-01-10   |          1.8 |              0.8 |         -1.0 | False         
[INFO] 2024-03-10   |         -2.1 |             -2.6 |         -0.5 | False         
[INFO] 2024-05-10   |          3.8 |             -3.8 |         -7.6 | False         
[INFO] 2024-07-10   |         -1.6 |             -0.3 |          1.3 | True          
[INFO] 2024-09-10   |          3.1 |             -3.1 |         -6.2 | False         
[INFO] 2024-11-10   |          0.3 |             -3.7 |         -4.0 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 7 of 20 periods (35.00% win rate)
[INFO] Updating Excel file with Kmeans results for LH...
[INFO] Excel file updated successfully. Added LH with Kmeans win rate 35.0% in row 29
[INFO] Added best Sharpe parameters 22/32 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 22, Long SMA: 32
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(20/40) - Original Sharpe: 0.8334
[INFO] Added cluster 2 to portfolio: SMA(120/170) - Original Sharpe: 0.4600
[INFO] Added cluster 3 to portfolio: SMA(110/238) - Original Sharpe: 0.4271
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LH_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.9184
[INFO] Kmeans Best out-of-sample Sharpe: 0.1153
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for LH...
[INFO] Excel file updated successfully. Added LH with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LH
[INFO] Big Point Value: 400.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8288 to 1.1408
[INFO] 
Best parameters:
[INFO] Short SMA: 22
[INFO] Long SMA: 32
[INFO] Sharpe Ratio: 1.140809
[INFO] Number of Trades: 90
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8288 to 1.1408
[INFO] Trades range: 14.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8198 to 3.1932
[INFO] Scaled Trades range: -0.8013 to 17.3999
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5787
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 18
[INFO] Using 18 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 18 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 83 elements
[INFO] Cluster 1: 349 elements
[INFO] Cluster 2: 1350 elements
[INFO] Cluster 3: 829 elements
[INFO] Cluster 4: 244 elements
[INFO] Cluster 5: 905 elements
[INFO] Cluster 6: 538 elements
[INFO] Cluster 7: 1240 elements
[INFO] Cluster 8: 168 elements
[INFO] Cluster 9: 417 elements
[INFO] Cluster 10: 15 elements
[INFO] Cluster 11: 584 elements
[INFO] Cluster 12: 730 elements
[INFO] Cluster 13: 942 elements
[INFO] Cluster 14: 390 elements
[INFO] Cluster 15: 703 elements
[INFO] Cluster 16: 394 elements
[INFO] Cluster 17: 704 elements
[INFO] Using 17 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=46, Long SMA=48, Sharpe=0.1164, Trades=127
[INFO] Cluster 1 cluster: Short SMA=80, Long SMA=90, Sharpe=-0.1687, Trades=54
[INFO] Cluster 2 cluster: Short SMA=120, Long SMA=184, Sharpe=0.4205, Trades=22
[INFO] Cluster 3 cluster: Short SMA=44, Long SMA=164, Sharpe=-0.1725, Trades=24
[INFO] Cluster 4 cluster: Short SMA=176, Long SMA=182, Sharpe=0.4396, Trades=55
[INFO] Cluster 5 cluster: Short SMA=214, Long SMA=272, Sharpe=-0.2958, Trades=21
[INFO] Cluster 6 cluster: Short SMA=254, Long SMA=268, Sharpe=-0.3689, Trades=37
[INFO] Cluster 7 cluster: Short SMA=76, Long SMA=264, Sharpe=0.4094, Trades=17
[INFO] Cluster 8 cluster: Short SMA=20, Long SMA=42, Sharpe=0.8576, Trades=70
[INFO] Cluster 9 cluster: Short SMA=18, Long SMA=178, Sharpe=0.2276, Trades=34
[INFO] Cluster 11 cluster: Short SMA=24, Long SMA=260, Sharpe=-0.1372, Trades=26
[INFO] Cluster 12 cluster: Short SMA=168, Long SMA=262, Sharpe=-0.1257, Trades=18
[INFO] Cluster 13 cluster: Short SMA=64, Long SMA=122, Sharpe=-0.2132, Trades=30
[INFO] Cluster 14 cluster: Short SMA=26, Long SMA=78, Sharpe=0.0964, Trades=41
[INFO] Cluster 15 cluster: Short SMA=68, Long SMA=212, Sharpe=0.3697, Trades=20
[INFO] Cluster 16 cluster: Short SMA=168, Long SMA=200, Sharpe=0.4670, Trades=29
[INFO] Cluster 17 cluster: Short SMA=132, Long SMA=266, Sharpe=0.1781, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=22, Long SMA=32, Sharpe=1.1408, Trades=90
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=20, Long SMA=42, Sharpe=0.8576, Trades=70
[INFO] Top 2: Short SMA=168, Long SMA=200, Sharpe=0.4670, Trades=29
[INFO] Top 3: Short SMA=176, Long SMA=182, Sharpe=0.4396, Trades=55
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 17 valid clusters with clusters
[INFO] Filtering to 10570 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 22, Long SMA: 32
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(20/42) - Original Sharpe: 0.8576, Trades: 70
[INFO] Hierarchical cluster 2: SMA(168/200) - Original Sharpe: 0.4670, Trades: 29
[INFO] Hierarchical cluster 3: SMA(176/182) - Original Sharpe: 0.4396, Trades: 55
[INFO] Hierarchical cluster 4: SMA(120/184) - Original Sharpe: 0.4205, Trades: 22
[INFO] Hierarchical cluster 5: SMA(76/264) - Original Sharpe: 0.4094, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (22/32)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (20/42) - Sharpe: 0.8576
[INFO] cluster 2: (168/200) - Sharpe: 0.4670
[INFO] cluster 3: (176/182) - Sharpe: 0.4396
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.008190           -1.698107
1    2021-11-10 2021-11-10            41    -1.506080            0.204778
2    2022-01-10 2022-01-10            41     3.633237           -4.616955
3    2022-03-10 2022-03-10            42     2.678211            1.009162
4    2022-05-10 2022-05-10            41    -2.014869           -4.807766
5    2022-07-10 2022-07-10            44    -0.459145            0.765956
6    2022-09-10 2022-09-10            43    -0.916318            0.465571
7    2022-11-10 2022-11-10            40     1.019050            1.571520
8    2023-01-10 2023-01-10            41     1.244469           -0.257210
9    2023-03-10 2023-03-10            42    -0.603135           -0.911111
10   2023-05-10 2023-05-10            40    -0.113382           -1.483471
11   2023-07-10 2023-07-10            44    -1.828979           -0.827304
12   2023-09-10 2023-09-10            44    -0.222549           -1.187195
13   2023-11-10 2023-11-10            40    -2.248900            1.366681
14   2024-01-10 2024-01-10            41     1.763493            2.480553
15   2024-03-10 2024-03-10            43    -2.111027           -0.101754
16   2024-05-10 2024-05-10            40     3.837640            4.027169
17   2024-07-10 2024-07-10            43    -1.589393            0.632558
18   2024-09-10 2024-09-10            44     3.096245            2.556322
19   2024-11-10 2024-11-10            35     0.304872            1.912519
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.0 |             -1.7 |         -0.7 | False         
[INFO] 2021-11-10   |         -1.5 |              0.2 |          1.7 | True          
[INFO] 2022-01-10   |          3.6 |             -4.6 |         -8.2 | False         
[INFO] 2022-03-10   |          2.7 |              1.0 |         -1.7 | False         
[INFO] 2022-05-10   |         -2.0 |             -4.8 |         -2.8 | False         
[INFO] 2022-07-10   |         -0.5 |              0.8 |          1.3 | True          
[INFO] 2022-09-10   |         -0.9 |              0.5 |          1.4 | True          
[INFO] 2022-11-10   |          1.0 |              1.6 |          0.6 | True          
[INFO] 2023-01-10   |          1.2 |             -0.3 |         -1.5 | False         
[INFO] 2023-03-10   |         -0.6 |             -0.9 |         -0.3 | False         
[INFO] 2023-05-10   |         -0.1 |             -1.5 |         -1.4 | False         
[INFO] 2023-07-10   |         -1.8 |             -0.8 |          1.0 | True          
[INFO] 2023-09-10   |         -0.2 |             -1.2 |         -1.0 | False         
[INFO] 2023-11-10   |         -2.2 |              1.4 |          3.6 | True          
[INFO] 2024-01-10   |          1.8 |              2.5 |          0.7 | True          
[INFO] 2024-03-10   |         -2.1 |             -0.1 |          2.0 | True          
[INFO] 2024-05-10   |          3.8 |              4.0 |          0.2 | True          
[INFO] 2024-07-10   |         -1.6 |              0.6 |          2.2 | True          
[INFO] 2024-09-10   |          3.1 |              2.6 |         -0.5 | False         
[INFO] 2024-11-10   |          0.3 |              1.9 |          1.6 | True          
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 20 periods (55.00% win rate)
[INFO] Updating Excel file with Hierarchical results for LH...
[INFO] Excel file updated successfully. Added LH with Hierarchical win rate 55.0% in row 29
[INFO] Added best Sharpe parameters 22/32 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 22, Long SMA: 32
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(20/42) - Original Sharpe: 0.8576
[INFO] Added cluster 2 to portfolio: SMA(168/200) - Original Sharpe: 0.4670
[INFO] Added cluster 3 to portfolio: SMA(176/182) - Original Sharpe: 0.4396
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LH_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2351
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1153
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for LH...
[INFO] Excel file updated successfully. Added LH with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LH
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LJ in column D: 23.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 238.60s
[INFO] Best parameters: Short SMA = 172, Long SMA = 190
[INFO] Best Sharpe ratio: 0.861463, Trades: 28
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_LJ_best_172/190 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LJ=124XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.10 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $545,114.00
[INFO] Market Buy & Hold P&L: $-2,180.00
[INFO] Outperformance: $547,294.00
[INFO] Sharpe ratio (entire period, annualized): 0.754097
[INFO] Sharpe ratio (in-sample, annualized): 0.861463
[INFO] Sharpe ratio (out-of-sample, annualized): 0.523110
[INFO] Maximum Drawdown: $104,670.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 20
[INFO] Out-of-sample period trades: 8
[INFO] Total trades: 28
[INFO] In-sample P&L: $425,552.00
[INFO] Out-of-sample P&L: $119,562.00
[INFO] 
Best parameters from GA: Short SMA = 172, Long SMA = 190, Sharpe = 0.861463
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 23.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7953 to 0.8615
[INFO] 
Best parameters:
[INFO] Short SMA: 172
[INFO] Long SMA: 190
[INFO] Sharpe Ratio: 0.861463
[INFO] Number of Trades: 28
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8464 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7953 to 0.8615
[INFO] Trades range: 11.0 to 309.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2926 to 2.6050
[INFO] Scaled Long SMA range: -2.6485 to 1.7059
[INFO] Scaled Sharpe ratio range: -3.8027 to 2.9913
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 903 elements
[INFO] Kmeans Cluster 1: 545 elements
[INFO] Kmeans Cluster 2: 561 elements
[INFO] Kmeans Cluster 3: 552 elements
[INFO] Kmeans Cluster 4: 442 elements
[INFO] Kmeans Cluster 5: 636 elements
[INFO] Kmeans Cluster 6: 661 elements
[INFO] Kmeans Cluster 7: 464 elements
[INFO] Kmeans Cluster 8: 333 elements
[INFO] Kmeans Cluster 9: 768 elements
[INFO] Kmeans Cluster 10: 799 elements
[INFO] Kmeans Cluster 11: 562 elements
[INFO] Kmeans Cluster 12: 469 elements
[INFO] Kmeans Cluster 13: 181 elements
[INFO] Kmeans Cluster 14: 588 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=117.45, Long SMA=198.29, Sharpe=0.4718
[INFO] Centroid 1: Short SMA=87.20, Long SMA=126.08, Sharpe=-0.0209
[INFO] Centroid 2: Short SMA=158.37, Long SMA=228.52, Sharpe=0.3140
[INFO] Centroid 3: Short SMA=25.91, Long SMA=265.36, Sharpe=0.1810
[INFO] Centroid 4: Short SMA=110.27, Long SMA=156.18, Sharpe=0.2136
[INFO] Centroid 5: Short SMA=59.08, Long SMA=105.30, Sharpe=-0.2209
[INFO] Centroid 6: Short SMA=41.01, Long SMA=194.91, Sharpe=0.0912
[INFO] Centroid 7: Short SMA=159.58, Long SMA=186.44, Sharpe=0.6023
[INFO] Centroid 8: Short SMA=204.84, Long SMA=236.77, Sharpe=-0.1784
[INFO] Centroid 9: Short SMA=245.60, Long SMA=278.74, Sharpe=0.1964
[INFO] Centroid 10: Short SMA=36.22, Long SMA=150.03, Sharpe=-0.1091
[INFO] Centroid 11: Short SMA=199.58, Long SMA=257.35, Sharpe=0.0268
[INFO] Centroid 12: Short SMA=60.11, Long SMA=220.39, Sharpe=0.3101
[INFO] Centroid 13: Short SMA=28.14, Long SMA=45.22, Sharpe=-0.2596
[INFO] Centroid 14: Short SMA=30.87, Long SMA=70.18, Sharpe=0.0285
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=172, Long SMA=190, Sharpe=0.8615, Trades=28
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=160, Long SMA=186, Sharpe=0.5351, Trades=24
[INFO] Kmeans Top 2: Short SMA=116, Long SMA=198, Sharpe=0.5133, Trades=15
[INFO] Kmeans Top 3: Short SMA=60, Long SMA=220, Sharpe=0.3998, Trades=11
[INFO] Kmeans Top 4: Short SMA=158, Long SMA=230, Sharpe=0.3570, Trades=13
[INFO] Kmeans Top 5: Short SMA=246, Long SMA=280, Sharpe=0.3352, Trades=17
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (117, 198)
[INFO]   Nearest: (118.0, 198.0)
[INFO]   Rounded: (87, 126)
[INFO]   Nearest: (88.0, 126.0)
[INFO]   Rounded: (158, 229)
[INFO]   Nearest: (158.0, 228.0)
[INFO]   Rounded: (26, 265)
[INFO]   Nearest: (26.0, 266.0)
[INFO]   Rounded: (110, 156)
[INFO]   Rounded: (59, 105)
[INFO]   Nearest: (60.0, 106.0)
[INFO]   Rounded: (41, 195)
[INFO]   Nearest: (42.0, 194.0)
[INFO]   Rounded: (160, 186)
[INFO]   Rounded: (205, 237)
[INFO]   Nearest: (204.0, 236.0)
[INFO]   Rounded: (246, 279)
[INFO]   Nearest: (246.0, 278.0)
[INFO]   Rounded: (36, 150)
[INFO]   Rounded: (200, 257)
[INFO]   Nearest: (200.0, 258.0)
[INFO]   Rounded: (60, 220)
[INFO]   Rounded: (28, 45)
[INFO]   Nearest: (28.0, 46.0)
[INFO]   Rounded: (31, 70)
[INFO]   Nearest: (30.0, 70.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 172, Long SMA: 190
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(160/186) - Original Sharpe: 0.5351, Trades: 24
[INFO] Kmeans cluster 2: SMA(116/198) - Original Sharpe: 0.5133, Trades: 15
[INFO] Kmeans cluster 3: SMA(60/220) - Original Sharpe: 0.3998, Trades: 11
[INFO] Kmeans cluster 4: SMA(158/230) - Original Sharpe: 0.3570, Trades: 13
[INFO] Kmeans cluster 5: SMA(246/280) - Original Sharpe: 0.3352, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2555
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (172/190)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (160/186) - Sharpe: 0.5351
[INFO] cluster 2: (116/198) - Sharpe: 0.5133
[INFO] cluster 3: (60/220) - Sharpe: 0.3998
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Out-of-sample period starts on: 2021-12-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-14 2021-12-14            41    -6.476923            0.600009
1    2022-02-14 2022-02-14            43     1.142795            0.082297
2    2022-04-14 2022-04-14            38     3.803073            3.803073
3    2022-06-14 2022-06-14            44    -1.477996           -1.477996
4    2022-08-14 2022-08-14            42     5.820882            5.820882
5    2022-10-14 2022-10-14            43    -3.029340           -3.029340
6    2022-12-14 2022-12-14            41     0.007038            0.007038
7    2023-02-14 2023-02-14            41    -0.235977           -0.235977
8    2023-04-14 2023-04-14            40     2.608255            2.389964
9    2023-06-14 2023-06-14            43     2.317082            0.429916
10   2023-08-14 2023-08-14            44    -0.537988           -0.537988
11   2023-10-14 2023-10-14            43    -2.449401           -2.449401
12   2023-12-14 2023-12-14            41     1.911555           -0.060349
13   2024-02-14 2024-02-14            41     0.151095            0.510807
14   2024-04-14 2024-04-14            42     0.082220            0.082220
15   2024-06-14 2024-06-14            43     1.909439            0.208979
16   2024-08-14 2024-08-14            42     1.064357            2.617361
17   2024-10-14 2024-10-14            45     0.185180           -1.412823
18   2024-12-14 2024-12-14            10     6.740598            7.957100
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-14   |         -6.5 |              0.6 |          7.1 | True          
[INFO] 2022-02-14   |          1.1 |              0.1 |         -1.0 | False         
[INFO] 2022-04-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-06-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-08-14   |          5.8 |              5.8 |          0.0 | Excluded      
[INFO] 2022-10-14   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-12-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-02-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-04-14   |          2.6 |              2.4 |         -0.2 | False         
[INFO] 2023-06-14   |          2.3 |              0.4 |         -1.9 | False         
[INFO] 2023-08-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2023-10-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2023-12-14   |          1.9 |             -0.1 |         -2.0 | False         
[INFO] 2024-02-14   |          0.2 |              0.5 |          0.3 | True          
[INFO] 2024-04-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-06-14   |          1.9 |              0.2 |         -1.7 | False         
[INFO] 2024-08-14   |          1.1 |              2.6 |          1.5 | True          
[INFO] 2024-10-14   |          0.2 |             -1.4 |         -1.6 | False         
[INFO] 2024-12-14   |          6.7 |              8.0 |          1.3 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-14, 2022-06-14, 2022-08-14, 2022-10-14, 2022-12-14, 2023-02-14, 2023-08-14, 2023-10-14, 2024-04-14
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Kmeans cluster wins (rounded comparison): 4 of 10 periods (40.00% win rate)
[INFO] Updating Excel file with Kmeans results for LJ...
[INFO] Excel file updated successfully. Added LJ with Kmeans win rate 40.0% in row 30
[INFO] Added best Sharpe parameters 172/190 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 172, Long SMA: 190
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(160/186) - Original Sharpe: 0.5351
[INFO] Added cluster 2 to portfolio: SMA(116/198) - Original Sharpe: 0.5133
[INFO] Added cluster 3 to portfolio: SMA(60/220) - Original Sharpe: 0.3998
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LJ_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3894
[INFO] Kmeans Best out-of-sample Sharpe: 0.5231
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for LJ...
[INFO] Excel file updated successfully. Added LJ with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LJ
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 23.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7953 to 0.8615
[INFO] 
Best parameters:
[INFO] Short SMA: 172
[INFO] Long SMA: 190
[INFO] Sharpe Ratio: 0.861463
[INFO] Number of Trades: 28
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8464 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7953 to 0.8615
[INFO] Trades range: 11.0 to 309.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2926 to 2.6050
[INFO] Scaled Long SMA range: -2.6485 to 1.7059
[INFO] Scaled Sharpe ratio range: -3.8027 to 2.9913
[INFO] Scaled Trades range: -0.7273 to 14.6134
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8464 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5887
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1261 elements
[INFO] Cluster 1: 277 elements
[INFO] Cluster 2: 200 elements
[INFO] Cluster 3: 204 elements
[INFO] Cluster 4: 840 elements
[INFO] Cluster 5: 324 elements
[INFO] Cluster 6: 605 elements
[INFO] Cluster 7: 824 elements
[INFO] Cluster 8: 542 elements
[INFO] Cluster 9: 1048 elements
[INFO] Cluster 10: 381 elements
[INFO] Cluster 11: 60 elements
[INFO] Cluster 12: 575 elements
[INFO] Cluster 13: 501 elements
[INFO] Cluster 14: 11 elements
[INFO] Cluster 15: 436 elements
[INFO] Cluster 16: 375 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=52, Long SMA=142, Sharpe=-0.1897, Trades=23
[INFO] Cluster 1 cluster: Short SMA=162, Long SMA=174, Sharpe=0.6656, Trades=32
[INFO] Cluster 2 cluster: Short SMA=28, Long SMA=42, Sharpe=0.2340, Trades=80
[INFO] Cluster 3 cluster: Short SMA=68, Long SMA=76, Sharpe=-0.2835, Trades=61
[INFO] Cluster 4 cluster: Short SMA=44, Long SMA=196, Sharpe=0.1481, Trades=17
[INFO] Cluster 5 cluster: Short SMA=206, Long SMA=236, Sharpe=-0.2708, Trades=21
[INFO] Cluster 6 cluster: Short SMA=58, Long SMA=102, Sharpe=-0.0806, Trades=29
[INFO] Cluster 7 cluster: Short SMA=206, Long SMA=268, Sharpe=-0.0026, Trades=15
[INFO] Cluster 8 cluster: Short SMA=256, Long SMA=278, Sharpe=0.3006, Trades=21
[INFO] Cluster 9 cluster: Short SMA=126, Long SMA=196, Sharpe=0.3805, Trades=17
[INFO] Cluster 10 cluster: Short SMA=108, Long SMA=156, Sharpe=0.3105, Trades=19
[INFO] Cluster 11 cluster: Short SMA=30, Long SMA=34, Sharpe=0.0721, Trades=134
[INFO] Cluster 12 cluster: Short SMA=152, Long SMA=230, Sharpe=0.4229, Trades=11
[INFO] Cluster 13 cluster: Short SMA=24, Long SMA=270, Sharpe=0.1570, Trades=17
[INFO] Cluster 15 cluster: Short SMA=26, Long SMA=78, Sharpe=0.0019, Trades=41
[INFO] Cluster 16 cluster: Short SMA=56, Long SMA=230, Sharpe=0.3815, Trades=11
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=172, Long SMA=190, Sharpe=0.8615, Trades=28
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=162, Long SMA=174, Sharpe=0.6656, Trades=32
[INFO] Top 2: Short SMA=152, Long SMA=230, Sharpe=0.4229, Trades=11
[INFO] Top 3: Short SMA=56, Long SMA=230, Sharpe=0.3815, Trades=11
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 8453 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 172, Long SMA: 190
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(162/174) - Original Sharpe: 0.6656, Trades: 32
[INFO] Hierarchical cluster 2: SMA(152/230) - Original Sharpe: 0.4229, Trades: 11
[INFO] Hierarchical cluster 3: SMA(56/230) - Original Sharpe: 0.3815, Trades: 11
[INFO] Hierarchical cluster 4: SMA(126/196) - Original Sharpe: 0.3805, Trades: 17
[INFO] Hierarchical cluster 5: SMA(108/156) - Original Sharpe: 0.3105, Trades: 19
[INFO] Trimmed warm-up period. Evaluation data length: 2555
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (172/190)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (162/174) - Sharpe: 0.6656
[INFO] cluster 2: (152/230) - Sharpe: 0.4229
[INFO] cluster 3: (56/230) - Sharpe: 0.3815
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Out-of-sample period starts on: 2021-12-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-14 2021-12-14            41    -6.476923           -4.347720
1    2022-02-14 2022-02-14            43     1.142795            0.067536
2    2022-04-14 2022-04-14            38     3.803073            3.803073
3    2022-06-14 2022-06-14            44    -1.477996           -1.477996
4    2022-08-14 2022-08-14            42     5.820882            5.820882
5    2022-10-14 2022-10-14            43    -3.029340           -3.029340
6    2022-12-14 2022-12-14            41     0.007038            0.007038
7    2023-02-14 2023-02-14            41    -0.235977           -0.235977
8    2023-04-14 2023-04-14            40     2.608255            4.362797
9    2023-06-14 2023-06-14            43     2.317082            0.797934
10   2023-08-14 2023-08-14            44    -0.537988           -0.537988
11   2023-10-14 2023-10-14            43    -2.449401           -2.449401
12   2023-12-14 2023-12-14            41     1.911555            0.251619
13   2024-02-14 2024-02-14            41     0.151095           -0.675326
14   2024-04-14 2024-04-14            42     0.082220            0.082220
15   2024-06-14 2024-06-14            43     1.909439            1.485880
16   2024-08-14 2024-08-14            42     1.064357            1.342731
17   2024-10-14 2024-10-14            45     0.185180           -1.150712
18   2024-12-14 2024-12-14            10     6.740598            6.892484
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-14   |         -6.5 |             -4.3 |          2.2 | True          
[INFO] 2022-02-14   |          1.1 |              0.1 |         -1.0 | False         
[INFO] 2022-04-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-06-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-08-14   |          5.8 |              5.8 |          0.0 | Excluded      
[INFO] 2022-10-14   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-12-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-02-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-04-14   |          2.6 |              4.4 |          1.8 | True          
[INFO] 2023-06-14   |          2.3 |              0.8 |         -1.5 | False         
[INFO] 2023-08-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2023-10-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2023-12-14   |          1.9 |              0.3 |         -1.6 | False         
[INFO] 2024-02-14   |          0.2 |             -0.7 |         -0.9 | False         
[INFO] 2024-04-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-06-14   |          1.9 |              1.5 |         -0.4 | False         
[INFO] 2024-08-14   |          1.1 |              1.3 |          0.2 | True          
[INFO] 2024-10-14   |          0.2 |             -1.2 |         -1.4 | False         
[INFO] 2024-12-14   |          6.7 |              6.9 |          0.2 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-14, 2022-06-14, 2022-08-14, 2022-10-14, 2022-12-14, 2023-02-14, 2023-08-14, 2023-10-14, 2024-04-14
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 10 periods (40.00% win rate)
[INFO] Updating Excel file with Hierarchical results for LJ...
[INFO] Excel file updated successfully. Added LJ with Hierarchical win rate 40.0% in row 30
[INFO] Added best Sharpe parameters 172/190 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 172, Long SMA: 190
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(162/174) - Original Sharpe: 0.6656
[INFO] Added cluster 2 to portfolio: SMA(152/230) - Original Sharpe: 0.4229
[INFO] Added cluster 3 to portfolio: SMA(56/230) - Original Sharpe: 0.3815
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LJ_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.4036
[INFO] Hierarchical Best out-of-sample Sharpe: 0.5231
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for LJ...
[INFO] Excel file updated successfully. Added LJ with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LJ
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LZ in column D: 15.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 273.13s
[INFO] Best parameters: Short SMA = 156, Long SMA = 158
[INFO] Best Sharpe ratio: 0.626081, Trades: 79
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_LZ_best_156/158 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LZ=104XC
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 7.62 contracts
[INFO] Maximum Position Size: 14 contracts
[INFO] Strategy Total P&L: $281,140.00
[INFO] Market Buy & Hold P&L: $28,760.00
[INFO] Outperformance: $252,380.00
[INFO] Sharpe ratio (entire period, annualized): 0.390068
[INFO] Sharpe ratio (in-sample, annualized): 0.626081
[INFO] Sharpe ratio (out-of-sample, annualized): -0.194681
[INFO] Maximum Drawdown: $178,945.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 50
[INFO] Out-of-sample period trades: 29
[INFO] Total trades: 79
[INFO] In-sample P&L: $321,435.00
[INFO] Out-of-sample P&L: $-40,295.00
[INFO] 
Best parameters from GA: Short SMA = 156, Long SMA = 158, Sharpe = 0.626081
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.3217 to 0.6261
[INFO] 
Best parameters:
[INFO] Short SMA: 156
[INFO] Long SMA: 158
[INFO] Sharpe Ratio: 0.626081
[INFO] Number of Trades: 79
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10332 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.3217 to 0.6261
[INFO] Trades range: 10.0 to 307.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3792 to 2.8477
[INFO] Scaled Long SMA range: -2.7903 to 1.4416
[INFO] Scaled Sharpe ratio range: -6.1933 to 4.3052
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 922 elements
[INFO] Kmeans Cluster 1: 556 elements
[INFO] Kmeans Cluster 2: 555 elements
[INFO] Kmeans Cluster 3: 587 elements
[INFO] Kmeans Cluster 4: 162 elements
[INFO] Kmeans Cluster 5: 670 elements
[INFO] Kmeans Cluster 6: 650 elements
[INFO] Kmeans Cluster 7: 553 elements
[INFO] Kmeans Cluster 8: 592 elements
[INFO] Kmeans Cluster 9: 808 elements
[INFO] Kmeans Cluster 10: 739 elements
[INFO] Kmeans Cluster 11: 172 elements
[INFO] Kmeans Cluster 12: 831 elements
[INFO] Kmeans Cluster 13: 797 elements
[INFO] Kmeans Cluster 14: 847 elements
[INFO] Kmeans Cluster 15: 420 elements
[INFO] Kmeans Cluster 16: 471 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=134.92, Long SMA=269.63, Sharpe=-0.3060
[INFO] Centroid 1: Short SMA=37.59, Long SMA=74.93, Sharpe=-0.2537
[INFO] Centroid 2: Short SMA=24.46, Long SMA=166.61, Sharpe=0.1338
[INFO] Centroid 3: Short SMA=253.57, Long SMA=278.79, Sharpe=-0.1985
[INFO] Centroid 4: Short SMA=148.63, Long SMA=174.54, Sharpe=0.3553
[INFO] Centroid 5: Short SMA=85.58, Long SMA=128.26, Sharpe=-0.4946
[INFO] Centroid 6: Short SMA=109.46, Long SMA=198.06, Sharpe=-0.0568
[INFO] Centroid 7: Short SMA=33.69, Long SMA=100.08, Sharpe=-0.0431
[INFO] Centroid 8: Short SMA=22.18, Long SMA=249.21, Sharpe=0.0266
[INFO] Centroid 9: Short SMA=75.89, Long SMA=266.07, Sharpe=-0.1649
[INFO] Centroid 10: Short SMA=88.35, Long SMA=141.27, Sharpe=-0.3112
[INFO] Centroid 11: Short SMA=23.77, Long SMA=51.35, Sharpe=-0.5070
[INFO] Centroid 12: Short SMA=207.71, Long SMA=256.31, Sharpe=-0.0698
[INFO] Centroid 13: Short SMA=157.59, Long SMA=226.51, Sharpe=-0.2173
[INFO] Centroid 14: Short SMA=61.31, Long SMA=197.93, Sharpe=-0.2101
[INFO] Centroid 15: Short SMA=56.56, Long SMA=272.54, Sharpe=-0.3740
[INFO] Centroid 16: Short SMA=164.58, Long SMA=191.88, Sharpe=0.0375
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=156, Long SMA=158, Sharpe=0.6261, Trades=79
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=148, Long SMA=174, Sharpe=0.4225, Trades=23
[INFO] Kmeans Top 2: Short SMA=24, Long SMA=168, Sharpe=0.1985, Trades=19
[INFO] Kmeans Top 3: Short SMA=22, Long SMA=248, Sharpe=0.1568, Trades=16
[INFO] Kmeans Top 4: Short SMA=166, Long SMA=192, Sharpe=0.1139, Trades=22
[INFO] Kmeans Top 5: Short SMA=208, Long SMA=256, Sharpe=0.0506, Trades=16
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (135, 270)
[INFO]   Nearest: (134.0, 270.0)
[INFO]   Rounded: (38, 75)
[INFO]   Nearest: (38.0, 74.0)
[INFO]   Rounded: (24, 167)
[INFO]   Nearest: (24.0, 166.0)
[INFO]   Rounded: (254, 279)
[INFO]   Nearest: (254.0, 278.0)
[INFO]   Rounded: (149, 175)
[INFO]   Nearest: (148.0, 174.0)
[INFO]   Rounded: (86, 128)
[INFO]   Rounded: (109, 198)
[INFO]   Nearest: (110.0, 198.0)
[INFO]   Rounded: (34, 100)
[INFO]   Rounded: (22, 249)
[INFO]   Nearest: (22.0, 250.0)
[INFO]   Rounded: (76, 266)
[INFO]   Rounded: (88, 141)
[INFO]   Nearest: (88.0, 142.0)
[INFO]   Rounded: (24, 51)
[INFO]   Nearest: (24.0, 52.0)
[INFO]   Rounded: (208, 256)
[INFO]   Rounded: (158, 227)
[INFO]   Nearest: (158.0, 226.0)
[INFO]   Rounded: (61, 198)
[INFO]   Nearest: (62.0, 198.0)
[INFO]   Rounded: (57, 273)
[INFO]   Nearest: (56.0, 272.0)
[INFO]   Rounded: (165, 192)
[INFO]   Nearest: (164.0, 192.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 156, Long SMA: 158
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(148/174) - Original Sharpe: 0.4225, Trades: 23
[INFO] Kmeans cluster 2: SMA(24/168) - Original Sharpe: 0.1985, Trades: 19
[INFO] Kmeans cluster 3: SMA(22/248) - Original Sharpe: 0.1568, Trades: 16
[INFO] Kmeans cluster 4: SMA(166/192) - Original Sharpe: 0.1139, Trades: 22
[INFO] Kmeans cluster 5: SMA(208/256) - Original Sharpe: 0.0506, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2544
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (156/158)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (148/174) - Sharpe: 0.4225
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Out-of-sample period starts on: 2021-12-17
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-17 2021-12-17            41     2.102424            2.102424
1    2022-02-17 2022-02-17            41    -0.193263           -0.193263
2    2022-04-17 2022-04-17            40    -2.414653           -2.414653
3    2022-06-17 2022-06-17            43     3.471248            3.471248
4    2022-08-17 2022-08-17            41     5.752319            0.260738
5    2022-10-17 2022-10-17            45     0.507784            3.983255
6    2022-12-17 2022-12-17            41     1.439696           -1.059509
7    2023-02-17 2023-02-17            39    -5.196104           -1.698496
8    2023-04-17 2023-04-17            42    -1.914640           -1.914640
9    2023-06-17 2023-06-17            43    -1.864618           -1.864618
10   2023-08-17 2023-08-17            42    -3.026053           -0.337220
11   2023-10-17 2023-10-17            44     2.645057            0.447216
12   2023-12-17 2023-12-17            42     2.127559            3.104874
13   2024-02-17 2024-02-17            40    -5.080096           -3.423521
14   2024-04-17 2024-04-17            41    -1.461984            2.231963
15   2024-06-17 2024-06-17            45     0.717903            0.717903
16   2024-08-17 2024-08-17            42     0.001423            0.001423
17   2024-10-17 2024-10-17            43    -0.391047           -1.160801
18   2024-12-17 2024-12-17             9     7.439225            0.325660
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-17   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2022-02-17   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-04-17   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2022-06-17   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-08-17   |          5.8 |              0.3 |         -5.5 | False         
[INFO] 2022-10-17   |          0.5 |              4.0 |          3.5 | True          
[INFO] 2022-12-17   |          1.4 |             -1.1 |         -2.5 | False         
[INFO] 2023-02-17   |         -5.2 |             -1.7 |          3.5 | True          
[INFO] 2023-04-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-06-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-08-17   |         -3.0 |             -0.3 |          2.7 | True          
[INFO] 2023-10-17   |          2.6 |              0.4 |         -2.2 | False         
[INFO] 2023-12-17   |          2.1 |              3.1 |          1.0 | True          
[INFO] 2024-02-17   |         -5.1 |             -3.4 |          1.7 | True          
[INFO] 2024-04-17   |         -1.5 |              2.2 |          3.7 | True          
[INFO] 2024-06-17   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-08-17   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-10-17   |         -0.4 |             -1.2 |         -0.8 | False         
[INFO] 2024-12-17   |          7.4 |              0.3 |         -7.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-12-17, 2022-02-17, 2022-04-17, 2022-06-17, 2023-04-17, 2023-06-17, 2024-06-17, 2024-08-17
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Kmeans cluster wins (rounded comparison): 6 of 11 periods (54.55% win rate)
[INFO] Updating Excel file with Kmeans results for LZ...
[INFO] Excel file updated successfully. Added LZ with Kmeans win rate 54.5% in row 31
[INFO] Added best Sharpe parameters 156/158 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 156, Long SMA: 158
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(148/174) - Original Sharpe: 0.4225
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LZ_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0054
[INFO] Kmeans Best out-of-sample Sharpe: -0.1947
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for LZ...
[INFO] Excel file updated successfully. Added LZ with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LZ
[INFO] Big Point Value: 10.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.3217 to 0.6261
[INFO] 
Best parameters:
[INFO] Short SMA: 156
[INFO] Long SMA: 158
[INFO] Sharpe Ratio: 0.626081
[INFO] Number of Trades: 79
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10332 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.3217 to 0.6261
[INFO] Trades range: 10.0 to 307.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3792 to 2.8477
[INFO] Scaled Long SMA range: -2.7903 to 1.4416
[INFO] Scaled Sharpe ratio range: -6.1933 to 4.3052
[INFO] Scaled Trades range: -0.6646 to 14.0601
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10332 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5137
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1457 elements
[INFO] Cluster 1: 1165 elements
[INFO] Cluster 2: 59 elements
[INFO] Cluster 3: 472 elements
[INFO] Cluster 4: 714 elements
[INFO] Cluster 5: 842 elements
[INFO] Cluster 6: 724 elements
[INFO] Cluster 7: 624 elements
[INFO] Cluster 8: 414 elements
[INFO] Cluster 9: 909 elements
[INFO] Cluster 10: 535 elements
[INFO] Cluster 11: 886 elements
[INFO] Cluster 12: 144 elements
[INFO] Cluster 13: 416 elements
[INFO] Cluster 14: 971 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=224, Long SMA=266, Sharpe=-0.1489, Trades=14
[INFO] Cluster 1 cluster: Short SMA=82, Long SMA=200, Sharpe=-0.1711, Trades=13
[INFO] Cluster 2 cluster: Short SMA=24, Long SMA=28, Sharpe=-0.2060, Trades=160
[INFO] Cluster 3 cluster: Short SMA=24, Long SMA=58, Sharpe=-0.3327, Trades=68
[INFO] Cluster 4 cluster: Short SMA=22, Long SMA=238, Sharpe=0.0831, Trades=18
[INFO] Cluster 5 cluster: Short SMA=86, Long SMA=132, Sharpe=-0.5241, Trades=29
[INFO] Cluster 6 cluster: Short SMA=148, Long SMA=220, Sharpe=-0.2259, Trades=12
[INFO] Cluster 7 cluster: Short SMA=164, Long SMA=192, Sharpe=-0.0080, Trades=24
[INFO] Cluster 8 cluster: Short SMA=32, Long SMA=84, Sharpe=0.0133, Trades=39
[INFO] Cluster 9 cluster: Short SMA=78, Long SMA=264, Sharpe=-0.1401, Trades=12
[INFO] Cluster 10 cluster: Short SMA=24, Long SMA=152, Sharpe=0.2864, Trades=23
[INFO] Cluster 11 cluster: Short SMA=70, Long SMA=144, Sharpe=-0.3836, Trades=23
[INFO] Cluster 12 cluster: Short SMA=148, Long SMA=176, Sharpe=0.3247, Trades=23
[INFO] Cluster 13 cluster: Short SMA=56, Long SMA=274, Sharpe=-0.3749, Trades=12
[INFO] Cluster 14 cluster: Short SMA=138, Long SMA=266, Sharpe=-0.2705, Trades=10
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=156, Long SMA=158, Sharpe=0.6261, Trades=79
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=148, Long SMA=176, Sharpe=0.3247, Trades=23
[INFO] Top 2: Short SMA=24, Long SMA=152, Sharpe=0.2864, Trades=23
[INFO] Top 3: Short SMA=22, Long SMA=238, Sharpe=0.0831, Trades=18
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10332 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 156, Long SMA: 158
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(148/176) - Original Sharpe: 0.3247, Trades: 23
[INFO] Hierarchical cluster 2: SMA(24/152) - Original Sharpe: 0.2864, Trades: 23
[INFO] Hierarchical cluster 3: SMA(22/238) - Original Sharpe: 0.0831, Trades: 18
[INFO] Hierarchical cluster 4: SMA(32/84) - Original Sharpe: 0.0133, Trades: 39
[INFO] Hierarchical cluster 5: SMA(164/192) - Original Sharpe: -0.0080, Trades: 24
[INFO] Trimmed warm-up period. Evaluation data length: 2544
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (156/158)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (148/176) - Sharpe: 0.3247
[INFO] cluster 2: (24/152) - Sharpe: 0.2864
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Out-of-sample period starts on: 2021-12-17
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-17 2021-12-17            41     2.102424            2.102424
1    2022-02-17 2022-02-17            41    -0.193263           -0.193263
2    2022-04-17 2022-04-17            40    -2.414653           -2.414653
3    2022-06-17 2022-06-17            43     3.471248            1.680553
4    2022-08-17 2022-08-17            41     5.752319           -1.556899
5    2022-10-17 2022-10-17            45     0.507784           -3.204914
6    2022-12-17 2022-12-17            41     1.439696            4.750448
7    2023-02-17 2023-02-17            39    -5.196104           -1.698496
8    2023-04-17 2023-04-17            42    -1.914640           -2.200436
9    2023-06-17 2023-06-17            43    -1.864618            0.000000
10   2023-08-17 2023-08-17            42    -3.026053           -0.741711
11   2023-10-17 2023-10-17            44     2.645057            0.447216
12   2023-12-17 2023-12-17            42     2.127559           -2.026376
13   2024-02-17 2024-02-17            40    -5.080096           -0.075535
14   2024-04-17 2024-04-17            41    -1.461984            2.231963
15   2024-06-17 2024-06-17            45     0.717903            0.717903
16   2024-08-17 2024-08-17            42     0.001423            0.001423
17   2024-10-17 2024-10-17            43    -0.391047           -2.895293
18   2024-12-17 2024-12-17             9     7.439225            2.322661
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-17   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2022-02-17   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-04-17   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2022-06-17   |          3.5 |              1.7 |         -1.8 | False         
[INFO] 2022-08-17   |          5.8 |             -1.6 |         -7.4 | False         
[INFO] 2022-10-17   |          0.5 |             -3.2 |         -3.7 | False         
[INFO] 2022-12-17   |          1.4 |              4.8 |          3.4 | True          
[INFO] 2023-02-17   |         -5.2 |             -1.7 |          3.5 | True          
[INFO] 2023-04-17   |         -1.9 |             -2.2 |         -0.3 | False         
[INFO] 2023-06-17   |         -1.9 |              0.0 |          1.9 | True          
[INFO] 2023-08-17   |         -3.0 |             -0.7 |          2.3 | True          
[INFO] 2023-10-17   |          2.6 |              0.4 |         -2.2 | False         
[INFO] 2023-12-17   |          2.1 |             -2.0 |         -4.1 | False         
[INFO] 2024-02-17   |         -5.1 |             -0.1 |          5.0 | True          
[INFO] 2024-04-17   |         -1.5 |              2.2 |          3.7 | True          
[INFO] 2024-06-17   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-08-17   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-10-17   |         -0.4 |             -2.9 |         -2.5 | False         
[INFO] 2024-12-17   |          7.4 |              2.3 |         -5.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-12-17, 2022-02-17, 2022-04-17, 2024-06-17, 2024-08-17
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 14 periods (42.86% win rate)
[INFO] Updating Excel file with Hierarchical results for LZ...
[INFO] Excel file updated successfully. Added LZ with Hierarchical win rate 42.9% in row 31
[INFO] Added best Sharpe parameters 156/158 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 156, Long SMA: 158
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(148/176) - Original Sharpe: 0.3247
[INFO] Added cluster 2 to portfolio: SMA(24/152) - Original Sharpe: 0.2864
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LZ_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2527
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1947
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for LZ...
[INFO] Excel file updated successfully. Added LZ with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LZ
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for MME in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 270.06s
[INFO] Best parameters: Short SMA = 42, Long SMA = 46
[INFO] Best Sharpe ratio: 0.770410, Trades: 114
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_MME_best_42/46 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @MME=103XC
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.01 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $461,080.00
[INFO] Market Buy & Hold P&L: $4,740.00
[INFO] Outperformance: $456,340.00
[INFO] Sharpe ratio (entire period, annualized): 0.635182
[INFO] Sharpe ratio (in-sample, annualized): 0.770410
[INFO] Sharpe ratio (out-of-sample, annualized): 0.299055
[INFO] Maximum Drawdown: $136,680.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 72
[INFO] Out-of-sample period trades: 42
[INFO] Total trades: 114
[INFO] In-sample P&L: $450,370.00
[INFO] Out-of-sample P&L: $70,150.00
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 46, Sharpe = 0.770410
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8268 to 0.7704
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.770410
[INFO] Number of Trades: 114
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8268 to 0.7704
[INFO] Trades range: 11.0 to 345.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.3786 to 3.2235
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 624 elements
[INFO] Kmeans Cluster 1: 559 elements
[INFO] Kmeans Cluster 2: 961 elements
[INFO] Kmeans Cluster 3: 705 elements
[INFO] Kmeans Cluster 4: 1084 elements
[INFO] Kmeans Cluster 5: 497 elements
[INFO] Kmeans Cluster 6: 605 elements
[INFO] Kmeans Cluster 7: 605 elements
[INFO] Kmeans Cluster 8: 1147 elements
[INFO] Kmeans Cluster 9: 883 elements
[INFO] Kmeans Cluster 10: 472 elements
[INFO] Kmeans Cluster 11: 480 elements
[INFO] Kmeans Cluster 12: 489 elements
[INFO] Kmeans Cluster 13: 681 elements
[INFO] Kmeans Cluster 14: 793 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=106.01, Long SMA=168.14, Sharpe=-0.5233
[INFO] Centroid 1: Short SMA=200.06, Long SMA=275.15, Sharpe=0.1833
[INFO] Centroid 2: Short SMA=47.13, Long SMA=180.25, Sharpe=-0.0760
[INFO] Centroid 3: Short SMA=29.18, Long SMA=108.42, Sharpe=0.2099
[INFO] Centroid 4: Short SMA=170.98, Long SMA=220.95, Sharpe=-0.0307
[INFO] Centroid 5: Short SMA=222.41, Long SMA=252.95, Sharpe=0.3924
[INFO] Centroid 6: Short SMA=138.55, Long SMA=181.43, Sharpe=-0.2535
[INFO] Centroid 7: Short SMA=89.95, Long SMA=223.16, Sharpe=-0.3110
[INFO] Centroid 8: Short SMA=129.56, Long SMA=267.46, Sharpe=0.0653
[INFO] Centroid 9: Short SMA=29.77, Long SMA=240.38, Sharpe=0.0989
[INFO] Centroid 10: Short SMA=26.15, Long SMA=56.24, Sharpe=0.4607
[INFO] Centroid 11: Short SMA=252.25, Long SMA=286.80, Sharpe=0.0398
[INFO] Centroid 12: Short SMA=87.15, Long SMA=114.14, Sharpe=-0.2294
[INFO] Centroid 13: Short SMA=64.22, Long SMA=120.50, Sharpe=0.0120
[INFO] Centroid 14: Short SMA=61.90, Long SMA=277.22, Sharpe=-0.0846
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=46, Sharpe=0.7704, Trades=114
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=26, Long SMA=54, Sharpe=0.6102, Trades=52
[INFO] Kmeans Top 2: Short SMA=222, Long SMA=250, Sharpe=0.4589, Trades=25
[INFO] Kmeans Top 3: Short SMA=30, Long SMA=106, Sharpe=0.3317, Trades=29
[INFO] Kmeans Top 4: Short SMA=200, Long SMA=280, Sharpe=0.3146, Trades=13
[INFO] Kmeans Top 5: Short SMA=254, Long SMA=286, Sharpe=0.0990, Trades=23
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (106, 168)
[INFO]   Rounded: (200, 275)
[INFO]   Nearest: (200.0, 276.0)
[INFO]   Rounded: (47, 180)
[INFO]   Nearest: (48.0, 180.0)
[INFO]   Rounded: (29, 108)
[INFO]   Nearest: (30.0, 108.0)
[INFO]   Rounded: (171, 221)
[INFO]   Nearest: (170.0, 220.0)
[INFO]   Rounded: (222, 253)
[INFO]   Nearest: (222.0, 252.0)
[INFO]   Rounded: (139, 181)
[INFO]   Nearest: (138.0, 182.0)
[INFO]   Rounded: (90, 223)
[INFO]   Nearest: (90.0, 224.0)
[INFO]   Rounded: (130, 267)
[INFO]   Nearest: (130.0, 268.0)
[INFO]   Rounded: (30, 240)
[INFO]   Rounded: (26, 56)
[INFO]   Rounded: (252, 287)
[INFO]   Nearest: (252.0, 286.0)
[INFO]   Rounded: (87, 114)
[INFO]   Nearest: (88.0, 114.0)
[INFO]   Rounded: (64, 120)
[INFO]   Rounded: (62, 277)
[INFO]   Nearest: (62.0, 278.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(26/54) - Original Sharpe: 0.6102, Trades: 52
[INFO] Kmeans cluster 2: SMA(222/250) - Original Sharpe: 0.4589, Trades: 25
[INFO] Kmeans cluster 3: SMA(30/106) - Original Sharpe: 0.3317, Trades: 29
[INFO] Kmeans cluster 4: SMA(200/280) - Original Sharpe: 0.3146, Trades: 13
[INFO] Kmeans cluster 5: SMA(254/286) - Original Sharpe: 0.0990, Trades: 23
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (26/54) - Sharpe: 0.6102
[INFO] cluster 2: (222/250) - Sharpe: 0.4589
[INFO] cluster 3: (30/106) - Sharpe: 0.3317
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.361742            0.809020
1    2021-11-14 2021-11-14            43    -1.602839           -2.601413
2    2022-01-14 2022-01-14            41     4.130644            4.721786
3    2022-03-14 2022-03-14            44     1.862130            1.111719
4    2022-05-14 2022-05-14            43    -1.126816            0.878780
5    2022-07-14 2022-07-14            44     1.988272            0.034208
6    2022-09-14 2022-09-14            43    -0.246838            0.784738
7    2022-11-14 2022-11-14            43     3.722936            1.453665
8    2023-01-14 2023-01-14            41    -3.722520           -0.900589
9    2023-03-14 2023-03-14            44    -1.448805            0.873625
10   2023-05-14 2023-05-14            44    -0.138874           -2.690770
11   2023-07-14 2023-07-14            44    -1.008814           -4.281467
12   2023-09-14 2023-09-14            43     1.221874            1.221874
13   2023-11-14 2023-11-14            42    -0.797839           -2.295547
14   2024-01-14 2024-01-14            43     0.255477            1.903671
15   2024-03-14 2024-03-14            42     0.482175           -1.089376
16   2024-05-14 2024-05-14            44     0.027624            2.210477
17   2024-07-14 2024-07-14            45     2.029233           -2.012170
18   2024-09-14 2024-09-14            43    -1.061167            0.176821
19   2024-11-14 2024-11-14            33     1.867323            0.892668
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |              0.8 |          1.2 | True          
[INFO] 2021-11-14   |         -1.6 |             -2.6 |         -1.0 | False         
[INFO] 2022-01-14   |          4.1 |              4.7 |          0.6 | True          
[INFO] 2022-03-14   |          1.9 |              1.1 |         -0.8 | False         
[INFO] 2022-05-14   |         -1.1 |              0.9 |          2.0 | True          
[INFO] 2022-07-14   |          2.0 |              0.0 |         -2.0 | False         
[INFO] 2022-09-14   |         -0.2 |              0.8 |          1.0 | True          
[INFO] 2022-11-14   |          3.7 |              1.5 |         -2.2 | False         
[INFO] 2023-01-14   |         -3.7 |             -0.9 |          2.8 | True          
[INFO] 2023-03-14   |         -1.4 |              0.9 |          2.3 | True          
[INFO] 2023-05-14   |         -0.1 |             -2.7 |         -2.6 | False         
[INFO] 2023-07-14   |         -1.0 |             -4.3 |         -3.3 | False         
[INFO] 2023-09-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -0.8 |             -2.3 |         -1.5 | False         
[INFO] 2024-01-14   |          0.3 |              1.9 |          1.6 | True          
[INFO] 2024-03-14   |          0.5 |             -1.1 |         -1.6 | False         
[INFO] 2024-05-14   |          0.0 |              2.2 |          2.2 | True          
[INFO] 2024-07-14   |          2.0 |             -2.0 |         -4.0 | False         
[INFO] 2024-09-14   |         -1.1 |              0.2 |          1.3 | True          
[INFO] 2024-11-14   |          1.9 |              0.9 |         -1.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 9 of 19 periods (47.37% win rate)
[INFO] Updating Excel file with Kmeans results for MME...
[INFO] Excel file updated successfully. Added MME with Kmeans win rate 47.4% in row 32
[INFO] Added best Sharpe parameters 42/46 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 46
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(26/54) - Original Sharpe: 0.6102
[INFO] Added cluster 2 to portfolio: SMA(222/250) - Original Sharpe: 0.4589
[INFO] Added cluster 3 to portfolio: SMA(30/106) - Original Sharpe: 0.3317
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MME_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0395
[INFO] Kmeans Best out-of-sample Sharpe: 0.2991
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for MME...
[INFO] Excel file updated successfully. Added MME with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MME
[INFO] Big Point Value: 50.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8268 to 0.7704
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.770410
[INFO] Number of Trades: 114
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8268 to 0.7704
[INFO] Trades range: 11.0 to 345.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.3786 to 3.2235
[INFO] Scaled Trades range: -0.7680 to 16.8676
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4956
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1240 elements
[INFO] Cluster 1: 1719 elements
[INFO] Cluster 2: 954 elements
[INFO] Cluster 3: 355 elements
[INFO] Cluster 4: 1441 elements
[INFO] Cluster 5: 480 elements
[INFO] Cluster 6: 26 elements
[INFO] Cluster 7: 1108 elements
[INFO] Cluster 8: 1493 elements
[INFO] Cluster 9: 129 elements
[INFO] Cluster 10: 99 elements
[INFO] Cluster 11: 755 elements
[INFO] Cluster 12: 520 elements
[INFO] Cluster 13: 266 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=220, Long SMA=280, Sharpe=0.1173, Trades=17
[INFO] Cluster 1 cluster: Short SMA=160, Long SMA=226, Sharpe=0.0290, Trades=17
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=118, Sharpe=0.0220, Trades=29
[INFO] Cluster 3 cluster: Short SMA=106, Long SMA=112, Sharpe=-0.0012, Trades=58
[INFO] Cluster 4 cluster: Short SMA=42, Long SMA=258, Sharpe=0.0330, Trades=19
[INFO] Cluster 5 cluster: Short SMA=22, Long SMA=62, Sharpe=0.6444, Trades=52
[INFO] Cluster 6 cluster: Short SMA=14, Long SMA=18, Sharpe=-0.2851, Trades=210
[INFO] Cluster 7 cluster: Short SMA=98, Long SMA=212, Sharpe=-0.2801, Trades=17
[INFO] Cluster 8 cluster: Short SMA=60, Long SMA=152, Sharpe=-0.1305, Trades=20
[INFO] Cluster 9 cluster: Short SMA=230, Long SMA=234, Sharpe=0.4738, Trades=61
[INFO] Cluster 10 cluster: Short SMA=30, Long SMA=36, Sharpe=0.3153, Trades=117
[INFO] Cluster 11 cluster: Short SMA=116, Long SMA=272, Sharpe=-0.0441, Trades=15
[INFO] Cluster 12 cluster: Short SMA=112, Long SMA=160, Sharpe=-0.6850, Trades=22
[INFO] Cluster 13 cluster: Short SMA=222, Long SMA=244, Sharpe=0.5770, Trades=27
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=46, Sharpe=0.7704, Trades=114
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=22, Long SMA=62, Sharpe=0.6444, Trades=52
[INFO] Top 2: Short SMA=222, Long SMA=244, Sharpe=0.5770, Trades=27
[INFO] Top 3: Short SMA=230, Long SMA=234, Sharpe=0.4738, Trades=61
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(22/62) - Original Sharpe: 0.6444, Trades: 52
[INFO] Hierarchical cluster 2: SMA(222/244) - Original Sharpe: 0.5770, Trades: 27
[INFO] Hierarchical cluster 3: SMA(230/234) - Original Sharpe: 0.4738, Trades: 61
[INFO] Hierarchical cluster 4: SMA(30/36) - Original Sharpe: 0.3153, Trades: 117
[INFO] Hierarchical cluster 5: SMA(220/280) - Original Sharpe: 0.1173, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (22/62) - Sharpe: 0.6444
[INFO] cluster 2: (222/244) - Sharpe: 0.5770
[INFO] cluster 3: (230/234) - Sharpe: 0.4738
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.361742            0.941168
1    2021-11-14 2021-11-14            43    -1.602839           -3.405553
2    2022-01-14 2022-01-14            41     4.130644            4.109708
3    2022-03-14 2022-03-14            44     1.862130            1.111719
4    2022-05-14 2022-05-14            43    -1.126816            0.878780
5    2022-07-14 2022-07-14            44     1.988272            0.010442
6    2022-09-14 2022-09-14            43    -0.246838            0.693882
7    2022-11-14 2022-11-14            43     3.722936           -1.543773
8    2023-01-14 2023-01-14            41    -3.722520            4.240075
9    2023-03-14 2023-03-14            44    -1.448805           -0.709784
10   2023-05-14 2023-05-14            44    -0.138874           -3.026655
11   2023-07-14 2023-07-14            44    -1.008814           -3.845351
12   2023-09-14 2023-09-14            43     1.221874           -0.650014
13   2023-11-14 2023-11-14            42    -0.797839            0.370336
14   2024-01-14 2024-01-14            43     0.255477            0.665944
15   2024-03-14 2024-03-14            42     0.482175           -1.379321
16   2024-05-14 2024-05-14            44     0.027624            2.033926
17   2024-07-14 2024-07-14            45     2.029233           -3.236040
18   2024-09-14 2024-09-14            43    -1.061167           -0.386227
19   2024-11-14 2024-11-14            33     1.867323           -2.243918
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |              0.9 |          1.3 | True          
[INFO] 2021-11-14   |         -1.6 |             -3.4 |         -1.8 | False         
[INFO] 2022-01-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          1.9 |              1.1 |         -0.8 | False         
[INFO] 2022-05-14   |         -1.1 |              0.9 |          2.0 | True          
[INFO] 2022-07-14   |          2.0 |              0.0 |         -2.0 | False         
[INFO] 2022-09-14   |         -0.2 |              0.7 |          0.9 | True          
[INFO] 2022-11-14   |          3.7 |             -1.5 |         -5.2 | False         
[INFO] 2023-01-14   |         -3.7 |              4.2 |          7.9 | True          
[INFO] 2023-03-14   |         -1.4 |             -0.7 |          0.7 | True          
[INFO] 2023-05-14   |         -0.1 |             -3.0 |         -2.9 | False         
[INFO] 2023-07-14   |         -1.0 |             -3.8 |         -2.8 | False         
[INFO] 2023-09-14   |          1.2 |             -0.7 |         -1.9 | False         
[INFO] 2023-11-14   |         -0.8 |              0.4 |          1.2 | True          
[INFO] 2024-01-14   |          0.3 |              0.7 |          0.4 | True          
[INFO] 2024-03-14   |          0.5 |             -1.4 |         -1.9 | False         
[INFO] 2024-05-14   |          0.0 |              2.0 |          2.0 | True          
[INFO] 2024-07-14   |          2.0 |             -3.2 |         -5.2 | False         
[INFO] 2024-09-14   |         -1.1 |             -0.4 |          0.7 | True          
[INFO] 2024-11-14   |          1.9 |             -2.2 |         -4.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 9 of 19 periods (47.37% win rate)
[INFO] Updating Excel file with Hierarchical results for MME...
[INFO] Excel file updated successfully. Added MME with Hierarchical win rate 47.4% in row 32
[INFO] Added best Sharpe parameters 42/46 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 46
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(22/62) - Original Sharpe: 0.6444
[INFO] Added cluster 2 to portfolio: SMA(222/244) - Original Sharpe: 0.5770
[INFO] Added cluster 3 to portfolio: SMA(230/234) - Original Sharpe: 0.4738
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MME_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2412
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2991
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for MME...
[INFO] Excel file updated successfully. Added MME with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MME
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for MP1 in column D: 8.5
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 256.16s
[INFO] Best parameters: Short SMA = 134, Long SMA = 138
[INFO] Best Sharpe ratio: 0.532081, Trades: 69
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_MP1_best_134/138 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @MP1
[INFO] Big Point Value (from data): 500000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 21.52 contracts
[INFO] Maximum Position Size: 40 contracts
[INFO] Strategy Total P&L: $332,152.00
[INFO] Market Buy & Hold P&L: $-645.00
[INFO] Outperformance: $332,797.00
[INFO] Sharpe ratio (entire period, annualized): 0.421251
[INFO] Sharpe ratio (in-sample, annualized): 0.532081
[INFO] Sharpe ratio (out-of-sample, annualized): 0.165051
[INFO] Maximum Drawdown: $177,843.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 52
[INFO] Out-of-sample period trades: 17
[INFO] Total trades: 69
[INFO] In-sample P&L: $272,899.50
[INFO] Out-of-sample P&L: $36,643.00
[INFO] 
Best parameters from GA: Short SMA = 134, Long SMA = 138, Sharpe = 0.532081
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 500000.0
[INFO] Slippage: 8.5
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8335 to 0.5321
[INFO] 
Best parameters:
[INFO] Short SMA: 134
[INFO] Long SMA: 138
[INFO] Sharpe Ratio: 0.532081
[INFO] Number of Trades: 69
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10439 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8335 to 0.5321
[INFO] Trades range: 10.0 to 324.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3869 to 2.7871
[INFO] Scaled Long SMA range: -2.7944 to 1.4240
[INFO] Scaled Sharpe ratio range: -3.2705 to 3.1456
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 952 elements
[INFO] Kmeans Cluster 1: 723 elements
[INFO] Kmeans Cluster 2: 593 elements
[INFO] Kmeans Cluster 3: 761 elements
[INFO] Kmeans Cluster 4: 801 elements
[INFO] Kmeans Cluster 5: 380 elements
[INFO] Kmeans Cluster 6: 255 elements
[INFO] Kmeans Cluster 7: 654 elements
[INFO] Kmeans Cluster 8: 652 elements
[INFO] Kmeans Cluster 9: 85 elements
[INFO] Kmeans Cluster 10: 706 elements
[INFO] Kmeans Cluster 11: 657 elements
[INFO] Kmeans Cluster 12: 756 elements
[INFO] Kmeans Cluster 13: 663 elements
[INFO] Kmeans Cluster 14: 454 elements
[INFO] Kmeans Cluster 15: 524 elements
[INFO] Kmeans Cluster 16: 823 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=57.81, Long SMA=212.25, Sharpe=-0.1485
[INFO] Centroid 1: Short SMA=172.45, Long SMA=218.90, Sharpe=-0.3370
[INFO] Centroid 2: Short SMA=127.28, Long SMA=186.26, Sharpe=0.2624
[INFO] Centroid 3: Short SMA=51.55, Long SMA=148.16, Sharpe=-0.1805
[INFO] Centroid 4: Short SMA=213.21, Long SMA=258.23, Sharpe=-0.4431
[INFO] Centroid 5: Short SMA=17.72, Long SMA=156.28, Sharpe=0.1336
[INFO] Centroid 6: Short SMA=22.73, Long SMA=52.85, Sharpe=0.1406
[INFO] Centroid 7: Short SMA=25.12, Long SMA=255.09, Sharpe=0.0283
[INFO] Centroid 8: Short SMA=172.27, Long SMA=274.30, Sharpe=-0.4643
[INFO] Centroid 9: Short SMA=281.44, Long SMA=293.88, Sharpe=0.2512
[INFO] Centroid 10: Short SMA=119.46, Long SMA=256.66, Sharpe=-0.2064
[INFO] Centroid 11: Short SMA=65.13, Long SMA=98.06, Sharpe=-0.3280
[INFO] Centroid 12: Short SMA=125.47, Long SMA=191.91, Sharpe=0.0812
[INFO] Centroid 13: Short SMA=95.61, Long SMA=147.13, Sharpe=-0.0507
[INFO] Centroid 14: Short SMA=249.89, Long SMA=278.08, Sharpe=-0.1873
[INFO] Centroid 15: Short SMA=31.29, Long SMA=76.44, Sharpe=-0.0903
[INFO] Centroid 16: Short SMA=70.11, Long SMA=277.42, Sharpe=-0.0859
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=134, Long SMA=138, Sharpe=0.5321, Trades=69
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=282, Long SMA=294, Sharpe=0.3671, Trades=36
[INFO] Kmeans Top 2: Short SMA=126, Long SMA=188, Sharpe=0.3523, Trades=14
[INFO] Kmeans Top 3: Short SMA=18, Long SMA=156, Sharpe=0.2276, Trades=21
[INFO] Kmeans Top 4: Short SMA=134, Long SMA=196, Sharpe=0.1654, Trades=14
[INFO] Kmeans Top 5: Short SMA=24, Long SMA=52, Sharpe=0.1632, Trades=55
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (58, 212)
[INFO]   Rounded: (172, 219)
[INFO]   Nearest: (172.0, 218.0)
[INFO]   Rounded: (127, 186)
[INFO]   Nearest: (128.0, 186.0)
[INFO]   Rounded: (52, 148)
[INFO]   Rounded: (213, 258)
[INFO]   Nearest: (214.0, 258.0)
[INFO]   Rounded: (18, 156)
[INFO]   Rounded: (23, 53)
[INFO]   Nearest: (22.0, 52.0)
[INFO]   Rounded: (25, 255)
[INFO]   Nearest: (26.0, 256.0)
[INFO]   Rounded: (172, 274)
[INFO]   Rounded: (281, 294)
[INFO]   Nearest: (282.0, 294.0)
[INFO]   Rounded: (119, 257)
[INFO]   Nearest: (120.0, 256.0)
[INFO]   Rounded: (65, 98)
[INFO]   Nearest: (66.0, 98.0)
[INFO]   Rounded: (125, 192)
[INFO]   Nearest: (126.0, 192.0)
[INFO]   Rounded: (96, 147)
[INFO]   Nearest: (96.0, 148.0)
[INFO]   Rounded: (250, 278)
[INFO]   Rounded: (31, 76)
[INFO]   Nearest: (32.0, 76.0)
[INFO]   Rounded: (70, 277)
[INFO]   Nearest: (70.0, 278.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 134, Long SMA: 138
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(282/294) - Original Sharpe: 0.3671, Trades: 36
[INFO] Kmeans cluster 2: SMA(126/188) - Original Sharpe: 0.3523, Trades: 14
[INFO] Kmeans cluster 3: SMA(18/156) - Original Sharpe: 0.2276, Trades: 21
[INFO] Kmeans cluster 4: SMA(134/196) - Original Sharpe: 0.1654, Trades: 14
[INFO] Kmeans cluster 5: SMA(24/52) - Original Sharpe: 0.1632, Trades: 55
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (134/138)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (282/294) - Sharpe: 0.3671
[INFO] cluster 2: (126/188) - Sharpe: 0.3523
[INFO] cluster 3: (18/156) - Sharpe: 0.2276
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.716042           -3.523470
1    2021-11-14 2021-11-14            43    -1.188262           -2.685968
2    2022-01-14 2022-01-14            41    -0.404804            0.894983
3    2022-03-14 2022-03-14            44    -3.078018            1.135182
4    2022-05-14 2022-05-14            43    -1.026268           -1.026268
5    2022-07-14 2022-07-14            44     2.174461            2.174461
6    2022-09-14 2022-09-14            43     2.833979            2.833979
7    2022-11-14 2022-11-14            43     2.673356            2.849639
8    2023-01-14 2023-01-14            41     0.249214            0.249214
9    2023-03-14 2023-03-14            44     4.663682            4.663682
10   2023-05-14 2023-05-14            44     3.615384            3.615384
11   2023-07-14 2023-07-14            44    -0.398216           -0.398216
12   2023-09-14 2023-09-14            43    -1.304784           -2.656085
13   2023-11-14 2023-11-14            42     3.397164            2.708785
14   2024-01-14 2024-01-14            43    -3.986215            2.512948
15   2024-03-14 2024-03-14            42    -0.165280           -0.165280
16   2024-05-14 2024-05-14            44    -1.994953           -3.296351
17   2024-07-14 2024-07-14            45    -0.809966           -2.853760
18   2024-09-14 2024-09-14            43     2.955873            0.562988
19   2024-11-14 2024-11-14            33     0.878530            3.502426
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |             -3.5 |         -1.8 | False         
[INFO] 2021-11-14   |         -1.2 |             -2.7 |         -1.5 | False         
[INFO] 2022-01-14   |         -0.4 |              0.9 |          1.3 | True          
[INFO] 2022-03-14   |         -3.1 |              1.1 |          4.2 | True          
[INFO] 2022-05-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.7 |              2.8 |          0.1 | True          
[INFO] 2023-01-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          4.7 |              4.7 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.3 |             -2.7 |         -1.4 | False         
[INFO] 2023-11-14   |          3.4 |              2.7 |         -0.7 | False         
[INFO] 2024-01-14   |         -4.0 |              2.5 |          6.5 | True          
[INFO] 2024-03-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -2.0 |             -3.3 |         -1.3 | False         
[INFO] 2024-07-14   |         -0.8 |             -2.9 |         -2.1 | False         
[INFO] 2024-09-14   |          3.0 |              0.6 |         -2.4 | False         
[INFO] 2024-11-14   |          0.9 |              3.5 |          2.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2022-07-14, 2022-09-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 5 of 12 periods (41.67% win rate)
[INFO] Updating Excel file with Kmeans results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Kmeans win rate 41.7% in row 33
[INFO] Added best Sharpe parameters 134/138 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 134, Long SMA: 138
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(282/294) - Original Sharpe: 0.3671
[INFO] Added cluster 2 to portfolio: SMA(126/188) - Original Sharpe: 0.3523
[INFO] Added cluster 3 to portfolio: SMA(18/156) - Original Sharpe: 0.2276
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MP1_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.4869
[INFO] Kmeans Best out-of-sample Sharpe: 0.1651
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MP1
[INFO] Big Point Value: 500000.0
[INFO] Slippage: 8.5
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8335 to 0.5321
[INFO] 
Best parameters:
[INFO] Short SMA: 134
[INFO] Long SMA: 138
[INFO] Sharpe Ratio: 0.532081
[INFO] Number of Trades: 69
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10439 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8335 to 0.5321
[INFO] Trades range: 10.0 to 324.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3869 to 2.7871
[INFO] Scaled Long SMA range: -2.7944 to 1.4240
[INFO] Scaled Sharpe ratio range: -3.2705 to 3.1456
[INFO] Scaled Trades range: -0.6512 to 13.7612
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10439 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5648
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 19
[INFO] Using 19 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 19 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1313 elements
[INFO] Cluster 1: 536 elements
[INFO] Cluster 2: 795 elements
[INFO] Cluster 3: 962 elements
[INFO] Cluster 4: 1086 elements
[INFO] Cluster 5: 124 elements
[INFO] Cluster 6: 143 elements
[INFO] Cluster 7: 795 elements
[INFO] Cluster 8: 942 elements
[INFO] Cluster 9: 129 elements
[INFO] Cluster 10: 20 elements
[INFO] Cluster 11: 660 elements
[INFO] Cluster 12: 837 elements
[INFO] Cluster 13: 226 elements
[INFO] Cluster 14: 179 elements
[INFO] Cluster 15: 372 elements
[INFO] Cluster 16: 78 elements
[INFO] Cluster 17: 1051 elements
[INFO] Cluster 18: 191 elements
[INFO] Using 19 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=54, Long SMA=272, Sharpe=-0.0613, Trades=12
[INFO] Cluster 1 cluster: Short SMA=20, Long SMA=124, Sharpe=0.0497, Trades=29
[INFO] Cluster 2 cluster: Short SMA=94, Long SMA=150, Sharpe=-0.1407, Trades=24
[INFO] Cluster 3 cluster: Short SMA=176, Long SMA=228, Sharpe=-0.3643, Trades=18
[INFO] Cluster 4 cluster: Short SMA=108, Long SMA=246, Sharpe=-0.1794, Trades=14
[INFO] Cluster 5 cluster: Short SMA=232, Long SMA=234, Sharpe=-0.3956, Trades=93
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=34, Sharpe=0.0989, Trades=112
[INFO] Cluster 7 cluster: Short SMA=50, Long SMA=150, Sharpe=-0.2223, Trades=19
[INFO] Cluster 8 cluster: Short SMA=130, Long SMA=188, Sharpe=0.3046, Trades=18
[INFO] Cluster 9 cluster: Short SMA=78, Long SMA=84, Sharpe=-0.3563, Trades=72
[INFO] Cluster 10 cluster: Short SMA=26, Long SMA=28, Sharpe=-0.0336, Trades=236
[INFO] Cluster 11 cluster: Short SMA=54, Long SMA=94, Sharpe=-0.3239, Trades=31
[INFO] Cluster 12 cluster: Short SMA=40, Long SMA=210, Sharpe=-0.1072, Trades=16
[INFO] Cluster 13 cluster: Short SMA=22, Long SMA=54, Sharpe=-0.0019, Trades=56
[INFO] Cluster 14 cluster: Short SMA=152, Long SMA=162, Sharpe=0.2721, Trades=52
[INFO] Cluster 15 cluster: Short SMA=252, Long SMA=282, Sharpe=-0.2094, Trades=18
[INFO] Cluster 16 cluster: Short SMA=282, Long SMA=294, Sharpe=0.3671, Trades=36
[INFO] Cluster 17 cluster: Short SMA=190, Long SMA=276, Sharpe=-0.3623, Trades=10
[INFO] Cluster 18 cluster: Short SMA=202, Long SMA=212, Sharpe=-0.6786, Trades=46
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=134, Long SMA=138, Sharpe=0.5321, Trades=69
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=282, Long SMA=294, Sharpe=0.3671, Trades=36
[INFO] Top 2: Short SMA=130, Long SMA=188, Sharpe=0.3046, Trades=18
[INFO] Top 3: Short SMA=152, Long SMA=162, Sharpe=0.2721, Trades=52
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 19 valid clusters with clusters
[INFO] Filtering to 10439 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 134, Long SMA: 138
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(282/294) - Original Sharpe: 0.3671, Trades: 36
[INFO] Hierarchical cluster 2: SMA(130/188) - Original Sharpe: 0.3046, Trades: 18
[INFO] Hierarchical cluster 3: SMA(152/162) - Original Sharpe: 0.2721, Trades: 52
[INFO] Hierarchical cluster 4: SMA(24/34) - Original Sharpe: 0.0989, Trades: 112
[INFO] Hierarchical cluster 5: SMA(20/124) - Original Sharpe: 0.0497, Trades: 29
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (134/138)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (282/294) - Sharpe: 0.3671
[INFO] cluster 2: (130/188) - Sharpe: 0.3046
[INFO] cluster 3: (152/162) - Sharpe: 0.2721
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.716042           -1.716042
1    2021-11-14 2021-11-14            43    -1.188262           -4.651975
2    2022-01-14 2022-01-14            41    -0.404804            1.604578
3    2022-03-14 2022-03-14            44    -3.078018           -2.612213
4    2022-05-14 2022-05-14            43    -1.026268           -1.026268
5    2022-07-14 2022-07-14            44     2.174461            2.174461
6    2022-09-14 2022-09-14            43     2.833979            2.833979
7    2022-11-14 2022-11-14            43     2.673356            2.849639
8    2023-01-14 2023-01-14            41     0.249214            0.249214
9    2023-03-14 2023-03-14            44     4.663682            4.663682
10   2023-05-14 2023-05-14            44     3.615384            3.615384
11   2023-07-14 2023-07-14            44    -0.398216           -0.398216
12   2023-09-14 2023-09-14            43    -1.304784           -1.304784
13   2023-11-14 2023-11-14            42     3.397164            3.397164
14   2024-01-14 2024-01-14            43    -3.986215            1.329533
15   2024-03-14 2024-03-14            42    -0.165280           -0.770191
16   2024-05-14 2024-05-14            44    -1.994953           -1.994953
17   2024-07-14 2024-07-14            45    -0.809966           -4.824745
18   2024-09-14 2024-09-14            43     2.955873            0.562988
19   2024-11-14 2024-11-14            33     0.878530            3.502426
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.2 |             -4.7 |         -3.5 | False         
[INFO] 2022-01-14   |         -0.4 |              1.6 |          2.0 | True          
[INFO] 2022-03-14   |         -3.1 |             -2.6 |          0.5 | True          
[INFO] 2022-05-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.7 |              2.8 |          0.1 | True          
[INFO] 2023-01-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          4.7 |              4.7 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -4.0 |              1.3 |          5.3 | True          
[INFO] 2024-03-14   |         -0.2 |             -0.8 |         -0.6 | False         
[INFO] 2024-05-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.8 |             -4.8 |         -4.0 | False         
[INFO] 2024-09-14   |          3.0 |              0.6 |         -2.4 | False         
[INFO] 2024-11-14   |          0.9 |              3.5 |          2.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 9 periods (55.56% win rate)
[INFO] Updating Excel file with Hierarchical results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Hierarchical win rate 55.6% in row 33
[INFO] Added best Sharpe parameters 134/138 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 134, Long SMA: 138
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(282/294) - Original Sharpe: 0.3671
[INFO] Added cluster 2 to portfolio: SMA(130/188) - Original Sharpe: 0.3046
[INFO] Added cluster 3 to portfolio: SMA(152/162) - Original Sharpe: 0.2721
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MP1_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2612
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1651
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MP1
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NE1 in column D: 9.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 64
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 255.32s
[INFO] Best parameters: Short SMA = 158, Long SMA = 288
[INFO] Best Sharpe ratio: 0.601145, Trades: 14
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_NE1_best_158/288 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NE1
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.80 contracts
[INFO] Maximum Position Size: 16 contracts
[INFO] Strategy Total P&L: $355,980.00
[INFO] Market Buy & Hold P&L: $-19,895.00
[INFO] Outperformance: $375,875.00
[INFO] Sharpe ratio (entire period, annualized): 0.489962
[INFO] Sharpe ratio (in-sample, annualized): 0.601145
[INFO] Sharpe ratio (out-of-sample, annualized): 0.226030
[INFO] Maximum Drawdown: $99,250.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 9
[INFO] Out-of-sample period trades: 5
[INFO] Total trades: 14
[INFO] In-sample P&L: $307,448.00
[INFO] Out-of-sample P&L: $48,722.00
[INFO] 
Best parameters from GA: Short SMA = 158, Long SMA = 288, Sharpe = 0.601145
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8463 to 0.6011
[INFO] 
Best parameters:
[INFO] Short SMA: 158
[INFO] Long SMA: 288
[INFO] Sharpe Ratio: 0.601145
[INFO] Number of Trades: 14
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8463 to 0.6011
[INFO] Trades range: 12.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8285 to 2.8656
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 1014 elements
[INFO] Kmeans Cluster 1: 858 elements
[INFO] Kmeans Cluster 2: 719 elements
[INFO] Kmeans Cluster 3: 694 elements
[INFO] Kmeans Cluster 4: 557 elements
[INFO] Kmeans Cluster 5: 502 elements
[INFO] Kmeans Cluster 6: 663 elements
[INFO] Kmeans Cluster 7: 538 elements
[INFO] Kmeans Cluster 8: 607 elements
[INFO] Kmeans Cluster 9: 649 elements
[INFO] Kmeans Cluster 10: 462 elements
[INFO] Kmeans Cluster 11: 815 elements
[INFO] Kmeans Cluster 12: 614 elements
[INFO] Kmeans Cluster 13: 661 elements
[INFO] Kmeans Cluster 14: 598 elements
[INFO] Kmeans Cluster 15: 634 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=69.00, Long SMA=184.55, Sharpe=-0.5526
[INFO] Centroid 1: Short SMA=155.07, Long SMA=216.65, Sharpe=0.0265
[INFO] Centroid 2: Short SMA=33.19, Long SMA=104.00, Sharpe=-0.1845
[INFO] Centroid 3: Short SMA=79.75, Long SMA=229.82, Sharpe=-0.3017
[INFO] Centroid 4: Short SMA=254.13, Long SMA=282.28, Sharpe=0.2802
[INFO] Centroid 5: Short SMA=33.47, Long SMA=281.11, Sharpe=0.0890
[INFO] Centroid 6: Short SMA=205.85, Long SMA=235.59, Sharpe=-0.2040
[INFO] Centroid 7: Short SMA=27.44, Long SMA=59.52, Sharpe=0.0331
[INFO] Centroid 8: Short SMA=109.51, Long SMA=143.35, Sharpe=-0.2813
[INFO] Centroid 9: Short SMA=91.06, Long SMA=274.40, Sharpe=0.0312
[INFO] Centroid 10: Short SMA=31.93, Long SMA=243.43, Sharpe=-0.1248
[INFO] Centroid 11: Short SMA=145.04, Long SMA=274.81, Sharpe=0.2580
[INFO] Centroid 12: Short SMA=30.39, Long SMA=174.62, Sharpe=-0.3523
[INFO] Centroid 13: Short SMA=71.21, Long SMA=113.45, Sharpe=-0.4285
[INFO] Centroid 14: Short SMA=200.83, Long SMA=273.68, Sharpe=0.0199
[INFO] Centroid 15: Short SMA=135.71, Long SMA=186.48, Sharpe=-0.1037
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=158, Long SMA=288, Sharpe=0.6011, Trades=14
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=254, Long SMA=282, Sharpe=0.3621, Trades=22
[INFO] Kmeans Top 2: Short SMA=146, Long SMA=276, Sharpe=0.3290, Trades=16
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=60, Sharpe=0.1189, Trades=54
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=244, Sharpe=0.0031, Trades=26
[INFO] Kmeans Top 5: Short SMA=136, Long SMA=186, Sharpe=-0.0121, Trades=18
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (69, 185)
[INFO]   Nearest: (70.0, 184.0)
[INFO]   Rounded: (155, 217)
[INFO]   Nearest: (156.0, 216.0)
[INFO]   Rounded: (33, 104)
[INFO]   Nearest: (34.0, 104.0)
[INFO]   Rounded: (80, 230)
[INFO]   Rounded: (254, 282)
[INFO]   Rounded: (33, 281)
[INFO]   Nearest: (34.0, 282.0)
[INFO]   Rounded: (206, 236)
[INFO]   Rounded: (27, 60)
[INFO]   Nearest: (28.0, 60.0)
[INFO]   Rounded: (110, 143)
[INFO]   Nearest: (110.0, 144.0)
[INFO]   Rounded: (91, 274)
[INFO]   Nearest: (92.0, 274.0)
[INFO]   Rounded: (32, 243)
[INFO]   Nearest: (32.0, 244.0)
[INFO]   Rounded: (145, 275)
[INFO]   Nearest: (146.0, 274.0)
[INFO]   Rounded: (30, 175)
[INFO]   Nearest: (30.0, 174.0)
[INFO]   Rounded: (71, 113)
[INFO]   Nearest: (72.0, 114.0)
[INFO]   Rounded: (201, 274)
[INFO]   Nearest: (200.0, 274.0)
[INFO]   Rounded: (136, 186)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 158, Long SMA: 288
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 64
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(254/282) - Original Sharpe: 0.3621, Trades: 22
[INFO] Kmeans cluster 2: SMA(146/276) - Original Sharpe: 0.3290, Trades: 16
[INFO] Kmeans cluster 3: SMA(28/60) - Original Sharpe: 0.1189, Trades: 54
[INFO] Kmeans cluster 4: SMA(30/244) - Original Sharpe: 0.0031, Trades: 26
[INFO] Kmeans cluster 5: SMA(136/186) - Original Sharpe: -0.0121, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (158/288)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (254/282) - Sharpe: 0.3621
[INFO] cluster 2: (146/276) - Sharpe: 0.3290
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.711854           -0.715883
1    2021-11-14 2021-11-14            43    -2.704530           -0.993103
2    2022-01-14 2022-01-14            41     0.749001            0.749001
3    2022-03-14 2022-03-14            44     3.657765            3.657765
4    2022-05-14 2022-05-14            43     1.252080            1.252080
5    2022-07-14 2022-07-14            44     0.795112            0.795112
6    2022-09-14 2022-09-14            43    -0.063770           -0.063770
7    2022-11-14 2022-11-14            43    -1.653258           -1.653258
8    2023-01-14 2023-01-14            41     1.658465            1.658465
9    2023-03-14 2023-03-14            44     0.152591           -1.646125
10   2023-05-14 2023-05-14            44     4.106633            0.000000
11   2023-07-14 2023-07-14            44    -5.609635           -2.393172
12   2023-09-14 2023-09-14            43     2.029860            2.546674
13   2023-11-14 2023-11-14            42    -3.851886           -1.121387
14   2024-01-14 2024-01-14            43     0.911910            0.911910
15   2024-03-14 2024-03-14            42     1.804454            1.804454
16   2024-05-14 2024-05-14            44    -3.279202           -2.010470
17   2024-07-14 2024-07-14            45     0.210954            0.307473
18   2024-09-14 2024-09-14            43    -0.935269           -2.631803
19   2024-11-14 2024-11-14            33     3.782667            2.315124
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -2.7 |             -1.0 |          1.7 | True          
[INFO] 2022-01-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.2 |             -1.6 |         -1.8 | False         
[INFO] 2023-05-14   |          4.1 |              0.0 |         -4.1 | False         
[INFO] 2023-07-14   |         -5.6 |             -2.4 |          3.2 | True          
[INFO] 2023-09-14   |          2.0 |              2.5 |          0.5 | True          
[INFO] 2023-11-14   |         -3.9 |             -1.1 |          2.8 | True          
[INFO] 2024-01-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -3.3 |             -2.0 |          1.3 | True          
[INFO] 2024-07-14   |          0.2 |              0.3 |          0.1 | True          
[INFO] 2024-09-14   |         -0.9 |             -2.6 |         -1.7 | False         
[INFO] 2024-11-14   |          3.8 |              2.3 |         -1.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2024-01-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Kmeans cluster wins (rounded comparison): 6 of 10 periods (60.00% win rate)
[INFO] Updating Excel file with Kmeans results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Kmeans win rate 60.0% in row 34
[INFO] Added best Sharpe parameters 158/288 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 158, Long SMA: 288
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(254/282) - Original Sharpe: 0.3621
[INFO] Added cluster 2 to portfolio: SMA(146/276) - Original Sharpe: 0.3290
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NE1_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2976
[INFO] Kmeans Best out-of-sample Sharpe: 0.2260
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NE1
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8463 to 0.6011
[INFO] 
Best parameters:
[INFO] Short SMA: 158
[INFO] Long SMA: 288
[INFO] Sharpe Ratio: 0.601145
[INFO] Number of Trades: 14
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8463 to 0.6011
[INFO] Trades range: 12.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8285 to 2.8656
[INFO] Scaled Trades range: -0.7866 to 14.7605
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5460
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1800 elements
[INFO] Cluster 1: 1051 elements
[INFO] Cluster 2: 782 elements
[INFO] Cluster 3: 796 elements
[INFO] Cluster 4: 1176 elements
[INFO] Cluster 5: 185 elements
[INFO] Cluster 6: 106 elements
[INFO] Cluster 7: 652 elements
[INFO] Cluster 8: 872 elements
[INFO] Cluster 9: 435 elements
[INFO] Cluster 10: 808 elements
[INFO] Cluster 11: 877 elements
[INFO] Cluster 12: 680 elements
[INFO] Cluster 13: 15 elements
[INFO] Cluster 14: 350 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=70, Long SMA=182, Sharpe=-0.5779, Trades=20
[INFO] Cluster 1 cluster: Short SMA=152, Long SMA=206, Sharpe=-0.0058, Trades=17
[INFO] Cluster 2 cluster: Short SMA=50, Long SMA=98, Sharpe=-0.1824, Trades=36
[INFO] Cluster 3 cluster: Short SMA=28, Long SMA=262, Sharpe=-0.0284, Trades=30
[INFO] Cluster 4 cluster: Short SMA=156, Long SMA=274, Sharpe=0.2937, Trades=14
[INFO] Cluster 5 cluster: Short SMA=46, Long SMA=54, Sharpe=-0.0108, Trades=90
[INFO] Cluster 6 cluster: Short SMA=30, Long SMA=36, Sharpe=-0.2151, Trades=138
[INFO] Cluster 7 cluster: Short SMA=252, Long SMA=282, Sharpe=0.3327, Trades=22
[INFO] Cluster 8 cluster: Short SMA=204, Long SMA=242, Sharpe=-0.2096, Trades=20
[INFO] Cluster 9 cluster: Short SMA=26, Long SMA=70, Sharpe=0.0607, Trades=50
[INFO] Cluster 10 cluster: Short SMA=112, Long SMA=208, Sharpe=-0.2023, Trades=18
[INFO] Cluster 11 cluster: Short SMA=84, Long SMA=274, Sharpe=0.0657, Trades=16
[INFO] Cluster 12 cluster: Short SMA=32, Long SMA=156, Sharpe=-0.4044, Trades=28
[INFO] Cluster 14 cluster: Short SMA=110, Long SMA=138, Sharpe=-0.1897, Trades=24
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=158, Long SMA=288, Sharpe=0.6011, Trades=14
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=252, Long SMA=282, Sharpe=0.3327, Trades=22
[INFO] Top 2: Short SMA=156, Long SMA=274, Sharpe=0.2937, Trades=14
[INFO] Top 3: Short SMA=84, Long SMA=274, Sharpe=0.0657, Trades=16
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 10570 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 158, Long SMA: 288
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 64
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(252/282) - Original Sharpe: 0.3327, Trades: 22
[INFO] Hierarchical cluster 2: SMA(156/274) - Original Sharpe: 0.2937, Trades: 14
[INFO] Hierarchical cluster 3: SMA(84/274) - Original Sharpe: 0.0657, Trades: 16
[INFO] Hierarchical cluster 4: SMA(26/70) - Original Sharpe: 0.0607, Trades: 50
[INFO] Hierarchical cluster 5: SMA(152/206) - Original Sharpe: -0.0058, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (158/288)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (252/282) - Sharpe: 0.3327
[INFO] cluster 2: (156/274) - Sharpe: 0.2937
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.711854           -0.711854
1    2021-11-14 2021-11-14            43    -2.704530           -0.765072
2    2022-01-14 2022-01-14            41     0.749001            0.749001
3    2022-03-14 2022-03-14            44     3.657765            3.657765
4    2022-05-14 2022-05-14            43     1.252080            1.252080
5    2022-07-14 2022-07-14            44     0.795112            0.795112
6    2022-09-14 2022-09-14            43    -0.063770           -0.063770
7    2022-11-14 2022-11-14            43    -1.653258           -1.653258
8    2023-01-14 2023-01-14            41     1.658465            1.658465
9    2023-03-14 2023-03-14            44     0.152591            0.152591
10   2023-05-14 2023-05-14            44     4.106633           -2.688256
11   2023-07-14 2023-07-14            44    -5.609635            2.316116
12   2023-09-14 2023-09-14            43     2.029860           -0.144531
13   2023-11-14 2023-11-14            42    -3.851886           -0.296181
14   2024-01-14 2024-01-14            43     0.911910            0.911910
15   2024-03-14 2024-03-14            42     1.804454            1.804454
16   2024-05-14 2024-05-14            44    -3.279202           -2.327332
17   2024-07-14 2024-07-14            45     0.210954            0.057384
18   2024-09-14 2024-09-14            43    -0.935269           -1.013586
19   2024-11-14 2024-11-14            33     3.782667            3.909701
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -2.7 |             -0.8 |          1.9 | True          
[INFO] 2022-01-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-05-14   |          4.1 |             -2.7 |         -6.8 | False         
[INFO] 2023-07-14   |         -5.6 |              2.3 |          7.9 | True          
[INFO] 2023-09-14   |          2.0 |             -0.1 |         -2.1 | False         
[INFO] 2023-11-14   |         -3.9 |             -0.3 |          3.6 | True          
[INFO] 2024-01-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -3.3 |             -2.3 |          1.0 | True          
[INFO] 2024-07-14   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2024-09-14   |         -0.9 |             -1.0 |         -0.1 | False         
[INFO] 2024-11-14   |          3.8 |              3.9 |          0.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-03-14, 2024-01-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 9 periods (55.56% win rate)
[INFO] Updating Excel file with Hierarchical results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Hierarchical win rate 55.6% in row 34
[INFO] Added best Sharpe parameters 158/288 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 158, Long SMA: 288
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(252/282) - Original Sharpe: 0.3327
[INFO] Added cluster 2 to portfolio: SMA(156/274) - Original Sharpe: 0.2937
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NE1_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.4778
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2260
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NE1
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NG in column D: 15.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 282.96s
[INFO] Best parameters: Short SMA = 38, Long SMA = 96
[INFO] Best Sharpe ratio: 0.840516, Trades: 34
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_NG_best_38/96 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NG
[INFO] Big Point Value (from data): 10000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.73 contracts
[INFO] Maximum Position Size: 13 contracts
[INFO] Strategy Total P&L: $311,555.00
[INFO] Market Buy & Hold P&L: $-82,800.00
[INFO] Outperformance: $394,355.00
[INFO] Sharpe ratio (entire period, annualized): 0.431735
[INFO] Sharpe ratio (in-sample, annualized): 0.840516
[INFO] Sharpe ratio (out-of-sample, annualized): -0.397004
[INFO] Maximum Drawdown: $168,255.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 22
[INFO] Out-of-sample period trades: 12
[INFO] Total trades: 34
[INFO] In-sample P&L: $479,775.00
[INFO] Out-of-sample P&L: $-111,340.00
[INFO] 
Best parameters from GA: Short SMA = 38, Long SMA = 96, Sharpe = 0.840516
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5760 to 0.8405
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 96
[INFO] Sharpe Ratio: 0.840516
[INFO] Number of Trades: 34
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8481 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5760 to 0.8405
[INFO] Trades range: 10.0 to 351.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2490 to 2.7470
[INFO] Scaled Long SMA range: -2.6028 to 1.6263
[INFO] Scaled Sharpe ratio range: -2.8606 to 1.8769
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 381 elements
[INFO] Kmeans Cluster 1: 457 elements
[INFO] Kmeans Cluster 2: 705 elements
[INFO] Kmeans Cluster 3: 550 elements
[INFO] Kmeans Cluster 4: 354 elements
[INFO] Kmeans Cluster 5: 745 elements
[INFO] Kmeans Cluster 6: 390 elements
[INFO] Kmeans Cluster 7: 508 elements
[INFO] Kmeans Cluster 8: 811 elements
[INFO] Kmeans Cluster 9: 575 elements
[INFO] Kmeans Cluster 10: 551 elements
[INFO] Kmeans Cluster 11: 475 elements
[INFO] Kmeans Cluster 12: 332 elements
[INFO] Kmeans Cluster 13: 518 elements
[INFO] Kmeans Cluster 14: 591 elements
[INFO] Kmeans Cluster 15: 538 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=196.41, Long SMA=221.73, Sharpe=0.1936
[INFO] Centroid 1: Short SMA=19.93, Long SMA=175.18, Sharpe=0.2849
[INFO] Centroid 2: Short SMA=90.05, Long SMA=212.69, Sharpe=0.3458
[INFO] Centroid 3: Short SMA=225.07, Long SMA=257.57, Sharpe=-0.1488
[INFO] Centroid 4: Short SMA=27.24, Long SMA=99.24, Sharpe=0.1633
[INFO] Centroid 5: Short SMA=61.98, Long SMA=122.81, Sharpe=0.6149
[INFO] Centroid 6: Short SMA=164.15, Long SMA=195.88, Sharpe=-0.0293
[INFO] Centroid 7: Short SMA=133.24, Long SMA=172.20, Sharpe=0.2702
[INFO] Centroid 8: Short SMA=58.08, Long SMA=176.39, Sharpe=0.6298
[INFO] Centroid 9: Short SMA=109.72, Long SMA=146.06, Sharpe=0.4662
[INFO] Centroid 10: Short SMA=243.86, Long SMA=284.55, Sharpe=-0.3528
[INFO] Centroid 11: Short SMA=26.16, Long SMA=273.93, Sharpe=0.3029
[INFO] Centroid 12: Short SMA=19.93, Long SMA=50.91, Sharpe=-0.0796
[INFO] Centroid 13: Short SMA=52.96, Long SMA=81.19, Sharpe=0.4924
[INFO] Centroid 14: Short SMA=43.01, Long SMA=241.77, Sharpe=0.5566
[INFO] Centroid 15: Short SMA=135.68, Long SMA=265.20, Sharpe=0.1402
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=96, Sharpe=0.8405, Trades=34
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=44, Long SMA=242, Sharpe=0.6256, Trades=10
[INFO] Kmeans Top 2: Short SMA=62, Long SMA=124, Sharpe=0.6217, Trades=21
[INFO] Kmeans Top 3: Short SMA=52, Long SMA=80, Sharpe=0.5792, Trades=47
[INFO] Kmeans Top 4: Short SMA=58, Long SMA=176, Sharpe=0.4794, Trades=24
[INFO] Kmeans Top 5: Short SMA=24, Long SMA=276, Sharpe=0.4097, Trades=16
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (196, 222)
[INFO]   Rounded: (20, 175)
[INFO]   Nearest: (20.0, 176.0)
[INFO]   Rounded: (90, 213)
[INFO]   Nearest: (90.0, 212.0)
[INFO]   Rounded: (225, 258)
[INFO]   Nearest: (226.0, 258.0)
[INFO]   Rounded: (27, 99)
[INFO]   Nearest: (28.0, 100.0)
[INFO]   Rounded: (62, 123)
[INFO]   Nearest: (62.0, 122.0)
[INFO]   Rounded: (164, 196)
[INFO]   Rounded: (133, 172)
[INFO]   Nearest: (134.0, 172.0)
[INFO]   Rounded: (58, 176)
[INFO]   Rounded: (110, 146)
[INFO]   Rounded: (244, 285)
[INFO]   Nearest: (244.0, 284.0)
[INFO]   Rounded: (26, 274)
[INFO]   Rounded: (20, 51)
[INFO]   Nearest: (20.0, 50.0)
[INFO]   Rounded: (53, 81)
[INFO]   Nearest: (52.0, 82.0)
[INFO]   Rounded: (43, 242)
[INFO]   Nearest: (44.0, 242.0)
[INFO]   Rounded: (136, 265)
[INFO]   Nearest: (136.0, 266.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 96
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(44/242) - Original Sharpe: 0.6256, Trades: 10
[INFO] Kmeans cluster 2: SMA(62/124) - Original Sharpe: 0.6217, Trades: 21
[INFO] Kmeans cluster 3: SMA(52/80) - Original Sharpe: 0.5792, Trades: 47
[INFO] Kmeans cluster 4: SMA(58/176) - Original Sharpe: 0.4794, Trades: 24
[INFO] Kmeans cluster 5: SMA(24/276) - Original Sharpe: 0.4097, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/96)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (44/242) - Sharpe: 0.6256
[INFO] cluster 2: (62/124) - Sharpe: 0.6217
[INFO] cluster 3: (52/80) - Sharpe: 0.5792
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.445674           -0.445674
1    2021-11-14 2021-11-14            43    -2.014680           -2.751950
2    2022-01-14 2022-01-14            41    -2.486703           -2.830890
3    2022-03-14 2022-03-14            44     3.957702            3.232771
4    2022-05-14 2022-05-14            43    -0.023760           -0.023760
5    2022-07-14 2022-07-14            44    -1.042803            3.068056
6    2022-09-14 2022-09-14            43    -2.178995           -4.043412
7    2022-11-14 2022-11-14            43     3.472189            3.472189
8    2023-01-14 2023-01-14            41     1.369071            1.369071
9    2023-03-14 2023-03-14            43     2.324517            2.324517
10   2023-05-14 2023-05-14            44    -0.121506           -0.121506
11   2023-07-14 2023-07-14            44    -0.937897           -1.929128
12   2023-09-14 2023-09-14            43    -3.674779           -4.697318
13   2023-11-14 2023-11-14            42    -5.314334           -2.365783
14   2024-01-14 2024-01-14            43     5.971629            5.971629
15   2024-03-14 2024-03-14            42    -1.552883           -1.552883
16   2024-05-14 2024-05-14            44    -1.549107           -0.134034
17   2024-07-14 2024-07-14            45    -1.110970           -1.393623
18   2024-09-14 2024-09-14            43     0.410531           -0.238021
19   2024-11-14 2024-11-14            33    -3.830386           -3.183962
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -2.0 |             -2.8 |         -0.8 | False         
[INFO] 2022-01-14   |         -2.5 |             -2.8 |         -0.3 | False         
[INFO] 2022-03-14   |          4.0 |              3.2 |         -0.8 | False         
[INFO] 2022-05-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |              3.1 |          4.1 | True          
[INFO] 2022-09-14   |         -2.2 |             -4.0 |         -1.8 | False         
[INFO] 2022-11-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.9 |             -1.9 |         -1.0 | False         
[INFO] 2023-09-14   |         -3.7 |             -4.7 |         -1.0 | False         
[INFO] 2023-11-14   |         -5.3 |             -2.4 |          2.9 | True          
[INFO] 2024-01-14   |          6.0 |              6.0 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -1.5 |             -0.1 |          1.4 | True          
[INFO] 2024-07-14   |         -1.1 |             -1.4 |         -0.3 | False         
[INFO] 2024-09-14   |          0.4 |             -0.2 |         -0.6 | False         
[INFO] 2024-11-14   |         -3.8 |             -3.2 |          0.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2022-11-14, 2023-01-14, 2023-03-14, 2023-05-14, 2024-01-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 4 of 12 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for NG...
[INFO] Excel file updated successfully. Added NG with Kmeans win rate 33.3% in row 35
[INFO] Added best Sharpe parameters 38/96 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 96
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(44/242) - Original Sharpe: 0.6256
[INFO] Added cluster 2 to portfolio: SMA(62/124) - Original Sharpe: 0.6217
[INFO] Added cluster 3 to portfolio: SMA(52/80) - Original Sharpe: 0.5792
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NG_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0742
[INFO] Kmeans Best out-of-sample Sharpe: -0.3970
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NG...
[INFO] Excel file updated successfully. Added NG with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NG
[INFO] Big Point Value: 10000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5760 to 0.8405
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 96
[INFO] Sharpe Ratio: 0.840516
[INFO] Number of Trades: 34
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8481 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5760 to 0.8405
[INFO] Trades range: 10.0 to 351.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2490 to 2.7470
[INFO] Scaled Long SMA range: -2.6028 to 1.6263
[INFO] Scaled Sharpe ratio range: -2.8606 to 1.8769
[INFO] Scaled Trades range: -0.6507 to 13.6551
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8481 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5908
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 134 elements
[INFO] Cluster 1: 835 elements
[INFO] Cluster 2: 360 elements
[INFO] Cluster 3: 582 elements
[INFO] Cluster 4: 1099 elements
[INFO] Cluster 5: 570 elements
[INFO] Cluster 6: 705 elements
[INFO] Cluster 7: 164 elements
[INFO] Cluster 8: 1300 elements
[INFO] Cluster 9: 979 elements
[INFO] Cluster 10: 35 elements
[INFO] Cluster 11: 546 elements
[INFO] Cluster 12: 538 elements
[INFO] Cluster 13: 455 elements
[INFO] Cluster 14: 179 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=44, Long SMA=48, Sharpe=0.3676, Trades=124
[INFO] Cluster 1 cluster: Short SMA=172, Long SMA=204, Sharpe=-0.1210, Trades=14
[INFO] Cluster 2 cluster: Short SMA=16, Long SMA=68, Sharpe=0.0125, Trades=60
[INFO] Cluster 3 cluster: Short SMA=18, Long SMA=166, Sharpe=0.2020, Trades=30
[INFO] Cluster 4 cluster: Short SMA=234, Long SMA=274, Sharpe=-0.0709, Trades=14
[INFO] Cluster 5 cluster: Short SMA=44, Long SMA=230, Sharpe=0.6891, Trades=10
[INFO] Cluster 6 cluster: Short SMA=54, Long SMA=94, Sharpe=0.4501, Trades=37
[INFO] Cluster 7 cluster: Short SMA=134, Long SMA=140, Sharpe=0.2369, Trades=58
[INFO] Cluster 8 cluster: Short SMA=66, Long SMA=156, Sharpe=0.6582, Trades=18
[INFO] Cluster 9 cluster: Short SMA=92, Long SMA=210, Sharpe=0.3475, Trades=14
[INFO] Cluster 10 cluster: Short SMA=32, Long SMA=34, Sharpe=-0.3912, Trades=200
[INFO] Cluster 11 cluster: Short SMA=136, Long SMA=262, Sharpe=0.1654, Trades=10
[INFO] Cluster 12 cluster: Short SMA=26, Long SMA=270, Sharpe=0.3787, Trades=16
[INFO] Cluster 13 cluster: Short SMA=116, Long SMA=146, Sharpe=0.4177, Trades=24
[INFO] Cluster 14 cluster: Short SMA=60, Long SMA=70, Sharpe=0.4593, Trades=69
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=96, Sharpe=0.8405, Trades=34
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=44, Long SMA=230, Sharpe=0.6891, Trades=10
[INFO] Top 2: Short SMA=66, Long SMA=156, Sharpe=0.6582, Trades=18
[INFO] Top 3: Short SMA=60, Long SMA=70, Sharpe=0.4593, Trades=69
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 8481 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 96
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(44/230) - Original Sharpe: 0.6891, Trades: 10
[INFO] Hierarchical cluster 2: SMA(66/156) - Original Sharpe: 0.6582, Trades: 18
[INFO] Hierarchical cluster 3: SMA(60/70) - Original Sharpe: 0.4593, Trades: 69
[INFO] Hierarchical cluster 4: SMA(54/94) - Original Sharpe: 0.4501, Trades: 37
[INFO] Hierarchical cluster 5: SMA(116/146) - Original Sharpe: 0.4177, Trades: 24
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/96)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (44/230) - Sharpe: 0.6891
[INFO] cluster 2: (66/156) - Sharpe: 0.6582
[INFO] cluster 3: (60/70) - Sharpe: 0.4593
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.445674           -0.445674
1    2021-11-14 2021-11-14            43    -2.014680           -1.579128
2    2022-01-14 2022-01-14            41    -2.486703           -2.577466
3    2022-03-14 2022-03-14            44     3.957702            2.313183
4    2022-05-14 2022-05-14            43    -0.023760           -0.023760
5    2022-07-14 2022-07-14            44    -1.042803            2.801597
6    2022-09-14 2022-09-14            43    -2.178995           -3.877243
7    2022-11-14 2022-11-14            43     3.472189            3.472189
8    2023-01-14 2023-01-14            41     1.369071            1.369071
9    2023-03-14 2023-03-14            43     2.324517            2.324517
10   2023-05-14 2023-05-14            44    -0.121506           -0.032662
11   2023-07-14 2023-07-14            44    -0.937897            0.051391
12   2023-09-14 2023-09-14            43    -3.674779           -3.205845
13   2023-11-14 2023-11-14            42    -5.314334           -4.170160
14   2024-01-14 2024-01-14            43     5.971629            5.971629
15   2024-03-14 2024-03-14            42    -1.552883           -1.552883
16   2024-05-14 2024-05-14            44    -1.549107           -0.893676
17   2024-07-14 2024-07-14            45    -1.110970            0.332921
18   2024-09-14 2024-09-14            43     0.410531            0.163536
19   2024-11-14 2024-11-14            33    -3.830386           -3.922637
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -2.0 |             -1.6 |          0.4 | True          
[INFO] 2022-01-14   |         -2.5 |             -2.6 |         -0.1 | False         
[INFO] 2022-03-14   |          4.0 |              2.3 |         -1.7 | False         
[INFO] 2022-05-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |              2.8 |          3.8 | True          
[INFO] 2022-09-14   |         -2.2 |             -3.9 |         -1.7 | False         
[INFO] 2022-11-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |         -0.1 |             -0.0 |          0.1 | True          
[INFO] 2023-07-14   |         -0.9 |              0.1 |          1.0 | True          
[INFO] 2023-09-14   |         -3.7 |             -3.2 |          0.5 | True          
[INFO] 2023-11-14   |         -5.3 |             -4.2 |          1.1 | True          
[INFO] 2024-01-14   |          6.0 |              6.0 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -1.5 |             -0.9 |          0.6 | True          
[INFO] 2024-07-14   |         -1.1 |              0.3 |          1.4 | True          
[INFO] 2024-09-14   |          0.4 |              0.2 |         -0.2 | False         
[INFO] 2024-11-14   |         -3.8 |             -3.9 |         -0.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2022-11-14, 2023-01-14, 2023-03-14, 2024-01-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 13 periods (61.54% win rate)
[INFO] Updating Excel file with Hierarchical results for NG...
[INFO] Excel file updated successfully. Added NG with Hierarchical win rate 61.5% in row 35
[INFO] Added best Sharpe parameters 38/96 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 96
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(44/230) - Original Sharpe: 0.6891
[INFO] Added cluster 2 to portfolio: SMA(66/156) - Original Sharpe: 0.6582
[INFO] Added cluster 3 to portfolio: SMA(60/70) - Original Sharpe: 0.4593
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NG_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1264
[INFO] Hierarchical Best out-of-sample Sharpe: -0.3970
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NG...
[INFO] Excel file updated successfully. Added NG with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NG
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NK in column D: 35.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 258.63s
[INFO] Best parameters: Short SMA = 20, Long SMA = 22
[INFO] Best Sharpe ratio: 0.860889, Trades: 251
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_NK_best_20/22 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NK
[INFO] Big Point Value (from data): 5.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.91 contracts
[INFO] Maximum Position Size: 8 contracts
[INFO] Strategy Total P&L: $555,050.00
[INFO] Market Buy & Hold P&L: $123,500.00
[INFO] Outperformance: $431,550.00
[INFO] Sharpe ratio (entire period, annualized): 0.567140
[INFO] Sharpe ratio (in-sample, annualized): 0.860889
[INFO] Sharpe ratio (out-of-sample, annualized): -0.084305
[INFO] Maximum Drawdown: $146,255.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 175
[INFO] Out-of-sample period trades: 76
[INFO] Total trades: 251
[INFO] In-sample P&L: $540,320.00
[INFO] Out-of-sample P&L: $-23,830.00
[INFO] 
Best parameters from GA: Short SMA = 20, Long SMA = 22, Sharpe = 0.860889
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 5.0
[INFO] Slippage: 35.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6475 to 0.8609
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 22
[INFO] Sharpe Ratio: 0.860889
[INFO] Number of Trades: 251
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10417 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6475 to 0.8609
[INFO] Trades range: 10.0 to 343.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3841 to 2.7941
[INFO] Scaled Long SMA range: -2.7959 to 1.4302
[INFO] Scaled Sharpe ratio range: -3.3641 to 4.1025
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 297 elements
[INFO] Kmeans Cluster 1: 765 elements
[INFO] Kmeans Cluster 2: 548 elements
[INFO] Kmeans Cluster 3: 864 elements
[INFO] Kmeans Cluster 4: 815 elements
[INFO] Kmeans Cluster 5: 710 elements
[INFO] Kmeans Cluster 6: 589 elements
[INFO] Kmeans Cluster 7: 443 elements
[INFO] Kmeans Cluster 8: 865 elements
[INFO] Kmeans Cluster 9: 655 elements
[INFO] Kmeans Cluster 10: 334 elements
[INFO] Kmeans Cluster 11: 503 elements
[INFO] Kmeans Cluster 12: 779 elements
[INFO] Kmeans Cluster 13: 461 elements
[INFO] Kmeans Cluster 14: 658 elements
[INFO] Kmeans Cluster 15: 783 elements
[INFO] Kmeans Cluster 16: 348 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=158.72, Long SMA=196.68, Sharpe=0.5227
[INFO] Centroid 1: Short SMA=29.93, Long SMA=186.92, Sharpe=-0.1278
[INFO] Centroid 2: Short SMA=187.51, Long SMA=229.42, Sharpe=0.1278
[INFO] Centroid 3: Short SMA=98.17, Long SMA=147.28, Sharpe=-0.0984
[INFO] Centroid 4: Short SMA=133.76, Long SMA=213.71, Sharpe=0.3055
[INFO] Centroid 5: Short SMA=36.90, Long SMA=267.73, Sharpe=0.0942
[INFO] Centroid 6: Short SMA=38.57, Long SMA=84.95, Sharpe=-0.1964
[INFO] Centroid 7: Short SMA=239.79, Long SMA=281.97, Sharpe=-0.0277
[INFO] Centroid 8: Short SMA=64.84, Long SMA=253.68, Sharpe=0.2566
[INFO] Centroid 9: Short SMA=69.85, Long SMA=196.94, Sharpe=0.0372
[INFO] Centroid 10: Short SMA=27.17, Long SMA=50.54, Sharpe=0.0219
[INFO] Centroid 11: Short SMA=242.88, Long SMA=267.96, Sharpe=-0.2565
[INFO] Centroid 12: Short SMA=117.72, Long SMA=273.23, Sharpe=0.1597
[INFO] Centroid 13: Short SMA=127.42, Long SMA=165.38, Sharpe=0.0854
[INFO] Centroid 14: Short SMA=47.42, Long SMA=131.75, Sharpe=0.0049
[INFO] Centroid 15: Short SMA=184.18, Long SMA=265.12, Sharpe=-0.0651
[INFO] Centroid 16: Short SMA=50.67, Long SMA=94.21, Sharpe=-0.3971
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=22, Sharpe=0.8609, Trades=251
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=160, Long SMA=198, Sharpe=0.6328, Trades=19
[INFO] Kmeans Top 2: Short SMA=130, Long SMA=218, Sharpe=0.4312, Trades=17
[INFO] Kmeans Top 3: Short SMA=68, Long SMA=250, Sharpe=0.2099, Trades=12
[INFO] Kmeans Top 4: Short SMA=118, Long SMA=272, Sharpe=0.1886, Trades=13
[INFO] Kmeans Top 5: Short SMA=130, Long SMA=168, Sharpe=0.0810, Trades=25
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (159, 197)
[INFO]   Nearest: (158.0, 196.0)
[INFO]   Rounded: (30, 187)
[INFO]   Nearest: (30.0, 186.0)
[INFO]   Rounded: (188, 229)
[INFO]   Nearest: (188.0, 230.0)
[INFO]   Rounded: (98, 147)
[INFO]   Nearest: (98.0, 148.0)
[INFO]   Rounded: (134, 214)
[INFO]   Rounded: (37, 268)
[INFO]   Nearest: (36.0, 268.0)
[INFO]   Rounded: (39, 85)
[INFO]   Nearest: (38.0, 84.0)
[INFO]   Rounded: (240, 282)
[INFO]   Rounded: (65, 254)
[INFO]   Nearest: (64.0, 254.0)
[INFO]   Rounded: (70, 197)
[INFO]   Nearest: (70.0, 196.0)
[INFO]   Rounded: (27, 51)
[INFO]   Nearest: (28.0, 50.0)
[INFO]   Rounded: (243, 268)
[INFO]   Nearest: (242.0, 268.0)
[INFO]   Rounded: (118, 273)
[INFO]   Nearest: (118.0, 274.0)
[INFO]   Rounded: (127, 165)
[INFO]   Nearest: (128.0, 166.0)
[INFO]   Rounded: (47, 132)
[INFO]   Nearest: (48.0, 132.0)
[INFO]   Rounded: (184, 265)
[INFO]   Nearest: (184.0, 266.0)
[INFO]   Rounded: (51, 94)
[INFO]   Nearest: (50.0, 94.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 22
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(160/198) - Original Sharpe: 0.6328, Trades: 19
[INFO] Kmeans cluster 2: SMA(130/218) - Original Sharpe: 0.4312, Trades: 17
[INFO] Kmeans cluster 3: SMA(68/250) - Original Sharpe: 0.2099, Trades: 12
[INFO] Kmeans cluster 4: SMA(118/272) - Original Sharpe: 0.1886, Trades: 13
[INFO] Kmeans cluster 5: SMA(130/168) - Original Sharpe: 0.0810, Trades: 25
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/22)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (160/198) - Sharpe: 0.6328
[INFO] cluster 2: (130/218) - Sharpe: 0.4312
[INFO] cluster 3: (68/250) - Sharpe: 0.2099
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -3.504421           -2.421152
1    2021-11-14 2021-11-14            43    -3.098247            1.510190
2    2022-01-14 2022-01-14            41     1.372559            0.530671
3    2022-03-14 2022-03-14            44    -1.165984           -0.875472
4    2022-05-14 2022-05-14            43    -1.900497            0.242755
5    2022-07-14 2022-07-14            44     2.319224           -1.151355
6    2022-09-14 2022-09-14            43     2.556621            4.593917
7    2022-11-14 2022-11-14            43    -0.052453           -3.439611
8    2023-01-14 2023-01-14            41    -4.424461            4.258386
9    2023-03-14 2023-03-14            44     3.997800           -1.051867
10   2023-05-14 2023-05-14            44     3.172571            3.089546
11   2023-07-14 2023-07-14            44     0.164211            0.071497
12   2023-09-14 2023-09-14            43    -0.266138            0.098898
13   2023-11-14 2023-11-14            42     0.656100            3.424369
14   2024-01-14 2024-01-14            43     2.638804            2.638804
15   2024-03-14 2024-03-14            42    -0.568643           -0.255646
16   2024-05-14 2024-05-14            44    -0.714126            2.633261
17   2024-07-14 2024-07-14            45    -1.907394           -2.110069
18   2024-09-14 2024-09-14            43    -1.733867            1.559373
19   2024-11-14 2024-11-14            33     2.409760           -0.567281
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -3.5 |             -2.4 |          1.1 | True          
[INFO] 2021-11-14   |         -3.1 |              1.5 |          4.6 | True          
[INFO] 2022-01-14   |          1.4 |              0.5 |         -0.9 | False         
[INFO] 2022-03-14   |         -1.2 |             -0.9 |          0.3 | True          
[INFO] 2022-05-14   |         -1.9 |              0.2 |          2.1 | True          
[INFO] 2022-07-14   |          2.3 |             -1.2 |         -3.5 | False         
[INFO] 2022-09-14   |          2.6 |              4.6 |          2.0 | True          
[INFO] 2022-11-14   |         -0.1 |             -3.4 |         -3.3 | False         
[INFO] 2023-01-14   |         -4.4 |              4.3 |          8.7 | True          
[INFO] 2023-03-14   |          4.0 |             -1.1 |         -5.1 | False         
[INFO] 2023-05-14   |          3.2 |              3.1 |         -0.1 | False         
[INFO] 2023-07-14   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2023-09-14   |         -0.3 |              0.1 |          0.4 | True          
[INFO] 2023-11-14   |          0.7 |              3.4 |          2.7 | True          
[INFO] 2024-01-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.6 |             -0.3 |          0.3 | True          
[INFO] 2024-05-14   |         -0.7 |              2.6 |          3.3 | True          
[INFO] 2024-07-14   |         -1.9 |             -2.1 |         -0.2 | False         
[INFO] 2024-09-14   |         -1.7 |              1.6 |          3.3 | True          
[INFO] 2024-11-14   |          2.4 |             -0.6 |         -3.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 11 of 19 periods (57.89% win rate)
[INFO] Updating Excel file with Kmeans results for NK...
[INFO] Excel file updated successfully. Added NK with Kmeans win rate 57.9% in row 36
[INFO] Added best Sharpe parameters 20/22 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 22
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(160/198) - Original Sharpe: 0.6328
[INFO] Added cluster 2 to portfolio: SMA(130/218) - Original Sharpe: 0.4312
[INFO] Added cluster 3 to portfolio: SMA(68/250) - Original Sharpe: 0.2099
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NK_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.5531
[INFO] Kmeans Best out-of-sample Sharpe: -0.0843
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NK...
[INFO] Excel file updated successfully. Added NK with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NK
[INFO] Big Point Value: 5.0
[INFO] Slippage: 35.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6475 to 0.8609
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 22
[INFO] Sharpe Ratio: 0.860889
[INFO] Number of Trades: 251
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10417 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6475 to 0.8609
[INFO] Trades range: 10.0 to 343.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3841 to 2.7941
[INFO] Scaled Long SMA range: -2.7959 to 1.4302
[INFO] Scaled Sharpe ratio range: -3.3641 to 4.1025
[INFO] Scaled Trades range: -0.7787 to 13.9661
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10417 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5252
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 2190 elements
[INFO] Cluster 1: 863 elements
[INFO] Cluster 2: 1238 elements
[INFO] Cluster 3: 854 elements
[INFO] Cluster 4: 155 elements
[INFO] Cluster 5: 436 elements
[INFO] Cluster 6: 767 elements
[INFO] Cluster 7: 1072 elements
[INFO] Cluster 8: 578 elements
[INFO] Cluster 9: 22 elements
[INFO] Cluster 10: 410 elements
[INFO] Cluster 11: 278 elements
[INFO] Cluster 12: 1008 elements
[INFO] Cluster 13: 486 elements
[INFO] Cluster 14: 60 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=74, Long SMA=164, Sharpe=-0.0082, Trades=22
[INFO] Cluster 1 cluster: Short SMA=44, Long SMA=90, Sharpe=-0.2223, Trades=44
[INFO] Cluster 2 cluster: Short SMA=100, Long SMA=228, Sharpe=0.3461, Trades=17
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=270, Sharpe=-0.0220, Trades=19
[INFO] Cluster 4 cluster: Short SMA=34, Long SMA=40, Sharpe=0.0278, Trades=121
[INFO] Cluster 5 cluster: Short SMA=160, Long SMA=190, Sharpe=0.5251, Trades=26
[INFO] Cluster 6 cluster: Short SMA=242, Long SMA=266, Sharpe=-0.0635, Trades=20
[INFO] Cluster 7 cluster: Short SMA=186, Long SMA=270, Sharpe=0.0267, Trades=13
[INFO] Cluster 8 cluster: Short SMA=22, Long SMA=190, Sharpe=-0.1507, Trades=36
[INFO] Cluster 9 cluster: Short SMA=26, Long SMA=28, Sharpe=-0.0946, Trades=228
[INFO] Cluster 10 cluster: Short SMA=114, Long SMA=134, Sharpe=-0.1883, Trades=43
[INFO] Cluster 11 cluster: Short SMA=28, Long SMA=60, Sharpe=-0.1075, Trades=68
[INFO] Cluster 12 cluster: Short SMA=108, Long SMA=272, Sharpe=0.1441, Trades=11
[INFO] Cluster 13 cluster: Short SMA=192, Long SMA=224, Sharpe=-0.0717, Trades=19
[INFO] Cluster 14 cluster: Short SMA=160, Long SMA=162, Sharpe=0.0820, Trades=104
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=22, Sharpe=0.8609, Trades=251
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=160, Long SMA=190, Sharpe=0.5251, Trades=26
[INFO] Top 2: Short SMA=100, Long SMA=228, Sharpe=0.3461, Trades=17
[INFO] Top 3: Short SMA=108, Long SMA=272, Sharpe=0.1441, Trades=11
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10417 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 22
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(160/190) - Original Sharpe: 0.5251, Trades: 26
[INFO] Hierarchical cluster 2: SMA(100/228) - Original Sharpe: 0.3461, Trades: 17
[INFO] Hierarchical cluster 3: SMA(108/272) - Original Sharpe: 0.1441, Trades: 11
[INFO] Hierarchical cluster 4: SMA(160/162) - Original Sharpe: 0.0820, Trades: 104
[INFO] Hierarchical cluster 5: SMA(34/40) - Original Sharpe: 0.0278, Trades: 121
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/22)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (160/190) - Sharpe: 0.5251
[INFO] cluster 2: (100/228) - Sharpe: 0.3461
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -3.504421           -4.300990
1    2021-11-14 2021-11-14            43    -3.098247            0.786625
2    2022-01-14 2022-01-14            41     1.372559            0.511001
3    2022-03-14 2022-03-14            44    -1.165984           -0.244600
4    2022-05-14 2022-05-14            43    -1.900497            0.242755
5    2022-07-14 2022-07-14            44     2.319224           -1.151355
6    2022-09-14 2022-09-14            43     2.556621            2.679576
7    2022-11-14 2022-11-14            43    -0.052453           -3.439611
8    2023-01-14 2023-01-14            41    -4.424461            2.094794
9    2023-03-14 2023-03-14            44     3.997800            1.153429
10   2023-05-14 2023-05-14            44     3.172571            3.352666
11   2023-07-14 2023-07-14            44     0.164211            0.071497
12   2023-09-14 2023-09-14            43    -0.266138            0.098898
13   2023-11-14 2023-11-14            42     0.656100            3.424369
14   2024-01-14 2024-01-14            43     2.638804            2.638804
15   2024-03-14 2024-03-14            42    -0.568643           -0.255646
16   2024-05-14 2024-05-14            44    -0.714126            2.633261
17   2024-07-14 2024-07-14            45    -1.907394           -2.110069
18   2024-09-14 2024-09-14            43    -1.733867            1.892408
19   2024-11-14 2024-11-14            33     2.409760           -0.838366
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -3.5 |             -4.3 |         -0.8 | False         
[INFO] 2021-11-14   |         -3.1 |              0.8 |          3.9 | True          
[INFO] 2022-01-14   |          1.4 |              0.5 |         -0.9 | False         
[INFO] 2022-03-14   |         -1.2 |             -0.2 |          1.0 | True          
[INFO] 2022-05-14   |         -1.9 |              0.2 |          2.1 | True          
[INFO] 2022-07-14   |          2.3 |             -1.2 |         -3.5 | False         
[INFO] 2022-09-14   |          2.6 |              2.7 |          0.1 | True          
[INFO] 2022-11-14   |         -0.1 |             -3.4 |         -3.3 | False         
[INFO] 2023-01-14   |         -4.4 |              2.1 |          6.5 | True          
[INFO] 2023-03-14   |          4.0 |              1.2 |         -2.8 | False         
[INFO] 2023-05-14   |          3.2 |              3.4 |          0.2 | True          
[INFO] 2023-07-14   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2023-09-14   |         -0.3 |              0.1 |          0.4 | True          
[INFO] 2023-11-14   |          0.7 |              3.4 |          2.7 | True          
[INFO] 2024-01-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.6 |             -0.3 |          0.3 | True          
[INFO] 2024-05-14   |         -0.7 |              2.6 |          3.3 | True          
[INFO] 2024-07-14   |         -1.9 |             -2.1 |         -0.2 | False         
[INFO] 2024-09-14   |         -1.7 |              1.9 |          3.6 | True          
[INFO] 2024-11-14   |          2.4 |             -0.8 |         -3.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 19 periods (57.89% win rate)
[INFO] Updating Excel file with Hierarchical results for NK...
[INFO] Excel file updated successfully. Added NK with Hierarchical win rate 57.9% in row 36
[INFO] Added best Sharpe parameters 20/22 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 22
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(160/190) - Original Sharpe: 0.5251
[INFO] Added cluster 2 to portfolio: SMA(100/228) - Original Sharpe: 0.3461
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NK_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.4892
[INFO] Hierarchical Best out-of-sample Sharpe: -0.0843
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NK...
[INFO] Excel file updated successfully. Added NK with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NK
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NQ in column D: 11.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 270.61s
[INFO] Best parameters: Short SMA = 210, Long SMA = 234
[INFO] Best Sharpe ratio: 1.114521, Trades: 10
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_NQ_best_210/234 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NQ
[INFO] Big Point Value (from data): 20.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.56 contracts
[INFO] Maximum Position Size: 11 contracts
[INFO] Strategy Total P&L: $690,104.00
[INFO] Market Buy & Hold P&L: $312,105.00
[INFO] Outperformance: $377,999.00
[INFO] Sharpe ratio (entire period, annualized): 0.738582
[INFO] Sharpe ratio (in-sample, annualized): 1.114521
[INFO] Sharpe ratio (out-of-sample, annualized): 0.029416
[INFO] Maximum Drawdown: $205,067.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 6
[INFO] Out-of-sample period trades: 4
[INFO] Total trades: 10
[INFO] In-sample P&L: $742,024.00
[INFO] Out-of-sample P&L: $10,238.00
[INFO] 
Best parameters from GA: Short SMA = 210, Long SMA = 234, Sharpe = 1.114521
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 20.0
[INFO] Slippage: 11.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.2377 to 1.1145
[INFO] 
Best parameters:
[INFO] Short SMA: 210
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.114521
[INFO] Number of Trades: 10
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 6490 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.2377 to 1.1145
[INFO] Trades range: 10.0 to 305.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0679 to 2.6754
[INFO] Scaled Long SMA range: -2.3404 to 1.7698
[INFO] Scaled Sharpe ratio range: -4.0912 to 2.6527
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 13
[INFO] Using 13 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=13...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 610 elements
[INFO] Kmeans Cluster 1: 465 elements
[INFO] Kmeans Cluster 2: 305 elements
[INFO] Kmeans Cluster 3: 528 elements
[INFO] Kmeans Cluster 4: 512 elements
[INFO] Kmeans Cluster 5: 424 elements
[INFO] Kmeans Cluster 6: 585 elements
[INFO] Kmeans Cluster 7: 415 elements
[INFO] Kmeans Cluster 8: 621 elements
[INFO] Kmeans Cluster 9: 386 elements
[INFO] Kmeans Cluster 10: 447 elements
[INFO] Kmeans Cluster 11: 486 elements
[INFO] Kmeans Cluster 12: 706 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=34.71, Long SMA=135.16, Sharpe=0.5980
[INFO] Centroid 1: Short SMA=257.97, Long SMA=281.42, Sharpe=0.7363
[INFO] Centroid 2: Short SMA=27.36, Long SMA=57.59, Sharpe=0.0645
[INFO] Centroid 3: Short SMA=31.95, Long SMA=275.21, Sharpe=0.6086
[INFO] Centroid 4: Short SMA=78.98, Long SMA=131.87, Sharpe=0.5197
[INFO] Centroid 5: Short SMA=44.07, Long SMA=92.96, Sharpe=0.4306
[INFO] Centroid 6: Short SMA=33.22, Long SMA=223.78, Sharpe=0.5913
[INFO] Centroid 7: Short SMA=112.27, Long SMA=171.95, Sharpe=0.7753
[INFO] Centroid 8: Short SMA=216.54, Long SMA=248.71, Sharpe=0.9065
[INFO] Centroid 9: Short SMA=173.52, Long SMA=192.72, Sharpe=0.6569
[INFO] Centroid 10: Short SMA=115.70, Long SMA=145.65, Sharpe=0.6406
[INFO] Centroid 11: Short SMA=45.31, Long SMA=72.97, Sharpe=0.2623
[INFO] Centroid 12: Short SMA=44.74, Long SMA=179.74, Sharpe=0.5464
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=210, Long SMA=234, Sharpe=1.1145, Trades=10
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=218, Long SMA=248, Sharpe=0.9490, Trades=10
[INFO] Kmeans Top 2: Short SMA=110, Long SMA=166, Sharpe=0.8467, Trades=12
[INFO] Kmeans Top 3: Short SMA=258, Long SMA=282, Sharpe=0.7238, Trades=11
[INFO] Kmeans Top 4: Short SMA=118, Long SMA=144, Sharpe=0.6697, Trades=21
[INFO] Kmeans Top 5: Short SMA=174, Long SMA=192, Sharpe=0.6626, Trades=10
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12}
[INFO]   Rounded: (35, 135)
[INFO]   Nearest: (34.0, 136.0)
[INFO]   Rounded: (258, 281)
[INFO]   Nearest: (258.0, 282.0)
[INFO]   Rounded: (27, 58)
[INFO]   Nearest: (28.0, 58.0)
[INFO]   Rounded: (32, 275)
[INFO]   Nearest: (32.0, 276.0)
[INFO]   Rounded: (79, 132)
[INFO]   Nearest: (78.0, 132.0)
[INFO]   Rounded: (44, 93)
[INFO]   Nearest: (44.0, 92.0)
[INFO]   Rounded: (33, 224)
[INFO]   Nearest: (34.0, 224.0)
[INFO]   Rounded: (112, 172)
[INFO]   Rounded: (217, 249)
[INFO]   Nearest: (216.0, 248.0)
[INFO]   Rounded: (174, 193)
[INFO]   Nearest: (174.0, 192.0)
[INFO]   Rounded: (116, 146)
[INFO]   Rounded: (45, 73)
[INFO]   Nearest: (46.0, 72.0)
[INFO]   Rounded: (45, 180)
[INFO]   Nearest: (44.0, 180.0)
[INFO] Successfully plotted 13 out of 13 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 210, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(218/248) - Original Sharpe: 0.9490, Trades: 10
[INFO] Kmeans cluster 2: SMA(110/166) - Original Sharpe: 0.8467, Trades: 12
[INFO] Kmeans cluster 3: SMA(258/282) - Original Sharpe: 0.7238, Trades: 11
[INFO] Kmeans cluster 4: SMA(118/144) - Original Sharpe: 0.6697, Trades: 21
[INFO] Kmeans cluster 5: SMA(174/192) - Original Sharpe: 0.6626, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (210/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (218/248) - Sharpe: 0.9490
[INFO] cluster 2: (110/166) - Sharpe: 0.8467
[INFO] cluster 3: (258/282) - Sharpe: 0.7238
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     1.806484            1.806484
1    2021-11-14 2021-11-14            43    -0.977041           -0.977041
2    2022-01-14 2022-01-14            41    -2.947949           -2.947949
3    2022-03-14 2022-03-14            44    -1.115967            1.380671
4    2022-05-14 2022-05-14            43     1.940963            1.680420
5    2022-07-14 2022-07-14            44     0.287301            0.338875
6    2022-09-14 2022-09-14            43     0.419792            0.419792
7    2022-11-14 2022-11-14            43     0.548831            0.548831
8    2023-01-14 2023-01-14            41    -0.831080           -0.831080
9    2023-03-14 2023-03-14            44    -1.028325           -4.061138
10   2023-05-14 2023-05-14            44    -3.465831            1.312494
11   2023-07-14 2023-07-14            44    -0.679801           -2.228813
12   2023-09-14 2023-09-14            43    -0.029656           -0.029656
13   2023-11-14 2023-11-14            42     3.419744            3.419744
14   2024-01-14 2024-01-14            43     2.462763            2.462763
15   2024-03-14 2024-03-14            42    -1.004018           -1.004018
16   2024-05-14 2024-05-14            44     4.245445            4.245445
17   2024-07-14 2024-07-14            45    -2.152848           -2.152848
18   2024-09-14 2024-09-14            43     2.552179            2.552179
19   2024-11-14 2024-11-14            33    -1.170159           -1.170159
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.9 |             -2.9 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.1 |              1.4 |          2.5 | True          
[INFO] 2022-05-14   |          1.9 |              1.7 |         -0.2 | False         
[INFO] 2022-07-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -1.0 |             -4.1 |         -3.1 | False         
[INFO] 2023-05-14   |         -3.5 |              1.3 |          4.8 | True          
[INFO] 2023-07-14   |         -0.7 |             -2.2 |         -1.5 | False         
[INFO] 2023-09-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 5
[INFO] Kmeans cluster wins (rounded comparison): 2 of 5 periods (40.00% win rate)
[INFO] Updating Excel file with Kmeans results for NQ...
[INFO] Excel file updated successfully. Added NQ with Kmeans win rate 40.0% in row 37
[INFO] Added best Sharpe parameters 210/234 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 210, Long SMA: 234
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(218/248) - Original Sharpe: 0.9490
[INFO] Added cluster 2 to portfolio: SMA(110/166) - Original Sharpe: 0.8467
[INFO] Added cluster 3 to portfolio: SMA(258/282) - Original Sharpe: 0.7238
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NQ_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1596
[INFO] Kmeans Best out-of-sample Sharpe: 0.0294
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NQ...
[INFO] Excel file updated successfully. Added NQ with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NQ
[INFO] Big Point Value: 20.0
[INFO] Slippage: 11.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.2377 to 1.1145
[INFO] 
Best parameters:
[INFO] Short SMA: 210
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.114521
[INFO] Number of Trades: 10
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 6490 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.2377 to 1.1145
[INFO] Trades range: 10.0 to 305.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0679 to 2.6754
[INFO] Scaled Long SMA range: -2.3404 to 1.7698
[INFO] Scaled Sharpe ratio range: -4.0912 to 2.6527
[INFO] Scaled Trades range: -0.5631 to 13.6657
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 6490 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.7509
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 432 elements
[INFO] Cluster 1: 213 elements
[INFO] Cluster 2: 1106 elements
[INFO] Cluster 3: 789 elements
[INFO] Cluster 4: 402 elements
[INFO] Cluster 5: 526 elements
[INFO] Cluster 6: 528 elements
[INFO] Cluster 7: 340 elements
[INFO] Cluster 8: 662 elements
[INFO] Cluster 9: 407 elements
[INFO] Cluster 10: 344 elements
[INFO] Cluster 11: 43 elements
[INFO] Cluster 12: 14 elements
[INFO] Cluster 13: 483 elements
[INFO] Cluster 14: 201 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=114, Long SMA=132, Sharpe=0.5490, Trades=23
[INFO] Cluster 1 cluster: Short SMA=26, Long SMA=40, Sharpe=0.1521, Trades=72
[INFO] Cluster 2 cluster: Short SMA=52, Long SMA=160, Sharpe=0.5370, Trades=10
[INFO] Cluster 3 cluster: Short SMA=28, Long SMA=262, Sharpe=0.5834, Trades=12
[INFO] Cluster 4 cluster: Short SMA=38, Long SMA=64, Sharpe=0.2319, Trades=50
[INFO] Cluster 5 cluster: Short SMA=38, Long SMA=206, Sharpe=0.5724, Trades=10
[INFO] Cluster 6 cluster: Short SMA=162, Long SMA=184, Sharpe=0.5887, Trades=10
[INFO] Cluster 7 cluster: Short SMA=104, Long SMA=170, Sharpe=0.8016, Trades=12
[INFO] Cluster 8 cluster: Short SMA=48, Long SMA=116, Sharpe=0.5503, Trades=20
[INFO] Cluster 9 cluster: Short SMA=212, Long SMA=236, Sharpe=0.9823, Trades=10
[INFO] Cluster 10 cluster: Short SMA=44, Long SMA=88, Sharpe=0.2673, Trades=30
[INFO] Cluster 11 cluster: Short SMA=34, Long SMA=36, Sharpe=0.0838, Trades=134
[INFO] Cluster 13 cluster: Short SMA=238, Long SMA=276, Sharpe=0.8473, Trades=11
[INFO] Cluster 14 cluster: Short SMA=270, Long SMA=280, Sharpe=0.6507, Trades=27
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=210, Long SMA=234, Sharpe=1.1145, Trades=10
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=212, Long SMA=236, Sharpe=0.9823, Trades=10
[INFO] Top 2: Short SMA=238, Long SMA=276, Sharpe=0.8473, Trades=11
[INFO] Top 3: Short SMA=104, Long SMA=170, Sharpe=0.8016, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 6476 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 210, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(212/236) - Original Sharpe: 0.9823, Trades: 10
[INFO] Hierarchical cluster 2: SMA(238/276) - Original Sharpe: 0.8473, Trades: 11
[INFO] Hierarchical cluster 3: SMA(104/170) - Original Sharpe: 0.8016, Trades: 12
[INFO] Hierarchical cluster 4: SMA(270/280) - Original Sharpe: 0.6507, Trades: 27
[INFO] Hierarchical cluster 5: SMA(162/184) - Original Sharpe: 0.5887, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (210/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (212/236) - Sharpe: 0.9823
[INFO] cluster 2: (238/276) - Sharpe: 0.8473
[INFO] cluster 3: (104/170) - Sharpe: 0.8016
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     1.806484            1.806484
1    2021-11-14 2021-11-14            43    -0.977041           -0.977041
2    2022-01-14 2022-01-14            41    -2.947949           -2.947949
3    2022-03-14 2022-03-14            44    -1.115967            2.019949
4    2022-05-14 2022-05-14            43     1.940963            1.477915
5    2022-07-14 2022-07-14            44     0.287301            0.287301
6    2022-09-14 2022-09-14            43     0.419792            0.419792
7    2022-11-14 2022-11-14            43     0.548831            0.548831
8    2023-01-14 2023-01-14            41    -0.831080           -0.831080
9    2023-03-14 2023-03-14            44    -1.028325           -3.938804
10   2023-05-14 2023-05-14            44    -3.465831            3.725452
11   2023-07-14 2023-07-14            44    -0.679801            0.678175
12   2023-09-14 2023-09-14            43    -0.029656           -0.029656
13   2023-11-14 2023-11-14            42     3.419744            3.419744
14   2024-01-14 2024-01-14            43     2.462763            2.462763
15   2024-03-14 2024-03-14            42    -1.004018           -1.004018
16   2024-05-14 2024-05-14            44     4.245445            4.245445
17   2024-07-14 2024-07-14            45    -2.152848           -2.152848
18   2024-09-14 2024-09-14            43     2.552179            2.552179
19   2024-11-14 2024-11-14            33    -1.170159           -1.170159
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.9 |             -2.9 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.1 |              2.0 |          3.1 | True          
[INFO] 2022-05-14   |          1.9 |              1.5 |         -0.4 | False         
[INFO] 2022-07-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -1.0 |             -3.9 |         -2.9 | False         
[INFO] 2023-05-14   |         -3.5 |              3.7 |          7.2 | True          
[INFO] 2023-07-14   |         -0.7 |              0.7 |          1.4 | True          
[INFO] 2023-09-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 5
[INFO] Hierarchical cluster wins (rounded comparison): 3 of 5 periods (60.00% win rate)
[INFO] Updating Excel file with Hierarchical results for NQ...
[INFO] Excel file updated successfully. Added NQ with Hierarchical win rate 60.0% in row 37
[INFO] Added best Sharpe parameters 210/234 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 210, Long SMA: 234
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(212/236) - Original Sharpe: 0.9823
[INFO] Added cluster 2 to portfolio: SMA(238/276) - Original Sharpe: 0.8473
[INFO] Added cluster 3 to portfolio: SMA(104/170) - Original Sharpe: 0.8016
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NQ_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3063
[INFO] Hierarchical Best out-of-sample Sharpe: 0.0294
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NQ...
[INFO] Excel file updated successfully. Added NQ with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NQ
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for PA in column D: 80.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 279.86s
[INFO] Best parameters: Short SMA = 112, Long SMA = 174
[INFO] Best Sharpe ratio: 0.926948, Trades: 16
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_PA_best_112/174 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @PA=13INC
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 2.59 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $712,220.00
[INFO] Market Buy & Hold P&L: $9,530.00
[INFO] Outperformance: $702,690.00
[INFO] Sharpe ratio (entire period, annualized): 0.716294
[INFO] Sharpe ratio (in-sample, annualized): 0.926948
[INFO] Sharpe ratio (out-of-sample, annualized): 0.281614
[INFO] Maximum Drawdown: $241,380.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 10
[INFO] Out-of-sample period trades: 6
[INFO] Total trades: 16
[INFO] In-sample P&L: $597,115.00
[INFO] Out-of-sample P&L: $87,290.00
[INFO] 
Best parameters from GA: Short SMA = 112, Long SMA = 174, Sharpe = 0.926948
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 80.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5147 to 0.9269
[INFO] 
Best parameters:
[INFO] Short SMA: 112
[INFO] Long SMA: 174
[INFO] Sharpe Ratio: 0.926948
[INFO] Number of Trades: 16
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8657 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5147 to 0.9269
[INFO] Trades range: 10.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2463 to 2.7391
[INFO] Scaled Long SMA range: -2.6546 to 1.6587
[INFO] Scaled Sharpe ratio range: -4.6266 to 2.1322
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 18
[INFO] Using 18 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=18...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 477 elements
[INFO] Kmeans Cluster 1: 577 elements
[INFO] Kmeans Cluster 2: 422 elements
[INFO] Kmeans Cluster 3: 783 elements
[INFO] Kmeans Cluster 4: 472 elements
[INFO] Kmeans Cluster 5: 524 elements
[INFO] Kmeans Cluster 6: 519 elements
[INFO] Kmeans Cluster 7: 594 elements
[INFO] Kmeans Cluster 8: 458 elements
[INFO] Kmeans Cluster 9: 594 elements
[INFO] Kmeans Cluster 10: 240 elements
[INFO] Kmeans Cluster 11: 156 elements
[INFO] Kmeans Cluster 12: 540 elements
[INFO] Kmeans Cluster 13: 360 elements
[INFO] Kmeans Cluster 14: 361 elements
[INFO] Kmeans Cluster 15: 570 elements
[INFO] Kmeans Cluster 16: 477 elements
[INFO] Kmeans Cluster 17: 533 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=133.81, Long SMA=227.43, Sharpe=0.4413
[INFO] Centroid 1: Short SMA=64.57, Long SMA=114.27, Sharpe=0.4747
[INFO] Centroid 2: Short SMA=31.15, Long SMA=81.43, Sharpe=0.0615
[INFO] Centroid 3: Short SMA=220.96, Long SMA=259.93, Sharpe=0.4287
[INFO] Centroid 4: Short SMA=102.55, Long SMA=180.30, Sharpe=0.7391
[INFO] Centroid 5: Short SMA=25.72, Long SMA=253.89, Sharpe=0.6916
[INFO] Centroid 6: Short SMA=49.67, Long SMA=279.17, Sharpe=0.5054
[INFO] Centroid 7: Short SMA=97.73, Long SMA=141.60, Sharpe=0.6331
[INFO] Centroid 8: Short SMA=183.21, Long SMA=229.31, Sharpe=0.5047
[INFO] Centroid 9: Short SMA=48.61, Long SMA=161.41, Sharpe=0.7078
[INFO] Centroid 10: Short SMA=15.74, Long SMA=55.09, Sharpe=-0.2028
[INFO] Centroid 11: Short SMA=13.76, Long SMA=167.88, Sharpe=0.2741
[INFO] Centroid 12: Short SMA=36.10, Long SMA=190.16, Sharpe=0.5418
[INFO] Centroid 13: Short SMA=172.46, Long SMA=191.85, Sharpe=0.3242
[INFO] Centroid 14: Short SMA=262.30, Long SMA=287.33, Sharpe=0.2376
[INFO] Centroid 15: Short SMA=68.68, Long SMA=223.88, Sharpe=0.6295
[INFO] Centroid 16: Short SMA=48.59, Long SMA=83.57, Sharpe=0.2645
[INFO] Centroid 17: Short SMA=142.56, Long SMA=180.23, Sharpe=0.4993
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=112, Long SMA=174, Sharpe=0.9269, Trades=16
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=102, Long SMA=180, Sharpe=0.8251, Trades=12
[INFO] Kmeans Top 2: Short SMA=50, Long SMA=162, Sharpe=0.7371, Trades=14
[INFO] Kmeans Top 3: Short SMA=26, Long SMA=252, Sharpe=0.6778, Trades=14
[INFO] Kmeans Top 4: Short SMA=98, Long SMA=142, Sharpe=0.6583, Trades=20
[INFO] Kmeans Top 5: Short SMA=68, Long SMA=224, Sharpe=0.6581, Trades=11
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17}
[INFO]   Rounded: (134, 227)
[INFO]   Nearest: (134.0, 228.0)
[INFO]   Rounded: (65, 114)
[INFO]   Nearest: (64.0, 114.0)
[INFO]   Rounded: (31, 81)
[INFO]   Nearest: (32.0, 82.0)
[INFO]   Rounded: (221, 260)
[INFO]   Nearest: (220.0, 260.0)
[INFO]   Rounded: (103, 180)
[INFO]   Nearest: (102.0, 180.0)
[INFO]   Rounded: (26, 254)
[INFO]   Rounded: (50, 279)
[INFO]   Nearest: (50.0, 280.0)
[INFO]   Rounded: (98, 142)
[INFO]   Rounded: (183, 229)
[INFO]   Nearest: (184.0, 230.0)
[INFO]   Rounded: (49, 161)
[INFO]   Nearest: (48.0, 162.0)
[INFO]   Rounded: (16, 55)
[INFO]   Nearest: (16.0, 56.0)
[INFO]   Rounded: (14, 168)
[INFO]   Rounded: (36, 190)
[INFO]   Rounded: (172, 192)
[INFO]   Rounded: (262, 287)
[INFO]   Nearest: (262.0, 288.0)
[INFO]   Rounded: (69, 224)
[INFO]   Nearest: (68.0, 224.0)
[INFO]   Rounded: (49, 84)
[INFO]   Nearest: (48.0, 84.0)
[INFO]   Rounded: (143, 180)
[INFO]   Nearest: (142.0, 180.0)
[INFO] Successfully plotted 18 out of 18 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 112, Long SMA: 174
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(102/180) - Original Sharpe: 0.8251, Trades: 12
[INFO] Kmeans cluster 2: SMA(50/162) - Original Sharpe: 0.7371, Trades: 14
[INFO] Kmeans cluster 3: SMA(26/252) - Original Sharpe: 0.6778, Trades: 14
[INFO] Kmeans cluster 4: SMA(98/142) - Original Sharpe: 0.6583, Trades: 20
[INFO] Kmeans cluster 5: SMA(68/224) - Original Sharpe: 0.6581, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (112/174)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (102/180) - Sharpe: 0.8251
[INFO] cluster 2: (50/162) - Sharpe: 0.7371
[INFO] cluster 3: (26/252) - Sharpe: 0.6778
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.848635           -1.350422
1    2021-11-14 2021-11-14            43     1.505824            1.505824
2    2022-01-14 2022-01-14            41    -4.150479           -5.205744
3    2022-03-14 2022-03-14            44    -0.356482           -2.536197
4    2022-05-14 2022-05-14            43     0.314844           -0.458489
5    2022-07-14 2022-07-14            44     2.699252           -0.811337
6    2022-09-14 2022-09-14            43     0.350844           -1.467934
7    2022-11-14 2022-11-14            43     3.719452            1.890097
8    2023-01-14 2023-01-14            41     2.654910            3.406412
9    2023-03-14 2023-03-14            43    -1.548584           -1.548584
10   2023-05-14 2023-05-14            44     3.059517            3.059517
11   2023-07-14 2023-07-14            44     0.609800            0.609800
12   2023-09-14 2023-09-14            43     4.868598            4.868598
13   2023-11-14 2023-11-14            42     0.159231            0.159231
14   2024-01-14 2024-01-14            43    -1.143094           -1.143094
15   2024-03-14 2024-03-14            42     1.807282            1.807282
16   2024-05-14 2024-05-14            44     0.086225            0.086225
17   2024-07-14 2024-07-14            45    -1.430493           -1.430493
18   2024-09-14 2024-09-14            43     1.688514            0.496976
19   2024-11-14 2024-11-14            33    -3.034107           -2.542481
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.8 |             -1.4 |          1.4 | True          
[INFO] 2021-11-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -4.2 |             -5.2 |         -1.0 | False         
[INFO] 2022-03-14   |         -0.4 |             -2.5 |         -2.1 | False         
[INFO] 2022-05-14   |          0.3 |             -0.5 |         -0.8 | False         
[INFO] 2022-07-14   |          2.7 |             -0.8 |         -3.5 | False         
[INFO] 2022-09-14   |          0.4 |             -1.5 |         -1.9 | False         
[INFO] 2022-11-14   |          3.7 |              1.9 |         -1.8 | False         
[INFO] 2023-01-14   |          2.7 |              3.4 |          0.7 | True          
[INFO] 2023-03-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          4.9 |              4.9 |          0.0 | Excluded      
[INFO] 2023-11-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          1.7 |              0.5 |         -1.2 | False         
[INFO] 2024-11-14   |         -3.0 |             -2.5 |          0.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Kmeans cluster wins (rounded comparison): 3 of 10 periods (30.00% win rate)
[INFO] Updating Excel file with Kmeans results for PA...
[INFO] Excel file updated successfully. Added PA with Kmeans win rate 30.0% in row 38
[INFO] Added best Sharpe parameters 112/174 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 112, Long SMA: 174
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(102/180) - Original Sharpe: 0.8251
[INFO] Added cluster 2 to portfolio: SMA(50/162) - Original Sharpe: 0.7371
[INFO] Added cluster 3 to portfolio: SMA(26/252) - Original Sharpe: 0.6778
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'PA_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0747
[INFO] Kmeans Best out-of-sample Sharpe: 0.2816
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for PA...
[INFO] Excel file updated successfully. Added PA with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PA
[INFO] Big Point Value: 100.0
[INFO] Slippage: 80.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5147 to 0.9269
[INFO] 
Best parameters:
[INFO] Short SMA: 112
[INFO] Long SMA: 174
[INFO] Sharpe Ratio: 0.926948
[INFO] Number of Trades: 16
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8657 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5147 to 0.9269
[INFO] Trades range: 10.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2463 to 2.7391
[INFO] Scaled Long SMA range: -2.6546 to 1.6587
[INFO] Scaled Sharpe ratio range: -4.6266 to 2.1322
[INFO] Scaled Trades range: -0.6520 to 13.4916
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8657 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5757
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 12
[INFO] Using 12 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 12 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1293 elements
[INFO] Cluster 1: 1324 elements
[INFO] Cluster 2: 970 elements
[INFO] Cluster 3: 895 elements
[INFO] Cluster 4: 131 elements
[INFO] Cluster 5: 963 elements
[INFO] Cluster 6: 772 elements
[INFO] Cluster 7: 31 elements
[INFO] Cluster 8: 206 elements
[INFO] Cluster 9: 301 elements
[INFO] Cluster 10: 357 elements
[INFO] Cluster 11: 1414 elements
[INFO] Using 12 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=42, Long SMA=262, Sharpe=0.6204, Trades=14
[INFO] Cluster 1 cluster: Short SMA=88, Long SMA=160, Sharpe=0.5542, Trades=15
[INFO] Cluster 2 cluster: Short SMA=216, Long SMA=254, Sharpe=0.4439, Trades=13
[INFO] Cluster 3 cluster: Short SMA=64, Long SMA=120, Sharpe=0.3422, Trades=29
[INFO] Cluster 4 cluster: Short SMA=44, Long SMA=50, Sharpe=0.0811, Trades=106
[INFO] Cluster 5 cluster: Short SMA=58, Long SMA=202, Sharpe=0.4957, Trades=14
[INFO] Cluster 6 cluster: Short SMA=36, Long SMA=92, Sharpe=0.1777, Trades=40
[INFO] Cluster 7 cluster: Short SMA=16, Long SMA=20, Sharpe=-0.1673, Trades=204
[INFO] Cluster 8 cluster: Short SMA=134, Long SMA=142, Sharpe=0.5521, Trades=62
[INFO] Cluster 9 cluster: Short SMA=16, Long SMA=60, Sharpe=-0.1514, Trades=62
[INFO] Cluster 10 cluster: Short SMA=262, Long SMA=288, Sharpe=0.3619, Trades=18
[INFO] Cluster 11 cluster: Short SMA=156, Long SMA=210, Sharpe=0.4646, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=112, Long SMA=174, Sharpe=0.9269, Trades=16
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=42, Long SMA=262, Sharpe=0.6204, Trades=14
[INFO] Top 2: Short SMA=88, Long SMA=160, Sharpe=0.5542, Trades=15
[INFO] Top 3: Short SMA=134, Long SMA=142, Sharpe=0.5521, Trades=62
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 12 valid clusters with clusters
[INFO] Filtering to 8657 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 112, Long SMA: 174
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(42/262) - Original Sharpe: 0.6204, Trades: 14
[INFO] Hierarchical cluster 2: SMA(88/160) - Original Sharpe: 0.5542, Trades: 15
[INFO] Hierarchical cluster 3: SMA(134/142) - Original Sharpe: 0.5521, Trades: 62
[INFO] Hierarchical cluster 4: SMA(58/202) - Original Sharpe: 0.4957, Trades: 14
[INFO] Hierarchical cluster 5: SMA(156/210) - Original Sharpe: 0.4646, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (112/174)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (42/262) - Sharpe: 0.6204
[INFO] cluster 2: (88/160) - Sharpe: 0.5542
[INFO] cluster 3: (134/142) - Sharpe: 0.5521
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.848635           -1.586460
1    2021-11-14 2021-11-14            43     1.505824            1.505824
2    2022-01-14 2022-01-14            41    -4.150479           -4.150479
3    2022-03-14 2022-03-14            44    -0.356482            0.107976
4    2022-05-14 2022-05-14            43     0.314844            0.309728
5    2022-07-14 2022-07-14            44     2.699252           -0.082017
6    2022-09-14 2022-09-14            43     0.350844           -0.921296
7    2022-11-14 2022-11-14            43     3.719452           -2.131695
8    2023-01-14 2023-01-14            41     2.654910            2.839568
9    2023-03-14 2023-03-14            43    -1.548584           -1.548584
10   2023-05-14 2023-05-14            44     3.059517            3.059517
11   2023-07-14 2023-07-14            44     0.609800            0.609800
12   2023-09-14 2023-09-14            43     4.868598            4.868598
13   2023-11-14 2023-11-14            42     0.159231            0.159231
14   2024-01-14 2024-01-14            43    -1.143094           -1.143094
15   2024-03-14 2024-03-14            42     1.807282            1.807282
16   2024-05-14 2024-05-14            44     0.086225            0.651995
17   2024-07-14 2024-07-14            45    -1.430493           -1.121677
18   2024-09-14 2024-09-14            43     1.688514           -2.510571
19   2024-11-14 2024-11-14            33    -3.034107            0.205630
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.8 |             -1.6 |          1.2 | True          
[INFO] 2021-11-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -4.2 |             -4.2 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -0.4 |              0.1 |          0.5 | True          
[INFO] 2022-05-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.7 |             -0.1 |         -2.8 | False         
[INFO] 2022-09-14   |          0.4 |             -0.9 |         -1.3 | False         
[INFO] 2022-11-14   |          3.7 |             -2.1 |         -5.8 | False         
[INFO] 2023-01-14   |          2.7 |              2.8 |          0.1 | True          
[INFO] 2023-03-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          4.9 |              4.9 |          0.0 | Excluded      
[INFO] 2023-11-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |          0.1 |              0.7 |          0.6 | True          
[INFO] 2024-07-14   |         -1.4 |             -1.1 |          0.3 | True          
[INFO] 2024-09-14   |          1.7 |             -2.5 |         -4.2 | False         
[INFO] 2024-11-14   |         -3.0 |              0.2 |          3.2 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-01-14, 2022-05-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 10 periods (60.00% win rate)
[INFO] Updating Excel file with Hierarchical results for PA...
[INFO] Excel file updated successfully. Added PA with Hierarchical win rate 60.0% in row 38
[INFO] Added best Sharpe parameters 112/174 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 112, Long SMA: 174
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(42/262) - Original Sharpe: 0.6204
[INFO] Added cluster 2 to portfolio: SMA(88/160) - Original Sharpe: 0.5542
[INFO] Added cluster 3 to portfolio: SMA(134/142) - Original Sharpe: 0.5521
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'PA_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0939
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2816
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for PA...
[INFO] Excel file updated successfully. Added PA with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PA
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for PL in column D: 20.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 277.41s
[INFO] Best parameters: Short SMA = 122, Long SMA = 126
[INFO] Best Sharpe ratio: 0.489096, Trades: 97
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_PL_best_122/126 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @PL
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 6.07 contracts
[INFO] Maximum Position Size: 11 contracts
[INFO] Strategy Total P&L: $256,175.00
[INFO] Market Buy & Hold P&L: $-30,695.00
[INFO] Outperformance: $286,870.00
[INFO] Sharpe ratio (entire period, annualized): 0.308659
[INFO] Sharpe ratio (in-sample, annualized): 0.489096
[INFO] Sharpe ratio (out-of-sample, annualized): -0.104550
[INFO] Maximum Drawdown: $174,145.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 55
[INFO] Out-of-sample period trades: 42
[INFO] Total trades: 97
[INFO] In-sample P&L: $254,115.00
[INFO] Out-of-sample P&L: $-23,720.00
[INFO] 
Best parameters from GA: Short SMA = 122, Long SMA = 126, Sharpe = 0.489096
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 20.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9850 to 0.4891
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 126
[INFO] Sharpe Ratio: 0.489096
[INFO] Number of Trades: 97
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9850 to 0.4891
[INFO] Trades range: 11.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.2033 to 3.3492
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 1083 elements
[INFO] Kmeans Cluster 1: 273 elements
[INFO] Kmeans Cluster 2: 774 elements
[INFO] Kmeans Cluster 3: 670 elements
[INFO] Kmeans Cluster 4: 617 elements
[INFO] Kmeans Cluster 5: 472 elements
[INFO] Kmeans Cluster 6: 558 elements
[INFO] Kmeans Cluster 7: 725 elements
[INFO] Kmeans Cluster 8: 365 elements
[INFO] Kmeans Cluster 9: 817 elements
[INFO] Kmeans Cluster 10: 640 elements
[INFO] Kmeans Cluster 11: 600 elements
[INFO] Kmeans Cluster 12: 667 elements
[INFO] Kmeans Cluster 13: 623 elements
[INFO] Kmeans Cluster 14: 539 elements
[INFO] Kmeans Cluster 15: 500 elements
[INFO] Kmeans Cluster 16: 662 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=49.84, Long SMA=271.84, Sharpe=-0.4665
[INFO] Centroid 1: Short SMA=122.72, Long SMA=143.25, Sharpe=0.1862
[INFO] Centroid 2: Short SMA=114.88, Long SMA=269.05, Sharpe=-0.0715
[INFO] Centroid 3: Short SMA=124.07, Long SMA=214.00, Sharpe=-0.2054
[INFO] Centroid 4: Short SMA=33.25, Long SMA=218.63, Sharpe=-0.2643
[INFO] Centroid 5: Short SMA=37.63, Long SMA=71.98, Sharpe=-0.2379
[INFO] Centroid 6: Short SMA=239.02, Long SMA=282.72, Sharpe=0.0164
[INFO] Centroid 7: Short SMA=78.90, Long SMA=209.40, Sharpe=-0.4771
[INFO] Centroid 8: Short SMA=178.67, Long SMA=210.91, Sharpe=-0.7301
[INFO] Centroid 9: Short SMA=71.45, Long SMA=142.13, Sharpe=-0.3071
[INFO] Centroid 10: Short SMA=27.74, Long SMA=167.62, Sharpe=-0.0668
[INFO] Centroid 11: Short SMA=125.67, Long SMA=167.99, Sharpe=-0.0599
[INFO] Centroid 12: Short SMA=179.78, Long SMA=229.64, Sharpe=-0.4812
[INFO] Centroid 13: Short SMA=229.59, Long SMA=261.12, Sharpe=-0.2203
[INFO] Centroid 14: Short SMA=25.84, Long SMA=76.51, Sharpe=0.0289
[INFO] Centroid 15: Short SMA=63.08, Long SMA=108.17, Sharpe=-0.5634
[INFO] Centroid 16: Short SMA=163.78, Long SMA=276.75, Sharpe=-0.3288
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=126, Sharpe=0.4891, Trades=97
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=122, Long SMA=142, Sharpe=0.2686, Trades=45
[INFO] Kmeans Top 2: Short SMA=114, Long SMA=270, Sharpe=0.0724, Trades=14
[INFO] Kmeans Top 3: Short SMA=240, Long SMA=284, Sharpe=0.0252, Trades=20
[INFO] Kmeans Top 4: Short SMA=126, Long SMA=170, Sharpe=0.0098, Trades=34
[INFO] Kmeans Top 5: Short SMA=26, Long SMA=168, Sharpe=-0.0205, Trades=26
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (50, 272)
[INFO]   Rounded: (123, 143)
[INFO]   Nearest: (122.0, 144.0)
[INFO]   Rounded: (115, 269)
[INFO]   Nearest: (114.0, 270.0)
[INFO]   Rounded: (124, 214)
[INFO]   Rounded: (33, 219)
[INFO]   Nearest: (34.0, 218.0)
[INFO]   Rounded: (38, 72)
[INFO]   Rounded: (239, 283)
[INFO]   Nearest: (240.0, 282.0)
[INFO]   Rounded: (79, 209)
[INFO]   Nearest: (78.0, 210.0)
[INFO]   Rounded: (179, 211)
[INFO]   Nearest: (178.0, 210.0)
[INFO]   Rounded: (71, 142)
[INFO]   Nearest: (72.0, 142.0)
[INFO]   Rounded: (28, 168)
[INFO]   Rounded: (126, 168)
[INFO]   Rounded: (180, 230)
[INFO]   Rounded: (230, 261)
[INFO]   Nearest: (230.0, 262.0)
[INFO]   Rounded: (26, 77)
[INFO]   Nearest: (26.0, 76.0)
[INFO]   Rounded: (63, 108)
[INFO]   Nearest: (64.0, 108.0)
[INFO]   Rounded: (164, 277)
[INFO]   Nearest: (164.0, 276.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 126
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] File size: 288521 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(122/142) - Original Sharpe: 0.2686, Trades: 45
[INFO] Kmeans cluster 2: SMA(114/270) - Original Sharpe: 0.0724, Trades: 14
[INFO] Kmeans cluster 3: SMA(240/284) - Original Sharpe: 0.0252, Trades: 20
[INFO] Kmeans cluster 4: SMA(126/170) - Original Sharpe: 0.0098, Trades: 34
[INFO] Kmeans cluster 5: SMA(26/168) - Original Sharpe: -0.0205, Trades: 26
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/126)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (122/142) - Sharpe: 0.2686
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] File size: 288521 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.390225           -2.390225
1    2021-11-14 2021-11-14            43     2.404429            2.404429
2    2022-01-14 2022-01-14            41     1.324381           -1.304674
3    2022-03-14 2022-03-14            44    -0.555883           -0.488069
4    2022-05-14 2022-05-14            43    -0.825815           -4.815247
5    2022-07-14 2022-07-14            44    -0.988424           -1.563263
6    2022-09-14 2022-09-14            43    -3.137421           -3.137421
7    2022-11-14 2022-11-14            43     0.541975            2.103754
8    2023-01-14 2023-01-14            41    -0.915581           -0.915581
9    2023-03-14 2023-03-14            43     0.468407            1.202812
10   2023-05-14 2023-05-14            44    -0.475481           -1.661030
11   2023-07-14 2023-07-14            44    -0.395339            1.785142
12   2023-09-14 2023-09-14            43     0.952901            2.753332
13   2023-11-14 2023-11-14            42    -0.229236           -1.209036
14   2024-01-14 2024-01-14            43    -2.215671           -0.754695
15   2024-03-14 2024-03-14            42     1.536450            2.369556
16   2024-05-14 2024-05-14            44     0.589741           -1.498226
17   2024-07-14 2024-07-14            45    -0.019681           -0.019681
18   2024-09-14 2024-09-14            43     2.214737            1.348904
19   2024-11-14 2024-11-14            33     1.167163            1.870860
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2021-11-14   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 2022-01-14   |          1.3 |             -1.3 |         -2.6 | False         
[INFO] 2022-03-14   |         -0.6 |             -0.5 |          0.1 | True          
[INFO] 2022-05-14   |         -0.8 |             -4.8 |         -4.0 | False         
[INFO] 2022-07-14   |         -1.0 |             -1.6 |         -0.6 | False         
[INFO] 2022-09-14   |         -3.1 |             -3.1 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.5 |              2.1 |          1.6 | True          
[INFO] 2023-01-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.5 |              1.2 |          0.7 | True          
[INFO] 2023-05-14   |         -0.5 |             -1.7 |         -1.2 | False         
[INFO] 2023-07-14   |         -0.4 |              1.8 |          2.2 | True          
[INFO] 2023-09-14   |          1.0 |              2.8 |          1.8 | True          
[INFO] 2023-11-14   |         -0.2 |             -1.2 |         -1.0 | False         
[INFO] 2024-01-14   |         -2.2 |             -0.8 |          1.4 | True          
[INFO] 2024-03-14   |          1.5 |              2.4 |          0.9 | True          
[INFO] 2024-05-14   |          0.6 |             -1.5 |         -2.1 | False         
[INFO] 2024-07-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.2 |              1.3 |         -0.9 | False         
[INFO] 2024-11-14   |          1.2 |              1.9 |          0.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-09-14, 2023-01-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Kmeans cluster wins (rounded comparison): 8 of 15 periods (53.33% win rate)
[INFO] Updating Excel file with Kmeans results for PL...
[INFO] Excel file updated successfully. Added PL with Kmeans win rate 53.3% in row 39
[INFO] Added best Sharpe parameters 122/126 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 126
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(122/142) - Original Sharpe: 0.2686
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'PL_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.2544
[INFO] Kmeans Best out-of-sample Sharpe: -0.1046
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for PL...
[INFO] Excel file updated successfully. Added PL with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PL
[INFO] Big Point Value: 50.0
[INFO] Slippage: 20.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9850 to 0.4891
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 126
[INFO] Sharpe Ratio: 0.489096
[INFO] Number of Trades: 97
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9850 to 0.4891
[INFO] Trades range: 11.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.2033 to 3.3492
[INFO] Scaled Trades range: -0.9147 to 14.1485
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5795
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 18
[INFO] Using 18 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 18 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1444 elements
[INFO] Cluster 1: 337 elements
[INFO] Cluster 2: 561 elements
[INFO] Cluster 3: 941 elements
[INFO] Cluster 4: 677 elements
[INFO] Cluster 5: 606 elements
[INFO] Cluster 6: 917 elements
[INFO] Cluster 7: 335 elements
[INFO] Cluster 8: 566 elements
[INFO] Cluster 9: 759 elements
[INFO] Cluster 10: 39 elements
[INFO] Cluster 11: 435 elements
[INFO] Cluster 12: 91 elements
[INFO] Cluster 13: 899 elements
[INFO] Cluster 14: 113 elements
[INFO] Cluster 15: 831 elements
[INFO] Cluster 16: 760 elements
[INFO] Cluster 17: 274 elements
[INFO] Using 18 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=46, Long SMA=262, Sharpe=-0.4449, Trades=22
[INFO] Cluster 1 cluster: Short SMA=44, Long SMA=54, Sharpe=0.2325, Trades=90
[INFO] Cluster 2 cluster: Short SMA=230, Long SMA=252, Sharpe=-0.1772, Trades=39
[INFO] Cluster 3 cluster: Short SMA=70, Long SMA=136, Sharpe=-0.1416, Trades=32
[INFO] Cluster 4 cluster: Short SMA=176, Long SMA=216, Sharpe=-0.8878, Trades=31
[INFO] Cluster 5 cluster: Short SMA=228, Long SMA=284, Sharpe=-0.0699, Trades=19
[INFO] Cluster 6 cluster: Short SMA=120, Long SMA=272, Sharpe=0.0179, Trades=14
[INFO] Cluster 7 cluster: Short SMA=52, Long SMA=80, Sharpe=-0.3689, Trades=52
[INFO] Cluster 8 cluster: Short SMA=128, Long SMA=156, Sharpe=-0.0810, Trades=40
[INFO] Cluster 9 cluster: Short SMA=170, Long SMA=268, Sharpe=-0.5125, Trades=13
[INFO] Cluster 10 cluster: Short SMA=28, Long SMA=30, Sharpe=-0.2571, Trades=194
[INFO] Cluster 11 cluster: Short SMA=24, Long SMA=90, Sharpe=-0.0321, Trades=44
[INFO] Cluster 12 cluster: Short SMA=100, Long SMA=104, Sharpe=-0.4474, Trades=91
[INFO] Cluster 13 cluster: Short SMA=80, Long SMA=210, Sharpe=-0.5429, Trades=20
[INFO] Cluster 14 cluster: Short SMA=244, Long SMA=248, Sharpe=-0.1248, Trades=83
[INFO] Cluster 15 cluster: Short SMA=24, Long SMA=176, Sharpe=-0.0857, Trades=30
[INFO] Cluster 16 cluster: Short SMA=126, Long SMA=206, Sharpe=-0.1477, Trades=20
[INFO] Cluster 17 cluster: Short SMA=56, Long SMA=112, Sharpe=-0.7207, Trades=34
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=126, Sharpe=0.4891, Trades=97
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=44, Long SMA=54, Sharpe=0.2325, Trades=90
[INFO] Top 2: Short SMA=120, Long SMA=272, Sharpe=0.0179, Trades=14
[INFO] Top 3: Short SMA=24, Long SMA=90, Sharpe=-0.0321, Trades=44
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 18 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 126
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] File size: 288521 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(44/54) - Original Sharpe: 0.2325, Trades: 90
[INFO] Hierarchical cluster 2: SMA(120/272) - Original Sharpe: 0.0179, Trades: 14
[INFO] Hierarchical cluster 3: SMA(24/90) - Original Sharpe: -0.0321, Trades: 44
[INFO] Hierarchical cluster 4: SMA(228/284) - Original Sharpe: -0.0699, Trades: 19
[INFO] Hierarchical cluster 5: SMA(128/156) - Original Sharpe: -0.0810, Trades: 40
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/126)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (44/54) - Sharpe: 0.2325
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] File size: 288521 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.390225           -1.258668
1    2021-11-14 2021-11-14            43     2.404429           -4.198027
2    2022-01-14 2022-01-14            41     1.324381           -0.366320
3    2022-03-14 2022-03-14            44    -0.555883           -1.234791
4    2022-05-14 2022-05-14            43    -0.825815            2.119832
5    2022-07-14 2022-07-14            44    -0.988424           -0.819901
6    2022-09-14 2022-09-14            43    -3.137421            1.389815
7    2022-11-14 2022-11-14            43     0.541975            0.501377
8    2023-01-14 2023-01-14            41    -0.915581           -2.073402
9    2023-03-14 2023-03-14            43     0.468407           -2.227439
10   2023-05-14 2023-05-14            44    -0.475481           -3.896198
11   2023-07-14 2023-07-14            44    -0.395339           -1.878256
12   2023-09-14 2023-09-14            43     0.952901            2.337459
13   2023-11-14 2023-11-14            42    -0.229236           -1.003511
14   2024-01-14 2024-01-14            43    -2.215671           -0.375822
15   2024-03-14 2024-03-14            42     1.536450           -0.485611
16   2024-05-14 2024-05-14            44     0.589741           -0.017272
17   2024-07-14 2024-07-14            45    -0.019681           -0.181297
18   2024-09-14 2024-09-14            43     2.214737           -1.106066
19   2024-11-14 2024-11-14            33     1.167163            1.199126
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.4 |             -1.3 |          1.1 | True          
[INFO] 2021-11-14   |          2.4 |             -4.2 |         -6.6 | False         
[INFO] 2022-01-14   |          1.3 |             -0.4 |         -1.7 | False         
[INFO] 2022-03-14   |         -0.6 |             -1.2 |         -0.6 | False         
[INFO] 2022-05-14   |         -0.8 |              2.1 |          2.9 | True          
[INFO] 2022-07-14   |         -1.0 |             -0.8 |          0.2 | True          
[INFO] 2022-09-14   |         -3.1 |              1.4 |          4.5 | True          
[INFO] 2022-11-14   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.9 |             -2.1 |         -1.2 | False         
[INFO] 2023-03-14   |          0.5 |             -2.2 |         -2.7 | False         
[INFO] 2023-05-14   |         -0.5 |             -3.9 |         -3.4 | False         
[INFO] 2023-07-14   |         -0.4 |             -1.9 |         -1.5 | False         
[INFO] 2023-09-14   |          1.0 |              2.3 |          1.3 | True          
[INFO] 2023-11-14   |         -0.2 |             -1.0 |         -0.8 | False         
[INFO] 2024-01-14   |         -2.2 |             -0.4 |          1.8 | True          
[INFO] 2024-03-14   |          1.5 |             -0.5 |         -2.0 | False         
[INFO] 2024-05-14   |          0.6 |             -0.0 |         -0.6 | False         
[INFO] 2024-07-14   |         -0.0 |             -0.2 |         -0.2 | False         
[INFO] 2024-09-14   |          2.2 |             -1.1 |         -3.3 | False         
[INFO] 2024-11-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-11-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 18 periods (33.33% win rate)
[INFO] Updating Excel file with Hierarchical results for PL...
[INFO] Excel file updated successfully. Added PL with Hierarchical win rate 33.3% in row 39
[INFO] Added best Sharpe parameters 122/126 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 126
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(44/54) - Original Sharpe: 0.2325
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'PL_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.6528
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1046
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for PL...
[INFO] Excel file updated successfully. Added PL with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PL
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for RB in column D: 22.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 273.30s
[INFO] Best parameters: Short SMA = 42, Long SMA = 50
[INFO] Best Sharpe ratio: 0.800794, Trades: 96
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_RB_best_42/50 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @RB
[INFO] Big Point Value (from data): 42000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.08 contracts
[INFO] Maximum Position Size: 5 contracts
[INFO] Strategy Total P&L: $291,724.40
[INFO] Market Buy & Hold P&L: $61,933.20
[INFO] Outperformance: $229,791.20
[INFO] Sharpe ratio (entire period, annualized): 0.421463
[INFO] Sharpe ratio (in-sample, annualized): 0.800794
[INFO] Sharpe ratio (out-of-sample, annualized): -0.404535
[INFO] Maximum Drawdown: $177,916.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 68
[INFO] Out-of-sample period trades: 28
[INFO] Total trades: 96
[INFO] In-sample P&L: $477,036.20
[INFO] Out-of-sample P&L: $-110,507.20
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 50, Sharpe = 0.800794
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.0498 to 0.8008
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.800794
[INFO] Number of Trades: 96
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.0498 to 0.8008
[INFO] Trades range: 10.0 to 319.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8627 to 2.8926
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 751 elements
[INFO] Kmeans Cluster 1: 736 elements
[INFO] Kmeans Cluster 2: 711 elements
[INFO] Kmeans Cluster 3: 480 elements
[INFO] Kmeans Cluster 4: 791 elements
[INFO] Kmeans Cluster 5: 934 elements
[INFO] Kmeans Cluster 6: 659 elements
[INFO] Kmeans Cluster 7: 734 elements
[INFO] Kmeans Cluster 8: 645 elements
[INFO] Kmeans Cluster 9: 906 elements
[INFO] Kmeans Cluster 10: 780 elements
[INFO] Kmeans Cluster 11: 220 elements
[INFO] Kmeans Cluster 12: 952 elements
[INFO] Kmeans Cluster 13: 950 elements
[INFO] Kmeans Cluster 14: 336 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=75.45, Long SMA=268.56, Sharpe=-0.1156
[INFO] Centroid 1: Short SMA=51.86, Long SMA=123.43, Sharpe=0.1514
[INFO] Centroid 2: Short SMA=121.55, Long SMA=241.34, Sharpe=-0.1889
[INFO] Centroid 3: Short SMA=237.92, Long SMA=284.48, Sharpe=-0.8115
[INFO] Centroid 4: Short SMA=33.50, Long SMA=188.63, Sharpe=-0.0528
[INFO] Centroid 5: Short SMA=35.66, Long SMA=86.71, Sharpe=0.4562
[INFO] Centroid 6: Short SMA=96.47, Long SMA=135.54, Sharpe=-0.2629
[INFO] Centroid 7: Short SMA=143.98, Long SMA=285.02, Sharpe=-0.5484
[INFO] Centroid 8: Short SMA=125.70, Long SMA=174.88, Sharpe=-0.4499
[INFO] Centroid 9: Short SMA=197.69, Long SMA=245.30, Sharpe=-0.1665
[INFO] Centroid 10: Short SMA=78.68, Long SMA=189.26, Sharpe=-0.3211
[INFO] Centroid 11: Short SMA=20.30, Long SMA=40.26, Sharpe=0.1441
[INFO] Centroid 12: Short SMA=162.66, Long SMA=210.05, Sharpe=0.0714
[INFO] Centroid 13: Short SMA=35.15, Long SMA=257.73, Sharpe=0.0841
[INFO] Centroid 14: Short SMA=248.43, Long SMA=278.60, Sharpe=-0.4944
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=50, Sharpe=0.8008, Trades=96
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=36, Long SMA=86, Sharpe=0.5389, Trades=32
[INFO] Kmeans Top 2: Short SMA=162, Long SMA=212, Sharpe=0.2222, Trades=20
[INFO] Kmeans Top 3: Short SMA=34, Long SMA=258, Sharpe=0.1868, Trades=14
[INFO] Kmeans Top 4: Short SMA=52, Long SMA=124, Sharpe=0.1352, Trades=22
[INFO] Kmeans Top 5: Short SMA=32, Long SMA=190, Sharpe=0.0113, Trades=23
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (75, 269)
[INFO]   Nearest: (76.0, 268.0)
[INFO]   Rounded: (52, 123)
[INFO]   Nearest: (52.0, 124.0)
[INFO]   Rounded: (122, 241)
[INFO]   Nearest: (122.0, 242.0)
[INFO]   Rounded: (238, 284)
[INFO]   Rounded: (34, 189)
[INFO]   Nearest: (34.0, 188.0)
[INFO]   Rounded: (36, 87)
[INFO]   Nearest: (36.0, 86.0)
[INFO]   Rounded: (96, 136)
[INFO]   Rounded: (144, 285)
[INFO]   Nearest: (144.0, 286.0)
[INFO]   Rounded: (126, 175)
[INFO]   Nearest: (126.0, 174.0)
[INFO]   Rounded: (198, 245)
[INFO]   Nearest: (198.0, 246.0)
[INFO]   Rounded: (79, 189)
[INFO]   Nearest: (78.0, 190.0)
[INFO]   Rounded: (20, 40)
[INFO]   Rounded: (163, 210)
[INFO]   Nearest: (162.0, 210.0)
[INFO]   Rounded: (35, 258)
[INFO]   Nearest: (36.0, 258.0)
[INFO]   Rounded: (248, 279)
[INFO]   Nearest: (248.0, 278.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(36/86) - Original Sharpe: 0.5389, Trades: 32
[INFO] Kmeans cluster 2: SMA(162/212) - Original Sharpe: 0.2222, Trades: 20
[INFO] Kmeans cluster 3: SMA(34/258) - Original Sharpe: 0.1868, Trades: 14
[INFO] Kmeans cluster 4: SMA(52/124) - Original Sharpe: 0.1352, Trades: 22
[INFO] Kmeans cluster 5: SMA(32/190) - Original Sharpe: 0.0113, Trades: 23
[INFO] Trimmed warm-up period. Evaluation data length: 2838
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (36/86) - Sharpe: 0.5389
[INFO] cluster 2: (162/212) - Sharpe: 0.2222
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.735456            2.522680
1    2021-11-14 2021-11-14            43    -2.165624           -0.506775
2    2022-01-14 2022-01-14            41     1.793648            3.206104
3    2022-03-14 2022-03-14            44    -0.267645            2.625333
4    2022-05-14 2022-05-14            43    -1.664283           -1.664283
5    2022-07-14 2022-07-14            44     2.545316           -0.512480
6    2022-09-14 2022-09-14            43    -1.824873           -1.090354
7    2022-11-14 2022-11-14            43    -2.147754           -0.867347
8    2023-01-14 2023-01-14            41     0.173521            0.184774
9    2023-03-14 2023-03-14            43    -5.761990           -2.304329
10   2023-05-14 2023-05-14            44     1.051850            2.236015
11   2023-07-14 2023-07-14            44     2.639646            2.639646
12   2023-09-14 2023-09-14            43     0.320827           -3.077552
13   2023-11-14 2023-11-14            42     0.697919            0.000000
14   2024-01-14 2024-01-14            43     0.380540            0.735663
15   2024-03-14 2024-03-14            42    -1.088742            1.243549
16   2024-05-14 2024-05-14            44    -0.468733           -3.511636
17   2024-07-14 2024-07-14            45     0.730155            0.000000
18   2024-09-14 2024-09-14            43    -2.244826            0.447786
19   2024-11-14 2024-11-14            33     0.455012           -0.089835
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |              2.5 |          4.2 | True          
[INFO] 2021-11-14   |         -2.2 |             -0.5 |          1.7 | True          
[INFO] 2022-01-14   |          1.8 |              3.2 |          1.4 | True          
[INFO] 2022-03-14   |         -0.3 |              2.6 |          2.9 | True          
[INFO] 2022-05-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.5 |             -0.5 |         -3.0 | False         
[INFO] 2022-09-14   |         -1.8 |             -1.1 |          0.7 | True          
[INFO] 2022-11-14   |         -2.1 |             -0.9 |          1.2 | True          
[INFO] 2023-01-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -5.8 |             -2.3 |          3.5 | True          
[INFO] 2023-05-14   |          1.1 |              2.2 |          1.1 | True          
[INFO] 2023-07-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          0.3 |             -3.1 |         -3.4 | False         
[INFO] 2023-11-14   |          0.7 |              0.0 |         -0.7 | False         
[INFO] 2024-01-14   |          0.4 |              0.7 |          0.3 | True          
[INFO] 2024-03-14   |         -1.1 |              1.2 |          2.3 | True          
[INFO] 2024-05-14   |         -0.5 |             -3.5 |         -3.0 | False         
[INFO] 2024-07-14   |          0.7 |              0.0 |         -0.7 | False         
[INFO] 2024-09-14   |         -2.2 |              0.4 |          2.6 | True          
[INFO] 2024-11-14   |          0.5 |             -0.1 |         -0.6 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2023-01-14, 2023-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 11 of 17 periods (64.71% win rate)
[INFO] Updating Excel file with Kmeans results for RB...
[INFO] Excel file updated successfully. Added RB with Kmeans win rate 64.7% in row 40
[INFO] Added best Sharpe parameters 42/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(36/86) - Original Sharpe: 0.5389
[INFO] Added cluster 2 to portfolio: SMA(162/212) - Original Sharpe: 0.2222
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RB_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3493
[INFO] Kmeans Best out-of-sample Sharpe: -0.4045
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for RB...
[INFO] Excel file updated successfully. Added RB with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RB
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.0498 to 0.8008
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.800794
[INFO] Number of Trades: 96
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.0498 to 0.8008
[INFO] Trades range: 10.0 to 319.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8627 to 2.8926
[INFO] Scaled Trades range: -0.8928 to 15.4926
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6084
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1332 elements
[INFO] Cluster 1: 246 elements
[INFO] Cluster 2: 636 elements
[INFO] Cluster 3: 806 elements
[INFO] Cluster 4: 201 elements
[INFO] Cluster 5: 1334 elements
[INFO] Cluster 6: 475 elements
[INFO] Cluster 7: 656 elements
[INFO] Cluster 8: 458 elements
[INFO] Cluster 9: 794 elements
[INFO] Cluster 10: 599 elements
[INFO] Cluster 11: 732 elements
[INFO] Cluster 12: 53 elements
[INFO] Cluster 13: 572 elements
[INFO] Cluster 14: 719 elements
[INFO] Cluster 15: 383 elements
[INFO] Cluster 16: 589 elements
[INFO] Using 17 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=58, Long SMA=264, Sharpe=-0.0459, Trades=12
[INFO] Cluster 1 cluster: Short SMA=186, Long SMA=190, Sharpe=-0.4462, Trades=55
[INFO] Cluster 2 cluster: Short SMA=250, Long SMA=284, Sharpe=-0.8086, Trades=23
[INFO] Cluster 3 cluster: Short SMA=50, Long SMA=134, Sharpe=0.0952, Trades=24
[INFO] Cluster 4 cluster: Short SMA=24, Long SMA=40, Sharpe=0.0548, Trades=87
[INFO] Cluster 5 cluster: Short SMA=76, Long SMA=176, Sharpe=-0.3148, Trades=20
[INFO] Cluster 6 cluster: Short SMA=122, Long SMA=282, Sharpe=-0.6393, Trades=14
[INFO] Cluster 7 cluster: Short SMA=132, Long SMA=182, Sharpe=-0.5128, Trades=25
[INFO] Cluster 8 cluster: Short SMA=40, Long SMA=66, Sharpe=0.5157, Trades=53
[INFO] Cluster 9 cluster: Short SMA=196, Long SMA=248, Sharpe=-0.1418, Trades=20
[INFO] Cluster 10 cluster: Short SMA=20, Long SMA=226, Sharpe=-0.0029, Trades=31
[INFO] Cluster 11 cluster: Short SMA=112, Long SMA=238, Sharpe=-0.2259, Trades=20
[INFO] Cluster 12 cluster: Short SMA=20, Long SMA=24, Sharpe=0.1253, Trades=174
[INFO] Cluster 13 cluster: Short SMA=30, Long SMA=102, Sharpe=0.4910, Trades=34
[INFO] Cluster 14 cluster: Short SMA=158, Long SMA=210, Sharpe=0.0020, Trades=20
[INFO] Cluster 15 cluster: Short SMA=104, Long SMA=126, Sharpe=-0.4010, Trades=30
[INFO] Cluster 16 cluster: Short SMA=184, Long SMA=282, Sharpe=-0.4499, Trades=16
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=50, Sharpe=0.8008, Trades=96
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=40, Long SMA=66, Sharpe=0.5157, Trades=53
[INFO] Top 2: Short SMA=30, Long SMA=102, Sharpe=0.4910, Trades=34
[INFO] Top 3: Short SMA=20, Long SMA=24, Sharpe=0.1253, Trades=174
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 17 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(40/66) - Original Sharpe: 0.5157, Trades: 53
[INFO] Hierarchical cluster 2: SMA(30/102) - Original Sharpe: 0.4910, Trades: 34
[INFO] Hierarchical cluster 3: SMA(20/24) - Original Sharpe: 0.1253, Trades: 174
[INFO] Hierarchical cluster 4: SMA(50/134) - Original Sharpe: 0.0952, Trades: 24
[INFO] Hierarchical cluster 5: SMA(24/40) - Original Sharpe: 0.0548, Trades: 87
[INFO] Trimmed warm-up period. Evaluation data length: 2838
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (40/66) - Sharpe: 0.5157
[INFO] cluster 2: (30/102) - Sharpe: 0.4910
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.735456            2.522680
1    2021-11-14 2021-11-14            43    -2.165624           -1.077474
2    2022-01-14 2022-01-14            41     1.793648            2.758451
3    2022-03-14 2022-03-14            44    -0.267645            2.625333
4    2022-05-14 2022-05-14            43    -1.664283           -1.664283
5    2022-07-14 2022-07-14            44     2.545316            0.831783
6    2022-09-14 2022-09-14            43    -1.824873           -3.936203
7    2022-11-14 2022-11-14            43    -2.147754           -1.448548
8    2023-01-14 2023-01-14            41     0.173521           -0.577536
9    2023-03-14 2023-03-14            43    -5.761990           -3.674375
10   2023-05-14 2023-05-14            44     1.051850            1.076460
11   2023-07-14 2023-07-14            44     2.639646            2.639646
12   2023-09-14 2023-09-14            43     0.320827           -3.428494
13   2023-11-14 2023-11-14            42     0.697919            0.891761
14   2024-01-14 2024-01-14            43     0.380540            0.058426
15   2024-03-14 2024-03-14            42    -1.088742           -1.088742
16   2024-05-14 2024-05-14            44    -0.468733           -3.933969
17   2024-07-14 2024-07-14            45     0.730155            1.831642
18   2024-09-14 2024-09-14            43    -2.244826           -0.738747
19   2024-11-14 2024-11-14            33     0.455012            2.359169
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |              2.5 |          4.2 | True          
[INFO] 2021-11-14   |         -2.2 |             -1.1 |          1.1 | True          
[INFO] 2022-01-14   |          1.8 |              2.8 |          1.0 | True          
[INFO] 2022-03-14   |         -0.3 |              2.6 |          2.9 | True          
[INFO] 2022-05-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.5 |              0.8 |         -1.7 | False         
[INFO] 2022-09-14   |         -1.8 |             -3.9 |         -2.1 | False         
[INFO] 2022-11-14   |         -2.1 |             -1.4 |          0.7 | True          
[INFO] 2023-01-14   |          0.2 |             -0.6 |         -0.8 | False         
[INFO] 2023-03-14   |         -5.8 |             -3.7 |          2.1 | True          
[INFO] 2023-05-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          0.3 |             -3.4 |         -3.7 | False         
[INFO] 2023-11-14   |          0.7 |              0.9 |          0.2 | True          
[INFO] 2024-01-14   |          0.4 |              0.1 |         -0.3 | False         
[INFO] 2024-03-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -0.5 |             -3.9 |         -3.4 | False         
[INFO] 2024-07-14   |          0.7 |              1.8 |          1.1 | True          
[INFO] 2024-09-14   |         -2.2 |             -0.7 |          1.5 | True          
[INFO] 2024-11-14   |          0.5 |              2.4 |          1.9 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2023-05-14, 2023-07-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 16 periods (62.50% win rate)
[INFO] Updating Excel file with Hierarchical results for RB...
[INFO] Excel file updated successfully. Added RB with Hierarchical win rate 62.5% in row 40
[INFO] Added best Sharpe parameters 42/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(40/66) - Original Sharpe: 0.5157
[INFO] Added cluster 2 to portfolio: SMA(30/102) - Original Sharpe: 0.4910
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RB_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1940
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4045
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for RB...
[INFO] Excel file updated successfully. Added RB with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RB
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for RTY in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 258.93s
[INFO] Best parameters: Short SMA = 122, Long SMA = 142
[INFO] Best Sharpe ratio: 0.356940, Trades: 40
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_RTY_best_122/142 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @RTY
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.21 contracts
[INFO] Maximum Position Size: 11 contracts
[INFO] Strategy Total P&L: $181,223.00
[INFO] Market Buy & Hold P&L: $47,790.00
[INFO] Outperformance: $133,433.00
[INFO] Sharpe ratio (entire period, annualized): 0.190911
[INFO] Sharpe ratio (in-sample, annualized): 0.356940
[INFO] Sharpe ratio (out-of-sample, annualized): -0.184654
[INFO] Maximum Drawdown: $212,021.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 18
[INFO] Out-of-sample period trades: 22
[INFO] Total trades: 40
[INFO] In-sample P&L: $206,561.00
[INFO] Out-of-sample P&L: $-47,237.00
[INFO] 
Best parameters from GA: Short SMA = 122, Long SMA = 142, Sharpe = 0.356940
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.0509 to 0.3569
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 142
[INFO] Sharpe Ratio: 0.356940
[INFO] Number of Trades: 40
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10582 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.0509 to 0.3569
[INFO] Trades range: 10.0 to 329.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3995 to 2.7991
[INFO] Scaled Long SMA range: -2.7993 to 1.4002
[INFO] Scaled Sharpe ratio range: -4.4788 to 3.0252
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 806 elements
[INFO] Kmeans Cluster 1: 698 elements
[INFO] Kmeans Cluster 2: 884 elements
[INFO] Kmeans Cluster 3: 510 elements
[INFO] Kmeans Cluster 4: 581 elements
[INFO] Kmeans Cluster 5: 839 elements
[INFO] Kmeans Cluster 6: 721 elements
[INFO] Kmeans Cluster 7: 605 elements
[INFO] Kmeans Cluster 8: 830 elements
[INFO] Kmeans Cluster 9: 422 elements
[INFO] Kmeans Cluster 10: 176 elements
[INFO] Kmeans Cluster 11: 420 elements
[INFO] Kmeans Cluster 12: 654 elements
[INFO] Kmeans Cluster 13: 651 elements
[INFO] Kmeans Cluster 14: 887 elements
[INFO] Kmeans Cluster 15: 898 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=54.98, Long SMA=276.27, Sharpe=0.0072
[INFO] Centroid 1: Short SMA=88.20, Long SMA=128.17, Sharpe=-0.1924
[INFO] Centroid 2: Short SMA=145.53, Long SMA=199.97, Sharpe=-0.3982
[INFO] Centroid 3: Short SMA=249.73, Long SMA=278.34, Sharpe=-0.7297
[INFO] Centroid 4: Short SMA=41.18, Long SMA=81.32, Sharpe=-0.1175
[INFO] Centroid 5: Short SMA=123.97, Long SMA=271.15, Sharpe=-0.1374
[INFO] Centroid 6: Short SMA=179.06, Long SMA=271.88, Sharpe=-0.2632
[INFO] Centroid 7: Short SMA=31.20, Long SMA=72.05, Sharpe=-0.3162
[INFO] Centroid 8: Short SMA=57.18, Long SMA=197.06, Sharpe=-0.2738
[INFO] Centroid 9: Short SMA=113.67, Long SMA=149.46, Sharpe=0.0530
[INFO] Centroid 10: Short SMA=213.52, Long SMA=231.83, Sharpe=0.0700
[INFO] Centroid 11: Short SMA=228.50, Long SMA=278.97, Sharpe=-0.4553
[INFO] Centroid 12: Short SMA=102.44, Long SMA=201.94, Sharpe=-0.1821
[INFO] Centroid 13: Short SMA=179.46, Long SMA=222.18, Sharpe=-0.2171
[INFO] Centroid 14: Short SMA=37.17, Long SMA=151.32, Sharpe=-0.0536
[INFO] Centroid 15: Short SMA=42.20, Long SMA=242.73, Sharpe=-0.1336
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=142, Sharpe=0.3569, Trades=40
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=214, Long SMA=232, Sharpe=0.2575, Trades=32
[INFO] Kmeans Top 2: Short SMA=116, Long SMA=150, Sharpe=0.1429, Trades=28
[INFO] Kmeans Top 3: Short SMA=56, Long SMA=282, Sharpe=-0.0649, Trades=15
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=148, Sharpe=-0.1232, Trades=30
[INFO] Kmeans Top 5: Short SMA=124, Long SMA=272, Sharpe=-0.1308, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (55, 276)
[INFO]   Nearest: (54.0, 276.0)
[INFO]   Rounded: (88, 128)
[INFO]   Rounded: (146, 200)
[INFO]   Rounded: (250, 278)
[INFO]   Rounded: (41, 81)
[INFO]   Nearest: (42.0, 82.0)
[INFO]   Rounded: (124, 271)
[INFO]   Nearest: (124.0, 272.0)
[INFO]   Rounded: (179, 272)
[INFO]   Nearest: (180.0, 272.0)
[INFO]   Rounded: (31, 72)
[INFO]   Nearest: (32.0, 72.0)
[INFO]   Rounded: (57, 197)
[INFO]   Nearest: (58.0, 198.0)
[INFO]   Rounded: (114, 149)
[INFO]   Nearest: (114.0, 150.0)
[INFO]   Rounded: (214, 232)
[INFO]   Rounded: (229, 279)
[INFO]   Nearest: (228.0, 278.0)
[INFO]   Rounded: (102, 202)
[INFO]   Rounded: (179, 222)
[INFO]   Nearest: (180.0, 222.0)
[INFO]   Rounded: (37, 151)
[INFO]   Nearest: (38.0, 152.0)
[INFO]   Rounded: (42, 243)
[INFO]   Nearest: (42.0, 242.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 142
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(214/232) - Original Sharpe: 0.2575, Trades: 32
[INFO] Kmeans cluster 2: SMA(116/150) - Original Sharpe: 0.1429, Trades: 28
[INFO] Kmeans cluster 3: SMA(56/282) - Original Sharpe: -0.0649, Trades: 15
[INFO] Kmeans cluster 4: SMA(36/148) - Original Sharpe: -0.1232, Trades: 30
[INFO] Kmeans cluster 5: SMA(124/272) - Original Sharpe: -0.1308, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/142)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (214/232) - Sharpe: 0.2575
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.951309            1.984401
1    2021-11-14 2021-11-14            43    -3.779143           -2.480238
2    2022-01-14 2022-01-14            41    -1.606093            1.495295
3    2022-03-14 2022-03-14            44     2.272090            2.272090
4    2022-05-14 2022-05-14            43     1.217919            1.217919
5    2022-07-14 2022-07-14            44    -0.981609           -0.981609
6    2022-09-14 2022-09-14            43    -0.503510           -0.503510
7    2022-11-14 2022-11-14            43     2.546707            0.047994
8    2023-01-14 2023-01-14            41     2.799352            2.462331
9    2023-03-14 2023-03-14            44    -0.771622           -2.321245
10   2023-05-14 2023-05-14            44    -1.092872           -2.291416
11   2023-07-14 2023-07-14            44     2.002487           -3.740779
12   2023-09-14 2023-09-14            43    -2.691940            4.573870
13   2023-11-14 2023-11-14            42     1.074911           -0.561653
14   2024-01-14 2024-01-14            43    -1.539506            0.563821
15   2024-03-14 2024-03-14            42    -0.907679           -0.907679
16   2024-05-14 2024-05-14            44     1.119288            3.970205
17   2024-07-14 2024-07-14            45    -0.484134            0.435707
18   2024-09-14 2024-09-14            43     1.944401            2.219115
19   2024-11-14 2024-11-14            33    -2.760739           -2.760739
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |              2.0 |          3.0 | True          
[INFO] 2021-11-14   |         -3.8 |             -2.5 |          1.3 | True          
[INFO] 2022-01-14   |         -1.6 |              1.5 |          3.1 | True          
[INFO] 2022-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.5 |              0.0 |         -2.5 | False         
[INFO] 2023-01-14   |          2.8 |              2.5 |         -0.3 | False         
[INFO] 2023-03-14   |         -0.8 |             -2.3 |         -1.5 | False         
[INFO] 2023-05-14   |         -1.1 |             -2.3 |         -1.2 | False         
[INFO] 2023-07-14   |          2.0 |             -3.7 |         -5.7 | False         
[INFO] 2023-09-14   |         -2.7 |              4.6 |          7.3 | True          
[INFO] 2023-11-14   |          1.1 |             -0.6 |         -1.7 | False         
[INFO] 2024-01-14   |         -1.5 |              0.6 |          2.1 | True          
[INFO] 2024-03-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.1 |              4.0 |          2.9 | True          
[INFO] 2024-07-14   |         -0.5 |              0.4 |          0.9 | True          
[INFO] 2024-09-14   |          1.9 |              2.2 |          0.3 | True          
[INFO] 2024-11-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2024-03-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 8 of 14 periods (57.14% win rate)
[INFO] Updating Excel file with Kmeans results for RTY...
[INFO] Excel file updated successfully. Added RTY with Kmeans win rate 57.1% in row 41
[INFO] Added best Sharpe parameters 122/142 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 142
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(214/232) - Original Sharpe: 0.2575
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RTY_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3164
[INFO] Kmeans Best out-of-sample Sharpe: -0.1847
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for RTY...
[INFO] Excel file updated successfully. Added RTY with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RTY
[INFO] Big Point Value: 50.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.0509 to 0.3569
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 142
[INFO] Sharpe Ratio: 0.356940
[INFO] Number of Trades: 40
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10582 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.0509 to 0.3569
[INFO] Trades range: 10.0 to 329.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3995 to 2.7991
[INFO] Scaled Long SMA range: -2.7993 to 1.4002
[INFO] Scaled Sharpe ratio range: -4.4788 to 3.0252
[INFO] Scaled Trades range: -0.8038 to 13.2173
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10582 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5539
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 13
[INFO] Using 13 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 13 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1372 elements
[INFO] Cluster 1: 646 elements
[INFO] Cluster 2: 2126 elements
[INFO] Cluster 3: 1399 elements
[INFO] Cluster 4: 1008 elements
[INFO] Cluster 5: 977 elements
[INFO] Cluster 6: 254 elements
[INFO] Cluster 7: 983 elements
[INFO] Cluster 8: 173 elements
[INFO] Cluster 9: 1047 elements
[INFO] Cluster 10: 369 elements
[INFO] Cluster 11: 43 elements
[INFO] Cluster 12: 185 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=188, Long SMA=262, Sharpe=-0.2355, Trades=16
[INFO] Cluster 1 cluster: Short SMA=252, Long SMA=278, Sharpe=-0.7979, Trades=25
[INFO] Cluster 2 cluster: Short SMA=72, Long SMA=188, Sharpe=-0.2959, Trades=20
[INFO] Cluster 3 cluster: Short SMA=46, Long SMA=268, Sharpe=-0.0875, Trades=15
[INFO] Cluster 4 cluster: Short SMA=146, Long SMA=208, Sharpe=-0.2647, Trades=18
[INFO] Cluster 5 cluster: Short SMA=40, Long SMA=82, Sharpe=-0.3615, Trades=46
[INFO] Cluster 6 cluster: Short SMA=32, Long SMA=44, Sharpe=-0.2771, Trades=100
[INFO] Cluster 7 cluster: Short SMA=40, Long SMA=134, Sharpe=-0.1505, Trades=28
[INFO] Cluster 8 cluster: Short SMA=180, Long SMA=186, Sharpe=-0.2343, Trades=60
[INFO] Cluster 9 cluster: Short SMA=118, Long SMA=264, Sharpe=-0.1638, Trades=14
[INFO] Cluster 10 cluster: Short SMA=118, Long SMA=148, Sharpe=0.2796, Trades=32
[INFO] Cluster 11 cluster: Short SMA=34, Long SMA=36, Sharpe=-0.4699, Trades=193
[INFO] Cluster 12 cluster: Short SMA=214, Long SMA=232, Sharpe=0.2575, Trades=32
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=142, Sharpe=0.3569, Trades=40
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=118, Long SMA=148, Sharpe=0.2796, Trades=32
[INFO] Top 2: Short SMA=214, Long SMA=232, Sharpe=0.2575, Trades=32
[INFO] Top 3: Short SMA=46, Long SMA=268, Sharpe=-0.0875, Trades=15
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 10582 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 142
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(118/148) - Original Sharpe: 0.2796, Trades: 32
[INFO] Hierarchical cluster 2: SMA(214/232) - Original Sharpe: 0.2575, Trades: 32
[INFO] Hierarchical cluster 3: SMA(46/268) - Original Sharpe: -0.0875, Trades: 15
[INFO] Hierarchical cluster 4: SMA(40/134) - Original Sharpe: -0.1505, Trades: 28
[INFO] Hierarchical cluster 5: SMA(118/264) - Original Sharpe: -0.1638, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/142)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (118/148) - Sharpe: 0.2796
[INFO] cluster 2: (214/232) - Sharpe: 0.2575
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.951309            1.947760
1    2021-11-14 2021-11-14            43    -3.779143           -2.892084
2    2022-01-14 2022-01-14            41    -1.606093            0.670813
3    2022-03-14 2022-03-14            44     2.272090            2.272090
4    2022-05-14 2022-05-14            43     1.217919            1.217919
5    2022-07-14 2022-07-14            44    -0.981609           -0.981609
6    2022-09-14 2022-09-14            43    -0.503510           -0.503510
7    2022-11-14 2022-11-14            43     2.546707            1.917129
8    2023-01-14 2023-01-14            41     2.799352            2.828442
9    2023-03-14 2023-03-14            44    -0.771622           -1.907497
10   2023-05-14 2023-05-14            44    -1.092872           -2.787420
11   2023-07-14 2023-07-14            44     2.002487           -1.810407
12   2023-09-14 2023-09-14            43    -2.691940            1.497119
13   2023-11-14 2023-11-14            42     1.074911            0.503980
14   2024-01-14 2024-01-14            43    -1.539506           -2.017009
15   2024-03-14 2024-03-14            42    -0.907679           -0.907679
16   2024-05-14 2024-05-14            44     1.119288            3.664145
17   2024-07-14 2024-07-14            45    -0.484134            0.435707
18   2024-09-14 2024-09-14            43     1.944401            2.157997
19   2024-11-14 2024-11-14            33    -2.760739           -2.760739
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |              1.9 |          2.9 | True          
[INFO] 2021-11-14   |         -3.8 |             -2.9 |          0.9 | True          
[INFO] 2022-01-14   |         -1.6 |              0.7 |          2.3 | True          
[INFO] 2022-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.5 |              1.9 |         -0.6 | False         
[INFO] 2023-01-14   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -0.8 |             -1.9 |         -1.1 | False         
[INFO] 2023-05-14   |         -1.1 |             -2.8 |         -1.7 | False         
[INFO] 2023-07-14   |          2.0 |             -1.8 |         -3.8 | False         
[INFO] 2023-09-14   |         -2.7 |              1.5 |          4.2 | True          
[INFO] 2023-11-14   |          1.1 |              0.5 |         -0.6 | False         
[INFO] 2024-01-14   |         -1.5 |             -2.0 |         -0.5 | False         
[INFO] 2024-03-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.1 |              3.7 |          2.6 | True          
[INFO] 2024-07-14   |         -0.5 |              0.4 |          0.9 | True          
[INFO] 2024-09-14   |          1.9 |              2.2 |          0.3 | True          
[INFO] 2024-11-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-01-14, 2024-03-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 13 periods (53.85% win rate)
[INFO] Updating Excel file with Hierarchical results for RTY...
[INFO] Excel file updated successfully. Added RTY with Hierarchical win rate 53.8% in row 41
[INFO] Added best Sharpe parameters 122/142 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 142
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(118/148) - Original Sharpe: 0.2796
[INFO] Added cluster 2 to portfolio: SMA(214/232) - Original Sharpe: 0.2575
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RTY_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2332
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1847
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for RTY...
[INFO] Excel file updated successfully. Added RTY with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RTY
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for S in column D: 15.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 242.53s
[INFO] Best parameters: Short SMA = 180, Long SMA = 184
[INFO] Best Sharpe ratio: 0.926274, Trades: 64
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_S_best_180/184 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SB
[INFO] Big Point Value (from data): 1120.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 14.27 contracts
[INFO] Maximum Position Size: 30 contracts
[INFO] Strategy Total P&L: $739,428.00
[INFO] Market Buy & Hold P&L: $-3,248.00
[INFO] Outperformance: $742,676.00
[INFO] Sharpe ratio (entire period, annualized): 0.939613
[INFO] Sharpe ratio (in-sample, annualized): 0.926274
[INFO] Sharpe ratio (out-of-sample, annualized): 0.970879
[INFO] Maximum Drawdown: $93,066.80
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 37
[INFO] Out-of-sample period trades: 27
[INFO] Total trades: 64
[INFO] In-sample P&L: $473,072.00
[INFO] Out-of-sample P&L: $208,676.00
[INFO] 
Best parameters from GA: Short SMA = 180, Long SMA = 184, Sharpe = 0.926274
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5070 to 0.9263
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.926274
[INFO] Number of Trades: 64
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10118 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5070 to 0.9263
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3602 to 2.7902
[INFO] Scaled Long SMA range: -2.7801 to 1.4751
[INFO] Scaled Sharpe ratio range: -5.3285 to 3.8001
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 622 elements
[INFO] Kmeans Cluster 1: 715 elements
[INFO] Kmeans Cluster 2: 625 elements
[INFO] Kmeans Cluster 3: 682 elements
[INFO] Kmeans Cluster 4: 554 elements
[INFO] Kmeans Cluster 5: 724 elements
[INFO] Kmeans Cluster 6: 878 elements
[INFO] Kmeans Cluster 7: 187 elements
[INFO] Kmeans Cluster 8: 752 elements
[INFO] Kmeans Cluster 9: 320 elements
[INFO] Kmeans Cluster 10: 811 elements
[INFO] Kmeans Cluster 11: 727 elements
[INFO] Kmeans Cluster 12: 621 elements
[INFO] Kmeans Cluster 13: 617 elements
[INFO] Kmeans Cluster 14: 411 elements
[INFO] Kmeans Cluster 15: 458 elements
[INFO] Kmeans Cluster 16: 414 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=140.76, Long SMA=255.80, Sharpe=0.4363
[INFO] Centroid 1: Short SMA=42.10, Long SMA=102.30, Sharpe=0.4467
[INFO] Centroid 2: Short SMA=70.05, Long SMA=131.37, Sharpe=0.3098
[INFO] Centroid 3: Short SMA=216.39, Long SMA=269.17, Sharpe=0.1488
[INFO] Centroid 4: Short SMA=163.09, Long SMA=205.08, Sharpe=0.6108
[INFO] Centroid 5: Short SMA=110.98, Long SMA=206.96, Sharpe=0.3406
[INFO] Centroid 6: Short SMA=86.21, Long SMA=263.33, Sharpe=0.2378
[INFO] Centroid 7: Short SMA=27.36, Long SMA=45.64, Sharpe=-0.0644
[INFO] Centroid 8: Short SMA=194.25, Long SMA=242.00, Sharpe=0.3578
[INFO] Centroid 9: Short SMA=123.67, Long SMA=148.79, Sharpe=0.0317
[INFO] Centroid 10: Short SMA=60.65, Long SMA=196.65, Sharpe=0.4433
[INFO] Centroid 11: Short SMA=36.02, Long SMA=269.57, Sharpe=0.4116
[INFO] Centroid 12: Short SMA=113.80, Long SMA=155.09, Sharpe=0.1986
[INFO] Centroid 13: Short SMA=36.31, Long SMA=82.97, Sharpe=0.2102
[INFO] Centroid 14: Short SMA=43.14, Long SMA=183.95, Sharpe=0.5898
[INFO] Centroid 15: Short SMA=254.64, Long SMA=284.17, Sharpe=0.2653
[INFO] Centroid 16: Short SMA=18.02, Long SMA=207.46, Sharpe=0.2680
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9263, Trades=64
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=162, Long SMA=204, Sharpe=0.6989, Trades=14
[INFO] Kmeans Top 2: Short SMA=44, Long SMA=182, Sharpe=0.6735, Trades=13
[INFO] Kmeans Top 3: Short SMA=42, Long SMA=102, Sharpe=0.5104, Trades=23
[INFO] Kmeans Top 4: Short SMA=64, Long SMA=200, Sharpe=0.4071, Trades=14
[INFO] Kmeans Top 5: Short SMA=112, Long SMA=208, Sharpe=0.4000, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (141, 256)
[INFO]   Nearest: (140.0, 256.0)
[INFO]   Rounded: (42, 102)
[INFO]   Rounded: (70, 131)
[INFO]   Nearest: (70.0, 132.0)
[INFO]   Rounded: (216, 269)
[INFO]   Nearest: (216.0, 270.0)
[INFO]   Rounded: (163, 205)
[INFO]   Nearest: (164.0, 206.0)
[INFO]   Rounded: (111, 207)
[INFO]   Nearest: (110.0, 206.0)
[INFO]   Rounded: (86, 263)
[INFO]   Nearest: (86.0, 264.0)
[INFO]   Rounded: (27, 46)
[INFO]   Nearest: (28.0, 46.0)
[INFO]   Rounded: (194, 242)
[INFO]   Rounded: (124, 149)
[INFO]   Nearest: (124.0, 148.0)
[INFO]   Rounded: (61, 197)
[INFO]   Nearest: (60.0, 196.0)
[INFO]   Rounded: (36, 270)
[INFO]   Rounded: (114, 155)
[INFO]   Nearest: (114.0, 156.0)
[INFO]   Rounded: (36, 83)
[INFO]   Nearest: (36.0, 82.0)
[INFO]   Rounded: (43, 184)
[INFO]   Nearest: (44.0, 184.0)
[INFO]   Rounded: (255, 284)
[INFO]   Nearest: (254.0, 284.0)
[INFO]   Rounded: (18, 207)
[INFO]   Nearest: (18.0, 208.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(162/204) - Original Sharpe: 0.6989, Trades: 14
[INFO] Kmeans cluster 2: SMA(44/182) - Original Sharpe: 0.6735, Trades: 13
[INFO] Kmeans cluster 3: SMA(42/102) - Original Sharpe: 0.5104, Trades: 23
[INFO] Kmeans cluster 4: SMA(64/200) - Original Sharpe: 0.4071, Trades: 14
[INFO] Kmeans cluster 5: SMA(112/208) - Original Sharpe: 0.4000, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (162/204) - Sharpe: 0.6989
[INFO] cluster 2: (44/182) - Sharpe: 0.6735
[INFO] cluster 3: (42/102) - Sharpe: 0.5104
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.463692
2    2022-01-10 2022-01-10            41     2.600539           -1.713688
3    2022-03-10 2022-03-10            42     0.191454           -2.970780
4    2022-05-10 2022-05-10            41    -0.735414            0.735414
5    2022-07-10 2022-07-10            44     4.954980           -0.423190
6    2022-09-10 2022-09-10            43     2.825703            1.668707
7    2022-11-10 2022-11-10            40     1.572256           -1.531587
8    2023-01-10 2023-01-10            41     3.123023            3.032782
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.003227
12   2023-09-10 2023-09-10            44     1.003709            0.711845
13   2023-11-10 2023-11-10            40    -4.602392           -6.003244
14   2024-01-10 2024-01-10            41     1.471174            1.369942
15   2024-03-10 2024-03-10            43    -0.286079            0.824991
16   2024-05-10 2024-05-10            40    -2.453105           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.736674
18   2024-09-10 2024-09-10            44     3.195301           -5.628273
19   2024-11-10 2024-11-10            35     3.533315           -3.533315
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |             -1.7 |         -4.3 | False         
[INFO] 2022-03-10   |          0.2 |             -3.0 |         -3.2 | False         
[INFO] 2022-05-10   |         -0.7 |              0.7 |          1.4 | True          
[INFO] 2022-07-10   |          5.0 |             -0.4 |         -5.4 | False         
[INFO] 2022-09-10   |          2.8 |              1.7 |         -1.1 | False         
[INFO] 2022-11-10   |          1.6 |             -1.5 |         -3.1 | False         
[INFO] 2023-01-10   |          3.1 |              3.0 |         -0.1 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              2.0 |         -1.0 | False         
[INFO] 2023-09-10   |          1.0 |              0.7 |         -0.3 | False         
[INFO] 2023-11-10   |         -4.6 |             -6.0 |         -1.4 | False         
[INFO] 2024-01-10   |          1.5 |              1.4 |         -0.1 | False         
[INFO] 2024-03-10   |         -0.3 |              0.8 |          1.1 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -5.6 |         -8.8 | False         
[INFO] 2024-11-10   |          3.5 |             -3.5 |         -7.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2023-03-10, 2023-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Kmeans cluster wins (rounded comparison): 3 of 15 periods (20.00% win rate)
[INFO] Updating Excel file with Kmeans results for S...
[INFO] Excel file updated successfully. Added S with Kmeans win rate 20.0% in row 42
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(162/204) - Original Sharpe: 0.6989
[INFO] Added cluster 2 to portfolio: SMA(44/182) - Original Sharpe: 0.6735
[INFO] Added cluster 3 to portfolio: SMA(42/102) - Original Sharpe: 0.5104
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'S_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3876
[INFO] Kmeans Best out-of-sample Sharpe: 0.9709
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for S...
[INFO] Excel file updated successfully. Added S with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\S
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5070 to 0.9263
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.926274
[INFO] Number of Trades: 64
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10118 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5070 to 0.9263
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3602 to 2.7902
[INFO] Scaled Long SMA range: -2.7801 to 1.4751
[INFO] Scaled Sharpe ratio range: -5.3285 to 3.8001
[INFO] Scaled Trades range: -0.6229 to 16.0045
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10118 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4517
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1437 elements
[INFO] Cluster 1: 1390 elements
[INFO] Cluster 2: 211 elements
[INFO] Cluster 3: 559 elements
[INFO] Cluster 4: 64 elements
[INFO] Cluster 5: 1071 elements
[INFO] Cluster 6: 577 elements
[INFO] Cluster 7: 507 elements
[INFO] Cluster 8: 867 elements
[INFO] Cluster 9: 650 elements
[INFO] Cluster 10: 934 elements
[INFO] Cluster 11: 434 elements
[INFO] Cluster 12: 801 elements
[INFO] Cluster 13: 349 elements
[INFO] Cluster 14: 267 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=168, Long SMA=248, Sharpe=0.3301, Trades=10
[INFO] Cluster 1 cluster: Short SMA=52, Long SMA=184, Sharpe=0.6077, Trades=13
[INFO] Cluster 2 cluster: Short SMA=40, Long SMA=48, Sharpe=0.0411, Trades=86
[INFO] Cluster 3 cluster: Short SMA=162, Long SMA=206, Sharpe=0.7477, Trades=16
[INFO] Cluster 4 cluster: Short SMA=24, Long SMA=28, Sharpe=-0.0306, Trades=156
[INFO] Cluster 5 cluster: Short SMA=80, Long SMA=258, Sharpe=0.2486, Trades=13
[INFO] Cluster 6 cluster: Short SMA=118, Long SMA=138, Sharpe=0.0667, Trades=30
[INFO] Cluster 7 cluster: Short SMA=34, Long SMA=68, Sharpe=0.3215, Trades=42
[INFO] Cluster 8 cluster: Short SMA=68, Long SMA=134, Sharpe=0.2563, Trades=20
[INFO] Cluster 9 cluster: Short SMA=34, Long SMA=268, Sharpe=0.3323, Trades=18
[INFO] Cluster 10 cluster: Short SMA=230, Long SMA=280, Sharpe=0.2426, Trades=10
[INFO] Cluster 11 cluster: Short SMA=14, Long SMA=198, Sharpe=0.3485, Trades=28
[INFO] Cluster 12 cluster: Short SMA=114, Long SMA=194, Sharpe=0.3451, Trades=13
[INFO] Cluster 13 cluster: Short SMA=44, Long SMA=94, Sharpe=0.5105, Trades=26
[INFO] Cluster 14 cluster: Short SMA=236, Long SMA=242, Sharpe=0.1882, Trades=30
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9263, Trades=64
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=162, Long SMA=206, Sharpe=0.7477, Trades=16
[INFO] Top 2: Short SMA=52, Long SMA=184, Sharpe=0.6077, Trades=13
[INFO] Top 3: Short SMA=44, Long SMA=94, Sharpe=0.5105, Trades=26
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10118 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(162/206) - Original Sharpe: 0.7477, Trades: 16
[INFO] Hierarchical cluster 2: SMA(52/184) - Original Sharpe: 0.6077, Trades: 13
[INFO] Hierarchical cluster 3: SMA(44/94) - Original Sharpe: 0.5105, Trades: 26
[INFO] Hierarchical cluster 4: SMA(14/198) - Original Sharpe: 0.3485, Trades: 28
[INFO] Hierarchical cluster 5: SMA(114/194) - Original Sharpe: 0.3451, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (162/206) - Sharpe: 0.7477
[INFO] cluster 2: (52/184) - Sharpe: 0.6077
[INFO] cluster 3: (44/94) - Sharpe: 0.5105
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -1.138777
2    2022-01-10 2022-01-10            41     2.600539           -0.076934
3    2022-03-10 2022-03-10            42     0.191454           -2.830385
4    2022-05-10 2022-05-10            41    -0.735414           -2.430395
5    2022-07-10 2022-07-10            44     4.954980           -0.176695
6    2022-09-10 2022-09-10            43     2.825703            0.722141
7    2022-11-10 2022-11-10            40     1.572256           -1.279814
8    2023-01-10 2023-01-10            41     3.123023            2.917380
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            1.925114
12   2023-09-10 2023-09-10            44     1.003709            0.711845
13   2023-11-10 2023-11-10            40    -4.602392           -5.665298
14   2024-01-10 2024-01-10            41     1.471174            1.919969
15   2024-03-10 2024-03-10            43    -0.286079           -0.181533
16   2024-05-10 2024-05-10            40    -2.453105           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.736674
18   2024-09-10 2024-09-10            44     3.195301           -4.823074
19   2024-11-10 2024-11-10            35     3.533315           -3.559290
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -1.1 |          1.4 | True          
[INFO] 2022-01-10   |          2.6 |             -0.1 |         -2.7 | False         
[INFO] 2022-03-10   |          0.2 |             -2.8 |         -3.0 | False         
[INFO] 2022-05-10   |         -0.7 |             -2.4 |         -1.7 | False         
[INFO] 2022-07-10   |          5.0 |             -0.2 |         -5.2 | False         
[INFO] 2022-09-10   |          2.8 |              0.7 |         -2.1 | False         
[INFO] 2022-11-10   |          1.6 |             -1.3 |         -2.9 | False         
[INFO] 2023-01-10   |          3.1 |              2.9 |         -0.2 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              1.9 |         -1.1 | False         
[INFO] 2023-09-10   |          1.0 |              0.7 |         -0.3 | False         
[INFO] 2023-11-10   |         -4.6 |             -5.7 |         -1.1 | False         
[INFO] 2024-01-10   |          1.5 |              1.9 |          0.4 | True          
[INFO] 2024-03-10   |         -0.3 |             -0.2 |          0.1 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -4.8 |         -8.0 | False         
[INFO] 2024-11-10   |          3.5 |             -3.6 |         -7.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2023-03-10, 2023-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 16 periods (25.00% win rate)
[INFO] Updating Excel file with Hierarchical results for S...
[INFO] Excel file updated successfully. Added S with Hierarchical win rate 25.0% in row 42
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(162/206) - Original Sharpe: 0.7477
[INFO] Added cluster 2 to portfolio: SMA(52/184) - Original Sharpe: 0.6077
[INFO] Added cluster 3 to portfolio: SMA(44/94) - Original Sharpe: 0.5105
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'S_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2854
[INFO] Hierarchical Best out-of-sample Sharpe: 0.9709
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for S...
[INFO] Excel file updated successfully. Added S with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\S
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SB in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 243.66s
[INFO] Best parameters: Short SMA = 180, Long SMA = 184
[INFO] Best Sharpe ratio: 0.927384, Trades: 64
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_SB_best_180/184 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SB
[INFO] Big Point Value (from data): 1120.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 14.27 contracts
[INFO] Maximum Position Size: 30 contracts
[INFO] Strategy Total P&L: $740,320.00
[INFO] Market Buy & Hold P&L: $-3,248.00
[INFO] Outperformance: $743,568.00
[INFO] Sharpe ratio (entire period, annualized): 0.940831
[INFO] Sharpe ratio (in-sample, annualized): 0.927384
[INFO] Sharpe ratio (out-of-sample, annualized): 0.972353
[INFO] Maximum Drawdown: $93,032.80
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 37
[INFO] Out-of-sample period trades: 27
[INFO] Total trades: 64
[INFO] In-sample P&L: $473,648.00
[INFO] Out-of-sample P&L: $208,992.00
[INFO] 
Best parameters from GA: Short SMA = 180, Long SMA = 184, Sharpe = 0.927384
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5052 to 0.9274
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.927384
[INFO] Number of Trades: 64
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10118 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5052 to 0.9274
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3602 to 2.7902
[INFO] Scaled Long SMA range: -2.7801 to 1.4751
[INFO] Scaled Sharpe ratio range: -5.3247 to 3.8078
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 545 elements
[INFO] Kmeans Cluster 1: 624 elements
[INFO] Kmeans Cluster 2: 874 elements
[INFO] Kmeans Cluster 3: 629 elements
[INFO] Kmeans Cluster 4: 458 elements
[INFO] Kmeans Cluster 5: 805 elements
[INFO] Kmeans Cluster 6: 701 elements
[INFO] Kmeans Cluster 7: 187 elements
[INFO] Kmeans Cluster 8: 723 elements
[INFO] Kmeans Cluster 9: 722 elements
[INFO] Kmeans Cluster 10: 414 elements
[INFO] Kmeans Cluster 11: 625 elements
[INFO] Kmeans Cluster 12: 629 elements
[INFO] Kmeans Cluster 13: 682 elements
[INFO] Kmeans Cluster 14: 412 elements
[INFO] Kmeans Cluster 15: 755 elements
[INFO] Kmeans Cluster 16: 333 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=163.34, Long SMA=204.73, Sharpe=0.6126
[INFO] Centroid 1: Short SMA=67.43, Long SMA=131.75, Sharpe=0.3159
[INFO] Centroid 2: Short SMA=86.40, Long SMA=263.48, Sharpe=0.2378
[INFO] Centroid 3: Short SMA=112.62, Long SMA=154.68, Sharpe=0.2038
[INFO] Centroid 4: Short SMA=254.64, Long SMA=284.17, Sharpe=0.2656
[INFO] Centroid 5: Short SMA=60.80, Long SMA=197.05, Sharpe=0.4441
[INFO] Centroid 6: Short SMA=42.12, Long SMA=101.82, Sharpe=0.4491
[INFO] Centroid 7: Short SMA=27.36, Long SMA=45.64, Sharpe=-0.0623
[INFO] Centroid 8: Short SMA=36.05, Long SMA=269.67, Sharpe=0.4123
[INFO] Centroid 9: Short SMA=110.91, Long SMA=207.22, Sharpe=0.3408
[INFO] Centroid 10: Short SMA=18.55, Long SMA=209.28, Sharpe=0.2694
[INFO] Centroid 11: Short SMA=36.79, Long SMA=83.36, Sharpe=0.2109
[INFO] Centroid 12: Short SMA=140.92, Long SMA=255.09, Sharpe=0.4386
[INFO] Centroid 13: Short SMA=216.43, Long SMA=269.11, Sharpe=0.1487
[INFO] Centroid 14: Short SMA=43.08, Long SMA=183.81, Sharpe=0.5898
[INFO] Centroid 15: Short SMA=194.09, Long SMA=242.12, Sharpe=0.3578
[INFO] Centroid 16: Short SMA=123.45, Long SMA=148.60, Sharpe=0.0379
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9274, Trades=64
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=164, Long SMA=204, Sharpe=0.7834, Trades=14
[INFO] Kmeans Top 2: Short SMA=44, Long SMA=182, Sharpe=0.6737, Trades=13
[INFO] Kmeans Top 3: Short SMA=140, Long SMA=254, Sharpe=0.5477, Trades=12
[INFO] Kmeans Top 4: Short SMA=42, Long SMA=102, Sharpe=0.5109, Trades=23
[INFO] Kmeans Top 5: Short SMA=64, Long SMA=200, Sharpe=0.4073, Trades=14
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (163, 205)
[INFO]   Nearest: (164.0, 204.0)
[INFO]   Rounded: (67, 132)
[INFO]   Nearest: (68.0, 132.0)
[INFO]   Rounded: (86, 263)
[INFO]   Nearest: (86.0, 264.0)
[INFO]   Rounded: (113, 155)
[INFO]   Nearest: (112.0, 154.0)
[INFO]   Rounded: (255, 284)
[INFO]   Nearest: (254.0, 284.0)
[INFO]   Rounded: (61, 197)
[INFO]   Nearest: (60.0, 198.0)
[INFO]   Rounded: (42, 102)
[INFO]   Rounded: (27, 46)
[INFO]   Nearest: (28.0, 46.0)
[INFO]   Rounded: (36, 270)
[INFO]   Rounded: (111, 207)
[INFO]   Nearest: (110.0, 208.0)
[INFO]   Rounded: (19, 209)
[INFO]   Nearest: (18.0, 210.0)
[INFO]   Rounded: (37, 83)
[INFO]   Nearest: (36.0, 84.0)
[INFO]   Rounded: (141, 255)
[INFO]   Nearest: (140.0, 256.0)
[INFO]   Rounded: (216, 269)
[INFO]   Nearest: (216.0, 270.0)
[INFO]   Rounded: (43, 184)
[INFO]   Nearest: (44.0, 184.0)
[INFO]   Rounded: (194, 242)
[INFO]   Rounded: (123, 149)
[INFO]   Nearest: (124.0, 148.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(164/204) - Original Sharpe: 0.7834, Trades: 14
[INFO] Kmeans cluster 2: SMA(44/182) - Original Sharpe: 0.6737, Trades: 13
[INFO] Kmeans cluster 3: SMA(140/254) - Original Sharpe: 0.5477, Trades: 12
[INFO] Kmeans cluster 4: SMA(42/102) - Original Sharpe: 0.5109, Trades: 23
[INFO] Kmeans cluster 5: SMA(64/200) - Original Sharpe: 0.4073, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (164/204) - Sharpe: 0.7834
[INFO] cluster 2: (44/182) - Sharpe: 0.6737
[INFO] cluster 3: (140/254) - Sharpe: 0.5477
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.457400
2    2022-01-10 2022-01-10            41     2.600539            2.568277
3    2022-03-10 2022-03-10            42     0.192786           -2.132309
4    2022-05-10 2022-05-10            41    -0.735414            0.475611
5    2022-07-10 2022-07-10            44     4.961128            0.699473
6    2022-09-10 2022-09-10            43     2.825703            0.362819
7    2022-11-10 2022-11-10            40     1.576583           -2.433794
8    2023-01-10 2023-01-10            41     3.128890            2.917862
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.978898
12   2023-09-10 2023-09-10            44     1.003709            1.003709
13   2023-11-10 2023-11-10            40    -4.602392           -5.427774
14   2024-01-10 2024-01-10            41     1.473702            3.716795
15   2024-03-10 2024-03-10            43    -0.280949            1.499598
16   2024-05-10 2024-05-10            40    -2.452361           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.736674
18   2024-09-10 2024-09-10            44     3.198404           -3.753250
19   2024-11-10 2024-11-10            35     3.533315            3.533315
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2022-03-10   |          0.2 |             -2.1 |         -2.3 | False         
[INFO] 2022-05-10   |         -0.7 |              0.5 |          1.2 | True          
[INFO] 2022-07-10   |          5.0 |              0.7 |         -4.3 | False         
[INFO] 2022-09-10   |          2.8 |              0.4 |         -2.4 | False         
[INFO] 2022-11-10   |          1.6 |             -2.4 |         -4.0 | False         
[INFO] 2023-01-10   |          3.1 |              2.9 |         -0.2 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-10   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -4.6 |             -5.4 |         -0.8 | False         
[INFO] 2024-01-10   |          1.5 |              3.7 |          2.2 | True          
[INFO] 2024-03-10   |         -0.3 |              1.5 |          1.8 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -3.8 |         -7.0 | False         
[INFO] 2024-11-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2024-07-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Kmeans cluster wins (rounded comparison): 4 of 11 periods (36.36% win rate)
[INFO] Updating Excel file with Kmeans results for SB...
[INFO] Excel file updated successfully. Added SB with Kmeans win rate 36.4% in row 43
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(164/204) - Original Sharpe: 0.7834
[INFO] Added cluster 2 to portfolio: SMA(44/182) - Original Sharpe: 0.6737
[INFO] Added cluster 3 to portfolio: SMA(140/254) - Original Sharpe: 0.5477
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SB_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0407
[INFO] Kmeans Best out-of-sample Sharpe: 0.9724
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for SB...
[INFO] Excel file updated successfully. Added SB with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SB
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5052 to 0.9274
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.927384
[INFO] Number of Trades: 64
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10118 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5052 to 0.9274
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3602 to 2.7902
[INFO] Scaled Long SMA range: -2.7801 to 1.4751
[INFO] Scaled Sharpe ratio range: -5.3247 to 3.8078
[INFO] Scaled Trades range: -0.6229 to 16.0045
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10118 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4517
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1078 elements
[INFO] Cluster 1: 1437 elements
[INFO] Cluster 2: 211 elements
[INFO] Cluster 3: 559 elements
[INFO] Cluster 4: 1173 elements
[INFO] Cluster 5: 1078 elements
[INFO] Cluster 6: 934 elements
[INFO] Cluster 7: 507 elements
[INFO] Cluster 8: 768 elements
[INFO] Cluster 9: 913 elements
[INFO] Cluster 10: 64 elements
[INFO] Cluster 11: 802 elements
[INFO] Cluster 12: 267 elements
[INFO] Cluster 13: 327 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=30, Long SMA=256, Sharpe=0.5070, Trades=16
[INFO] Cluster 1 cluster: Short SMA=168, Long SMA=248, Sharpe=0.3304, Trades=10
[INFO] Cluster 2 cluster: Short SMA=40, Long SMA=48, Sharpe=0.0430, Trades=86
[INFO] Cluster 3 cluster: Short SMA=162, Long SMA=206, Sharpe=0.7479, Trades=16
[INFO] Cluster 4 cluster: Short SMA=56, Long SMA=192, Sharpe=0.4966, Trades=13
[INFO] Cluster 5 cluster: Short SMA=48, Long SMA=118, Sharpe=0.3422, Trades=23
[INFO] Cluster 6 cluster: Short SMA=230, Long SMA=280, Sharpe=0.2428, Trades=10
[INFO] Cluster 7 cluster: Short SMA=34, Long SMA=68, Sharpe=0.3223, Trades=42
[INFO] Cluster 8 cluster: Short SMA=76, Long SMA=128, Sharpe=0.2309, Trades=26
[INFO] Cluster 9 cluster: Short SMA=112, Long SMA=200, Sharpe=0.3463, Trades=13
[INFO] Cluster 10 cluster: Short SMA=24, Long SMA=28, Sharpe=-0.0274, Trades=156
[INFO] Cluster 11 cluster: Short SMA=84, Long SMA=266, Sharpe=0.2772, Trades=11
[INFO] Cluster 12 cluster: Short SMA=236, Long SMA=242, Sharpe=0.1887, Trades=30
[INFO] Cluster 13 cluster: Short SMA=122, Long SMA=154, Sharpe=0.0081, Trades=20
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9274, Trades=64
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=162, Long SMA=206, Sharpe=0.7479, Trades=16
[INFO] Top 2: Short SMA=30, Long SMA=256, Sharpe=0.5070, Trades=16
[INFO] Top 3: Short SMA=56, Long SMA=192, Sharpe=0.4966, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 10118 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(162/206) - Original Sharpe: 0.7479, Trades: 16
[INFO] Hierarchical cluster 2: SMA(30/256) - Original Sharpe: 0.5070, Trades: 16
[INFO] Hierarchical cluster 3: SMA(56/192) - Original Sharpe: 0.4966, Trades: 13
[INFO] Hierarchical cluster 4: SMA(112/200) - Original Sharpe: 0.3463, Trades: 13
[INFO] Hierarchical cluster 5: SMA(48/118) - Original Sharpe: 0.3422, Trades: 23
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (162/206) - Sharpe: 0.7479
[INFO] cluster 2: (30/256) - Sharpe: 0.5070
[INFO] cluster 3: (56/192) - Sharpe: 0.4966
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.457400
2    2022-01-10 2022-01-10            41     2.600539           -1.058356
3    2022-03-10 2022-03-10            42     0.192786           -0.448025
4    2022-05-10 2022-05-10            41    -0.735414            0.718259
5    2022-07-10 2022-07-10            44     4.961128            0.354193
6    2022-09-10 2022-09-10            43     2.825703            0.584655
7    2022-11-10 2022-11-10            40     1.576583           -0.872057
8    2023-01-10 2023-01-10            41     3.128890            2.917862
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.978898
12   2023-09-10 2023-09-10            44     1.003709            1.003709
13   2023-11-10 2023-11-10            40    -4.602392           -5.063351
14   2024-01-10 2024-01-10            41     1.473702            1.920310
15   2024-03-10 2024-03-10            43    -0.280949           -0.179921
16   2024-05-10 2024-05-10            40    -2.452361           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.736674
18   2024-09-10 2024-09-10            44     3.198404           -3.438205
19   2024-11-10 2024-11-10            35     3.533315           -3.521645
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |             -1.1 |         -3.7 | False         
[INFO] 2022-03-10   |          0.2 |             -0.4 |         -0.6 | False         
[INFO] 2022-05-10   |         -0.7 |              0.7 |          1.4 | True          
[INFO] 2022-07-10   |          5.0 |              0.4 |         -4.6 | False         
[INFO] 2022-09-10   |          2.8 |              0.6 |         -2.2 | False         
[INFO] 2022-11-10   |          1.6 |             -0.9 |         -2.5 | False         
[INFO] 2023-01-10   |          3.1 |              2.9 |         -0.2 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-10   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -4.6 |             -5.1 |         -0.5 | False         
[INFO] 2024-01-10   |          1.5 |              1.9 |          0.4 | True          
[INFO] 2024-03-10   |         -0.3 |             -0.2 |          0.1 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -3.4 |         -6.6 | False         
[INFO] 2024-11-10   |          3.5 |             -3.5 |         -7.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 13 periods (30.77% win rate)
[INFO] Updating Excel file with Hierarchical results for SB...
[INFO] Excel file updated successfully. Added SB with Hierarchical win rate 30.8% in row 43
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(162/206) - Original Sharpe: 0.7479
[INFO] Added cluster 2 to portfolio: SMA(30/256) - Original Sharpe: 0.5070
[INFO] Added cluster 3 to portfolio: SMA(56/192) - Original Sharpe: 0.4966
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SB_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0786
[INFO] Hierarchical Best out-of-sample Sharpe: 0.9724
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for SB...
[INFO] Excel file updated successfully. Added SB with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SB
[INFO] Loading SF data from local files...
[INFO] Found data file: A_OHLCV_@SF_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SF in column D: 13.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 291.95s
[INFO] Best parameters: Short SMA = 192, Long SMA = 194
[INFO] Best Sharpe ratio: 0.202683, Trades: 104
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_SF_best_192/194 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SF
[INFO] Big Point Value (from data): 125000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 7.05 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $344,481.50
[INFO] Market Buy & Hold P&L: $-34,818.75
[INFO] Outperformance: $379,300.25
[INFO] Sharpe ratio (entire period, annualized): 0.354150
[INFO] Sharpe ratio (in-sample, annualized): 0.202683
[INFO] Sharpe ratio (out-of-sample, annualized): 0.811300
[INFO] Maximum Drawdown: $171,886.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 79
[INFO] Out-of-sample period trades: 25
[INFO] Total trades: 104
[INFO] In-sample P&L: $140,603.50
[INFO] Out-of-sample P&L: $189,643.50
[INFO] 
Best parameters from GA: Short SMA = 192, Long SMA = 194, Sharpe = 0.202683
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] 
Best parameters:
[INFO] Short SMA: 192
[INFO] Long SMA: 194
[INFO] Sharpe Ratio: 0.202683
[INFO] Number of Trades: 104
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.3580 to 3.2380
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 820 elements
[INFO] Kmeans Cluster 1: 655 elements
[INFO] Kmeans Cluster 2: 473 elements
[INFO] Kmeans Cluster 3: 559 elements
[INFO] Kmeans Cluster 4: 589 elements
[INFO] Kmeans Cluster 5: 747 elements
[INFO] Kmeans Cluster 6: 685 elements
[INFO] Kmeans Cluster 7: 664 elements
[INFO] Kmeans Cluster 8: 806 elements
[INFO] Kmeans Cluster 9: 319 elements
[INFO] Kmeans Cluster 10: 737 elements
[INFO] Kmeans Cluster 11: 386 elements
[INFO] Kmeans Cluster 12: 693 elements
[INFO] Kmeans Cluster 13: 743 elements
[INFO] Kmeans Cluster 14: 728 elements
[INFO] Kmeans Cluster 15: 614 elements
[INFO] Kmeans Cluster 16: 367 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=61.47, Long SMA=177.90, Sharpe=-0.3219
[INFO] Centroid 1: Short SMA=125.96, Long SMA=273.62, Sharpe=-0.1229
[INFO] Centroid 2: Short SMA=255.95, Long SMA=285.15, Sharpe=-0.2588
[INFO] Centroid 3: Short SMA=111.49, Long SMA=150.84, Sharpe=-0.0627
[INFO] Centroid 4: Short SMA=30.21, Long SMA=133.89, Sharpe=-0.5041
[INFO] Centroid 5: Short SMA=178.61, Long SMA=256.48, Sharpe=-0.2201
[INFO] Centroid 6: Short SMA=80.08, Long SMA=127.06, Sharpe=-0.2350
[INFO] Centroid 7: Short SMA=36.11, Long SMA=77.26, Sharpe=-0.4003
[INFO] Centroid 8: Short SMA=83.14, Long SMA=267.09, Sharpe=-0.2552
[INFO] Centroid 9: Short SMA=225.24, Long SMA=262.20, Sharpe=-0.5222
[INFO] Centroid 10: Short SMA=161.45, Long SMA=213.32, Sharpe=-0.0504
[INFO] Centroid 11: Short SMA=33.75, Long SMA=67.55, Sharpe=-0.2135
[INFO] Centroid 12: Short SMA=40.97, Long SMA=268.55, Sharpe=-0.3625
[INFO] Centroid 13: Short SMA=104.32, Long SMA=206.87, Sharpe=-0.1842
[INFO] Centroid 14: Short SMA=29.74, Long SMA=219.51, Sharpe=-0.5173
[INFO] Centroid 15: Short SMA=200.94, Long SMA=263.44, Sharpe=-0.3611
[INFO] Centroid 16: Short SMA=146.09, Long SMA=170.63, Sharpe=-0.3032
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=192, Long SMA=194, Sharpe=0.2027, Trades=104
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=162, Long SMA=212, Sharpe=-0.0089, Trades=20
[INFO] Kmeans Top 2: Short SMA=128, Long SMA=274, Sharpe=-0.0618, Trades=10
[INFO] Kmeans Top 3: Short SMA=114, Long SMA=154, Sharpe=-0.0792, Trades=28
[INFO] Kmeans Top 4: Short SMA=78, Long SMA=124, Sharpe=-0.1808, Trades=31
[INFO] Kmeans Top 5: Short SMA=36, Long SMA=66, Sharpe=-0.1910, Trades=55
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (61, 178)
[INFO]   Nearest: (62.0, 178.0)
[INFO]   Rounded: (126, 274)
[INFO]   Rounded: (256, 285)
[INFO]   Nearest: (256.0, 286.0)
[INFO]   Rounded: (111, 151)
[INFO]   Nearest: (112.0, 150.0)
[INFO]   Rounded: (30, 134)
[INFO]   Rounded: (179, 256)
[INFO]   Nearest: (178.0, 256.0)
[INFO]   Rounded: (80, 127)
[INFO]   Nearest: (80.0, 128.0)
[INFO]   Rounded: (36, 77)
[INFO]   Nearest: (36.0, 78.0)
[INFO]   Rounded: (83, 267)
[INFO]   Nearest: (84.0, 268.0)
[INFO]   Rounded: (225, 262)
[INFO]   Nearest: (226.0, 262.0)
[INFO]   Rounded: (161, 213)
[INFO]   Nearest: (162.0, 214.0)
[INFO]   Rounded: (34, 68)
[INFO]   Rounded: (41, 269)
[INFO]   Nearest: (40.0, 268.0)
[INFO]   Rounded: (104, 207)
[INFO]   Nearest: (104.0, 206.0)
[INFO]   Rounded: (30, 220)
[INFO]   Rounded: (201, 263)
[INFO]   Nearest: (200.0, 264.0)
[INFO]   Rounded: (146, 171)
[INFO]   Nearest: (146.0, 170.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 192, Long SMA: 194
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SF data from local files...
[INFO] Found data file: A_OHLCV_@SF_minutes_1440_1703-1557.dat
[INFO] File size: 296586 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(162/212) - Original Sharpe: -0.0089, Trades: 20
[INFO] Kmeans cluster 2: SMA(128/274) - Original Sharpe: -0.0618, Trades: 10
[INFO] Kmeans cluster 3: SMA(114/154) - Original Sharpe: -0.0792, Trades: 28
[INFO] Kmeans cluster 4: SMA(78/124) - Original Sharpe: -0.1808, Trades: 31
[INFO] Kmeans cluster 5: SMA(36/66) - Original Sharpe: -0.1910, Trades: 55
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (192/194)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 192, Long SMA: 194
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] Error: No Kmeans cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SF
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] 
Best parameters:
[INFO] Short SMA: 192
[INFO] Long SMA: 194
[INFO] Sharpe Ratio: 0.202683
[INFO] Number of Trades: 104
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.3580 to 3.2380
[INFO] Scaled Trades range: -0.9245 to 13.5719
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5212
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1376 elements
[INFO] Cluster 1: 616 elements
[INFO] Cluster 2: 895 elements
[INFO] Cluster 3: 831 elements
[INFO] Cluster 4: 716 elements
[INFO] Cluster 5: 1256 elements
[INFO] Cluster 6: 1214 elements
[INFO] Cluster 7: 1004 elements
[INFO] Cluster 8: 32 elements
[INFO] Cluster 9: 566 elements
[INFO] Cluster 10: 215 elements
[INFO] Cluster 11: 1009 elements
[INFO] Cluster 12: 693 elements
[INFO] Cluster 13: 162 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=36, Long SMA=216, Sharpe=-0.6091, Trades=29
[INFO] Cluster 1 cluster: Short SMA=254, Long SMA=278, Sharpe=-0.2586, Trades=28
[INFO] Cluster 2 cluster: Short SMA=40, Long SMA=80, Sharpe=-0.2493, Trades=53
[INFO] Cluster 3 cluster: Short SMA=116, Long SMA=156, Sharpe=-0.0114, Trades=28
[INFO] Cluster 4 cluster: Short SMA=208, Long SMA=264, Sharpe=-0.3248, Trades=20
[INFO] Cluster 5 cluster: Short SMA=72, Long SMA=272, Sharpe=-0.2043, Trades=20
[INFO] Cluster 6 cluster: Short SMA=146, Long SMA=242, Sharpe=-0.0743, Trades=14
[INFO] Cluster 7 cluster: Short SMA=78, Long SMA=154, Sharpe=-0.2373, Trades=25
[INFO] Cluster 8 cluster: Short SMA=30, Long SMA=32, Sharpe=-0.5467, Trades=201
[INFO] Cluster 9 cluster: Short SMA=34, Long SMA=124, Sharpe=-0.4964, Trades=33
[INFO] Cluster 10 cluster: Short SMA=34, Long SMA=42, Sharpe=-0.4709, Trades=105
[INFO] Cluster 11 cluster: Short SMA=104, Long SMA=208, Sharpe=-0.1988, Trades=20
[INFO] Cluster 12 cluster: Short SMA=182, Long SMA=266, Sharpe=-0.2601, Trades=15
[INFO] Cluster 13 cluster: Short SMA=130, Long SMA=134, Sharpe=-0.4495, Trades=74
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=192, Long SMA=194, Sharpe=0.2027, Trades=104
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=116, Long SMA=156, Sharpe=-0.0114, Trades=28
[INFO] Top 2: Short SMA=146, Long SMA=242, Sharpe=-0.0743, Trades=14
[INFO] Top 3: Short SMA=104, Long SMA=208, Sharpe=-0.1988, Trades=20
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 192, Long SMA: 194
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SF data from local files...
[INFO] Found data file: A_OHLCV_@SF_minutes_1440_1703-1557.dat
[INFO] File size: 296586 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(116/156) - Original Sharpe: -0.0114, Trades: 28
[INFO] Hierarchical cluster 2: SMA(146/242) - Original Sharpe: -0.0743, Trades: 14
[INFO] Hierarchical cluster 3: SMA(104/208) - Original Sharpe: -0.1988, Trades: 20
[INFO] Hierarchical cluster 4: SMA(72/272) - Original Sharpe: -0.2043, Trades: 20
[INFO] Hierarchical cluster 5: SMA(78/154) - Original Sharpe: -0.2373, Trades: 25
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (192/194)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 192, Long SMA: 194
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SF
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SI in column D: 27.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 271.66s
[INFO] Best parameters: Short SMA = 48, Long SMA = 50
[INFO] Best Sharpe ratio: 0.669797, Trades: 154
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_SI_best_48/50 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SI
[INFO] Big Point Value (from data): 5000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.38 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $414,360.00
[INFO] Market Buy & Hold P&L: $17,375.00
[INFO] Outperformance: $396,985.00
[INFO] Sharpe ratio (entire period, annualized): 0.321215
[INFO] Sharpe ratio (in-sample, annualized): 0.669797
[INFO] Sharpe ratio (out-of-sample, annualized): -0.408321
[INFO] Maximum Drawdown: $246,379.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 112
[INFO] Out-of-sample period trades: 42
[INFO] Total trades: 154
[INFO] In-sample P&L: $407,662.00
[INFO] Out-of-sample P&L: $-118,498.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.669797
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 5000.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9380 to 0.6698
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.669797
[INFO] Number of Trades: 154
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8660 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9380 to 0.6698
[INFO] Trades range: 11.0 to 337.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2464 to 2.7541
[INFO] Scaled Long SMA range: -2.6696 to 1.6829
[INFO] Scaled Sharpe ratio range: -3.7133 to 3.4043
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 685 elements
[INFO] Kmeans Cluster 1: 734 elements
[INFO] Kmeans Cluster 2: 200 elements
[INFO] Kmeans Cluster 3: 547 elements
[INFO] Kmeans Cluster 4: 440 elements
[INFO] Kmeans Cluster 5: 251 elements
[INFO] Kmeans Cluster 6: 424 elements
[INFO] Kmeans Cluster 7: 473 elements
[INFO] Kmeans Cluster 8: 501 elements
[INFO] Kmeans Cluster 9: 245 elements
[INFO] Kmeans Cluster 10: 276 elements
[INFO] Kmeans Cluster 11: 554 elements
[INFO] Kmeans Cluster 12: 695 elements
[INFO] Kmeans Cluster 13: 822 elements
[INFO] Kmeans Cluster 14: 583 elements
[INFO] Kmeans Cluster 15: 800 elements
[INFO] Kmeans Cluster 16: 430 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=207.86, Long SMA=243.27, Sharpe=0.2216
[INFO] Centroid 1: Short SMA=47.28, Long SMA=115.23, Sharpe=-0.3304
[INFO] Centroid 2: Short SMA=41.17, Long SMA=148.78, Sharpe=0.2059
[INFO] Centroid 3: Short SMA=87.65, Long SMA=227.65, Sharpe=-0.1508
[INFO] Centroid 4: Short SMA=45.88, Long SMA=89.24, Sharpe=-0.5196
[INFO] Centroid 5: Short SMA=28.41, Long SMA=52.90, Sharpe=0.1244
[INFO] Centroid 6: Short SMA=130.14, Long SMA=177.85, Sharpe=-0.4944
[INFO] Centroid 7: Short SMA=226.55, Long SMA=271.63, Sharpe=0.0236
[INFO] Centroid 8: Short SMA=158.61, Long SMA=195.30, Sharpe=-0.2154
[INFO] Centroid 9: Short SMA=23.31, Long SMA=57.64, Sharpe=-0.1706
[INFO] Centroid 10: Short SMA=267.30, Long SMA=286.87, Sharpe=-0.2423
[INFO] Centroid 11: Short SMA=90.90, Long SMA=173.79, Sharpe=-0.2804
[INFO] Centroid 12: Short SMA=42.71, Long SMA=249.20, Sharpe=0.1753
[INFO] Centroid 13: Short SMA=90.26, Long SMA=136.67, Sharpe=-0.0928
[INFO] Centroid 14: Short SMA=148.81, Long SMA=216.90, Sharpe=-0.0001
[INFO] Centroid 15: Short SMA=35.70, Long SMA=191.75, Sharpe=-0.0197
[INFO] Centroid 16: Short SMA=28.64, Long SMA=276.79, Sharpe=0.0248
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.6698, Trades=154
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=40, Long SMA=148, Sharpe=0.3269, Trades=31
[INFO] Kmeans Top 2: Short SMA=30, Long SMA=54, Sharpe=0.1553, Trades=58
[INFO] Kmeans Top 3: Short SMA=206, Long SMA=240, Sharpe=0.1553, Trades=19
[INFO] Kmeans Top 4: Short SMA=230, Long SMA=276, Sharpe=0.1526, Trades=19
[INFO] Kmeans Top 5: Short SMA=44, Long SMA=248, Sharpe=0.1417, Trades=19
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (208, 243)
[INFO]   Nearest: (208.0, 244.0)
[INFO]   Rounded: (47, 115)
[INFO]   Nearest: (48.0, 116.0)
[INFO]   Rounded: (41, 149)
[INFO]   Nearest: (42.0, 148.0)
[INFO]   Rounded: (88, 228)
[INFO]   Rounded: (46, 89)
[INFO]   Nearest: (46.0, 90.0)
[INFO]   Rounded: (28, 53)
[INFO]   Nearest: (28.0, 52.0)
[INFO]   Rounded: (130, 178)
[INFO]   Rounded: (227, 272)
[INFO]   Nearest: (226.0, 272.0)
[INFO]   Rounded: (159, 195)
[INFO]   Nearest: (158.0, 196.0)
[INFO]   Rounded: (23, 58)
[INFO]   Nearest: (24.0, 58.0)
[INFO]   Rounded: (267, 287)
[INFO]   Nearest: (268.0, 286.0)
[INFO]   Rounded: (91, 174)
[INFO]   Nearest: (90.0, 174.0)
[INFO]   Rounded: (43, 249)
[INFO]   Nearest: (42.0, 250.0)
[INFO]   Rounded: (90, 137)
[INFO]   Nearest: (90.0, 136.0)
[INFO]   Rounded: (149, 217)
[INFO]   Nearest: (148.0, 216.0)
[INFO]   Rounded: (36, 192)
[INFO]   Rounded: (29, 277)
[INFO]   Nearest: (28.0, 276.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(40/148) - Original Sharpe: 0.3269, Trades: 31
[INFO] Kmeans cluster 2: SMA(30/54) - Original Sharpe: 0.1553, Trades: 58
[INFO] Kmeans cluster 3: SMA(206/240) - Original Sharpe: 0.1553, Trades: 19
[INFO] Kmeans cluster 4: SMA(230/276) - Original Sharpe: 0.1526, Trades: 19
[INFO] Kmeans cluster 5: SMA(44/248) - Original Sharpe: 0.1417, Trades: 19
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (40/148) - Sharpe: 0.3269
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.846146           -1.499253
1    2021-11-14 2021-11-14            43     1.283193            2.964470
2    2022-01-14 2022-01-14            41     2.565750           -1.497098
3    2022-03-14 2022-03-14            44    -3.404503           -4.734924
4    2022-05-14 2022-05-14            43     2.893818            4.492106
5    2022-07-14 2022-07-14            44     0.011366            0.011366
6    2022-09-14 2022-09-14            43     3.966370           -1.875590
7    2022-11-14 2022-11-14            43     1.499239            3.478177
8    2023-01-14 2023-01-14            41    -2.431921           -1.645791
9    2023-03-14 2023-03-14            43    -5.362105            2.972700
10   2023-05-14 2023-05-14            44    -0.525137           -3.076501
11   2023-07-14 2023-07-14            44    -4.645863           -5.977898
12   2023-09-14 2023-09-14            43     1.669521            0.419633
13   2023-11-14 2023-11-14            42    -3.736541           -3.067060
14   2024-01-14 2024-01-14            43    -2.734966           -2.984107
15   2024-03-14 2024-03-14            42     2.485153            3.228775
16   2024-05-14 2024-05-14            44     1.052155            1.052155
17   2024-07-14 2024-07-14            45    -2.506040           -0.245055
18   2024-09-14 2024-09-14            43    -1.009444           -0.349255
19   2024-11-14 2024-11-14            33     1.294467           -1.444151
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.8 |             -1.5 |          0.3 | True          
[INFO] 2021-11-14   |          1.3 |              3.0 |          1.7 | True          
[INFO] 2022-01-14   |          2.6 |             -1.5 |         -4.1 | False         
[INFO] 2022-03-14   |         -3.4 |             -4.7 |         -1.3 | False         
[INFO] 2022-05-14   |          2.9 |              4.5 |          1.6 | True          
[INFO] 2022-07-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |          4.0 |             -1.9 |         -5.9 | False         
[INFO] 2022-11-14   |          1.5 |              3.5 |          2.0 | True          
[INFO] 2023-01-14   |         -2.4 |             -1.6 |          0.8 | True          
[INFO] 2023-03-14   |         -5.4 |              3.0 |          8.4 | True          
[INFO] 2023-05-14   |         -0.5 |             -3.1 |         -2.6 | False         
[INFO] 2023-07-14   |         -4.6 |             -6.0 |         -1.4 | False         
[INFO] 2023-09-14   |          1.7 |              0.4 |         -1.3 | False         
[INFO] 2023-11-14   |         -3.7 |             -3.1 |          0.6 | True          
[INFO] 2024-01-14   |         -2.7 |             -3.0 |         -0.3 | False         
[INFO] 2024-03-14   |          2.5 |              3.2 |          0.7 | True          
[INFO] 2024-05-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-09-14   |         -1.0 |             -0.3 |          0.7 | True          
[INFO] 2024-11-14   |          1.3 |             -1.4 |         -2.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 10 of 18 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for SI...
[INFO] Excel file updated successfully. Added SI with Kmeans win rate 55.6% in row 44
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(40/148) - Original Sharpe: 0.3269
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SI_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.4690
[INFO] Kmeans Best out-of-sample Sharpe: -0.4083
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for SI...
[INFO] Excel file updated successfully. Added SI with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SI
[INFO] Big Point Value: 5000.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9380 to 0.6698
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.669797
[INFO] Number of Trades: 154
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8660 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9380 to 0.6698
[INFO] Trades range: 11.0 to 337.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2464 to 2.7541
[INFO] Scaled Long SMA range: -2.6696 to 1.6829
[INFO] Scaled Sharpe ratio range: -3.7133 to 3.4043
[INFO] Scaled Trades range: -0.9008 to 12.8274
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8660 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6294
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 11
[INFO] Using 11 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 11 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1433 elements
[INFO] Cluster 1: 122 elements
[INFO] Cluster 2: 1230 elements
[INFO] Cluster 3: 1526 elements
[INFO] Cluster 4: 1027 elements
[INFO] Cluster 5: 1285 elements
[INFO] Cluster 6: 665 elements
[INFO] Cluster 7: 340 elements
[INFO] Cluster 8: 272 elements
[INFO] Cluster 9: 526 elements
[INFO] Cluster 10: 234 elements
[INFO] Using 11 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=122, Long SMA=218, Sharpe=0.0911, Trades=13
[INFO] Cluster 1 cluster: Short SMA=46, Long SMA=48, Sharpe=0.1014, Trades=154
[INFO] Cluster 2 cluster: Short SMA=214, Long SMA=252, Sharpe=0.0499, Trades=21
[INFO] Cluster 3 cluster: Short SMA=40, Long SMA=246, Sharpe=0.2063, Trades=19
[INFO] Cluster 4 cluster: Short SMA=40, Long SMA=102, Sharpe=-0.4584, Trades=46
[INFO] Cluster 5 cluster: Short SMA=82, Long SMA=156, Sharpe=-0.0252, Trades=25
[INFO] Cluster 6 cluster: Short SMA=136, Long SMA=174, Sharpe=-0.3603, Trades=33
[INFO] Cluster 7 cluster: Short SMA=22, Long SMA=52, Sharpe=0.0708, Trades=66
[INFO] Cluster 8 cluster: Short SMA=270, Long SMA=286, Sharpe=-0.2235, Trades=19
[INFO] Cluster 9 cluster: Short SMA=34, Long SMA=156, Sharpe=0.3110, Trades=32
[INFO] Cluster 10 cluster: Short SMA=100, Long SMA=110, Sharpe=-0.1994, Trades=66
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.6698, Trades=154
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=34, Long SMA=156, Sharpe=0.3110, Trades=32
[INFO] Top 2: Short SMA=40, Long SMA=246, Sharpe=0.2063, Trades=19
[INFO] Top 3: Short SMA=46, Long SMA=48, Sharpe=0.1014, Trades=154
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 11 valid clusters with clusters
[INFO] Filtering to 8660 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(34/156) - Original Sharpe: 0.3110, Trades: 32
[INFO] Hierarchical cluster 2: SMA(40/246) - Original Sharpe: 0.2063, Trades: 19
[INFO] Hierarchical cluster 3: SMA(46/48) - Original Sharpe: 0.1014, Trades: 154
[INFO] Hierarchical cluster 4: SMA(122/218) - Original Sharpe: 0.0911, Trades: 13
[INFO] Hierarchical cluster 5: SMA(22/52) - Original Sharpe: 0.0708, Trades: 66
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/156) - Sharpe: 0.3110
[INFO] cluster 2: (40/246) - Sharpe: 0.2063
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.846146           -1.499253
1    2021-11-14 2021-11-14            43     1.283193            2.964470
2    2022-01-14 2022-01-14            41     2.565750           -2.515920
3    2022-03-14 2022-03-14            44    -3.404503           -5.174543
4    2022-05-14 2022-05-14            43     2.893818            3.472151
5    2022-07-14 2022-07-14            44     0.011366            0.011366
6    2022-09-14 2022-09-14            43     3.966370           -1.875590
7    2022-11-14 2022-11-14            43     1.499239            0.309219
8    2023-01-14 2023-01-14            41    -2.431921           -1.645791
9    2023-03-14 2023-03-14            43    -5.362105            2.972700
10   2023-05-14 2023-05-14            44    -0.525137           -1.504773
11   2023-07-14 2023-07-14            44    -4.645863           -0.682652
12   2023-09-14 2023-09-14            43     1.669521            0.744510
13   2023-11-14 2023-11-14            42    -3.736541           -2.016259
14   2024-01-14 2024-01-14            43    -2.734966           -2.325767
15   2024-03-14 2024-03-14            42     2.485153            1.154565
16   2024-05-14 2024-05-14            44     1.052155            1.052155
17   2024-07-14 2024-07-14            45    -2.506040           -0.245055
18   2024-09-14 2024-09-14            43    -1.009444           -0.349255
19   2024-11-14 2024-11-14            33     1.294467           -0.426350
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.8 |             -1.5 |          0.3 | True          
[INFO] 2021-11-14   |          1.3 |              3.0 |          1.7 | True          
[INFO] 2022-01-14   |          2.6 |             -2.5 |         -5.1 | False         
[INFO] 2022-03-14   |         -3.4 |             -5.2 |         -1.8 | False         
[INFO] 2022-05-14   |          2.9 |              3.5 |          0.6 | True          
[INFO] 2022-07-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |          4.0 |             -1.9 |         -5.9 | False         
[INFO] 2022-11-14   |          1.5 |              0.3 |         -1.2 | False         
[INFO] 2023-01-14   |         -2.4 |             -1.6 |          0.8 | True          
[INFO] 2023-03-14   |         -5.4 |              3.0 |          8.4 | True          
[INFO] 2023-05-14   |         -0.5 |             -1.5 |         -1.0 | False         
[INFO] 2023-07-14   |         -4.6 |             -0.7 |          3.9 | True          
[INFO] 2023-09-14   |          1.7 |              0.7 |         -1.0 | False         
[INFO] 2023-11-14   |         -3.7 |             -2.0 |          1.7 | True          
[INFO] 2024-01-14   |         -2.7 |             -2.3 |          0.4 | True          
[INFO] 2024-03-14   |          2.5 |              1.2 |         -1.3 | False         
[INFO] 2024-05-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-09-14   |         -1.0 |             -0.3 |          0.7 | True          
[INFO] 2024-11-14   |          1.3 |             -0.4 |         -1.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 18 periods (55.56% win rate)
[INFO] Updating Excel file with Hierarchical results for SI...
[INFO] Excel file updated successfully. Added SI with Hierarchical win rate 55.6% in row 44
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/156) - Original Sharpe: 0.3110
[INFO] Added cluster 2 to portfolio: SMA(40/246) - Original Sharpe: 0.2063
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SI_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3194
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4083
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for SI...
[INFO] Excel file updated successfully. Added SI with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SI
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SM in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 245.55s
[INFO] Best parameters: Short SMA = 70, Long SMA = 74
[INFO] Best Sharpe ratio: 0.679896, Trades: 87
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_SM_best_70/74 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SM
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.37 contracts
[INFO] Maximum Position Size: 19 contracts
[INFO] Strategy Total P&L: $214,754.00
[INFO] Market Buy & Hold P&L: $10,810.00
[INFO] Outperformance: $203,944.00
[INFO] Sharpe ratio (entire period, annualized): 0.196631
[INFO] Sharpe ratio (in-sample, annualized): 0.679896
[INFO] Sharpe ratio (out-of-sample, annualized): -0.899276
[INFO] Maximum Drawdown: $250,628.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 63
[INFO] Out-of-sample period trades: 24
[INFO] Total trades: 87
[INFO] In-sample P&L: $356,944.00
[INFO] Out-of-sample P&L: $-208,076.00
[INFO] 
Best parameters from GA: Short SMA = 70, Long SMA = 74, Sharpe = 0.679896
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.3858 to 0.6799
[INFO] 
Best parameters:
[INFO] Short SMA: 70
[INFO] Long SMA: 74
[INFO] Sharpe Ratio: 0.679896
[INFO] Number of Trades: 87
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.3858 to 0.6799
[INFO] Trades range: 12.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.2107 to 3.4208
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 898 elements
[INFO] Kmeans Cluster 1: 685 elements
[INFO] Kmeans Cluster 2: 822 elements
[INFO] Kmeans Cluster 3: 1207 elements
[INFO] Kmeans Cluster 4: 902 elements
[INFO] Kmeans Cluster 5: 289 elements
[INFO] Kmeans Cluster 6: 430 elements
[INFO] Kmeans Cluster 7: 683 elements
[INFO] Kmeans Cluster 8: 720 elements
[INFO] Kmeans Cluster 9: 651 elements
[INFO] Kmeans Cluster 10: 563 elements
[INFO] Kmeans Cluster 11: 750 elements
[INFO] Kmeans Cluster 12: 790 elements
[INFO] Kmeans Cluster 13: 676 elements
[INFO] Kmeans Cluster 14: 519 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=109.46, Long SMA=251.67, Sharpe=-0.5782
[INFO] Centroid 1: Short SMA=46.33, Long SMA=91.54, Sharpe=-0.0455
[INFO] Centroid 2: Short SMA=157.11, Long SMA=255.63, Sharpe=-0.2979
[INFO] Centroid 3: Short SMA=48.50, Long SMA=215.41, Sharpe=-0.2983
[INFO] Centroid 4: Short SMA=35.68, Long SMA=152.02, Sharpe=-0.2283
[INFO] Centroid 5: Short SMA=265.90, Long SMA=289.67, Sharpe=-0.9693
[INFO] Centroid 6: Short SMA=126.44, Long SMA=159.20, Sharpe=-0.9734
[INFO] Centroid 7: Short SMA=211.69, Long SMA=283.10, Sharpe=-0.5753
[INFO] Centroid 8: Short SMA=37.11, Long SMA=71.98, Sharpe=0.2360
[INFO] Centroid 9: Short SMA=35.96, Long SMA=269.09, Sharpe=-0.4499
[INFO] Centroid 10: Short SMA=83.07, Long SMA=287.87, Sharpe=-0.8851
[INFO] Centroid 11: Short SMA=87.21, Long SMA=144.28, Sharpe=-0.4080
[INFO] Centroid 12: Short SMA=210.00, Long SMA=240.66, Sharpe=-0.2986
[INFO] Centroid 13: Short SMA=121.43, Long SMA=185.43, Sharpe=-0.6089
[INFO] Centroid 14: Short SMA=165.71, Long SMA=202.26, Sharpe=-0.1038
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=70, Long SMA=74, Sharpe=0.6799, Trades=87
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=40, Long SMA=76, Sharpe=0.2973, Trades=37
[INFO] Kmeans Top 2: Short SMA=44, Long SMA=100, Sharpe=0.0598, Trades=33
[INFO] Kmeans Top 3: Short SMA=166, Long SMA=202, Sharpe=0.0108, Trades=25
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=152, Sharpe=-0.1428, Trades=21
[INFO] Kmeans Top 5: Short SMA=158, Long SMA=256, Sharpe=-0.2367, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (109, 252)
[INFO]   Nearest: (110.0, 252.0)
[INFO]   Rounded: (46, 92)
[INFO]   Rounded: (157, 256)
[INFO]   Nearest: (158.0, 256.0)
[INFO]   Rounded: (48, 215)
[INFO]   Nearest: (48.0, 216.0)
[INFO]   Rounded: (36, 152)
[INFO]   Rounded: (266, 290)
[INFO]   Rounded: (126, 159)
[INFO]   Nearest: (126.0, 160.0)
[INFO]   Rounded: (212, 283)
[INFO]   Nearest: (212.0, 284.0)
[INFO]   Rounded: (37, 72)
[INFO]   Nearest: (38.0, 72.0)
[INFO]   Rounded: (36, 269)
[INFO]   Nearest: (36.0, 270.0)
[INFO]   Rounded: (83, 288)
[INFO]   Nearest: (84.0, 288.0)
[INFO]   Rounded: (87, 144)
[INFO]   Nearest: (88.0, 144.0)
[INFO]   Rounded: (210, 241)
[INFO]   Nearest: (210.0, 240.0)
[INFO]   Rounded: (121, 185)
[INFO]   Nearest: (122.0, 186.0)
[INFO]   Rounded: (166, 202)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 70, Long SMA: 74
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(40/76) - Original Sharpe: 0.2973, Trades: 37
[INFO] Kmeans cluster 2: SMA(44/100) - Original Sharpe: 0.0598, Trades: 33
[INFO] Kmeans cluster 3: SMA(166/202) - Original Sharpe: 0.0108, Trades: 25
[INFO] Kmeans cluster 4: SMA(36/152) - Original Sharpe: -0.1428, Trades: 21
[INFO] Kmeans cluster 5: SMA(158/256) - Original Sharpe: -0.2367, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (70/74)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (40/76) - Sharpe: 0.2973
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.297409           -0.297409
1    2021-11-10 2021-11-10            41     0.579196            2.795857
2    2022-01-10 2022-01-10            41     2.725389            2.725389
3    2022-03-10 2022-03-10            42    -4.090683           -4.090683
4    2022-05-10 2022-05-10            41    -3.216020           -1.530527
5    2022-07-10 2022-07-10            44    -0.228249           -0.621374
6    2022-09-10 2022-09-10            43     0.723663            0.393718
7    2022-11-10 2022-11-10            40    -1.624676           -3.687231
8    2023-01-10 2023-01-10            41     1.963421            1.963421
9    2023-03-10 2023-03-10            42    -4.781168           -0.937034
10   2023-05-10 2023-05-10            40     1.697903            0.316314
11   2023-07-10 2023-07-10            44    -0.986722           -0.083433
12   2023-09-10 2023-09-10            44    -0.465397           -3.010091
13   2023-11-10 2023-11-10            40    -3.397712           -3.397712
14   2024-01-10 2024-01-10            41     0.698756           -0.055457
15   2024-03-10 2024-03-10            43    -2.269644           -3.571957
16   2024-05-10 2024-05-10            40    -2.839898           -2.097938
17   2024-07-10 2024-07-10            43    -2.557415           -0.080603
18   2024-09-10 2024-09-10            44    -1.365575           -1.023977
19   2024-11-10 2024-11-10            35    -0.851426           -1.987769
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.3 |             -0.3 |          0.0 | Excluded      
[INFO] 2021-11-10   |          0.6 |              2.8 |          2.2 | True          
[INFO] 2022-01-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -4.1 |             -4.1 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -3.2 |             -1.5 |          1.7 | True          
[INFO] 2022-07-10   |         -0.2 |             -0.6 |         -0.4 | False         
[INFO] 2022-09-10   |          0.7 |              0.4 |         -0.3 | False         
[INFO] 2022-11-10   |         -1.6 |             -3.7 |         -2.1 | False         
[INFO] 2023-01-10   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -4.8 |             -0.9 |          3.9 | True          
[INFO] 2023-05-10   |          1.7 |              0.3 |         -1.4 | False         
[INFO] 2023-07-10   |         -1.0 |             -0.1 |          0.9 | True          
[INFO] 2023-09-10   |         -0.5 |             -3.0 |         -2.5 | False         
[INFO] 2023-11-10   |         -3.4 |             -3.4 |          0.0 | Excluded      
[INFO] 2024-01-10   |          0.7 |             -0.1 |         -0.8 | False         
[INFO] 2024-03-10   |         -2.3 |             -3.6 |         -1.3 | False         
[INFO] 2024-05-10   |         -2.8 |             -2.1 |          0.7 | True          
[INFO] 2024-07-10   |         -2.6 |             -0.1 |          2.5 | True          
[INFO] 2024-09-10   |         -1.4 |             -1.0 |          0.4 | True          
[INFO] 2024-11-10   |         -0.9 |             -2.0 |         -1.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2022-01-10, 2022-03-10, 2023-01-10, 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Kmeans cluster wins (rounded comparison): 7 of 15 periods (46.67% win rate)
[INFO] Updating Excel file with Kmeans results for SM...
[INFO] Excel file updated successfully. Added SM with Kmeans win rate 46.7% in row 45
[INFO] Added best Sharpe parameters 70/74 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 70, Long SMA: 74
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(40/76) - Original Sharpe: 0.2973
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SM_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.8689
[INFO] Kmeans Best out-of-sample Sharpe: -0.8993
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for SM...
[INFO] Excel file updated successfully. Added SM with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SM
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.3858 to 0.6799
[INFO] 
Best parameters:
[INFO] Short SMA: 70
[INFO] Long SMA: 74
[INFO] Sharpe Ratio: 0.679896
[INFO] Number of Trades: 87
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.3858 to 0.6799
[INFO] Trades range: 12.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.2107 to 3.4208
[INFO] Scaled Trades range: -0.7741 to 18.1739
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6539
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1056 elements
[INFO] Cluster 1: 1398 elements
[INFO] Cluster 2: 962 elements
[INFO] Cluster 3: 790 elements
[INFO] Cluster 4: 801 elements
[INFO] Cluster 5: 1102 elements
[INFO] Cluster 6: 75 elements
[INFO] Cluster 7: 790 elements
[INFO] Cluster 8: 129 elements
[INFO] Cluster 9: 223 elements
[INFO] Cluster 10: 446 elements
[INFO] Cluster 11: 829 elements
[INFO] Cluster 12: 1059 elements
[INFO] Cluster 13: 200 elements
[INFO] Cluster 14: 8 elements
[INFO] Cluster 15: 717 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=100, Long SMA=158, Sharpe=-0.5463, Trades=23
[INFO] Cluster 1 cluster: Short SMA=42, Long SMA=144, Sharpe=-0.1986, Trades=25
[INFO] Cluster 2 cluster: Short SMA=184, Long SMA=216, Sharpe=-0.3053, Trades=26
[INFO] Cluster 3 cluster: Short SMA=38, Long SMA=84, Sharpe=0.0843, Trades=37
[INFO] Cluster 4 cluster: Short SMA=86, Long SMA=284, Sharpe=-0.8828, Trades=18
[INFO] Cluster 5 cluster: Short SMA=38, Long SMA=252, Sharpe=-0.4108, Trades=23
[INFO] Cluster 6 cluster: Short SMA=42, Long SMA=44, Sharpe=0.0567, Trades=133
[INFO] Cluster 7 cluster: Short SMA=214, Long SMA=284, Sharpe=-0.5811, Trades=16
[INFO] Cluster 8 cluster: Short SMA=196, Long SMA=200, Sharpe=-0.4868, Trades=71
[INFO] Cluster 9 cluster: Short SMA=26, Long SMA=44, Sharpe=-0.1758, Trades=71
[INFO] Cluster 10 cluster: Short SMA=126, Long SMA=162, Sharpe=-1.0711, Trades=27
[INFO] Cluster 11 cluster: Short SMA=110, Long SMA=236, Sharpe=-0.4814, Trades=15
[INFO] Cluster 12 cluster: Short SMA=166, Long SMA=256, Sharpe=-0.1880, Trades=13
[INFO] Cluster 13 cluster: Short SMA=272, Long SMA=290, Sharpe=-0.9629, Trades=28
[INFO] Cluster 15 cluster: Short SMA=62, Long SMA=200, Sharpe=-0.3250, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=70, Long SMA=74, Sharpe=0.6799, Trades=87
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=84, Sharpe=0.0843, Trades=37
[INFO] Top 2: Short SMA=42, Long SMA=44, Sharpe=0.0567, Trades=133
[INFO] Top 3: Short SMA=26, Long SMA=44, Sharpe=-0.1758, Trades=71
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10577 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 70, Long SMA: 74
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/84) - Original Sharpe: 0.0843, Trades: 37
[INFO] Hierarchical cluster 2: SMA(42/44) - Original Sharpe: 0.0567, Trades: 133
[INFO] Hierarchical cluster 3: SMA(26/44) - Original Sharpe: -0.1758, Trades: 71
[INFO] Hierarchical cluster 4: SMA(166/256) - Original Sharpe: -0.1880, Trades: 13
[INFO] Hierarchical cluster 5: SMA(42/144) - Original Sharpe: -0.1986, Trades: 25
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (70/74)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 70, Long SMA: 74
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SM
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for TEN in column D: 18.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 194.06s
[INFO] Best parameters: Short SMA = 58, Long SMA = 76
[INFO] Best Sharpe ratio: 1.262627, Trades: 37
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_TEN_best_58/76 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @TEN=117XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.08 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $411,204.62
[INFO] Market Buy & Hold P&L: $-18,312.50
[INFO] Outperformance: $429,517.12
[INFO] Sharpe ratio (entire period, annualized): 0.642709
[INFO] Sharpe ratio (in-sample, annualized): 1.262627
[INFO] Sharpe ratio (out-of-sample, annualized): -0.813918
[INFO] Maximum Drawdown: $216,784.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 23
[INFO] Out-of-sample period trades: 14
[INFO] Total trades: 37
[INFO] In-sample P&L: $566,161.25
[INFO] Out-of-sample P&L: $-154,956.62
[INFO] 
Best parameters from GA: Short SMA = 58, Long SMA = 76, Sharpe = 1.262627
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5303 to 1.2626
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 76
[INFO] Sharpe Ratio: 1.262627
[INFO] Number of Trades: 37
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9144 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5303 to 1.2626
[INFO] Trades range: 10.0 to 263.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3303 to 2.6446
[INFO] Scaled Long SMA range: -2.7069 to 1.6060
[INFO] Scaled Sharpe ratio range: -2.5233 to 3.4723
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 14
[INFO] Using 14 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=14...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 654 elements
[INFO] Kmeans Cluster 1: 662 elements
[INFO] Kmeans Cluster 2: 414 elements
[INFO] Kmeans Cluster 3: 806 elements
[INFO] Kmeans Cluster 4: 875 elements
[INFO] Kmeans Cluster 5: 721 elements
[INFO] Kmeans Cluster 6: 691 elements
[INFO] Kmeans Cluster 7: 671 elements
[INFO] Kmeans Cluster 8: 815 elements
[INFO] Kmeans Cluster 9: 604 elements
[INFO] Kmeans Cluster 10: 695 elements
[INFO] Kmeans Cluster 11: 851 elements
[INFO] Kmeans Cluster 12: 586 elements
[INFO] Kmeans Cluster 13: 99 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=36.08, Long SMA=270.42, Sharpe=0.3546
[INFO] Centroid 1: Short SMA=128.47, Long SMA=232.01, Sharpe=0.2590
[INFO] Centroid 2: Short SMA=49.24, Long SMA=104.74, Sharpe=0.5286
[INFO] Centroid 3: Short SMA=189.96, Long SMA=221.19, Sharpe=-0.0340
[INFO] Centroid 4: Short SMA=133.69, Long SMA=185.25, Sharpe=0.1987
[INFO] Centroid 5: Short SMA=181.18, Long SMA=268.50, Sharpe=-0.0584
[INFO] Centroid 6: Short SMA=38.50, Long SMA=221.31, Sharpe=0.4874
[INFO] Centroid 7: Short SMA=100.35, Long SMA=141.89, Sharpe=-0.1871
[INFO] Centroid 8: Short SMA=34.90, Long SMA=73.60, Sharpe=0.8559
[INFO] Centroid 9: Short SMA=31.27, Long SMA=147.88, Sharpe=0.3516
[INFO] Centroid 10: Short SMA=64.26, Long SMA=195.68, Sharpe=0.2704
[INFO] Centroid 11: Short SMA=244.27, Long SMA=277.35, Sharpe=-0.0497
[INFO] Centroid 12: Short SMA=81.36, Long SMA=140.92, Sharpe=0.0421
[INFO] Centroid 13: Short SMA=16.83, Long SMA=30.10, Sharpe=0.3285
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=76, Sharpe=1.2626, Trades=37
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=34, Long SMA=74, Sharpe=0.8244, Trades=33
[INFO] Kmeans Top 2: Short SMA=48, Long SMA=108, Sharpe=0.6913, Trades=23
[INFO] Kmeans Top 3: Short SMA=16, Long SMA=30, Sharpe=0.4645, Trades=83
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=148, Sharpe=0.4283, Trades=21
[INFO] Kmeans Top 5: Short SMA=36, Long SMA=224, Sharpe=0.4033, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}
[INFO]   Rounded: (36, 270)
[INFO]   Rounded: (128, 232)
[INFO]   Rounded: (49, 105)
[INFO]   Nearest: (50.0, 104.0)
[INFO]   Rounded: (190, 221)
[INFO]   Nearest: (190.0, 222.0)
[INFO]   Rounded: (134, 185)
[INFO]   Nearest: (134.0, 186.0)
[INFO]   Rounded: (181, 268)
[INFO]   Nearest: (182.0, 268.0)
[INFO]   Rounded: (38, 221)
[INFO]   Nearest: (38.0, 222.0)
[INFO]   Rounded: (100, 142)
[INFO]   Rounded: (35, 74)
[INFO]   Nearest: (34.0, 74.0)
[INFO]   Rounded: (31, 148)
[INFO]   Nearest: (32.0, 148.0)
[INFO]   Rounded: (64, 196)
[INFO]   Rounded: (244, 277)
[INFO]   Nearest: (244.0, 278.0)
[INFO]   Rounded: (81, 141)
[INFO]   Nearest: (82.0, 140.0)
[INFO]   Rounded: (17, 30)
[INFO]   Nearest: (16.0, 30.0)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 76
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(34/74) - Original Sharpe: 0.8244, Trades: 33
[INFO] Kmeans cluster 2: SMA(48/108) - Original Sharpe: 0.6913, Trades: 23
[INFO] Kmeans cluster 3: SMA(16/30) - Original Sharpe: 0.4645, Trades: 83
[INFO] Kmeans cluster 4: SMA(30/148) - Original Sharpe: 0.4283, Trades: 21
[INFO] Kmeans cluster 5: SMA(36/224) - Original Sharpe: 0.4033, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2318
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/76)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/74) - Sharpe: 0.8244
[INFO] cluster 2: (48/108) - Sharpe: 0.6913
[INFO] cluster 3: (16/30) - Sharpe: 0.4645
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Out-of-sample period starts on: 2022-04-25
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2022-04-25 2022-04-25            45     0.869705           -1.407746
1    2022-06-25 2022-06-25            43    -0.666869           -2.283784
2    2022-08-25 2022-08-25            43    -1.133345            2.812645
3    2022-10-25 2022-10-25            44    -2.239033           -4.598551
4    2022-12-25 2022-12-25            43    -3.070652           -5.002529
5    2023-02-25 2023-02-25            41    -3.791965           -2.467970
6    2023-04-25 2023-04-25            44    -2.516428           -2.711744
7    2023-06-25 2023-06-25            44     2.949798            2.949798
8    2023-08-25 2023-08-25            43     3.401253            3.401253
9    2023-10-25 2023-10-25            43    -4.105859           -1.213436
10   2023-12-25 2023-12-25            43    -3.479188           -3.377329
11   2024-02-25 2024-02-25            42     2.392603            2.629456
12   2024-04-25 2024-04-25            43    -2.501372           -3.058875
13   2024-06-25 2024-06-25            44     2.619489            2.964956
14   2024-08-25 2024-08-25            44    -3.660489           -3.146234
15   2024-10-25 2024-10-25            43     0.789016           -0.969247
16   2024-12-25 2024-12-25             4    -0.779051           -0.779051
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2022-04-25   |          0.9 |             -1.4 |         -2.3 | False         
[INFO] 2022-06-25   |         -0.7 |             -2.3 |         -1.6 | False         
[INFO] 2022-08-25   |         -1.1 |              2.8 |          3.9 | True          
[INFO] 2022-10-25   |         -2.2 |             -4.6 |         -2.4 | False         
[INFO] 2022-12-25   |         -3.1 |             -5.0 |         -1.9 | False         
[INFO] 2023-02-25   |         -3.8 |             -2.5 |          1.3 | True          
[INFO] 2023-04-25   |         -2.5 |             -2.7 |         -0.2 | False         
[INFO] 2023-06-25   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-08-25   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-10-25   |         -4.1 |             -1.2 |          2.9 | True          
[INFO] 2023-12-25   |         -3.5 |             -3.4 |          0.1 | True          
[INFO] 2024-02-25   |          2.4 |              2.6 |          0.2 | True          
[INFO] 2024-04-25   |         -2.5 |             -3.1 |         -0.6 | False         
[INFO] 2024-06-25   |          2.6 |              3.0 |          0.4 | True          
[INFO] 2024-08-25   |         -3.7 |             -3.1 |          0.6 | True          
[INFO] 2024-10-25   |          0.8 |             -1.0 |         -1.8 | False         
[INFO] 2024-12-25   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-06-25, 2023-08-25, 2024-12-25
[INFO] 
Total periods before exclusion: 17
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 7 of 14 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for TEN...
[INFO] Excel file updated successfully. Added TEN with Kmeans win rate 50.0% in row 46
[INFO] Added best Sharpe parameters 58/76 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 76
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/74) - Original Sharpe: 0.8244
[INFO] Added cluster 2 to portfolio: SMA(48/108) - Original Sharpe: 0.6913
[INFO] Added cluster 3 to portfolio: SMA(16/30) - Original Sharpe: 0.4645
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TEN_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3273
[INFO] Kmeans Best out-of-sample Sharpe: -0.8139
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for TEN...
[INFO] Excel file updated successfully. Added TEN with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TEN
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5303 to 1.2626
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 76
[INFO] Sharpe Ratio: 1.262627
[INFO] Number of Trades: 37
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9144 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5303 to 1.2626
[INFO] Trades range: 10.0 to 263.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3303 to 2.6446
[INFO] Scaled Long SMA range: -2.7069 to 1.6060
[INFO] Scaled Sharpe ratio range: -2.5233 to 3.4723
[INFO] Scaled Trades range: -0.7128 to 16.0622
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9144 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6785
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 13
[INFO] Using 13 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 13 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1852 elements
[INFO] Cluster 1: 1234 elements
[INFO] Cluster 2: 1526 elements
[INFO] Cluster 3: 26 elements
[INFO] Cluster 4: 895 elements
[INFO] Cluster 5: 1332 elements
[INFO] Cluster 6: 742 elements
[INFO] Cluster 7: 544 elements
[INFO] Cluster 8: 76 elements
[INFO] Cluster 9: 584 elements
[INFO] Cluster 10: 168 elements
[INFO] Cluster 11: 43 elements
[INFO] Cluster 12: 122 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=188, Long SMA=248, Sharpe=0.0139, Trades=13
[INFO] Cluster 1 cluster: Short SMA=90, Long SMA=142, Sharpe=0.0038, Trades=21
[INFO] Cluster 2 cluster: Short SMA=124, Long SMA=204, Sharpe=0.1614, Trades=14
[INFO] Cluster 3 cluster: Short SMA=24, Long SMA=26, Sharpe=0.4344, Trades=175
[INFO] Cluster 4 cluster: Short SMA=38, Long SMA=84, Sharpe=0.8337, Trades=29
[INFO] Cluster 5 cluster: Short SMA=44, Long SMA=210, Sharpe=0.3049, Trades=15
[INFO] Cluster 6 cluster: Short SMA=34, Long SMA=138, Sharpe=0.4537, Trades=21
[INFO] Cluster 7 cluster: Short SMA=254, Long SMA=282, Sharpe=0.0447, Trades=15
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=32, Sharpe=0.5727, Trades=96
[INFO] Cluster 9 cluster: Short SMA=36, Long SMA=272, Sharpe=0.2405, Trades=11
[INFO] Cluster 10 cluster: Short SMA=30, Long SMA=44, Sharpe=0.8697, Trades=61
[INFO] Cluster 11 cluster: Short SMA=130, Long SMA=132, Sharpe=-0.0789, Trades=72
[INFO] Cluster 12 cluster: Short SMA=220, Long SMA=224, Sharpe=-0.1355, Trades=34
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=76, Sharpe=1.2626, Trades=37
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=30, Long SMA=44, Sharpe=0.8697, Trades=61
[INFO] Top 2: Short SMA=38, Long SMA=84, Sharpe=0.8337, Trades=29
[INFO] Top 3: Short SMA=26, Long SMA=32, Sharpe=0.5727, Trades=96
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 9144 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 76
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(30/44) - Original Sharpe: 0.8697, Trades: 61
[INFO] Hierarchical cluster 2: SMA(38/84) - Original Sharpe: 0.8337, Trades: 29
[INFO] Hierarchical cluster 3: SMA(26/32) - Original Sharpe: 0.5727, Trades: 96
[INFO] Hierarchical cluster 4: SMA(34/138) - Original Sharpe: 0.4537, Trades: 21
[INFO] Hierarchical cluster 5: SMA(24/26) - Original Sharpe: 0.4344, Trades: 175
[INFO] Trimmed warm-up period. Evaluation data length: 2318
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/76)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (30/44) - Sharpe: 0.8697
[INFO] cluster 2: (38/84) - Sharpe: 0.8337
[INFO] cluster 3: (26/32) - Sharpe: 0.5727
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Out-of-sample period starts on: 2022-04-25
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2022-04-25 2022-04-25            45     0.869705           -0.087896
1    2022-06-25 2022-06-25            43    -0.666869           -3.149866
2    2022-08-25 2022-08-25            43    -1.133345            3.153218
3    2022-10-25 2022-10-25            44    -2.239033           -4.256258
4    2022-12-25 2022-12-25            43    -3.070652           -0.434751
5    2023-02-25 2023-02-25            41    -3.791965           -2.481072
6    2023-04-25 2023-04-25            44    -2.516428            0.262345
7    2023-06-25 2023-06-25            44     2.949798            2.949798
8    2023-08-25 2023-08-25            43     3.401253            3.401253
9    2023-10-25 2023-10-25            43    -4.105859           -1.123827
10   2023-12-25 2023-12-25            43    -3.479188           -1.909067
11   2024-02-25 2024-02-25            42     2.392603            2.500044
12   2024-04-25 2024-04-25            43    -2.501372           -2.078131
13   2024-06-25 2024-06-25            44     2.619489            2.473731
14   2024-08-25 2024-08-25            44    -3.660489           -2.802540
15   2024-10-25 2024-10-25            43     0.789016            0.883394
16   2024-12-25 2024-12-25             4    -0.779051           -0.779051
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2022-04-25   |          0.9 |             -0.1 |         -1.0 | False         
[INFO] 2022-06-25   |         -0.7 |             -3.1 |         -2.4 | False         
[INFO] 2022-08-25   |         -1.1 |              3.2 |          4.3 | True          
[INFO] 2022-10-25   |         -2.2 |             -4.3 |         -2.1 | False         
[INFO] 2022-12-25   |         -3.1 |             -0.4 |          2.7 | True          
[INFO] 2023-02-25   |         -3.8 |             -2.5 |          1.3 | True          
[INFO] 2023-04-25   |         -2.5 |              0.3 |          2.8 | True          
[INFO] 2023-06-25   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-08-25   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-10-25   |         -4.1 |             -1.1 |          3.0 | True          
[INFO] 2023-12-25   |         -3.5 |             -1.9 |          1.6 | True          
[INFO] 2024-02-25   |          2.4 |              2.5 |          0.1 | True          
[INFO] 2024-04-25   |         -2.5 |             -2.1 |          0.4 | True          
[INFO] 2024-06-25   |          2.6 |              2.5 |         -0.1 | False         
[INFO] 2024-08-25   |         -3.7 |             -2.8 |          0.9 | True          
[INFO] 2024-10-25   |          0.8 |              0.9 |          0.1 | True          
[INFO] 2024-12-25   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-06-25, 2023-08-25, 2024-12-25
[INFO] 
Total periods before exclusion: 17
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 14 periods (71.43% win rate)
[INFO] Updating Excel file with Hierarchical results for TEN...
[INFO] Excel file updated successfully. Added TEN with Hierarchical win rate 71.4% in row 46
[INFO] Added best Sharpe parameters 58/76 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 76
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(30/44) - Original Sharpe: 0.8697
[INFO] Added cluster 2 to portfolio: SMA(38/84) - Original Sharpe: 0.8337
[INFO] Added cluster 3 to portfolio: SMA(26/32) - Original Sharpe: 0.5727
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TEN_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0695
[INFO] Hierarchical Best out-of-sample Sharpe: -0.8139
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for TEN...
[INFO] Excel file updated successfully. Added TEN with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TEN
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for TY in column D: 18.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 174.25s
[INFO] Best parameters: Short SMA = 56, Long SMA = 82
[INFO] Best Sharpe ratio: 1.031512, Trades: 33
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_TY_best_56/82 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @TY
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 11.36 contracts
[INFO] Maximum Position Size: 20 contracts
[INFO] Strategy Total P&L: $283,342.50
[INFO] Market Buy & Hold P&L: $-4,734.38
[INFO] Outperformance: $288,076.88
[INFO] Sharpe ratio (entire period, annualized): 0.579425
[INFO] Sharpe ratio (in-sample, annualized): 1.031512
[INFO] Sharpe ratio (out-of-sample, annualized): -0.443143
[INFO] Maximum Drawdown: $211,316.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 22
[INFO] Out-of-sample period trades: 11
[INFO] Total trades: 33
[INFO] In-sample P&L: $541,716.12
[INFO] Out-of-sample P&L: $-102,735.12
[INFO] 
Best parameters from GA: Short SMA = 56, Long SMA = 82, Sharpe = 1.031512
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] 
Best parameters:
[INFO] Short SMA: 56
[INFO] Long SMA: 82
[INFO] Sharpe Ratio: 1.031512
[INFO] Number of Trades: 33
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8851 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] Trades range: 10.0 to 328.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2970 to 2.7663
[INFO] Scaled Long SMA range: -2.7173 to 1.6949
[INFO] Scaled Sharpe ratio range: -2.9375 to 3.3040
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 18
[INFO] Using 18 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=18...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 582 elements
[INFO] Kmeans Cluster 1: 410 elements
[INFO] Kmeans Cluster 2: 423 elements
[INFO] Kmeans Cluster 3: 433 elements
[INFO] Kmeans Cluster 4: 505 elements
[INFO] Kmeans Cluster 5: 767 elements
[INFO] Kmeans Cluster 6: 443 elements
[INFO] Kmeans Cluster 7: 688 elements
[INFO] Kmeans Cluster 8: 652 elements
[INFO] Kmeans Cluster 9: 423 elements
[INFO] Kmeans Cluster 10: 404 elements
[INFO] Kmeans Cluster 11: 500 elements
[INFO] Kmeans Cluster 12: 725 elements
[INFO] Kmeans Cluster 13: 200 elements
[INFO] Kmeans Cluster 14: 400 elements
[INFO] Kmeans Cluster 15: 585 elements
[INFO] Kmeans Cluster 16: 543 elements
[INFO] Kmeans Cluster 17: 168 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=163.92, Long SMA=214.82, Sharpe=0.0462
[INFO] Centroid 1: Short SMA=25.06, Long SMA=203.61, Sharpe=0.4721
[INFO] Centroid 2: Short SMA=68.50, Long SMA=113.13, Sharpe=0.2414
[INFO] Centroid 3: Short SMA=210.59, Long SMA=236.17, Sharpe=-0.0591
[INFO] Centroid 4: Short SMA=27.24, Long SMA=143.96, Sharpe=0.4357
[INFO] Centroid 5: Short SMA=120.88, Long SMA=209.84, Sharpe=0.3059
[INFO] Centroid 6: Short SMA=251.62, Long SMA=281.00, Sharpe=-0.0563
[INFO] Centroid 7: Short SMA=58.46, Long SMA=237.69, Sharpe=0.3802
[INFO] Centroid 8: Short SMA=85.01, Long SMA=143.39, Sharpe=0.0296
[INFO] Centroid 9: Short SMA=115.94, Long SMA=151.58, Sharpe=0.1795
[INFO] Centroid 10: Short SMA=39.30, Long SMA=83.66, Sharpe=0.6785
[INFO] Centroid 11: Short SMA=36.88, Long SMA=80.43, Sharpe=0.4773
[INFO] Centroid 12: Short SMA=180.58, Long SMA=255.60, Sharpe=-0.1725
[INFO] Centroid 13: Short SMA=21.81, Long SMA=39.55, Sharpe=0.0883
[INFO] Centroid 14: Short SMA=135.14, Long SMA=176.02, Sharpe=0.4718
[INFO] Centroid 15: Short SMA=58.98, Long SMA=187.40, Sharpe=0.3025
[INFO] Centroid 16: Short SMA=27.38, Long SMA=271.59, Sharpe=0.2474
[INFO] Centroid 17: Short SMA=242.40, Long SMA=261.10, Sharpe=-0.3088
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=56, Long SMA=82, Sharpe=1.0315, Trades=33
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=40, Long SMA=82, Sharpe=0.7350, Trades=31
[INFO] Kmeans Top 2: Short SMA=24, Long SMA=204, Sharpe=0.6803, Trades=22
[INFO] Kmeans Top 3: Short SMA=136, Long SMA=174, Sharpe=0.6613, Trades=21
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=86, Sharpe=0.5529, Trades=31
[INFO] Kmeans Top 5: Short SMA=28, Long SMA=144, Sharpe=0.4568, Trades=25
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17}
[INFO]   Rounded: (164, 215)
[INFO]   Nearest: (164.0, 214.0)
[INFO]   Rounded: (25, 204)
[INFO]   Nearest: (26.0, 204.0)
[INFO]   Rounded: (68, 113)
[INFO]   Nearest: (68.0, 114.0)
[INFO]   Rounded: (211, 236)
[INFO]   Nearest: (210.0, 236.0)
[INFO]   Rounded: (27, 144)
[INFO]   Nearest: (28.0, 144.0)
[INFO]   Rounded: (121, 210)
[INFO]   Nearest: (120.0, 210.0)
[INFO]   Rounded: (252, 281)
[INFO]   Nearest: (252.0, 282.0)
[INFO]   Rounded: (58, 238)
[INFO]   Rounded: (85, 143)
[INFO]   Nearest: (86.0, 144.0)
[INFO]   Rounded: (116, 152)
[INFO]   Rounded: (39, 84)
[INFO]   Nearest: (40.0, 84.0)
[INFO]   Rounded: (37, 80)
[INFO]   Nearest: (36.0, 80.0)
[INFO]   Rounded: (181, 256)
[INFO]   Nearest: (180.0, 256.0)
[INFO]   Rounded: (22, 40)
[INFO]   Rounded: (135, 176)
[INFO]   Nearest: (136.0, 176.0)
[INFO]   Rounded: (59, 187)
[INFO]   Nearest: (58.0, 188.0)
[INFO]   Rounded: (27, 272)
[INFO]   Nearest: (28.0, 272.0)
[INFO]   Rounded: (242, 261)
[INFO]   Nearest: (242.0, 262.0)
[INFO] Successfully plotted 18 out of 18 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 56, Long SMA: 82
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(40/82) - Original Sharpe: 0.7350, Trades: 31
[INFO] Kmeans cluster 2: SMA(24/204) - Original Sharpe: 0.6803, Trades: 22
[INFO] Kmeans cluster 3: SMA(136/174) - Original Sharpe: 0.6613, Trades: 21
[INFO] Kmeans cluster 4: SMA(36/86) - Original Sharpe: 0.5529, Trades: 31
[INFO] Kmeans cluster 5: SMA(28/144) - Original Sharpe: 0.4568, Trades: 25
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (56/82)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (40/82) - Sharpe: 0.7350
[INFO] cluster 2: (24/204) - Sharpe: 0.6803
[INFO] cluster 3: (136/174) - Sharpe: 0.6613
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.704271           -3.282225
1    2021-11-14 2021-11-14            43     0.838842            0.838842
2    2022-01-14 2022-01-14            41     1.984191            1.765231
3    2022-03-14 2022-03-14            44     4.120920            4.120920
4    2022-05-14 2022-05-14            43     0.411261            0.411261
5    2022-07-14 2022-07-14            44     0.308673            0.609152
6    2022-09-14 2022-09-14            43    -1.526198            1.448915
7    2022-11-14 2022-11-14            43    -1.104580           -1.063430
8    2023-01-14 2023-01-14            41    -5.413014           -1.984568
9    2023-03-14 2023-03-14            44    -1.314612           -0.857945
10   2023-05-14 2023-05-14            44    -1.913035           -4.378408
11   2023-07-14 2023-07-14            44     3.093754            3.093754
12   2023-09-14 2023-09-14            43     2.065825            2.065825
13   2023-11-14 2023-11-14            42    -3.774049           -3.843024
14   2024-01-14 2024-01-14            43    -1.733531           -1.286705
15   2024-03-14 2024-03-14            42     0.586636            2.950920
16   2024-05-14 2024-05-14            44    -1.885239           -0.633388
17   2024-07-14 2024-07-14            45     3.577993            4.079337
18   2024-09-14 2024-09-14            43    -4.939107           -5.404306
19   2024-11-14 2024-11-14            33     1.144905            1.144905
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.7 |             -3.3 |         -0.6 | False         
[INFO] 2021-11-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-01-14   |          2.0 |              1.8 |         -0.2 | False         
[INFO] 2022-03-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.3 |              0.6 |          0.3 | True          
[INFO] 2022-09-14   |         -1.5 |              1.4 |          2.9 | True          
[INFO] 2022-11-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -5.4 |             -2.0 |          3.4 | True          
[INFO] 2023-03-14   |         -1.3 |             -0.9 |          0.4 | True          
[INFO] 2023-05-14   |         -1.9 |             -4.4 |         -2.5 | False         
[INFO] 2023-07-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.8 |             -3.8 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -1.7 |             -1.3 |          0.4 | True          
[INFO] 2024-03-14   |          0.6 |              3.0 |          2.4 | True          
[INFO] 2024-05-14   |         -1.9 |             -0.6 |          1.3 | True          
[INFO] 2024-07-14   |          3.6 |              4.1 |          0.5 | True          
[INFO] 2024-09-14   |         -4.9 |             -5.4 |         -0.5 | False         
[INFO] 2024-11-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-03-14, 2022-05-14, 2022-11-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 8 of 12 periods (66.67% win rate)
[INFO] Updating Excel file with Kmeans results for TY...
[INFO] Excel file updated successfully. Added TY with Kmeans win rate 66.7% in row 47
[INFO] Added best Sharpe parameters 56/82 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 56, Long SMA: 82
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(40/82) - Original Sharpe: 0.7350
[INFO] Added cluster 2 to portfolio: SMA(24/204) - Original Sharpe: 0.6803
[INFO] Added cluster 3 to portfolio: SMA(136/174) - Original Sharpe: 0.6613
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TY_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1509
[INFO] Kmeans Best out-of-sample Sharpe: -0.4431
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for TY...
[INFO] Excel file updated successfully. Added TY with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TY
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] 
Best parameters:
[INFO] Short SMA: 56
[INFO] Long SMA: 82
[INFO] Sharpe Ratio: 1.031512
[INFO] Number of Trades: 33
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8851 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] Trades range: 10.0 to 328.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2970 to 2.7663
[INFO] Scaled Long SMA range: -2.7173 to 1.6949
[INFO] Scaled Sharpe ratio range: -2.9375 to 3.3040
[INFO] Scaled Trades range: -0.7511 to 15.9532
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8851 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5979
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 834 elements
[INFO] Cluster 1: 594 elements
[INFO] Cluster 2: 847 elements
[INFO] Cluster 3: 607 elements
[INFO] Cluster 4: 145 elements
[INFO] Cluster 5: 1110 elements
[INFO] Cluster 6: 646 elements
[INFO] Cluster 7: 27 elements
[INFO] Cluster 8: 753 elements
[INFO] Cluster 9: 900 elements
[INFO] Cluster 10: 535 elements
[INFO] Cluster 11: 114 elements
[INFO] Cluster 12: 453 elements
[INFO] Cluster 13: 51 elements
[INFO] Cluster 14: 199 elements
[INFO] Cluster 15: 289 elements
[INFO] Cluster 16: 747 elements
[INFO] Using 17 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=184, Long SMA=216, Sharpe=0.0152, Trades=19
[INFO] Cluster 1 cluster: Short SMA=248, Long SMA=276, Sharpe=-0.0633, Trades=18
[INFO] Cluster 2 cluster: Short SMA=80, Long SMA=160, Sharpe=-0.0797, Trades=19
[INFO] Cluster 3 cluster: Short SMA=102, Long SMA=128, Sharpe=0.0767, Trades=31
[INFO] Cluster 4 cluster: Short SMA=36, Long SMA=44, Sharpe=0.3151, Trades=82
[INFO] Cluster 5 cluster: Short SMA=62, Long SMA=228, Sharpe=0.3867, Trades=14
[INFO] Cluster 6 cluster: Short SMA=34, Long SMA=82, Sharpe=0.5871, Trades=32
[INFO] Cluster 7 cluster: Short SMA=16, Long SMA=20, Sharpe=0.0002, Trades=194
[INFO] Cluster 8 cluster: Short SMA=122, Long SMA=210, Sharpe=0.3349, Trades=15
[INFO] Cluster 9 cluster: Short SMA=182, Long SMA=254, Sharpe=-0.1733, Trades=12
[INFO] Cluster 10 cluster: Short SMA=38, Long SMA=124, Sharpe=0.3679, Trades=25
[INFO] Cluster 11 cluster: Short SMA=130, Long SMA=134, Sharpe=0.0939, Trades=64
[INFO] Cluster 12 cluster: Short SMA=22, Long SMA=272, Sharpe=0.2313, Trades=16
[INFO] Cluster 13 cluster: Short SMA=20, Long SMA=28, Sharpe=-0.2267, Trades=126
[INFO] Cluster 14 cluster: Short SMA=28, Long SMA=62, Sharpe=0.4531, Trades=54
[INFO] Cluster 15 cluster: Short SMA=138, Long SMA=174, Sharpe=0.5894, Trades=23
[INFO] Cluster 16 cluster: Short SMA=28, Long SMA=186, Sharpe=0.4640, Trades=22
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=56, Long SMA=82, Sharpe=1.0315, Trades=33
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=138, Long SMA=174, Sharpe=0.5894, Trades=23
[INFO] Top 2: Short SMA=34, Long SMA=82, Sharpe=0.5871, Trades=32
[INFO] Top 3: Short SMA=28, Long SMA=186, Sharpe=0.4640, Trades=22
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 17 valid clusters with clusters
[INFO] Filtering to 8851 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 56, Long SMA: 82
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(138/174) - Original Sharpe: 0.5894, Trades: 23
[INFO] Hierarchical cluster 2: SMA(34/82) - Original Sharpe: 0.5871, Trades: 32
[INFO] Hierarchical cluster 3: SMA(28/186) - Original Sharpe: 0.4640, Trades: 22
[INFO] Hierarchical cluster 4: SMA(28/62) - Original Sharpe: 0.4531, Trades: 54
[INFO] Hierarchical cluster 5: SMA(62/228) - Original Sharpe: 0.3867, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (56/82)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (138/174) - Sharpe: 0.5894
[INFO] cluster 2: (34/82) - Sharpe: 0.5871
[INFO] cluster 3: (28/186) - Sharpe: 0.4640
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.704271           -3.542007
1    2021-11-14 2021-11-14            43     0.838842            0.838842
2    2022-01-14 2022-01-14            41     1.984191            1.765231
3    2022-03-14 2022-03-14            44     4.120920            4.120920
4    2022-05-14 2022-05-14            43     0.411261            0.411261
5    2022-07-14 2022-07-14            44     0.308673            0.167387
6    2022-09-14 2022-09-14            43    -1.526198            1.692498
7    2022-11-14 2022-11-14            43    -1.104580           -1.252937
8    2023-01-14 2023-01-14            41    -5.413014           -2.370189
9    2023-03-14 2023-03-14            44    -1.314612           -0.869019
10   2023-05-14 2023-05-14            44    -1.913035           -3.700008
11   2023-07-14 2023-07-14            44     3.093754            3.093754
12   2023-09-14 2023-09-14            43     2.065825            2.065825
13   2023-11-14 2023-11-14            42    -3.774049           -2.710225
14   2024-01-14 2024-01-14            43    -1.733531           -1.116063
15   2024-03-14 2024-03-14            42     0.586636            3.220235
16   2024-05-14 2024-05-14            44    -1.885239           -2.703840
17   2024-07-14 2024-07-14            45     3.577993            0.204856
18   2024-09-14 2024-09-14            43    -4.939107           -5.322641
19   2024-11-14 2024-11-14            33     1.144905            1.144905
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.7 |             -3.5 |         -0.8 | False         
[INFO] 2021-11-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-01-14   |          2.0 |              1.8 |         -0.2 | False         
[INFO] 2022-03-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.3 |              0.2 |         -0.1 | False         
[INFO] 2022-09-14   |         -1.5 |              1.7 |          3.2 | True          
[INFO] 2022-11-14   |         -1.1 |             -1.3 |         -0.2 | False         
[INFO] 2023-01-14   |         -5.4 |             -2.4 |          3.0 | True          
[INFO] 2023-03-14   |         -1.3 |             -0.9 |          0.4 | True          
[INFO] 2023-05-14   |         -1.9 |             -3.7 |         -1.8 | False         
[INFO] 2023-07-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.8 |             -2.7 |          1.1 | True          
[INFO] 2024-01-14   |         -1.7 |             -1.1 |          0.6 | True          
[INFO] 2024-03-14   |          0.6 |              3.2 |          2.6 | True          
[INFO] 2024-05-14   |         -1.9 |             -2.7 |         -0.8 | False         
[INFO] 2024-07-14   |          3.6 |              0.2 |         -3.4 | False         
[INFO] 2024-09-14   |         -4.9 |             -5.3 |         -0.4 | False         
[INFO] 2024-11-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 14 periods (42.86% win rate)
[INFO] Updating Excel file with Hierarchical results for TY...
[INFO] Excel file updated successfully. Added TY with Hierarchical win rate 42.9% in row 47
[INFO] Added best Sharpe parameters 56/82 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 56, Long SMA: 82
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(138/174) - Original Sharpe: 0.5894
[INFO] Added cluster 2 to portfolio: SMA(34/82) - Original Sharpe: 0.5871
[INFO] Added cluster 3 to portfolio: SMA(28/186) - Original Sharpe: 0.4640
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TY_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1178
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4431
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for TY...
[INFO] Excel file updated successfully. Added TY with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TY
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for TU in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 167.33s
[INFO] Best parameters: Short SMA = 274, Long SMA = 284
[INFO] Best Sharpe ratio: 0.774149, Trades: 18
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_TU_best_274/284 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @TU
[INFO] Big Point Value (from data): 2000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 36.04 contracts
[INFO] Maximum Position Size: 152 contracts
[INFO] Strategy Total P&L: $685,372.50
[INFO] Market Buy & Hold P&L: $-12,695.31
[INFO] Outperformance: $698,067.81
[INFO] Sharpe ratio (entire period, annualized): 0.880451
[INFO] Sharpe ratio (in-sample, annualized): 0.774149
[INFO] Sharpe ratio (out-of-sample, annualized): 1.105817
[INFO] Maximum Drawdown: $100,651.25
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 16
[INFO] Out-of-sample period trades: 2
[INFO] Total trades: 18
[INFO] In-sample P&L: $401,453.44
[INFO] Out-of-sample P&L: $274,450.31
[INFO] 
Best parameters from GA: Short SMA = 274, Long SMA = 284, Sharpe = 0.774149
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 2000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9208 to 0.7741
[INFO] 
Best parameters:
[INFO] Short SMA: 274
[INFO] Long SMA: 284
[INFO] Sharpe Ratio: 0.774149
[INFO] Number of Trades: 18
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7800 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9208 to 0.7741
[INFO] Trades range: 10.0 to 366.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2341 to 2.7587
[INFO] Scaled Long SMA range: -2.5984 to 1.8280
[INFO] Scaled Sharpe ratio range: -5.1407 to 2.7922
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 577 elements
[INFO] Kmeans Cluster 1: 377 elements
[INFO] Kmeans Cluster 2: 437 elements
[INFO] Kmeans Cluster 3: 586 elements
[INFO] Kmeans Cluster 4: 541 elements
[INFO] Kmeans Cluster 5: 681 elements
[INFO] Kmeans Cluster 6: 706 elements
[INFO] Kmeans Cluster 7: 390 elements
[INFO] Kmeans Cluster 8: 584 elements
[INFO] Kmeans Cluster 9: 263 elements
[INFO] Kmeans Cluster 10: 460 elements
[INFO] Kmeans Cluster 11: 457 elements
[INFO] Kmeans Cluster 12: 676 elements
[INFO] Kmeans Cluster 13: 249 elements
[INFO] Kmeans Cluster 14: 371 elements
[INFO] Kmeans Cluster 15: 445 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=114.16, Long SMA=175.50, Sharpe=0.1620
[INFO] Centroid 1: Short SMA=45.37, Long SMA=78.41, Sharpe=-0.1980
[INFO] Centroid 2: Short SMA=237.43, Long SMA=269.84, Sharpe=0.2590
[INFO] Centroid 3: Short SMA=37.08, Long SMA=215.28, Sharpe=0.3011
[INFO] Centroid 4: Short SMA=30.25, Long SMA=275.12, Sharpe=0.3287
[INFO] Centroid 5: Short SMA=36.63, Long SMA=143.59, Sharpe=0.2051
[INFO] Centroid 6: Short SMA=162.39, Long SMA=215.69, Sharpe=0.2214
[INFO] Centroid 7: Short SMA=59.01, Long SMA=103.27, Sharpe=0.3780
[INFO] Centroid 8: Short SMA=94.91, Long SMA=137.42, Sharpe=0.0351
[INFO] Centroid 9: Short SMA=261.34, Long SMA=282.34, Sharpe=0.4507
[INFO] Centroid 10: Short SMA=122.68, Long SMA=204.90, Sharpe=0.3885
[INFO] Centroid 11: Short SMA=41.90, Long SMA=92.74, Sharpe=0.0772
[INFO] Centroid 12: Short SMA=56.52, Long SMA=181.24, Sharpe=0.0827
[INFO] Centroid 13: Short SMA=22.09, Long SMA=45.55, Sharpe=-0.4865
[INFO] Centroid 14: Short SMA=135.18, Long SMA=183.82, Sharpe=-0.0489
[INFO] Centroid 15: Short SMA=205.31, Long SMA=235.47, Sharpe=0.4163
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=18
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=262, Long SMA=282, Sharpe=0.4323, Trades=16
[INFO] Kmeans Top 2: Short SMA=36, Long SMA=216, Sharpe=0.3637, Trades=15
[INFO] Kmeans Top 3: Short SMA=236, Long SMA=266, Sharpe=0.3289, Trades=11
[INFO] Kmeans Top 4: Short SMA=206, Long SMA=236, Sharpe=0.3240, Trades=17
[INFO] Kmeans Top 5: Short SMA=120, Long SMA=212, Sharpe=0.2983, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (114, 175)
[INFO]   Nearest: (114.0, 176.0)
[INFO]   Rounded: (45, 78)
[INFO]   Nearest: (46.0, 78.0)
[INFO]   Rounded: (237, 270)
[INFO]   Nearest: (238.0, 270.0)
[INFO]   Rounded: (37, 215)
[INFO]   Nearest: (38.0, 216.0)
[INFO]   Rounded: (30, 275)
[INFO]   Nearest: (30.0, 276.0)
[INFO]   Rounded: (37, 144)
[INFO]   Nearest: (36.0, 144.0)
[INFO]   Rounded: (162, 216)
[INFO]   Rounded: (59, 103)
[INFO]   Nearest: (60.0, 104.0)
[INFO]   Rounded: (95, 137)
[INFO]   Nearest: (94.0, 138.0)
[INFO]   Rounded: (261, 282)
[INFO]   Nearest: (262.0, 282.0)
[INFO]   Rounded: (123, 205)
[INFO]   Nearest: (122.0, 204.0)
[INFO]   Rounded: (42, 93)
[INFO]   Nearest: (42.0, 92.0)
[INFO]   Rounded: (57, 181)
[INFO]   Nearest: (56.0, 182.0)
[INFO]   Rounded: (22, 46)
[INFO]   Rounded: (135, 184)
[INFO]   Nearest: (136.0, 184.0)
[INFO]   Rounded: (205, 235)
[INFO]   Nearest: (206.0, 236.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 274, Long SMA: 284
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(262/282) - Original Sharpe: 0.4323, Trades: 16
[INFO] Kmeans cluster 2: SMA(36/216) - Original Sharpe: 0.3637, Trades: 15
[INFO] Kmeans cluster 3: SMA(236/266) - Original Sharpe: 0.3289, Trades: 11
[INFO] Kmeans cluster 4: SMA(206/236) - Original Sharpe: 0.3240, Trades: 17
[INFO] Kmeans cluster 5: SMA(120/212) - Original Sharpe: 0.2983, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (274/284)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (262/282) - Sharpe: 0.4323
[INFO] cluster 2: (36/216) - Sharpe: 0.3637
[INFO] cluster 3: (236/266) - Sharpe: 0.3289
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     5.346901            5.346901
1    2021-11-14 2021-11-14            43     1.829328            1.829328
2    2022-01-14 2022-01-14            41     4.222575            4.222575
3    2022-03-14 2022-03-14            44     3.242182            3.242182
4    2022-05-14 2022-05-14            43     1.473801            1.473801
5    2022-07-14 2022-07-14            44     2.919931            2.919931
6    2022-09-14 2022-09-14            43     2.385425            2.385425
7    2022-11-14 2022-11-14            43    -0.436907           -0.436907
8    2023-01-14 2023-01-14            41    -0.202608           -0.202608
9    2023-03-14 2023-03-14            44     0.324596            0.324596
10   2023-05-14 2023-05-14            44     3.890567            3.890567
11   2023-07-14 2023-07-14            44     3.021284            3.021284
12   2023-09-14 2023-09-14            43     1.135707            1.135707
13   2023-11-14 2023-11-14            42    -3.433823           -3.433823
14   2024-01-14 2024-01-14            43     3.467114            2.248509
15   2024-03-14 2024-03-14            42     2.327772            2.327772
16   2024-05-14 2024-05-14            44    -2.234806           -2.234806
17   2024-07-14 2024-07-14            45    -3.677302           -2.358057
18   2024-09-14 2024-09-14            43     0.511850           -5.642739
19   2024-11-14 2024-11-14            33    -2.294343            1.862406
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          5.3 |              5.3 |          0.0 | Excluded      
[INFO] 2021-11-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2022-01-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.2 |              3.2 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2023-07-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.4 |             -3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.5 |              2.2 |         -1.3 | False         
[INFO] 2024-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -3.7 |             -2.4 |          1.3 | True          
[INFO] 2024-09-14   |          0.5 |             -5.6 |         -6.1 | False         
[INFO] 2024-11-14   |         -2.3 |              1.9 |          4.2 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-03-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 4
[INFO] Kmeans cluster wins (rounded comparison): 2 of 4 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for TU...
[INFO] Excel file updated successfully. Added TU with Kmeans win rate 50.0% in row 48
[INFO] Added best Sharpe parameters 274/284 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 274, Long SMA: 284
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(262/282) - Original Sharpe: 0.4323
[INFO] Added cluster 2 to portfolio: SMA(36/216) - Original Sharpe: 0.3637
[INFO] Added cluster 3 to portfolio: SMA(236/266) - Original Sharpe: 0.3289
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TU_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 1.0007
[INFO] Kmeans Best out-of-sample Sharpe: 1.1058
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for TU...
[INFO] Excel file updated successfully. Added TU with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TU
[INFO] Big Point Value: 2000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9208 to 0.7741
[INFO] 
Best parameters:
[INFO] Short SMA: 274
[INFO] Long SMA: 284
[INFO] Sharpe Ratio: 0.774149
[INFO] Number of Trades: 18
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7800 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9208 to 0.7741
[INFO] Trades range: 10.0 to 366.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2341 to 2.7587
[INFO] Scaled Long SMA range: -2.5984 to 1.8280
[INFO] Scaled Sharpe ratio range: -5.1407 to 2.7922
[INFO] Scaled Trades range: -0.6610 to 14.6335
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 7800 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6561
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 13
[INFO] Using 13 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 13 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 979 elements
[INFO] Cluster 1: 1168 elements
[INFO] Cluster 2: 1062 elements
[INFO] Cluster 3: 355 elements
[INFO] Cluster 4: 272 elements
[INFO] Cluster 5: 965 elements
[INFO] Cluster 6: 564 elements
[INFO] Cluster 7: 1097 elements
[INFO] Cluster 8: 20 elements
[INFO] Cluster 9: 53 elements
[INFO] Cluster 10: 830 elements
[INFO] Cluster 11: 315 elements
[INFO] Cluster 12: 120 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=46, Long SMA=106, Sharpe=0.2675, Trades=27
[INFO] Cluster 1 cluster: Short SMA=30, Long SMA=248, Sharpe=0.3841, Trades=11
[INFO] Cluster 2 cluster: Short SMA=230, Long SMA=262, Sharpe=0.2240, Trades=13
[INFO] Cluster 3 cluster: Short SMA=28, Long SMA=56, Sharpe=-0.2366, Trades=60
[INFO] Cluster 4 cluster: Short SMA=178, Long SMA=188, Sharpe=-0.0147, Trades=42
[INFO] Cluster 5 cluster: Short SMA=106, Long SMA=188, Sharpe=0.0300, Trades=14
[INFO] Cluster 6 cluster: Short SMA=106, Long SMA=148, Sharpe=0.0735, Trades=20
[INFO] Cluster 7 cluster: Short SMA=46, Long SMA=164, Sharpe=0.1164, Trades=17
[INFO] Cluster 8 cluster: Short SMA=24, Long SMA=26, Sharpe=-0.4659, Trades=224
[INFO] Cluster 9 cluster: Short SMA=94, Long SMA=96, Sharpe=-0.0687, Trades=125
[INFO] Cluster 10 cluster: Short SMA=152, Long SMA=216, Sharpe=0.1412, Trades=12
[INFO] Cluster 11 cluster: Short SMA=40, Long SMA=88, Sharpe=-0.0279, Trades=35
[INFO] Cluster 12 cluster: Short SMA=22, Long SMA=32, Sharpe=-0.5151, Trades=105
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=18
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=30, Long SMA=248, Sharpe=0.3841, Trades=11
[INFO] Top 2: Short SMA=46, Long SMA=106, Sharpe=0.2675, Trades=27
[INFO] Top 3: Short SMA=230, Long SMA=262, Sharpe=0.2240, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 7800 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 274, Long SMA: 284
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(30/248) - Original Sharpe: 0.3841, Trades: 11
[INFO] Hierarchical cluster 2: SMA(46/106) - Original Sharpe: 0.2675, Trades: 27
[INFO] Hierarchical cluster 3: SMA(230/262) - Original Sharpe: 0.2240, Trades: 13
[INFO] Hierarchical cluster 4: SMA(152/216) - Original Sharpe: 0.1412, Trades: 12
[INFO] Hierarchical cluster 5: SMA(46/164) - Original Sharpe: 0.1164, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (274/284)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (30/248) - Sharpe: 0.3841
[INFO] cluster 2: (46/106) - Sharpe: 0.2675
[INFO] cluster 3: (230/262) - Sharpe: 0.2240
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     5.346901            2.812369
1    2021-11-14 2021-11-14            43     1.829328            1.829328
2    2022-01-14 2022-01-14            41     4.222575            4.222575
3    2022-03-14 2022-03-14            44     3.242182            3.242182
4    2022-05-14 2022-05-14            43     1.473801            1.473801
5    2022-07-14 2022-07-14            44     2.919931            2.919931
6    2022-09-14 2022-09-14            43     2.385425            2.385425
7    2022-11-14 2022-11-14            43    -0.436907           -0.436907
8    2023-01-14 2023-01-14            41    -0.202608           -1.179572
9    2023-03-14 2023-03-14            44     0.324596            0.527258
10   2023-05-14 2023-05-14            44     3.890567            2.324500
11   2023-07-14 2023-07-14            44     3.021284            3.021284
12   2023-09-14 2023-09-14            43     1.135707            1.135707
13   2023-11-14 2023-11-14            42    -3.433823           -3.354994
14   2024-01-14 2024-01-14            43     3.467114            3.467114
15   2024-03-14 2024-03-14            42     2.327772            2.098026
16   2024-05-14 2024-05-14            44    -2.234806           -2.234806
17   2024-07-14 2024-07-14            45    -3.677302            0.588205
18   2024-09-14 2024-09-14            43     0.511850           -5.327829
19   2024-11-14 2024-11-14            33    -2.294343            0.372993
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          5.3 |              2.8 |         -2.5 | False         
[INFO] 2021-11-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2022-01-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.2 |              3.2 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.2 |             -1.2 |         -1.0 | False         
[INFO] 2023-03-14   |          0.3 |              0.5 |          0.2 | True          
[INFO] 2023-05-14   |          3.9 |              2.3 |         -1.6 | False         
[INFO] 2023-07-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.4 |             -3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |          2.3 |              2.1 |         -0.2 | False         
[INFO] 2024-05-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -3.7 |              0.6 |          4.3 | True          
[INFO] 2024-09-14   |          0.5 |             -5.3 |         -5.8 | False         
[INFO] 2024-11-14   |         -2.3 |              0.4 |          2.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Hierarchical cluster wins (rounded comparison): 3 of 8 periods (37.50% win rate)
[INFO] Updating Excel file with Hierarchical results for TU...
[INFO] Excel file updated successfully. Added TU with Hierarchical win rate 37.5% in row 48
[INFO] Added best Sharpe parameters 274/284 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 274, Long SMA: 284
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(30/248) - Original Sharpe: 0.3841
[INFO] Added cluster 2 to portfolio: SMA(46/106) - Original Sharpe: 0.2675
[INFO] Added cluster 3 to portfolio: SMA(230/262) - Original Sharpe: 0.2240
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TU_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.8033
[INFO] Hierarchical Best out-of-sample Sharpe: 1.1058
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for TU...
[INFO] Excel file updated successfully. Added TU with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TU
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for UB in column D: 34.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 167.89s
[INFO] Best parameters: Short SMA = 62, Long SMA = 80
[INFO] Best Sharpe ratio: 0.952489, Trades: 45
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_UB_best_62/80 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @UB=117XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.63 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $499,619.00
[INFO] Market Buy & Hold P&L: $-15,562.50
[INFO] Outperformance: $515,181.50
[INFO] Sharpe ratio (entire period, annualized): 0.694675
[INFO] Sharpe ratio (in-sample, annualized): 0.952489
[INFO] Sharpe ratio (out-of-sample, annualized): 0.089749
[INFO] Maximum Drawdown: $135,012.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 30
[INFO] Out-of-sample period trades: 15
[INFO] Total trades: 45
[INFO] In-sample P&L: $564,104.75
[INFO] Out-of-sample P&L: $22,641.00
[INFO] 
Best parameters from GA: Short SMA = 62, Long SMA = 80, Sharpe = 0.952489
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5904 to 0.9525
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 80
[INFO] Sharpe Ratio: 0.952489
[INFO] Number of Trades: 45
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5904 to 0.9525
[INFO] Trades range: 11.0 to 334.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6592 to 3.0565
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 625 elements
[INFO] Kmeans Cluster 1: 751 elements
[INFO] Kmeans Cluster 2: 612 elements
[INFO] Kmeans Cluster 3: 595 elements
[INFO] Kmeans Cluster 4: 159 elements
[INFO] Kmeans Cluster 5: 570 elements
[INFO] Kmeans Cluster 6: 994 elements
[INFO] Kmeans Cluster 7: 711 elements
[INFO] Kmeans Cluster 8: 742 elements
[INFO] Kmeans Cluster 9: 730 elements
[INFO] Kmeans Cluster 10: 690 elements
[INFO] Kmeans Cluster 11: 545 elements
[INFO] Kmeans Cluster 12: 815 elements
[INFO] Kmeans Cluster 13: 737 elements
[INFO] Kmeans Cluster 14: 566 elements
[INFO] Kmeans Cluster 15: 743 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=116.92, Long SMA=233.03, Sharpe=0.1162
[INFO] Centroid 1: Short SMA=35.93, Long SMA=137.65, Sharpe=0.4485
[INFO] Centroid 2: Short SMA=163.04, Long SMA=272.84, Sharpe=-0.1376
[INFO] Centroid 3: Short SMA=44.77, Long SMA=250.96, Sharpe=0.1889
[INFO] Centroid 4: Short SMA=20.54, Long SMA=35.02, Sharpe=0.1984
[INFO] Centroid 5: Short SMA=84.50, Long SMA=132.68, Sharpe=0.1599
[INFO] Centroid 6: Short SMA=40.71, Long SMA=81.10, Sharpe=0.6206
[INFO] Centroid 7: Short SMA=29.05, Long SMA=204.76, Sharpe=0.3682
[INFO] Centroid 8: Short SMA=210.73, Long SMA=269.16, Sharpe=-0.3113
[INFO] Centroid 9: Short SMA=185.64, Long SMA=223.70, Sharpe=-0.0568
[INFO] Centroid 10: Short SMA=105.48, Long SMA=150.28, Sharpe=-0.0153
[INFO] Centroid 11: Short SMA=254.32, Long SMA=282.39, Sharpe=-0.2231
[INFO] Centroid 12: Short SMA=79.78, Long SMA=196.83, Sharpe=0.2175
[INFO] Centroid 13: Short SMA=107.85, Long SMA=276.30, Sharpe=-0.0284
[INFO] Centroid 14: Short SMA=45.81, Long SMA=283.85, Sharpe=-0.0505
[INFO] Centroid 15: Short SMA=147.03, Long SMA=190.08, Sharpe=0.2521
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=80, Sharpe=0.9525, Trades=45
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=40, Long SMA=80, Sharpe=0.7209, Trades=38
[INFO] Kmeans Top 2: Short SMA=34, Long SMA=138, Sharpe=0.4736, Trades=22
[INFO] Kmeans Top 3: Short SMA=30, Long SMA=206, Sharpe=0.4671, Trades=16
[INFO] Kmeans Top 4: Short SMA=146, Long SMA=190, Sharpe=0.3358, Trades=17
[INFO] Kmeans Top 5: Short SMA=80, Long SMA=198, Sharpe=0.3044, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (117, 233)
[INFO]   Nearest: (116.0, 234.0)
[INFO]   Rounded: (36, 138)
[INFO]   Rounded: (163, 273)
[INFO]   Nearest: (164.0, 272.0)
[INFO]   Rounded: (45, 251)
[INFO]   Nearest: (44.0, 250.0)
[INFO]   Rounded: (21, 35)
[INFO]   Nearest: (20.0, 36.0)
[INFO]   Rounded: (85, 133)
[INFO]   Nearest: (84.0, 132.0)
[INFO]   Rounded: (41, 81)
[INFO]   Nearest: (40.0, 82.0)
[INFO]   Rounded: (29, 205)
[INFO]   Nearest: (30.0, 204.0)
[INFO]   Rounded: (211, 269)
[INFO]   Nearest: (210.0, 270.0)
[INFO]   Rounded: (186, 224)
[INFO]   Rounded: (105, 150)
[INFO]   Nearest: (106.0, 150.0)
[INFO]   Rounded: (254, 282)
[INFO]   Rounded: (80, 197)
[INFO]   Nearest: (80.0, 196.0)
[INFO]   Rounded: (108, 276)
[INFO]   Rounded: (46, 284)
[INFO]   Rounded: (147, 190)
[INFO]   Nearest: (148.0, 190.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 80
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(40/80) - Original Sharpe: 0.7209, Trades: 38
[INFO] Kmeans cluster 2: SMA(34/138) - Original Sharpe: 0.4736, Trades: 22
[INFO] Kmeans cluster 3: SMA(30/206) - Original Sharpe: 0.4671, Trades: 16
[INFO] Kmeans cluster 4: SMA(146/190) - Original Sharpe: 0.3358, Trades: 17
[INFO] Kmeans cluster 5: SMA(80/198) - Original Sharpe: 0.3044, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/80)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (40/80) - Sharpe: 0.7209
[INFO] cluster 2: (34/138) - Sharpe: 0.4736
[INFO] cluster 3: (30/206) - Sharpe: 0.4671
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.086204           -1.053950
1    2021-11-14 2021-11-14            43     0.984700           -1.663282
2    2022-01-14 2022-01-14            41    -0.851035            0.829133
3    2022-03-14 2022-03-14            44     4.626773            4.626773
4    2022-05-14 2022-05-14            43     0.064197            0.064197
5    2022-07-14 2022-07-14            44     2.151092            1.232614
6    2022-09-14 2022-09-14            43     0.507963            2.628638
7    2022-11-14 2022-11-14            43    -2.397546           -1.338947
8    2023-01-14 2023-01-14            41    -0.385884           -1.206844
9    2023-03-14 2023-03-14            44    -1.291343           -0.201368
10   2023-05-14 2023-05-14            44     1.653847            0.105995
11   2023-07-14 2023-07-14            44     3.431170            3.431170
12   2023-09-14 2023-09-14            43     2.602377            2.602377
13   2023-11-14 2023-11-14            42    -4.883992           -5.547211
14   2024-01-14 2024-01-14            43    -1.084920           -1.121934
15   2024-03-14 2024-03-14            42     0.609020            0.600987
16   2024-05-14 2024-05-14            44    -1.255123           -0.991204
17   2024-07-14 2024-07-14            45     2.338417            2.917034
18   2024-09-14 2024-09-14            43    -3.629115           -3.357013
19   2024-11-14 2024-11-14            33     1.699993            1.699993
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |             -1.1 |          1.0 | True          
[INFO] 2021-11-14   |          1.0 |             -1.7 |         -2.7 | False         
[INFO] 2022-01-14   |         -0.9 |              0.8 |          1.7 | True          
[INFO] 2022-03-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.2 |              1.2 |         -1.0 | False         
[INFO] 2022-09-14   |          0.5 |              2.6 |          2.1 | True          
[INFO] 2022-11-14   |         -2.4 |             -1.3 |          1.1 | True          
[INFO] 2023-01-14   |         -0.4 |             -1.2 |         -0.8 | False         
[INFO] 2023-03-14   |         -1.3 |             -0.2 |          1.1 | True          
[INFO] 2023-05-14   |          1.7 |              0.1 |         -1.6 | False         
[INFO] 2023-07-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -4.9 |             -5.5 |         -0.6 | False         
[INFO] 2024-01-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-03-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -1.3 |             -1.0 |          0.3 | True          
[INFO] 2024-07-14   |          2.3 |              2.9 |          0.6 | True          
[INFO] 2024-09-14   |         -3.6 |             -3.4 |          0.2 | True          
[INFO] 2024-11-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14, 2024-01-14, 2024-03-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 8 of 13 periods (61.54% win rate)
[INFO] Updating Excel file with Kmeans results for UB...
[INFO] Excel file updated successfully. Added UB with Kmeans win rate 61.5% in row 49
[INFO] Added best Sharpe parameters 62/80 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 80
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(40/80) - Original Sharpe: 0.7209
[INFO] Added cluster 2 to portfolio: SMA(34/138) - Original Sharpe: 0.4736
[INFO] Added cluster 3 to portfolio: SMA(30/206) - Original Sharpe: 0.4671
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'UB_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.4397
[INFO] Kmeans Best out-of-sample Sharpe: 0.0897
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for UB...
[INFO] Excel file updated successfully. Added UB with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\UB
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5904 to 0.9525
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 80
[INFO] Sharpe Ratio: 0.952489
[INFO] Number of Trades: 45
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5904 to 0.9525
[INFO] Trades range: 11.0 to 334.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6592 to 3.0565
[INFO] Scaled Trades range: -0.6464 to 16.5656
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6383
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1011 elements
[INFO] Cluster 1: 1221 elements
[INFO] Cluster 2: 1328 elements
[INFO] Cluster 3: 966 elements
[INFO] Cluster 4: 133 elements
[INFO] Cluster 5: 850 elements
[INFO] Cluster 6: 839 elements
[INFO] Cluster 7: 980 elements
[INFO] Cluster 8: 25 elements
[INFO] Cluster 9: 1043 elements
[INFO] Cluster 10: 87 elements
[INFO] Cluster 11: 660 elements
[INFO] Cluster 12: 206 elements
[INFO] Cluster 13: 506 elements
[INFO] Cluster 14: 730 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=168, Long SMA=222, Sharpe=-0.0479, Trades=15
[INFO] Cluster 1 cluster: Short SMA=230, Long SMA=272, Sharpe=-0.2917, Trades=18
[INFO] Cluster 2 cluster: Short SMA=94, Long SMA=150, Sharpe=0.1053, Trades=22
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=140, Sharpe=0.4906, Trades=26
[INFO] Cluster 4 cluster: Short SMA=24, Long SMA=34, Sharpe=0.0163, Trades=103
[INFO] Cluster 5 cluster: Short SMA=36, Long SMA=208, Sharpe=0.2835, Trades=14
[INFO] Cluster 6 cluster: Short SMA=62, Long SMA=244, Sharpe=0.1602, Trades=12
[INFO] Cluster 7 cluster: Short SMA=110, Long SMA=274, Sharpe=-0.1276, Trades=11
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=28, Sharpe=-0.2505, Trades=214
[INFO] Cluster 9 cluster: Short SMA=120, Long SMA=196, Sharpe=0.2316, Trades=17
[INFO] Cluster 10 cluster: Short SMA=142, Long SMA=144, Sharpe=0.0615, Trades=71
[INFO] Cluster 11 cluster: Short SMA=174, Long SMA=270, Sharpe=-0.2754, Trades=12
[INFO] Cluster 12 cluster: Short SMA=42, Long SMA=52, Sharpe=0.3771, Trades=64
[INFO] Cluster 13 cluster: Short SMA=44, Long SMA=284, Sharpe=0.0508, Trades=16
[INFO] Cluster 14 cluster: Short SMA=42, Long SMA=80, Sharpe=0.6902, Trades=40
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=80, Sharpe=0.9525, Trades=45
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=42, Long SMA=80, Sharpe=0.6902, Trades=40
[INFO] Top 2: Short SMA=34, Long SMA=140, Sharpe=0.4906, Trades=26
[INFO] Top 3: Short SMA=42, Long SMA=52, Sharpe=0.3771, Trades=64
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 80
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(42/80) - Original Sharpe: 0.6902, Trades: 40
[INFO] Hierarchical cluster 2: SMA(34/140) - Original Sharpe: 0.4906, Trades: 26
[INFO] Hierarchical cluster 3: SMA(42/52) - Original Sharpe: 0.3771, Trades: 64
[INFO] Hierarchical cluster 4: SMA(36/208) - Original Sharpe: 0.2835, Trades: 14
[INFO] Hierarchical cluster 5: SMA(120/196) - Original Sharpe: 0.2316, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/80)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (42/80) - Sharpe: 0.6902
[INFO] cluster 2: (34/140) - Sharpe: 0.4906
[INFO] cluster 3: (42/52) - Sharpe: 0.3771
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.086204           -2.003562
1    2021-11-14 2021-11-14            43     0.984700           -3.236023
2    2022-01-14 2022-01-14            41    -0.851035            0.806788
3    2022-03-14 2022-03-14            44     4.626773            4.626773
4    2022-05-14 2022-05-14            43     0.064197            0.064197
5    2022-07-14 2022-07-14            44     2.151092           -0.795668
6    2022-09-14 2022-09-14            43     0.507963            2.628638
7    2022-11-14 2022-11-14            43    -2.397546           -2.275551
8    2023-01-14 2023-01-14            41    -0.385884            2.535084
9    2023-03-14 2023-03-14            44    -1.291343           -0.585922
10   2023-05-14 2023-05-14            44     1.653847           -1.456978
11   2023-07-14 2023-07-14            44     3.431170            3.235779
12   2023-09-14 2023-09-14            43     2.602377            2.602377
13   2023-11-14 2023-11-14            42    -4.883992           -5.720514
14   2024-01-14 2024-01-14            43    -1.084920           -2.022080
15   2024-03-14 2024-03-14            42     0.609020            0.600987
16   2024-05-14 2024-05-14            44    -1.255123           -1.086770
17   2024-07-14 2024-07-14            45     2.338417            2.917034
18   2024-09-14 2024-09-14            43    -3.629115           -3.837146
19   2024-11-14 2024-11-14            33     1.699993            1.699993
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |             -2.0 |          0.1 | True          
[INFO] 2021-11-14   |          1.0 |             -3.2 |         -4.2 | False         
[INFO] 2022-01-14   |         -0.9 |              0.8 |          1.7 | True          
[INFO] 2022-03-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.2 |             -0.8 |         -3.0 | False         
[INFO] 2022-09-14   |          0.5 |              2.6 |          2.1 | True          
[INFO] 2022-11-14   |         -2.4 |             -2.3 |          0.1 | True          
[INFO] 2023-01-14   |         -0.4 |              2.5 |          2.9 | True          
[INFO] 2023-03-14   |         -1.3 |             -0.6 |          0.7 | True          
[INFO] 2023-05-14   |          1.7 |             -1.5 |         -3.2 | False         
[INFO] 2023-07-14   |          3.4 |              3.2 |         -0.2 | False         
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -4.9 |             -5.7 |         -0.8 | False         
[INFO] 2024-01-14   |         -1.1 |             -2.0 |         -0.9 | False         
[INFO] 2024-03-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -1.3 |             -1.1 |          0.2 | True          
[INFO] 2024-07-14   |          2.3 |              2.9 |          0.6 | True          
[INFO] 2024-09-14   |         -3.6 |             -3.8 |         -0.2 | False         
[INFO] 2024-11-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-09-14, 2024-03-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 15 periods (53.33% win rate)
[INFO] Updating Excel file with Hierarchical results for UB...
[INFO] Excel file updated successfully. Added UB with Hierarchical win rate 53.3% in row 49
[INFO] Added best Sharpe parameters 62/80 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 80
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(42/80) - Original Sharpe: 0.6902
[INFO] Added cluster 2 to portfolio: SMA(34/140) - Original Sharpe: 0.4906
[INFO] Added cluster 3 to portfolio: SMA(42/52) - Original Sharpe: 0.3771
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'UB_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1354
[INFO] Hierarchical Best out-of-sample Sharpe: 0.0897
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for UB...
[INFO] Excel file updated successfully. Added UB with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\UB
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for ULS in column D: 27.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 2
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 154.11s
[INFO] Best parameters: Short SMA = 166, Long SMA = 168
[INFO] Best Sharpe ratio: 1.113971, Trades: 62
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_ULS_best_166/168 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @ULS=116XC
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.30 contracts
[INFO] Maximum Position Size: 8 contracts
[INFO] Strategy Total P&L: $545,860.00
[INFO] Market Buy & Hold P&L: $27,400.00
[INFO] Outperformance: $518,460.00
[INFO] Sharpe ratio (entire period, annualized): 0.653386
[INFO] Sharpe ratio (in-sample, annualized): 1.113971
[INFO] Sharpe ratio (out-of-sample, annualized): -0.211071
[INFO] Maximum Drawdown: $292,053.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 31
[INFO] Out-of-sample period trades: 31
[INFO] Total trades: 62
[INFO] In-sample P&L: $606,384.00
[INFO] Out-of-sample P&L: $-60,524.00
[INFO] 
Best parameters from GA: Short SMA = 166, Long SMA = 168, Sharpe = 1.113971
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3504 to 1.1140
[INFO] 
Best parameters:
[INFO] Short SMA: 166
[INFO] Long SMA: 168
[INFO] Sharpe Ratio: 1.113971
[INFO] Number of Trades: 62
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9538 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3504 to 1.1140
[INFO] Trades range: 10.0 to 302.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3195 to 2.7315
[INFO] Scaled Long SMA range: -2.7051 to 1.5032
[INFO] Scaled Sharpe ratio range: -3.2164 to 2.3607
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 850 elements
[INFO] Kmeans Cluster 1: 751 elements
[INFO] Kmeans Cluster 2: 835 elements
[INFO] Kmeans Cluster 3: 730 elements
[INFO] Kmeans Cluster 4: 241 elements
[INFO] Kmeans Cluster 5: 349 elements
[INFO] Kmeans Cluster 6: 1010 elements
[INFO] Kmeans Cluster 7: 797 elements
[INFO] Kmeans Cluster 8: 414 elements
[INFO] Kmeans Cluster 9: 755 elements
[INFO] Kmeans Cluster 10: 327 elements
[INFO] Kmeans Cluster 11: 562 elements
[INFO] Kmeans Cluster 12: 717 elements
[INFO] Kmeans Cluster 13: 658 elements
[INFO] Kmeans Cluster 14: 542 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=39.69, Long SMA=227.34, Sharpe=0.3844
[INFO] Centroid 1: Short SMA=165.32, Long SMA=197.18, Sharpe=0.8687
[INFO] Centroid 2: Short SMA=96.02, Long SMA=132.84, Sharpe=0.0046
[INFO] Centroid 3: Short SMA=32.45, Long SMA=114.41, Sharpe=0.3581
[INFO] Centroid 4: Short SMA=269.25, Long SMA=288.74, Sharpe=0.3029
[INFO] Centroid 5: Short SMA=97.94, Long SMA=189.43, Sharpe=0.5328
[INFO] Centroid 6: Short SMA=179.72, Long SMA=254.85, Sharpe=0.7878
[INFO] Centroid 7: Short SMA=229.17, Long SMA=265.78, Sharpe=0.6614
[INFO] Centroid 8: Short SMA=83.72, Long SMA=287.00, Sharpe=0.3595
[INFO] Centroid 9: Short SMA=122.74, Long SMA=212.93, Sharpe=0.7542
[INFO] Centroid 10: Short SMA=21.54, Long SMA=46.60, Sharpe=0.6845
[INFO] Centroid 11: Short SMA=30.32, Long SMA=175.12, Sharpe=0.4817
[INFO] Centroid 12: Short SMA=43.81, Long SMA=271.97, Sharpe=0.5254
[INFO] Centroid 13: Short SMA=80.73, Long SMA=163.70, Sharpe=0.2294
[INFO] Centroid 14: Short SMA=54.03, Long SMA=81.02, Sharpe=0.2750
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=166, Long SMA=168, Sharpe=1.1140, Trades=62
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=166, Long SMA=198, Sharpe=0.9857, Trades=18
[INFO] Kmeans Top 2: Short SMA=180, Long SMA=254, Sharpe=0.9041, Trades=12
[INFO] Kmeans Top 3: Short SMA=124, Long SMA=212, Sharpe=0.8159, Trades=12
[INFO] Kmeans Top 4: Short SMA=22, Long SMA=46, Sharpe=0.6830, Trades=61
[INFO] Kmeans Top 5: Short SMA=230, Long SMA=266, Sharpe=0.6825, Trades=16
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (40, 227)
[INFO]   Nearest: (40.0, 228.0)
[INFO]   Rounded: (165, 197)
[INFO]   Nearest: (166.0, 198.0)
[INFO]   Rounded: (96, 133)
[INFO]   Nearest: (96.0, 132.0)
[INFO]   Rounded: (32, 114)
[INFO]   Rounded: (269, 289)
[INFO]   Nearest: (270.0, 288.0)
[INFO]   Rounded: (98, 189)
[INFO]   Nearest: (98.0, 190.0)
[INFO]   Rounded: (180, 255)
[INFO]   Nearest: (180.0, 254.0)
[INFO]   Rounded: (229, 266)
[INFO]   Nearest: (230.0, 266.0)
[INFO]   Rounded: (84, 287)
[INFO]   Nearest: (84.0, 286.0)
[INFO]   Rounded: (123, 213)
[INFO]   Nearest: (122.0, 212.0)
[INFO]   Rounded: (22, 47)
[INFO]   Nearest: (22.0, 46.0)
[INFO]   Rounded: (30, 175)
[INFO]   Nearest: (30.0, 176.0)
[INFO]   Rounded: (44, 272)
[INFO]   Rounded: (81, 164)
[INFO]   Nearest: (80.0, 164.0)
[INFO]   Rounded: (54, 81)
[INFO]   Nearest: (54.0, 82.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 166, Long SMA: 168
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 2
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(166/198) - Original Sharpe: 0.9857, Trades: 18
[INFO] Kmeans cluster 2: SMA(180/254) - Original Sharpe: 0.9041, Trades: 12
[INFO] Kmeans cluster 3: SMA(124/212) - Original Sharpe: 0.8159, Trades: 12
[INFO] Kmeans cluster 4: SMA(22/46) - Original Sharpe: 0.6830, Trades: 61
[INFO] Kmeans cluster 5: SMA(230/266) - Original Sharpe: 0.6825, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2681
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (166/168)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (166/198) - Sharpe: 0.9857
[INFO] cluster 2: (180/254) - Sharpe: 0.9041
[INFO] cluster 3: (124/212) - Sharpe: 0.8159
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Out-of-sample period starts on: 2021-11-19
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-11-19 2021-11-19            43     1.280342            1.280342
1    2022-01-19 2022-01-19            43     2.581626            2.581626
2    2022-03-19 2022-03-19            42     0.329627            0.329627
3    2022-05-19 2022-05-19            43     1.402034            1.402034
4    2022-07-19 2022-07-19            44    -1.324002           -1.324002
5    2022-09-19 2022-09-19            45     1.312950            1.385705
6    2022-11-19 2022-11-19            41    -0.638271           -0.060679
7    2023-01-19 2023-01-19            42     3.607885           -1.886238
8    2023-03-19 2023-03-19            43     3.055470            1.567510
9    2023-05-19 2023-05-19            43    -2.250970           -2.086250
10   2023-07-19 2023-07-19            44    -5.185486           -4.566868
11   2023-09-19 2023-09-19            44    -2.773541           -0.776382
12   2023-11-19 2023-11-19            42     0.667456            0.667456
13   2024-01-19 2024-01-19            42     2.912396            2.912396
14   2024-03-19 2024-03-19            43    -2.656666           -3.599997
15   2024-05-19 2024-05-19            44    -6.949862            5.005755
16   2024-07-19 2024-07-19            44    -3.716464           -3.469693
17   2024-09-19 2024-09-19            43    -1.541732            0.560633
18   2024-11-19 2024-11-19            30    -1.144354           -1.144354
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-11-19   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-01-19   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2022-03-19   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-05-19   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-07-19   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2022-09-19   |          1.3 |              1.4 |          0.1 | True          
[INFO] 2022-11-19   |         -0.6 |             -0.1 |          0.5 | True          
[INFO] 2023-01-19   |          3.6 |             -1.9 |         -5.5 | False         
[INFO] 2023-03-19   |          3.1 |              1.6 |         -1.5 | False         
[INFO] 2023-05-19   |         -2.3 |             -2.1 |          0.2 | True          
[INFO] 2023-07-19   |         -5.2 |             -4.6 |          0.6 | True          
[INFO] 2023-09-19   |         -2.8 |             -0.8 |          2.0 | True          
[INFO] 2023-11-19   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-01-19   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-03-19   |         -2.7 |             -3.6 |         -0.9 | False         
[INFO] 2024-05-19   |         -6.9 |              5.0 |         11.9 | True          
[INFO] 2024-07-19   |         -3.7 |             -3.5 |          0.2 | True          
[INFO] 2024-09-19   |         -1.5 |              0.6 |          2.1 | True          
[INFO] 2024-11-19   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-19, 2022-01-19, 2022-03-19, 2022-05-19, 2022-07-19, 2023-11-19, 2024-01-19, 2024-11-19
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Kmeans cluster wins (rounded comparison): 8 of 11 periods (72.73% win rate)
[INFO] Updating Excel file with Kmeans results for ULS...
[INFO] Excel file updated successfully. Added ULS with Kmeans win rate 72.7% in row 50
[INFO] Added best Sharpe parameters 166/168 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 166, Long SMA: 168
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(166/198) - Original Sharpe: 0.9857
[INFO] Added cluster 2 to portfolio: SMA(180/254) - Original Sharpe: 0.9041
[INFO] Added cluster 3 to portfolio: SMA(124/212) - Original Sharpe: 0.8159
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ULS_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1787
[INFO] Kmeans Best out-of-sample Sharpe: -0.2111
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for ULS...
[INFO] Excel file updated successfully. Added ULS with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ULS
[INFO] Big Point Value: 100.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3504 to 1.1140
[INFO] 
Best parameters:
[INFO] Short SMA: 166
[INFO] Long SMA: 168
[INFO] Sharpe Ratio: 1.113971
[INFO] Number of Trades: 62
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9538 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3504 to 1.1140
[INFO] Trades range: 10.0 to 302.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3195 to 2.7315
[INFO] Scaled Long SMA range: -2.7051 to 1.5032
[INFO] Scaled Sharpe ratio range: -3.2164 to 2.3607
[INFO] Scaled Trades range: -0.7285 to 15.7469
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9538 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5728
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1771 elements
[INFO] Cluster 1: 1039 elements
[INFO] Cluster 2: 1318 elements
[INFO] Cluster 3: 1219 elements
[INFO] Cluster 4: 199 elements
[INFO] Cluster 5: 954 elements
[INFO] Cluster 6: 860 elements
[INFO] Cluster 7: 65 elements
[INFO] Cluster 8: 201 elements
[INFO] Cluster 9: 148 elements
[INFO] Cluster 10: 64 elements
[INFO] Cluster 11: 9 elements
[INFO] Cluster 12: 625 elements
[INFO] Cluster 13: 440 elements
[INFO] Cluster 14: 626 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=42, Long SMA=202, Sharpe=0.3282, Trades=14
[INFO] Cluster 1 cluster: Short SMA=140, Long SMA=196, Sharpe=0.7974, Trades=16
[INFO] Cluster 2 cluster: Short SMA=218, Long SMA=266, Sharpe=0.6476, Trades=14
[INFO] Cluster 3 cluster: Short SMA=62, Long SMA=274, Sharpe=0.4660, Trades=12
[INFO] Cluster 4 cluster: Short SMA=74, Long SMA=80, Sharpe=0.1404, Trades=65
[INFO] Cluster 5 cluster: Short SMA=164, Long SMA=240, Sharpe=0.6943, Trades=12
[INFO] Cluster 6 cluster: Short SMA=92, Long SMA=136, Sharpe=0.0768, Trades=26
[INFO] Cluster 7 cluster: Short SMA=24, Long SMA=28, Sharpe=0.8679, Trades=118
[INFO] Cluster 8 cluster: Short SMA=22, Long SMA=48, Sharpe=0.5750, Trades=61
[INFO] Cluster 9 cluster: Short SMA=278, Long SMA=292, Sharpe=0.1013, Trades=24
[INFO] Cluster 10 cluster: Short SMA=206, Long SMA=208, Sharpe=0.8508, Trades=64
[INFO] Cluster 12 cluster: Short SMA=34, Long SMA=86, Sharpe=0.2214, Trades=39
[INFO] Cluster 13 cluster: Short SMA=82, Long SMA=166, Sharpe=0.1472, Trades=20
[INFO] Cluster 14 cluster: Short SMA=44, Long SMA=116, Sharpe=0.5973, Trades=22
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=166, Long SMA=168, Sharpe=1.1140, Trades=62
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=24, Long SMA=28, Sharpe=0.8679, Trades=118
[INFO] Top 2: Short SMA=206, Long SMA=208, Sharpe=0.8508, Trades=64
[INFO] Top 3: Short SMA=140, Long SMA=196, Sharpe=0.7974, Trades=16
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 9529 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 166, Long SMA: 168
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 2
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(24/28) - Original Sharpe: 0.8679, Trades: 118
[INFO] Hierarchical cluster 2: SMA(206/208) - Original Sharpe: 0.8508, Trades: 64
[INFO] Hierarchical cluster 3: SMA(140/196) - Original Sharpe: 0.7974, Trades: 16
[INFO] Hierarchical cluster 4: SMA(164/240) - Original Sharpe: 0.6943, Trades: 12
[INFO] Hierarchical cluster 5: SMA(218/266) - Original Sharpe: 0.6476, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2681
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (166/168)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/28) - Sharpe: 0.8679
[INFO] cluster 2: (206/208) - Sharpe: 0.8508
[INFO] cluster 3: (140/196) - Sharpe: 0.7974
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Out-of-sample period starts on: 2021-11-19
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-11-19 2021-11-19            43     1.280342            3.933856
1    2022-01-19 2022-01-19            43     2.581626            2.581626
2    2022-03-19 2022-03-19            42     0.329627           -0.654496
3    2022-05-19 2022-05-19            43     1.402034            1.033246
4    2022-07-19 2022-07-19            44    -1.324002           -3.600612
5    2022-09-19 2022-09-19            45     1.312950            0.671149
6    2022-11-19 2022-11-19            41    -0.638271           -1.771143
7    2023-01-19 2023-01-19            42     3.607885           -2.543203
8    2023-03-19 2023-03-19            43     3.055470            0.535486
9    2023-05-19 2023-05-19            43    -2.250970           -1.333865
10   2023-07-19 2023-07-19            44    -5.185486           -3.165484
11   2023-09-19 2023-09-19            44    -2.773541            3.538996
12   2023-11-19 2023-11-19            42     0.667456            0.403718
13   2024-01-19 2024-01-19            42     2.912396            2.512139
14   2024-03-19 2024-03-19            43    -2.656666           -1.272023
15   2024-05-19 2024-05-19            44    -6.949862           -1.928444
16   2024-07-19 2024-07-19            44    -3.716464           -3.172266
17   2024-09-19 2024-09-19            43    -1.541732           -2.212946
18   2024-11-19 2024-11-19            30    -1.144354           -3.795896
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-11-19   |          1.3 |              3.9 |          2.6 | True          
[INFO] 2022-01-19   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2022-03-19   |          0.3 |             -0.7 |         -1.0 | False         
[INFO] 2022-05-19   |          1.4 |              1.0 |         -0.4 | False         
[INFO] 2022-07-19   |         -1.3 |             -3.6 |         -2.3 | False         
[INFO] 2022-09-19   |          1.3 |              0.7 |         -0.6 | False         
[INFO] 2022-11-19   |         -0.6 |             -1.8 |         -1.2 | False         
[INFO] 2023-01-19   |          3.6 |             -2.5 |         -6.1 | False         
[INFO] 2023-03-19   |          3.1 |              0.5 |         -2.6 | False         
[INFO] 2023-05-19   |         -2.3 |             -1.3 |          1.0 | True          
[INFO] 2023-07-19   |         -5.2 |             -3.2 |          2.0 | True          
[INFO] 2023-09-19   |         -2.8 |              3.5 |          6.3 | True          
[INFO] 2023-11-19   |          0.7 |              0.4 |         -0.3 | False         
[INFO] 2024-01-19   |          2.9 |              2.5 |         -0.4 | False         
[INFO] 2024-03-19   |         -2.7 |             -1.3 |          1.4 | True          
[INFO] 2024-05-19   |         -6.9 |             -1.9 |          5.0 | True          
[INFO] 2024-07-19   |         -3.7 |             -3.2 |          0.5 | True          
[INFO] 2024-09-19   |         -1.5 |             -2.2 |         -0.7 | False         
[INFO] 2024-11-19   |         -1.1 |             -3.8 |         -2.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-19
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 18 periods (38.89% win rate)
[INFO] Updating Excel file with Hierarchical results for ULS...
[INFO] Excel file updated successfully. Added ULS with Hierarchical win rate 38.9% in row 50
[INFO] Added best Sharpe parameters 166/168 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 166, Long SMA: 168
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/28) - Original Sharpe: 0.8679
[INFO] Added cluster 2 to portfolio: SMA(206/208) - Original Sharpe: 0.8508
[INFO] Added cluster 3 to portfolio: SMA(140/196) - Original Sharpe: 0.7974
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ULS_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2261
[INFO] Hierarchical Best out-of-sample Sharpe: -0.2111
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for ULS...
[INFO] Excel file updated successfully. Added ULS with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ULS
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for US in column D: 34.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 165.28s
[INFO] Best parameters: Short SMA = 62, Long SMA = 94
[INFO] Best Sharpe ratio: 1.040882, Trades: 39
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_US_best_62/94 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @US
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.13 contracts
[INFO] Maximum Position Size: 9 contracts
[INFO] Strategy Total P&L: $514,847.25
[INFO] Market Buy & Hold P&L: $2,093.75
[INFO] Outperformance: $512,753.50
[INFO] Sharpe ratio (entire period, annualized): 0.785212
[INFO] Sharpe ratio (in-sample, annualized): 1.040882
[INFO] Sharpe ratio (out-of-sample, annualized): 0.193643
[INFO] Maximum Drawdown: $114,216.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 26
[INFO] Out-of-sample period trades: 13
[INFO] Total trades: 39
[INFO] In-sample P&L: $581,161.00
[INFO] Out-of-sample P&L: $46,701.75
[INFO] 
Best parameters from GA: Short SMA = 62, Long SMA = 94, Sharpe = 1.040882
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4882 to 1.0409
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 94
[INFO] Sharpe Ratio: 1.040882
[INFO] Number of Trades: 39
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4882 to 1.0409
[INFO] Trades range: 11.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.5262 to 3.2566
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 783 elements
[INFO] Kmeans Cluster 1: 716 elements
[INFO] Kmeans Cluster 2: 800 elements
[INFO] Kmeans Cluster 3: 990 elements
[INFO] Kmeans Cluster 4: 563 elements
[INFO] Kmeans Cluster 5: 718 elements
[INFO] Kmeans Cluster 6: 438 elements
[INFO] Kmeans Cluster 7: 804 elements
[INFO] Kmeans Cluster 8: 740 elements
[INFO] Kmeans Cluster 9: 132 elements
[INFO] Kmeans Cluster 10: 821 elements
[INFO] Kmeans Cluster 11: 513 elements
[INFO] Kmeans Cluster 12: 823 elements
[INFO] Kmeans Cluster 13: 588 elements
[INFO] Kmeans Cluster 14: 577 elements
[INFO] Kmeans Cluster 15: 579 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=125.66, Long SMA=243.75, Sharpe=0.1174
[INFO] Centroid 1: Short SMA=44.46, Long SMA=129.61, Sharpe=0.4828
[INFO] Centroid 2: Short SMA=191.17, Long SMA=231.68, Sharpe=0.0369
[INFO] Centroid 3: Short SMA=238.70, Long SMA=277.71, Sharpe=-0.2324
[INFO] Centroid 4: Short SMA=86.48, Long SMA=142.49, Sharpe=0.1262
[INFO] Centroid 5: Short SMA=44.78, Long SMA=231.97, Sharpe=0.2759
[INFO] Centroid 6: Short SMA=30.22, Long SMA=67.47, Sharpe=0.5625
[INFO] Centroid 7: Short SMA=84.97, Long SMA=197.20, Sharpe=0.2779
[INFO] Centroid 8: Short SMA=164.91, Long SMA=279.38, Sharpe=-0.0964
[INFO] Centroid 9: Short SMA=20.75, Long SMA=32.78, Sharpe=0.2548
[INFO] Centroid 10: Short SMA=84.49, Long SMA=276.62, Sharpe=0.0188
[INFO] Centroid 11: Short SMA=30.16, Long SMA=275.15, Sharpe=0.1290
[INFO] Centroid 12: Short SMA=150.06, Long SMA=191.53, Sharpe=0.2580
[INFO] Centroid 13: Short SMA=111.27, Long SMA=145.18, Sharpe=-0.0529
[INFO] Centroid 14: Short SMA=26.30, Long SMA=183.98, Sharpe=0.4634
[INFO] Centroid 15: Short SMA=45.39, Long SMA=90.13, Sharpe=0.7499
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=94, Sharpe=1.0409, Trades=39
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=48, Long SMA=90, Sharpe=0.7733, Trades=33
[INFO] Kmeans Top 2: Short SMA=44, Long SMA=130, Sharpe=0.4545, Trades=24
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=66, Sharpe=0.4416, Trades=42
[INFO] Kmeans Top 4: Short SMA=26, Long SMA=184, Sharpe=0.3957, Trades=24
[INFO] Kmeans Top 5: Short SMA=86, Long SMA=198, Sharpe=0.3794, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (126, 244)
[INFO]   Rounded: (44, 130)
[INFO]   Rounded: (191, 232)
[INFO]   Nearest: (192.0, 232.0)
[INFO]   Rounded: (239, 278)
[INFO]   Nearest: (238.0, 278.0)
[INFO]   Rounded: (86, 142)
[INFO]   Rounded: (45, 232)
[INFO]   Nearest: (44.0, 232.0)
[INFO]   Rounded: (30, 67)
[INFO]   Nearest: (30.0, 68.0)
[INFO]   Rounded: (85, 197)
[INFO]   Nearest: (84.0, 198.0)
[INFO]   Rounded: (165, 279)
[INFO]   Nearest: (164.0, 280.0)
[INFO]   Rounded: (21, 33)
[INFO]   Nearest: (20.0, 32.0)
[INFO]   Rounded: (84, 277)
[INFO]   Nearest: (84.0, 276.0)
[INFO]   Rounded: (30, 275)
[INFO]   Nearest: (30.0, 276.0)
[INFO]   Rounded: (150, 192)
[INFO]   Rounded: (111, 145)
[INFO]   Nearest: (112.0, 146.0)
[INFO]   Rounded: (26, 184)
[INFO]   Rounded: (45, 90)
[INFO]   Nearest: (46.0, 90.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 94
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(48/90) - Original Sharpe: 0.7733, Trades: 33
[INFO] Kmeans cluster 2: SMA(44/130) - Original Sharpe: 0.4545, Trades: 24
[INFO] Kmeans cluster 3: SMA(28/66) - Original Sharpe: 0.4416, Trades: 42
[INFO] Kmeans cluster 4: SMA(26/184) - Original Sharpe: 0.3957, Trades: 24
[INFO] Kmeans cluster 5: SMA(86/198) - Original Sharpe: 0.3794, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/94)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (48/90) - Sharpe: 0.7733
[INFO] cluster 2: (44/130) - Sharpe: 0.4545
[INFO] cluster 3: (28/66) - Sharpe: 0.4416
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.475522           -2.384177
1    2021-11-14 2021-11-14            43     1.219983           -3.963115
2    2022-01-14 2022-01-14            41    -0.358176            0.450526
3    2022-03-14 2022-03-14            44     4.804528            4.804528
4    2022-05-14 2022-05-14            43    -0.181247           -0.181247
5    2022-07-14 2022-07-14            44     1.120787           -2.227540
6    2022-09-14 2022-09-14            43    -1.028981            1.190920
7    2022-11-14 2022-11-14            43    -2.298651           -2.551572
8    2023-01-14 2023-01-14            41    -0.223635           -2.956322
9    2023-03-14 2023-03-14            44     0.355798           -1.165891
10   2023-05-14 2023-05-14            44     1.277535           -2.453500
11   2023-07-14 2023-07-14            44     3.299199            3.299199
12   2023-09-14 2023-09-14            43     2.565820            2.565820
13   2023-11-14 2023-11-14            42    -2.979453           -5.174338
14   2024-01-14 2024-01-14            43    -1.306968           -2.149698
15   2024-03-14 2024-03-14            42     0.596356           -0.501038
16   2024-05-14 2024-05-14            44    -1.478112           -1.114513
17   2024-07-14 2024-07-14            45     3.789391            3.328175
18   2024-09-14 2024-09-14            43    -5.219166           -5.107952
19   2024-11-14 2024-11-14            33     2.330861            2.032426
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.5 |             -2.4 |         -0.9 | False         
[INFO] 2021-11-14   |          1.2 |             -4.0 |         -5.2 | False         
[INFO] 2022-01-14   |         -0.4 |              0.5 |          0.9 | True          
[INFO] 2022-03-14   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |             -2.2 |         -3.3 | False         
[INFO] 2022-09-14   |         -1.0 |              1.2 |          2.2 | True          
[INFO] 2022-11-14   |         -2.3 |             -2.6 |         -0.3 | False         
[INFO] 2023-01-14   |         -0.2 |             -3.0 |         -2.8 | False         
[INFO] 2023-03-14   |          0.4 |             -1.2 |         -1.6 | False         
[INFO] 2023-05-14   |          1.3 |             -2.5 |         -3.8 | False         
[INFO] 2023-07-14   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.0 |             -5.2 |         -2.2 | False         
[INFO] 2024-01-14   |         -1.3 |             -2.1 |         -0.8 | False         
[INFO] 2024-03-14   |          0.6 |             -0.5 |         -1.1 | False         
[INFO] 2024-05-14   |         -1.5 |             -1.1 |          0.4 | True          
[INFO] 2024-07-14   |          3.8 |              3.3 |         -0.5 | False         
[INFO] 2024-09-14   |         -5.2 |             -5.1 |          0.1 | True          
[INFO] 2024-11-14   |          2.3 |              2.0 |         -0.3 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 4 of 16 periods (25.00% win rate)
[INFO] Updating Excel file with Kmeans results for US...
[INFO] Excel file updated successfully. Added US with Kmeans win rate 25.0% in row 51
[INFO] Added best Sharpe parameters 62/94 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 94
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(48/90) - Original Sharpe: 0.7733
[INFO] Added cluster 2 to portfolio: SMA(44/130) - Original Sharpe: 0.4545
[INFO] Added cluster 3 to portfolio: SMA(28/66) - Original Sharpe: 0.4416
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'US_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3485
[INFO] Kmeans Best out-of-sample Sharpe: 0.1936
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for US...
[INFO] Excel file updated successfully. Added US with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\US
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4882 to 1.0409
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 94
[INFO] Sharpe Ratio: 1.040882
[INFO] Number of Trades: 39
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4882 to 1.0409
[INFO] Trades range: 11.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.5262 to 3.2566
[INFO] Scaled Trades range: -0.6643 to 16.8688
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6209
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 46 elements
[INFO] Cluster 1: 1199 elements
[INFO] Cluster 2: 1009 elements
[INFO] Cluster 3: 1039 elements
[INFO] Cluster 4: 1254 elements
[INFO] Cluster 5: 160 elements
[INFO] Cluster 6: 1072 elements
[INFO] Cluster 7: 238 elements
[INFO] Cluster 8: 877 elements
[INFO] Cluster 9: 938 elements
[INFO] Cluster 10: 753 elements
[INFO] Cluster 11: 729 elements
[INFO] Cluster 12: 561 elements
[INFO] Cluster 13: 710 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=22, Long SMA=26, Sharpe=-0.0290, Trades=168
[INFO] Cluster 1 cluster: Short SMA=38, Long SMA=152, Sharpe=0.5535, Trades=22
[INFO] Cluster 2 cluster: Short SMA=34, Long SMA=88, Sharpe=0.6643, Trades=36
[INFO] Cluster 3 cluster: Short SMA=134, Long SMA=270, Sharpe=0.0227, Trades=11
[INFO] Cluster 4 cluster: Short SMA=228, Long SMA=276, Sharpe=-0.1892, Trades=14
[INFO] Cluster 5 cluster: Short SMA=156, Long SMA=160, Sharpe=0.6610, Trades=57
[INFO] Cluster 6 cluster: Short SMA=102, Long SMA=196, Sharpe=0.2239, Trades=15
[INFO] Cluster 7 cluster: Short SMA=36, Long SMA=44, Sharpe=0.4140, Trades=84
[INFO] Cluster 8 cluster: Short SMA=58, Long SMA=216, Sharpe=0.2403, Trades=16
[INFO] Cluster 9 cluster: Short SMA=182, Long SMA=236, Sharpe=-0.0002, Trades=15
[INFO] Cluster 10 cluster: Short SMA=102, Long SMA=140, Sharpe=0.0349, Trades=27
[INFO] Cluster 11 cluster: Short SMA=34, Long SMA=266, Sharpe=0.1149, Trades=16
[INFO] Cluster 12 cluster: Short SMA=156, Long SMA=192, Sharpe=0.1745, Trades=21
[INFO] Cluster 13 cluster: Short SMA=80, Long SMA=274, Sharpe=0.0200, Trades=14
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=94, Sharpe=1.0409, Trades=39
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=34, Long SMA=88, Sharpe=0.6643, Trades=36
[INFO] Top 2: Short SMA=156, Long SMA=160, Sharpe=0.6610, Trades=57
[INFO] Top 3: Short SMA=38, Long SMA=152, Sharpe=0.5535, Trades=22
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 94
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(34/88) - Original Sharpe: 0.6643, Trades: 36
[INFO] Hierarchical cluster 2: SMA(156/160) - Original Sharpe: 0.6610, Trades: 57
[INFO] Hierarchical cluster 3: SMA(38/152) - Original Sharpe: 0.5535, Trades: 22
[INFO] Hierarchical cluster 4: SMA(36/44) - Original Sharpe: 0.4140, Trades: 84
[INFO] Hierarchical cluster 5: SMA(58/216) - Original Sharpe: 0.2403, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/94)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/88) - Sharpe: 0.6643
[INFO] cluster 2: (156/160) - Sharpe: 0.6610
[INFO] cluster 3: (38/152) - Sharpe: 0.5535
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.475522           -0.719186
1    2021-11-14 2021-11-14            43     1.219983           -2.441520
2    2022-01-14 2022-01-14            41    -0.358176           -1.325125
3    2022-03-14 2022-03-14            44     4.804528            4.804528
4    2022-05-14 2022-05-14            43    -0.181247           -0.181247
5    2022-07-14 2022-07-14            44     1.120787           -0.141345
6    2022-09-14 2022-09-14            43    -1.028981            2.291593
7    2022-11-14 2022-11-14            43    -2.298651           -2.069310
8    2023-01-14 2023-01-14            41    -0.223635           -2.435678
9    2023-03-14 2023-03-14            44     0.355798           -1.372617
10   2023-05-14 2023-05-14            44     1.277535           -3.404959
11   2023-07-14 2023-07-14            44     3.299199            2.952356
12   2023-09-14 2023-09-14            43     2.565820            2.992245
13   2023-11-14 2023-11-14            42    -2.979453           -4.234912
14   2024-01-14 2024-01-14            43    -1.306968           -1.306968
15   2024-03-14 2024-03-14            42     0.596356           -0.208245
16   2024-05-14 2024-05-14            44    -1.478112           -1.373000
17   2024-07-14 2024-07-14            45     3.789391            4.631774
18   2024-09-14 2024-09-14            43    -5.219166           -7.491548
19   2024-11-14 2024-11-14            33     2.330861            2.420626
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.5 |             -0.7 |          0.8 | True          
[INFO] 2021-11-14   |          1.2 |             -2.4 |         -3.6 | False         
[INFO] 2022-01-14   |         -0.4 |             -1.3 |         -0.9 | False         
[INFO] 2022-03-14   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |             -0.1 |         -1.2 | False         
[INFO] 2022-09-14   |         -1.0 |              2.3 |          3.3 | True          
[INFO] 2022-11-14   |         -2.3 |             -2.1 |          0.2 | True          
[INFO] 2023-01-14   |         -0.2 |             -2.4 |         -2.2 | False         
[INFO] 2023-03-14   |          0.4 |             -1.4 |         -1.8 | False         
[INFO] 2023-05-14   |          1.3 |             -3.4 |         -4.7 | False         
[INFO] 2023-07-14   |          3.3 |              3.0 |         -0.3 | False         
[INFO] 2023-09-14   |          2.6 |              3.0 |          0.4 | True          
[INFO] 2023-11-14   |         -3.0 |             -4.2 |         -1.2 | False         
[INFO] 2024-01-14   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2024-03-14   |          0.6 |             -0.2 |         -0.8 | False         
[INFO] 2024-05-14   |         -1.5 |             -1.4 |          0.1 | True          
[INFO] 2024-07-14   |          3.8 |              4.6 |          0.8 | True          
[INFO] 2024-09-14   |         -5.2 |             -7.5 |         -2.3 | False         
[INFO] 2024-11-14   |          2.3 |              2.4 |          0.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2024-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 17 periods (41.18% win rate)
[INFO] Updating Excel file with Hierarchical results for US...
[INFO] Excel file updated successfully. Added US with Hierarchical win rate 41.2% in row 51
[INFO] Added best Sharpe parameters 62/94 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 94
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/88) - Original Sharpe: 0.6643
[INFO] Added cluster 2 to portfolio: SMA(156/160) - Original Sharpe: 0.6610
[INFO] Added cluster 3 to portfolio: SMA(38/152) - Original Sharpe: 0.5535
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'US_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2601
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1936
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for US...
[INFO] Excel file updated successfully. Added US with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\US
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for VX in column D: 52.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 166.80s
[INFO] Best parameters: Short SMA = 20, Long SMA = 26
[INFO] Best Sharpe ratio: 0.498120, Trades: 112
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_VX_best_20/26 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @VX
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 6.89 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $374,312.00
[INFO] Market Buy & Hold P&L: $-118,870.00
[INFO] Outperformance: $493,182.00
[INFO] Sharpe ratio (entire period, annualized): 0.348523
[INFO] Sharpe ratio (in-sample, annualized): 0.498120
[INFO] Sharpe ratio (out-of-sample, annualized): -0.080129
[INFO] Maximum Drawdown: $275,228.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 77
[INFO] Out-of-sample period trades: 35
[INFO] Total trades: 112
[INFO] In-sample P&L: $452,028.00
[INFO] Out-of-sample P&L: $-25,006.00
[INFO] 
Best parameters from GA: Short SMA = 20, Long SMA = 26, Sharpe = 0.498120
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 52.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6289 to 0.4981
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 0.498120
[INFO] Number of Trades: 112
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10372 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6289 to 0.4981
[INFO] Trades range: 10.0 to 319.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3877 to 2.8531
[INFO] Scaled Long SMA range: -2.7953 to 1.4389
[INFO] Scaled Sharpe ratio range: -2.2865 to 4.5954
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 18
[INFO] Using 18 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=18...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 870 elements
[INFO] Kmeans Cluster 1: 652 elements
[INFO] Kmeans Cluster 2: 309 elements
[INFO] Kmeans Cluster 3: 556 elements
[INFO] Kmeans Cluster 4: 698 elements
[INFO] Kmeans Cluster 5: 676 elements
[INFO] Kmeans Cluster 6: 504 elements
[INFO] Kmeans Cluster 7: 388 elements
[INFO] Kmeans Cluster 8: 228 elements
[INFO] Kmeans Cluster 9: 525 elements
[INFO] Kmeans Cluster 10: 315 elements
[INFO] Kmeans Cluster 11: 619 elements
[INFO] Kmeans Cluster 12: 798 elements
[INFO] Kmeans Cluster 13: 854 elements
[INFO] Kmeans Cluster 14: 584 elements
[INFO] Kmeans Cluster 15: 305 elements
[INFO] Kmeans Cluster 16: 527 elements
[INFO] Kmeans Cluster 17: 964 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=89.19, Long SMA=259.36, Sharpe=-0.4623
[INFO] Centroid 1: Short SMA=113.52, Long SMA=143.22, Sharpe=-0.2308
[INFO] Centroid 2: Short SMA=192.14, Long SMA=231.99, Sharpe=-0.1688
[INFO] Centroid 3: Short SMA=69.49, Long SMA=110.45, Sharpe=-0.3075
[INFO] Centroid 4: Short SMA=112.81, Long SMA=208.78, Sharpe=-0.4195
[INFO] Centroid 5: Short SMA=74.61, Long SMA=164.35, Sharpe=-0.3177
[INFO] Centroid 6: Short SMA=29.10, Long SMA=131.73, Sharpe=-0.1280
[INFO] Centroid 7: Short SMA=18.98, Long SMA=262.10, Sharpe=-0.1691
[INFO] Centroid 8: Short SMA=221.82, Long SMA=256.84, Sharpe=0.1247
[INFO] Centroid 9: Short SMA=47.25, Long SMA=273.67, Sharpe=-0.3561
[INFO] Centroid 10: Short SMA=265.08, Long SMA=285.97, Sharpe=-0.2449
[INFO] Centroid 11: Short SMA=37.42, Long SMA=70.10, Sharpe=-0.0743
[INFO] Centroid 12: Short SMA=135.50, Long SMA=266.24, Sharpe=-0.3296
[INFO] Centroid 13: Short SMA=161.74, Long SMA=196.84, Sharpe=-0.3946
[INFO] Centroid 14: Short SMA=28.20, Long SMA=189.82, Sharpe=-0.2210
[INFO] Centroid 15: Short SMA=24.19, Long SMA=68.45, Sharpe=0.1098
[INFO] Centroid 16: Short SMA=59.11, Long SMA=214.39, Sharpe=-0.4008
[INFO] Centroid 17: Short SMA=204.44, Long SMA=268.05, Sharpe=-0.0382
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=26, Sharpe=0.4981, Trades=112
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=230, Long SMA=252, Sharpe=0.2229, Trades=12
[INFO] Kmeans Top 2: Short SMA=24, Long SMA=68, Sharpe=0.0760, Trades=42
[INFO] Kmeans Top 3: Short SMA=204, Long SMA=268, Sharpe=-0.0314, Trades=10
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=132, Sharpe=-0.1388, Trades=24
[INFO] Kmeans Top 5: Short SMA=40, Long SMA=72, Sharpe=-0.1418, Trades=32
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17}
[INFO]   Rounded: (89, 259)
[INFO]   Nearest: (90.0, 260.0)
[INFO]   Rounded: (114, 143)
[INFO]   Nearest: (114.0, 144.0)
[INFO]   Rounded: (192, 232)
[INFO]   Rounded: (69, 110)
[INFO]   Nearest: (70.0, 110.0)
[INFO]   Rounded: (113, 209)
[INFO]   Nearest: (112.0, 208.0)
[INFO]   Rounded: (75, 164)
[INFO]   Nearest: (74.0, 164.0)
[INFO]   Rounded: (29, 132)
[INFO]   Nearest: (30.0, 132.0)
[INFO]   Rounded: (19, 262)
[INFO]   Nearest: (18.0, 262.0)
[INFO]   Rounded: (222, 257)
[INFO]   Nearest: (222.0, 256.0)
[INFO]   Rounded: (47, 274)
[INFO]   Nearest: (48.0, 274.0)
[INFO]   Rounded: (265, 286)
[INFO]   Nearest: (266.0, 286.0)
[INFO]   Rounded: (37, 70)
[INFO]   Nearest: (38.0, 70.0)
[INFO]   Rounded: (136, 266)
[INFO]   Rounded: (162, 197)
[INFO]   Nearest: (162.0, 196.0)
[INFO]   Rounded: (28, 190)
[INFO]   Rounded: (24, 68)
[INFO]   Rounded: (59, 214)
[INFO]   Nearest: (60.0, 214.0)
[INFO]   Rounded: (204, 268)
[INFO] Successfully plotted 18 out of 18 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] File size: 186438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(230/252) - Original Sharpe: 0.2229, Trades: 12
[INFO] Kmeans cluster 2: SMA(24/68) - Original Sharpe: 0.0760, Trades: 42
[INFO] Kmeans cluster 3: SMA(204/268) - Original Sharpe: -0.0314, Trades: 10
[INFO] Kmeans cluster 4: SMA(30/132) - Original Sharpe: -0.1388, Trades: 24
[INFO] Kmeans cluster 5: SMA(40/72) - Original Sharpe: -0.1418, Trades: 32
[INFO] Trimmed warm-up period. Evaluation data length: 2811
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (230/252) - Sharpe: 0.2229
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] File size: 186438 bytes
[INFO] Out-of-sample period starts on: 2021-09-21
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-21 2021-09-21            44    -0.805050            3.374280
1    2021-11-21 2021-11-21            43    -3.658865           -0.559921
2    2022-01-21 2022-01-21            41    -3.169670            0.135712
3    2022-03-21 2022-03-21            44    -2.653829           -0.610308
4    2022-05-21 2022-05-21            43    -0.674806            2.464155
5    2022-07-21 2022-07-21            44     2.031682            0.643163
6    2022-09-21 2022-09-21            43     1.062687            0.766913
7    2022-11-21 2022-11-21            43     3.891653            3.891653
8    2023-01-21 2023-01-21            41     2.035036           -1.158953
9    2023-03-21 2023-03-21            43    -0.328875            3.614602
10   2023-05-21 2023-05-21            44     4.995280            4.995280
11   2023-07-21 2023-07-21            42    -2.139299            1.023261
12   2023-09-21 2023-09-21            43    -2.742992            0.857398
13   2023-11-21 2023-11-21            42     2.723792            2.723792
14   2024-01-21 2024-01-21            43     2.153976            2.153976
15   2024-03-21 2024-03-21            42    -3.174471            1.190655
16   2024-05-21 2024-05-21            43    -0.220985           -0.220985
17   2024-07-21 2024-07-21            45     1.033071           -1.396810
18   2024-09-21 2024-09-21            43     0.907216           -0.295040
19   2024-11-21 2024-11-21            28    -0.090414           -0.071379
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-21   |         -0.8 |              3.4 |          4.2 | True          
[INFO] 2021-11-21   |         -3.7 |             -0.6 |          3.1 | True          
[INFO] 2022-01-21   |         -3.2 |              0.1 |          3.3 | True          
[INFO] 2022-03-21   |         -2.7 |             -0.6 |          2.1 | True          
[INFO] 2022-05-21   |         -0.7 |              2.5 |          3.2 | True          
[INFO] 2022-07-21   |          2.0 |              0.6 |         -1.4 | False         
[INFO] 2022-09-21   |          1.1 |              0.8 |         -0.3 | False         
[INFO] 2022-11-21   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2023-01-21   |          2.0 |             -1.2 |         -3.2 | False         
[INFO] 2023-03-21   |         -0.3 |              3.6 |          3.9 | True          
[INFO] 2023-05-21   |          5.0 |              5.0 |          0.0 | Excluded      
[INFO] 2023-07-21   |         -2.1 |              1.0 |          3.1 | True          
[INFO] 2023-09-21   |         -2.7 |              0.9 |          3.6 | True          
[INFO] 2023-11-21   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2024-01-21   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-03-21   |         -3.2 |              1.2 |          4.4 | True          
[INFO] 2024-05-21   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2024-07-21   |          1.0 |             -1.4 |         -2.4 | False         
[INFO] 2024-09-21   |          0.9 |             -0.3 |         -1.2 | False         
[INFO] 2024-11-21   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-11-21, 2023-05-21, 2023-11-21, 2024-01-21, 2024-05-21, 2024-11-21
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 9 of 14 periods (64.29% win rate)
[INFO] Updating Excel file with Kmeans results for VX...
[INFO] Excel file updated successfully. Added VX with Kmeans win rate 64.3% in row 52
[INFO] Added best Sharpe parameters 20/26 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 26
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(230/252) - Original Sharpe: 0.2229
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'VX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.6423
[INFO] Kmeans Best out-of-sample Sharpe: -0.0801
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for VX...
[INFO] Excel file updated successfully. Added VX with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\VX
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 52.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6289 to 0.4981
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 0.498120
[INFO] Number of Trades: 112
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10372 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6289 to 0.4981
[INFO] Trades range: 10.0 to 319.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3877 to 2.8531
[INFO] Scaled Long SMA range: -2.7953 to 1.4389
[INFO] Scaled Sharpe ratio range: -2.2865 to 4.5954
[INFO] Scaled Trades range: -0.5516 to 19.0730
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10372 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5367
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 811 elements
[INFO] Cluster 1: 626 elements
[INFO] Cluster 2: 1262 elements
[INFO] Cluster 3: 195 elements
[INFO] Cluster 4: 1351 elements
[INFO] Cluster 5: 831 elements
[INFO] Cluster 6: 1375 elements
[INFO] Cluster 7: 19 elements
[INFO] Cluster 8: 461 elements
[INFO] Cluster 9: 313 elements
[INFO] Cluster 10: 856 elements
[INFO] Cluster 11: 765 elements
[INFO] Cluster 12: 686 elements
[INFO] Cluster 13: 651 elements
[INFO] Cluster 14: 170 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=26, Long SMA=134, Sharpe=-0.1669, Trades=22
[INFO] Cluster 1 cluster: Short SMA=76, Long SMA=104, Sharpe=-0.4481, Trades=28
[INFO] Cluster 2 cluster: Short SMA=96, Long SMA=146, Sharpe=-0.2823, Trades=17
[INFO] Cluster 3 cluster: Short SMA=26, Long SMA=36, Sharpe=-0.0472, Trades=80
[INFO] Cluster 4 cluster: Short SMA=200, Long SMA=262, Sharpe=-0.0464, Trades=10
[INFO] Cluster 5 cluster: Short SMA=24, Long SMA=224, Sharpe=-0.1756, Trades=18
[INFO] Cluster 6 cluster: Short SMA=96, Long SMA=248, Sharpe=-0.4381, Trades=10
[INFO] Cluster 8 cluster: Short SMA=32, Long SMA=66, Sharpe=-0.2048, Trades=42
[INFO] Cluster 9 cluster: Short SMA=264, Long SMA=286, Sharpe=-0.2594, Trades=12
[INFO] Cluster 10 cluster: Short SMA=140, Long SMA=256, Sharpe=-0.3501, Trades=10
[INFO] Cluster 11 cluster: Short SMA=158, Long SMA=196, Sharpe=-0.3428, Trades=12
[INFO] Cluster 12 cluster: Short SMA=78, Long SMA=192, Sharpe=-0.3146, Trades=14
[INFO] Cluster 13 cluster: Short SMA=46, Long SMA=262, Sharpe=-0.3084, Trades=10
[INFO] Cluster 14 cluster: Short SMA=234, Long SMA=250, Sharpe=0.1637, Trades=16
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=26, Sharpe=0.4981, Trades=112
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=234, Long SMA=250, Sharpe=0.1637, Trades=16
[INFO] Top 2: Short SMA=200, Long SMA=262, Sharpe=-0.0464, Trades=10
[INFO] Top 3: Short SMA=26, Long SMA=36, Sharpe=-0.0472, Trades=80
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 10353 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] File size: 186438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(234/250) - Original Sharpe: 0.1637, Trades: 16
[INFO] Hierarchical cluster 2: SMA(200/262) - Original Sharpe: -0.0464, Trades: 10
[INFO] Hierarchical cluster 3: SMA(26/36) - Original Sharpe: -0.0472, Trades: 80
[INFO] Hierarchical cluster 4: SMA(26/134) - Original Sharpe: -0.1669, Trades: 22
[INFO] Hierarchical cluster 5: SMA(24/224) - Original Sharpe: -0.1756, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2811
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 26
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\VX
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for W in column D: 15.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 169.07s
[INFO] Best parameters: Short SMA = 48, Long SMA = 50
[INFO] Best Sharpe ratio: 0.887053, Trades: 170
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_W_best_48/50 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @WBS=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.86 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $387,570.00
[INFO] Market Buy & Hold P&L: $-29,470.00
[INFO] Outperformance: $417,040.00
[INFO] Sharpe ratio (entire period, annualized): 0.439905
[INFO] Sharpe ratio (in-sample, annualized): 0.887053
[INFO] Sharpe ratio (out-of-sample, annualized): -0.550168
[INFO] Maximum Drawdown: $231,315.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 108
[INFO] Out-of-sample period trades: 62
[INFO] Total trades: 170
[INFO] In-sample P&L: $528,290.00
[INFO] Out-of-sample P&L: $-147,780.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.887053
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7249 to 0.8871
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.887053
[INFO] Number of Trades: 170
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7249 to 0.8871
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.3475 to 3.5609
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 14
[INFO] Using 14 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=14...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 882 elements
[INFO] Kmeans Cluster 1: 1135 elements
[INFO] Kmeans Cluster 2: 760 elements
[INFO] Kmeans Cluster 3: 752 elements
[INFO] Kmeans Cluster 4: 1070 elements
[INFO] Kmeans Cluster 5: 403 elements
[INFO] Kmeans Cluster 6: 468 elements
[INFO] Kmeans Cluster 7: 383 elements
[INFO] Kmeans Cluster 8: 829 elements
[INFO] Kmeans Cluster 9: 1147 elements
[INFO] Kmeans Cluster 10: 846 elements
[INFO] Kmeans Cluster 11: 593 elements
[INFO] Kmeans Cluster 12: 668 elements
[INFO] Kmeans Cluster 13: 649 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=39.01, Long SMA=97.88, Sharpe=0.3001
[INFO] Centroid 1: Short SMA=95.14, Long SMA=253.71, Sharpe=0.2130
[INFO] Centroid 2: Short SMA=46.51, Long SMA=143.50, Sharpe=0.0981
[INFO] Centroid 3: Short SMA=35.59, Long SMA=271.41, Sharpe=0.3513
[INFO] Centroid 4: Short SMA=184.50, Long SMA=245.92, Sharpe=0.2340
[INFO] Centroid 5: Short SMA=255.29, Long SMA=289.09, Sharpe=-0.1862
[INFO] Centroid 6: Short SMA=27.61, Long SMA=58.66, Sharpe=0.5287
[INFO] Centroid 7: Short SMA=93.26, Long SMA=131.61, Sharpe=-0.3596
[INFO] Centroid 8: Short SMA=144.26, Long SMA=196.76, Sharpe=0.3439
[INFO] Centroid 9: Short SMA=41.33, Long SMA=207.53, Sharpe=0.2114
[INFO] Centroid 10: Short SMA=136.33, Long SMA=276.55, Sharpe=0.0179
[INFO] Centroid 11: Short SMA=124.63, Long SMA=175.88, Sharpe=0.1078
[INFO] Centroid 12: Short SMA=100.46, Long SMA=152.99, Sharpe=-0.1213
[INFO] Centroid 13: Short SMA=223.66, Long SMA=265.61, Sharpe=0.0754
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8871, Trades=170
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=28, Long SMA=58, Sharpe=0.6037, Trades=62
[INFO] Kmeans Top 2: Short SMA=40, Long SMA=98, Sharpe=0.3919, Trades=30
[INFO] Kmeans Top 3: Short SMA=42, Long SMA=208, Sharpe=0.3593, Trades=20
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=272, Sharpe=0.2979, Trades=16
[INFO] Kmeans Top 5: Short SMA=94, Long SMA=254, Sharpe=0.2231, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}
[INFO]   Rounded: (39, 98)
[INFO]   Nearest: (40.0, 98.0)
[INFO]   Rounded: (95, 254)
[INFO]   Nearest: (96.0, 254.0)
[INFO]   Rounded: (47, 144)
[INFO]   Nearest: (46.0, 144.0)
[INFO]   Rounded: (36, 271)
[INFO]   Nearest: (36.0, 272.0)
[INFO]   Rounded: (185, 246)
[INFO]   Nearest: (184.0, 246.0)
[INFO]   Rounded: (255, 289)
[INFO]   Nearest: (256.0, 290.0)
[INFO]   Rounded: (28, 59)
[INFO]   Nearest: (28.0, 58.0)
[INFO]   Rounded: (93, 132)
[INFO]   Nearest: (94.0, 132.0)
[INFO]   Rounded: (144, 197)
[INFO]   Nearest: (144.0, 196.0)
[INFO]   Rounded: (41, 208)
[INFO]   Nearest: (42.0, 208.0)
[INFO]   Rounded: (136, 277)
[INFO]   Nearest: (136.0, 276.0)
[INFO]   Rounded: (125, 176)
[INFO]   Nearest: (124.0, 176.0)
[INFO]   Rounded: (100, 153)
[INFO]   Nearest: (100.0, 152.0)
[INFO]   Rounded: (224, 266)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(28/58) - Original Sharpe: 0.6037, Trades: 62
[INFO] Kmeans cluster 2: SMA(40/98) - Original Sharpe: 0.3919, Trades: 30
[INFO] Kmeans cluster 3: SMA(42/208) - Original Sharpe: 0.3593, Trades: 20
[INFO] Kmeans cluster 4: SMA(36/272) - Original Sharpe: 0.2979, Trades: 16
[INFO] Kmeans cluster 5: SMA(94/254) - Original Sharpe: 0.2231, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (28/58) - Sharpe: 0.6037
[INFO] cluster 2: (40/98) - Sharpe: 0.3919
[INFO] cluster 3: (42/208) - Sharpe: 0.3593
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.967409            1.759091
1    2021-11-14 2021-11-14            44    -3.438860           -1.956259
2    2022-01-14 2022-01-14            41     1.436141            2.467787
3    2022-03-14 2022-03-14            44    -2.274052            0.417722
4    2022-05-14 2022-05-14            43    -2.489614           -1.334296
5    2022-07-14 2022-07-14            44     1.425601            0.496186
6    2022-09-14 2022-09-14            43     0.424917           -2.011163
7    2022-11-14 2022-11-14            43    -1.042455           -0.256353
8    2023-01-14 2023-01-14            41     3.089660            1.763276
9    2023-03-14 2023-03-14            43    -2.849337            0.328012
10   2023-05-14 2023-05-14            44    -0.357970           -1.430473
11   2023-07-14 2023-07-14            44     5.884227            3.421500
12   2023-09-14 2023-09-14            43    -1.305448           -1.679372
13   2023-11-14 2023-11-14            42     1.296328            0.555225
14   2024-01-14 2024-01-14            43    -0.582105           -1.901329
15   2024-03-14 2024-03-14            42     0.280722           -0.063431
16   2024-05-14 2024-05-14            44    -5.328325           -1.682559
17   2024-07-14 2024-07-14            45     0.233819           -1.405821
18   2024-09-14 2024-09-14            43    -1.778911           -0.383473
19   2024-11-14 2024-11-14            33    -0.446965           -2.652793
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              1.8 |          3.8 | True          
[INFO] 2021-11-14   |         -3.4 |             -2.0 |          1.4 | True          
[INFO] 2022-01-14   |          1.4 |              2.5 |          1.1 | True          
[INFO] 2022-03-14   |         -2.3 |              0.4 |          2.7 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.3 |          1.2 | True          
[INFO] 2022-07-14   |          1.4 |              0.5 |         -0.9 | False         
[INFO] 2022-09-14   |          0.4 |             -2.0 |         -2.4 | False         
[INFO] 2022-11-14   |         -1.0 |             -0.3 |          0.7 | True          
[INFO] 2023-01-14   |          3.1 |              1.8 |         -1.3 | False         
[INFO] 2023-03-14   |         -2.8 |              0.3 |          3.1 | True          
[INFO] 2023-05-14   |         -0.4 |             -1.4 |         -1.0 | False         
[INFO] 2023-07-14   |          5.9 |              3.4 |         -2.5 | False         
[INFO] 2023-09-14   |         -1.3 |             -1.7 |         -0.4 | False         
[INFO] 2023-11-14   |          1.3 |              0.6 |         -0.7 | False         
[INFO] 2024-01-14   |         -0.6 |             -1.9 |         -1.3 | False         
[INFO] 2024-03-14   |          0.3 |             -0.1 |         -0.4 | False         
[INFO] 2024-05-14   |         -5.3 |             -1.7 |          3.6 | True          
[INFO] 2024-07-14   |          0.2 |             -1.4 |         -1.6 | False         
[INFO] 2024-09-14   |         -1.8 |             -0.4 |          1.4 | True          
[INFO] 2024-11-14   |         -0.4 |             -2.7 |         -2.3 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 9 of 20 periods (45.00% win rate)
[INFO] Updating Excel file with Kmeans results for W...
[INFO] Excel file updated successfully. Added W with Kmeans win rate 45.0% in row 53
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(28/58) - Original Sharpe: 0.6037
[INFO] Added cluster 2 to portfolio: SMA(40/98) - Original Sharpe: 0.3919
[INFO] Added cluster 3 to portfolio: SMA(42/208) - Original Sharpe: 0.3593
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'W_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1715
[INFO] Kmeans Best out-of-sample Sharpe: -0.5502
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for W...
[INFO] Excel file updated successfully. Added W with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\W
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7249 to 0.8871
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.887053
[INFO] Number of Trades: 170
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7249 to 0.8871
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.3475 to 3.5609
[INFO] Scaled Trades range: -0.7942 to 16.0301
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5985
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 13
[INFO] Using 13 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 13 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 103 elements
[INFO] Cluster 1: 528 elements
[INFO] Cluster 2: 1641 elements
[INFO] Cluster 3: 1013 elements
[INFO] Cluster 4: 2293 elements
[INFO] Cluster 5: 996 elements
[INFO] Cluster 6: 406 elements
[INFO] Cluster 7: 794 elements
[INFO] Cluster 8: 1128 elements
[INFO] Cluster 9: 699 elements
[INFO] Cluster 10: 344 elements
[INFO] Cluster 11: 283 elements
[INFO] Cluster 12: 357 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=42, Long SMA=44, Sharpe=0.5081, Trades=139
[INFO] Cluster 1 cluster: Short SMA=258, Long SMA=282, Sharpe=-0.1995, Trades=23
[INFO] Cluster 2 cluster: Short SMA=190, Long SMA=246, Sharpe=0.2384, Trades=17
[INFO] Cluster 3 cluster: Short SMA=142, Long SMA=280, Sharpe=-0.0288, Trades=14
[INFO] Cluster 4 cluster: Short SMA=94, Long SMA=228, Sharpe=0.2973, Trades=15
[INFO] Cluster 5 cluster: Short SMA=38, Long SMA=100, Sharpe=0.3015, Trades=32
[INFO] Cluster 6 cluster: Short SMA=28, Long SMA=58, Sharpe=0.6037, Trades=62
[INFO] Cluster 7 cluster: Short SMA=86, Long SMA=150, Sharpe=-0.1847, Trades=20
[INFO] Cluster 8 cluster: Short SMA=36, Long SMA=188, Sharpe=0.2759, Trades=22
[INFO] Cluster 9 cluster: Short SMA=32, Long SMA=274, Sharpe=0.2715, Trades=18
[INFO] Cluster 10 cluster: Short SMA=136, Long SMA=146, Sharpe=-0.0137, Trades=43
[INFO] Cluster 11 cluster: Short SMA=158, Long SMA=180, Sharpe=0.4847, Trades=27
[INFO] Cluster 12 cluster: Short SMA=90, Long SMA=132, Sharpe=-0.3618, Trades=22
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8871, Trades=170
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=28, Long SMA=58, Sharpe=0.6037, Trades=62
[INFO] Top 2: Short SMA=42, Long SMA=44, Sharpe=0.5081, Trades=139
[INFO] Top 3: Short SMA=158, Long SMA=180, Sharpe=0.4847, Trades=27
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 10585 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(28/58) - Original Sharpe: 0.6037, Trades: 62
[INFO] Hierarchical cluster 2: SMA(42/44) - Original Sharpe: 0.5081, Trades: 139
[INFO] Hierarchical cluster 3: SMA(158/180) - Original Sharpe: 0.4847, Trades: 27
[INFO] Hierarchical cluster 4: SMA(38/100) - Original Sharpe: 0.3015, Trades: 32
[INFO] Hierarchical cluster 5: SMA(94/228) - Original Sharpe: 0.2973, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (28/58) - Sharpe: 0.6037
[INFO] cluster 2: (42/44) - Sharpe: 0.5081
[INFO] cluster 3: (158/180) - Sharpe: 0.4847
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.967409            1.559157
1    2021-11-14 2021-11-14            44    -3.438860           -2.414661
2    2022-01-14 2022-01-14            41     1.436141            2.676298
3    2022-03-14 2022-03-14            44    -2.274052            0.389039
4    2022-05-14 2022-05-14            43    -2.489614           -1.721791
5    2022-07-14 2022-07-14            44     1.425601            2.499558
6    2022-09-14 2022-09-14            43     0.424917           -2.799983
7    2022-11-14 2022-11-14            43    -1.042455           -0.816761
8    2023-01-14 2023-01-14            41     3.089660           -0.087506
9    2023-03-14 2023-03-14            43    -2.849337           -0.440377
10   2023-05-14 2023-05-14            44    -0.357970           -0.932655
11   2023-07-14 2023-07-14            44     5.884227            1.916408
12   2023-09-14 2023-09-14            43    -1.305448           -1.894468
13   2023-11-14 2023-11-14            42     1.296328            1.458682
14   2024-01-14 2024-01-14            43    -0.582105            2.024982
15   2024-03-14 2024-03-14            42     0.280722            1.222062
16   2024-05-14 2024-05-14            44    -5.328325           -1.460350
17   2024-07-14 2024-07-14            45     0.233819           -0.667297
18   2024-09-14 2024-09-14            43    -1.778911            0.223527
19   2024-11-14 2024-11-14            33    -0.446965           -2.093205
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              1.6 |          3.6 | True          
[INFO] 2021-11-14   |         -3.4 |             -2.4 |          1.0 | True          
[INFO] 2022-01-14   |          1.4 |              2.7 |          1.3 | True          
[INFO] 2022-03-14   |         -2.3 |              0.4 |          2.7 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.7 |          0.8 | True          
[INFO] 2022-07-14   |          1.4 |              2.5 |          1.1 | True          
[INFO] 2022-09-14   |          0.4 |             -2.8 |         -3.2 | False         
[INFO] 2022-11-14   |         -1.0 |             -0.8 |          0.2 | True          
[INFO] 2023-01-14   |          3.1 |             -0.1 |         -3.2 | False         
[INFO] 2023-03-14   |         -2.8 |             -0.4 |          2.4 | True          
[INFO] 2023-05-14   |         -0.4 |             -0.9 |         -0.5 | False         
[INFO] 2023-07-14   |          5.9 |              1.9 |         -4.0 | False         
[INFO] 2023-09-14   |         -1.3 |             -1.9 |         -0.6 | False         
[INFO] 2023-11-14   |          1.3 |              1.5 |          0.2 | True          
[INFO] 2024-01-14   |         -0.6 |              2.0 |          2.6 | True          
[INFO] 2024-03-14   |          0.3 |              1.2 |          0.9 | True          
[INFO] 2024-05-14   |         -5.3 |             -1.5 |          3.8 | True          
[INFO] 2024-07-14   |          0.2 |             -0.7 |         -0.9 | False         
[INFO] 2024-09-14   |         -1.8 |              0.2 |          2.0 | True          
[INFO] 2024-11-14   |         -0.4 |             -2.1 |         -1.7 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Hierarchical cluster wins (rounded comparison): 13 of 20 periods (65.00% win rate)
[INFO] Updating Excel file with Hierarchical results for W...
[INFO] Excel file updated successfully. Added W with Hierarchical win rate 65.0% in row 53
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(28/58) - Original Sharpe: 0.6037
[INFO] Added cluster 2 to portfolio: SMA(42/44) - Original Sharpe: 0.5081
[INFO] Added cluster 3 to portfolio: SMA(158/180) - Original Sharpe: 0.4847
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'W_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1305
[INFO] Hierarchical Best out-of-sample Sharpe: -0.5502
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for W...
[INFO] Excel file updated successfully. Added W with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\W
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for WBS in column D: 17.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 169.61s
[INFO] Best parameters: Short SMA = 48, Long SMA = 50
[INFO] Best Sharpe ratio: 0.885528, Trades: 170
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_WBS_best_48/50 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @WBS=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.86 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $386,182.00
[INFO] Market Buy & Hold P&L: $-29,470.00
[INFO] Outperformance: $415,652.00
[INFO] Sharpe ratio (entire period, annualized): 0.438437
[INFO] Sharpe ratio (in-sample, annualized): 0.885528
[INFO] Sharpe ratio (out-of-sample, annualized): -0.551536
[INFO] Maximum Drawdown: $231,617.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 108
[INFO] Out-of-sample period trades: 62
[INFO] Total trades: 170
[INFO] In-sample P&L: $527,382.00
[INFO] Out-of-sample P&L: $-148,144.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.885528
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7259 to 0.8855
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.885528
[INFO] Number of Trades: 170
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7259 to 0.8855
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.3515 to 3.5551
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 690 elements
[INFO] Kmeans Cluster 1: 750 elements
[INFO] Kmeans Cluster 2: 578 elements
[INFO] Kmeans Cluster 3: 624 elements
[INFO] Kmeans Cluster 4: 453 elements
[INFO] Kmeans Cluster 5: 768 elements
[INFO] Kmeans Cluster 6: 678 elements
[INFO] Kmeans Cluster 7: 1041 elements
[INFO] Kmeans Cluster 8: 1050 elements
[INFO] Kmeans Cluster 9: 383 elements
[INFO] Kmeans Cluster 10: 867 elements
[INFO] Kmeans Cluster 11: 674 elements
[INFO] Kmeans Cluster 12: 876 elements
[INFO] Kmeans Cluster 13: 752 elements
[INFO] Kmeans Cluster 14: 401 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=86.41, Long SMA=272.53, Sharpe=0.1232
[INFO] Centroid 1: Short SMA=47.06, Long SMA=142.01, Sharpe=0.1001
[INFO] Centroid 2: Short SMA=120.75, Long SMA=174.99, Sharpe=0.1216
[INFO] Centroid 3: Short SMA=225.21, Long SMA=266.23, Sharpe=0.0797
[INFO] Centroid 4: Short SMA=27.42, Long SMA=58.43, Sharpe=0.5329
[INFO] Centroid 5: Short SMA=35.97, Long SMA=271.25, Sharpe=0.3490
[INFO] Centroid 6: Short SMA=151.47, Long SMA=194.13, Sharpe=0.3532
[INFO] Centroid 7: Short SMA=38.71, Long SMA=203.90, Sharpe=0.2156
[INFO] Centroid 8: Short SMA=184.86, Long SMA=246.03, Sharpe=0.2347
[INFO] Centroid 9: Short SMA=93.26, Long SMA=131.61, Sharpe=-0.3599
[INFO] Centroid 10: Short SMA=101.29, Long SMA=235.22, Sharpe=0.2615
[INFO] Centroid 11: Short SMA=99.78, Long SMA=152.78, Sharpe=-0.1194
[INFO] Centroid 12: Short SMA=38.86, Long SMA=96.29, Sharpe=0.3042
[INFO] Centroid 13: Short SMA=149.25, Long SMA=269.24, Sharpe=0.0066
[INFO] Centroid 14: Short SMA=255.61, Long SMA=289.04, Sharpe=-0.1869
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8855, Trades=170
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=28, Long SMA=58, Sharpe=0.6031, Trades=62
[INFO] Kmeans Top 2: Short SMA=40, Long SMA=98, Sharpe=0.3916, Trades=30
[INFO] Kmeans Top 3: Short SMA=102, Long SMA=234, Sharpe=0.3356, Trades=15
[INFO] Kmeans Top 4: Short SMA=152, Long SMA=194, Sharpe=0.3294, Trades=17
[INFO] Kmeans Top 5: Short SMA=38, Long SMA=204, Sharpe=0.3081, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (86, 273)
[INFO]   Nearest: (86.0, 272.0)
[INFO]   Rounded: (47, 142)
[INFO]   Nearest: (48.0, 142.0)
[INFO]   Rounded: (121, 175)
[INFO]   Nearest: (120.0, 174.0)
[INFO]   Rounded: (225, 266)
[INFO]   Nearest: (226.0, 266.0)
[INFO]   Rounded: (27, 58)
[INFO]   Nearest: (28.0, 58.0)
[INFO]   Rounded: (36, 271)
[INFO]   Nearest: (36.0, 272.0)
[INFO]   Rounded: (151, 194)
[INFO]   Nearest: (152.0, 194.0)
[INFO]   Rounded: (39, 204)
[INFO]   Nearest: (38.0, 204.0)
[INFO]   Rounded: (185, 246)
[INFO]   Nearest: (184.0, 246.0)
[INFO]   Rounded: (93, 132)
[INFO]   Nearest: (94.0, 132.0)
[INFO]   Rounded: (101, 235)
[INFO]   Nearest: (102.0, 236.0)
[INFO]   Rounded: (100, 153)
[INFO]   Nearest: (100.0, 152.0)
[INFO]   Rounded: (39, 96)
[INFO]   Nearest: (38.0, 96.0)
[INFO]   Rounded: (149, 269)
[INFO]   Nearest: (150.0, 270.0)
[INFO]   Rounded: (256, 289)
[INFO]   Nearest: (256.0, 290.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(28/58) - Original Sharpe: 0.6031, Trades: 62
[INFO] Kmeans cluster 2: SMA(40/98) - Original Sharpe: 0.3916, Trades: 30
[INFO] Kmeans cluster 3: SMA(102/234) - Original Sharpe: 0.3356, Trades: 15
[INFO] Kmeans cluster 4: SMA(152/194) - Original Sharpe: 0.3294, Trades: 17
[INFO] Kmeans cluster 5: SMA(38/204) - Original Sharpe: 0.3081, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (28/58) - Sharpe: 0.6031
[INFO] cluster 2: (40/98) - Sharpe: 0.3916
[INFO] cluster 3: (102/234) - Sharpe: 0.3356
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.969108            1.758366
1    2021-11-14 2021-11-14            44    -3.439143           -1.956495
2    2022-01-14 2022-01-14            41     1.435275            2.467583
3    2022-03-14 2022-03-14            44    -2.274282            0.417637
4    2022-05-14 2022-05-14            43    -2.490349           -1.334378
5    2022-07-14 2022-07-14            44     1.424645            0.495744
6    2022-09-14 2022-09-14            43     0.423005           -1.628354
7    2022-11-14 2022-11-14            43    -1.044126           -0.850383
8    2023-01-14 2023-01-14            41     3.087546            1.762836
9    2023-03-14 2023-03-14            43    -2.851713            0.327854
10   2023-05-14 2023-05-14            44    -0.359960           -1.430646
11   2023-07-14 2023-07-14            44     5.881769            1.059240
12   2023-09-14 2023-09-14            43    -1.305448           -2.580481
13   2023-11-14 2023-11-14            42     1.295824            0.488500
14   2024-01-14 2024-01-14            43    -0.582717            0.284861
15   2024-03-14 2024-03-14            42     0.280722            1.377026
16   2024-05-14 2024-05-14            44    -5.331792           -1.684247
17   2024-07-14 2024-07-14            45     0.232453           -1.102719
18   2024-09-14 2024-09-14            43    -1.780293            1.074335
19   2024-11-14 2024-11-14            33    -0.454091           -2.653228
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              1.8 |          3.8 | True          
[INFO] 2021-11-14   |         -3.4 |             -2.0 |          1.4 | True          
[INFO] 2022-01-14   |          1.4 |              2.5 |          1.1 | True          
[INFO] 2022-03-14   |         -2.3 |              0.4 |          2.7 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.3 |          1.2 | True          
[INFO] 2022-07-14   |          1.4 |              0.5 |         -0.9 | False         
[INFO] 2022-09-14   |          0.4 |             -1.6 |         -2.0 | False         
[INFO] 2022-11-14   |         -1.0 |             -0.9 |          0.1 | True          
[INFO] 2023-01-14   |          3.1 |              1.8 |         -1.3 | False         
[INFO] 2023-03-14   |         -2.9 |              0.3 |          3.2 | True          
[INFO] 2023-05-14   |         -0.4 |             -1.4 |         -1.0 | False         
[INFO] 2023-07-14   |          5.9 |              1.1 |         -4.8 | False         
[INFO] 2023-09-14   |         -1.3 |             -2.6 |         -1.3 | False         
[INFO] 2023-11-14   |          1.3 |              0.5 |         -0.8 | False         
[INFO] 2024-01-14   |         -0.6 |              0.3 |          0.9 | True          
[INFO] 2024-03-14   |          0.3 |              1.4 |          1.1 | True          
[INFO] 2024-05-14   |         -5.3 |             -1.7 |          3.6 | True          
[INFO] 2024-07-14   |          0.2 |             -1.1 |         -1.3 | False         
[INFO] 2024-09-14   |         -1.8 |              1.1 |          2.9 | True          
[INFO] 2024-11-14   |         -0.5 |             -2.7 |         -2.2 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 11 of 20 periods (55.00% win rate)
[INFO] Updating Excel file with Kmeans results for WBS...
[INFO] Excel file updated successfully. Added WBS with Kmeans win rate 55.0% in row 54
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(28/58) - Original Sharpe: 0.6031
[INFO] Added cluster 2 to portfolio: SMA(40/98) - Original Sharpe: 0.3916
[INFO] Added cluster 3 to portfolio: SMA(102/234) - Original Sharpe: 0.3356
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'WBS_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1423
[INFO] Kmeans Best out-of-sample Sharpe: -0.5515
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for WBS...
[INFO] Excel file updated successfully. Added WBS with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\WBS
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7259 to 0.8855
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.885528
[INFO] Number of Trades: 170
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7259 to 0.8855
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.3515 to 3.5551
[INFO] Scaled Trades range: -0.7942 to 16.0301
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5985
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 344 elements
[INFO] Cluster 1: 1616 elements
[INFO] Cluster 2: 1058 elements
[INFO] Cluster 3: 1272 elements
[INFO] Cluster 4: 1249 elements
[INFO] Cluster 5: 794 elements
[INFO] Cluster 6: 344 elements
[INFO] Cluster 7: 1274 elements
[INFO] Cluster 8: 173 elements
[INFO] Cluster 9: 84 elements
[INFO] Cluster 10: 699 elements
[INFO] Cluster 11: 816 elements
[INFO] Cluster 12: 357 elements
[INFO] Cluster 13: 131 elements
[INFO] Cluster 14: 19 elements
[INFO] Cluster 15: 355 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=136, Long SMA=146, Sharpe=-0.0141, Trades=43
[INFO] Cluster 1 cluster: Short SMA=42, Long SMA=198, Sharpe=0.3013, Trades=20
[INFO] Cluster 2 cluster: Short SMA=38, Long SMA=100, Sharpe=0.3012, Trades=32
[INFO] Cluster 3 cluster: Short SMA=134, Long SMA=198, Sharpe=0.1298, Trades=19
[INFO] Cluster 4 cluster: Short SMA=200, Long SMA=254, Sharpe=0.3223, Trades=16
[INFO] Cluster 5 cluster: Short SMA=86, Long SMA=150, Sharpe=-0.1850, Trades=20
[INFO] Cluster 6 cluster: Short SMA=30, Long SMA=50, Sharpe=0.5880, Trades=68
[INFO] Cluster 7 cluster: Short SMA=96, Long SMA=258, Sharpe=0.1706, Trades=13
[INFO] Cluster 8 cluster: Short SMA=254, Long SMA=260, Sharpe=0.0463, Trades=44
[INFO] Cluster 9 cluster: Short SMA=34, Long SMA=38, Sharpe=0.4874, Trades=119
[INFO] Cluster 10 cluster: Short SMA=32, Long SMA=274, Sharpe=0.2713, Trades=18
[INFO] Cluster 11 cluster: Short SMA=150, Long SMA=276, Sharpe=0.0401, Trades=16
[INFO] Cluster 12 cluster: Short SMA=90, Long SMA=132, Sharpe=-0.3621, Trades=22
[INFO] Cluster 13 cluster: Short SMA=176, Long SMA=184, Sharpe=0.3371, Trades=47
[INFO] Cluster 15 cluster: Short SMA=252, Long SMA=290, Sharpe=-0.2221, Trades=21
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8855, Trades=170
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=30, Long SMA=50, Sharpe=0.5880, Trades=68
[INFO] Top 2: Short SMA=34, Long SMA=38, Sharpe=0.4874, Trades=119
[INFO] Top 3: Short SMA=176, Long SMA=184, Sharpe=0.3371, Trades=47
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 10566 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(30/50) - Original Sharpe: 0.5880, Trades: 68
[INFO] Hierarchical cluster 2: SMA(34/38) - Original Sharpe: 0.4874, Trades: 119
[INFO] Hierarchical cluster 3: SMA(176/184) - Original Sharpe: 0.3371, Trades: 47
[INFO] Hierarchical cluster 4: SMA(200/254) - Original Sharpe: 0.3223, Trades: 16
[INFO] Hierarchical cluster 5: SMA(42/198) - Original Sharpe: 0.3013, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (30/50) - Sharpe: 0.5880
[INFO] cluster 2: (34/38) - Sharpe: 0.4874
[INFO] cluster 3: (176/184) - Sharpe: 0.3371
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.969108            2.555961
1    2021-11-14 2021-11-14            44    -3.439143           -3.515243
2    2022-01-14 2022-01-14            41     1.435275            3.000048
3    2022-03-14 2022-03-14            44    -2.274282           -0.983057
4    2022-05-14 2022-05-14            43    -2.490349           -1.208493
5    2022-07-14 2022-07-14            44     1.424645            2.199135
6    2022-09-14 2022-09-14            43     0.423005           -3.305890
7    2022-11-14 2022-11-14            43    -1.044126           -1.825403
8    2023-01-14 2023-01-14            41     3.087546            1.809027
9    2023-03-14 2023-03-14            43    -2.851713           -0.183323
10   2023-05-14 2023-05-14            44    -0.359960           -1.781673
11   2023-07-14 2023-07-14            44     5.881769            3.970634
12   2023-09-14 2023-09-14            43    -1.305448            0.237576
13   2023-11-14 2023-11-14            42     1.295824            0.465749
14   2024-01-14 2024-01-14            43    -0.582717            0.862258
15   2024-03-14 2024-03-14            42     0.280722           -0.240554
16   2024-05-14 2024-05-14            44    -5.331792           -1.851553
17   2024-07-14 2024-07-14            45     0.232453           -0.607799
18   2024-09-14 2024-09-14            43    -1.780293           -1.715654
19   2024-11-14 2024-11-14            33    -0.454091           -1.120320
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              2.6 |          4.6 | True          
[INFO] 2021-11-14   |         -3.4 |             -3.5 |         -0.1 | False         
[INFO] 2022-01-14   |          1.4 |              3.0 |          1.6 | True          
[INFO] 2022-03-14   |         -2.3 |             -1.0 |          1.3 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.2 |          1.3 | True          
[INFO] 2022-07-14   |          1.4 |              2.2 |          0.8 | True          
[INFO] 2022-09-14   |          0.4 |             -3.3 |         -3.7 | False         
[INFO] 2022-11-14   |         -1.0 |             -1.8 |         -0.8 | False         
[INFO] 2023-01-14   |          3.1 |              1.8 |         -1.3 | False         
[INFO] 2023-03-14   |         -2.9 |             -0.2 |          2.7 | True          
[INFO] 2023-05-14   |         -0.4 |             -1.8 |         -1.4 | False         
[INFO] 2023-07-14   |          5.9 |              4.0 |         -1.9 | False         
[INFO] 2023-09-14   |         -1.3 |              0.2 |          1.5 | True          
[INFO] 2023-11-14   |          1.3 |              0.5 |         -0.8 | False         
[INFO] 2024-01-14   |         -0.6 |              0.9 |          1.5 | True          
[INFO] 2024-03-14   |          0.3 |             -0.2 |         -0.5 | False         
[INFO] 2024-05-14   |         -5.3 |             -1.9 |          3.4 | True          
[INFO] 2024-07-14   |          0.2 |             -0.6 |         -0.8 | False         
[INFO] 2024-09-14   |         -1.8 |             -1.7 |          0.1 | True          
[INFO] 2024-11-14   |         -0.5 |             -1.1 |         -0.6 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 20 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for WBS...
[INFO] Excel file updated successfully. Added WBS with Hierarchical win rate 50.0% in row 54
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(30/50) - Original Sharpe: 0.5880
[INFO] Added cluster 2 to portfolio: SMA(34/38) - Original Sharpe: 0.4874
[INFO] Added cluster 3 to portfolio: SMA(176/184) - Original Sharpe: 0.3371
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'WBS_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1613
[INFO] Hierarchical Best out-of-sample Sharpe: -0.5515
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for WBS...
[INFO] Excel file updated successfully. Added WBS with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\WBS
