[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for AD in column D: 8.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 70.64s
[INFO] Best parameters: Short SMA = 106, Long SMA = 160
[INFO] Best Sharpe ratio: 0.627696, Trades: 22
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 711 bad combos; keeping 1845 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? False
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @AD
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.51 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $555,481.00
[INFO] Market Buy & Hold P&L: $-24,520.00
[INFO] Outperformance: $580,001.00
[INFO] Sharpe ratio (entire period, annualized): 0.632989
[INFO] Sharpe ratio (in-sample, annualized): 0.627696
[INFO] Sharpe ratio (out-of-sample, annualized): 0.644916
[INFO] Maximum Drawdown: $102,820.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 14
[INFO] Out-of-sample period trades: 8
[INFO] Total trades: 22
[INFO] In-sample P&L: $318,183.00
[INFO] Out-of-sample P&L: $140,738.00
[INFO] 
Best parameters from GA: Short SMA = 106, Long SMA = 160, Sharpe = 0.627696
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 22
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9874 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] Trades range: 10.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3635 to 2.7332
[INFO] Scaled Long SMA range: -2.7723 to 1.5199
[INFO] Scaled Sharpe ratio range: -3.8904 to 2.8778
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 78 elements
[INFO] Kmeans Cluster 1: 197 elements
[INFO] Kmeans Cluster 2: 327 elements
[INFO] Kmeans Cluster 3: 229 elements
[INFO] Kmeans Cluster 4: 182 elements
[INFO] Kmeans Cluster 5: 185 elements
[INFO] Kmeans Cluster 6: 141 elements
[INFO] Kmeans Cluster 7: 259 elements
[INFO] Kmeans Cluster 8: 275 elements
[INFO] Kmeans Cluster 9: 211 elements
[INFO] Kmeans Cluster 10: 311 elements
[INFO] Kmeans Cluster 11: 222 elements
[INFO] Kmeans Cluster 12: 171 elements
[INFO] Kmeans Cluster 13: 245 elements
[INFO] Kmeans Cluster 14: 151 elements
[INFO] Kmeans Cluster 15: 267 elements
[INFO] Kmeans Cluster 16: 260 elements
[INFO] Kmeans Cluster 17: 54 elements
[INFO] Kmeans Cluster 18: 318 elements
[INFO] Kmeans Cluster 19: 130 elements
[INFO] Kmeans Cluster 20: 198 elements
[INFO] Kmeans Cluster 21: 102 elements
[INFO] Kmeans Cluster 22: 174 elements
[INFO] Kmeans Cluster 23: 114 elements
[INFO] Kmeans Cluster 24: 128 elements
[INFO] Kmeans Cluster 25: 151 elements
[INFO] Kmeans Cluster 26: 18 elements
[INFO] Kmeans Cluster 27: 265 elements
[INFO] Kmeans Cluster 28: 215 elements
[INFO] Kmeans Cluster 29: 229 elements
[INFO] Kmeans Cluster 30: 149 elements
[INFO] Kmeans Cluster 31: 175 elements
[INFO] Kmeans Cluster 32: 302 elements
[INFO] Kmeans Cluster 33: 228 elements
[INFO] Kmeans Cluster 34: 183 elements
[INFO] Kmeans Cluster 35: 148 elements
[INFO] Kmeans Cluster 36: 262 elements
[INFO] Kmeans Cluster 37: 189 elements
[INFO] Kmeans Cluster 38: 152 elements
[INFO] Kmeans Cluster 39: 201 elements
[INFO] Kmeans Cluster 40: 176 elements
[INFO] Kmeans Cluster 41: 212 elements
[INFO] Kmeans Cluster 42: 203 elements
[INFO] Kmeans Cluster 43: 177 elements
[INFO] Kmeans Cluster 44: 216 elements
[INFO] Kmeans Cluster 45: 191 elements
[INFO] Kmeans Cluster 46: 219 elements
[INFO] Kmeans Cluster 47: 279 elements
[INFO] Kmeans Cluster 48: 274 elements
[INFO] Kmeans Cluster 49: 131 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=128.54, Long SMA=143.92, Sharpe=0.1837
[INFO] Centroid 1: Short SMA=128.70, Long SMA=268.22, Sharpe=0.1069
[INFO] Centroid 2: Short SMA=47.61, Long SMA=200.36, Sharpe=-0.0764
[INFO] Centroid 3: Short SMA=147.71, Long SMA=249.18, Sharpe=-0.0840
[INFO] Centroid 4: Short SMA=54.48, Long SMA=136.05, Sharpe=-0.2167
[INFO] Centroid 5: Short SMA=218.16, Long SMA=266.55, Sharpe=0.0242
[INFO] Centroid 6: Short SMA=18.54, Long SMA=236.03, Sharpe=0.1643
[INFO] Centroid 7: Short SMA=138.30, Long SMA=183.43, Sharpe=0.2910
[INFO] Centroid 8: Short SMA=27.39, Long SMA=61.26, Sharpe=0.1444
[INFO] Centroid 9: Short SMA=208.20, Long SMA=234.67, Sharpe=0.0037
[INFO] Centroid 10: Short SMA=127.32, Long SMA=231.79, Sharpe=0.0554
[INFO] Centroid 11: Short SMA=93.94, Long SMA=187.24, Sharpe=0.3967
[INFO] Centroid 12: Short SMA=58.10, Long SMA=91.63, Sharpe=-0.1931
[INFO] Centroid 13: Short SMA=74.73, Long SMA=222.38, Sharpe=0.1070
[INFO] Centroid 14: Short SMA=25.88, Long SMA=178.94, Sharpe=0.0940
[INFO] Centroid 15: Short SMA=233.32, Long SMA=262.19, Sharpe=-0.0948
[INFO] Centroid 16: Short SMA=67.32, Long SMA=104.82, Sharpe=-0.3256
[INFO] Centroid 17: Short SMA=21.26, Long SMA=33.85, Sharpe=-0.0772
[INFO] Centroid 18: Short SMA=23.44, Long SMA=276.04, Sharpe=0.0298
[INFO] Centroid 19: Short SMA=188.38, Long SMA=215.03, Sharpe=-0.2351
[INFO] Centroid 20: Short SMA=199.35, Long SMA=248.27, Sharpe=0.1259
[INFO] Centroid 21: Short SMA=96.45, Long SMA=127.49, Sharpe=0.0109
[INFO] Centroid 22: Short SMA=134.67, Long SMA=202.02, Sharpe=0.1824
[INFO] Centroid 23: Short SMA=13.60, Long SMA=158.16, Sharpe=0.3086
[INFO] Centroid 24: Short SMA=28.23, Long SMA=50.80, Sharpe=0.2867
[INFO] Centroid 25: Short SMA=18.77, Long SMA=128.52, Sharpe=0.0898
[INFO] Centroid 27: Short SMA=105.10, Long SMA=163.47, Sharpe=0.5081
[INFO] Centroid 28: Short SMA=234.48, Long SMA=287.62, Sharpe=-0.1889
[INFO] Centroid 29: Short SMA=62.93, Long SMA=258.89, Sharpe=0.0982
[INFO] Centroid 30: Short SMA=45.68, Long SMA=284.94, Sharpe=0.1874
[INFO] Centroid 31: Short SMA=192.67, Long SMA=284.02, Sharpe=-0.0919
[INFO] Centroid 32: Short SMA=42.60, Long SMA=240.18, Sharpe=-0.0528
[INFO] Centroid 33: Short SMA=174.46, Long SMA=216.23, Sharpe=-0.0936
[INFO] Centroid 34: Short SMA=145.72, Long SMA=284.22, Sharpe=0.0314
[INFO] Centroid 35: Short SMA=70.56, Long SMA=98.24, Sharpe=-0.4620
[INFO] Centroid 36: Short SMA=172.15, Long SMA=255.39, Sharpe=0.0070
[INFO] Centroid 37: Short SMA=62.26, Long SMA=166.09, Sharpe=0.0983
[INFO] Centroid 38: Short SMA=16.39, Long SMA=206.28, Sharpe=0.2767
[INFO] Centroid 39: Short SMA=112.21, Long SMA=142.46, Sharpe=0.3680
[INFO] Centroid 40: Short SMA=87.69, Long SMA=119.58, Sharpe=-0.1123
[INFO] Centroid 41: Short SMA=169.12, Long SMA=195.69, Sharpe=0.0320
[INFO] Centroid 42: Short SMA=140.78, Long SMA=169.00, Sharpe=0.4270
[INFO] Centroid 43: Short SMA=32.44, Long SMA=78.43, Sharpe=0.0275
[INFO] Centroid 44: Short SMA=41.44, Long SMA=154.93, Sharpe=-0.0683
[INFO] Centroid 45: Short SMA=94.77, Long SMA=208.04, Sharpe=0.2570
[INFO] Centroid 46: Short SMA=30.06, Long SMA=108.79, Sharpe=-0.0715
[INFO] Centroid 47: Short SMA=265.18, Long SMA=286.68, Sharpe=-0.0352
[INFO] Centroid 48: Short SMA=93.64, Long SMA=245.58, Sharpe=0.2045
[INFO] Centroid 49: Short SMA=77.21, Long SMA=164.90, Sharpe=0.2527
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=22
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=104, Long SMA=164, Sharpe=0.5659, Trades=20
[INFO] Kmeans Top 2: Short SMA=140, Long SMA=168, Sharpe=0.4355, Trades=22
[INFO] Kmeans Top 3: Short SMA=94, Long SMA=188, Sharpe=0.4254, Trades=16
[INFO] Kmeans Top 4: Short SMA=112, Long SMA=142, Sharpe=0.4192, Trades=27
[INFO] Kmeans Top 5: Short SMA=14, Long SMA=160, Sharpe=0.3160, Trades=32
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (129, 144)
[INFO]   Nearest: (128.0, 144.0)
[INFO]   Rounded: (129, 268)
[INFO]   Nearest: (128.0, 268.0)
[INFO]   Rounded: (48, 200)
[INFO]   Rounded: (148, 249)
[INFO]   Nearest: (148.0, 250.0)
[INFO]   Rounded: (54, 136)
[INFO]   Rounded: (218, 267)
[INFO]   Nearest: (218.0, 266.0)
[INFO]   Rounded: (19, 236)
[INFO]   Nearest: (18.0, 236.0)
[INFO]   Rounded: (138, 183)
[INFO]   Nearest: (138.0, 184.0)
[INFO]   Rounded: (27, 61)
[INFO]   Nearest: (28.0, 62.0)
[INFO]   Rounded: (208, 235)
[INFO]   Nearest: (208.0, 234.0)
[INFO]   Rounded: (127, 232)
[INFO]   Nearest: (128.0, 232.0)
[INFO]   Rounded: (94, 187)
[INFO]   Nearest: (94.0, 188.0)
[INFO]   Rounded: (58, 92)
[INFO]   Rounded: (75, 222)
[INFO]   Nearest: (74.0, 222.0)
[INFO]   Rounded: (26, 179)
[INFO]   Nearest: (26.0, 178.0)
[INFO]   Rounded: (233, 262)
[INFO]   Nearest: (234.0, 262.0)
[INFO]   Rounded: (67, 105)
[INFO]   Nearest: (68.0, 104.0)
[INFO]   Rounded: (21, 34)
[INFO]   Nearest: (22.0, 34.0)
[INFO]   Rounded: (23, 276)
[INFO]   Nearest: (24.0, 276.0)
[INFO]   Rounded: (188, 215)
[INFO]   Nearest: (188.0, 216.0)
[INFO]   Rounded: (199, 248)
[INFO]   Nearest: (200.0, 248.0)
[INFO]   Rounded: (96, 127)
[INFO]   Nearest: (96.0, 128.0)
[INFO]   Rounded: (135, 202)
[INFO]   Nearest: (134.0, 202.0)
[INFO]   Rounded: (14, 158)
[INFO]   Rounded: (28, 51)
[INFO]   Nearest: (28.0, 50.0)
[INFO]   Rounded: (19, 129)
[INFO]   Nearest: (18.0, 128.0)
[INFO]   Rounded: (105, 163)
[INFO]   Nearest: (106.0, 164.0)
[INFO]   Rounded: (234, 288)
[INFO]   Rounded: (63, 259)
[INFO]   Nearest: (62.0, 258.0)
[INFO]   Rounded: (46, 285)
[INFO]   Nearest: (46.0, 284.0)
[INFO]   Rounded: (193, 284)
[INFO]   Nearest: (192.0, 284.0)
[INFO]   Rounded: (43, 240)
[INFO]   Nearest: (42.0, 240.0)
[INFO]   Rounded: (174, 216)
[INFO]   Rounded: (146, 284)
[INFO]   Rounded: (71, 98)
[INFO]   Nearest: (70.0, 98.0)
[INFO]   Rounded: (172, 255)
[INFO]   Nearest: (172.0, 256.0)
[INFO]   Rounded: (62, 166)
[INFO]   Rounded: (16, 206)
[INFO]   Rounded: (112, 142)
[INFO]   Rounded: (88, 120)
[INFO]   Rounded: (169, 196)
[INFO]   Nearest: (170.0, 196.0)
[INFO]   Rounded: (141, 169)
[INFO]   Nearest: (140.0, 168.0)
[INFO]   Rounded: (32, 78)
[INFO]   Rounded: (41, 155)
[INFO]   Nearest: (42.0, 154.0)
[INFO]   Rounded: (95, 208)
[INFO]   Nearest: (94.0, 208.0)
[INFO]   Rounded: (30, 109)
[INFO]   Nearest: (30.0, 108.0)
[INFO]   Rounded: (265, 287)
[INFO]   Nearest: (266.0, 286.0)
[INFO]   Rounded: (94, 246)
[INFO]   Rounded: (77, 165)
[INFO]   Nearest: (78.0, 164.0)
[INFO] Successfully plotted 49 out of 49 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(104/164) - Original Sharpe: 0.5659, Trades: 20
[INFO] Kmeans cluster 2: SMA(140/168) - Original Sharpe: 0.4355, Trades: 22
[INFO] Kmeans cluster 3: SMA(94/188) - Original Sharpe: 0.4254, Trades: 16
[INFO] Kmeans cluster 4: SMA(112/142) - Original Sharpe: 0.4192, Trades: 27
[INFO] Kmeans cluster 5: SMA(14/160) - Original Sharpe: 0.3160, Trades: 32
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (104/164) - Sharpe: 0.5659
[INFO] cluster 2: (140/168) - Sharpe: 0.4355
[INFO] cluster 3: (94/188) - Sharpe: 0.4254
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            0.551202
1    2021-11-14 2021-11-14            43     0.620829            0.620829
2    2022-01-14 2022-01-14            41     0.058063            0.058063
3    2022-03-14 2022-03-14            44     1.979608            1.979608
4    2022-05-14 2022-05-14            43    -1.220633            0.117255
5    2022-07-14 2022-07-14            44     0.448047            0.448047
6    2022-09-14 2022-09-14            43     0.790083            0.790083
7    2022-11-14 2022-11-14            43    -1.736792           -1.736792
8    2023-01-14 2023-01-14            41     2.493082            2.984725
9    2023-03-14 2023-03-14            44    -0.132668           -0.623035
10   2023-05-14 2023-05-14            44     0.580825            0.697290
11   2023-07-14 2023-07-14            44     4.541233            4.541233
12   2023-09-14 2023-09-14            43     0.691612            0.691612
13   2023-11-14 2023-11-14            42    -2.563801           -2.563801
14   2024-01-14 2024-01-14            43     4.073536            3.232900
15   2024-03-14 2024-03-14            42    -0.424007           -0.080170
16   2024-05-14 2024-05-14            44    -1.116674            1.585596
17   2024-07-14 2024-07-14            45     3.495207           -1.434941
18   2024-09-14 2024-09-14            43    -2.003748           -2.003748
19   2024-11-14 2024-11-14            33     3.170976           -1.192238
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -1.2 |              0.1 |          1.3 | True          
[INFO] 2022-07-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          2.5 |              3.0 |          0.5 | True          
[INFO] 2023-03-14   |         -0.1 |             -0.6 |         -0.5 | False         
[INFO] 2023-05-14   |          0.6 |              0.7 |          0.1 | True          
[INFO] 2023-07-14   |          4.5 |              4.5 |          0.0 | Excluded      
[INFO] 2023-09-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2024-01-14   |          4.1 |              3.2 |         -0.9 | False         
[INFO] 2024-03-14   |         -0.4 |             -0.1 |          0.3 | True          
[INFO] 2024-05-14   |         -1.1 |              1.6 |          2.7 | True          
[INFO] 2024-07-14   |          3.5 |             -1.4 |         -4.9 | False         
[INFO] 2024-09-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-11-14   |          3.2 |             -1.2 |         -4.4 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 5 of 9 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans win rate 55.6% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(104/164) - Original Sharpe: 0.5659
[INFO] Added cluster 2 to portfolio: SMA(140/168) - Original Sharpe: 0.4355
[INFO] Added cluster 3 to portfolio: SMA(94/188) - Original Sharpe: 0.4254
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.4118
[INFO] Kmeans Best out-of-sample Sharpe: 0.6449
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 22
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9874 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] Trades range: 10.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3635 to 2.7332
[INFO] Scaled Long SMA range: -2.7723 to 1.5199
[INFO] Scaled Sharpe ratio range: -3.8904 to 2.8778
[INFO] Scaled Trades range: -0.7421 to 14.7138
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9874 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5641
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 185 elements
[INFO] Cluster 1: 391 elements
[INFO] Cluster 2: 321 elements
[INFO] Cluster 3: 415 elements
[INFO] Cluster 4: 62 elements
[INFO] Cluster 5: 314 elements
[INFO] Cluster 6: 98 elements
[INFO] Cluster 7: 227 elements
[INFO] Cluster 8: 285 elements
[INFO] Cluster 9: 269 elements
[INFO] Cluster 10: 45 elements
[INFO] Cluster 11: 9 elements
[INFO] Cluster 12: 363 elements
[INFO] Cluster 13: 386 elements
[INFO] Cluster 14: 420 elements
[INFO] Cluster 15: 320 elements
[INFO] Cluster 16: 204 elements
[INFO] Cluster 17: 233 elements
[INFO] Cluster 18: 36 elements
[INFO] Cluster 19: 370 elements
[INFO] Cluster 20: 71 elements
[INFO] Cluster 21: 328 elements
[INFO] Cluster 22: 25 elements
[INFO] Cluster 23: 40 elements
[INFO] Cluster 24: 294 elements
[INFO] Cluster 25: 245 elements
[INFO] Cluster 26: 33 elements
[INFO] Cluster 27: 242 elements
[INFO] Cluster 28: 282 elements
[INFO] Cluster 29: 183 elements
[INFO] Cluster 30: 272 elements
[INFO] Cluster 31: 106 elements
[INFO] Cluster 32: 193 elements
[INFO] Cluster 33: 241 elements
[INFO] Cluster 34: 156 elements
[INFO] Cluster 35: 295 elements
[INFO] Cluster 36: 244 elements
[INFO] Cluster 37: 68 elements
[INFO] Cluster 38: 230 elements
[INFO] Cluster 39: 74 elements
[INFO] Cluster 40: 255 elements
[INFO] Cluster 41: 116 elements
[INFO] Cluster 42: 187 elements
[INFO] Cluster 43: 57 elements
[INFO] Cluster 44: 12 elements
[INFO] Cluster 45: 155 elements
[INFO] Cluster 46: 198 elements
[INFO] Cluster 47: 189 elements
[INFO] Cluster 48: 70 elements
[INFO] Cluster 49: 60 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=32, Long SMA=56, Sharpe=0.1933, Trades=66
[INFO] Cluster 1 cluster: Short SMA=52, Long SMA=164, Sharpe=0.0707, Trades=21
[INFO] Cluster 2 cluster: Short SMA=22, Long SMA=82, Sharpe=0.1277, Trades=46
[INFO] Cluster 3 cluster: Short SMA=94, Long SMA=232, Sharpe=0.2030, Trades=12
[INFO] Cluster 4 cluster: Short SMA=146, Long SMA=150, Sharpe=0.3705, Trades=76
[INFO] Cluster 5 cluster: Short SMA=88, Long SMA=188, Sharpe=0.3597, Trades=16
[INFO] Cluster 6 cluster: Short SMA=66, Long SMA=80, Sharpe=-0.3947, Trades=68
[INFO] Cluster 7 cluster: Short SMA=268, Long SMA=290, Sharpe=-0.0592, Trades=16
[INFO] Cluster 8 cluster: Short SMA=136, Long SMA=170, Sharpe=0.4235, Trades=20
[INFO] Cluster 9 cluster: Short SMA=56, Long SMA=98, Sharpe=-0.2678, Trades=39
[INFO] Cluster 10 cluster: Short SMA=46, Long SMA=50, Sharpe=-0.1409, Trades=132
[INFO] Cluster 12 cluster: Short SMA=224, Long SMA=286, Sharpe=-0.1259, Trades=12
[INFO] Cluster 13 cluster: Short SMA=224, Long SMA=270, Sharpe=-0.0797, Trades=16
[INFO] Cluster 14 cluster: Short SMA=168, Long SMA=262, Sharpe=0.0630, Trades=13
[INFO] Cluster 15 cluster: Short SMA=22, Long SMA=276, Sharpe=0.0127, Trades=24
[INFO] Cluster 16 cluster: Short SMA=86, Long SMA=126, Sharpe=-0.0077, Trades=29
[INFO] Cluster 17 cluster: Short SMA=40, Long SMA=146, Sharpe=-0.0482, Trades=24
[INFO] Cluster 18 cluster: Short SMA=32, Long SMA=38, Sharpe=0.2564, Trades=118
[INFO] Cluster 19 cluster: Short SMA=132, Long SMA=216, Sharpe=0.0913, Trades=15
[INFO] Cluster 20 cluster: Short SMA=196, Long SMA=200, Sharpe=-0.2224, Trades=47
[INFO] Cluster 21 cluster: Short SMA=48, Long SMA=222, Sharpe=-0.0986, Trades=20
[INFO] Cluster 22 cluster: Short SMA=36, Long SMA=38, Sharpe=0.2695, Trades=194
[INFO] Cluster 23 cluster: Short SMA=108, Long SMA=114, Sharpe=0.0573, Trades=72
[INFO] Cluster 24 cluster: Short SMA=54, Long SMA=274, Sharpe=0.1810, Trades=12
[INFO] Cluster 25 cluster: Short SMA=30, Long SMA=104, Sharpe=-0.0385, Trades=38
[INFO] Cluster 26 cluster: Short SMA=38, Long SMA=46, Sharpe=0.2736, Trades=92
[INFO] Cluster 27 cluster: Short SMA=198, Long SMA=246, Sharpe=0.1064, Trades=17
[INFO] Cluster 28 cluster: Short SMA=18, Long SMA=218, Sharpe=0.2753, Trades=26
[INFO] Cluster 29 cluster: Short SMA=186, Long SMA=214, Sharpe=-0.1823, Trades=19
[INFO] Cluster 30 cluster: Short SMA=98, Long SMA=168, Sharpe=0.5574, Trades=20
[INFO] Cluster 31 cluster: Short SMA=14, Long SMA=164, Sharpe=0.2813, Trades=30
[INFO] Cluster 32 cluster: Short SMA=168, Long SMA=202, Sharpe=0.0055, Trades=19
[INFO] Cluster 33 cluster: Short SMA=134, Long SMA=192, Sharpe=0.2328, Trades=18
[INFO] Cluster 34 cluster: Short SMA=62, Long SMA=114, Sharpe=-0.4367, Trades=31
[INFO] Cluster 35 cluster: Short SMA=134, Long SMA=278, Sharpe=0.1207, Trades=10
[INFO] Cluster 36 cluster: Short SMA=72, Long SMA=230, Sharpe=0.1160, Trades=16
[INFO] Cluster 37 cluster: Short SMA=130, Long SMA=146, Sharpe=0.2610, Trades=34
[INFO] Cluster 38 cluster: Short SMA=130, Long SMA=248, Sharpe=-0.0543, Trades=11
[INFO] Cluster 39 cluster: Short SMA=248, Long SMA=254, Sharpe=0.0996, Trades=42
[INFO] Cluster 40 cluster: Short SMA=40, Long SMA=188, Sharpe=0.0009, Trades=22
[INFO] Cluster 41 cluster: Short SMA=56, Long SMA=136, Sharpe=-0.2503, Trades=25
[INFO] Cluster 42 cluster: Short SMA=110, Long SMA=142, Sharpe=0.2572, Trades=27
[INFO] Cluster 43 cluster: Short SMA=142, Long SMA=150, Sharpe=0.2987, Trades=48
[INFO] Cluster 45 cluster: Short SMA=156, Long SMA=234, Sharpe=-0.1261, Trades=13
[INFO] Cluster 46 cluster: Short SMA=40, Long SMA=252, Sharpe=0.0066, Trades=20
[INFO] Cluster 47 cluster: Short SMA=210, Long SMA=238, Sharpe=0.0482, Trades=19
[INFO] Cluster 48 cluster: Short SMA=78, Long SMA=90, Sharpe=-0.2917, Trades=57
[INFO] Cluster 49 cluster: Short SMA=20, Long SMA=38, Sharpe=-0.1420, Trades=88
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=22
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=98, Long SMA=168, Sharpe=0.5574, Trades=20
[INFO] Top 2: Short SMA=136, Long SMA=170, Sharpe=0.4235, Trades=20
[INFO] Top 3: Short SMA=146, Long SMA=150, Sharpe=0.3705, Trades=76
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 9853 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(98/168) - Original Sharpe: 0.5574, Trades: 20
[INFO] Hierarchical cluster 2: SMA(136/170) - Original Sharpe: 0.4235, Trades: 20
[INFO] Hierarchical cluster 3: SMA(146/150) - Original Sharpe: 0.3705, Trades: 76
[INFO] Hierarchical cluster 4: SMA(88/188) - Original Sharpe: 0.3597, Trades: 16
[INFO] Hierarchical cluster 5: SMA(142/150) - Original Sharpe: 0.2987, Trades: 48
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (98/168) - Sharpe: 0.5574
[INFO] cluster 2: (136/170) - Sharpe: 0.4235
[INFO] cluster 3: (146/150) - Sharpe: 0.3705
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            0.551202
1    2021-11-14 2021-11-14            43     0.620829            0.620829
2    2022-01-14 2022-01-14            41     0.058063            0.058063
3    2022-03-14 2022-03-14            44     1.979608            2.054112
4    2022-05-14 2022-05-14            43    -1.220633            0.036652
5    2022-07-14 2022-07-14            44     0.448047            0.940266
6    2022-09-14 2022-09-14            43     0.790083            0.790083
7    2022-11-14 2022-11-14            43    -1.736792           -1.736792
8    2023-01-14 2023-01-14            41     2.493082            2.990355
9    2023-03-14 2023-03-14            44    -0.132668           -1.367119
10   2023-05-14 2023-05-14            44     0.580825           -1.261239
11   2023-07-14 2023-07-14            44     4.541233            3.994579
12   2023-09-14 2023-09-14            43     0.691612            0.324974
13   2023-11-14 2023-11-14            42    -2.563801           -2.235847
14   2024-01-14 2024-01-14            43     4.073536            1.531242
15   2024-03-14 2024-03-14            42    -0.424007           -0.080170
16   2024-05-14 2024-05-14            44    -1.116674           -1.596447
17   2024-07-14 2024-07-14            45     3.495207           -0.124020
18   2024-09-14 2024-09-14            43    -2.003748           -2.003748
19   2024-11-14 2024-11-14            33     3.170976           -0.031119
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          2.0 |              2.1 |          0.1 | True          
[INFO] 2022-05-14   |         -1.2 |              0.0 |          1.2 | True          
[INFO] 2022-07-14   |          0.4 |              0.9 |          0.5 | True          
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          2.5 |              3.0 |          0.5 | True          
[INFO] 2023-03-14   |         -0.1 |             -1.4 |         -1.3 | False         
[INFO] 2023-05-14   |          0.6 |             -1.3 |         -1.9 | False         
[INFO] 2023-07-14   |          4.5 |              4.0 |         -0.5 | False         
[INFO] 2023-09-14   |          0.7 |              0.3 |         -0.4 | False         
[INFO] 2023-11-14   |         -2.6 |             -2.2 |          0.4 | True          
[INFO] 2024-01-14   |          4.1 |              1.5 |         -2.6 | False         
[INFO] 2024-03-14   |         -0.4 |             -0.1 |          0.3 | True          
[INFO] 2024-05-14   |         -1.1 |             -1.6 |         -0.5 | False         
[INFO] 2024-07-14   |          3.5 |             -0.1 |         -3.6 | False         
[INFO] 2024-09-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-11-14   |          3.2 |             -0.0 |         -3.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-09-14, 2022-11-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 14 periods (42.86% win rate)
[INFO] Updating Excel file with Hierarchical results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical win rate 42.9% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(98/168) - Original Sharpe: 0.5574
[INFO] Added cluster 2 to portfolio: SMA(136/170) - Original Sharpe: 0.4235
[INFO] Added cluster 3 to portfolio: SMA(146/150) - Original Sharpe: 0.3705
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1991
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6449
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BO in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 72.83s
[INFO] Best parameters: Short SMA = 48, Long SMA = 54
[INFO] Best Sharpe ratio: 1.148397, Trades: 89
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 751 bad combos; keeping 1981 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BO
[INFO] Big Point Value (from data): 600.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 13.60 contracts
[INFO] Maximum Position Size: 31 contracts
[INFO] Strategy Total P&L: $553,098.00
[INFO] Market Buy & Hold P&L: $8,556.00
[INFO] Outperformance: $544,542.00
[INFO] Sharpe ratio (entire period, annualized): 0.651163
[INFO] Sharpe ratio (in-sample, annualized): 1.148397
[INFO] Sharpe ratio (out-of-sample, annualized): -0.439751
[INFO] Maximum Drawdown: $162,660.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 63
[INFO] Out-of-sample period trades: 26
[INFO] Total trades: 89
[INFO] In-sample P&L: $556,682.00
[INFO] Out-of-sample P&L: $-96,936.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 54, Sharpe = 1.148397
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 89
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9834 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3624 to 2.7150
[INFO] Scaled Long SMA range: -2.7630 to 1.5177
[INFO] Scaled Sharpe ratio range: -2.5920 to 4.1745
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 230 elements
[INFO] Kmeans Cluster 1: 230 elements
[INFO] Kmeans Cluster 2: 177 elements
[INFO] Kmeans Cluster 3: 190 elements
[INFO] Kmeans Cluster 4: 108 elements
[INFO] Kmeans Cluster 5: 230 elements
[INFO] Kmeans Cluster 6: 326 elements
[INFO] Kmeans Cluster 7: 237 elements
[INFO] Kmeans Cluster 8: 104 elements
[INFO] Kmeans Cluster 9: 256 elements
[INFO] Kmeans Cluster 10: 239 elements
[INFO] Kmeans Cluster 11: 235 elements
[INFO] Kmeans Cluster 12: 161 elements
[INFO] Kmeans Cluster 13: 326 elements
[INFO] Kmeans Cluster 14: 88 elements
[INFO] Kmeans Cluster 15: 63 elements
[INFO] Kmeans Cluster 16: 176 elements
[INFO] Kmeans Cluster 17: 258 elements
[INFO] Kmeans Cluster 18: 51 elements
[INFO] Kmeans Cluster 19: 244 elements
[INFO] Kmeans Cluster 20: 191 elements
[INFO] Kmeans Cluster 21: 241 elements
[INFO] Kmeans Cluster 22: 225 elements
[INFO] Kmeans Cluster 23: 182 elements
[INFO] Kmeans Cluster 24: 276 elements
[INFO] Kmeans Cluster 25: 241 elements
[INFO] Kmeans Cluster 26: 265 elements
[INFO] Kmeans Cluster 27: 201 elements
[INFO] Kmeans Cluster 28: 134 elements
[INFO] Kmeans Cluster 29: 175 elements
[INFO] Kmeans Cluster 30: 160 elements
[INFO] Kmeans Cluster 31: 229 elements
[INFO] Kmeans Cluster 32: 191 elements
[INFO] Kmeans Cluster 33: 149 elements
[INFO] Kmeans Cluster 34: 167 elements
[INFO] Kmeans Cluster 35: 258 elements
[INFO] Kmeans Cluster 36: 280 elements
[INFO] Kmeans Cluster 37: 138 elements
[INFO] Kmeans Cluster 38: 207 elements
[INFO] Kmeans Cluster 39: 321 elements
[INFO] Kmeans Cluster 40: 166 elements
[INFO] Kmeans Cluster 41: 201 elements
[INFO] Kmeans Cluster 42: 193 elements
[INFO] Kmeans Cluster 43: 263 elements
[INFO] Kmeans Cluster 44: 63 elements
[INFO] Kmeans Cluster 45: 119 elements
[INFO] Kmeans Cluster 46: 182 elements
[INFO] Kmeans Cluster 47: 179 elements
[INFO] Kmeans Cluster 48: 95 elements
[INFO] Kmeans Cluster 49: 213 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=54.52, Long SMA=194.92, Sharpe=-0.1909
[INFO] Centroid 1: Short SMA=174.61, Long SMA=249.98, Sharpe=0.1347
[INFO] Centroid 2: Short SMA=28.53, Long SMA=100.44, Sharpe=0.4065
[INFO] Centroid 3: Short SMA=82.05, Long SMA=104.14, Sharpe=-0.0701
[INFO] Centroid 4: Short SMA=41.09, Long SMA=64.11, Sharpe=0.9064
[INFO] Centroid 5: Short SMA=27.63, Long SMA=226.64, Sharpe=0.1390
[INFO] Centroid 6: Short SMA=90.64, Long SMA=226.18, Sharpe=0.0548
[INFO] Centroid 7: Short SMA=219.13, Long SMA=285.97, Sharpe=0.4634
[INFO] Centroid 8: Short SMA=263.38, Long SMA=286.17, Sharpe=-0.0022
[INFO] Centroid 9: Short SMA=24.60, Long SMA=281.40, Sharpe=0.3289
[INFO] Centroid 10: Short SMA=112.01, Long SMA=167.40, Sharpe=-0.1252
[INFO] Centroid 11: Short SMA=132.88, Long SMA=199.46, Sharpe=0.0834
[INFO] Centroid 12: Short SMA=67.66, Long SMA=94.45, Sharpe=0.0634
[INFO] Centroid 13: Short SMA=105.38, Long SMA=253.21, Sharpe=0.2035
[INFO] Centroid 14: Short SMA=29.05, Long SMA=47.95, Sharpe=0.4986
[INFO] Centroid 15: Short SMA=17.21, Long SMA=29.65, Sharpe=-0.1654
[INFO] Centroid 16: Short SMA=25.91, Long SMA=178.11, Sharpe=0.1346
[INFO] Centroid 17: Short SMA=29.31, Long SMA=68.04, Sharpe=0.7103
[INFO] Centroid 18: Short SMA=284.86, Long SMA=296.71, Sharpe=-0.2597
[INFO] Centroid 19: Short SMA=144.94, Long SMA=270.73, Sharpe=0.0599
[INFO] Centroid 20: Short SMA=73.59, Long SMA=152.79, Sharpe=-0.2705
[INFO] Centroid 21: Short SMA=59.31, Long SMA=220.31, Sharpe=-0.0803
[INFO] Centroid 22: Short SMA=49.56, Long SMA=286.76, Sharpe=0.1814
[INFO] Centroid 23: Short SMA=250.67, Long SMA=279.62, Sharpe=0.1569
[INFO] Centroid 24: Short SMA=29.64, Long SMA=150.36, Sharpe=0.2611
[INFO] Centroid 25: Short SMA=109.81, Long SMA=136.20, Sharpe=-0.0439
[INFO] Centroid 26: Short SMA=180.77, Long SMA=281.32, Sharpe=0.1701
[INFO] Centroid 27: Short SMA=198.04, Long SMA=237.09, Sharpe=0.2498
[INFO] Centroid 28: Short SMA=51.16, Long SMA=142.85, Sharpe=0.0055
[INFO] Centroid 29: Short SMA=224.11, Long SMA=250.82, Sharpe=0.4033
[INFO] Centroid 30: Short SMA=126.86, Long SMA=145.65, Sharpe=-0.2123
[INFO] Centroid 31: Short SMA=79.21, Long SMA=128.13, Sharpe=-0.1668
[INFO] Centroid 32: Short SMA=141.43, Long SMA=219.24, Sharpe=-0.1125
[INFO] Centroid 33: Short SMA=253.96, Long SMA=277.42, Sharpe=0.3187
[INFO] Centroid 34: Short SMA=29.71, Long SMA=97.56, Sharpe=0.5381
[INFO] Centroid 35: Short SMA=194.76, Long SMA=220.20, Sharpe=0.1583
[INFO] Centroid 36: Short SMA=142.52, Long SMA=244.25, Sharpe=0.0022
[INFO] Centroid 37: Short SMA=60.35, Long SMA=92.74, Sharpe=0.2413
[INFO] Centroid 38: Short SMA=24.72, Long SMA=252.01, Sharpe=0.2693
[INFO] Centroid 39: Short SMA=150.20, Long SMA=173.56, Sharpe=-0.0462
[INFO] Centroid 40: Short SMA=97.54, Long SMA=196.29, Sharpe=-0.1447
[INFO] Centroid 41: Short SMA=67.02, Long SMA=169.91, Sharpe=-0.3817
[INFO] Centroid 42: Short SMA=23.08, Long SMA=198.33, Sharpe=0.0116
[INFO] Centroid 43: Short SMA=173.04, Long SMA=204.73, Sharpe=0.0828
[INFO] Centroid 44: Short SMA=17.94, Long SMA=35.75, Sharpe=0.1452
[INFO] Centroid 45: Short SMA=201.19, Long SMA=271.85, Sharpe=0.3144
[INFO] Centroid 46: Short SMA=60.55, Long SMA=250.80, Sharpe=0.2061
[INFO] Centroid 47: Short SMA=24.69, Long SMA=131.18, Sharpe=0.4012
[INFO] Centroid 48: Short SMA=228.13, Long SMA=256.74, Sharpe=0.6049
[INFO] Centroid 49: Short SMA=98.78, Long SMA=191.18, Sharpe=-0.0155
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=54, Sharpe=1.1484, Trades=89
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=44, Long SMA=64, Sharpe=0.9054, Trades=50
[INFO] Kmeans Top 2: Short SMA=30, Long SMA=68, Sharpe=0.6192, Trades=36
[INFO] Kmeans Top 3: Short SMA=230, Long SMA=252, Sharpe=0.5651, Trades=22
[INFO] Kmeans Top 4: Short SMA=28, Long SMA=48, Sharpe=0.5328, Trades=66
[INFO] Kmeans Top 5: Short SMA=32, Long SMA=96, Sharpe=0.4908, Trades=30
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (55, 195)
[INFO]   Nearest: (54.0, 194.0)
[INFO]   Rounded: (175, 250)
[INFO]   Nearest: (174.0, 250.0)
[INFO]   Rounded: (29, 100)
[INFO]   Nearest: (28.0, 100.0)
[INFO]   Rounded: (82, 104)
[INFO]   Rounded: (41, 64)
[INFO]   Nearest: (42.0, 64.0)
[INFO]   Rounded: (28, 227)
[INFO]   Nearest: (28.0, 226.0)
[INFO]   Rounded: (91, 226)
[INFO]   Nearest: (90.0, 226.0)
[INFO]   Rounded: (219, 286)
[INFO]   Nearest: (220.0, 286.0)
[INFO]   Rounded: (263, 286)
[INFO]   Nearest: (264.0, 286.0)
[INFO]   Rounded: (25, 281)
[INFO]   Nearest: (24.0, 282.0)
[INFO]   Rounded: (112, 167)
[INFO]   Nearest: (112.0, 168.0)
[INFO]   Rounded: (133, 199)
[INFO]   Nearest: (132.0, 200.0)
[INFO]   Rounded: (68, 94)
[INFO]   Rounded: (105, 253)
[INFO]   Nearest: (106.0, 254.0)
[INFO]   Rounded: (29, 48)
[INFO]   Nearest: (30.0, 48.0)
[INFO]   Rounded: (17, 30)
[INFO]   Nearest: (18.0, 30.0)
[INFO]   Rounded: (26, 178)
[INFO]   Rounded: (29, 68)
[INFO]   Nearest: (30.0, 68.0)
[INFO]   Rounded: (285, 297)
[INFO]   Nearest: (284.0, 296.0)
[INFO]   Rounded: (145, 271)
[INFO]   Nearest: (144.0, 270.0)
[INFO]   Rounded: (74, 153)
[INFO]   Nearest: (74.0, 152.0)
[INFO]   Rounded: (59, 220)
[INFO]   Nearest: (60.0, 220.0)
[INFO]   Rounded: (50, 287)
[INFO]   Nearest: (50.0, 286.0)
[INFO]   Rounded: (251, 280)
[INFO]   Nearest: (250.0, 280.0)
[INFO]   Rounded: (30, 150)
[INFO]   Rounded: (110, 136)
[INFO]   Rounded: (181, 281)
[INFO]   Nearest: (180.0, 282.0)
[INFO]   Rounded: (198, 237)
[INFO]   Nearest: (198.0, 238.0)
[INFO]   Rounded: (51, 143)
[INFO]   Nearest: (52.0, 142.0)
[INFO]   Rounded: (224, 251)
[INFO]   Nearest: (224.0, 250.0)
[INFO]   Rounded: (127, 146)
[INFO]   Nearest: (126.0, 146.0)
[INFO]   Rounded: (79, 128)
[INFO]   Nearest: (80.0, 128.0)
[INFO]   Rounded: (141, 219)
[INFO]   Nearest: (142.0, 220.0)
[INFO]   Rounded: (254, 277)
[INFO]   Nearest: (254.0, 278.0)
[INFO]   Rounded: (30, 98)
[INFO]   Rounded: (195, 220)
[INFO]   Nearest: (194.0, 220.0)
[INFO]   Rounded: (143, 244)
[INFO]   Nearest: (142.0, 244.0)
[INFO]   Rounded: (60, 93)
[INFO]   Nearest: (60.0, 92.0)
[INFO]   Rounded: (25, 252)
[INFO]   Nearest: (24.0, 252.0)
[INFO]   Rounded: (150, 174)
[INFO]   Rounded: (98, 196)
[INFO]   Rounded: (67, 170)
[INFO]   Nearest: (68.0, 170.0)
[INFO]   Rounded: (23, 198)
[INFO]   Nearest: (24.0, 198.0)
[INFO]   Rounded: (173, 205)
[INFO]   Nearest: (174.0, 204.0)
[INFO]   Rounded: (18, 36)
[INFO]   Rounded: (201, 272)
[INFO]   Nearest: (202.0, 272.0)
[INFO]   Rounded: (61, 251)
[INFO]   Nearest: (60.0, 250.0)
[INFO]   Rounded: (25, 131)
[INFO]   Nearest: (24.0, 132.0)
[INFO]   Rounded: (228, 257)
[INFO]   Nearest: (228.0, 256.0)
[INFO]   Rounded: (99, 191)
[INFO]   Nearest: (98.0, 192.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 54
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(44/64) - Original Sharpe: 0.9054, Trades: 50
[INFO] Kmeans cluster 2: SMA(30/68) - Original Sharpe: 0.6192, Trades: 36
[INFO] Kmeans cluster 3: SMA(230/252) - Original Sharpe: 0.5651, Trades: 22
[INFO] Kmeans cluster 4: SMA(28/48) - Original Sharpe: 0.5328, Trades: 66
[INFO] Kmeans cluster 5: SMA(32/96) - Original Sharpe: 0.4908, Trades: 30
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/54)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (44/64) - Sharpe: 0.9054
[INFO] cluster 2: (30/68) - Sharpe: 0.6192
[INFO] cluster 3: (230/252) - Sharpe: 0.5651
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -3.408887           -3.100510
1    2021-11-10 2021-11-10            41    -4.249630           -2.455196
2    2022-01-10 2022-01-10            41     1.218137            2.013241
3    2022-03-10 2022-03-10            42     2.126254            2.226860
4    2022-05-10 2022-05-10            41    -5.000926           -4.723519
5    2022-07-10 2022-07-10            44    -0.790260           -0.794179
6    2022-09-10 2022-09-10            43     1.268514            3.602145
7    2022-11-10 2022-11-10            40    -2.869549           -1.881657
8    2023-01-10 2023-01-10            41     1.869806            2.198292
9    2023-03-10 2023-03-10            42     1.878823            1.030365
10   2023-05-10 2023-05-10            40    -1.601658           -1.389424
11   2023-07-10 2023-07-10            44     0.545769            0.125060
12   2023-09-10 2023-09-10            44     0.229410            2.095092
13   2023-11-10 2023-11-10            40     0.831968            0.831968
14   2024-01-10 2024-01-10            41     1.354455            1.637747
15   2024-03-10 2024-03-10            43    -1.598528           -4.040323
16   2024-05-10 2024-05-10            40     1.637085           -0.699818
17   2024-07-10 2024-07-10            43    -1.484568            0.265905
18   2024-09-10 2024-09-10            44     1.814989           -0.052099
19   2024-11-10 2024-11-10            35    -2.317816           -5.950780
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -3.4 |             -3.1 |          0.3 | True          
[INFO] 2021-11-10   |         -4.2 |             -2.5 |          1.7 | True          
[INFO] 2022-01-10   |          1.2 |              2.0 |          0.8 | True          
[INFO] 2022-03-10   |          2.1 |              2.2 |          0.1 | True          
[INFO] 2022-05-10   |         -5.0 |             -4.7 |          0.3 | True          
[INFO] 2022-07-10   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2022-09-10   |          1.3 |              3.6 |          2.3 | True          
[INFO] 2022-11-10   |         -2.9 |             -1.9 |          1.0 | True          
[INFO] 2023-01-10   |          1.9 |              2.2 |          0.3 | True          
[INFO] 2023-03-10   |          1.9 |              1.0 |         -0.9 | False         
[INFO] 2023-05-10   |         -1.6 |             -1.4 |          0.2 | True          
[INFO] 2023-07-10   |          0.5 |              0.1 |         -0.4 | False         
[INFO] 2023-09-10   |          0.2 |              2.1 |          1.9 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.4 |              1.6 |          0.2 | True          
[INFO] 2024-03-10   |         -1.6 |             -4.0 |         -2.4 | False         
[INFO] 2024-05-10   |          1.6 |             -0.7 |         -2.3 | False         
[INFO] 2024-07-10   |         -1.5 |              0.3 |          1.8 | True          
[INFO] 2024-09-10   |          1.8 |             -0.1 |         -1.9 | False         
[INFO] 2024-11-10   |         -2.3 |             -6.0 |         -3.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-10, 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 12 of 18 periods (66.67% win rate)
[INFO] Updating Excel file with Kmeans results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans win rate 66.7% in row 4
[INFO] Added best Sharpe parameters 48/54 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 54
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(44/64) - Original Sharpe: 0.9054
[INFO] Added cluster 2 to portfolio: SMA(30/68) - Original Sharpe: 0.6192
[INFO] Added cluster 3 to portfolio: SMA(230/252) - Original Sharpe: 0.5651
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BO_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1240
[INFO] Kmeans Best out-of-sample Sharpe: -0.4398
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BO
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 89
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9834 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3624 to 2.7150
[INFO] Scaled Long SMA range: -2.7630 to 1.5177
[INFO] Scaled Sharpe ratio range: -2.5920 to 4.1745
[INFO] Scaled Trades range: -0.7949 to 15.6625
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9834 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5858
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 340 elements
[INFO] Cluster 1: 90 elements
[INFO] Cluster 2: 213 elements
[INFO] Cluster 3: 310 elements
[INFO] Cluster 4: 382 elements
[INFO] Cluster 5: 479 elements
[INFO] Cluster 6: 362 elements
[INFO] Cluster 7: 300 elements
[INFO] Cluster 8: 23 elements
[INFO] Cluster 9: 50 elements
[INFO] Cluster 10: 446 elements
[INFO] Cluster 11: 316 elements
[INFO] Cluster 12: 93 elements
[INFO] Cluster 13: 359 elements
[INFO] Cluster 14: 346 elements
[INFO] Cluster 15: 333 elements
[INFO] Cluster 16: 354 elements
[INFO] Cluster 17: 262 elements
[INFO] Cluster 18: 44 elements
[INFO] Cluster 19: 274 elements
[INFO] Cluster 20: 71 elements
[INFO] Cluster 21: 480 elements
[INFO] Cluster 22: 44 elements
[INFO] Cluster 23: 44 elements
[INFO] Cluster 24: 106 elements
[INFO] Cluster 25: 6 elements
[INFO] Cluster 26: 296 elements
[INFO] Cluster 27: 421 elements
[INFO] Cluster 28: 416 elements
[INFO] Cluster 29: 125 elements
[INFO] Cluster 30: 12 elements
[INFO] Cluster 31: 156 elements
[INFO] Cluster 32: 24 elements
[INFO] Cluster 33: 39 elements
[INFO] Cluster 34: 248 elements
[INFO] Cluster 35: 111 elements
[INFO] Cluster 36: 121 elements
[INFO] Cluster 37: 13 elements
[INFO] Cluster 38: 198 elements
[INFO] Cluster 39: 32 elements
[INFO] Cluster 40: 179 elements
[INFO] Cluster 41: 78 elements
[INFO] Cluster 42: 208 elements
[INFO] Cluster 43: 245 elements
[INFO] Cluster 44: 219 elements
[INFO] Cluster 45: 41 elements
[INFO] Cluster 46: 175 elements
[INFO] Cluster 47: 31 elements
[INFO] Cluster 48: 57 elements
[INFO] Cluster 49: 262 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=24, Long SMA=186, Sharpe=0.1139, Trades=30
[INFO] Cluster 1 cluster: Short SMA=30, Long SMA=46, Sharpe=0.5812, Trades=70
[INFO] Cluster 2 cluster: Short SMA=254, Long SMA=288, Sharpe=0.1842, Trades=20
[INFO] Cluster 3 cluster: Short SMA=32, Long SMA=70, Sharpe=0.7812, Trades=38
[INFO] Cluster 4 cluster: Short SMA=90, Long SMA=126, Sharpe=-0.1403, Trades=26
[INFO] Cluster 5 cluster: Short SMA=98, Long SMA=218, Sharpe=0.0029, Trades=16
[INFO] Cluster 6 cluster: Short SMA=148, Long SMA=180, Sharpe=-0.0181, Trades=20
[INFO] Cluster 7 cluster: Short SMA=26, Long SMA=100, Sharpe=0.3490, Trades=30
[INFO] Cluster 8 cluster: Short SMA=22, Long SMA=26, Sharpe=0.0143, Trades=148
[INFO] Cluster 9 cluster: Short SMA=24, Long SMA=36, Sharpe=0.1100, Trades=86
[INFO] Cluster 10 cluster: Short SMA=218, Long SMA=274, Sharpe=0.5041, Trades=14
[INFO] Cluster 11 cluster: Short SMA=30, Long SMA=152, Sharpe=0.2654, Trades=26
[INFO] Cluster 12 cluster: Short SMA=198, Long SMA=204, Sharpe=0.1083, Trades=42
[INFO] Cluster 13 cluster: Short SMA=50, Long SMA=264, Sharpe=0.2242, Trades=10
[INFO] Cluster 14 cluster: Short SMA=160, Long SMA=212, Sharpe=0.0904, Trades=16
[INFO] Cluster 15 cluster: Short SMA=76, Long SMA=134, Sharpe=-0.1901, Trades=23
[INFO] Cluster 16 cluster: Short SMA=190, Long SMA=224, Sharpe=0.1549, Trades=16
[INFO] Cluster 17 cluster: Short SMA=90, Long SMA=198, Sharpe=-0.0669, Trades=20
[INFO] Cluster 18 cluster: Short SMA=264, Long SMA=268, Sharpe=0.1688, Trades=52
[INFO] Cluster 19 cluster: Short SMA=22, Long SMA=258, Sharpe=0.3267, Trades=18
[INFO] Cluster 20 cluster: Short SMA=248, Long SMA=254, Sharpe=0.2372, Trades=48
[INFO] Cluster 21 cluster: Short SMA=142, Long SMA=260, Sharpe=0.0462, Trades=10
[INFO] Cluster 22 cluster: Short SMA=22, Long SMA=46, Sharpe=0.3097, Trades=66
[INFO] Cluster 23 cluster: Short SMA=180, Long SMA=182, Sharpe=-0.0657, Trades=82
[INFO] Cluster 24 cluster: Short SMA=150, Long SMA=156, Sharpe=0.0285, Trades=48
[INFO] Cluster 26 cluster: Short SMA=72, Long SMA=168, Sharpe=-0.4065, Trades=22
[INFO] Cluster 27 cluster: Short SMA=102, Long SMA=250, Sharpe=0.2315, Trades=10
[INFO] Cluster 28 cluster: Short SMA=178, Long SMA=274, Sharpe=0.1082, Trades=10
[INFO] Cluster 29 cluster: Short SMA=88, Long SMA=100, Sharpe=-0.0705, Trades=41
[INFO] Cluster 31 cluster: Short SMA=254, Long SMA=276, Sharpe=0.2620, Trades=24
[INFO] Cluster 32 cluster: Short SMA=246, Long SMA=248, Sharpe=0.3374, Trades=74
[INFO] Cluster 33 cluster: Short SMA=46, Long SMA=58, Sharpe=0.9701, Trades=65
[INFO] Cluster 34 cluster: Short SMA=52, Long SMA=196, Sharpe=-0.2592, Trades=22
[INFO] Cluster 35 cluster: Short SMA=58, Long SMA=102, Sharpe=0.1465, Trades=23
[INFO] Cluster 36 cluster: Short SMA=138, Long SMA=224, Sharpe=-0.1283, Trades=16
[INFO] Cluster 38 cluster: Short SMA=26, Long SMA=220, Sharpe=0.1416, Trades=24
[INFO] Cluster 39 cluster: Short SMA=106, Long SMA=108, Sharpe=-0.0325, Trades=84
[INFO] Cluster 40 cluster: Short SMA=116, Long SMA=152, Sharpe=-0.2537, Trades=24
[INFO] Cluster 41 cluster: Short SMA=68, Long SMA=82, Sharpe=0.2526, Trades=45
[INFO] Cluster 42 cluster: Short SMA=194, Long SMA=252, Sharpe=0.2381, Trades=14
[INFO] Cluster 43 cluster: Short SMA=30, Long SMA=286, Sharpe=0.4272, Trades=12
[INFO] Cluster 44 cluster: Short SMA=34, Long SMA=124, Sharpe=0.3680, Trades=24
[INFO] Cluster 45 cluster: Short SMA=16, Long SMA=30, Sharpe=-0.4021, Trades=102
[INFO] Cluster 46 cluster: Short SMA=50, Long SMA=224, Sharpe=-0.1033, Trades=20
[INFO] Cluster 47 cluster: Short SMA=288, Long SMA=298, Sharpe=-0.3307, Trades=44
[INFO] Cluster 48 cluster: Short SMA=230, Long SMA=244, Sharpe=0.4999, Trades=30
[INFO] Cluster 49 cluster: Short SMA=112, Long SMA=174, Sharpe=-0.1331, Trades=20
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=54, Sharpe=1.1484, Trades=89
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=46, Long SMA=58, Sharpe=0.9701, Trades=65
[INFO] Top 2: Short SMA=32, Long SMA=70, Sharpe=0.7812, Trades=38
[INFO] Top 3: Short SMA=30, Long SMA=46, Sharpe=0.5812, Trades=70
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 9803 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 54
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(46/58) - Original Sharpe: 0.9701, Trades: 65
[INFO] Hierarchical cluster 2: SMA(32/70) - Original Sharpe: 0.7812, Trades: 38
[INFO] Hierarchical cluster 3: SMA(30/46) - Original Sharpe: 0.5812, Trades: 70
[INFO] Hierarchical cluster 4: SMA(218/274) - Original Sharpe: 0.5041, Trades: 14
[INFO] Hierarchical cluster 5: SMA(230/244) - Original Sharpe: 0.4999, Trades: 30
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/54)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (46/58) - Sharpe: 0.9701
[INFO] cluster 2: (32/70) - Sharpe: 0.7812
[INFO] cluster 3: (30/46) - Sharpe: 0.5812
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -3.408887           -3.011985
1    2021-11-10 2021-11-10            41    -4.249630           -3.681542
2    2022-01-10 2022-01-10            41     1.218137            0.614105
3    2022-03-10 2022-03-10            42     2.126254            2.126254
4    2022-05-10 2022-05-10            41    -5.000926           -4.561856
5    2022-07-10 2022-07-10            44    -0.790260           -1.220528
6    2022-09-10 2022-09-10            43     1.268514            1.793897
7    2022-11-10 2022-11-10            40    -2.869549           -2.698271
8    2023-01-10 2023-01-10            41     1.869806            2.821585
9    2023-03-10 2023-03-10            42     1.878823            1.878823
10   2023-05-10 2023-05-10            40    -1.601658           -1.838660
11   2023-07-10 2023-07-10            44     0.545769            0.545769
12   2023-09-10 2023-09-10            44     0.229410            0.547246
13   2023-11-10 2023-11-10            40     0.831968            0.493203
14   2024-01-10 2024-01-10            41     1.354455            1.633020
15   2024-03-10 2024-03-10            43    -1.598528           -2.679757
16   2024-05-10 2024-05-10            40     1.637085           -0.158051
17   2024-07-10 2024-07-10            43    -1.484568           -1.077636
18   2024-09-10 2024-09-10            44     1.814989            1.495754
19   2024-11-10 2024-11-10            35    -2.317816           -4.987295
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -3.4 |             -3.0 |          0.4 | True          
[INFO] 2021-11-10   |         -4.2 |             -3.7 |          0.5 | True          
[INFO] 2022-01-10   |          1.2 |              0.6 |         -0.6 | False         
[INFO] 2022-03-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -5.0 |             -4.6 |          0.4 | True          
[INFO] 2022-07-10   |         -0.8 |             -1.2 |         -0.4 | False         
[INFO] 2022-09-10   |          1.3 |              1.8 |          0.5 | True          
[INFO] 2022-11-10   |         -2.9 |             -2.7 |          0.2 | True          
[INFO] 2023-01-10   |          1.9 |              2.8 |          0.9 | True          
[INFO] 2023-03-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -1.6 |             -1.8 |         -0.2 | False         
[INFO] 2023-07-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-09-10   |          0.2 |              0.5 |          0.3 | True          
[INFO] 2023-11-10   |          0.8 |              0.5 |         -0.3 | False         
[INFO] 2024-01-10   |          1.4 |              1.6 |          0.2 | True          
[INFO] 2024-03-10   |         -1.6 |             -2.7 |         -1.1 | False         
[INFO] 2024-05-10   |          1.6 |             -0.2 |         -1.8 | False         
[INFO] 2024-07-10   |         -1.5 |             -1.1 |          0.4 | True          
[INFO] 2024-09-10   |          1.8 |              1.5 |         -0.3 | False         
[INFO] 2024-11-10   |         -2.3 |             -5.0 |         -2.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-10, 2023-03-10, 2023-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 9 of 17 periods (52.94% win rate)
[INFO] Updating Excel file with Hierarchical results for BO...
[INFO] Excel file updated successfully. Added BO with Hierarchical win rate 52.9% in row 4
[INFO] Added best Sharpe parameters 48/54 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 54
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(46/58) - Original Sharpe: 0.9701
[INFO] Added cluster 2 to portfolio: SMA(32/70) - Original Sharpe: 0.7812
[INFO] Added cluster 3 to portfolio: SMA(30/46) - Original Sharpe: 0.5812
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BO_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.4732
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4398
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for BO...
[INFO] Excel file updated successfully. Added BO with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BO
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BP in column D: 8.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 71.40s
[INFO] Best parameters: Short SMA = 42, Long SMA = 58
[INFO] Best Sharpe ratio: 0.774978, Trades: 55
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BP
[INFO] Big Point Value (from data): 62500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.80 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $603,751.00
[INFO] Market Buy & Hold P&L: $-29,593.75
[INFO] Outperformance: $633,344.75
[INFO] Sharpe ratio (entire period, annualized): 0.716232
[INFO] Sharpe ratio (in-sample, annualized): 0.774978
[INFO] Sharpe ratio (out-of-sample, annualized): 0.572860
[INFO] Maximum Drawdown: $88,641.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 39
[INFO] Out-of-sample period trades: 16
[INFO] Total trades: 55
[INFO] In-sample P&L: $424,013.75
[INFO] Out-of-sample P&L: $128,250.00
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 58, Sharpe = 0.774978
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 62500.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5932 to 0.7750
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 58
[INFO] Sharpe Ratio: 0.774978
[INFO] Number of Trades: 55
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5932 to 0.7750
[INFO] Trades range: 11.0 to 357.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.8418 to 3.9473
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 210 elements
[INFO] Kmeans Cluster 1: 339 elements
[INFO] Kmeans Cluster 2: 236 elements
[INFO] Kmeans Cluster 3: 275 elements
[INFO] Kmeans Cluster 4: 73 elements
[INFO] Kmeans Cluster 5: 219 elements
[INFO] Kmeans Cluster 6: 141 elements
[INFO] Kmeans Cluster 7: 116 elements
[INFO] Kmeans Cluster 8: 175 elements
[INFO] Kmeans Cluster 9: 204 elements
[INFO] Kmeans Cluster 10: 150 elements
[INFO] Kmeans Cluster 11: 165 elements
[INFO] Kmeans Cluster 12: 216 elements
[INFO] Kmeans Cluster 13: 94 elements
[INFO] Kmeans Cluster 14: 186 elements
[INFO] Kmeans Cluster 15: 159 elements
[INFO] Kmeans Cluster 16: 174 elements
[INFO] Kmeans Cluster 17: 249 elements
[INFO] Kmeans Cluster 18: 258 elements
[INFO] Kmeans Cluster 19: 189 elements
[INFO] Kmeans Cluster 20: 169 elements
[INFO] Kmeans Cluster 21: 471 elements
[INFO] Kmeans Cluster 22: 230 elements
[INFO] Kmeans Cluster 23: 183 elements
[INFO] Kmeans Cluster 24: 209 elements
[INFO] Kmeans Cluster 25: 263 elements
[INFO] Kmeans Cluster 26: 273 elements
[INFO] Kmeans Cluster 27: 275 elements
[INFO] Kmeans Cluster 28: 106 elements
[INFO] Kmeans Cluster 29: 247 elements
[INFO] Kmeans Cluster 30: 73 elements
[INFO] Kmeans Cluster 31: 325 elements
[INFO] Kmeans Cluster 32: 229 elements
[INFO] Kmeans Cluster 33: 245 elements
[INFO] Kmeans Cluster 34: 369 elements
[INFO] Kmeans Cluster 35: 253 elements
[INFO] Kmeans Cluster 36: 271 elements
[INFO] Kmeans Cluster 37: 68 elements
[INFO] Kmeans Cluster 38: 261 elements
[INFO] Kmeans Cluster 39: 268 elements
[INFO] Kmeans Cluster 40: 199 elements
[INFO] Kmeans Cluster 41: 200 elements
[INFO] Kmeans Cluster 42: 94 elements
[INFO] Kmeans Cluster 43: 302 elements
[INFO] Kmeans Cluster 44: 108 elements
[INFO] Kmeans Cluster 45: 258 elements
[INFO] Kmeans Cluster 46: 180 elements
[INFO] Kmeans Cluster 47: 211 elements
[INFO] Kmeans Cluster 48: 186 elements
[INFO] Kmeans Cluster 49: 231 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=167.07, Long SMA=273.22, Sharpe=0.2611
[INFO] Centroid 1: Short SMA=52.19, Long SMA=161.54, Sharpe=0.0864
[INFO] Centroid 2: Short SMA=145.22, Long SMA=178.84, Sharpe=-0.1514
[INFO] Centroid 3: Short SMA=59.97, Long SMA=279.16, Sharpe=0.0834
[INFO] Centroid 4: Short SMA=44.77, Long SMA=64.74, Sharpe=0.5706
[INFO] Centroid 5: Short SMA=204.43, Long SMA=242.05, Sharpe=0.0900
[INFO] Centroid 6: Short SMA=78.48, Long SMA=178.99, Sharpe=-0.1125
[INFO] Centroid 7: Short SMA=20.55, Long SMA=43.72, Sharpe=0.0896
[INFO] Centroid 8: Short SMA=22.07, Long SMA=286.79, Sharpe=0.4059
[INFO] Centroid 9: Short SMA=61.46, Long SMA=226.29, Sharpe=-0.0206
[INFO] Centroid 10: Short SMA=231.24, Long SMA=260.01, Sharpe=-0.0992
[INFO] Centroid 11: Short SMA=87.54, Long SMA=110.27, Sharpe=-0.0317
[INFO] Centroid 12: Short SMA=118.03, Long SMA=270.87, Sharpe=-0.1178
[INFO] Centroid 13: Short SMA=106.72, Long SMA=123.70, Sharpe=0.2574
[INFO] Centroid 14: Short SMA=172.62, Long SMA=195.40, Sharpe=0.0661
[INFO] Centroid 15: Short SMA=208.84, Long SMA=237.11, Sharpe=0.2865
[INFO] Centroid 16: Short SMA=269.01, Long SMA=288.33, Sharpe=-0.1279
[INFO] Centroid 17: Short SMA=32.47, Long SMA=85.09, Sharpe=0.4582
[INFO] Centroid 18: Short SMA=50.97, Long SMA=192.32, Sharpe=0.0027
[INFO] Centroid 19: Short SMA=20.46, Long SMA=140.01, Sharpe=0.3396
[INFO] Centroid 20: Short SMA=69.27, Long SMA=111.67, Sharpe=-0.1590
[INFO] Centroid 21: Short SMA=105.61, Long SMA=201.92, Sharpe=0.0615
[INFO] Centroid 22: Short SMA=23.03, Long SMA=258.90, Sharpe=0.2567
[INFO] Centroid 23: Short SMA=51.08, Long SMA=112.58, Sharpe=0.1714
[INFO] Centroid 24: Short SMA=114.73, Long SMA=157.46, Sharpe=0.0393
[INFO] Centroid 25: Short SMA=185.63, Long SMA=216.15, Sharpe=0.1538
[INFO] Centroid 26: Short SMA=152.11, Long SMA=204.34, Sharpe=-0.0672
[INFO] Centroid 27: Short SMA=20.07, Long SMA=182.89, Sharpe=0.1974
[INFO] Centroid 28: Short SMA=147.55, Long SMA=161.21, Sharpe=-0.2676
[INFO] Centroid 29: Short SMA=116.53, Long SMA=285.99, Sharpe=0.0042
[INFO] Centroid 30: Short SMA=21.67, Long SMA=38.79, Sharpe=-0.0823
[INFO] Centroid 31: Short SMA=101.56, Long SMA=162.55, Sharpe=-0.0342
[INFO] Centroid 32: Short SMA=195.98, Long SMA=283.14, Sharpe=-0.0233
[INFO] Centroid 33: Short SMA=250.90, Long SMA=285.10, Sharpe=-0.0123
[INFO] Centroid 34: Short SMA=86.66, Long SMA=238.22, Sharpe=0.0849
[INFO] Centroid 35: Short SMA=152.58, Long SMA=282.43, Sharpe=0.1018
[INFO] Centroid 36: Short SMA=37.25, Long SMA=247.70, Sharpe=0.1675
[INFO] Centroid 37: Short SMA=73.09, Long SMA=87.35, Sharpe=-0.3877
[INFO] Centroid 38: Short SMA=139.07, Long SMA=237.66, Sharpe=-0.1641
[INFO] Centroid 39: Short SMA=37.21, Long SMA=217.52, Sharpe=0.0785
[INFO] Centroid 40: Short SMA=117.64, Long SMA=240.96, Sharpe=-0.0290
[INFO] Centroid 41: Short SMA=223.42, Long SMA=283.79, Sharpe=0.0787
[INFO] Centroid 42: Short SMA=237.74, Long SMA=257.36, Sharpe=-0.2376
[INFO] Centroid 43: Short SMA=75.25, Long SMA=279.35, Sharpe=0.1673
[INFO] Centroid 44: Short SMA=22.43, Long SMA=52.94, Sharpe=0.2442
[INFO] Centroid 45: Short SMA=175.44, Long SMA=250.50, Sharpe=0.1852
[INFO] Centroid 46: Short SMA=43.07, Long SMA=73.03, Sharpe=0.3552
[INFO] Centroid 47: Short SMA=51.29, Long SMA=132.94, Sharpe=-0.0360
[INFO] Centroid 48: Short SMA=22.28, Long SMA=107.46, Sharpe=0.5466
[INFO] Centroid 49: Short SMA=94.94, Long SMA=128.21, Sharpe=0.1231
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=58, Sharpe=0.7750, Trades=55
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=44, Long SMA=64, Sharpe=0.6247, Trades=45
[INFO] Kmeans Top 2: Short SMA=22, Long SMA=106, Sharpe=0.5689, Trades=25
[INFO] Kmeans Top 3: Short SMA=32, Long SMA=86, Sharpe=0.4926, Trades=29
[INFO] Kmeans Top 4: Short SMA=22, Long SMA=288, Sharpe=0.3587, Trades=16
[INFO] Kmeans Top 5: Short SMA=20, Long SMA=140, Sharpe=0.3427, Trades=21
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (167, 273)
[INFO]   Nearest: (168.0, 274.0)
[INFO]   Rounded: (52, 162)
[INFO]   Rounded: (145, 179)
[INFO]   Nearest: (146.0, 178.0)
[INFO]   Rounded: (60, 279)
[INFO]   Nearest: (60.0, 280.0)
[INFO]   Rounded: (45, 65)
[INFO]   Nearest: (44.0, 64.0)
[INFO]   Rounded: (204, 242)
[INFO]   Rounded: (78, 179)
[INFO]   Nearest: (78.0, 178.0)
[INFO]   Rounded: (21, 44)
[INFO]   Nearest: (20.0, 44.0)
[INFO]   Rounded: (22, 287)
[INFO]   Nearest: (22.0, 286.0)
[INFO]   Rounded: (61, 226)
[INFO]   Nearest: (62.0, 226.0)
[INFO]   Rounded: (231, 260)
[INFO]   Nearest: (232.0, 260.0)
[INFO]   Rounded: (88, 110)
[INFO]   Rounded: (118, 271)
[INFO]   Nearest: (118.0, 270.0)
[INFO]   Rounded: (107, 124)
[INFO]   Nearest: (106.0, 124.0)
[INFO]   Rounded: (173, 195)
[INFO]   Nearest: (172.0, 196.0)
[INFO]   Rounded: (209, 237)
[INFO]   Nearest: (208.0, 238.0)
[INFO]   Rounded: (269, 288)
[INFO]   Nearest: (270.0, 288.0)
[INFO]   Rounded: (32, 85)
[INFO]   Nearest: (32.0, 86.0)
[INFO]   Rounded: (51, 192)
[INFO]   Nearest: (50.0, 192.0)
[INFO]   Rounded: (20, 140)
[INFO]   Rounded: (69, 112)
[INFO]   Nearest: (70.0, 112.0)
[INFO]   Rounded: (106, 202)
[INFO]   Rounded: (23, 259)
[INFO]   Nearest: (24.0, 258.0)
[INFO]   Rounded: (51, 113)
[INFO]   Nearest: (52.0, 112.0)
[INFO]   Rounded: (115, 157)
[INFO]   Nearest: (114.0, 158.0)
[INFO]   Rounded: (186, 216)
[INFO]   Rounded: (152, 204)
[INFO]   Rounded: (20, 183)
[INFO]   Nearest: (20.0, 182.0)
[INFO]   Rounded: (148, 161)
[INFO]   Nearest: (148.0, 162.0)
[INFO]   Rounded: (117, 286)
[INFO]   Nearest: (116.0, 286.0)
[INFO]   Rounded: (22, 39)
[INFO]   Nearest: (22.0, 38.0)
[INFO]   Rounded: (102, 163)
[INFO]   Nearest: (102.0, 162.0)
[INFO]   Rounded: (196, 283)
[INFO]   Nearest: (196.0, 284.0)
[INFO]   Rounded: (251, 285)
[INFO]   Nearest: (250.0, 286.0)
[INFO]   Rounded: (87, 238)
[INFO]   Nearest: (86.0, 238.0)
[INFO]   Rounded: (153, 282)
[INFO]   Nearest: (152.0, 282.0)
[INFO]   Rounded: (37, 248)
[INFO]   Nearest: (38.0, 248.0)
[INFO]   Rounded: (73, 87)
[INFO]   Nearest: (74.0, 88.0)
[INFO]   Rounded: (139, 238)
[INFO]   Nearest: (140.0, 238.0)
[INFO]   Rounded: (37, 218)
[INFO]   Nearest: (38.0, 218.0)
[INFO]   Rounded: (118, 241)
[INFO]   Nearest: (118.0, 240.0)
[INFO]   Rounded: (223, 284)
[INFO]   Nearest: (224.0, 284.0)
[INFO]   Rounded: (238, 257)
[INFO]   Nearest: (238.0, 258.0)
[INFO]   Rounded: (75, 279)
[INFO]   Nearest: (76.0, 280.0)
[INFO]   Rounded: (22, 53)
[INFO]   Nearest: (22.0, 52.0)
[INFO]   Rounded: (175, 251)
[INFO]   Nearest: (176.0, 250.0)
[INFO]   Rounded: (43, 73)
[INFO]   Nearest: (44.0, 74.0)
[INFO]   Rounded: (51, 133)
[INFO]   Nearest: (52.0, 132.0)
[INFO]   Rounded: (22, 107)
[INFO]   Nearest: (22.0, 108.0)
[INFO]   Rounded: (95, 128)
[INFO]   Nearest: (94.0, 128.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 58
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(44/64) - Original Sharpe: 0.6247, Trades: 45
[INFO] Kmeans cluster 2: SMA(22/106) - Original Sharpe: 0.5689, Trades: 25
[INFO] Kmeans cluster 3: SMA(32/86) - Original Sharpe: 0.4926, Trades: 29
[INFO] Kmeans cluster 4: SMA(22/288) - Original Sharpe: 0.3587, Trades: 16
[INFO] Kmeans cluster 5: SMA(20/140) - Original Sharpe: 0.3427, Trades: 21
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/58)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (44/64) - Sharpe: 0.6247
[INFO] cluster 2: (22/106) - Sharpe: 0.5689
[INFO] cluster 3: (32/86) - Sharpe: 0.4926
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.987883            2.470739
1    2021-11-14 2021-11-14            43    -2.596797           -2.596797
2    2022-01-14 2022-01-14            41    -0.015731           -1.817439
3    2022-03-14 2022-03-14            44     3.605243            3.521451
4    2022-05-14 2022-05-14            43     1.166814            1.166814
5    2022-07-14 2022-07-14            44     2.275295            2.275295
6    2022-09-14 2022-09-14            43     0.019017            0.019017
7    2022-11-14 2022-11-14            43    -0.093903            0.043375
8    2023-01-14 2023-01-14            41     1.898865           -1.837587
9    2023-03-14 2023-03-14            44    -0.658221           -0.291252
10   2023-05-14 2023-05-14            44     4.055520            4.055520
11   2023-07-14 2023-07-14            44    -5.179654           -4.770657
12   2023-09-14 2023-09-14            43     1.327473            1.327473
13   2023-11-14 2023-11-14            42    -1.340773           -1.117954
14   2024-01-14 2024-01-14            43    -2.266886            0.688363
15   2024-03-14 2024-03-14            42     2.522025           -2.687345
16   2024-05-14 2024-05-14            44    -0.336600            0.237958
17   2024-07-14 2024-07-14            45     0.798888            0.798888
18   2024-09-14 2024-09-14            43     0.601562           -0.761128
19   2024-11-14 2024-11-14            33     1.741863            1.741863
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              2.5 |          1.5 | True          
[INFO] 2021-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -0.0 |             -1.8 |         -1.8 | False         
[INFO] 2022-03-14   |          3.6 |              3.5 |         -0.1 | False         
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.1 |              0.0 |          0.1 | True          
[INFO] 2023-01-14   |          1.9 |             -1.8 |         -3.7 | False         
[INFO] 2023-03-14   |         -0.7 |             -0.3 |          0.4 | True          
[INFO] 2023-05-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -5.2 |             -4.8 |          0.4 | True          
[INFO] 2023-09-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -1.3 |             -1.1 |          0.2 | True          
[INFO] 2024-01-14   |         -2.3 |              0.7 |          3.0 | True          
[INFO] 2024-03-14   |          2.5 |             -2.7 |         -5.2 | False         
[INFO] 2024-05-14   |         -0.3 |              0.2 |          0.5 | True          
[INFO] 2024-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.6 |             -0.8 |         -1.4 | False         
[INFO] 2024-11-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-05-14, 2023-09-14, 2024-07-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 7 of 12 periods (58.33% win rate)
[INFO] Updating Excel file with Kmeans results for BP...
[INFO] Excel file updated successfully. Added BP with Kmeans win rate 58.3% in row 5
[INFO] Added best Sharpe parameters 42/58 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 58
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(44/64) - Original Sharpe: 0.6247
[INFO] Added cluster 2 to portfolio: SMA(22/106) - Original Sharpe: 0.5689
[INFO] Added cluster 3 to portfolio: SMA(32/86) - Original Sharpe: 0.4926
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BP_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3405
[INFO] Kmeans Best out-of-sample Sharpe: 0.5729
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for BP...
[INFO] Excel file updated successfully. Added BP with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BP
[INFO] Big Point Value: 62500.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5932 to 0.7750
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 58
[INFO] Sharpe Ratio: 0.774978
[INFO] Number of Trades: 55
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5932 to 0.7750
[INFO] Trades range: 11.0 to 357.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.8418 to 3.9473
[INFO] Scaled Trades range: -0.5447 to 17.8407
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4399
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 425 elements
[INFO] Cluster 1: 640 elements
[INFO] Cluster 2: 122 elements
[INFO] Cluster 3: 242 elements
[INFO] Cluster 4: 44 elements
[INFO] Cluster 5: 69 elements
[INFO] Cluster 6: 258 elements
[INFO] Cluster 7: 236 elements
[INFO] Cluster 8: 678 elements
[INFO] Cluster 9: 362 elements
[INFO] Cluster 10: 272 elements
[INFO] Cluster 11: 157 elements
[INFO] Cluster 12: 249 elements
[INFO] Cluster 13: 257 elements
[INFO] Cluster 14: 354 elements
[INFO] Cluster 15: 524 elements
[INFO] Cluster 16: 287 elements
[INFO] Cluster 17: 272 elements
[INFO] Cluster 18: 147 elements
[INFO] Cluster 19: 204 elements
[INFO] Cluster 20: 232 elements
[INFO] Cluster 21: 177 elements
[INFO] Cluster 22: 119 elements
[INFO] Cluster 23: 407 elements
[INFO] Cluster 24: 308 elements
[INFO] Cluster 25: 281 elements
[INFO] Cluster 26: 105 elements
[INFO] Cluster 27: 10 elements
[INFO] Cluster 28: 428 elements
[INFO] Cluster 29: 337 elements
[INFO] Cluster 30: 202 elements
[INFO] Cluster 31: 77 elements
[INFO] Cluster 32: 263 elements
[INFO] Cluster 33: 37 elements
[INFO] Cluster 34: 216 elements
[INFO] Cluster 35: 273 elements
[INFO] Cluster 36: 14 elements
[INFO] Cluster 37: 32 elements
[INFO] Cluster 38: 3 elements
[INFO] Cluster 39: 46 elements
[INFO] Cluster 40: 231 elements
[INFO] Cluster 41: 13 elements
[INFO] Cluster 42: 121 elements
[INFO] Cluster 43: 164 elements
[INFO] Cluster 44: 314 elements
[INFO] Cluster 45: 55 elements
[INFO] Cluster 46: 34 elements
[INFO] Cluster 47: 39 elements
[INFO] Cluster 48: 237 elements
[INFO] Cluster 49: 11 elements
[INFO] Using 45 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=74, Long SMA=200, Sharpe=-0.0093, Trades=14
[INFO] Cluster 1 cluster: Short SMA=72, Long SMA=272, Sharpe=0.1718, Trades=13
[INFO] Cluster 2 cluster: Short SMA=18, Long SMA=40, Sharpe=0.0390, Trades=77
[INFO] Cluster 3 cluster: Short SMA=62, Long SMA=118, Sharpe=-0.2032, Trades=21
[INFO] Cluster 4 cluster: Short SMA=114, Long SMA=116, Sharpe=0.0090, Trades=81
[INFO] Cluster 5 cluster: Short SMA=42, Long SMA=46, Sharpe=0.3136, Trades=115
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=284, Sharpe=0.3257, Trades=14
[INFO] Cluster 7 cluster: Short SMA=242, Long SMA=266, Sharpe=-0.1544, Trades=19
[INFO] Cluster 8 cluster: Short SMA=104, Long SMA=212, Sharpe=0.1087, Trades=14
[INFO] Cluster 9 cluster: Short SMA=30, Long SMA=248, Sharpe=0.1320, Trades=19
[INFO] Cluster 10 cluster: Short SMA=24, Long SMA=96, Sharpe=0.6073, Trades=29
[INFO] Cluster 11 cluster: Short SMA=86, Long SMA=104, Sharpe=0.2444, Trades=39
[INFO] Cluster 12 cluster: Short SMA=56, Long SMA=162, Sharpe=0.0439, Trades=17
[INFO] Cluster 13 cluster: Short SMA=144, Long SMA=172, Sharpe=-0.2206, Trades=20
[INFO] Cluster 14 cluster: Short SMA=150, Long SMA=202, Sharpe=-0.1117, Trades=12
[INFO] Cluster 15 cluster: Short SMA=182, Long SMA=234, Sharpe=0.0999, Trades=12
[INFO] Cluster 16 cluster: Short SMA=42, Long SMA=236, Sharpe=0.1172, Trades=19
[INFO] Cluster 17 cluster: Short SMA=236, Long SMA=282, Sharpe=0.0066, Trades=13
[INFO] Cluster 18 cluster: Short SMA=36, Long SMA=72, Sharpe=0.3774, Trades=43
[INFO] Cluster 19 cluster: Short SMA=32, Long SMA=112, Sharpe=0.3735, Trades=23
[INFO] Cluster 20 cluster: Short SMA=166, Long SMA=272, Sharpe=0.3623, Trades=13
[INFO] Cluster 21 cluster: Short SMA=72, Long SMA=120, Sharpe=-0.0659, Trades=19
[INFO] Cluster 22 cluster: Short SMA=210, Long SMA=236, Sharpe=0.2845, Trades=14
[INFO] Cluster 23 cluster: Short SMA=114, Long SMA=264, Sharpe=-0.1700, Trades=12
[INFO] Cluster 24 cluster: Short SMA=58, Long SMA=144, Sharpe=0.1157, Trades=17
[INFO] Cluster 25 cluster: Short SMA=20, Long SMA=186, Sharpe=0.2483, Trades=21
[INFO] Cluster 26 cluster: Short SMA=26, Long SMA=58, Sharpe=0.1090, Trades=53
[INFO] Cluster 28 cluster: Short SMA=102, Long SMA=160, Sharpe=-0.0366, Trades=18
[INFO] Cluster 29 cluster: Short SMA=140, Long SMA=234, Sharpe=-0.1603, Trades=12
[INFO] Cluster 30 cluster: Short SMA=188, Long SMA=202, Sharpe=0.1420, Trades=22
[INFO] Cluster 31 cluster: Short SMA=106, Long SMA=116, Sharpe=-0.1848, Trades=50
[INFO] Cluster 32 cluster: Short SMA=150, Long SMA=276, Sharpe=0.1468, Trades=13
[INFO] Cluster 33 cluster: Short SMA=194, Long SMA=196, Sharpe=-0.0893, Trades=60
[INFO] Cluster 34 cluster: Short SMA=100, Long SMA=130, Sharpe=0.1545, Trades=22
[INFO] Cluster 35 cluster: Short SMA=218, Long SMA=276, Sharpe=0.0735, Trades=13
[INFO] Cluster 37 cluster: Short SMA=48, Long SMA=54, Sharpe=0.4104, Trades=77
[INFO] Cluster 39 cluster: Short SMA=76, Long SMA=92, Sharpe=-0.5321, Trades=47
[INFO] Cluster 40 cluster: Short SMA=116, Long SMA=292, Sharpe=-0.0142, Trades=13
[INFO] Cluster 42 cluster: Short SMA=22, Long SMA=148, Sharpe=0.2367, Trades=19
[INFO] Cluster 43 cluster: Short SMA=274, Long SMA=284, Sharpe=-0.0344, Trades=25
[INFO] Cluster 44 cluster: Short SMA=40, Long SMA=200, Sharpe=0.0327, Trades=17
[INFO] Cluster 45 cluster: Short SMA=42, Long SMA=60, Sharpe=0.5796, Trades=53
[INFO] Cluster 46 cluster: Short SMA=270, Long SMA=272, Sharpe=-0.1811, Trades=51
[INFO] Cluster 47 cluster: Short SMA=154, Long SMA=160, Sharpe=-0.3481, Trades=34
[INFO] Cluster 48 cluster: Short SMA=196, Long SMA=284, Sharpe=-0.0450, Trades=13
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=58, Sharpe=0.7750, Trades=55
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=24, Long SMA=96, Sharpe=0.6073, Trades=29
[INFO] Top 2: Short SMA=42, Long SMA=60, Sharpe=0.5796, Trades=53
[INFO] Top 3: Short SMA=48, Long SMA=54, Sharpe=0.4104, Trades=77
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 45 valid clusters with clusters
[INFO] Filtering to 10534 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 58
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(24/96) - Original Sharpe: 0.6073, Trades: 29
[INFO] Hierarchical cluster 2: SMA(42/60) - Original Sharpe: 0.5796, Trades: 53
[INFO] Hierarchical cluster 3: SMA(48/54) - Original Sharpe: 0.4104, Trades: 77
[INFO] Hierarchical cluster 4: SMA(36/72) - Original Sharpe: 0.3774, Trades: 43
[INFO] Hierarchical cluster 5: SMA(32/112) - Original Sharpe: 0.3735, Trades: 23
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/58)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/96) - Sharpe: 0.6073
[INFO] cluster 2: (42/60) - Sharpe: 0.5796
[INFO] cluster 3: (48/54) - Sharpe: 0.4104
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.987883            2.738014
1    2021-11-14 2021-11-14            43    -2.596797           -2.596797
2    2022-01-14 2022-01-14            41    -0.015731           -1.440824
3    2022-03-14 2022-03-14            44     3.605243            3.605243
4    2022-05-14 2022-05-14            43     1.166814            1.166814
5    2022-07-14 2022-07-14            44     2.275295            2.275295
6    2022-09-14 2022-09-14            43     0.019017            0.019017
7    2022-11-14 2022-11-14            43    -0.093903            0.054652
8    2023-01-14 2023-01-14            41     1.898865           -1.388452
9    2023-03-14 2023-03-14            44    -0.658221           -1.279125
10   2023-05-14 2023-05-14            44     4.055520            4.055520
11   2023-07-14 2023-07-14            44    -5.179654           -5.594133
12   2023-09-14 2023-09-14            43     1.327473            1.013722
13   2023-11-14 2023-11-14            42    -1.340773           -1.621553
14   2024-01-14 2024-01-14            43    -2.266886           -1.582944
15   2024-03-14 2024-03-14            42     2.522025            1.503154
16   2024-05-14 2024-05-14            44    -0.336600            0.099506
17   2024-07-14 2024-07-14            45     0.798888            0.798888
18   2024-09-14 2024-09-14            43     0.601562            0.327296
19   2024-11-14 2024-11-14            33     1.741863            1.741863
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              2.7 |          1.7 | True          
[INFO] 2021-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -0.0 |             -1.4 |         -1.4 | False         
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.1 |              0.1 |          0.2 | True          
[INFO] 2023-01-14   |          1.9 |             -1.4 |         -3.3 | False         
[INFO] 2023-03-14   |         -0.7 |             -1.3 |         -0.6 | False         
[INFO] 2023-05-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -5.2 |             -5.6 |         -0.4 | False         
[INFO] 2023-09-14   |          1.3 |              1.0 |         -0.3 | False         
[INFO] 2023-11-14   |         -1.3 |             -1.6 |         -0.3 | False         
[INFO] 2024-01-14   |         -2.3 |             -1.6 |          0.7 | True          
[INFO] 2024-03-14   |          2.5 |              1.5 |         -1.0 | False         
[INFO] 2024-05-14   |         -0.3 |              0.1 |          0.4 | True          
[INFO] 2024-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.6 |              0.3 |         -0.3 | False         
[INFO] 2024-11-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-05-14, 2024-07-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 12 periods (33.33% win rate)
[INFO] Updating Excel file with Hierarchical results for BP...
[INFO] Excel file updated successfully. Added BP with Hierarchical win rate 33.3% in row 5
[INFO] Added best Sharpe parameters 42/58 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 58
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/96) - Original Sharpe: 0.6073
[INFO] Added cluster 2 to portfolio: SMA(42/60) - Original Sharpe: 0.5796
[INFO] Added cluster 3 to portfolio: SMA(48/54) - Original Sharpe: 0.4104
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BP_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3470
[INFO] Hierarchical Best out-of-sample Sharpe: 0.5729
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for BP...
[INFO] Excel file updated successfully. Added BP with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BP
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BRN in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.72s
[INFO] Best parameters: Short SMA = 10, Long SMA = 26
[INFO] Best Sharpe ratio: 1.115955, Trades: 106
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BRN=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.82 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $738,554.00
[INFO] Market Buy & Hold P&L: $-13,990.00
[INFO] Outperformance: $752,544.00
[INFO] Sharpe ratio (entire period, annualized): 0.960879
[INFO] Sharpe ratio (in-sample, annualized): 1.115955
[INFO] Sharpe ratio (out-of-sample, annualized): 0.618723
[INFO] Maximum Drawdown: $146,756.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 66
[INFO] Out-of-sample period trades: 40
[INFO] Total trades: 106
[INFO] In-sample P&L: $658,590.00
[INFO] Out-of-sample P&L: $165,200.00
[INFO] 
Best parameters from GA: Short SMA = 10, Long SMA = 26, Sharpe = 1.115955
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8116 to 1.1160
[INFO] 
Best parameters:
[INFO] Short SMA: 10
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 1.115955
[INFO] Number of Trades: 106
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8116 to 1.1160
[INFO] Trades range: 11.0 to 325.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6772 to 3.5491
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 128 elements
[INFO] Kmeans Cluster 1: 252 elements
[INFO] Kmeans Cluster 2: 207 elements
[INFO] Kmeans Cluster 3: 324 elements
[INFO] Kmeans Cluster 4: 236 elements
[INFO] Kmeans Cluster 5: 95 elements
[INFO] Kmeans Cluster 6: 283 elements
[INFO] Kmeans Cluster 7: 217 elements
[INFO] Kmeans Cluster 8: 206 elements
[INFO] Kmeans Cluster 9: 276 elements
[INFO] Kmeans Cluster 10: 253 elements
[INFO] Kmeans Cluster 11: 270 elements
[INFO] Kmeans Cluster 12: 109 elements
[INFO] Kmeans Cluster 13: 254 elements
[INFO] Kmeans Cluster 14: 321 elements
[INFO] Kmeans Cluster 15: 232 elements
[INFO] Kmeans Cluster 16: 177 elements
[INFO] Kmeans Cluster 17: 274 elements
[INFO] Kmeans Cluster 18: 288 elements
[INFO] Kmeans Cluster 19: 122 elements
[INFO] Kmeans Cluster 20: 114 elements
[INFO] Kmeans Cluster 21: 216 elements
[INFO] Kmeans Cluster 22: 252 elements
[INFO] Kmeans Cluster 23: 198 elements
[INFO] Kmeans Cluster 24: 88 elements
[INFO] Kmeans Cluster 25: 273 elements
[INFO] Kmeans Cluster 26: 224 elements
[INFO] Kmeans Cluster 27: 189 elements
[INFO] Kmeans Cluster 28: 35 elements
[INFO] Kmeans Cluster 29: 254 elements
[INFO] Kmeans Cluster 30: 247 elements
[INFO] Kmeans Cluster 31: 224 elements
[INFO] Kmeans Cluster 32: 185 elements
[INFO] Kmeans Cluster 33: 103 elements
[INFO] Kmeans Cluster 34: 286 elements
[INFO] Kmeans Cluster 35: 98 elements
[INFO] Kmeans Cluster 36: 284 elements
[INFO] Kmeans Cluster 37: 147 elements
[INFO] Kmeans Cluster 38: 253 elements
[INFO] Kmeans Cluster 39: 287 elements
[INFO] Kmeans Cluster 40: 282 elements
[INFO] Kmeans Cluster 41: 296 elements
[INFO] Kmeans Cluster 42: 190 elements
[INFO] Kmeans Cluster 43: 105 elements
[INFO] Kmeans Cluster 44: 243 elements
[INFO] Kmeans Cluster 45: 159 elements
[INFO] Kmeans Cluster 46: 263 elements
[INFO] Kmeans Cluster 47: 96 elements
[INFO] Kmeans Cluster 48: 215 elements
[INFO] Kmeans Cluster 49: 255 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=53.36, Long SMA=82.95, Sharpe=0.2492
[INFO] Centroid 1: Short SMA=197.02, Long SMA=279.70, Sharpe=0.1821
[INFO] Centroid 2: Short SMA=106.34, Long SMA=184.48, Sharpe=-0.0457
[INFO] Centroid 3: Short SMA=31.33, Long SMA=248.73, Sharpe=0.3472
[INFO] Centroid 4: Short SMA=185.61, Long SMA=218.39, Sharpe=0.5831
[INFO] Centroid 5: Short SMA=90.27, Long SMA=120.93, Sharpe=-0.5859
[INFO] Centroid 6: Short SMA=26.64, Long SMA=55.16, Sharpe=0.6081
[INFO] Centroid 7: Short SMA=123.39, Long SMA=271.60, Sharpe=0.1419
[INFO] Centroid 8: Short SMA=122.60, Long SMA=240.18, Sharpe=0.3409
[INFO] Centroid 9: Short SMA=27.05, Long SMA=202.41, Sharpe=0.3237
[INFO] Centroid 10: Short SMA=115.10, Long SMA=209.29, Sharpe=0.0582
[INFO] Centroid 11: Short SMA=69.11, Long SMA=282.25, Sharpe=0.1452
[INFO] Centroid 12: Short SMA=69.05, Long SMA=94.11, Sharpe=-0.0004
[INFO] Centroid 13: Short SMA=261.56, Long SMA=281.68, Sharpe=0.0233
[INFO] Centroid 14: Short SMA=30.57, Long SMA=106.88, Sharpe=0.3876
[INFO] Centroid 15: Short SMA=63.87, Long SMA=191.96, Sharpe=0.1188
[INFO] Centroid 16: Short SMA=72.15, Long SMA=165.01, Sharpe=-0.1780
[INFO] Centroid 17: Short SMA=120.34, Long SMA=152.21, Sharpe=-0.2007
[INFO] Centroid 18: Short SMA=150.87, Long SMA=227.51, Sharpe=0.4575
[INFO] Centroid 19: Short SMA=109.20, Long SMA=295.52, Sharpe=-0.2027
[INFO] Centroid 20: Short SMA=27.12, Long SMA=181.58, Sharpe=0.5147
[INFO] Centroid 21: Short SMA=137.80, Long SMA=192.61, Sharpe=0.1274
[INFO] Centroid 22: Short SMA=66.51, Long SMA=246.92, Sharpe=0.0702
[INFO] Centroid 23: Short SMA=193.73, Long SMA=233.18, Sharpe=0.4341
[INFO] Centroid 24: Short SMA=24.23, Long SMA=36.05, Sharpe=0.8196
[INFO] Centroid 25: Short SMA=26.94, Long SMA=134.69, Sharpe=0.1971
[INFO] Centroid 26: Short SMA=245.51, Long SMA=279.77, Sharpe=0.1887
[INFO] Centroid 27: Short SMA=78.12, Long SMA=104.77, Sharpe=-0.2054
[INFO] Centroid 28: Short SMA=286.06, Long SMA=294.97, Sharpe=-0.2238
[INFO] Centroid 29: Short SMA=164.36, Long SMA=290.46, Sharpe=0.0417
[INFO] Centroid 30: Short SMA=219.04, Long SMA=247.00, Sharpe=0.2293
[INFO] Centroid 31: Short SMA=33.68, Long SMA=283.44, Sharpe=0.2960
[INFO] Centroid 32: Short SMA=163.82, Long SMA=190.25, Sharpe=0.3440
[INFO] Centroid 33: Short SMA=231.73, Long SMA=253.01, Sharpe=0.4199
[INFO] Centroid 34: Short SMA=90.24, Long SMA=232.95, Sharpe=-0.1253
[INFO] Centroid 35: Short SMA=182.22, Long SMA=197.47, Sharpe=0.1727
[INFO] Centroid 36: Short SMA=147.02, Long SMA=263.47, Sharpe=0.3420
[INFO] Centroid 37: Short SMA=134.68, Long SMA=149.70, Sharpe=0.0114
[INFO] Centroid 38: Short SMA=28.70, Long SMA=161.80, Sharpe=0.3326
[INFO] Centroid 39: Short SMA=97.13, Long SMA=131.43, Sharpe=-0.3977
[INFO] Centroid 40: Short SMA=35.09, Long SMA=72.60, Sharpe=0.4463
[INFO] Centroid 41: Short SMA=77.55, Long SMA=150.39, Sharpe=-0.2874
[INFO] Centroid 42: Short SMA=28.24, Long SMA=279.52, Sharpe=0.4630
[INFO] Centroid 43: Short SMA=54.44, Long SMA=134.67, Sharpe=-0.0491
[INFO] Centroid 44: Short SMA=180.42, Long SMA=255.11, Sharpe=0.2743
[INFO] Centroid 45: Short SMA=220.77, Long SMA=288.21, Sharpe=0.0347
[INFO] Centroid 46: Short SMA=99.27, Long SMA=277.25, Sharpe=-0.0225
[INFO] Centroid 47: Short SMA=159.23, Long SMA=175.02, Sharpe=0.5436
[INFO] Centroid 48: Short SMA=34.09, Long SMA=224.16, Sharpe=0.4312
[INFO] Centroid 49: Short SMA=71.89, Long SMA=203.65, Sharpe=-0.0132
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=10, Long SMA=26, Sharpe=1.1160, Trades=106
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=20, Long SMA=30, Sharpe=0.7359, Trades=90
[INFO] Kmeans Top 2: Short SMA=28, Long SMA=182, Sharpe=0.6048, Trades=19
[INFO] Kmeans Top 3: Short SMA=26, Long SMA=56, Sharpe=0.5812, Trades=59
[INFO] Kmeans Top 4: Short SMA=188, Long SMA=218, Sharpe=0.5761, Trades=23
[INFO] Kmeans Top 5: Short SMA=158, Long SMA=174, Sharpe=0.5702, Trades=37
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (53, 83)
[INFO]   Nearest: (54.0, 82.0)
[INFO]   Rounded: (197, 280)
[INFO]   Nearest: (198.0, 280.0)
[INFO]   Rounded: (106, 184)
[INFO]   Rounded: (31, 249)
[INFO]   Nearest: (32.0, 248.0)
[INFO]   Rounded: (186, 218)
[INFO]   Rounded: (90, 121)
[INFO]   Nearest: (90.0, 120.0)
[INFO]   Rounded: (27, 55)
[INFO]   Nearest: (26.0, 56.0)
[INFO]   Rounded: (123, 272)
[INFO]   Nearest: (124.0, 272.0)
[INFO]   Rounded: (123, 240)
[INFO]   Nearest: (122.0, 240.0)
[INFO]   Rounded: (27, 202)
[INFO]   Nearest: (28.0, 202.0)
[INFO]   Rounded: (115, 209)
[INFO]   Nearest: (116.0, 210.0)
[INFO]   Rounded: (69, 282)
[INFO]   Nearest: (70.0, 282.0)
[INFO]   Rounded: (69, 94)
[INFO]   Nearest: (70.0, 94.0)
[INFO]   Rounded: (262, 282)
[INFO]   Rounded: (31, 107)
[INFO]   Nearest: (30.0, 106.0)
[INFO]   Rounded: (64, 192)
[INFO]   Rounded: (72, 165)
[INFO]   Nearest: (72.0, 166.0)
[INFO]   Rounded: (120, 152)
[INFO]   Rounded: (151, 228)
[INFO]   Nearest: (150.0, 228.0)
[INFO]   Rounded: (109, 296)
[INFO]   Nearest: (110.0, 296.0)
[INFO]   Rounded: (27, 182)
[INFO]   Nearest: (28.0, 182.0)
[INFO]   Rounded: (138, 193)
[INFO]   Nearest: (138.0, 192.0)
[INFO]   Rounded: (67, 247)
[INFO]   Nearest: (66.0, 246.0)
[INFO]   Rounded: (194, 233)
[INFO]   Nearest: (194.0, 234.0)
[INFO]   Rounded: (24, 36)
[INFO]   Rounded: (27, 135)
[INFO]   Nearest: (26.0, 134.0)
[INFO]   Rounded: (246, 280)
[INFO]   Rounded: (78, 105)
[INFO]   Nearest: (78.0, 104.0)
[INFO]   Rounded: (286, 295)
[INFO]   Nearest: (286.0, 294.0)
[INFO]   Rounded: (164, 290)
[INFO]   Rounded: (219, 247)
[INFO]   Nearest: (220.0, 246.0)
[INFO]   Rounded: (34, 283)
[INFO]   Nearest: (34.0, 284.0)
[INFO]   Rounded: (164, 190)
[INFO]   Rounded: (232, 253)
[INFO]   Nearest: (232.0, 254.0)
[INFO]   Rounded: (90, 233)
[INFO]   Nearest: (90.0, 232.0)
[INFO]   Rounded: (182, 197)
[INFO]   Nearest: (182.0, 198.0)
[INFO]   Rounded: (147, 263)
[INFO]   Nearest: (148.0, 264.0)
[INFO]   Rounded: (135, 150)
[INFO]   Nearest: (134.0, 150.0)
[INFO]   Rounded: (29, 162)
[INFO]   Nearest: (28.0, 162.0)
[INFO]   Rounded: (97, 131)
[INFO]   Nearest: (98.0, 132.0)
[INFO]   Rounded: (35, 73)
[INFO]   Nearest: (36.0, 72.0)
[INFO]   Rounded: (78, 150)
[INFO]   Rounded: (28, 280)
[INFO]   Rounded: (54, 135)
[INFO]   Nearest: (54.0, 134.0)
[INFO]   Rounded: (180, 255)
[INFO]   Nearest: (180.0, 256.0)
[INFO]   Rounded: (221, 288)
[INFO]   Nearest: (220.0, 288.0)
[INFO]   Rounded: (99, 277)
[INFO]   Nearest: (100.0, 278.0)
[INFO]   Rounded: (159, 175)
[INFO]   Nearest: (160.0, 176.0)
[INFO]   Rounded: (34, 224)
[INFO]   Rounded: (72, 204)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 10, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(20/30) - Original Sharpe: 0.7359, Trades: 90
[INFO] Kmeans cluster 2: SMA(28/182) - Original Sharpe: 0.6048, Trades: 19
[INFO] Kmeans cluster 3: SMA(26/56) - Original Sharpe: 0.5812, Trades: 59
[INFO] Kmeans cluster 4: SMA(188/218) - Original Sharpe: 0.5761, Trades: 23
[INFO] Kmeans cluster 5: SMA(158/174) - Original Sharpe: 0.5702, Trades: 37
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (10/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (20/30) - Sharpe: 0.7359
[INFO] cluster 2: (28/182) - Sharpe: 0.6048
[INFO] cluster 3: (26/56) - Sharpe: 0.5812
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     4.800806            2.796250
1    2021-11-14 2021-11-14            44     2.049644           -2.412465
2    2022-01-14 2022-01-14            41     3.528418            3.295644
3    2022-03-14 2022-03-14            44     0.138982           -1.209555
4    2022-05-14 2022-05-14            43     1.388289           -0.524410
5    2022-07-14 2022-07-14            44    -3.155014            0.334456
6    2022-09-14 2022-09-14            43    -0.180219           -1.284387
7    2022-11-14 2022-11-14            43    -1.334805           -2.160937
8    2023-01-14 2023-01-14            41    -0.581478            0.402081
9    2023-03-14 2023-03-14            43    -0.524319           -0.609580
10   2023-05-14 2023-05-14            44    -1.200228           -1.315645
11   2023-07-14 2023-07-14            44     0.362193            4.155108
12   2023-09-14 2023-09-14            43    -2.369631           -0.228285
13   2023-11-14 2023-11-14            42     1.581330           -0.636557
14   2024-01-14 2024-01-14            43     1.622963            0.639817
15   2024-03-14 2024-03-14            42     4.138827            0.453107
16   2024-05-14 2024-05-14            44    -0.527309           -2.045344
17   2024-07-14 2024-07-14            45     1.437611            0.023149
18   2024-09-14 2024-09-14            43    -0.271801           -1.197064
19   2024-11-14 2024-11-14            33     1.096941           -0.596527
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          4.8 |              2.8 |         -2.0 | False         
[INFO] 2021-11-14   |          2.0 |             -2.4 |         -4.4 | False         
[INFO] 2022-01-14   |          3.5 |              3.3 |         -0.2 | False         
[INFO] 2022-03-14   |          0.1 |             -1.2 |         -1.3 | False         
[INFO] 2022-05-14   |          1.4 |             -0.5 |         -1.9 | False         
[INFO] 2022-07-14   |         -3.2 |              0.3 |          3.5 | True          
[INFO] 2022-09-14   |         -0.2 |             -1.3 |         -1.1 | False         
[INFO] 2022-11-14   |         -1.3 |             -2.2 |         -0.9 | False         
[INFO] 2023-01-14   |         -0.6 |              0.4 |          1.0 | True          
[INFO] 2023-03-14   |         -0.5 |             -0.6 |         -0.1 | False         
[INFO] 2023-05-14   |         -1.2 |             -1.3 |         -0.1 | False         
[INFO] 2023-07-14   |          0.4 |              4.2 |          3.8 | True          
[INFO] 2023-09-14   |         -2.4 |             -0.2 |          2.2 | True          
[INFO] 2023-11-14   |          1.6 |             -0.6 |         -2.2 | False         
[INFO] 2024-01-14   |          1.6 |              0.6 |         -1.0 | False         
[INFO] 2024-03-14   |          4.1 |              0.5 |         -3.6 | False         
[INFO] 2024-05-14   |         -0.5 |             -2.0 |         -1.5 | False         
[INFO] 2024-07-14   |          1.4 |              0.0 |         -1.4 | False         
[INFO] 2024-09-14   |         -0.3 |             -1.2 |         -0.9 | False         
[INFO] 2024-11-14   |          1.1 |             -0.6 |         -1.7 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 4 of 20 periods (20.00% win rate)
[INFO] Updating Excel file with Kmeans results for BRN...
[INFO] Excel file updated successfully. Added BRN with Kmeans win rate 20.0% in row 6
[INFO] Added best Sharpe parameters 10/26 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 10, Long SMA: 26
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(20/30) - Original Sharpe: 0.7359
[INFO] Added cluster 2 to portfolio: SMA(28/182) - Original Sharpe: 0.6048
[INFO] Added cluster 3 to portfolio: SMA(26/56) - Original Sharpe: 0.5812
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BRN_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1376
[INFO] Kmeans Best out-of-sample Sharpe: 0.6187
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for BRN...
[INFO] Excel file updated successfully. Added BRN with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BRN
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8116 to 1.1160
[INFO] 
Best parameters:
[INFO] Short SMA: 10
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 1.115955
[INFO] Number of Trades: 106
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8116 to 1.1160
[INFO] Trades range: 11.0 to 325.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6772 to 3.5491
[INFO] Scaled Trades range: -0.7653 to 15.8184
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5971
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 281 elements
[INFO] Cluster 1: 406 elements
[INFO] Cluster 2: 634 elements
[INFO] Cluster 3: 498 elements
[INFO] Cluster 4: 109 elements
[INFO] Cluster 5: 478 elements
[INFO] Cluster 6: 10 elements
[INFO] Cluster 7: 194 elements
[INFO] Cluster 8: 56 elements
[INFO] Cluster 9: 339 elements
[INFO] Cluster 10: 100 elements
[INFO] Cluster 11: 42 elements
[INFO] Cluster 12: 101 elements
[INFO] Cluster 13: 33 elements
[INFO] Cluster 14: 213 elements
[INFO] Cluster 15: 274 elements
[INFO] Cluster 16: 49 elements
[INFO] Cluster 17: 227 elements
[INFO] Cluster 18: 307 elements
[INFO] Cluster 19: 196 elements
[INFO] Cluster 20: 110 elements
[INFO] Cluster 21: 440 elements
[INFO] Cluster 22: 477 elements
[INFO] Cluster 23: 418 elements
[INFO] Cluster 24: 203 elements
[INFO] Cluster 25: 244 elements
[INFO] Cluster 26: 342 elements
[INFO] Cluster 27: 337 elements
[INFO] Cluster 28: 64 elements
[INFO] Cluster 29: 115 elements
[INFO] Cluster 30: 151 elements
[INFO] Cluster 31: 253 elements
[INFO] Cluster 32: 318 elements
[INFO] Cluster 33: 342 elements
[INFO] Cluster 34: 331 elements
[INFO] Cluster 35: 84 elements
[INFO] Cluster 36: 325 elements
[INFO] Cluster 37: 180 elements
[INFO] Cluster 38: 93 elements
[INFO] Cluster 39: 125 elements
[INFO] Cluster 40: 95 elements
[INFO] Cluster 41: 245 elements
[INFO] Cluster 42: 201 elements
[INFO] Cluster 43: 133 elements
[INFO] Cluster 44: 63 elements
[INFO] Cluster 45: 132 elements
[INFO] Cluster 46: 59 elements
[INFO] Cluster 47: 25 elements
[INFO] Cluster 48: 52 elements
[INFO] Cluster 49: 81 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=26, Long SMA=62, Sharpe=0.6563, Trades=55
[INFO] Cluster 1 cluster: Short SMA=182, Long SMA=268, Sharpe=0.1654, Trades=14
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=274, Sharpe=0.4765, Trades=18
[INFO] Cluster 3 cluster: Short SMA=66, Long SMA=196, Sharpe=0.0464, Trades=15
[INFO] Cluster 4 cluster: Short SMA=274, Long SMA=280, Sharpe=0.1020, Trades=43
[INFO] Cluster 5 cluster: Short SMA=36, Long SMA=214, Sharpe=0.3906, Trades=17
[INFO] Cluster 7 cluster: Short SMA=230, Long SMA=242, Sharpe=0.3876, Trades=31
[INFO] Cluster 8 cluster: Short SMA=196, Long SMA=198, Sharpe=0.2362, Trades=71
[INFO] Cluster 9 cluster: Short SMA=30, Long SMA=92, Sharpe=0.4099, Trades=41
[INFO] Cluster 10 cluster: Short SMA=160, Long SMA=176, Sharpe=0.5862, Trades=37
[INFO] Cluster 11 cluster: Short SMA=22, Long SMA=26, Sharpe=0.7741, Trades=149
[INFO] Cluster 12 cluster: Short SMA=20, Long SMA=42, Sharpe=0.4849, Trades=72
[INFO] Cluster 13 cluster: Short SMA=88, Long SMA=90, Sharpe=0.0030, Trades=118
[INFO] Cluster 14 cluster: Short SMA=18, Long SMA=172, Sharpe=0.3186, Trades=25
[INFO] Cluster 15 cluster: Short SMA=98, Long SMA=148, Sharpe=-0.4096, Trades=21
[INFO] Cluster 16 cluster: Short SMA=24, Long SMA=32, Sharpe=0.6952, Trades=98
[INFO] Cluster 17 cluster: Short SMA=64, Long SMA=114, Sharpe=-0.0633, Trades=29
[INFO] Cluster 18 cluster: Short SMA=144, Long SMA=266, Sharpe=0.2905, Trades=13
[INFO] Cluster 19 cluster: Short SMA=114, Long SMA=160, Sharpe=-0.1952, Trades=23
[INFO] Cluster 20 cluster: Short SMA=130, Long SMA=150, Sharpe=-0.0866, Trades=31
[INFO] Cluster 21 cluster: Short SMA=128, Long SMA=202, Sharpe=-0.0019, Trades=17
[INFO] Cluster 22 cluster: Short SMA=68, Long SMA=268, Sharpe=0.0705, Trades=14
[INFO] Cluster 23 cluster: Short SMA=138, Long SMA=234, Sharpe=0.3068, Trades=13
[INFO] Cluster 24 cluster: Short SMA=108, Long SMA=294, Sharpe=-0.0888, Trades=12
[INFO] Cluster 25 cluster: Short SMA=260, Long SMA=286, Sharpe=0.1002, Trades=23
[INFO] Cluster 26 cluster: Short SMA=90, Long SMA=234, Sharpe=-0.2568, Trades=15
[INFO] Cluster 27 cluster: Short SMA=74, Long SMA=154, Sharpe=-0.2518, Trades=21
[INFO] Cluster 28 cluster: Short SMA=92, Long SMA=98, Sharpe=-0.2270, Trades=69
[INFO] Cluster 29 cluster: Short SMA=100, Long SMA=118, Sharpe=-0.3050, Trades=41
[INFO] Cluster 30 cluster: Short SMA=40, Long SMA=144, Sharpe=0.1623, Trades=25
[INFO] Cluster 31 cluster: Short SMA=158, Long SMA=290, Sharpe=0.1202, Trades=12
[INFO] Cluster 32 cluster: Short SMA=102, Long SMA=186, Sharpe=-0.0369, Trades=17
[INFO] Cluster 33 cluster: Short SMA=222, Long SMA=264, Sharpe=0.2256, Trades=19
[INFO] Cluster 34 cluster: Short SMA=108, Long SMA=270, Sharpe=0.0633, Trades=14
[INFO] Cluster 35 cluster: Short SMA=134, Long SMA=142, Sharpe=0.2050, Trades=55
[INFO] Cluster 36 cluster: Short SMA=36, Long SMA=118, Sharpe=0.4645, Trades=29
[INFO] Cluster 37 cluster: Short SMA=194, Long SMA=246, Sharpe=0.4863, Trades=19
[INFO] Cluster 38 cluster: Short SMA=180, Long SMA=196, Sharpe=0.1633, Trades=39
[INFO] Cluster 39 cluster: Short SMA=16, Long SMA=230, Sharpe=0.2960, Trades=25
[INFO] Cluster 40 cluster: Short SMA=14, Long SMA=136, Sharpe=0.2028, Trades=39
[INFO] Cluster 41 cluster: Short SMA=170, Long SMA=218, Sharpe=0.5344, Trades=19
[INFO] Cluster 42 cluster: Short SMA=220, Long SMA=286, Sharpe=-0.0045, Trades=19
[INFO] Cluster 43 cluster: Short SMA=160, Long SMA=190, Sharpe=0.2476, Trades=25
[INFO] Cluster 44 cluster: Short SMA=76, Long SMA=90, Sharpe=-0.1882, Trades=51
[INFO] Cluster 45 cluster: Short SMA=200, Long SMA=214, Sharpe=0.6025, Trades=35
[INFO] Cluster 46 cluster: Short SMA=56, Long SMA=70, Sharpe=0.3648, Trades=61
[INFO] Cluster 47 cluster: Short SMA=128, Long SMA=130, Sharpe=0.0149, Trades=93
[INFO] Cluster 48 cluster: Short SMA=88, Long SMA=118, Sharpe=-0.8070, Trades=29
[INFO] Cluster 49 cluster: Short SMA=28, Long SMA=180, Sharpe=0.5903, Trades=21
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=10, Long SMA=26, Sharpe=1.1160, Trades=106
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=22, Long SMA=26, Sharpe=0.7741, Trades=149
[INFO] Top 2: Short SMA=24, Long SMA=32, Sharpe=0.6952, Trades=98
[INFO] Top 3: Short SMA=26, Long SMA=62, Sharpe=0.6563, Trades=55
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10575 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 10, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(22/26) - Original Sharpe: 0.7741, Trades: 149
[INFO] Hierarchical cluster 2: SMA(24/32) - Original Sharpe: 0.6952, Trades: 98
[INFO] Hierarchical cluster 3: SMA(26/62) - Original Sharpe: 0.6563, Trades: 55
[INFO] Hierarchical cluster 4: SMA(200/214) - Original Sharpe: 0.6025, Trades: 35
[INFO] Hierarchical cluster 5: SMA(28/180) - Original Sharpe: 0.5903, Trades: 21
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (10/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (22/26) - Sharpe: 0.7741
[INFO] cluster 2: (24/32) - Sharpe: 0.6952
[INFO] cluster 3: (26/62) - Sharpe: 0.6563
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     4.800806            2.483854
1    2021-11-14 2021-11-14            44     2.049644           -1.125306
2    2022-01-14 2022-01-14            41     3.528418            3.131964
3    2022-03-14 2022-03-14            44     0.138982           -1.536136
4    2022-05-14 2022-05-14            43     1.388289            0.547650
5    2022-07-14 2022-07-14            44    -3.155014            1.156005
6    2022-09-14 2022-09-14            43    -0.180219           -0.800320
7    2022-11-14 2022-11-14            43    -1.334805           -3.006287
8    2023-01-14 2023-01-14            41    -0.581478           -3.353172
9    2023-03-14 2023-03-14            43    -0.524319           -3.667248
10   2023-05-14 2023-05-14            44    -1.200228           -0.287598
11   2023-07-14 2023-07-14            44     0.362193            4.454866
12   2023-09-14 2023-09-14            43    -2.369631           -0.552777
13   2023-11-14 2023-11-14            42     1.581330            1.027634
14   2024-01-14 2024-01-14            43     1.622963            2.341427
15   2024-03-14 2024-03-14            42     4.138827            0.448668
16   2024-05-14 2024-05-14            44    -0.527309           -1.768440
17   2024-07-14 2024-07-14            45     1.437611           -0.214296
18   2024-09-14 2024-09-14            43    -0.271801           -2.174034
19   2024-11-14 2024-11-14            33     1.096941           -2.603502
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          4.8 |              2.5 |         -2.3 | False         
[INFO] 2021-11-14   |          2.0 |             -1.1 |         -3.1 | False         
[INFO] 2022-01-14   |          3.5 |              3.1 |         -0.4 | False         
[INFO] 2022-03-14   |          0.1 |             -1.5 |         -1.6 | False         
[INFO] 2022-05-14   |          1.4 |              0.5 |         -0.9 | False         
[INFO] 2022-07-14   |         -3.2 |              1.2 |          4.4 | True          
[INFO] 2022-09-14   |         -0.2 |             -0.8 |         -0.6 | False         
[INFO] 2022-11-14   |         -1.3 |             -3.0 |         -1.7 | False         
[INFO] 2023-01-14   |         -0.6 |             -3.4 |         -2.8 | False         
[INFO] 2023-03-14   |         -0.5 |             -3.7 |         -3.2 | False         
[INFO] 2023-05-14   |         -1.2 |             -0.3 |          0.9 | True          
[INFO] 2023-07-14   |          0.4 |              4.5 |          4.1 | True          
[INFO] 2023-09-14   |         -2.4 |             -0.6 |          1.8 | True          
[INFO] 2023-11-14   |          1.6 |              1.0 |         -0.6 | False         
[INFO] 2024-01-14   |          1.6 |              2.3 |          0.7 | True          
[INFO] 2024-03-14   |          4.1 |              0.4 |         -3.7 | False         
[INFO] 2024-05-14   |         -0.5 |             -1.8 |         -1.3 | False         
[INFO] 2024-07-14   |          1.4 |             -0.2 |         -1.6 | False         
[INFO] 2024-09-14   |         -0.3 |             -2.2 |         -1.9 | False         
[INFO] 2024-11-14   |          1.1 |             -2.6 |         -3.7 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 20 periods (25.00% win rate)
[INFO] Updating Excel file with Hierarchical results for BRN...
[INFO] Excel file updated successfully. Added BRN with Hierarchical win rate 25.0% in row 6
[INFO] Added best Sharpe parameters 10/26 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 10, Long SMA: 26
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(22/26) - Original Sharpe: 0.7741
[INFO] Added cluster 2 to portfolio: SMA(24/32) - Original Sharpe: 0.6952
[INFO] Added cluster 3 to portfolio: SMA(26/62) - Original Sharpe: 0.6563
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BRN_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0016
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6187
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for BRN...
[INFO] Excel file updated successfully. Added BRN with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BRN
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for C in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.41s
[INFO] Best parameters: Short SMA = 118, Long SMA = 134
[INFO] Best Sharpe ratio: 0.630269, Trades: 52
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CC
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 10.33 contracts
[INFO] Maximum Position Size: 18 contracts
[INFO] Strategy Total P&L: $777,426.00
[INFO] Market Buy & Hold P&L: $114,720.00
[INFO] Outperformance: $662,706.00
[INFO] Sharpe ratio (entire period, annualized): 0.965941
[INFO] Sharpe ratio (in-sample, annualized): 0.630269
[INFO] Sharpe ratio (out-of-sample, annualized): 1.618642
[INFO] Maximum Drawdown: $143,374.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 39
[INFO] Out-of-sample period trades: 13
[INFO] Total trades: 52
[INFO] In-sample P&L: $325,636.00
[INFO] Out-of-sample P&L: $439,720.00
[INFO] 
Best parameters from GA: Short SMA = 118, Long SMA = 134, Sharpe = 0.630269
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.7127 to 0.6303
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.630269
[INFO] Number of Trades: 52
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.7127 to 0.6303
[INFO] Trades range: 12.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.9917 to 2.9163
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 267 elements
[INFO] Kmeans Cluster 1: 350 elements
[INFO] Kmeans Cluster 2: 238 elements
[INFO] Kmeans Cluster 3: 153 elements
[INFO] Kmeans Cluster 4: 118 elements
[INFO] Kmeans Cluster 5: 250 elements
[INFO] Kmeans Cluster 6: 274 elements
[INFO] Kmeans Cluster 7: 202 elements
[INFO] Kmeans Cluster 8: 181 elements
[INFO] Kmeans Cluster 9: 193 elements
[INFO] Kmeans Cluster 10: 215 elements
[INFO] Kmeans Cluster 11: 70 elements
[INFO] Kmeans Cluster 12: 267 elements
[INFO] Kmeans Cluster 13: 172 elements
[INFO] Kmeans Cluster 14: 212 elements
[INFO] Kmeans Cluster 15: 196 elements
[INFO] Kmeans Cluster 16: 175 elements
[INFO] Kmeans Cluster 17: 97 elements
[INFO] Kmeans Cluster 18: 215 elements
[INFO] Kmeans Cluster 19: 301 elements
[INFO] Kmeans Cluster 20: 246 elements
[INFO] Kmeans Cluster 21: 319 elements
[INFO] Kmeans Cluster 22: 134 elements
[INFO] Kmeans Cluster 23: 247 elements
[INFO] Kmeans Cluster 24: 211 elements
[INFO] Kmeans Cluster 25: 264 elements
[INFO] Kmeans Cluster 26: 168 elements
[INFO] Kmeans Cluster 27: 218 elements
[INFO] Kmeans Cluster 28: 296 elements
[INFO] Kmeans Cluster 29: 340 elements
[INFO] Kmeans Cluster 30: 143 elements
[INFO] Kmeans Cluster 31: 280 elements
[INFO] Kmeans Cluster 32: 242 elements
[INFO] Kmeans Cluster 33: 210 elements
[INFO] Kmeans Cluster 34: 227 elements
[INFO] Kmeans Cluster 35: 241 elements
[INFO] Kmeans Cluster 36: 214 elements
[INFO] Kmeans Cluster 37: 206 elements
[INFO] Kmeans Cluster 38: 285 elements
[INFO] Kmeans Cluster 39: 135 elements
[INFO] Kmeans Cluster 40: 195 elements
[INFO] Kmeans Cluster 41: 179 elements
[INFO] Kmeans Cluster 42: 111 elements
[INFO] Kmeans Cluster 43: 269 elements
[INFO] Kmeans Cluster 44: 206 elements
[INFO] Kmeans Cluster 45: 221 elements
[INFO] Kmeans Cluster 46: 39 elements
[INFO] Kmeans Cluster 47: 143 elements
[INFO] Kmeans Cluster 48: 209 elements
[INFO] Kmeans Cluster 49: 241 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=182.11, Long SMA=257.63, Sharpe=-0.0289
[INFO] Centroid 1: Short SMA=33.93, Long SMA=166.25, Sharpe=-0.4090
[INFO] Centroid 2: Short SMA=54.06, Long SMA=285.49, Sharpe=-0.3611
[INFO] Centroid 3: Short SMA=148.98, Long SMA=170.00, Sharpe=-0.1111
[INFO] Centroid 4: Short SMA=18.56, Long SMA=55.00, Sharpe=-1.4219
[INFO] Centroid 5: Short SMA=269.06, Long SMA=286.68, Sharpe=0.0618
[INFO] Centroid 6: Short SMA=48.83, Long SMA=238.08, Sharpe=-0.2743
[INFO] Centroid 7: Short SMA=81.52, Long SMA=123.64, Sharpe=-0.2651
[INFO] Centroid 8: Short SMA=128.91, Long SMA=226.21, Sharpe=-0.0722
[INFO] Centroid 9: Short SMA=171.21, Long SMA=193.37, Sharpe=-0.2447
[INFO] Centroid 10: Short SMA=23.62, Long SMA=286.11, Sharpe=-0.6435
[INFO] Centroid 11: Short SMA=24.23, Long SMA=39.89, Sharpe=-0.7908
[INFO] Centroid 12: Short SMA=104.83, Long SMA=148.87, Sharpe=0.1347
[INFO] Centroid 13: Short SMA=75.83, Long SMA=277.97, Sharpe=-0.1614
[INFO] Centroid 14: Short SMA=143.67, Long SMA=256.39, Sharpe=0.1894
[INFO] Centroid 15: Short SMA=78.74, Long SMA=103.86, Sharpe=-0.4438
[INFO] Centroid 16: Short SMA=18.77, Long SMA=191.86, Sharpe=-0.5878
[INFO] Centroid 17: Short SMA=41.51, Long SMA=55.75, Sharpe=-0.0935
[INFO] Centroid 18: Short SMA=216.71, Long SMA=269.01, Sharpe=0.0818
[INFO] Centroid 19: Short SMA=106.85, Long SMA=240.24, Sharpe=-0.2123
[INFO] Centroid 20: Short SMA=238.37, Long SMA=285.93, Sharpe=-0.0295
[INFO] Centroid 21: Short SMA=76.01, Long SMA=217.13, Sharpe=-0.0711
[INFO] Centroid 22: Short SMA=25.09, Long SMA=95.27, Sharpe=-0.8641
[INFO] Centroid 23: Short SMA=103.00, Long SMA=284.02, Sharpe=-0.3260
[INFO] Centroid 24: Short SMA=128.26, Long SMA=284.27, Sharpe=-0.1011
[INFO] Centroid 25: Short SMA=36.47, Long SMA=124.32, Sharpe=-0.3048
[INFO] Centroid 26: Short SMA=167.02, Long SMA=291.26, Sharpe=-0.1388
[INFO] Centroid 27: Short SMA=168.78, Long SMA=208.39, Sharpe=-0.1020
[INFO] Centroid 28: Short SMA=51.42, Long SMA=189.13, Sharpe=-0.2722
[INFO] Centroid 29: Short SMA=125.56, Long SMA=194.92, Sharpe=-0.2632
[INFO] Centroid 30: Short SMA=19.45, Long SMA=60.10, Sharpe=-1.1734
[INFO] Centroid 31: Short SMA=85.58, Long SMA=161.12, Sharpe=-0.0525
[INFO] Centroid 32: Short SMA=24.83, Long SMA=224.93, Sharpe=-0.4378
[INFO] Centroid 33: Short SMA=188.09, Long SMA=222.15, Sharpe=0.0210
[INFO] Centroid 34: Short SMA=229.39, Long SMA=248.19, Sharpe=0.0370
[INFO] Centroid 35: Short SMA=53.11, Long SMA=132.03, Sharpe=-0.4905
[INFO] Centroid 36: Short SMA=151.81, Long SMA=269.75, Sharpe=0.0606
[INFO] Centroid 37: Short SMA=199.06, Long SMA=288.18, Sharpe=-0.1337
[INFO] Centroid 38: Short SMA=78.05, Long SMA=255.21, Sharpe=0.0241
[INFO] Centroid 39: Short SMA=15.20, Long SMA=133.05, Sharpe=-0.6796
[INFO] Centroid 40: Short SMA=206.75, Long SMA=234.98, Sharpe=-0.1418
[INFO] Centroid 41: Short SMA=150.87, Long SMA=233.77, Sharpe=0.1055
[INFO] Centroid 42: Short SMA=93.78, Long SMA=109.23, Sharpe=-0.0517
[INFO] Centroid 43: Short SMA=90.94, Long SMA=192.45, Sharpe=-0.1625
[INFO] Centroid 44: Short SMA=139.92, Long SMA=167.58, Sharpe=-0.3828
[INFO] Centroid 45: Short SMA=42.03, Long SMA=71.12, Sharpe=-0.3992
[INFO] Centroid 46: Short SMA=255.23, Long SMA=265.23, Sharpe=-0.2886
[INFO] Centroid 47: Short SMA=120.34, Long SMA=139.59, Sharpe=0.3276
[INFO] Centroid 48: Short SMA=51.18, Long SMA=91.57, Sharpe=-0.6399
[INFO] Centroid 49: Short SMA=25.63, Long SMA=257.56, Sharpe=-0.5332
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6303, Trades=52
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=120, Long SMA=138, Sharpe=0.2949, Trades=44
[INFO] Kmeans Top 2: Short SMA=106, Long SMA=146, Sharpe=0.2073, Trades=24
[INFO] Kmeans Top 3: Short SMA=152, Long SMA=234, Sharpe=0.1868, Trades=12
[INFO] Kmeans Top 4: Short SMA=144, Long SMA=256, Sharpe=0.1525, Trades=12
[INFO] Kmeans Top 5: Short SMA=152, Long SMA=270, Sharpe=0.0940, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (182, 258)
[INFO]   Rounded: (34, 166)
[INFO]   Rounded: (54, 285)
[INFO]   Nearest: (54.0, 286.0)
[INFO]   Rounded: (149, 170)
[INFO]   Nearest: (148.0, 170.0)
[INFO]   Rounded: (19, 55)
[INFO]   Nearest: (18.0, 56.0)
[INFO]   Rounded: (269, 287)
[INFO]   Nearest: (270.0, 286.0)
[INFO]   Rounded: (49, 238)
[INFO]   Nearest: (48.0, 238.0)
[INFO]   Rounded: (82, 124)
[INFO]   Rounded: (129, 226)
[INFO]   Nearest: (128.0, 226.0)
[INFO]   Rounded: (171, 193)
[INFO]   Nearest: (172.0, 194.0)
[INFO]   Rounded: (24, 286)
[INFO]   Rounded: (24, 40)
[INFO]   Rounded: (105, 149)
[INFO]   Nearest: (104.0, 148.0)
[INFO]   Rounded: (76, 278)
[INFO]   Rounded: (144, 256)
[INFO]   Rounded: (79, 104)
[INFO]   Nearest: (78.0, 104.0)
[INFO]   Rounded: (19, 192)
[INFO]   Nearest: (18.0, 192.0)
[INFO]   Rounded: (42, 56)
[INFO]   Rounded: (217, 269)
[INFO]   Nearest: (216.0, 270.0)
[INFO]   Rounded: (107, 240)
[INFO]   Nearest: (106.0, 240.0)
[INFO]   Rounded: (238, 286)
[INFO]   Rounded: (76, 217)
[INFO]   Nearest: (76.0, 218.0)
[INFO]   Rounded: (25, 95)
[INFO]   Nearest: (26.0, 96.0)
[INFO]   Rounded: (103, 284)
[INFO]   Nearest: (104.0, 284.0)
[INFO]   Rounded: (128, 284)
[INFO]   Rounded: (36, 124)
[INFO]   Rounded: (167, 291)
[INFO]   Nearest: (168.0, 292.0)
[INFO]   Rounded: (169, 208)
[INFO]   Nearest: (168.0, 208.0)
[INFO]   Rounded: (51, 189)
[INFO]   Nearest: (52.0, 190.0)
[INFO]   Rounded: (126, 195)
[INFO]   Nearest: (126.0, 194.0)
[INFO]   Rounded: (19, 60)
[INFO]   Nearest: (20.0, 60.0)
[INFO]   Rounded: (86, 161)
[INFO]   Nearest: (86.0, 162.0)
[INFO]   Rounded: (25, 225)
[INFO]   Nearest: (24.0, 224.0)
[INFO]   Rounded: (188, 222)
[INFO]   Rounded: (229, 248)
[INFO]   Nearest: (230.0, 248.0)
[INFO]   Rounded: (53, 132)
[INFO]   Nearest: (54.0, 132.0)
[INFO]   Rounded: (152, 270)
[INFO]   Rounded: (199, 288)
[INFO]   Nearest: (200.0, 288.0)
[INFO]   Rounded: (78, 255)
[INFO]   Nearest: (78.0, 256.0)
[INFO]   Rounded: (15, 133)
[INFO]   Nearest: (16.0, 134.0)
[INFO]   Rounded: (207, 235)
[INFO]   Nearest: (206.0, 234.0)
[INFO]   Rounded: (151, 234)
[INFO]   Nearest: (150.0, 234.0)
[INFO]   Rounded: (94, 109)
[INFO]   Nearest: (94.0, 110.0)
[INFO]   Rounded: (91, 192)
[INFO]   Nearest: (90.0, 192.0)
[INFO]   Rounded: (140, 168)
[INFO]   Rounded: (42, 71)
[INFO]   Nearest: (42.0, 72.0)
[INFO]   Rounded: (255, 265)
[INFO]   Nearest: (256.0, 266.0)
[INFO]   Rounded: (120, 140)
[INFO]   Rounded: (51, 92)
[INFO]   Nearest: (52.0, 92.0)
[INFO]   Rounded: (26, 258)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(120/138) - Original Sharpe: 0.2949, Trades: 44
[INFO] Kmeans cluster 2: SMA(106/146) - Original Sharpe: 0.2073, Trades: 24
[INFO] Kmeans cluster 3: SMA(152/234) - Original Sharpe: 0.1868, Trades: 12
[INFO] Kmeans cluster 4: SMA(144/256) - Original Sharpe: 0.1525, Trades: 12
[INFO] Kmeans cluster 5: SMA(152/270) - Original Sharpe: 0.0940, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (120/138) - Sharpe: 0.2949
[INFO] cluster 2: (106/146) - Sharpe: 0.2073
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.387066            0.919998
1    2021-11-10 2021-11-10            41    -1.369000            1.512131
2    2022-01-10 2022-01-10            41     1.348855            3.040561
3    2022-03-10 2022-03-10            42     3.066197            3.066197
4    2022-05-10 2022-05-10            41     0.256065            0.107554
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.313270            0.168202
8    2023-01-10 2023-01-10            41     0.018666            0.018666
9    2023-03-10 2023-03-10            42     3.526516            3.526516
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.369719           -1.664934
19   2024-11-10 2024-11-10            35     2.120478            4.095623
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.4 |              0.9 |          0.5 | True          
[INFO] 2021-11-10   |         -1.4 |              1.5 |          2.9 | True          
[INFO] 2022-01-10   |          1.3 |              3.0 |          1.7 | True          
[INFO] 2022-03-10   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2022-05-10   |          0.3 |              0.1 |         -0.2 | False         
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |              0.2 |         -0.1 | False         
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |             -1.7 |         -0.3 | False         
[INFO] 2024-11-10   |          2.1 |              4.1 |          2.0 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-10, 2022-07-10, 2022-09-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 7
[INFO] Kmeans cluster wins (rounded comparison): 4 of 7 periods (57.14% win rate)
[INFO] Updating Excel file with Kmeans results for C...
[INFO] Excel file updated successfully. Added C with Kmeans win rate 57.1% in row 7
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(120/138) - Original Sharpe: 0.2949
[INFO] Added cluster 2 to portfolio: SMA(106/146) - Original Sharpe: 0.2073
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'C_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 1.9835
[INFO] Kmeans Best out-of-sample Sharpe: 1.6186
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for C...
[INFO] Excel file updated successfully. Added C with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\C
[INFO] Big Point Value: 10.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.7127 to 0.6303
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.630269
[INFO] Number of Trades: 52
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.7127 to 0.6303
[INFO] Trades range: 12.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.9917 to 2.9163
[INFO] Scaled Trades range: -0.6807 to 13.5867
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5249
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 201 elements
[INFO] Cluster 1: 159 elements
[INFO] Cluster 2: 271 elements
[INFO] Cluster 3: 451 elements
[INFO] Cluster 4: 60 elements
[INFO] Cluster 5: 244 elements
[INFO] Cluster 6: 221 elements
[INFO] Cluster 7: 397 elements
[INFO] Cluster 8: 383 elements
[INFO] Cluster 9: 265 elements
[INFO] Cluster 10: 98 elements
[INFO] Cluster 11: 54 elements
[INFO] Cluster 12: 261 elements
[INFO] Cluster 13: 10 elements
[INFO] Cluster 14: 277 elements
[INFO] Cluster 15: 239 elements
[INFO] Cluster 16: 332 elements
[INFO] Cluster 17: 284 elements
[INFO] Cluster 18: 282 elements
[INFO] Cluster 19: 533 elements
[INFO] Cluster 20: 25 elements
[INFO] Cluster 21: 156 elements
[INFO] Cluster 22: 318 elements
[INFO] Cluster 23: 297 elements
[INFO] Cluster 24: 239 elements
[INFO] Cluster 25: 307 elements
[INFO] Cluster 26: 54 elements
[INFO] Cluster 27: 363 elements
[INFO] Cluster 28: 342 elements
[INFO] Cluster 29: 200 elements
[INFO] Cluster 30: 285 elements
[INFO] Cluster 31: 50 elements
[INFO] Cluster 32: 260 elements
[INFO] Cluster 33: 291 elements
[INFO] Cluster 34: 72 elements
[INFO] Cluster 35: 340 elements
[INFO] Cluster 36: 311 elements
[INFO] Cluster 37: 145 elements
[INFO] Cluster 38: 246 elements
[INFO] Cluster 39: 242 elements
[INFO] Cluster 40: 77 elements
[INFO] Cluster 41: 121 elements
[INFO] Cluster 42: 209 elements
[INFO] Cluster 43: 11 elements
[INFO] Cluster 44: 42 elements
[INFO] Cluster 45: 176 elements
[INFO] Cluster 46: 64 elements
[INFO] Cluster 47: 5 elements
[INFO] Cluster 48: 245 elements
[INFO] Cluster 49: 70 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=20, Long SMA=56, Sharpe=-1.5878, Trades=72
[INFO] Cluster 1 cluster: Short SMA=56, Long SMA=72, Sharpe=-0.2605, Trades=62
[INFO] Cluster 2 cluster: Short SMA=234, Long SMA=254, Sharpe=0.0088, Trades=28
[INFO] Cluster 3 cluster: Short SMA=108, Long SMA=228, Sharpe=-0.1860, Trades=12
[INFO] Cluster 4 cluster: Short SMA=64, Long SMA=66, Sharpe=-0.6467, Trades=134
[INFO] Cluster 5 cluster: Short SMA=16, Long SMA=198, Sharpe=-0.6704, Trades=30
[INFO] Cluster 6 cluster: Short SMA=52, Long SMA=82, Sharpe=-0.6673, Trades=44
[INFO] Cluster 7 cluster: Short SMA=34, Long SMA=124, Sharpe=-0.2056, Trades=26
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=276, Sharpe=-0.5355, Trades=21
[INFO] Cluster 9 cluster: Short SMA=68, Long SMA=292, Sharpe=-0.3607, Trades=13
[INFO] Cluster 10 cluster: Short SMA=166, Long SMA=170, Sharpe=-0.1459, Trades=68
[INFO] Cluster 11 cluster: Short SMA=26, Long SMA=34, Sharpe=-1.3176, Trades=108
[INFO] Cluster 12 cluster: Short SMA=22, Long SMA=108, Sharpe=-0.6717, Trades=38
[INFO] Cluster 14 cluster: Short SMA=100, Long SMA=156, Sharpe=0.1466, Trades=20
[INFO] Cluster 15 cluster: Short SMA=174, Long SMA=192, Sharpe=-0.3266, Trades=33
[INFO] Cluster 16 cluster: Short SMA=36, Long SMA=166, Sharpe=-0.3604, Trades=26
[INFO] Cluster 17 cluster: Short SMA=62, Long SMA=124, Sharpe=-0.4461, Trades=26
[INFO] Cluster 18 cluster: Short SMA=164, Long SMA=206, Sharpe=-0.0803, Trades=18
[INFO] Cluster 19 cluster: Short SMA=148, Long SMA=250, Sharpe=0.2391, Trades=12
[INFO] Cluster 20 cluster: Short SMA=20, Long SMA=24, Sharpe=-0.7264, Trades=172
[INFO] Cluster 21 cluster: Short SMA=114, Long SMA=136, Sharpe=0.4568, Trades=40
[INFO] Cluster 22 cluster: Short SMA=180, Long SMA=258, Sharpe=-0.0903, Trades=12
[INFO] Cluster 23 cluster: Short SMA=80, Long SMA=194, Sharpe=-0.2441, Trades=16
[INFO] Cluster 24 cluster: Short SMA=226, Long SMA=290, Sharpe=-0.0616, Trades=15
[INFO] Cluster 25 cluster: Short SMA=48, Long SMA=192, Sharpe=-0.2598, Trades=18
[INFO] Cluster 26 cluster: Short SMA=246, Long SMA=248, Sharpe=0.0845, Trades=80
[INFO] Cluster 27 cluster: Short SMA=130, Long SMA=186, Sharpe=-0.2631, Trades=16
[INFO] Cluster 28 cluster: Short SMA=52, Long SMA=254, Sharpe=-0.2480, Trades=20
[INFO] Cluster 29 cluster: Short SMA=268, Long SMA=288, Sharpe=0.0039, Trades=25
[INFO] Cluster 30 cluster: Short SMA=216, Long SMA=268, Sharpe=0.0557, Trades=15
[INFO] Cluster 31 cluster: Short SMA=60, Long SMA=66, Sharpe=-0.3171, Trades=90
[INFO] Cluster 32 cluster: Short SMA=26, Long SMA=230, Sharpe=-0.4711, Trades=20
[INFO] Cluster 33 cluster: Short SMA=140, Long SMA=288, Sharpe=-0.0875, Trades=13
[INFO] Cluster 34 cluster: Short SMA=124, Long SMA=132, Sharpe=0.2665, Trades=64
[INFO] Cluster 35 cluster: Short SMA=78, Long SMA=222, Sharpe=-0.1219, Trades=14
[INFO] Cluster 36 cluster: Short SMA=100, Long SMA=276, Sharpe=-0.2965, Trades=13
[INFO] Cluster 37 cluster: Short SMA=84, Long SMA=106, Sharpe=-0.1518, Trades=46
[INFO] Cluster 38 cluster: Short SMA=78, Long SMA=258, Sharpe=-0.0174, Trades=12
[INFO] Cluster 39 cluster: Short SMA=200, Long SMA=230, Sharpe=-0.0093, Trades=22
[INFO] Cluster 40 cluster: Short SMA=248, Long SMA=252, Sharpe=0.0691, Trades=50
[INFO] Cluster 41 cluster: Short SMA=80, Long SMA=134, Sharpe=-0.2538, Trades=28
[INFO] Cluster 42 cluster: Short SMA=184, Long SMA=290, Sharpe=-0.1121, Trades=13
[INFO] Cluster 44 cluster: Short SMA=32, Long SMA=54, Sharpe=-0.7663, Trades=68
[INFO] Cluster 45 cluster: Short SMA=132, Long SMA=226, Sharpe=0.0269, Trades=12
[INFO] Cluster 46 cluster: Short SMA=144, Long SMA=162, Sharpe=-0.5548, Trades=36
[INFO] Cluster 48 cluster: Short SMA=88, Long SMA=162, Sharpe=-0.0208, Trades=18
[INFO] Cluster 49 cluster: Short SMA=14, Long SMA=88, Sharpe=-1.1458, Trades=56
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6303, Trades=52
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=114, Long SMA=136, Sharpe=0.4568, Trades=40
[INFO] Top 2: Short SMA=124, Long SMA=132, Sharpe=0.2665, Trades=64
[INFO] Top 3: Short SMA=148, Long SMA=250, Sharpe=0.2391, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10559 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(114/136) - Original Sharpe: 0.4568, Trades: 40
[INFO] Hierarchical cluster 2: SMA(124/132) - Original Sharpe: 0.2665, Trades: 64
[INFO] Hierarchical cluster 3: SMA(148/250) - Original Sharpe: 0.2391, Trades: 12
[INFO] Hierarchical cluster 4: SMA(100/156) - Original Sharpe: 0.1466, Trades: 20
[INFO] Hierarchical cluster 5: SMA(246/248) - Original Sharpe: 0.0845, Trades: 80
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (114/136) - Sharpe: 0.4568
[INFO] cluster 2: (124/132) - Sharpe: 0.2665
[INFO] cluster 3: (148/250) - Sharpe: 0.2391
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.387066            1.199940
1    2021-11-10 2021-11-10            41    -1.369000           -1.958181
2    2022-01-10 2022-01-10            41     1.348855            3.009380
3    2022-03-10 2022-03-10            42     3.066197            2.768531
4    2022-05-10 2022-05-10            41     0.256065            0.062162
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.313270           -0.791676
8    2023-01-10 2023-01-10            41     0.018666            0.018666
9    2023-03-10 2023-03-10            42     3.526516            3.028973
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.369719            0.101703
19   2024-11-10 2024-11-10            35     2.120478            3.502000
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.4 |              1.2 |          0.8 | True          
[INFO] 2021-11-10   |         -1.4 |             -2.0 |         -0.6 | False         
[INFO] 2022-01-10   |          1.3 |              3.0 |          1.7 | True          
[INFO] 2022-03-10   |          3.1 |              2.8 |         -0.3 | False         
[INFO] 2022-05-10   |          0.3 |              0.1 |         -0.2 | False         
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |             -0.8 |         -1.1 | False         
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              3.0 |         -0.5 | False         
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |              0.1 |          1.5 | True          
[INFO] 2024-11-10   |          2.1 |              3.5 |          1.4 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-10, 2022-09-10, 2023-01-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 9 periods (44.44% win rate)
[INFO] Updating Excel file with Hierarchical results for C...
[INFO] Excel file updated successfully. Added C with Hierarchical win rate 44.4% in row 7
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(114/136) - Original Sharpe: 0.4568
[INFO] Added cluster 2 to portfolio: SMA(124/132) - Original Sharpe: 0.2665
[INFO] Added cluster 3 to portfolio: SMA(148/250) - Original Sharpe: 0.2391
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'C_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 1.8603
[INFO] Hierarchical Best out-of-sample Sharpe: 1.6186
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for C...
[INFO] Excel file updated successfully. Added C with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\C
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CC in column D: 40.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.69s
[INFO] Best parameters: Short SMA = 118, Long SMA = 134
[INFO] Best Sharpe ratio: 0.608029, Trades: 52
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CC
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 10.33 contracts
[INFO] Maximum Position Size: 18 contracts
[INFO] Strategy Total P&L: $762,710.00
[INFO] Market Buy & Hold P&L: $114,720.00
[INFO] Outperformance: $647,990.00
[INFO] Sharpe ratio (entire period, annualized): 0.947776
[INFO] Sharpe ratio (in-sample, annualized): 0.608029
[INFO] Sharpe ratio (out-of-sample, annualized): 1.607980
[INFO] Maximum Drawdown: $144,700.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 39
[INFO] Out-of-sample period trades: 13
[INFO] Total trades: 52
[INFO] In-sample P&L: $314,170.00
[INFO] Out-of-sample P&L: $436,860.00
[INFO] 
Best parameters from GA: Short SMA = 118, Long SMA = 134, Sharpe = 0.608029
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10.0
[INFO] Slippage: 40.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.7425 to 0.6080
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.608029
[INFO] Number of Trades: 52
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.7425 to 0.6080
[INFO] Trades range: 12.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.9880 to 2.8413
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 265 elements
[INFO] Kmeans Cluster 1: 194 elements
[INFO] Kmeans Cluster 2: 243 elements
[INFO] Kmeans Cluster 3: 335 elements
[INFO] Kmeans Cluster 4: 289 elements
[INFO] Kmeans Cluster 5: 138 elements
[INFO] Kmeans Cluster 6: 284 elements
[INFO] Kmeans Cluster 7: 316 elements
[INFO] Kmeans Cluster 8: 215 elements
[INFO] Kmeans Cluster 9: 200 elements
[INFO] Kmeans Cluster 10: 284 elements
[INFO] Kmeans Cluster 11: 150 elements
[INFO] Kmeans Cluster 12: 233 elements
[INFO] Kmeans Cluster 13: 243 elements
[INFO] Kmeans Cluster 14: 262 elements
[INFO] Kmeans Cluster 15: 258 elements
[INFO] Kmeans Cluster 16: 245 elements
[INFO] Kmeans Cluster 17: 222 elements
[INFO] Kmeans Cluster 18: 190 elements
[INFO] Kmeans Cluster 19: 236 elements
[INFO] Kmeans Cluster 20: 220 elements
[INFO] Kmeans Cluster 21: 94 elements
[INFO] Kmeans Cluster 22: 70 elements
[INFO] Kmeans Cluster 23: 161 elements
[INFO] Kmeans Cluster 24: 218 elements
[INFO] Kmeans Cluster 25: 252 elements
[INFO] Kmeans Cluster 26: 233 elements
[INFO] Kmeans Cluster 27: 188 elements
[INFO] Kmeans Cluster 28: 134 elements
[INFO] Kmeans Cluster 29: 208 elements
[INFO] Kmeans Cluster 30: 316 elements
[INFO] Kmeans Cluster 31: 139 elements
[INFO] Kmeans Cluster 32: 314 elements
[INFO] Kmeans Cluster 33: 166 elements
[INFO] Kmeans Cluster 34: 205 elements
[INFO] Kmeans Cluster 35: 202 elements
[INFO] Kmeans Cluster 36: 284 elements
[INFO] Kmeans Cluster 37: 186 elements
[INFO] Kmeans Cluster 38: 147 elements
[INFO] Kmeans Cluster 39: 242 elements
[INFO] Kmeans Cluster 40: 287 elements
[INFO] Kmeans Cluster 41: 233 elements
[INFO] Kmeans Cluster 42: 62 elements
[INFO] Kmeans Cluster 43: 215 elements
[INFO] Kmeans Cluster 44: 157 elements
[INFO] Kmeans Cluster 45: 68 elements
[INFO] Kmeans Cluster 46: 159 elements
[INFO] Kmeans Cluster 47: 81 elements
[INFO] Kmeans Cluster 48: 274 elements
[INFO] Kmeans Cluster 49: 268 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=57.19, Long SMA=127.13, Sharpe=-0.5113
[INFO] Centroid 1: Short SMA=165.45, Long SMA=209.86, Sharpe=-0.1044
[INFO] Centroid 2: Short SMA=47.08, Long SMA=246.32, Sharpe=-0.3003
[INFO] Centroid 3: Short SMA=126.47, Long SMA=194.70, Sharpe=-0.2713
[INFO] Centroid 4: Short SMA=185.99, Long SMA=258.69, Sharpe=-0.0462
[INFO] Centroid 5: Short SMA=19.51, Long SMA=53.90, Sharpe=-1.2755
[INFO] Centroid 6: Short SMA=85.57, Long SMA=162.79, Sharpe=-0.0683
[INFO] Centroid 7: Short SMA=107.15, Long SMA=243.28, Sharpe=-0.2171
[INFO] Centroid 8: Short SMA=192.80, Long SMA=221.90, Sharpe=-0.0180
[INFO] Centroid 9: Short SMA=55.86, Long SMA=169.15, Sharpe=-0.3210
[INFO] Centroid 10: Short SMA=77.99, Long SMA=254.49, Sharpe=0.0193
[INFO] Centroid 11: Short SMA=119.57, Long SMA=140.31, Sharpe=0.3037
[INFO] Centroid 12: Short SMA=150.33, Long SMA=270.45, Sharpe=0.0783
[INFO] Centroid 13: Short SMA=25.72, Long SMA=257.23, Sharpe=-0.5381
[INFO] Centroid 14: Short SMA=268.95, Long SMA=286.82, Sharpe=0.0450
[INFO] Centroid 15: Short SMA=35.61, Long SMA=127.43, Sharpe=-0.3233
[INFO] Centroid 16: Short SMA=49.04, Long SMA=206.06, Sharpe=-0.2513
[INFO] Centroid 17: Short SMA=83.05, Long SMA=114.30, Sharpe=-0.3576
[INFO] Centroid 18: Short SMA=58.81, Long SMA=89.21, Sharpe=-0.5894
[INFO] Centroid 19: Short SMA=102.91, Long SMA=285.02, Sharpe=-0.3348
[INFO] Centroid 20: Short SMA=23.50, Long SMA=285.60, Sharpe=-0.6538
[INFO] Centroid 21: Short SMA=41.51, Long SMA=55.83, Sharpe=-0.1291
[INFO] Centroid 22: Short SMA=28.31, Long SMA=45.94, Sharpe=-0.9409
[INFO] Centroid 23: Short SMA=18.53, Long SMA=190.19, Sharpe=-0.6098
[INFO] Centroid 24: Short SMA=54.84, Long SMA=287.46, Sharpe=-0.3705
[INFO] Centroid 25: Short SMA=134.80, Long SMA=287.56, Sharpe=-0.1032
[INFO] Centroid 26: Short SMA=220.88, Long SMA=265.66, Sharpe=0.0904
[INFO] Centroid 27: Short SMA=164.28, Long SMA=236.19, Sharpe=0.0591
[INFO] Centroid 28: Short SMA=15.22, Long SMA=132.64, Sharpe=-0.6951
[INFO] Centroid 29: Short SMA=173.12, Long SMA=193.91, Sharpe=-0.2475
[INFO] Centroid 30: Short SMA=76.41, Long SMA=216.87, Sharpe=-0.0773
[INFO] Centroid 31: Short SMA=219.19, Long SMA=238.98, Sharpe=-0.2274
[INFO] Centroid 32: Short SMA=32.42, Long SMA=166.96, Sharpe=-0.4305
[INFO] Centroid 33: Short SMA=76.42, Long SMA=278.82, Sharpe=-0.1608
[INFO] Centroid 34: Short SMA=44.36, Long SMA=78.67, Sharpe=-0.3878
[INFO] Centroid 35: Short SMA=140.58, Long SMA=167.70, Sharpe=-0.4013
[INFO] Centroid 36: Short SMA=186.46, Long SMA=289.64, Sharpe=-0.1540
[INFO] Centroid 37: Short SMA=127.76, Long SMA=227.06, Sharpe=-0.0774
[INFO] Centroid 38: Short SMA=90.45, Long SMA=112.54, Sharpe=-0.1321
[INFO] Centroid 39: Short SMA=142.15, Long SMA=247.02, Sharpe=0.1733
[INFO] Centroid 40: Short SMA=103.98, Long SMA=147.15, Sharpe=0.1106
[INFO] Centroid 41: Short SMA=24.48, Long SMA=222.56, Sharpe=-0.4597
[INFO] Centroid 42: Short SMA=28.77, Long SMA=43.23, Sharpe=-0.5881
[INFO] Centroid 43: Short SMA=227.36, Long SMA=247.73, Sharpe=-0.0059
[INFO] Centroid 44: Short SMA=35.71, Long SMA=95.82, Sharpe=-0.7847
[INFO] Centroid 45: Short SMA=16.06, Long SMA=91.44, Sharpe=-1.0565
[INFO] Centroid 46: Short SMA=148.92, Long SMA=170.21, Sharpe=-0.1310
[INFO] Centroid 47: Short SMA=18.10, Long SMA=56.57, Sharpe=-1.4982
[INFO] Centroid 48: Short SMA=234.53, Long SMA=286.16, Sharpe=-0.0422
[INFO] Centroid 49: Short SMA=92.19, Long SMA=193.72, Sharpe=-0.1795
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6080, Trades=52
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=120, Long SMA=138, Sharpe=0.2779, Trades=44
[INFO] Kmeans Top 2: Short SMA=142, Long SMA=246, Sharpe=0.2628, Trades=12
[INFO] Kmeans Top 3: Short SMA=104, Long SMA=146, Sharpe=0.1603, Trades=22
[INFO] Kmeans Top 4: Short SMA=152, Long SMA=272, Sharpe=0.0701, Trades=13
[INFO] Kmeans Top 5: Short SMA=192, Long SMA=222, Sharpe=0.0627, Trades=22
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (57, 127)
[INFO]   Nearest: (58.0, 128.0)
[INFO]   Rounded: (165, 210)
[INFO]   Nearest: (166.0, 210.0)
[INFO]   Rounded: (47, 246)
[INFO]   Nearest: (48.0, 246.0)
[INFO]   Rounded: (126, 195)
[INFO]   Nearest: (126.0, 194.0)
[INFO]   Rounded: (186, 259)
[INFO]   Nearest: (186.0, 258.0)
[INFO]   Rounded: (20, 54)
[INFO]   Rounded: (86, 163)
[INFO]   Nearest: (86.0, 162.0)
[INFO]   Rounded: (107, 243)
[INFO]   Nearest: (108.0, 244.0)
[INFO]   Rounded: (193, 222)
[INFO]   Nearest: (192.0, 222.0)
[INFO]   Rounded: (56, 169)
[INFO]   Nearest: (56.0, 170.0)
[INFO]   Rounded: (78, 254)
[INFO]   Rounded: (120, 140)
[INFO]   Rounded: (150, 270)
[INFO]   Rounded: (26, 257)
[INFO]   Nearest: (26.0, 258.0)
[INFO]   Rounded: (269, 287)
[INFO]   Nearest: (268.0, 286.0)
[INFO]   Rounded: (36, 127)
[INFO]   Nearest: (36.0, 128.0)
[INFO]   Rounded: (49, 206)
[INFO]   Nearest: (50.0, 206.0)
[INFO]   Rounded: (83, 114)
[INFO]   Nearest: (84.0, 114.0)
[INFO]   Rounded: (59, 89)
[INFO]   Nearest: (58.0, 90.0)
[INFO]   Rounded: (103, 285)
[INFO]   Nearest: (102.0, 286.0)
[INFO]   Rounded: (24, 286)
[INFO]   Rounded: (42, 56)
[INFO]   Rounded: (28, 46)
[INFO]   Rounded: (19, 190)
[INFO]   Nearest: (18.0, 190.0)
[INFO]   Rounded: (55, 287)
[INFO]   Nearest: (54.0, 288.0)
[INFO]   Rounded: (135, 288)
[INFO]   Nearest: (134.0, 288.0)
[INFO]   Rounded: (221, 266)
[INFO]   Nearest: (220.0, 266.0)
[INFO]   Rounded: (164, 236)
[INFO]   Rounded: (15, 133)
[INFO]   Nearest: (16.0, 132.0)
[INFO]   Rounded: (173, 194)
[INFO]   Nearest: (174.0, 194.0)
[INFO]   Rounded: (76, 217)
[INFO]   Nearest: (76.0, 216.0)
[INFO]   Rounded: (219, 239)
[INFO]   Nearest: (220.0, 238.0)
[INFO]   Rounded: (32, 167)
[INFO]   Nearest: (32.0, 166.0)
[INFO]   Rounded: (76, 279)
[INFO]   Nearest: (76.0, 278.0)
[INFO]   Rounded: (44, 79)
[INFO]   Nearest: (44.0, 78.0)
[INFO]   Rounded: (141, 168)
[INFO]   Nearest: (140.0, 168.0)
[INFO]   Rounded: (186, 290)
[INFO]   Rounded: (128, 227)
[INFO]   Nearest: (128.0, 228.0)
[INFO]   Rounded: (90, 113)
[INFO]   Nearest: (90.0, 112.0)
[INFO]   Rounded: (142, 247)
[INFO]   Nearest: (142.0, 248.0)
[INFO]   Rounded: (104, 147)
[INFO]   Nearest: (104.0, 148.0)
[INFO]   Rounded: (24, 223)
[INFO]   Nearest: (24.0, 222.0)
[INFO]   Rounded: (29, 43)
[INFO]   Nearest: (28.0, 44.0)
[INFO]   Rounded: (227, 248)
[INFO]   Nearest: (228.0, 248.0)
[INFO]   Rounded: (36, 96)
[INFO]   Rounded: (16, 91)
[INFO]   Nearest: (16.0, 92.0)
[INFO]   Rounded: (149, 170)
[INFO]   Nearest: (148.0, 170.0)
[INFO]   Rounded: (18, 57)
[INFO]   Nearest: (18.0, 56.0)
[INFO]   Rounded: (235, 286)
[INFO]   Nearest: (234.0, 286.0)
[INFO]   Rounded: (92, 194)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(120/138) - Original Sharpe: 0.2779, Trades: 44
[INFO] Kmeans cluster 2: SMA(142/246) - Original Sharpe: 0.2628, Trades: 12
[INFO] Kmeans cluster 3: SMA(104/146) - Original Sharpe: 0.1603, Trades: 22
[INFO] Kmeans cluster 4: SMA(152/272) - Original Sharpe: 0.0701, Trades: 13
[INFO] Kmeans cluster 5: SMA(192/222) - Original Sharpe: 0.0627, Trades: 22
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (120/138) - Sharpe: 0.2779
[INFO] cluster 2: (142/246) - Sharpe: 0.2628
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.295900           -0.627664
1    2021-11-10 2021-11-10            41    -1.394418            2.319398
2    2022-01-10 2022-01-10            41     1.323900           -2.761341
3    2022-03-10 2022-03-10            42     3.066197            3.539379
4    2022-05-10 2022-05-10            41     0.194831            3.168935
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.282908           -0.917482
8    2023-01-10 2023-01-10            41     0.018666            0.000000
9    2023-03-10 2023-03-10            42     3.526516            3.867727
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.376819           -1.259435
19   2024-11-10 2024-11-10            35     2.115676            4.092710
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.3 |             -0.6 |         -0.9 | False         
[INFO] 2021-11-10   |         -1.4 |              2.3 |          3.7 | True          
[INFO] 2022-01-10   |          1.3 |             -2.8 |         -4.1 | False         
[INFO] 2022-03-10   |          3.1 |              3.5 |          0.4 | True          
[INFO] 2022-05-10   |          0.2 |              3.2 |          3.0 | True          
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |             -0.9 |         -1.2 | False         
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              3.9 |          0.4 | True          
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |             -1.3 |          0.1 | True          
[INFO] 2024-11-10   |          2.1 |              4.1 |          2.0 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-10, 2022-09-10, 2023-01-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 6 of 9 periods (66.67% win rate)
[INFO] Updating Excel file with Kmeans results for CC...
[INFO] Excel file updated successfully. Added CC with Kmeans win rate 66.7% in row 8
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(120/138) - Original Sharpe: 0.2779
[INFO] Added cluster 2 to portfolio: SMA(142/246) - Original Sharpe: 0.2628
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 1.9056
[INFO] Kmeans Best out-of-sample Sharpe: 1.6080
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for CC...
[INFO] Excel file updated successfully. Added CC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CC
[INFO] Big Point Value: 10.0
[INFO] Slippage: 40.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.7425 to 0.6080
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.608029
[INFO] Number of Trades: 52
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.7425 to 0.6080
[INFO] Trades range: 12.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.9880 to 2.8413
[INFO] Scaled Trades range: -0.6807 to 13.5867
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5223
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 41 elements
[INFO] Cluster 1: 397 elements
[INFO] Cluster 2: 461 elements
[INFO] Cluster 3: 267 elements
[INFO] Cluster 4: 438 elements
[INFO] Cluster 5: 50 elements
[INFO] Cluster 6: 112 elements
[INFO] Cluster 7: 586 elements
[INFO] Cluster 8: 416 elements
[INFO] Cluster 9: 60 elements
[INFO] Cluster 10: 494 elements
[INFO] Cluster 11: 98 elements
[INFO] Cluster 12: 249 elements
[INFO] Cluster 13: 10 elements
[INFO] Cluster 14: 202 elements
[INFO] Cluster 15: 310 elements
[INFO] Cluster 16: 70 elements
[INFO] Cluster 17: 279 elements
[INFO] Cluster 18: 262 elements
[INFO] Cluster 19: 349 elements
[INFO] Cluster 20: 242 elements
[INFO] Cluster 21: 297 elements
[INFO] Cluster 22: 65 elements
[INFO] Cluster 23: 259 elements
[INFO] Cluster 24: 54 elements
[INFO] Cluster 25: 391 elements
[INFO] Cluster 26: 453 elements
[INFO] Cluster 27: 220 elements
[INFO] Cluster 28: 163 elements
[INFO] Cluster 29: 67 elements
[INFO] Cluster 30: 275 elements
[INFO] Cluster 31: 185 elements
[INFO] Cluster 32: 317 elements
[INFO] Cluster 33: 254 elements
[INFO] Cluster 34: 86 elements
[INFO] Cluster 35: 70 elements
[INFO] Cluster 36: 229 elements
[INFO] Cluster 37: 145 elements
[INFO] Cluster 38: 128 elements
[INFO] Cluster 39: 246 elements
[INFO] Cluster 40: 283 elements
[INFO] Cluster 41: 331 elements
[INFO] Cluster 42: 93 elements
[INFO] Cluster 43: 64 elements
[INFO] Cluster 44: 42 elements
[INFO] Cluster 45: 25 elements
[INFO] Cluster 46: 80 elements
[INFO] Cluster 47: 246 elements
[INFO] Cluster 48: 5 elements
[INFO] Cluster 49: 119 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=160, Long SMA=162, Sharpe=-0.1667, Trades=90
[INFO] Cluster 1 cluster: Short SMA=146, Long SMA=220, Sharpe=-0.0727, Trades=14
[INFO] Cluster 2 cluster: Short SMA=228, Long SMA=278, Sharpe=0.1003, Trades=17
[INFO] Cluster 3 cluster: Short SMA=232, Long SMA=252, Sharpe=0.0930, Trades=28
[INFO] Cluster 4 cluster: Short SMA=34, Long SMA=124, Sharpe=-0.2176, Trades=26
[INFO] Cluster 5 cluster: Short SMA=26, Long SMA=34, Sharpe=-1.3572, Trades=108
[INFO] Cluster 6 cluster: Short SMA=178, Long SMA=184, Sharpe=-0.4368, Trades=57
[INFO] Cluster 7 cluster: Short SMA=150, Long SMA=252, Sharpe=0.2058, Trades=12
[INFO] Cluster 8 cluster: Short SMA=88, Long SMA=176, Sharpe=-0.0752, Trades=16
[INFO] Cluster 9 cluster: Short SMA=64, Long SMA=66, Sharpe=-0.7054, Trades=134
[INFO] Cluster 10 cluster: Short SMA=126, Long SMA=190, Sharpe=-0.2236, Trades=16
[INFO] Cluster 11 cluster: Short SMA=48, Long SMA=64, Sharpe=-0.0548, Trades=66
[INFO] Cluster 12 cluster: Short SMA=20, Long SMA=112, Sharpe=-0.7925, Trades=40
[INFO] Cluster 14 cluster: Short SMA=48, Long SMA=80, Sharpe=-0.6905, Trades=44
[INFO] Cluster 15 cluster: Short SMA=100, Long SMA=276, Sharpe=-0.3021, Trades=13
[INFO] Cluster 16 cluster: Short SMA=122, Long SMA=132, Sharpe=0.3302, Trades=64
[INFO] Cluster 17 cluster: Short SMA=62, Long SMA=126, Sharpe=-0.5148, Trades=26
[INFO] Cluster 18 cluster: Short SMA=24, Long SMA=216, Sharpe=-0.5453, Trades=22
[INFO] Cluster 19 cluster: Short SMA=194, Long SMA=288, Sharpe=-0.2352, Trades=13
[INFO] Cluster 20 cluster: Short SMA=200, Long SMA=230, Sharpe=-0.0180, Trades=22
[INFO] Cluster 21 cluster: Short SMA=166, Long SMA=188, Sharpe=-0.2561, Trades=30
[INFO] Cluster 22 cluster: Short SMA=244, Long SMA=248, Sharpe=0.0593, Trades=52
[INFO] Cluster 23 cluster: Short SMA=70, Long SMA=292, Sharpe=-0.3702, Trades=13
[INFO] Cluster 24 cluster: Short SMA=246, Long SMA=248, Sharpe=0.0601, Trades=80
[INFO] Cluster 25 cluster: Short SMA=50, Long SMA=254, Sharpe=-0.3023, Trades=18
[INFO] Cluster 26 cluster: Short SMA=40, Long SMA=172, Sharpe=-0.3227, Trades=24
[INFO] Cluster 27 cluster: Short SMA=24, Long SMA=286, Sharpe=-0.6136, Trades=21
[INFO] Cluster 28 cluster: Short SMA=114, Long SMA=138, Sharpe=0.3696, Trades=36
[INFO] Cluster 29 cluster: Short SMA=62, Long SMA=70, Sharpe=-0.4002, Trades=82
[INFO] Cluster 30 cluster: Short SMA=100, Long SMA=158, Sharpe=0.1172, Trades=20
[INFO] Cluster 31 cluster: Short SMA=266, Long SMA=286, Sharpe=0.1193, Trades=27
[INFO] Cluster 32 cluster: Short SMA=106, Long SMA=232, Sharpe=-0.2352, Trades=12
[INFO] Cluster 33 cluster: Short SMA=52, Long SMA=206, Sharpe=-0.1766, Trades=18
[INFO] Cluster 34 cluster: Short SMA=22, Long SMA=40, Sharpe=-1.3436, Trades=84
[INFO] Cluster 35 cluster: Short SMA=14, Long SMA=88, Sharpe=-1.1715, Trades=56
[INFO] Cluster 36 cluster: Short SMA=138, Long SMA=290, Sharpe=-0.0933, Trades=13
[INFO] Cluster 37 cluster: Short SMA=84, Long SMA=108, Sharpe=-0.4672, Trades=42
[INFO] Cluster 38 cluster: Short SMA=78, Long SMA=136, Sharpe=-0.2458, Trades=24
[INFO] Cluster 39 cluster: Short SMA=78, Long SMA=258, Sharpe=-0.0225, Trades=12
[INFO] Cluster 40 cluster: Short SMA=178, Long SMA=258, Sharpe=-0.0835, Trades=12
[INFO] Cluster 41 cluster: Short SMA=78, Long SMA=222, Sharpe=-0.1280, Trades=14
[INFO] Cluster 42 cluster: Short SMA=14, Long SMA=182, Sharpe=-0.7995, Trades=34
[INFO] Cluster 43 cluster: Short SMA=144, Long SMA=162, Sharpe=-0.5711, Trades=36
[INFO] Cluster 44 cluster: Short SMA=32, Long SMA=54, Sharpe=-0.7978, Trades=68
[INFO] Cluster 45 cluster: Short SMA=20, Long SMA=24, Sharpe=-0.7862, Trades=172
[INFO] Cluster 46 cluster: Short SMA=86, Long SMA=98, Sharpe=-0.2207, Trades=56
[INFO] Cluster 47 cluster: Short SMA=28, Long SMA=258, Sharpe=-0.5227, Trades=20
[INFO] Cluster 49 cluster: Short SMA=18, Long SMA=60, Sharpe=-1.5675, Trades=68
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6080, Trades=52
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=114, Long SMA=138, Sharpe=0.3696, Trades=36
[INFO] Top 2: Short SMA=122, Long SMA=132, Sharpe=0.3302, Trades=64
[INFO] Top 3: Short SMA=150, Long SMA=252, Sharpe=0.2058, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10570 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(114/138) - Original Sharpe: 0.3696, Trades: 36
[INFO] Hierarchical cluster 2: SMA(122/132) - Original Sharpe: 0.3302, Trades: 64
[INFO] Hierarchical cluster 3: SMA(150/252) - Original Sharpe: 0.2058, Trades: 12
[INFO] Hierarchical cluster 4: SMA(266/286) - Original Sharpe: 0.1193, Trades: 27
[INFO] Hierarchical cluster 5: SMA(100/158) - Original Sharpe: 0.1172, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (114/138) - Sharpe: 0.3696
[INFO] cluster 2: (122/132) - Sharpe: 0.3302
[INFO] cluster 3: (150/252) - Sharpe: 0.2058
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.295900            1.719348
1    2021-11-10 2021-11-10            41    -1.394418           -1.651113
2    2022-01-10 2022-01-10            41     1.323900            2.986415
3    2022-03-10 2022-03-10            42     3.066197            2.261628
4    2022-05-10 2022-05-10            41     0.194831            2.823237
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.282908           -0.454282
8    2023-01-10 2023-01-10            41     0.018666            0.018666
9    2023-03-10 2023-03-10            42     3.526516            2.903279
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.376819           -1.208058
19   2024-11-10 2024-11-10            35     2.115676            3.101950
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.3 |              1.7 |          1.4 | True          
[INFO] 2021-11-10   |         -1.4 |             -1.7 |         -0.3 | False         
[INFO] 2022-01-10   |          1.3 |              3.0 |          1.7 | True          
[INFO] 2022-03-10   |          3.1 |              2.3 |         -0.8 | False         
[INFO] 2022-05-10   |          0.2 |              2.8 |          2.6 | True          
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |             -0.5 |         -0.8 | False         
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              2.9 |         -0.6 | False         
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |             -1.2 |          0.2 | True          
[INFO] 2024-11-10   |          2.1 |              3.1 |          1.0 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-10, 2022-09-10, 2023-01-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 9 periods (55.56% win rate)
[INFO] Updating Excel file with Hierarchical results for CC...
[INFO] Excel file updated successfully. Added CC with Hierarchical win rate 55.6% in row 8
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(114/138) - Original Sharpe: 0.3696
[INFO] Added cluster 2 to portfolio: SMA(122/132) - Original Sharpe: 0.3302
[INFO] Added cluster 3 to portfolio: SMA(150/252) - Original Sharpe: 0.2058
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 1.8442
[INFO] Hierarchical Best out-of-sample Sharpe: 1.6080
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for CC...
[INFO] Excel file updated successfully. Added CC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CC
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CD in column D: 7.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.73s
[INFO] Best parameters: Short SMA = 38, Long SMA = 44
[INFO] Best Sharpe ratio: 0.791094, Trades: 100
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CD
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 12.56 contracts
[INFO] Maximum Position Size: 24 contracts
[INFO] Strategy Total P&L: $198,897.00
[INFO] Market Buy & Hold P&L: $-25,775.00
[INFO] Outperformance: $224,672.00
[INFO] Sharpe ratio (entire period, annualized): 0.265370
[INFO] Sharpe ratio (in-sample, annualized): 0.791094
[INFO] Sharpe ratio (out-of-sample, annualized): -0.999272
[INFO] Maximum Drawdown: $290,984.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 67
[INFO] Out-of-sample period trades: 33
[INFO] Total trades: 100
[INFO] In-sample P&L: $408,450.00
[INFO] Out-of-sample P&L: $-214,288.00
[INFO] 
Best parameters from GA: Short SMA = 38, Long SMA = 44, Sharpe = 0.791094
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 7.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7997 to 0.7911
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 44
[INFO] Sharpe Ratio: 0.791094
[INFO] Number of Trades: 100
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7997 to 0.7911
[INFO] Trades range: 10.0 to 354.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6320 to 3.9805
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 228 elements
[INFO] Kmeans Cluster 1: 242 elements
[INFO] Kmeans Cluster 2: 158 elements
[INFO] Kmeans Cluster 3: 173 elements
[INFO] Kmeans Cluster 4: 130 elements
[INFO] Kmeans Cluster 5: 297 elements
[INFO] Kmeans Cluster 6: 88 elements
[INFO] Kmeans Cluster 7: 306 elements
[INFO] Kmeans Cluster 8: 222 elements
[INFO] Kmeans Cluster 9: 177 elements
[INFO] Kmeans Cluster 10: 230 elements
[INFO] Kmeans Cluster 11: 355 elements
[INFO] Kmeans Cluster 12: 225 elements
[INFO] Kmeans Cluster 13: 156 elements
[INFO] Kmeans Cluster 14: 263 elements
[INFO] Kmeans Cluster 15: 179 elements
[INFO] Kmeans Cluster 16: 72 elements
[INFO] Kmeans Cluster 17: 243 elements
[INFO] Kmeans Cluster 18: 91 elements
[INFO] Kmeans Cluster 19: 296 elements
[INFO] Kmeans Cluster 20: 91 elements
[INFO] Kmeans Cluster 21: 217 elements
[INFO] Kmeans Cluster 22: 250 elements
[INFO] Kmeans Cluster 23: 202 elements
[INFO] Kmeans Cluster 24: 151 elements
[INFO] Kmeans Cluster 25: 234 elements
[INFO] Kmeans Cluster 26: 250 elements
[INFO] Kmeans Cluster 27: 210 elements
[INFO] Kmeans Cluster 28: 221 elements
[INFO] Kmeans Cluster 29: 239 elements
[INFO] Kmeans Cluster 30: 196 elements
[INFO] Kmeans Cluster 31: 242 elements
[INFO] Kmeans Cluster 32: 113 elements
[INFO] Kmeans Cluster 33: 324 elements
[INFO] Kmeans Cluster 34: 296 elements
[INFO] Kmeans Cluster 35: 240 elements
[INFO] Kmeans Cluster 36: 234 elements
[INFO] Kmeans Cluster 37: 173 elements
[INFO] Kmeans Cluster 38: 193 elements
[INFO] Kmeans Cluster 39: 225 elements
[INFO] Kmeans Cluster 40: 161 elements
[INFO] Kmeans Cluster 41: 321 elements
[INFO] Kmeans Cluster 42: 186 elements
[INFO] Kmeans Cluster 43: 327 elements
[INFO] Kmeans Cluster 44: 271 elements
[INFO] Kmeans Cluster 45: 159 elements
[INFO] Kmeans Cluster 46: 202 elements
[INFO] Kmeans Cluster 47: 113 elements
[INFO] Kmeans Cluster 48: 262 elements
[INFO] Kmeans Cluster 49: 151 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=60.46, Long SMA=163.89, Sharpe=-0.1019
[INFO] Centroid 1: Short SMA=171.66, Long SMA=265.12, Sharpe=-0.1343
[INFO] Centroid 2: Short SMA=23.71, Long SMA=67.95, Sharpe=0.2478
[INFO] Centroid 3: Short SMA=160.44, Long SMA=190.43, Sharpe=0.2948
[INFO] Centroid 4: Short SMA=63.78, Long SMA=81.09, Sharpe=-0.3864
[INFO] Centroid 5: Short SMA=81.21, Long SMA=284.67, Sharpe=0.0433
[INFO] Centroid 6: Short SMA=256.68, Long SMA=278.77, Sharpe=0.3067
[INFO] Centroid 7: Short SMA=26.64, Long SMA=221.99, Sharpe=0.1310
[INFO] Centroid 8: Short SMA=28.65, Long SMA=94.95, Sharpe=0.1203
[INFO] Centroid 9: Short SMA=134.55, Long SMA=162.17, Sharpe=0.0621
[INFO] Centroid 10: Short SMA=183.12, Long SMA=223.90, Sharpe=-0.2129
[INFO] Centroid 11: Short SMA=31.05, Long SMA=261.31, Sharpe=0.0769
[INFO] Centroid 12: Short SMA=202.84, Long SMA=287.30, Sharpe=-0.3319
[INFO] Centroid 13: Short SMA=274.33, Long SMA=291.83, Sharpe=-0.0067
[INFO] Centroid 14: Short SMA=114.66, Long SMA=253.77, Sharpe=-0.0867
[INFO] Centroid 15: Short SMA=102.93, Long SMA=137.47, Sharpe=-0.1918
[INFO] Centroid 16: Short SMA=92.03, Long SMA=105.42, Sharpe=-0.6010
[INFO] Centroid 17: Short SMA=30.85, Long SMA=115.97, Sharpe=-0.0057
[INFO] Centroid 18: Short SMA=84.59, Long SMA=100.07, Sharpe=0.0151
[INFO] Centroid 19: Short SMA=145.25, Long SMA=265.89, Sharpe=-0.0085
[INFO] Centroid 20: Short SMA=23.76, Long SMA=44.86, Sharpe=0.6054
[INFO] Centroid 21: Short SMA=89.42, Long SMA=249.57, Sharpe=0.0527
[INFO] Centroid 22: Short SMA=56.60, Long SMA=276.66, Sharpe=-0.0552
[INFO] Centroid 23: Short SMA=84.48, Long SMA=126.34, Sharpe=-0.4029
[INFO] Centroid 24: Short SMA=118.44, Long SMA=177.01, Sharpe=0.2880
[INFO] Centroid 25: Short SMA=23.95, Long SMA=165.96, Sharpe=0.2421
[INFO] Centroid 26: Short SMA=28.81, Long SMA=149.51, Sharpe=0.1359
[INFO] Centroid 27: Short SMA=210.53, Long SMA=236.70, Sharpe=-0.4763
[INFO] Centroid 28: Short SMA=85.78, Long SMA=203.04, Sharpe=-0.0087
[INFO] Centroid 29: Short SMA=58.51, Long SMA=103.77, Sharpe=-0.1623
[INFO] Centroid 30: Short SMA=139.62, Long SMA=233.66, Sharpe=-0.2200
[INFO] Centroid 31: Short SMA=113.28, Long SMA=150.67, Sharpe=-0.0561
[INFO] Centroid 32: Short SMA=163.98, Long SMA=209.43, Sharpe=-0.0218
[INFO] Centroid 33: Short SMA=150.75, Long SMA=188.19, Sharpe=0.1487
[INFO] Centroid 34: Short SMA=121.58, Long SMA=288.41, Sharpe=-0.1069
[INFO] Centroid 35: Short SMA=60.00, Long SMA=203.09, Sharpe=-0.1389
[INFO] Centroid 36: Short SMA=32.16, Long SMA=192.56, Sharpe=0.0262
[INFO] Centroid 37: Short SMA=221.56, Long SMA=251.06, Sharpe=-0.3683
[INFO] Centroid 38: Short SMA=173.25, Long SMA=287.66, Sharpe=-0.2819
[INFO] Centroid 39: Short SMA=72.17, Long SMA=131.71, Sharpe=-0.2886
[INFO] Centroid 40: Short SMA=226.89, Long SMA=268.43, Sharpe=-0.1971
[INFO] Centroid 41: Short SMA=115.94, Long SMA=215.13, Sharpe=-0.0674
[INFO] Centroid 42: Short SMA=23.25, Long SMA=49.10, Sharpe=0.4199
[INFO] Centroid 43: Short SMA=64.69, Long SMA=235.14, Sharpe=-0.0734
[INFO] Centroid 44: Short SMA=186.70, Long SMA=228.89, Sharpe=-0.3398
[INFO] Centroid 45: Short SMA=249.40, Long SMA=285.50, Sharpe=0.1535
[INFO] Centroid 46: Short SMA=21.99, Long SMA=283.58, Sharpe=-0.0429
[INFO] Centroid 47: Short SMA=40.64, Long SMA=59.89, Sharpe=0.0027
[INFO] Centroid 48: Short SMA=92.31, Long SMA=177.68, Sharpe=0.1280
[INFO] Centroid 49: Short SMA=234.97, Long SMA=272.93, Sharpe=-0.0139
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=44, Sharpe=0.7911, Trades=100
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=24, Long SMA=46, Sharpe=0.5423, Trades=64
[INFO] Kmeans Top 2: Short SMA=24, Long SMA=52, Sharpe=0.4683, Trades=60
[INFO] Kmeans Top 3: Short SMA=256, Long SMA=278, Sharpe=0.4184, Trades=22
[INFO] Kmeans Top 4: Short SMA=22, Long SMA=72, Sharpe=0.3145, Trades=50
[INFO] Kmeans Top 5: Short SMA=24, Long SMA=166, Sharpe=0.3033, Trades=30
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (60, 164)
[INFO]   Rounded: (172, 265)
[INFO]   Nearest: (172.0, 266.0)
[INFO]   Rounded: (24, 68)
[INFO]   Rounded: (160, 190)
[INFO]   Rounded: (64, 81)
[INFO]   Nearest: (64.0, 82.0)
[INFO]   Rounded: (81, 285)
[INFO]   Nearest: (82.0, 284.0)
[INFO]   Rounded: (257, 279)
[INFO]   Nearest: (256.0, 278.0)
[INFO]   Rounded: (27, 222)
[INFO]   Nearest: (26.0, 222.0)
[INFO]   Rounded: (29, 95)
[INFO]   Nearest: (28.0, 94.0)
[INFO]   Rounded: (135, 162)
[INFO]   Nearest: (134.0, 162.0)
[INFO]   Rounded: (183, 224)
[INFO]   Nearest: (184.0, 224.0)
[INFO]   Rounded: (31, 261)
[INFO]   Nearest: (32.0, 262.0)
[INFO]   Rounded: (203, 287)
[INFO]   Nearest: (202.0, 288.0)
[INFO]   Rounded: (274, 292)
[INFO]   Rounded: (115, 254)
[INFO]   Nearest: (114.0, 254.0)
[INFO]   Rounded: (103, 137)
[INFO]   Nearest: (102.0, 138.0)
[INFO]   Rounded: (92, 105)
[INFO]   Nearest: (92.0, 106.0)
[INFO]   Rounded: (31, 116)
[INFO]   Nearest: (30.0, 116.0)
[INFO]   Rounded: (85, 100)
[INFO]   Nearest: (84.0, 100.0)
[INFO]   Rounded: (145, 266)
[INFO]   Nearest: (146.0, 266.0)
[INFO]   Rounded: (24, 45)
[INFO]   Nearest: (24.0, 44.0)
[INFO]   Rounded: (89, 250)
[INFO]   Nearest: (90.0, 250.0)
[INFO]   Rounded: (57, 277)
[INFO]   Nearest: (56.0, 276.0)
[INFO]   Rounded: (84, 126)
[INFO]   Rounded: (118, 177)
[INFO]   Nearest: (118.0, 178.0)
[INFO]   Rounded: (24, 166)
[INFO]   Rounded: (29, 150)
[INFO]   Nearest: (28.0, 150.0)
[INFO]   Rounded: (211, 237)
[INFO]   Nearest: (210.0, 236.0)
[INFO]   Rounded: (86, 203)
[INFO]   Nearest: (86.0, 204.0)
[INFO]   Rounded: (59, 104)
[INFO]   Nearest: (58.0, 104.0)
[INFO]   Rounded: (140, 234)
[INFO]   Rounded: (113, 151)
[INFO]   Nearest: (114.0, 150.0)
[INFO]   Rounded: (164, 209)
[INFO]   Nearest: (164.0, 210.0)
[INFO]   Rounded: (151, 188)
[INFO]   Nearest: (150.0, 188.0)
[INFO]   Rounded: (122, 288)
[INFO]   Rounded: (60, 203)
[INFO]   Nearest: (60.0, 204.0)
[INFO]   Rounded: (32, 193)
[INFO]   Nearest: (32.0, 192.0)
[INFO]   Rounded: (222, 251)
[INFO]   Nearest: (222.0, 252.0)
[INFO]   Rounded: (173, 288)
[INFO]   Nearest: (174.0, 288.0)
[INFO]   Rounded: (72, 132)
[INFO]   Rounded: (227, 268)
[INFO]   Nearest: (226.0, 268.0)
[INFO]   Rounded: (116, 215)
[INFO]   Nearest: (116.0, 216.0)
[INFO]   Rounded: (23, 49)
[INFO]   Nearest: (24.0, 50.0)
[INFO]   Rounded: (65, 235)
[INFO]   Nearest: (64.0, 236.0)
[INFO]   Rounded: (187, 229)
[INFO]   Nearest: (186.0, 228.0)
[INFO]   Rounded: (249, 285)
[INFO]   Nearest: (250.0, 286.0)
[INFO]   Rounded: (22, 284)
[INFO]   Rounded: (41, 60)
[INFO]   Nearest: (40.0, 60.0)
[INFO]   Rounded: (92, 178)
[INFO]   Rounded: (235, 273)
[INFO]   Nearest: (234.0, 272.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 44
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(24/46) - Original Sharpe: 0.5423, Trades: 64
[INFO] Kmeans cluster 2: SMA(24/52) - Original Sharpe: 0.4683, Trades: 60
[INFO] Kmeans cluster 3: SMA(256/278) - Original Sharpe: 0.4184, Trades: 22
[INFO] Kmeans cluster 4: SMA(22/72) - Original Sharpe: 0.3145, Trades: 50
[INFO] Kmeans cluster 5: SMA(24/166) - Original Sharpe: 0.3033, Trades: 30
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/44)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/46) - Sharpe: 0.5423
[INFO] cluster 2: (24/52) - Sharpe: 0.4683
[INFO] cluster 3: (256/278) - Sharpe: 0.4184
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -4.559447           -3.366935
1    2021-11-14 2021-11-14            43    -2.832319           -3.784963
2    2022-01-14 2022-01-14            41    -0.950707           -2.875425
3    2022-03-14 2022-03-14            44    -3.892117           -2.552112
4    2022-05-14 2022-05-14            43     0.644192            0.238603
5    2022-07-14 2022-07-14            44    -4.160323           -1.613770
6    2022-09-14 2022-09-14            43     1.032024            0.987674
7    2022-11-14 2022-11-14            43    -0.748377           -0.692060
8    2023-01-14 2023-01-14            41    -4.124943           -0.165707
9    2023-03-14 2023-03-14            44     0.052422           -3.773470
10   2023-05-14 2023-05-14            44    -2.505249           -0.714782
11   2023-07-14 2023-07-14            44    -2.114246           -0.169890
12   2023-09-14 2023-09-14            43     1.988935            1.887059
13   2023-11-14 2023-11-14            42    -3.835381           -1.121809
14   2024-01-14 2024-01-14            43    -1.838269            0.119416
15   2024-03-14 2024-03-14            42     1.898357            0.096444
16   2024-05-14 2024-05-14            44     1.248914           -0.361520
17   2024-07-14 2024-07-14            45     0.220219           -3.023481
18   2024-09-14 2024-09-14            43     0.081170            1.440385
19   2024-11-14 2024-11-14            33     3.870625            4.000879
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -4.6 |             -3.4 |          1.2 | True          
[INFO] 2021-11-14   |         -2.8 |             -3.8 |         -1.0 | False         
[INFO] 2022-01-14   |         -1.0 |             -2.9 |         -1.9 | False         
[INFO] 2022-03-14   |         -3.9 |             -2.6 |          1.3 | True          
[INFO] 2022-05-14   |          0.6 |              0.2 |         -0.4 | False         
[INFO] 2022-07-14   |         -4.2 |             -1.6 |          2.6 | True          
[INFO] 2022-09-14   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -4.1 |             -0.2 |          3.9 | True          
[INFO] 2023-03-14   |          0.1 |             -3.8 |         -3.9 | False         
[INFO] 2023-05-14   |         -2.5 |             -0.7 |          1.8 | True          
[INFO] 2023-07-14   |         -2.1 |             -0.2 |          1.9 | True          
[INFO] 2023-09-14   |          2.0 |              1.9 |         -0.1 | False         
[INFO] 2023-11-14   |         -3.8 |             -1.1 |          2.7 | True          
[INFO] 2024-01-14   |         -1.8 |              0.1 |          1.9 | True          
[INFO] 2024-03-14   |          1.9 |              0.1 |         -1.8 | False         
[INFO] 2024-05-14   |          1.2 |             -0.4 |         -1.6 | False         
[INFO] 2024-07-14   |          0.2 |             -3.0 |         -3.2 | False         
[INFO] 2024-09-14   |          0.1 |              1.4 |          1.3 | True          
[INFO] 2024-11-14   |          3.9 |              4.0 |          0.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-09-14, 2022-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 10 of 18 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for CD...
[INFO] Excel file updated successfully. Added CD with Kmeans win rate 55.6% in row 9
[INFO] Added best Sharpe parameters 38/44 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 44
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/46) - Original Sharpe: 0.5423
[INFO] Added cluster 2 to portfolio: SMA(24/52) - Original Sharpe: 0.4683
[INFO] Added cluster 3 to portfolio: SMA(256/278) - Original Sharpe: 0.4184
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.7492
[INFO] Kmeans Best out-of-sample Sharpe: -0.9993
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for CD...
[INFO] Excel file updated successfully. Added CD with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CD
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 7.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7997 to 0.7911
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 44
[INFO] Sharpe Ratio: 0.791094
[INFO] Number of Trades: 100
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7997 to 0.7911
[INFO] Trades range: 10.0 to 354.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6320 to 3.9805
[INFO] Scaled Trades range: -0.8077 to 15.1655
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5960
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 452 elements
[INFO] Cluster 1: 513 elements
[INFO] Cluster 2: 91 elements
[INFO] Cluster 3: 471 elements
[INFO] Cluster 4: 223 elements
[INFO] Cluster 5: 313 elements
[INFO] Cluster 6: 314 elements
[INFO] Cluster 7: 560 elements
[INFO] Cluster 8: 307 elements
[INFO] Cluster 9: 162 elements
[INFO] Cluster 10: 21 elements
[INFO] Cluster 11: 188 elements
[INFO] Cluster 12: 490 elements
[INFO] Cluster 13: 153 elements
[INFO] Cluster 14: 290 elements
[INFO] Cluster 15: 311 elements
[INFO] Cluster 16: 73 elements
[INFO] Cluster 17: 121 elements
[INFO] Cluster 18: 22 elements
[INFO] Cluster 19: 390 elements
[INFO] Cluster 20: 409 elements
[INFO] Cluster 21: 6 elements
[INFO] Cluster 22: 311 elements
[INFO] Cluster 23: 319 elements
[INFO] Cluster 24: 257 elements
[INFO] Cluster 25: 140 elements
[INFO] Cluster 26: 165 elements
[INFO] Cluster 27: 190 elements
[INFO] Cluster 28: 266 elements
[INFO] Cluster 29: 125 elements
[INFO] Cluster 30: 203 elements
[INFO] Cluster 31: 261 elements
[INFO] Cluster 32: 58 elements
[INFO] Cluster 33: 25 elements
[INFO] Cluster 34: 54 elements
[INFO] Cluster 35: 138 elements
[INFO] Cluster 36: 98 elements
[INFO] Cluster 37: 30 elements
[INFO] Cluster 38: 35 elements
[INFO] Cluster 39: 57 elements
[INFO] Cluster 40: 239 elements
[INFO] Cluster 41: 91 elements
[INFO] Cluster 42: 281 elements
[INFO] Cluster 43: 144 elements
[INFO] Cluster 44: 235 elements
[INFO] Cluster 45: 72 elements
[INFO] Cluster 46: 111 elements
[INFO] Cluster 47: 332 elements
[INFO] Cluster 48: 292 elements
[INFO] Cluster 49: 176 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=28, Long SMA=104, Sharpe=-0.0422, Trades=40
[INFO] Cluster 1 cluster: Short SMA=190, Long SMA=286, Sharpe=-0.3084, Trades=14
[INFO] Cluster 2 cluster: Short SMA=276, Long SMA=280, Sharpe=0.0124, Trades=52
[INFO] Cluster 3 cluster: Short SMA=60, Long SMA=256, Sharpe=-0.1211, Trades=14
[INFO] Cluster 4 cluster: Short SMA=250, Long SMA=284, Sharpe=0.3276, Trades=22
[INFO] Cluster 5 cluster: Short SMA=30, Long SMA=158, Sharpe=0.1779, Trades=28
[INFO] Cluster 6 cluster: Short SMA=130, Long SMA=182, Sharpe=0.1883, Trades=22
[INFO] Cluster 7 cluster: Short SMA=102, Long SMA=214, Sharpe=0.0149, Trades=14
[INFO] Cluster 8 cluster: Short SMA=146, Long SMA=192, Sharpe=0.1213, Trades=20
[INFO] Cluster 9 cluster: Short SMA=20, Long SMA=48, Sharpe=0.6373, Trades=66
[INFO] Cluster 10 cluster: Short SMA=30, Long SMA=32, Sharpe=0.0247, Trades=200
[INFO] Cluster 11 cluster: Short SMA=18, Long SMA=164, Sharpe=0.2591, Trades=36
[INFO] Cluster 12 cluster: Short SMA=84, Long SMA=274, Sharpe=0.0461, Trades=12
[INFO] Cluster 13 cluster: Short SMA=202, Long SMA=216, Sharpe=-0.2219, Trades=30
[INFO] Cluster 14 cluster: Short SMA=98, Long SMA=138, Sharpe=-0.3051, Trades=34
[INFO] Cluster 15 cluster: Short SMA=58, Long SMA=110, Sharpe=-0.2515, Trades=34
[INFO] Cluster 16 cluster: Short SMA=160, Long SMA=168, Sharpe=0.1671, Trades=54
[INFO] Cluster 17 cluster: Short SMA=102, Long SMA=120, Sharpe=-0.4915, Trades=44
[INFO] Cluster 18 cluster: Short SMA=30, Long SMA=34, Sharpe=0.0441, Trades=146
[INFO] Cluster 19 cluster: Short SMA=30, Long SMA=258, Sharpe=0.0865, Trades=20
[INFO] Cluster 20 cluster: Short SMA=60, Long SMA=168, Sharpe=-0.0436, Trades=18
[INFO] Cluster 22 cluster: Short SMA=182, Long SMA=236, Sharpe=-0.2634, Trades=20
[INFO] Cluster 23 cluster: Short SMA=210, Long SMA=242, Sharpe=-0.4873, Trades=22
[INFO] Cluster 24 cluster: Short SMA=124, Long SMA=290, Sharpe=-0.0418, Trades=10
[INFO] Cluster 25 cluster: Short SMA=116, Long SMA=158, Sharpe=-0.0028, Trades=34
[INFO] Cluster 26 cluster: Short SMA=22, Long SMA=70, Sharpe=0.2588, Trades=52
[INFO] Cluster 27 cluster: Short SMA=262, Long SMA=290, Sharpe=0.0371, Trades=20
[INFO] Cluster 28 cluster: Short SMA=148, Long SMA=234, Sharpe=-0.3138, Trades=18
[INFO] Cluster 29 cluster: Short SMA=48, Long SMA=68, Sharpe=0.0646, Trades=58
[INFO] Cluster 30 cluster: Short SMA=22, Long SMA=284, Sharpe=-0.1046, Trades=26
[INFO] Cluster 31 cluster: Short SMA=66, Long SMA=128, Sharpe=-0.5548, Trades=32
[INFO] Cluster 32 cluster: Short SMA=26, Long SMA=36, Sharpe=-0.0145, Trades=100
[INFO] Cluster 33 cluster: Short SMA=16, Long SMA=26, Sharpe=0.6297, Trades=124
[INFO] Cluster 34 cluster: Short SMA=78, Long SMA=84, Sharpe=-0.6506, Trades=75
[INFO] Cluster 35 cluster: Short SMA=20, Long SMA=200, Sharpe=-0.0813, Trades=30
[INFO] Cluster 36 cluster: Short SMA=164, Long SMA=214, Sharpe=0.0045, Trades=18
[INFO] Cluster 37 cluster: Short SMA=82, Long SMA=84, Sharpe=-0.3214, Trades=121
[INFO] Cluster 38 cluster: Short SMA=144, Long SMA=146, Sharpe=-0.0178, Trades=112
[INFO] Cluster 39 cluster: Short SMA=146, Long SMA=152, Sharpe=0.0277, Trades=76
[INFO] Cluster 40 cluster: Short SMA=56, Long SMA=206, Sharpe=-0.1903, Trades=16
[INFO] Cluster 41 cluster: Short SMA=58, Long SMA=78, Sharpe=-0.4408, Trades=54
[INFO] Cluster 42 cluster: Short SMA=144, Long SMA=266, Sharpe=0.0216, Trades=10
[INFO] Cluster 43 cluster: Short SMA=228, Long SMA=270, Sharpe=-0.0565, Trades=16
[INFO] Cluster 44 cluster: Short SMA=30, Long SMA=224, Sharpe=0.1818, Trades=22
[INFO] Cluster 45 cluster: Short SMA=222, Long SMA=226, Sharpe=-0.4034, Trades=56
[INFO] Cluster 46 cluster: Short SMA=130, Long SMA=148, Sharpe=0.0091, Trades=50
[INFO] Cluster 47 cluster: Short SMA=114, Long SMA=254, Sharpe=-0.0751, Trades=10
[INFO] Cluster 48 cluster: Short SMA=88, Long SMA=182, Sharpe=0.0166, Trades=14
[INFO] Cluster 49 cluster: Short SMA=170, Long SMA=264, Sharpe=-0.1064, Trades=16
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=44, Sharpe=0.7911, Trades=100
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=20, Long SMA=48, Sharpe=0.6373, Trades=66
[INFO] Top 2: Short SMA=16, Long SMA=26, Sharpe=0.6297, Trades=124
[INFO] Top 3: Short SMA=250, Long SMA=284, Sharpe=0.3276, Trades=22
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10579 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 44
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(20/48) - Original Sharpe: 0.6373, Trades: 66
[INFO] Hierarchical cluster 2: SMA(16/26) - Original Sharpe: 0.6297, Trades: 124
[INFO] Hierarchical cluster 3: SMA(250/284) - Original Sharpe: 0.3276, Trades: 22
[INFO] Hierarchical cluster 4: SMA(18/164) - Original Sharpe: 0.2591, Trades: 36
[INFO] Hierarchical cluster 5: SMA(22/70) - Original Sharpe: 0.2588, Trades: 52
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/44)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (20/48) - Sharpe: 0.6373
[INFO] cluster 2: (16/26) - Sharpe: 0.6297
[INFO] cluster 3: (250/284) - Sharpe: 0.3276
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -4.559447           -3.279724
1    2021-11-14 2021-11-14            43    -2.832319           -0.764695
2    2022-01-14 2022-01-14            41    -0.950707           -2.228976
3    2022-03-14 2022-03-14            44    -3.892117           -0.710241
4    2022-05-14 2022-05-14            43     0.644192           -1.708740
5    2022-07-14 2022-07-14            44    -4.160323           -1.008933
6    2022-09-14 2022-09-14            43     1.032024            2.299271
7    2022-11-14 2022-11-14            43    -0.748377           -1.930487
8    2023-01-14 2023-01-14            41    -4.124943            1.928573
9    2023-03-14 2023-03-14            44     0.052422           -4.974505
10   2023-05-14 2023-05-14            44    -2.505249           -3.037270
11   2023-07-14 2023-07-14            44    -2.114246            0.645298
12   2023-09-14 2023-09-14            43     1.988935            0.230364
13   2023-11-14 2023-11-14            42    -3.835381           -2.562235
14   2024-01-14 2024-01-14            43    -1.838269            0.238900
15   2024-03-14 2024-03-14            42     1.898357            0.943989
16   2024-05-14 2024-05-14            44     1.248914           -2.500041
17   2024-07-14 2024-07-14            45     0.220219           -6.192219
18   2024-09-14 2024-09-14            43     0.081170            1.207796
19   2024-11-14 2024-11-14            33     3.870625            4.000879
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -4.6 |             -3.3 |          1.3 | True          
[INFO] 2021-11-14   |         -2.8 |             -0.8 |          2.0 | True          
[INFO] 2022-01-14   |         -1.0 |             -2.2 |         -1.2 | False         
[INFO] 2022-03-14   |         -3.9 |             -0.7 |          3.2 | True          
[INFO] 2022-05-14   |          0.6 |             -1.7 |         -2.3 | False         
[INFO] 2022-07-14   |         -4.2 |             -1.0 |          3.2 | True          
[INFO] 2022-09-14   |          1.0 |              2.3 |          1.3 | True          
[INFO] 2022-11-14   |         -0.7 |             -1.9 |         -1.2 | False         
[INFO] 2023-01-14   |         -4.1 |              1.9 |          6.0 | True          
[INFO] 2023-03-14   |          0.1 |             -5.0 |         -5.1 | False         
[INFO] 2023-05-14   |         -2.5 |             -3.0 |         -0.5 | False         
[INFO] 2023-07-14   |         -2.1 |              0.6 |          2.7 | True          
[INFO] 2023-09-14   |          2.0 |              0.2 |         -1.8 | False         
[INFO] 2023-11-14   |         -3.8 |             -2.6 |          1.2 | True          
[INFO] 2024-01-14   |         -1.8 |              0.2 |          2.0 | True          
[INFO] 2024-03-14   |          1.9 |              0.9 |         -1.0 | False         
[INFO] 2024-05-14   |          1.2 |             -2.5 |         -3.7 | False         
[INFO] 2024-07-14   |          0.2 |             -6.2 |         -6.4 | False         
[INFO] 2024-09-14   |          0.1 |              1.2 |          1.1 | True          
[INFO] 2024-11-14   |          3.9 |              4.0 |          0.1 | True          
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 20 periods (55.00% win rate)
[INFO] Updating Excel file with Hierarchical results for CD...
[INFO] Excel file updated successfully. Added CD with Hierarchical win rate 55.0% in row 9
[INFO] Added best Sharpe parameters 38/44 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 44
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(20/48) - Original Sharpe: 0.6373
[INFO] Added cluster 2 to portfolio: SMA(16/26) - Original Sharpe: 0.6297
[INFO] Added cluster 3 to portfolio: SMA(250/284) - Original Sharpe: 0.3276
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CD_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.8242
[INFO] Hierarchical Best out-of-sample Sharpe: -0.9993
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for CD...
[INFO] Excel file updated successfully. Added CD with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CD
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CL in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.25s
[INFO] Best parameters: Short SMA = 48, Long SMA = 50
[INFO] Best Sharpe ratio: 0.878812, Trades: 162
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CL
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.78 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $355,616.00
[INFO] Market Buy & Hold P&L: $-27,500.00
[INFO] Outperformance: $383,116.00
[INFO] Sharpe ratio (entire period, annualized): 0.399775
[INFO] Sharpe ratio (in-sample, annualized): 0.878812
[INFO] Sharpe ratio (out-of-sample, annualized): -0.653072
[INFO] Maximum Drawdown: $261,660.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 108
[INFO] Out-of-sample period trades: 54
[INFO] Total trades: 162
[INFO] In-sample P&L: $513,068.00
[INFO] Out-of-sample P&L: $-173,232.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.878812
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6266 to 0.8788
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.878812
[INFO] Number of Trades: 162
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6266 to 0.8788
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.0216 to 3.8079
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 252 elements
[INFO] Kmeans Cluster 1: 262 elements
[INFO] Kmeans Cluster 2: 229 elements
[INFO] Kmeans Cluster 3: 87 elements
[INFO] Kmeans Cluster 4: 313 elements
[INFO] Kmeans Cluster 5: 179 elements
[INFO] Kmeans Cluster 6: 163 elements
[INFO] Kmeans Cluster 7: 193 elements
[INFO] Kmeans Cluster 8: 105 elements
[INFO] Kmeans Cluster 9: 360 elements
[INFO] Kmeans Cluster 10: 178 elements
[INFO] Kmeans Cluster 11: 186 elements
[INFO] Kmeans Cluster 12: 217 elements
[INFO] Kmeans Cluster 13: 252 elements
[INFO] Kmeans Cluster 14: 235 elements
[INFO] Kmeans Cluster 15: 164 elements
[INFO] Kmeans Cluster 16: 112 elements
[INFO] Kmeans Cluster 17: 224 elements
[INFO] Kmeans Cluster 18: 185 elements
[INFO] Kmeans Cluster 19: 262 elements
[INFO] Kmeans Cluster 20: 218 elements
[INFO] Kmeans Cluster 21: 192 elements
[INFO] Kmeans Cluster 22: 350 elements
[INFO] Kmeans Cluster 23: 222 elements
[INFO] Kmeans Cluster 24: 257 elements
[INFO] Kmeans Cluster 25: 213 elements
[INFO] Kmeans Cluster 26: 117 elements
[INFO] Kmeans Cluster 27: 253 elements
[INFO] Kmeans Cluster 28: 141 elements
[INFO] Kmeans Cluster 29: 69 elements
[INFO] Kmeans Cluster 30: 83 elements
[INFO] Kmeans Cluster 31: 223 elements
[INFO] Kmeans Cluster 32: 299 elements
[INFO] Kmeans Cluster 33: 244 elements
[INFO] Kmeans Cluster 34: 317 elements
[INFO] Kmeans Cluster 35: 129 elements
[INFO] Kmeans Cluster 36: 277 elements
[INFO] Kmeans Cluster 37: 139 elements
[INFO] Kmeans Cluster 38: 211 elements
[INFO] Kmeans Cluster 39: 252 elements
[INFO] Kmeans Cluster 40: 154 elements
[INFO] Kmeans Cluster 41: 197 elements
[INFO] Kmeans Cluster 42: 300 elements
[INFO] Kmeans Cluster 43: 236 elements
[INFO] Kmeans Cluster 44: 137 elements
[INFO] Kmeans Cluster 45: 161 elements
[INFO] Kmeans Cluster 46: 207 elements
[INFO] Kmeans Cluster 47: 262 elements
[INFO] Kmeans Cluster 48: 255 elements
[INFO] Kmeans Cluster 49: 312 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=172.30, Long SMA=277.88, Sharpe=0.1213
[INFO] Centroid 1: Short SMA=49.93, Long SMA=255.75, Sharpe=0.2451
[INFO] Centroid 2: Short SMA=61.07, Long SMA=91.97, Sharpe=0.2667
[INFO] Centroid 3: Short SMA=133.24, Long SMA=158.99, Sharpe=-0.2002
[INFO] Centroid 4: Short SMA=220.56, Long SMA=249.34, Sharpe=0.1112
[INFO] Centroid 5: Short SMA=115.21, Long SMA=181.32, Sharpe=0.1569
[INFO] Centroid 6: Short SMA=263.56, Long SMA=293.55, Sharpe=-0.2748
[INFO] Centroid 7: Short SMA=78.22, Long SMA=184.72, Sharpe=0.0431
[INFO] Centroid 8: Short SMA=29.79, Long SMA=51.92, Sharpe=0.6439
[INFO] Centroid 9: Short SMA=126.71, Long SMA=237.23, Sharpe=0.1345
[INFO] Centroid 10: Short SMA=28.81, Long SMA=58.70, Sharpe=0.4752
[INFO] Centroid 11: Short SMA=125.01, Long SMA=150.47, Sharpe=-0.0083
[INFO] Centroid 12: Short SMA=151.20, Long SMA=179.47, Sharpe=0.3648
[INFO] Centroid 13: Short SMA=87.53, Long SMA=272.82, Sharpe=0.1302
[INFO] Centroid 14: Short SMA=188.13, Long SMA=266.55, Sharpe=0.2305
[INFO] Centroid 15: Short SMA=39.45, Long SMA=188.09, Sharpe=0.3376
[INFO] Centroid 16: Short SMA=19.23, Long SMA=39.12, Sharpe=0.3422
[INFO] Centroid 17: Short SMA=28.40, Long SMA=276.33, Sharpe=0.4349
[INFO] Centroid 18: Short SMA=92.43, Long SMA=129.87, Sharpe=-0.2661
[INFO] Centroid 19: Short SMA=236.84, Long SMA=263.85, Sharpe=-0.0035
[INFO] Centroid 20: Short SMA=20.94, Long SMA=173.68, Sharpe=0.1239
[INFO] Centroid 21: Short SMA=114.98, Long SMA=195.27, Sharpe=0.2808
[INFO] Centroid 22: Short SMA=34.51, Long SMA=278.27, Sharpe=0.3203
[INFO] Centroid 23: Short SMA=139.06, Long SMA=286.14, Sharpe=-0.0808
[INFO] Centroid 24: Short SMA=176.05, Long SMA=229.65, Sharpe=0.1562
[INFO] Centroid 25: Short SMA=66.98, Long SMA=188.00, Sharpe=0.1818
[INFO] Centroid 26: Short SMA=124.80, Long SMA=137.66, Sharpe=0.1425
[INFO] Centroid 27: Short SMA=89.55, Long SMA=156.76, Sharpe=-0.1339
[INFO] Centroid 28: Short SMA=28.00, Long SMA=71.06, Sharpe=0.2178
[INFO] Centroid 29: Short SMA=192.17, Long SMA=201.54, Sharpe=0.4870
[INFO] Centroid 30: Short SMA=184.19, Long SMA=198.27, Sharpe=-0.0472
[INFO] Centroid 31: Short SMA=99.29, Long SMA=258.24, Sharpe=0.2214
[INFO] Centroid 32: Short SMA=37.04, Long SMA=89.62, Sharpe=0.3652
[INFO] Centroid 33: Short SMA=252.53, Long SMA=283.84, Sharpe=-0.1451
[INFO] Centroid 34: Short SMA=77.74, Long SMA=225.69, Sharpe=0.2947
[INFO] Centroid 35: Short SMA=68.74, Long SMA=97.53, Sharpe=0.1173
[INFO] Centroid 36: Short SMA=29.45, Long SMA=127.44, Sharpe=0.2800
[INFO] Centroid 37: Short SMA=93.12, Long SMA=122.69, Sharpe=-0.4150
[INFO] Centroid 38: Short SMA=180.36, Long SMA=214.12, Sharpe=0.2930
[INFO] Centroid 39: Short SMA=139.06, Long SMA=266.87, Sharpe=0.0316
[INFO] Centroid 40: Short SMA=92.22, Long SMA=215.17, Sharpe=0.3982
[INFO] Centroid 41: Short SMA=200.71, Long SMA=292.57, Sharpe=-0.0533
[INFO] Centroid 42: Short SMA=26.04, Long SMA=211.59, Sharpe=0.2379
[INFO] Centroid 43: Short SMA=91.16, Long SMA=289.48, Sharpe=0.0140
[INFO] Centroid 44: Short SMA=76.51, Long SMA=116.48, Sharpe=-0.0783
[INFO] Centroid 45: Short SMA=183.98, Long SMA=243.69, Sharpe=0.0508
[INFO] Centroid 46: Short SMA=51.27, Long SMA=154.66, Sharpe=-0.0042
[INFO] Centroid 47: Short SMA=43.86, Long SMA=232.38, Sharpe=0.1532
[INFO] Centroid 48: Short SMA=35.91, Long SMA=135.37, Sharpe=0.1296
[INFO] Centroid 49: Short SMA=146.78, Long SMA=206.19, Sharpe=0.2181
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8788, Trades=162
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=34, Long SMA=52, Sharpe=0.6435, Trades=64
[INFO] Kmeans Top 2: Short SMA=28, Long SMA=58, Sharpe=0.4482, Trades=58
[INFO] Kmeans Top 3: Short SMA=40, Long SMA=188, Sharpe=0.4466, Trades=18
[INFO] Kmeans Top 4: Short SMA=96, Long SMA=216, Sharpe=0.4374, Trades=15
[INFO] Kmeans Top 5: Short SMA=200, Long SMA=210, Sharpe=0.4122, Trades=39
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (172, 278)
[INFO]   Rounded: (50, 256)
[INFO]   Rounded: (61, 92)
[INFO]   Nearest: (62.0, 92.0)
[INFO]   Rounded: (133, 159)
[INFO]   Nearest: (134.0, 158.0)
[INFO]   Rounded: (221, 249)
[INFO]   Nearest: (220.0, 250.0)
[INFO]   Rounded: (115, 181)
[INFO]   Nearest: (116.0, 182.0)
[INFO]   Rounded: (264, 294)
[INFO]   Rounded: (78, 185)
[INFO]   Nearest: (78.0, 184.0)
[INFO]   Rounded: (30, 52)
[INFO]   Rounded: (127, 237)
[INFO]   Nearest: (126.0, 238.0)
[INFO]   Rounded: (29, 59)
[INFO]   Nearest: (28.0, 58.0)
[INFO]   Rounded: (125, 150)
[INFO]   Nearest: (126.0, 150.0)
[INFO]   Rounded: (151, 179)
[INFO]   Nearest: (152.0, 180.0)
[INFO]   Rounded: (88, 273)
[INFO]   Nearest: (88.0, 272.0)
[INFO]   Rounded: (188, 267)
[INFO]   Nearest: (188.0, 266.0)
[INFO]   Rounded: (39, 188)
[INFO]   Nearest: (40.0, 188.0)
[INFO]   Rounded: (19, 39)
[INFO]   Nearest: (20.0, 40.0)
[INFO]   Rounded: (28, 276)
[INFO]   Rounded: (92, 130)
[INFO]   Rounded: (237, 264)
[INFO]   Nearest: (236.0, 264.0)
[INFO]   Rounded: (21, 174)
[INFO]   Nearest: (20.0, 174.0)
[INFO]   Rounded: (115, 195)
[INFO]   Nearest: (114.0, 196.0)
[INFO]   Rounded: (35, 278)
[INFO]   Nearest: (34.0, 278.0)
[INFO]   Rounded: (139, 286)
[INFO]   Nearest: (140.0, 286.0)
[INFO]   Rounded: (176, 230)
[INFO]   Rounded: (67, 188)
[INFO]   Nearest: (66.0, 188.0)
[INFO]   Rounded: (125, 138)
[INFO]   Nearest: (124.0, 138.0)
[INFO]   Rounded: (90, 157)
[INFO]   Nearest: (90.0, 156.0)
[INFO]   Rounded: (28, 71)
[INFO]   Nearest: (28.0, 72.0)
[INFO]   Rounded: (192, 202)
[INFO]   Rounded: (184, 198)
[INFO]   Rounded: (99, 258)
[INFO]   Nearest: (100.0, 258.0)
[INFO]   Rounded: (37, 90)
[INFO]   Nearest: (38.0, 90.0)
[INFO]   Rounded: (253, 284)
[INFO]   Nearest: (252.0, 284.0)
[INFO]   Rounded: (78, 226)
[INFO]   Rounded: (69, 98)
[INFO]   Nearest: (68.0, 98.0)
[INFO]   Rounded: (29, 127)
[INFO]   Nearest: (30.0, 128.0)
[INFO]   Rounded: (93, 123)
[INFO]   Nearest: (94.0, 122.0)
[INFO]   Rounded: (180, 214)
[INFO]   Rounded: (139, 267)
[INFO]   Nearest: (140.0, 266.0)
[INFO]   Rounded: (92, 215)
[INFO]   Nearest: (92.0, 216.0)
[INFO]   Rounded: (201, 293)
[INFO]   Nearest: (200.0, 292.0)
[INFO]   Rounded: (26, 212)
[INFO]   Rounded: (91, 289)
[INFO]   Nearest: (92.0, 290.0)
[INFO]   Rounded: (77, 116)
[INFO]   Nearest: (76.0, 116.0)
[INFO]   Rounded: (184, 244)
[INFO]   Rounded: (51, 155)
[INFO]   Nearest: (52.0, 154.0)
[INFO]   Rounded: (44, 232)
[INFO]   Rounded: (36, 135)
[INFO]   Nearest: (36.0, 136.0)
[INFO]   Rounded: (147, 206)
[INFO]   Nearest: (146.0, 206.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(34/52) - Original Sharpe: 0.6435, Trades: 64
[INFO] Kmeans cluster 2: SMA(28/58) - Original Sharpe: 0.4482, Trades: 58
[INFO] Kmeans cluster 3: SMA(40/188) - Original Sharpe: 0.4466, Trades: 18
[INFO] Kmeans cluster 4: SMA(96/216) - Original Sharpe: 0.4374, Trades: 15
[INFO] Kmeans cluster 5: SMA(200/210) - Original Sharpe: 0.4122, Trades: 39
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/52) - Sharpe: 0.6435
[INFO] cluster 2: (28/58) - Sharpe: 0.4482
[INFO] cluster 3: (40/188) - Sharpe: 0.4466
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.084997            1.595256
1    2021-11-14 2021-11-14            43    -3.371493           -2.486667
2    2022-01-14 2022-01-14            41     0.999580            2.792030
3    2022-03-14 2022-03-14            44    -2.172742           -1.019148
4    2022-05-14 2022-05-14            43    -2.742027           -1.260121
5    2022-07-14 2022-07-14            44     1.611941            2.736294
6    2022-09-14 2022-09-14            43    -0.389136           -0.498543
7    2022-11-14 2022-11-14            43    -1.067985           -2.717489
8    2023-01-14 2023-01-14            41     3.157482            1.943974
9    2023-03-14 2023-03-14            43    -3.021412            0.560417
10   2023-05-14 2023-05-14            44    -0.333860           -1.748459
11   2023-07-14 2023-07-14            44     5.741367            3.897904
12   2023-09-14 2023-09-14            43    -1.017661           -1.661802
13   2023-11-14 2023-11-14            42     1.520442            0.817348
14   2024-01-14 2024-01-14            43    -0.905207           -0.021609
15   2024-03-14 2024-03-14            42     0.235563           -1.141098
16   2024-05-14 2024-05-14            44    -5.318006           -3.241324
17   2024-07-14 2024-07-14            45    -0.143393           -0.961669
18   2024-09-14 2024-09-14            43    -1.755618           -0.064139
19   2024-11-14 2024-11-14            33    -0.116449           -2.404266
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |              1.6 |          3.7 | True          
[INFO] 2021-11-14   |         -3.4 |             -2.5 |          0.9 | True          
[INFO] 2022-01-14   |          1.0 |              2.8 |          1.8 | True          
[INFO] 2022-03-14   |         -2.2 |             -1.0 |          1.2 | True          
[INFO] 2022-05-14   |         -2.7 |             -1.3 |          1.4 | True          
[INFO] 2022-07-14   |          1.6 |              2.7 |          1.1 | True          
[INFO] 2022-09-14   |         -0.4 |             -0.5 |         -0.1 | False         
[INFO] 2022-11-14   |         -1.1 |             -2.7 |         -1.6 | False         
[INFO] 2023-01-14   |          3.2 |              1.9 |         -1.3 | False         
[INFO] 2023-03-14   |         -3.0 |              0.6 |          3.6 | True          
[INFO] 2023-05-14   |         -0.3 |             -1.7 |         -1.4 | False         
[INFO] 2023-07-14   |          5.7 |              3.9 |         -1.8 | False         
[INFO] 2023-09-14   |         -1.0 |             -1.7 |         -0.7 | False         
[INFO] 2023-11-14   |          1.5 |              0.8 |         -0.7 | False         
[INFO] 2024-01-14   |         -0.9 |             -0.0 |          0.9 | True          
[INFO] 2024-03-14   |          0.2 |             -1.1 |         -1.3 | False         
[INFO] 2024-05-14   |         -5.3 |             -3.2 |          2.1 | True          
[INFO] 2024-07-14   |         -0.1 |             -1.0 |         -0.9 | False         
[INFO] 2024-09-14   |         -1.8 |             -0.1 |          1.7 | True          
[INFO] 2024-11-14   |         -0.1 |             -2.4 |         -2.3 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 10 of 20 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for CL...
[INFO] Excel file updated successfully. Added CL with Kmeans win rate 50.0% in row 10
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/52) - Original Sharpe: 0.6435
[INFO] Added cluster 2 to portfolio: SMA(28/58) - Original Sharpe: 0.4482
[INFO] Added cluster 3 to portfolio: SMA(40/188) - Original Sharpe: 0.4466
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CL_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.2028
[INFO] Kmeans Best out-of-sample Sharpe: -0.6531
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for CL...
[INFO] Excel file updated successfully. Added CL with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CL
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6266 to 0.8788
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.878812
[INFO] Number of Trades: 162
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6266 to 0.8788
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.0216 to 3.8079
[INFO] Scaled Trades range: -0.7951 to 15.7640
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6071
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 253 elements
[INFO] Cluster 1: 438 elements
[INFO] Cluster 2: 233 elements
[INFO] Cluster 3: 51 elements
[INFO] Cluster 4: 321 elements
[INFO] Cluster 5: 333 elements
[INFO] Cluster 6: 423 elements
[INFO] Cluster 7: 298 elements
[INFO] Cluster 8: 432 elements
[INFO] Cluster 9: 46 elements
[INFO] Cluster 10: 492 elements
[INFO] Cluster 11: 425 elements
[INFO] Cluster 12: 284 elements
[INFO] Cluster 13: 354 elements
[INFO] Cluster 14: 253 elements
[INFO] Cluster 15: 140 elements
[INFO] Cluster 16: 325 elements
[INFO] Cluster 17: 289 elements
[INFO] Cluster 18: 279 elements
[INFO] Cluster 19: 280 elements
[INFO] Cluster 20: 269 elements
[INFO] Cluster 21: 61 elements
[INFO] Cluster 22: 259 elements
[INFO] Cluster 23: 66 elements
[INFO] Cluster 24: 448 elements
[INFO] Cluster 25: 107 elements
[INFO] Cluster 26: 77 elements
[INFO] Cluster 27: 125 elements
[INFO] Cluster 28: 81 elements
[INFO] Cluster 29: 287 elements
[INFO] Cluster 30: 73 elements
[INFO] Cluster 31: 10 elements
[INFO] Cluster 32: 163 elements
[INFO] Cluster 33: 72 elements
[INFO] Cluster 34: 177 elements
[INFO] Cluster 35: 36 elements
[INFO] Cluster 36: 267 elements
[INFO] Cluster 37: 47 elements
[INFO] Cluster 38: 217 elements
[INFO] Cluster 39: 315 elements
[INFO] Cluster 40: 263 elements
[INFO] Cluster 41: 270 elements
[INFO] Cluster 42: 296 elements
[INFO] Cluster 43: 82 elements
[INFO] Cluster 44: 4 elements
[INFO] Cluster 45: 103 elements
[INFO] Cluster 46: 204 elements
[INFO] Cluster 47: 71 elements
[INFO] Cluster 48: 154 elements
[INFO] Cluster 49: 32 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=92, Long SMA=126, Sharpe=-0.3423, Trades=26
[INFO] Cluster 1 cluster: Short SMA=42, Long SMA=110, Sharpe=0.4037, Trades=26
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=62, Sharpe=0.4966, Trades=56
[INFO] Cluster 3 cluster: Short SMA=38, Long SMA=42, Sharpe=0.4436, Trades=111
[INFO] Cluster 4 cluster: Short SMA=170, Long SMA=210, Sharpe=0.2837, Trades=19
[INFO] Cluster 5 cluster: Short SMA=98, Long SMA=154, Sharpe=-0.2063, Trades=21
[INFO] Cluster 6 cluster: Short SMA=90, Long SMA=260, Sharpe=0.1130, Trades=13
[INFO] Cluster 7 cluster: Short SMA=252, Long SMA=292, Sharpe=-0.1272, Trades=21
[INFO] Cluster 8 cluster: Short SMA=230, Long SMA=256, Sharpe=0.0264, Trades=22
[INFO] Cluster 9 cluster: Short SMA=42, Long SMA=44, Sharpe=0.5017, Trades=146
[INFO] Cluster 10 cluster: Short SMA=84, Long SMA=220, Sharpe=0.2709, Trades=15
[INFO] Cluster 11 cluster: Short SMA=122, Long SMA=192, Sharpe=0.2381, Trades=19
[INFO] Cluster 12 cluster: Short SMA=52, Long SMA=136, Sharpe=0.1933, Trades=22
[INFO] Cluster 13 cluster: Short SMA=198, Long SMA=258, Sharpe=0.2886, Trades=16
[INFO] Cluster 14 cluster: Short SMA=24, Long SMA=90, Sharpe=0.4327, Trades=36
[INFO] Cluster 15 cluster: Short SMA=20, Long SMA=44, Sharpe=0.2535, Trades=74
[INFO] Cluster 16 cluster: Short SMA=140, Long SMA=286, Sharpe=-0.1127, Trades=13
[INFO] Cluster 17 cluster: Short SMA=142, Long SMA=180, Sharpe=0.3321, Trades=23
[INFO] Cluster 18 cluster: Short SMA=24, Long SMA=270, Sharpe=0.3776, Trades=20
[INFO] Cluster 19 cluster: Short SMA=22, Long SMA=154, Sharpe=0.0176, Trades=28
[INFO] Cluster 20 cluster: Short SMA=82, Long SMA=176, Sharpe=0.0449, Trades=20
[INFO] Cluster 21 cluster: Short SMA=108, Long SMA=116, Sharpe=-0.3614, Trades=56
[INFO] Cluster 22 cluster: Short SMA=20, Long SMA=208, Sharpe=0.2667, Trades=28
[INFO] Cluster 23 cluster: Short SMA=150, Long SMA=154, Sharpe=0.0009, Trades=67
[INFO] Cluster 24 cluster: Short SMA=126, Long SMA=246, Sharpe=0.1194, Trades=15
[INFO] Cluster 25 cluster: Short SMA=64, Long SMA=80, Sharpe=0.1572, Trades=53
[INFO] Cluster 26 cluster: Short SMA=176, Long SMA=184, Sharpe=0.2977, Trades=47
[INFO] Cluster 27 cluster: Short SMA=124, Long SMA=138, Sharpe=0.0844, Trades=41
[INFO] Cluster 28 cluster: Short SMA=242, Long SMA=246, Sharpe=0.1017, Trades=58
[INFO] Cluster 29 cluster: Short SMA=66, Long SMA=188, Sharpe=0.1746, Trades=18
[INFO] Cluster 30 cluster: Short SMA=270, Long SMA=280, Sharpe=-0.1083, Trades=37
[INFO] Cluster 32 cluster: Short SMA=206, Long SMA=292, Sharpe=-0.0738, Trades=15
[INFO] Cluster 33 cluster: Short SMA=184, Long SMA=198, Sharpe=-0.0192, Trades=29
[INFO] Cluster 34 cluster: Short SMA=38, Long SMA=186, Sharpe=0.3097, Trades=20
[INFO] Cluster 35 cluster: Short SMA=106, Long SMA=110, Sharpe=-0.2315, Trades=84
[INFO] Cluster 36 cluster: Short SMA=172, Long SMA=278, Sharpe=0.1972, Trades=17
[INFO] Cluster 37 cluster: Short SMA=38, Long SMA=48, Sharpe=0.7150, Trades=74
[INFO] Cluster 38 cluster: Short SMA=42, Long SMA=286, Sharpe=0.4796, Trades=14
[INFO] Cluster 39 cluster: Short SMA=92, Long SMA=288, Sharpe=0.0643, Trades=14
[INFO] Cluster 40 cluster: Short SMA=40, Long SMA=228, Sharpe=0.1698, Trades=18
[INFO] Cluster 41 cluster: Short SMA=56, Long SMA=258, Sharpe=0.2905, Trades=16
[INFO] Cluster 42 cluster: Short SMA=164, Long SMA=232, Sharpe=0.1008, Trades=17
[INFO] Cluster 43 cluster: Short SMA=12, Long SMA=250, Sharpe=0.5293, Trades=28
[INFO] Cluster 45 cluster: Short SMA=114, Long SMA=148, Sharpe=-0.0496, Trades=25
[INFO] Cluster 46 cluster: Short SMA=160, Long SMA=254, Sharpe=0.0366, Trades=19
[INFO] Cluster 47 cluster: Short SMA=70, Long SMA=94, Sharpe=0.2147, Trades=41
[INFO] Cluster 48 cluster: Short SMA=68, Long SMA=138, Sharpe=-0.0908, Trades=22
[INFO] Cluster 49 cluster: Short SMA=280, Long SMA=284, Sharpe=-0.1702, Trades=57
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8788, Trades=162
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=48, Sharpe=0.7150, Trades=74
[INFO] Top 2: Short SMA=12, Long SMA=250, Sharpe=0.5293, Trades=28
[INFO] Top 3: Short SMA=42, Long SMA=44, Sharpe=0.5017, Trades=146
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10571 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/48) - Original Sharpe: 0.7150, Trades: 74
[INFO] Hierarchical cluster 2: SMA(12/250) - Original Sharpe: 0.5293, Trades: 28
[INFO] Hierarchical cluster 3: SMA(42/44) - Original Sharpe: 0.5017, Trades: 146
[INFO] Hierarchical cluster 4: SMA(32/62) - Original Sharpe: 0.4966, Trades: 56
[INFO] Hierarchical cluster 5: SMA(42/286) - Original Sharpe: 0.4796, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/48) - Sharpe: 0.7150
[INFO] cluster 2: (12/250) - Sharpe: 0.5293
[INFO] cluster 3: (42/44) - Sharpe: 0.5017
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.084997            0.380274
1    2021-11-14 2021-11-14            43    -3.371493           -2.320114
2    2022-01-14 2022-01-14            41     0.999580            2.633910
3    2022-03-14 2022-03-14            44    -2.172742           -0.210781
4    2022-05-14 2022-05-14            43    -2.742027           -2.524345
5    2022-07-14 2022-07-14            44     1.611941            1.798501
6    2022-09-14 2022-09-14            43    -0.389136           -3.175985
7    2022-11-14 2022-11-14            43    -1.067985           -1.481491
8    2023-01-14 2023-01-14            41     3.157482           -1.415664
9    2023-03-14 2023-03-14            43    -3.021412           -0.534803
10   2023-05-14 2023-05-14            44    -0.333860           -1.977833
11   2023-07-14 2023-07-14            44     5.741367            2.261066
12   2023-09-14 2023-09-14            43    -1.017661           -1.791434
13   2023-11-14 2023-11-14            42     1.520442            1.252467
14   2024-01-14 2024-01-14            43    -0.905207            1.493713
15   2024-03-14 2024-03-14            42     0.235563            0.235563
16   2024-05-14 2024-05-14            44    -5.318006           -3.465176
17   2024-07-14 2024-07-14            45    -0.143393           -0.583365
18   2024-09-14 2024-09-14            43    -1.755618           -0.696694
19   2024-11-14 2024-11-14            33    -0.116449           -2.889909
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |              0.4 |          2.5 | True          
[INFO] 2021-11-14   |         -3.4 |             -2.3 |          1.1 | True          
[INFO] 2022-01-14   |          1.0 |              2.6 |          1.6 | True          
[INFO] 2022-03-14   |         -2.2 |             -0.2 |          2.0 | True          
[INFO] 2022-05-14   |         -2.7 |             -2.5 |          0.2 | True          
[INFO] 2022-07-14   |          1.6 |              1.8 |          0.2 | True          
[INFO] 2022-09-14   |         -0.4 |             -3.2 |         -2.8 | False         
[INFO] 2022-11-14   |         -1.1 |             -1.5 |         -0.4 | False         
[INFO] 2023-01-14   |          3.2 |             -1.4 |         -4.6 | False         
[INFO] 2023-03-14   |         -3.0 |             -0.5 |          2.5 | True          
[INFO] 2023-05-14   |         -0.3 |             -2.0 |         -1.7 | False         
[INFO] 2023-07-14   |          5.7 |              2.3 |         -3.4 | False         
[INFO] 2023-09-14   |         -1.0 |             -1.8 |         -0.8 | False         
[INFO] 2023-11-14   |          1.5 |              1.3 |         -0.2 | False         
[INFO] 2024-01-14   |         -0.9 |              1.5 |          2.4 | True          
[INFO] 2024-03-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -3.5 |          1.8 | True          
[INFO] 2024-07-14   |         -0.1 |             -0.6 |         -0.5 | False         
[INFO] 2024-09-14   |         -1.8 |             -0.7 |          1.1 | True          
[INFO] 2024-11-14   |         -0.1 |             -2.9 |         -2.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 19 periods (52.63% win rate)
[INFO] Updating Excel file with Hierarchical results for CL...
[INFO] Excel file updated successfully. Added CL with Hierarchical win rate 52.6% in row 10
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/48) - Original Sharpe: 0.7150
[INFO] Added cluster 2 to portfolio: SMA(12/250) - Original Sharpe: 0.5293
[INFO] Added cluster 3 to portfolio: SMA(42/44) - Original Sharpe: 0.5017
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CL_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.5540
[INFO] Hierarchical Best out-of-sample Sharpe: -0.6531
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for CL...
[INFO] Excel file updated successfully. Added CL with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CL
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CT in column D: 16.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.33s
[INFO] Best parameters: Short SMA = 34, Long SMA = 46
[INFO] Best Sharpe ratio: 0.962456, Trades: 81
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CT
[INFO] Big Point Value (from data): 500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.39 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $473,067.00
[INFO] Market Buy & Hold P&L: $-135.00
[INFO] Outperformance: $473,202.00
[INFO] Sharpe ratio (entire period, annualized): 0.734813
[INFO] Sharpe ratio (in-sample, annualized): 0.962456
[INFO] Sharpe ratio (out-of-sample, annualized): 0.233362
[INFO] Maximum Drawdown: $139,161.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 60
[INFO] Out-of-sample period trades: 21
[INFO] Total trades: 81
[INFO] In-sample P&L: $500,879.00
[INFO] Out-of-sample P&L: $55,046.00
[INFO] 
Best parameters from GA: Short SMA = 34, Long SMA = 46, Sharpe = 0.962456
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 500.0
[INFO] Slippage: 16.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6979 to 0.9625
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.962456
[INFO] Number of Trades: 81
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6979 to 0.9625
[INFO] Trades range: 10.0 to 339.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6852 to 3.9097
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 254 elements
[INFO] Kmeans Cluster 1: 224 elements
[INFO] Kmeans Cluster 2: 242 elements
[INFO] Kmeans Cluster 3: 148 elements
[INFO] Kmeans Cluster 4: 236 elements
[INFO] Kmeans Cluster 5: 226 elements
[INFO] Kmeans Cluster 6: 135 elements
[INFO] Kmeans Cluster 7: 327 elements
[INFO] Kmeans Cluster 8: 250 elements
[INFO] Kmeans Cluster 9: 216 elements
[INFO] Kmeans Cluster 10: 175 elements
[INFO] Kmeans Cluster 11: 127 elements
[INFO] Kmeans Cluster 12: 158 elements
[INFO] Kmeans Cluster 13: 230 elements
[INFO] Kmeans Cluster 14: 204 elements
[INFO] Kmeans Cluster 15: 194 elements
[INFO] Kmeans Cluster 16: 81 elements
[INFO] Kmeans Cluster 17: 166 elements
[INFO] Kmeans Cluster 18: 241 elements
[INFO] Kmeans Cluster 19: 189 elements
[INFO] Kmeans Cluster 20: 215 elements
[INFO] Kmeans Cluster 21: 182 elements
[INFO] Kmeans Cluster 22: 48 elements
[INFO] Kmeans Cluster 23: 193 elements
[INFO] Kmeans Cluster 24: 282 elements
[INFO] Kmeans Cluster 25: 211 elements
[INFO] Kmeans Cluster 26: 300 elements
[INFO] Kmeans Cluster 27: 150 elements
[INFO] Kmeans Cluster 28: 278 elements
[INFO] Kmeans Cluster 29: 244 elements
[INFO] Kmeans Cluster 30: 242 elements
[INFO] Kmeans Cluster 31: 59 elements
[INFO] Kmeans Cluster 32: 274 elements
[INFO] Kmeans Cluster 33: 287 elements
[INFO] Kmeans Cluster 34: 188 elements
[INFO] Kmeans Cluster 35: 144 elements
[INFO] Kmeans Cluster 36: 151 elements
[INFO] Kmeans Cluster 37: 149 elements
[INFO] Kmeans Cluster 38: 130 elements
[INFO] Kmeans Cluster 39: 319 elements
[INFO] Kmeans Cluster 40: 342 elements
[INFO] Kmeans Cluster 41: 223 elements
[INFO] Kmeans Cluster 42: 175 elements
[INFO] Kmeans Cluster 43: 288 elements
[INFO] Kmeans Cluster 44: 262 elements
[INFO] Kmeans Cluster 45: 206 elements
[INFO] Kmeans Cluster 46: 193 elements
[INFO] Kmeans Cluster 47: 328 elements
[INFO] Kmeans Cluster 48: 336 elements
[INFO] Kmeans Cluster 49: 163 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=204.98, Long SMA=250.54, Sharpe=-0.2084
[INFO] Centroid 1: Short SMA=57.32, Long SMA=136.59, Sharpe=0.1238
[INFO] Centroid 2: Short SMA=45.92, Long SMA=280.09, Sharpe=0.2579
[INFO] Centroid 3: Short SMA=134.77, Long SMA=166.73, Sharpe=-0.4786
[INFO] Centroid 4: Short SMA=135.92, Long SMA=230.10, Sharpe=-0.0274
[INFO] Centroid 5: Short SMA=32.77, Long SMA=108.55, Sharpe=0.2272
[INFO] Centroid 6: Short SMA=261.39, Long SMA=280.25, Sharpe=-0.1466
[INFO] Centroid 7: Short SMA=92.29, Long SMA=282.88, Sharpe=-0.1399
[INFO] Centroid 8: Short SMA=69.14, Long SMA=208.03, Sharpe=-0.2364
[INFO] Centroid 9: Short SMA=153.21, Long SMA=282.96, Sharpe=-0.1087
[INFO] Centroid 10: Short SMA=89.23, Long SMA=128.64, Sharpe=-0.1956
[INFO] Centroid 11: Short SMA=31.84, Long SMA=145.09, Sharpe=0.5387
[INFO] Centroid 12: Short SMA=238.43, Long SMA=276.11, Sharpe=-0.4386
[INFO] Centroid 13: Short SMA=67.08, Long SMA=103.20, Sharpe=0.2929
[INFO] Centroid 14: Short SMA=154.83, Long SMA=188.04, Sharpe=0.1748
[INFO] Centroid 15: Short SMA=23.01, Long SMA=165.77, Sharpe=0.3600
[INFO] Centroid 16: Short SMA=18.42, Long SMA=38.37, Sharpe=0.1526
[INFO] Centroid 17: Short SMA=55.45, Long SMA=167.04, Sharpe=-0.0030
[INFO] Centroid 18: Short SMA=176.15, Long SMA=279.52, Sharpe=0.0253
[INFO] Centroid 19: Short SMA=146.76, Long SMA=208.68, Sharpe=-0.2018
[INFO] Centroid 20: Short SMA=210.88, Long SMA=232.47, Sharpe=-0.0421
[INFO] Centroid 21: Short SMA=69.18, Long SMA=275.75, Sharpe=0.0533
[INFO] Centroid 22: Short SMA=34.87, Long SMA=48.75, Sharpe=0.6904
[INFO] Centroid 23: Short SMA=27.70, Long SMA=286.66, Sharpe=0.3990
[INFO] Centroid 24: Short SMA=125.36, Long SMA=264.06, Sharpe=-0.0947
[INFO] Centroid 25: Short SMA=27.52, Long SMA=127.57, Sharpe=0.3635
[INFO] Centroid 26: Short SMA=167.53, Long SMA=195.33, Sharpe=-0.0233
[INFO] Centroid 27: Short SMA=18.76, Long SMA=85.72, Sharpe=0.1238
[INFO] Centroid 28: Short SMA=106.24, Long SMA=181.83, Sharpe=-0.4100
[INFO] Centroid 29: Short SMA=26.47, Long SMA=191.79, Sharpe=0.2856
[INFO] Centroid 30: Short SMA=202.24, Long SMA=283.56, Sharpe=-0.1641
[INFO] Centroid 31: Short SMA=16.07, Long SMA=28.58, Sharpe=-0.1123
[INFO] Centroid 32: Short SMA=73.41, Long SMA=172.16, Sharpe=-0.2505
[INFO] Centroid 33: Short SMA=59.44, Long SMA=243.88, Sharpe=0.0935
[INFO] Centroid 34: Short SMA=56.07, Long SMA=217.13, Sharpe=-0.0949
[INFO] Centroid 35: Short SMA=31.75, Long SMA=59.44, Sharpe=0.4717
[INFO] Centroid 36: Short SMA=87.17, Long SMA=113.91, Sharpe=-0.0468
[INFO] Centroid 37: Short SMA=194.87, Long SMA=215.69, Sharpe=0.1566
[INFO] Centroid 38: Short SMA=274.31, Long SMA=290.49, Sharpe=0.0422
[INFO] Centroid 39: Short SMA=24.34, Long SMA=252.38, Sharpe=0.2046
[INFO] Centroid 40: Short SMA=167.17, Long SMA=241.87, Sharpe=-0.1202
[INFO] Centroid 41: Short SMA=127.58, Long SMA=153.00, Sharpe=-0.2507
[INFO] Centroid 42: Short SMA=63.26, Long SMA=78.45, Sharpe=0.1081
[INFO] Centroid 43: Short SMA=100.73, Long SMA=243.92, Sharpe=-0.1683
[INFO] Centroid 44: Short SMA=106.37, Long SMA=140.75, Sharpe=-0.4422
[INFO] Centroid 45: Short SMA=37.05, Long SMA=72.82, Sharpe=0.3027
[INFO] Centroid 46: Short SMA=23.32, Long SMA=215.39, Sharpe=0.1696
[INFO] Centroid 47: Short SMA=234.91, Long SMA=274.26, Sharpe=-0.2949
[INFO] Centroid 48: Short SMA=102.07, Long SMA=208.40, Sharpe=-0.3419
[INFO] Centroid 49: Short SMA=128.83, Long SMA=288.91, Sharpe=-0.1875
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=46, Sharpe=0.9625, Trades=81
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=32, Long SMA=146, Sharpe=0.8063, Trades=20
[INFO] Kmeans Top 2: Short SMA=36, Long SMA=48, Sharpe=0.6032, Trades=83
[INFO] Kmeans Top 3: Short SMA=26, Long SMA=288, Sharpe=0.4214, Trades=14
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=56, Sharpe=0.3805, Trades=49
[INFO] Kmeans Top 5: Short SMA=26, Long SMA=192, Sharpe=0.3507, Trades=22
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (205, 251)
[INFO]   Nearest: (204.0, 250.0)
[INFO]   Rounded: (57, 137)
[INFO]   Nearest: (58.0, 136.0)
[INFO]   Rounded: (46, 280)
[INFO]   Rounded: (135, 167)
[INFO]   Nearest: (134.0, 166.0)
[INFO]   Rounded: (136, 230)
[INFO]   Rounded: (33, 109)
[INFO]   Nearest: (32.0, 108.0)
[INFO]   Rounded: (261, 280)
[INFO]   Nearest: (262.0, 280.0)
[INFO]   Rounded: (92, 283)
[INFO]   Nearest: (92.0, 282.0)
[INFO]   Rounded: (69, 208)
[INFO]   Nearest: (70.0, 208.0)
[INFO]   Rounded: (153, 283)
[INFO]   Nearest: (154.0, 282.0)
[INFO]   Rounded: (89, 129)
[INFO]   Nearest: (90.0, 128.0)
[INFO]   Rounded: (32, 145)
[INFO]   Nearest: (32.0, 146.0)
[INFO]   Rounded: (238, 276)
[INFO]   Rounded: (67, 103)
[INFO]   Nearest: (68.0, 104.0)
[INFO]   Rounded: (155, 188)
[INFO]   Nearest: (154.0, 188.0)
[INFO]   Rounded: (23, 166)
[INFO]   Nearest: (24.0, 166.0)
[INFO]   Rounded: (18, 38)
[INFO]   Rounded: (55, 167)
[INFO]   Nearest: (56.0, 168.0)
[INFO]   Rounded: (176, 280)
[INFO]   Rounded: (147, 209)
[INFO]   Nearest: (146.0, 208.0)
[INFO]   Rounded: (211, 232)
[INFO]   Nearest: (210.0, 232.0)
[INFO]   Rounded: (69, 276)
[INFO]   Nearest: (70.0, 276.0)
[INFO]   Rounded: (35, 49)
[INFO]   Nearest: (34.0, 48.0)
[INFO]   Rounded: (28, 287)
[INFO]   Nearest: (28.0, 286.0)
[INFO]   Rounded: (125, 264)
[INFO]   Nearest: (126.0, 264.0)
[INFO]   Rounded: (28, 128)
[INFO]   Rounded: (168, 195)
[INFO]   Nearest: (168.0, 196.0)
[INFO]   Rounded: (19, 86)
[INFO]   Nearest: (18.0, 86.0)
[INFO]   Rounded: (106, 182)
[INFO]   Rounded: (26, 192)
[INFO]   Rounded: (202, 284)
[INFO]   Rounded: (16, 29)
[INFO]   Nearest: (16.0, 28.0)
[INFO]   Rounded: (73, 172)
[INFO]   Nearest: (74.0, 172.0)
[INFO]   Rounded: (59, 244)
[INFO]   Nearest: (60.0, 244.0)
[INFO]   Rounded: (56, 217)
[INFO]   Nearest: (56.0, 218.0)
[INFO]   Rounded: (32, 59)
[INFO]   Nearest: (32.0, 60.0)
[INFO]   Rounded: (87, 114)
[INFO]   Nearest: (88.0, 114.0)
[INFO]   Rounded: (195, 216)
[INFO]   Nearest: (194.0, 216.0)
[INFO]   Rounded: (274, 290)
[INFO]   Rounded: (24, 252)
[INFO]   Rounded: (167, 242)
[INFO]   Nearest: (168.0, 242.0)
[INFO]   Rounded: (128, 153)
[INFO]   Nearest: (128.0, 152.0)
[INFO]   Rounded: (63, 78)
[INFO]   Nearest: (64.0, 78.0)
[INFO]   Rounded: (101, 244)
[INFO]   Nearest: (100.0, 244.0)
[INFO]   Rounded: (106, 141)
[INFO]   Nearest: (106.0, 140.0)
[INFO]   Rounded: (37, 73)
[INFO]   Nearest: (38.0, 72.0)
[INFO]   Rounded: (23, 215)
[INFO]   Nearest: (24.0, 216.0)
[INFO]   Rounded: (235, 274)
[INFO]   Nearest: (234.0, 274.0)
[INFO]   Rounded: (102, 208)
[INFO]   Rounded: (129, 289)
[INFO]   Nearest: (128.0, 288.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(32/146) - Original Sharpe: 0.8063, Trades: 20
[INFO] Kmeans cluster 2: SMA(36/48) - Original Sharpe: 0.6032, Trades: 83
[INFO] Kmeans cluster 3: SMA(26/288) - Original Sharpe: 0.4214, Trades: 14
[INFO] Kmeans cluster 4: SMA(30/56) - Original Sharpe: 0.3805, Trades: 49
[INFO] Kmeans cluster 5: SMA(26/192) - Original Sharpe: 0.3507, Trades: 22
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (32/146) - Sharpe: 0.8063
[INFO] cluster 2: (36/48) - Sharpe: 0.6032
[INFO] cluster 3: (26/288) - Sharpe: 0.4214
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     4.813792            4.813792
1    2021-11-10 2021-11-10            41    -1.040578           -0.181232
2    2022-01-10 2022-01-10            41    -1.414548            0.240465
3    2022-03-10 2022-03-10            42     3.891271            3.891271
4    2022-05-10 2022-05-10            41    -1.433874           -3.115806
5    2022-07-10 2022-07-10            44    -4.366290           -6.511913
6    2022-09-10 2022-09-10            43    -3.101727           -1.531688
7    2022-11-10 2022-11-10            40     2.171378            0.388156
8    2023-01-10 2023-01-10            41     0.013687            0.085091
9    2023-03-10 2023-03-10            42    -1.173054           -0.098393
10   2023-05-10 2023-05-10            40     0.876456            0.001692
11   2023-07-10 2023-07-10            44    -0.240108           -1.822792
12   2023-09-10 2023-09-10            44     1.293828           -1.819593
13   2023-11-10 2023-11-10            40    -0.460322           -0.625512
14   2024-01-10 2024-01-10            41     3.165454           -0.744174
15   2024-03-10 2024-03-10            43    -1.060941           -4.650580
16   2024-05-10 2024-05-10            40     2.090657            2.090657
17   2024-07-10 2024-07-10            43     1.137725            1.137725
18   2024-09-10 2024-09-10            44    -3.483824           -2.901935
19   2024-11-10 2024-11-10            35     0.406321            2.347072
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -1.0 |             -0.2 |          0.8 | True          
[INFO] 2022-01-10   |         -1.4 |              0.2 |          1.6 | True          
[INFO] 2022-03-10   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.4 |             -3.1 |         -1.7 | False         
[INFO] 2022-07-10   |         -4.4 |             -6.5 |         -2.1 | False         
[INFO] 2022-09-10   |         -3.1 |             -1.5 |          1.6 | True          
[INFO] 2022-11-10   |          2.2 |              0.4 |         -1.8 | False         
[INFO] 2023-01-10   |          0.0 |              0.1 |          0.1 | True          
[INFO] 2023-03-10   |         -1.2 |             -0.1 |          1.1 | True          
[INFO] 2023-05-10   |          0.9 |              0.0 |         -0.9 | False         
[INFO] 2023-07-10   |         -0.2 |             -1.8 |         -1.6 | False         
[INFO] 2023-09-10   |          1.3 |             -1.8 |         -3.1 | False         
[INFO] 2023-11-10   |         -0.5 |             -0.6 |         -0.1 | False         
[INFO] 2024-01-10   |          3.2 |             -0.7 |         -3.9 | False         
[INFO] 2024-03-10   |         -1.1 |             -4.7 |         -3.6 | False         
[INFO] 2024-05-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -3.5 |             -2.9 |          0.6 | True          
[INFO] 2024-11-10   |          0.4 |              2.3 |          1.9 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2022-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 7 of 16 periods (43.75% win rate)
[INFO] Updating Excel file with Kmeans results for CT...
[INFO] Excel file updated successfully. Added CT with Kmeans win rate 43.8% in row 11
[INFO] Added best Sharpe parameters 34/46 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 46
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(32/146) - Original Sharpe: 0.8063
[INFO] Added cluster 2 to portfolio: SMA(36/48) - Original Sharpe: 0.6032
[INFO] Added cluster 3 to portfolio: SMA(26/288) - Original Sharpe: 0.4214
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CT_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0067
[INFO] Kmeans Best out-of-sample Sharpe: 0.2334
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for CT...
[INFO] Excel file updated successfully. Added CT with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CT
[INFO] Big Point Value: 500.0
[INFO] Slippage: 16.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6979 to 0.9625
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.962456
[INFO] Number of Trades: 81
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6979 to 0.9625
[INFO] Trades range: 10.0 to 339.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6852 to 3.9097
[INFO] Scaled Trades range: -0.7533 to 16.0364
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5572
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 565 elements
[INFO] Cluster 1: 417 elements
[INFO] Cluster 2: 143 elements
[INFO] Cluster 3: 204 elements
[INFO] Cluster 4: 496 elements
[INFO] Cluster 5: 236 elements
[INFO] Cluster 6: 603 elements
[INFO] Cluster 7: 241 elements
[INFO] Cluster 8: 141 elements
[INFO] Cluster 9: 34 elements
[INFO] Cluster 10: 556 elements
[INFO] Cluster 11: 315 elements
[INFO] Cluster 12: 378 elements
[INFO] Cluster 13: 96 elements
[INFO] Cluster 14: 237 elements
[INFO] Cluster 15: 480 elements
[INFO] Cluster 16: 251 elements
[INFO] Cluster 17: 88 elements
[INFO] Cluster 18: 6 elements
[INFO] Cluster 19: 281 elements
[INFO] Cluster 20: 261 elements
[INFO] Cluster 21: 230 elements
[INFO] Cluster 22: 179 elements
[INFO] Cluster 23: 252 elements
[INFO] Cluster 24: 31 elements
[INFO] Cluster 25: 106 elements
[INFO] Cluster 26: 228 elements
[INFO] Cluster 27: 63 elements
[INFO] Cluster 28: 359 elements
[INFO] Cluster 29: 338 elements
[INFO] Cluster 30: 44 elements
[INFO] Cluster 31: 343 elements
[INFO] Cluster 32: 66 elements
[INFO] Cluster 33: 14 elements
[INFO] Cluster 34: 326 elements
[INFO] Cluster 35: 174 elements
[INFO] Cluster 36: 166 elements
[INFO] Cluster 37: 114 elements
[INFO] Cluster 38: 106 elements
[INFO] Cluster 39: 278 elements
[INFO] Cluster 40: 24 elements
[INFO] Cluster 41: 31 elements
[INFO] Cluster 42: 245 elements
[INFO] Cluster 43: 39 elements
[INFO] Cluster 44: 118 elements
[INFO] Cluster 45: 271 elements
[INFO] Cluster 46: 123 elements
[INFO] Cluster 47: 205 elements
[INFO] Cluster 48: 59 elements
[INFO] Cluster 49: 24 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=110, Long SMA=160, Sharpe=-0.3858, Trades=20
[INFO] Cluster 1 cluster: Short SMA=20, Long SMA=238, Sharpe=0.1752, Trades=24
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=54, Sharpe=0.5346, Trades=55
[INFO] Cluster 3 cluster: Short SMA=126, Long SMA=158, Sharpe=-0.2617, Trades=22
[INFO] Cluster 4 cluster: Short SMA=202, Long SMA=264, Sharpe=-0.1898, Trades=18
[INFO] Cluster 5 cluster: Short SMA=18, Long SMA=82, Sharpe=0.1345, Trades=46
[INFO] Cluster 6 cluster: Short SMA=136, Long SMA=278, Sharpe=-0.1557, Trades=12
[INFO] Cluster 7 cluster: Short SMA=54, Long SMA=158, Sharpe=0.0841, Trades=16
[INFO] Cluster 8 cluster: Short SMA=166, Long SMA=188, Sharpe=0.1141, Trades=34
[INFO] Cluster 9 cluster: Short SMA=26, Long SMA=30, Sharpe=0.1042, Trades=140
[INFO] Cluster 10 cluster: Short SMA=48, Long SMA=100, Sharpe=0.2755, Trades=32
[INFO] Cluster 11 cluster: Short SMA=178, Long SMA=278, Sharpe=0.0840, Trades=10
[INFO] Cluster 12 cluster: Short SMA=26, Long SMA=182, Sharpe=0.3874, Trades=20
[INFO] Cluster 13 cluster: Short SMA=132, Long SMA=138, Sharpe=-0.2471, Trades=46
[INFO] Cluster 14 cluster: Short SMA=52, Long SMA=224, Sharpe=-0.1211, Trades=16
[INFO] Cluster 15 cluster: Short SMA=104, Long SMA=202, Sharpe=-0.4130, Trades=16
[INFO] Cluster 16 cluster: Short SMA=88, Long SMA=124, Sharpe=-0.1556, Trades=25
[INFO] Cluster 17 cluster: Short SMA=276, Long SMA=284, Sharpe=0.0915, Trades=54
[INFO] Cluster 19 cluster: Short SMA=134, Long SMA=230, Sharpe=-0.0117, Trades=12
[INFO] Cluster 20 cluster: Short SMA=234, Long SMA=284, Sharpe=-0.4889, Trades=18
[INFO] Cluster 21 cluster: Short SMA=240, Long SMA=268, Sharpe=-0.2752, Trades=22
[INFO] Cluster 22 cluster: Short SMA=198, Long SMA=228, Sharpe=-0.0760, Trades=22
[INFO] Cluster 23 cluster: Short SMA=158, Long SMA=246, Sharpe=-0.1415, Trades=12
[INFO] Cluster 24 cluster: Short SMA=264, Long SMA=266, Sharpe=-0.1655, Trades=94
[INFO] Cluster 25 cluster: Short SMA=48, Long SMA=58, Sharpe=0.1460, Trades=76
[INFO] Cluster 26 cluster: Short SMA=22, Long SMA=136, Sharpe=0.4058, Trades=26
[INFO] Cluster 27 cluster: Short SMA=186, Long SMA=190, Sharpe=-0.0681, Trades=66
[INFO] Cluster 28 cluster: Short SMA=46, Long SMA=264, Sharpe=0.1201, Trades=16
[INFO] Cluster 29 cluster: Short SMA=66, Long SMA=206, Sharpe=-0.2540, Trades=16
[INFO] Cluster 30 cluster: Short SMA=198, Long SMA=200, Sharpe=0.2267, Trades=90
[INFO] Cluster 31 cluster: Short SMA=94, Long SMA=284, Sharpe=-0.1501, Trades=14
[INFO] Cluster 32 cluster: Short SMA=20, Long SMA=34, Sharpe=0.1037, Trades=97
[INFO] Cluster 34 cluster: Short SMA=70, Long SMA=260, Sharpe=0.0622, Trades=14
[INFO] Cluster 35 cluster: Short SMA=152, Long SMA=202, Sharpe=0.1428, Trades=16
[INFO] Cluster 36 cluster: Short SMA=58, Long SMA=122, Sharpe=0.1737, Trades=28
[INFO] Cluster 37 cluster: Short SMA=74, Long SMA=86, Sharpe=0.0215, Trades=49
[INFO] Cluster 38 cluster: Short SMA=268, Long SMA=292, Sharpe=-0.0478, Trades=32
[INFO] Cluster 39 cluster: Short SMA=100, Long SMA=244, Sharpe=-0.1381, Trades=14
[INFO] Cluster 40 cluster: Short SMA=46, Long SMA=50, Sharpe=0.2951, Trades=112
[INFO] Cluster 41 cluster: Short SMA=128, Long SMA=130, Sharpe=-0.0129, Trades=80
[INFO] Cluster 42 cluster: Short SMA=28, Long SMA=286, Sharpe=0.4472, Trades=14
[INFO] Cluster 43 cluster: Short SMA=250, Long SMA=256, Sharpe=-0.4934, Trades=61
[INFO] Cluster 44 cluster: Short SMA=172, Long SMA=190, Sharpe=-0.0860, Trades=36
[INFO] Cluster 45 cluster: Short SMA=76, Long SMA=170, Sharpe=-0.3031, Trades=16
[INFO] Cluster 46 cluster: Short SMA=34, Long SMA=146, Sharpe=0.5774, Trades=22
[INFO] Cluster 47 cluster: Short SMA=172, Long SMA=218, Sharpe=-0.0974, Trades=18
[INFO] Cluster 48 cluster: Short SMA=220, Long SMA=228, Sharpe=-0.0897, Trades=45
[INFO] Cluster 49 cluster: Short SMA=38, Long SMA=46, Sharpe=0.6996, Trades=93
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=46, Sharpe=0.9625, Trades=81
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=46, Sharpe=0.6996, Trades=93
[INFO] Top 2: Short SMA=34, Long SMA=146, Sharpe=0.5774, Trades=22
[INFO] Top 3: Short SMA=32, Long SMA=54, Sharpe=0.5346, Trades=55
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10565 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/46) - Original Sharpe: 0.6996, Trades: 93
[INFO] Hierarchical cluster 2: SMA(34/146) - Original Sharpe: 0.5774, Trades: 22
[INFO] Hierarchical cluster 3: SMA(32/54) - Original Sharpe: 0.5346, Trades: 55
[INFO] Hierarchical cluster 4: SMA(28/286) - Original Sharpe: 0.4472, Trades: 14
[INFO] Hierarchical cluster 5: SMA(22/136) - Original Sharpe: 0.4058, Trades: 26
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/46) - Sharpe: 0.6996
[INFO] cluster 2: (34/146) - Sharpe: 0.5774
[INFO] cluster 3: (32/54) - Sharpe: 0.5346
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     4.813792            4.813792
1    2021-11-10 2021-11-10            41    -1.040578           -0.508406
2    2022-01-10 2022-01-10            41    -1.414548           -0.941785
3    2022-03-10 2022-03-10            42     3.891271            3.891271
4    2022-05-10 2022-05-10            41    -1.433874           -3.280444
5    2022-07-10 2022-07-10            44    -4.366290           -5.695941
6    2022-09-10 2022-09-10            43    -3.101727           -1.648852
7    2022-11-10 2022-11-10            40     2.171378            1.584969
8    2023-01-10 2023-01-10            41     0.013687           -3.149596
9    2023-03-10 2023-03-10            42    -1.173054           -0.104846
10   2023-05-10 2023-05-10            40     0.876456            0.988355
11   2023-07-10 2023-07-10            44    -0.240108           -0.975262
12   2023-09-10 2023-09-10            44     1.293828           -0.101590
13   2023-11-10 2023-11-10            40    -0.460322           -0.293809
14   2024-01-10 2024-01-10            41     3.165454            1.692757
15   2024-03-10 2024-03-10            43    -1.060941           -4.192162
16   2024-05-10 2024-05-10            40     2.090657            2.090657
17   2024-07-10 2024-07-10            43     1.137725            1.137725
18   2024-09-10 2024-09-10            44    -3.483824           -3.761869
19   2024-11-10 2024-11-10            35     0.406321            1.225750
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -1.0 |             -0.5 |          0.5 | True          
[INFO] 2022-01-10   |         -1.4 |             -0.9 |          0.5 | True          
[INFO] 2022-03-10   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.4 |             -3.3 |         -1.9 | False         
[INFO] 2022-07-10   |         -4.4 |             -5.7 |         -1.3 | False         
[INFO] 2022-09-10   |         -3.1 |             -1.6 |          1.5 | True          
[INFO] 2022-11-10   |          2.2 |              1.6 |         -0.6 | False         
[INFO] 2023-01-10   |          0.0 |             -3.1 |         -3.1 | False         
[INFO] 2023-03-10   |         -1.2 |             -0.1 |          1.1 | True          
[INFO] 2023-05-10   |          0.9 |              1.0 |          0.1 | True          
[INFO] 2023-07-10   |         -0.2 |             -1.0 |         -0.8 | False         
[INFO] 2023-09-10   |          1.3 |             -0.1 |         -1.4 | False         
[INFO] 2023-11-10   |         -0.5 |             -0.3 |          0.2 | True          
[INFO] 2024-01-10   |          3.2 |              1.7 |         -1.5 | False         
[INFO] 2024-03-10   |         -1.1 |             -4.2 |         -3.1 | False         
[INFO] 2024-05-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -3.5 |             -3.8 |         -0.3 | False         
[INFO] 2024-11-10   |          0.4 |              1.2 |          0.8 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2022-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 16 periods (43.75% win rate)
[INFO] Updating Excel file with Hierarchical results for CT...
[INFO] Excel file updated successfully. Added CT with Hierarchical win rate 43.8% in row 11
[INFO] Added best Sharpe parameters 34/46 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 46
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/46) - Original Sharpe: 0.6996
[INFO] Added cluster 2 to portfolio: SMA(34/146) - Original Sharpe: 0.5774
[INFO] Added cluster 3 to portfolio: SMA(32/54) - Original Sharpe: 0.5346
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CT_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0475
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2334
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for CT...
[INFO] Excel file updated successfully. Added CT with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CT
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for DX in column D: 9.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.58s
[INFO] Best parameters: Short SMA = 38, Long SMA = 46
[INFO] Best Sharpe ratio: 0.858167, Trades: 78
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 396 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @DX
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 11.44 contracts
[INFO] Maximum Position Size: 27 contracts
[INFO] Strategy Total P&L: $299,542.00
[INFO] Market Buy & Hold P&L: $34,961.00
[INFO] Outperformance: $264,581.00
[INFO] Sharpe ratio (entire period, annualized): 0.447473
[INFO] Sharpe ratio (in-sample, annualized): 0.858167
[INFO] Sharpe ratio (out-of-sample, annualized): -0.499666
[INFO] Maximum Drawdown: $282,207.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 58
[INFO] Out-of-sample period trades: 20
[INFO] Total trades: 78
[INFO] In-sample P&L: $454,390.00
[INFO] Out-of-sample P&L: $-114,613.00
[INFO] 
Best parameters from GA: Short SMA = 38, Long SMA = 46, Sharpe = 0.858167
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7443 to 0.8582
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.858167
[INFO] Number of Trades: 78
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10189 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7443 to 0.8582
[INFO] Trades range: 10.0 to 340.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3620 to 2.7774
[INFO] Scaled Long SMA range: -2.7580 to 1.4307
[INFO] Scaled Sharpe ratio range: -2.5342 to 2.5444
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 86 elements
[INFO] Kmeans Cluster 1: 306 elements
[INFO] Kmeans Cluster 2: 77 elements
[INFO] Kmeans Cluster 3: 162 elements
[INFO] Kmeans Cluster 4: 240 elements
[INFO] Kmeans Cluster 5: 181 elements
[INFO] Kmeans Cluster 6: 248 elements
[INFO] Kmeans Cluster 7: 277 elements
[INFO] Kmeans Cluster 8: 189 elements
[INFO] Kmeans Cluster 9: 154 elements
[INFO] Kmeans Cluster 10: 123 elements
[INFO] Kmeans Cluster 11: 246 elements
[INFO] Kmeans Cluster 12: 236 elements
[INFO] Kmeans Cluster 13: 285 elements
[INFO] Kmeans Cluster 14: 283 elements
[INFO] Kmeans Cluster 15: 294 elements
[INFO] Kmeans Cluster 16: 176 elements
[INFO] Kmeans Cluster 17: 232 elements
[INFO] Kmeans Cluster 18: 288 elements
[INFO] Kmeans Cluster 19: 45 elements
[INFO] Kmeans Cluster 20: 256 elements
[INFO] Kmeans Cluster 21: 366 elements
[INFO] Kmeans Cluster 22: 185 elements
[INFO] Kmeans Cluster 23: 252 elements
[INFO] Kmeans Cluster 24: 99 elements
[INFO] Kmeans Cluster 25: 197 elements
[INFO] Kmeans Cluster 26: 312 elements
[INFO] Kmeans Cluster 27: 274 elements
[INFO] Kmeans Cluster 28: 182 elements
[INFO] Kmeans Cluster 29: 92 elements
[INFO] Kmeans Cluster 30: 182 elements
[INFO] Kmeans Cluster 31: 211 elements
[INFO] Kmeans Cluster 32: 127 elements
[INFO] Kmeans Cluster 33: 245 elements
[INFO] Kmeans Cluster 34: 161 elements
[INFO] Kmeans Cluster 35: 115 elements
[INFO] Kmeans Cluster 36: 171 elements
[INFO] Kmeans Cluster 37: 239 elements
[INFO] Kmeans Cluster 38: 279 elements
[INFO] Kmeans Cluster 39: 172 elements
[INFO] Kmeans Cluster 40: 201 elements
[INFO] Kmeans Cluster 41: 225 elements
[INFO] Kmeans Cluster 42: 138 elements
[INFO] Kmeans Cluster 43: 241 elements
[INFO] Kmeans Cluster 44: 243 elements
[INFO] Kmeans Cluster 45: 195 elements
[INFO] Kmeans Cluster 46: 199 elements
[INFO] Kmeans Cluster 47: 177 elements
[INFO] Kmeans Cluster 48: 284 elements
[INFO] Kmeans Cluster 49: 41 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=12.77, Long SMA=99.16, Sharpe=0.0201
[INFO] Centroid 1: Short SMA=165.22, Long SMA=283.68, Sharpe=-0.4523
[INFO] Centroid 2: Short SMA=54.60, Long SMA=274.83, Sharpe=0.2175
[INFO] Centroid 3: Short SMA=90.96, Long SMA=198.69, Sharpe=0.0328
[INFO] Centroid 4: Short SMA=248.71, Long SMA=282.08, Sharpe=-0.2619
[INFO] Centroid 5: Short SMA=62.97, Long SMA=152.17, Sharpe=0.4936
[INFO] Centroid 6: Short SMA=114.86, Long SMA=213.31, Sharpe=-0.1799
[INFO] Centroid 7: Short SMA=27.61, Long SMA=123.15, Sharpe=0.3159
[INFO] Centroid 8: Short SMA=66.67, Long SMA=280.58, Sharpe=0.0083
[INFO] Centroid 9: Short SMA=34.78, Long SMA=57.53, Sharpe=0.4316
[INFO] Centroid 10: Short SMA=214.23, Long SMA=232.81, Sharpe=0.0315
[INFO] Centroid 11: Short SMA=93.55, Long SMA=118.33, Sharpe=0.5558
[INFO] Centroid 12: Short SMA=25.72, Long SMA=197.88, Sharpe=0.4449
[INFO] Centroid 13: Short SMA=169.22, Long SMA=223.36, Sharpe=-0.2092
[INFO] Centroid 14: Short SMA=33.73, Long SMA=83.88, Sharpe=0.2514
[INFO] Centroid 15: Short SMA=56.55, Long SMA=178.78, Sharpe=0.3402
[INFO] Centroid 16: Short SMA=19.82, Long SMA=226.58, Sharpe=0.3788
[INFO] Centroid 17: Short SMA=112.57, Long SMA=244.80, Sharpe=-0.2742
[INFO] Centroid 18: Short SMA=145.23, Long SMA=209.82, Sharpe=-0.3944
[INFO] Centroid 19: Short SMA=14.58, Long SMA=30.00, Sharpe=-0.1369
[INFO] Centroid 20: Short SMA=135.02, Long SMA=158.02, Sharpe=-0.0537
[INFO] Centroid 21: Short SMA=205.73, Long SMA=283.62, Sharpe=-0.3623
[INFO] Centroid 22: Short SMA=20.56, Long SMA=285.11, Sharpe=0.4834
[INFO] Centroid 23: Short SMA=263.75, Long SMA=288.17, Sharpe=-0.1368
[INFO] Centroid 24: Short SMA=32.69, Long SMA=54.32, Sharpe=0.6661
[INFO] Centroid 25: Short SMA=80.79, Long SMA=250.89, Sharpe=0.0142
[INFO] Centroid 26: Short SMA=110.89, Long SMA=284.83, Sharpe=-0.3348
[INFO] Centroid 27: Short SMA=116.10, Long SMA=179.22, Sharpe=-0.0673
[INFO] Centroid 28: Short SMA=192.64, Long SMA=230.77, Sharpe=-0.4017
[INFO] Centroid 29: Short SMA=75.26, Long SMA=101.74, Sharpe=0.3501
[INFO] Centroid 30: Short SMA=50.07, Long SMA=239.97, Sharpe=0.4104
[INFO] Centroid 31: Short SMA=97.71, Long SMA=136.54, Sharpe=0.3636
[INFO] Centroid 32: Short SMA=17.01, Long SMA=43.89, Sharpe=0.1192
[INFO] Centroid 33: Short SMA=32.26, Long SMA=158.80, Sharpe=0.4470
[INFO] Centroid 34: Short SMA=205.94, Long SMA=243.06, Sharpe=-0.1686
[INFO] Centroid 35: Short SMA=13.93, Long SMA=162.87, Sharpe=0.2871
[INFO] Centroid 36: Short SMA=84.81, Long SMA=282.64, Sharpe=-0.1572
[INFO] Centroid 37: Short SMA=28.13, Long SMA=253.36, Sharpe=0.5400
[INFO] Centroid 38: Short SMA=59.33, Long SMA=124.07, Sharpe=0.2113
[INFO] Centroid 39: Short SMA=41.02, Long SMA=279.56, Sharpe=0.4048
[INFO] Centroid 40: Short SMA=180.26, Long SMA=195.19, Sharpe=-0.0840
[INFO] Centroid 41: Short SMA=60.12, Long SMA=88.42, Sharpe=0.1423
[INFO] Centroid 42: Short SMA=115.88, Long SMA=143.35, Sharpe=0.1236
[INFO] Centroid 43: Short SMA=171.03, Long SMA=255.73, Sharpe=-0.3276
[INFO] Centroid 44: Short SMA=231.05, Long SMA=255.92, Sharpe=-0.2424
[INFO] Centroid 45: Short SMA=83.23, Long SMA=225.09, Sharpe=0.1259
[INFO] Centroid 46: Short SMA=86.66, Long SMA=177.93, Sharpe=0.1682
[INFO] Centroid 47: Short SMA=153.05, Long SMA=181.71, Sharpe=-0.2853
[INFO] Centroid 48: Short SMA=56.15, Long SMA=214.53, Sharpe=0.2646
[INFO] Centroid 49: Short SMA=73.56, Long SMA=82.15, Sharpe=-0.0701
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=46, Sharpe=0.8582, Trades=78
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=32, Long SMA=54, Sharpe=0.7377, Trades=50
[INFO] Kmeans Top 2: Short SMA=62, Long SMA=152, Sharpe=0.6381, Trades=19
[INFO] Kmeans Top 3: Short SMA=20, Long SMA=286, Sharpe=0.5868, Trades=15
[INFO] Kmeans Top 4: Short SMA=28, Long SMA=254, Sharpe=0.5567, Trades=13
[INFO] Kmeans Top 5: Short SMA=50, Long SMA=240, Sharpe=0.4678, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (13, 99)
[INFO]   Nearest: (12.0, 100.0)
[INFO]   Rounded: (165, 284)
[INFO]   Nearest: (166.0, 284.0)
[INFO]   Rounded: (55, 275)
[INFO]   Nearest: (54.0, 274.0)
[INFO]   Rounded: (91, 199)
[INFO]   Nearest: (90.0, 198.0)
[INFO]   Rounded: (249, 282)
[INFO]   Nearest: (248.0, 282.0)
[INFO]   Rounded: (63, 152)
[INFO]   Nearest: (62.0, 152.0)
[INFO]   Rounded: (115, 213)
[INFO]   Nearest: (114.0, 214.0)
[INFO]   Rounded: (28, 123)
[INFO]   Nearest: (28.0, 124.0)
[INFO]   Rounded: (67, 281)
[INFO]   Nearest: (66.0, 280.0)
[INFO]   Rounded: (35, 58)
[INFO]   Nearest: (34.0, 58.0)
[INFO]   Rounded: (214, 233)
[INFO]   Nearest: (214.0, 232.0)
[INFO]   Rounded: (94, 118)
[INFO]   Rounded: (26, 198)
[INFO]   Rounded: (169, 223)
[INFO]   Nearest: (170.0, 224.0)
[INFO]   Rounded: (34, 84)
[INFO]   Rounded: (57, 179)
[INFO]   Nearest: (56.0, 178.0)
[INFO]   Rounded: (20, 227)
[INFO]   Nearest: (20.0, 226.0)
[INFO]   Rounded: (113, 245)
[INFO]   Nearest: (112.0, 244.0)
[INFO]   Rounded: (145, 210)
[INFO]   Nearest: (146.0, 210.0)
[INFO]   Rounded: (15, 30)
[INFO]   Nearest: (14.0, 30.0)
[INFO]   Rounded: (135, 158)
[INFO]   Nearest: (136.0, 158.0)
[INFO]   Rounded: (206, 284)
[INFO]   Rounded: (21, 285)
[INFO]   Nearest: (20.0, 286.0)
[INFO]   Rounded: (264, 288)
[INFO]   Rounded: (33, 54)
[INFO]   Nearest: (32.0, 54.0)
[INFO]   Rounded: (81, 251)
[INFO]   Nearest: (80.0, 250.0)
[INFO]   Rounded: (111, 285)
[INFO]   Nearest: (110.0, 284.0)
[INFO]   Rounded: (116, 179)
[INFO]   Nearest: (116.0, 180.0)
[INFO]   Rounded: (193, 231)
[INFO]   Nearest: (192.0, 230.0)
[INFO]   Rounded: (75, 102)
[INFO]   Nearest: (76.0, 102.0)
[INFO]   Rounded: (50, 240)
[INFO]   Rounded: (98, 137)
[INFO]   Nearest: (98.0, 136.0)
[INFO]   Rounded: (17, 44)
[INFO]   Nearest: (18.0, 44.0)
[INFO]   Rounded: (32, 159)
[INFO]   Nearest: (32.0, 158.0)
[INFO]   Rounded: (206, 243)
[INFO]   Nearest: (206.0, 244.0)
[INFO]   Rounded: (14, 163)
[INFO]   Nearest: (14.0, 162.0)
[INFO]   Rounded: (85, 283)
[INFO]   Nearest: (84.0, 282.0)
[INFO]   Rounded: (28, 253)
[INFO]   Nearest: (28.0, 254.0)
[INFO]   Rounded: (59, 124)
[INFO]   Nearest: (60.0, 124.0)
[INFO]   Rounded: (41, 280)
[INFO]   Nearest: (42.0, 280.0)
[INFO]   Rounded: (180, 195)
[INFO]   Nearest: (180.0, 196.0)
[INFO]   Rounded: (60, 88)
[INFO]   Rounded: (116, 143)
[INFO]   Nearest: (116.0, 144.0)
[INFO]   Rounded: (171, 256)
[INFO]   Nearest: (172.0, 256.0)
[INFO]   Rounded: (231, 256)
[INFO]   Nearest: (232.0, 256.0)
[INFO]   Rounded: (83, 225)
[INFO]   Nearest: (84.0, 226.0)
[INFO]   Rounded: (87, 178)
[INFO]   Nearest: (86.0, 178.0)
[INFO]   Rounded: (153, 182)
[INFO]   Nearest: (154.0, 182.0)
[INFO]   Rounded: (56, 215)
[INFO]   Nearest: (56.0, 214.0)
[INFO]   Rounded: (74, 82)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(32/54) - Original Sharpe: 0.7377, Trades: 50
[INFO] Kmeans cluster 2: SMA(62/152) - Original Sharpe: 0.6381, Trades: 19
[INFO] Kmeans cluster 3: SMA(20/286) - Original Sharpe: 0.5868, Trades: 15
[INFO] Kmeans cluster 4: SMA(28/254) - Original Sharpe: 0.5567, Trades: 13
[INFO] Kmeans cluster 5: SMA(50/240) - Original Sharpe: 0.4678, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2816
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (32/54) - Sharpe: 0.7377
[INFO] cluster 2: (62/152) - Sharpe: 0.6381
[INFO] cluster 3: (20/286) - Sharpe: 0.5868
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Out-of-sample period starts on: 2021-09-24
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-24 2021-09-24            43     3.830825            3.830825
1    2021-11-24 2021-11-24            42    -0.750030           -0.975845
2    2022-01-24 2022-01-24            43    -1.158438            2.908511
3    2022-03-24 2022-03-24            42     2.899845            2.899845
4    2022-05-24 2022-05-24            44    -0.772793            3.060061
5    2022-07-24 2022-07-24            45     4.284626            3.795241
6    2022-09-24 2022-09-24            43    -1.964998           -2.488069
7    2022-11-24 2022-11-24            41     2.719154           -0.939014
8    2023-01-24 2023-01-24            43    -4.933460           -3.889108
9    2023-03-24 2023-03-24            43    -4.230774           -2.448649
10   2023-05-24 2023-05-24            43    -5.713874           -0.807369
11   2023-07-24 2023-07-24            45    -1.713757           -3.185753
12   2023-09-24 2023-09-24            44    -0.948650           -1.107919
13   2023-11-24 2023-11-24            41    -0.015249           -5.583361
14   2024-01-24 2024-01-24            43    -1.669992           -0.015138
15   2024-03-24 2024-03-24            43    -3.457983           -0.554942
16   2024-05-24 2024-05-24            43    -0.337335           -0.526494
17   2024-07-24 2024-07-24            44     0.689877           -2.609827
18   2024-09-24 2024-09-24            44     0.685285           -2.907787
19   2024-11-24 2024-11-24            26     1.390507            3.171480
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-24   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2021-11-24   |         -0.8 |             -1.0 |         -0.2 | False         
[INFO] 2022-01-24   |         -1.2 |              2.9 |          4.1 | True          
[INFO] 2022-03-24   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-05-24   |         -0.8 |              3.1 |          3.9 | True          
[INFO] 2022-07-24   |          4.3 |              3.8 |         -0.5 | False         
[INFO] 2022-09-24   |         -2.0 |             -2.5 |         -0.5 | False         
[INFO] 2022-11-24   |          2.7 |             -0.9 |         -3.6 | False         
[INFO] 2023-01-24   |         -4.9 |             -3.9 |          1.0 | True          
[INFO] 2023-03-24   |         -4.2 |             -2.4 |          1.8 | True          
[INFO] 2023-05-24   |         -5.7 |             -0.8 |          4.9 | True          
[INFO] 2023-07-24   |         -1.7 |             -3.2 |         -1.5 | False         
[INFO] 2023-09-24   |         -0.9 |             -1.1 |         -0.2 | False         
[INFO] 2023-11-24   |         -0.0 |             -5.6 |         -5.6 | False         
[INFO] 2024-01-24   |         -1.7 |             -0.0 |          1.7 | True          
[INFO] 2024-03-24   |         -3.5 |             -0.6 |          2.9 | True          
[INFO] 2024-05-24   |         -0.3 |             -0.5 |         -0.2 | False         
[INFO] 2024-07-24   |          0.7 |             -2.6 |         -3.3 | False         
[INFO] 2024-09-24   |          0.7 |             -2.9 |         -3.6 | False         
[INFO] 2024-11-24   |          1.4 |              3.2 |          1.8 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-24, 2022-03-24
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 8 of 18 periods (44.44% win rate)
[INFO] Updating Excel file with Kmeans results for DX...
[INFO] Excel file updated successfully. Added DX with Kmeans win rate 44.4% in row 12
[INFO] Added best Sharpe parameters 38/46 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 46
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(32/54) - Original Sharpe: 0.7377
[INFO] Added cluster 2 to portfolio: SMA(62/152) - Original Sharpe: 0.6381
[INFO] Added cluster 3 to portfolio: SMA(20/286) - Original Sharpe: 0.5868
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'DX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0086
[INFO] Kmeans Best out-of-sample Sharpe: -0.4997
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for DX...
[INFO] Excel file updated successfully. Added DX with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\DX
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7443 to 0.8582
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.858167
[INFO] Number of Trades: 78
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10189 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7443 to 0.8582
[INFO] Trades range: 10.0 to 340.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3620 to 2.7774
[INFO] Scaled Long SMA range: -2.7580 to 1.4307
[INFO] Scaled Sharpe ratio range: -2.5342 to 2.5444
[INFO] Scaled Trades range: -0.6914 to 16.4374
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10189 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5345
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 184 elements
[INFO] Cluster 1: 369 elements
[INFO] Cluster 2: 330 elements
[INFO] Cluster 3: 81 elements
[INFO] Cluster 4: 48 elements
[INFO] Cluster 5: 21 elements
[INFO] Cluster 6: 310 elements
[INFO] Cluster 7: 479 elements
[INFO] Cluster 8: 299 elements
[INFO] Cluster 9: 91 elements
[INFO] Cluster 10: 109 elements
[INFO] Cluster 11: 156 elements
[INFO] Cluster 12: 312 elements
[INFO] Cluster 13: 48 elements
[INFO] Cluster 14: 298 elements
[INFO] Cluster 15: 375 elements
[INFO] Cluster 16: 339 elements
[INFO] Cluster 17: 228 elements
[INFO] Cluster 18: 100 elements
[INFO] Cluster 19: 227 elements
[INFO] Cluster 20: 370 elements
[INFO] Cluster 21: 384 elements
[INFO] Cluster 22: 316 elements
[INFO] Cluster 23: 297 elements
[INFO] Cluster 24: 354 elements
[INFO] Cluster 25: 321 elements
[INFO] Cluster 26: 135 elements
[INFO] Cluster 27: 287 elements
[INFO] Cluster 28: 246 elements
[INFO] Cluster 29: 11 elements
[INFO] Cluster 30: 38 elements
[INFO] Cluster 31: 211 elements
[INFO] Cluster 32: 108 elements
[INFO] Cluster 33: 4 elements
[INFO] Cluster 34: 40 elements
[INFO] Cluster 35: 45 elements
[INFO] Cluster 36: 254 elements
[INFO] Cluster 37: 82 elements
[INFO] Cluster 38: 53 elements
[INFO] Cluster 39: 169 elements
[INFO] Cluster 40: 162 elements
[INFO] Cluster 41: 205 elements
[INFO] Cluster 42: 124 elements
[INFO] Cluster 43: 382 elements
[INFO] Cluster 44: 207 elements
[INFO] Cluster 45: 357 elements
[INFO] Cluster 46: 148 elements
[INFO] Cluster 47: 329 elements
[INFO] Cluster 48: 65 elements
[INFO] Cluster 49: 81 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=32, Long SMA=62, Sharpe=0.6664, Trades=48
[INFO] Cluster 1 cluster: Short SMA=68, Long SMA=278, Sharpe=0.0002, Trades=11
[INFO] Cluster 2 cluster: Short SMA=190, Long SMA=236, Sharpe=-0.4990, Trades=19
[INFO] Cluster 3 cluster: Short SMA=258, Long SMA=262, Sharpe=-0.2417, Trades=55
[INFO] Cluster 4 cluster: Short SMA=32, Long SMA=38, Sharpe=0.2864, Trades=101
[INFO] Cluster 5 cluster: Short SMA=34, Long SMA=36, Sharpe=0.3559, Trades=173
[INFO] Cluster 6 cluster: Short SMA=42, Long SMA=84, Sharpe=0.2915, Trades=37
[INFO] Cluster 7 cluster: Short SMA=112, Long SMA=184, Sharpe=-0.0415, Trades=14
[INFO] Cluster 8 cluster: Short SMA=72, Long SMA=156, Sharpe=0.5084, Trades=15
[INFO] Cluster 9 cluster: Short SMA=64, Long SMA=74, Sharpe=0.0907, Trades=63
[INFO] Cluster 10 cluster: Short SMA=14, Long SMA=50, Sharpe=0.0652, Trades=67
[INFO] Cluster 11 cluster: Short SMA=14, Long SMA=212, Sharpe=0.3527, Trades=23
[INFO] Cluster 12 cluster: Short SMA=116, Long SMA=224, Sharpe=-0.3028, Trades=12
[INFO] Cluster 13 cluster: Short SMA=110, Long SMA=114, Sharpe=0.4147, Trades=52
[INFO] Cluster 14 cluster: Short SMA=34, Long SMA=152, Sharpe=0.3887, Trades=25
[INFO] Cluster 15 cluster: Short SMA=58, Long SMA=118, Sharpe=0.1921, Trades=25
[INFO] Cluster 16 cluster: Short SMA=146, Long SMA=216, Sharpe=-0.3949, Trades=15
[INFO] Cluster 17 cluster: Short SMA=28, Long SMA=288, Sharpe=0.4546, Trades=15
[INFO] Cluster 18 cluster: Short SMA=12, Long SMA=94, Sharpe=0.0380, Trades=47
[INFO] Cluster 19 cluster: Short SMA=194, Long SMA=286, Sharpe=-0.4110, Trades=15
[INFO] Cluster 20 cluster: Short SMA=44, Long SMA=250, Sharpe=0.5251, Trades=13
[INFO] Cluster 21 cluster: Short SMA=256, Long SMA=284, Sharpe=-0.1933, Trades=21
[INFO] Cluster 22 cluster: Short SMA=24, Long SMA=126, Sharpe=0.3643, Trades=31
[INFO] Cluster 23 cluster: Short SMA=28, Long SMA=198, Sharpe=0.3799, Trades=17
[INFO] Cluster 24 cluster: Short SMA=84, Long SMA=230, Sharpe=0.1593, Trades=13
[INFO] Cluster 25 cluster: Short SMA=224, Long SMA=280, Sharpe=-0.3848, Trades=19
[INFO] Cluster 26 cluster: Short SMA=160, Long SMA=168, Sharpe=-0.2702, Trades=38
[INFO] Cluster 27 cluster: Short SMA=92, Long SMA=122, Sharpe=0.5068, Trades=27
[INFO] Cluster 28 cluster: Short SMA=84, Long SMA=180, Sharpe=0.1744, Trades=15
[INFO] Cluster 30 cluster: Short SMA=168, Long SMA=170, Sharpe=-0.0417, Trades=70
[INFO] Cluster 31 cluster: Short SMA=132, Long SMA=158, Sharpe=-0.0078, Trades=22
[INFO] Cluster 32 cluster: Short SMA=98, Long SMA=114, Sharpe=0.3266, Trades=33
[INFO] Cluster 34 cluster: Short SMA=54, Long SMA=56, Sharpe=0.3441, Trades=131
[INFO] Cluster 35 cluster: Short SMA=38, Long SMA=48, Sharpe=0.7196, Trades=72
[INFO] Cluster 36 cluster: Short SMA=166, Long SMA=226, Sharpe=-0.1665, Trades=13
[INFO] Cluster 37 cluster: Short SMA=242, Long SMA=250, Sharpe=-0.2476, Trades=34
[INFO] Cluster 38 cluster: Short SMA=216, Long SMA=224, Sharpe=-0.0933, Trades=40
[INFO] Cluster 39 cluster: Short SMA=208, Long SMA=252, Sharpe=-0.1440, Trades=18
[INFO] Cluster 40 cluster: Short SMA=154, Long SMA=184, Sharpe=-0.4435, Trades=20
[INFO] Cluster 41 cluster: Short SMA=52, Long SMA=182, Sharpe=0.3503, Trades=15
[INFO] Cluster 42 cluster: Short SMA=180, Long SMA=202, Sharpe=-0.0620, Trades=24
[INFO] Cluster 43 cluster: Short SMA=110, Long SMA=280, Sharpe=-0.3242, Trades=11
[INFO] Cluster 44 cluster: Short SMA=22, Long SMA=256, Sharpe=0.6281, Trades=13
[INFO] Cluster 45 cluster: Short SMA=164, Long SMA=280, Sharpe=-0.3715, Trades=11
[INFO] Cluster 46 cluster: Short SMA=90, Long SMA=274, Sharpe=-0.1615, Trades=11
[INFO] Cluster 47 cluster: Short SMA=56, Long SMA=216, Sharpe=0.2599, Trades=13
[INFO] Cluster 48 cluster: Short SMA=114, Long SMA=140, Sharpe=0.1431, Trades=26
[INFO] Cluster 49 cluster: Short SMA=212, Long SMA=236, Sharpe=0.0143, Trades=24
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=46, Sharpe=0.8582, Trades=78
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=48, Sharpe=0.7196, Trades=72
[INFO] Top 2: Short SMA=32, Long SMA=62, Sharpe=0.6664, Trades=48
[INFO] Top 3: Short SMA=22, Long SMA=256, Sharpe=0.6281, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10174 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/48) - Original Sharpe: 0.7196, Trades: 72
[INFO] Hierarchical cluster 2: SMA(32/62) - Original Sharpe: 0.6664, Trades: 48
[INFO] Hierarchical cluster 3: SMA(22/256) - Original Sharpe: 0.6281, Trades: 13
[INFO] Hierarchical cluster 4: SMA(44/250) - Original Sharpe: 0.5251, Trades: 13
[INFO] Hierarchical cluster 5: SMA(72/156) - Original Sharpe: 0.5084, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2816
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/48) - Sharpe: 0.7196
[INFO] cluster 2: (32/62) - Sharpe: 0.6664
[INFO] cluster 3: (22/256) - Sharpe: 0.6281
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Out-of-sample period starts on: 2021-09-24
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-24 2021-09-24            43     3.830825            3.830825
1    2021-11-24 2021-11-24            42    -0.750030           -1.040813
2    2022-01-24 2022-01-24            43    -1.158438            0.134840
3    2022-03-24 2022-03-24            42     2.899845            2.899845
4    2022-05-24 2022-05-24            44    -0.772793            2.004411
5    2022-07-24 2022-07-24            45     4.284626            4.094274
6    2022-09-24 2022-09-24            43    -1.964998           -2.208997
7    2022-11-24 2022-11-24            41     2.719154            2.715267
8    2023-01-24 2023-01-24            43    -4.933460           -3.833336
9    2023-03-24 2023-03-24            43    -4.230774           -2.893967
10   2023-05-24 2023-05-24            43    -5.713874           -6.016551
11   2023-07-24 2023-07-24            45    -1.713757           -1.613246
12   2023-09-24 2023-09-24            44    -0.948650           -1.107919
13   2023-11-24 2023-11-24            41    -0.015249           -3.333935
14   2024-01-24 2024-01-24            43    -1.669992            0.161003
15   2024-03-24 2024-03-24            43    -3.457983           -0.342823
16   2024-05-24 2024-05-24            43    -0.337335            0.121698
17   2024-07-24 2024-07-24            44     0.689877            0.174487
18   2024-09-24 2024-09-24            44     0.685285            0.169151
19   2024-11-24 2024-11-24            26     1.390507            1.390507
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-24   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2021-11-24   |         -0.8 |             -1.0 |         -0.2 | False         
[INFO] 2022-01-24   |         -1.2 |              0.1 |          1.3 | True          
[INFO] 2022-03-24   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-05-24   |         -0.8 |              2.0 |          2.8 | True          
[INFO] 2022-07-24   |          4.3 |              4.1 |         -0.2 | False         
[INFO] 2022-09-24   |         -2.0 |             -2.2 |         -0.2 | False         
[INFO] 2022-11-24   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2023-01-24   |         -4.9 |             -3.8 |          1.1 | True          
[INFO] 2023-03-24   |         -4.2 |             -2.9 |          1.3 | True          
[INFO] 2023-05-24   |         -5.7 |             -6.0 |         -0.3 | False         
[INFO] 2023-07-24   |         -1.7 |             -1.6 |          0.1 | True          
[INFO] 2023-09-24   |         -0.9 |             -1.1 |         -0.2 | False         
[INFO] 2023-11-24   |         -0.0 |             -3.3 |         -3.3 | False         
[INFO] 2024-01-24   |         -1.7 |              0.2 |          1.9 | True          
[INFO] 2024-03-24   |         -3.5 |             -0.3 |          3.2 | True          
[INFO] 2024-05-24   |         -0.3 |              0.1 |          0.4 | True          
[INFO] 2024-07-24   |          0.7 |              0.2 |         -0.5 | False         
[INFO] 2024-09-24   |          0.7 |              0.2 |         -0.5 | False         
[INFO] 2024-11-24   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-24, 2022-03-24, 2022-11-24, 2024-11-24
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 16 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for DX...
[INFO] Excel file updated successfully. Added DX with Hierarchical win rate 50.0% in row 12
[INFO] Added best Sharpe parameters 38/46 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 46
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/48) - Original Sharpe: 0.7196
[INFO] Added cluster 2 to portfolio: SMA(32/62) - Original Sharpe: 0.6664
[INFO] Added cluster 3 to portfolio: SMA(22/256) - Original Sharpe: 0.6281
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'DX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0029
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4997
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for DX...
[INFO] Excel file updated successfully. Added DX with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\DX
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for EC in column D: 9.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.69s
[INFO] Best parameters: Short SMA = 102, Long SMA = 106
[INFO] Best Sharpe ratio: 1.205170, Trades: 61
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 160 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @EC
[INFO] Big Point Value (from data): 125000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 6.80 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $719,557.00
[INFO] Market Buy & Hold P&L: $-67,087.50
[INFO] Outperformance: $786,644.50
[INFO] Sharpe ratio (entire period, annualized): 0.852974
[INFO] Sharpe ratio (in-sample, annualized): 1.205170
[INFO] Sharpe ratio (out-of-sample, annualized): 0.038724
[INFO] Maximum Drawdown: $200,630.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 45
[INFO] Out-of-sample period trades: 16
[INFO] Total trades: 61
[INFO] In-sample P&L: $643,237.25
[INFO] Out-of-sample P&L: $8,927.75
[INFO] 
Best parameters from GA: Short SMA = 102, Long SMA = 106, Sharpe = 1.205170
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5845 to 1.2052
[INFO] 
Best parameters:
[INFO] Short SMA: 102
[INFO] Long SMA: 106
[INFO] Sharpe Ratio: 1.205170
[INFO] Number of Trades: 61
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10425 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5845 to 1.2052
[INFO] Trades range: 10.0 to 346.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3845 to 2.7910
[INFO] Scaled Long SMA range: -2.7782 to 1.4049
[INFO] Scaled Sharpe ratio range: -2.3779 to 3.4455
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 321 elements
[INFO] Kmeans Cluster 1: 269 elements
[INFO] Kmeans Cluster 2: 241 elements
[INFO] Kmeans Cluster 3: 358 elements
[INFO] Kmeans Cluster 4: 168 elements
[INFO] Kmeans Cluster 5: 246 elements
[INFO] Kmeans Cluster 6: 90 elements
[INFO] Kmeans Cluster 7: 276 elements
[INFO] Kmeans Cluster 8: 276 elements
[INFO] Kmeans Cluster 9: 226 elements
[INFO] Kmeans Cluster 10: 172 elements
[INFO] Kmeans Cluster 11: 153 elements
[INFO] Kmeans Cluster 12: 279 elements
[INFO] Kmeans Cluster 13: 287 elements
[INFO] Kmeans Cluster 14: 263 elements
[INFO] Kmeans Cluster 15: 238 elements
[INFO] Kmeans Cluster 16: 215 elements
[INFO] Kmeans Cluster 17: 165 elements
[INFO] Kmeans Cluster 18: 296 elements
[INFO] Kmeans Cluster 19: 233 elements
[INFO] Kmeans Cluster 20: 199 elements
[INFO] Kmeans Cluster 21: 161 elements
[INFO] Kmeans Cluster 22: 256 elements
[INFO] Kmeans Cluster 23: 206 elements
[INFO] Kmeans Cluster 24: 206 elements
[INFO] Kmeans Cluster 25: 127 elements
[INFO] Kmeans Cluster 26: 179 elements
[INFO] Kmeans Cluster 27: 135 elements
[INFO] Kmeans Cluster 28: 139 elements
[INFO] Kmeans Cluster 29: 299 elements
[INFO] Kmeans Cluster 30: 226 elements
[INFO] Kmeans Cluster 31: 244 elements
[INFO] Kmeans Cluster 32: 223 elements
[INFO] Kmeans Cluster 33: 197 elements
[INFO] Kmeans Cluster 34: 119 elements
[INFO] Kmeans Cluster 35: 231 elements
[INFO] Kmeans Cluster 36: 129 elements
[INFO] Kmeans Cluster 37: 255 elements
[INFO] Kmeans Cluster 38: 178 elements
[INFO] Kmeans Cluster 39: 179 elements
[INFO] Kmeans Cluster 40: 204 elements
[INFO] Kmeans Cluster 41: 222 elements
[INFO] Kmeans Cluster 42: 250 elements
[INFO] Kmeans Cluster 43: 98 elements
[INFO] Kmeans Cluster 44: 262 elements
[INFO] Kmeans Cluster 45: 212 elements
[INFO] Kmeans Cluster 46: 39 elements
[INFO] Kmeans Cluster 47: 156 elements
[INFO] Kmeans Cluster 48: 61 elements
[INFO] Kmeans Cluster 49: 261 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=106.90, Long SMA=177.85, Sharpe=0.2481
[INFO] Centroid 1: Short SMA=234.68, Long SMA=283.75, Sharpe=-0.1500
[INFO] Centroid 2: Short SMA=36.69, Long SMA=118.69, Sharpe=0.4026
[INFO] Centroid 3: Short SMA=28.62, Long SMA=282.83, Sharpe=0.4513
[INFO] Centroid 4: Short SMA=113.62, Long SMA=287.67, Sharpe=-0.1494
[INFO] Centroid 5: Short SMA=171.84, Long SMA=236.68, Sharpe=-0.1924
[INFO] Centroid 6: Short SMA=12.62, Long SMA=88.11, Sharpe=0.0319
[INFO] Centroid 7: Short SMA=45.16, Long SMA=177.33, Sharpe=0.3697
[INFO] Centroid 8: Short SMA=91.93, Long SMA=252.44, Sharpe=0.1071
[INFO] Centroid 9: Short SMA=91.67, Long SMA=122.13, Sharpe=0.6433
[INFO] Centroid 10: Short SMA=31.40, Long SMA=61.71, Sharpe=0.4172
[INFO] Centroid 11: Short SMA=147.32, Long SMA=245.62, Sharpe=-0.3441
[INFO] Centroid 12: Short SMA=27.79, Long SMA=214.96, Sharpe=0.3420
[INFO] Centroid 13: Short SMA=145.57, Long SMA=180.86, Sharpe=-0.0662
[INFO] Centroid 14: Short SMA=114.57, Long SMA=140.04, Sharpe=0.3745
[INFO] Centroid 15: Short SMA=24.87, Long SMA=245.03, Sharpe=0.4872
[INFO] Centroid 16: Short SMA=75.64, Long SMA=284.79, Sharpe=0.1823
[INFO] Centroid 17: Short SMA=217.01, Long SMA=234.93, Sharpe=-0.1713
[INFO] Centroid 18: Short SMA=183.20, Long SMA=282.72, Sharpe=-0.3959
[INFO] Centroid 19: Short SMA=68.37, Long SMA=225.16, Sharpe=0.3609
[INFO] Centroid 20: Short SMA=64.85, Long SMA=86.70, Sharpe=0.2924
[INFO] Centroid 21: Short SMA=63.53, Long SMA=279.95, Sharpe=0.2894
[INFO] Centroid 22: Short SMA=197.25, Long SMA=233.21, Sharpe=-0.3611
[INFO] Centroid 23: Short SMA=28.18, Long SMA=94.28, Sharpe=0.2502
[INFO] Centroid 24: Short SMA=65.50, Long SMA=113.69, Sharpe=0.4538
[INFO] Centroid 25: Short SMA=62.39, Long SMA=82.39, Sharpe=0.1075
[INFO] Centroid 26: Short SMA=20.75, Long SMA=186.46, Sharpe=0.4696
[INFO] Centroid 27: Short SMA=34.34, Long SMA=56.55, Sharpe=0.6161
[INFO] Centroid 28: Short SMA=260.33, Long SMA=283.65, Sharpe=-0.0443
[INFO] Centroid 29: Short SMA=120.01, Long SMA=217.62, Sharpe=0.0537
[INFO] Centroid 30: Short SMA=178.92, Long SMA=202.53, Sharpe=-0.0899
[INFO] Centroid 31: Short SMA=206.77, Long SMA=275.37, Sharpe=-0.2995
[INFO] Centroid 32: Short SMA=134.87, Long SMA=281.01, Sharpe=-0.3092
[INFO] Centroid 33: Short SMA=149.04, Long SMA=215.92, Sharpe=-0.1740
[INFO] Centroid 34: Short SMA=19.28, Long SMA=41.97, Sharpe=0.2464
[INFO] Centroid 35: Short SMA=69.11, Long SMA=144.94, Sharpe=0.5595
[INFO] Centroid 36: Short SMA=167.60, Long SMA=183.26, Sharpe=0.1333
[INFO] Centroid 37: Short SMA=68.38, Long SMA=201.10, Sharpe=0.3020
[INFO] Centroid 38: Short SMA=131.49, Long SMA=161.56, Sharpe=0.1250
[INFO] Centroid 39: Short SMA=104.77, Long SMA=270.04, Sharpe=0.0071
[INFO] Centroid 40: Short SMA=160.11, Long SMA=279.75, Sharpe=-0.2308
[INFO] Centroid 41: Short SMA=232.50, Long SMA=255.75, Sharpe=-0.3418
[INFO] Centroid 42: Short SMA=49.26, Long SMA=252.74, Sharpe=0.3878
[INFO] Centroid 43: Short SMA=13.16, Long SMA=154.02, Sharpe=0.3564
[INFO] Centroid 44: Short SMA=30.34, Long SMA=144.32, Sharpe=0.4993
[INFO] Centroid 45: Short SMA=95.61, Long SMA=221.88, Sharpe=0.1662
[INFO] Centroid 46: Short SMA=14.05, Long SMA=22.77, Sharpe=-0.1523
[INFO] Centroid 47: Short SMA=273.49, Long SMA=289.14, Sharpe=-0.1928
[INFO] Centroid 48: Short SMA=97.02, Long SMA=114.85, Sharpe=0.8609
[INFO] Centroid 49: Short SMA=77.17, Long SMA=169.98, Sharpe=0.4315
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=102, Long SMA=106, Sharpe=1.2052, Trades=61
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=98, Long SMA=114, Sharpe=0.9483, Trades=33
[INFO] Kmeans Top 2: Short SMA=92, Long SMA=124, Sharpe=0.7075, Trades=25
[INFO] Kmeans Top 3: Short SMA=34, Long SMA=56, Sharpe=0.6238, Trades=53
[INFO] Kmeans Top 4: Short SMA=68, Long SMA=144, Sharpe=0.5616, Trades=15
[INFO] Kmeans Top 5: Short SMA=24, Long SMA=246, Sharpe=0.5572, Trades=17
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (107, 178)
[INFO]   Nearest: (106.0, 178.0)
[INFO]   Rounded: (235, 284)
[INFO]   Nearest: (234.0, 284.0)
[INFO]   Rounded: (37, 119)
[INFO]   Nearest: (36.0, 118.0)
[INFO]   Rounded: (29, 283)
[INFO]   Nearest: (28.0, 282.0)
[INFO]   Rounded: (114, 288)
[INFO]   Rounded: (172, 237)
[INFO]   Nearest: (172.0, 236.0)
[INFO]   Rounded: (13, 88)
[INFO]   Nearest: (12.0, 88.0)
[INFO]   Rounded: (45, 177)
[INFO]   Nearest: (46.0, 178.0)
[INFO]   Rounded: (92, 252)
[INFO]   Rounded: (92, 122)
[INFO]   Rounded: (31, 62)
[INFO]   Nearest: (32.0, 62.0)
[INFO]   Rounded: (147, 246)
[INFO]   Nearest: (148.0, 246.0)
[INFO]   Rounded: (28, 215)
[INFO]   Nearest: (28.0, 214.0)
[INFO]   Rounded: (146, 181)
[INFO]   Nearest: (146.0, 180.0)
[INFO]   Rounded: (115, 140)
[INFO]   Nearest: (114.0, 140.0)
[INFO]   Rounded: (25, 245)
[INFO]   Nearest: (24.0, 246.0)
[INFO]   Rounded: (76, 285)
[INFO]   Nearest: (76.0, 284.0)
[INFO]   Rounded: (217, 235)
[INFO]   Nearest: (218.0, 234.0)
[INFO]   Rounded: (183, 283)
[INFO]   Nearest: (184.0, 282.0)
[INFO]   Rounded: (68, 225)
[INFO]   Nearest: (68.0, 226.0)
[INFO]   Rounded: (65, 87)
[INFO]   Nearest: (64.0, 86.0)
[INFO]   Rounded: (64, 280)
[INFO]   Rounded: (197, 233)
[INFO]   Nearest: (198.0, 234.0)
[INFO]   Rounded: (28, 94)
[INFO]   Rounded: (66, 114)
[INFO]   Rounded: (62, 82)
[INFO]   Rounded: (21, 186)
[INFO]   Nearest: (20.0, 186.0)
[INFO]   Rounded: (34, 57)
[INFO]   Nearest: (34.0, 56.0)
[INFO]   Rounded: (260, 284)
[INFO]   Rounded: (120, 218)
[INFO]   Rounded: (179, 203)
[INFO]   Nearest: (178.0, 202.0)
[INFO]   Rounded: (207, 275)
[INFO]   Nearest: (206.0, 276.0)
[INFO]   Rounded: (135, 281)
[INFO]   Nearest: (134.0, 282.0)
[INFO]   Rounded: (149, 216)
[INFO]   Nearest: (150.0, 216.0)
[INFO]   Rounded: (19, 42)
[INFO]   Nearest: (20.0, 42.0)
[INFO]   Rounded: (69, 145)
[INFO]   Nearest: (70.0, 144.0)
[INFO]   Rounded: (168, 183)
[INFO]   Nearest: (168.0, 184.0)
[INFO]   Rounded: (68, 201)
[INFO]   Nearest: (68.0, 202.0)
[INFO]   Rounded: (131, 162)
[INFO]   Nearest: (132.0, 162.0)
[INFO]   Rounded: (105, 270)
[INFO]   Nearest: (104.0, 270.0)
[INFO]   Rounded: (160, 280)
[INFO]   Rounded: (232, 256)
[INFO]   Rounded: (49, 253)
[INFO]   Nearest: (50.0, 252.0)
[INFO]   Rounded: (13, 154)
[INFO]   Nearest: (14.0, 154.0)
[INFO]   Rounded: (30, 144)
[INFO]   Rounded: (96, 222)
[INFO]   Rounded: (14, 23)
[INFO]   Nearest: (14.0, 22.0)
[INFO]   Rounded: (273, 289)
[INFO]   Nearest: (274.0, 290.0)
[INFO]   Rounded: (97, 115)
[INFO]   Nearest: (98.0, 114.0)
[INFO]   Rounded: (77, 170)
[INFO]   Nearest: (78.0, 170.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 102, Long SMA: 106
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(98/114) - Original Sharpe: 0.9483, Trades: 33
[INFO] Kmeans cluster 2: SMA(92/124) - Original Sharpe: 0.7075, Trades: 25
[INFO] Kmeans cluster 3: SMA(34/56) - Original Sharpe: 0.6238, Trades: 53
[INFO] Kmeans cluster 4: SMA(68/144) - Original Sharpe: 0.5616, Trades: 15
[INFO] Kmeans cluster 5: SMA(24/246) - Original Sharpe: 0.5572, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (102/106)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (98/114) - Sharpe: 0.9483
[INFO] cluster 2: (92/124) - Sharpe: 0.7075
[INFO] cluster 3: (34/56) - Sharpe: 0.6238
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     3.487734            3.487734
1    2021-11-14 2021-11-14            43     0.321475            0.321475
2    2022-01-14 2022-01-14            41     3.270794            3.377129
3    2022-03-14 2022-03-14            44     3.649515            3.649515
4    2022-05-14 2022-05-14            43     1.818210            1.818210
5    2022-07-14 2022-07-14            44     0.788062            0.788062
6    2022-09-14 2022-09-14            43    -1.170570           -1.170570
7    2022-11-14 2022-11-14            43    -2.242409           -2.171576
8    2023-01-14 2023-01-14            41    -0.989824           -1.812533
9    2023-03-14 2023-03-14            44     0.488570           -0.887998
10   2023-05-14 2023-05-14            44    -0.377326           -1.402134
11   2023-07-14 2023-07-14            44    -3.130408           -3.050112
12   2023-09-14 2023-09-14            43     2.281930            0.834631
13   2023-11-14 2023-11-14            42    -1.565980           -2.389151
14   2024-01-14 2024-01-14            43     1.745773            4.536046
15   2024-03-14 2024-03-14            42    -3.416207           -4.479252
16   2024-05-14 2024-05-14            44    -0.027797           -2.280527
17   2024-07-14 2024-07-14            45    -0.762846           -1.210301
18   2024-09-14 2024-09-14            43    -3.897937           -4.326979
19   2024-11-14 2024-11-14            33     0.919641            2.542116
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-01-14   |          3.3 |              3.4 |          0.1 | True          
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -1.0 |             -1.8 |         -0.8 | False         
[INFO] 2023-03-14   |          0.5 |             -0.9 |         -1.4 | False         
[INFO] 2023-05-14   |         -0.4 |             -1.4 |         -1.0 | False         
[INFO] 2023-07-14   |         -3.1 |             -3.1 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.3 |              0.8 |         -1.5 | False         
[INFO] 2023-11-14   |         -1.6 |             -2.4 |         -0.8 | False         
[INFO] 2024-01-14   |          1.7 |              4.5 |          2.8 | True          
[INFO] 2024-03-14   |         -3.4 |             -4.5 |         -1.1 | False         
[INFO] 2024-05-14   |         -0.0 |             -2.3 |         -2.3 | False         
[INFO] 2024-07-14   |         -0.8 |             -1.2 |         -0.4 | False         
[INFO] 2024-09-14   |         -3.9 |             -4.3 |         -0.4 | False         
[INFO] 2024-11-14   |          0.9 |              2.5 |          1.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 3 of 12 periods (25.00% win rate)
[INFO] Updating Excel file with Kmeans results for EC...
[INFO] Excel file updated successfully. Added EC with Kmeans win rate 25.0% in row 13
[INFO] Added best Sharpe parameters 102/106 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 102, Long SMA: 106
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(98/114) - Original Sharpe: 0.9483
[INFO] Added cluster 2 to portfolio: SMA(92/124) - Original Sharpe: 0.7075
[INFO] Added cluster 3 to portfolio: SMA(34/56) - Original Sharpe: 0.6238
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'EC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1102
[INFO] Kmeans Best out-of-sample Sharpe: 0.0387
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for EC...
[INFO] Excel file updated successfully. Added EC with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EC
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5845 to 1.2052
[INFO] 
Best parameters:
[INFO] Short SMA: 102
[INFO] Long SMA: 106
[INFO] Sharpe Ratio: 1.205170
[INFO] Number of Trades: 61
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10425 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5845 to 1.2052
[INFO] Trades range: 10.0 to 346.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3845 to 2.7910
[INFO] Scaled Long SMA range: -2.7782 to 1.4049
[INFO] Scaled Sharpe ratio range: -2.3779 to 3.4455
[INFO] Scaled Trades range: -0.6847 to 16.6990
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10425 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6116
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 455 elements
[INFO] Cluster 1: 140 elements
[INFO] Cluster 2: 502 elements
[INFO] Cluster 3: 88 elements
[INFO] Cluster 4: 144 elements
[INFO] Cluster 5: 406 elements
[INFO] Cluster 6: 488 elements
[INFO] Cluster 7: 305 elements
[INFO] Cluster 8: 182 elements
[INFO] Cluster 9: 55 elements
[INFO] Cluster 10: 137 elements
[INFO] Cluster 11: 361 elements
[INFO] Cluster 12: 417 elements
[INFO] Cluster 13: 153 elements
[INFO] Cluster 14: 381 elements
[INFO] Cluster 15: 188 elements
[INFO] Cluster 16: 90 elements
[INFO] Cluster 17: 7 elements
[INFO] Cluster 18: 54 elements
[INFO] Cluster 19: 312 elements
[INFO] Cluster 20: 305 elements
[INFO] Cluster 21: 25 elements
[INFO] Cluster 22: 19 elements
[INFO] Cluster 23: 315 elements
[INFO] Cluster 24: 249 elements
[INFO] Cluster 25: 91 elements
[INFO] Cluster 26: 265 elements
[INFO] Cluster 27: 295 elements
[INFO] Cluster 28: 164 elements
[INFO] Cluster 29: 339 elements
[INFO] Cluster 30: 371 elements
[INFO] Cluster 31: 29 elements
[INFO] Cluster 32: 361 elements
[INFO] Cluster 33: 169 elements
[INFO] Cluster 34: 236 elements
[INFO] Cluster 35: 354 elements
[INFO] Cluster 36: 51 elements
[INFO] Cluster 37: 164 elements
[INFO] Cluster 38: 123 elements
[INFO] Cluster 39: 35 elements
[INFO] Cluster 40: 292 elements
[INFO] Cluster 41: 9 elements
[INFO] Cluster 42: 271 elements
[INFO] Cluster 43: 226 elements
[INFO] Cluster 44: 29 elements
[INFO] Cluster 45: 260 elements
[INFO] Cluster 46: 104 elements
[INFO] Cluster 47: 132 elements
[INFO] Cluster 48: 220 elements
[INFO] Cluster 49: 57 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=60, Long SMA=174, Sharpe=0.4251, Trades=17
[INFO] Cluster 1 cluster: Short SMA=86, Long SMA=104, Sharpe=0.3999, Trades=37
[INFO] Cluster 2 cluster: Short SMA=192, Long SMA=282, Sharpe=-0.3433, Trades=16
[INFO] Cluster 3 cluster: Short SMA=260, Long SMA=264, Sharpe=0.0929, Trades=53
[INFO] Cluster 4 cluster: Short SMA=16, Long SMA=80, Sharpe=-0.0183, Trades=53
[INFO] Cluster 5 cluster: Short SMA=166, Long SMA=250, Sharpe=-0.2317, Trades=13
[INFO] Cluster 6 cluster: Short SMA=72, Long SMA=206, Sharpe=0.3047, Trades=15
[INFO] Cluster 7 cluster: Short SMA=212, Long SMA=250, Sharpe=-0.3292, Trades=20
[INFO] Cluster 8 cluster: Short SMA=178, Long SMA=198, Sharpe=-0.1282, Trades=26
[INFO] Cluster 9 cluster: Short SMA=30, Long SMA=36, Sharpe=0.2324, Trades=103
[INFO] Cluster 10 cluster: Short SMA=158, Long SMA=180, Sharpe=0.1560, Trades=23
[INFO] Cluster 11 cluster: Short SMA=40, Long SMA=90, Sharpe=0.2456, Trades=33
[INFO] Cluster 12 cluster: Short SMA=48, Long SMA=118, Sharpe=0.3718, Trades=21
[INFO] Cluster 13 cluster: Short SMA=34, Long SMA=66, Sharpe=0.5798, Trades=49
[INFO] Cluster 14 cluster: Short SMA=112, Long SMA=218, Sharpe=0.0221, Trades=15
[INFO] Cluster 15 cluster: Short SMA=216, Long SMA=232, Sharpe=-0.1533, Trades=28
[INFO] Cluster 16 cluster: Short SMA=26, Long SMA=40, Sharpe=0.2601, Trades=75
[INFO] Cluster 18 cluster: Short SMA=126, Long SMA=130, Sharpe=0.4411, Trades=71
[INFO] Cluster 19 cluster: Short SMA=32, Long SMA=286, Sharpe=0.4430, Trades=16
[INFO] Cluster 20 cluster: Short SMA=236, Long SMA=284, Sharpe=-0.1571, Trades=16
[INFO] Cluster 21 cluster: Short SMA=52, Long SMA=56, Sharpe=0.5362, Trades=99
[INFO] Cluster 23 cluster: Short SMA=26, Long SMA=212, Sharpe=0.3151, Trades=21
[INFO] Cluster 24 cluster: Short SMA=100, Long SMA=266, Sharpe=0.1053, Trades=11
[INFO] Cluster 25 cluster: Short SMA=114, Long SMA=140, Sharpe=0.3261, Trades=23
[INFO] Cluster 26 cluster: Short SMA=74, Long SMA=140, Sharpe=0.5864, Trades=15
[INFO] Cluster 27 cluster: Short SMA=118, Long SMA=176, Sharpe=0.2083, Trades=15
[INFO] Cluster 28 cluster: Short SMA=90, Long SMA=120, Sharpe=0.7415, Trades=27
[INFO] Cluster 29 cluster: Short SMA=52, Long SMA=250, Sharpe=0.4063, Trades=15
[INFO] Cluster 30 cluster: Short SMA=164, Long SMA=222, Sharpe=-0.2159, Trades=13
[INFO] Cluster 31 cluster: Short SMA=48, Long SMA=50, Sharpe=0.6007, Trades=138
[INFO] Cluster 32 cluster: Short SMA=142, Long SMA=282, Sharpe=-0.4139, Trades=12
[INFO] Cluster 33 cluster: Short SMA=20, Long SMA=184, Sharpe=0.4880, Trades=23
[INFO] Cluster 34 cluster: Short SMA=140, Long SMA=198, Sharpe=-0.0809, Trades=15
[INFO] Cluster 35 cluster: Short SMA=72, Long SMA=284, Sharpe=0.2911, Trades=12
[INFO] Cluster 36 cluster: Short SMA=158, Long SMA=162, Sharpe=-0.2452, Trades=55
[INFO] Cluster 37 cluster: Short SMA=112, Long SMA=290, Sharpe=-0.1572, Trades=12
[INFO] Cluster 38 cluster: Short SMA=20, Long SMA=60, Sharpe=0.3831, Trades=55
[INFO] Cluster 39 cluster: Short SMA=100, Long SMA=108, Sharpe=1.0603, Trades=43
[INFO] Cluster 40 cluster: Short SMA=24, Long SMA=250, Sharpe=0.5009, Trades=17
[INFO] Cluster 42 cluster: Short SMA=30, Long SMA=146, Sharpe=0.5186, Trades=21
[INFO] Cluster 43 cluster: Short SMA=268, Long SMA=286, Sharpe=-0.1507, Trades=22
[INFO] Cluster 44 cluster: Short SMA=36, Long SMA=48, Sharpe=0.7012, Trades=68
[INFO] Cluster 45 cluster: Short SMA=90, Long SMA=242, Sharpe=0.0643, Trades=11
[INFO] Cluster 46 cluster: Short SMA=12, Long SMA=152, Sharpe=0.3678, Trades=31
[INFO] Cluster 47 cluster: Short SMA=148, Long SMA=166, Sharpe=-0.1707, Trades=27
[INFO] Cluster 48 cluster: Short SMA=96, Long SMA=158, Sharpe=0.3788, Trades=15
[INFO] Cluster 49 cluster: Short SMA=242, Long SMA=252, Sharpe=-0.3431, Trades=34
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=102, Long SMA=106, Sharpe=1.2052, Trades=61
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=100, Long SMA=108, Sharpe=1.0603, Trades=43
[INFO] Top 2: Short SMA=90, Long SMA=120, Sharpe=0.7415, Trades=27
[INFO] Top 3: Short SMA=36, Long SMA=48, Sharpe=0.7012, Trades=68
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10390 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 102, Long SMA: 106
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(100/108) - Original Sharpe: 1.0603, Trades: 43
[INFO] Hierarchical cluster 2: SMA(90/120) - Original Sharpe: 0.7415, Trades: 27
[INFO] Hierarchical cluster 3: SMA(36/48) - Original Sharpe: 0.7012, Trades: 68
[INFO] Hierarchical cluster 4: SMA(48/50) - Original Sharpe: 0.6007, Trades: 138
[INFO] Hierarchical cluster 5: SMA(74/140) - Original Sharpe: 0.5864, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (102/106)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (100/108) - Sharpe: 1.0603
[INFO] cluster 2: (90/120) - Sharpe: 0.7415
[INFO] cluster 3: (36/48) - Sharpe: 0.7012
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     3.487734            3.487734
1    2021-11-14 2021-11-14            43     0.321475            0.321475
2    2022-01-14 2022-01-14            41     3.270794            2.368390
3    2022-03-14 2022-03-14            44     3.649515            3.649515
4    2022-05-14 2022-05-14            43     1.818210            0.469325
5    2022-07-14 2022-07-14            44     0.788062            0.788062
6    2022-09-14 2022-09-14            43    -1.170570           -1.170570
7    2022-11-14 2022-11-14            43    -2.242409           -1.787640
8    2023-01-14 2023-01-14            41    -0.989824           -2.006603
9    2023-03-14 2023-03-14            44     0.488570           -0.838319
10   2023-05-14 2023-05-14            44    -0.377326           -2.224363
11   2023-07-14 2023-07-14            44    -3.130408           -3.382348
12   2023-09-14 2023-09-14            43     2.281930            1.359621
13   2023-11-14 2023-11-14            42    -1.565980           -2.389151
14   2024-01-14 2024-01-14            43     1.745773            1.740406
15   2024-03-14 2024-03-14            42    -3.416207           -3.826669
16   2024-05-14 2024-05-14            44    -0.027797           -1.721581
17   2024-07-14 2024-07-14            45    -0.762846           -1.331605
18   2024-09-14 2024-09-14            43    -3.897937           -3.876528
19   2024-11-14 2024-11-14            33     0.919641            1.884721
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-01-14   |          3.3 |              2.4 |         -0.9 | False         
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.8 |              0.5 |         -1.3 | False         
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -2.2 |             -1.8 |          0.4 | True          
[INFO] 2023-01-14   |         -1.0 |             -2.0 |         -1.0 | False         
[INFO] 2023-03-14   |          0.5 |             -0.8 |         -1.3 | False         
[INFO] 2023-05-14   |         -0.4 |             -2.2 |         -1.8 | False         
[INFO] 2023-07-14   |         -3.1 |             -3.4 |         -0.3 | False         
[INFO] 2023-09-14   |          2.3 |              1.4 |         -0.9 | False         
[INFO] 2023-11-14   |         -1.6 |             -2.4 |         -0.8 | False         
[INFO] 2024-01-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -3.4 |             -3.8 |         -0.4 | False         
[INFO] 2024-05-14   |         -0.0 |             -1.7 |         -1.7 | False         
[INFO] 2024-07-14   |         -0.8 |             -1.3 |         -0.5 | False         
[INFO] 2024-09-14   |         -3.9 |             -3.9 |          0.0 | Excluded      
[INFO] 2024-11-14   |          0.9 |              1.9 |          1.0 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-03-14, 2022-07-14, 2022-09-14, 2024-01-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 13 periods (15.38% win rate)
[INFO] Updating Excel file with Hierarchical results for EC...
[INFO] Excel file updated successfully. Added EC with Hierarchical win rate 15.4% in row 13
[INFO] Added best Sharpe parameters 102/106 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 102, Long SMA: 106
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(100/108) - Original Sharpe: 1.0603
[INFO] Added cluster 2 to portfolio: SMA(90/120) - Original Sharpe: 0.7415
[INFO] Added cluster 3 to portfolio: SMA(36/48) - Original Sharpe: 0.7012
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'EC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2857
[INFO] Hierarchical Best out-of-sample Sharpe: 0.0387
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for EC...
[INFO] Excel file updated successfully. Added EC with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EC
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for EMD in column D: 55.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.54s
[INFO] Best parameters: Short SMA = 216, Long SMA = 222
[INFO] Best Sharpe ratio: 0.453823, Trades: 36
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 55 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @EMD
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 2.80 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $195,360.00
[INFO] Market Buy & Hold P&L: $161,780.00
[INFO] Outperformance: $33,580.00
[INFO] Sharpe ratio (entire period, annualized): 0.255399
[INFO] Sharpe ratio (in-sample, annualized): 0.453823
[INFO] Sharpe ratio (out-of-sample, annualized): -0.167302
[INFO] Maximum Drawdown: $265,775.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 20
[INFO] Out-of-sample period trades: 16
[INFO] Total trades: 36
[INFO] In-sample P&L: $302,580.00
[INFO] Out-of-sample P&L: $-52,280.00
[INFO] 
Best parameters from GA: Short SMA = 216, Long SMA = 222, Sharpe = 0.453823
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 55.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] 
Best parameters:
[INFO] Short SMA: 216
[INFO] Long SMA: 222
[INFO] Sharpe Ratio: 0.453823
[INFO] Number of Trades: 36
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10530 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] Trades range: 10.0 to 335.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3944 to 2.7966
[INFO] Scaled Long SMA range: -2.7981 to 1.4094
[INFO] Scaled Sharpe ratio range: -4.0417 to 3.3900
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 236 elements
[INFO] Kmeans Cluster 1: 347 elements
[INFO] Kmeans Cluster 2: 231 elements
[INFO] Kmeans Cluster 3: 270 elements
[INFO] Kmeans Cluster 4: 124 elements
[INFO] Kmeans Cluster 5: 224 elements
[INFO] Kmeans Cluster 6: 179 elements
[INFO] Kmeans Cluster 7: 138 elements
[INFO] Kmeans Cluster 8: 274 elements
[INFO] Kmeans Cluster 9: 22 elements
[INFO] Kmeans Cluster 10: 200 elements
[INFO] Kmeans Cluster 11: 291 elements
[INFO] Kmeans Cluster 12: 241 elements
[INFO] Kmeans Cluster 13: 198 elements
[INFO] Kmeans Cluster 14: 147 elements
[INFO] Kmeans Cluster 15: 213 elements
[INFO] Kmeans Cluster 16: 178 elements
[INFO] Kmeans Cluster 17: 117 elements
[INFO] Kmeans Cluster 18: 141 elements
[INFO] Kmeans Cluster 19: 222 elements
[INFO] Kmeans Cluster 20: 380 elements
[INFO] Kmeans Cluster 21: 299 elements
[INFO] Kmeans Cluster 22: 121 elements
[INFO] Kmeans Cluster 23: 195 elements
[INFO] Kmeans Cluster 24: 350 elements
[INFO] Kmeans Cluster 25: 309 elements
[INFO] Kmeans Cluster 26: 277 elements
[INFO] Kmeans Cluster 27: 219 elements
[INFO] Kmeans Cluster 28: 152 elements
[INFO] Kmeans Cluster 29: 37 elements
[INFO] Kmeans Cluster 30: 97 elements
[INFO] Kmeans Cluster 31: 367 elements
[INFO] Kmeans Cluster 32: 228 elements
[INFO] Kmeans Cluster 33: 234 elements
[INFO] Kmeans Cluster 34: 234 elements
[INFO] Kmeans Cluster 35: 289 elements
[INFO] Kmeans Cluster 36: 149 elements
[INFO] Kmeans Cluster 37: 340 elements
[INFO] Kmeans Cluster 38: 269 elements
[INFO] Kmeans Cluster 39: 269 elements
[INFO] Kmeans Cluster 40: 151 elements
[INFO] Kmeans Cluster 41: 116 elements
[INFO] Kmeans Cluster 42: 133 elements
[INFO] Kmeans Cluster 43: 232 elements
[INFO] Kmeans Cluster 44: 278 elements
[INFO] Kmeans Cluster 45: 127 elements
[INFO] Kmeans Cluster 46: 189 elements
[INFO] Kmeans Cluster 47: 117 elements
[INFO] Kmeans Cluster 48: 187 elements
[INFO] Kmeans Cluster 49: 192 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=114.15, Long SMA=148.85, Sharpe=-0.0616
[INFO] Centroid 1: Short SMA=151.23, Long SMA=201.45, Sharpe=-0.2251
[INFO] Centroid 2: Short SMA=63.93, Long SMA=198.27, Sharpe=-0.0995
[INFO] Centroid 3: Short SMA=53.04, Long SMA=94.16, Sharpe=-0.2308
[INFO] Centroid 4: Short SMA=275.55, Long SMA=293.45, Sharpe=-0.4704
[INFO] Centroid 5: Short SMA=31.88, Long SMA=64.82, Sharpe=-0.0274
[INFO] Centroid 6: Short SMA=41.83, Long SMA=278.84, Sharpe=-0.2041
[INFO] Centroid 7: Short SMA=18.68, Long SMA=176.32, Sharpe=0.0798
[INFO] Centroid 8: Short SMA=88.09, Long SMA=255.20, Sharpe=0.0230
[INFO] Centroid 9: Short SMA=216.45, Long SMA=222.00, Sharpe=0.2934
[INFO] Centroid 10: Short SMA=184.33, Long SMA=282.24, Sharpe=-0.2960
[INFO] Centroid 11: Short SMA=163.52, Long SMA=243.26, Sharpe=-0.1385
[INFO] Centroid 12: Short SMA=193.72, Long SMA=224.78, Sharpe=-0.0587
[INFO] Centroid 13: Short SMA=136.60, Long SMA=265.21, Sharpe=-0.2565
[INFO] Centroid 14: Short SMA=20.53, Long SMA=282.48, Sharpe=-0.0144
[INFO] Centroid 15: Short SMA=30.08, Long SMA=198.19, Sharpe=-0.1157
[INFO] Centroid 16: Short SMA=140.28, Long SMA=162.92, Sharpe=-0.1960
[INFO] Centroid 17: Short SMA=153.01, Long SMA=175.61, Sharpe=-0.3200
[INFO] Centroid 18: Short SMA=240.44, Long SMA=259.42, Sharpe=-0.4796
[INFO] Centroid 19: Short SMA=92.79, Long SMA=130.47, Sharpe=-0.1616
[INFO] Centroid 20: Short SMA=49.15, Long SMA=233.85, Sharpe=-0.0556
[INFO] Centroid 21: Short SMA=238.25, Long SMA=282.09, Sharpe=-0.5914
[INFO] Centroid 22: Short SMA=55.70, Long SMA=77.93, Sharpe=-0.4118
[INFO] Centroid 23: Short SMA=27.79, Long SMA=144.12, Sharpe=0.1610
[INFO] Centroid 24: Short SMA=88.86, Long SMA=217.30, Sharpe=0.0129
[INFO] Centroid 25: Short SMA=35.66, Long SMA=131.54, Sharpe=0.0422
[INFO] Centroid 26: Short SMA=84.34, Long SMA=285.25, Sharpe=-0.0320
[INFO] Centroid 27: Short SMA=75.96, Long SMA=115.37, Sharpe=-0.0735
[INFO] Centroid 28: Short SMA=81.54, Long SMA=121.45, Sharpe=-0.2733
[INFO] Centroid 29: Short SMA=20.70, Long SMA=37.57, Sharpe=0.2677
[INFO] Centroid 30: Short SMA=25.42, Long SMA=41.55, Sharpe=-0.1915
[INFO] Centroid 31: Short SMA=125.71, Long SMA=235.80, Sharpe=-0.1531
[INFO] Centroid 32: Short SMA=168.69, Long SMA=196.16, Sharpe=-0.1204
[INFO] Centroid 33: Short SMA=198.48, Long SMA=246.36, Sharpe=-0.2158
[INFO] Centroid 34: Short SMA=38.33, Long SMA=169.89, Sharpe=-0.0289
[INFO] Centroid 35: Short SMA=100.44, Long SMA=179.10, Sharpe=0.0091
[INFO] Centroid 36: Short SMA=216.08, Long SMA=260.12, Sharpe=-0.3826
[INFO] Centroid 37: Short SMA=48.99, Long SMA=272.91, Sharpe=-0.1092
[INFO] Centroid 38: Short SMA=160.39, Long SMA=281.18, Sharpe=-0.2003
[INFO] Centroid 39: Short SMA=68.21, Long SMA=167.70, Sharpe=-0.1819
[INFO] Centroid 40: Short SMA=28.42, Long SMA=235.15, Sharpe=-0.1611
[INFO] Centroid 41: Short SMA=208.52, Long SMA=223.38, Sharpe=0.0898
[INFO] Centroid 42: Short SMA=112.08, Long SMA=135.67, Sharpe=0.0443
[INFO] Centroid 43: Short SMA=30.99, Long SMA=97.82, Sharpe=-0.1012
[INFO] Centroid 44: Short SMA=116.35, Long SMA=280.18, Sharpe=-0.1341
[INFO] Centroid 45: Short SMA=12.77, Long SMA=241.73, Sharpe=0.1079
[INFO] Centroid 46: Short SMA=213.35, Long SMA=285.46, Sharpe=-0.4956
[INFO] Centroid 47: Short SMA=254.60, Long SMA=278.55, Sharpe=-0.7031
[INFO] Centroid 48: Short SMA=116.72, Long SMA=198.34, Sharpe=-0.0958
[INFO] Centroid 49: Short SMA=25.05, Long SMA=61.65, Sharpe=0.0864
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=216, Long SMA=222, Sharpe=0.4538, Trades=36
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=218, Long SMA=224, Sharpe=0.4112, Trades=36
[INFO] Kmeans Top 2: Short SMA=20, Long SMA=36, Sharpe=0.3108, Trades=95
[INFO] Kmeans Top 3: Short SMA=26, Long SMA=144, Sharpe=0.2328, Trades=26
[INFO] Kmeans Top 4: Short SMA=12, Long SMA=240, Sharpe=0.1499, Trades=26
[INFO] Kmeans Top 5: Short SMA=18, Long SMA=174, Sharpe=0.1074, Trades=24
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (114, 149)
[INFO]   Nearest: (114.0, 148.0)
[INFO]   Rounded: (151, 201)
[INFO]   Nearest: (152.0, 202.0)
[INFO]   Rounded: (64, 198)
[INFO]   Rounded: (53, 94)
[INFO]   Nearest: (54.0, 94.0)
[INFO]   Rounded: (276, 293)
[INFO]   Nearest: (276.0, 294.0)
[INFO]   Rounded: (32, 65)
[INFO]   Nearest: (32.0, 64.0)
[INFO]   Rounded: (42, 279)
[INFO]   Nearest: (42.0, 278.0)
[INFO]   Rounded: (19, 176)
[INFO]   Nearest: (18.0, 176.0)
[INFO]   Rounded: (88, 255)
[INFO]   Nearest: (88.0, 256.0)
[INFO]   Rounded: (216, 222)
[INFO]   Rounded: (184, 282)
[INFO]   Rounded: (164, 243)
[INFO]   Nearest: (164.0, 244.0)
[INFO]   Rounded: (194, 225)
[INFO]   Nearest: (194.0, 224.0)
[INFO]   Rounded: (137, 265)
[INFO]   Nearest: (136.0, 266.0)
[INFO]   Rounded: (21, 282)
[INFO]   Nearest: (20.0, 282.0)
[INFO]   Rounded: (30, 198)
[INFO]   Rounded: (140, 163)
[INFO]   Nearest: (140.0, 162.0)
[INFO]   Rounded: (153, 176)
[INFO]   Nearest: (154.0, 176.0)
[INFO]   Rounded: (240, 259)
[INFO]   Nearest: (240.0, 260.0)
[INFO]   Rounded: (93, 130)
[INFO]   Nearest: (92.0, 130.0)
[INFO]   Rounded: (49, 234)
[INFO]   Nearest: (50.0, 234.0)
[INFO]   Rounded: (238, 282)
[INFO]   Rounded: (56, 78)
[INFO]   Rounded: (28, 144)
[INFO]   Rounded: (89, 217)
[INFO]   Nearest: (88.0, 218.0)
[INFO]   Rounded: (36, 132)
[INFO]   Rounded: (84, 285)
[INFO]   Nearest: (84.0, 286.0)
[INFO]   Rounded: (76, 115)
[INFO]   Nearest: (76.0, 116.0)
[INFO]   Rounded: (82, 121)
[INFO]   Nearest: (82.0, 122.0)
[INFO]   Rounded: (21, 38)
[INFO]   Nearest: (20.0, 38.0)
[INFO]   Rounded: (25, 42)
[INFO]   Nearest: (26.0, 42.0)
[INFO]   Rounded: (126, 236)
[INFO]   Rounded: (169, 196)
[INFO]   Nearest: (168.0, 196.0)
[INFO]   Rounded: (198, 246)
[INFO]   Rounded: (38, 170)
[INFO]   Rounded: (100, 179)
[INFO]   Nearest: (100.0, 180.0)
[INFO]   Rounded: (216, 260)
[INFO]   Rounded: (49, 273)
[INFO]   Nearest: (48.0, 272.0)
[INFO]   Rounded: (160, 281)
[INFO]   Nearest: (160.0, 282.0)
[INFO]   Rounded: (68, 168)
[INFO]   Rounded: (28, 235)
[INFO]   Nearest: (28.0, 236.0)
[INFO]   Rounded: (209, 223)
[INFO]   Nearest: (208.0, 224.0)
[INFO]   Rounded: (112, 136)
[INFO]   Rounded: (31, 98)
[INFO]   Nearest: (30.0, 98.0)
[INFO]   Rounded: (116, 280)
[INFO]   Rounded: (13, 242)
[INFO]   Nearest: (12.0, 242.0)
[INFO]   Rounded: (213, 285)
[INFO]   Nearest: (214.0, 286.0)
[INFO]   Rounded: (255, 279)
[INFO]   Nearest: (254.0, 278.0)
[INFO]   Rounded: (117, 198)
[INFO]   Nearest: (116.0, 198.0)
[INFO]   Rounded: (25, 62)
[INFO]   Nearest: (26.0, 62.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 216, Long SMA: 222
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] File size: 287237 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(218/224) - Original Sharpe: 0.4112, Trades: 36
[INFO] Kmeans cluster 2: SMA(20/36) - Original Sharpe: 0.3108, Trades: 95
[INFO] Kmeans cluster 3: SMA(26/144) - Original Sharpe: 0.2328, Trades: 26
[INFO] Kmeans cluster 4: SMA(12/240) - Original Sharpe: 0.1499, Trades: 26
[INFO] Kmeans cluster 5: SMA(18/174) - Original Sharpe: 0.1074, Trades: 24
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (216/222)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (218/224) - Sharpe: 0.4112
[INFO] cluster 2: (20/36) - Sharpe: 0.3108
[INFO] cluster 3: (26/144) - Sharpe: 0.2328
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] File size: 287237 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     2.819527            0.901345
1    2021-11-14 2021-11-14            43    -1.145321           -1.272692
2    2022-01-14 2022-01-14            41    -2.030834           -3.179703
3    2022-03-14 2022-03-14            44    -1.744332           -2.114610
4    2022-05-14 2022-05-14            43     3.502737            2.683312
5    2022-07-14 2022-07-14            44    -1.329484           -2.948020
6    2022-09-14 2022-09-14            43     0.741490            1.167019
7    2022-11-14 2022-11-14            43    -0.351982           -3.558450
8    2023-01-14 2023-01-14            41     2.520987            3.103008
9    2023-03-14 2023-03-14            44    -1.655688           -0.562821
10   2023-05-14 2023-05-14            44    -1.226126           -0.380546
11   2023-07-14 2023-07-14            44    -2.793162           -3.254242
12   2023-09-14 2023-09-14            43    -1.709353            0.459624
13   2023-11-14 2023-11-14            42    -3.498659           -4.029988
14   2024-01-14 2024-01-14            43     3.360693            5.026220
15   2024-03-14 2024-03-14            42     0.057655           -1.254783
16   2024-05-14 2024-05-14            44     3.250284           -0.924800
17   2024-07-14 2024-07-14            45    -0.486251           -0.663651
18   2024-09-14 2024-09-14            43     2.886146            2.886146
19   2024-11-14 2024-11-14            33    -2.653916           -2.297946
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          2.8 |              0.9 |         -1.9 | False         
[INFO] 2021-11-14   |         -1.1 |             -1.3 |         -0.2 | False         
[INFO] 2022-01-14   |         -2.0 |             -3.2 |         -1.2 | False         
[INFO] 2022-03-14   |         -1.7 |             -2.1 |         -0.4 | False         
[INFO] 2022-05-14   |          3.5 |              2.7 |         -0.8 | False         
[INFO] 2022-07-14   |         -1.3 |             -2.9 |         -1.6 | False         
[INFO] 2022-09-14   |          0.7 |              1.2 |          0.5 | True          
[INFO] 2022-11-14   |         -0.4 |             -3.6 |         -3.2 | False         
[INFO] 2023-01-14   |          2.5 |              3.1 |          0.6 | True          
[INFO] 2023-03-14   |         -1.7 |             -0.6 |          1.1 | True          
[INFO] 2023-05-14   |         -1.2 |             -0.4 |          0.8 | True          
[INFO] 2023-07-14   |         -2.8 |             -3.3 |         -0.5 | False         
[INFO] 2023-09-14   |         -1.7 |              0.5 |          2.2 | True          
[INFO] 2023-11-14   |         -3.5 |             -4.0 |         -0.5 | False         
[INFO] 2024-01-14   |          3.4 |              5.0 |          1.6 | True          
[INFO] 2024-03-14   |          0.1 |             -1.3 |         -1.4 | False         
[INFO] 2024-05-14   |          3.3 |             -0.9 |         -4.2 | False         
[INFO] 2024-07-14   |         -0.5 |             -0.7 |         -0.2 | False         
[INFO] 2024-09-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -2.7 |             -2.3 |          0.4 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 7 of 19 periods (36.84% win rate)
[INFO] Updating Excel file with Kmeans results for EMD...
[INFO] Excel file updated successfully. Added EMD with Kmeans win rate 36.8% in row 14
[INFO] Added best Sharpe parameters 216/222 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 216, Long SMA: 222
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(218/224) - Original Sharpe: 0.4112
[INFO] Added cluster 2 to portfolio: SMA(20/36) - Original Sharpe: 0.3108
[INFO] Added cluster 3 to portfolio: SMA(26/144) - Original Sharpe: 0.2328
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'EMD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3440
[INFO] Kmeans Best out-of-sample Sharpe: -0.1673
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for EMD...
[INFO] Excel file updated successfully. Added EMD with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EMD
[INFO] Big Point Value: 100.0
[INFO] Slippage: 55.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] 
Best parameters:
[INFO] Short SMA: 216
[INFO] Long SMA: 222
[INFO] Sharpe Ratio: 0.453823
[INFO] Number of Trades: 36
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10530 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] Trades range: 10.0 to 335.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3944 to 2.7966
[INFO] Scaled Long SMA range: -2.7981 to 1.4094
[INFO] Scaled Sharpe ratio range: -4.0417 to 3.3900
[INFO] Scaled Trades range: -0.6701 to 14.8618
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10530 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4875
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 289 elements
[INFO] Cluster 1: 128 elements
[INFO] Cluster 2: 60 elements
[INFO] Cluster 3: 103 elements
[INFO] Cluster 4: 286 elements
[INFO] Cluster 5: 624 elements
[INFO] Cluster 6: 284 elements
[INFO] Cluster 7: 138 elements
[INFO] Cluster 8: 338 elements
[INFO] Cluster 9: 377 elements
[INFO] Cluster 10: 548 elements
[INFO] Cluster 11: 328 elements
[INFO] Cluster 12: 266 elements
[INFO] Cluster 13: 342 elements
[INFO] Cluster 14: 97 elements
[INFO] Cluster 15: 23 elements
[INFO] Cluster 16: 53 elements
[INFO] Cluster 17: 367 elements
[INFO] Cluster 18: 254 elements
[INFO] Cluster 19: 207 elements
[INFO] Cluster 20: 26 elements
[INFO] Cluster 21: 233 elements
[INFO] Cluster 22: 105 elements
[INFO] Cluster 23: 7 elements
[INFO] Cluster 24: 207 elements
[INFO] Cluster 25: 480 elements
[INFO] Cluster 26: 38 elements
[INFO] Cluster 27: 253 elements
[INFO] Cluster 28: 227 elements
[INFO] Cluster 29: 196 elements
[INFO] Cluster 30: 240 elements
[INFO] Cluster 31: 340 elements
[INFO] Cluster 32: 235 elements
[INFO] Cluster 33: 196 elements
[INFO] Cluster 34: 153 elements
[INFO] Cluster 35: 134 elements
[INFO] Cluster 36: 38 elements
[INFO] Cluster 37: 222 elements
[INFO] Cluster 38: 172 elements
[INFO] Cluster 39: 112 elements
[INFO] Cluster 40: 422 elements
[INFO] Cluster 41: 327 elements
[INFO] Cluster 42: 221 elements
[INFO] Cluster 43: 225 elements
[INFO] Cluster 44: 192 elements
[INFO] Cluster 45: 100 elements
[INFO] Cluster 46: 96 elements
[INFO] Cluster 47: 85 elements
[INFO] Cluster 48: 26 elements
[INFO] Cluster 49: 110 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=116, Long SMA=146, Sharpe=-0.0507, Trades=28
[INFO] Cluster 1 cluster: Short SMA=14, Long SMA=58, Sharpe=0.0551, Trades=67
[INFO] Cluster 2 cluster: Short SMA=148, Long SMA=150, Sharpe=-0.1243, Trades=78
[INFO] Cluster 3 cluster: Short SMA=74, Long SMA=84, Sharpe=-0.4245, Trades=62
[INFO] Cluster 4 cluster: Short SMA=212, Long SMA=272, Sharpe=-0.5165, Trades=13
[INFO] Cluster 5 cluster: Short SMA=134, Long SMA=234, Sharpe=-0.1293, Trades=10
[INFO] Cluster 6 cluster: Short SMA=38, Long SMA=176, Sharpe=-0.0088, Trades=16
[INFO] Cluster 7 cluster: Short SMA=102, Long SMA=114, Sharpe=-0.2518, Trades=42
[INFO] Cluster 8 cluster: Short SMA=36, Long SMA=276, Sharpe=-0.1219, Trades=17
[INFO] Cluster 9 cluster: Short SMA=150, Long SMA=190, Sharpe=-0.2620, Trades=18
[INFO] Cluster 10 cluster: Short SMA=50, Long SMA=230, Sharpe=-0.0733, Trades=12
[INFO] Cluster 11 cluster: Short SMA=56, Long SMA=98, Sharpe=-0.1603, Trades=34
[INFO] Cluster 12 cluster: Short SMA=66, Long SMA=122, Sharpe=-0.0615, Trades=28
[INFO] Cluster 13 cluster: Short SMA=28, Long SMA=96, Sharpe=-0.1026, Trades=38
[INFO] Cluster 14 cluster: Short SMA=26, Long SMA=38, Sharpe=-0.0390, Trades=93
[INFO] Cluster 15 cluster: Short SMA=36, Long SMA=38, Sharpe=-0.0742, Trades=179
[INFO] Cluster 16 cluster: Short SMA=196, Long SMA=202, Sharpe=0.0690, Trades=53
[INFO] Cluster 17 cluster: Short SMA=158, Long SMA=272, Sharpe=-0.1801, Trades=11
[INFO] Cluster 18 cluster: Short SMA=190, Long SMA=252, Sharpe=-0.2075, Trades=10
[INFO] Cluster 19 cluster: Short SMA=28, Long SMA=64, Sharpe=-0.0352, Trades=50
[INFO] Cluster 20 cluster: Short SMA=16, Long SMA=22, Sharpe=-0.5247, Trades=143
[INFO] Cluster 21 cluster: Short SMA=256, Long SMA=290, Sharpe=-0.5859, Trades=17
[INFO] Cluster 22 cluster: Short SMA=214, Long SMA=230, Sharpe=0.1704, Trades=30
[INFO] Cluster 24 cluster: Short SMA=130, Long SMA=272, Sharpe=-0.2357, Trades=13
[INFO] Cluster 25 cluster: Short SMA=90, Long SMA=210, Sharpe=0.0071, Trades=12
[INFO] Cluster 26 cluster: Short SMA=22, Long SMA=32, Sharpe=0.1813, Trades=111
[INFO] Cluster 27 cluster: Short SMA=80, Long SMA=142, Sharpe=-0.3009, Trades=26
[INFO] Cluster 28 cluster: Short SMA=184, Long SMA=286, Sharpe=-0.2548, Trades=11
[INFO] Cluster 29 cluster: Short SMA=172, Long SMA=194, Sharpe=-0.1715, Trades=26
[INFO] Cluster 30 cluster: Short SMA=112, Long SMA=280, Sharpe=-0.1264, Trades=11
[INFO] Cluster 31 cluster: Short SMA=58, Long SMA=274, Sharpe=-0.1375, Trades=15
[INFO] Cluster 32 cluster: Short SMA=118, Long SMA=190, Sharpe=-0.1347, Trades=14
[INFO] Cluster 33 cluster: Short SMA=184, Long SMA=228, Sharpe=-0.0527, Trades=14
[INFO] Cluster 34 cluster: Short SMA=12, Long SMA=244, Sharpe=0.1334, Trades=26
[INFO] Cluster 35 cluster: Short SMA=248, Long SMA=258, Sharpe=-0.3545, Trades=32
[INFO] Cluster 36 cluster: Short SMA=270, Long SMA=272, Sharpe=-0.7611, Trades=65
[INFO] Cluster 37 cluster: Short SMA=108, Long SMA=164, Sharpe=0.0086, Trades=16
[INFO] Cluster 38 cluster: Short SMA=20, Long SMA=154, Sharpe=0.1176, Trades=28
[INFO] Cluster 39 cluster: Short SMA=260, Long SMA=276, Sharpe=-0.7198, Trades=23
[INFO] Cluster 40 cluster: Short SMA=86, Long SMA=264, Sharpe=-0.0324, Trades=12
[INFO] Cluster 41 cluster: Short SMA=68, Long SMA=182, Sharpe=-0.1983, Trades=14
[INFO] Cluster 42 cluster: Short SMA=28, Long SMA=202, Sharpe=-0.0977, Trades=18
[INFO] Cluster 43 cluster: Short SMA=42, Long SMA=146, Sharpe=0.0910, Trades=20
[INFO] Cluster 44 cluster: Short SMA=226, Long SMA=278, Sharpe=-0.6763, Trades=15
[INFO] Cluster 45 cluster: Short SMA=212, Long SMA=230, Sharpe=-0.0355, Trades=26
[INFO] Cluster 46 cluster: Short SMA=16, Long SMA=138, Sharpe=0.0400, Trades=38
[INFO] Cluster 47 cluster: Short SMA=16, Long SMA=284, Sharpe=-0.0382, Trades=21
[INFO] Cluster 48 cluster: Short SMA=88, Long SMA=90, Sharpe=-0.2417, Trades=110
[INFO] Cluster 49 cluster: Short SMA=152, Long SMA=160, Sharpe=-0.2035, Trades=44
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=216, Long SMA=222, Sharpe=0.4538, Trades=36
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=22, Long SMA=32, Sharpe=0.1813, Trades=111
[INFO] Top 2: Short SMA=214, Long SMA=230, Sharpe=0.1704, Trades=30
[INFO] Top 3: Short SMA=12, Long SMA=244, Sharpe=0.1334, Trades=26
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10523 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 216, Long SMA: 222
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] File size: 287237 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(22/32) - Original Sharpe: 0.1813, Trades: 111
[INFO] Hierarchical cluster 2: SMA(214/230) - Original Sharpe: 0.1704, Trades: 30
[INFO] Hierarchical cluster 3: SMA(12/244) - Original Sharpe: 0.1334, Trades: 26
[INFO] Hierarchical cluster 4: SMA(20/154) - Original Sharpe: 0.1176, Trades: 28
[INFO] Hierarchical cluster 5: SMA(42/146) - Original Sharpe: 0.0910, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (216/222)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 216, Long SMA: 222
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EMD
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for ES in column D: 13.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.38s
[INFO] Best parameters: Short SMA = 162, Long SMA = 274
[INFO] Best Sharpe ratio: 0.900987, Trades: 9
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 2966 bad combos; keeping 1073 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @ES
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.31 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $510,692.50
[INFO] Market Buy & Hold P&L: $187,962.50
[INFO] Outperformance: $322,730.00
[INFO] Sharpe ratio (entire period, annualized): 0.672117
[INFO] Sharpe ratio (in-sample, annualized): 0.900987
[INFO] Sharpe ratio (out-of-sample, annualized): 0.183475
[INFO] Maximum Drawdown: $136,852.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 7
[INFO] Out-of-sample period trades: 2
[INFO] Total trades: 9
[INFO] In-sample P&L: $574,895.00
[INFO] Out-of-sample P&L: $54,647.50
[INFO] 
Best parameters from GA: Short SMA = 162, Long SMA = 274, Sharpe = 0.900987
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3535 to 0.9010
[INFO] 
Best parameters:
[INFO] Short SMA: 162
[INFO] Long SMA: 274
[INFO] Sharpe Ratio: 0.900987
[INFO] Number of Trades: 9
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7619 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3535 to 0.8709
[INFO] Trades range: 10.0 to 333.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1625 to 2.6459
[INFO] Scaled Long SMA range: -2.4904 to 1.6638
[INFO] Scaled Sharpe ratio range: -4.7529 to 3.5059
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 148 elements
[INFO] Kmeans Cluster 1: 221 elements
[INFO] Kmeans Cluster 2: 217 elements
[INFO] Kmeans Cluster 3: 135 elements
[INFO] Kmeans Cluster 4: 146 elements
[INFO] Kmeans Cluster 5: 96 elements
[INFO] Kmeans Cluster 6: 99 elements
[INFO] Kmeans Cluster 7: 77 elements
[INFO] Kmeans Cluster 8: 135 elements
[INFO] Kmeans Cluster 9: 242 elements
[INFO] Kmeans Cluster 10: 205 elements
[INFO] Kmeans Cluster 11: 197 elements
[INFO] Kmeans Cluster 12: 214 elements
[INFO] Kmeans Cluster 13: 79 elements
[INFO] Kmeans Cluster 14: 102 elements
[INFO] Kmeans Cluster 15: 208 elements
[INFO] Kmeans Cluster 16: 170 elements
[INFO] Kmeans Cluster 17: 196 elements
[INFO] Kmeans Cluster 18: 42 elements
[INFO] Kmeans Cluster 19: 138 elements
[INFO] Kmeans Cluster 20: 267 elements
[INFO] Kmeans Cluster 21: 247 elements
[INFO] Kmeans Cluster 22: 116 elements
[INFO] Kmeans Cluster 23: 90 elements
[INFO] Kmeans Cluster 24: 64 elements
[INFO] Kmeans Cluster 25: 58 elements
[INFO] Kmeans Cluster 26: 47 elements
[INFO] Kmeans Cluster 27: 149 elements
[INFO] Kmeans Cluster 28: 172 elements
[INFO] Kmeans Cluster 29: 132 elements
[INFO] Kmeans Cluster 30: 153 elements
[INFO] Kmeans Cluster 31: 77 elements
[INFO] Kmeans Cluster 32: 172 elements
[INFO] Kmeans Cluster 33: 173 elements
[INFO] Kmeans Cluster 34: 38 elements
[INFO] Kmeans Cluster 35: 196 elements
[INFO] Kmeans Cluster 36: 215 elements
[INFO] Kmeans Cluster 37: 217 elements
[INFO] Kmeans Cluster 38: 260 elements
[INFO] Kmeans Cluster 39: 194 elements
[INFO] Kmeans Cluster 40: 179 elements
[INFO] Kmeans Cluster 41: 189 elements
[INFO] Kmeans Cluster 42: 131 elements
[INFO] Kmeans Cluster 43: 60 elements
[INFO] Kmeans Cluster 44: 193 elements
[INFO] Kmeans Cluster 45: 98 elements
[INFO] Kmeans Cluster 46: 224 elements
[INFO] Kmeans Cluster 47: 131 elements
[INFO] Kmeans Cluster 48: 152 elements
[INFO] Kmeans Cluster 49: 158 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=154.31, Long SMA=182.69, Sharpe=0.2926
[INFO] Centroid 1: Short SMA=35.53, Long SMA=66.24, Sharpe=0.3300
[INFO] Centroid 2: Short SMA=52.60, Long SMA=239.87, Sharpe=0.2859
[INFO] Centroid 3: Short SMA=214.76, Long SMA=236.30, Sharpe=0.5402
[INFO] Centroid 4: Short SMA=28.62, Long SMA=131.08, Sharpe=0.2534
[INFO] Centroid 5: Short SMA=71.54, Long SMA=94.52, Sharpe=0.0325
[INFO] Centroid 6: Short SMA=15.45, Long SMA=244.57, Sharpe=0.4989
[INFO] Centroid 7: Short SMA=236.26, Long SMA=266.94, Sharpe=0.2624
[INFO] Centroid 8: Short SMA=191.30, Long SMA=220.21, Sharpe=0.7450
[INFO] Centroid 9: Short SMA=109.98, Long SMA=146.61, Sharpe=0.2010
[INFO] Centroid 10: Short SMA=39.09, Long SMA=167.38, Sharpe=0.3225
[INFO] Centroid 11: Short SMA=28.19, Long SMA=238.81, Sharpe=0.4036
[INFO] Centroid 12: Short SMA=133.75, Long SMA=204.96, Sharpe=0.4183
[INFO] Centroid 13: Short SMA=21.47, Long SMA=103.67, Sharpe=0.4815
[INFO] Centroid 14: Short SMA=229.51, Long SMA=290.57, Sharpe=0.5757
[INFO] Centroid 15: Short SMA=177.70, Long SMA=207.42, Sharpe=0.5895
[INFO] Centroid 16: Short SMA=225.20, Long SMA=261.38, Sharpe=0.3671
[INFO] Centroid 17: Short SMA=44.01, Long SMA=88.07, Sharpe=0.2594
[INFO] Centroid 18: Short SMA=14.48, Long SMA=27.90, Sharpe=-0.1100
[INFO] Centroid 19: Short SMA=20.35, Long SMA=152.61, Sharpe=0.4007
[INFO] Centroid 20: Short SMA=120.40, Long SMA=164.55, Sharpe=0.2860
[INFO] Centroid 21: Short SMA=144.34, Long SMA=176.71, Sharpe=0.3703
[INFO] Centroid 22: Short SMA=17.22, Long SMA=199.24, Sharpe=0.4926
[INFO] Centroid 23: Short SMA=92.22, Long SMA=161.51, Sharpe=0.1287
[INFO] Centroid 24: Short SMA=114.62, Long SMA=126.75, Sharpe=0.3806
[INFO] Centroid 25: Short SMA=28.83, Long SMA=58.45, Sharpe=0.5702
[INFO] Centroid 26: Short SMA=28.55, Long SMA=43.02, Sharpe=0.0720
[INFO] Centroid 27: Short SMA=62.99, Long SMA=278.32, Sharpe=0.2495
[INFO] Centroid 28: Short SMA=24.56, Long SMA=193.40, Sharpe=0.3966
[INFO] Centroid 29: Short SMA=74.24, Long SMA=134.64, Sharpe=0.3099
[INFO] Centroid 30: Short SMA=60.63, Long SMA=201.92, Sharpe=0.2162
[INFO] Centroid 31: Short SMA=15.64, Long SMA=284.99, Sharpe=0.5368
[INFO] Centroid 32: Short SMA=34.60, Long SMA=119.01, Sharpe=0.3459
[INFO] Centroid 33: Short SMA=166.83, Long SMA=210.34, Sharpe=0.4999
[INFO] Centroid 34: Short SMA=65.11, Long SMA=87.84, Sharpe=-0.1018
[INFO] Centroid 35: Short SMA=33.44, Long SMA=285.70, Sharpe=0.4156
[INFO] Centroid 36: Short SMA=45.63, Long SMA=205.74, Sharpe=0.3083
[INFO] Centroid 37: Short SMA=66.53, Long SMA=165.94, Sharpe=0.2498
[INFO] Centroid 38: Short SMA=42.63, Long SMA=271.08, Sharpe=0.3357
[INFO] Centroid 39: Short SMA=197.76, Long SMA=234.56, Sharpe=0.6528
[INFO] Centroid 40: Short SMA=100.19, Long SMA=128.06, Sharpe=0.2650
[INFO] Centroid 41: Short SMA=254.60, Long SMA=281.80, Sharpe=0.3914
[INFO] Centroid 42: Short SMA=26.99, Long SMA=64.69, Sharpe=0.4288
[INFO] Centroid 43: Short SMA=25.67, Long SMA=107.77, Sharpe=0.1127
[INFO] Centroid 44: Short SMA=71.85, Long SMA=119.08, Sharpe=0.2186
[INFO] Centroid 45: Short SMA=25.45, Long SMA=48.47, Sharpe=0.2116
[INFO] Centroid 46: Short SMA=227.35, Long SMA=263.33, Sharpe=0.4470
[INFO] Centroid 47: Short SMA=69.51, Long SMA=94.31, Sharpe=0.1450
[INFO] Centroid 48: Short SMA=271.96, Long SMA=290.37, Sharpe=0.5136
[INFO] Centroid 49: Short SMA=52.91, Long SMA=140.76, Sharpe=0.1699
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=162, Long SMA=274, Sharpe=0.9010, Trades=9
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=192, Long SMA=222, Sharpe=0.7385, Trades=16
[INFO] Kmeans Top 2: Short SMA=16, Long SMA=286, Sharpe=0.6399, Trades=15
[INFO] Kmeans Top 3: Short SMA=198, Long SMA=236, Sharpe=0.6318, Trades=12
[INFO] Kmeans Top 4: Short SMA=228, Long SMA=292, Sharpe=0.6199, Trades=13
[INFO] Kmeans Top 5: Short SMA=180, Long SMA=208, Sharpe=0.6069, Trades=18
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (154, 183)
[INFO]   Nearest: (154.0, 182.0)
[INFO]   Rounded: (36, 66)
[INFO]   Rounded: (53, 240)
[INFO]   Nearest: (52.0, 240.0)
[INFO]   Rounded: (215, 236)
[INFO]   Nearest: (214.0, 236.0)
[INFO]   Rounded: (29, 131)
[INFO]   Nearest: (28.0, 132.0)
[INFO]   Rounded: (72, 95)
[INFO]   Nearest: (72.0, 94.0)
[INFO]   Rounded: (15, 245)
[INFO]   Nearest: (16.0, 244.0)
[INFO]   Rounded: (236, 267)
[INFO]   Nearest: (236.0, 266.0)
[INFO]   Rounded: (191, 220)
[INFO]   Nearest: (192.0, 220.0)
[INFO]   Rounded: (110, 147)
[INFO]   Nearest: (110.0, 146.0)
[INFO]   Rounded: (39, 167)
[INFO]   Nearest: (40.0, 168.0)
[INFO]   Rounded: (28, 239)
[INFO]   Nearest: (28.0, 238.0)
[INFO]   Rounded: (134, 205)
[INFO]   Nearest: (134.0, 204.0)
[INFO]   Rounded: (21, 104)
[INFO]   Nearest: (22.0, 104.0)
[INFO]   Rounded: (230, 291)
[INFO]   Nearest: (230.0, 290.0)
[INFO]   Rounded: (178, 207)
[INFO]   Nearest: (178.0, 208.0)
[INFO]   Rounded: (225, 261)
[INFO]   Nearest: (226.0, 262.0)
[INFO]   Rounded: (44, 88)
[INFO]   Rounded: (14, 28)
[INFO]   Rounded: (20, 153)
[INFO]   Nearest: (20.0, 152.0)
[INFO]   Rounded: (120, 165)
[INFO]   Nearest: (120.0, 164.0)
[INFO]   Rounded: (144, 177)
[INFO]   Nearest: (144.0, 176.0)
[INFO]   Rounded: (17, 199)
[INFO]   Nearest: (18.0, 200.0)
[INFO]   Rounded: (92, 162)
[INFO]   Rounded: (115, 127)
[INFO]   Nearest: (114.0, 126.0)
[INFO]   Rounded: (29, 58)
[INFO]   Nearest: (28.0, 58.0)
[INFO]   Rounded: (29, 43)
[INFO]   Nearest: (28.0, 44.0)
[INFO]   Rounded: (63, 278)
[INFO]   Nearest: (62.0, 278.0)
[INFO]   Rounded: (25, 193)
[INFO]   Nearest: (24.0, 194.0)
[INFO]   Rounded: (74, 135)
[INFO]   Nearest: (74.0, 134.0)
[INFO]   Rounded: (61, 202)
[INFO]   Nearest: (60.0, 202.0)
[INFO]   Rounded: (16, 285)
[INFO]   Nearest: (16.0, 284.0)
[INFO]   Rounded: (35, 119)
[INFO]   Nearest: (34.0, 120.0)
[INFO]   Rounded: (167, 210)
[INFO]   Nearest: (166.0, 210.0)
[INFO]   Rounded: (65, 88)
[INFO]   Nearest: (66.0, 88.0)
[INFO]   Rounded: (33, 286)
[INFO]   Nearest: (34.0, 286.0)
[INFO]   Rounded: (46, 206)
[INFO]   Rounded: (67, 166)
[INFO]   Nearest: (66.0, 166.0)
[INFO]   Rounded: (43, 271)
[INFO]   Nearest: (42.0, 272.0)
[INFO]   Rounded: (198, 235)
[INFO]   Nearest: (198.0, 234.0)
[INFO]   Rounded: (100, 128)
[INFO]   Rounded: (255, 282)
[INFO]   Nearest: (254.0, 282.0)
[INFO]   Rounded: (27, 65)
[INFO]   Nearest: (26.0, 64.0)
[INFO]   Rounded: (26, 108)
[INFO]   Rounded: (72, 119)
[INFO]   Nearest: (72.0, 120.0)
[INFO]   Rounded: (25, 48)
[INFO]   Nearest: (26.0, 48.0)
[INFO]   Rounded: (227, 263)
[INFO]   Nearest: (228.0, 264.0)
[INFO]   Rounded: (70, 94)
[INFO]   Rounded: (272, 290)
[INFO]   Rounded: (53, 141)
[INFO]   Nearest: (52.0, 140.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 162, Long SMA: 274
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(192/222) - Original Sharpe: 0.7385, Trades: 16
[INFO] Kmeans cluster 2: SMA(16/286) - Original Sharpe: 0.6399, Trades: 15
[INFO] Kmeans cluster 3: SMA(198/236) - Original Sharpe: 0.6318, Trades: 12
[INFO] Kmeans cluster 4: SMA(228/292) - Original Sharpe: 0.6199, Trades: 13
[INFO] Kmeans cluster 5: SMA(180/208) - Original Sharpe: 0.6069, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (162/274)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (192/222) - Sharpe: 0.7385
[INFO] cluster 2: (16/286) - Sharpe: 0.6399
[INFO] cluster 3: (198/236) - Sharpe: 0.6318
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.911391            0.911391
1    2021-11-14 2021-11-14            43    -0.628261           -0.628261
2    2022-01-14 2022-01-14            41    -2.812439           -2.516898
3    2022-03-14 2022-03-14            44    -0.960414           -1.826409
4    2022-05-14 2022-05-14            43     0.052587            1.343023
5    2022-07-14 2022-07-14            44    -0.911692           -0.911692
6    2022-09-14 2022-09-14            43    -0.232210           -0.232210
7    2022-11-14 2022-11-14            43     0.093646            0.093646
8    2023-01-14 2023-01-14            41     1.619125            1.174021
9    2023-03-14 2023-03-14            44    -1.939764           -2.396146
10   2023-05-14 2023-05-14            44     2.318419            2.536024
11   2023-07-14 2023-07-14            44    -0.689668           -0.689668
12   2023-09-14 2023-09-14            43    -1.587437           -1.587437
13   2023-11-14 2023-11-14            42     3.878695            3.878695
14   2024-01-14 2024-01-14            43     3.930264            3.930264
15   2024-03-14 2024-03-14            42    -0.498348           -0.498348
16   2024-05-14 2024-05-14            44     4.604239            4.604239
17   2024-07-14 2024-07-14            45    -0.424050           -0.424050
18   2024-09-14 2024-09-14            43     2.451837            2.451837
19   2024-11-14 2024-11-14            33    -1.823399           -1.823399
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.8 |             -2.5 |          0.3 | True          
[INFO] 2022-03-14   |         -1.0 |             -1.8 |         -0.8 | False         
[INFO] 2022-05-14   |          0.1 |              1.3 |          1.2 | True          
[INFO] 2022-07-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.6 |              1.2 |         -0.4 | False         
[INFO] 2023-03-14   |         -1.9 |             -2.4 |         -0.5 | False         
[INFO] 2023-05-14   |          2.3 |              2.5 |          0.2 | True          
[INFO] 2023-07-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 6
[INFO] Kmeans cluster wins (rounded comparison): 3 of 6 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for ES...
[INFO] Excel file updated successfully. Added ES with Kmeans win rate 50.0% in row 15
[INFO] Added best Sharpe parameters 162/274 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 162, Long SMA: 274
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(192/222) - Original Sharpe: 0.7385
[INFO] Added cluster 2 to portfolio: SMA(16/286) - Original Sharpe: 0.6399
[INFO] Added cluster 3 to portfolio: SMA(198/236) - Original Sharpe: 0.6318
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ES_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1582
[INFO] Kmeans Best out-of-sample Sharpe: 0.1835
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for ES...
[INFO] Excel file updated successfully. Added ES with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ES
[INFO] Big Point Value: 50.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3535 to 0.9010
[INFO] 
Best parameters:
[INFO] Short SMA: 162
[INFO] Long SMA: 274
[INFO] Sharpe Ratio: 0.900987
[INFO] Number of Trades: 9
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7619 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3535 to 0.8709
[INFO] Trades range: 10.0 to 333.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1625 to 2.6459
[INFO] Scaled Long SMA range: -2.4904 to 1.6638
[INFO] Scaled Sharpe ratio range: -4.7529 to 3.5059
[INFO] Scaled Trades range: -0.6029 to 16.9141
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 7619 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6710
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 85 elements
[INFO] Cluster 1: 214 elements
[INFO] Cluster 2: 107 elements
[INFO] Cluster 3: 411 elements
[INFO] Cluster 4: 361 elements
[INFO] Cluster 5: 285 elements
[INFO] Cluster 6: 104 elements
[INFO] Cluster 7: 138 elements
[INFO] Cluster 8: 198 elements
[INFO] Cluster 9: 291 elements
[INFO] Cluster 10: 262 elements
[INFO] Cluster 11: 229 elements
[INFO] Cluster 12: 253 elements
[INFO] Cluster 13: 292 elements
[INFO] Cluster 14: 97 elements
[INFO] Cluster 15: 203 elements
[INFO] Cluster 16: 79 elements
[INFO] Cluster 17: 41 elements
[INFO] Cluster 18: 35 elements
[INFO] Cluster 19: 311 elements
[INFO] Cluster 20: 9 elements
[INFO] Cluster 21: 77 elements
[INFO] Cluster 22: 203 elements
[INFO] Cluster 23: 68 elements
[INFO] Cluster 24: 253 elements
[INFO] Cluster 25: 34 elements
[INFO] Cluster 26: 218 elements
[INFO] Cluster 27: 321 elements
[INFO] Cluster 28: 270 elements
[INFO] Cluster 29: 183 elements
[INFO] Cluster 30: 200 elements
[INFO] Cluster 31: 133 elements
[INFO] Cluster 32: 2 elements
[INFO] Cluster 33: 26 elements
[INFO] Cluster 34: 88 elements
[INFO] Cluster 35: 42 elements
[INFO] Cluster 36: 166 elements
[INFO] Cluster 37: 172 elements
[INFO] Cluster 38: 217 elements
[INFO] Cluster 39: 10 elements
[INFO] Cluster 40: 64 elements
[INFO] Cluster 41: 95 elements
[INFO] Cluster 42: 110 elements
[INFO] Cluster 43: 68 elements
[INFO] Cluster 44: 114 elements
[INFO] Cluster 45: 96 elements
[INFO] Cluster 46: 185 elements
[INFO] Cluster 47: 55 elements
[INFO] Cluster 48: 123 elements
[INFO] Cluster 49: 21 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=78, Long SMA=88, Sharpe=0.0344, Trades=42
[INFO] Cluster 1 cluster: Short SMA=202, Long SMA=240, Sharpe=0.6069, Trades=14
[INFO] Cluster 2 cluster: Short SMA=210, Long SMA=214, Sharpe=0.4890, Trades=44
[INFO] Cluster 3 cluster: Short SMA=42, Long SMA=276, Sharpe=0.3357, Trades=11
[INFO] Cluster 4 cluster: Short SMA=104, Long SMA=152, Sharpe=0.2369, Trades=16
[INFO] Cluster 5 cluster: Short SMA=44, Long SMA=106, Sharpe=0.2968, Trades=20
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=40, Sharpe=0.1497, Trades=72
[INFO] Cluster 7 cluster: Short SMA=22, Long SMA=80, Sharpe=0.3603, Trades=42
[INFO] Cluster 8 cluster: Short SMA=86, Long SMA=134, Sharpe=0.2960, Trades=16
[INFO] Cluster 9 cluster: Short SMA=50, Long SMA=236, Sharpe=0.3781, Trades=10
[INFO] Cluster 10 cluster: Short SMA=32, Long SMA=132, Sharpe=0.3128, Trades=18
[INFO] Cluster 11 cluster: Short SMA=126, Long SMA=180, Sharpe=0.2591, Trades=12
[INFO] Cluster 12 cluster: Short SMA=66, Long SMA=186, Sharpe=0.2242, Trades=10
[INFO] Cluster 13 cluster: Short SMA=138, Long SMA=166, Sharpe=0.4052, Trades=16
[INFO] Cluster 14 cluster: Short SMA=250, Long SMA=258, Sharpe=0.3445, Trades=26
[INFO] Cluster 15 cluster: Short SMA=16, Long SMA=272, Sharpe=0.4970, Trades=17
[INFO] Cluster 16 cluster: Short SMA=120, Long SMA=130, Sharpe=0.5726, Trades=32
[INFO] Cluster 17 cluster: Short SMA=134, Long SMA=138, Sharpe=0.3516, Trades=46
[INFO] Cluster 18 cluster: Short SMA=32, Long SMA=36, Sharpe=0.2530, Trades=113
[INFO] Cluster 19 cluster: Short SMA=240, Long SMA=274, Sharpe=0.4151, Trades=13
[INFO] Cluster 21 cluster: Short SMA=12, Long SMA=132, Sharpe=0.3278, Trades=32
[INFO] Cluster 22 cluster: Short SMA=190, Long SMA=224, Sharpe=0.6978, Trades=14
[INFO] Cluster 23 cluster: Short SMA=216, Long SMA=262, Sharpe=0.2952, Trades=12
[INFO] Cluster 24 cluster: Short SMA=24, Long SMA=190, Sharpe=0.4247, Trades=14
[INFO] Cluster 25 cluster: Short SMA=40, Long SMA=46, Sharpe=0.5802, Trades=76
[INFO] Cluster 26 cluster: Short SMA=176, Long SMA=212, Sharpe=0.5942, Trades=14
[INFO] Cluster 27 cluster: Short SMA=48, Long SMA=164, Sharpe=0.2712, Trades=14
[INFO] Cluster 28 cluster: Short SMA=62, Long SMA=134, Sharpe=0.2282, Trades=14
[INFO] Cluster 29 cluster: Short SMA=66, Long SMA=98, Sharpe=0.1766, Trades=24
[INFO] Cluster 30 cluster: Short SMA=224, Long SMA=272, Sharpe=0.4509, Trades=13
[INFO] Cluster 31 cluster: Short SMA=66, Long SMA=280, Sharpe=0.2091, Trades=11
[INFO] Cluster 33 cluster: Short SMA=14, Long SMA=34, Sharpe=-0.0245, Trades=87
[INFO] Cluster 34 cluster: Short SMA=24, Long SMA=52, Sharpe=0.3069, Trades=56
[INFO] Cluster 35 cluster: Short SMA=282, Long SMA=286, Sharpe=0.5461, Trades=29
[INFO] Cluster 36 cluster: Short SMA=24, Long SMA=246, Sharpe=0.4037, Trades=16
[INFO] Cluster 37 cluster: Short SMA=152, Long SMA=212, Sharpe=0.4987, Trades=12
[INFO] Cluster 38 cluster: Short SMA=134, Long SMA=198, Sharpe=0.4453, Trades=10
[INFO] Cluster 40 cluster: Short SMA=70, Long SMA=98, Sharpe=0.0235, Trades=26
[INFO] Cluster 41 cluster: Short SMA=104, Long SMA=120, Sharpe=0.2737, Trades=24
[INFO] Cluster 42 cluster: Short SMA=14, Long SMA=208, Sharpe=0.4733, Trades=16
[INFO] Cluster 43 cluster: Short SMA=226, Long SMA=292, Sharpe=0.6233, Trades=13
[INFO] Cluster 44 cluster: Short SMA=38, Long SMA=66, Sharpe=0.3151, Trades=44
[INFO] Cluster 45 cluster: Short SMA=42, Long SMA=82, Sharpe=0.3643, Trades=28
[INFO] Cluster 46 cluster: Short SMA=44, Long SMA=200, Sharpe=0.2641, Trades=12
[INFO] Cluster 47 cluster: Short SMA=20, Long SMA=60, Sharpe=0.5871, Trades=46
[INFO] Cluster 48 cluster: Short SMA=270, Long SMA=292, Sharpe=0.5976, Trades=13
[INFO] Cluster 49 cluster: Short SMA=12, Long SMA=24, Sharpe=-0.0446, Trades=123
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=162, Long SMA=274, Sharpe=0.9010, Trades=9
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=190, Long SMA=224, Sharpe=0.6978, Trades=14
[INFO] Top 2: Short SMA=226, Long SMA=292, Sharpe=0.6233, Trades=13
[INFO] Top 3: Short SMA=202, Long SMA=240, Sharpe=0.6069, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 7598 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 162, Long SMA: 274
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(190/224) - Original Sharpe: 0.6978, Trades: 14
[INFO] Hierarchical cluster 2: SMA(226/292) - Original Sharpe: 0.6233, Trades: 13
[INFO] Hierarchical cluster 3: SMA(202/240) - Original Sharpe: 0.6069, Trades: 14
[INFO] Hierarchical cluster 4: SMA(270/292) - Original Sharpe: 0.5976, Trades: 13
[INFO] Hierarchical cluster 5: SMA(176/212) - Original Sharpe: 0.5942, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (162/274)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (190/224) - Sharpe: 0.6978
[INFO] cluster 2: (226/292) - Sharpe: 0.6233
[INFO] cluster 3: (202/240) - Sharpe: 0.6069
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.911391            0.911391
1    2021-11-14 2021-11-14            43    -0.628261           -0.628261
2    2022-01-14 2022-01-14            41    -2.812439           -2.812439
3    2022-03-14 2022-03-14            44    -0.960414           -0.960414
4    2022-05-14 2022-05-14            43     0.052587           -0.428037
5    2022-07-14 2022-07-14            44    -0.911692           -0.218178
6    2022-09-14 2022-09-14            43    -0.232210           -0.232210
7    2022-11-14 2022-11-14            43     0.093646            0.093646
8    2023-01-14 2023-01-14            41     1.619125            1.619125
9    2023-03-14 2023-03-14            44    -1.939764           -3.852542
10   2023-05-14 2023-05-14            44     2.318419           -3.577272
11   2023-07-14 2023-07-14            44    -0.689668           -1.140430
12   2023-09-14 2023-09-14            43    -1.587437           -1.587437
13   2023-11-14 2023-11-14            42     3.878695            3.878695
14   2024-01-14 2024-01-14            43     3.930264            3.930264
15   2024-03-14 2024-03-14            42    -0.498348           -0.498348
16   2024-05-14 2024-05-14            44     4.604239            4.604239
17   2024-07-14 2024-07-14            45    -0.424050           -0.424050
18   2024-09-14 2024-09-14            43     2.451837            2.451837
19   2024-11-14 2024-11-14            33    -1.823399           -1.823399
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.1 |             -0.4 |         -0.5 | False         
[INFO] 2022-07-14   |         -0.9 |             -0.2 |          0.7 | True          
[INFO] 2022-09-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -1.9 |             -3.9 |         -2.0 | False         
[INFO] 2023-05-14   |          2.3 |             -3.6 |         -5.9 | False         
[INFO] 2023-07-14   |         -0.7 |             -1.1 |         -0.4 | False         
[INFO] 2023-09-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 5
[INFO] Hierarchical cluster wins (rounded comparison): 1 of 5 periods (20.00% win rate)
[INFO] Updating Excel file with Hierarchical results for ES...
[INFO] Excel file updated successfully. Added ES with Hierarchical win rate 20.0% in row 15
[INFO] Added best Sharpe parameters 162/274 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 162, Long SMA: 274
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(190/224) - Original Sharpe: 0.6978
[INFO] Added cluster 2 to portfolio: SMA(226/292) - Original Sharpe: 0.6233
[INFO] Added cluster 3 to portfolio: SMA(202/240) - Original Sharpe: 0.6069
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ES_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0128
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1835
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for ES...
[INFO] Excel file updated successfully. Added ES with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ES
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FC in column D: 25.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.90s
[INFO] Best parameters: Short SMA = 212, Long SMA = 214
[INFO] Best Sharpe ratio: 0.759717, Trades: 91
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FC
[INFO] Big Point Value (from data): 500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.42 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $335,425.00
[INFO] Market Buy & Hold P&L: $4,212.50
[INFO] Outperformance: $331,212.50
[INFO] Sharpe ratio (entire period, annualized): 0.465159
[INFO] Sharpe ratio (in-sample, annualized): 0.759717
[INFO] Sharpe ratio (out-of-sample, annualized): -0.209532
[INFO] Maximum Drawdown: $225,162.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 56
[INFO] Out-of-sample period trades: 35
[INFO] Total trades: 91
[INFO] In-sample P&L: $438,112.50
[INFO] Out-of-sample P&L: $-52,725.00
[INFO] 
Best parameters from GA: Short SMA = 212, Long SMA = 214, Sharpe = 0.759717
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 500.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4652 to 0.7597
[INFO] 
Best parameters:
[INFO] Short SMA: 212
[INFO] Long SMA: 214
[INFO] Sharpe Ratio: 0.759717
[INFO] Number of Trades: 91
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4652 to 0.7597
[INFO] Trades range: 10.0 to 377.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6102 to 4.0054
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 303 elements
[INFO] Kmeans Cluster 1: 307 elements
[INFO] Kmeans Cluster 2: 217 elements
[INFO] Kmeans Cluster 3: 185 elements
[INFO] Kmeans Cluster 4: 323 elements
[INFO] Kmeans Cluster 5: 322 elements
[INFO] Kmeans Cluster 6: 79 elements
[INFO] Kmeans Cluster 7: 210 elements
[INFO] Kmeans Cluster 8: 194 elements
[INFO] Kmeans Cluster 9: 80 elements
[INFO] Kmeans Cluster 10: 260 elements
[INFO] Kmeans Cluster 11: 183 elements
[INFO] Kmeans Cluster 12: 208 elements
[INFO] Kmeans Cluster 13: 160 elements
[INFO] Kmeans Cluster 14: 206 elements
[INFO] Kmeans Cluster 15: 111 elements
[INFO] Kmeans Cluster 16: 280 elements
[INFO] Kmeans Cluster 17: 235 elements
[INFO] Kmeans Cluster 18: 223 elements
[INFO] Kmeans Cluster 19: 240 elements
[INFO] Kmeans Cluster 20: 105 elements
[INFO] Kmeans Cluster 21: 172 elements
[INFO] Kmeans Cluster 22: 251 elements
[INFO] Kmeans Cluster 23: 169 elements
[INFO] Kmeans Cluster 24: 228 elements
[INFO] Kmeans Cluster 25: 251 elements
[INFO] Kmeans Cluster 26: 196 elements
[INFO] Kmeans Cluster 27: 210 elements
[INFO] Kmeans Cluster 28: 81 elements
[INFO] Kmeans Cluster 29: 181 elements
[INFO] Kmeans Cluster 30: 138 elements
[INFO] Kmeans Cluster 31: 221 elements
[INFO] Kmeans Cluster 32: 234 elements
[INFO] Kmeans Cluster 33: 158 elements
[INFO] Kmeans Cluster 34: 230 elements
[INFO] Kmeans Cluster 35: 197 elements
[INFO] Kmeans Cluster 36: 286 elements
[INFO] Kmeans Cluster 37: 273 elements
[INFO] Kmeans Cluster 38: 296 elements
[INFO] Kmeans Cluster 39: 200 elements
[INFO] Kmeans Cluster 40: 301 elements
[INFO] Kmeans Cluster 41: 119 elements
[INFO] Kmeans Cluster 42: 127 elements
[INFO] Kmeans Cluster 43: 164 elements
[INFO] Kmeans Cluster 44: 271 elements
[INFO] Kmeans Cluster 45: 252 elements
[INFO] Kmeans Cluster 46: 285 elements
[INFO] Kmeans Cluster 47: 304 elements
[INFO] Kmeans Cluster 48: 153 elements
[INFO] Kmeans Cluster 49: 206 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=129.47, Long SMA=227.64, Sharpe=0.2458
[INFO] Centroid 1: Short SMA=86.50, Long SMA=137.88, Sharpe=0.0279
[INFO] Centroid 2: Short SMA=100.60, Long SMA=264.43, Sharpe=0.0376
[INFO] Centroid 3: Short SMA=44.80, Long SMA=72.85, Sharpe=0.2869
[INFO] Centroid 4: Short SMA=248.06, Long SMA=275.34, Sharpe=-0.0189
[INFO] Centroid 5: Short SMA=200.88, Long SMA=278.93, Sharpe=0.1851
[INFO] Centroid 6: Short SMA=19.87, Long SMA=43.24, Sharpe=-0.1827
[INFO] Centroid 7: Short SMA=29.39, Long SMA=272.88, Sharpe=-0.0671
[INFO] Centroid 8: Short SMA=87.65, Long SMA=278.16, Sharpe=-0.1488
[INFO] Centroid 9: Short SMA=204.12, Long SMA=219.47, Sharpe=0.4980
[INFO] Centroid 10: Short SMA=111.94, Long SMA=237.76, Sharpe=0.1574
[INFO] Centroid 11: Short SMA=82.30, Long SMA=109.21, Sharpe=0.3018
[INFO] Centroid 12: Short SMA=33.89, Long SMA=121.53, Sharpe=0.3204
[INFO] Centroid 13: Short SMA=141.34, Long SMA=167.71, Sharpe=0.2789
[INFO] Centroid 14: Short SMA=139.95, Long SMA=271.64, Sharpe=0.3306
[INFO] Centroid 15: Short SMA=22.54, Long SMA=50.97, Sharpe=-0.0215
[INFO] Centroid 16: Short SMA=30.96, Long SMA=159.96, Sharpe=0.0944
[INFO] Centroid 17: Short SMA=174.03, Long SMA=215.47, Sharpe=0.0896
[INFO] Centroid 18: Short SMA=139.74, Long SMA=175.49, Sharpe=0.1281
[INFO] Centroid 19: Short SMA=52.07, Long SMA=271.40, Sharpe=0.0584
[INFO] Centroid 20: Short SMA=50.90, Long SMA=83.52, Sharpe=0.5050
[INFO] Centroid 21: Short SMA=241.71, Long SMA=284.74, Sharpe=-0.1409
[INFO] Centroid 22: Short SMA=61.05, Long SMA=156.63, Sharpe=-0.0989
[INFO] Centroid 23: Short SMA=20.93, Long SMA=285.59, Sharpe=-0.2124
[INFO] Centroid 24: Short SMA=116.81, Long SMA=164.20, Sharpe=-0.0524
[INFO] Centroid 25: Short SMA=46.97, Long SMA=244.36, Sharpe=0.1871
[INFO] Centroid 26: Short SMA=209.78, Long SMA=235.21, Sharpe=0.2693
[INFO] Centroid 27: Short SMA=130.53, Long SMA=278.34, Sharpe=0.1710
[INFO] Centroid 28: Short SMA=21.75, Long SMA=41.75, Sharpe=-0.3188
[INFO] Centroid 29: Short SMA=144.75, Long SMA=207.49, Sharpe=0.3536
[INFO] Centroid 30: Short SMA=268.42, Long SMA=284.06, Sharpe=0.1100
[INFO] Centroid 31: Short SMA=84.14, Long SMA=179.81, Sharpe=0.1128
[INFO] Centroid 32: Short SMA=108.42, Long SMA=135.68, Sharpe=0.1434
[INFO] Centroid 33: Short SMA=167.41, Long SMA=202.76, Sharpe=-0.0425
[INFO] Centroid 34: Short SMA=71.44, Long SMA=202.05, Sharpe=0.2232
[INFO] Centroid 35: Short SMA=78.14, Long SMA=224.87, Sharpe=0.3235
[INFO] Centroid 36: Short SMA=47.59, Long SMA=95.73, Sharpe=0.3997
[INFO] Centroid 37: Short SMA=80.19, Long SMA=282.70, Sharpe=-0.0598
[INFO] Centroid 38: Short SMA=214.58, Long SMA=258.56, Sharpe=0.0979
[INFO] Centroid 39: Short SMA=19.69, Long SMA=191.16, Sharpe=-0.0565
[INFO] Centroid 40: Short SMA=168.46, Long SMA=286.66, Sharpe=0.0758
[INFO] Centroid 41: Short SMA=15.50, Long SMA=101.31, Sharpe=0.1893
[INFO] Centroid 42: Short SMA=27.24, Long SMA=62.99, Sharpe=0.1411
[INFO] Centroid 43: Short SMA=174.34, Long SMA=199.39, Sharpe=0.2293
[INFO] Centroid 44: Short SMA=48.97, Long SMA=206.07, Sharpe=-0.0123
[INFO] Centroid 45: Short SMA=104.52, Long SMA=190.87, Sharpe=0.0159
[INFO] Centroid 46: Short SMA=167.92, Long SMA=248.36, Sharpe=0.1939
[INFO] Centroid 47: Short SMA=29.61, Long SMA=227.56, Sharpe=0.0706
[INFO] Centroid 48: Short SMA=75.73, Long SMA=102.44, Sharpe=0.1868
[INFO] Centroid 49: Short SMA=29.30, Long SMA=144.99, Sharpe=0.2145
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=212, Long SMA=214, Sharpe=0.7597, Trades=91
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=50, Long SMA=84, Sharpe=0.5416, Trades=30
[INFO] Kmeans Top 2: Short SMA=204, Long SMA=220, Sharpe=0.5081, Trades=31
[INFO] Kmeans Top 3: Short SMA=46, Long SMA=96, Sharpe=0.3788, Trades=30
[INFO] Kmeans Top 4: Short SMA=144, Long SMA=168, Sharpe=0.3406, Trades=29
[INFO] Kmeans Top 5: Short SMA=140, Long SMA=272, Sharpe=0.2978, Trades=10
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (129, 228)
[INFO]   Nearest: (130.0, 228.0)
[INFO]   Rounded: (86, 138)
[INFO]   Rounded: (101, 264)
[INFO]   Nearest: (100.0, 264.0)
[INFO]   Rounded: (45, 73)
[INFO]   Nearest: (44.0, 72.0)
[INFO]   Rounded: (248, 275)
[INFO]   Nearest: (248.0, 276.0)
[INFO]   Rounded: (201, 279)
[INFO]   Nearest: (200.0, 278.0)
[INFO]   Rounded: (20, 43)
[INFO]   Nearest: (20.0, 44.0)
[INFO]   Rounded: (29, 273)
[INFO]   Nearest: (30.0, 272.0)
[INFO]   Rounded: (88, 278)
[INFO]   Rounded: (204, 219)
[INFO]   Nearest: (204.0, 220.0)
[INFO]   Rounded: (112, 238)
[INFO]   Rounded: (82, 109)
[INFO]   Nearest: (82.0, 110.0)
[INFO]   Rounded: (34, 122)
[INFO]   Rounded: (141, 168)
[INFO]   Nearest: (142.0, 168.0)
[INFO]   Rounded: (140, 272)
[INFO]   Rounded: (23, 51)
[INFO]   Nearest: (22.0, 50.0)
[INFO]   Rounded: (31, 160)
[INFO]   Nearest: (30.0, 160.0)
[INFO]   Rounded: (174, 215)
[INFO]   Nearest: (174.0, 216.0)
[INFO]   Rounded: (140, 175)
[INFO]   Nearest: (140.0, 176.0)
[INFO]   Rounded: (52, 271)
[INFO]   Nearest: (52.0, 272.0)
[INFO]   Rounded: (51, 84)
[INFO]   Nearest: (50.0, 84.0)
[INFO]   Rounded: (242, 285)
[INFO]   Nearest: (242.0, 284.0)
[INFO]   Rounded: (61, 157)
[INFO]   Nearest: (62.0, 156.0)
[INFO]   Rounded: (21, 286)
[INFO]   Nearest: (20.0, 286.0)
[INFO]   Rounded: (117, 164)
[INFO]   Nearest: (116.0, 164.0)
[INFO]   Rounded: (47, 244)
[INFO]   Nearest: (46.0, 244.0)
[INFO]   Rounded: (210, 235)
[INFO]   Nearest: (210.0, 236.0)
[INFO]   Rounded: (131, 278)
[INFO]   Nearest: (130.0, 278.0)
[INFO]   Rounded: (22, 42)
[INFO]   Rounded: (145, 207)
[INFO]   Nearest: (144.0, 208.0)
[INFO]   Rounded: (268, 284)
[INFO]   Rounded: (84, 180)
[INFO]   Rounded: (108, 136)
[INFO]   Rounded: (167, 203)
[INFO]   Nearest: (168.0, 202.0)
[INFO]   Rounded: (71, 202)
[INFO]   Nearest: (72.0, 202.0)
[INFO]   Rounded: (78, 225)
[INFO]   Nearest: (78.0, 224.0)
[INFO]   Rounded: (48, 96)
[INFO]   Rounded: (80, 283)
[INFO]   Nearest: (80.0, 282.0)
[INFO]   Rounded: (215, 259)
[INFO]   Nearest: (214.0, 258.0)
[INFO]   Rounded: (20, 191)
[INFO]   Nearest: (20.0, 192.0)
[INFO]   Rounded: (168, 287)
[INFO]   Nearest: (168.0, 286.0)
[INFO]   Rounded: (15, 101)
[INFO]   Nearest: (16.0, 102.0)
[INFO]   Rounded: (27, 63)
[INFO]   Nearest: (28.0, 62.0)
[INFO]   Rounded: (174, 199)
[INFO]   Nearest: (174.0, 200.0)
[INFO]   Rounded: (49, 206)
[INFO]   Nearest: (48.0, 206.0)
[INFO]   Rounded: (105, 191)
[INFO]   Nearest: (104.0, 190.0)
[INFO]   Rounded: (168, 248)
[INFO]   Rounded: (30, 228)
[INFO]   Rounded: (76, 102)
[INFO]   Rounded: (29, 145)
[INFO]   Nearest: (30.0, 144.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 212, Long SMA: 214
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(50/84) - Original Sharpe: 0.5416, Trades: 30
[INFO] Kmeans cluster 2: SMA(204/220) - Original Sharpe: 0.5081, Trades: 31
[INFO] Kmeans cluster 3: SMA(46/96) - Original Sharpe: 0.3788, Trades: 30
[INFO] Kmeans cluster 4: SMA(144/168) - Original Sharpe: 0.3406, Trades: 29
[INFO] Kmeans cluster 5: SMA(140/272) - Original Sharpe: 0.2978, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (212/214)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (50/84) - Sharpe: 0.5416
[INFO] cluster 2: (204/220) - Sharpe: 0.5081
[INFO] cluster 3: (46/96) - Sharpe: 0.3788
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.243014           -1.069139
1    2021-11-10 2021-11-10            41    -1.727839           -2.165061
2    2022-01-10 2022-01-10            41    -1.491477           -3.418842
3    2022-03-10 2022-03-10            42    -2.601234           -0.189721
4    2022-05-10 2022-05-10            41     0.452239            0.452239
5    2022-07-10 2022-07-10            44    -0.869854           -1.350839
6    2022-09-10 2022-09-10            43     2.218651           -1.064909
7    2022-11-10 2022-11-10            40    -1.000002           -0.817513
8    2023-01-10 2023-01-10            41    -0.351051            3.792858
9    2023-03-10 2023-03-10            42     1.488556            0.686008
10   2023-05-10 2023-05-10            40    -0.521278            3.457536
11   2023-07-10 2023-07-10            44     2.056252            2.056252
12   2023-09-10 2023-09-10            44    -4.792962           -3.215434
13   2023-11-10 2023-11-10            40    -0.611143            0.611143
14   2024-01-10 2024-01-10            41     4.588013           -3.608413
15   2024-03-10 2024-03-10            43    -2.405032           -2.383949
16   2024-05-10 2024-05-10            40    -0.870401           -0.949497
17   2024-07-10 2024-07-10            43     2.708529           -1.170555
18   2024-09-10 2024-09-10            44     0.264177           -3.995304
19   2024-11-10 2024-11-10            35     3.696891            7.482870
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.2 |             -1.1 |         -0.9 | False         
[INFO] 2021-11-10   |         -1.7 |             -2.2 |         -0.5 | False         
[INFO] 2022-01-10   |         -1.5 |             -3.4 |         -1.9 | False         
[INFO] 2022-03-10   |         -2.6 |             -0.2 |          2.4 | True          
[INFO] 2022-05-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.9 |             -1.4 |         -0.5 | False         
[INFO] 2022-09-10   |          2.2 |             -1.1 |         -3.3 | False         
[INFO] 2022-11-10   |         -1.0 |             -0.8 |          0.2 | True          
[INFO] 2023-01-10   |         -0.4 |              3.8 |          4.2 | True          
[INFO] 2023-03-10   |          1.5 |              0.7 |         -0.8 | False         
[INFO] 2023-05-10   |         -0.5 |              3.5 |          4.0 | True          
[INFO] 2023-07-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -4.8 |             -3.2 |          1.6 | True          
[INFO] 2023-11-10   |         -0.6 |              0.6 |          1.2 | True          
[INFO] 2024-01-10   |          4.6 |             -3.6 |         -8.2 | False         
[INFO] 2024-03-10   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2024-05-10   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-07-10   |          2.7 |             -1.2 |         -3.9 | False         
[INFO] 2024-09-10   |          0.3 |             -4.0 |         -4.3 | False         
[INFO] 2024-11-10   |          3.7 |              7.5 |          3.8 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-10, 2023-07-10, 2024-03-10, 2024-05-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 7 of 16 periods (43.75% win rate)
[INFO] Updating Excel file with Kmeans results for FC...
[INFO] Excel file updated successfully. Added FC with Kmeans win rate 43.8% in row 16
[INFO] Added best Sharpe parameters 212/214 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 212, Long SMA: 214
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(50/84) - Original Sharpe: 0.5416
[INFO] Added cluster 2 to portfolio: SMA(204/220) - Original Sharpe: 0.5081
[INFO] Added cluster 3 to portfolio: SMA(46/96) - Original Sharpe: 0.3788
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3569
[INFO] Kmeans Best out-of-sample Sharpe: -0.2095
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FC...
[INFO] Excel file updated successfully. Added FC with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FC
[INFO] Big Point Value: 500.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4652 to 0.7597
[INFO] 
Best parameters:
[INFO] Short SMA: 212
[INFO] Long SMA: 214
[INFO] Sharpe Ratio: 0.759717
[INFO] Number of Trades: 91
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4652 to 0.7597
[INFO] Trades range: 10.0 to 377.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6102 to 4.0054
[INFO] Scaled Trades range: -0.8971 to 17.2706
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5547
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 106 elements
[INFO] Cluster 1: 529 elements
[INFO] Cluster 2: 401 elements
[INFO] Cluster 3: 41 elements
[INFO] Cluster 4: 396 elements
[INFO] Cluster 5: 225 elements
[INFO] Cluster 6: 26 elements
[INFO] Cluster 7: 251 elements
[INFO] Cluster 8: 361 elements
[INFO] Cluster 9: 510 elements
[INFO] Cluster 10: 361 elements
[INFO] Cluster 11: 363 elements
[INFO] Cluster 12: 69 elements
[INFO] Cluster 13: 321 elements
[INFO] Cluster 14: 395 elements
[INFO] Cluster 15: 50 elements
[INFO] Cluster 16: 215 elements
[INFO] Cluster 17: 282 elements
[INFO] Cluster 18: 255 elements
[INFO] Cluster 19: 276 elements
[INFO] Cluster 20: 342 elements
[INFO] Cluster 21: 297 elements
[INFO] Cluster 22: 306 elements
[INFO] Cluster 23: 369 elements
[INFO] Cluster 24: 57 elements
[INFO] Cluster 25: 74 elements
[INFO] Cluster 26: 369 elements
[INFO] Cluster 27: 3 elements
[INFO] Cluster 28: 71 elements
[INFO] Cluster 29: 332 elements
[INFO] Cluster 30: 97 elements
[INFO] Cluster 31: 231 elements
[INFO] Cluster 32: 108 elements
[INFO] Cluster 33: 169 elements
[INFO] Cluster 34: 196 elements
[INFO] Cluster 35: 193 elements
[INFO] Cluster 36: 311 elements
[INFO] Cluster 37: 114 elements
[INFO] Cluster 38: 93 elements
[INFO] Cluster 39: 168 elements
[INFO] Cluster 40: 153 elements
[INFO] Cluster 41: 28 elements
[INFO] Cluster 42: 239 elements
[INFO] Cluster 43: 36 elements
[INFO] Cluster 44: 78 elements
[INFO] Cluster 45: 253 elements
[INFO] Cluster 46: 156 elements
[INFO] Cluster 47: 179 elements
[INFO] Cluster 48: 81 elements
[INFO] Cluster 49: 49 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=158, Long SMA=164, Sharpe=0.1300, Trades=58
[INFO] Cluster 1 cluster: Short SMA=86, Long SMA=276, Sharpe=-0.2802, Trades=15
[INFO] Cluster 2 cluster: Short SMA=90, Long SMA=182, Sharpe=0.0462, Trades=18
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=38, Sharpe=-0.0631, Trades=138
[INFO] Cluster 4 cluster: Short SMA=122, Long SMA=276, Sharpe=0.1057, Trades=12
[INFO] Cluster 5 cluster: Short SMA=194, Long SMA=214, Sharpe=0.1260, Trades=31
[INFO] Cluster 6 cluster: Short SMA=28, Long SMA=30, Sharpe=-0.3392, Trades=206
[INFO] Cluster 7 cluster: Short SMA=16, Long SMA=92, Sharpe=0.1847, Trades=42
[INFO] Cluster 8 cluster: Short SMA=114, Long SMA=168, Sharpe=-0.0310, Trades=25
[INFO] Cluster 9 cluster: Short SMA=156, Long SMA=250, Sharpe=0.1432, Trades=13
[INFO] Cluster 10 cluster: Short SMA=74, Long SMA=210, Sharpe=0.2948, Trades=22
[INFO] Cluster 11 cluster: Short SMA=70, Long SMA=148, Sharpe=-0.0793, Trades=24
[INFO] Cluster 12 cluster: Short SMA=246, Long SMA=250, Sharpe=0.2759, Trades=53
[INFO] Cluster 13 cluster: Short SMA=178, Long SMA=272, Sharpe=0.1103, Trades=14
[INFO] Cluster 14 cluster: Short SMA=246, Long SMA=274, Sharpe=-0.0602, Trades=21
[INFO] Cluster 15 cluster: Short SMA=62, Long SMA=66, Sharpe=0.3531, Trades=102
[INFO] Cluster 16 cluster: Short SMA=44, Long SMA=84, Sharpe=0.2796, Trades=36
[INFO] Cluster 17 cluster: Short SMA=32, Long SMA=280, Sharpe=-0.0481, Trades=29
[INFO] Cluster 18 cluster: Short SMA=222, Long SMA=260, Sharpe=0.0811, Trades=21
[INFO] Cluster 19 cluster: Short SMA=16, Long SMA=198, Sharpe=-0.0340, Trades=42
[INFO] Cluster 20 cluster: Short SMA=200, Long SMA=282, Sharpe=0.2118, Trades=13
[INFO] Cluster 21 cluster: Short SMA=148, Long SMA=196, Sharpe=0.1840, Trades=23
[INFO] Cluster 22 cluster: Short SMA=38, Long SMA=176, Sharpe=0.0668, Trades=26
[INFO] Cluster 23 cluster: Short SMA=48, Long SMA=100, Sharpe=0.3988, Trades=32
[INFO] Cluster 24 cluster: Short SMA=52, Long SMA=64, Sharpe=0.3404, Trades=67
[INFO] Cluster 25 cluster: Short SMA=204, Long SMA=220, Sharpe=0.5081, Trades=31
[INFO] Cluster 26 cluster: Short SMA=34, Long SMA=236, Sharpe=0.1178, Trades=28
[INFO] Cluster 28 cluster: Short SMA=22, Long SMA=34, Sharpe=-0.2216, Trades=98
[INFO] Cluster 29 cluster: Short SMA=108, Long SMA=232, Sharpe=0.2603, Trades=15
[INFO] Cluster 30 cluster: Short SMA=22, Long SMA=46, Sharpe=-0.2176, Trades=70
[INFO] Cluster 31 cluster: Short SMA=132, Long SMA=214, Sharpe=0.3115, Trades=21
[INFO] Cluster 32 cluster: Short SMA=14, Long SMA=282, Sharpe=-0.2799, Trades=41
[INFO] Cluster 33 cluster: Short SMA=138, Long SMA=272, Sharpe=0.3810, Trades=12
[INFO] Cluster 34 cluster: Short SMA=58, Long SMA=120, Sharpe=0.2762, Trades=26
[INFO] Cluster 35 cluster: Short SMA=50, Long SMA=214, Sharpe=-0.0164, Trades=26
[INFO] Cluster 36 cluster: Short SMA=98, Long SMA=128, Sharpe=0.1197, Trades=27
[INFO] Cluster 37 cluster: Short SMA=242, Long SMA=290, Sharpe=-0.1649, Trades=17
[INFO] Cluster 38 cluster: Short SMA=22, Long SMA=62, Sharpe=0.0543, Trades=52
[INFO] Cluster 39 cluster: Short SMA=58, Long SMA=276, Sharpe=0.0068, Trades=19
[INFO] Cluster 40 cluster: Short SMA=168, Long SMA=210, Sharpe=0.0294, Trades=23
[INFO] Cluster 41 cluster: Short SMA=208, Long SMA=210, Sharpe=0.1792, Trades=91
[INFO] Cluster 42 cluster: Short SMA=28, Long SMA=140, Sharpe=0.2319, Trades=34
[INFO] Cluster 43 cluster: Short SMA=140, Long SMA=142, Sharpe=-0.1260, Trades=93
[INFO] Cluster 44 cluster: Short SMA=268, Long SMA=274, Sharpe=0.0294, Trades=45
[INFO] Cluster 45 cluster: Short SMA=142, Long SMA=186, Sharpe=0.2510, Trades=23
[INFO] Cluster 46 cluster: Short SMA=58, Long SMA=160, Sharpe=-0.1336, Trades=24
[INFO] Cluster 47 cluster: Short SMA=48, Long SMA=248, Sharpe=0.3163, Trades=24
[INFO] Cluster 48 cluster: Short SMA=108, Long SMA=122, Sharpe=0.0830, Trades=35
[INFO] Cluster 49 cluster: Short SMA=84, Long SMA=90, Sharpe=0.1122, Trades=68
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=212, Long SMA=214, Sharpe=0.7597, Trades=91
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=204, Long SMA=220, Sharpe=0.5081, Trades=31
[INFO] Top 2: Short SMA=48, Long SMA=100, Sharpe=0.3988, Trades=32
[INFO] Top 3: Short SMA=138, Long SMA=272, Sharpe=0.3810, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10582 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 212, Long SMA: 214
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(204/220) - Original Sharpe: 0.5081, Trades: 31
[INFO] Hierarchical cluster 2: SMA(48/100) - Original Sharpe: 0.3988, Trades: 32
[INFO] Hierarchical cluster 3: SMA(138/272) - Original Sharpe: 0.3810, Trades: 12
[INFO] Hierarchical cluster 4: SMA(62/66) - Original Sharpe: 0.3531, Trades: 102
[INFO] Hierarchical cluster 5: SMA(52/64) - Original Sharpe: 0.3404, Trades: 67
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (212/214)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (204/220) - Sharpe: 0.5081
[INFO] cluster 2: (48/100) - Sharpe: 0.3988
[INFO] cluster 3: (138/272) - Sharpe: 0.3810
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.243014            0.548539
1    2021-11-10 2021-11-10            41    -1.727839           -1.729910
2    2022-01-10 2022-01-10            41    -1.491477           -2.043836
3    2022-03-10 2022-03-10            42    -2.601234            0.157045
4    2022-05-10 2022-05-10            41     0.452239            0.452239
5    2022-07-10 2022-07-10            44    -0.869854           -2.241745
6    2022-09-10 2022-09-10            43     2.218651            2.242787
7    2022-11-10 2022-11-10            40    -1.000002           -0.987037
8    2023-01-10 2023-01-10            41    -0.351051            3.473554
9    2023-03-10 2023-03-10            42     1.488556            1.313178
10   2023-05-10 2023-05-10            40    -0.521278            3.457536
11   2023-07-10 2023-07-10            44     2.056252            2.056252
12   2023-09-10 2023-09-10            44    -4.792962           -3.979653
13   2023-11-10 2023-11-10            40    -0.611143           -0.611143
14   2024-01-10 2024-01-10            41     4.588013            1.147273
15   2024-03-10 2024-03-10            43    -2.405032            0.217589
16   2024-05-10 2024-05-10            40    -0.870401           -0.355726
17   2024-07-10 2024-07-10            43     2.708529            1.129969
18   2024-09-10 2024-09-10            44     0.264177           -3.132565
19   2024-11-10 2024-11-10            35     3.696891            0.615651
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.2 |              0.5 |          0.7 | True          
[INFO] 2021-11-10   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2022-01-10   |         -1.5 |             -2.0 |         -0.5 | False         
[INFO] 2022-03-10   |         -2.6 |              0.2 |          2.8 | True          
[INFO] 2022-05-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.9 |             -2.2 |         -1.3 | False         
[INFO] 2022-09-10   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2022-11-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2023-01-10   |         -0.4 |              3.5 |          3.9 | True          
[INFO] 2023-03-10   |          1.5 |              1.3 |         -0.2 | False         
[INFO] 2023-05-10   |         -0.5 |              3.5 |          4.0 | True          
[INFO] 2023-07-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -4.8 |             -4.0 |          0.8 | True          
[INFO] 2023-11-10   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2024-01-10   |          4.6 |              1.1 |         -3.5 | False         
[INFO] 2024-03-10   |         -2.4 |              0.2 |          2.6 | True          
[INFO] 2024-05-10   |         -0.9 |             -0.4 |          0.5 | True          
[INFO] 2024-07-10   |          2.7 |              1.1 |         -1.6 | False         
[INFO] 2024-09-10   |          0.3 |             -3.1 |         -3.4 | False         
[INFO] 2024-11-10   |          3.7 |              0.6 |         -3.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-10, 2022-05-10, 2022-09-10, 2022-11-10, 2023-07-10, 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 14 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for FC...
[INFO] Excel file updated successfully. Added FC with Hierarchical win rate 50.0% in row 16
[INFO] Added best Sharpe parameters 212/214 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 212, Long SMA: 214
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(204/220) - Original Sharpe: 0.5081
[INFO] Added cluster 2 to portfolio: SMA(48/100) - Original Sharpe: 0.3988
[INFO] Added cluster 3 to portfolio: SMA(138/272) - Original Sharpe: 0.3810
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0383
[INFO] Hierarchical Best out-of-sample Sharpe: -0.2095
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FC...
[INFO] Excel file updated successfully. Added FC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FC
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FDAX in column D: 27.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.64s
[INFO] Best parameters: Short SMA = 160, Long SMA = 262
[INFO] Best Sharpe ratio: 0.607501, Trades: 11
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 345 bad combos; keeping 1784 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FDAX
[INFO] Big Point Value (from data): 25.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 1.84 contracts
[INFO] Maximum Position Size: 3 contracts
[INFO] Strategy Total P&L: $341,785.00
[INFO] Market Buy & Hold P&L: $221,350.00
[INFO] Outperformance: $120,435.00
[INFO] Sharpe ratio (entire period, annualized): 0.414119
[INFO] Sharpe ratio (in-sample, annualized): 0.607501
[INFO] Sharpe ratio (out-of-sample, annualized): -0.028574
[INFO] Maximum Drawdown: $183,656.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 7
[INFO] Out-of-sample period trades: 4
[INFO] Total trades: 11
[INFO] In-sample P&L: $450,899.00
[INFO] Out-of-sample P&L: $-9,264.00
[INFO] 
Best parameters from GA: Short SMA = 160, Long SMA = 262, Sharpe = 0.607501
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 25.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9414 to 0.6075
[INFO] 
Best parameters:
[INFO] Short SMA: 160
[INFO] Long SMA: 262
[INFO] Sharpe Ratio: 0.607501
[INFO] Number of Trades: 11
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10240 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9414 to 0.6075
[INFO] Trades range: 10.0 to 339.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3672 to 2.8326
[INFO] Scaled Long SMA range: -2.7807 to 1.4497
[INFO] Scaled Sharpe ratio range: -4.1879 to 3.3270
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 239 elements
[INFO] Kmeans Cluster 1: 204 elements
[INFO] Kmeans Cluster 2: 245 elements
[INFO] Kmeans Cluster 3: 248 elements
[INFO] Kmeans Cluster 4: 199 elements
[INFO] Kmeans Cluster 5: 253 elements
[INFO] Kmeans Cluster 6: 240 elements
[INFO] Kmeans Cluster 7: 144 elements
[INFO] Kmeans Cluster 8: 188 elements
[INFO] Kmeans Cluster 9: 98 elements
[INFO] Kmeans Cluster 10: 12 elements
[INFO] Kmeans Cluster 11: 310 elements
[INFO] Kmeans Cluster 12: 204 elements
[INFO] Kmeans Cluster 13: 213 elements
[INFO] Kmeans Cluster 14: 186 elements
[INFO] Kmeans Cluster 15: 201 elements
[INFO] Kmeans Cluster 16: 147 elements
[INFO] Kmeans Cluster 17: 259 elements
[INFO] Kmeans Cluster 18: 321 elements
[INFO] Kmeans Cluster 19: 156 elements
[INFO] Kmeans Cluster 20: 183 elements
[INFO] Kmeans Cluster 21: 216 elements
[INFO] Kmeans Cluster 22: 244 elements
[INFO] Kmeans Cluster 23: 249 elements
[INFO] Kmeans Cluster 24: 205 elements
[INFO] Kmeans Cluster 25: 82 elements
[INFO] Kmeans Cluster 26: 283 elements
[INFO] Kmeans Cluster 27: 97 elements
[INFO] Kmeans Cluster 28: 183 elements
[INFO] Kmeans Cluster 29: 281 elements
[INFO] Kmeans Cluster 30: 256 elements
[INFO] Kmeans Cluster 31: 200 elements
[INFO] Kmeans Cluster 32: 249 elements
[INFO] Kmeans Cluster 33: 177 elements
[INFO] Kmeans Cluster 34: 255 elements
[INFO] Kmeans Cluster 35: 208 elements
[INFO] Kmeans Cluster 36: 154 elements
[INFO] Kmeans Cluster 37: 219 elements
[INFO] Kmeans Cluster 38: 169 elements
[INFO] Kmeans Cluster 39: 241 elements
[INFO] Kmeans Cluster 40: 203 elements
[INFO] Kmeans Cluster 41: 290 elements
[INFO] Kmeans Cluster 42: 251 elements
[INFO] Kmeans Cluster 43: 244 elements
[INFO] Kmeans Cluster 44: 268 elements
[INFO] Kmeans Cluster 45: 95 elements
[INFO] Kmeans Cluster 46: 190 elements
[INFO] Kmeans Cluster 47: 210 elements
[INFO] Kmeans Cluster 48: 159 elements
[INFO] Kmeans Cluster 49: 112 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=80.69, Long SMA=218.31, Sharpe=-0.2092
[INFO] Centroid 1: Short SMA=190.75, Long SMA=218.61, Sharpe=0.3171
[INFO] Centroid 2: Short SMA=23.49, Long SMA=111.04, Sharpe=-0.2763
[INFO] Centroid 3: Short SMA=227.41, Long SMA=248.20, Sharpe=-0.0634
[INFO] Centroid 4: Short SMA=68.41, Long SMA=286.40, Sharpe=-0.0764
[INFO] Centroid 5: Short SMA=126.45, Long SMA=230.65, Sharpe=0.0367
[INFO] Centroid 6: Short SMA=150.38, Long SMA=176.13, Sharpe=-0.1503
[INFO] Centroid 7: Short SMA=90.31, Long SMA=123.04, Sharpe=0.0102
[INFO] Centroid 8: Short SMA=23.56, Long SMA=58.47, Sharpe=0.0431
[INFO] Centroid 9: Short SMA=262.18, Long SMA=282.53, Sharpe=-0.5306
[INFO] Centroid 11: Short SMA=58.62, Long SMA=189.85, Sharpe=-0.1255
[INFO] Centroid 12: Short SMA=25.56, Long SMA=279.09, Sharpe=-0.3692
[INFO] Centroid 13: Short SMA=107.28, Long SMA=181.12, Sharpe=-0.1361
[INFO] Centroid 14: Short SMA=54.48, Long SMA=88.45, Sharpe=-0.3886
[INFO] Centroid 15: Short SMA=21.65, Long SMA=239.78, Sharpe=-0.2766
[INFO] Centroid 16: Short SMA=109.20, Long SMA=284.76, Sharpe=0.1573
[INFO] Centroid 17: Short SMA=176.49, Long SMA=235.83, Sharpe=0.4661
[INFO] Centroid 18: Short SMA=212.24, Long SMA=275.57, Sharpe=0.0277
[INFO] Centroid 19: Short SMA=65.42, Long SMA=112.09, Sharpe=-0.2697
[INFO] Centroid 20: Short SMA=269.81, Long SMA=289.09, Sharpe=-0.3564
[INFO] Centroid 21: Short SMA=33.55, Long SMA=62.63, Sharpe=-0.0838
[INFO] Centroid 22: Short SMA=102.28, Long SMA=234.42, Sharpe=-0.0640
[INFO] Centroid 23: Short SMA=55.00, Long SMA=146.57, Sharpe=-0.0672
[INFO] Centroid 24: Short SMA=25.80, Long SMA=200.60, Sharpe=-0.2096
[INFO] Centroid 25: Short SMA=19.24, Long SMA=50.54, Sharpe=0.2445
[INFO] Centroid 26: Short SMA=120.14, Long SMA=200.19, Sharpe=-0.0394
[INFO] Centroid 27: Short SMA=95.61, Long SMA=120.16, Sharpe=0.1743
[INFO] Centroid 28: Short SMA=20.84, Long SMA=163.88, Sharpe=-0.3249
[INFO] Centroid 29: Short SMA=50.90, Long SMA=230.13, Sharpe=-0.0934
[INFO] Centroid 30: Short SMA=106.20, Long SMA=279.73, Sharpe=0.0537
[INFO] Centroid 31: Short SMA=134.79, Long SMA=281.92, Sharpe=0.2617
[INFO] Centroid 32: Short SMA=30.68, Long SMA=148.70, Sharpe=-0.1914
[INFO] Centroid 33: Short SMA=29.16, Long SMA=281.50, Sharpe=-0.2524
[INFO] Centroid 34: Short SMA=111.36, Long SMA=144.19, Sharpe=-0.1546
[INFO] Centroid 35: Short SMA=206.02, Long SMA=246.23, Sharpe=0.1307
[INFO] Centroid 36: Short SMA=38.88, Long SMA=63.84, Sharpe=-0.2136
[INFO] Centroid 37: Short SMA=49.71, Long SMA=265.30, Sharpe=-0.1504
[INFO] Centroid 38: Short SMA=29.82, Long SMA=205.08, Sharpe=-0.0691
[INFO] Centroid 39: Short SMA=56.80, Long SMA=116.70, Sharpe=-0.1493
[INFO] Centroid 40: Short SMA=165.94, Long SMA=194.20, Sharpe=0.0023
[INFO] Centroid 41: Short SMA=81.10, Long SMA=167.66, Sharpe=-0.2138
[INFO] Centroid 42: Short SMA=76.51, Long SMA=256.73, Sharpe=-0.2166
[INFO] Centroid 43: Short SMA=136.61, Long SMA=253.76, Sharpe=0.1438
[INFO] Centroid 44: Short SMA=237.18, Long SMA=282.36, Sharpe=-0.1252
[INFO] Centroid 45: Short SMA=123.14, Long SMA=140.19, Sharpe=-0.3042
[INFO] Centroid 46: Short SMA=167.63, Long SMA=258.98, Sharpe=0.3626
[INFO] Centroid 47: Short SMA=159.57, Long SMA=209.92, Sharpe=0.1540
[INFO] Centroid 48: Short SMA=129.48, Long SMA=156.15, Sharpe=-0.0331
[INFO] Centroid 49: Short SMA=70.95, Long SMA=91.84, Sharpe=-0.5417
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=160, Long SMA=262, Sharpe=0.6075, Trades=11
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=178, Long SMA=234, Sharpe=0.4827, Trades=12
[INFO] Kmeans Top 2: Short SMA=194, Long SMA=218, Sharpe=0.4016, Trades=20
[INFO] Kmeans Top 3: Short SMA=168, Long SMA=256, Sharpe=0.3927, Trades=12
[INFO] Kmeans Top 4: Short SMA=108, Long SMA=284, Sharpe=0.2191, Trades=11
[INFO] Kmeans Top 5: Short SMA=136, Long SMA=282, Sharpe=0.2128, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (81, 218)
[INFO]   Nearest: (80.0, 218.0)
[INFO]   Rounded: (191, 219)
[INFO]   Nearest: (190.0, 218.0)
[INFO]   Rounded: (23, 111)
[INFO]   Nearest: (24.0, 112.0)
[INFO]   Rounded: (227, 248)
[INFO]   Nearest: (228.0, 248.0)
[INFO]   Rounded: (68, 286)
[INFO]   Rounded: (126, 231)
[INFO]   Nearest: (126.0, 230.0)
[INFO]   Rounded: (150, 176)
[INFO]   Rounded: (90, 123)
[INFO]   Nearest: (90.0, 124.0)
[INFO]   Rounded: (24, 58)
[INFO]   Rounded: (262, 283)
[INFO]   Nearest: (262.0, 282.0)
[INFO]   Rounded: (59, 190)
[INFO]   Nearest: (58.0, 190.0)
[INFO]   Rounded: (26, 279)
[INFO]   Nearest: (26.0, 280.0)
[INFO]   Rounded: (107, 181)
[INFO]   Nearest: (108.0, 182.0)
[INFO]   Rounded: (54, 88)
[INFO]   Rounded: (22, 240)
[INFO]   Rounded: (109, 285)
[INFO]   Nearest: (110.0, 284.0)
[INFO]   Rounded: (176, 236)
[INFO]   Rounded: (212, 276)
[INFO]   Rounded: (65, 112)
[INFO]   Nearest: (66.0, 112.0)
[INFO]   Rounded: (270, 289)
[INFO]   Nearest: (270.0, 290.0)
[INFO]   Rounded: (34, 63)
[INFO]   Nearest: (34.0, 62.0)
[INFO]   Rounded: (102, 234)
[INFO]   Rounded: (55, 147)
[INFO]   Nearest: (54.0, 146.0)
[INFO]   Rounded: (26, 201)
[INFO]   Nearest: (26.0, 200.0)
[INFO]   Rounded: (19, 51)
[INFO]   Nearest: (20.0, 50.0)
[INFO]   Rounded: (120, 200)
[INFO]   Rounded: (96, 120)
[INFO]   Rounded: (21, 164)
[INFO]   Nearest: (20.0, 164.0)
[INFO]   Rounded: (51, 230)
[INFO]   Nearest: (50.0, 230.0)
[INFO]   Rounded: (106, 280)
[INFO]   Rounded: (135, 282)
[INFO]   Nearest: (134.0, 282.0)
[INFO]   Rounded: (31, 149)
[INFO]   Nearest: (30.0, 148.0)
[INFO]   Rounded: (29, 282)
[INFO]   Nearest: (30.0, 282.0)
[INFO]   Rounded: (111, 144)
[INFO]   Nearest: (112.0, 144.0)
[INFO]   Rounded: (206, 246)
[INFO]   Rounded: (39, 64)
[INFO]   Nearest: (38.0, 64.0)
[INFO]   Rounded: (50, 265)
[INFO]   Nearest: (50.0, 266.0)
[INFO]   Rounded: (30, 205)
[INFO]   Nearest: (30.0, 206.0)
[INFO]   Rounded: (57, 117)
[INFO]   Nearest: (56.0, 116.0)
[INFO]   Rounded: (166, 194)
[INFO]   Rounded: (81, 168)
[INFO]   Nearest: (82.0, 168.0)
[INFO]   Rounded: (77, 257)
[INFO]   Nearest: (76.0, 256.0)
[INFO]   Rounded: (137, 254)
[INFO]   Nearest: (136.0, 254.0)
[INFO]   Rounded: (237, 282)
[INFO]   Nearest: (238.0, 282.0)
[INFO]   Rounded: (123, 140)
[INFO]   Nearest: (124.0, 140.0)
[INFO]   Rounded: (168, 259)
[INFO]   Nearest: (168.0, 258.0)
[INFO]   Rounded: (160, 210)
[INFO]   Rounded: (129, 156)
[INFO]   Nearest: (130.0, 156.0)
[INFO]   Rounded: (71, 92)
[INFO]   Nearest: (70.0, 92.0)
[INFO] Successfully plotted 49 out of 49 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 160, Long SMA: 262
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(178/234) - Original Sharpe: 0.4827, Trades: 12
[INFO] Kmeans cluster 2: SMA(194/218) - Original Sharpe: 0.4016, Trades: 20
[INFO] Kmeans cluster 3: SMA(168/256) - Original Sharpe: 0.3927, Trades: 12
[INFO] Kmeans cluster 4: SMA(108/284) - Original Sharpe: 0.2191, Trades: 11
[INFO] Kmeans cluster 5: SMA(136/282) - Original Sharpe: 0.2128, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2794
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (160/262)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (178/234) - Sharpe: 0.4827
[INFO] cluster 2: (194/218) - Sharpe: 0.4016
[INFO] cluster 3: (168/256) - Sharpe: 0.3927
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Out-of-sample period starts on: 2021-09-20
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-20 2021-09-20            45     1.874942            1.874942
1    2021-11-20 2021-11-20            41    -1.542081           -1.542081
2    2022-01-20 2022-01-20            42    -2.017855           -1.997490
3    2022-03-20 2022-03-20            42     1.424244            1.074352
4    2022-05-20 2022-05-20            43     0.980542            0.980542
5    2022-07-20 2022-07-20            44     1.402100            1.402100
6    2022-09-20 2022-09-20            44    -3.031215           -3.031215
7    2022-11-20 2022-11-20            43    -1.359366           -1.359366
8    2023-01-20 2023-01-20            41    -2.575891           -2.671959
9    2023-03-20 2023-03-20            42     4.502487            4.392442
10   2023-05-20 2023-05-20            43    -0.783470           -0.783470
11   2023-07-20 2023-07-20            44    -1.705868           -1.705868
12   2023-09-20 2023-09-20            43     0.424324            0.424324
13   2023-11-20 2023-11-20            42     2.238515            2.238515
14   2024-01-20 2024-01-20            42     1.404552           -0.704792
15   2024-03-20 2024-03-20            40     1.567381            0.260014
16   2024-05-20 2024-05-20            45    -1.796289           -1.796289
17   2024-07-20 2024-07-20            44     0.668910            0.668910
18   2024-09-20 2024-09-20            43     0.376154            0.376154
19   2024-11-20 2024-11-20            26     2.631388            2.631388
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-20   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-20   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-01-20   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-03-20   |          1.4 |              1.1 |         -0.3 | False         
[INFO] 2022-05-20   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-07-20   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-09-20   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-11-20   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2023-01-20   |         -2.6 |             -2.7 |         -0.1 | False         
[INFO] 2023-03-20   |          4.5 |              4.4 |         -0.1 | False         
[INFO] 2023-05-20   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-07-20   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2023-11-20   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-01-20   |          1.4 |             -0.7 |         -2.1 | False         
[INFO] 2024-03-20   |          1.6 |              0.3 |         -1.3 | False         
[INFO] 2024-05-20   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 2024-07-20   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-20   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-20, 2021-11-20, 2022-01-20, 2022-05-20, 2022-07-20, 2022-09-20, 2022-11-20, 2023-05-20, 2023-07-20, 2023-09-20, 2023-11-20, 2024-05-20, 2024-07-20, 2024-09-20, 2024-11-20
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 5
[INFO] Kmeans cluster wins (rounded comparison): 0 of 5 periods (0.00% win rate)
[INFO] Updating Excel file with Kmeans results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Kmeans win rate 0.0% in row 17
[INFO] Added best Sharpe parameters 160/262 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 160, Long SMA: 262
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(178/234) - Original Sharpe: 0.4827
[INFO] Added cluster 2 to portfolio: SMA(194/218) - Original Sharpe: 0.4016
[INFO] Added cluster 3 to portfolio: SMA(168/256) - Original Sharpe: 0.3927
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FDAX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1682
[INFO] Kmeans Best out-of-sample Sharpe: -0.0286
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FDAX
[INFO] Big Point Value: 25.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9414 to 0.6075
[INFO] 
Best parameters:
[INFO] Short SMA: 160
[INFO] Long SMA: 262
[INFO] Sharpe Ratio: 0.607501
[INFO] Number of Trades: 11
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10240 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9414 to 0.6075
[INFO] Trades range: 10.0 to 339.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3672 to 2.8326
[INFO] Scaled Long SMA range: -2.7807 to 1.4497
[INFO] Scaled Sharpe ratio range: -4.1879 to 3.3270
[INFO] Scaled Trades range: -0.6811 to 15.7386
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10240 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5273
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 327 elements
[INFO] Cluster 1: 248 elements
[INFO] Cluster 2: 195 elements
[INFO] Cluster 3: 257 elements
[INFO] Cluster 4: 86 elements
[INFO] Cluster 5: 23 elements
[INFO] Cluster 6: 564 elements
[INFO] Cluster 7: 62 elements
[INFO] Cluster 8: 185 elements
[INFO] Cluster 9: 378 elements
[INFO] Cluster 10: 342 elements
[INFO] Cluster 11: 386 elements
[INFO] Cluster 12: 397 elements
[INFO] Cluster 13: 158 elements
[INFO] Cluster 14: 255 elements
[INFO] Cluster 15: 335 elements
[INFO] Cluster 16: 84 elements
[INFO] Cluster 17: 283 elements
[INFO] Cluster 18: 287 elements
[INFO] Cluster 19: 378 elements
[INFO] Cluster 20: 234 elements
[INFO] Cluster 21: 46 elements
[INFO] Cluster 22: 198 elements
[INFO] Cluster 23: 371 elements
[INFO] Cluster 24: 386 elements
[INFO] Cluster 25: 334 elements
[INFO] Cluster 26: 282 elements
[INFO] Cluster 27: 250 elements
[INFO] Cluster 28: 64 elements
[INFO] Cluster 29: 111 elements
[INFO] Cluster 30: 78 elements
[INFO] Cluster 31: 159 elements
[INFO] Cluster 32: 308 elements
[INFO] Cluster 33: 64 elements
[INFO] Cluster 34: 210 elements
[INFO] Cluster 35: 244 elements
[INFO] Cluster 36: 3 elements
[INFO] Cluster 37: 6 elements
[INFO] Cluster 38: 18 elements
[INFO] Cluster 39: 20 elements
[INFO] Cluster 40: 170 elements
[INFO] Cluster 41: 230 elements
[INFO] Cluster 42: 80 elements
[INFO] Cluster 43: 379 elements
[INFO] Cluster 44: 26 elements
[INFO] Cluster 45: 109 elements
[INFO] Cluster 46: 179 elements
[INFO] Cluster 47: 60 elements
[INFO] Cluster 48: 180 elements
[INFO] Cluster 49: 211 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=24, Long SMA=218, Sharpe=-0.2225, Trades=16
[INFO] Cluster 1 cluster: Short SMA=268, Long SMA=286, Sharpe=-0.4305, Trades=21
[INFO] Cluster 2 cluster: Short SMA=90, Long SMA=126, Sharpe=0.2288, Trades=24
[INFO] Cluster 3 cluster: Short SMA=20, Long SMA=142, Sharpe=-0.3926, Trades=36
[INFO] Cluster 4 cluster: Short SMA=246, Long SMA=250, Sharpe=-0.2662, Trades=42
[INFO] Cluster 5 cluster: Short SMA=34, Long SMA=36, Sharpe=-0.0554, Trades=184
[INFO] Cluster 6 cluster: Short SMA=66, Long SMA=194, Sharpe=-0.1029, Trades=12
[INFO] Cluster 7 cluster: Short SMA=28, Long SMA=34, Sharpe=-0.0170, Trades=122
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=76, Sharpe=0.0178, Trades=42
[INFO] Cluster 9 cluster: Short SMA=24, Long SMA=276, Sharpe=-0.3299, Trades=21
[INFO] Cluster 10 cluster: Short SMA=120, Long SMA=152, Sharpe=-0.2014, Trades=20
[INFO] Cluster 11 cluster: Short SMA=132, Long SMA=180, Sharpe=-0.1173, Trades=16
[INFO] Cluster 12 cluster: Short SMA=46, Long SMA=210, Sharpe=-0.1026, Trades=14
[INFO] Cluster 13 cluster: Short SMA=22, Long SMA=54, Sharpe=0.0166, Trades=66
[INFO] Cluster 14 cluster: Short SMA=70, Long SMA=124, Sharpe=-0.3128, Trades=24
[INFO] Cluster 15 cluster: Short SMA=232, Long SMA=282, Sharpe=-0.0556, Trades=13
[INFO] Cluster 16 cluster: Short SMA=198, Long SMA=208, Sharpe=0.4023, Trades=38
[INFO] Cluster 17 cluster: Short SMA=142, Long SMA=202, Sharpe=-0.0188, Trades=14
[INFO] Cluster 18 cluster: Short SMA=46, Long SMA=98, Sharpe=-0.2728, Trades=34
[INFO] Cluster 19 cluster: Short SMA=112, Long SMA=276, Sharpe=0.0761, Trades=13
[INFO] Cluster 20 cluster: Short SMA=154, Long SMA=272, Sharpe=0.2975, Trades=11
[INFO] Cluster 21 cluster: Short SMA=144, Long SMA=146, Sharpe=-0.2599, Trades=86
[INFO] Cluster 22 cluster: Short SMA=52, Long SMA=88, Sharpe=-0.3536, Trades=32
[INFO] Cluster 23 cluster: Short SMA=54, Long SMA=148, Sharpe=-0.1166, Trades=22
[INFO] Cluster 24 cluster: Short SMA=60, Long SMA=252, Sharpe=-0.0616, Trades=14
[INFO] Cluster 25 cluster: Short SMA=108, Long SMA=212, Sharpe=-0.1028, Trades=12
[INFO] Cluster 26 cluster: Short SMA=170, Long SMA=242, Sharpe=0.4285, Trades=12
[INFO] Cluster 27 cluster: Short SMA=54, Long SMA=274, Sharpe=-0.1905, Trades=15
[INFO] Cluster 28 cluster: Short SMA=80, Long SMA=88, Sharpe=-0.3865, Trades=62
[INFO] Cluster 29 cluster: Short SMA=42, Long SMA=58, Sharpe=-0.1751, Trades=58
[INFO] Cluster 30 cluster: Short SMA=174, Long SMA=186, Sharpe=-0.0358, Trades=38
[INFO] Cluster 31 cluster: Short SMA=234, Long SMA=248, Sharpe=-0.0886, Trades=26
[INFO] Cluster 32 cluster: Short SMA=148, Long SMA=228, Sharpe=0.1161, Trades=12
[INFO] Cluster 33 cluster: Short SMA=22, Long SMA=38, Sharpe=0.0541, Trades=84
[INFO] Cluster 34 cluster: Short SMA=92, Long SMA=166, Sharpe=-0.2111, Trades=16
[INFO] Cluster 35 cluster: Short SMA=122, Long SMA=280, Sharpe=0.1766, Trades=13
[INFO] Cluster 39 cluster: Short SMA=200, Long SMA=202, Sharpe=0.2470, Trades=82
[INFO] Cluster 40 cluster: Short SMA=192, Long SMA=220, Sharpe=0.3821, Trades=20
[INFO] Cluster 41 cluster: Short SMA=26, Long SMA=134, Sharpe=-0.1883, Trades=32
[INFO] Cluster 42 cluster: Short SMA=144, Long SMA=152, Sharpe=-0.2437, Trades=44
[INFO] Cluster 43 cluster: Short SMA=210, Long SMA=268, Sharpe=-0.0089, Trades=11
[INFO] Cluster 44 cluster: Short SMA=16, Long SMA=74, Sharpe=0.2423, Trades=46
[INFO] Cluster 45 cluster: Short SMA=198, Long SMA=246, Sharpe=0.2329, Trades=16
[INFO] Cluster 46 cluster: Short SMA=78, Long SMA=230, Sharpe=-0.2315, Trades=12
[INFO] Cluster 47 cluster: Short SMA=108, Long SMA=118, Sharpe=-0.0252, Trades=42
[INFO] Cluster 48 cluster: Short SMA=66, Long SMA=288, Sharpe=-0.0359, Trades=15
[INFO] Cluster 49 cluster: Short SMA=114, Long SMA=244, Sharpe=0.0680, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=160, Long SMA=262, Sharpe=0.6075, Trades=11
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=170, Long SMA=242, Sharpe=0.4285, Trades=12
[INFO] Top 2: Short SMA=198, Long SMA=208, Sharpe=0.4023, Trades=38
[INFO] Top 3: Short SMA=192, Long SMA=220, Sharpe=0.3821, Trades=20
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10213 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 160, Long SMA: 262
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(170/242) - Original Sharpe: 0.4285, Trades: 12
[INFO] Hierarchical cluster 2: SMA(198/208) - Original Sharpe: 0.4023, Trades: 38
[INFO] Hierarchical cluster 3: SMA(192/220) - Original Sharpe: 0.3821, Trades: 20
[INFO] Hierarchical cluster 4: SMA(154/272) - Original Sharpe: 0.2975, Trades: 11
[INFO] Hierarchical cluster 5: SMA(200/202) - Original Sharpe: 0.2470, Trades: 82
[INFO] Trimmed warm-up period. Evaluation data length: 2794
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (160/262)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (170/242) - Sharpe: 0.4285
[INFO] cluster 2: (198/208) - Sharpe: 0.4023
[INFO] cluster 3: (192/220) - Sharpe: 0.3821
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Out-of-sample period starts on: 2021-09-20
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-20 2021-09-20            45     1.874942            1.874942
1    2021-11-20 2021-11-20            41    -1.542081           -1.542081
2    2022-01-20 2022-01-20            42    -2.017855           -2.969025
3    2022-03-20 2022-03-20            42     1.424244            1.175750
4    2022-05-20 2022-05-20            43     0.980542            0.980542
5    2022-07-20 2022-07-20            44     1.402100            1.402100
6    2022-09-20 2022-09-20            44    -3.031215           -3.031215
7    2022-11-20 2022-11-20            43    -1.359366           -1.122281
8    2023-01-20 2023-01-20            41    -2.575891           -1.378293
9    2023-03-20 2023-03-20            42     4.502487            3.451302
10   2023-05-20 2023-05-20            43    -0.783470           -0.783470
11   2023-07-20 2023-07-20            44    -1.705868           -1.705868
12   2023-09-20 2023-09-20            43     0.424324            0.424324
13   2023-11-20 2023-11-20            42     2.238515            1.444379
14   2024-01-20 2024-01-20            42     1.404552           -3.653111
15   2024-03-20 2024-03-20            40     1.567381           -0.488950
16   2024-05-20 2024-05-20            45    -1.796289           -1.796289
17   2024-07-20 2024-07-20            44     0.668910            0.668910
18   2024-09-20 2024-09-20            43     0.376154            0.376154
19   2024-11-20 2024-11-20            26     2.631388            2.631388
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-20   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-20   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-01-20   |         -2.0 |             -3.0 |         -1.0 | False         
[INFO] 2022-03-20   |          1.4 |              1.2 |         -0.2 | False         
[INFO] 2022-05-20   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-07-20   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-09-20   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-11-20   |         -1.4 |             -1.1 |          0.3 | True          
[INFO] 2023-01-20   |         -2.6 |             -1.4 |          1.2 | True          
[INFO] 2023-03-20   |          4.5 |              3.5 |         -1.0 | False         
[INFO] 2023-05-20   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-07-20   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2023-11-20   |          2.2 |              1.4 |         -0.8 | False         
[INFO] 2024-01-20   |          1.4 |             -3.7 |         -5.1 | False         
[INFO] 2024-03-20   |          1.6 |             -0.5 |         -2.1 | False         
[INFO] 2024-05-20   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 2024-07-20   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-20   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-20, 2021-11-20, 2022-05-20, 2022-07-20, 2022-09-20, 2023-05-20, 2023-07-20, 2023-09-20, 2024-05-20, 2024-07-20, 2024-09-20, 2024-11-20
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 8 periods (25.00% win rate)
[INFO] Updating Excel file with Hierarchical results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Hierarchical win rate 25.0% in row 17
[INFO] Added best Sharpe parameters 160/262 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 160, Long SMA: 262
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(170/242) - Original Sharpe: 0.4285
[INFO] Added cluster 2 to portfolio: SMA(198/208) - Original Sharpe: 0.4023
[INFO] Added cluster 3 to portfolio: SMA(192/220) - Original Sharpe: 0.3821
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FDAX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3559
[INFO] Hierarchical Best out-of-sample Sharpe: -0.0286
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FDAX
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FESX in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.36s
[INFO] Best parameters: Short SMA = 106, Long SMA = 108
[INFO] Best Sharpe ratio: 0.401709, Trades: 83
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 717 bad combos; keeping 1923 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FESX
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 12.10 contracts
[INFO] Maximum Position Size: 27 contracts
[INFO] Strategy Total P&L: $187,176.00
[INFO] Market Buy & Hold P&L: $27,270.00
[INFO] Outperformance: $159,906.00
[INFO] Sharpe ratio (entire period, annualized): 0.239297
[INFO] Sharpe ratio (in-sample, annualized): 0.401709
[INFO] Sharpe ratio (out-of-sample, annualized): -0.147499
[INFO] Maximum Drawdown: $198,118.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 56
[INFO] Out-of-sample period trades: 27
[INFO] Total trades: 83
[INFO] In-sample P&L: $221,772.00
[INFO] Out-of-sample P&L: $-34,192.00
[INFO] 
Best parameters from GA: Short SMA = 106, Long SMA = 108, Sharpe = 0.401709
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9619 to 0.4017
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 108
[INFO] Sharpe Ratio: 0.401709
[INFO] Number of Trades: 83
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9868 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9619 to 0.4017
[INFO] Trades range: 10.0 to 337.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3348 to 2.8905
[INFO] Scaled Long SMA range: -2.7505 to 1.4945
[INFO] Scaled Sharpe ratio range: -5.5305 to 2.9544
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 248 elements
[INFO] Kmeans Cluster 1: 167 elements
[INFO] Kmeans Cluster 2: 207 elements
[INFO] Kmeans Cluster 3: 194 elements
[INFO] Kmeans Cluster 4: 207 elements
[INFO] Kmeans Cluster 5: 184 elements
[INFO] Kmeans Cluster 6: 320 elements
[INFO] Kmeans Cluster 7: 220 elements
[INFO] Kmeans Cluster 8: 193 elements
[INFO] Kmeans Cluster 9: 158 elements
[INFO] Kmeans Cluster 10: 123 elements
[INFO] Kmeans Cluster 11: 217 elements
[INFO] Kmeans Cluster 12: 83 elements
[INFO] Kmeans Cluster 13: 157 elements
[INFO] Kmeans Cluster 14: 194 elements
[INFO] Kmeans Cluster 15: 93 elements
[INFO] Kmeans Cluster 16: 184 elements
[INFO] Kmeans Cluster 17: 162 elements
[INFO] Kmeans Cluster 18: 130 elements
[INFO] Kmeans Cluster 19: 203 elements
[INFO] Kmeans Cluster 20: 246 elements
[INFO] Kmeans Cluster 21: 86 elements
[INFO] Kmeans Cluster 22: 323 elements
[INFO] Kmeans Cluster 23: 215 elements
[INFO] Kmeans Cluster 24: 178 elements
[INFO] Kmeans Cluster 25: 214 elements
[INFO] Kmeans Cluster 26: 189 elements
[INFO] Kmeans Cluster 27: 219 elements
[INFO] Kmeans Cluster 28: 245 elements
[INFO] Kmeans Cluster 29: 224 elements
[INFO] Kmeans Cluster 30: 135 elements
[INFO] Kmeans Cluster 31: 147 elements
[INFO] Kmeans Cluster 32: 98 elements
[INFO] Kmeans Cluster 33: 198 elements
[INFO] Kmeans Cluster 34: 159 elements
[INFO] Kmeans Cluster 35: 259 elements
[INFO] Kmeans Cluster 36: 236 elements
[INFO] Kmeans Cluster 37: 296 elements
[INFO] Kmeans Cluster 38: 216 elements
[INFO] Kmeans Cluster 39: 132 elements
[INFO] Kmeans Cluster 40: 191 elements
[INFO] Kmeans Cluster 41: 233 elements
[INFO] Kmeans Cluster 42: 333 elements
[INFO] Kmeans Cluster 43: 216 elements
[INFO] Kmeans Cluster 44: 249 elements
[INFO] Kmeans Cluster 45: 246 elements
[INFO] Kmeans Cluster 46: 212 elements
[INFO] Kmeans Cluster 47: 304 elements
[INFO] Kmeans Cluster 48: 108 elements
[INFO] Kmeans Cluster 49: 117 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=31.39, Long SMA=281.69, Sharpe=-0.2244
[INFO] Centroid 1: Short SMA=127.20, Long SMA=276.31, Sharpe=-0.0239
[INFO] Centroid 2: Short SMA=24.64, Long SMA=54.81, Sharpe=-0.2353
[INFO] Centroid 3: Short SMA=238.94, Long SMA=278.88, Sharpe=-0.0161
[INFO] Centroid 4: Short SMA=50.08, Long SMA=81.63, Sharpe=0.0065
[INFO] Centroid 5: Short SMA=150.20, Long SMA=167.18, Sharpe=-0.0520
[INFO] Centroid 6: Short SMA=145.96, Long SMA=241.30, Sharpe=0.0553
[INFO] Centroid 7: Short SMA=56.38, Long SMA=106.36, Sharpe=-0.1378
[INFO] Centroid 8: Short SMA=47.59, Long SMA=151.59, Sharpe=-0.0114
[INFO] Centroid 9: Short SMA=26.37, Long SMA=110.46, Sharpe=-0.2627
[INFO] Centroid 10: Short SMA=263.93, Long SMA=285.80, Sharpe=-0.2057
[INFO] Centroid 11: Short SMA=153.93, Long SMA=193.30, Sharpe=0.0742
[INFO] Centroid 12: Short SMA=34.02, Long SMA=109.95, Sharpe=-0.5767
[INFO] Centroid 13: Short SMA=123.44, Long SMA=221.87, Sharpe=0.2263
[INFO] Centroid 14: Short SMA=55.68, Long SMA=224.34, Sharpe=-0.0462
[INFO] Centroid 15: Short SMA=279.74, Long SMA=293.25, Sharpe=-0.4202
[INFO] Centroid 16: Short SMA=87.61, Long SMA=188.74, Sharpe=-0.3138
[INFO] Centroid 17: Short SMA=22.30, Long SMA=161.75, Sharpe=-0.2396
[INFO] Centroid 18: Short SMA=134.09, Long SMA=291.68, Sharpe=-0.1577
[INFO] Centroid 19: Short SMA=97.60, Long SMA=268.53, Sharpe=0.1794
[INFO] Centroid 20: Short SMA=154.22, Long SMA=219.23, Sharpe=-0.0468
[INFO] Centroid 21: Short SMA=98.98, Long SMA=121.40, Sharpe=0.1746
[INFO] Centroid 22: Short SMA=189.25, Long SMA=229.39, Sharpe=0.0804
[INFO] Centroid 23: Short SMA=24.07, Long SMA=222.29, Sharpe=-0.2179
[INFO] Centroid 24: Short SMA=39.87, Long SMA=193.72, Sharpe=0.0263
[INFO] Centroid 25: Short SMA=102.48, Long SMA=138.85, Sharpe=-0.0684
[INFO] Centroid 26: Short SMA=25.07, Long SMA=123.82, Sharpe=-0.3928
[INFO] Centroid 27: Short SMA=109.11, Long SMA=149.58, Sharpe=-0.1800
[INFO] Centroid 28: Short SMA=87.77, Long SMA=285.62, Sharpe=0.0638
[INFO] Centroid 29: Short SMA=80.02, Long SMA=221.59, Sharpe=-0.1210
[INFO] Centroid 30: Short SMA=15.17, Long SMA=272.65, Sharpe=-0.0765
[INFO] Centroid 31: Short SMA=77.71, Long SMA=101.93, Sharpe=-0.3108
[INFO] Centroid 32: Short SMA=21.00, Long SMA=50.82, Sharpe=-0.3993
[INFO] Centroid 33: Short SMA=24.51, Long SMA=189.45, Sharpe=-0.1110
[INFO] Centroid 34: Short SMA=86.86, Long SMA=124.77, Sharpe=0.0418
[INFO] Centroid 35: Short SMA=187.93, Long SMA=208.80, Sharpe=0.1747
[INFO] Centroid 36: Short SMA=60.56, Long SMA=255.19, Sharpe=-0.1784
[INFO] Centroid 37: Short SMA=128.30, Long SMA=169.39, Sharpe=0.0529
[INFO] Centroid 38: Short SMA=59.03, Long SMA=278.65, Sharpe=-0.0708
[INFO] Centroid 39: Short SMA=49.98, Long SMA=77.29, Sharpe=0.1406
[INFO] Centroid 40: Short SMA=27.20, Long SMA=63.70, Sharpe=-0.0989
[INFO] Centroid 41: Short SMA=108.39, Long SMA=206.20, Sharpe=-0.0104
[INFO] Centroid 42: Short SMA=69.53, Long SMA=164.62, Sharpe=-0.1245
[INFO] Centroid 43: Short SMA=32.15, Long SMA=247.04, Sharpe=-0.3009
[INFO] Centroid 44: Short SMA=107.65, Long SMA=249.14, Sharpe=0.1026
[INFO] Centroid 45: Short SMA=229.51, Long SMA=277.80, Sharpe=-0.1163
[INFO] Centroid 46: Short SMA=74.29, Long SMA=199.02, Sharpe=-0.2059
[INFO] Centroid 47: Short SMA=214.79, Long SMA=249.08, Sharpe=-0.0202
[INFO] Centroid 48: Short SMA=53.65, Long SMA=142.52, Sharpe=0.1412
[INFO] Centroid 49: Short SMA=245.37, Long SMA=264.41, Sharpe=0.0955
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=108, Sharpe=0.4017, Trades=83
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=122, Long SMA=220, Sharpe=0.3212, Trades=15
[INFO] Kmeans Top 2: Short SMA=100, Long SMA=120, Sharpe=0.2259, Trades=34
[INFO] Kmeans Top 3: Short SMA=54, Long SMA=138, Sharpe=0.2110, Trades=19
[INFO] Kmeans Top 4: Short SMA=106, Long SMA=250, Sharpe=0.1528, Trades=13
[INFO] Kmeans Top 5: Short SMA=248, Long SMA=264, Sharpe=0.1487, Trades=21
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (31, 282)
[INFO]   Nearest: (32.0, 282.0)
[INFO]   Rounded: (127, 276)
[INFO]   Nearest: (128.0, 276.0)
[INFO]   Rounded: (25, 55)
[INFO]   Nearest: (24.0, 54.0)
[INFO]   Rounded: (239, 279)
[INFO]   Nearest: (238.0, 278.0)
[INFO]   Rounded: (50, 82)
[INFO]   Rounded: (150, 167)
[INFO]   Nearest: (150.0, 168.0)
[INFO]   Rounded: (146, 241)
[INFO]   Nearest: (146.0, 242.0)
[INFO]   Rounded: (56, 106)
[INFO]   Rounded: (48, 152)
[INFO]   Rounded: (26, 110)
[INFO]   Rounded: (264, 286)
[INFO]   Rounded: (154, 193)
[INFO]   Nearest: (154.0, 194.0)
[INFO]   Rounded: (34, 110)
[INFO]   Rounded: (123, 222)
[INFO]   Nearest: (124.0, 222.0)
[INFO]   Rounded: (56, 224)
[INFO]   Rounded: (280, 293)
[INFO]   Nearest: (280.0, 294.0)
[INFO]   Rounded: (88, 189)
[INFO]   Nearest: (88.0, 188.0)
[INFO]   Rounded: (22, 162)
[INFO]   Rounded: (134, 292)
[INFO]   Rounded: (98, 269)
[INFO]   Nearest: (98.0, 268.0)
[INFO]   Rounded: (154, 219)
[INFO]   Nearest: (154.0, 220.0)
[INFO]   Rounded: (99, 121)
[INFO]   Nearest: (98.0, 122.0)
[INFO]   Rounded: (189, 229)
[INFO]   Nearest: (190.0, 230.0)
[INFO]   Rounded: (24, 222)
[INFO]   Rounded: (40, 194)
[INFO]   Rounded: (102, 139)
[INFO]   Nearest: (102.0, 138.0)
[INFO]   Rounded: (25, 124)
[INFO]   Nearest: (26.0, 124.0)
[INFO]   Rounded: (109, 150)
[INFO]   Nearest: (110.0, 150.0)
[INFO]   Rounded: (88, 286)
[INFO]   Rounded: (80, 222)
[INFO]   Rounded: (15, 273)
[INFO]   Nearest: (16.0, 272.0)
[INFO]   Rounded: (78, 102)
[INFO]   Rounded: (21, 51)
[INFO]   Nearest: (20.0, 50.0)
[INFO]   Rounded: (25, 189)
[INFO]   Nearest: (24.0, 190.0)
[INFO]   Rounded: (87, 125)
[INFO]   Nearest: (86.0, 124.0)
[INFO]   Rounded: (188, 209)
[INFO]   Nearest: (188.0, 208.0)
[INFO]   Rounded: (61, 255)
[INFO]   Nearest: (60.0, 256.0)
[INFO]   Rounded: (128, 169)
[INFO]   Nearest: (128.0, 170.0)
[INFO]   Rounded: (59, 279)
[INFO]   Nearest: (60.0, 278.0)
[INFO]   Rounded: (50, 77)
[INFO]   Nearest: (50.0, 78.0)
[INFO]   Rounded: (27, 64)
[INFO]   Nearest: (28.0, 64.0)
[INFO]   Rounded: (108, 206)
[INFO]   Rounded: (70, 165)
[INFO]   Nearest: (70.0, 164.0)
[INFO]   Rounded: (32, 247)
[INFO]   Nearest: (32.0, 248.0)
[INFO]   Rounded: (108, 249)
[INFO]   Nearest: (108.0, 250.0)
[INFO]   Rounded: (230, 278)
[INFO]   Rounded: (74, 199)
[INFO]   Nearest: (74.0, 200.0)
[INFO]   Rounded: (215, 249)
[INFO]   Nearest: (214.0, 250.0)
[INFO]   Rounded: (54, 143)
[INFO]   Nearest: (54.0, 142.0)
[INFO]   Rounded: (245, 264)
[INFO]   Nearest: (246.0, 264.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 108
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(122/220) - Original Sharpe: 0.3212, Trades: 15
[INFO] Kmeans cluster 2: SMA(100/120) - Original Sharpe: 0.2259, Trades: 34
[INFO] Kmeans cluster 3: SMA(54/138) - Original Sharpe: 0.2110, Trades: 19
[INFO] Kmeans cluster 4: SMA(106/250) - Original Sharpe: 0.1528, Trades: 13
[INFO] Kmeans cluster 5: SMA(248/264) - Original Sharpe: 0.1487, Trades: 21
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/108)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (122/220) - Sharpe: 0.3212
[INFO] cluster 2: (100/120) - Sharpe: 0.2259
[INFO] cluster 3: (54/138) - Sharpe: 0.2110
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.819258            1.819258
1    2021-11-16 2021-11-16            42    -0.990182           -1.393676
2    2022-01-16 2022-01-16            42    -3.234063           -3.391809
3    2022-03-16 2022-03-16            41     1.259415            0.795988
4    2022-05-16 2022-05-16            45     1.642319            1.642319
5    2022-07-16 2022-07-16            44     0.816637           -0.103327
6    2022-09-16 2022-09-16            43    -1.315674           -2.305190
7    2022-11-16 2022-11-16            42    -4.141997            0.622152
8    2023-01-16 2023-01-16            43    -0.549165           -0.772965
9    2023-03-16 2023-03-16            40     2.960185            2.960185
10   2023-05-16 2023-05-16            44     0.373260            0.373260
11   2023-07-16 2023-07-16            45    -1.929853           -1.162382
12   2023-09-16 2023-09-16            43    -1.339093           -3.833874
13   2023-11-16 2023-11-16            40    -1.599206           -1.447254
14   2024-01-16 2024-01-16            44     7.610619            2.443722
15   2024-03-16 2024-03-16            40     1.356364            1.356364
16   2024-05-16 2024-05-16            43    -1.239630           -1.239630
17   2024-07-16 2024-07-16            44    -2.440824           -2.419432
18   2024-09-16 2024-09-16            45     0.297766            0.309976
19   2024-11-16 2024-11-16            28    -0.195314           -1.788683
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-16   |         -1.0 |             -1.4 |         -0.4 | False         
[INFO] 2022-01-16   |         -3.2 |             -3.4 |         -0.2 | False         
[INFO] 2022-03-16   |          1.3 |              0.8 |         -0.5 | False         
[INFO] 2022-05-16   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2022-07-16   |          0.8 |             -0.1 |         -0.9 | False         
[INFO] 2022-09-16   |         -1.3 |             -2.3 |         -1.0 | False         
[INFO] 2022-11-16   |         -4.1 |              0.6 |          4.7 | True          
[INFO] 2023-01-16   |         -0.5 |             -0.8 |         -0.3 | False         
[INFO] 2023-03-16   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-05-16   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2023-07-16   |         -1.9 |             -1.2 |          0.7 | True          
[INFO] 2023-09-16   |         -1.3 |             -3.8 |         -2.5 | False         
[INFO] 2023-11-16   |         -1.6 |             -1.4 |          0.2 | True          
[INFO] 2024-01-16   |          7.6 |              2.4 |         -5.2 | False         
[INFO] 2024-03-16   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2024-05-16   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2024-07-16   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2024-09-16   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-11-16   |         -0.2 |             -1.8 |         -1.6 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-05-16, 2023-03-16, 2023-05-16, 2024-03-16, 2024-05-16, 2024-07-16, 2024-09-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 3 of 12 periods (25.00% win rate)
[INFO] Updating Excel file with Kmeans results for FESX...
[INFO] Excel file updated successfully. Added FESX with Kmeans win rate 25.0% in row 18
[INFO] Added best Sharpe parameters 106/108 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 108
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(122/220) - Original Sharpe: 0.3212
[INFO] Added cluster 2 to portfolio: SMA(100/120) - Original Sharpe: 0.2259
[INFO] Added cluster 3 to portfolio: SMA(54/138) - Original Sharpe: 0.2110
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FESX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3790
[INFO] Kmeans Best out-of-sample Sharpe: -0.1475
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FESX...
[INFO] Excel file updated successfully. Added FESX with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FESX
[INFO] Big Point Value: 10.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9619 to 0.4017
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 108
[INFO] Sharpe Ratio: 0.401709
[INFO] Number of Trades: 83
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9868 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9619 to 0.4017
[INFO] Trades range: 10.0 to 337.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3348 to 2.8905
[INFO] Scaled Long SMA range: -2.7505 to 1.4945
[INFO] Scaled Sharpe ratio range: -5.5305 to 2.9544
[INFO] Scaled Trades range: -0.6994 to 15.5517
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9868 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4669
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 87 elements
[INFO] Cluster 1: 464 elements
[INFO] Cluster 2: 266 elements
[INFO] Cluster 3: 334 elements
[INFO] Cluster 4: 134 elements
[INFO] Cluster 5: 265 elements
[INFO] Cluster 6: 200 elements
[INFO] Cluster 7: 258 elements
[INFO] Cluster 8: 341 elements
[INFO] Cluster 9: 310 elements
[INFO] Cluster 10: 7 elements
[INFO] Cluster 11: 102 elements
[INFO] Cluster 12: 192 elements
[INFO] Cluster 13: 303 elements
[INFO] Cluster 14: 315 elements
[INFO] Cluster 15: 358 elements
[INFO] Cluster 16: 147 elements
[INFO] Cluster 17: 22 elements
[INFO] Cluster 18: 81 elements
[INFO] Cluster 19: 427 elements
[INFO] Cluster 20: 370 elements
[INFO] Cluster 21: 291 elements
[INFO] Cluster 22: 240 elements
[INFO] Cluster 23: 32 elements
[INFO] Cluster 24: 224 elements
[INFO] Cluster 25: 231 elements
[INFO] Cluster 26: 196 elements
[INFO] Cluster 27: 172 elements
[INFO] Cluster 28: 362 elements
[INFO] Cluster 29: 11 elements
[INFO] Cluster 30: 20 elements
[INFO] Cluster 31: 267 elements
[INFO] Cluster 32: 28 elements
[INFO] Cluster 33: 424 elements
[INFO] Cluster 34: 330 elements
[INFO] Cluster 35: 203 elements
[INFO] Cluster 36: 38 elements
[INFO] Cluster 37: 30 elements
[INFO] Cluster 38: 138 elements
[INFO] Cluster 39: 182 elements
[INFO] Cluster 40: 96 elements
[INFO] Cluster 41: 362 elements
[INFO] Cluster 42: 133 elements
[INFO] Cluster 43: 17 elements
[INFO] Cluster 44: 199 elements
[INFO] Cluster 45: 210 elements
[INFO] Cluster 46: 68 elements
[INFO] Cluster 47: 160 elements
[INFO] Cluster 48: 155 elements
[INFO] Cluster 49: 66 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=30, Long SMA=38, Sharpe=-0.0703, Trades=107
[INFO] Cluster 1 cluster: Short SMA=60, Long SMA=260, Sharpe=-0.0856, Trades=18
[INFO] Cluster 2 cluster: Short SMA=26, Long SMA=118, Sharpe=-0.3628, Trades=33
[INFO] Cluster 3 cluster: Short SMA=242, Long SMA=286, Sharpe=-0.1203, Trades=13
[INFO] Cluster 4 cluster: Short SMA=120, Long SMA=128, Sharpe=-0.0926, Trades=41
[INFO] Cluster 5 cluster: Short SMA=90, Long SMA=126, Sharpe=-0.0093, Trades=28
[INFO] Cluster 6 cluster: Short SMA=52, Long SMA=86, Sharpe=0.0922, Trades=33
[INFO] Cluster 7 cluster: Short SMA=244, Long SMA=274, Sharpe=-0.0248, Trades=15
[INFO] Cluster 8 cluster: Short SMA=178, Long SMA=234, Sharpe=0.0757, Trades=14
[INFO] Cluster 9 cluster: Short SMA=46, Long SMA=118, Sharpe=-0.1857, Trades=27
[INFO] Cluster 11 cluster: Short SMA=282, Long SMA=292, Sharpe=-0.3850, Trades=21
[INFO] Cluster 12 cluster: Short SMA=14, Long SMA=266, Sharpe=-0.1659, Trades=29
[INFO] Cluster 13 cluster: Short SMA=46, Long SMA=158, Sharpe=0.0543, Trades=15
[INFO] Cluster 14 cluster: Short SMA=42, Long SMA=278, Sharpe=-0.2141, Trades=20
[INFO] Cluster 15 cluster: Short SMA=70, Long SMA=206, Sharpe=-0.1862, Trades=17
[INFO] Cluster 16 cluster: Short SMA=26, Long SMA=58, Sharpe=-0.2450, Trades=61
[INFO] Cluster 17 cluster: Short SMA=22, Long SMA=26, Sharpe=-0.2488, Trades=159
[INFO] Cluster 18 cluster: Short SMA=28, Long SMA=130, Sharpe=-0.5856, Trades=33
[INFO] Cluster 19 cluster: Short SMA=138, Long SMA=246, Sharpe=0.0885, Trades=11
[INFO] Cluster 20 cluster: Short SMA=186, Long SMA=212, Sharpe=0.1425, Trades=19
[INFO] Cluster 21 cluster: Short SMA=70, Long SMA=162, Sharpe=-0.1410, Trades=15
[INFO] Cluster 22 cluster: Short SMA=118, Long SMA=230, Sharpe=0.2020, Trades=15
[INFO] Cluster 23 cluster: Short SMA=238, Long SMA=240, Sharpe=-0.0059, Trades=44
[INFO] Cluster 24 cluster: Short SMA=22, Long SMA=182, Sharpe=-0.1315, Trades=23
[INFO] Cluster 25 cluster: Short SMA=150, Long SMA=168, Sharpe=-0.0126, Trades=25
[INFO] Cluster 26 cluster: Short SMA=106, Long SMA=206, Sharpe=-0.0550, Trades=15
[INFO] Cluster 27 cluster: Short SMA=60, Long SMA=100, Sharpe=-0.0716, Trades=31
[INFO] Cluster 28 cluster: Short SMA=126, Long SMA=180, Sharpe=0.1708, Trades=15
[INFO] Cluster 30 cluster: Short SMA=56, Long SMA=62, Sharpe=0.1677, Trades=87
[INFO] Cluster 31 cluster: Short SMA=48, Long SMA=212, Sharpe=-0.0258, Trades=17
[INFO] Cluster 32 cluster: Short SMA=186, Long SMA=188, Sharpe=0.0472, Trades=71
[INFO] Cluster 33 cluster: Short SMA=100, Long SMA=266, Sharpe=0.1042, Trades=13
[INFO] Cluster 34 cluster: Short SMA=32, Long SMA=244, Sharpe=-0.2771, Trades=19
[INFO] Cluster 35 cluster: Short SMA=130, Long SMA=290, Sharpe=-0.0624, Trades=11
[INFO] Cluster 36 cluster: Short SMA=48, Long SMA=54, Sharpe=-0.3712, Trades=95
[INFO] Cluster 37 cluster: Short SMA=138, Long SMA=140, Sharpe=-0.0902, Trades=81
[INFO] Cluster 38 cluster: Short SMA=20, Long SMA=86, Sharpe=-0.3242, Trades=44
[INFO] Cluster 39 cluster: Short SMA=110, Long SMA=144, Sharpe=-0.1190, Trades=21
[INFO] Cluster 40 cluster: Short SMA=14, Long SMA=86, Sharpe=-0.0376, Trades=48
[INFO] Cluster 41 cluster: Short SMA=214, Long SMA=254, Sharpe=0.0071, Trades=14
[INFO] Cluster 42 cluster: Short SMA=16, Long SMA=210, Sharpe=-0.2610, Trades=29
[INFO] Cluster 44 cluster: Short SMA=156, Long SMA=214, Sharpe=0.0017, Trades=15
[INFO] Cluster 45 cluster: Short SMA=96, Long SMA=162, Sharpe=-0.2428, Trades=15
[INFO] Cluster 46 cluster: Short SMA=56, Long SMA=68, Sharpe=-0.0360, Trades=65
[INFO] Cluster 47 cluster: Short SMA=86, Long SMA=192, Sharpe=-0.3954, Trades=15
[INFO] Cluster 48 cluster: Short SMA=78, Long SMA=288, Sharpe=0.0036, Trades=15
[INFO] Cluster 49 cluster: Short SMA=24, Long SMA=44, Sharpe=-0.3298, Trades=83
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=108, Sharpe=0.4017, Trades=83
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=118, Long SMA=230, Sharpe=0.2020, Trades=15
[INFO] Top 2: Short SMA=126, Long SMA=180, Sharpe=0.1708, Trades=15
[INFO] Top 3: Short SMA=56, Long SMA=62, Sharpe=0.1677, Trades=87
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 9833 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 108
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(118/230) - Original Sharpe: 0.2020, Trades: 15
[INFO] Hierarchical cluster 2: SMA(126/180) - Original Sharpe: 0.1708, Trades: 15
[INFO] Hierarchical cluster 3: SMA(56/62) - Original Sharpe: 0.1677, Trades: 87
[INFO] Hierarchical cluster 4: SMA(186/212) - Original Sharpe: 0.1425, Trades: 19
[INFO] Hierarchical cluster 5: SMA(100/266) - Original Sharpe: 0.1042, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/108)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (118/230) - Sharpe: 0.2020
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.819258            1.819258
1    2021-11-16 2021-11-16            42    -0.990182           -1.393676
2    2022-01-16 2022-01-16            42    -3.234063           -3.234063
3    2022-03-16 2022-03-16            41     1.259415            0.819373
4    2022-05-16 2022-05-16            45     1.642319            1.642319
5    2022-07-16 2022-07-16            44     0.816637           -0.103327
6    2022-09-16 2022-09-16            43    -1.315674           -2.305190
7    2022-11-16 2022-11-16            42    -4.141997            2.722207
8    2023-01-16 2023-01-16            43    -0.549165           -0.875610
9    2023-03-16 2023-03-16            40     2.960185            2.960185
10   2023-05-16 2023-05-16            44     0.373260            0.373260
11   2023-07-16 2023-07-16            45    -1.929853           -1.162382
12   2023-09-16 2023-09-16            43    -1.339093            0.025666
13   2023-11-16 2023-11-16            40    -1.599206            5.419019
14   2024-01-16 2024-01-16            44     7.610619           -0.483500
15   2024-03-16 2024-03-16            40     1.356364            1.356364
16   2024-05-16 2024-05-16            43    -1.239630           -1.239630
17   2024-07-16 2024-07-16            44    -2.440824           -1.421227
18   2024-09-16 2024-09-16            45     0.297766           -0.309976
19   2024-11-16 2024-11-16            28    -0.195314           -1.444204
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-16   |         -1.0 |             -1.4 |         -0.4 | False         
[INFO] 2022-01-16   |         -3.2 |             -3.2 |          0.0 | Excluded      
[INFO] 2022-03-16   |          1.3 |              0.8 |         -0.5 | False         
[INFO] 2022-05-16   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2022-07-16   |          0.8 |             -0.1 |         -0.9 | False         
[INFO] 2022-09-16   |         -1.3 |             -2.3 |         -1.0 | False         
[INFO] 2022-11-16   |         -4.1 |              2.7 |          6.8 | True          
[INFO] 2023-01-16   |         -0.5 |             -0.9 |         -0.4 | False         
[INFO] 2023-03-16   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-05-16   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2023-07-16   |         -1.9 |             -1.2 |          0.7 | True          
[INFO] 2023-09-16   |         -1.3 |              0.0 |          1.3 | True          
[INFO] 2023-11-16   |         -1.6 |              5.4 |          7.0 | True          
[INFO] 2024-01-16   |          7.6 |             -0.5 |         -8.1 | False         
[INFO] 2024-03-16   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2024-05-16   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2024-07-16   |         -2.4 |             -1.4 |          1.0 | True          
[INFO] 2024-09-16   |          0.3 |             -0.3 |         -0.6 | False         
[INFO] 2024-11-16   |         -0.2 |             -1.4 |         -1.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-01-16, 2022-05-16, 2023-03-16, 2023-05-16, 2024-03-16, 2024-05-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 13 periods (38.46% win rate)
[INFO] Updating Excel file with Hierarchical results for FESX...
[INFO] Excel file updated successfully. Added FESX with Hierarchical win rate 38.5% in row 18
[INFO] Added best Sharpe parameters 106/108 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 108
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(118/230) - Original Sharpe: 0.2020
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FESX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0102
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1475
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FESX...
[INFO] Excel file updated successfully. Added FESX with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FESX
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FGBL in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.82s
[INFO] Best parameters: Short SMA = 36, Long SMA = 62
[INFO] Best Sharpe ratio: 1.001266, Trades: 41
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 77 bad combos; keeping 2072 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FGBL
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.50 contracts
[INFO] Maximum Position Size: 13 contracts
[INFO] Strategy Total P&L: $427,442.00
[INFO] Market Buy & Hold P&L: $23,030.00
[INFO] Outperformance: $404,412.00
[INFO] Sharpe ratio (entire period, annualized): 0.670529
[INFO] Sharpe ratio (in-sample, annualized): 1.001266
[INFO] Sharpe ratio (out-of-sample, annualized): -0.101266
[INFO] Maximum Drawdown: $157,502.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 28
[INFO] Out-of-sample period trades: 13
[INFO] Total trades: 41
[INFO] In-sample P&L: $532,570.00
[INFO] Out-of-sample P&L: $-23,060.00
[INFO] 
Best parameters from GA: Short SMA = 36, Long SMA = 62, Sharpe = 1.001266
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.2062 to 1.0013
[INFO] 
Best parameters:
[INFO] Short SMA: 36
[INFO] Long SMA: 62
[INFO] Sharpe Ratio: 1.001266
[INFO] Number of Trades: 41
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10508 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.2062 to 1.0013
[INFO] Trades range: 10.0 to 294.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3925 to 2.8029
[INFO] Scaled Long SMA range: -2.7982 to 1.4140
[INFO] Scaled Sharpe ratio range: -3.6757 to 3.4265
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 235 elements
[INFO] Kmeans Cluster 1: 221 elements
[INFO] Kmeans Cluster 2: 239 elements
[INFO] Kmeans Cluster 3: 179 elements
[INFO] Kmeans Cluster 4: 153 elements
[INFO] Kmeans Cluster 5: 228 elements
[INFO] Kmeans Cluster 6: 254 elements
[INFO] Kmeans Cluster 7: 255 elements
[INFO] Kmeans Cluster 8: 232 elements
[INFO] Kmeans Cluster 9: 191 elements
[INFO] Kmeans Cluster 10: 184 elements
[INFO] Kmeans Cluster 11: 246 elements
[INFO] Kmeans Cluster 12: 234 elements
[INFO] Kmeans Cluster 13: 225 elements
[INFO] Kmeans Cluster 14: 114 elements
[INFO] Kmeans Cluster 15: 259 elements
[INFO] Kmeans Cluster 16: 125 elements
[INFO] Kmeans Cluster 17: 211 elements
[INFO] Kmeans Cluster 18: 260 elements
[INFO] Kmeans Cluster 19: 265 elements
[INFO] Kmeans Cluster 20: 235 elements
[INFO] Kmeans Cluster 21: 60 elements
[INFO] Kmeans Cluster 22: 82 elements
[INFO] Kmeans Cluster 23: 277 elements
[INFO] Kmeans Cluster 24: 207 elements
[INFO] Kmeans Cluster 25: 109 elements
[INFO] Kmeans Cluster 26: 138 elements
[INFO] Kmeans Cluster 27: 270 elements
[INFO] Kmeans Cluster 28: 242 elements
[INFO] Kmeans Cluster 29: 266 elements
[INFO] Kmeans Cluster 30: 102 elements
[INFO] Kmeans Cluster 31: 282 elements
[INFO] Kmeans Cluster 32: 175 elements
[INFO] Kmeans Cluster 33: 270 elements
[INFO] Kmeans Cluster 34: 136 elements
[INFO] Kmeans Cluster 35: 250 elements
[INFO] Kmeans Cluster 36: 75 elements
[INFO] Kmeans Cluster 37: 252 elements
[INFO] Kmeans Cluster 38: 340 elements
[INFO] Kmeans Cluster 39: 151 elements
[INFO] Kmeans Cluster 40: 205 elements
[INFO] Kmeans Cluster 41: 278 elements
[INFO] Kmeans Cluster 42: 147 elements
[INFO] Kmeans Cluster 43: 206 elements
[INFO] Kmeans Cluster 44: 213 elements
[INFO] Kmeans Cluster 45: 265 elements
[INFO] Kmeans Cluster 46: 264 elements
[INFO] Kmeans Cluster 47: 218 elements
[INFO] Kmeans Cluster 48: 250 elements
[INFO] Kmeans Cluster 49: 233 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=25.64, Long SMA=143.96, Sharpe=0.3754
[INFO] Centroid 1: Short SMA=146.02, Long SMA=276.91, Sharpe=0.5689
[INFO] Centroid 2: Short SMA=33.34, Long SMA=236.72, Sharpe=0.2460
[INFO] Centroid 3: Short SMA=35.43, Long SMA=68.04, Sharpe=0.6926
[INFO] Centroid 4: Short SMA=118.86, Long SMA=146.84, Sharpe=0.2750
[INFO] Centroid 5: Short SMA=139.24, Long SMA=170.30, Sharpe=0.5074
[INFO] Centroid 6: Short SMA=178.99, Long SMA=256.12, Sharpe=0.3185
[INFO] Centroid 7: Short SMA=258.52, Long SMA=288.82, Sharpe=0.4755
[INFO] Centroid 8: Short SMA=102.49, Long SMA=256.40, Sharpe=0.5159
[INFO] Centroid 9: Short SMA=24.12, Long SMA=232.67, Sharpe=0.1139
[INFO] Centroid 10: Short SMA=220.00, Long SMA=249.18, Sharpe=0.5218
[INFO] Centroid 11: Short SMA=90.29, Long SMA=123.19, Sharpe=0.1270
[INFO] Centroid 12: Short SMA=177.97, Long SMA=281.29, Sharpe=0.4381
[INFO] Centroid 13: Short SMA=136.28, Long SMA=216.28, Sharpe=0.5772
[INFO] Centroid 14: Short SMA=19.16, Long SMA=42.00, Sharpe=0.3881
[INFO] Centroid 15: Short SMA=65.24, Long SMA=105.94, Sharpe=0.3101
[INFO] Centroid 16: Short SMA=127.10, Long SMA=220.50, Sharpe=0.7157
[INFO] Centroid 17: Short SMA=85.10, Long SMA=211.52, Sharpe=0.3330
[INFO] Centroid 18: Short SMA=32.03, Long SMA=198.37, Sharpe=0.0495
[INFO] Centroid 19: Short SMA=38.40, Long SMA=260.02, Sharpe=0.3293
[INFO] Centroid 20: Short SMA=212.66, Long SMA=285.08, Sharpe=0.5516
[INFO] Centroid 21: Short SMA=240.70, Long SMA=265.03, Sharpe=0.7826
[INFO] Centroid 22: Short SMA=37.68, Long SMA=64.37, Sharpe=0.8401
[INFO] Centroid 23: Short SMA=127.41, Long SMA=259.47, Sharpe=0.6426
[INFO] Centroid 24: Short SMA=112.07, Long SMA=287.76, Sharpe=0.4295
[INFO] Centroid 25: Short SMA=97.85, Long SMA=118.48, Sharpe=-0.0074
[INFO] Centroid 26: Short SMA=63.91, Long SMA=85.61, Sharpe=0.4502
[INFO] Centroid 27: Short SMA=163.07, Long SMA=238.53, Sharpe=0.4437
[INFO] Centroid 28: Short SMA=40.82, Long SMA=164.37, Sharpe=0.2572
[INFO] Centroid 29: Short SMA=61.89, Long SMA=279.93, Sharpe=0.4412
[INFO] Centroid 30: Short SMA=227.94, Long SMA=248.51, Sharpe=0.4121
[INFO] Centroid 31: Short SMA=88.79, Long SMA=182.83, Sharpe=0.4687
[INFO] Centroid 32: Short SMA=159.55, Long SMA=178.15, Sharpe=0.6378
[INFO] Centroid 33: Short SMA=40.98, Long SMA=191.49, Sharpe=0.1602
[INFO] Centroid 34: Short SMA=25.54, Long SMA=132.07, Sharpe=0.5020
[INFO] Centroid 35: Short SMA=26.99, Long SMA=286.31, Sharpe=0.4095
[INFO] Centroid 36: Short SMA=21.07, Long SMA=33.44, Sharpe=0.1616
[INFO] Centroid 37: Short SMA=26.77, Long SMA=104.22, Sharpe=0.6639
[INFO] Centroid 38: Short SMA=74.04, Long SMA=236.72, Sharpe=0.4603
[INFO] Centroid 39: Short SMA=262.62, Long SMA=282.30, Sharpe=0.3518
[INFO] Centroid 40: Short SMA=29.77, Long SMA=69.58, Sharpe=0.5517
[INFO] Centroid 41: Short SMA=72.43, Long SMA=126.88, Sharpe=0.2244
[INFO] Centroid 42: Short SMA=154.48, Long SMA=190.71, Sharpe=0.3795
[INFO] Centroid 43: Short SMA=219.88, Long SMA=264.73, Sharpe=0.6481
[INFO] Centroid 44: Short SMA=198.16, Long SMA=224.82, Sharpe=0.4104
[INFO] Centroid 45: Short SMA=178.20, Long SMA=207.30, Sharpe=0.5116
[INFO] Centroid 46: Short SMA=69.87, Long SMA=159.61, Sharpe=0.3295
[INFO] Centroid 47: Short SMA=83.28, Long SMA=281.33, Sharpe=0.5710
[INFO] Centroid 48: Short SMA=114.90, Long SMA=164.78, Sharpe=0.3937
[INFO] Centroid 49: Short SMA=108.99, Long SMA=212.69, Sharpe=0.4242
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=36, Long SMA=62, Sharpe=1.0013, Trades=41
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=40, Long SMA=62, Sharpe=0.8639, Trades=47
[INFO] Kmeans Top 2: Short SMA=242, Long SMA=266, Sharpe=0.7978, Trades=24
[INFO] Kmeans Top 3: Short SMA=128, Long SMA=222, Sharpe=0.7394, Trades=15
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=68, Sharpe=0.7351, Trades=35
[INFO] Kmeans Top 5: Short SMA=142, Long SMA=218, Sharpe=0.6410, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (26, 144)
[INFO]   Rounded: (146, 277)
[INFO]   Nearest: (146.0, 276.0)
[INFO]   Rounded: (33, 237)
[INFO]   Nearest: (34.0, 236.0)
[INFO]   Rounded: (35, 68)
[INFO]   Nearest: (36.0, 68.0)
[INFO]   Rounded: (119, 147)
[INFO]   Nearest: (118.0, 146.0)
[INFO]   Rounded: (139, 170)
[INFO]   Nearest: (140.0, 170.0)
[INFO]   Rounded: (179, 256)
[INFO]   Nearest: (178.0, 256.0)
[INFO]   Rounded: (259, 289)
[INFO]   Nearest: (258.0, 288.0)
[INFO]   Rounded: (102, 256)
[INFO]   Rounded: (24, 233)
[INFO]   Nearest: (24.0, 232.0)
[INFO]   Rounded: (220, 249)
[INFO]   Nearest: (220.0, 250.0)
[INFO]   Rounded: (90, 123)
[INFO]   Nearest: (90.0, 124.0)
[INFO]   Rounded: (178, 281)
[INFO]   Nearest: (178.0, 282.0)
[INFO]   Rounded: (136, 216)
[INFO]   Rounded: (19, 42)
[INFO]   Nearest: (20.0, 42.0)
[INFO]   Rounded: (65, 106)
[INFO]   Nearest: (66.0, 106.0)
[INFO]   Rounded: (127, 220)
[INFO]   Nearest: (128.0, 220.0)
[INFO]   Rounded: (85, 212)
[INFO]   Nearest: (86.0, 212.0)
[INFO]   Rounded: (32, 198)
[INFO]   Rounded: (38, 260)
[INFO]   Rounded: (213, 285)
[INFO]   Nearest: (212.0, 286.0)
[INFO]   Rounded: (241, 265)
[INFO]   Nearest: (240.0, 266.0)
[INFO]   Rounded: (38, 64)
[INFO]   Rounded: (127, 259)
[INFO]   Nearest: (128.0, 260.0)
[INFO]   Rounded: (112, 288)
[INFO]   Rounded: (98, 118)
[INFO]   Rounded: (64, 86)
[INFO]   Rounded: (163, 239)
[INFO]   Nearest: (164.0, 238.0)
[INFO]   Rounded: (41, 164)
[INFO]   Nearest: (40.0, 164.0)
[INFO]   Rounded: (62, 280)
[INFO]   Rounded: (228, 249)
[INFO]   Nearest: (228.0, 248.0)
[INFO]   Rounded: (89, 183)
[INFO]   Nearest: (88.0, 182.0)
[INFO]   Rounded: (160, 178)
[INFO]   Rounded: (41, 191)
[INFO]   Nearest: (40.0, 192.0)
[INFO]   Rounded: (26, 132)
[INFO]   Rounded: (27, 286)
[INFO]   Nearest: (26.0, 286.0)
[INFO]   Rounded: (21, 33)
[INFO]   Nearest: (22.0, 34.0)
[INFO]   Rounded: (27, 104)
[INFO]   Nearest: (26.0, 104.0)
[INFO]   Rounded: (74, 237)
[INFO]   Nearest: (74.0, 236.0)
[INFO]   Rounded: (263, 282)
[INFO]   Nearest: (262.0, 282.0)
[INFO]   Rounded: (30, 70)
[INFO]   Rounded: (72, 127)
[INFO]   Nearest: (72.0, 126.0)
[INFO]   Rounded: (154, 191)
[INFO]   Nearest: (154.0, 190.0)
[INFO]   Rounded: (220, 265)
[INFO]   Nearest: (220.0, 264.0)
[INFO]   Rounded: (198, 225)
[INFO]   Nearest: (198.0, 224.0)
[INFO]   Rounded: (178, 207)
[INFO]   Nearest: (178.0, 208.0)
[INFO]   Rounded: (70, 160)
[INFO]   Rounded: (83, 281)
[INFO]   Nearest: (84.0, 282.0)
[INFO]   Rounded: (115, 165)
[INFO]   Nearest: (114.0, 164.0)
[INFO]   Rounded: (109, 213)
[INFO]   Nearest: (108.0, 212.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 36, Long SMA: 62
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(40/62) - Original Sharpe: 0.8639, Trades: 47
[INFO] Kmeans cluster 2: SMA(242/266) - Original Sharpe: 0.7978, Trades: 24
[INFO] Kmeans cluster 3: SMA(128/222) - Original Sharpe: 0.7394, Trades: 15
[INFO] Kmeans cluster 4: SMA(36/68) - Original Sharpe: 0.7351, Trades: 35
[INFO] Kmeans cluster 5: SMA(142/218) - Original Sharpe: 0.6410, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (36/62)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (40/62) - Sharpe: 0.8639
[INFO] cluster 2: (242/266) - Sharpe: 0.7978
[INFO] cluster 3: (128/222) - Sharpe: 0.7394
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -1.923691            0.029534
1    2021-11-16 2021-11-16            42    -5.059052           -4.801903
2    2022-01-16 2022-01-16            42     2.440556            1.154691
3    2022-03-16 2022-03-16            41     3.634012            3.634012
4    2022-05-16 2022-05-16            45     1.252348            1.252348
5    2022-07-16 2022-07-16            44    -7.003364            0.690466
6    2022-09-16 2022-09-16            43     0.563233            0.563323
7    2022-11-16 2022-11-16            42    -3.204331           -0.292595
8    2023-01-16 2023-01-16            43     0.674222            0.281723
9    2023-03-16 2023-03-16            40     2.331121            0.854847
10   2023-05-16 2023-05-16            44     0.759333            1.577194
11   2023-07-16 2023-07-16            45     1.110941            1.110941
12   2023-09-16 2023-09-16            43    -0.006381           -0.006381
13   2023-11-16 2023-11-16            40     1.543347           -3.719542
14   2024-01-16 2024-01-16            44    -1.381398            1.046526
15   2024-03-16 2024-03-16            40     0.255891           -0.308473
16   2024-05-16 2024-05-16            43     0.307612            0.307612
17   2024-07-16 2024-07-16            44     2.232450           -0.665211
18   2024-09-16 2024-09-16            45    -2.889253           -2.889130
19   2024-11-16 2024-11-16            28     0.360194            5.798059
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -1.9 |              0.0 |          1.9 | True          
[INFO] 2021-11-16   |         -5.1 |             -4.8 |          0.3 | True          
[INFO] 2022-01-16   |          2.4 |              1.2 |         -1.2 | False         
[INFO] 2022-03-16   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -7.0 |              0.7 |          7.7 | True          
[INFO] 2022-09-16   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-11-16   |         -3.2 |             -0.3 |          2.9 | True          
[INFO] 2023-01-16   |          0.7 |              0.3 |         -0.4 | False         
[INFO] 2023-03-16   |          2.3 |              0.9 |         -1.4 | False         
[INFO] 2023-05-16   |          0.8 |              1.6 |          0.8 | True          
[INFO] 2023-07-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-16   |          1.5 |             -3.7 |         -5.2 | False         
[INFO] 2024-01-16   |         -1.4 |              1.0 |          2.4 | True          
[INFO] 2024-03-16   |          0.3 |             -0.3 |         -0.6 | False         
[INFO] 2024-05-16   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-16   |          2.2 |             -0.7 |         -2.9 | False         
[INFO] 2024-09-16   |         -2.9 |             -2.9 |          0.0 | Excluded      
[INFO] 2024-11-16   |          0.4 |              5.8 |          5.4 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16, 2022-09-16, 2023-07-16, 2023-09-16, 2024-05-16, 2024-09-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 7 of 13 periods (53.85% win rate)
[INFO] Updating Excel file with Kmeans results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Kmeans win rate 53.8% in row 19
[INFO] Added best Sharpe parameters 36/62 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 36, Long SMA: 62
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(40/62) - Original Sharpe: 0.8639
[INFO] Added cluster 2 to portfolio: SMA(242/266) - Original Sharpe: 0.7978
[INFO] Added cluster 3 to portfolio: SMA(128/222) - Original Sharpe: 0.7394
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBL_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.4658
[INFO] Kmeans Best out-of-sample Sharpe: -0.1013
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBL
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.2062 to 1.0013
[INFO] 
Best parameters:
[INFO] Short SMA: 36
[INFO] Long SMA: 62
[INFO] Sharpe Ratio: 1.001266
[INFO] Number of Trades: 41
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10508 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.2062 to 1.0013
[INFO] Trades range: 10.0 to 294.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3925 to 2.8029
[INFO] Scaled Long SMA range: -2.7982 to 1.4140
[INFO] Scaled Sharpe ratio range: -3.6757 to 3.4265
[INFO] Scaled Trades range: -0.7803 to 14.9447
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10508 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5242
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 285 elements
[INFO] Cluster 1: 48 elements
[INFO] Cluster 2: 403 elements
[INFO] Cluster 3: 76 elements
[INFO] Cluster 4: 102 elements
[INFO] Cluster 5: 597 elements
[INFO] Cluster 6: 487 elements
[INFO] Cluster 7: 84 elements
[INFO] Cluster 8: 48 elements
[INFO] Cluster 9: 172 elements
[INFO] Cluster 10: 433 elements
[INFO] Cluster 11: 205 elements
[INFO] Cluster 12: 200 elements
[INFO] Cluster 13: 252 elements
[INFO] Cluster 14: 264 elements
[INFO] Cluster 15: 376 elements
[INFO] Cluster 16: 115 elements
[INFO] Cluster 17: 167 elements
[INFO] Cluster 18: 288 elements
[INFO] Cluster 19: 279 elements
[INFO] Cluster 20: 10 elements
[INFO] Cluster 21: 160 elements
[INFO] Cluster 22: 243 elements
[INFO] Cluster 23: 78 elements
[INFO] Cluster 24: 137 elements
[INFO] Cluster 25: 372 elements
[INFO] Cluster 26: 98 elements
[INFO] Cluster 27: 242 elements
[INFO] Cluster 28: 63 elements
[INFO] Cluster 29: 355 elements
[INFO] Cluster 30: 358 elements
[INFO] Cluster 31: 332 elements
[INFO] Cluster 32: 183 elements
[INFO] Cluster 33: 450 elements
[INFO] Cluster 34: 46 elements
[INFO] Cluster 35: 234 elements
[INFO] Cluster 36: 96 elements
[INFO] Cluster 37: 15 elements
[INFO] Cluster 38: 246 elements
[INFO] Cluster 39: 121 elements
[INFO] Cluster 40: 188 elements
[INFO] Cluster 41: 314 elements
[INFO] Cluster 42: 218 elements
[INFO] Cluster 43: 104 elements
[INFO] Cluster 44: 230 elements
[INFO] Cluster 45: 18 elements
[INFO] Cluster 46: 209 elements
[INFO] Cluster 47: 193 elements
[INFO] Cluster 48: 129 elements
[INFO] Cluster 49: 185 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=220, Long SMA=264, Sharpe=0.5665, Trades=18
[INFO] Cluster 1 cluster: Short SMA=78, Long SMA=80, Sharpe=0.2867, Trades=93
[INFO] Cluster 2 cluster: Short SMA=44, Long SMA=192, Sharpe=0.0826, Trades=20
[INFO] Cluster 3 cluster: Short SMA=214, Long SMA=216, Sharpe=0.3948, Trades=85
[INFO] Cluster 4 cluster: Short SMA=274, Long SMA=280, Sharpe=0.3537, Trades=37
[INFO] Cluster 5 cluster: Short SMA=80, Long SMA=240, Sharpe=0.4674, Trades=13
[INFO] Cluster 6 cluster: Short SMA=100, Long SMA=190, Sharpe=0.4336, Trades=15
[INFO] Cluster 7 cluster: Short SMA=16, Long SMA=36, Sharpe=0.2252, Trades=81
[INFO] Cluster 8 cluster: Short SMA=30, Long SMA=34, Sharpe=0.4317, Trades=127
[INFO] Cluster 9 cluster: Short SMA=164, Long SMA=176, Sharpe=0.6341, Trades=39
[INFO] Cluster 10 cluster: Short SMA=178, Long SMA=262, Sharpe=0.3565, Trades=12
[INFO] Cluster 11 cluster: Short SMA=64, Long SMA=108, Sharpe=0.2456, Trades=29
[INFO] Cluster 12 cluster: Short SMA=30, Long SMA=78, Sharpe=0.6545, Trades=37
[INFO] Cluster 13 cluster: Short SMA=158, Long SMA=272, Sharpe=0.4891, Trades=10
[INFO] Cluster 14 cluster: Short SMA=258, Long SMA=288, Sharpe=0.4410, Trades=18
[INFO] Cluster 15 cluster: Short SMA=214, Long SMA=274, Sharpe=0.4853, Trades=16
[INFO] Cluster 16 cluster: Short SMA=228, Long SMA=236, Sharpe=0.4796, Trades=45
[INFO] Cluster 17 cluster: Short SMA=30, Long SMA=82, Sharpe=0.6785, Trades=37
[INFO] Cluster 18 cluster: Short SMA=90, Long SMA=128, Sharpe=-0.0024, Trades=25
[INFO] Cluster 19 cluster: Short SMA=110, Long SMA=282, Sharpe=0.3838, Trades=13
[INFO] Cluster 21 cluster: Short SMA=176, Long SMA=194, Sharpe=0.5909, Trades=31
[INFO] Cluster 22 cluster: Short SMA=24, Long SMA=234, Sharpe=0.0212, Trades=25
[INFO] Cluster 23 cluster: Short SMA=10, Long SMA=236, Sharpe=0.3147, Trades=36
[INFO] Cluster 24 cluster: Short SMA=130, Long SMA=152, Sharpe=0.4025, Trades=31
[INFO] Cluster 25 cluster: Short SMA=102, Long SMA=166, Sharpe=0.3963, Trades=17
[INFO] Cluster 26 cluster: Short SMA=60, Long SMA=70, Sharpe=0.4044, Trades=53
[INFO] Cluster 27 cluster: Short SMA=22, Long SMA=138, Sharpe=0.4344, Trades=30
[INFO] Cluster 28 cluster: Short SMA=98, Long SMA=104, Sharpe=0.1350, Trades=58
[INFO] Cluster 29 cluster: Short SMA=162, Long SMA=226, Sharpe=0.4420, Trades=15
[INFO] Cluster 30 cluster: Short SMA=30, Long SMA=282, Sharpe=0.3182, Trades=19
[INFO] Cluster 31 cluster: Short SMA=126, Long SMA=242, Sharpe=0.6148, Trades=15
[INFO] Cluster 32 cluster: Short SMA=206, Long SMA=232, Sharpe=0.4454, Trades=23
[INFO] Cluster 33 cluster: Short SMA=48, Long SMA=158, Sharpe=0.2582, Trades=18
[INFO] Cluster 34 cluster: Short SMA=46, Long SMA=56, Sharpe=0.7064, Trades=67
[INFO] Cluster 35 cluster: Short SMA=88, Long SMA=280, Sharpe=0.6570, Trades=13
[INFO] Cluster 36 cluster: Short SMA=100, Long SMA=118, Sharpe=0.0966, Trades=37
[INFO] Cluster 38 cluster: Short SMA=96, Long SMA=210, Sharpe=0.3650, Trades=15
[INFO] Cluster 39 cluster: Short SMA=62, Long SMA=88, Sharpe=0.3362, Trades=33
[INFO] Cluster 40 cluster: Short SMA=162, Long SMA=208, Sharpe=0.4651, Trades=17
[INFO] Cluster 41 cluster: Short SMA=44, Long SMA=240, Sharpe=0.2690, Trades=20
[INFO] Cluster 42 cluster: Short SMA=72, Long SMA=134, Sharpe=0.2362, Trades=20
[INFO] Cluster 43 cluster: Short SMA=20, Long SMA=58, Sharpe=0.4759, Trades=53
[INFO] Cluster 44 cluster: Short SMA=58, Long SMA=288, Sharpe=0.4937, Trades=11
[INFO] Cluster 46 cluster: Short SMA=138, Long SMA=280, Sharpe=0.6690, Trades=13
[INFO] Cluster 47 cluster: Short SMA=28, Long SMA=112, Sharpe=0.7305, Trades=27
[INFO] Cluster 48 cluster: Short SMA=16, Long SMA=194, Sharpe=0.0185, Trades=31
[INFO] Cluster 49 cluster: Short SMA=130, Long SMA=198, Sharpe=0.5390, Trades=15
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=36, Long SMA=62, Sharpe=1.0013, Trades=41
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=28, Long SMA=112, Sharpe=0.7305, Trades=27
[INFO] Top 2: Short SMA=46, Long SMA=56, Sharpe=0.7064, Trades=67
[INFO] Top 3: Short SMA=30, Long SMA=82, Sharpe=0.6785, Trades=37
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10465 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 36, Long SMA: 62
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(28/112) - Original Sharpe: 0.7305, Trades: 27
[INFO] Hierarchical cluster 2: SMA(46/56) - Original Sharpe: 0.7064, Trades: 67
[INFO] Hierarchical cluster 3: SMA(30/82) - Original Sharpe: 0.6785, Trades: 37
[INFO] Hierarchical cluster 4: SMA(138/280) - Original Sharpe: 0.6690, Trades: 13
[INFO] Hierarchical cluster 5: SMA(88/280) - Original Sharpe: 0.6570, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (36/62)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (28/112) - Sharpe: 0.7305
[INFO] cluster 2: (46/56) - Sharpe: 0.7064
[INFO] cluster 3: (30/82) - Sharpe: 0.6785
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -1.923691           -2.032207
1    2021-11-16 2021-11-16            42    -5.059052           -5.030328
2    2022-01-16 2022-01-16            42     2.440556            2.238433
3    2022-03-16 2022-03-16            41     3.634012            3.634012
4    2022-05-16 2022-05-16            45     1.252348            1.252348
5    2022-07-16 2022-07-16            44    -7.003364           -5.946865
6    2022-09-16 2022-09-16            43     0.563233            0.485647
7    2022-11-16 2022-11-16            42    -3.204331           -0.256095
8    2023-01-16 2023-01-16            43     0.674222            2.261096
9    2023-03-16 2023-03-16            40     2.331121            2.038604
10   2023-05-16 2023-05-16            44     0.759333           -2.464239
11   2023-07-16 2023-07-16            45     1.110941            1.110941
12   2023-09-16 2023-09-16            43    -0.006381           -0.006381
13   2023-11-16 2023-11-16            40     1.543347           -0.515934
14   2024-01-16 2024-01-16            44    -1.381398           -2.176824
15   2024-03-16 2024-03-16            40     0.255891            0.255891
16   2024-05-16 2024-05-16            43     0.307612            0.733773
17   2024-07-16 2024-07-16            44     2.232450            0.931064
18   2024-09-16 2024-09-16            45    -2.889253           -1.664865
19   2024-11-16 2024-11-16            28     0.360194            0.360194
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -1.9 |             -2.0 |         -0.1 | False         
[INFO] 2021-11-16   |         -5.1 |             -5.0 |          0.1 | True          
[INFO] 2022-01-16   |          2.4 |              2.2 |         -0.2 | False         
[INFO] 2022-03-16   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -7.0 |             -5.9 |          1.1 | True          
[INFO] 2022-09-16   |          0.6 |              0.5 |         -0.1 | False         
[INFO] 2022-11-16   |         -3.2 |             -0.3 |          2.9 | True          
[INFO] 2023-01-16   |          0.7 |              2.3 |          1.6 | True          
[INFO] 2023-03-16   |          2.3 |              2.0 |         -0.3 | False         
[INFO] 2023-05-16   |          0.8 |             -2.5 |         -3.3 | False         
[INFO] 2023-07-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-16   |          1.5 |             -0.5 |         -2.0 | False         
[INFO] 2024-01-16   |         -1.4 |             -2.2 |         -0.8 | False         
[INFO] 2024-03-16   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-16   |          0.3 |              0.7 |          0.4 | True          
[INFO] 2024-07-16   |          2.2 |              0.9 |         -1.3 | False         
[INFO] 2024-09-16   |         -2.9 |             -1.7 |          1.2 | True          
[INFO] 2024-11-16   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16, 2023-07-16, 2023-09-16, 2024-03-16, 2024-11-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 14 periods (42.86% win rate)
[INFO] Updating Excel file with Hierarchical results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Hierarchical win rate 42.9% in row 19
[INFO] Added best Sharpe parameters 36/62 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 36, Long SMA: 62
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(28/112) - Original Sharpe: 0.7305
[INFO] Added cluster 2 to portfolio: SMA(46/56) - Original Sharpe: 0.7064
[INFO] Added cluster 3 to portfolio: SMA(30/82) - Original Sharpe: 0.6785
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBL_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1171
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1013
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBL
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FGBM in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.33s
[INFO] Best parameters: Short SMA = 222, Long SMA = 234
[INFO] Best Sharpe ratio: 1.126980, Trades: 33
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 328 bad combos; keeping 1885 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FGBM
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 22.84 contracts
[INFO] Maximum Position Size: 41 contracts
[INFO] Strategy Total P&L: $669,998.00
[INFO] Market Buy & Hold P&L: $3,260.00
[INFO] Outperformance: $666,738.00
[INFO] Sharpe ratio (entire period, annualized): 1.001723
[INFO] Sharpe ratio (in-sample, annualized): 1.126980
[INFO] Sharpe ratio (out-of-sample, annualized): 0.717761
[INFO] Maximum Drawdown: $90,124.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 21
[INFO] Out-of-sample period trades: 12
[INFO] Total trades: 33
[INFO] In-sample P&L: $582,388.00
[INFO] Out-of-sample P&L: $163,678.00
[INFO] 
Best parameters from GA: Short SMA = 222, Long SMA = 234, Sharpe = 1.126980
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] 
Best parameters:
[INFO] Short SMA: 222
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.126980
[INFO] Number of Trades: 33
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10257 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3726 to 2.8264
[INFO] Scaled Long SMA range: -2.7886 to 1.4556
[INFO] Scaled Sharpe ratio range: -4.6012 to 3.8231
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 207 elements
[INFO] Kmeans Cluster 1: 262 elements
[INFO] Kmeans Cluster 2: 218 elements
[INFO] Kmeans Cluster 3: 323 elements
[INFO] Kmeans Cluster 4: 133 elements
[INFO] Kmeans Cluster 5: 248 elements
[INFO] Kmeans Cluster 6: 115 elements
[INFO] Kmeans Cluster 7: 242 elements
[INFO] Kmeans Cluster 8: 266 elements
[INFO] Kmeans Cluster 9: 229 elements
[INFO] Kmeans Cluster 10: 208 elements
[INFO] Kmeans Cluster 11: 168 elements
[INFO] Kmeans Cluster 12: 222 elements
[INFO] Kmeans Cluster 13: 271 elements
[INFO] Kmeans Cluster 14: 178 elements
[INFO] Kmeans Cluster 15: 60 elements
[INFO] Kmeans Cluster 16: 135 elements
[INFO] Kmeans Cluster 17: 134 elements
[INFO] Kmeans Cluster 18: 280 elements
[INFO] Kmeans Cluster 19: 253 elements
[INFO] Kmeans Cluster 20: 96 elements
[INFO] Kmeans Cluster 21: 319 elements
[INFO] Kmeans Cluster 22: 216 elements
[INFO] Kmeans Cluster 23: 188 elements
[INFO] Kmeans Cluster 24: 253 elements
[INFO] Kmeans Cluster 25: 264 elements
[INFO] Kmeans Cluster 26: 251 elements
[INFO] Kmeans Cluster 27: 102 elements
[INFO] Kmeans Cluster 28: 157 elements
[INFO] Kmeans Cluster 29: 211 elements
[INFO] Kmeans Cluster 30: 262 elements
[INFO] Kmeans Cluster 31: 117 elements
[INFO] Kmeans Cluster 32: 180 elements
[INFO] Kmeans Cluster 33: 162 elements
[INFO] Kmeans Cluster 34: 337 elements
[INFO] Kmeans Cluster 35: 205 elements
[INFO] Kmeans Cluster 36: 163 elements
[INFO] Kmeans Cluster 37: 83 elements
[INFO] Kmeans Cluster 38: 250 elements
[INFO] Kmeans Cluster 39: 190 elements
[INFO] Kmeans Cluster 40: 210 elements
[INFO] Kmeans Cluster 41: 170 elements
[INFO] Kmeans Cluster 42: 162 elements
[INFO] Kmeans Cluster 43: 217 elements
[INFO] Kmeans Cluster 44: 263 elements
[INFO] Kmeans Cluster 45: 199 elements
[INFO] Kmeans Cluster 46: 298 elements
[INFO] Kmeans Cluster 47: 146 elements
[INFO] Kmeans Cluster 48: 221 elements
[INFO] Kmeans Cluster 49: 213 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=143.30, Long SMA=221.52, Sharpe=0.5778
[INFO] Centroid 1: Short SMA=43.39, Long SMA=129.51, Sharpe=0.2655
[INFO] Centroid 2: Short SMA=54.11, Long SMA=266.82, Sharpe=0.2254
[INFO] Centroid 3: Short SMA=68.01, Long SMA=220.33, Sharpe=0.4463
[INFO] Centroid 4: Short SMA=265.85, Long SMA=286.21, Sharpe=0.4059
[INFO] Centroid 5: Short SMA=203.39, Long SMA=264.30, Sharpe=0.7181
[INFO] Centroid 6: Short SMA=30.12, Long SMA=56.71, Sharpe=0.5546
[INFO] Centroid 7: Short SMA=90.39, Long SMA=188.48, Sharpe=0.3540
[INFO] Centroid 8: Short SMA=92.21, Long SMA=287.85, Sharpe=0.4473
[INFO] Centroid 9: Short SMA=102.17, Long SMA=141.62, Sharpe=0.1808
[INFO] Centroid 10: Short SMA=21.69, Long SMA=90.41, Sharpe=0.3962
[INFO] Centroid 11: Short SMA=68.17, Long SMA=103.25, Sharpe=0.0961
[INFO] Centroid 12: Short SMA=19.77, Long SMA=253.84, Sharpe=0.4747
[INFO] Centroid 13: Short SMA=28.44, Long SMA=190.01, Sharpe=0.2114
[INFO] Centroid 14: Short SMA=202.18, Long SMA=281.20, Sharpe=0.6031
[INFO] Centroid 15: Short SMA=85.33, Long SMA=109.50, Sharpe=-0.2648
[INFO] Centroid 16: Short SMA=20.87, Long SMA=51.05, Sharpe=0.2799
[INFO] Centroid 17: Short SMA=208.85, Long SMA=230.48, Sharpe=0.9322
[INFO] Centroid 18: Short SMA=95.66, Long SMA=251.94, Sharpe=0.5872
[INFO] Centroid 19: Short SMA=25.50, Long SMA=147.92, Sharpe=0.3705
[INFO] Centroid 20: Short SMA=247.81, Long SMA=282.15, Sharpe=0.2627
[INFO] Centroid 21: Short SMA=163.59, Long SMA=255.86, Sharpe=0.6253
[INFO] Centroid 22: Short SMA=24.47, Long SMA=222.55, Sharpe=0.3868
[INFO] Centroid 23: Short SMA=138.61, Long SMA=227.67, Sharpe=0.4700
[INFO] Centroid 24: Short SMA=138.88, Long SMA=170.78, Sharpe=0.4118
[INFO] Centroid 25: Short SMA=171.96, Long SMA=198.55, Sharpe=0.4792
[INFO] Centroid 26: Short SMA=71.03, Long SMA=169.54, Sharpe=0.2620
[INFO] Centroid 27: Short SMA=21.59, Long SMA=34.55, Sharpe=0.0676
[INFO] Centroid 28: Short SMA=90.80, Long SMA=119.31, Sharpe=-0.0673
[INFO] Centroid 29: Short SMA=129.87, Long SMA=272.14, Sharpe=0.3861
[INFO] Centroid 30: Short SMA=44.31, Long SMA=182.58, Sharpe=0.3242
[INFO] Centroid 31: Short SMA=234.03, Long SMA=252.22, Sharpe=0.6508
[INFO] Centroid 32: Short SMA=72.33, Long SMA=277.72, Sharpe=0.3189
[INFO] Centroid 33: Short SMA=63.65, Long SMA=83.84, Sharpe=0.2849
[INFO] Centroid 34: Short SMA=104.28, Long SMA=220.07, Sharpe=0.4260
[INFO] Centroid 35: Short SMA=137.49, Long SMA=198.19, Sharpe=0.3310
[INFO] Centroid 36: Short SMA=140.42, Long SMA=169.63, Sharpe=0.5350
[INFO] Centroid 37: Short SMA=278.77, Long SMA=293.04, Sharpe=0.5511
[INFO] Centroid 38: Short SMA=50.59, Long SMA=235.04, Sharpe=0.3186
[INFO] Centroid 39: Short SMA=182.43, Long SMA=216.51, Sharpe=0.6551
[INFO] Centroid 40: Short SMA=115.00, Long SMA=159.62, Sharpe=0.2699
[INFO] Centroid 41: Short SMA=237.64, Long SMA=285.86, Sharpe=0.3664
[INFO] Centroid 42: Short SMA=25.98, Long SMA=104.88, Sharpe=0.5351
[INFO] Centroid 43: Short SMA=49.80, Long SMA=73.27, Sharpe=0.4217
[INFO] Centroid 44: Short SMA=130.93, Long SMA=274.30, Sharpe=0.4819
[INFO] Centroid 45: Short SMA=97.83, Long SMA=135.76, Sharpe=0.0661
[INFO] Centroid 46: Short SMA=30.74, Long SMA=284.58, Sharpe=0.3554
[INFO] Centroid 47: Short SMA=238.37, Long SMA=261.42, Sharpe=0.4956
[INFO] Centroid 48: Short SMA=201.26, Long SMA=235.59, Sharpe=0.7978
[INFO] Centroid 49: Short SMA=50.54, Long SMA=138.55, Sharpe=0.1472
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=222, Long SMA=234, Sharpe=1.1270, Trades=33
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=208, Long SMA=230, Sharpe=1.0017, Trades=31
[INFO] Kmeans Top 2: Short SMA=200, Long SMA=238, Sharpe=0.7747, Trades=19
[INFO] Kmeans Top 3: Short SMA=234, Long SMA=252, Sharpe=0.6780, Trades=29
[INFO] Kmeans Top 4: Short SMA=204, Long SMA=264, Sharpe=0.6752, Trades=12
[INFO] Kmeans Top 5: Short SMA=32, Long SMA=56, Sharpe=0.6672, Trades=54
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (143, 222)
[INFO]   Nearest: (144.0, 222.0)
[INFO]   Rounded: (43, 130)
[INFO]   Nearest: (44.0, 130.0)
[INFO]   Rounded: (54, 267)
[INFO]   Nearest: (54.0, 266.0)
[INFO]   Rounded: (68, 220)
[INFO]   Rounded: (266, 286)
[INFO]   Rounded: (203, 264)
[INFO]   Nearest: (204.0, 264.0)
[INFO]   Rounded: (30, 57)
[INFO]   Nearest: (30.0, 56.0)
[INFO]   Rounded: (90, 188)
[INFO]   Rounded: (92, 288)
[INFO]   Rounded: (102, 142)
[INFO]   Rounded: (22, 90)
[INFO]   Rounded: (68, 103)
[INFO]   Nearest: (68.0, 104.0)
[INFO]   Rounded: (20, 254)
[INFO]   Rounded: (28, 190)
[INFO]   Rounded: (202, 281)
[INFO]   Nearest: (202.0, 282.0)
[INFO]   Rounded: (85, 110)
[INFO]   Nearest: (86.0, 110.0)
[INFO]   Rounded: (21, 51)
[INFO]   Nearest: (20.0, 52.0)
[INFO]   Rounded: (209, 230)
[INFO]   Nearest: (208.0, 230.0)
[INFO]   Rounded: (96, 252)
[INFO]   Rounded: (26, 148)
[INFO]   Rounded: (248, 282)
[INFO]   Rounded: (164, 256)
[INFO]   Rounded: (24, 223)
[INFO]   Nearest: (24.0, 222.0)
[INFO]   Rounded: (139, 228)
[INFO]   Nearest: (138.0, 228.0)
[INFO]   Rounded: (139, 171)
[INFO]   Nearest: (138.0, 170.0)
[INFO]   Rounded: (172, 199)
[INFO]   Nearest: (172.0, 198.0)
[INFO]   Rounded: (71, 170)
[INFO]   Nearest: (72.0, 170.0)
[INFO]   Rounded: (22, 35)
[INFO]   Nearest: (22.0, 34.0)
[INFO]   Rounded: (91, 119)
[INFO]   Nearest: (90.0, 120.0)
[INFO]   Rounded: (130, 272)
[INFO]   Rounded: (44, 183)
[INFO]   Nearest: (44.0, 182.0)
[INFO]   Rounded: (234, 252)
[INFO]   Rounded: (72, 278)
[INFO]   Rounded: (64, 84)
[INFO]   Rounded: (104, 220)
[INFO]   Rounded: (137, 198)
[INFO]   Nearest: (138.0, 198.0)
[INFO]   Rounded: (140, 170)
[INFO]   Rounded: (279, 293)
[INFO]   Nearest: (278.0, 294.0)
[INFO]   Rounded: (51, 235)
[INFO]   Nearest: (50.0, 236.0)
[INFO]   Rounded: (182, 217)
[INFO]   Nearest: (182.0, 216.0)
[INFO]   Rounded: (115, 160)
[INFO]   Nearest: (114.0, 160.0)
[INFO]   Rounded: (238, 286)
[INFO]   Rounded: (26, 105)
[INFO]   Nearest: (26.0, 104.0)
[INFO]   Rounded: (50, 73)
[INFO]   Nearest: (50.0, 74.0)
[INFO]   Rounded: (131, 274)
[INFO]   Nearest: (130.0, 274.0)
[INFO]   Rounded: (98, 136)
[INFO]   Rounded: (31, 285)
[INFO]   Nearest: (30.0, 284.0)
[INFO]   Rounded: (238, 261)
[INFO]   Nearest: (238.0, 262.0)
[INFO]   Rounded: (201, 236)
[INFO]   Nearest: (202.0, 236.0)
[INFO]   Rounded: (51, 139)
[INFO]   Nearest: (50.0, 138.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 222, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(208/230) - Original Sharpe: 1.0017, Trades: 31
[INFO] Kmeans cluster 2: SMA(200/238) - Original Sharpe: 0.7747, Trades: 19
[INFO] Kmeans cluster 3: SMA(234/252) - Original Sharpe: 0.6780, Trades: 29
[INFO] Kmeans cluster 4: SMA(204/264) - Original Sharpe: 0.6752, Trades: 12
[INFO] Kmeans cluster 5: SMA(32/56) - Original Sharpe: 0.6672, Trades: 54
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (222/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (208/230) - Sharpe: 1.0017
[INFO] cluster 2: (200/238) - Sharpe: 0.7747
[INFO] cluster 3: (234/252) - Sharpe: 0.6780
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.487748            1.487748
1    2021-11-16 2021-11-16            42     1.336541            0.549202
2    2022-01-16 2022-01-16            42     0.385142            0.164936
3    2022-03-16 2022-03-16            41     2.717615            2.453804
4    2022-05-16 2022-05-16            45     1.180567            1.180567
5    2022-07-16 2022-07-16            44     3.343289            3.343289
6    2022-09-16 2022-09-16            43     1.239321            1.239321
7    2022-11-16 2022-11-16            42     0.648774            0.648774
8    2023-01-16 2023-01-16            43     0.128552            0.128552
9    2023-03-16 2023-03-16            40    -0.229572           -0.229572
10   2023-05-16 2023-05-16            44     2.110030            2.110030
11   2023-07-16 2023-07-16            45     0.849981            0.849981
12   2023-09-16 2023-09-16            43    -0.445153           -0.445153
13   2023-11-16 2023-11-16            40    -3.244508           -4.596200
14   2024-01-16 2024-01-16            44     3.758682            0.546780
15   2024-03-16 2024-03-16            40     0.479300            0.639507
16   2024-05-16 2024-05-16            43    -0.511733           -1.294932
17   2024-07-16 2024-07-16            44    -0.791530            3.172012
18   2024-09-16 2024-09-16            45     0.783900            1.186372
19   2024-11-16 2024-11-16            28    -0.078821           -0.078821
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2021-11-16   |          1.3 |              0.5 |         -0.8 | False         
[INFO] 2022-01-16   |          0.4 |              0.2 |         -0.2 | False         
[INFO] 2022-03-16   |          2.7 |              2.5 |         -0.2 | False         
[INFO] 2022-05-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-16   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2022-09-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-11-16   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-01-16   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-03-16   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-05-16   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-07-16   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-11-16   |         -3.2 |             -4.6 |         -1.4 | False         
[INFO] 2024-01-16   |          3.8 |              0.5 |         -3.3 | False         
[INFO] 2024-03-16   |          0.5 |              0.6 |          0.1 | True          
[INFO] 2024-05-16   |         -0.5 |             -1.3 |         -0.8 | False         
[INFO] 2024-07-16   |         -0.8 |              3.2 |          4.0 | True          
[INFO] 2024-09-16   |          0.8 |              1.2 |          0.4 | True          
[INFO] 2024-11-16   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-05-16, 2022-07-16, 2022-09-16, 2022-11-16, 2023-01-16, 2023-03-16, 2023-05-16, 2023-07-16, 2023-09-16, 2024-11-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 3 of 9 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Kmeans win rate 33.3% in row 20
[INFO] Added best Sharpe parameters 222/234 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 222, Long SMA: 234
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(208/230) - Original Sharpe: 1.0017
[INFO] Added cluster 2 to portfolio: SMA(200/238) - Original Sharpe: 0.7747
[INFO] Added cluster 3 to portfolio: SMA(234/252) - Original Sharpe: 0.6780
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBM_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.6275
[INFO] Kmeans Best out-of-sample Sharpe: 0.7178
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBM
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] 
Best parameters:
[INFO] Short SMA: 222
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.126980
[INFO] Number of Trades: 33
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10257 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3726 to 2.8264
[INFO] Scaled Long SMA range: -2.7886 to 1.4556
[INFO] Scaled Sharpe ratio range: -4.6012 to 3.8231
[INFO] Scaled Trades range: -0.7504 to 15.6375
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10257 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5627
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 446 elements
[INFO] Cluster 1: 464 elements
[INFO] Cluster 2: 483 elements
[INFO] Cluster 3: 192 elements
[INFO] Cluster 4: 392 elements
[INFO] Cluster 5: 143 elements
[INFO] Cluster 6: 73 elements
[INFO] Cluster 7: 263 elements
[INFO] Cluster 8: 44 elements
[INFO] Cluster 9: 378 elements
[INFO] Cluster 10: 252 elements
[INFO] Cluster 11: 405 elements
[INFO] Cluster 12: 381 elements
[INFO] Cluster 13: 340 elements
[INFO] Cluster 14: 334 elements
[INFO] Cluster 15: 175 elements
[INFO] Cluster 16: 485 elements
[INFO] Cluster 17: 439 elements
[INFO] Cluster 18: 213 elements
[INFO] Cluster 19: 40 elements
[INFO] Cluster 20: 18 elements
[INFO] Cluster 21: 345 elements
[INFO] Cluster 22: 186 elements
[INFO] Cluster 23: 218 elements
[INFO] Cluster 24: 253 elements
[INFO] Cluster 25: 243 elements
[INFO] Cluster 26: 103 elements
[INFO] Cluster 27: 307 elements
[INFO] Cluster 28: 134 elements
[INFO] Cluster 29: 141 elements
[INFO] Cluster 30: 54 elements
[INFO] Cluster 31: 68 elements
[INFO] Cluster 32: 227 elements
[INFO] Cluster 33: 87 elements
[INFO] Cluster 34: 114 elements
[INFO] Cluster 35: 63 elements
[INFO] Cluster 36: 188 elements
[INFO] Cluster 37: 3 elements
[INFO] Cluster 38: 318 elements
[INFO] Cluster 39: 130 elements
[INFO] Cluster 40: 193 elements
[INFO] Cluster 41: 151 elements
[INFO] Cluster 42: 33 elements
[INFO] Cluster 43: 80 elements
[INFO] Cluster 44: 231 elements
[INFO] Cluster 45: 88 elements
[INFO] Cluster 46: 31 elements
[INFO] Cluster 47: 64 elements
[INFO] Cluster 48: 55 elements
[INFO] Cluster 49: 189 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=24, Long SMA=256, Sharpe=0.4577, Trades=20
[INFO] Cluster 1 cluster: Short SMA=50, Long SMA=280, Sharpe=0.2744, Trades=15
[INFO] Cluster 2 cluster: Short SMA=110, Long SMA=288, Sharpe=0.3957, Trades=13
[INFO] Cluster 3 cluster: Short SMA=266, Long SMA=280, Sharpe=0.4039, Trades=30
[INFO] Cluster 4 cluster: Short SMA=74, Long SMA=146, Sharpe=0.1265, Trades=20
[INFO] Cluster 5 cluster: Short SMA=30, Long SMA=60, Sharpe=0.5859, Trades=48
[INFO] Cluster 6 cluster: Short SMA=86, Long SMA=118, Sharpe=-0.1486, Trades=32
[INFO] Cluster 7 cluster: Short SMA=54, Long SMA=118, Sharpe=0.2167, Trades=25
[INFO] Cluster 8 cluster: Short SMA=44, Long SMA=46, Sharpe=0.4209, Trades=129
[INFO] Cluster 9 cluster: Short SMA=98, Long SMA=256, Sharpe=0.5319, Trades=13
[INFO] Cluster 10 cluster: Short SMA=52, Long SMA=246, Sharpe=0.2006, Trades=16
[INFO] Cluster 11 cluster: Short SMA=166, Long SMA=256, Sharpe=0.6342, Trades=13
[INFO] Cluster 12 cluster: Short SMA=124, Long SMA=198, Sharpe=0.4249, Trades=17
[INFO] Cluster 13 cluster: Short SMA=164, Long SMA=200, Sharpe=0.5560, Trades=21
[INFO] Cluster 14 cluster: Short SMA=204, Long SMA=260, Sharpe=0.7291, Trades=14
[INFO] Cluster 15 cluster: Short SMA=18, Long SMA=148, Sharpe=0.3811, Trades=32
[INFO] Cluster 16 cluster: Short SMA=76, Long SMA=182, Sharpe=0.3590, Trades=14
[INFO] Cluster 17 cluster: Short SMA=94, Long SMA=224, Sharpe=0.4534, Trades=13
[INFO] Cluster 18 cluster: Short SMA=16, Long SMA=94, Sharpe=0.3641, Trades=43
[INFO] Cluster 19 cluster: Short SMA=108, Long SMA=110, Sharpe=0.0911, Trades=90
[INFO] Cluster 21 cluster: Short SMA=42, Long SMA=158, Sharpe=0.2560, Trades=16
[INFO] Cluster 22 cluster: Short SMA=78, Long SMA=116, Sharpe=-0.0432, Trades=26
[INFO] Cluster 23 cluster: Short SMA=206, Long SMA=230, Sharpe=1.0178, Trades=29
[INFO] Cluster 24 cluster: Short SMA=34, Long SMA=194, Sharpe=0.1897, Trades=18
[INFO] Cluster 25 cluster: Short SMA=110, Long SMA=160, Sharpe=0.3123, Trades=19
[INFO] Cluster 26 cluster: Short SMA=144, Long SMA=156, Sharpe=0.3654, Trades=39
[INFO] Cluster 27 cluster: Short SMA=244, Long SMA=288, Sharpe=0.2866, Trades=14
[INFO] Cluster 28 cluster: Short SMA=28, Long SMA=102, Sharpe=0.5017, Trades=31
[INFO] Cluster 29 cluster: Short SMA=236, Long SMA=252, Sharpe=0.6488, Trades=29
[INFO] Cluster 30 cluster: Short SMA=266, Long SMA=270, Sharpe=0.2141, Trades=48
[INFO] Cluster 31 cluster: Short SMA=20, Long SMA=44, Sharpe=0.0163, Trades=67
[INFO] Cluster 32 cluster: Short SMA=138, Long SMA=250, Sharpe=0.3884, Trades=11
[INFO] Cluster 33 cluster: Short SMA=44, Long SMA=50, Sharpe=0.3473, Trades=81
[INFO] Cluster 34 cluster: Short SMA=110, Long SMA=124, Sharpe=0.1615, Trades=39
[INFO] Cluster 35 cluster: Short SMA=98, Long SMA=104, Sharpe=0.1197, Trades=57
[INFO] Cluster 36 cluster: Short SMA=204, Long SMA=282, Sharpe=0.6499, Trades=10
[INFO] Cluster 38 cluster: Short SMA=146, Long SMA=228, Sharpe=0.5392, Trades=13
[INFO] Cluster 39 cluster: Short SMA=62, Long SMA=84, Sharpe=0.3319, Trades=37
[INFO] Cluster 40 cluster: Short SMA=136, Long SMA=166, Sharpe=0.3265, Trades=25
[INFO] Cluster 41 cluster: Short SMA=24, Long SMA=210, Sharpe=0.3002, Trades=22
[INFO] Cluster 42 cluster: Short SMA=16, Long SMA=30, Sharpe=0.1297, Trades=98
[INFO] Cluster 43 cluster: Short SMA=214, Long SMA=218, Sharpe=0.8782, Trades=55
[INFO] Cluster 44 cluster: Short SMA=56, Long SMA=222, Sharpe=0.4733, Trades=14
[INFO] Cluster 45 cluster: Short SMA=50, Long SMA=66, Sharpe=0.3670, Trades=57
[INFO] Cluster 46 cluster: Short SMA=174, Long SMA=176, Sharpe=0.7194, Trades=107
[INFO] Cluster 47 cluster: Short SMA=164, Long SMA=170, Sharpe=0.3865, Trades=55
[INFO] Cluster 48 cluster: Short SMA=192, Long SMA=208, Sharpe=0.5675, Trades=34
[INFO] Cluster 49 cluster: Short SMA=42, Long SMA=86, Sharpe=0.4450, Trades=33
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=222, Long SMA=234, Sharpe=1.1270, Trades=33
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=206, Long SMA=230, Sharpe=1.0178, Trades=29
[INFO] Top 2: Short SMA=214, Long SMA=218, Sharpe=0.8782, Trades=55
[INFO] Top 3: Short SMA=204, Long SMA=260, Sharpe=0.7291, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10236 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 222, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(206/230) - Original Sharpe: 1.0178, Trades: 29
[INFO] Hierarchical cluster 2: SMA(214/218) - Original Sharpe: 0.8782, Trades: 55
[INFO] Hierarchical cluster 3: SMA(204/260) - Original Sharpe: 0.7291, Trades: 14
[INFO] Hierarchical cluster 4: SMA(174/176) - Original Sharpe: 0.7194, Trades: 107
[INFO] Hierarchical cluster 5: SMA(204/282) - Original Sharpe: 0.6499, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (222/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (206/230) - Sharpe: 1.0178
[INFO] cluster 2: (214/218) - Sharpe: 0.8782
[INFO] cluster 3: (204/260) - Sharpe: 0.7291
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.487748            1.487748
1    2021-11-16 2021-11-16            42     1.336541           -2.460190
2    2022-01-16 2022-01-16            42     0.385142            0.994781
3    2022-03-16 2022-03-16            41     2.717615            1.677018
4    2022-05-16 2022-05-16            45     1.180567            1.180567
5    2022-07-16 2022-07-16            44     3.343289            3.343289
6    2022-09-16 2022-09-16            43     1.239321            1.239321
7    2022-11-16 2022-11-16            42     0.648774            0.648774
8    2023-01-16 2023-01-16            43     0.128552            0.128552
9    2023-03-16 2023-03-16            40    -0.229572           -0.229572
10   2023-05-16 2023-05-16            44     2.110030            2.110030
11   2023-07-16 2023-07-16            45     0.849981            0.849981
12   2023-09-16 2023-09-16            43    -0.445153           -0.202107
13   2023-11-16 2023-11-16            40    -3.244508           -6.324060
14   2024-01-16 2024-01-16            44     3.758682            2.309361
15   2024-03-16 2024-03-16            40     0.479300            0.540060
16   2024-05-16 2024-05-16            43    -0.511733           -1.505887
17   2024-07-16 2024-07-16            44    -0.791530            3.771965
18   2024-09-16 2024-09-16            45     0.783900            1.623013
19   2024-11-16 2024-11-16            28    -0.078821           -0.078821
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2021-11-16   |          1.3 |             -2.5 |         -3.8 | False         
[INFO] 2022-01-16   |          0.4 |              1.0 |          0.6 | True          
[INFO] 2022-03-16   |          2.7 |              1.7 |         -1.0 | False         
[INFO] 2022-05-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-16   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2022-09-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-11-16   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-01-16   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-03-16   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-05-16   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-07-16   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.4 |             -0.2 |          0.2 | True          
[INFO] 2023-11-16   |         -3.2 |             -6.3 |         -3.1 | False         
[INFO] 2024-01-16   |          3.8 |              2.3 |         -1.5 | False         
[INFO] 2024-03-16   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2024-05-16   |         -0.5 |             -1.5 |         -1.0 | False         
[INFO] 2024-07-16   |         -0.8 |              3.8 |          4.6 | True          
[INFO] 2024-09-16   |          0.8 |              1.6 |          0.8 | True          
[INFO] 2024-11-16   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-05-16, 2022-07-16, 2022-09-16, 2022-11-16, 2023-01-16, 2023-03-16, 2023-05-16, 2023-07-16, 2024-03-16, 2024-11-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 9 periods (44.44% win rate)
[INFO] Updating Excel file with Hierarchical results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Hierarchical win rate 44.4% in row 20
[INFO] Added best Sharpe parameters 222/234 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 222, Long SMA: 234
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(206/230) - Original Sharpe: 1.0178
[INFO] Added cluster 2 to portfolio: SMA(214/218) - Original Sharpe: 0.8782
[INFO] Added cluster 3 to portfolio: SMA(204/260) - Original Sharpe: 0.7291
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBM_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.6846
[INFO] Hierarchical Best out-of-sample Sharpe: 0.7178
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBM
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FGBX in column D: 22.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.45s
[INFO] Best parameters: Short SMA = 50, Long SMA = 56
[INFO] Best Sharpe ratio: 1.001858, Trades: 82
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 3 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FGBX=105XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.64 contracts
[INFO] Maximum Position Size: 8 contracts
[INFO] Strategy Total P&L: $350,036.00
[INFO] Market Buy & Hold P&L: $24,200.00
[INFO] Outperformance: $325,836.00
[INFO] Sharpe ratio (entire period, annualized): 0.452533
[INFO] Sharpe ratio (in-sample, annualized): 1.001858
[INFO] Sharpe ratio (out-of-sample, annualized): -0.816874
[INFO] Maximum Drawdown: $268,780.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 56
[INFO] Out-of-sample period trades: 26
[INFO] Total trades: 82
[INFO] In-sample P&L: $585,486.00
[INFO] Out-of-sample P&L: $-206,288.00
[INFO] 
Best parameters from GA: Short SMA = 50, Long SMA = 56, Sharpe = 1.001858
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3871 to 1.0019
[INFO] 
Best parameters:
[INFO] Short SMA: 50
[INFO] Long SMA: 56
[INFO] Sharpe Ratio: 1.001858
[INFO] Number of Trades: 82
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10582 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3871 to 1.0019
[INFO] Trades range: 10.0 to 301.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3994 to 2.7993
[INFO] Scaled Long SMA range: -2.7994 to 1.4003
[INFO] Scaled Sharpe ratio range: -4.8665 to 4.5092
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 192 elements
[INFO] Kmeans Cluster 1: 253 elements
[INFO] Kmeans Cluster 2: 262 elements
[INFO] Kmeans Cluster 3: 273 elements
[INFO] Kmeans Cluster 4: 279 elements
[INFO] Kmeans Cluster 5: 101 elements
[INFO] Kmeans Cluster 6: 165 elements
[INFO] Kmeans Cluster 7: 220 elements
[INFO] Kmeans Cluster 8: 184 elements
[INFO] Kmeans Cluster 9: 236 elements
[INFO] Kmeans Cluster 10: 328 elements
[INFO] Kmeans Cluster 11: 224 elements
[INFO] Kmeans Cluster 12: 207 elements
[INFO] Kmeans Cluster 13: 181 elements
[INFO] Kmeans Cluster 14: 301 elements
[INFO] Kmeans Cluster 15: 269 elements
[INFO] Kmeans Cluster 16: 74 elements
[INFO] Kmeans Cluster 17: 186 elements
[INFO] Kmeans Cluster 18: 276 elements
[INFO] Kmeans Cluster 19: 182 elements
[INFO] Kmeans Cluster 20: 268 elements
[INFO] Kmeans Cluster 21: 160 elements
[INFO] Kmeans Cluster 22: 214 elements
[INFO] Kmeans Cluster 23: 148 elements
[INFO] Kmeans Cluster 24: 269 elements
[INFO] Kmeans Cluster 25: 339 elements
[INFO] Kmeans Cluster 26: 281 elements
[INFO] Kmeans Cluster 27: 228 elements
[INFO] Kmeans Cluster 28: 84 elements
[INFO] Kmeans Cluster 29: 236 elements
[INFO] Kmeans Cluster 30: 329 elements
[INFO] Kmeans Cluster 31: 202 elements
[INFO] Kmeans Cluster 32: 297 elements
[INFO] Kmeans Cluster 33: 139 elements
[INFO] Kmeans Cluster 34: 271 elements
[INFO] Kmeans Cluster 35: 105 elements
[INFO] Kmeans Cluster 36: 259 elements
[INFO] Kmeans Cluster 37: 195 elements
[INFO] Kmeans Cluster 38: 46 elements
[INFO] Kmeans Cluster 39: 90 elements
[INFO] Kmeans Cluster 40: 84 elements
[INFO] Kmeans Cluster 41: 229 elements
[INFO] Kmeans Cluster 42: 242 elements
[INFO] Kmeans Cluster 43: 163 elements
[INFO] Kmeans Cluster 44: 261 elements
[INFO] Kmeans Cluster 45: 203 elements
[INFO] Kmeans Cluster 46: 143 elements
[INFO] Kmeans Cluster 47: 108 elements
[INFO] Kmeans Cluster 48: 297 elements
[INFO] Kmeans Cluster 49: 299 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=26.35, Long SMA=115.85, Sharpe=0.3783
[INFO] Centroid 1: Short SMA=164.10, Long SMA=268.43, Sharpe=0.1842
[INFO] Centroid 2: Short SMA=71.10, Long SMA=222.66, Sharpe=0.4737
[INFO] Centroid 3: Short SMA=33.47, Long SMA=73.66, Sharpe=0.6003
[INFO] Centroid 4: Short SMA=113.06, Long SMA=221.08, Sharpe=0.3955
[INFO] Centroid 5: Short SMA=142.75, Long SMA=173.92, Sharpe=0.6763
[INFO] Centroid 6: Short SMA=85.24, Long SMA=122.34, Sharpe=0.0607
[INFO] Centroid 7: Short SMA=255.55, Long SMA=281.18, Sharpe=0.2146
[INFO] Centroid 8: Short SMA=64.53, Long SMA=92.25, Sharpe=0.3656
[INFO] Centroid 9: Short SMA=194.13, Long SMA=218.77, Sharpe=0.3223
[INFO] Centroid 10: Short SMA=105.28, Long SMA=249.89, Sharpe=0.2966
[INFO] Centroid 11: Short SMA=252.25, Long SMA=280.14, Sharpe=0.3227
[INFO] Centroid 12: Short SMA=170.80, Long SMA=201.39, Sharpe=0.4165
[INFO] Centroid 13: Short SMA=37.15, Long SMA=239.20, Sharpe=0.3012
[INFO] Centroid 14: Short SMA=31.61, Long SMA=134.96, Sharpe=0.2664
[INFO] Centroid 15: Short SMA=139.57, Long SMA=173.93, Sharpe=0.5588
[INFO] Centroid 16: Short SMA=20.19, Long SMA=31.65, Sharpe=0.0817
[INFO] Centroid 17: Short SMA=123.33, Long SMA=155.59, Sharpe=0.4237
[INFO] Centroid 18: Short SMA=139.59, Long SMA=245.57, Sharpe=0.3365
[INFO] Centroid 19: Short SMA=23.48, Long SMA=182.28, Sharpe=0.3494
[INFO] Centroid 20: Short SMA=68.27, Long SMA=261.21, Sharpe=0.4354
[INFO] Centroid 21: Short SMA=193.65, Long SMA=278.30, Sharpe=0.3269
[INFO] Centroid 22: Short SMA=65.39, Long SMA=284.34, Sharpe=0.3547
[INFO] Centroid 23: Short SMA=37.97, Long SMA=64.74, Sharpe=0.7416
[INFO] Centroid 24: Short SMA=36.49, Long SMA=83.78, Sharpe=0.4835
[INFO] Centroid 25: Short SMA=150.44, Long SMA=207.85, Sharpe=0.5107
[INFO] Centroid 26: Short SMA=47.26, Long SMA=152.43, Sharpe=0.1682
[INFO] Centroid 27: Short SMA=99.67, Long SMA=145.34, Sharpe=0.1927
[INFO] Centroid 28: Short SMA=37.05, Long SMA=267.57, Sharpe=0.1380
[INFO] Centroid 29: Short SMA=69.90, Long SMA=106.97, Sharpe=0.2191
[INFO] Centroid 30: Short SMA=32.07, Long SMA=221.01, Sharpe=0.3882
[INFO] Centroid 31: Short SMA=177.44, Long SMA=247.93, Sharpe=0.0956
[INFO] Centroid 32: Short SMA=121.40, Long SMA=280.61, Sharpe=0.3814
[INFO] Centroid 33: Short SMA=224.20, Long SMA=258.55, Sharpe=0.0157
[INFO] Centroid 34: Short SMA=79.31, Long SMA=180.14, Sharpe=0.3620
[INFO] Centroid 35: Short SMA=16.67, Long SMA=188.32, Sharpe=0.4846
[INFO] Centroid 36: Short SMA=98.19, Long SMA=187.31, Sharpe=0.4701
[INFO] Centroid 37: Short SMA=40.30, Long SMA=278.58, Sharpe=0.2398
[INFO] Centroid 38: Short SMA=285.74, Long SMA=295.65, Sharpe=-0.0102
[INFO] Centroid 39: Short SMA=15.24, Long SMA=282.73, Sharpe=0.4764
[INFO] Centroid 40: Short SMA=20.43, Long SMA=39.93, Sharpe=0.3087
[INFO] Centroid 41: Short SMA=194.79, Long SMA=226.05, Sharpe=0.2153
[INFO] Centroid 42: Short SMA=157.40, Long SMA=286.23, Sharpe=0.2690
[INFO] Centroid 43: Short SMA=20.21, Long SMA=267.28, Sharpe=0.3633
[INFO] Centroid 44: Short SMA=226.79, Long SMA=266.57, Sharpe=0.1220
[INFO] Centroid 45: Short SMA=205.55, Long SMA=277.91, Sharpe=0.2062
[INFO] Centroid 46: Short SMA=92.22, Long SMA=290.34, Sharpe=0.1970
[INFO] Centroid 47: Short SMA=80.76, Long SMA=233.78, Sharpe=0.5605
[INFO] Centroid 48: Short SMA=52.18, Long SMA=182.97, Sharpe=0.2624
[INFO] Centroid 49: Short SMA=99.99, Long SMA=138.05, Sharpe=0.3000
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=50, Long SMA=56, Sharpe=1.0019, Trades=82
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=34, Long SMA=62, Sharpe=0.6996, Trades=48
[INFO] Kmeans Top 2: Short SMA=144, Long SMA=174, Sharpe=0.6670, Trades=25
[INFO] Kmeans Top 3: Short SMA=34, Long SMA=74, Sharpe=0.6354, Trades=44
[INFO] Kmeans Top 4: Short SMA=82, Long SMA=234, Sharpe=0.6288, Trades=13
[INFO] Kmeans Top 5: Short SMA=140, Long SMA=174, Sharpe=0.5349, Trades=25
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (26, 116)
[INFO]   Rounded: (164, 268)
[INFO]   Rounded: (71, 223)
[INFO]   Nearest: (72.0, 222.0)
[INFO]   Rounded: (33, 74)
[INFO]   Nearest: (34.0, 74.0)
[INFO]   Rounded: (113, 221)
[INFO]   Nearest: (114.0, 222.0)
[INFO]   Rounded: (143, 174)
[INFO]   Nearest: (142.0, 174.0)
[INFO]   Rounded: (85, 122)
[INFO]   Nearest: (86.0, 122.0)
[INFO]   Rounded: (256, 281)
[INFO]   Nearest: (256.0, 282.0)
[INFO]   Rounded: (65, 92)
[INFO]   Nearest: (64.0, 92.0)
[INFO]   Rounded: (194, 219)
[INFO]   Nearest: (194.0, 218.0)
[INFO]   Rounded: (105, 250)
[INFO]   Nearest: (106.0, 250.0)
[INFO]   Rounded: (252, 280)
[INFO]   Rounded: (171, 201)
[INFO]   Nearest: (170.0, 202.0)
[INFO]   Rounded: (37, 239)
[INFO]   Nearest: (38.0, 240.0)
[INFO]   Rounded: (32, 135)
[INFO]   Nearest: (32.0, 134.0)
[INFO]   Rounded: (140, 174)
[INFO]   Rounded: (20, 32)
[INFO]   Rounded: (123, 156)
[INFO]   Nearest: (124.0, 156.0)
[INFO]   Rounded: (140, 246)
[INFO]   Rounded: (23, 182)
[INFO]   Nearest: (24.0, 182.0)
[INFO]   Rounded: (68, 261)
[INFO]   Nearest: (68.0, 262.0)
[INFO]   Rounded: (194, 278)
[INFO]   Rounded: (65, 284)
[INFO]   Nearest: (66.0, 284.0)
[INFO]   Rounded: (38, 65)
[INFO]   Nearest: (38.0, 64.0)
[INFO]   Rounded: (36, 84)
[INFO]   Rounded: (150, 208)
[INFO]   Rounded: (47, 152)
[INFO]   Nearest: (48.0, 152.0)
[INFO]   Rounded: (100, 145)
[INFO]   Nearest: (100.0, 146.0)
[INFO]   Rounded: (37, 268)
[INFO]   Nearest: (38.0, 268.0)
[INFO]   Rounded: (70, 107)
[INFO]   Nearest: (70.0, 106.0)
[INFO]   Rounded: (32, 221)
[INFO]   Nearest: (32.0, 222.0)
[INFO]   Rounded: (177, 248)
[INFO]   Nearest: (178.0, 248.0)
[INFO]   Rounded: (121, 281)
[INFO]   Nearest: (122.0, 280.0)
[INFO]   Rounded: (224, 259)
[INFO]   Nearest: (224.0, 258.0)
[INFO]   Rounded: (79, 180)
[INFO]   Nearest: (80.0, 180.0)
[INFO]   Rounded: (17, 188)
[INFO]   Nearest: (16.0, 188.0)
[INFO]   Rounded: (98, 187)
[INFO]   Nearest: (98.0, 188.0)
[INFO]   Rounded: (40, 279)
[INFO]   Nearest: (40.0, 278.0)
[INFO]   Rounded: (286, 296)
[INFO]   Rounded: (15, 283)
[INFO]   Nearest: (16.0, 282.0)
[INFO]   Rounded: (20, 40)
[INFO]   Rounded: (195, 226)
[INFO]   Nearest: (194.0, 226.0)
[INFO]   Rounded: (157, 286)
[INFO]   Nearest: (158.0, 286.0)
[INFO]   Rounded: (20, 267)
[INFO]   Nearest: (20.0, 268.0)
[INFO]   Rounded: (227, 267)
[INFO]   Nearest: (226.0, 266.0)
[INFO]   Rounded: (206, 278)
[INFO]   Rounded: (92, 290)
[INFO]   Rounded: (81, 234)
[INFO]   Nearest: (80.0, 234.0)
[INFO]   Rounded: (52, 183)
[INFO]   Nearest: (52.0, 182.0)
[INFO]   Rounded: (100, 138)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 50, Long SMA: 56
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(34/62) - Original Sharpe: 0.6996, Trades: 48
[INFO] Kmeans cluster 2: SMA(144/174) - Original Sharpe: 0.6670, Trades: 25
[INFO] Kmeans cluster 3: SMA(34/74) - Original Sharpe: 0.6354, Trades: 44
[INFO] Kmeans cluster 4: SMA(82/234) - Original Sharpe: 0.6288, Trades: 13
[INFO] Kmeans cluster 5: SMA(140/174) - Original Sharpe: 0.5349, Trades: 25
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (50/56)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/62) - Sharpe: 0.6996
[INFO] cluster 2: (144/174) - Sharpe: 0.6670
[INFO] cluster 3: (34/74) - Sharpe: 0.6354
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -2.493074           -2.304650
1    2021-11-16 2021-11-16            42    -3.189982           -1.910223
2    2022-01-16 2022-01-16            42     1.294092            0.677492
3    2022-03-16 2022-03-16            41     4.339011            4.339011
4    2022-05-16 2022-05-16            45     1.113246            1.113246
5    2022-07-16 2022-07-16            44    -3.870262           -3.388668
6    2022-09-16 2022-09-16            43    -0.767104            0.830544
7    2022-11-16 2022-11-16            42    -4.333365           -6.207695
8    2023-01-16 2023-01-16            43     2.406742           -0.501787
9    2023-03-16 2023-03-16            40     0.982602            2.067613
10   2023-05-16 2023-05-16            44    -4.191287            0.878863
11   2023-07-16 2023-07-16            45    -0.015977            0.539197
12   2023-09-16 2023-09-16            43     0.712175            0.712175
13   2023-11-16 2023-11-16            40    -3.685762           -4.665991
14   2024-01-16 2024-01-16            44    -0.038296            0.306586
15   2024-03-16 2024-03-16            40     0.200895            0.058466
16   2024-05-16 2024-05-16            43     1.126451            0.831052
17   2024-07-16 2024-07-16            44    -4.492154            1.186019
18   2024-09-16 2024-09-16            45    -1.267614           -1.331970
19   2024-11-16 2024-11-16            28    -1.014734           -7.011318
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -2.5 |             -2.3 |          0.2 | True          
[INFO] 2021-11-16   |         -3.2 |             -1.9 |          1.3 | True          
[INFO] 2022-01-16   |          1.3 |              0.7 |         -0.6 | False         
[INFO] 2022-03-16   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -3.9 |             -3.4 |          0.5 | True          
[INFO] 2022-09-16   |         -0.8 |              0.8 |          1.6 | True          
[INFO] 2022-11-16   |         -4.3 |             -6.2 |         -1.9 | False         
[INFO] 2023-01-16   |          2.4 |             -0.5 |         -2.9 | False         
[INFO] 2023-03-16   |          1.0 |              2.1 |          1.1 | True          
[INFO] 2023-05-16   |         -4.2 |              0.9 |          5.1 | True          
[INFO] 2023-07-16   |         -0.0 |              0.5 |          0.5 | True          
[INFO] 2023-09-16   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-16   |         -3.7 |             -4.7 |         -1.0 | False         
[INFO] 2024-01-16   |         -0.0 |              0.3 |          0.3 | True          
[INFO] 2024-03-16   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2024-05-16   |          1.1 |              0.8 |         -0.3 | False         
[INFO] 2024-07-16   |         -4.5 |              1.2 |          5.7 | True          
[INFO] 2024-09-16   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2024-11-16   |         -1.0 |             -7.0 |         -6.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16, 2023-09-16, 2024-09-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 9 of 16 periods (56.25% win rate)
[INFO] Updating Excel file with Kmeans results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Kmeans win rate 56.2% in row 21
[INFO] Added best Sharpe parameters 50/56 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 50, Long SMA: 56
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/62) - Original Sharpe: 0.6996
[INFO] Added cluster 2 to portfolio: SMA(144/174) - Original Sharpe: 0.6670
[INFO] Added cluster 3 to portfolio: SMA(34/74) - Original Sharpe: 0.6354
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3291
[INFO] Kmeans Best out-of-sample Sharpe: -0.8169
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBX
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3871 to 1.0019
[INFO] 
Best parameters:
[INFO] Short SMA: 50
[INFO] Long SMA: 56
[INFO] Sharpe Ratio: 1.001858
[INFO] Number of Trades: 82
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10582 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3871 to 1.0019
[INFO] Trades range: 10.0 to 301.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3994 to 2.7993
[INFO] Scaled Long SMA range: -2.7994 to 1.4003
[INFO] Scaled Sharpe ratio range: -4.8665 to 4.5092
[INFO] Scaled Trades range: -0.7931 to 14.9015
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10582 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6276
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 407 elements
[INFO] Cluster 1: 140 elements
[INFO] Cluster 2: 341 elements
[INFO] Cluster 3: 89 elements
[INFO] Cluster 4: 51 elements
[INFO] Cluster 5: 275 elements
[INFO] Cluster 6: 14 elements
[INFO] Cluster 7: 403 elements
[INFO] Cluster 8: 232 elements
[INFO] Cluster 9: 346 elements
[INFO] Cluster 10: 506 elements
[INFO] Cluster 11: 403 elements
[INFO] Cluster 12: 48 elements
[INFO] Cluster 13: 414 elements
[INFO] Cluster 14: 260 elements
[INFO] Cluster 15: 304 elements
[INFO] Cluster 16: 89 elements
[INFO] Cluster 17: 226 elements
[INFO] Cluster 18: 327 elements
[INFO] Cluster 19: 18 elements
[INFO] Cluster 20: 83 elements
[INFO] Cluster 21: 445 elements
[INFO] Cluster 22: 570 elements
[INFO] Cluster 23: 89 elements
[INFO] Cluster 24: 176 elements
[INFO] Cluster 25: 240 elements
[INFO] Cluster 26: 93 elements
[INFO] Cluster 27: 138 elements
[INFO] Cluster 28: 52 elements
[INFO] Cluster 29: 126 elements
[INFO] Cluster 30: 271 elements
[INFO] Cluster 31: 236 elements
[INFO] Cluster 32: 336 elements
[INFO] Cluster 33: 340 elements
[INFO] Cluster 34: 122 elements
[INFO] Cluster 35: 132 elements
[INFO] Cluster 36: 268 elements
[INFO] Cluster 37: 112 elements
[INFO] Cluster 38: 302 elements
[INFO] Cluster 39: 202 elements
[INFO] Cluster 40: 7 elements
[INFO] Cluster 41: 96 elements
[INFO] Cluster 42: 193 elements
[INFO] Cluster 43: 254 elements
[INFO] Cluster 44: 22 elements
[INFO] Cluster 45: 313 elements
[INFO] Cluster 46: 132 elements
[INFO] Cluster 47: 54 elements
[INFO] Cluster 48: 219 elements
[INFO] Cluster 49: 66 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=36, Long SMA=130, Sharpe=0.2344, Trades=29
[INFO] Cluster 1 cluster: Short SMA=266, Long SMA=278, Sharpe=0.1320, Trades=32
[INFO] Cluster 2 cluster: Short SMA=162, Long SMA=288, Sharpe=0.2684, Trades=12
[INFO] Cluster 3 cluster: Short SMA=18, Long SMA=34, Sharpe=0.1257, Trades=89
[INFO] Cluster 4 cluster: Short SMA=38, Long SMA=44, Sharpe=0.6061, Trades=101
[INFO] Cluster 5 cluster: Short SMA=248, Long SMA=286, Sharpe=0.2385, Trades=18
[INFO] Cluster 7 cluster: Short SMA=102, Long SMA=180, Sharpe=0.5294, Trades=17
[INFO] Cluster 8 cluster: Short SMA=140, Long SMA=176, Sharpe=0.6050, Trades=25
[INFO] Cluster 9 cluster: Short SMA=34, Long SMA=96, Sharpe=0.5618, Trades=36
[INFO] Cluster 10 cluster: Short SMA=52, Long SMA=174, Sharpe=0.2381, Trades=17
[INFO] Cluster 11 cluster: Short SMA=146, Long SMA=208, Sharpe=0.5413, Trades=17
[INFO] Cluster 12 cluster: Short SMA=238, Long SMA=240, Sharpe=0.0985, Trades=72
[INFO] Cluster 13 cluster: Short SMA=196, Long SMA=256, Sharpe=0.2605, Trades=14
[INFO] Cluster 14 cluster: Short SMA=196, Long SMA=214, Sharpe=0.2776, Trades=28
[INFO] Cluster 15 cluster: Short SMA=100, Long SMA=142, Sharpe=0.1748, Trades=27
[INFO] Cluster 16 cluster: Short SMA=156, Long SMA=160, Sharpe=0.4263, Trades=57
[INFO] Cluster 17 cluster: Short SMA=32, Long SMA=70, Sharpe=0.7257, Trades=44
[INFO] Cluster 18 cluster: Short SMA=74, Long SMA=252, Sharpe=0.4707, Trades=15
[INFO] Cluster 20 cluster: Short SMA=148, Long SMA=160, Sharpe=0.8068, Trades=41
[INFO] Cluster 21 cluster: Short SMA=140, Long SMA=236, Sharpe=0.3530, Trades=13
[INFO] Cluster 22 cluster: Short SMA=30, Long SMA=224, Sharpe=0.3755, Trades=21
[INFO] Cluster 23 cluster: Short SMA=84, Long SMA=102, Sharpe=0.2328, Trades=42
[INFO] Cluster 24 cluster: Short SMA=90, Long SMA=290, Sharpe=0.1622, Trades=13
[INFO] Cluster 25 cluster: Short SMA=68, Long SMA=280, Sharpe=0.3490, Trades=15
[INFO] Cluster 26 cluster: Short SMA=54, Long SMA=66, Sharpe=0.3968, Trades=62
[INFO] Cluster 27 cluster: Short SMA=110, Long SMA=128, Sharpe=0.2192, Trades=37
[INFO] Cluster 28 cluster: Short SMA=46, Long SMA=54, Sharpe=0.8229, Trades=78
[INFO] Cluster 29 cluster: Short SMA=16, Long SMA=286, Sharpe=0.4407, Trades=25
[INFO] Cluster 30 cluster: Short SMA=222, Long SMA=262, Sharpe=0.1311, Trades=16
[INFO] Cluster 31 cluster: Short SMA=40, Long SMA=112, Sharpe=0.3155, Trades=31
[INFO] Cluster 32 cluster: Short SMA=40, Long SMA=268, Sharpe=0.1969, Trades=21
[INFO] Cluster 33 cluster: Short SMA=86, Long SMA=196, Sharpe=0.3629, Trades=15
[INFO] Cluster 34 cluster: Short SMA=166, Long SMA=188, Sharpe=0.4487, Trades=29
[INFO] Cluster 35 cluster: Short SMA=16, Long SMA=182, Sharpe=0.4442, Trades=25
[INFO] Cluster 36 cluster: Short SMA=122, Long SMA=280, Sharpe=0.3453, Trades=13
[INFO] Cluster 37 cluster: Short SMA=22, Long SMA=66, Sharpe=0.5285, Trades=53
[INFO] Cluster 38 cluster: Short SMA=102, Long SMA=256, Sharpe=0.3461, Trades=13
[INFO] Cluster 39 cluster: Short SMA=176, Long SMA=248, Sharpe=0.1052, Trades=14
[INFO] Cluster 41 cluster: Short SMA=260, Long SMA=270, Sharpe=0.2458, Trades=34
[INFO] Cluster 42 cluster: Short SMA=72, Long SMA=136, Sharpe=0.0794, Trades=23
[INFO] Cluster 43 cluster: Short SMA=162, Long SMA=272, Sharpe=0.1558, Trades=12
[INFO] Cluster 44 cluster: Short SMA=112, Long SMA=114, Sharpe=0.2230, Trades=105
[INFO] Cluster 45 cluster: Short SMA=74, Long SMA=224, Sharpe=0.4859, Trades=13
[INFO] Cluster 46 cluster: Short SMA=228, Long SMA=272, Sharpe=0.0769, Trades=14
[INFO] Cluster 47 cluster: Short SMA=100, Long SMA=108, Sharpe=0.1153, Trades=52
[INFO] Cluster 48 cluster: Short SMA=52, Long SMA=158, Sharpe=0.0899, Trades=19
[INFO] Cluster 49 cluster: Short SMA=36, Long SMA=270, Sharpe=0.0299, Trades=23
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=50, Long SMA=56, Sharpe=1.0019, Trades=82
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=46, Long SMA=54, Sharpe=0.8229, Trades=78
[INFO] Top 2: Short SMA=148, Long SMA=160, Sharpe=0.8068, Trades=41
[INFO] Top 3: Short SMA=32, Long SMA=70, Sharpe=0.7257, Trades=44
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10543 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 50, Long SMA: 56
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(46/54) - Original Sharpe: 0.8229, Trades: 78
[INFO] Hierarchical cluster 2: SMA(148/160) - Original Sharpe: 0.8068, Trades: 41
[INFO] Hierarchical cluster 3: SMA(32/70) - Original Sharpe: 0.7257, Trades: 44
[INFO] Hierarchical cluster 4: SMA(38/44) - Original Sharpe: 0.6061, Trades: 101
[INFO] Hierarchical cluster 5: SMA(140/176) - Original Sharpe: 0.6050, Trades: 25
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (50/56)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (46/54) - Sharpe: 0.8229
[INFO] cluster 2: (148/160) - Sharpe: 0.8068
[INFO] cluster 3: (32/70) - Sharpe: 0.7257
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -2.493074           -2.766959
1    2021-11-16 2021-11-16            42    -3.189982           -2.147975
2    2022-01-16 2022-01-16            42     1.294092            0.344900
3    2022-03-16 2022-03-16            41     4.339011            4.339011
4    2022-05-16 2022-05-16            45     1.113246            1.113246
5    2022-07-16 2022-07-16            44    -3.870262           -2.860561
6    2022-09-16 2022-09-16            43    -0.767104            0.503117
7    2022-11-16 2022-11-16            42    -4.333365           -5.505828
8    2023-01-16 2023-01-16            43     2.406742            0.064034
9    2023-03-16 2023-03-16            40     0.982602            1.720658
10   2023-05-16 2023-05-16            44    -4.191287           -0.995549
11   2023-07-16 2023-07-16            45    -0.015977            0.637425
12   2023-09-16 2023-09-16            43     0.712175            1.129303
13   2023-11-16 2023-11-16            40    -3.685762           -3.089990
14   2024-01-16 2024-01-16            44    -0.038296           -0.826883
15   2024-03-16 2024-03-16            40     0.200895            0.695812
16   2024-05-16 2024-05-16            43     1.126451            1.178872
17   2024-07-16 2024-07-16            44    -4.492154           -0.020764
18   2024-09-16 2024-09-16            45    -1.267614           -2.099983
19   2024-11-16 2024-11-16            28    -1.014734           -5.386193
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -2.5 |             -2.8 |         -0.3 | False         
[INFO] 2021-11-16   |         -3.2 |             -2.1 |          1.1 | True          
[INFO] 2022-01-16   |          1.3 |              0.3 |         -1.0 | False         
[INFO] 2022-03-16   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -3.9 |             -2.9 |          1.0 | True          
[INFO] 2022-09-16   |         -0.8 |              0.5 |          1.3 | True          
[INFO] 2022-11-16   |         -4.3 |             -5.5 |         -1.2 | False         
[INFO] 2023-01-16   |          2.4 |              0.1 |         -2.3 | False         
[INFO] 2023-03-16   |          1.0 |              1.7 |          0.7 | True          
[INFO] 2023-05-16   |         -4.2 |             -1.0 |          3.2 | True          
[INFO] 2023-07-16   |         -0.0 |              0.6 |          0.6 | True          
[INFO] 2023-09-16   |          0.7 |              1.1 |          0.4 | True          
[INFO] 2023-11-16   |         -3.7 |             -3.1 |          0.6 | True          
[INFO] 2024-01-16   |         -0.0 |             -0.8 |         -0.8 | False         
[INFO] 2024-03-16   |          0.2 |              0.7 |          0.5 | True          
[INFO] 2024-05-16   |          1.1 |              1.2 |          0.1 | True          
[INFO] 2024-07-16   |         -4.5 |             -0.0 |          4.5 | True          
[INFO] 2024-09-16   |         -1.3 |             -2.1 |         -0.8 | False         
[INFO] 2024-11-16   |         -1.0 |             -5.4 |         -4.4 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 18 periods (61.11% win rate)
[INFO] Updating Excel file with Hierarchical results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Hierarchical win rate 61.1% in row 21
[INFO] Added best Sharpe parameters 50/56 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 50, Long SMA: 56
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(46/54) - Original Sharpe: 0.8229
[INFO] Added cluster 2 to portfolio: SMA(148/160) - Original Sharpe: 0.8068
[INFO] Added cluster 3 to portfolio: SMA(32/70) - Original Sharpe: 0.7257
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3441
[INFO] Hierarchical Best out-of-sample Sharpe: -0.8169
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBX
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FV in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 69.59s
[INFO] Best parameters: Short SMA = 72, Long SMA = 80
[INFO] Best Sharpe ratio: 0.949806, Trades: 55
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 3246 bad combos; keeping 1949 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FV
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 19.39 contracts
[INFO] Maximum Position Size: 46 contracts
[INFO] Strategy Total P&L: $459,015.94
[INFO] Market Buy & Hold P&L: $-7,468.75
[INFO] Outperformance: $466,484.69
[INFO] Sharpe ratio (entire period, annualized): 0.704491
[INFO] Sharpe ratio (in-sample, annualized): 0.949806
[INFO] Sharpe ratio (out-of-sample, annualized): 0.150694
[INFO] Maximum Drawdown: $166,890.31
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 38
[INFO] Out-of-sample period trades: 17
[INFO] Total trades: 55
[INFO] In-sample P&L: $498,560.94
[INFO] Out-of-sample P&L: $35,012.81
[INFO] 
Best parameters from GA: Short SMA = 72, Long SMA = 80, Sharpe = 0.949806
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7879 to 0.9498
[INFO] 
Best parameters:
[INFO] Short SMA: 72
[INFO] Long SMA: 80
[INFO] Sharpe Ratio: 0.949806
[INFO] Number of Trades: 55
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7339 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7879 to 0.9498
[INFO] Trades range: 10.0 to 350.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1881 to 2.8942
[INFO] Scaled Long SMA range: -2.5863 to 1.9520
[INFO] Scaled Sharpe ratio range: -4.7689 to 3.0644
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 150 elements
[INFO] Kmeans Cluster 1: 114 elements
[INFO] Kmeans Cluster 2: 109 elements
[INFO] Kmeans Cluster 3: 188 elements
[INFO] Kmeans Cluster 4: 138 elements
[INFO] Kmeans Cluster 5: 141 elements
[INFO] Kmeans Cluster 6: 180 elements
[INFO] Kmeans Cluster 7: 208 elements
[INFO] Kmeans Cluster 8: 135 elements
[INFO] Kmeans Cluster 9: 41 elements
[INFO] Kmeans Cluster 10: 155 elements
[INFO] Kmeans Cluster 11: 80 elements
[INFO] Kmeans Cluster 12: 136 elements
[INFO] Kmeans Cluster 13: 128 elements
[INFO] Kmeans Cluster 14: 106 elements
[INFO] Kmeans Cluster 15: 72 elements
[INFO] Kmeans Cluster 16: 205 elements
[INFO] Kmeans Cluster 17: 246 elements
[INFO] Kmeans Cluster 18: 199 elements
[INFO] Kmeans Cluster 19: 168 elements
[INFO] Kmeans Cluster 20: 138 elements
[INFO] Kmeans Cluster 21: 67 elements
[INFO] Kmeans Cluster 22: 111 elements
[INFO] Kmeans Cluster 23: 270 elements
[INFO] Kmeans Cluster 24: 142 elements
[INFO] Kmeans Cluster 25: 89 elements
[INFO] Kmeans Cluster 26: 157 elements
[INFO] Kmeans Cluster 27: 170 elements
[INFO] Kmeans Cluster 28: 99 elements
[INFO] Kmeans Cluster 29: 180 elements
[INFO] Kmeans Cluster 30: 254 elements
[INFO] Kmeans Cluster 31: 142 elements
[INFO] Kmeans Cluster 32: 82 elements
[INFO] Kmeans Cluster 33: 159 elements
[INFO] Kmeans Cluster 34: 188 elements
[INFO] Kmeans Cluster 35: 216 elements
[INFO] Kmeans Cluster 36: 211 elements
[INFO] Kmeans Cluster 37: 90 elements
[INFO] Kmeans Cluster 38: 168 elements
[INFO] Kmeans Cluster 39: 100 elements
[INFO] Kmeans Cluster 40: 135 elements
[INFO] Kmeans Cluster 41: 141 elements
[INFO] Kmeans Cluster 42: 205 elements
[INFO] Kmeans Cluster 43: 148 elements
[INFO] Kmeans Cluster 44: 189 elements
[INFO] Kmeans Cluster 45: 88 elements
[INFO] Kmeans Cluster 46: 156 elements
[INFO] Kmeans Cluster 47: 139 elements
[INFO] Kmeans Cluster 48: 69 elements
[INFO] Kmeans Cluster 49: 137 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=92.25, Long SMA=174.32, Sharpe=0.2743
[INFO] Centroid 1: Short SMA=236.47, Long SMA=261.98, Sharpe=-0.0429
[INFO] Centroid 2: Short SMA=36.17, Long SMA=57.10, Sharpe=0.2395
[INFO] Centroid 3: Short SMA=75.22, Long SMA=215.39, Sharpe=0.4619
[INFO] Centroid 4: Short SMA=154.86, Long SMA=222.90, Sharpe=0.0919
[INFO] Centroid 5: Short SMA=49.94, Long SMA=83.28, Sharpe=0.5688
[INFO] Centroid 6: Short SMA=21.49, Long SMA=278.04, Sharpe=0.3105
[INFO] Centroid 7: Short SMA=33.01, Long SMA=130.51, Sharpe=0.4475
[INFO] Centroid 8: Short SMA=86.65, Long SMA=125.75, Sharpe=0.2560
[INFO] Centroid 9: Short SMA=18.24, Long SMA=28.29, Sharpe=-0.4612
[INFO] Centroid 10: Short SMA=157.81, Long SMA=191.37, Sharpe=0.2017
[INFO] Centroid 11: Short SMA=16.70, Long SMA=39.58, Sharpe=-0.2209
[INFO] Centroid 12: Short SMA=202.13, Long SMA=250.21, Sharpe=0.0170
[INFO] Centroid 13: Short SMA=138.12, Long SMA=176.16, Sharpe=0.3744
[INFO] Centroid 14: Short SMA=19.49, Long SMA=54.19, Sharpe=-0.0681
[INFO] Centroid 15: Short SMA=232.72, Long SMA=246.31, Sharpe=-0.2655
[INFO] Centroid 16: Short SMA=24.87, Long SMA=250.52, Sharpe=0.3995
[INFO] Centroid 17: Short SMA=104.79, Long SMA=157.00, Sharpe=0.1753
[INFO] Centroid 18: Short SMA=24.39, Long SMA=188.32, Sharpe=0.5554
[INFO] Centroid 19: Short SMA=59.51, Long SMA=123.54, Sharpe=0.3071
[INFO] Centroid 20: Short SMA=35.81, Long SMA=285.62, Sharpe=0.1612
[INFO] Centroid 21: Short SMA=145.91, Long SMA=160.81, Sharpe=0.6431
[INFO] Centroid 22: Short SMA=137.98, Long SMA=168.14, Sharpe=0.5220
[INFO] Centroid 23: Short SMA=190.74, Long SMA=225.78, Sharpe=0.0478
[INFO] Centroid 24: Short SMA=18.87, Long SMA=97.48, Sharpe=0.2045
[INFO] Centroid 25: Short SMA=60.81, Long SMA=80.40, Sharpe=0.7277
[INFO] Centroid 26: Short SMA=111.76, Long SMA=191.99, Sharpe=0.4662
[INFO] Centroid 27: Short SMA=172.09, Long SMA=198.13, Sharpe=0.0296
[INFO] Centroid 28: Short SMA=280.63, Long SMA=292.75, Sharpe=-0.0270
[INFO] Centroid 29: Short SMA=25.14, Long SMA=158.54, Sharpe=0.4582
[INFO] Centroid 30: Short SMA=65.91, Long SMA=176.08, Sharpe=0.3550
[INFO] Centroid 31: Short SMA=41.13, Long SMA=229.20, Sharpe=0.3196
[INFO] Centroid 32: Short SMA=99.32, Long SMA=115.56, Sharpe=-0.0144
[INFO] Centroid 33: Short SMA=224.14, Long SMA=244.63, Sharpe=-0.1340
[INFO] Centroid 34: Short SMA=25.96, Long SMA=225.09, Sharpe=0.4991
[INFO] Centroid 35: Short SMA=39.67, Long SMA=199.81, Sharpe=0.4371
[INFO] Centroid 36: Short SMA=67.73, Long SMA=147.60, Sharpe=0.2084
[INFO] Centroid 37: Short SMA=36.27, Long SMA=70.64, Sharpe=0.3751
[INFO] Centroid 38: Short SMA=259.18, Long SMA=276.23, Sharpe=0.1250
[INFO] Centroid 39: Short SMA=29.52, Long SMA=60.34, Sharpe=0.0905
[INFO] Centroid 40: Short SMA=104.37, Long SMA=126.55, Sharpe=0.1151
[INFO] Centroid 41: Short SMA=188.21, Long SMA=208.38, Sharpe=-0.0687
[INFO] Centroid 42: Short SMA=131.10, Long SMA=203.99, Sharpe=0.3415
[INFO] Centroid 43: Short SMA=44.28, Long SMA=97.80, Sharpe=0.4678
[INFO] Centroid 44: Short SMA=75.93, Long SMA=204.92, Sharpe=0.5656
[INFO] Centroid 45: Short SMA=19.27, Long SMA=119.75, Sharpe=0.3480
[INFO] Centroid 46: Short SMA=126.43, Long SMA=145.97, Sharpe=0.2948
[INFO] Centroid 47: Short SMA=76.91, Long SMA=107.01, Sharpe=0.1557
[INFO] Centroid 48: Short SMA=75.28, Long SMA=91.80, Sharpe=0.3476
[INFO] Centroid 49: Short SMA=31.30, Long SMA=157.72, Sharpe=0.5768
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=72, Long SMA=80, Sharpe=0.9498, Trades=55
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=62, Long SMA=80, Sharpe=0.8317, Trades=39
[INFO] Kmeans Top 2: Short SMA=146, Long SMA=160, Sharpe=0.6448, Trades=31
[INFO] Kmeans Top 3: Short SMA=24, Long SMA=188, Sharpe=0.6342, Trades=18
[INFO] Kmeans Top 4: Short SMA=48, Long SMA=84, Sharpe=0.6064, Trades=29
[INFO] Kmeans Top 5: Short SMA=138, Long SMA=170, Sharpe=0.5558, Trades=23
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (92, 174)
[INFO]   Rounded: (236, 262)
[INFO]   Rounded: (36, 57)
[INFO]   Nearest: (36.0, 58.0)
[INFO]   Rounded: (75, 215)
[INFO]   Nearest: (76.0, 216.0)
[INFO]   Rounded: (155, 223)
[INFO]   Nearest: (154.0, 222.0)
[INFO]   Rounded: (50, 83)
[INFO]   Nearest: (50.0, 84.0)
[INFO]   Rounded: (21, 278)
[INFO]   Nearest: (22.0, 278.0)
[INFO]   Rounded: (33, 131)
[INFO]   Nearest: (34.0, 130.0)
[INFO]   Rounded: (87, 126)
[INFO]   Nearest: (86.0, 126.0)
[INFO]   Rounded: (18, 28)
[INFO]   Rounded: (158, 191)
[INFO]   Nearest: (158.0, 192.0)
[INFO]   Rounded: (17, 40)
[INFO]   Nearest: (16.0, 40.0)
[INFO]   Rounded: (202, 250)
[INFO]   Rounded: (138, 176)
[INFO]   Rounded: (19, 54)
[INFO]   Nearest: (20.0, 54.0)
[INFO]   Rounded: (233, 246)
[INFO]   Nearest: (232.0, 246.0)
[INFO]   Rounded: (25, 251)
[INFO]   Nearest: (24.0, 250.0)
[INFO]   Rounded: (105, 157)
[INFO]   Nearest: (104.0, 158.0)
[INFO]   Rounded: (24, 188)
[INFO]   Rounded: (60, 124)
[INFO]   Rounded: (36, 286)
[INFO]   Rounded: (146, 161)
[INFO]   Nearest: (146.0, 160.0)
[INFO]   Rounded: (138, 168)
[INFO]   Rounded: (191, 226)
[INFO]   Nearest: (190.0, 226.0)
[INFO]   Rounded: (19, 97)
[INFO]   Nearest: (18.0, 98.0)
[INFO]   Rounded: (61, 80)
[INFO]   Nearest: (60.0, 80.0)
[INFO]   Rounded: (112, 192)
[INFO]   Rounded: (172, 198)
[INFO]   Rounded: (281, 293)
[INFO]   Nearest: (280.0, 292.0)
[INFO]   Rounded: (25, 159)
[INFO]   Nearest: (26.0, 158.0)
[INFO]   Rounded: (66, 176)
[INFO]   Rounded: (41, 229)
[INFO]   Nearest: (42.0, 230.0)
[INFO]   Rounded: (99, 116)
[INFO]   Nearest: (100.0, 116.0)
[INFO]   Rounded: (224, 245)
[INFO]   Nearest: (224.0, 244.0)
[INFO]   Rounded: (26, 225)
[INFO]   Nearest: (26.0, 226.0)
[INFO]   Rounded: (40, 200)
[INFO]   Rounded: (68, 148)
[INFO]   Rounded: (36, 71)
[INFO]   Nearest: (36.0, 70.0)
[INFO]   Rounded: (259, 276)
[INFO]   Nearest: (260.0, 276.0)
[INFO]   Rounded: (30, 60)
[INFO]   Rounded: (104, 127)
[INFO]   Nearest: (104.0, 126.0)
[INFO]   Rounded: (188, 208)
[INFO]   Rounded: (131, 204)
[INFO]   Nearest: (132.0, 204.0)
[INFO]   Rounded: (44, 98)
[INFO]   Rounded: (76, 205)
[INFO]   Nearest: (76.0, 204.0)
[INFO]   Rounded: (19, 120)
[INFO]   Nearest: (20.0, 120.0)
[INFO]   Rounded: (126, 146)
[INFO]   Rounded: (77, 107)
[INFO]   Nearest: (76.0, 108.0)
[INFO]   Rounded: (75, 92)
[INFO]   Nearest: (76.0, 92.0)
[INFO]   Rounded: (31, 158)
[INFO]   Nearest: (32.0, 158.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 72, Long SMA: 80
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(62/80) - Original Sharpe: 0.8317, Trades: 39
[INFO] Kmeans cluster 2: SMA(146/160) - Original Sharpe: 0.6448, Trades: 31
[INFO] Kmeans cluster 3: SMA(24/188) - Original Sharpe: 0.6342, Trades: 18
[INFO] Kmeans cluster 4: SMA(48/84) - Original Sharpe: 0.6064, Trades: 29
[INFO] Kmeans cluster 5: SMA(138/170) - Original Sharpe: 0.5558, Trades: 23
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (72/80)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (62/80) - Sharpe: 0.8317
[INFO] cluster 2: (146/160) - Sharpe: 0.6448
[INFO] cluster 3: (24/188) - Sharpe: 0.6342
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.048416           -3.896156
1    2021-11-14 2021-11-14            43     1.455706            0.873526
2    2022-01-14 2022-01-14            41     2.700861            2.700861
3    2022-03-14 2022-03-14            44     3.784695            3.784695
4    2022-05-14 2022-05-14            43     0.729933            0.729933
5    2022-07-14 2022-07-14            44     1.065131            2.944947
6    2022-09-14 2022-09-14            43     0.232152            0.443676
7    2022-11-14 2022-11-14            43    -2.056108           -1.012364
8    2023-01-14 2023-01-14            41    -0.637807           -2.169833
9    2023-03-14 2023-03-14            44    -0.502398           -0.599316
10   2023-05-14 2023-05-14            44    -0.910839           -3.804508
11   2023-07-14 2023-07-14            44     2.935724            2.935724
12   2023-09-14 2023-09-14            43     1.603056            1.589366
13   2023-11-14 2023-11-14            42    -2.819972           -3.453135
14   2024-01-14 2024-01-14            43    -2.527000           -3.081239
15   2024-03-14 2024-03-14            42     2.399643            2.876108
16   2024-05-14 2024-05-14            44    -2.159756           -2.656702
17   2024-07-14 2024-07-14            45     4.444693           -2.709292
18   2024-09-14 2024-09-14            43    -6.223105           -6.585498
19   2024-11-14 2024-11-14            33     0.476612            0.954542
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |             -3.9 |         -2.9 | False         
[INFO] 2021-11-14   |          1.5 |              0.9 |         -0.6 | False         
[INFO] 2022-01-14   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |              2.9 |          1.8 | True          
[INFO] 2022-09-14   |          0.2 |              0.4 |          0.2 | True          
[INFO] 2022-11-14   |         -2.1 |             -1.0 |          1.1 | True          
[INFO] 2023-01-14   |         -0.6 |             -2.2 |         -1.6 | False         
[INFO] 2023-03-14   |         -0.5 |             -0.6 |         -0.1 | False         
[INFO] 2023-05-14   |         -0.9 |             -3.8 |         -2.9 | False         
[INFO] 2023-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -2.8 |             -3.5 |         -0.7 | False         
[INFO] 2024-01-14   |         -2.5 |             -3.1 |         -0.6 | False         
[INFO] 2024-03-14   |          2.4 |              2.9 |          0.5 | True          
[INFO] 2024-05-14   |         -2.2 |             -2.7 |         -0.5 | False         
[INFO] 2024-07-14   |          4.4 |             -2.7 |         -7.1 | False         
[INFO] 2024-09-14   |         -6.2 |             -6.6 |         -0.4 | False         
[INFO] 2024-11-14   |          0.5 |              1.0 |          0.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14, 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Kmeans cluster wins (rounded comparison): 5 of 15 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for FV...
[INFO] Excel file updated successfully. Added FV with Kmeans win rate 33.3% in row 22
[INFO] Added best Sharpe parameters 72/80 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 72, Long SMA: 80
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(62/80) - Original Sharpe: 0.8317
[INFO] Added cluster 2 to portfolio: SMA(146/160) - Original Sharpe: 0.6448
[INFO] Added cluster 3 to portfolio: SMA(24/188) - Original Sharpe: 0.6342
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FV_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0469
[INFO] Kmeans Best out-of-sample Sharpe: 0.1507
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FV...
[INFO] Excel file updated successfully. Added FV with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FV
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7879 to 0.9498
[INFO] 
Best parameters:
[INFO] Short SMA: 72
[INFO] Long SMA: 80
[INFO] Sharpe Ratio: 0.949806
[INFO] Number of Trades: 55
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7339 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7879 to 0.9498
[INFO] Trades range: 10.0 to 350.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1881 to 2.8942
[INFO] Scaled Long SMA range: -2.5863 to 1.9520
[INFO] Scaled Sharpe ratio range: -4.7689 to 3.0644
[INFO] Scaled Trades range: -0.7160 to 14.6498
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 7339 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6175
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 406 elements
[INFO] Cluster 1: 45 elements
[INFO] Cluster 2: 177 elements
[INFO] Cluster 3: 381 elements
[INFO] Cluster 4: 70 elements
[INFO] Cluster 5: 305 elements
[INFO] Cluster 6: 371 elements
[INFO] Cluster 7: 123 elements
[INFO] Cluster 8: 224 elements
[INFO] Cluster 9: 304 elements
[INFO] Cluster 10: 260 elements
[INFO] Cluster 11: 103 elements
[INFO] Cluster 12: 28 elements
[INFO] Cluster 13: 165 elements
[INFO] Cluster 14: 133 elements
[INFO] Cluster 15: 117 elements
[INFO] Cluster 16: 51 elements
[INFO] Cluster 17: 387 elements
[INFO] Cluster 18: 286 elements
[INFO] Cluster 19: 247 elements
[INFO] Cluster 20: 102 elements
[INFO] Cluster 21: 19 elements
[INFO] Cluster 22: 296 elements
[INFO] Cluster 23: 19 elements
[INFO] Cluster 24: 48 elements
[INFO] Cluster 25: 95 elements
[INFO] Cluster 26: 31 elements
[INFO] Cluster 27: 3 elements
[INFO] Cluster 28: 126 elements
[INFO] Cluster 29: 213 elements
[INFO] Cluster 30: 23 elements
[INFO] Cluster 31: 127 elements
[INFO] Cluster 32: 186 elements
[INFO] Cluster 33: 26 elements
[INFO] Cluster 34: 11 elements
[INFO] Cluster 35: 147 elements
[INFO] Cluster 36: 53 elements
[INFO] Cluster 37: 234 elements
[INFO] Cluster 38: 72 elements
[INFO] Cluster 39: 212 elements
[INFO] Cluster 40: 228 elements
[INFO] Cluster 41: 245 elements
[INFO] Cluster 42: 68 elements
[INFO] Cluster 43: 67 elements
[INFO] Cluster 44: 77 elements
[INFO] Cluster 45: 201 elements
[INFO] Cluster 46: 73 elements
[INFO] Cluster 47: 53 elements
[INFO] Cluster 48: 93 elements
[INFO] Cluster 49: 8 elements
[INFO] Using 45 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=132, Long SMA=196, Sharpe=0.3053, Trades=15
[INFO] Cluster 1 cluster: Short SMA=14, Long SMA=26, Sharpe=-0.3356, Trades=120
[INFO] Cluster 2 cluster: Short SMA=94, Long SMA=110, Sharpe=0.1348, Trades=43
[INFO] Cluster 3 cluster: Short SMA=100, Long SMA=164, Sharpe=0.1506, Trades=17
[INFO] Cluster 4 cluster: Short SMA=46, Long SMA=54, Sharpe=0.3929, Trades=72
[INFO] Cluster 5 cluster: Short SMA=22, Long SMA=142, Sharpe=0.4090, Trades=27
[INFO] Cluster 6 cluster: Short SMA=76, Long SMA=212, Sharpe=0.5701, Trades=12
[INFO] Cluster 7 cluster: Short SMA=130, Long SMA=150, Sharpe=0.2735, Trades=27
[INFO] Cluster 8 cluster: Short SMA=34, Long SMA=220, Sharpe=0.4279, Trades=16
[INFO] Cluster 9 cluster: Short SMA=28, Long SMA=174, Sharpe=0.5766, Trades=19
[INFO] Cluster 10 cluster: Short SMA=228, Long SMA=252, Sharpe=-0.1106, Trades=14
[INFO] Cluster 11 cluster: Short SMA=160, Long SMA=188, Sharpe=0.1761, Trades=21
[INFO] Cluster 12 cluster: Short SMA=150, Long SMA=154, Sharpe=0.6174, Trades=55
[INFO] Cluster 13 cluster: Short SMA=46, Long SMA=88, Sharpe=0.5532, Trades=29
[INFO] Cluster 14 cluster: Short SMA=28, Long SMA=64, Sharpe=0.1462, Trades=50
[INFO] Cluster 15 cluster: Short SMA=152, Long SMA=224, Sharpe=0.0829, Trades=11
[INFO] Cluster 16 cluster: Short SMA=276, Long SMA=280, Sharpe=0.1401, Trades=32
[INFO] Cluster 17 cluster: Short SMA=178, Long SMA=212, Sharpe=0.0209, Trades=17
[INFO] Cluster 18 cluster: Short SMA=64, Long SMA=172, Sharpe=0.3134, Trades=17
[INFO] Cluster 19 cluster: Short SMA=24, Long SMA=280, Sharpe=0.2915, Trades=10
[INFO] Cluster 20 cluster: Short SMA=42, Long SMA=74, Sharpe=0.3329, Trades=41
[INFO] Cluster 22 cluster: Short SMA=68, Long SMA=122, Sharpe=0.2638, Trades=27
[INFO] Cluster 24 cluster: Short SMA=208, Long SMA=212, Sharpe=-0.1528, Trades=52
[INFO] Cluster 25 cluster: Short SMA=16, Long SMA=58, Sharpe=-0.1540, Trades=60
[INFO] Cluster 26 cluster: Short SMA=66, Long SMA=72, Sharpe=0.7254, Trades=69
[INFO] Cluster 28 cluster: Short SMA=106, Long SMA=134, Sharpe=-0.0361, Trades=28
[INFO] Cluster 29 cluster: Short SMA=42, Long SMA=108, Sharpe=0.4888, Trades=27
[INFO] Cluster 30 cluster: Short SMA=64, Long SMA=66, Sharpe=0.6455, Trades=113
[INFO] Cluster 31 cluster: Short SMA=118, Long SMA=184, Sharpe=0.5223, Trades=15
[INFO] Cluster 32 cluster: Short SMA=28, Long SMA=222, Sharpe=0.5236, Trades=16
[INFO] Cluster 33 cluster: Short SMA=130, Long SMA=132, Sharpe=0.4630, Trades=86
[INFO] Cluster 35 cluster: Short SMA=258, Long SMA=278, Sharpe=0.1429, Trades=12
[INFO] Cluster 36 cluster: Short SMA=132, Long SMA=138, Sharpe=0.3394, Trades=46
[INFO] Cluster 37 cluster: Short SMA=48, Long SMA=190, Sharpe=0.4033, Trades=17
[INFO] Cluster 38 cluster: Short SMA=144, Long SMA=162, Sharpe=0.6899, Trades=29
[INFO] Cluster 39 cluster: Short SMA=28, Long SMA=250, Sharpe=0.4311, Trades=14
[INFO] Cluster 40 cluster: Short SMA=198, Long SMA=240, Sharpe=0.0571, Trades=12
[INFO] Cluster 41 cluster: Short SMA=74, Long SMA=146, Sharpe=0.1741, Trades=21
[INFO] Cluster 42 cluster: Short SMA=236, Long SMA=248, Sharpe=-0.2848, Trades=18
[INFO] Cluster 43 cluster: Short SMA=58, Long SMA=82, Sharpe=0.7453, Trades=37
[INFO] Cluster 44 cluster: Short SMA=34, Long SMA=290, Sharpe=0.0899, Trades=10
[INFO] Cluster 45 cluster: Short SMA=20, Long SMA=98, Sharpe=0.1733, Trades=39
[INFO] Cluster 46 cluster: Short SMA=278, Long SMA=294, Sharpe=-0.0379, Trades=15
[INFO] Cluster 47 cluster: Short SMA=16, Long SMA=38, Sharpe=-0.2307, Trades=86
[INFO] Cluster 48 cluster: Short SMA=188, Long SMA=196, Sharpe=0.0183, Trades=35
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=72, Long SMA=80, Sharpe=0.9498, Trades=55
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=58, Long SMA=82, Sharpe=0.7453, Trades=37
[INFO] Top 2: Short SMA=66, Long SMA=72, Sharpe=0.7254, Trades=69
[INFO] Top 3: Short SMA=144, Long SMA=162, Sharpe=0.6899, Trades=29
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 45 valid clusters with clusters
[INFO] Filtering to 7279 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 72, Long SMA: 80
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(58/82) - Original Sharpe: 0.7453, Trades: 37
[INFO] Hierarchical cluster 2: SMA(66/72) - Original Sharpe: 0.7254, Trades: 69
[INFO] Hierarchical cluster 3: SMA(144/162) - Original Sharpe: 0.6899, Trades: 29
[INFO] Hierarchical cluster 4: SMA(64/66) - Original Sharpe: 0.6455, Trades: 113
[INFO] Hierarchical cluster 5: SMA(150/154) - Original Sharpe: 0.6174, Trades: 55
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (72/80)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (58/82) - Sharpe: 0.7453
[INFO] cluster 2: (66/72) - Sharpe: 0.7254
[INFO] cluster 3: (144/162) - Sharpe: 0.6899
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.048416           -3.123523
1    2021-11-14 2021-11-14            43     1.455706            0.873526
2    2022-01-14 2022-01-14            41     2.700861            2.700861
3    2022-03-14 2022-03-14            44     3.784695            3.784695
4    2022-05-14 2022-05-14            43     0.729933            0.729933
5    2022-07-14 2022-07-14            44     1.065131            2.554426
6    2022-09-14 2022-09-14            43     0.232152           -1.790148
7    2022-11-14 2022-11-14            43    -2.056108           -0.381685
8    2023-01-14 2023-01-14            41    -0.637807           -5.201039
9    2023-03-14 2023-03-14            44    -0.502398           -0.653245
10   2023-05-14 2023-05-14            44    -0.910839           -3.750063
11   2023-07-14 2023-07-14            44     2.935724            2.935724
12   2023-09-14 2023-09-14            43     1.603056            1.417042
13   2023-11-14 2023-11-14            42    -2.819972           -3.790743
14   2024-01-14 2024-01-14            43    -2.527000           -2.527000
15   2024-03-14 2024-03-14            42     2.399643            1.909747
16   2024-05-14 2024-05-14            44    -2.159756           -3.386008
17   2024-07-14 2024-07-14            45     4.444693            3.506981
18   2024-09-14 2024-09-14            43    -6.223105           -6.232862
19   2024-11-14 2024-11-14            33     0.476612            0.954542
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |             -3.1 |         -2.1 | False         
[INFO] 2021-11-14   |          1.5 |              0.9 |         -0.6 | False         
[INFO] 2022-01-14   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |              2.6 |          1.5 | True          
[INFO] 2022-09-14   |          0.2 |             -1.8 |         -2.0 | False         
[INFO] 2022-11-14   |         -2.1 |             -0.4 |          1.7 | True          
[INFO] 2023-01-14   |         -0.6 |             -5.2 |         -4.6 | False         
[INFO] 2023-03-14   |         -0.5 |             -0.7 |         -0.2 | False         
[INFO] 2023-05-14   |         -0.9 |             -3.8 |         -2.9 | False         
[INFO] 2023-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.6 |              1.4 |         -0.2 | False         
[INFO] 2023-11-14   |         -2.8 |             -3.8 |         -1.0 | False         
[INFO] 2024-01-14   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |          2.4 |              1.9 |         -0.5 | False         
[INFO] 2024-05-14   |         -2.2 |             -3.4 |         -1.2 | False         
[INFO] 2024-07-14   |          4.4 |              3.5 |         -0.9 | False         
[INFO] 2024-09-14   |         -6.2 |             -6.2 |          0.0 | Excluded      
[INFO] 2024-11-14   |          0.5 |              1.0 |          0.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14, 2022-03-14, 2022-05-14, 2023-07-14, 2024-01-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 3 of 14 periods (21.43% win rate)
[INFO] Updating Excel file with Hierarchical results for FV...
[INFO] Excel file updated successfully. Added FV with Hierarchical win rate 21.4% in row 22
[INFO] Added best Sharpe parameters 72/80 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 72, Long SMA: 80
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(58/82) - Original Sharpe: 0.7453
[INFO] Added cluster 2 to portfolio: SMA(66/72) - Original Sharpe: 0.7254
[INFO] Added cluster 3 to portfolio: SMA(144/162) - Original Sharpe: 0.6899
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FV_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2439
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1507
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for FV...
[INFO] Excel file updated successfully. Added FV with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FV
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for GC in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.98s
[INFO] Best parameters: Short SMA = 34, Long SMA = 40
[INFO] Best Sharpe ratio: 0.654126, Trades: 106
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @GC
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.70 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $480,888.00
[INFO] Market Buy & Hold P&L: $96,090.00
[INFO] Outperformance: $384,798.00
[INFO] Sharpe ratio (entire period, annualized): 0.434125
[INFO] Sharpe ratio (in-sample, annualized): 0.654126
[INFO] Sharpe ratio (out-of-sample, annualized): -0.036014
[INFO] Maximum Drawdown: $135,992.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 76
[INFO] Out-of-sample period trades: 30
[INFO] Total trades: 106
[INFO] In-sample P&L: $375,178.00
[INFO] Out-of-sample P&L: $-9,644.00
[INFO] 
Best parameters from GA: Short SMA = 34, Long SMA = 40, Sharpe = 0.654126
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8556 to 0.6541
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 40
[INFO] Sharpe Ratio: 0.654126
[INFO] Number of Trades: 106
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8556 to 0.6541
[INFO] Trades range: 11.0 to 332.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.4157 to 3.6814
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 77 elements
[INFO] Kmeans Cluster 1: 243 elements
[INFO] Kmeans Cluster 2: 231 elements
[INFO] Kmeans Cluster 3: 171 elements
[INFO] Kmeans Cluster 4: 284 elements
[INFO] Kmeans Cluster 5: 256 elements
[INFO] Kmeans Cluster 6: 154 elements
[INFO] Kmeans Cluster 7: 64 elements
[INFO] Kmeans Cluster 8: 268 elements
[INFO] Kmeans Cluster 9: 205 elements
[INFO] Kmeans Cluster 10: 298 elements
[INFO] Kmeans Cluster 11: 160 elements
[INFO] Kmeans Cluster 12: 204 elements
[INFO] Kmeans Cluster 13: 213 elements
[INFO] Kmeans Cluster 14: 164 elements
[INFO] Kmeans Cluster 15: 197 elements
[INFO] Kmeans Cluster 16: 206 elements
[INFO] Kmeans Cluster 17: 314 elements
[INFO] Kmeans Cluster 18: 365 elements
[INFO] Kmeans Cluster 19: 113 elements
[INFO] Kmeans Cluster 20: 181 elements
[INFO] Kmeans Cluster 21: 222 elements
[INFO] Kmeans Cluster 22: 119 elements
[INFO] Kmeans Cluster 23: 238 elements
[INFO] Kmeans Cluster 24: 192 elements
[INFO] Kmeans Cluster 25: 225 elements
[INFO] Kmeans Cluster 26: 248 elements
[INFO] Kmeans Cluster 27: 173 elements
[INFO] Kmeans Cluster 28: 151 elements
[INFO] Kmeans Cluster 29: 183 elements
[INFO] Kmeans Cluster 30: 227 elements
[INFO] Kmeans Cluster 31: 101 elements
[INFO] Kmeans Cluster 32: 276 elements
[INFO] Kmeans Cluster 33: 362 elements
[INFO] Kmeans Cluster 34: 153 elements
[INFO] Kmeans Cluster 35: 112 elements
[INFO] Kmeans Cluster 36: 324 elements
[INFO] Kmeans Cluster 37: 236 elements
[INFO] Kmeans Cluster 38: 240 elements
[INFO] Kmeans Cluster 39: 287 elements
[INFO] Kmeans Cluster 40: 100 elements
[INFO] Kmeans Cluster 41: 247 elements
[INFO] Kmeans Cluster 42: 372 elements
[INFO] Kmeans Cluster 43: 148 elements
[INFO] Kmeans Cluster 44: 200 elements
[INFO] Kmeans Cluster 45: 258 elements
[INFO] Kmeans Cluster 46: 128 elements
[INFO] Kmeans Cluster 47: 236 elements
[INFO] Kmeans Cluster 48: 170 elements
[INFO] Kmeans Cluster 49: 289 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=33.05, Long SMA=50.87, Sharpe=0.4081
[INFO] Centroid 1: Short SMA=112.40, Long SMA=190.38, Sharpe=-0.1293
[INFO] Centroid 2: Short SMA=34.21, Long SMA=123.58, Sharpe=-0.5348
[INFO] Centroid 3: Short SMA=232.68, Long SMA=258.73, Sharpe=-0.0763
[INFO] Centroid 4: Short SMA=122.88, Long SMA=257.09, Sharpe=-0.2228
[INFO] Centroid 5: Short SMA=68.69, Long SMA=171.42, Sharpe=0.1200
[INFO] Centroid 6: Short SMA=272.68, Long SMA=285.62, Sharpe=-0.4342
[INFO] Centroid 7: Short SMA=16.31, Long SMA=30.25, Sharpe=-0.2100
[INFO] Centroid 8: Short SMA=30.93, Long SMA=278.81, Sharpe=-0.1211
[INFO] Centroid 9: Short SMA=58.59, Long SMA=221.34, Sharpe=-0.1171
[INFO] Centroid 10: Short SMA=175.11, Long SMA=215.32, Sharpe=-0.1738
[INFO] Centroid 11: Short SMA=108.96, Long SMA=131.09, Sharpe=0.3255
[INFO] Centroid 12: Short SMA=52.70, Long SMA=97.06, Sharpe=-0.6969
[INFO] Centroid 13: Short SMA=199.69, Long SMA=268.96, Sharpe=0.0784
[INFO] Centroid 14: Short SMA=22.29, Long SMA=61.71, Sharpe=0.1069
[INFO] Centroid 15: Short SMA=143.21, Long SMA=166.18, Sharpe=-0.1351
[INFO] Centroid 16: Short SMA=91.22, Long SMA=267.82, Sharpe=-0.0378
[INFO] Centroid 17: Short SMA=43.65, Long SMA=191.20, Sharpe=0.0003
[INFO] Centroid 18: Short SMA=148.27, Long SMA=283.23, Sharpe=-0.1938
[INFO] Centroid 19: Short SMA=73.43, Long SMA=116.07, Sharpe=-0.1705
[INFO] Centroid 20: Short SMA=62.80, Long SMA=249.28, Sharpe=-0.2196
[INFO] Centroid 21: Short SMA=28.04, Long SMA=163.19, Sharpe=-0.2137
[INFO] Centroid 22: Short SMA=170.81, Long SMA=188.35, Sharpe=-0.4003
[INFO] Centroid 23: Short SMA=224.98, Long SMA=287.05, Sharpe=-0.1574
[INFO] Centroid 24: Short SMA=57.47, Long SMA=87.23, Sharpe=-0.5581
[INFO] Centroid 25: Short SMA=211.36, Long SMA=238.44, Sharpe=0.1835
[INFO] Centroid 26: Short SMA=24.83, Long SMA=132.65, Sharpe=-0.3831
[INFO] Centroid 27: Short SMA=125.61, Long SMA=159.45, Sharpe=0.0047
[INFO] Centroid 28: Short SMA=18.34, Long SMA=198.28, Sharpe=-0.3545
[INFO] Centroid 29: Short SMA=81.16, Long SMA=119.98, Sharpe=0.0328
[INFO] Centroid 30: Short SMA=37.72, Long SMA=246.08, Sharpe=0.0086
[INFO] Centroid 31: Short SMA=24.30, Long SMA=74.48, Sharpe=-0.0510
[INFO] Centroid 32: Short SMA=75.43, Long SMA=155.87, Sharpe=0.2257
[INFO] Centroid 33: Short SMA=95.67, Long SMA=287.10, Sharpe=-0.1403
[INFO] Centroid 34: Short SMA=13.82, Long SMA=263.14, Sharpe=-0.3656
[INFO] Centroid 35: Short SMA=67.16, Long SMA=90.18, Sharpe=-0.3776
[INFO] Centroid 36: Short SMA=161.40, Long SMA=249.05, Sharpe=-0.2489
[INFO] Centroid 37: Short SMA=183.20, Long SMA=283.75, Sharpe=-0.0655
[INFO] Centroid 38: Short SMA=147.14, Long SMA=187.48, Sharpe=-0.2604
[INFO] Centroid 39: Short SMA=84.66, Long SMA=198.65, Sharpe=-0.0428
[INFO] Centroid 40: Short SMA=30.26, Long SMA=87.94, Sharpe=-0.2383
[INFO] Centroid 41: Short SMA=185.10, Long SMA=223.61, Sharpe=-0.0400
[INFO] Centroid 42: Short SMA=129.28, Long SMA=222.42, Sharpe=-0.1483
[INFO] Centroid 43: Short SMA=28.26, Long SMA=56.50, Sharpe=0.2626
[INFO] Centroid 44: Short SMA=255.98, Long SMA=285.74, Sharpe=-0.2899
[INFO] Centroid 45: Short SMA=104.41, Long SMA=137.73, Sharpe=0.1664
[INFO] Centroid 46: Short SMA=232.83, Long SMA=253.88, Sharpe=0.0664
[INFO] Centroid 47: Short SMA=56.58, Long SMA=279.92, Sharpe=-0.3123
[INFO] Centroid 48: Short SMA=21.53, Long SMA=221.18, Sharpe=-0.2145
[INFO] Centroid 49: Short SMA=90.64, Long SMA=233.49, Sharpe=-0.0697
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=40, Sharpe=0.6541, Trades=106
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=34, Long SMA=52, Sharpe=0.4172, Trades=64
[INFO] Kmeans Top 2: Short SMA=108, Long SMA=130, Sharpe=0.3617, Trades=30
[INFO] Kmeans Top 3: Short SMA=76, Long SMA=156, Sharpe=0.2610, Trades=17
[INFO] Kmeans Top 4: Short SMA=28, Long SMA=58, Sharpe=0.2495, Trades=50
[INFO] Kmeans Top 5: Short SMA=106, Long SMA=140, Sharpe=0.1709, Trades=24
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (33, 51)
[INFO]   Nearest: (34.0, 50.0)
[INFO]   Rounded: (112, 190)
[INFO]   Rounded: (34, 124)
[INFO]   Rounded: (233, 259)
[INFO]   Nearest: (232.0, 258.0)
[INFO]   Rounded: (123, 257)
[INFO]   Nearest: (122.0, 258.0)
[INFO]   Rounded: (69, 171)
[INFO]   Nearest: (68.0, 172.0)
[INFO]   Rounded: (273, 286)
[INFO]   Nearest: (272.0, 286.0)
[INFO]   Rounded: (16, 30)
[INFO]   Rounded: (31, 279)
[INFO]   Nearest: (30.0, 278.0)
[INFO]   Rounded: (59, 221)
[INFO]   Nearest: (58.0, 222.0)
[INFO]   Rounded: (175, 215)
[INFO]   Nearest: (176.0, 216.0)
[INFO]   Rounded: (109, 131)
[INFO]   Nearest: (108.0, 132.0)
[INFO]   Rounded: (53, 97)
[INFO]   Nearest: (52.0, 98.0)
[INFO]   Rounded: (200, 269)
[INFO]   Nearest: (200.0, 268.0)
[INFO]   Rounded: (22, 62)
[INFO]   Rounded: (143, 166)
[INFO]   Nearest: (144.0, 166.0)
[INFO]   Rounded: (91, 268)
[INFO]   Nearest: (92.0, 268.0)
[INFO]   Rounded: (44, 191)
[INFO]   Nearest: (44.0, 192.0)
[INFO]   Rounded: (148, 283)
[INFO]   Nearest: (148.0, 284.0)
[INFO]   Rounded: (73, 116)
[INFO]   Nearest: (74.0, 116.0)
[INFO]   Rounded: (63, 249)
[INFO]   Nearest: (62.0, 250.0)
[INFO]   Rounded: (28, 163)
[INFO]   Nearest: (28.0, 164.0)
[INFO]   Rounded: (171, 188)
[INFO]   Nearest: (170.0, 188.0)
[INFO]   Rounded: (225, 287)
[INFO]   Nearest: (224.0, 288.0)
[INFO]   Rounded: (57, 87)
[INFO]   Nearest: (58.0, 88.0)
[INFO]   Rounded: (211, 238)
[INFO]   Nearest: (212.0, 238.0)
[INFO]   Rounded: (25, 133)
[INFO]   Nearest: (24.0, 132.0)
[INFO]   Rounded: (126, 159)
[INFO]   Nearest: (126.0, 160.0)
[INFO]   Rounded: (18, 198)
[INFO]   Rounded: (81, 120)
[INFO]   Nearest: (82.0, 120.0)
[INFO]   Rounded: (38, 246)
[INFO]   Rounded: (24, 74)
[INFO]   Rounded: (75, 156)
[INFO]   Nearest: (76.0, 156.0)
[INFO]   Rounded: (96, 287)
[INFO]   Nearest: (96.0, 288.0)
[INFO]   Rounded: (14, 263)
[INFO]   Nearest: (14.0, 264.0)
[INFO]   Rounded: (67, 90)
[INFO]   Nearest: (68.0, 90.0)
[INFO]   Rounded: (161, 249)
[INFO]   Nearest: (162.0, 250.0)
[INFO]   Rounded: (183, 284)
[INFO]   Nearest: (184.0, 284.0)
[INFO]   Rounded: (147, 187)
[INFO]   Nearest: (148.0, 188.0)
[INFO]   Rounded: (85, 199)
[INFO]   Nearest: (84.0, 198.0)
[INFO]   Rounded: (30, 88)
[INFO]   Rounded: (185, 224)
[INFO]   Nearest: (186.0, 224.0)
[INFO]   Rounded: (129, 222)
[INFO]   Nearest: (130.0, 222.0)
[INFO]   Rounded: (28, 56)
[INFO]   Rounded: (256, 286)
[INFO]   Rounded: (104, 138)
[INFO]   Rounded: (233, 254)
[INFO]   Nearest: (232.0, 254.0)
[INFO]   Rounded: (57, 280)
[INFO]   Nearest: (56.0, 280.0)
[INFO]   Rounded: (22, 221)
[INFO]   Nearest: (22.0, 222.0)
[INFO]   Rounded: (91, 233)
[INFO]   Nearest: (90.0, 234.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 40
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(34/52) - Original Sharpe: 0.4172, Trades: 64
[INFO] Kmeans cluster 2: SMA(108/130) - Original Sharpe: 0.3617, Trades: 30
[INFO] Kmeans cluster 3: SMA(76/156) - Original Sharpe: 0.2610, Trades: 17
[INFO] Kmeans cluster 4: SMA(28/58) - Original Sharpe: 0.2495, Trades: 50
[INFO] Kmeans cluster 5: SMA(106/140) - Original Sharpe: 0.1709, Trades: 24
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/40)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/52) - Sharpe: 0.4172
[INFO] cluster 2: (108/130) - Sharpe: 0.3617
[INFO] cluster 3: (76/156) - Sharpe: 0.2610
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.475309           -4.653432
1    2021-11-14 2021-11-14            43    -2.403082            0.197346
2    2022-01-14 2022-01-14            41     3.901083            3.674401
3    2022-03-14 2022-03-14            44     0.151957           -3.460421
4    2022-05-14 2022-05-14            43    -1.226083           -2.329131
5    2022-07-14 2022-07-14            44    -0.992081            2.024849
6    2022-09-14 2022-09-14            43    -2.140694           -1.538954
7    2022-11-14 2022-11-14            43     2.716556           -2.430600
8    2023-01-14 2023-01-14            41    -3.937365           -2.230964
9    2023-03-14 2023-03-14            43    -1.001656            0.574584
10   2023-05-14 2023-05-14            44    -1.986559           -2.278491
11   2023-07-14 2023-07-14            44     4.153690           -0.400619
12   2023-09-14 2023-09-14            43    -0.209199           -0.209199
13   2023-11-14 2023-11-14            42     1.089419           -2.070184
14   2024-01-14 2024-01-14            43    -4.104296            1.279032
15   2024-03-14 2024-03-14            42     3.001304            3.001304
16   2024-05-14 2024-05-14            44    -0.938204           -0.113098
17   2024-07-14 2024-07-14            45     1.375742            2.706934
18   2024-09-14 2024-09-14            43    -0.392625           -0.392625
19   2024-11-14 2024-11-14            33     1.099525            0.995116
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.5 |             -4.7 |         -5.2 | False         
[INFO] 2021-11-14   |         -2.4 |              0.2 |          2.6 | True          
[INFO] 2022-01-14   |          3.9 |              3.7 |         -0.2 | False         
[INFO] 2022-03-14   |          0.2 |             -3.5 |         -3.7 | False         
[INFO] 2022-05-14   |         -1.2 |             -2.3 |         -1.1 | False         
[INFO] 2022-07-14   |         -1.0 |              2.0 |          3.0 | True          
[INFO] 2022-09-14   |         -2.1 |             -1.5 |          0.6 | True          
[INFO] 2022-11-14   |          2.7 |             -2.4 |         -5.1 | False         
[INFO] 2023-01-14   |         -3.9 |             -2.2 |          1.7 | True          
[INFO] 2023-03-14   |         -1.0 |              0.6 |          1.6 | True          
[INFO] 2023-05-14   |         -2.0 |             -2.3 |         -0.3 | False         
[INFO] 2023-07-14   |          4.2 |             -0.4 |         -4.6 | False         
[INFO] 2023-09-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-11-14   |          1.1 |             -2.1 |         -3.2 | False         
[INFO] 2024-01-14   |         -4.1 |              1.3 |          5.4 | True          
[INFO] 2024-03-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -0.9 |             -0.1 |          0.8 | True          
[INFO] 2024-07-14   |          1.4 |              2.7 |          1.3 | True          
[INFO] 2024-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |          1.1 |              1.0 |         -0.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-09-14, 2024-03-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 8 of 17 periods (47.06% win rate)
[INFO] Updating Excel file with Kmeans results for GC...
[INFO] Excel file updated successfully. Added GC with Kmeans win rate 47.1% in row 23
[INFO] Added best Sharpe parameters 34/40 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 40
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/52) - Original Sharpe: 0.4172
[INFO] Added cluster 2 to portfolio: SMA(108/130) - Original Sharpe: 0.3617
[INFO] Added cluster 3 to portfolio: SMA(76/156) - Original Sharpe: 0.2610
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'GC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0428
[INFO] Kmeans Best out-of-sample Sharpe: -0.0360
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for GC...
[INFO] Excel file updated successfully. Added GC with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\GC
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8556 to 0.6541
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 40
[INFO] Sharpe Ratio: 0.654126
[INFO] Number of Trades: 106
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8556 to 0.6541
[INFO] Trades range: 11.0 to 332.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.4157 to 3.6814
[INFO] Scaled Trades range: -0.7504 to 15.7636
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5600
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 473 elements
[INFO] Cluster 1: 427 elements
[INFO] Cluster 2: 672 elements
[INFO] Cluster 3: 323 elements
[INFO] Cluster 4: 566 elements
[INFO] Cluster 5: 184 elements
[INFO] Cluster 6: 199 elements
[INFO] Cluster 7: 379 elements
[INFO] Cluster 8: 67 elements
[INFO] Cluster 9: 506 elements
[INFO] Cluster 10: 197 elements
[INFO] Cluster 11: 73 elements
[INFO] Cluster 12: 453 elements
[INFO] Cluster 13: 243 elements
[INFO] Cluster 14: 298 elements
[INFO] Cluster 15: 198 elements
[INFO] Cluster 16: 344 elements
[INFO] Cluster 17: 62 elements
[INFO] Cluster 18: 168 elements
[INFO] Cluster 19: 288 elements
[INFO] Cluster 20: 53 elements
[INFO] Cluster 21: 500 elements
[INFO] Cluster 22: 23 elements
[INFO] Cluster 23: 112 elements
[INFO] Cluster 24: 95 elements
[INFO] Cluster 25: 359 elements
[INFO] Cluster 26: 197 elements
[INFO] Cluster 27: 245 elements
[INFO] Cluster 28: 155 elements
[INFO] Cluster 29: 139 elements
[INFO] Cluster 30: 6 elements
[INFO] Cluster 31: 35 elements
[INFO] Cluster 32: 29 elements
[INFO] Cluster 33: 127 elements
[INFO] Cluster 34: 135 elements
[INFO] Cluster 35: 25 elements
[INFO] Cluster 36: 118 elements
[INFO] Cluster 37: 124 elements
[INFO] Cluster 38: 169 elements
[INFO] Cluster 39: 9 elements
[INFO] Cluster 40: 156 elements
[INFO] Cluster 41: 42 elements
[INFO] Cluster 42: 53 elements
[INFO] Cluster 43: 156 elements
[INFO] Cluster 44: 143 elements
[INFO] Cluster 45: 248 elements
[INFO] Cluster 46: 194 elements
[INFO] Cluster 47: 304 elements
[INFO] Cluster 48: 277 elements
[INFO] Cluster 49: 237 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=44, Long SMA=204, Sharpe=0.0295, Trades=21
[INFO] Cluster 1 cluster: Short SMA=204, Long SMA=266, Sharpe=0.1520, Trades=15
[INFO] Cluster 2 cluster: Short SMA=80, Long SMA=214, Sharpe=-0.0614, Trades=15
[INFO] Cluster 3 cluster: Short SMA=48, Long SMA=246, Sharpe=-0.1345, Trades=15
[INFO] Cluster 4 cluster: Short SMA=136, Long SMA=266, Sharpe=-0.2257, Trades=13
[INFO] Cluster 5 cluster: Short SMA=24, Long SMA=68, Sharpe=0.1680, Trades=50
[INFO] Cluster 6 cluster: Short SMA=180, Long SMA=194, Sharpe=-0.3896, Trades=31
[INFO] Cluster 7 cluster: Short SMA=92, Long SMA=144, Sharpe=0.1872, Trades=21
[INFO] Cluster 8 cluster: Short SMA=38, Long SMA=44, Sharpe=0.2995, Trades=100
[INFO] Cluster 9 cluster: Short SMA=92, Long SMA=268, Sharpe=0.0259, Trades=13
[INFO] Cluster 10 cluster: Short SMA=32, Long SMA=160, Sharpe=-0.2559, Trades=25
[INFO] Cluster 11 cluster: Short SMA=106, Long SMA=114, Sharpe=0.2481, Trades=57
[INFO] Cluster 12 cluster: Short SMA=162, Long SMA=242, Sharpe=-0.2879, Trades=17
[INFO] Cluster 13 cluster: Short SMA=18, Long SMA=204, Sharpe=-0.3731, Trades=33
[INFO] Cluster 14 cluster: Short SMA=184, Long SMA=226, Sharpe=-0.0811, Trades=21
[INFO] Cluster 15 cluster: Short SMA=220, Long SMA=236, Sharpe=0.0441, Trades=27
[INFO] Cluster 16 cluster: Short SMA=50, Long SMA=104, Sharpe=-0.5342, Trades=31
[INFO] Cluster 17 cluster: Short SMA=160, Long SMA=162, Sharpe=-0.1327, Trades=71
[INFO] Cluster 18 cluster: Short SMA=272, Long SMA=286, Sharpe=-0.3603, Trades=29
[INFO] Cluster 19 cluster: Short SMA=30, Long SMA=278, Sharpe=-0.0877, Trades=15
[INFO] Cluster 20 cluster: Short SMA=80, Long SMA=90, Sharpe=-0.3445, Trades=53
[INFO] Cluster 21 cluster: Short SMA=130, Long SMA=214, Sharpe=-0.0907, Trades=15
[INFO] Cluster 22 cluster: Short SMA=32, Long SMA=34, Sharpe=0.2971, Trades=177
[INFO] Cluster 23 cluster: Short SMA=70, Long SMA=116, Sharpe=-0.2100, Trades=27
[INFO] Cluster 24 cluster: Short SMA=66, Long SMA=78, Sharpe=-0.5371, Trades=55
[INFO] Cluster 25 cluster: Short SMA=30, Long SMA=126, Sharpe=-0.3576, Trades=33
[INFO] Cluster 26 cluster: Short SMA=250, Long SMA=290, Sharpe=-0.3529, Trades=17
[INFO] Cluster 27 cluster: Short SMA=220, Long SMA=286, Sharpe=-0.1232, Trades=15
[INFO] Cluster 28 cluster: Short SMA=112, Long SMA=164, Sharpe=0.0390, Trades=21
[INFO] Cluster 29 cluster: Short SMA=146, Long SMA=160, Sharpe=-0.1529, Trades=37
[INFO] Cluster 31 cluster: Short SMA=18, Long SMA=26, Sharpe=-0.4546, Trades=132
[INFO] Cluster 32 cluster: Short SMA=72, Long SMA=76, Sharpe=-0.5074, Trades=87
[INFO] Cluster 33 cluster: Short SMA=14, Long SMA=148, Sharpe=-0.3719, Trades=43
[INFO] Cluster 34 cluster: Short SMA=32, Long SMA=54, Sharpe=0.3263, Trades=60
[INFO] Cluster 35 cluster: Short SMA=274, Long SMA=276, Sharpe=-0.3491, Trades=65
[INFO] Cluster 36 cluster: Short SMA=236, Long SMA=250, Sharpe=-0.0654, Trades=27
[INFO] Cluster 37 cluster: Short SMA=14, Long SMA=266, Sharpe=-0.4273, Trades=39
[INFO] Cluster 38 cluster: Short SMA=108, Long SMA=128, Sharpe=0.4268, Trades=34
[INFO] Cluster 40 cluster: Short SMA=26, Long SMA=88, Sharpe=-0.2109, Trades=40
[INFO] Cluster 41 cluster: Short SMA=218, Long SMA=222, Sharpe=0.1883, Trades=49
[INFO] Cluster 42 cluster: Short SMA=18, Long SMA=38, Sharpe=-0.2148, Trades=88
[INFO] Cluster 43 cluster: Short SMA=142, Long SMA=188, Sharpe=-0.2286, Trades=21
[INFO] Cluster 44 cluster: Short SMA=74, Long SMA=128, Sharpe=-0.0177, Trades=27
[INFO] Cluster 45 cluster: Short SMA=120, Long SMA=178, Sharpe=-0.1804, Trades=17
[INFO] Cluster 46 cluster: Short SMA=174, Long SMA=282, Sharpe=-0.0889, Trades=13
[INFO] Cluster 47 cluster: Short SMA=66, Long SMA=168, Sharpe=0.0749, Trades=17
[INFO] Cluster 48 cluster: Short SMA=58, Long SMA=278, Sharpe=-0.3048, Trades=15
[INFO] Cluster 49 cluster: Short SMA=114, Long SMA=292, Sharpe=-0.1599, Trades=13
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=40, Sharpe=0.6541, Trades=106
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=108, Long SMA=128, Sharpe=0.4268, Trades=34
[INFO] Top 2: Short SMA=32, Long SMA=54, Sharpe=0.3263, Trades=60
[INFO] Top 3: Short SMA=38, Long SMA=44, Sharpe=0.2995, Trades=100
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10570 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 40
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(108/128) - Original Sharpe: 0.4268, Trades: 34
[INFO] Hierarchical cluster 2: SMA(32/54) - Original Sharpe: 0.3263, Trades: 60
[INFO] Hierarchical cluster 3: SMA(38/44) - Original Sharpe: 0.2995, Trades: 100
[INFO] Hierarchical cluster 4: SMA(32/34) - Original Sharpe: 0.2971, Trades: 177
[INFO] Hierarchical cluster 5: SMA(106/114) - Original Sharpe: 0.2481, Trades: 57
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/40)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (108/128) - Sharpe: 0.4268
[INFO] cluster 2: (32/54) - Sharpe: 0.3263
[INFO] cluster 3: (38/44) - Sharpe: 0.2995
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.475309           -2.300200
1    2021-11-14 2021-11-14            43    -2.403082           -2.818177
2    2022-01-14 2022-01-14            41     3.901083            3.098387
3    2022-03-14 2022-03-14            44     0.151957           -2.345438
4    2022-05-14 2022-05-14            43    -1.226083            1.889570
5    2022-07-14 2022-07-14            44    -0.992081            1.489532
6    2022-09-14 2022-09-14            43    -2.140694           -1.905055
7    2022-11-14 2022-11-14            43     2.716556            1.426252
8    2023-01-14 2023-01-14            41    -3.937365           -4.813109
9    2023-03-14 2023-03-14            43    -1.001656           -1.598902
10   2023-05-14 2023-05-14            44    -1.986559           -1.894546
11   2023-07-14 2023-07-14            44     4.153690            7.071727
12   2023-09-14 2023-09-14            43    -0.209199           -0.209199
13   2023-11-14 2023-11-14            42     1.089419           -0.354304
14   2024-01-14 2024-01-14            43    -4.104296           -4.886337
15   2024-03-14 2024-03-14            42     3.001304            3.001304
16   2024-05-14 2024-05-14            44    -0.938204           -0.203103
17   2024-07-14 2024-07-14            45     1.375742            3.050859
18   2024-09-14 2024-09-14            43    -0.392625           -0.392625
19   2024-11-14 2024-11-14            33     1.099525            2.669087
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.5 |             -2.3 |         -2.8 | False         
[INFO] 2021-11-14   |         -2.4 |             -2.8 |         -0.4 | False         
[INFO] 2022-01-14   |          3.9 |              3.1 |         -0.8 | False         
[INFO] 2022-03-14   |          0.2 |             -2.3 |         -2.5 | False         
[INFO] 2022-05-14   |         -1.2 |              1.9 |          3.1 | True          
[INFO] 2022-07-14   |         -1.0 |              1.5 |          2.5 | True          
[INFO] 2022-09-14   |         -2.1 |             -1.9 |          0.2 | True          
[INFO] 2022-11-14   |          2.7 |              1.4 |         -1.3 | False         
[INFO] 2023-01-14   |         -3.9 |             -4.8 |         -0.9 | False         
[INFO] 2023-03-14   |         -1.0 |             -1.6 |         -0.6 | False         
[INFO] 2023-05-14   |         -2.0 |             -1.9 |          0.1 | True          
[INFO] 2023-07-14   |          4.2 |              7.1 |          2.9 | True          
[INFO] 2023-09-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-11-14   |          1.1 |             -0.4 |         -1.5 | False         
[INFO] 2024-01-14   |         -4.1 |             -4.9 |         -0.8 | False         
[INFO] 2024-03-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -0.9 |             -0.2 |          0.7 | True          
[INFO] 2024-07-14   |          1.4 |              3.1 |          1.7 | True          
[INFO] 2024-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |          1.1 |              2.7 |          1.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-09-14, 2024-03-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 17 periods (47.06% win rate)
[INFO] Updating Excel file with Hierarchical results for GC...
[INFO] Excel file updated successfully. Added GC with Hierarchical win rate 47.1% in row 23
[INFO] Added best Sharpe parameters 34/40 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 40
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(108/128) - Original Sharpe: 0.4268
[INFO] Added cluster 2 to portfolio: SMA(32/54) - Original Sharpe: 0.3263
[INFO] Added cluster 3 to portfolio: SMA(38/44) - Original Sharpe: 0.2995
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'GC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0312
[INFO] Hierarchical Best out-of-sample Sharpe: -0.0360
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for GC...
[INFO] Excel file updated successfully. Added GC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\GC
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for HG in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.58s
[INFO] Best parameters: Short SMA = 202, Long SMA = 204
[INFO] Best Sharpe ratio: 0.957606, Trades: 77
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 798 bad combos; keeping 1926 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @HG
[INFO] Big Point Value (from data): 25000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.53 contracts
[INFO] Maximum Position Size: 9 contracts
[INFO] Strategy Total P&L: $250,534.50
[INFO] Market Buy & Hold P&L: $900.00
[INFO] Outperformance: $249,634.50
[INFO] Sharpe ratio (entire period, annualized): 0.254714
[INFO] Sharpe ratio (in-sample, annualized): 0.957606
[INFO] Sharpe ratio (out-of-sample, annualized): -1.312122
[INFO] Maximum Drawdown: $353,420.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 55
[INFO] Out-of-sample period trades: 22
[INFO] Total trades: 77
[INFO] In-sample P&L: $522,067.00
[INFO] Out-of-sample P&L: $-320,532.50
[INFO] 
Best parameters from GA: Short SMA = 202, Long SMA = 204, Sharpe = 0.957606
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 25000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7723 to 0.9576
[INFO] 
Best parameters:
[INFO] Short SMA: 202
[INFO] Long SMA: 204
[INFO] Sharpe Ratio: 0.957606
[INFO] Number of Trades: 77
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9787 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7723 to 0.9576
[INFO] Trades range: 10.0 to 363.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3319 to 2.7995
[INFO] Scaled Long SMA range: -2.7689 to 1.5355
[INFO] Scaled Sharpe ratio range: -2.9750 to 2.2590
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 109 elements
[INFO] Kmeans Cluster 1: 329 elements
[INFO] Kmeans Cluster 2: 171 elements
[INFO] Kmeans Cluster 3: 265 elements
[INFO] Kmeans Cluster 4: 102 elements
[INFO] Kmeans Cluster 5: 181 elements
[INFO] Kmeans Cluster 6: 137 elements
[INFO] Kmeans Cluster 7: 163 elements
[INFO] Kmeans Cluster 8: 132 elements
[INFO] Kmeans Cluster 9: 208 elements
[INFO] Kmeans Cluster 10: 229 elements
[INFO] Kmeans Cluster 11: 231 elements
[INFO] Kmeans Cluster 12: 307 elements
[INFO] Kmeans Cluster 13: 197 elements
[INFO] Kmeans Cluster 14: 73 elements
[INFO] Kmeans Cluster 15: 149 elements
[INFO] Kmeans Cluster 16: 226 elements
[INFO] Kmeans Cluster 17: 73 elements
[INFO] Kmeans Cluster 18: 237 elements
[INFO] Kmeans Cluster 19: 297 elements
[INFO] Kmeans Cluster 20: 260 elements
[INFO] Kmeans Cluster 21: 318 elements
[INFO] Kmeans Cluster 22: 172 elements
[INFO] Kmeans Cluster 23: 149 elements
[INFO] Kmeans Cluster 24: 190 elements
[INFO] Kmeans Cluster 25: 222 elements
[INFO] Kmeans Cluster 26: 73 elements
[INFO] Kmeans Cluster 27: 285 elements
[INFO] Kmeans Cluster 28: 215 elements
[INFO] Kmeans Cluster 29: 179 elements
[INFO] Kmeans Cluster 30: 221 elements
[INFO] Kmeans Cluster 31: 178 elements
[INFO] Kmeans Cluster 32: 109 elements
[INFO] Kmeans Cluster 33: 137 elements
[INFO] Kmeans Cluster 34: 171 elements
[INFO] Kmeans Cluster 35: 241 elements
[INFO] Kmeans Cluster 36: 118 elements
[INFO] Kmeans Cluster 37: 143 elements
[INFO] Kmeans Cluster 38: 317 elements
[INFO] Kmeans Cluster 39: 197 elements
[INFO] Kmeans Cluster 40: 58 elements
[INFO] Kmeans Cluster 41: 208 elements
[INFO] Kmeans Cluster 42: 317 elements
[INFO] Kmeans Cluster 43: 177 elements
[INFO] Kmeans Cluster 44: 352 elements
[INFO] Kmeans Cluster 45: 159 elements
[INFO] Kmeans Cluster 46: 155 elements
[INFO] Kmeans Cluster 47: 197 elements
[INFO] Kmeans Cluster 48: 185 elements
[INFO] Kmeans Cluster 49: 268 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=52.00, Long SMA=78.62, Sharpe=0.0603
[INFO] Centroid 1: Short SMA=180.09, Long SMA=258.56, Sharpe=0.6726
[INFO] Centroid 2: Short SMA=28.02, Long SMA=198.74, Sharpe=0.1825
[INFO] Centroid 3: Short SMA=62.12, Long SMA=175.15, Sharpe=-0.3138
[INFO] Centroid 4: Short SMA=275.57, Long SMA=290.52, Sharpe=0.3831
[INFO] Centroid 5: Short SMA=144.69, Long SMA=162.84, Sharpe=0.0154
[INFO] Centroid 6: Short SMA=114.35, Long SMA=278.47, Sharpe=0.4760
[INFO] Centroid 7: Short SMA=26.97, Long SMA=287.50, Sharpe=0.3602
[INFO] Centroid 8: Short SMA=67.35, Long SMA=100.33, Sharpe=-0.3655
[INFO] Centroid 9: Short SMA=61.53, Long SMA=199.25, Sharpe=-0.0723
[INFO] Centroid 10: Short SMA=102.07, Long SMA=122.08, Sharpe=0.0589
[INFO] Centroid 11: Short SMA=28.94, Long SMA=132.74, Sharpe=0.1455
[INFO] Centroid 12: Short SMA=220.21, Long SMA=284.22, Sharpe=0.3055
[INFO] Centroid 13: Short SMA=169.92, Long SMA=210.02, Sharpe=0.3386
[INFO] Centroid 14: Short SMA=34.77, Long SMA=49.32, Sharpe=0.7066
[INFO] Centroid 15: Short SMA=16.66, Long SMA=97.38, Sharpe=-0.0282
[INFO] Centroid 16: Short SMA=54.73, Long SMA=228.16, Sharpe=0.1939
[INFO] Centroid 17: Short SMA=16.63, Long SMA=39.29, Sharpe=-0.0707
[INFO] Centroid 18: Short SMA=78.93, Long SMA=242.98, Sharpe=0.5795
[INFO] Centroid 19: Short SMA=194.51, Long SMA=220.38, Sharpe=0.6306
[INFO] Centroid 20: Short SMA=21.55, Long SMA=177.49, Sharpe=-0.0330
[INFO] Centroid 21: Short SMA=122.81, Long SMA=244.94, Sharpe=0.5773
[INFO] Centroid 22: Short SMA=63.31, Long SMA=127.97, Sharpe=-0.4096
[INFO] Centroid 23: Short SMA=233.66, Long SMA=249.46, Sharpe=0.7063
[INFO] Centroid 24: Short SMA=85.12, Long SMA=121.68, Sharpe=-0.1413
[INFO] Centroid 25: Short SMA=102.58, Long SMA=209.68, Sharpe=0.2040
[INFO] Centroid 26: Short SMA=72.63, Long SMA=89.23, Sharpe=-0.5601
[INFO] Centroid 27: Short SMA=92.55, Long SMA=262.76, Sharpe=0.7492
[INFO] Centroid 28: Short SMA=25.27, Long SMA=267.99, Sharpe=0.4649
[INFO] Centroid 29: Short SMA=22.20, Long SMA=243.27, Sharpe=0.2791
[INFO] Centroid 30: Short SMA=121.82, Long SMA=147.17, Sharpe=-0.1152
[INFO] Centroid 31: Short SMA=105.98, Long SMA=179.37, Sharpe=-0.1658
[INFO] Centroid 32: Short SMA=111.61, Long SMA=167.71, Sharpe=-0.3535
[INFO] Centroid 33: Short SMA=30.06, Long SMA=54.48, Sharpe=0.4183
[INFO] Centroid 34: Short SMA=94.19, Long SMA=221.78, Sharpe=0.3901
[INFO] Centroid 35: Short SMA=259.62, Long SMA=284.36, Sharpe=0.1901
[INFO] Centroid 36: Short SMA=56.81, Long SMA=86.75, Sharpe=-0.1540
[INFO] Centroid 37: Short SMA=32.64, Long SMA=106.81, Sharpe=0.3888
[INFO] Centroid 38: Short SMA=157.00, Long SMA=234.97, Sharpe=0.5380
[INFO] Centroid 39: Short SMA=28.60, Long SMA=73.39, Sharpe=0.2007
[INFO] Centroid 40: Short SMA=18.59, Long SMA=32.00, Sharpe=-0.4183
[INFO] Centroid 41: Short SMA=31.74, Long SMA=220.09, Sharpe=0.4513
[INFO] Centroid 42: Short SMA=159.08, Long SMA=187.38, Sharpe=0.1758
[INFO] Centroid 43: Short SMA=51.22, Long SMA=282.06, Sharpe=0.1886
[INFO] Centroid 44: Short SMA=220.02, Long SMA=254.77, Sharpe=0.4990
[INFO] Centroid 45: Short SMA=89.40, Long SMA=155.74, Sharpe=-0.0336
[INFO] Centroid 46: Short SMA=63.64, Long SMA=152.49, Sharpe=-0.5410
[INFO] Centroid 47: Short SMA=62.67, Long SMA=276.42, Sharpe=0.3507
[INFO] Centroid 48: Short SMA=33.07, Long SMA=142.62, Sharpe=-0.1062
[INFO] Centroid 49: Short SMA=123.16, Long SMA=195.97, Sharpe=-0.0047
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=202, Long SMA=204, Sharpe=0.9576, Trades=77
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=92, Long SMA=262, Sharpe=0.8236, Trades=12
[INFO] Kmeans Top 2: Short SMA=34, Long SMA=50, Sharpe=0.8119, Trades=58
[INFO] Kmeans Top 3: Short SMA=194, Long SMA=220, Sharpe=0.7209, Trades=21
[INFO] Kmeans Top 4: Short SMA=232, Long SMA=248, Sharpe=0.6777, Trades=33
[INFO] Kmeans Top 5: Short SMA=180, Long SMA=258, Sharpe=0.6719, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (52, 79)
[INFO]   Nearest: (52.0, 78.0)
[INFO]   Rounded: (180, 259)
[INFO]   Nearest: (180.0, 258.0)
[INFO]   Rounded: (28, 199)
[INFO]   Nearest: (28.0, 198.0)
[INFO]   Rounded: (62, 175)
[INFO]   Nearest: (62.0, 176.0)
[INFO]   Rounded: (276, 291)
[INFO]   Nearest: (276.0, 290.0)
[INFO]   Rounded: (145, 163)
[INFO]   Nearest: (144.0, 162.0)
[INFO]   Rounded: (114, 278)
[INFO]   Rounded: (27, 287)
[INFO]   Nearest: (26.0, 288.0)
[INFO]   Rounded: (67, 100)
[INFO]   Nearest: (68.0, 100.0)
[INFO]   Rounded: (62, 199)
[INFO]   Nearest: (62.0, 200.0)
[INFO]   Rounded: (102, 122)
[INFO]   Rounded: (29, 133)
[INFO]   Nearest: (28.0, 132.0)
[INFO]   Rounded: (220, 284)
[INFO]   Rounded: (170, 210)
[INFO]   Rounded: (35, 49)
[INFO]   Nearest: (34.0, 50.0)
[INFO]   Rounded: (17, 97)
[INFO]   Nearest: (16.0, 98.0)
[INFO]   Rounded: (55, 228)
[INFO]   Nearest: (54.0, 228.0)
[INFO]   Rounded: (17, 39)
[INFO]   Nearest: (16.0, 40.0)
[INFO]   Rounded: (79, 243)
[INFO]   Nearest: (78.0, 242.0)
[INFO]   Rounded: (195, 220)
[INFO]   Nearest: (194.0, 220.0)
[INFO]   Rounded: (22, 177)
[INFO]   Nearest: (22.0, 178.0)
[INFO]   Rounded: (123, 245)
[INFO]   Nearest: (122.0, 244.0)
[INFO]   Rounded: (63, 128)
[INFO]   Nearest: (64.0, 128.0)
[INFO]   Rounded: (234, 249)
[INFO]   Nearest: (234.0, 250.0)
[INFO]   Rounded: (85, 122)
[INFO]   Nearest: (86.0, 122.0)
[INFO]   Rounded: (103, 210)
[INFO]   Nearest: (102.0, 210.0)
[INFO]   Rounded: (73, 89)
[INFO]   Nearest: (72.0, 90.0)
[INFO]   Rounded: (93, 263)
[INFO]   Nearest: (92.0, 262.0)
[INFO]   Rounded: (25, 268)
[INFO]   Nearest: (26.0, 268.0)
[INFO]   Rounded: (22, 243)
[INFO]   Nearest: (22.0, 244.0)
[INFO]   Rounded: (122, 147)
[INFO]   Nearest: (122.0, 148.0)
[INFO]   Rounded: (106, 179)
[INFO]   Nearest: (106.0, 180.0)
[INFO]   Rounded: (112, 168)
[INFO]   Rounded: (30, 54)
[INFO]   Rounded: (94, 222)
[INFO]   Rounded: (260, 284)
[INFO]   Rounded: (57, 87)
[INFO]   Nearest: (56.0, 86.0)
[INFO]   Rounded: (33, 107)
[INFO]   Nearest: (32.0, 106.0)
[INFO]   Rounded: (157, 235)
[INFO]   Nearest: (158.0, 234.0)
[INFO]   Rounded: (29, 73)
[INFO]   Nearest: (28.0, 74.0)
[INFO]   Rounded: (19, 32)
[INFO]   Nearest: (18.0, 32.0)
[INFO]   Rounded: (32, 220)
[INFO]   Rounded: (159, 187)
[INFO]   Nearest: (160.0, 188.0)
[INFO]   Rounded: (51, 282)
[INFO]   Nearest: (52.0, 282.0)
[INFO]   Rounded: (220, 255)
[INFO]   Nearest: (220.0, 254.0)
[INFO]   Rounded: (89, 156)
[INFO]   Nearest: (90.0, 156.0)
[INFO]   Rounded: (64, 152)
[INFO]   Rounded: (63, 276)
[INFO]   Nearest: (62.0, 276.0)
[INFO]   Rounded: (33, 143)
[INFO]   Nearest: (34.0, 142.0)
[INFO]   Rounded: (123, 196)
[INFO]   Nearest: (124.0, 196.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 202, Long SMA: 204
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(92/262) - Original Sharpe: 0.8236, Trades: 12
[INFO] Kmeans cluster 2: SMA(34/50) - Original Sharpe: 0.8119, Trades: 58
[INFO] Kmeans cluster 3: SMA(194/220) - Original Sharpe: 0.7209, Trades: 21
[INFO] Kmeans cluster 4: SMA(232/248) - Original Sharpe: 0.6777, Trades: 33
[INFO] Kmeans cluster 5: SMA(180/258) - Original Sharpe: 0.6719, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (202/204)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (92/262) - Sharpe: 0.8236
[INFO] cluster 2: (34/50) - Sharpe: 0.8119
[INFO] cluster 3: (194/220) - Sharpe: 0.7209
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.966360            0.117695
1    2021-11-14 2021-11-14            43     0.592419           -0.313086
2    2022-01-14 2022-01-14            41    -1.051138            1.390183
3    2022-03-14 2022-03-14            44    -3.278609           -3.736027
4    2022-05-14 2022-05-14            43    -4.117036           -3.307681
5    2022-07-14 2022-07-14            44    -0.204524           -0.093324
6    2022-09-14 2022-09-14            43    -1.944732           -2.592570
7    2022-11-14 2022-11-14            43    -1.875063           -0.416868
8    2023-01-14 2023-01-14            41     1.193934            1.185891
9    2023-03-14 2023-03-14            43    -3.970882           -3.415216
10   2023-05-14 2023-05-14            44     1.555819            2.861136
11   2023-07-14 2023-07-14            44    -2.334756           -1.986261
12   2023-09-14 2023-09-14            43    -2.853678           -0.550524
13   2023-11-14 2023-11-14            42    -0.420702           -1.723812
14   2024-01-14 2024-01-14            43     0.886191           -3.325021
15   2024-03-14 2024-03-14            42    -0.888819            5.846958
16   2024-05-14 2024-05-14            44    -3.242588           -1.884963
17   2024-07-14 2024-07-14            45    -2.418088           -2.418088
18   2024-09-14 2024-09-14            43    -0.682782           -1.759809
19   2024-11-14 2024-11-14            33    -1.722392            3.817042
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              0.1 |         -0.9 | False         
[INFO] 2021-11-14   |          0.6 |             -0.3 |         -0.9 | False         
[INFO] 2022-01-14   |         -1.1 |              1.4 |          2.5 | True          
[INFO] 2022-03-14   |         -3.3 |             -3.7 |         -0.4 | False         
[INFO] 2022-05-14   |         -4.1 |             -3.3 |          0.8 | True          
[INFO] 2022-07-14   |         -0.2 |             -0.1 |          0.1 | True          
[INFO] 2022-09-14   |         -1.9 |             -2.6 |         -0.7 | False         
[INFO] 2022-11-14   |         -1.9 |             -0.4 |          1.5 | True          
[INFO] 2023-01-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -4.0 |             -3.4 |          0.6 | True          
[INFO] 2023-05-14   |          1.6 |              2.9 |          1.3 | True          
[INFO] 2023-07-14   |         -2.3 |             -2.0 |          0.3 | True          
[INFO] 2023-09-14   |         -2.9 |             -0.6 |          2.3 | True          
[INFO] 2023-11-14   |         -0.4 |             -1.7 |         -1.3 | False         
[INFO] 2024-01-14   |          0.9 |             -3.3 |         -4.2 | False         
[INFO] 2024-03-14   |         -0.9 |              5.8 |          6.7 | True          
[INFO] 2024-05-14   |         -3.2 |             -1.9 |          1.3 | True          
[INFO] 2024-07-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -0.7 |             -1.8 |         -1.1 | False         
[INFO] 2024-11-14   |         -1.7 |              3.8 |          5.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-01-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 11 of 18 periods (61.11% win rate)
[INFO] Updating Excel file with Kmeans results for HG...
[INFO] Excel file updated successfully. Added HG with Kmeans win rate 61.1% in row 24
[INFO] Added best Sharpe parameters 202/204 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 202, Long SMA: 204
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(92/262) - Original Sharpe: 0.8236
[INFO] Added cluster 2 to portfolio: SMA(34/50) - Original Sharpe: 0.8119
[INFO] Added cluster 3 to portfolio: SMA(194/220) - Original Sharpe: 0.7209
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HG_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.9808
[INFO] Kmeans Best out-of-sample Sharpe: -1.3121
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for HG...
[INFO] Excel file updated successfully. Added HG with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HG
[INFO] Big Point Value: 25000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7723 to 0.9576
[INFO] 
Best parameters:
[INFO] Short SMA: 202
[INFO] Long SMA: 204
[INFO] Sharpe Ratio: 0.957606
[INFO] Number of Trades: 77
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9787 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7723 to 0.9576
[INFO] Trades range: 10.0 to 363.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3319 to 2.7995
[INFO] Scaled Long SMA range: -2.7689 to 1.5355
[INFO] Scaled Sharpe ratio range: -2.9750 to 2.2590
[INFO] Scaled Trades range: -0.8737 to 15.7098
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9787 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4944
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 418 elements
[INFO] Cluster 1: 402 elements
[INFO] Cluster 2: 199 elements
[INFO] Cluster 3: 147 elements
[INFO] Cluster 4: 366 elements
[INFO] Cluster 5: 86 elements
[INFO] Cluster 6: 413 elements
[INFO] Cluster 7: 229 elements
[INFO] Cluster 8: 355 elements
[INFO] Cluster 9: 152 elements
[INFO] Cluster 10: 172 elements
[INFO] Cluster 11: 141 elements
[INFO] Cluster 12: 397 elements
[INFO] Cluster 13: 130 elements
[INFO] Cluster 14: 80 elements
[INFO] Cluster 15: 324 elements
[INFO] Cluster 16: 404 elements
[INFO] Cluster 17: 73 elements
[INFO] Cluster 18: 230 elements
[INFO] Cluster 19: 272 elements
[INFO] Cluster 20: 31 elements
[INFO] Cluster 21: 36 elements
[INFO] Cluster 22: 31 elements
[INFO] Cluster 23: 87 elements
[INFO] Cluster 24: 252 elements
[INFO] Cluster 25: 14 elements
[INFO] Cluster 26: 180 elements
[INFO] Cluster 27: 123 elements
[INFO] Cluster 28: 282 elements
[INFO] Cluster 29: 317 elements
[INFO] Cluster 30: 219 elements
[INFO] Cluster 31: 203 elements
[INFO] Cluster 32: 203 elements
[INFO] Cluster 33: 295 elements
[INFO] Cluster 34: 318 elements
[INFO] Cluster 35: 445 elements
[INFO] Cluster 36: 126 elements
[INFO] Cluster 37: 3 elements
[INFO] Cluster 38: 277 elements
[INFO] Cluster 39: 190 elements
[INFO] Cluster 40: 28 elements
[INFO] Cluster 41: 266 elements
[INFO] Cluster 42: 109 elements
[INFO] Cluster 43: 205 elements
[INFO] Cluster 44: 128 elements
[INFO] Cluster 45: 44 elements
[INFO] Cluster 46: 12 elements
[INFO] Cluster 47: 205 elements
[INFO] Cluster 48: 11 elements
[INFO] Cluster 49: 157 elements
[INFO] Using 46 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=92, Long SMA=216, Sharpe=0.2735, Trades=18
[INFO] Cluster 1 cluster: Short SMA=72, Long SMA=128, Sharpe=-0.3308, Trades=28
[INFO] Cluster 2 cluster: Short SMA=26, Long SMA=92, Sharpe=0.0486, Trades=46
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=56, Sharpe=0.5807, Trades=56
[INFO] Cluster 4 cluster: Short SMA=182, Long SMA=248, Sharpe=0.7270, Trades=15
[INFO] Cluster 5 cluster: Short SMA=224, Long SMA=228, Sharpe=0.4556, Trades=57
[INFO] Cluster 6 cluster: Short SMA=116, Long SMA=260, Sharpe=0.6526, Trades=10
[INFO] Cluster 7 cluster: Short SMA=220, Long SMA=236, Sharpe=0.5588, Trades=33
[INFO] Cluster 8 cluster: Short SMA=60, Long SMA=278, Sharpe=0.2600, Trades=14
[INFO] Cluster 9 cluster: Short SMA=274, Long SMA=288, Sharpe=0.2364, Trades=25
[INFO] Cluster 10 cluster: Short SMA=166, Long SMA=208, Sharpe=0.2265, Trades=22
[INFO] Cluster 11 cluster: Short SMA=108, Long SMA=120, Sharpe=0.0031, Trades=45
[INFO] Cluster 12 cluster: Short SMA=212, Long SMA=258, Sharpe=0.4925, Trades=17
[INFO] Cluster 13 cluster: Short SMA=70, Long SMA=96, Sharpe=-0.4096, Trades=41
[INFO] Cluster 14 cluster: Short SMA=22, Long SMA=40, Sharpe=-0.1644, Trades=89
[INFO] Cluster 15 cluster: Short SMA=118, Long SMA=190, Sharpe=-0.0423, Trades=21
[INFO] Cluster 16 cluster: Short SMA=26, Long SMA=278, Sharpe=0.4081, Trades=18
[INFO] Cluster 17 cluster: Short SMA=160, Long SMA=164, Sharpe=-0.1321, Trades=78
[INFO] Cluster 18 cluster: Short SMA=22, Long SMA=226, Sharpe=0.3623, Trades=26
[INFO] Cluster 19 cluster: Short SMA=30, Long SMA=80, Sharpe=0.2749, Trades=42
[INFO] Cluster 20 cluster: Short SMA=22, Long SMA=30, Sharpe=-0.6297, Trades=121
[INFO] Cluster 21 cluster: Short SMA=94, Long SMA=96, Sharpe=-0.1141, Trades=107
[INFO] Cluster 22 cluster: Short SMA=42, Long SMA=44, Sharpe=0.5555, Trades=160
[INFO] Cluster 23 cluster: Short SMA=48, Long SMA=60, Sharpe=0.1424, Trades=62
[INFO] Cluster 24 cluster: Short SMA=30, Long SMA=134, Sharpe=0.1998, Trades=29
[INFO] Cluster 26 cluster: Short SMA=58, Long SMA=200, Sharpe=-0.0124, Trades=20
[INFO] Cluster 27 cluster: Short SMA=168, Long SMA=184, Sharpe=0.1947, Trades=37
[INFO] Cluster 28 cluster: Short SMA=62, Long SMA=176, Sharpe=-0.3288, Trades=25
[INFO] Cluster 29 cluster: Short SMA=116, Long SMA=154, Sharpe=-0.0355, Trades=29
[INFO] Cluster 30 cluster: Short SMA=26, Long SMA=182, Sharpe=0.0824, Trades=33
[INFO] Cluster 31 cluster: Short SMA=78, Long SMA=242, Sharpe=0.6538, Trades=14
[INFO] Cluster 32 cluster: Short SMA=30, Long SMA=222, Sharpe=0.4704, Trades=24
[INFO] Cluster 33 cluster: Short SMA=62, Long SMA=138, Sharpe=-0.6059, Trades=27
[INFO] Cluster 34 cluster: Short SMA=222, Long SMA=282, Sharpe=0.4359, Trades=15
[INFO] Cluster 35 cluster: Short SMA=154, Long SMA=234, Sharpe=0.5322, Trades=16
[INFO] Cluster 36 cluster: Short SMA=32, Long SMA=106, Sharpe=0.5127, Trades=34
[INFO] Cluster 38 cluster: Short SMA=146, Long SMA=200, Sharpe=0.0235, Trades=20
[INFO] Cluster 39 cluster: Short SMA=14, Long SMA=156, Sharpe=-0.1318, Trades=43
[INFO] Cluster 40 cluster: Short SMA=280, Long SMA=282, Sharpe=0.2216, Trades=59
[INFO] Cluster 41 cluster: Short SMA=92, Long SMA=262, Sharpe=0.8236, Trades=12
[INFO] Cluster 42 cluster: Short SMA=152, Long SMA=166, Sharpe=-0.2394, Trades=48
[INFO] Cluster 43 cluster: Short SMA=52, Long SMA=232, Sharpe=0.1365, Trades=20
[INFO] Cluster 44 cluster: Short SMA=108, Long SMA=170, Sharpe=-0.4139, Trades=23
[INFO] Cluster 45 cluster: Short SMA=104, Long SMA=110, Sharpe=0.1902, Trades=70
[INFO] Cluster 47 cluster: Short SMA=94, Long SMA=148, Sharpe=-0.0055, Trades=23
[INFO] Cluster 49 cluster: Short SMA=254, Long SMA=288, Sharpe=0.1882, Trades=15
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=202, Long SMA=204, Sharpe=0.9576, Trades=77
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=92, Long SMA=262, Sharpe=0.8236, Trades=12
[INFO] Top 2: Short SMA=182, Long SMA=248, Sharpe=0.7270, Trades=15
[INFO] Top 3: Short SMA=78, Long SMA=242, Sharpe=0.6538, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 46 valid clusters with clusters
[INFO] Filtering to 9747 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 202, Long SMA: 204
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(92/262) - Original Sharpe: 0.8236, Trades: 12
[INFO] Hierarchical cluster 2: SMA(182/248) - Original Sharpe: 0.7270, Trades: 15
[INFO] Hierarchical cluster 3: SMA(78/242) - Original Sharpe: 0.6538, Trades: 14
[INFO] Hierarchical cluster 4: SMA(116/260) - Original Sharpe: 0.6526, Trades: 10
[INFO] Hierarchical cluster 5: SMA(34/56) - Original Sharpe: 0.5807, Trades: 56
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (202/204)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (92/262) - Sharpe: 0.8236
[INFO] cluster 2: (182/248) - Sharpe: 0.7270
[INFO] cluster 3: (78/242) - Sharpe: 0.6538
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.966360            0.966360
1    2021-11-14 2021-11-14            43     0.592419            0.592419
2    2022-01-14 2022-01-14            41    -1.051138            0.063782
3    2022-03-14 2022-03-14            44    -3.278609           -3.464352
4    2022-05-14 2022-05-14            43    -4.117036           -2.663939
5    2022-07-14 2022-07-14            44    -0.204524           -0.976006
6    2022-09-14 2022-09-14            43    -1.944732           -1.944732
7    2022-11-14 2022-11-14            43    -1.875063           -1.875063
8    2023-01-14 2023-01-14            41     1.193934            0.560851
9    2023-03-14 2023-03-14            43    -3.970882           -2.586256
10   2023-05-14 2023-05-14            44     1.555819            1.555819
11   2023-07-14 2023-07-14            44    -2.334756           -1.642700
12   2023-09-14 2023-09-14            43    -2.853678           -0.408483
13   2023-11-14 2023-11-14            42    -0.420702           -0.420702
14   2024-01-14 2024-01-14            43     0.886191           -2.896531
15   2024-03-14 2024-03-14            42    -0.888819            2.965624
16   2024-05-14 2024-05-14            44    -3.242588            0.187921
17   2024-07-14 2024-07-14            45    -2.418088           -2.418088
18   2024-09-14 2024-09-14            43    -0.682782           -0.682782
19   2024-11-14 2024-11-14            33    -1.722392            2.780768
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -1.1 |              0.1 |          1.2 | True          
[INFO] 2022-03-14   |         -3.3 |             -3.5 |         -0.2 | False         
[INFO] 2022-05-14   |         -4.1 |             -2.7 |          1.4 | True          
[INFO] 2022-07-14   |         -0.2 |             -1.0 |         -0.8 | False         
[INFO] 2022-09-14   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.2 |              0.6 |         -0.6 | False         
[INFO] 2023-03-14   |         -4.0 |             -2.6 |          1.4 | True          
[INFO] 2023-05-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -2.3 |             -1.6 |          0.7 | True          
[INFO] 2023-09-14   |         -2.9 |             -0.4 |          2.5 | True          
[INFO] 2023-11-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          0.9 |             -2.9 |         -3.8 | False         
[INFO] 2024-03-14   |         -0.9 |              3.0 |          3.9 | True          
[INFO] 2024-05-14   |         -3.2 |              0.2 |          3.4 | True          
[INFO] 2024-07-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.7 |              2.8 |          4.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-09-14, 2022-11-14, 2023-05-14, 2023-11-14, 2024-07-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 12 periods (66.67% win rate)
[INFO] Updating Excel file with Hierarchical results for HG...
[INFO] Excel file updated successfully. Added HG with Hierarchical win rate 66.7% in row 24
[INFO] Added best Sharpe parameters 202/204 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 202, Long SMA: 204
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(92/262) - Original Sharpe: 0.8236
[INFO] Added cluster 2 to portfolio: SMA(182/248) - Original Sharpe: 0.7270
[INFO] Added cluster 3 to portfolio: SMA(78/242) - Original Sharpe: 0.6538
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HG_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.7783
[INFO] Hierarchical Best out-of-sample Sharpe: -1.3121
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for HG...
[INFO] Excel file updated successfully. Added HG with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HG
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for HO in column D: 25.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.67s
[INFO] Best parameters: Short SMA = 22, Long SMA = 28
[INFO] Best Sharpe ratio: 0.889954, Trades: 121
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 558 bad combos; keeping 1880 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @HO
[INFO] Big Point Value (from data): 42000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.17 contracts
[INFO] Maximum Position Size: 5 contracts
[INFO] Strategy Total P&L: $583,218.00
[INFO] Market Buy & Hold P&L: $86,142.00
[INFO] Outperformance: $497,076.00
[INFO] Sharpe ratio (entire period, annualized): 0.710110
[INFO] Sharpe ratio (in-sample, annualized): 0.889954
[INFO] Sharpe ratio (out-of-sample, annualized): 0.345997
[INFO] Maximum Drawdown: $227,841.80
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 80
[INFO] Out-of-sample period trades: 41
[INFO] Total trades: 121
[INFO] In-sample P&L: $523,733.40
[INFO] Out-of-sample P&L: $99,514.60
[INFO] 
Best parameters from GA: Short SMA = 22, Long SMA = 28, Sharpe = 0.889954
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7969 to 0.8900
[INFO] 
Best parameters:
[INFO] Short SMA: 22
[INFO] Long SMA: 28
[INFO] Sharpe Ratio: 0.889954
[INFO] Number of Trades: 121
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10027 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7969 to 0.8900
[INFO] Trades range: 10.0 to 331.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3615 to 2.7312
[INFO] Scaled Long SMA range: -2.7206 to 1.4041
[INFO] Scaled Sharpe ratio range: -4.1113 to 3.2767
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 233 elements
[INFO] Kmeans Cluster 1: 212 elements
[INFO] Kmeans Cluster 2: 167 elements
[INFO] Kmeans Cluster 3: 220 elements
[INFO] Kmeans Cluster 4: 226 elements
[INFO] Kmeans Cluster 5: 248 elements
[INFO] Kmeans Cluster 6: 207 elements
[INFO] Kmeans Cluster 7: 206 elements
[INFO] Kmeans Cluster 8: 181 elements
[INFO] Kmeans Cluster 9: 161 elements
[INFO] Kmeans Cluster 10: 228 elements
[INFO] Kmeans Cluster 11: 294 elements
[INFO] Kmeans Cluster 12: 194 elements
[INFO] Kmeans Cluster 13: 250 elements
[INFO] Kmeans Cluster 14: 176 elements
[INFO] Kmeans Cluster 15: 129 elements
[INFO] Kmeans Cluster 16: 214 elements
[INFO] Kmeans Cluster 17: 220 elements
[INFO] Kmeans Cluster 18: 169 elements
[INFO] Kmeans Cluster 19: 270 elements
[INFO] Kmeans Cluster 20: 146 elements
[INFO] Kmeans Cluster 21: 286 elements
[INFO] Kmeans Cluster 22: 136 elements
[INFO] Kmeans Cluster 23: 323 elements
[INFO] Kmeans Cluster 24: 162 elements
[INFO] Kmeans Cluster 25: 176 elements
[INFO] Kmeans Cluster 26: 148 elements
[INFO] Kmeans Cluster 27: 210 elements
[INFO] Kmeans Cluster 28: 236 elements
[INFO] Kmeans Cluster 29: 207 elements
[INFO] Kmeans Cluster 30: 141 elements
[INFO] Kmeans Cluster 31: 292 elements
[INFO] Kmeans Cluster 32: 122 elements
[INFO] Kmeans Cluster 33: 161 elements
[INFO] Kmeans Cluster 34: 258 elements
[INFO] Kmeans Cluster 35: 157 elements
[INFO] Kmeans Cluster 36: 244 elements
[INFO] Kmeans Cluster 37: 136 elements
[INFO] Kmeans Cluster 38: 150 elements
[INFO] Kmeans Cluster 39: 252 elements
[INFO] Kmeans Cluster 40: 201 elements
[INFO] Kmeans Cluster 41: 267 elements
[INFO] Kmeans Cluster 42: 152 elements
[INFO] Kmeans Cluster 43: 266 elements
[INFO] Kmeans Cluster 44: 257 elements
[INFO] Kmeans Cluster 45: 161 elements
[INFO] Kmeans Cluster 46: 43 elements
[INFO] Kmeans Cluster 47: 141 elements
[INFO] Kmeans Cluster 48: 216 elements
[INFO] Kmeans Cluster 49: 175 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=29.18, Long SMA=85.37, Sharpe=0.0698
[INFO] Centroid 1: Short SMA=121.81, Long SMA=272.66, Sharpe=0.1951
[INFO] Centroid 2: Short SMA=214.18, Long SMA=279.25, Sharpe=-0.2431
[INFO] Centroid 3: Short SMA=141.99, Long SMA=225.80, Sharpe=0.2254
[INFO] Centroid 4: Short SMA=47.15, Long SMA=184.95, Sharpe=0.1894
[INFO] Centroid 5: Short SMA=73.60, Long SMA=291.28, Sharpe=-0.0192
[INFO] Centroid 6: Short SMA=124.34, Long SMA=149.37, Sharpe=0.0877
[INFO] Centroid 7: Short SMA=18.84, Long SMA=183.12, Sharpe=0.3788
[INFO] Centroid 8: Short SMA=92.34, Long SMA=138.49, Sharpe=-0.2527
[INFO] Centroid 9: Short SMA=143.02, Long SMA=177.50, Sharpe=0.4677
[INFO] Centroid 10: Short SMA=27.93, Long SMA=56.02, Sharpe=0.2591
[INFO] Centroid 11: Short SMA=177.15, Long SMA=284.39, Sharpe=0.0241
[INFO] Centroid 12: Short SMA=27.51, Long SMA=211.36, Sharpe=0.2888
[INFO] Centroid 13: Short SMA=47.10, Long SMA=231.63, Sharpe=0.4031
[INFO] Centroid 14: Short SMA=259.80, Long SMA=277.83, Sharpe=-0.3927
[INFO] Centroid 15: Short SMA=271.67, Long SMA=291.61, Sharpe=-0.5494
[INFO] Centroid 16: Short SMA=97.71, Long SMA=121.80, Sharpe=-0.1057
[INFO] Centroid 17: Short SMA=23.82, Long SMA=244.40, Sharpe=0.3005
[INFO] Centroid 18: Short SMA=192.66, Long SMA=233.43, Sharpe=0.0800
[INFO] Centroid 19: Short SMA=220.69, Long SMA=243.66, Sharpe=-0.1465
[INFO] Centroid 20: Short SMA=143.49, Long SMA=293.16, Sharpe=-0.0662
[INFO] Centroid 21: Short SMA=119.89, Long SMA=193.93, Sharpe=0.3556
[INFO] Centroid 22: Short SMA=16.88, Long SMA=124.21, Sharpe=-0.0200
[INFO] Centroid 23: Short SMA=38.94, Long SMA=155.93, Sharpe=0.2818
[INFO] Centroid 24: Short SMA=95.09, Long SMA=179.68, Sharpe=0.1961
[INFO] Centroid 25: Short SMA=22.92, Long SMA=48.60, Sharpe=0.4054
[INFO] Centroid 26: Short SMA=53.09, Long SMA=94.55, Sharpe=0.3297
[INFO] Centroid 27: Short SMA=219.49, Long SMA=285.21, Sharpe=-0.1176
[INFO] Centroid 28: Short SMA=70.35, Long SMA=192.51, Sharpe=0.0800
[INFO] Centroid 29: Short SMA=30.86, Long SMA=125.73, Sharpe=0.1486
[INFO] Centroid 30: Short SMA=108.62, Long SMA=208.26, Sharpe=0.4622
[INFO] Centroid 31: Short SMA=166.38, Long SMA=204.83, Sharpe=0.3530
[INFO] Centroid 32: Short SMA=63.39, Long SMA=93.15, Sharpe=-0.1464
[INFO] Centroid 33: Short SMA=115.91, Long SMA=288.12, Sharpe=0.0591
[INFO] Centroid 34: Short SMA=67.98, Long SMA=117.37, Sharpe=-0.0173
[INFO] Centroid 35: Short SMA=83.77, Long SMA=166.19, Sharpe=-0.0663
[INFO] Centroid 36: Short SMA=179.43, Long SMA=261.34, Sharpe=0.1626
[INFO] Centroid 37: Short SMA=151.40, Long SMA=176.71, Sharpe=0.6228
[INFO] Centroid 38: Short SMA=68.65, Long SMA=216.95, Sharpe=0.2538
[INFO] Centroid 39: Short SMA=189.62, Long SMA=209.44, Sharpe=0.2239
[INFO] Centroid 40: Short SMA=245.43, Long SMA=273.84, Sharpe=-0.2725
[INFO] Centroid 41: Short SMA=160.81, Long SMA=245.60, Sharpe=0.3020
[INFO] Centroid 42: Short SMA=67.00, Long SMA=144.03, Sharpe=0.0940
[INFO] Centroid 43: Short SMA=68.12, Long SMA=271.36, Sharpe=0.1260
[INFO] Centroid 44: Short SMA=29.37, Long SMA=270.45, Sharpe=0.4069
[INFO] Centroid 45: Short SMA=27.55, Long SMA=288.56, Sharpe=0.2240
[INFO] Centroid 46: Short SMA=24.79, Long SMA=40.09, Sharpe=0.6262
[INFO] Centroid 47: Short SMA=127.91, Long SMA=148.61, Sharpe=0.2615
[INFO] Centroid 48: Short SMA=76.94, Long SMA=250.64, Sharpe=0.2934
[INFO] Centroid 49: Short SMA=58.15, Long SMA=88.77, Sharpe=0.1619
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=22, Long SMA=28, Sharpe=0.8900, Trades=121
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=152, Long SMA=176, Sharpe=0.5859, Trades=25
[INFO] Kmeans Top 2: Short SMA=24, Long SMA=42, Sharpe=0.5840, Trades=71
[INFO] Kmeans Top 3: Short SMA=140, Long SMA=176, Sharpe=0.4910, Trades=21
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=270, Sharpe=0.4418, Trades=14
[INFO] Kmeans Top 5: Short SMA=110, Long SMA=208, Sharpe=0.4312, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (29, 85)
[INFO]   Nearest: (30.0, 86.0)
[INFO]   Rounded: (122, 273)
[INFO]   Nearest: (122.0, 272.0)
[INFO]   Rounded: (214, 279)
[INFO]   Nearest: (214.0, 280.0)
[INFO]   Rounded: (142, 226)
[INFO]   Rounded: (47, 185)
[INFO]   Nearest: (48.0, 184.0)
[INFO]   Rounded: (74, 291)
[INFO]   Nearest: (74.0, 292.0)
[INFO]   Rounded: (124, 149)
[INFO]   Nearest: (124.0, 150.0)
[INFO]   Rounded: (19, 183)
[INFO]   Nearest: (18.0, 184.0)
[INFO]   Rounded: (92, 138)
[INFO]   Rounded: (143, 178)
[INFO]   Nearest: (144.0, 178.0)
[INFO]   Rounded: (28, 56)
[INFO]   Rounded: (177, 284)
[INFO]   Nearest: (178.0, 284.0)
[INFO]   Rounded: (28, 211)
[INFO]   Nearest: (28.0, 212.0)
[INFO]   Rounded: (47, 232)
[INFO]   Nearest: (48.0, 232.0)
[INFO]   Rounded: (260, 278)
[INFO]   Rounded: (272, 292)
[INFO]   Rounded: (98, 122)
[INFO]   Rounded: (24, 244)
[INFO]   Rounded: (193, 233)
[INFO]   Nearest: (192.0, 234.0)
[INFO]   Rounded: (221, 244)
[INFO]   Nearest: (220.0, 244.0)
[INFO]   Rounded: (143, 293)
[INFO]   Nearest: (144.0, 294.0)
[INFO]   Rounded: (120, 194)
[INFO]   Rounded: (17, 124)
[INFO]   Nearest: (16.0, 124.0)
[INFO]   Rounded: (39, 156)
[INFO]   Nearest: (38.0, 156.0)
[INFO]   Rounded: (95, 180)
[INFO]   Nearest: (96.0, 180.0)
[INFO]   Rounded: (23, 49)
[INFO]   Nearest: (22.0, 48.0)
[INFO]   Rounded: (53, 95)
[INFO]   Nearest: (54.0, 94.0)
[INFO]   Rounded: (219, 285)
[INFO]   Nearest: (220.0, 286.0)
[INFO]   Rounded: (70, 193)
[INFO]   Nearest: (70.0, 192.0)
[INFO]   Rounded: (31, 126)
[INFO]   Nearest: (30.0, 126.0)
[INFO]   Rounded: (109, 208)
[INFO]   Nearest: (108.0, 208.0)
[INFO]   Rounded: (166, 205)
[INFO]   Nearest: (166.0, 204.0)
[INFO]   Rounded: (63, 93)
[INFO]   Nearest: (64.0, 94.0)
[INFO]   Rounded: (116, 288)
[INFO]   Rounded: (68, 117)
[INFO]   Nearest: (68.0, 118.0)
[INFO]   Rounded: (84, 166)
[INFO]   Rounded: (179, 261)
[INFO]   Nearest: (180.0, 262.0)
[INFO]   Rounded: (151, 177)
[INFO]   Nearest: (152.0, 176.0)
[INFO]   Rounded: (69, 217)
[INFO]   Nearest: (68.0, 216.0)
[INFO]   Rounded: (190, 209)
[INFO]   Nearest: (190.0, 210.0)
[INFO]   Rounded: (245, 274)
[INFO]   Nearest: (246.0, 274.0)
[INFO]   Rounded: (161, 246)
[INFO]   Nearest: (160.0, 246.0)
[INFO]   Rounded: (67, 144)
[INFO]   Nearest: (68.0, 144.0)
[INFO]   Rounded: (68, 271)
[INFO]   Nearest: (68.0, 272.0)
[INFO]   Rounded: (29, 270)
[INFO]   Nearest: (30.0, 270.0)
[INFO]   Rounded: (28, 289)
[INFO]   Nearest: (28.0, 288.0)
[INFO]   Rounded: (25, 40)
[INFO]   Nearest: (24.0, 40.0)
[INFO]   Rounded: (128, 149)
[INFO]   Nearest: (128.0, 148.0)
[INFO]   Rounded: (77, 251)
[INFO]   Nearest: (76.0, 250.0)
[INFO]   Rounded: (58, 89)
[INFO]   Nearest: (58.0, 88.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 22, Long SMA: 28
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(152/176) - Original Sharpe: 0.5859, Trades: 25
[INFO] Kmeans cluster 2: SMA(24/42) - Original Sharpe: 0.5840, Trades: 71
[INFO] Kmeans cluster 3: SMA(140/176) - Original Sharpe: 0.4910, Trades: 21
[INFO] Kmeans cluster 4: SMA(30/270) - Original Sharpe: 0.4418, Trades: 14
[INFO] Kmeans cluster 5: SMA(110/208) - Original Sharpe: 0.4312, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (22/28)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (152/176) - Sharpe: 0.5859
[INFO] cluster 2: (24/42) - Sharpe: 0.5840
[INFO] cluster 3: (140/176) - Sharpe: 0.4910
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     2.591859            2.613218
1    2021-11-14 2021-11-14            43     2.356142            0.840616
2    2022-01-14 2022-01-14            41     3.996440            3.996440
3    2022-03-14 2022-03-14            44     1.386441            3.521776
4    2022-05-14 2022-05-14            43    -1.122388           -0.011332
5    2022-07-14 2022-07-14            44    -2.969387           -1.565247
6    2022-09-14 2022-09-14            43    -2.635788            0.952403
7    2022-11-14 2022-11-14            43     0.035722           -1.946191
8    2023-01-14 2023-01-14            41     0.459261            0.911892
9    2023-03-14 2023-03-14            43    -2.585156           -2.585185
10   2023-05-14 2023-05-14            44     1.833453           -2.271341
11   2023-07-14 2023-07-14            44     5.432989           -5.432989
12   2023-09-14 2023-09-14            43    -0.091949           -0.864588
13   2023-11-14 2023-11-14            42     0.208767           -0.526956
14   2024-01-14 2024-01-14            43    -1.397108            0.671357
15   2024-03-14 2024-03-14            42    -3.827908            3.263279
16   2024-05-14 2024-05-14            44    -2.752596           -1.309922
17   2024-07-14 2024-07-14            45     2.695689            1.011504
18   2024-09-14 2024-09-14            43    -2.556363           -0.694579
19   2024-11-14 2024-11-14            33    -4.535438           -1.436543
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          2.4 |              0.8 |         -1.6 | False         
[INFO] 2022-01-14   |          4.0 |              4.0 |          0.0 | Excluded      
[INFO] 2022-03-14   |          1.4 |              3.5 |          2.1 | True          
[INFO] 2022-05-14   |         -1.1 |             -0.0 |          1.1 | True          
[INFO] 2022-07-14   |         -3.0 |             -1.6 |          1.4 | True          
[INFO] 2022-09-14   |         -2.6 |              1.0 |          3.6 | True          
[INFO] 2022-11-14   |          0.0 |             -1.9 |         -1.9 | False         
[INFO] 2023-01-14   |          0.5 |              0.9 |          0.4 | True          
[INFO] 2023-03-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2023-05-14   |          1.8 |             -2.3 |         -4.1 | False         
[INFO] 2023-07-14   |          5.4 |             -5.4 |        -10.8 | False         
[INFO] 2023-09-14   |         -0.1 |             -0.9 |         -0.8 | False         
[INFO] 2023-11-14   |          0.2 |             -0.5 |         -0.7 | False         
[INFO] 2024-01-14   |         -1.4 |              0.7 |          2.1 | True          
[INFO] 2024-03-14   |         -3.8 |              3.3 |          7.1 | True          
[INFO] 2024-05-14   |         -2.8 |             -1.3 |          1.5 | True          
[INFO] 2024-07-14   |          2.7 |              1.0 |         -1.7 | False         
[INFO] 2024-09-14   |         -2.6 |             -0.7 |          1.9 | True          
[INFO] 2024-11-14   |         -4.5 |             -1.4 |          3.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-01-14, 2023-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 10 of 17 periods (58.82% win rate)
[INFO] Updating Excel file with Kmeans results for HO...
[INFO] Excel file updated successfully. Added HO with Kmeans win rate 58.8% in row 25
[INFO] Added best Sharpe parameters 22/28 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 22, Long SMA: 28
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(152/176) - Original Sharpe: 0.5859
[INFO] Added cluster 2 to portfolio: SMA(24/42) - Original Sharpe: 0.5840
[INFO] Added cluster 3 to portfolio: SMA(140/176) - Original Sharpe: 0.4910
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HO_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.6774
[INFO] Kmeans Best out-of-sample Sharpe: 0.3460
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for HO...
[INFO] Excel file updated successfully. Added HO with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HO
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7969 to 0.8900
[INFO] 
Best parameters:
[INFO] Short SMA: 22
[INFO] Long SMA: 28
[INFO] Sharpe Ratio: 0.889954
[INFO] Number of Trades: 121
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10027 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7969 to 0.8900
[INFO] Trades range: 10.0 to 331.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3615 to 2.7312
[INFO] Scaled Long SMA range: -2.7206 to 1.4041
[INFO] Scaled Sharpe ratio range: -4.1113 to 3.2767
[INFO] Scaled Trades range: -0.7449 to 16.2358
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10027 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5757
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 302 elements
[INFO] Cluster 1: 143 elements
[INFO] Cluster 2: 410 elements
[INFO] Cluster 3: 68 elements
[INFO] Cluster 4: 289 elements
[INFO] Cluster 5: 307 elements
[INFO] Cluster 6: 347 elements
[INFO] Cluster 7: 541 elements
[INFO] Cluster 8: 267 elements
[INFO] Cluster 9: 61 elements
[INFO] Cluster 10: 99 elements
[INFO] Cluster 11: 327 elements
[INFO] Cluster 12: 225 elements
[INFO] Cluster 13: 430 elements
[INFO] Cluster 14: 380 elements
[INFO] Cluster 15: 24 elements
[INFO] Cluster 16: 259 elements
[INFO] Cluster 17: 173 elements
[INFO] Cluster 18: 366 elements
[INFO] Cluster 19: 261 elements
[INFO] Cluster 20: 310 elements
[INFO] Cluster 21: 20 elements
[INFO] Cluster 22: 117 elements
[INFO] Cluster 23: 215 elements
[INFO] Cluster 24: 327 elements
[INFO] Cluster 25: 131 elements
[INFO] Cluster 26: 8 elements
[INFO] Cluster 27: 265 elements
[INFO] Cluster 28: 50 elements
[INFO] Cluster 29: 225 elements
[INFO] Cluster 30: 48 elements
[INFO] Cluster 31: 270 elements
[INFO] Cluster 32: 192 elements
[INFO] Cluster 33: 168 elements
[INFO] Cluster 34: 133 elements
[INFO] Cluster 35: 310 elements
[INFO] Cluster 36: 245 elements
[INFO] Cluster 37: 231 elements
[INFO] Cluster 38: 207 elements
[INFO] Cluster 39: 90 elements
[INFO] Cluster 40: 277 elements
[INFO] Cluster 41: 69 elements
[INFO] Cluster 42: 44 elements
[INFO] Cluster 43: 32 elements
[INFO] Cluster 44: 254 elements
[INFO] Cluster 45: 158 elements
[INFO] Cluster 46: 92 elements
[INFO] Cluster 47: 109 elements
[INFO] Cluster 48: 149 elements
[INFO] Cluster 49: 2 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=40, Long SMA=130, Sharpe=0.1646, Trades=28
[INFO] Cluster 1 cluster: Short SMA=270, Long SMA=276, Sharpe=-0.6122, Trades=36
[INFO] Cluster 2 cluster: Short SMA=68, Long SMA=230, Sharpe=0.2279, Trades=12
[INFO] Cluster 3 cluster: Short SMA=126, Long SMA=132, Sharpe=0.0847, Trades=67
[INFO] Cluster 4 cluster: Short SMA=192, Long SMA=212, Sharpe=0.2537, Trades=22
[INFO] Cluster 5 cluster: Short SMA=94, Long SMA=142, Sharpe=-0.2625, Trades=25
[INFO] Cluster 6 cluster: Short SMA=64, Long SMA=122, Sharpe=-0.0503, Trades=26
[INFO] Cluster 7 cluster: Short SMA=152, Long SMA=234, Sharpe=0.1638, Trades=11
[INFO] Cluster 8 cluster: Short SMA=124, Long SMA=154, Sharpe=0.1572, Trades=27
[INFO] Cluster 9 cluster: Short SMA=28, Long SMA=34, Sharpe=0.1916, Trades=107
[INFO] Cluster 10 cluster: Short SMA=42, Long SMA=66, Sharpe=0.0341, Trades=54
[INFO] Cluster 11 cluster: Short SMA=188, Long SMA=252, Sharpe=0.1548, Trades=18
[INFO] Cluster 12 cluster: Short SMA=22, Long SMA=104, Sharpe=-0.1021, Trades=41
[INFO] Cluster 13 cluster: Short SMA=40, Long SMA=254, Sharpe=0.3902, Trades=14
[INFO] Cluster 14 cluster: Short SMA=112, Long SMA=200, Sharpe=0.4476, Trades=13
[INFO] Cluster 15 cluster: Short SMA=24, Long SMA=30, Sharpe=0.6863, Trades=115
[INFO] Cluster 16 cluster: Short SMA=78, Long SMA=292, Sharpe=0.0038, Trades=12
[INFO] Cluster 17 cluster: Short SMA=28, Long SMA=52, Sharpe=0.3268, Trades=59
[INFO] Cluster 18 cluster: Short SMA=172, Long SMA=286, Sharpe=-0.0069, Trades=10
[INFO] Cluster 19 cluster: Short SMA=236, Long SMA=278, Sharpe=-0.3071, Trades=18
[INFO] Cluster 20 cluster: Short SMA=68, Long SMA=270, Sharpe=0.0885, Trades=12
[INFO] Cluster 21 cluster: Short SMA=20, Long SMA=24, Sharpe=0.0682, Trades=159
[INFO] Cluster 22 cluster: Short SMA=30, Long SMA=68, Sharpe=0.3070, Trades=47
[INFO] Cluster 23 cluster: Short SMA=126, Long SMA=292, Sharpe=0.0035, Trades=10
[INFO] Cluster 24 cluster: Short SMA=78, Long SMA=188, Sharpe=0.0945, Trades=15
[INFO] Cluster 25 cluster: Short SMA=104, Long SMA=124, Sharpe=-0.0973, Trades=36
[INFO] Cluster 27 cluster: Short SMA=126, Long SMA=272, Sharpe=0.1420, Trades=10
[INFO] Cluster 28 cluster: Short SMA=164, Long SMA=168, Sharpe=0.5808, Trades=47
[INFO] Cluster 29 cluster: Short SMA=28, Long SMA=288, Sharpe=0.3549, Trades=16
[INFO] Cluster 30 cluster: Short SMA=98, Long SMA=102, Sharpe=-0.0429, Trades=77
[INFO] Cluster 31 cluster: Short SMA=46, Long SMA=88, Sharpe=0.1721, Trades=35
[INFO] Cluster 32 cluster: Short SMA=262, Long SMA=288, Sharpe=-0.4345, Trades=22
[INFO] Cluster 33 cluster: Short SMA=20, Long SMA=202, Sharpe=0.4632, Trades=15
[INFO] Cluster 34 cluster: Short SMA=152, Long SMA=178, Sharpe=0.6182, Trades=25
[INFO] Cluster 35 cluster: Short SMA=220, Long SMA=250, Sharpe=-0.1696, Trades=22
[INFO] Cluster 36 cluster: Short SMA=20, Long SMA=236, Sharpe=0.3021, Trades=19
[INFO] Cluster 37 cluster: Short SMA=44, Long SMA=190, Sharpe=0.1762, Trades=15
[INFO] Cluster 38 cluster: Short SMA=218, Long SMA=288, Sharpe=-0.1592, Trades=16
[INFO] Cluster 39 cluster: Short SMA=42, Long SMA=112, Sharpe=0.3756, Trades=30
[INFO] Cluster 40 cluster: Short SMA=44, Long SMA=158, Sharpe=0.2869, Trades=18
[INFO] Cluster 41 cluster: Short SMA=20, Long SMA=38, Sharpe=0.2497, Trades=79
[INFO] Cluster 42 cluster: Short SMA=228, Long SMA=232, Sharpe=-0.2407, Trades=42
[INFO] Cluster 43 cluster: Short SMA=190, Long SMA=192, Sharpe=0.1161, Trades=51
[INFO] Cluster 44 cluster: Short SMA=162, Long SMA=198, Sharpe=0.2944, Trades=19
[INFO] Cluster 45 cluster: Short SMA=130, Long SMA=176, Sharpe=0.5134, Trades=23
[INFO] Cluster 46 cluster: Short SMA=92, Long SMA=104, Sharpe=-0.1007, Trades=48
[INFO] Cluster 47 cluster: Short SMA=74, Long SMA=174, Sharpe=-0.1523, Trades=17
[INFO] Cluster 48 cluster: Short SMA=18, Long SMA=168, Sharpe=0.3844, Trades=25
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=22, Long SMA=28, Sharpe=0.8900, Trades=121
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=24, Long SMA=30, Sharpe=0.6863, Trades=115
[INFO] Top 2: Short SMA=152, Long SMA=178, Sharpe=0.6182, Trades=25
[INFO] Top 3: Short SMA=164, Long SMA=168, Sharpe=0.5808, Trades=47
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10017 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 22, Long SMA: 28
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(24/30) - Original Sharpe: 0.6863, Trades: 115
[INFO] Hierarchical cluster 2: SMA(152/178) - Original Sharpe: 0.6182, Trades: 25
[INFO] Hierarchical cluster 3: SMA(164/168) - Original Sharpe: 0.5808, Trades: 47
[INFO] Hierarchical cluster 4: SMA(130/176) - Original Sharpe: 0.5134, Trades: 23
[INFO] Hierarchical cluster 5: SMA(20/202) - Original Sharpe: 0.4632, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (22/28)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/30) - Sharpe: 0.6863
[INFO] cluster 2: (152/178) - Sharpe: 0.6182
[INFO] cluster 3: (164/168) - Sharpe: 0.5808
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     2.591859            2.591859
1    2021-11-14 2021-11-14            43     2.356142            1.339783
2    2022-01-14 2022-01-14            41     3.996440            3.996440
3    2022-03-14 2022-03-14            44     1.386441            2.682058
4    2022-05-14 2022-05-14            43    -1.122388            0.383530
5    2022-07-14 2022-07-14            44    -2.969387           -1.988646
6    2022-09-14 2022-09-14            43    -2.635788           -0.506471
7    2022-11-14 2022-11-14            43     0.035722           -2.353818
8    2023-01-14 2023-01-14            41     0.459261            3.243244
9    2023-03-14 2023-03-14            43    -2.585156           -1.421376
10   2023-05-14 2023-05-14            44     1.833453           -1.005170
11   2023-07-14 2023-07-14            44     5.432989           -4.516900
12   2023-09-14 2023-09-14            43    -0.091949           -0.484029
13   2023-11-14 2023-11-14            42     0.208767           -1.301032
14   2024-01-14 2024-01-14            43    -1.397108            0.657853
15   2024-03-14 2024-03-14            42    -3.827908            2.435903
16   2024-05-14 2024-05-14            44    -2.752596           -1.462517
17   2024-07-14 2024-07-14            45     2.695689            1.571657
18   2024-09-14 2024-09-14            43    -2.556363           -2.104434
19   2024-11-14 2024-11-14            33    -4.535438           -2.939545
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          2.4 |              1.3 |         -1.1 | False         
[INFO] 2022-01-14   |          4.0 |              4.0 |          0.0 | Excluded      
[INFO] 2022-03-14   |          1.4 |              2.7 |          1.3 | True          
[INFO] 2022-05-14   |         -1.1 |              0.4 |          1.5 | True          
[INFO] 2022-07-14   |         -3.0 |             -2.0 |          1.0 | True          
[INFO] 2022-09-14   |         -2.6 |             -0.5 |          2.1 | True          
[INFO] 2022-11-14   |          0.0 |             -2.4 |         -2.4 | False         
[INFO] 2023-01-14   |          0.5 |              3.2 |          2.7 | True          
[INFO] 2023-03-14   |         -2.6 |             -1.4 |          1.2 | True          
[INFO] 2023-05-14   |          1.8 |             -1.0 |         -2.8 | False         
[INFO] 2023-07-14   |          5.4 |             -4.5 |         -9.9 | False         
[INFO] 2023-09-14   |         -0.1 |             -0.5 |         -0.4 | False         
[INFO] 2023-11-14   |          0.2 |             -1.3 |         -1.5 | False         
[INFO] 2024-01-14   |         -1.4 |              0.7 |          2.1 | True          
[INFO] 2024-03-14   |         -3.8 |              2.4 |          6.2 | True          
[INFO] 2024-05-14   |         -2.8 |             -1.5 |          1.3 | True          
[INFO] 2024-07-14   |          2.7 |              1.6 |         -1.1 | False         
[INFO] 2024-09-14   |         -2.6 |             -2.1 |          0.5 | True          
[INFO] 2024-11-14   |         -4.5 |             -2.9 |          1.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 18 periods (61.11% win rate)
[INFO] Updating Excel file with Hierarchical results for HO...
[INFO] Excel file updated successfully. Added HO with Hierarchical win rate 61.1% in row 25
[INFO] Added best Sharpe parameters 22/28 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 22, Long SMA: 28
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/30) - Original Sharpe: 0.6863
[INFO] Added cluster 2 to portfolio: SMA(152/178) - Original Sharpe: 0.6182
[INFO] Added cluster 3 to portfolio: SMA(164/168) - Original Sharpe: 0.5808
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HO_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.6101
[INFO] Hierarchical Best out-of-sample Sharpe: 0.3460
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for HO...
[INFO] Excel file updated successfully. Added HO with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HO
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for JY in column D: 9.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 70.17s
[INFO] Best parameters: Short SMA = 58, Long SMA = 60
[INFO] Best Sharpe ratio: 0.628631, Trades: 140
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 97 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @JY
[INFO] Big Point Value (from data): 125000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.36 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $621,660.50
[INFO] Market Buy & Hold P&L: $-63,037.50
[INFO] Outperformance: $684,698.00
[INFO] Sharpe ratio (entire period, annualized): 0.689477
[INFO] Sharpe ratio (in-sample, annualized): 0.628631
[INFO] Sharpe ratio (out-of-sample, annualized): 0.827503
[INFO] Maximum Drawdown: $158,630.25
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 109
[INFO] Out-of-sample period trades: 31
[INFO] Total trades: 140
[INFO] In-sample P&L: $348,546.00
[INFO] Out-of-sample P&L: $201,967.50
[INFO] 
Best parameters from GA: Short SMA = 58, Long SMA = 60, Sharpe = 0.628631
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6534 to 0.6286
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 60
[INFO] Sharpe Ratio: 0.628631
[INFO] Number of Trades: 140
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10488 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6534 to 0.6286
[INFO] Trades range: 10.0 to 360.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3975 to 2.7853
[INFO] Scaled Long SMA range: -2.7975 to 1.4174
[INFO] Scaled Sharpe ratio range: -2.7947 to 4.8392
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 276 elements
[INFO] Kmeans Cluster 1: 283 elements
[INFO] Kmeans Cluster 2: 73 elements
[INFO] Kmeans Cluster 3: 209 elements
[INFO] Kmeans Cluster 4: 213 elements
[INFO] Kmeans Cluster 5: 297 elements
[INFO] Kmeans Cluster 6: 240 elements
[INFO] Kmeans Cluster 7: 215 elements
[INFO] Kmeans Cluster 8: 184 elements
[INFO] Kmeans Cluster 9: 199 elements
[INFO] Kmeans Cluster 10: 245 elements
[INFO] Kmeans Cluster 11: 229 elements
[INFO] Kmeans Cluster 12: 276 elements
[INFO] Kmeans Cluster 13: 219 elements
[INFO] Kmeans Cluster 14: 351 elements
[INFO] Kmeans Cluster 15: 65 elements
[INFO] Kmeans Cluster 16: 253 elements
[INFO] Kmeans Cluster 17: 263 elements
[INFO] Kmeans Cluster 18: 284 elements
[INFO] Kmeans Cluster 19: 205 elements
[INFO] Kmeans Cluster 20: 69 elements
[INFO] Kmeans Cluster 21: 214 elements
[INFO] Kmeans Cluster 22: 301 elements
[INFO] Kmeans Cluster 23: 276 elements
[INFO] Kmeans Cluster 24: 250 elements
[INFO] Kmeans Cluster 25: 210 elements
[INFO] Kmeans Cluster 26: 142 elements
[INFO] Kmeans Cluster 27: 128 elements
[INFO] Kmeans Cluster 28: 148 elements
[INFO] Kmeans Cluster 29: 198 elements
[INFO] Kmeans Cluster 30: 274 elements
[INFO] Kmeans Cluster 31: 229 elements
[INFO] Kmeans Cluster 32: 291 elements
[INFO] Kmeans Cluster 33: 159 elements
[INFO] Kmeans Cluster 34: 220 elements
[INFO] Kmeans Cluster 35: 174 elements
[INFO] Kmeans Cluster 36: 106 elements
[INFO] Kmeans Cluster 37: 164 elements
[INFO] Kmeans Cluster 38: 210 elements
[INFO] Kmeans Cluster 39: 158 elements
[INFO] Kmeans Cluster 40: 147 elements
[INFO] Kmeans Cluster 41: 300 elements
[INFO] Kmeans Cluster 42: 230 elements
[INFO] Kmeans Cluster 43: 212 elements
[INFO] Kmeans Cluster 44: 235 elements
[INFO] Kmeans Cluster 45: 160 elements
[INFO] Kmeans Cluster 46: 256 elements
[INFO] Kmeans Cluster 47: 114 elements
[INFO] Kmeans Cluster 48: 147 elements
[INFO] Kmeans Cluster 49: 187 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=112.98, Long SMA=234.70, Sharpe=-0.1396
[INFO] Centroid 1: Short SMA=96.61, Long SMA=166.07, Sharpe=-0.2719
[INFO] Centroid 2: Short SMA=43.32, Long SMA=63.32, Sharpe=0.3446
[INFO] Centroid 3: Short SMA=180.16, Long SMA=275.66, Sharpe=-0.2261
[INFO] Centroid 4: Short SMA=37.21, Long SMA=108.51, Sharpe=-0.0509
[INFO] Centroid 5: Short SMA=164.57, Long SMA=198.37, Sharpe=-0.3738
[INFO] Centroid 6: Short SMA=55.43, Long SMA=226.49, Sharpe=-0.3119
[INFO] Centroid 7: Short SMA=218.28, Long SMA=263.04, Sharpe=-0.0371
[INFO] Centroid 8: Short SMA=26.96, Long SMA=232.85, Sharpe=-0.1064
[INFO] Centroid 9: Short SMA=129.56, Long SMA=200.16, Sharpe=-0.4882
[INFO] Centroid 10: Short SMA=56.42, Long SMA=139.53, Sharpe=-0.2236
[INFO] Centroid 11: Short SMA=71.72, Long SMA=271.40, Sharpe=-0.2834
[INFO] Centroid 12: Short SMA=36.36, Long SMA=75.62, Sharpe=0.0608
[INFO] Centroid 13: Short SMA=104.57, Long SMA=132.72, Sharpe=-0.1935
[INFO] Centroid 14: Short SMA=24.39, Long SMA=276.43, Sharpe=-0.0207
[INFO] Centroid 15: Short SMA=18.80, Long SMA=30.58, Sharpe=-0.3307
[INFO] Centroid 16: Short SMA=77.39, Long SMA=110.42, Sharpe=-0.3061
[INFO] Centroid 17: Short SMA=134.69, Long SMA=286.20, Sharpe=-0.2691
[INFO] Centroid 18: Short SMA=212.02, Long SMA=239.01, Sharpe=-0.1637
[INFO] Centroid 19: Short SMA=96.99, Long SMA=232.64, Sharpe=-0.2310
[INFO] Centroid 20: Short SMA=248.38, Long SMA=270.58, Sharpe=0.2929
[INFO] Centroid 21: Short SMA=171.13, Long SMA=213.47, Sharpe=-0.4904
[INFO] Centroid 22: Short SMA=103.92, Long SMA=274.28, Sharpe=-0.1688
[INFO] Centroid 23: Short SMA=152.55, Long SMA=238.33, Sharpe=-0.2401
[INFO] Centroid 24: Short SMA=59.62, Long SMA=175.42, Sharpe=-0.3311
[INFO] Centroid 25: Short SMA=21.78, Long SMA=143.00, Sharpe=-0.0060
[INFO] Centroid 26: Short SMA=23.25, Long SMA=44.82, Sharpe=-0.0997
[INFO] Centroid 27: Short SMA=135.23, Long SMA=148.75, Sharpe=0.0353
[INFO] Centroid 28: Short SMA=251.61, Long SMA=274.66, Sharpe=0.0932
[INFO] Centroid 29: Short SMA=144.21, Long SMA=175.90, Sharpe=-0.2342
[INFO] Centroid 30: Short SMA=193.89, Long SMA=231.28, Sharpe=-0.2937
[INFO] Centroid 31: Short SMA=179.90, Long SMA=279.93, Sharpe=-0.1334
[INFO] Centroid 32: Short SMA=27.20, Long SMA=81.06, Sharpe=0.1845
[INFO] Centroid 33: Short SMA=244.24, Long SMA=283.67, Sharpe=-0.2585
[INFO] Centroid 34: Short SMA=62.77, Long SMA=199.79, Sharpe=-0.4094
[INFO] Centroid 35: Short SMA=134.89, Long SMA=156.37, Sharpe=-0.0946
[INFO] Centroid 36: Short SMA=81.87, Long SMA=102.77, Sharpe=-0.4497
[INFO] Centroid 37: Short SMA=267.94, Long SMA=289.68, Sharpe=-0.0825
[INFO] Centroid 38: Short SMA=152.02, Long SMA=267.89, Sharpe=-0.3707
[INFO] Centroid 39: Short SMA=14.84, Long SMA=219.15, Sharpe=0.0244
[INFO] Centroid 40: Short SMA=53.46, Long SMA=97.20, Sharpe=-0.1484
[INFO] Centroid 41: Short SMA=110.51, Long SMA=193.11, Sharpe=-0.3717
[INFO] Centroid 42: Short SMA=56.45, Long SMA=241.10, Sharpe=-0.2121
[INFO] Centroid 43: Short SMA=81.52, Long SMA=143.56, Sharpe=-0.1180
[INFO] Centroid 44: Short SMA=47.74, Long SMA=280.01, Sharpe=-0.1330
[INFO] Centroid 45: Short SMA=111.58, Long SMA=262.93, Sharpe=-0.0624
[INFO] Centroid 46: Short SMA=26.87, Long SMA=164.75, Sharpe=-0.0994
[INFO] Centroid 47: Short SMA=70.64, Long SMA=200.94, Sharpe=-0.5063
[INFO] Centroid 48: Short SMA=29.96, Long SMA=193.99, Sharpe=-0.2176
[INFO] Centroid 49: Short SMA=218.90, Long SMA=285.26, Sharpe=-0.1252
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=60, Sharpe=0.6286, Trades=140
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=248, Long SMA=272, Sharpe=0.3586, Trades=20
[INFO] Kmeans Top 2: Short SMA=50, Long SMA=62, Sharpe=0.3010, Trades=60
[INFO] Kmeans Top 3: Short SMA=26, Long SMA=80, Sharpe=0.1314, Trades=34
[INFO] Kmeans Top 4: Short SMA=38, Long SMA=76, Sharpe=0.0909, Trades=32
[INFO] Kmeans Top 5: Short SMA=254, Long SMA=272, Sharpe=0.0840, Trades=22
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (113, 235)
[INFO]   Nearest: (112.0, 234.0)
[INFO]   Rounded: (97, 166)
[INFO]   Nearest: (96.0, 166.0)
[INFO]   Rounded: (43, 63)
[INFO]   Nearest: (44.0, 64.0)
[INFO]   Rounded: (180, 276)
[INFO]   Rounded: (37, 109)
[INFO]   Nearest: (38.0, 108.0)
[INFO]   Rounded: (165, 198)
[INFO]   Nearest: (164.0, 198.0)
[INFO]   Rounded: (55, 226)
[INFO]   Nearest: (56.0, 226.0)
[INFO]   Rounded: (218, 263)
[INFO]   Nearest: (218.0, 264.0)
[INFO]   Rounded: (27, 233)
[INFO]   Nearest: (26.0, 232.0)
[INFO]   Rounded: (130, 200)
[INFO]   Rounded: (56, 140)
[INFO]   Rounded: (72, 271)
[INFO]   Nearest: (72.0, 272.0)
[INFO]   Rounded: (36, 76)
[INFO]   Rounded: (105, 133)
[INFO]   Nearest: (104.0, 132.0)
[INFO]   Rounded: (24, 276)
[INFO]   Rounded: (19, 31)
[INFO]   Nearest: (18.0, 30.0)
[INFO]   Rounded: (77, 110)
[INFO]   Nearest: (78.0, 110.0)
[INFO]   Rounded: (135, 286)
[INFO]   Nearest: (134.0, 286.0)
[INFO]   Rounded: (212, 239)
[INFO]   Nearest: (212.0, 240.0)
[INFO]   Rounded: (97, 233)
[INFO]   Nearest: (96.0, 232.0)
[INFO]   Rounded: (248, 271)
[INFO]   Nearest: (248.0, 270.0)
[INFO]   Rounded: (171, 213)
[INFO]   Nearest: (172.0, 214.0)
[INFO]   Rounded: (104, 274)
[INFO]   Rounded: (153, 238)
[INFO]   Nearest: (152.0, 238.0)
[INFO]   Rounded: (60, 175)
[INFO]   Nearest: (60.0, 176.0)
[INFO]   Rounded: (22, 143)
[INFO]   Nearest: (22.0, 142.0)
[INFO]   Rounded: (23, 45)
[INFO]   Nearest: (24.0, 44.0)
[INFO]   Rounded: (135, 149)
[INFO]   Nearest: (136.0, 148.0)
[INFO]   Rounded: (252, 275)
[INFO]   Nearest: (252.0, 274.0)
[INFO]   Rounded: (144, 176)
[INFO]   Rounded: (194, 231)
[INFO]   Nearest: (194.0, 232.0)
[INFO]   Rounded: (180, 280)
[INFO]   Rounded: (27, 81)
[INFO]   Nearest: (28.0, 82.0)
[INFO]   Rounded: (244, 284)
[INFO]   Rounded: (63, 200)
[INFO]   Nearest: (62.0, 200.0)
[INFO]   Rounded: (135, 156)
[INFO]   Nearest: (134.0, 156.0)
[INFO]   Rounded: (82, 103)
[INFO]   Nearest: (82.0, 102.0)
[INFO]   Rounded: (268, 290)
[INFO]   Rounded: (152, 268)
[INFO]   Rounded: (15, 219)
[INFO]   Nearest: (14.0, 220.0)
[INFO]   Rounded: (53, 97)
[INFO]   Nearest: (54.0, 98.0)
[INFO]   Rounded: (111, 193)
[INFO]   Nearest: (110.0, 194.0)
[INFO]   Rounded: (56, 241)
[INFO]   Nearest: (56.0, 242.0)
[INFO]   Rounded: (82, 144)
[INFO]   Rounded: (48, 280)
[INFO]   Rounded: (112, 263)
[INFO]   Nearest: (112.0, 262.0)
[INFO]   Rounded: (27, 165)
[INFO]   Nearest: (26.0, 164.0)
[INFO]   Rounded: (71, 201)
[INFO]   Nearest: (70.0, 200.0)
[INFO]   Rounded: (30, 194)
[INFO]   Rounded: (219, 285)
[INFO]   Nearest: (218.0, 286.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 60
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(248/272) - Original Sharpe: 0.3586, Trades: 20
[INFO] Kmeans cluster 2: SMA(50/62) - Original Sharpe: 0.3010, Trades: 60
[INFO] Kmeans cluster 3: SMA(26/80) - Original Sharpe: 0.1314, Trades: 34
[INFO] Kmeans cluster 4: SMA(38/76) - Original Sharpe: 0.0909, Trades: 32
[INFO] Kmeans cluster 5: SMA(254/272) - Original Sharpe: 0.0840, Trades: 22
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/60)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (248/272) - Sharpe: 0.3586
[INFO] cluster 2: (50/62) - Sharpe: 0.3010
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.150748            2.947793
1    2021-11-14 2021-11-14            43     1.384297           -0.080849
2    2022-01-14 2022-01-14            41     3.292417            3.200824
3    2022-03-14 2022-03-14            44     6.956797            5.852003
4    2022-05-14 2022-05-14            43     3.536297            3.536297
5    2022-07-14 2022-07-14            44     1.924049            1.924049
6    2022-09-14 2022-09-14            43    -1.464758           -1.464758
7    2022-11-14 2022-11-14            43     3.567745           -0.017465
8    2023-01-14 2023-01-14            41    -2.381255            0.000000
9    2023-03-14 2023-03-14            44     2.565997            0.870419
10   2023-05-14 2023-05-14            44    -0.317342           -1.140137
11   2023-07-14 2023-07-14            44     5.203187            4.959094
12   2023-09-14 2023-09-14            43     3.227294            0.000000
13   2023-11-14 2023-11-14            42    -5.199080           -3.106780
14   2024-01-14 2024-01-14            43    -5.390091           -2.610137
15   2024-03-14 2024-03-14            42     4.374593            4.374593
16   2024-05-14 2024-05-14            44     1.567034            1.567034
17   2024-07-14 2024-07-14            45    -2.564883           -4.032104
18   2024-09-14 2024-09-14            43    -3.192759            1.581668
19   2024-11-14 2024-11-14            33     1.332713            1.332713
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.2 |              2.9 |          5.1 | True          
[INFO] 2021-11-14   |          1.4 |             -0.1 |         -1.5 | False         
[INFO] 2022-01-14   |          3.3 |              3.2 |         -0.1 | False         
[INFO] 2022-03-14   |          7.0 |              5.9 |         -1.1 | False         
[INFO] 2022-05-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-11-14   |          3.6 |             -0.0 |         -3.6 | False         
[INFO] 2023-01-14   |         -2.4 |              0.0 |          2.4 | True          
[INFO] 2023-03-14   |          2.6 |              0.9 |         -1.7 | False         
[INFO] 2023-05-14   |         -0.3 |             -1.1 |         -0.8 | False         
[INFO] 2023-07-14   |          5.2 |              5.0 |         -0.2 | False         
[INFO] 2023-09-14   |          3.2 |              0.0 |         -3.2 | False         
[INFO] 2023-11-14   |         -5.2 |             -3.1 |          2.1 | True          
[INFO] 2024-01-14   |         -5.4 |             -2.6 |          2.8 | True          
[INFO] 2024-03-14   |          4.4 |              4.4 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.6 |             -4.0 |         -1.4 | False         
[INFO] 2024-09-14   |         -3.2 |              1.6 |          4.8 | True          
[INFO] 2024-11-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2022-07-14, 2022-09-14, 2024-03-14, 2024-05-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 5 of 14 periods (35.71% win rate)
[INFO] Updating Excel file with Kmeans results for JY...
[INFO] Excel file updated successfully. Added JY with Kmeans win rate 35.7% in row 26
[INFO] Added best Sharpe parameters 58/60 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 60
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(248/272) - Original Sharpe: 0.3586
[INFO] Added cluster 2 to portfolio: SMA(50/62) - Original Sharpe: 0.3010
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'JY_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 1.0693
[INFO] Kmeans Best out-of-sample Sharpe: 0.8275
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for JY...
[INFO] Excel file updated successfully. Added JY with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\JY
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6534 to 0.6286
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 60
[INFO] Sharpe Ratio: 0.628631
[INFO] Number of Trades: 140
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10488 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6534 to 0.6286
[INFO] Trades range: 10.0 to 360.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3975 to 2.7853
[INFO] Scaled Long SMA range: -2.7975 to 1.4174
[INFO] Scaled Sharpe ratio range: -2.7947 to 4.8392
[INFO] Scaled Trades range: -0.7089 to 17.7531
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10488 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5236
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 88 elements
[INFO] Cluster 1: 73 elements
[INFO] Cluster 2: 327 elements
[INFO] Cluster 3: 488 elements
[INFO] Cluster 4: 297 elements
[INFO] Cluster 5: 317 elements
[INFO] Cluster 6: 22 elements
[INFO] Cluster 7: 361 elements
[INFO] Cluster 8: 292 elements
[INFO] Cluster 9: 289 elements
[INFO] Cluster 10: 145 elements
[INFO] Cluster 11: 553 elements
[INFO] Cluster 12: 65 elements
[INFO] Cluster 13: 215 elements
[INFO] Cluster 14: 383 elements
[INFO] Cluster 15: 357 elements
[INFO] Cluster 16: 115 elements
[INFO] Cluster 17: 41 elements
[INFO] Cluster 18: 370 elements
[INFO] Cluster 19: 234 elements
[INFO] Cluster 20: 255 elements
[INFO] Cluster 21: 362 elements
[INFO] Cluster 22: 263 elements
[INFO] Cluster 23: 376 elements
[INFO] Cluster 24: 241 elements
[INFO] Cluster 25: 78 elements
[INFO] Cluster 26: 86 elements
[INFO] Cluster 27: 38 elements
[INFO] Cluster 28: 268 elements
[INFO] Cluster 29: 404 elements
[INFO] Cluster 30: 3 elements
[INFO] Cluster 31: 282 elements
[INFO] Cluster 32: 261 elements
[INFO] Cluster 33: 34 elements
[INFO] Cluster 34: 316 elements
[INFO] Cluster 35: 103 elements
[INFO] Cluster 36: 181 elements
[INFO] Cluster 37: 426 elements
[INFO] Cluster 38: 170 elements
[INFO] Cluster 39: 232 elements
[INFO] Cluster 40: 40 elements
[INFO] Cluster 41: 18 elements
[INFO] Cluster 42: 98 elements
[INFO] Cluster 43: 298 elements
[INFO] Cluster 44: 19 elements
[INFO] Cluster 45: 104 elements
[INFO] Cluster 46: 199 elements
[INFO] Cluster 47: 189 elements
[INFO] Cluster 48: 15 elements
[INFO] Cluster 49: 97 elements
[INFO] Using 46 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=266, Long SMA=270, Sharpe=0.0649, Trades=52
[INFO] Cluster 1 cluster: Short SMA=26, Long SMA=40, Sharpe=-0.0436, Trades=89
[INFO] Cluster 2 cluster: Short SMA=20, Long SMA=240, Sharpe=0.0039, Trades=22
[INFO] Cluster 3 cluster: Short SMA=172, Long SMA=240, Sharpe=-0.2086, Trades=16
[INFO] Cluster 4 cluster: Short SMA=238, Long SMA=272, Sharpe=-0.0170, Trades=18
[INFO] Cluster 5 cluster: Short SMA=240, Long SMA=288, Sharpe=-0.1009, Trades=18
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=26, Sharpe=-0.0761, Trades=210
[INFO] Cluster 7 cluster: Short SMA=28, Long SMA=190, Sharpe=-0.1819, Trades=20
[INFO] Cluster 8 cluster: Short SMA=138, Long SMA=176, Sharpe=-0.1764, Trades=17
[INFO] Cluster 9 cluster: Short SMA=212, Long SMA=230, Sharpe=-0.1977, Trades=24
[INFO] Cluster 10 cluster: Short SMA=26, Long SMA=62, Sharpe=0.0489, Trades=50
[INFO] Cluster 11 cluster: Short SMA=192, Long SMA=274, Sharpe=-0.1203, Trades=14
[INFO] Cluster 12 cluster: Short SMA=110, Long SMA=114, Sharpe=-0.2890, Trades=77
[INFO] Cluster 13 cluster: Short SMA=138, Long SMA=156, Sharpe=-0.0007, Trades=23
[INFO] Cluster 14 cluster: Short SMA=148, Long SMA=282, Sharpe=-0.2792, Trades=12
[INFO] Cluster 15 cluster: Short SMA=102, Long SMA=192, Sharpe=-0.2914, Trades=15
[INFO] Cluster 16 cluster: Short SMA=246, Long SMA=272, Sharpe=0.1503, Trades=22
[INFO] Cluster 17 cluster: Short SMA=24, Long SMA=30, Sharpe=-0.5034, Trades=139
[INFO] Cluster 18 cluster: Short SMA=164, Long SMA=204, Sharpe=-0.3998, Trades=20
[INFO] Cluster 19 cluster: Short SMA=58, Long SMA=200, Sharpe=-0.3815, Trades=22
[INFO] Cluster 20 cluster: Short SMA=60, Long SMA=180, Sharpe=-0.2988, Trades=18
[INFO] Cluster 21 cluster: Short SMA=58, Long SMA=134, Sharpe=-0.2045, Trades=24
[INFO] Cluster 22 cluster: Short SMA=50, Long SMA=280, Sharpe=-0.1118, Trades=10
[INFO] Cluster 23 cluster: Short SMA=38, Long SMA=114, Sharpe=-0.0059, Trades=24
[INFO] Cluster 24 cluster: Short SMA=134, Long SMA=202, Sharpe=-0.4554, Trades=15
[INFO] Cluster 25 cluster: Short SMA=86, Long SMA=96, Sharpe=-0.3009, Trades=50
[INFO] Cluster 26 cluster: Short SMA=42, Long SMA=70, Sharpe=-0.1751, Trades=42
[INFO] Cluster 27 cluster: Short SMA=188, Long SMA=190, Sharpe=-0.4206, Trades=52
[INFO] Cluster 28 cluster: Short SMA=82, Long SMA=144, Sharpe=-0.1413, Trades=17
[INFO] Cluster 29 cluster: Short SMA=114, Long SMA=236, Sharpe=-0.1808, Trades=13
[INFO] Cluster 31 cluster: Short SMA=66, Long SMA=224, Sharpe=-0.3133, Trades=18
[INFO] Cluster 32 cluster: Short SMA=24, Long SMA=282, Sharpe=-0.0854, Trades=14
[INFO] Cluster 33 cluster: Short SMA=22, Long SMA=34, Sharpe=-0.4142, Trades=108
[INFO] Cluster 34 cluster: Short SMA=96, Long SMA=162, Sharpe=-0.2900, Trades=17
[INFO] Cluster 35 cluster: Short SMA=26, Long SMA=50, Sharpe=0.0858, Trades=70
[INFO] Cluster 36 cluster: Short SMA=96, Long SMA=120, Sharpe=-0.3070, Trades=32
[INFO] Cluster 37 cluster: Short SMA=106, Long SMA=274, Sharpe=-0.2020, Trades=12
[INFO] Cluster 38 cluster: Short SMA=34, Long SMA=94, Sharpe=0.0155, Trades=30
[INFO] Cluster 39 cluster: Short SMA=20, Long SMA=152, Sharpe=-0.1028, Trades=28
[INFO] Cluster 40 cluster: Short SMA=140, Long SMA=144, Sharpe=-0.1717, Trades=51
[INFO] Cluster 42 cluster: Short SMA=76, Long SMA=108, Sharpe=-0.3323, Trades=28
[INFO] Cluster 43 cluster: Short SMA=74, Long SMA=260, Sharpe=-0.2772, Trades=14
[INFO] Cluster 45 cluster: Short SMA=116, Long SMA=266, Sharpe=-0.0937, Trades=12
[INFO] Cluster 46 cluster: Short SMA=24, Long SMA=84, Sharpe=0.1771, Trades=34
[INFO] Cluster 47 cluster: Short SMA=54, Long SMA=240, Sharpe=-0.2214, Trades=16
[INFO] Cluster 49 cluster: Short SMA=148, Long SMA=250, Sharpe=-0.4712, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=60, Sharpe=0.6286, Trades=140
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=24, Long SMA=84, Sharpe=0.1771, Trades=34
[INFO] Top 2: Short SMA=246, Long SMA=272, Sharpe=0.1503, Trades=22
[INFO] Top 3: Short SMA=26, Long SMA=50, Sharpe=0.0858, Trades=70
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 46 valid clusters with clusters
[INFO] Filtering to 10433 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 60
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(24/84) - Original Sharpe: 0.1771, Trades: 34
[INFO] Hierarchical cluster 2: SMA(246/272) - Original Sharpe: 0.1503, Trades: 22
[INFO] Hierarchical cluster 3: SMA(26/50) - Original Sharpe: 0.0858, Trades: 70
[INFO] Hierarchical cluster 4: SMA(266/270) - Original Sharpe: 0.0649, Trades: 52
[INFO] Hierarchical cluster 5: SMA(26/62) - Original Sharpe: 0.0489, Trades: 50
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/60)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 60
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\JY
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for KC in column D: 32.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.27s
[INFO] Best parameters: Short SMA = 126, Long SMA = 144
[INFO] Best Sharpe ratio: 0.627789, Trades: 31
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 850 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @KC
[INFO] Big Point Value (from data): 375.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.46 contracts
[INFO] Maximum Position Size: 10 contracts
[INFO] Strategy Total P&L: $639,834.00
[INFO] Market Buy & Hold P&L: $47,625.00
[INFO] Outperformance: $592,209.00
[INFO] Sharpe ratio (entire period, annualized): 0.637021
[INFO] Sharpe ratio (in-sample, annualized): 0.627789
[INFO] Sharpe ratio (out-of-sample, annualized): 0.657694
[INFO] Maximum Drawdown: $199,510.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 23
[INFO] Out-of-sample period trades: 8
[INFO] Total trades: 31
[INFO] In-sample P&L: $366,396.50
[INFO] Out-of-sample P&L: $175,393.75
[INFO] 
Best parameters from GA: Short SMA = 126, Long SMA = 144, Sharpe = 0.627789
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 375.0
[INFO] Slippage: 32.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7635 to 0.6278
[INFO] 
Best parameters:
[INFO] Short SMA: 126
[INFO] Long SMA: 144
[INFO] Sharpe Ratio: 0.627789
[INFO] Number of Trades: 31
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9735 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7635 to 0.6278
[INFO] Trades range: 11.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3432 to 2.6986
[INFO] Scaled Long SMA range: -2.7329 to 1.5004
[INFO] Scaled Sharpe ratio range: -3.9207 to 2.9484
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 333 elements
[INFO] Kmeans Cluster 1: 179 elements
[INFO] Kmeans Cluster 2: 266 elements
[INFO] Kmeans Cluster 3: 264 elements
[INFO] Kmeans Cluster 4: 175 elements
[INFO] Kmeans Cluster 5: 270 elements
[INFO] Kmeans Cluster 6: 111 elements
[INFO] Kmeans Cluster 7: 253 elements
[INFO] Kmeans Cluster 8: 210 elements
[INFO] Kmeans Cluster 9: 196 elements
[INFO] Kmeans Cluster 10: 161 elements
[INFO] Kmeans Cluster 11: 213 elements
[INFO] Kmeans Cluster 12: 196 elements
[INFO] Kmeans Cluster 13: 253 elements
[INFO] Kmeans Cluster 14: 151 elements
[INFO] Kmeans Cluster 15: 98 elements
[INFO] Kmeans Cluster 16: 135 elements
[INFO] Kmeans Cluster 17: 230 elements
[INFO] Kmeans Cluster 18: 82 elements
[INFO] Kmeans Cluster 19: 234 elements
[INFO] Kmeans Cluster 20: 177 elements
[INFO] Kmeans Cluster 21: 292 elements
[INFO] Kmeans Cluster 22: 128 elements
[INFO] Kmeans Cluster 23: 116 elements
[INFO] Kmeans Cluster 24: 163 elements
[INFO] Kmeans Cluster 25: 180 elements
[INFO] Kmeans Cluster 26: 232 elements
[INFO] Kmeans Cluster 27: 124 elements
[INFO] Kmeans Cluster 28: 200 elements
[INFO] Kmeans Cluster 29: 213 elements
[INFO] Kmeans Cluster 30: 313 elements
[INFO] Kmeans Cluster 31: 217 elements
[INFO] Kmeans Cluster 32: 125 elements
[INFO] Kmeans Cluster 33: 195 elements
[INFO] Kmeans Cluster 34: 211 elements
[INFO] Kmeans Cluster 35: 72 elements
[INFO] Kmeans Cluster 36: 235 elements
[INFO] Kmeans Cluster 37: 236 elements
[INFO] Kmeans Cluster 38: 171 elements
[INFO] Kmeans Cluster 39: 231 elements
[INFO] Kmeans Cluster 40: 192 elements
[INFO] Kmeans Cluster 41: 195 elements
[INFO] Kmeans Cluster 42: 198 elements
[INFO] Kmeans Cluster 43: 248 elements
[INFO] Kmeans Cluster 44: 57 elements
[INFO] Kmeans Cluster 45: 114 elements
[INFO] Kmeans Cluster 46: 219 elements
[INFO] Kmeans Cluster 47: 214 elements
[INFO] Kmeans Cluster 48: 198 elements
[INFO] Kmeans Cluster 49: 259 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=38.17, Long SMA=168.05, Sharpe=0.2210
[INFO] Centroid 1: Short SMA=184.00, Long SMA=282.60, Sharpe=-0.1012
[INFO] Centroid 2: Short SMA=114.81, Long SMA=187.83, Sharpe=0.0556
[INFO] Centroid 3: Short SMA=40.43, Long SMA=225.38, Sharpe=0.0274
[INFO] Centroid 4: Short SMA=32.91, Long SMA=67.66, Sharpe=-0.0647
[INFO] Centroid 5: Short SMA=249.39, Long SMA=282.53, Sharpe=-0.3443
[INFO] Centroid 6: Short SMA=19.05, Long SMA=35.53, Sharpe=-0.4945
[INFO] Centroid 7: Short SMA=135.83, Long SMA=243.50, Sharpe=-0.1066
[INFO] Centroid 8: Short SMA=188.67, Long SMA=218.03, Sharpe=0.1650
[INFO] Centroid 9: Short SMA=75.00, Long SMA=245.88, Sharpe=-0.0059
[INFO] Centroid 10: Short SMA=119.60, Long SMA=152.68, Sharpe=0.4078
[INFO] Centroid 11: Short SMA=44.74, Long SMA=282.71, Sharpe=-0.2060
[INFO] Centroid 12: Short SMA=156.04, Long SMA=178.01, Sharpe=-0.2345
[INFO] Centroid 13: Short SMA=93.96, Long SMA=167.11, Sharpe=0.1568
[INFO] Centroid 14: Short SMA=19.91, Long SMA=223.68, Sharpe=0.2947
[INFO] Centroid 15: Short SMA=15.08, Long SMA=151.39, Sharpe=-0.1045
[INFO] Centroid 16: Short SMA=48.65, Long SMA=79.38, Sharpe=0.2037
[INFO] Centroid 17: Short SMA=35.67, Long SMA=71.61, Sharpe=0.0755
[INFO] Centroid 18: Short SMA=282.66, Long SMA=292.34, Sharpe=-0.1055
[INFO] Centroid 19: Short SMA=148.34, Long SMA=174.79, Sharpe=-0.0837
[INFO] Centroid 20: Short SMA=69.42, Long SMA=199.14, Sharpe=0.2230
[INFO] Centroid 21: Short SMA=108.83, Long SMA=220.10, Sharpe=-0.0265
[INFO] Centroid 22: Short SMA=15.06, Long SMA=256.05, Sharpe=0.1817
[INFO] Centroid 23: Short SMA=230.69, Long SMA=256.00, Sharpe=-0.1712
[INFO] Centroid 24: Short SMA=28.26, Long SMA=138.82, Sharpe=0.0420
[INFO] Centroid 25: Short SMA=80.16, Long SMA=99.70, Sharpe=0.0671
[INFO] Centroid 26: Short SMA=168.53, Long SMA=268.97, Sharpe=-0.0033
[INFO] Centroid 27: Short SMA=61.13, Long SMA=99.34, Sharpe=0.3429
[INFO] Centroid 28: Short SMA=49.25, Long SMA=182.10, Sharpe=0.3706
[INFO] Centroid 29: Short SMA=177.45, Long SMA=250.13, Sharpe=0.0813
[INFO] Centroid 30: Short SMA=70.36, Long SMA=140.53, Sharpe=0.3090
[INFO] Centroid 31: Short SMA=207.86, Long SMA=288.76, Sharpe=-0.2209
[INFO] Centroid 32: Short SMA=23.26, Long SMA=49.58, Sharpe=-0.2576
[INFO] Centroid 33: Short SMA=248.81, Long SMA=281.50, Sharpe=-0.4568
[INFO] Centroid 34: Short SMA=82.25, Long SMA=214.33, Sharpe=0.0850
[INFO] Centroid 35: Short SMA=188.42, Long SMA=203.72, Sharpe=0.3591
[INFO] Centroid 36: Short SMA=155.40, Long SMA=206.94, Sharpe=0.0791
[INFO] Centroid 37: Short SMA=72.47, Long SMA=280.56, Sharpe=-0.1050
[INFO] Centroid 38: Short SMA=214.35, Long SMA=245.58, Sharpe=-0.0299
[INFO] Centroid 39: Short SMA=156.04, Long SMA=227.72, Sharpe=-0.0183
[INFO] Centroid 40: Short SMA=25.92, Long SMA=282.72, Sharpe=-0.0743
[INFO] Centroid 41: Short SMA=36.66, Long SMA=110.07, Sharpe=0.2544
[INFO] Centroid 42: Short SMA=35.33, Long SMA=199.63, Sharpe=0.1326
[INFO] Centroid 43: Short SMA=213.47, Long SMA=241.19, Sharpe=0.0800
[INFO] Centroid 44: Short SMA=11.19, Long SMA=135.61, Sharpe=-0.3148
[INFO] Centroid 45: Short SMA=151.74, Long SMA=285.84, Sharpe=-0.2197
[INFO] Centroid 46: Short SMA=113.40, Long SMA=151.56, Sharpe=0.2753
[INFO] Centroid 47: Short SMA=43.93, Long SMA=250.86, Sharpe=-0.0587
[INFO] Centroid 48: Short SMA=39.07, Long SMA=115.99, Sharpe=0.1515
[INFO] Centroid 49: Short SMA=93.60, Long SMA=120.63, Sharpe=0.1867
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=126, Long SMA=144, Sharpe=0.6278, Trades=31
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=120, Long SMA=154, Sharpe=0.4369, Trades=21
[INFO] Kmeans Top 2: Short SMA=188, Long SMA=204, Sharpe=0.3923, Trades=21
[INFO] Kmeans Top 3: Short SMA=20, Long SMA=222, Sharpe=0.3369, Trades=23
[INFO] Kmeans Top 4: Short SMA=56, Long SMA=182, Sharpe=0.3276, Trades=15
[INFO] Kmeans Top 5: Short SMA=34, Long SMA=110, Sharpe=0.2995, Trades=21
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (38, 168)
[INFO]   Rounded: (184, 283)
[INFO]   Nearest: (184.0, 282.0)
[INFO]   Rounded: (115, 188)
[INFO]   Nearest: (114.0, 188.0)
[INFO]   Rounded: (40, 225)
[INFO]   Nearest: (40.0, 226.0)
[INFO]   Rounded: (33, 68)
[INFO]   Nearest: (32.0, 68.0)
[INFO]   Rounded: (249, 283)
[INFO]   Nearest: (250.0, 282.0)
[INFO]   Rounded: (19, 36)
[INFO]   Nearest: (20.0, 36.0)
[INFO]   Rounded: (136, 244)
[INFO]   Rounded: (189, 218)
[INFO]   Nearest: (188.0, 218.0)
[INFO]   Rounded: (75, 246)
[INFO]   Nearest: (74.0, 246.0)
[INFO]   Rounded: (120, 153)
[INFO]   Nearest: (120.0, 152.0)
[INFO]   Rounded: (45, 283)
[INFO]   Nearest: (44.0, 282.0)
[INFO]   Rounded: (156, 178)
[INFO]   Rounded: (94, 167)
[INFO]   Nearest: (94.0, 168.0)
[INFO]   Rounded: (20, 224)
[INFO]   Rounded: (15, 151)
[INFO]   Nearest: (16.0, 152.0)
[INFO]   Rounded: (49, 79)
[INFO]   Nearest: (48.0, 80.0)
[INFO]   Rounded: (36, 72)
[INFO]   Rounded: (283, 292)
[INFO]   Nearest: (282.0, 292.0)
[INFO]   Rounded: (148, 175)
[INFO]   Nearest: (148.0, 174.0)
[INFO]   Rounded: (69, 199)
[INFO]   Nearest: (70.0, 200.0)
[INFO]   Rounded: (109, 220)
[INFO]   Nearest: (108.0, 220.0)
[INFO]   Rounded: (15, 256)
[INFO]   Nearest: (16.0, 256.0)
[INFO]   Rounded: (231, 256)
[INFO]   Nearest: (230.0, 256.0)
[INFO]   Rounded: (28, 139)
[INFO]   Nearest: (28.0, 138.0)
[INFO]   Rounded: (80, 100)
[INFO]   Rounded: (169, 269)
[INFO]   Nearest: (168.0, 268.0)
[INFO]   Rounded: (61, 99)
[INFO]   Nearest: (62.0, 100.0)
[INFO]   Rounded: (49, 182)
[INFO]   Nearest: (50.0, 182.0)
[INFO]   Rounded: (177, 250)
[INFO]   Nearest: (178.0, 250.0)
[INFO]   Rounded: (70, 141)
[INFO]   Nearest: (70.0, 140.0)
[INFO]   Rounded: (208, 289)
[INFO]   Nearest: (208.0, 288.0)
[INFO]   Rounded: (23, 50)
[INFO]   Nearest: (24.0, 50.0)
[INFO]   Rounded: (249, 281)
[INFO]   Nearest: (248.0, 282.0)
[INFO]   Rounded: (82, 214)
[INFO]   Rounded: (188, 204)
[INFO]   Rounded: (155, 207)
[INFO]   Nearest: (156.0, 206.0)
[INFO]   Rounded: (72, 281)
[INFO]   Nearest: (72.0, 280.0)
[INFO]   Rounded: (214, 246)
[INFO]   Rounded: (156, 228)
[INFO]   Rounded: (26, 283)
[INFO]   Nearest: (26.0, 282.0)
[INFO]   Rounded: (37, 110)
[INFO]   Nearest: (36.0, 110.0)
[INFO]   Rounded: (35, 200)
[INFO]   Nearest: (36.0, 200.0)
[INFO]   Rounded: (213, 241)
[INFO]   Nearest: (214.0, 242.0)
[INFO]   Rounded: (11, 136)
[INFO]   Nearest: (12.0, 136.0)
[INFO]   Rounded: (152, 286)
[INFO]   Rounded: (113, 152)
[INFO]   Nearest: (114.0, 152.0)
[INFO]   Rounded: (44, 251)
[INFO]   Nearest: (44.0, 250.0)
[INFO]   Rounded: (39, 116)
[INFO]   Nearest: (40.0, 116.0)
[INFO]   Rounded: (94, 121)
[INFO]   Nearest: (94.0, 120.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 126, Long SMA: 144
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(120/154) - Original Sharpe: 0.4369, Trades: 21
[INFO] Kmeans cluster 2: SMA(188/204) - Original Sharpe: 0.3923, Trades: 21
[INFO] Kmeans cluster 3: SMA(20/222) - Original Sharpe: 0.3369, Trades: 23
[INFO] Kmeans cluster 4: SMA(56/182) - Original Sharpe: 0.3276, Trades: 15
[INFO] Kmeans cluster 5: SMA(34/110) - Original Sharpe: 0.2995, Trades: 21
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (126/144)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (120/154) - Sharpe: 0.4369
[INFO] cluster 2: (188/204) - Sharpe: 0.3923
[INFO] cluster 3: (20/222) - Sharpe: 0.3369
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     1.943138            1.943138
1    2021-11-10 2021-11-10            41     2.726433            2.726433
2    2022-01-10 2022-01-10            41    -0.979722           -0.979722
3    2022-03-10 2022-03-10            42    -1.932434           -1.932434
4    2022-05-10 2022-05-10            41     2.781394            1.388700
5    2022-07-10 2022-07-10            44    -0.902683           -4.217722
6    2022-09-10 2022-09-10            43     4.781663            5.639283
7    2022-11-10 2022-11-10            40     0.520961            0.528681
8    2023-01-10 2023-01-10            41    -1.945501           -1.945501
9    2023-03-10 2023-03-10            42    -1.386296           -1.319826
10   2023-05-10 2023-05-10            40    -1.725343           -5.225273
11   2023-07-10 2023-07-10            44     0.054587            2.659566
12   2023-09-10 2023-09-10            44    -3.556132           -3.556132
13   2023-11-10 2023-11-10            40    -1.024655           -2.411943
14   2024-01-10 2024-01-10            41     1.405934            0.672127
15   2024-03-10 2024-03-10            43     1.924896            1.618583
16   2024-05-10 2024-05-10            40     2.925387            2.925387
17   2024-07-10 2024-07-10            43     0.254368            0.254368
18   2024-09-10 2024-09-10            44     0.943102            0.943102
19   2024-11-10 2024-11-10            35     5.162860            5.162860
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-01-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |          2.8 |              1.4 |         -1.4 | False         
[INFO] 2022-07-10   |         -0.9 |             -4.2 |         -3.3 | False         
[INFO] 2022-09-10   |          4.8 |              5.6 |          0.8 | True          
[INFO] 2022-11-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -1.4 |             -1.3 |          0.1 | True          
[INFO] 2023-05-10   |         -1.7 |             -5.2 |         -3.5 | False         
[INFO] 2023-07-10   |          0.1 |              2.7 |          2.6 | True          
[INFO] 2023-09-10   |         -3.6 |             -3.6 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -1.0 |             -2.4 |         -1.4 | False         
[INFO] 2024-01-10   |          1.4 |              0.7 |         -0.7 | False         
[INFO] 2024-03-10   |          1.9 |              1.6 |         -0.3 | False         
[INFO] 2024-05-10   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-11-10   |          5.2 |              5.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2022-11-10, 2023-01-10, 2023-09-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 3 of 9 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for KC...
[INFO] Excel file updated successfully. Added KC with Kmeans win rate 33.3% in row 27
[INFO] Added best Sharpe parameters 126/144 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 126, Long SMA: 144
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(120/154) - Original Sharpe: 0.4369
[INFO] Added cluster 2 to portfolio: SMA(188/204) - Original Sharpe: 0.3923
[INFO] Added cluster 3 to portfolio: SMA(20/222) - Original Sharpe: 0.3369
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.7917
[INFO] Kmeans Best out-of-sample Sharpe: 0.6577
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for KC...
[INFO] Excel file updated successfully. Added KC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KC
[INFO] Big Point Value: 375.0
[INFO] Slippage: 32.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7635 to 0.6278
[INFO] 
Best parameters:
[INFO] Short SMA: 126
[INFO] Long SMA: 144
[INFO] Sharpe Ratio: 0.627789
[INFO] Number of Trades: 31
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9735 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7635 to 0.6278
[INFO] Trades range: 11.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3432 to 2.6986
[INFO] Scaled Long SMA range: -2.7329 to 1.5004
[INFO] Scaled Sharpe ratio range: -3.9207 to 2.9484
[INFO] Scaled Trades range: -0.5894 to 15.3908
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9735 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4846
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 63 elements
[INFO] Cluster 1: 272 elements
[INFO] Cluster 2: 103 elements
[INFO] Cluster 3: 64 elements
[INFO] Cluster 4: 190 elements
[INFO] Cluster 5: 459 elements
[INFO] Cluster 6: 426 elements
[INFO] Cluster 7: 302 elements
[INFO] Cluster 8: 488 elements
[INFO] Cluster 9: 204 elements
[INFO] Cluster 10: 235 elements
[INFO] Cluster 11: 453 elements
[INFO] Cluster 12: 301 elements
[INFO] Cluster 13: 284 elements
[INFO] Cluster 14: 104 elements
[INFO] Cluster 15: 338 elements
[INFO] Cluster 16: 90 elements
[INFO] Cluster 17: 6 elements
[INFO] Cluster 18: 279 elements
[INFO] Cluster 19: 31 elements
[INFO] Cluster 20: 256 elements
[INFO] Cluster 21: 300 elements
[INFO] Cluster 22: 222 elements
[INFO] Cluster 23: 192 elements
[INFO] Cluster 24: 369 elements
[INFO] Cluster 25: 237 elements
[INFO] Cluster 26: 316 elements
[INFO] Cluster 27: 184 elements
[INFO] Cluster 28: 42 elements
[INFO] Cluster 29: 95 elements
[INFO] Cluster 30: 79 elements
[INFO] Cluster 31: 196 elements
[INFO] Cluster 32: 220 elements
[INFO] Cluster 33: 184 elements
[INFO] Cluster 34: 16 elements
[INFO] Cluster 35: 294 elements
[INFO] Cluster 36: 217 elements
[INFO] Cluster 37: 67 elements
[INFO] Cluster 38: 13 elements
[INFO] Cluster 39: 53 elements
[INFO] Cluster 40: 136 elements
[INFO] Cluster 41: 131 elements
[INFO] Cluster 42: 65 elements
[INFO] Cluster 43: 211 elements
[INFO] Cluster 44: 161 elements
[INFO] Cluster 45: 89 elements
[INFO] Cluster 46: 247 elements
[INFO] Cluster 47: 276 elements
[INFO] Cluster 48: 13 elements
[INFO] Cluster 49: 162 elements
[INFO] Using 46 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=56, Long SMA=60, Sharpe=-0.0740, Trades=95
[INFO] Cluster 1 cluster: Short SMA=24, Long SMA=148, Sharpe=0.0005, Trades=29
[INFO] Cluster 2 cluster: Short SMA=10, Long SMA=106, Sharpe=-0.3132, Trades=45
[INFO] Cluster 3 cluster: Short SMA=130, Long SMA=134, Sharpe=0.3153, Trades=67
[INFO] Cluster 4 cluster: Short SMA=210, Long SMA=266, Sharpe=-0.0504, Trades=13
[INFO] Cluster 5 cluster: Short SMA=248, Long SMA=282, Sharpe=-0.3674, Trades=15
[INFO] Cluster 6 cluster: Short SMA=174, Long SMA=262, Sharpe=0.0203, Trades=11
[INFO] Cluster 7 cluster: Short SMA=180, Long SMA=214, Sharpe=0.2739, Trades=15
[INFO] Cluster 8 cluster: Short SMA=108, Long SMA=200, Sharpe=-0.0120, Trades=13
[INFO] Cluster 9 cluster: Short SMA=116, Long SMA=162, Sharpe=0.4040, Trades=17
[INFO] Cluster 10 cluster: Short SMA=30, Long SMA=68, Sharpe=-0.0429, Trades=39
[INFO] Cluster 11 cluster: Short SMA=38, Long SMA=174, Sharpe=0.3098, Trades=21
[INFO] Cluster 12 cluster: Short SMA=40, Long SMA=104, Sharpe=0.2755, Trades=25
[INFO] Cluster 13 cluster: Short SMA=36, Long SMA=114, Sharpe=0.1956, Trades=21
[INFO] Cluster 14 cluster: Short SMA=154, Long SMA=164, Sharpe=-0.0144, Trades=39
[INFO] Cluster 15 cluster: Short SMA=74, Long SMA=140, Sharpe=0.3199, Trades=21
[INFO] Cluster 16 cluster: Short SMA=224, Long SMA=230, Sharpe=0.2095, Trades=35
[INFO] Cluster 18 cluster: Short SMA=40, Long SMA=284, Sharpe=-0.1483, Trades=15
[INFO] Cluster 19 cluster: Short SMA=172, Long SMA=174, Sharpe=-0.4261, Trades=83
[INFO] Cluster 20 cluster: Short SMA=210, Long SMA=286, Sharpe=-0.1991, Trades=11
[INFO] Cluster 21 cluster: Short SMA=66, Long SMA=244, Sharpe=-0.0148, Trades=13
[INFO] Cluster 22 cluster: Short SMA=74, Long SMA=110, Sharpe=0.1714, Trades=25
[INFO] Cluster 23 cluster: Short SMA=20, Long SMA=216, Sharpe=0.3544, Trades=25
[INFO] Cluster 24 cluster: Short SMA=138, Long SMA=240, Sharpe=-0.0511, Trades=11
[INFO] Cluster 25 cluster: Short SMA=94, Long SMA=166, Sharpe=0.1278, Trades=17
[INFO] Cluster 26 cluster: Short SMA=42, Long SMA=224, Sharpe=0.0189, Trades=17
[INFO] Cluster 27 cluster: Short SMA=70, Long SMA=88, Sharpe=0.0833, Trades=39
[INFO] Cluster 28 cluster: Short SMA=22, Long SMA=30, Sharpe=-0.1131, Trades=118
[INFO] Cluster 29 cluster: Short SMA=60, Long SMA=70, Sharpe=0.0733, Trades=65
[INFO] Cluster 30 cluster: Short SMA=190, Long SMA=204, Sharpe=0.3813, Trades=25
[INFO] Cluster 31 cluster: Short SMA=26, Long SMA=268, Sharpe=-0.0791, Trades=17
[INFO] Cluster 32 cluster: Short SMA=64, Long SMA=182, Sharpe=0.4094, Trades=15
[INFO] Cluster 33 cluster: Short SMA=160, Long SMA=288, Sharpe=-0.0821, Trades=11
[INFO] Cluster 35 cluster: Short SMA=212, Long SMA=246, Sharpe=0.0963, Trades=17
[INFO] Cluster 36 cluster: Short SMA=152, Long SMA=182, Sharpe=-0.2164, Trades=21
[INFO] Cluster 37 cluster: Short SMA=22, Long SMA=48, Sharpe=-0.1598, Trades=70
[INFO] Cluster 39 cluster: Short SMA=126, Long SMA=136, Sharpe=0.4034, Trades=45
[INFO] Cluster 40 cluster: Short SMA=136, Long SMA=180, Sharpe=-0.0609, Trades=17
[INFO] Cluster 41 cluster: Short SMA=14, Long SMA=244, Sharpe=0.2315, Trades=21
[INFO] Cluster 42 cluster: Short SMA=20, Long SMA=36, Sharpe=-0.5110, Trades=92
[INFO] Cluster 43 cluster: Short SMA=160, Long SMA=226, Sharpe=0.0788, Trades=11
[INFO] Cluster 44 cluster: Short SMA=68, Long SMA=210, Sharpe=0.1674, Trades=15
[INFO] Cluster 45 cluster: Short SMA=282, Long SMA=292, Sharpe=-0.0739, Trades=23
[INFO] Cluster 46 cluster: Short SMA=106, Long SMA=228, Sharpe=-0.0243, Trades=11
[INFO] Cluster 47 cluster: Short SMA=66, Long SMA=280, Sharpe=-0.1237, Trades=11
[INFO] Cluster 49 cluster: Short SMA=102, Long SMA=134, Sharpe=0.1685, Trades=23
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=126, Long SMA=144, Sharpe=0.6278, Trades=31
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=64, Long SMA=182, Sharpe=0.4094, Trades=15
[INFO] Top 2: Short SMA=116, Long SMA=162, Sharpe=0.4040, Trades=17
[INFO] Top 3: Short SMA=126, Long SMA=136, Sharpe=0.4034, Trades=45
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 46 valid clusters with clusters
[INFO] Filtering to 9687 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 126, Long SMA: 144
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(64/182) - Original Sharpe: 0.4094, Trades: 15
[INFO] Hierarchical cluster 2: SMA(116/162) - Original Sharpe: 0.4040, Trades: 17
[INFO] Hierarchical cluster 3: SMA(126/136) - Original Sharpe: 0.4034, Trades: 45
[INFO] Hierarchical cluster 4: SMA(190/204) - Original Sharpe: 0.3813, Trades: 25
[INFO] Hierarchical cluster 5: SMA(20/216) - Original Sharpe: 0.3544, Trades: 25
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (126/144)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (64/182) - Sharpe: 0.4094
[INFO] cluster 2: (116/162) - Sharpe: 0.4040
[INFO] cluster 3: (126/136) - Sharpe: 0.4034
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     1.943138            1.943138
1    2021-11-10 2021-11-10            41     2.726433            2.726433
2    2022-01-10 2022-01-10            41    -0.979722           -0.979722
3    2022-03-10 2022-03-10            42    -1.932434           -1.932434
4    2022-05-10 2022-05-10            41     2.781394            1.483445
5    2022-07-10 2022-07-10            44    -0.902683           -1.258010
6    2022-09-10 2022-09-10            43     4.781663            6.310151
7    2022-11-10 2022-11-10            40     0.520961            0.143581
8    2023-01-10 2023-01-10            41    -1.945501           -1.945501
9    2023-03-10 2023-03-10            42    -1.386296           -1.386296
10   2023-05-10 2023-05-10            40    -1.725343           -1.621066
11   2023-07-10 2023-07-10            44     0.054587           -1.223471
12   2023-09-10 2023-09-10            44    -3.556132           -3.556132
13   2023-11-10 2023-11-10            40    -1.024655           -1.650040
14   2024-01-10 2024-01-10            41     1.405934            0.876946
15   2024-03-10 2024-03-10            43     1.924896            1.924896
16   2024-05-10 2024-05-10            40     2.925387            2.925387
17   2024-07-10 2024-07-10            43     0.254368            0.254368
18   2024-09-10 2024-09-10            44     0.943102            0.943102
19   2024-11-10 2024-11-10            35     5.162860            5.162860
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-01-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |          2.8 |              1.5 |         -1.3 | False         
[INFO] 2022-07-10   |         -0.9 |             -1.3 |         -0.4 | False         
[INFO] 2022-09-10   |          4.8 |              6.3 |          1.5 | True          
[INFO] 2022-11-10   |          0.5 |              0.1 |         -0.4 | False         
[INFO] 2023-01-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -1.7 |             -1.6 |          0.1 | True          
[INFO] 2023-07-10   |          0.1 |             -1.2 |         -1.3 | False         
[INFO] 2023-09-10   |         -3.6 |             -3.6 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -1.0 |             -1.7 |         -0.7 | False         
[INFO] 2024-01-10   |          1.4 |              0.9 |         -0.5 | False         
[INFO] 2024-03-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-11-10   |          5.2 |              5.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2023-01-10, 2023-03-10, 2023-09-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 8 periods (25.00% win rate)
[INFO] Updating Excel file with Hierarchical results for KC...
[INFO] Excel file updated successfully. Added KC with Hierarchical win rate 25.0% in row 27
[INFO] Added best Sharpe parameters 126/144 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 126, Long SMA: 144
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(64/182) - Original Sharpe: 0.4094
[INFO] Added cluster 2 to portfolio: SMA(116/162) - Original Sharpe: 0.4040
[INFO] Added cluster 3 to portfolio: SMA(126/136) - Original Sharpe: 0.4034
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.4862
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6577
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for KC...
[INFO] Excel file updated successfully. Added KC with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KC
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for KW in column D: 18.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.74s
[INFO] Best parameters: Short SMA = 218, Long SMA = 300
[INFO] Best Sharpe ratio: 0.653288, Trades: 4
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 1541 bad combos; keeping 1636 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @KW
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.20 contracts
[INFO] Maximum Position Size: 19 contracts
[INFO] Strategy Total P&L: $596,198.00
[INFO] Market Buy & Hold P&L: $-29,750.00
[INFO] Outperformance: $625,948.00
[INFO] Sharpe ratio (entire period, annualized): 0.656604
[INFO] Sharpe ratio (in-sample, annualized): 0.653288
[INFO] Sharpe ratio (out-of-sample, annualized): 0.664140
[INFO] Maximum Drawdown: $122,145.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 3
[INFO] Out-of-sample period trades: 1
[INFO] Total trades: 4
[INFO] In-sample P&L: $336,968.50
[INFO] Out-of-sample P&L: $154,779.50
[INFO] 
Best parameters from GA: Short SMA = 218, Long SMA = 300, Sharpe = 0.653288
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8976 to 0.6533
[INFO] 
Best parameters:
[INFO] Short SMA: 218
[INFO] Long SMA: 300
[INFO] Sharpe Ratio: 0.653288
[INFO] Number of Trades: 4
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9044 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8976 to 0.5917
[INFO] Trades range: 10.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2918 to 2.7703
[INFO] Scaled Long SMA range: -2.6926 to 1.6018
[INFO] Scaled Sharpe ratio range: -3.4124 to 3.0154
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 231 elements
[INFO] Kmeans Cluster 1: 216 elements
[INFO] Kmeans Cluster 2: 76 elements
[INFO] Kmeans Cluster 3: 204 elements
[INFO] Kmeans Cluster 4: 187 elements
[INFO] Kmeans Cluster 5: 189 elements
[INFO] Kmeans Cluster 6: 165 elements
[INFO] Kmeans Cluster 7: 136 elements
[INFO] Kmeans Cluster 8: 297 elements
[INFO] Kmeans Cluster 9: 128 elements
[INFO] Kmeans Cluster 10: 152 elements
[INFO] Kmeans Cluster 11: 190 elements
[INFO] Kmeans Cluster 12: 206 elements
[INFO] Kmeans Cluster 13: 238 elements
[INFO] Kmeans Cluster 14: 134 elements
[INFO] Kmeans Cluster 15: 282 elements
[INFO] Kmeans Cluster 16: 162 elements
[INFO] Kmeans Cluster 17: 133 elements
[INFO] Kmeans Cluster 18: 126 elements
[INFO] Kmeans Cluster 19: 118 elements
[INFO] Kmeans Cluster 20: 169 elements
[INFO] Kmeans Cluster 21: 138 elements
[INFO] Kmeans Cluster 22: 314 elements
[INFO] Kmeans Cluster 23: 184 elements
[INFO] Kmeans Cluster 24: 276 elements
[INFO] Kmeans Cluster 25: 195 elements
[INFO] Kmeans Cluster 26: 260 elements
[INFO] Kmeans Cluster 27: 153 elements
[INFO] Kmeans Cluster 28: 225 elements
[INFO] Kmeans Cluster 29: 115 elements
[INFO] Kmeans Cluster 30: 306 elements
[INFO] Kmeans Cluster 31: 180 elements
[INFO] Kmeans Cluster 32: 251 elements
[INFO] Kmeans Cluster 33: 49 elements
[INFO] Kmeans Cluster 34: 106 elements
[INFO] Kmeans Cluster 35: 242 elements
[INFO] Kmeans Cluster 36: 157 elements
[INFO] Kmeans Cluster 37: 221 elements
[INFO] Kmeans Cluster 38: 43 elements
[INFO] Kmeans Cluster 39: 62 elements
[INFO] Kmeans Cluster 40: 176 elements
[INFO] Kmeans Cluster 41: 173 elements
[INFO] Kmeans Cluster 42: 240 elements
[INFO] Kmeans Cluster 43: 155 elements
[INFO] Kmeans Cluster 44: 195 elements
[INFO] Kmeans Cluster 45: 243 elements
[INFO] Kmeans Cluster 46: 104 elements
[INFO] Kmeans Cluster 47: 211 elements
[INFO] Kmeans Cluster 48: 136 elements
[INFO] Kmeans Cluster 49: 195 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=39.77, Long SMA=179.52, Sharpe=-0.3589
[INFO] Centroid 1: Short SMA=153.48, Long SMA=229.71, Sharpe=-0.0861
[INFO] Centroid 2: Short SMA=12.26, Long SMA=96.18, Sharpe=-0.0307
[INFO] Centroid 3: Short SMA=225.48, Long SMA=260.00, Sharpe=0.1385
[INFO] Centroid 4: Short SMA=89.33, Long SMA=163.83, Sharpe=0.0054
[INFO] Centroid 5: Short SMA=41.48, Long SMA=80.19, Sharpe=-0.3529
[INFO] Centroid 6: Short SMA=24.82, Long SMA=285.19, Sharpe=-0.2458
[INFO] Centroid 7: Short SMA=16.71, Long SMA=138.24, Sharpe=-0.2168
[INFO] Centroid 8: Short SMA=60.84, Long SMA=230.79, Sharpe=-0.1736
[INFO] Centroid 9: Short SMA=13.19, Long SMA=252.89, Sharpe=-0.0377
[INFO] Centroid 10: Short SMA=34.40, Long SMA=157.40, Sharpe=-0.5083
[INFO] Centroid 11: Short SMA=85.44, Long SMA=136.80, Sharpe=-0.0888
[INFO] Centroid 12: Short SMA=32.96, Long SMA=110.86, Sharpe=-0.5813
[INFO] Centroid 13: Short SMA=188.26, Long SMA=225.22, Sharpe=0.1991
[INFO] Centroid 14: Short SMA=235.61, Long SMA=253.58, Sharpe=-0.0182
[INFO] Centroid 15: Short SMA=131.02, Long SMA=186.21, Sharpe=0.0234
[INFO] Centroid 16: Short SMA=114.19, Long SMA=136.22, Sharpe=0.0577
[INFO] Centroid 17: Short SMA=211.43, Long SMA=234.84, Sharpe=0.3966
[INFO] Centroid 18: Short SMA=16.60, Long SMA=174.22, Sharpe=-0.0407
[INFO] Centroid 19: Short SMA=76.32, Long SMA=285.03, Sharpe=-0.0122
[INFO] Centroid 20: Short SMA=172.88, Long SMA=259.22, Sharpe=0.1446
[INFO] Centroid 21: Short SMA=239.01, Long SMA=282.58, Sharpe=0.3790
[INFO] Centroid 22: Short SMA=54.47, Long SMA=274.98, Sharpe=-0.1418
[INFO] Centroid 23: Short SMA=29.21, Long SMA=265.52, Sharpe=-0.3846
[INFO] Centroid 24: Short SMA=80.97, Long SMA=188.69, Sharpe=-0.1018
[INFO] Centroid 25: Short SMA=22.65, Long SMA=52.70, Sharpe=-0.2320
[INFO] Centroid 26: Short SMA=261.53, Long SMA=283.07, Sharpe=0.2407
[INFO] Centroid 27: Short SMA=133.11, Long SMA=155.55, Sharpe=-0.0876
[INFO] Centroid 28: Short SMA=184.09, Long SMA=208.56, Sharpe=0.0184
[INFO] Centroid 29: Short SMA=130.02, Long SMA=228.47, Sharpe=-0.3385
[INFO] Centroid 30: Short SMA=159.53, Long SMA=188.74, Sharpe=-0.1282
[INFO] Centroid 31: Short SMA=64.06, Long SMA=129.22, Sharpe=-0.2819
[INFO] Centroid 32: Short SMA=58.45, Long SMA=187.76, Sharpe=-0.2075
[INFO] Centroid 33: Short SMA=284.69, Long SMA=295.88, Sharpe=0.4306
[INFO] Centroid 34: Short SMA=20.28, Long SMA=40.09, Sharpe=-0.0254
[INFO] Centroid 35: Short SMA=198.74, Long SMA=261.58, Sharpe=0.2918
[INFO] Centroid 36: Short SMA=64.11, Long SMA=241.21, Sharpe=-0.0635
[INFO] Centroid 37: Short SMA=33.39, Long SMA=224.38, Sharpe=-0.3007
[INFO] Centroid 38: Short SMA=42.70, Long SMA=53.12, Sharpe=-0.7505
[INFO] Centroid 39: Short SMA=73.35, Long SMA=88.58, Sharpe=0.0141
[INFO] Centroid 40: Short SMA=88.44, Long SMA=128.26, Sharpe=-0.1913
[INFO] Centroid 41: Short SMA=150.12, Long SMA=272.06, Sharpe=0.0047
[INFO] Centroid 42: Short SMA=41.36, Long SMA=127.80, Sharpe=-0.4138
[INFO] Centroid 43: Short SMA=66.10, Long SMA=90.43, Sharpe=-0.1793
[INFO] Centroid 44: Short SMA=135.47, Long SMA=234.86, Sharpe=-0.2007
[INFO] Centroid 45: Short SMA=120.35, Long SMA=161.99, Sharpe=0.1607
[INFO] Centroid 46: Short SMA=87.04, Long SMA=105.37, Sharpe=-0.4059
[INFO] Centroid 47: Short SMA=113.48, Long SMA=220.43, Sharpe=-0.0854
[INFO] Centroid 48: Short SMA=19.04, Long SMA=210.53, Sharpe=-0.1033
[INFO] Centroid 49: Short SMA=37.48, Long SMA=71.12, Sharpe=-0.5101
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=218, Long SMA=300, Sharpe=0.6533, Trades=4
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=212, Long SMA=234, Sharpe=0.4528, Trades=16
[INFO] Kmeans Top 2: Short SMA=284, Long SMA=296, Sharpe=0.4447, Trades=16
[INFO] Kmeans Top 3: Short SMA=238, Long SMA=282, Sharpe=0.4165, Trades=12
[INFO] Kmeans Top 4: Short SMA=198, Long SMA=260, Sharpe=0.2549, Trades=10
[INFO] Kmeans Top 5: Short SMA=262, Long SMA=284, Sharpe=0.2022, Trades=16
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (40, 180)
[INFO]   Rounded: (153, 230)
[INFO]   Nearest: (154.0, 230.0)
[INFO]   Rounded: (12, 96)
[INFO]   Rounded: (225, 260)
[INFO]   Nearest: (226.0, 260.0)
[INFO]   Rounded: (89, 164)
[INFO]   Nearest: (90.0, 164.0)
[INFO]   Rounded: (41, 80)
[INFO]   Nearest: (42.0, 80.0)
[INFO]   Rounded: (25, 285)
[INFO]   Nearest: (24.0, 286.0)
[INFO]   Rounded: (17, 138)
[INFO]   Nearest: (16.0, 138.0)
[INFO]   Rounded: (61, 231)
[INFO]   Nearest: (60.0, 230.0)
[INFO]   Rounded: (13, 253)
[INFO]   Nearest: (14.0, 252.0)
[INFO]   Rounded: (34, 157)
[INFO]   Nearest: (34.0, 158.0)
[INFO]   Rounded: (85, 137)
[INFO]   Nearest: (86.0, 136.0)
[INFO]   Rounded: (33, 111)
[INFO]   Nearest: (32.0, 110.0)
[INFO]   Rounded: (188, 225)
[INFO]   Nearest: (188.0, 226.0)
[INFO]   Rounded: (236, 254)
[INFO]   Rounded: (131, 186)
[INFO]   Nearest: (132.0, 186.0)
[INFO]   Rounded: (114, 136)
[INFO]   Rounded: (211, 235)
[INFO]   Nearest: (212.0, 234.0)
[INFO]   Rounded: (17, 174)
[INFO]   Nearest: (16.0, 174.0)
[INFO]   Rounded: (76, 285)
[INFO]   Nearest: (76.0, 286.0)
[INFO]   Rounded: (173, 259)
[INFO]   Nearest: (172.0, 260.0)
[INFO]   Rounded: (239, 283)
[INFO]   Nearest: (240.0, 282.0)
[INFO]   Rounded: (54, 275)
[INFO]   Nearest: (54.0, 274.0)
[INFO]   Rounded: (29, 266)
[INFO]   Nearest: (30.0, 266.0)
[INFO]   Rounded: (81, 189)
[INFO]   Nearest: (80.0, 188.0)
[INFO]   Rounded: (23, 53)
[INFO]   Nearest: (22.0, 52.0)
[INFO]   Rounded: (262, 283)
[INFO]   Nearest: (262.0, 284.0)
[INFO]   Rounded: (133, 156)
[INFO]   Nearest: (134.0, 156.0)
[INFO]   Rounded: (184, 209)
[INFO]   Nearest: (184.0, 208.0)
[INFO]   Rounded: (130, 228)
[INFO]   Rounded: (160, 189)
[INFO]   Nearest: (160.0, 188.0)
[INFO]   Rounded: (64, 129)
[INFO]   Nearest: (64.0, 130.0)
[INFO]   Rounded: (58, 188)
[INFO]   Rounded: (285, 296)
[INFO]   Nearest: (284.0, 296.0)
[INFO]   Rounded: (20, 40)
[INFO]   Rounded: (199, 262)
[INFO]   Nearest: (198.0, 262.0)
[INFO]   Rounded: (64, 241)
[INFO]   Nearest: (64.0, 242.0)
[INFO]   Rounded: (33, 224)
[INFO]   Nearest: (34.0, 224.0)
[INFO]   Rounded: (43, 53)
[INFO]   Nearest: (42.0, 54.0)
[INFO]   Rounded: (73, 89)
[INFO]   Nearest: (74.0, 88.0)
[INFO]   Rounded: (88, 128)
[INFO]   Rounded: (150, 272)
[INFO]   Rounded: (41, 128)
[INFO]   Nearest: (42.0, 128.0)
[INFO]   Rounded: (66, 90)
[INFO]   Rounded: (135, 235)
[INFO]   Nearest: (136.0, 234.0)
[INFO]   Rounded: (120, 162)
[INFO]   Rounded: (87, 105)
[INFO]   Nearest: (88.0, 106.0)
[INFO]   Rounded: (113, 220)
[INFO]   Nearest: (114.0, 220.0)
[INFO]   Rounded: (19, 211)
[INFO]   Nearest: (20.0, 210.0)
[INFO]   Rounded: (37, 71)
[INFO]   Nearest: (38.0, 72.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 218, Long SMA: 300
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(212/234) - Original Sharpe: 0.4528, Trades: 16
[INFO] Kmeans cluster 2: SMA(284/296) - Original Sharpe: 0.4447, Trades: 16
[INFO] Kmeans cluster 3: SMA(238/282) - Original Sharpe: 0.4165, Trades: 12
[INFO] Kmeans cluster 4: SMA(198/260) - Original Sharpe: 0.2549, Trades: 10
[INFO] Kmeans cluster 5: SMA(262/284) - Original Sharpe: 0.2022, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (218/300)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (212/234) - Sharpe: 0.4528
[INFO] cluster 2: (284/296) - Sharpe: 0.4447
[INFO] cluster 3: (238/282) - Sharpe: 0.4165
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     3.716844            3.716844
1    2021-11-10 2021-11-10            41    -0.412472           -0.412472
2    2022-01-10 2022-01-10            41     4.290205            4.290205
3    2022-03-10 2022-03-10            42     0.696473            0.696473
4    2022-05-10 2022-05-10            41    -1.906913           -1.906913
5    2022-07-10 2022-07-10            44     0.008064            0.008064
6    2022-09-10 2022-09-10            43     0.059045            0.059045
7    2022-11-10 2022-11-10            40    -2.768953           -2.768953
8    2023-01-10 2023-01-10            41     0.901765            1.162422
9    2023-03-10 2023-03-10            42    -2.058673           -1.339569
10   2023-05-10 2023-05-10            40     0.600971            1.336074
11   2023-07-10 2023-07-10            44     1.747552            2.138921
12   2023-09-10 2023-09-10            44     2.993555            2.301941
13   2023-11-10 2023-11-10            40     0.817504            0.817504
14   2024-01-10 2024-01-10            41     1.290468            1.290468
15   2024-03-10 2024-03-10            43    -2.221917           -2.221917
16   2024-05-10 2024-05-10            40     2.247863            2.247863
17   2024-07-10 2024-07-10            43     0.009942            0.009942
18   2024-09-10 2024-09-10            44     0.461751            0.461751
19   2024-11-10 2024-11-10            35     0.788268            0.788268
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2022-01-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-03-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-10   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-11-10   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2023-01-10   |          0.9 |              1.2 |          0.3 | True          
[INFO] 2023-03-10   |         -2.1 |             -1.3 |          0.8 | True          
[INFO] 2023-05-10   |          0.6 |              1.3 |          0.7 | True          
[INFO] 2023-07-10   |          1.7 |              2.1 |          0.4 | True          
[INFO] 2023-09-10   |          3.0 |              2.3 |         -0.7 | False         
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2024-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2022-05-10, 2022-07-10, 2022-09-10, 2022-11-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 5
[INFO] Kmeans cluster wins (rounded comparison): 4 of 5 periods (80.00% win rate)
[INFO] Updating Excel file with Kmeans results for KW...
[INFO] Excel file updated successfully. Added KW with Kmeans win rate 80.0% in row 28
[INFO] Added best Sharpe parameters 218/300 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 218, Long SMA: 300
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(212/234) - Original Sharpe: 0.4528
[INFO] Added cluster 2 to portfolio: SMA(284/296) - Original Sharpe: 0.4447
[INFO] Added cluster 3 to portfolio: SMA(238/282) - Original Sharpe: 0.4165
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KW_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.7082
[INFO] Kmeans Best out-of-sample Sharpe: 0.6641
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for KW...
[INFO] Excel file updated successfully. Added KW with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KW
[INFO] Big Point Value: 50.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8976 to 0.6533
[INFO] 
Best parameters:
[INFO] Short SMA: 218
[INFO] Long SMA: 300
[INFO] Sharpe Ratio: 0.653288
[INFO] Number of Trades: 4
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9044 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8976 to 0.5917
[INFO] Trades range: 10.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2918 to 2.7703
[INFO] Scaled Long SMA range: -2.6926 to 1.6018
[INFO] Scaled Sharpe ratio range: -3.4124 to 3.0154
[INFO] Scaled Trades range: -0.6668 to 14.7729
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9044 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5618
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 185 elements
[INFO] Cluster 1: 233 elements
[INFO] Cluster 2: 178 elements
[INFO] Cluster 3: 282 elements
[INFO] Cluster 4: 242 elements
[INFO] Cluster 5: 135 elements
[INFO] Cluster 6: 324 elements
[INFO] Cluster 7: 10 elements
[INFO] Cluster 8: 292 elements
[INFO] Cluster 9: 139 elements
[INFO] Cluster 10: 55 elements
[INFO] Cluster 11: 355 elements
[INFO] Cluster 12: 104 elements
[INFO] Cluster 13: 345 elements
[INFO] Cluster 14: 365 elements
[INFO] Cluster 15: 53 elements
[INFO] Cluster 16: 189 elements
[INFO] Cluster 17: 340 elements
[INFO] Cluster 18: 206 elements
[INFO] Cluster 19: 91 elements
[INFO] Cluster 20: 205 elements
[INFO] Cluster 21: 390 elements
[INFO] Cluster 22: 227 elements
[INFO] Cluster 23: 313 elements
[INFO] Cluster 24: 259 elements
[INFO] Cluster 25: 44 elements
[INFO] Cluster 26: 149 elements
[INFO] Cluster 27: 27 elements
[INFO] Cluster 28: 260 elements
[INFO] Cluster 29: 182 elements
[INFO] Cluster 30: 273 elements
[INFO] Cluster 31: 296 elements
[INFO] Cluster 32: 17 elements
[INFO] Cluster 33: 197 elements
[INFO] Cluster 34: 229 elements
[INFO] Cluster 35: 193 elements
[INFO] Cluster 36: 63 elements
[INFO] Cluster 37: 153 elements
[INFO] Cluster 38: 239 elements
[INFO] Cluster 39: 83 elements
[INFO] Cluster 40: 256 elements
[INFO] Cluster 41: 11 elements
[INFO] Cluster 42: 149 elements
[INFO] Cluster 43: 26 elements
[INFO] Cluster 44: 91 elements
[INFO] Cluster 45: 38 elements
[INFO] Cluster 46: 169 elements
[INFO] Cluster 47: 43 elements
[INFO] Cluster 48: 170 elements
[INFO] Cluster 49: 169 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=124, Long SMA=146, Sharpe=0.0903, Trades=34
[INFO] Cluster 1 cluster: Short SMA=90, Long SMA=120, Sharpe=-0.2567, Trades=34
[INFO] Cluster 2 cluster: Short SMA=46, Long SMA=76, Sharpe=-0.2566, Trades=46
[INFO] Cluster 3 cluster: Short SMA=36, Long SMA=78, Sharpe=-0.6261, Trades=44
[INFO] Cluster 4 cluster: Short SMA=32, Long SMA=138, Sharpe=-0.6343, Trades=26
[INFO] Cluster 5 cluster: Short SMA=22, Long SMA=44, Sharpe=-0.0448, Trades=72
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=272, Sharpe=-0.2992, Trades=18
[INFO] Cluster 8 cluster: Short SMA=50, Long SMA=148, Sharpe=-0.3727, Trades=18
[INFO] Cluster 9 cluster: Short SMA=60, Long SMA=88, Sharpe=-0.1159, Trades=45
[INFO] Cluster 10 cluster: Short SMA=116, Long SMA=120, Sharpe=0.1182, Trades=70
[INFO] Cluster 11 cluster: Short SMA=132, Long SMA=182, Sharpe=-0.0674, Trades=16
[INFO] Cluster 12 cluster: Short SMA=168, Long SMA=176, Sharpe=0.0885, Trades=50
[INFO] Cluster 13 cluster: Short SMA=184, Long SMA=242, Sharpe=0.2118, Trades=12
[INFO] Cluster 14 cluster: Short SMA=54, Long SMA=272, Sharpe=-0.1494, Trades=12
[INFO] Cluster 15 cluster: Short SMA=40, Long SMA=44, Sharpe=-0.2732, Trades=106
[INFO] Cluster 16 cluster: Short SMA=64, Long SMA=114, Sharpe=-0.2737, Trades=29
[INFO] Cluster 17 cluster: Short SMA=36, Long SMA=196, Sharpe=-0.3578, Trades=16
[INFO] Cluster 18 cluster: Short SMA=82, Long SMA=140, Sharpe=-0.0927, Trades=21
[INFO] Cluster 19 cluster: Short SMA=202, Long SMA=212, Sharpe=-0.0155, Trades=30
[INFO] Cluster 20 cluster: Short SMA=154, Long SMA=268, Sharpe=0.0127, Trades=10
[INFO] Cluster 21 cluster: Short SMA=56, Long SMA=232, Sharpe=-0.1697, Trades=10
[INFO] Cluster 22 cluster: Short SMA=16, Long SMA=242, Sharpe=-0.0623, Trades=20
[INFO] Cluster 23 cluster: Short SMA=260, Long SMA=284, Sharpe=0.2159, Trades=16
[INFO] Cluster 24 cluster: Short SMA=132, Long SMA=232, Sharpe=-0.4300, Trades=10
[INFO] Cluster 25 cluster: Short SMA=46, Long SMA=64, Sharpe=-0.6048, Trades=58
[INFO] Cluster 26 cluster: Short SMA=14, Long SMA=140, Sharpe=-0.2458, Trades=32
[INFO] Cluster 27 cluster: Short SMA=16, Long SMA=24, Sharpe=-0.0912, Trades=145
[INFO] Cluster 28 cluster: Short SMA=106, Long SMA=160, Sharpe=0.0962, Trades=16
[INFO] Cluster 29 cluster: Short SMA=16, Long SMA=182, Sharpe=-0.0057, Trades=24
[INFO] Cluster 30 cluster: Short SMA=66, Long SMA=184, Sharpe=-0.1769, Trades=14
[INFO] Cluster 31 cluster: Short SMA=156, Long SMA=198, Sharpe=-0.1290, Trades=16
[INFO] Cluster 33 cluster: Short SMA=34, Long SMA=106, Sharpe=-0.5119, Trades=38
[INFO] Cluster 34 cluster: Short SMA=202, Long SMA=262, Sharpe=0.3202, Trades=10
[INFO] Cluster 35 cluster: Short SMA=184, Long SMA=210, Sharpe=0.1478, Trades=20
[INFO] Cluster 36 cluster: Short SMA=56, Long SMA=62, Sharpe=-0.6486, Trades=80
[INFO] Cluster 37 cluster: Short SMA=234, Long SMA=256, Sharpe=0.0744, Trades=14
[INFO] Cluster 38 cluster: Short SMA=92, Long SMA=178, Sharpe=-0.1176, Trades=12
[INFO] Cluster 39 cluster: Short SMA=242, Long SMA=286, Sharpe=0.4405, Trades=12
[INFO] Cluster 40 cluster: Short SMA=148, Long SMA=240, Sharpe=-0.1702, Trades=12
[INFO] Cluster 42 cluster: Short SMA=70, Long SMA=284, Sharpe=-0.0239, Trades=10
[INFO] Cluster 43 cluster: Short SMA=162, Long SMA=166, Sharpe=-0.2076, Trades=84
[INFO] Cluster 44 cluster: Short SMA=214, Long SMA=232, Sharpe=0.4075, Trades=20
[INFO] Cluster 45 cluster: Short SMA=268, Long SMA=272, Sharpe=0.3361, Trades=30
[INFO] Cluster 46 cluster: Short SMA=112, Long SMA=216, Sharpe=-0.1775, Trades=10
[INFO] Cluster 47 cluster: Short SMA=100, Long SMA=106, Sharpe=-0.2195, Trades=65
[INFO] Cluster 48 cluster: Short SMA=220, Long SMA=258, Sharpe=0.0869, Trades=12
[INFO] Cluster 49 cluster: Short SMA=70, Long SMA=212, Sharpe=-0.0917, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=218, Long SMA=300, Sharpe=0.6533, Trades=4
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=242, Long SMA=286, Sharpe=0.4405, Trades=12
[INFO] Top 2: Short SMA=214, Long SMA=232, Sharpe=0.4075, Trades=20
[INFO] Top 3: Short SMA=268, Long SMA=272, Sharpe=0.3361, Trades=30
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 9006 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 218, Long SMA: 300
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(242/286) - Original Sharpe: 0.4405, Trades: 12
[INFO] Hierarchical cluster 2: SMA(214/232) - Original Sharpe: 0.4075, Trades: 20
[INFO] Hierarchical cluster 3: SMA(268/272) - Original Sharpe: 0.3361, Trades: 30
[INFO] Hierarchical cluster 4: SMA(202/262) - Original Sharpe: 0.3202, Trades: 10
[INFO] Hierarchical cluster 5: SMA(260/284) - Original Sharpe: 0.2159, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (218/300)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (242/286) - Sharpe: 0.4405
[INFO] cluster 2: (214/232) - Sharpe: 0.4075
[INFO] cluster 3: (268/272) - Sharpe: 0.3361
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     3.716844            3.716844
1    2021-11-10 2021-11-10            41    -0.412472           -0.412472
2    2022-01-10 2022-01-10            41     4.290205            4.290205
3    2022-03-10 2022-03-10            42     0.696473            0.696473
4    2022-05-10 2022-05-10            41    -1.906913           -1.906913
5    2022-07-10 2022-07-10            44     0.008064            0.008064
6    2022-09-10 2022-09-10            43     0.059045            0.059045
7    2022-11-10 2022-11-10            40    -2.768953           -2.768953
8    2023-01-10 2023-01-10            41     0.901765            0.041333
9    2023-03-10 2023-03-10            42    -2.058673            0.167853
10   2023-05-10 2023-05-10            40     0.600971            1.566265
11   2023-07-10 2023-07-10            44     1.747552            1.308938
12   2023-09-10 2023-09-10            44     2.993555            2.775302
13   2023-11-10 2023-11-10            40     0.817504            0.817504
14   2024-01-10 2024-01-10            41     1.290468            1.290468
15   2024-03-10 2024-03-10            43    -2.221917           -2.221917
16   2024-05-10 2024-05-10            40     2.247863            2.247863
17   2024-07-10 2024-07-10            43     0.009942            0.009942
18   2024-09-10 2024-09-10            44     0.461751            0.461751
19   2024-11-10 2024-11-10            35     0.788268            0.788268
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2022-01-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-03-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-10   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-11-10   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2023-01-10   |          0.9 |              0.0 |         -0.9 | False         
[INFO] 2023-03-10   |         -2.1 |              0.2 |          2.3 | True          
[INFO] 2023-05-10   |          0.6 |              1.6 |          1.0 | True          
[INFO] 2023-07-10   |          1.7 |              1.3 |         -0.4 | False         
[INFO] 2023-09-10   |          3.0 |              2.8 |         -0.2 | False         
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2024-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2022-05-10, 2022-07-10, 2022-09-10, 2022-11-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 5
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 5 periods (40.00% win rate)
[INFO] Updating Excel file with Hierarchical results for KW...
[INFO] Excel file updated successfully. Added KW with Hierarchical win rate 40.0% in row 28
[INFO] Added best Sharpe parameters 218/300 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 218, Long SMA: 300
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(242/286) - Original Sharpe: 0.4405
[INFO] Added cluster 2 to portfolio: SMA(214/232) - Original Sharpe: 0.4075
[INFO] Added cluster 3 to portfolio: SMA(268/272) - Original Sharpe: 0.3361
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KW_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.7571
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6641
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for KW...
[INFO] Excel file updated successfully. Added KW with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KW
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LC in column D: 13.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 70.45s
[INFO] Best parameters: Short SMA = 132, Long SMA = 256
[INFO] Best Sharpe ratio: 0.667366, Trades: 14
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LC
[INFO] Big Point Value (from data): 400.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.44 contracts
[INFO] Maximum Position Size: 19 contracts
[INFO] Strategy Total P&L: $356,156.00
[INFO] Market Buy & Hold P&L: $19,030.00
[INFO] Outperformance: $337,126.00
[INFO] Sharpe ratio (entire period, annualized): 0.433210
[INFO] Sharpe ratio (in-sample, annualized): 0.667366
[INFO] Sharpe ratio (out-of-sample, annualized): -0.118494
[INFO] Maximum Drawdown: $172,019.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 9
[INFO] Out-of-sample period trades: 5
[INFO] Total trades: 14
[INFO] In-sample P&L: $373,813.00
[INFO] Out-of-sample P&L: $-28,163.00
[INFO] 
Best parameters from GA: Short SMA = 132, Long SMA = 256, Sharpe = 0.667366
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 400.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7424 to 0.6674
[INFO] 
Best parameters:
[INFO] Short SMA: 132
[INFO] Long SMA: 256
[INFO] Sharpe Ratio: 0.667366
[INFO] Number of Trades: 14
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7424 to 0.6674
[INFO] Trades range: 12.0 to 373.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6486 to 2.9007
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 263 elements
[INFO] Kmeans Cluster 1: 232 elements
[INFO] Kmeans Cluster 2: 366 elements
[INFO] Kmeans Cluster 3: 168 elements
[INFO] Kmeans Cluster 4: 256 elements
[INFO] Kmeans Cluster 5: 180 elements
[INFO] Kmeans Cluster 6: 309 elements
[INFO] Kmeans Cluster 7: 180 elements
[INFO] Kmeans Cluster 8: 187 elements
[INFO] Kmeans Cluster 9: 149 elements
[INFO] Kmeans Cluster 10: 221 elements
[INFO] Kmeans Cluster 11: 219 elements
[INFO] Kmeans Cluster 12: 290 elements
[INFO] Kmeans Cluster 13: 235 elements
[INFO] Kmeans Cluster 14: 217 elements
[INFO] Kmeans Cluster 15: 135 elements
[INFO] Kmeans Cluster 16: 191 elements
[INFO] Kmeans Cluster 17: 428 elements
[INFO] Kmeans Cluster 18: 200 elements
[INFO] Kmeans Cluster 19: 260 elements
[INFO] Kmeans Cluster 20: 104 elements
[INFO] Kmeans Cluster 21: 248 elements
[INFO] Kmeans Cluster 22: 125 elements
[INFO] Kmeans Cluster 23: 112 elements
[INFO] Kmeans Cluster 24: 354 elements
[INFO] Kmeans Cluster 25: 30 elements
[INFO] Kmeans Cluster 26: 232 elements
[INFO] Kmeans Cluster 27: 188 elements
[INFO] Kmeans Cluster 28: 147 elements
[INFO] Kmeans Cluster 29: 244 elements
[INFO] Kmeans Cluster 30: 272 elements
[INFO] Kmeans Cluster 31: 193 elements
[INFO] Kmeans Cluster 32: 393 elements
[INFO] Kmeans Cluster 33: 141 elements
[INFO] Kmeans Cluster 34: 270 elements
[INFO] Kmeans Cluster 35: 164 elements
[INFO] Kmeans Cluster 36: 286 elements
[INFO] Kmeans Cluster 37: 275 elements
[INFO] Kmeans Cluster 38: 211 elements
[INFO] Kmeans Cluster 39: 210 elements
[INFO] Kmeans Cluster 40: 60 elements
[INFO] Kmeans Cluster 41: 93 elements
[INFO] Kmeans Cluster 42: 221 elements
[INFO] Kmeans Cluster 43: 125 elements
[INFO] Kmeans Cluster 44: 147 elements
[INFO] Kmeans Cluster 45: 184 elements
[INFO] Kmeans Cluster 46: 277 elements
[INFO] Kmeans Cluster 47: 200 elements
[INFO] Kmeans Cluster 48: 217 elements
[INFO] Kmeans Cluster 49: 176 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=36.54, Long SMA=61.63, Sharpe=0.2568
[INFO] Centroid 1: Short SMA=127.43, Long SMA=285.46, Sharpe=-0.0041
[INFO] Centroid 2: Short SMA=51.72, Long SMA=160.03, Sharpe=-0.3190
[INFO] Centroid 3: Short SMA=154.86, Long SMA=256.73, Sharpe=0.2452
[INFO] Centroid 4: Short SMA=216.50, Long SMA=286.65, Sharpe=-0.5247
[INFO] Centroid 5: Short SMA=108.53, Long SMA=141.78, Sharpe=-0.2685
[INFO] Centroid 6: Short SMA=27.85, Long SMA=211.66, Sharpe=-0.0596
[INFO] Centroid 7: Short SMA=167.23, Long SMA=202.58, Sharpe=0.0216
[INFO] Centroid 8: Short SMA=85.44, Long SMA=275.96, Sharpe=-0.1417
[INFO] Centroid 9: Short SMA=152.93, Long SMA=171.37, Sharpe=0.3328
[INFO] Centroid 10: Short SMA=32.65, Long SMA=120.21, Sharpe=-0.0667
[INFO] Centroid 11: Short SMA=182.56, Long SMA=267.04, Sharpe=-0.1847
[INFO] Centroid 12: Short SMA=98.81, Long SMA=186.21, Sharpe=-0.2176
[INFO] Centroid 13: Short SMA=138.95, Long SMA=202.43, Sharpe=0.2024
[INFO] Centroid 14: Short SMA=140.06, Long SMA=235.58, Sharpe=0.3887
[INFO] Centroid 15: Short SMA=221.24, Long SMA=250.41, Sharpe=-0.3438
[INFO] Centroid 16: Short SMA=104.30, Long SMA=248.02, Sharpe=0.0954
[INFO] Centroid 17: Short SMA=88.61, Long SMA=210.21, Sharpe=-0.0827
[INFO] Centroid 18: Short SMA=136.44, Long SMA=249.37, Sharpe=0.5355
[INFO] Centroid 19: Short SMA=96.38, Long SMA=151.11, Sharpe=-0.3879
[INFO] Centroid 20: Short SMA=196.27, Long SMA=216.62, Sharpe=0.3330
[INFO] Centroid 21: Short SMA=26.04, Long SMA=158.27, Sharpe=-0.1802
[INFO] Centroid 22: Short SMA=84.06, Long SMA=104.67, Sharpe=-0.3222
[INFO] Centroid 23: Short SMA=214.36, Long SMA=238.00, Sharpe=-0.0747
[INFO] Centroid 24: Short SMA=67.11, Long SMA=246.68, Sharpe=-0.0342
[INFO] Centroid 25: Short SMA=13.60, Long SMA=24.00, Sharpe=-0.2806
[INFO] Centroid 26: Short SMA=234.14, Long SMA=262.39, Sharpe=-0.5004
[INFO] Centroid 27: Short SMA=125.54, Long SMA=158.48, Sharpe=-0.1225
[INFO] Centroid 28: Short SMA=21.16, Long SMA=107.46, Sharpe=0.1718
[INFO] Centroid 29: Short SMA=77.64, Long SMA=288.75, Sharpe=-0.2669
[INFO] Centroid 30: Short SMA=189.59, Long SMA=220.43, Sharpe=0.1503
[INFO] Centroid 31: Short SMA=34.72, Long SMA=287.41, Sharpe=-0.3137
[INFO] Centroid 32: Short SMA=30.94, Long SMA=247.70, Sharpe=0.0510
[INFO] Centroid 33: Short SMA=16.54, Long SMA=179.76, Sharpe=0.0006
[INFO] Centroid 34: Short SMA=66.19, Long SMA=136.27, Sharpe=-0.1910
[INFO] Centroid 35: Short SMA=194.99, Long SMA=282.59, Sharpe=-0.3909
[INFO] Centroid 36: Short SMA=27.72, Long SMA=76.56, Sharpe=0.4068
[INFO] Centroid 37: Short SMA=54.97, Long SMA=201.61, Sharpe=-0.2279
[INFO] Centroid 38: Short SMA=131.59, Long SMA=166.70, Sharpe=0.0490
[INFO] Centroid 39: Short SMA=111.51, Long SMA=249.48, Sharpe=0.2305
[INFO] Centroid 40: Short SMA=277.93, Long SMA=285.57, Sharpe=-0.1664
[INFO] Centroid 41: Short SMA=172.39, Long SMA=189.31, Sharpe=-0.1449
[INFO] Centroid 42: Short SMA=57.97, Long SMA=88.89, Sharpe=0.0713
[INFO] Centroid 43: Short SMA=22.38, Long SMA=41.54, Sharpe=0.0624
[INFO] Centroid 44: Short SMA=264.12, Long SMA=280.20, Sharpe=-0.3889
[INFO] Centroid 45: Short SMA=175.89, Long SMA=245.51, Sharpe=0.0286
[INFO] Centroid 46: Short SMA=79.40, Long SMA=111.00, Sharpe=-0.0961
[INFO] Centroid 47: Short SMA=155.58, Long SMA=292.28, Sharpe=-0.2218
[INFO] Centroid 48: Short SMA=30.44, Long SMA=277.30, Sharpe=-0.1151
[INFO] Centroid 49: Short SMA=254.90, Long SMA=290.80, Sharpe=-0.5652
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=132, Long SMA=256, Sharpe=0.6674, Trades=14
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=136, Long SMA=250, Sharpe=0.5839, Trades=14
[INFO] Kmeans Top 2: Short SMA=154, Long SMA=172, Sharpe=0.5522, Trades=34
[INFO] Kmeans Top 3: Short SMA=142, Long SMA=234, Sharpe=0.4058, Trades=14
[INFO] Kmeans Top 4: Short SMA=26, Long SMA=78, Sharpe=0.3957, Trades=34
[INFO] Kmeans Top 5: Short SMA=198, Long SMA=218, Sharpe=0.3679, Trades=30
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (37, 62)
[INFO]   Nearest: (36.0, 62.0)
[INFO]   Rounded: (127, 285)
[INFO]   Nearest: (128.0, 286.0)
[INFO]   Rounded: (52, 160)
[INFO]   Rounded: (155, 257)
[INFO]   Nearest: (154.0, 256.0)
[INFO]   Rounded: (216, 287)
[INFO]   Nearest: (216.0, 286.0)
[INFO]   Rounded: (109, 142)
[INFO]   Nearest: (108.0, 142.0)
[INFO]   Rounded: (28, 212)
[INFO]   Rounded: (167, 203)
[INFO]   Nearest: (168.0, 202.0)
[INFO]   Rounded: (85, 276)
[INFO]   Nearest: (86.0, 276.0)
[INFO]   Rounded: (153, 171)
[INFO]   Nearest: (152.0, 172.0)
[INFO]   Rounded: (33, 120)
[INFO]   Nearest: (32.0, 120.0)
[INFO]   Rounded: (183, 267)
[INFO]   Nearest: (182.0, 268.0)
[INFO]   Rounded: (99, 186)
[INFO]   Nearest: (98.0, 186.0)
[INFO]   Rounded: (139, 202)
[INFO]   Nearest: (138.0, 202.0)
[INFO]   Rounded: (140, 236)
[INFO]   Rounded: (221, 250)
[INFO]   Nearest: (222.0, 250.0)
[INFO]   Rounded: (104, 248)
[INFO]   Rounded: (89, 210)
[INFO]   Nearest: (88.0, 210.0)
[INFO]   Rounded: (136, 249)
[INFO]   Nearest: (136.0, 250.0)
[INFO]   Rounded: (96, 151)
[INFO]   Nearest: (96.0, 152.0)
[INFO]   Rounded: (196, 217)
[INFO]   Nearest: (196.0, 216.0)
[INFO]   Rounded: (26, 158)
[INFO]   Rounded: (84, 105)
[INFO]   Nearest: (84.0, 104.0)
[INFO]   Rounded: (214, 238)
[INFO]   Rounded: (67, 247)
[INFO]   Nearest: (68.0, 246.0)
[INFO]   Rounded: (14, 24)
[INFO]   Rounded: (234, 262)
[INFO]   Rounded: (126, 158)
[INFO]   Rounded: (21, 107)
[INFO]   Nearest: (22.0, 108.0)
[INFO]   Rounded: (78, 289)
[INFO]   Nearest: (78.0, 288.0)
[INFO]   Rounded: (190, 220)
[INFO]   Rounded: (35, 287)
[INFO]   Nearest: (34.0, 288.0)
[INFO]   Rounded: (31, 248)
[INFO]   Nearest: (30.0, 248.0)
[INFO]   Rounded: (17, 180)
[INFO]   Nearest: (16.0, 180.0)
[INFO]   Rounded: (66, 136)
[INFO]   Rounded: (195, 283)
[INFO]   Nearest: (194.0, 282.0)
[INFO]   Rounded: (28, 77)
[INFO]   Nearest: (28.0, 76.0)
[INFO]   Rounded: (55, 202)
[INFO]   Nearest: (54.0, 202.0)
[INFO]   Rounded: (132, 167)
[INFO]   Nearest: (132.0, 166.0)
[INFO]   Rounded: (112, 249)
[INFO]   Nearest: (112.0, 250.0)
[INFO]   Rounded: (278, 286)
[INFO]   Rounded: (172, 189)
[INFO]   Nearest: (172.0, 190.0)
[INFO]   Rounded: (58, 89)
[INFO]   Nearest: (58.0, 88.0)
[INFO]   Rounded: (22, 42)
[INFO]   Rounded: (264, 280)
[INFO]   Rounded: (176, 246)
[INFO]   Rounded: (79, 111)
[INFO]   Nearest: (80.0, 112.0)
[INFO]   Rounded: (156, 292)
[INFO]   Rounded: (30, 277)
[INFO]   Nearest: (30.0, 278.0)
[INFO]   Rounded: (255, 291)
[INFO]   Nearest: (254.0, 290.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 132, Long SMA: 256
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(136/250) - Original Sharpe: 0.5839, Trades: 14
[INFO] Kmeans cluster 2: SMA(154/172) - Original Sharpe: 0.5522, Trades: 34
[INFO] Kmeans cluster 3: SMA(142/234) - Original Sharpe: 0.4058, Trades: 14
[INFO] Kmeans cluster 4: SMA(26/78) - Original Sharpe: 0.3957, Trades: 34
[INFO] Kmeans cluster 5: SMA(198/218) - Original Sharpe: 0.3679, Trades: 30
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (132/256)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (136/250) - Sharpe: 0.5839
[INFO] cluster 2: (154/172) - Sharpe: 0.5522
[INFO] cluster 3: (142/234) - Sharpe: 0.4058
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.063439           -1.063439
1    2021-11-10 2021-11-10            41    -1.314198           -2.002354
2    2022-01-10 2022-01-10            41    -5.643048           -5.432694
3    2022-03-10 2022-03-10            42    -0.325669           -0.963855
4    2022-05-10 2022-05-10            41     0.167451            0.167451
5    2022-07-10 2022-07-10            44    -0.540213            1.176167
6    2022-09-10 2022-09-10            43    -0.837964           -1.387369
7    2022-11-10 2022-11-10            40     0.541236            0.984847
8    2023-01-10 2023-01-10            41     1.733004            1.733004
9    2023-03-10 2023-03-10            42     1.762416            1.762416
10   2023-05-10 2023-05-10            40     4.337990            4.337990
11   2023-07-10 2023-07-10            44     1.358879            1.358879
12   2023-09-10 2023-09-10            44    -2.443328           -2.443328
13   2023-11-10 2023-11-10            40    -0.939135           -0.939135
14   2024-01-10 2024-01-10            41     4.199481            4.999459
15   2024-03-10 2024-03-10            43    -1.906869           -0.880365
16   2024-05-10 2024-05-10            40    -2.345527           -2.350005
17   2024-07-10 2024-07-10            43    -1.402768           -2.284408
18   2024-09-10 2024-09-10            44     1.583600            4.034420
19   2024-11-10 2024-11-10            35     2.423431            2.381075
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -1.3 |             -2.0 |         -0.7 | False         
[INFO] 2022-01-10   |         -5.6 |             -5.4 |          0.2 | True          
[INFO] 2022-03-10   |         -0.3 |             -1.0 |         -0.7 | False         
[INFO] 2022-05-10   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.5 |              1.2 |          1.7 | True          
[INFO] 2022-09-10   |         -0.8 |             -1.4 |         -0.6 | False         
[INFO] 2022-11-10   |          0.5 |              1.0 |          0.5 | True          
[INFO] 2023-01-10   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-10   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2023-05-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2023-07-10   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-01-10   |          4.2 |              5.0 |          0.8 | True          
[INFO] 2024-03-10   |         -1.9 |             -0.9 |          1.0 | True          
[INFO] 2024-05-10   |         -2.3 |             -2.4 |         -0.1 | False         
[INFO] 2024-07-10   |         -1.4 |             -2.3 |         -0.9 | False         
[INFO] 2024-09-10   |          1.6 |              4.0 |          2.4 | True          
[INFO] 2024-11-10   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2022-05-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Kmeans cluster wins (rounded comparison): 6 of 11 periods (54.55% win rate)
[INFO] Updating Excel file with Kmeans results for LC...
[INFO] Excel file updated successfully. Added LC with Kmeans win rate 54.5% in row 29
[INFO] Added best Sharpe parameters 132/256 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 132, Long SMA: 256
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(136/250) - Original Sharpe: 0.5839
[INFO] Added cluster 2 to portfolio: SMA(154/172) - Original Sharpe: 0.5522
[INFO] Added cluster 3 to portfolio: SMA(142/234) - Original Sharpe: 0.4058
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0569
[INFO] Kmeans Best out-of-sample Sharpe: -0.1185
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for LC...
[INFO] Excel file updated successfully. Added LC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LC
[INFO] Big Point Value: 400.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7424 to 0.6674
[INFO] 
Best parameters:
[INFO] Short SMA: 132
[INFO] Long SMA: 256
[INFO] Sharpe Ratio: 0.667366
[INFO] Number of Trades: 14
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7424 to 0.6674
[INFO] Trades range: 12.0 to 373.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6486 to 2.9007
[INFO] Scaled Trades range: -0.7810 to 17.3722
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6075
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 478 elements
[INFO] Cluster 1: 15 elements
[INFO] Cluster 2: 352 elements
[INFO] Cluster 3: 133 elements
[INFO] Cluster 4: 419 elements
[INFO] Cluster 5: 89 elements
[INFO] Cluster 6: 246 elements
[INFO] Cluster 7: 270 elements
[INFO] Cluster 8: 526 elements
[INFO] Cluster 9: 410 elements
[INFO] Cluster 10: 325 elements
[INFO] Cluster 11: 150 elements
[INFO] Cluster 12: 56 elements
[INFO] Cluster 13: 337 elements
[INFO] Cluster 14: 343 elements
[INFO] Cluster 15: 201 elements
[INFO] Cluster 16: 230 elements
[INFO] Cluster 17: 283 elements
[INFO] Cluster 18: 390 elements
[INFO] Cluster 19: 272 elements
[INFO] Cluster 20: 275 elements
[INFO] Cluster 21: 316 elements
[INFO] Cluster 22: 36 elements
[INFO] Cluster 23: 28 elements
[INFO] Cluster 24: 391 elements
[INFO] Cluster 25: 392 elements
[INFO] Cluster 26: 146 elements
[INFO] Cluster 27: 253 elements
[INFO] Cluster 28: 128 elements
[INFO] Cluster 29: 164 elements
[INFO] Cluster 30: 4 elements
[INFO] Cluster 31: 207 elements
[INFO] Cluster 32: 159 elements
[INFO] Cluster 33: 193 elements
[INFO] Cluster 34: 46 elements
[INFO] Cluster 35: 106 elements
[INFO] Cluster 36: 257 elements
[INFO] Cluster 37: 334 elements
[INFO] Cluster 38: 76 elements
[INFO] Cluster 39: 193 elements
[INFO] Cluster 40: 48 elements
[INFO] Cluster 41: 65 elements
[INFO] Cluster 42: 167 elements
[INFO] Cluster 43: 486 elements
[INFO] Cluster 44: 81 elements
[INFO] Cluster 45: 94 elements
[INFO] Cluster 46: 111 elements
[INFO] Cluster 47: 146 elements
[INFO] Cluster 48: 135 elements
[INFO] Cluster 49: 23 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=100, Long SMA=178, Sharpe=-0.2394, Trades=20
[INFO] Cluster 2 cluster: Short SMA=26, Long SMA=202, Sharpe=-0.0906, Trades=22
[INFO] Cluster 3 cluster: Short SMA=30, Long SMA=46, Sharpe=0.2510, Trades=75
[INFO] Cluster 4 cluster: Short SMA=26, Long SMA=156, Sharpe=-0.2245, Trades=30
[INFO] Cluster 5 cluster: Short SMA=262, Long SMA=266, Sharpe=-0.0947, Trades=63
[INFO] Cluster 6 cluster: Short SMA=188, Long SMA=224, Sharpe=0.2513, Trades=25
[INFO] Cluster 7 cluster: Short SMA=116, Long SMA=280, Sharpe=0.0504, Trades=15
[INFO] Cluster 8 cluster: Short SMA=72, Long SMA=128, Sharpe=-0.1420, Trades=26
[INFO] Cluster 9 cluster: Short SMA=138, Long SMA=246, Sharpe=0.5967, Trades=14
[INFO] Cluster 10 cluster: Short SMA=32, Long SMA=102, Sharpe=0.2584, Trades=32
[INFO] Cluster 11 cluster: Short SMA=204, Long SMA=244, Sharpe=-0.1458, Trades=25
[INFO] Cluster 12 cluster: Short SMA=176, Long SMA=178, Sharpe=-0.3760, Trades=100
[INFO] Cluster 13 cluster: Short SMA=46, Long SMA=248, Sharpe=-0.0302, Trades=18
[INFO] Cluster 14 cluster: Short SMA=54, Long SMA=158, Sharpe=-0.2851, Trades=20
[INFO] Cluster 15 cluster: Short SMA=40, Long SMA=286, Sharpe=-0.2680, Trades=25
[INFO] Cluster 16 cluster: Short SMA=166, Long SMA=258, Sharpe=0.1442, Trades=13
[INFO] Cluster 17 cluster: Short SMA=262, Long SMA=282, Sharpe=-0.3665, Trades=31
[INFO] Cluster 18 cluster: Short SMA=170, Long SMA=282, Sharpe=-0.2089, Trades=13
[INFO] Cluster 19 cluster: Short SMA=150, Long SMA=198, Sharpe=0.2100, Trades=24
[INFO] Cluster 20 cluster: Short SMA=28, Long SMA=60, Sharpe=0.1866, Trades=47
[INFO] Cluster 21 cluster: Short SMA=112, Long SMA=238, Sharpe=0.2581, Trades=16
[INFO] Cluster 22 cluster: Short SMA=84, Long SMA=86, Sharpe=-0.2862, Trades=114
[INFO] Cluster 23 cluster: Short SMA=42, Long SMA=44, Sharpe=-0.0135, Trades=166
[INFO] Cluster 24 cluster: Short SMA=226, Long SMA=284, Sharpe=-0.5561, Trades=17
[INFO] Cluster 25 cluster: Short SMA=78, Long SMA=286, Sharpe=-0.2798, Trades=15
[INFO] Cluster 26 cluster: Short SMA=158, Long SMA=254, Sharpe=0.2662, Trades=13
[INFO] Cluster 27 cluster: Short SMA=102, Long SMA=148, Sharpe=-0.3834, Trades=28
[INFO] Cluster 28 cluster: Short SMA=152, Long SMA=172, Sharpe=0.3737, Trades=34
[INFO] Cluster 29 cluster: Short SMA=26, Long SMA=82, Sharpe=0.5313, Trades=34
[INFO] Cluster 31 cluster: Short SMA=54, Long SMA=104, Sharpe=-0.0191, Trades=28
[INFO] Cluster 32 cluster: Short SMA=132, Long SMA=154, Sharpe=-0.1392, Trades=34
[INFO] Cluster 33 cluster: Short SMA=56, Long SMA=208, Sharpe=-0.2409, Trades=20
[INFO] Cluster 34 cluster: Short SMA=172, Long SMA=178, Sharpe=-0.1872, Trades=58
[INFO] Cluster 35 cluster: Short SMA=84, Long SMA=106, Sharpe=-0.2733, Trades=34
[INFO] Cluster 36 cluster: Short SMA=20, Long SMA=248, Sharpe=0.0777, Trades=30
[INFO] Cluster 37 cluster: Short SMA=94, Long SMA=208, Sharpe=-0.0932, Trades=16
[INFO] Cluster 38 cluster: Short SMA=230, Long SMA=240, Sharpe=-0.3174, Trades=43
[INFO] Cluster 39 cluster: Short SMA=198, Long SMA=282, Sharpe=-0.4368, Trades=13
[INFO] Cluster 40 cluster: Short SMA=186, Long SMA=190, Sharpe=0.2070, Trades=70
[INFO] Cluster 41 cluster: Short SMA=32, Long SMA=38, Sharpe=0.1894, Trades=106
[INFO] Cluster 42 cluster: Short SMA=30, Long SMA=280, Sharpe=-0.1780, Trades=25
[INFO] Cluster 43 cluster: Short SMA=78, Long SMA=238, Sharpe=0.0900, Trades=18
[INFO] Cluster 44 cluster: Short SMA=110, Long SMA=118, Sharpe=-0.2332, Trades=53
[INFO] Cluster 45 cluster: Short SMA=198, Long SMA=210, Sharpe=0.1678, Trades=41
[INFO] Cluster 46 cluster: Short SMA=168, Long SMA=196, Sharpe=-0.0055, Trades=30
[INFO] Cluster 47 cluster: Short SMA=222, Long SMA=256, Sharpe=-0.4175, Trades=25
[INFO] Cluster 48 cluster: Short SMA=138, Long SMA=202, Sharpe=0.2299, Trades=20
[INFO] Cluster 49 cluster: Short SMA=102, Long SMA=106, Sharpe=-0.3398, Trades=78
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=132, Long SMA=256, Sharpe=0.6674, Trades=14
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=138, Long SMA=246, Sharpe=0.5967, Trades=14
[INFO] Top 2: Short SMA=26, Long SMA=82, Sharpe=0.5313, Trades=34
[INFO] Top 3: Short SMA=152, Long SMA=172, Sharpe=0.3737, Trades=34
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10566 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 132, Long SMA: 256
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(138/246) - Original Sharpe: 0.5967, Trades: 14
[INFO] Hierarchical cluster 2: SMA(26/82) - Original Sharpe: 0.5313, Trades: 34
[INFO] Hierarchical cluster 3: SMA(152/172) - Original Sharpe: 0.3737, Trades: 34
[INFO] Hierarchical cluster 4: SMA(158/254) - Original Sharpe: 0.2662, Trades: 13
[INFO] Hierarchical cluster 5: SMA(32/102) - Original Sharpe: 0.2584, Trades: 32
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (132/256)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (138/246) - Sharpe: 0.5967
[INFO] cluster 2: (26/82) - Sharpe: 0.5313
[INFO] cluster 3: (152/172) - Sharpe: 0.3737
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.063439           -1.402009
1    2021-11-10 2021-11-10            41    -1.314198           -2.609414
2    2022-01-10 2022-01-10            41    -5.643048           -2.945744
3    2022-03-10 2022-03-10            42    -0.325669            0.959289
4    2022-05-10 2022-05-10            41     0.167451            0.167451
5    2022-07-10 2022-07-10            44    -0.540213            1.708677
6    2022-09-10 2022-09-10            43    -0.837964           -2.152975
7    2022-11-10 2022-11-10            40     0.541236            1.495133
8    2023-01-10 2023-01-10            41     1.733004            1.733004
9    2023-03-10 2023-03-10            42     1.762416            1.762416
10   2023-05-10 2023-05-10            40     4.337990            4.337990
11   2023-07-10 2023-07-10            44     1.358879            1.358879
12   2023-09-10 2023-09-10            44    -2.443328           -1.543865
13   2023-11-10 2023-11-10            40    -0.939135           -0.939135
14   2024-01-10 2024-01-10            41     4.199481            2.798215
15   2024-03-10 2024-03-10            43    -1.906869           -0.982986
16   2024-05-10 2024-05-10            40    -2.345527           -3.376726
17   2024-07-10 2024-07-10            43    -1.402768           -1.672777
18   2024-09-10 2024-09-10            44     1.583600           -0.453294
19   2024-11-10 2024-11-10            35     2.423431            2.423431
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.1 |             -1.4 |         -0.3 | False         
[INFO] 2021-11-10   |         -1.3 |             -2.6 |         -1.3 | False         
[INFO] 2022-01-10   |         -5.6 |             -2.9 |          2.7 | True          
[INFO] 2022-03-10   |         -0.3 |              1.0 |          1.3 | True          
[INFO] 2022-05-10   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.5 |              1.7 |          2.2 | True          
[INFO] 2022-09-10   |         -0.8 |             -2.2 |         -1.4 | False         
[INFO] 2022-11-10   |          0.5 |              1.5 |          1.0 | True          
[INFO] 2023-01-10   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-10   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2023-05-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2023-07-10   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -2.4 |             -1.5 |          0.9 | True          
[INFO] 2023-11-10   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-01-10   |          4.2 |              2.8 |         -1.4 | False         
[INFO] 2024-03-10   |         -1.9 |             -1.0 |          0.9 | True          
[INFO] 2024-05-10   |         -2.3 |             -3.4 |         -1.1 | False         
[INFO] 2024-07-10   |         -1.4 |             -1.7 |         -0.3 | False         
[INFO] 2024-09-10   |          1.6 |             -0.5 |         -2.1 | False         
[INFO] 2024-11-10   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-11-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 13 periods (46.15% win rate)
[INFO] Updating Excel file with Hierarchical results for LC...
[INFO] Excel file updated successfully. Added LC with Hierarchical win rate 46.2% in row 29
[INFO] Added best Sharpe parameters 132/256 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 132, Long SMA: 256
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(138/246) - Original Sharpe: 0.5967
[INFO] Added cluster 2 to portfolio: SMA(26/82) - Original Sharpe: 0.5313
[INFO] Added cluster 3 to portfolio: SMA(152/172) - Original Sharpe: 0.3737
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2122
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1185
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for LC...
[INFO] Excel file updated successfully. Added LC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LC
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LH in column D: 17.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 73.23s
[INFO] Best parameters: Short SMA = 22, Long SMA = 32
[INFO] Best Sharpe ratio: 1.140809, Trades: 90
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LH
[INFO] Big Point Value (from data): 400.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.56 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $871,258.00
[INFO] Market Buy & Hold P&L: $-13,970.00
[INFO] Outperformance: $885,228.00
[INFO] Sharpe ratio (entire period, annualized): 0.831820
[INFO] Sharpe ratio (in-sample, annualized): 1.140809
[INFO] Sharpe ratio (out-of-sample, annualized): 0.115284
[INFO] Maximum Drawdown: $109,300.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 60
[INFO] Out-of-sample period trades: 30
[INFO] Total trades: 90
[INFO] In-sample P&L: $656,660.00
[INFO] Out-of-sample P&L: $28,587.00
[INFO] 
Best parameters from GA: Short SMA = 22, Long SMA = 32, Sharpe = 1.140809
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 400.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8288 to 1.1408
[INFO] 
Best parameters:
[INFO] Short SMA: 22
[INFO] Long SMA: 32
[INFO] Sharpe Ratio: 1.140809
[INFO] Number of Trades: 90
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8288 to 1.1408
[INFO] Trades range: 14.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8198 to 3.1932
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 232 elements
[INFO] Kmeans Cluster 1: 204 elements
[INFO] Kmeans Cluster 2: 240 elements
[INFO] Kmeans Cluster 3: 239 elements
[INFO] Kmeans Cluster 4: 195 elements
[INFO] Kmeans Cluster 5: 335 elements
[INFO] Kmeans Cluster 6: 227 elements
[INFO] Kmeans Cluster 7: 160 elements
[INFO] Kmeans Cluster 8: 256 elements
[INFO] Kmeans Cluster 9: 275 elements
[INFO] Kmeans Cluster 10: 185 elements
[INFO] Kmeans Cluster 11: 207 elements
[INFO] Kmeans Cluster 12: 162 elements
[INFO] Kmeans Cluster 13: 80 elements
[INFO] Kmeans Cluster 14: 192 elements
[INFO] Kmeans Cluster 15: 127 elements
[INFO] Kmeans Cluster 16: 209 elements
[INFO] Kmeans Cluster 17: 251 elements
[INFO] Kmeans Cluster 18: 202 elements
[INFO] Kmeans Cluster 19: 283 elements
[INFO] Kmeans Cluster 20: 265 elements
[INFO] Kmeans Cluster 21: 177 elements
[INFO] Kmeans Cluster 22: 326 elements
[INFO] Kmeans Cluster 23: 340 elements
[INFO] Kmeans Cluster 24: 230 elements
[INFO] Kmeans Cluster 25: 236 elements
[INFO] Kmeans Cluster 26: 166 elements
[INFO] Kmeans Cluster 27: 163 elements
[INFO] Kmeans Cluster 28: 195 elements
[INFO] Kmeans Cluster 29: 160 elements
[INFO] Kmeans Cluster 30: 230 elements
[INFO] Kmeans Cluster 31: 250 elements
[INFO] Kmeans Cluster 32: 201 elements
[INFO] Kmeans Cluster 33: 179 elements
[INFO] Kmeans Cluster 34: 171 elements
[INFO] Kmeans Cluster 35: 238 elements
[INFO] Kmeans Cluster 36: 155 elements
[INFO] Kmeans Cluster 37: 273 elements
[INFO] Kmeans Cluster 38: 159 elements
[INFO] Kmeans Cluster 39: 100 elements
[INFO] Kmeans Cluster 40: 295 elements
[INFO] Kmeans Cluster 41: 240 elements
[INFO] Kmeans Cluster 42: 174 elements
[INFO] Kmeans Cluster 43: 264 elements
[INFO] Kmeans Cluster 44: 308 elements
[INFO] Kmeans Cluster 45: 80 elements
[INFO] Kmeans Cluster 46: 260 elements
[INFO] Kmeans Cluster 47: 116 elements
[INFO] Kmeans Cluster 48: 145 elements
[INFO] Kmeans Cluster 49: 228 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=90.53, Long SMA=291.00, Sharpe=0.2772
[INFO] Centroid 1: Short SMA=91.02, Long SMA=119.65, Sharpe=-0.2385
[INFO] Centroid 2: Short SMA=253.65, Long SMA=280.81, Sharpe=-0.2690
[INFO] Centroid 3: Short SMA=140.49, Long SMA=163.72, Sharpe=0.5106
[INFO] Centroid 4: Short SMA=17.59, Long SMA=82.65, Sharpe=0.2842
[INFO] Centroid 5: Short SMA=162.51, Long SMA=279.88, Sharpe=-0.1423
[INFO] Centroid 6: Short SMA=25.59, Long SMA=237.07, Sharpe=0.0577
[INFO] Centroid 7: Short SMA=153.19, Long SMA=232.09, Sharpe=0.2194
[INFO] Centroid 8: Short SMA=66.03, Long SMA=243.83, Sharpe=0.4343
[INFO] Centroid 9: Short SMA=104.15, Long SMA=184.96, Sharpe=0.4426
[INFO] Centroid 10: Short SMA=30.23, Long SMA=193.36, Sharpe=0.0556
[INFO] Centroid 11: Short SMA=264.53, Long SMA=287.99, Sharpe=-0.5341
[INFO] Centroid 12: Short SMA=31.05, Long SMA=122.15, Sharpe=-0.0400
[INFO] Centroid 13: Short SMA=18.92, Long SMA=37.05, Sharpe=0.7860
[INFO] Centroid 14: Short SMA=22.96, Long SMA=277.54, Sharpe=0.1381
[INFO] Centroid 15: Short SMA=13.07, Long SMA=155.50, Sharpe=0.4189
[INFO] Centroid 16: Short SMA=87.89, Long SMA=225.09, Sharpe=0.3407
[INFO] Centroid 17: Short SMA=230.50, Long SMA=259.63, Sharpe=-0.1177
[INFO] Centroid 18: Short SMA=210.59, Long SMA=291.80, Sharpe=-0.5272
[INFO] Centroid 19: Short SMA=80.35, Long SMA=200.03, Sharpe=0.2011
[INFO] Centroid 20: Short SMA=129.07, Long SMA=202.75, Sharpe=0.6048
[INFO] Centroid 21: Short SMA=59.81, Long SMA=164.99, Sharpe=-0.3216
[INFO] Centroid 22: Short SMA=174.39, Long SMA=243.52, Sharpe=0.0287
[INFO] Centroid 23: Short SMA=57.71, Long SMA=275.53, Sharpe=0.3437
[INFO] Centroid 24: Short SMA=60.83, Long SMA=84.47, Sharpe=-0.4826
[INFO] Centroid 25: Short SMA=134.69, Long SMA=280.32, Sharpe=0.0967
[INFO] Centroid 26: Short SMA=43.60, Long SMA=69.14, Sharpe=-0.1873
[INFO] Centroid 27: Short SMA=86.26, Long SMA=106.60, Sharpe=-0.1067
[INFO] Centroid 28: Short SMA=28.18, Long SMA=280.31, Sharpe=-0.0699
[INFO] Centroid 29: Short SMA=51.33, Long SMA=139.42, Sharpe=-0.3089
[INFO] Centroid 30: Short SMA=48.24, Long SMA=224.93, Sharpe=0.2250
[INFO] Centroid 31: Short SMA=168.70, Long SMA=199.24, Sharpe=0.4007
[INFO] Centroid 32: Short SMA=123.78, Long SMA=264.18, Sharpe=0.2502
[INFO] Centroid 33: Short SMA=122.82, Long SMA=153.21, Sharpe=0.6465
[INFO] Centroid 34: Short SMA=157.32, Long SMA=186.21, Sharpe=0.2513
[INFO] Centroid 35: Short SMA=190.29, Long SMA=215.16, Sharpe=0.2412
[INFO] Centroid 36: Short SMA=30.53, Long SMA=64.77, Sharpe=0.0786
[INFO] Centroid 37: Short SMA=123.07, Long SMA=231.16, Sharpe=0.4205
[INFO] Centroid 38: Short SMA=20.47, Long SMA=140.18, Sharpe=0.2263
[INFO] Centroid 39: Short SMA=71.58, Long SMA=176.44, Sharpe=-0.0560
[INFO] Centroid 40: Short SMA=213.02, Long SMA=243.13, Sharpe=-0.2601
[INFO] Centroid 41: Short SMA=49.09, Long SMA=109.43, Sharpe=-0.2319
[INFO] Centroid 42: Short SMA=73.64, Long SMA=134.68, Sharpe=-0.4455
[INFO] Centroid 43: Short SMA=194.23, Long SMA=279.13, Sharpe=-0.3276
[INFO] Centroid 44: Short SMA=96.43, Long SMA=261.89, Sharpe=0.4398
[INFO] Centroid 45: Short SMA=104.33, Long SMA=134.35, Sharpe=0.1713
[INFO] Centroid 46: Short SMA=43.13, Long SMA=177.52, Sharpe=-0.1889
[INFO] Centroid 47: Short SMA=18.71, Long SMA=40.62, Sharpe=0.4761
[INFO] Centroid 48: Short SMA=15.21, Long SMA=208.91, Sharpe=0.2303
[INFO] Centroid 49: Short SMA=105.56, Long SMA=152.12, Sharpe=0.5101
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=22, Long SMA=32, Sharpe=1.1408, Trades=90
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=18, Long SMA=38, Sharpe=0.7061, Trades=70
[INFO] Kmeans Top 2: Short SMA=130, Long SMA=204, Sharpe=0.6401, Trades=20
[INFO] Kmeans Top 3: Short SMA=122, Long SMA=152, Sharpe=0.6308, Trades=28
[INFO] Kmeans Top 4: Short SMA=106, Long SMA=154, Sharpe=0.5929, Trades=24
[INFO] Kmeans Top 5: Short SMA=24, Long SMA=42, Sharpe=0.5898, Trades=69
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (91, 291)
[INFO]   Nearest: (90.0, 290.0)
[INFO]   Rounded: (91, 120)
[INFO]   Nearest: (92.0, 120.0)
[INFO]   Rounded: (254, 281)
[INFO]   Nearest: (254.0, 280.0)
[INFO]   Rounded: (140, 164)
[INFO]   Rounded: (18, 83)
[INFO]   Nearest: (18.0, 82.0)
[INFO]   Rounded: (163, 280)
[INFO]   Nearest: (162.0, 280.0)
[INFO]   Rounded: (26, 237)
[INFO]   Nearest: (26.0, 238.0)
[INFO]   Rounded: (153, 232)
[INFO]   Nearest: (154.0, 232.0)
[INFO]   Rounded: (66, 244)
[INFO]   Rounded: (104, 185)
[INFO]   Nearest: (104.0, 184.0)
[INFO]   Rounded: (30, 193)
[INFO]   Nearest: (30.0, 194.0)
[INFO]   Rounded: (265, 288)
[INFO]   Nearest: (264.0, 288.0)
[INFO]   Rounded: (31, 122)
[INFO]   Nearest: (32.0, 122.0)
[INFO]   Rounded: (19, 37)
[INFO]   Nearest: (18.0, 38.0)
[INFO]   Rounded: (23, 278)
[INFO]   Nearest: (22.0, 278.0)
[INFO]   Rounded: (13, 155)
[INFO]   Nearest: (14.0, 156.0)
[INFO]   Rounded: (88, 225)
[INFO]   Nearest: (88.0, 226.0)
[INFO]   Rounded: (231, 260)
[INFO]   Nearest: (230.0, 260.0)
[INFO]   Rounded: (211, 292)
[INFO]   Nearest: (210.0, 292.0)
[INFO]   Rounded: (80, 200)
[INFO]   Rounded: (129, 203)
[INFO]   Nearest: (130.0, 202.0)
[INFO]   Rounded: (60, 165)
[INFO]   Nearest: (60.0, 164.0)
[INFO]   Rounded: (174, 244)
[INFO]   Rounded: (58, 276)
[INFO]   Rounded: (61, 84)
[INFO]   Nearest: (60.0, 84.0)
[INFO]   Rounded: (135, 280)
[INFO]   Nearest: (134.0, 280.0)
[INFO]   Rounded: (44, 69)
[INFO]   Nearest: (44.0, 70.0)
[INFO]   Rounded: (86, 107)
[INFO]   Nearest: (86.0, 106.0)
[INFO]   Rounded: (28, 280)
[INFO]   Rounded: (51, 139)
[INFO]   Nearest: (52.0, 140.0)
[INFO]   Rounded: (48, 225)
[INFO]   Nearest: (48.0, 224.0)
[INFO]   Rounded: (169, 199)
[INFO]   Nearest: (168.0, 200.0)
[INFO]   Rounded: (124, 264)
[INFO]   Rounded: (123, 153)
[INFO]   Nearest: (122.0, 154.0)
[INFO]   Rounded: (157, 186)
[INFO]   Nearest: (158.0, 186.0)
[INFO]   Rounded: (190, 215)
[INFO]   Nearest: (190.0, 216.0)
[INFO]   Rounded: (31, 65)
[INFO]   Nearest: (30.0, 64.0)
[INFO]   Rounded: (123, 231)
[INFO]   Nearest: (124.0, 232.0)
[INFO]   Rounded: (20, 140)
[INFO]   Rounded: (72, 176)
[INFO]   Rounded: (213, 243)
[INFO]   Nearest: (214.0, 244.0)
[INFO]   Rounded: (49, 109)
[INFO]   Nearest: (50.0, 110.0)
[INFO]   Rounded: (74, 135)
[INFO]   Nearest: (74.0, 134.0)
[INFO]   Rounded: (194, 279)
[INFO]   Nearest: (194.0, 280.0)
[INFO]   Rounded: (96, 262)
[INFO]   Rounded: (104, 134)
[INFO]   Rounded: (43, 178)
[INFO]   Nearest: (44.0, 178.0)
[INFO]   Rounded: (19, 41)
[INFO]   Nearest: (18.0, 40.0)
[INFO]   Rounded: (15, 209)
[INFO]   Nearest: (16.0, 208.0)
[INFO]   Rounded: (106, 152)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 22, Long SMA: 32
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(18/38) - Original Sharpe: 0.7061, Trades: 70
[INFO] Kmeans cluster 2: SMA(130/204) - Original Sharpe: 0.6401, Trades: 20
[INFO] Kmeans cluster 3: SMA(122/152) - Original Sharpe: 0.6308, Trades: 28
[INFO] Kmeans cluster 4: SMA(106/154) - Original Sharpe: 0.5929, Trades: 24
[INFO] Kmeans cluster 5: SMA(24/42) - Original Sharpe: 0.5898, Trades: 69
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (22/32)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (18/38) - Sharpe: 0.7061
[INFO] cluster 2: (130/204) - Sharpe: 0.6401
[INFO] cluster 3: (122/152) - Sharpe: 0.6308
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.008190           -1.214357
1    2021-11-10 2021-11-10            41    -1.506080           -1.027527
2    2022-01-10 2022-01-10            41     3.633237           -3.366299
3    2022-03-10 2022-03-10            42     2.678211           -5.933074
4    2022-05-10 2022-05-10            41    -2.014869            0.685632
5    2022-07-10 2022-07-10            44    -0.459145            3.357951
6    2022-09-10 2022-09-10            43    -0.916318           -0.563144
7    2022-11-10 2022-11-10            40     1.019050           -4.311982
8    2023-01-10 2023-01-10            41     1.244469           -2.227720
9    2023-03-10 2023-03-10            42    -0.603135            1.628212
10   2023-05-10 2023-05-10            40    -0.113382           -1.490498
11   2023-07-10 2023-07-10            44    -1.828979            0.180886
12   2023-09-10 2023-09-10            44    -0.222549            1.599131
13   2023-11-10 2023-11-10            40    -2.248900           -1.086979
14   2024-01-10 2024-01-10            41     1.763493            2.775193
15   2024-03-10 2024-03-10            43    -2.111027           -3.233678
16   2024-05-10 2024-05-10            40     3.837640            2.486639
17   2024-07-10 2024-07-10            43    -1.589393            0.440086
18   2024-09-10 2024-09-10            44     3.096245           -3.352161
19   2024-11-10 2024-11-10            35     0.304872           -4.226979
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.0 |             -1.2 |         -0.2 | False         
[INFO] 2021-11-10   |         -1.5 |             -1.0 |          0.5 | True          
[INFO] 2022-01-10   |          3.6 |             -3.4 |         -7.0 | False         
[INFO] 2022-03-10   |          2.7 |             -5.9 |         -8.6 | False         
[INFO] 2022-05-10   |         -2.0 |              0.7 |          2.7 | True          
[INFO] 2022-07-10   |         -0.5 |              3.4 |          3.9 | True          
[INFO] 2022-09-10   |         -0.9 |             -0.6 |          0.3 | True          
[INFO] 2022-11-10   |          1.0 |             -4.3 |         -5.3 | False         
[INFO] 2023-01-10   |          1.2 |             -2.2 |         -3.4 | False         
[INFO] 2023-03-10   |         -0.6 |              1.6 |          2.2 | True          
[INFO] 2023-05-10   |         -0.1 |             -1.5 |         -1.4 | False         
[INFO] 2023-07-10   |         -1.8 |              0.2 |          2.0 | True          
[INFO] 2023-09-10   |         -0.2 |              1.6 |          1.8 | True          
[INFO] 2023-11-10   |         -2.2 |             -1.1 |          1.1 | True          
[INFO] 2024-01-10   |          1.8 |              2.8 |          1.0 | True          
[INFO] 2024-03-10   |         -2.1 |             -3.2 |         -1.1 | False         
[INFO] 2024-05-10   |          3.8 |              2.5 |         -1.3 | False         
[INFO] 2024-07-10   |         -1.6 |              0.4 |          2.0 | True          
[INFO] 2024-09-10   |          3.1 |             -3.4 |         -6.5 | False         
[INFO] 2024-11-10   |          0.3 |             -4.2 |         -4.5 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 10 of 20 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for LH...
[INFO] Excel file updated successfully. Added LH with Kmeans win rate 50.0% in row 30
[INFO] Added best Sharpe parameters 22/32 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 22, Long SMA: 32
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(18/38) - Original Sharpe: 0.7061
[INFO] Added cluster 2 to portfolio: SMA(130/204) - Original Sharpe: 0.6401
[INFO] Added cluster 3 to portfolio: SMA(122/152) - Original Sharpe: 0.6308
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LH_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.6015
[INFO] Kmeans Best out-of-sample Sharpe: 0.1153
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for LH...
[INFO] Excel file updated successfully. Added LH with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LH
[INFO] Big Point Value: 400.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8288 to 1.1408
[INFO] 
Best parameters:
[INFO] Short SMA: 22
[INFO] Long SMA: 32
[INFO] Sharpe Ratio: 1.140809
[INFO] Number of Trades: 90
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8288 to 1.1408
[INFO] Trades range: 14.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8198 to 3.1932
[INFO] Scaled Trades range: -0.8013 to 17.3999
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5787
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 411 elements
[INFO] Cluster 1: 557 elements
[INFO] Cluster 2: 129 elements
[INFO] Cluster 3: 33 elements
[INFO] Cluster 4: 533 elements
[INFO] Cluster 5: 415 elements
[INFO] Cluster 6: 144 elements
[INFO] Cluster 7: 301 elements
[INFO] Cluster 8: 234 elements
[INFO] Cluster 9: 392 elements
[INFO] Cluster 10: 403 elements
[INFO] Cluster 11: 271 elements
[INFO] Cluster 12: 110 elements
[INFO] Cluster 13: 433 elements
[INFO] Cluster 14: 596 elements
[INFO] Cluster 15: 128 elements
[INFO] Cluster 16: 394 elements
[INFO] Cluster 17: 199 elements
[INFO] Cluster 18: 384 elements
[INFO] Cluster 19: 37 elements
[INFO] Cluster 20: 12 elements
[INFO] Cluster 21: 145 elements
[INFO] Cluster 22: 216 elements
[INFO] Cluster 23: 100 elements
[INFO] Cluster 24: 40 elements
[INFO] Cluster 25: 51 elements
[INFO] Cluster 26: 369 elements
[INFO] Cluster 27: 319 elements
[INFO] Cluster 28: 218 elements
[INFO] Cluster 29: 39 elements
[INFO] Cluster 30: 181 elements
[INFO] Cluster 31: 100 elements
[INFO] Cluster 32: 199 elements
[INFO] Cluster 33: 51 elements
[INFO] Cluster 34: 164 elements
[INFO] Cluster 35: 258 elements
[INFO] Cluster 36: 288 elements
[INFO] Cluster 37: 83 elements
[INFO] Cluster 38: 246 elements
[INFO] Cluster 39: 3 elements
[INFO] Cluster 40: 26 elements
[INFO] Cluster 41: 204 elements
[INFO] Cluster 42: 87 elements
[INFO] Cluster 43: 174 elements
[INFO] Cluster 44: 156 elements
[INFO] Cluster 45: 211 elements
[INFO] Cluster 46: 13 elements
[INFO] Cluster 47: 193 elements
[INFO] Cluster 48: 91 elements
[INFO] Cluster 49: 244 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=174, Long SMA=244, Sharpe=0.0676, Trades=19
[INFO] Cluster 1 cluster: Short SMA=116, Long SMA=162, Sharpe=0.4778, Trades=24
[INFO] Cluster 2 cluster: Short SMA=16, Long SMA=46, Sharpe=0.7948, Trades=64
[INFO] Cluster 3 cluster: Short SMA=18, Long SMA=24, Sharpe=0.1604, Trades=150
[INFO] Cluster 4 cluster: Short SMA=218, Long SMA=264, Sharpe=-0.1810, Trades=21
[INFO] Cluster 5 cluster: Short SMA=82, Long SMA=204, Sharpe=0.1861, Trades=20
[INFO] Cluster 6 cluster: Short SMA=62, Long SMA=74, Sharpe=-0.4102, Trades=61
[INFO] Cluster 7 cluster: Short SMA=142, Long SMA=238, Sharpe=0.3088, Trades=19
[INFO] Cluster 8 cluster: Short SMA=232, Long SMA=244, Sharpe=-0.2685, Trades=42
[INFO] Cluster 9 cluster: Short SMA=72, Long SMA=114, Sharpe=-0.2497, Trades=34
[INFO] Cluster 10 cluster: Short SMA=128, Long SMA=280, Sharpe=0.1580, Trades=17
[INFO] Cluster 11 cluster: Short SMA=32, Long SMA=124, Sharpe=-0.1211, Trades=27
[INFO] Cluster 12 cluster: Short SMA=158, Long SMA=164, Sharpe=0.3673, Trades=55
[INFO] Cluster 13 cluster: Short SMA=60, Long SMA=282, Sharpe=0.4165, Trades=19
[INFO] Cluster 14 cluster: Short SMA=94, Long SMA=258, Sharpe=0.4798, Trades=16
[INFO] Cluster 15 cluster: Short SMA=92, Long SMA=104, Sharpe=-0.2289, Trades=48
[INFO] Cluster 16 cluster: Short SMA=168, Long SMA=200, Sharpe=0.4670, Trades=29
[INFO] Cluster 17 cluster: Short SMA=32, Long SMA=74, Sharpe=-0.1103, Trades=43
[INFO] Cluster 18 cluster: Short SMA=48, Long SMA=172, Sharpe=-0.2892, Trades=24
[INFO] Cluster 19 cluster: Short SMA=82, Long SMA=84, Sharpe=-0.4311, Trades=98
[INFO] Cluster 21 cluster: Short SMA=16, Long SMA=274, Sharpe=0.1374, Trades=29
[INFO] Cluster 22 cluster: Short SMA=212, Long SMA=292, Sharpe=-0.5088, Trades=17
[INFO] Cluster 23 cluster: Short SMA=268, Long SMA=278, Sharpe=-0.4336, Trades=43
[INFO] Cluster 24 cluster: Short SMA=258, Long SMA=260, Sharpe=-0.2531, Trades=84
[INFO] Cluster 25 cluster: Short SMA=170, Long SMA=172, Sharpe=0.4302, Trades=85
[INFO] Cluster 26 cluster: Short SMA=62, Long SMA=142, Sharpe=-0.4986, Trades=26
[INFO] Cluster 27 cluster: Short SMA=164, Long SMA=280, Sharpe=-0.0969, Trades=18
[INFO] Cluster 28 cluster: Short SMA=14, Long SMA=156, Sharpe=0.4319, Trades=35
[INFO] Cluster 29 cluster: Short SMA=20, Long SMA=32, Sharpe=1.0915, Trades=98
[INFO] Cluster 30 cluster: Short SMA=54, Long SMA=90, Sharpe=-0.4745, Trades=40
[INFO] Cluster 31 cluster: Short SMA=18, Long SMA=102, Sharpe=0.1564, Trades=35
[INFO] Cluster 32 cluster: Short SMA=20, Long SMA=200, Sharpe=0.2048, Trades=28
[INFO] Cluster 33 cluster: Short SMA=112, Long SMA=128, Sharpe=0.1590, Trades=36
[INFO] Cluster 34 cluster: Short SMA=258, Long SMA=288, Sharpe=-0.2389, Trades=23
[INFO] Cluster 35 cluster: Short SMA=126, Long SMA=226, Sharpe=0.4387, Trades=20
[INFO] Cluster 36 cluster: Short SMA=48, Long SMA=226, Sharpe=0.3114, Trades=18
[INFO] Cluster 37 cluster: Short SMA=196, Long SMA=206, Sharpe=0.3609, Trades=45
[INFO] Cluster 38 cluster: Short SMA=28, Long SMA=276, Sharpe=-0.0537, Trades=25
[INFO] Cluster 40 cluster: Short SMA=36, Long SMA=46, Sharpe=-0.0604, Trades=70
[INFO] Cluster 41 cluster: Short SMA=102, Long SMA=186, Sharpe=0.4307, Trades=18
[INFO] Cluster 42 cluster: Short SMA=134, Long SMA=148, Sharpe=0.5368, Trades=36
[INFO] Cluster 43 cluster: Short SMA=52, Long SMA=192, Sharpe=-0.1323, Trades=24
[INFO] Cluster 44 cluster: Short SMA=192, Long SMA=282, Sharpe=-0.3353, Trades=17
[INFO] Cluster 45 cluster: Short SMA=64, Long SMA=244, Sharpe=0.4901, Trades=18
[INFO] Cluster 47 cluster: Short SMA=26, Long SMA=230, Sharpe=0.0427, Trades=24
[INFO] Cluster 48 cluster: Short SMA=20, Long SMA=66, Sharpe=0.3237, Trades=47
[INFO] Cluster 49 cluster: Short SMA=126, Long SMA=208, Sharpe=0.6591, Trades=20
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=22, Long SMA=32, Sharpe=1.1408, Trades=90
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=20, Long SMA=32, Sharpe=1.0915, Trades=98
[INFO] Top 2: Short SMA=16, Long SMA=46, Sharpe=0.7948, Trades=64
[INFO] Top 3: Short SMA=126, Long SMA=208, Sharpe=0.6591, Trades=20
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10557 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 22, Long SMA: 32
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(20/32) - Original Sharpe: 1.0915, Trades: 98
[INFO] Hierarchical cluster 2: SMA(16/46) - Original Sharpe: 0.7948, Trades: 64
[INFO] Hierarchical cluster 3: SMA(126/208) - Original Sharpe: 0.6591, Trades: 20
[INFO] Hierarchical cluster 4: SMA(134/148) - Original Sharpe: 0.5368, Trades: 36
[INFO] Hierarchical cluster 5: SMA(64/244) - Original Sharpe: 0.4901, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (22/32)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (20/32) - Sharpe: 1.0915
[INFO] cluster 2: (16/46) - Sharpe: 0.7948
[INFO] cluster 3: (126/208) - Sharpe: 0.6591
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.008190           -6.212624
1    2021-11-10 2021-11-10            41    -1.506080           -2.676041
2    2022-01-10 2022-01-10            41     3.633237            0.737417
3    2022-03-10 2022-03-10            42     2.678211            1.382734
4    2022-05-10 2022-05-10            41    -2.014869           -2.537969
5    2022-07-10 2022-07-10            44    -0.459145            0.415410
6    2022-09-10 2022-09-10            43    -0.916318           -1.265164
7    2022-11-10 2022-11-10            40     1.019050           -0.624559
8    2023-01-10 2023-01-10            41     1.244469            1.233131
9    2023-03-10 2023-03-10            42    -0.603135            1.635219
10   2023-05-10 2023-05-10            40    -0.113382           -1.205020
11   2023-07-10 2023-07-10            44    -1.828979           -1.637963
12   2023-09-10 2023-09-10            44    -0.222549           -0.763164
13   2023-11-10 2023-11-10            40    -2.248900           -1.848550
14   2024-01-10 2024-01-10            41     1.763493            1.262823
15   2024-03-10 2024-03-10            43    -2.111027           -2.736356
16   2024-05-10 2024-05-10            40     3.837640            4.569220
17   2024-07-10 2024-07-10            43    -1.589393            1.011359
18   2024-09-10 2024-09-10            44     3.096245            3.096245
19   2024-11-10 2024-11-10            35     0.304872           -1.752560
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.0 |             -6.2 |         -5.2 | False         
[INFO] 2021-11-10   |         -1.5 |             -2.7 |         -1.2 | False         
[INFO] 2022-01-10   |          3.6 |              0.7 |         -2.9 | False         
[INFO] 2022-03-10   |          2.7 |              1.4 |         -1.3 | False         
[INFO] 2022-05-10   |         -2.0 |             -2.5 |         -0.5 | False         
[INFO] 2022-07-10   |         -0.5 |              0.4 |          0.9 | True          
[INFO] 2022-09-10   |         -0.9 |             -1.3 |         -0.4 | False         
[INFO] 2022-11-10   |          1.0 |             -0.6 |         -1.6 | False         
[INFO] 2023-01-10   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -0.6 |              1.6 |          2.2 | True          
[INFO] 2023-05-10   |         -0.1 |             -1.2 |         -1.1 | False         
[INFO] 2023-07-10   |         -1.8 |             -1.6 |          0.2 | True          
[INFO] 2023-09-10   |         -0.2 |             -0.8 |         -0.6 | False         
[INFO] 2023-11-10   |         -2.2 |             -1.8 |          0.4 | True          
[INFO] 2024-01-10   |          1.8 |              1.3 |         -0.5 | False         
[INFO] 2024-03-10   |         -2.1 |             -2.7 |         -0.6 | False         
[INFO] 2024-05-10   |          3.8 |              4.6 |          0.8 | True          
[INFO] 2024-07-10   |         -1.6 |              1.0 |          2.6 | True          
[INFO] 2024-09-10   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2024-11-10   |          0.3 |             -1.8 |         -2.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-01-10, 2024-09-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 18 periods (33.33% win rate)
[INFO] Updating Excel file with Hierarchical results for LH...
[INFO] Excel file updated successfully. Added LH with Hierarchical win rate 33.3% in row 30
[INFO] Added best Sharpe parameters 22/32 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 22, Long SMA: 32
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(20/32) - Original Sharpe: 1.0915
[INFO] Added cluster 2 to portfolio: SMA(16/46) - Original Sharpe: 0.7948
[INFO] Added cluster 3 to portfolio: SMA(126/208) - Original Sharpe: 0.6591
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LH_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.4287
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1153
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for LH...
[INFO] Excel file updated successfully. Added LH with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LH
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LJ in column D: 23.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 71.61s
[INFO] Best parameters: Short SMA = 172, Long SMA = 190
[INFO] Best Sharpe ratio: 0.861463, Trades: 28
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 2121 bad combos; keeping 1800 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LJ=124XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.10 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $545,114.00
[INFO] Market Buy & Hold P&L: $-2,180.00
[INFO] Outperformance: $547,294.00
[INFO] Sharpe ratio (entire period, annualized): 0.754097
[INFO] Sharpe ratio (in-sample, annualized): 0.861463
[INFO] Sharpe ratio (out-of-sample, annualized): 0.523110
[INFO] Maximum Drawdown: $104,670.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 20
[INFO] Out-of-sample period trades: 8
[INFO] Total trades: 28
[INFO] In-sample P&L: $425,552.00
[INFO] Out-of-sample P&L: $119,562.00
[INFO] 
Best parameters from GA: Short SMA = 172, Long SMA = 190, Sharpe = 0.861463
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 23.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7953 to 0.8615
[INFO] 
Best parameters:
[INFO] Short SMA: 172
[INFO] Long SMA: 190
[INFO] Sharpe Ratio: 0.861463
[INFO] Number of Trades: 28
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8464 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7953 to 0.8615
[INFO] Trades range: 11.0 to 309.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2926 to 2.6050
[INFO] Scaled Long SMA range: -2.6485 to 1.7059
[INFO] Scaled Sharpe ratio range: -3.8027 to 2.9913
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 152 elements
[INFO] Kmeans Cluster 1: 181 elements
[INFO] Kmeans Cluster 2: 236 elements
[INFO] Kmeans Cluster 3: 251 elements
[INFO] Kmeans Cluster 4: 143 elements
[INFO] Kmeans Cluster 5: 131 elements
[INFO] Kmeans Cluster 6: 171 elements
[INFO] Kmeans Cluster 7: 187 elements
[INFO] Kmeans Cluster 8: 172 elements
[INFO] Kmeans Cluster 9: 109 elements
[INFO] Kmeans Cluster 10: 67 elements
[INFO] Kmeans Cluster 11: 213 elements
[INFO] Kmeans Cluster 12: 253 elements
[INFO] Kmeans Cluster 13: 194 elements
[INFO] Kmeans Cluster 14: 87 elements
[INFO] Kmeans Cluster 15: 168 elements
[INFO] Kmeans Cluster 16: 110 elements
[INFO] Kmeans Cluster 17: 193 elements
[INFO] Kmeans Cluster 18: 121 elements
[INFO] Kmeans Cluster 19: 117 elements
[INFO] Kmeans Cluster 20: 204 elements
[INFO] Kmeans Cluster 21: 141 elements
[INFO] Kmeans Cluster 22: 137 elements
[INFO] Kmeans Cluster 23: 242 elements
[INFO] Kmeans Cluster 24: 156 elements
[INFO] Kmeans Cluster 25: 129 elements
[INFO] Kmeans Cluster 26: 280 elements
[INFO] Kmeans Cluster 27: 160 elements
[INFO] Kmeans Cluster 28: 205 elements
[INFO] Kmeans Cluster 29: 211 elements
[INFO] Kmeans Cluster 30: 164 elements
[INFO] Kmeans Cluster 31: 103 elements
[INFO] Kmeans Cluster 32: 164 elements
[INFO] Kmeans Cluster 33: 217 elements
[INFO] Kmeans Cluster 34: 123 elements
[INFO] Kmeans Cluster 35: 159 elements
[INFO] Kmeans Cluster 36: 94 elements
[INFO] Kmeans Cluster 37: 216 elements
[INFO] Kmeans Cluster 38: 117 elements
[INFO] Kmeans Cluster 39: 205 elements
[INFO] Kmeans Cluster 40: 182 elements
[INFO] Kmeans Cluster 41: 200 elements
[INFO] Kmeans Cluster 42: 225 elements
[INFO] Kmeans Cluster 43: 125 elements
[INFO] Kmeans Cluster 44: 152 elements
[INFO] Kmeans Cluster 45: 249 elements
[INFO] Kmeans Cluster 46: 102 elements
[INFO] Kmeans Cluster 47: 87 elements
[INFO] Kmeans Cluster 48: 232 elements
[INFO] Kmeans Cluster 49: 227 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=61.64, Long SMA=119.83, Sharpe=0.0170
[INFO] Centroid 1: Short SMA=133.72, Long SMA=236.43, Sharpe=0.3299
[INFO] Centroid 2: Short SMA=221.14, Long SMA=288.23, Sharpe=0.1436
[INFO] Centroid 3: Short SMA=52.82, Long SMA=184.78, Sharpe=0.0799
[INFO] Centroid 4: Short SMA=205.89, Long SMA=238.57, Sharpe=-0.2455
[INFO] Centroid 5: Short SMA=52.85, Long SMA=96.23, Sharpe=-0.3366
[INFO] Centroid 6: Short SMA=21.99, Long SMA=280.91, Sharpe=0.2204
[INFO] Centroid 7: Short SMA=152.47, Long SMA=219.88, Sharpe=0.4400
[INFO] Centroid 8: Short SMA=19.49, Long SMA=169.78, Sharpe=-0.1449
[INFO] Centroid 9: Short SMA=128.24, Long SMA=145.89, Sharpe=0.1656
[INFO] Centroid 10: Short SMA=87.55, Long SMA=182.48, Sharpe=0.3134
[INFO] Centroid 11: Short SMA=194.77, Long SMA=269.92, Sharpe=-0.0103
[INFO] Centroid 12: Short SMA=24.92, Long SMA=247.15, Sharpe=0.1834
[INFO] Centroid 13: Short SMA=102.43, Long SMA=190.41, Sharpe=0.5447
[INFO] Centroid 14: Short SMA=24.09, Long SMA=42.39, Sharpe=0.0307
[INFO] Centroid 15: Short SMA=163.55, Long SMA=181.20, Sharpe=0.6941
[INFO] Centroid 16: Short SMA=31.75, Long SMA=49.95, Sharpe=-0.1441
[INFO] Centroid 17: Short SMA=54.39, Long SMA=161.45, Sharpe=-0.0304
[INFO] Centroid 18: Short SMA=184.12, Long SMA=236.71, Sharpe=-0.0058
[INFO] Centroid 19: Short SMA=86.22, Long SMA=123.73, Sharpe=-0.2460
[INFO] Centroid 20: Short SMA=44.35, Long SMA=81.95, Sharpe=-0.0646
[INFO] Centroid 21: Short SMA=250.33, Long SMA=274.92, Sharpe=0.3077
[INFO] Centroid 22: Short SMA=121.85, Long SMA=156.77, Sharpe=0.3120
[INFO] Centroid 23: Short SMA=65.78, Long SMA=147.16, Sharpe=-0.1386
[INFO] Centroid 24: Short SMA=232.40, Long SMA=255.49, Sharpe=0.2125
[INFO] Centroid 25: Short SMA=150.05, Long SMA=173.36, Sharpe=0.5349
[INFO] Centroid 26: Short SMA=111.85, Long SMA=215.69, Sharpe=0.4513
[INFO] Centroid 27: Short SMA=94.49, Long SMA=157.86, Sharpe=0.1592
[INFO] Centroid 28: Short SMA=18.64, Long SMA=210.56, Sharpe=0.0370
[INFO] Centroid 29: Short SMA=25.88, Long SMA=82.18, Sharpe=0.0230
[INFO] Centroid 30: Short SMA=47.83, Long SMA=245.22, Sharpe=0.3179
[INFO] Centroid 31: Short SMA=183.20, Long SMA=224.04, Sharpe=0.1365
[INFO] Centroid 32: Short SMA=105.49, Long SMA=127.85, Sharpe=0.0332
[INFO] Centroid 33: Short SMA=156.59, Long SMA=200.35, Sharpe=0.5526
[INFO] Centroid 34: Short SMA=160.33, Long SMA=244.44, Sharpe=0.2667
[INFO] Centroid 35: Short SMA=228.67, Long SMA=262.15, Sharpe=0.0524
[INFO] Centroid 36: Short SMA=28.89, Long SMA=289.38, Sharpe=0.0722
[INFO] Centroid 37: Short SMA=31.29, Long SMA=118.02, Sharpe=-0.1850
[INFO] Centroid 38: Short SMA=67.74, Long SMA=190.94, Sharpe=0.1998
[INFO] Centroid 39: Short SMA=66.80, Long SMA=92.99, Sharpe=-0.1768
[INFO] Centroid 40: Short SMA=205.67, Long SMA=235.09, Sharpe=-0.1290
[INFO] Centroid 41: Short SMA=77.21, Long SMA=214.59, Sharpe=0.3649
[INFO] Centroid 42: Short SMA=126.59, Long SMA=179.13, Sharpe=0.4425
[INFO] Centroid 43: Short SMA=183.70, Long SMA=207.92, Sharpe=0.3020
[INFO] Centroid 44: Short SMA=97.84, Long SMA=119.25, Sharpe=-0.0869
[INFO] Centroid 45: Short SMA=267.83, Long SMA=288.73, Sharpe=0.1707
[INFO] Centroid 46: Short SMA=26.18, Long SMA=58.86, Sharpe=0.1956
[INFO] Centroid 47: Short SMA=21.70, Long SMA=38.76, Sharpe=-0.3385
[INFO] Centroid 48: Short SMA=24.25, Long SMA=138.38, Sharpe=-0.0806
[INFO] Centroid 49: Short SMA=39.79, Long SMA=206.22, Sharpe=0.2115
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=172, Long SMA=190, Sharpe=0.8615, Trades=28
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=168, Long SMA=186, Sharpe=0.6126, Trades=28
[INFO] Kmeans Top 2: Short SMA=150, Long SMA=176, Sharpe=0.6096, Trades=22
[INFO] Kmeans Top 3: Short SMA=156, Long SMA=200, Sharpe=0.5628, Trades=17
[INFO] Kmeans Top 4: Short SMA=102, Long SMA=190, Sharpe=0.5562, Trades=15
[INFO] Kmeans Top 5: Short SMA=112, Long SMA=216, Sharpe=0.5031, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (62, 120)
[INFO]   Rounded: (134, 236)
[INFO]   Rounded: (221, 288)
[INFO]   Nearest: (222.0, 288.0)
[INFO]   Rounded: (53, 185)
[INFO]   Nearest: (52.0, 184.0)
[INFO]   Rounded: (206, 239)
[INFO]   Nearest: (206.0, 238.0)
[INFO]   Rounded: (53, 96)
[INFO]   Nearest: (52.0, 96.0)
[INFO]   Rounded: (22, 281)
[INFO]   Nearest: (22.0, 280.0)
[INFO]   Rounded: (152, 220)
[INFO]   Rounded: (19, 170)
[INFO]   Nearest: (20.0, 170.0)
[INFO]   Rounded: (128, 146)
[INFO]   Rounded: (88, 182)
[INFO]   Rounded: (195, 270)
[INFO]   Nearest: (194.0, 270.0)
[INFO]   Rounded: (25, 247)
[INFO]   Nearest: (24.0, 248.0)
[INFO]   Rounded: (102, 190)
[INFO]   Rounded: (24, 42)
[INFO]   Rounded: (164, 181)
[INFO]   Nearest: (164.0, 182.0)
[INFO]   Rounded: (32, 50)
[INFO]   Rounded: (54, 161)
[INFO]   Nearest: (54.0, 162.0)
[INFO]   Rounded: (184, 237)
[INFO]   Nearest: (184.0, 236.0)
[INFO]   Rounded: (86, 124)
[INFO]   Rounded: (44, 82)
[INFO]   Rounded: (250, 275)
[INFO]   Nearest: (250.0, 274.0)
[INFO]   Rounded: (122, 157)
[INFO]   Nearest: (122.0, 156.0)
[INFO]   Rounded: (66, 147)
[INFO]   Nearest: (66.0, 148.0)
[INFO]   Rounded: (232, 255)
[INFO]   Nearest: (232.0, 256.0)
[INFO]   Rounded: (150, 173)
[INFO]   Nearest: (150.0, 174.0)
[INFO]   Rounded: (112, 216)
[INFO]   Rounded: (94, 158)
[INFO]   Rounded: (19, 211)
[INFO]   Nearest: (18.0, 210.0)
[INFO]   Rounded: (26, 82)
[INFO]   Rounded: (48, 245)
[INFO]   Nearest: (48.0, 246.0)
[INFO]   Rounded: (183, 224)
[INFO]   Nearest: (184.0, 224.0)
[INFO]   Rounded: (105, 128)
[INFO]   Nearest: (106.0, 128.0)
[INFO]   Rounded: (157, 200)
[INFO]   Nearest: (156.0, 200.0)
[INFO]   Rounded: (160, 244)
[INFO]   Rounded: (229, 262)
[INFO]   Nearest: (228.0, 262.0)
[INFO]   Rounded: (29, 289)
[INFO]   Nearest: (28.0, 290.0)
[INFO]   Rounded: (31, 118)
[INFO]   Nearest: (32.0, 118.0)
[INFO]   Rounded: (68, 191)
[INFO]   Nearest: (68.0, 190.0)
[INFO]   Rounded: (67, 93)
[INFO]   Nearest: (66.0, 92.0)
[INFO]   Rounded: (206, 235)
[INFO]   Nearest: (206.0, 236.0)
[INFO]   Rounded: (77, 215)
[INFO]   Nearest: (78.0, 214.0)
[INFO]   Rounded: (127, 179)
[INFO]   Nearest: (126.0, 180.0)
[INFO]   Rounded: (184, 208)
[INFO]   Rounded: (98, 119)
[INFO]   Nearest: (98.0, 120.0)
[INFO]   Rounded: (268, 289)
[INFO]   Nearest: (268.0, 288.0)
[INFO]   Rounded: (26, 59)
[INFO]   Nearest: (26.0, 58.0)
[INFO]   Rounded: (22, 39)
[INFO]   Nearest: (22.0, 38.0)
[INFO]   Rounded: (24, 138)
[INFO]   Rounded: (40, 206)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 172, Long SMA: 190
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(168/186) - Original Sharpe: 0.6126, Trades: 28
[INFO] Kmeans cluster 2: SMA(150/176) - Original Sharpe: 0.6096, Trades: 22
[INFO] Kmeans cluster 3: SMA(156/200) - Original Sharpe: 0.5628, Trades: 17
[INFO] Kmeans cluster 4: SMA(102/190) - Original Sharpe: 0.5562, Trades: 15
[INFO] Kmeans cluster 5: SMA(112/216) - Original Sharpe: 0.5031, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2555
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (172/190)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (168/186) - Sharpe: 0.6126
[INFO] cluster 2: (150/176) - Sharpe: 0.6096
[INFO] cluster 3: (156/200) - Sharpe: 0.5628
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Out-of-sample period starts on: 2021-12-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-14 2021-12-14            41    -6.476923           -6.322180
1    2022-02-14 2022-02-14            43     1.142795            0.182851
2    2022-04-14 2022-04-14            38     3.803073            3.803073
3    2022-06-14 2022-06-14            44    -1.477996           -1.477996
4    2022-08-14 2022-08-14            42     5.820882            5.820882
5    2022-10-14 2022-10-14            43    -3.029340           -3.029340
6    2022-12-14 2022-12-14            41     0.007038            0.007038
7    2023-02-14 2023-02-14            41    -0.235977           -0.235977
8    2023-04-14 2023-04-14            40     2.608255            0.832551
9    2023-06-14 2023-06-14            43     2.317082            2.419304
10   2023-08-14 2023-08-14            44    -0.537988           -0.537988
11   2023-10-14 2023-10-14            43    -2.449401           -2.449401
12   2023-12-14 2023-12-14            41     1.911555            1.384920
13   2024-02-14 2024-02-14            41     0.151095            0.353160
14   2024-04-14 2024-04-14            42     0.082220            0.082220
15   2024-06-14 2024-06-14            43     1.909439            1.152882
16   2024-08-14 2024-08-14            42     1.064357            2.472431
17   2024-10-14 2024-10-14            45     0.185180           -1.002867
18   2024-12-14 2024-12-14            10     6.740598            2.473857
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-14   |         -6.5 |             -6.3 |          0.2 | True          
[INFO] 2022-02-14   |          1.1 |              0.2 |         -0.9 | False         
[INFO] 2022-04-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-06-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-08-14   |          5.8 |              5.8 |          0.0 | Excluded      
[INFO] 2022-10-14   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-12-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-02-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-04-14   |          2.6 |              0.8 |         -1.8 | False         
[INFO] 2023-06-14   |          2.3 |              2.4 |          0.1 | True          
[INFO] 2023-08-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2023-10-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2023-12-14   |          1.9 |              1.4 |         -0.5 | False         
[INFO] 2024-02-14   |          0.2 |              0.4 |          0.2 | True          
[INFO] 2024-04-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-06-14   |          1.9 |              1.2 |         -0.7 | False         
[INFO] 2024-08-14   |          1.1 |              2.5 |          1.4 | True          
[INFO] 2024-10-14   |          0.2 |             -1.0 |         -1.2 | False         
[INFO] 2024-12-14   |          6.7 |              2.5 |         -4.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-14, 2022-06-14, 2022-08-14, 2022-10-14, 2022-12-14, 2023-02-14, 2023-08-14, 2023-10-14, 2024-04-14
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Kmeans cluster wins (rounded comparison): 4 of 10 periods (40.00% win rate)
[INFO] Updating Excel file with Kmeans results for LJ...
[INFO] Excel file updated successfully. Added LJ with Kmeans win rate 40.0% in row 31
[INFO] Added best Sharpe parameters 172/190 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 172, Long SMA: 190
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(168/186) - Original Sharpe: 0.6126
[INFO] Added cluster 2 to portfolio: SMA(150/176) - Original Sharpe: 0.6096
[INFO] Added cluster 3 to portfolio: SMA(156/200) - Original Sharpe: 0.5628
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LJ_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2575
[INFO] Kmeans Best out-of-sample Sharpe: 0.5231
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for LJ...
[INFO] Excel file updated successfully. Added LJ with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LJ
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 23.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7953 to 0.8615
[INFO] 
Best parameters:
[INFO] Short SMA: 172
[INFO] Long SMA: 190
[INFO] Sharpe Ratio: 0.861463
[INFO] Number of Trades: 28
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8464 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7953 to 0.8615
[INFO] Trades range: 11.0 to 309.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2926 to 2.6050
[INFO] Scaled Long SMA range: -2.6485 to 1.7059
[INFO] Scaled Sharpe ratio range: -3.8027 to 2.9913
[INFO] Scaled Trades range: -0.7273 to 14.6134
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8464 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5887
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 58 elements
[INFO] Cluster 1: 265 elements
[INFO] Cluster 2: 279 elements
[INFO] Cluster 3: 286 elements
[INFO] Cluster 4: 254 elements
[INFO] Cluster 5: 441 elements
[INFO] Cluster 6: 344 elements
[INFO] Cluster 7: 362 elements
[INFO] Cluster 8: 124 elements
[INFO] Cluster 9: 278 elements
[INFO] Cluster 10: 236 elements
[INFO] Cluster 11: 192 elements
[INFO] Cluster 12: 200 elements
[INFO] Cluster 13: 40 elements
[INFO] Cluster 14: 57 elements
[INFO] Cluster 15: 257 elements
[INFO] Cluster 16: 114 elements
[INFO] Cluster 17: 58 elements
[INFO] Cluster 18: 189 elements
[INFO] Cluster 19: 164 elements
[INFO] Cluster 20: 214 elements
[INFO] Cluster 21: 80 elements
[INFO] Cluster 22: 26 elements
[INFO] Cluster 23: 121 elements
[INFO] Cluster 24: 191 elements
[INFO] Cluster 25: 46 elements
[INFO] Cluster 26: 82 elements
[INFO] Cluster 27: 138 elements
[INFO] Cluster 28: 306 elements
[INFO] Cluster 29: 34 elements
[INFO] Cluster 30: 264 elements
[INFO] Cluster 31: 4 elements
[INFO] Cluster 32: 21 elements
[INFO] Cluster 33: 143 elements
[INFO] Cluster 34: 98 elements
[INFO] Cluster 35: 269 elements
[INFO] Cluster 36: 247 elements
[INFO] Cluster 37: 182 elements
[INFO] Cluster 38: 304 elements
[INFO] Cluster 39: 174 elements
[INFO] Cluster 40: 208 elements
[INFO] Cluster 41: 184 elements
[INFO] Cluster 42: 177 elements
[INFO] Cluster 43: 260 elements
[INFO] Cluster 44: 168 elements
[INFO] Cluster 45: 97 elements
[INFO] Cluster 46: 45 elements
[INFO] Cluster 47: 7 elements
[INFO] Cluster 48: 77 elements
[INFO] Cluster 49: 99 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=144, Long SMA=150, Sharpe=0.1312, Trades=46
[INFO] Cluster 1 cluster: Short SMA=72, Long SMA=98, Sharpe=-0.2203, Trades=33
[INFO] Cluster 2 cluster: Short SMA=136, Long SMA=178, Sharpe=0.4492, Trades=20
[INFO] Cluster 3 cluster: Short SMA=246, Long SMA=272, Sharpe=0.3847, Trades=17
[INFO] Cluster 4 cluster: Short SMA=26, Long SMA=284, Sharpe=0.1745, Trades=15
[INFO] Cluster 5 cluster: Short SMA=60, Long SMA=154, Sharpe=-0.1266, Trades=17
[INFO] Cluster 6 cluster: Short SMA=192, Long SMA=264, Sharpe=0.0465, Trades=13
[INFO] Cluster 7 cluster: Short SMA=54, Long SMA=204, Sharpe=0.1245, Trades=15
[INFO] Cluster 8 cluster: Short SMA=42, Long SMA=56, Sharpe=-0.3193, Trades=63
[INFO] Cluster 9 cluster: Short SMA=204, Long SMA=238, Sharpe=-0.3063, Trades=19
[INFO] Cluster 10 cluster: Short SMA=22, Long SMA=74, Sharpe=0.0949, Trades=43
[INFO] Cluster 11 cluster: Short SMA=116, Long SMA=160, Sharpe=0.3378, Trades=19
[INFO] Cluster 12 cluster: Short SMA=36, Long SMA=82, Sharpe=-0.1202, Trades=39
[INFO] Cluster 13 cluster: Short SMA=72, Long SMA=76, Sharpe=-0.2069, Trades=93
[INFO] Cluster 14 cluster: Short SMA=24, Long SMA=48, Sharpe=0.2546, Trades=65
[INFO] Cluster 15 cluster: Short SMA=150, Long SMA=204, Sharpe=0.4799, Trades=15
[INFO] Cluster 16 cluster: Short SMA=184, Long SMA=224, Sharpe=0.1094, Trades=17
[INFO] Cluster 17 cluster: Short SMA=26, Long SMA=38, Sharpe=0.0039, Trades=88
[INFO] Cluster 18 cluster: Short SMA=100, Long SMA=150, Sharpe=0.1761, Trades=19
[INFO] Cluster 19 cluster: Short SMA=106, Long SMA=130, Sharpe=-0.0603, Trades=27
[INFO] Cluster 20 cluster: Short SMA=20, Long SMA=210, Sharpe=0.1052, Trades=25
[INFO] Cluster 21 cluster: Short SMA=112, Long SMA=118, Sharpe=0.0632, Trades=57
[INFO] Cluster 22 cluster: Short SMA=36, Long SMA=38, Sharpe=-0.0131, Trades=160
[INFO] Cluster 23 cluster: Short SMA=166, Long SMA=188, Sharpe=0.6448, Trades=26
[INFO] Cluster 24 cluster: Short SMA=74, Long SMA=218, Sharpe=0.2854, Trades=11
[INFO] Cluster 25 cluster: Short SMA=216, Long SMA=220, Sharpe=-0.0815, Trades=43
[INFO] Cluster 26 cluster: Short SMA=268, Long SMA=272, Sharpe=0.0609, Trades=33
[INFO] Cluster 27 cluster: Short SMA=180, Long SMA=210, Sharpe=0.2813, Trades=17
[INFO] Cluster 28 cluster: Short SMA=28, Long SMA=136, Sharpe=-0.1015, Trades=25
[INFO] Cluster 29 cluster: Short SMA=34, Long SMA=38, Sharpe=0.0160, Trades=118
[INFO] Cluster 30 cluster: Short SMA=56, Long SMA=184, Sharpe=0.0661, Trades=15
[INFO] Cluster 32 cluster: Short SMA=168, Long SMA=170, Sharpe=0.7867, Trades=62
[INFO] Cluster 33 cluster: Short SMA=38, Long SMA=106, Sharpe=-0.3748, Trades=31
[INFO] Cluster 34 cluster: Short SMA=84, Long SMA=128, Sharpe=-0.2187, Trades=23
[INFO] Cluster 35 cluster: Short SMA=222, Long SMA=286, Sharpe=0.1151, Trades=13
[INFO] Cluster 36 cluster: Short SMA=20, Long SMA=248, Sharpe=0.2345, Trades=19
[INFO] Cluster 37 cluster: Short SMA=62, Long SMA=120, Sharpe=0.1078, Trades=21
[INFO] Cluster 38 cluster: Short SMA=108, Long SMA=214, Sharpe=0.3668, Trades=15
[INFO] Cluster 39 cluster: Short SMA=266, Long SMA=290, Sharpe=0.1704, Trades=18
[INFO] Cluster 40 cluster: Short SMA=104, Long SMA=190, Sharpe=0.5234, Trades=15
[INFO] Cluster 41 cluster: Short SMA=46, Long SMA=244, Sharpe=0.2619, Trades=11
[INFO] Cluster 42 cluster: Short SMA=146, Long SMA=226, Sharpe=0.4727, Trades=13
[INFO] Cluster 43 cluster: Short SMA=148, Long SMA=242, Sharpe=0.3311, Trades=11
[INFO] Cluster 44 cluster: Short SMA=18, Long SMA=172, Sharpe=-0.2092, Trades=25
[INFO] Cluster 45 cluster: Short SMA=232, Long SMA=260, Sharpe=0.0446, Trades=19
[INFO] Cluster 46 cluster: Short SMA=14, Long SMA=34, Sharpe=-0.3521, Trades=93
[INFO] Cluster 48 cluster: Short SMA=158, Long SMA=168, Sharpe=0.6407, Trades=35
[INFO] Cluster 49 cluster: Short SMA=20, Long SMA=112, Sharpe=-0.1517, Trades=39
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=172, Long SMA=190, Sharpe=0.8615, Trades=28
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=168, Long SMA=170, Sharpe=0.7867, Trades=62
[INFO] Top 2: Short SMA=166, Long SMA=188, Sharpe=0.6448, Trades=26
[INFO] Top 3: Short SMA=158, Long SMA=168, Sharpe=0.6407, Trades=35
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 8453 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 172, Long SMA: 190
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(168/170) - Original Sharpe: 0.7867, Trades: 62
[INFO] Hierarchical cluster 2: SMA(166/188) - Original Sharpe: 0.6448, Trades: 26
[INFO] Hierarchical cluster 3: SMA(158/168) - Original Sharpe: 0.6407, Trades: 35
[INFO] Hierarchical cluster 4: SMA(104/190) - Original Sharpe: 0.5234, Trades: 15
[INFO] Hierarchical cluster 5: SMA(150/204) - Original Sharpe: 0.4799, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2555
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (172/190)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (168/170) - Sharpe: 0.7867
[INFO] cluster 2: (166/188) - Sharpe: 0.6448
[INFO] cluster 3: (158/168) - Sharpe: 0.6407
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Out-of-sample period starts on: 2021-12-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-14 2021-12-14            41    -6.476923           -5.019313
1    2022-02-14 2022-02-14            43     1.142795            0.067536
2    2022-04-14 2022-04-14            38     3.803073            3.803073
3    2022-06-14 2022-06-14            44    -1.477996           -1.477996
4    2022-08-14 2022-08-14            42     5.820882            5.820882
5    2022-10-14 2022-10-14            43    -3.029340           -3.029340
6    2022-12-14 2022-12-14            41     0.007038            0.007038
7    2023-02-14 2023-02-14            41    -0.235977           -0.235977
8    2023-04-14 2023-04-14            40     2.608255            1.650851
9    2023-06-14 2023-06-14            43     2.317082            0.999296
10   2023-08-14 2023-08-14            44    -0.537988           -0.718025
11   2023-10-14 2023-10-14            43    -2.449401           -2.449401
12   2023-12-14 2023-12-14            41     1.911555            0.763879
13   2024-02-14 2024-02-14            41     0.151095           -0.026113
14   2024-04-14 2024-04-14            42     0.082220            0.082220
15   2024-06-14 2024-06-14            43     1.909439            1.879837
16   2024-08-14 2024-08-14            42     1.064357            2.204758
17   2024-10-14 2024-10-14            45     0.185180           -4.238036
18   2024-12-14 2024-12-14            10     6.740598           -9.052136
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-14   |         -6.5 |             -5.0 |          1.5 | True          
[INFO] 2022-02-14   |          1.1 |              0.1 |         -1.0 | False         
[INFO] 2022-04-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-06-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-08-14   |          5.8 |              5.8 |          0.0 | Excluded      
[INFO] 2022-10-14   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-12-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-02-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-04-14   |          2.6 |              1.7 |         -0.9 | False         
[INFO] 2023-06-14   |          2.3 |              1.0 |         -1.3 | False         
[INFO] 2023-08-14   |         -0.5 |             -0.7 |         -0.2 | False         
[INFO] 2023-10-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2023-12-14   |          1.9 |              0.8 |         -1.1 | False         
[INFO] 2024-02-14   |          0.2 |             -0.0 |         -0.2 | False         
[INFO] 2024-04-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-06-14   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2024-08-14   |          1.1 |              2.2 |          1.1 | True          
[INFO] 2024-10-14   |          0.2 |             -4.2 |         -4.4 | False         
[INFO] 2024-12-14   |          6.7 |             -9.1 |        -15.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-14, 2022-06-14, 2022-08-14, 2022-10-14, 2022-12-14, 2023-02-14, 2023-10-14, 2024-04-14, 2024-06-14
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 10 periods (20.00% win rate)
[INFO] Updating Excel file with Hierarchical results for LJ...
[INFO] Excel file updated successfully. Added LJ with Hierarchical win rate 20.0% in row 31
[INFO] Added best Sharpe parameters 172/190 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 172, Long SMA: 190
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(168/170) - Original Sharpe: 0.7867
[INFO] Added cluster 2 to portfolio: SMA(166/188) - Original Sharpe: 0.6448
[INFO] Added cluster 3 to portfolio: SMA(158/168) - Original Sharpe: 0.6407
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LJ_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1308
[INFO] Hierarchical Best out-of-sample Sharpe: 0.5231
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for LJ...
[INFO] Excel file updated successfully. Added LJ with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LJ
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LZ in column D: 15.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 73.93s
[INFO] Best parameters: Short SMA = 156, Long SMA = 158
[INFO] Best Sharpe ratio: 0.626081, Trades: 79
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 253 bad combos; keeping 2111 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LZ=104XC
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 7.62 contracts
[INFO] Maximum Position Size: 14 contracts
[INFO] Strategy Total P&L: $281,140.00
[INFO] Market Buy & Hold P&L: $28,760.00
[INFO] Outperformance: $252,380.00
[INFO] Sharpe ratio (entire period, annualized): 0.390068
[INFO] Sharpe ratio (in-sample, annualized): 0.626081
[INFO] Sharpe ratio (out-of-sample, annualized): -0.194681
[INFO] Maximum Drawdown: $178,945.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 50
[INFO] Out-of-sample period trades: 29
[INFO] Total trades: 79
[INFO] In-sample P&L: $321,435.00
[INFO] Out-of-sample P&L: $-40,295.00
[INFO] 
Best parameters from GA: Short SMA = 156, Long SMA = 158, Sharpe = 0.626081
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.3217 to 0.6261
[INFO] 
Best parameters:
[INFO] Short SMA: 156
[INFO] Long SMA: 158
[INFO] Sharpe Ratio: 0.626081
[INFO] Number of Trades: 79
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10332 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.3217 to 0.6261
[INFO] Trades range: 10.0 to 307.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3792 to 2.8477
[INFO] Scaled Long SMA range: -2.7903 to 1.4416
[INFO] Scaled Sharpe ratio range: -6.1933 to 4.3052
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 281 elements
[INFO] Kmeans Cluster 1: 156 elements
[INFO] Kmeans Cluster 2: 224 elements
[INFO] Kmeans Cluster 3: 302 elements
[INFO] Kmeans Cluster 4: 302 elements
[INFO] Kmeans Cluster 5: 240 elements
[INFO] Kmeans Cluster 6: 369 elements
[INFO] Kmeans Cluster 7: 229 elements
[INFO] Kmeans Cluster 8: 143 elements
[INFO] Kmeans Cluster 9: 104 elements
[INFO] Kmeans Cluster 10: 314 elements
[INFO] Kmeans Cluster 11: 225 elements
[INFO] Kmeans Cluster 12: 159 elements
[INFO] Kmeans Cluster 13: 11 elements
[INFO] Kmeans Cluster 14: 159 elements
[INFO] Kmeans Cluster 15: 139 elements
[INFO] Kmeans Cluster 16: 222 elements
[INFO] Kmeans Cluster 17: 278 elements
[INFO] Kmeans Cluster 18: 253 elements
[INFO] Kmeans Cluster 19: 232 elements
[INFO] Kmeans Cluster 20: 372 elements
[INFO] Kmeans Cluster 21: 230 elements
[INFO] Kmeans Cluster 22: 175 elements
[INFO] Kmeans Cluster 23: 287 elements
[INFO] Kmeans Cluster 24: 177 elements
[INFO] Kmeans Cluster 25: 133 elements
[INFO] Kmeans Cluster 26: 271 elements
[INFO] Kmeans Cluster 27: 286 elements
[INFO] Kmeans Cluster 28: 171 elements
[INFO] Kmeans Cluster 29: 200 elements
[INFO] Kmeans Cluster 30: 217 elements
[INFO] Kmeans Cluster 31: 58 elements
[INFO] Kmeans Cluster 32: 177 elements
[INFO] Kmeans Cluster 33: 180 elements
[INFO] Kmeans Cluster 34: 194 elements
[INFO] Kmeans Cluster 35: 73 elements
[INFO] Kmeans Cluster 36: 189 elements
[INFO] Kmeans Cluster 37: 210 elements
[INFO] Kmeans Cluster 38: 129 elements
[INFO] Kmeans Cluster 39: 173 elements
[INFO] Kmeans Cluster 40: 254 elements
[INFO] Kmeans Cluster 41: 244 elements
[INFO] Kmeans Cluster 42: 225 elements
[INFO] Kmeans Cluster 43: 217 elements
[INFO] Kmeans Cluster 44: 110 elements
[INFO] Kmeans Cluster 45: 206 elements
[INFO] Kmeans Cluster 46: 193 elements
[INFO] Kmeans Cluster 47: 243 elements
[INFO] Kmeans Cluster 48: 191 elements
[INFO] Kmeans Cluster 49: 205 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=107.77, Long SMA=276.60, Sharpe=-0.2444
[INFO] Centroid 1: Short SMA=81.04, Long SMA=113.50, Sharpe=-0.3329
[INFO] Centroid 2: Short SMA=119.63, Long SMA=184.74, Sharpe=-0.0583
[INFO] Centroid 3: Short SMA=208.25, Long SMA=233.13, Sharpe=-0.1169
[INFO] Centroid 4: Short SMA=22.01, Long SMA=186.11, Sharpe=0.1209
[INFO] Centroid 5: Short SMA=31.58, Long SMA=109.13, Sharpe=-0.1364
[INFO] Centroid 6: Short SMA=169.41, Long SMA=239.21, Sharpe=-0.2561
[INFO] Centroid 7: Short SMA=94.19, Long SMA=232.94, Sharpe=-0.0916
[INFO] Centroid 8: Short SMA=19.79, Long SMA=281.97, Sharpe=-0.0113
[INFO] Centroid 9: Short SMA=147.85, Long SMA=176.83, Sharpe=0.2997
[INFO] Centroid 10: Short SMA=133.11, Long SMA=250.11, Sharpe=-0.3082
[INFO] Centroid 11: Short SMA=269.52, Long SMA=290.32, Sharpe=-0.2016
[INFO] Centroid 12: Short SMA=40.30, Long SMA=178.09, Sharpe=-0.1208
[INFO] Centroid 14: Short SMA=22.05, Long SMA=58.88, Sharpe=-0.3679
[INFO] Centroid 15: Short SMA=103.22, Long SMA=139.22, Sharpe=-0.5845
[INFO] Centroid 16: Short SMA=55.61, Long SMA=282.92, Sharpe=-0.4225
[INFO] Centroid 17: Short SMA=236.04, Long SMA=276.54, Sharpe=-0.1264
[INFO] Centroid 18: Short SMA=182.53, Long SMA=202.57, Sharpe=-0.0078
[INFO] Centroid 19: Short SMA=26.17, Long SMA=126.27, Sharpe=0.0360
[INFO] Centroid 20: Short SMA=142.09, Long SMA=283.50, Sharpe=-0.3338
[INFO] Centroid 21: Short SMA=59.01, Long SMA=262.59, Sharpe=-0.3070
[INFO] Centroid 22: Short SMA=116.30, Long SMA=153.49, Sharpe=-0.3240
[INFO] Centroid 23: Short SMA=62.17, Long SMA=213.89, Sharpe=-0.2678
[INFO] Centroid 24: Short SMA=32.02, Long SMA=273.22, Sharpe=-0.1445
[INFO] Centroid 25: Short SMA=120.66, Long SMA=164.32, Sharpe=-0.1857
[INFO] Centroid 26: Short SMA=126.05, Long SMA=222.48, Sharpe=-0.2221
[INFO] Centroid 27: Short SMA=86.34, Long SMA=275.61, Sharpe=-0.1361
[INFO] Centroid 28: Short SMA=27.30, Long SMA=142.88, Sharpe=0.2061
[INFO] Centroid 29: Short SMA=22.15, Long SMA=251.64, Sharpe=0.0901
[INFO] Centroid 30: Short SMA=62.05, Long SMA=167.32, Sharpe=-0.2733
[INFO] Centroid 31: Short SMA=150.03, Long SMA=170.45, Sharpe=0.4551
[INFO] Centroid 32: Short SMA=99.29, Long SMA=204.12, Sharpe=0.0431
[INFO] Centroid 33: Short SMA=28.99, Long SMA=52.30, Sharpe=-0.2080
[INFO] Centroid 34: Short SMA=150.98, Long SMA=183.49, Sharpe=0.0942
[INFO] Centroid 35: Short SMA=20.08, Long SMA=45.12, Sharpe=-0.5382
[INFO] Centroid 36: Short SMA=246.24, Long SMA=266.20, Sharpe=-0.2412
[INFO] Centroid 37: Short SMA=25.22, Long SMA=220.53, Sharpe=0.0053
[INFO] Centroid 38: Short SMA=67.38, Long SMA=121.92, Sharpe=-0.5325
[INFO] Centroid 39: Short SMA=68.96, Long SMA=96.25, Sharpe=-0.4280
[INFO] Centroid 40: Short SMA=184.51, Long SMA=266.44, Sharpe=-0.1208
[INFO] Centroid 41: Short SMA=74.89, Long SMA=187.89, Sharpe=-0.1629
[INFO] Centroid 42: Short SMA=69.60, Long SMA=151.34, Sharpe=-0.3904
[INFO] Centroid 43: Short SMA=153.39, Long SMA=206.64, Sharpe=-0.1386
[INFO] Centroid 44: Short SMA=88.78, Long SMA=110.24, Sharpe=-0.2071
[INFO] Centroid 45: Short SMA=57.78, Long SMA=234.93, Sharpe=-0.1971
[INFO] Centroid 46: Short SMA=38.39, Long SMA=69.84, Sharpe=-0.0282
[INFO] Centroid 47: Short SMA=214.17, Long SMA=266.74, Sharpe=0.0082
[INFO] Centroid 48: Short SMA=49.32, Long SMA=92.00, Sharpe=-0.2714
[INFO] Centroid 49: Short SMA=102.08, Long SMA=136.60, Sharpe=-0.4648
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=156, Long SMA=158, Sharpe=0.6261, Trades=79
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=150, Long SMA=168, Sharpe=0.4942, Trades=35
[INFO] Kmeans Top 2: Short SMA=148, Long SMA=178, Sharpe=0.3308, Trades=21
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=144, Sharpe=0.1872, Trades=25
[INFO] Kmeans Top 4: Short SMA=22, Long SMA=186, Sharpe=0.1729, Trades=19
[INFO] Kmeans Top 5: Short SMA=152, Long SMA=188, Sharpe=0.1669, Trades=18
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (108, 277)
[INFO]   Nearest: (108.0, 276.0)
[INFO]   Rounded: (81, 114)
[INFO]   Nearest: (82.0, 114.0)
[INFO]   Rounded: (120, 185)
[INFO]   Nearest: (120.0, 184.0)
[INFO]   Rounded: (208, 233)
[INFO]   Nearest: (208.0, 234.0)
[INFO]   Rounded: (22, 186)
[INFO]   Rounded: (32, 109)
[INFO]   Nearest: (32.0, 110.0)
[INFO]   Rounded: (169, 239)
[INFO]   Nearest: (170.0, 240.0)
[INFO]   Rounded: (94, 233)
[INFO]   Nearest: (94.0, 232.0)
[INFO]   Rounded: (20, 282)
[INFO]   Rounded: (148, 177)
[INFO]   Nearest: (148.0, 176.0)
[INFO]   Rounded: (133, 250)
[INFO]   Nearest: (134.0, 250.0)
[INFO]   Rounded: (270, 290)
[INFO]   Rounded: (40, 178)
[INFO]   Rounded: (22, 59)
[INFO]   Nearest: (22.0, 58.0)
[INFO]   Rounded: (103, 139)
[INFO]   Nearest: (104.0, 140.0)
[INFO]   Rounded: (56, 283)
[INFO]   Nearest: (56.0, 282.0)
[INFO]   Rounded: (236, 277)
[INFO]   Nearest: (236.0, 276.0)
[INFO]   Rounded: (183, 203)
[INFO]   Nearest: (182.0, 202.0)
[INFO]   Rounded: (26, 126)
[INFO]   Rounded: (142, 284)
[INFO]   Rounded: (59, 263)
[INFO]   Nearest: (60.0, 262.0)
[INFO]   Rounded: (116, 153)
[INFO]   Nearest: (116.0, 154.0)
[INFO]   Rounded: (62, 214)
[INFO]   Rounded: (32, 273)
[INFO]   Nearest: (32.0, 274.0)
[INFO]   Rounded: (121, 164)
[INFO]   Nearest: (120.0, 164.0)
[INFO]   Rounded: (126, 222)
[INFO]   Rounded: (86, 276)
[INFO]   Rounded: (27, 143)
[INFO]   Nearest: (28.0, 142.0)
[INFO]   Rounded: (22, 252)
[INFO]   Rounded: (62, 167)
[INFO]   Nearest: (62.0, 168.0)
[INFO]   Rounded: (150, 170)
[INFO]   Rounded: (99, 204)
[INFO]   Nearest: (100.0, 204.0)
[INFO]   Rounded: (29, 52)
[INFO]   Nearest: (28.0, 52.0)
[INFO]   Rounded: (151, 183)
[INFO]   Nearest: (150.0, 184.0)
[INFO]   Rounded: (20, 45)
[INFO]   Nearest: (20.0, 46.0)
[INFO]   Rounded: (246, 266)
[INFO]   Rounded: (25, 221)
[INFO]   Nearest: (26.0, 220.0)
[INFO]   Rounded: (67, 122)
[INFO]   Nearest: (68.0, 122.0)
[INFO]   Rounded: (69, 96)
[INFO]   Nearest: (68.0, 96.0)
[INFO]   Rounded: (185, 266)
[INFO]   Nearest: (184.0, 266.0)
[INFO]   Rounded: (75, 188)
[INFO]   Nearest: (74.0, 188.0)
[INFO]   Rounded: (70, 151)
[INFO]   Nearest: (70.0, 152.0)
[INFO]   Rounded: (153, 207)
[INFO]   Nearest: (154.0, 206.0)
[INFO]   Rounded: (89, 110)
[INFO]   Nearest: (88.0, 110.0)
[INFO]   Rounded: (58, 235)
[INFO]   Nearest: (58.0, 234.0)
[INFO]   Rounded: (38, 70)
[INFO]   Rounded: (214, 267)
[INFO]   Nearest: (214.0, 266.0)
[INFO]   Rounded: (49, 92)
[INFO]   Nearest: (50.0, 92.0)
[INFO]   Rounded: (102, 137)
[INFO]   Nearest: (102.0, 136.0)
[INFO] Successfully plotted 49 out of 49 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 156, Long SMA: 158
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(150/168) - Original Sharpe: 0.4942, Trades: 35
[INFO] Kmeans cluster 2: SMA(148/178) - Original Sharpe: 0.3308, Trades: 21
[INFO] Kmeans cluster 3: SMA(28/144) - Original Sharpe: 0.1872, Trades: 25
[INFO] Kmeans cluster 4: SMA(22/186) - Original Sharpe: 0.1729, Trades: 19
[INFO] Kmeans cluster 5: SMA(152/188) - Original Sharpe: 0.1669, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2544
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (156/158)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (150/168) - Sharpe: 0.4942
[INFO] cluster 2: (148/178) - Sharpe: 0.3308
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Out-of-sample period starts on: 2021-12-17
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-17 2021-12-17            41     2.102424            2.102424
1    2022-02-17 2022-02-17            41    -0.193263           -0.193263
2    2022-04-17 2022-04-17            40    -2.414653           -2.414653
3    2022-06-17 2022-06-17            43     3.471248            3.471248
4    2022-08-17 2022-08-17            41     5.752319            1.570119
5    2022-10-17 2022-10-17            45     0.507784            3.531525
6    2022-12-17 2022-12-17            41     1.439696           -1.093877
7    2023-02-17 2023-02-17            39    -5.196104           -2.689142
8    2023-04-17 2023-04-17            42    -1.914640           -1.914640
9    2023-06-17 2023-06-17            43    -1.864618           -1.864618
10   2023-08-17 2023-08-17            42    -3.026053           -0.825375
11   2023-10-17 2023-10-17            44     2.645057            0.605706
12   2023-12-17 2023-12-17            42     2.127559            0.224075
13   2024-02-17 2024-02-17            40    -5.080096           -4.219978
14   2024-04-17 2024-04-17            41    -1.461984            0.324029
15   2024-06-17 2024-06-17            45     0.717903            0.717903
16   2024-08-17 2024-08-17            42     0.001423            0.001423
17   2024-10-17 2024-10-17            43    -0.391047           -0.726248
18   2024-12-17 2024-12-17             9     7.439225           -1.613322
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-17   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2022-02-17   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-04-17   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2022-06-17   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-08-17   |          5.8 |              1.6 |         -4.2 | False         
[INFO] 2022-10-17   |          0.5 |              3.5 |          3.0 | True          
[INFO] 2022-12-17   |          1.4 |             -1.1 |         -2.5 | False         
[INFO] 2023-02-17   |         -5.2 |             -2.7 |          2.5 | True          
[INFO] 2023-04-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-06-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-08-17   |         -3.0 |             -0.8 |          2.2 | True          
[INFO] 2023-10-17   |          2.6 |              0.6 |         -2.0 | False         
[INFO] 2023-12-17   |          2.1 |              0.2 |         -1.9 | False         
[INFO] 2024-02-17   |         -5.1 |             -4.2 |          0.9 | True          
[INFO] 2024-04-17   |         -1.5 |              0.3 |          1.8 | True          
[INFO] 2024-06-17   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-08-17   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-10-17   |         -0.4 |             -0.7 |         -0.3 | False         
[INFO] 2024-12-17   |          7.4 |             -1.6 |         -9.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-12-17, 2022-02-17, 2022-04-17, 2022-06-17, 2023-04-17, 2023-06-17, 2024-06-17, 2024-08-17
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Kmeans cluster wins (rounded comparison): 5 of 11 periods (45.45% win rate)
[INFO] Updating Excel file with Kmeans results for LZ...
[INFO] Excel file updated successfully. Added LZ with Kmeans win rate 45.5% in row 32
[INFO] Added best Sharpe parameters 156/158 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 156, Long SMA: 158
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(150/168) - Original Sharpe: 0.4942
[INFO] Added cluster 2 to portfolio: SMA(148/178) - Original Sharpe: 0.3308
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LZ_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3046
[INFO] Kmeans Best out-of-sample Sharpe: -0.1947
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for LZ...
[INFO] Excel file updated successfully. Added LZ with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LZ
[INFO] Big Point Value: 10.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.3217 to 0.6261
[INFO] 
Best parameters:
[INFO] Short SMA: 156
[INFO] Long SMA: 158
[INFO] Sharpe Ratio: 0.626081
[INFO] Number of Trades: 79
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10332 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.3217 to 0.6261
[INFO] Trades range: 10.0 to 307.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3792 to 2.8477
[INFO] Scaled Long SMA range: -2.7903 to 1.4416
[INFO] Scaled Sharpe ratio range: -6.1933 to 4.3052
[INFO] Scaled Trades range: -0.6646 to 14.0601
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10332 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5137
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 416 elements
[INFO] Cluster 1: 379 elements
[INFO] Cluster 2: 533 elements
[INFO] Cluster 3: 332 elements
[INFO] Cluster 4: 376 elements
[INFO] Cluster 5: 188 elements
[INFO] Cluster 6: 74 elements
[INFO] Cluster 7: 36 elements
[INFO] Cluster 8: 193 elements
[INFO] Cluster 9: 211 elements
[INFO] Cluster 10: 131 elements
[INFO] Cluster 11: 350 elements
[INFO] Cluster 12: 304 elements
[INFO] Cluster 13: 159 elements
[INFO] Cluster 14: 217 elements
[INFO] Cluster 15: 267 elements
[INFO] Cluster 16: 219 elements
[INFO] Cluster 17: 137 elements
[INFO] Cluster 18: 298 elements
[INFO] Cluster 19: 59 elements
[INFO] Cluster 20: 446 elements
[INFO] Cluster 21: 186 elements
[INFO] Cluster 22: 255 elements
[INFO] Cluster 23: 439 elements
[INFO] Cluster 24: 12 elements
[INFO] Cluster 25: 313 elements
[INFO] Cluster 26: 260 elements
[INFO] Cluster 27: 262 elements
[INFO] Cluster 28: 169 elements
[INFO] Cluster 29: 185 elements
[INFO] Cluster 30: 45 elements
[INFO] Cluster 31: 324 elements
[INFO] Cluster 32: 174 elements
[INFO] Cluster 33: 102 elements
[INFO] Cluster 34: 145 elements
[INFO] Cluster 35: 319 elements
[INFO] Cluster 36: 4 elements
[INFO] Cluster 37: 206 elements
[INFO] Cluster 38: 44 elements
[INFO] Cluster 39: 110 elements
[INFO] Cluster 40: 99 elements
[INFO] Cluster 41: 256 elements
[INFO] Cluster 42: 165 elements
[INFO] Cluster 43: 244 elements
[INFO] Cluster 44: 70 elements
[INFO] Cluster 45: 270 elements
[INFO] Cluster 46: 41 elements
[INFO] Cluster 47: 7 elements
[INFO] Cluster 48: 89 elements
[INFO] Cluster 49: 212 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=56, Long SMA=274, Sharpe=-0.3749, Trades=12
[INFO] Cluster 1 cluster: Short SMA=222, Long SMA=274, Sharpe=-0.0511, Trades=14
[INFO] Cluster 2 cluster: Short SMA=90, Long SMA=272, Sharpe=-0.1231, Trades=10
[INFO] Cluster 3 cluster: Short SMA=64, Long SMA=158, Sharpe=-0.3814, Trades=19
[INFO] Cluster 4 cluster: Short SMA=46, Long SMA=248, Sharpe=-0.1937, Trades=12
[INFO] Cluster 5 cluster: Short SMA=102, Long SMA=112, Sharpe=-0.3506, Trades=50
[INFO] Cluster 6 cluster: Short SMA=14, Long SMA=36, Sharpe=-0.7293, Trades=101
[INFO] Cluster 7 cluster: Short SMA=44, Long SMA=46, Sharpe=-0.3275, Trades=151
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=54, Sharpe=-0.2945, Trades=64
[INFO] Cluster 9 cluster: Short SMA=74, Long SMA=106, Sharpe=-0.3219, Trades=35
[INFO] Cluster 10 cluster: Short SMA=182, Long SMA=188, Sharpe=-0.0003, Trades=42
[INFO] Cluster 11 cluster: Short SMA=22, Long SMA=162, Sharpe=0.2259, Trades=21
[INFO] Cluster 12 cluster: Short SMA=26, Long SMA=98, Sharpe=-0.1875, Trades=41
[INFO] Cluster 13 cluster: Short SMA=238, Long SMA=250, Sharpe=-0.3057, Trades=24
[INFO] Cluster 14 cluster: Short SMA=182, Long SMA=204, Sharpe=-0.0475, Trades=22
[INFO] Cluster 15 cluster: Short SMA=98, Long SMA=218, Sharpe=-0.0968, Trades=10
[INFO] Cluster 16 cluster: Short SMA=102, Long SMA=138, Sharpe=-0.5862, Trades=33
[INFO] Cluster 17 cluster: Short SMA=66, Long SMA=98, Sharpe=-0.6476, Trades=33
[INFO] Cluster 18 cluster: Short SMA=76, Long SMA=140, Sharpe=-0.4493, Trades=21
[INFO] Cluster 19 cluster: Short SMA=94, Long SMA=98, Sharpe=-0.2549, Trades=79
[INFO] Cluster 20 cluster: Short SMA=146, Long SMA=252, Sharpe=-0.2957, Trades=10
[INFO] Cluster 21 cluster: Short SMA=22, Long SMA=274, Sharpe=0.1718, Trades=18
[INFO] Cluster 22 cluster: Short SMA=112, Long SMA=178, Sharpe=-0.0973, Trades=19
[INFO] Cluster 23 cluster: Short SMA=24, Long SMA=218, Sharpe=0.1132, Trades=18
[INFO] Cluster 25 cluster: Short SMA=118, Long SMA=276, Sharpe=-0.2431, Trades=10
[INFO] Cluster 26 cluster: Short SMA=180, Long SMA=270, Sharpe=-0.1210, Trades=10
[INFO] Cluster 27 cluster: Short SMA=150, Long SMA=212, Sharpe=-0.1383, Trades=12
[INFO] Cluster 28 cluster: Short SMA=46, Long SMA=132, Sharpe=-0.0399, Trades=23
[INFO] Cluster 29 cluster: Short SMA=24, Long SMA=126, Sharpe=0.0455, Trades=27
[INFO] Cluster 30 cluster: Short SMA=154, Long SMA=164, Sharpe=0.4730, Trades=41
[INFO] Cluster 31 cluster: Short SMA=68, Long SMA=186, Sharpe=-0.1400, Trades=15
[INFO] Cluster 32 cluster: Short SMA=116, Long SMA=154, Sharpe=-0.2906, Trades=29
[INFO] Cluster 33 cluster: Short SMA=24, Long SMA=64, Sharpe=-0.5103, Trades=64
[INFO] Cluster 34 cluster: Short SMA=276, Long SMA=284, Sharpe=-0.1849, Trades=26
[INFO] Cluster 35 cluster: Short SMA=62, Long SMA=214, Sharpe=-0.2523, Trades=14
[INFO] Cluster 37 cluster: Short SMA=176, Long SMA=230, Sharpe=-0.2859, Trades=16
[INFO] Cluster 38 cluster: Short SMA=44, Long SMA=50, Sharpe=-0.2590, Trades=93
[INFO] Cluster 39 cluster: Short SMA=38, Long SMA=78, Sharpe=0.0444, Trades=43
[INFO] Cluster 40 cluster: Short SMA=146, Long SMA=180, Sharpe=0.3501, Trades=19
[INFO] Cluster 41 cluster: Short SMA=128, Long SMA=222, Sharpe=-0.2250, Trades=10
[INFO] Cluster 42 cluster: Short SMA=138, Long SMA=190, Sharpe=0.0563, Trades=15
[INFO] Cluster 43 cluster: Short SMA=204, Long SMA=236, Sharpe=-0.1194, Trades=18
[INFO] Cluster 44 cluster: Short SMA=146, Long SMA=164, Sharpe=0.3105, Trades=37
[INFO] Cluster 45 cluster: Short SMA=248, Long SMA=284, Sharpe=-0.1697, Trades=14
[INFO] Cluster 46 cluster: Short SMA=176, Long SMA=178, Sharpe=-0.2414, Trades=66
[INFO] Cluster 48 cluster: Short SMA=12, Long SMA=274, Sharpe=-0.0774, Trades=30
[INFO] Cluster 49 cluster: Short SMA=146, Long SMA=284, Sharpe=-0.3462, Trades=10
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=156, Long SMA=158, Sharpe=0.6261, Trades=79
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=154, Long SMA=164, Sharpe=0.4730, Trades=41
[INFO] Top 2: Short SMA=146, Long SMA=180, Sharpe=0.3501, Trades=19
[INFO] Top 3: Short SMA=146, Long SMA=164, Sharpe=0.3105, Trades=37
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10309 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 156, Long SMA: 158
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(154/164) - Original Sharpe: 0.4730, Trades: 41
[INFO] Hierarchical cluster 2: SMA(146/180) - Original Sharpe: 0.3501, Trades: 19
[INFO] Hierarchical cluster 3: SMA(146/164) - Original Sharpe: 0.3105, Trades: 37
[INFO] Hierarchical cluster 4: SMA(22/162) - Original Sharpe: 0.2259, Trades: 21
[INFO] Hierarchical cluster 5: SMA(22/274) - Original Sharpe: 0.1718, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2544
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (156/158)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (154/164) - Sharpe: 0.4730
[INFO] cluster 2: (146/180) - Sharpe: 0.3501
[INFO] cluster 3: (146/164) - Sharpe: 0.3105
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Out-of-sample period starts on: 2021-12-17
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-17 2021-12-17            41     2.102424            2.102424
1    2022-02-17 2022-02-17            41    -0.193263           -0.193263
2    2022-04-17 2022-04-17            40    -2.414653           -2.414653
3    2022-06-17 2022-06-17            43     3.471248            3.471248
4    2022-08-17 2022-08-17            41     5.752319            1.539595
5    2022-10-17 2022-10-17            45     0.507784            2.141812
6    2022-12-17 2022-12-17            41     1.439696           -1.263648
7    2023-02-17 2023-02-17            39    -5.196104           -3.195836
8    2023-04-17 2023-04-17            42    -1.914640           -1.914640
9    2023-06-17 2023-06-17            43    -1.864618           -1.864618
10   2023-08-17 2023-08-17            42    -3.026053           -1.977975
11   2023-10-17 2023-10-17            44     2.645057            1.290004
12   2023-12-17 2023-12-17            42     2.127559            1.123648
13   2024-02-17 2024-02-17            40    -5.080096           -1.350880
14   2024-04-17 2024-04-17            41    -1.461984           -0.036654
15   2024-06-17 2024-06-17            45     0.717903            0.717903
16   2024-08-17 2024-08-17            42     0.001423            0.001423
17   2024-10-17 2024-10-17            43    -0.391047           -0.290333
18   2024-12-17 2024-12-17             9     7.439225            3.065770
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-17   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2022-02-17   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-04-17   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2022-06-17   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-08-17   |          5.8 |              1.5 |         -4.3 | False         
[INFO] 2022-10-17   |          0.5 |              2.1 |          1.6 | True          
[INFO] 2022-12-17   |          1.4 |             -1.3 |         -2.7 | False         
[INFO] 2023-02-17   |         -5.2 |             -3.2 |          2.0 | True          
[INFO] 2023-04-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-06-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-08-17   |         -3.0 |             -2.0 |          1.0 | True          
[INFO] 2023-10-17   |          2.6 |              1.3 |         -1.3 | False         
[INFO] 2023-12-17   |          2.1 |              1.1 |         -1.0 | False         
[INFO] 2024-02-17   |         -5.1 |             -1.4 |          3.7 | True          
[INFO] 2024-04-17   |         -1.5 |             -0.0 |          1.5 | True          
[INFO] 2024-06-17   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-08-17   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-10-17   |         -0.4 |             -0.3 |          0.1 | True          
[INFO] 2024-12-17   |          7.4 |              3.1 |         -4.3 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-12-17, 2022-02-17, 2022-04-17, 2022-06-17, 2023-04-17, 2023-06-17, 2024-06-17, 2024-08-17
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 11 periods (54.55% win rate)
[INFO] Updating Excel file with Hierarchical results for LZ...
[INFO] Excel file updated successfully. Added LZ with Hierarchical win rate 54.5% in row 32
[INFO] Added best Sharpe parameters 156/158 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 156, Long SMA: 158
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(154/164) - Original Sharpe: 0.4730
[INFO] Added cluster 2 to portfolio: SMA(146/180) - Original Sharpe: 0.3501
[INFO] Added cluster 3 to portfolio: SMA(146/164) - Original Sharpe: 0.3105
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LZ_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2386
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1947
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for LZ...
[INFO] Excel file updated successfully. Added LZ with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LZ
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for MME in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 69.42s
[INFO] Best parameters: Short SMA = 42, Long SMA = 46
[INFO] Best Sharpe ratio: 0.770410, Trades: 114
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @MME=103XC
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.01 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $461,080.00
[INFO] Market Buy & Hold P&L: $4,740.00
[INFO] Outperformance: $456,340.00
[INFO] Sharpe ratio (entire period, annualized): 0.635182
[INFO] Sharpe ratio (in-sample, annualized): 0.770410
[INFO] Sharpe ratio (out-of-sample, annualized): 0.299055
[INFO] Maximum Drawdown: $136,680.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 72
[INFO] Out-of-sample period trades: 42
[INFO] Total trades: 114
[INFO] In-sample P&L: $450,370.00
[INFO] Out-of-sample P&L: $70,150.00
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 46, Sharpe = 0.770410
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8268 to 0.7704
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.770410
[INFO] Number of Trades: 114
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8268 to 0.7704
[INFO] Trades range: 11.0 to 345.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.3786 to 3.2235
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 202 elements
[INFO] Kmeans Cluster 1: 268 elements
[INFO] Kmeans Cluster 2: 218 elements
[INFO] Kmeans Cluster 3: 277 elements
[INFO] Kmeans Cluster 4: 171 elements
[INFO] Kmeans Cluster 5: 196 elements
[INFO] Kmeans Cluster 6: 167 elements
[INFO] Kmeans Cluster 7: 194 elements
[INFO] Kmeans Cluster 8: 243 elements
[INFO] Kmeans Cluster 9: 225 elements
[INFO] Kmeans Cluster 10: 215 elements
[INFO] Kmeans Cluster 11: 193 elements
[INFO] Kmeans Cluster 12: 220 elements
[INFO] Kmeans Cluster 13: 239 elements
[INFO] Kmeans Cluster 14: 289 elements
[INFO] Kmeans Cluster 15: 217 elements
[INFO] Kmeans Cluster 16: 239 elements
[INFO] Kmeans Cluster 17: 163 elements
[INFO] Kmeans Cluster 18: 193 elements
[INFO] Kmeans Cluster 19: 158 elements
[INFO] Kmeans Cluster 20: 133 elements
[INFO] Kmeans Cluster 21: 220 elements
[INFO] Kmeans Cluster 22: 212 elements
[INFO] Kmeans Cluster 23: 106 elements
[INFO] Kmeans Cluster 24: 253 elements
[INFO] Kmeans Cluster 25: 227 elements
[INFO] Kmeans Cluster 26: 174 elements
[INFO] Kmeans Cluster 27: 130 elements
[INFO] Kmeans Cluster 28: 140 elements
[INFO] Kmeans Cluster 29: 220 elements
[INFO] Kmeans Cluster 30: 247 elements
[INFO] Kmeans Cluster 31: 223 elements
[INFO] Kmeans Cluster 32: 232 elements
[INFO] Kmeans Cluster 33: 228 elements
[INFO] Kmeans Cluster 34: 210 elements
[INFO] Kmeans Cluster 35: 161 elements
[INFO] Kmeans Cluster 36: 220 elements
[INFO] Kmeans Cluster 37: 319 elements
[INFO] Kmeans Cluster 38: 263 elements
[INFO] Kmeans Cluster 39: 226 elements
[INFO] Kmeans Cluster 40: 294 elements
[INFO] Kmeans Cluster 41: 329 elements
[INFO] Kmeans Cluster 42: 236 elements
[INFO] Kmeans Cluster 43: 12 elements
[INFO] Kmeans Cluster 44: 226 elements
[INFO] Kmeans Cluster 45: 210 elements
[INFO] Kmeans Cluster 46: 284 elements
[INFO] Kmeans Cluster 47: 159 elements
[INFO] Kmeans Cluster 48: 258 elements
[INFO] Kmeans Cluster 49: 146 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=98.80, Long SMA=179.43, Sharpe=-0.6282
[INFO] Centroid 1: Short SMA=41.45, Long SMA=250.28, Sharpe=0.0150
[INFO] Centroid 2: Short SMA=155.29, Long SMA=275.67, Sharpe=-0.0679
[INFO] Centroid 3: Short SMA=35.45, Long SMA=81.35, Sharpe=0.2352
[INFO] Centroid 4: Short SMA=101.22, Long SMA=137.61, Sharpe=-0.2621
[INFO] Centroid 5: Short SMA=225.27, Long SMA=273.33, Sharpe=0.1671
[INFO] Centroid 6: Short SMA=61.20, Long SMA=85.14, Sharpe=-0.0388
[INFO] Centroid 7: Short SMA=161.09, Long SMA=183.73, Sharpe=-0.0677
[INFO] Centroid 8: Short SMA=99.43, Long SMA=217.39, Sharpe=-0.2717
[INFO] Centroid 9: Short SMA=211.87, Long SMA=252.49, Sharpe=0.3618
[INFO] Centroid 10: Short SMA=23.23, Long SMA=54.18, Sharpe=0.5555
[INFO] Centroid 11: Short SMA=138.29, Long SMA=160.30, Sharpe=-0.2812
[INFO] Centroid 12: Short SMA=17.42, Long SMA=182.46, Sharpe=0.1234
[INFO] Centroid 13: Short SMA=65.89, Long SMA=172.87, Sharpe=-0.0254
[INFO] Centroid 14: Short SMA=127.22, Long SMA=284.39, Sharpe=0.0312
[INFO] Centroid 15: Short SMA=17.94, Long SMA=273.12, Sharpe=0.1308
[INFO] Centroid 16: Short SMA=146.97, Long SMA=199.56, Sharpe=-0.1932
[INFO] Centroid 17: Short SMA=73.66, Long SMA=136.36, Sharpe=0.0963
[INFO] Centroid 18: Short SMA=182.17, Long SMA=237.39, Sharpe=-0.1333
[INFO] Centroid 19: Short SMA=187.81, Long SMA=204.23, Sharpe=0.1464
[INFO] Centroid 20: Short SMA=222.62, Long SMA=242.53, Sharpe=0.5280
[INFO] Centroid 21: Short SMA=80.17, Long SMA=251.41, Sharpe=-0.2041
[INFO] Centroid 22: Short SMA=121.06, Long SMA=188.50, Sharpe=-0.3535
[INFO] Centroid 23: Short SMA=12.70, Long SMA=128.68, Sharpe=0.3713
[INFO] Centroid 24: Short SMA=50.57, Long SMA=190.88, Sharpe=-0.1207
[INFO] Centroid 25: Short SMA=88.72, Long SMA=285.10, Sharpe=-0.0329
[INFO] Centroid 26: Short SMA=77.66, Long SMA=99.52, Sharpe=-0.2667
[INFO] Centroid 27: Short SMA=263.29, Long SMA=289.92, Sharpe=-0.0757
[INFO] Centroid 28: Short SMA=247.93, Long SMA=266.51, Sharpe=0.2995
[INFO] Centroid 29: Short SMA=58.03, Long SMA=282.59, Sharpe=-0.1443
[INFO] Centroid 30: Short SMA=35.84, Long SMA=230.41, Sharpe=0.1451
[INFO] Centroid 31: Short SMA=177.31, Long SMA=278.46, Sharpe=0.0797
[INFO] Centroid 32: Short SMA=151.49, Long SMA=237.26, Sharpe=0.0327
[INFO] Centroid 33: Short SMA=29.89, Long SMA=52.40, Sharpe=0.3772
[INFO] Centroid 34: Short SMA=132.88, Long SMA=246.63, Sharpe=0.1872
[INFO] Centroid 35: Short SMA=228.37, Long SMA=288.87, Sharpe=0.0381
[INFO] Centroid 36: Short SMA=50.10, Long SMA=128.54, Sharpe=0.0136
[INFO] Centroid 37: Short SMA=29.94, Long SMA=116.73, Sharpe=0.1479
[INFO] Centroid 38: Short SMA=40.52, Long SMA=156.94, Sharpe=-0.1424
[INFO] Centroid 39: Short SMA=90.42, Long SMA=120.42, Sharpe=-0.0928
[INFO] Centroid 40: Short SMA=182.81, Long SMA=219.01, Sharpe=-0.0037
[INFO] Centroid 41: Short SMA=112.27, Long SMA=153.90, Sharpe=-0.4776
[INFO] Centroid 42: Short SMA=109.95, Long SMA=264.58, Sharpe=0.1082
[INFO] Centroid 44: Short SMA=41.93, Long SMA=283.63, Sharpe=-0.0265
[INFO] Centroid 45: Short SMA=190.45, Long SMA=283.42, Sharpe=0.2604
[INFO] Centroid 46: Short SMA=40.23, Long SMA=213.17, Sharpe=-0.0146
[INFO] Centroid 47: Short SMA=267.27, Long SMA=285.51, Sharpe=0.1100
[INFO] Centroid 48: Short SMA=83.00, Long SMA=217.09, Sharpe=-0.4221
[INFO] Centroid 49: Short SMA=122.84, Long SMA=227.08, Sharpe=-0.0528
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=46, Sharpe=0.7704, Trades=114
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=22, Long SMA=54, Sharpe=0.6414, Trades=56
[INFO] Kmeans Top 2: Short SMA=222, Long SMA=242, Sharpe=0.5816, Trades=27
[INFO] Kmeans Top 3: Short SMA=12, Long SMA=130, Sharpe=0.4408, Trades=39
[INFO] Kmeans Top 4: Short SMA=210, Long SMA=254, Sharpe=0.4045, Trades=19
[INFO] Kmeans Top 5: Short SMA=32, Long SMA=52, Sharpe=0.3752, Trades=56
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (99, 179)
[INFO]   Nearest: (98.0, 180.0)
[INFO]   Rounded: (41, 250)
[INFO]   Nearest: (42.0, 250.0)
[INFO]   Rounded: (155, 276)
[INFO]   Nearest: (156.0, 276.0)
[INFO]   Rounded: (35, 81)
[INFO]   Nearest: (36.0, 82.0)
[INFO]   Rounded: (101, 138)
[INFO]   Nearest: (102.0, 138.0)
[INFO]   Rounded: (225, 273)
[INFO]   Nearest: (226.0, 274.0)
[INFO]   Rounded: (61, 85)
[INFO]   Nearest: (62.0, 86.0)
[INFO]   Rounded: (161, 184)
[INFO]   Nearest: (162.0, 184.0)
[INFO]   Rounded: (99, 217)
[INFO]   Nearest: (100.0, 218.0)
[INFO]   Rounded: (212, 252)
[INFO]   Rounded: (23, 54)
[INFO]   Nearest: (24.0, 54.0)
[INFO]   Rounded: (138, 160)
[INFO]   Rounded: (17, 182)
[INFO]   Nearest: (18.0, 182.0)
[INFO]   Rounded: (66, 173)
[INFO]   Nearest: (66.0, 172.0)
[INFO]   Rounded: (127, 284)
[INFO]   Nearest: (128.0, 284.0)
[INFO]   Rounded: (18, 273)
[INFO]   Nearest: (18.0, 274.0)
[INFO]   Rounded: (147, 200)
[INFO]   Nearest: (146.0, 200.0)
[INFO]   Rounded: (74, 136)
[INFO]   Rounded: (182, 237)
[INFO]   Nearest: (182.0, 238.0)
[INFO]   Rounded: (188, 204)
[INFO]   Rounded: (223, 243)
[INFO]   Nearest: (222.0, 242.0)
[INFO]   Rounded: (80, 251)
[INFO]   Nearest: (80.0, 252.0)
[INFO]   Rounded: (121, 188)
[INFO]   Nearest: (122.0, 188.0)
[INFO]   Rounded: (13, 129)
[INFO]   Nearest: (12.0, 128.0)
[INFO]   Rounded: (51, 191)
[INFO]   Nearest: (50.0, 190.0)
[INFO]   Rounded: (89, 285)
[INFO]   Nearest: (88.0, 286.0)
[INFO]   Rounded: (78, 100)
[INFO]   Rounded: (263, 290)
[INFO]   Nearest: (264.0, 290.0)
[INFO]   Rounded: (248, 267)
[INFO]   Nearest: (248.0, 266.0)
[INFO]   Rounded: (58, 283)
[INFO]   Nearest: (58.0, 282.0)
[INFO]   Rounded: (36, 230)
[INFO]   Rounded: (177, 278)
[INFO]   Nearest: (178.0, 278.0)
[INFO]   Rounded: (151, 237)
[INFO]   Nearest: (152.0, 238.0)
[INFO]   Rounded: (30, 52)
[INFO]   Rounded: (133, 247)
[INFO]   Nearest: (132.0, 246.0)
[INFO]   Rounded: (228, 289)
[INFO]   Nearest: (228.0, 288.0)
[INFO]   Rounded: (50, 129)
[INFO]   Nearest: (50.0, 128.0)
[INFO]   Rounded: (30, 117)
[INFO]   Nearest: (30.0, 116.0)
[INFO]   Rounded: (41, 157)
[INFO]   Nearest: (40.0, 156.0)
[INFO]   Rounded: (90, 120)
[INFO]   Rounded: (183, 219)
[INFO]   Nearest: (182.0, 220.0)
[INFO]   Rounded: (112, 154)
[INFO]   Rounded: (110, 265)
[INFO]   Nearest: (110.0, 264.0)
[INFO]   Rounded: (42, 284)
[INFO]   Rounded: (190, 283)
[INFO]   Nearest: (190.0, 284.0)
[INFO]   Rounded: (40, 213)
[INFO]   Nearest: (40.0, 214.0)
[INFO]   Rounded: (267, 286)
[INFO]   Nearest: (268.0, 286.0)
[INFO]   Rounded: (83, 217)
[INFO]   Nearest: (82.0, 218.0)
[INFO]   Rounded: (123, 227)
[INFO]   Nearest: (122.0, 228.0)
[INFO] Successfully plotted 49 out of 49 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(22/54) - Original Sharpe: 0.6414, Trades: 56
[INFO] Kmeans cluster 2: SMA(222/242) - Original Sharpe: 0.5816, Trades: 27
[INFO] Kmeans cluster 3: SMA(12/130) - Original Sharpe: 0.4408, Trades: 39
[INFO] Kmeans cluster 4: SMA(210/254) - Original Sharpe: 0.4045, Trades: 19
[INFO] Kmeans cluster 5: SMA(32/52) - Original Sharpe: 0.3752, Trades: 56
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (22/54) - Sharpe: 0.6414
[INFO] cluster 2: (222/242) - Sharpe: 0.5816
[INFO] cluster 3: (12/130) - Sharpe: 0.4408
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.361742            0.022751
1    2021-11-14 2021-11-14            43    -1.602839           -2.715959
2    2022-01-14 2022-01-14            41     4.130644            5.249232
3    2022-03-14 2022-03-14            44     1.862130            1.111719
4    2022-05-14 2022-05-14            43    -1.126816            0.878780
5    2022-07-14 2022-07-14            44     1.988272            0.421932
6    2022-09-14 2022-09-14            43    -0.246838            0.693882
7    2022-11-14 2022-11-14            43     3.722936            1.723344
8    2023-01-14 2023-01-14            41    -3.722520           -1.527094
9    2023-03-14 2023-03-14            44    -1.448805           -2.617394
10   2023-05-14 2023-05-14            44    -0.138874           -4.122952
11   2023-07-14 2023-07-14            44    -1.008814           -4.989374
12   2023-09-14 2023-09-14            43     1.221874            1.221874
13   2023-11-14 2023-11-14            42    -0.797839           -2.267579
14   2024-01-14 2024-01-14            43     0.255477           -0.392202
15   2024-03-14 2024-03-14            42     0.482175           -1.652985
16   2024-05-14 2024-05-14            44     0.027624            2.970981
17   2024-07-14 2024-07-14            45     2.029233           -4.170885
18   2024-09-14 2024-09-14            43    -1.061167           -0.322741
19   2024-11-14 2024-11-14            33     1.867323            1.640528
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |              0.0 |          0.4 | True          
[INFO] 2021-11-14   |         -1.6 |             -2.7 |         -1.1 | False         
[INFO] 2022-01-14   |          4.1 |              5.2 |          1.1 | True          
[INFO] 2022-03-14   |          1.9 |              1.1 |         -0.8 | False         
[INFO] 2022-05-14   |         -1.1 |              0.9 |          2.0 | True          
[INFO] 2022-07-14   |          2.0 |              0.4 |         -1.6 | False         
[INFO] 2022-09-14   |         -0.2 |              0.7 |          0.9 | True          
[INFO] 2022-11-14   |          3.7 |              1.7 |         -2.0 | False         
[INFO] 2023-01-14   |         -3.7 |             -1.5 |          2.2 | True          
[INFO] 2023-03-14   |         -1.4 |             -2.6 |         -1.2 | False         
[INFO] 2023-05-14   |         -0.1 |             -4.1 |         -4.0 | False         
[INFO] 2023-07-14   |         -1.0 |             -5.0 |         -4.0 | False         
[INFO] 2023-09-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -0.8 |             -2.3 |         -1.5 | False         
[INFO] 2024-01-14   |          0.3 |             -0.4 |         -0.7 | False         
[INFO] 2024-03-14   |          0.5 |             -1.7 |         -2.2 | False         
[INFO] 2024-05-14   |          0.0 |              3.0 |          3.0 | True          
[INFO] 2024-07-14   |          2.0 |             -4.2 |         -6.2 | False         
[INFO] 2024-09-14   |         -1.1 |             -0.3 |          0.8 | True          
[INFO] 2024-11-14   |          1.9 |              1.6 |         -0.3 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 7 of 19 periods (36.84% win rate)
[INFO] Updating Excel file with Kmeans results for MME...
[INFO] Excel file updated successfully. Added MME with Kmeans win rate 36.8% in row 33
[INFO] Added best Sharpe parameters 42/46 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 46
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(22/54) - Original Sharpe: 0.6414
[INFO] Added cluster 2 to portfolio: SMA(222/242) - Original Sharpe: 0.5816
[INFO] Added cluster 3 to portfolio: SMA(12/130) - Original Sharpe: 0.4408
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MME_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3838
[INFO] Kmeans Best out-of-sample Sharpe: 0.2991
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for MME...
[INFO] Excel file updated successfully. Added MME with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MME
[INFO] Big Point Value: 50.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8268 to 0.7704
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.770410
[INFO] Number of Trades: 114
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8268 to 0.7704
[INFO] Trades range: 11.0 to 345.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.3786 to 3.2235
[INFO] Scaled Trades range: -0.7680 to 16.8676
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4956
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 594 elements
[INFO] Cluster 1: 406 elements
[INFO] Cluster 2: 224 elements
[INFO] Cluster 3: 143 elements
[INFO] Cluster 4: 355 elements
[INFO] Cluster 5: 451 elements
[INFO] Cluster 6: 266 elements
[INFO] Cluster 7: 339 elements
[INFO] Cluster 8: 67 elements
[INFO] Cluster 9: 242 elements
[INFO] Cluster 10: 163 elements
[INFO] Cluster 11: 6 elements
[INFO] Cluster 12: 181 elements
[INFO] Cluster 13: 296 elements
[INFO] Cluster 14: 405 elements
[INFO] Cluster 15: 315 elements
[INFO] Cluster 16: 234 elements
[INFO] Cluster 17: 405 elements
[INFO] Cluster 18: 612 elements
[INFO] Cluster 19: 181 elements
[INFO] Cluster 20: 252 elements
[INFO] Cluster 21: 106 elements
[INFO] Cluster 22: 260 elements
[INFO] Cluster 23: 50 elements
[INFO] Cluster 24: 10 elements
[INFO] Cluster 25: 246 elements
[INFO] Cluster 26: 61 elements
[INFO] Cluster 27: 199 elements
[INFO] Cluster 28: 248 elements
[INFO] Cluster 29: 275 elements
[INFO] Cluster 30: 522 elements
[INFO] Cluster 31: 64 elements
[INFO] Cluster 32: 262 elements
[INFO] Cluster 33: 180 elements
[INFO] Cluster 34: 161 elements
[INFO] Cluster 35: 35 elements
[INFO] Cluster 36: 49 elements
[INFO] Cluster 37: 177 elements
[INFO] Cluster 38: 174 elements
[INFO] Cluster 39: 138 elements
[INFO] Cluster 40: 287 elements
[INFO] Cluster 41: 188 elements
[INFO] Cluster 42: 30 elements
[INFO] Cluster 43: 61 elements
[INFO] Cluster 44: 206 elements
[INFO] Cluster 45: 10 elements
[INFO] Cluster 46: 115 elements
[INFO] Cluster 47: 60 elements
[INFO] Cluster 48: 151 elements
[INFO] Cluster 49: 123 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=112, Long SMA=278, Sharpe=-0.0371, Trades=15
[INFO] Cluster 1 cluster: Short SMA=88, Long SMA=242, Sharpe=-0.2621, Trades=17
[INFO] Cluster 2 cluster: Short SMA=246, Long SMA=272, Sharpe=0.2983, Trades=25
[INFO] Cluster 3 cluster: Short SMA=28, Long SMA=64, Sharpe=0.5256, Trades=46
[INFO] Cluster 4 cluster: Short SMA=182, Long SMA=274, Sharpe=0.1709, Trades=13
[INFO] Cluster 5 cluster: Short SMA=66, Long SMA=140, Sharpe=0.0360, Trades=20
[INFO] Cluster 6 cluster: Short SMA=222, Long SMA=244, Sharpe=0.5770, Trades=27
[INFO] Cluster 7 cluster: Short SMA=86, Long SMA=208, Sharpe=-0.5175, Trades=16
[INFO] Cluster 8 cluster: Short SMA=104, Long SMA=106, Sharpe=-0.1474, Trades=98
[INFO] Cluster 9 cluster: Short SMA=186, Long SMA=206, Sharpe=0.0833, Trades=29
[INFO] Cluster 10 cluster: Short SMA=22, Long SMA=48, Sharpe=0.4836, Trades=62
[INFO] Cluster 12 cluster: Short SMA=130, Long SMA=154, Sharpe=-0.5027, Trades=30
[INFO] Cluster 13 cluster: Short SMA=20, Long SMA=270, Sharpe=0.1307, Trades=23
[INFO] Cluster 14 cluster: Short SMA=34, Long SMA=98, Sharpe=0.1263, Trades=31
[INFO] Cluster 15 cluster: Short SMA=62, Long SMA=194, Sharpe=-0.0325, Trades=16
[INFO] Cluster 16 cluster: Short SMA=16, Long SMA=196, Sharpe=0.1423, Trades=29
[INFO] Cluster 17 cluster: Short SMA=40, Long SMA=162, Sharpe=-0.1691, Trades=23
[INFO] Cluster 18 cluster: Short SMA=56, Long SMA=278, Sharpe=0.0132, Trades=19
[INFO] Cluster 19 cluster: Short SMA=156, Long SMA=182, Sharpe=-0.0625, Trades=27
[INFO] Cluster 20 cluster: Short SMA=144, Long SMA=204, Sharpe=-0.1021, Trades=17
[INFO] Cluster 21 cluster: Short SMA=72, Long SMA=86, Sharpe=-0.1453, Trades=44
[INFO] Cluster 22 cluster: Short SMA=184, Long SMA=236, Sharpe=-0.0600, Trades=17
[INFO] Cluster 23 cluster: Short SMA=242, Long SMA=244, Sharpe=0.2317, Trades=77
[INFO] Cluster 25 cluster: Short SMA=30, Long SMA=218, Sharpe=0.0304, Trades=23
[INFO] Cluster 26 cluster: Short SMA=124, Long SMA=130, Sharpe=-0.2178, Trades=63
[INFO] Cluster 27 cluster: Short SMA=78, Long SMA=108, Sharpe=-0.1508, Trades=26
[INFO] Cluster 28 cluster: Short SMA=120, Long SMA=194, Sharpe=-0.2777, Trades=17
[INFO] Cluster 29 cluster: Short SMA=196, Long SMA=276, Sharpe=0.3961, Trades=13
[INFO] Cluster 30 cluster: Short SMA=146, Long SMA=232, Sharpe=-0.0922, Trades=17
[INFO] Cluster 31 cluster: Short SMA=26, Long SMA=34, Sharpe=0.3992, Trades=104
[INFO] Cluster 32 cluster: Short SMA=152, Long SMA=278, Sharpe=-0.1516, Trades=13
[INFO] Cluster 33 cluster: Short SMA=262, Long SMA=290, Sharpe=-0.0700, Trades=25
[INFO] Cluster 34 cluster: Short SMA=132, Long SMA=250, Sharpe=0.2468, Trades=13
[INFO] Cluster 35 cluster: Short SMA=32, Long SMA=36, Sharpe=0.5112, Trades=143
[INFO] Cluster 36 cluster: Short SMA=184, Long SMA=188, Sharpe=-0.0893, Trades=63
[INFO] Cluster 37 cluster: Short SMA=20, Long SMA=146, Sharpe=0.1206, Trades=25
[INFO] Cluster 38 cluster: Short SMA=18, Long SMA=92, Sharpe=0.2950, Trades=36
[INFO] Cluster 39 cluster: Short SMA=54, Long SMA=96, Sharpe=-0.1014, Trades=29
[INFO] Cluster 40 cluster: Short SMA=48, Long SMA=234, Sharpe=0.1727, Trades=19
[INFO] Cluster 41 cluster: Short SMA=98, Long SMA=178, Sharpe=-0.6266, Trades=20
[INFO] Cluster 42 cluster: Short SMA=270, Long SMA=274, Sharpe=-0.0231, Trades=51
[INFO] Cluster 43 cluster: Short SMA=154, Long SMA=162, Sharpe=-0.2834, Trades=52
[INFO] Cluster 44 cluster: Short SMA=230, Long SMA=288, Sharpe=0.0634, Trades=19
[INFO] Cluster 46 cluster: Short SMA=90, Long SMA=154, Sharpe=-0.2720, Trades=20
[INFO] Cluster 47 cluster: Short SMA=96, Long SMA=104, Sharpe=-0.3610, Trades=46
[INFO] Cluster 48 cluster: Short SMA=108, Long SMA=148, Sharpe=-0.5554, Trades=22
[INFO] Cluster 49 cluster: Short SMA=88, Long SMA=126, Sharpe=-0.0727, Trades=24
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=46, Sharpe=0.7704, Trades=114
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=222, Long SMA=244, Sharpe=0.5770, Trades=27
[INFO] Top 2: Short SMA=28, Long SMA=64, Sharpe=0.5256, Trades=46
[INFO] Top 3: Short SMA=32, Long SMA=36, Sharpe=0.5112, Trades=143
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10559 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(222/244) - Original Sharpe: 0.5770, Trades: 27
[INFO] Hierarchical cluster 2: SMA(28/64) - Original Sharpe: 0.5256, Trades: 46
[INFO] Hierarchical cluster 3: SMA(32/36) - Original Sharpe: 0.5112, Trades: 143
[INFO] Hierarchical cluster 4: SMA(22/48) - Original Sharpe: 0.4836, Trades: 62
[INFO] Hierarchical cluster 5: SMA(26/34) - Original Sharpe: 0.3992, Trades: 104
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (222/244) - Sharpe: 0.5770
[INFO] cluster 2: (28/64) - Sharpe: 0.5256
[INFO] cluster 3: (32/36) - Sharpe: 0.5112
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.361742            2.219880
1    2021-11-14 2021-11-14            43    -1.602839           -3.727358
2    2022-01-14 2022-01-14            41     4.130644            3.053304
3    2022-03-14 2022-03-14            44     1.862130            0.861822
4    2022-05-14 2022-05-14            43    -1.126816            0.541956
5    2022-07-14 2022-07-14            44     1.988272            0.254961
6    2022-09-14 2022-09-14            43    -0.246838            0.693882
7    2022-11-14 2022-11-14            43     3.722936           -0.137221
8    2023-01-14 2023-01-14            41    -3.722520           -2.261490
9    2023-03-14 2023-03-14            44    -1.448805           -1.294979
10   2023-05-14 2023-05-14            44    -0.138874           -2.478641
11   2023-07-14 2023-07-14            44    -1.008814           -1.283359
12   2023-09-14 2023-09-14            43     1.221874            2.353038
13   2023-11-14 2023-11-14            42    -0.797839           -0.275573
14   2024-01-14 2024-01-14            43     0.255477           -0.754409
15   2024-03-14 2024-03-14            42     0.482175           -1.660974
16   2024-05-14 2024-05-14            44     0.027624           -0.749641
17   2024-07-14 2024-07-14            45     2.029233           -2.446646
18   2024-09-14 2024-09-14            43    -1.061167            0.517191
19   2024-11-14 2024-11-14            33     1.867323            1.907227
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |              2.2 |          2.6 | True          
[INFO] 2021-11-14   |         -1.6 |             -3.7 |         -2.1 | False         
[INFO] 2022-01-14   |          4.1 |              3.1 |         -1.0 | False         
[INFO] 2022-03-14   |          1.9 |              0.9 |         -1.0 | False         
[INFO] 2022-05-14   |         -1.1 |              0.5 |          1.6 | True          
[INFO] 2022-07-14   |          2.0 |              0.3 |         -1.7 | False         
[INFO] 2022-09-14   |         -0.2 |              0.7 |          0.9 | True          
[INFO] 2022-11-14   |          3.7 |             -0.1 |         -3.8 | False         
[INFO] 2023-01-14   |         -3.7 |             -2.3 |          1.4 | True          
[INFO] 2023-03-14   |         -1.4 |             -1.3 |          0.1 | True          
[INFO] 2023-05-14   |         -0.1 |             -2.5 |         -2.4 | False         
[INFO] 2023-07-14   |         -1.0 |             -1.3 |         -0.3 | False         
[INFO] 2023-09-14   |          1.2 |              2.4 |          1.2 | True          
[INFO] 2023-11-14   |         -0.8 |             -0.3 |          0.5 | True          
[INFO] 2024-01-14   |          0.3 |             -0.8 |         -1.1 | False         
[INFO] 2024-03-14   |          0.5 |             -1.7 |         -2.2 | False         
[INFO] 2024-05-14   |          0.0 |             -0.7 |         -0.7 | False         
[INFO] 2024-07-14   |          2.0 |             -2.4 |         -4.4 | False         
[INFO] 2024-09-14   |         -1.1 |              0.5 |          1.6 | True          
[INFO] 2024-11-14   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 19 periods (42.11% win rate)
[INFO] Updating Excel file with Hierarchical results for MME...
[INFO] Excel file updated successfully. Added MME with Hierarchical win rate 42.1% in row 33
[INFO] Added best Sharpe parameters 42/46 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 46
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(222/244) - Original Sharpe: 0.5770
[INFO] Added cluster 2 to portfolio: SMA(28/64) - Original Sharpe: 0.5256
[INFO] Added cluster 3 to portfolio: SMA(32/36) - Original Sharpe: 0.5112
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MME_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3374
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2991
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for MME...
[INFO] Excel file updated successfully. Added MME with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MME
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for MP1 in column D: 8.5
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.66s
[INFO] Best parameters: Short SMA = 134, Long SMA = 138
[INFO] Best Sharpe ratio: 0.532081, Trades: 69
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 146 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @MP1
[INFO] Big Point Value (from data): 500000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 21.52 contracts
[INFO] Maximum Position Size: 40 contracts
[INFO] Strategy Total P&L: $332,152.00
[INFO] Market Buy & Hold P&L: $-645.00
[INFO] Outperformance: $332,797.00
[INFO] Sharpe ratio (entire period, annualized): 0.421251
[INFO] Sharpe ratio (in-sample, annualized): 0.532081
[INFO] Sharpe ratio (out-of-sample, annualized): 0.165051
[INFO] Maximum Drawdown: $177,843.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 52
[INFO] Out-of-sample period trades: 17
[INFO] Total trades: 69
[INFO] In-sample P&L: $272,899.50
[INFO] Out-of-sample P&L: $36,643.00
[INFO] 
Best parameters from GA: Short SMA = 134, Long SMA = 138, Sharpe = 0.532081
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 500000.0
[INFO] Slippage: 8.5
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8335 to 0.5321
[INFO] 
Best parameters:
[INFO] Short SMA: 134
[INFO] Long SMA: 138
[INFO] Sharpe Ratio: 0.532081
[INFO] Number of Trades: 69
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10439 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8335 to 0.5321
[INFO] Trades range: 10.0 to 324.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3869 to 2.7871
[INFO] Scaled Long SMA range: -2.7944 to 1.4240
[INFO] Scaled Sharpe ratio range: -3.2705 to 3.1456
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 85 elements
[INFO] Kmeans Cluster 1: 230 elements
[INFO] Kmeans Cluster 2: 410 elements
[INFO] Kmeans Cluster 3: 127 elements
[INFO] Kmeans Cluster 4: 193 elements
[INFO] Kmeans Cluster 5: 225 elements
[INFO] Kmeans Cluster 6: 244 elements
[INFO] Kmeans Cluster 7: 158 elements
[INFO] Kmeans Cluster 8: 250 elements
[INFO] Kmeans Cluster 9: 194 elements
[INFO] Kmeans Cluster 10: 285 elements
[INFO] Kmeans Cluster 11: 226 elements
[INFO] Kmeans Cluster 12: 79 elements
[INFO] Kmeans Cluster 13: 227 elements
[INFO] Kmeans Cluster 14: 139 elements
[INFO] Kmeans Cluster 15: 242 elements
[INFO] Kmeans Cluster 16: 230 elements
[INFO] Kmeans Cluster 17: 156 elements
[INFO] Kmeans Cluster 18: 217 elements
[INFO] Kmeans Cluster 19: 245 elements
[INFO] Kmeans Cluster 20: 167 elements
[INFO] Kmeans Cluster 21: 197 elements
[INFO] Kmeans Cluster 22: 291 elements
[INFO] Kmeans Cluster 23: 162 elements
[INFO] Kmeans Cluster 24: 189 elements
[INFO] Kmeans Cluster 25: 167 elements
[INFO] Kmeans Cluster 26: 224 elements
[INFO] Kmeans Cluster 27: 137 elements
[INFO] Kmeans Cluster 28: 259 elements
[INFO] Kmeans Cluster 29: 249 elements
[INFO] Kmeans Cluster 30: 147 elements
[INFO] Kmeans Cluster 31: 206 elements
[INFO] Kmeans Cluster 32: 152 elements
[INFO] Kmeans Cluster 33: 140 elements
[INFO] Kmeans Cluster 34: 279 elements
[INFO] Kmeans Cluster 35: 181 elements
[INFO] Kmeans Cluster 36: 304 elements
[INFO] Kmeans Cluster 37: 128 elements
[INFO] Kmeans Cluster 38: 256 elements
[INFO] Kmeans Cluster 39: 256 elements
[INFO] Kmeans Cluster 40: 230 elements
[INFO] Kmeans Cluster 41: 139 elements
[INFO] Kmeans Cluster 42: 271 elements
[INFO] Kmeans Cluster 43: 195 elements
[INFO] Kmeans Cluster 44: 196 elements
[INFO] Kmeans Cluster 45: 162 elements
[INFO] Kmeans Cluster 46: 242 elements
[INFO] Kmeans Cluster 47: 269 elements
[INFO] Kmeans Cluster 48: 253 elements
[INFO] Kmeans Cluster 49: 229 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=84.71, Long SMA=97.29, Sharpe=-0.4985
[INFO] Centroid 1: Short SMA=70.72, Long SMA=196.03, Sharpe=-0.1141
[INFO] Centroid 2: Short SMA=203.10, Long SMA=282.47, Sharpe=-0.4126
[INFO] Centroid 3: Short SMA=76.93, Long SMA=109.48, Sharpe=-0.1165
[INFO] Centroid 4: Short SMA=98.97, Long SMA=144.38, Sharpe=0.0189
[INFO] Centroid 5: Short SMA=150.75, Long SMA=229.32, Sharpe=-0.3045
[INFO] Centroid 6: Short SMA=53.09, Long SMA=261.48, Sharpe=-0.0459
[INFO] Centroid 7: Short SMA=239.22, Long SMA=270.23, Sharpe=-0.3215
[INFO] Centroid 8: Short SMA=122.03, Long SMA=193.41, Sharpe=0.3263
[INFO] Centroid 9: Short SMA=26.81, Long SMA=51.82, Sharpe=0.0337
[INFO] Centroid 10: Short SMA=181.41, Long SMA=246.87, Sharpe=-0.4523
[INFO] Centroid 11: Short SMA=22.90, Long SMA=243.81, Sharpe=-0.0130
[INFO] Centroid 12: Short SMA=282.58, Long SMA=294.41, Sharpe=0.2656
[INFO] Centroid 13: Short SMA=81.35, Long SMA=261.13, Sharpe=-0.1475
[INFO] Centroid 14: Short SMA=19.06, Long SMA=121.96, Sharpe=0.0805
[INFO] Centroid 15: Short SMA=116.10, Long SMA=166.36, Sharpe=0.1714
[INFO] Centroid 16: Short SMA=46.93, Long SMA=83.42, Sharpe=-0.2327
[INFO] Centroid 17: Short SMA=17.95, Long SMA=205.10, Sharpe=0.0819
[INFO] Centroid 18: Short SMA=51.79, Long SMA=128.83, Sharpe=-0.2115
[INFO] Centroid 19: Short SMA=113.80, Long SMA=219.65, Sharpe=0.1461
[INFO] Centroid 20: Short SMA=22.84, Long SMA=101.07, Sharpe=-0.0673
[INFO] Centroid 21: Short SMA=149.84, Long SMA=178.58, Sharpe=0.2067
[INFO] Centroid 22: Short SMA=220.31, Long SMA=249.59, Sharpe=-0.5000
[INFO] Centroid 23: Short SMA=29.79, Long SMA=53.70, Sharpe=-0.1072
[INFO] Centroid 24: Short SMA=101.88, Long SMA=253.40, Sharpe=-0.2506
[INFO] Centroid 25: Short SMA=122.56, Long SMA=233.99, Sharpe=-0.0543
[INFO] Centroid 26: Short SMA=147.16, Long SMA=174.94, Sharpe=0.0615
[INFO] Centroid 27: Short SMA=254.28, Long SMA=281.93, Sharpe=-0.0751
[INFO] Centroid 28: Short SMA=35.55, Long SMA=204.72, Sharpe=-0.0818
[INFO] Centroid 29: Short SMA=183.06, Long SMA=217.37, Sharpe=-0.4371
[INFO] Centroid 30: Short SMA=145.88, Long SMA=269.17, Sharpe=-0.3457
[INFO] Centroid 31: Short SMA=95.29, Long SMA=286.15, Sharpe=-0.0508
[INFO] Centroid 32: Short SMA=90.74, Long SMA=113.52, Sharpe=-0.2702
[INFO] Centroid 33: Short SMA=34.96, Long SMA=145.07, Sharpe=-0.0879
[INFO] Centroid 34: Short SMA=54.38, Long SMA=288.37, Sharpe=-0.0998
[INFO] Centroid 35: Short SMA=48.78, Long SMA=231.76, Sharpe=-0.1416
[INFO] Centroid 36: Short SMA=167.37, Long SMA=279.76, Sharpe=-0.4952
[INFO] Centroid 37: Short SMA=22.13, Long SMA=52.91, Sharpe=0.2129
[INFO] Centroid 38: Short SMA=128.55, Long SMA=268.48, Sharpe=-0.1869
[INFO] Centroid 39: Short SMA=21.81, Long SMA=278.89, Sharpe=0.0748
[INFO] Centroid 40: Short SMA=87.65, Long SMA=183.33, Sharpe=0.0178
[INFO] Centroid 41: Short SMA=166.26, Long SMA=196.92, Sharpe=-0.1711
[INFO] Centroid 42: Short SMA=43.41, Long SMA=169.26, Sharpe=-0.2239
[INFO] Centroid 43: Short SMA=110.29, Long SMA=134.47, Sharpe=-0.1041
[INFO] Centroid 44: Short SMA=194.46, Long SMA=216.51, Sharpe=-0.3194
[INFO] Centroid 45: Short SMA=15.59, Long SMA=160.10, Sharpe=0.2041
[INFO] Centroid 46: Short SMA=72.96, Long SMA=154.64, Sharpe=-0.1239
[INFO] Centroid 47: Short SMA=73.08, Long SMA=220.56, Sharpe=-0.2463
[INFO] Centroid 48: Short SMA=54.69, Long SMA=98.47, Sharpe=-0.3526
[INFO] Centroid 49: Short SMA=250.98, Long SMA=278.95, Sharpe=-0.2066
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=134, Long SMA=138, Sharpe=0.5321, Trades=69
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=122, Long SMA=196, Sharpe=0.4394, Trades=14
[INFO] Kmeans Top 2: Short SMA=282, Long SMA=294, Sharpe=0.3671, Trades=36
[INFO] Kmeans Top 3: Short SMA=116, Long SMA=168, Sharpe=0.2361, Trades=26
[INFO] Kmeans Top 4: Short SMA=16, Long SMA=160, Sharpe=0.2104, Trades=21
[INFO] Kmeans Top 5: Short SMA=112, Long SMA=222, Sharpe=0.2102, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (85, 97)
[INFO]   Nearest: (84.0, 98.0)
[INFO]   Rounded: (71, 196)
[INFO]   Nearest: (70.0, 196.0)
[INFO]   Rounded: (203, 282)
[INFO]   Nearest: (204.0, 282.0)
[INFO]   Rounded: (77, 109)
[INFO]   Nearest: (76.0, 110.0)
[INFO]   Rounded: (99, 144)
[INFO]   Nearest: (98.0, 144.0)
[INFO]   Rounded: (151, 229)
[INFO]   Nearest: (150.0, 230.0)
[INFO]   Rounded: (53, 261)
[INFO]   Nearest: (54.0, 262.0)
[INFO]   Rounded: (239, 270)
[INFO]   Nearest: (240.0, 270.0)
[INFO]   Rounded: (122, 193)
[INFO]   Nearest: (122.0, 194.0)
[INFO]   Rounded: (27, 52)
[INFO]   Nearest: (26.0, 52.0)
[INFO]   Rounded: (181, 247)
[INFO]   Nearest: (182.0, 246.0)
[INFO]   Rounded: (23, 244)
[INFO]   Nearest: (22.0, 244.0)
[INFO]   Rounded: (283, 294)
[INFO]   Nearest: (282.0, 294.0)
[INFO]   Rounded: (81, 261)
[INFO]   Nearest: (82.0, 262.0)
[INFO]   Rounded: (19, 122)
[INFO]   Nearest: (20.0, 122.0)
[INFO]   Rounded: (116, 166)
[INFO]   Rounded: (47, 83)
[INFO]   Nearest: (46.0, 84.0)
[INFO]   Rounded: (18, 205)
[INFO]   Nearest: (18.0, 206.0)
[INFO]   Rounded: (52, 129)
[INFO]   Nearest: (52.0, 128.0)
[INFO]   Rounded: (114, 220)
[INFO]   Rounded: (23, 101)
[INFO]   Nearest: (22.0, 102.0)
[INFO]   Rounded: (150, 179)
[INFO]   Nearest: (150.0, 178.0)
[INFO]   Rounded: (220, 250)
[INFO]   Rounded: (30, 54)
[INFO]   Rounded: (102, 253)
[INFO]   Nearest: (102.0, 254.0)
[INFO]   Rounded: (123, 234)
[INFO]   Nearest: (122.0, 234.0)
[INFO]   Rounded: (147, 175)
[INFO]   Nearest: (148.0, 174.0)
[INFO]   Rounded: (254, 282)
[INFO]   Rounded: (36, 205)
[INFO]   Nearest: (36.0, 204.0)
[INFO]   Rounded: (183, 217)
[INFO]   Nearest: (184.0, 218.0)
[INFO]   Rounded: (146, 269)
[INFO]   Nearest: (146.0, 270.0)
[INFO]   Rounded: (95, 286)
[INFO]   Nearest: (96.0, 286.0)
[INFO]   Rounded: (91, 114)
[INFO]   Nearest: (90.0, 114.0)
[INFO]   Rounded: (35, 145)
[INFO]   Nearest: (34.0, 146.0)
[INFO]   Rounded: (54, 288)
[INFO]   Rounded: (49, 232)
[INFO]   Nearest: (48.0, 232.0)
[INFO]   Rounded: (167, 280)
[INFO]   Nearest: (168.0, 280.0)
[INFO]   Rounded: (22, 53)
[INFO]   Nearest: (22.0, 52.0)
[INFO]   Rounded: (129, 268)
[INFO]   Nearest: (128.0, 268.0)
[INFO]   Rounded: (22, 279)
[INFO]   Nearest: (22.0, 278.0)
[INFO]   Rounded: (88, 183)
[INFO]   Nearest: (88.0, 184.0)
[INFO]   Rounded: (166, 197)
[INFO]   Nearest: (166.0, 196.0)
[INFO]   Rounded: (43, 169)
[INFO]   Nearest: (44.0, 170.0)
[INFO]   Rounded: (110, 134)
[INFO]   Rounded: (194, 217)
[INFO]   Nearest: (194.0, 216.0)
[INFO]   Rounded: (16, 160)
[INFO]   Rounded: (73, 155)
[INFO]   Nearest: (72.0, 154.0)
[INFO]   Rounded: (73, 221)
[INFO]   Nearest: (74.0, 220.0)
[INFO]   Rounded: (55, 98)
[INFO]   Nearest: (54.0, 98.0)
[INFO]   Rounded: (251, 279)
[INFO]   Nearest: (250.0, 278.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 134, Long SMA: 138
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(122/196) - Original Sharpe: 0.4394, Trades: 14
[INFO] Kmeans cluster 2: SMA(282/294) - Original Sharpe: 0.3671, Trades: 36
[INFO] Kmeans cluster 3: SMA(116/168) - Original Sharpe: 0.2361, Trades: 26
[INFO] Kmeans cluster 4: SMA(16/160) - Original Sharpe: 0.2104, Trades: 21
[INFO] Kmeans cluster 5: SMA(112/222) - Original Sharpe: 0.2102, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (134/138)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (122/196) - Sharpe: 0.4394
[INFO] cluster 2: (282/294) - Sharpe: 0.3671
[INFO] cluster 3: (116/168) - Sharpe: 0.2361
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.716042           -1.716042
1    2021-11-14 2021-11-14            43    -1.188262           -4.309311
2    2022-01-14 2022-01-14            41    -0.404804            1.624822
3    2022-03-14 2022-03-14            44    -3.078018           -1.972244
4    2022-05-14 2022-05-14            43    -1.026268           -1.026268
5    2022-07-14 2022-07-14            44     2.174461            2.174461
6    2022-09-14 2022-09-14            43     2.833979            2.833979
7    2022-11-14 2022-11-14            43     2.673356            2.849639
8    2023-01-14 2023-01-14            41     0.249214            0.249214
9    2023-03-14 2023-03-14            44     4.663682            4.663682
10   2023-05-14 2023-05-14            44     3.615384            3.615384
11   2023-07-14 2023-07-14            44    -0.398216           -0.398216
12   2023-09-14 2023-09-14            43    -1.304784           -1.304784
13   2023-11-14 2023-11-14            42     3.397164            3.397164
14   2024-01-14 2024-01-14            43    -3.986215            2.548606
15   2024-03-14 2024-03-14            42    -0.165280           -0.165280
16   2024-05-14 2024-05-14            44    -1.994953           -1.994953
17   2024-07-14 2024-07-14            45    -0.809966           -3.485251
18   2024-09-14 2024-09-14            43     2.955873            0.562988
19   2024-11-14 2024-11-14            33     0.878530            3.502426
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.2 |             -4.3 |         -3.1 | False         
[INFO] 2022-01-14   |         -0.4 |              1.6 |          2.0 | True          
[INFO] 2022-03-14   |         -3.1 |             -2.0 |          1.1 | True          
[INFO] 2022-05-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.7 |              2.8 |          0.1 | True          
[INFO] 2023-01-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          4.7 |              4.7 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -4.0 |              2.5 |          6.5 | True          
[INFO] 2024-03-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.8 |             -3.5 |         -2.7 | False         
[INFO] 2024-09-14   |          3.0 |              0.6 |         -2.4 | False         
[INFO] 2024-11-14   |          0.9 |              3.5 |          2.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-03-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Kmeans cluster wins (rounded comparison): 5 of 8 periods (62.50% win rate)
[INFO] Updating Excel file with Kmeans results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Kmeans win rate 62.5% in row 34
[INFO] Added best Sharpe parameters 134/138 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 134, Long SMA: 138
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(122/196) - Original Sharpe: 0.4394
[INFO] Added cluster 2 to portfolio: SMA(282/294) - Original Sharpe: 0.3671
[INFO] Added cluster 3 to portfolio: SMA(116/168) - Original Sharpe: 0.2361
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MP1_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.4034
[INFO] Kmeans Best out-of-sample Sharpe: 0.1651
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MP1
[INFO] Big Point Value: 500000.0
[INFO] Slippage: 8.5
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8335 to 0.5321
[INFO] 
Best parameters:
[INFO] Short SMA: 134
[INFO] Long SMA: 138
[INFO] Sharpe Ratio: 0.532081
[INFO] Number of Trades: 69
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10439 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8335 to 0.5321
[INFO] Trades range: 10.0 to 324.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3869 to 2.7871
[INFO] Scaled Long SMA range: -2.7944 to 1.4240
[INFO] Scaled Sharpe ratio range: -3.2705 to 3.1456
[INFO] Scaled Trades range: -0.6512 to 13.7612
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10439 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5648
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 62 elements
[INFO] Cluster 1: 436 elements
[INFO] Cluster 2: 89 elements
[INFO] Cluster 3: 413 elements
[INFO] Cluster 4: 427 elements
[INFO] Cluster 5: 287 elements
[INFO] Cluster 6: 359 elements
[INFO] Cluster 7: 372 elements
[INFO] Cluster 8: 117 elements
[INFO] Cluster 9: 448 elements
[INFO] Cluster 10: 388 elements
[INFO] Cluster 11: 81 elements
[INFO] Cluster 12: 443 elements
[INFO] Cluster 13: 230 elements
[INFO] Cluster 14: 36 elements
[INFO] Cluster 15: 395 elements
[INFO] Cluster 16: 249 elements
[INFO] Cluster 17: 60 elements
[INFO] Cluster 18: 495 elements
[INFO] Cluster 19: 308 elements
[INFO] Cluster 20: 220 elements
[INFO] Cluster 21: 118 elements
[INFO] Cluster 22: 290 elements
[INFO] Cluster 23: 301 elements
[INFO] Cluster 24: 36 elements
[INFO] Cluster 25: 366 elements
[INFO] Cluster 26: 64 elements
[INFO] Cluster 27: 150 elements
[INFO] Cluster 28: 40 elements
[INFO] Cluster 29: 205 elements
[INFO] Cluster 30: 109 elements
[INFO] Cluster 31: 26 elements
[INFO] Cluster 32: 395 elements
[INFO] Cluster 33: 162 elements
[INFO] Cluster 34: 164 elements
[INFO] Cluster 35: 325 elements
[INFO] Cluster 36: 15 elements
[INFO] Cluster 37: 278 elements
[INFO] Cluster 38: 316 elements
[INFO] Cluster 39: 382 elements
[INFO] Cluster 40: 14 elements
[INFO] Cluster 41: 61 elements
[INFO] Cluster 42: 52 elements
[INFO] Cluster 43: 197 elements
[INFO] Cluster 44: 185 elements
[INFO] Cluster 45: 43 elements
[INFO] Cluster 46: 111 elements
[INFO] Cluster 47: 26 elements
[INFO] Cluster 48: 88 elements
[INFO] Cluster 49: 5 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=262, Long SMA=266, Sharpe=-0.1695, Trades=63
[INFO] Cluster 1 cluster: Short SMA=86, Long SMA=272, Sharpe=-0.1499, Trades=14
[INFO] Cluster 2 cluster: Short SMA=76, Long SMA=84, Sharpe=-0.1610, Trades=65
[INFO] Cluster 3 cluster: Short SMA=128, Long SMA=268, Sharpe=-0.1675, Trades=12
[INFO] Cluster 4 cluster: Short SMA=92, Long SMA=170, Sharpe=-0.0282, Trades=20
[INFO] Cluster 5 cluster: Short SMA=132, Long SMA=164, Sharpe=0.0928, Trades=30
[INFO] Cluster 6 cluster: Short SMA=50, Long SMA=88, Sharpe=-0.2277, Trades=31
[INFO] Cluster 7 cluster: Short SMA=252, Long SMA=282, Sharpe=-0.2094, Trades=18
[INFO] Cluster 8 cluster: Short SMA=30, Long SMA=48, Sharpe=0.1090, Trades=67
[INFO] Cluster 9 cluster: Short SMA=52, Long SMA=162, Sharpe=-0.1956, Trades=19
[INFO] Cluster 10 cluster: Short SMA=154, Long SMA=224, Sharpe=-0.2839, Trades=14
[INFO] Cluster 11 cluster: Short SMA=20, Long SMA=36, Sharpe=-0.0670, Trades=98
[INFO] Cluster 12 cluster: Short SMA=80, Long SMA=230, Sharpe=-0.2074, Trades=14
[INFO] Cluster 13 cluster: Short SMA=128, Long SMA=230, Sharpe=0.0421, Trades=12
[INFO] Cluster 14 cluster: Short SMA=28, Long SMA=34, Sharpe=0.2304, Trades=133
[INFO] Cluster 15 cluster: Short SMA=52, Long SMA=194, Sharpe=-0.0596, Trades=16
[INFO] Cluster 16 cluster: Short SMA=218, Long SMA=240, Sharpe=-0.5426, Trades=23
[INFO] Cluster 17 cluster: Short SMA=222, Long SMA=228, Sharpe=-0.4206, Trades=57
[INFO] Cluster 18 cluster: Short SMA=52, Long SMA=276, Sharpe=-0.0219, Trades=12
[INFO] Cluster 19 cluster: Short SMA=130, Long SMA=188, Sharpe=0.3046, Trades=18
[INFO] Cluster 20 cluster: Short SMA=16, Long SMA=168, Sharpe=0.1633, Trades=23
[INFO] Cluster 21 cluster: Short SMA=144, Long SMA=150, Sharpe=0.1853, Trades=58
[INFO] Cluster 22 cluster: Short SMA=170, Long SMA=270, Sharpe=-0.5718, Trades=10
[INFO] Cluster 23 cluster: Short SMA=58, Long SMA=106, Sharpe=-0.3253, Trades=27
[INFO] Cluster 24 cluster: Short SMA=156, Long SMA=158, Sharpe=0.1727, Trades=108
[INFO] Cluster 25 cluster: Short SMA=184, Long SMA=280, Sharpe=-0.3625, Trades=10
[INFO] Cluster 26 cluster: Short SMA=280, Long SMA=294, Sharpe=0.3256, Trades=36
[INFO] Cluster 27 cluster: Short SMA=36, Long SMA=138, Sharpe=-0.1726, Trades=23
[INFO] Cluster 28 cluster: Short SMA=80, Long SMA=82, Sharpe=-0.1646, Trades=104
[INFO] Cluster 29 cluster: Short SMA=20, Long SMA=92, Sharpe=-0.0617, Trades=35
[INFO] Cluster 30 cluster: Short SMA=20, Long SMA=62, Sharpe=0.1458, Trades=47
[INFO] Cluster 31 cluster: Short SMA=220, Long SMA=222, Sharpe=-0.3192, Trades=101
[INFO] Cluster 32 cluster: Short SMA=216, Long SMA=276, Sharpe=-0.4864, Trades=12
[INFO] Cluster 33 cluster: Short SMA=120, Long SMA=200, Sharpe=0.3609, Trades=14
[INFO] Cluster 34 cluster: Short SMA=20, Long SMA=212, Sharpe=-0.0288, Trades=22
[INFO] Cluster 35 cluster: Short SMA=178, Long SMA=232, Sharpe=-0.4548, Trades=18
[INFO] Cluster 37 cluster: Short SMA=40, Long SMA=232, Sharpe=-0.2079, Trades=14
[INFO] Cluster 38 cluster: Short SMA=98, Long SMA=136, Sharpe=-0.0613, Trades=28
[INFO] Cluster 39 cluster: Short SMA=22, Long SMA=268, Sharpe=0.0411, Trades=12
[INFO] Cluster 41 cluster: Short SMA=164, Long SMA=178, Sharpe=0.0198, Trades=44
[INFO] Cluster 42 cluster: Short SMA=116, Long SMA=124, Sharpe=-0.1825, Trades=50
[INFO] Cluster 43 cluster: Short SMA=62, Long SMA=128, Sharpe=-0.1781, Trades=26
[INFO] Cluster 44 cluster: Short SMA=112, Long SMA=226, Sharpe=0.1580, Trades=12
[INFO] Cluster 45 cluster: Short SMA=192, Long SMA=198, Sharpe=-0.3255, Trades=60
[INFO] Cluster 46 cluster: Short SMA=20, Long SMA=120, Sharpe=-0.0086, Trades=27
[INFO] Cluster 47 cluster: Short SMA=28, Long SMA=32, Sharpe=-0.0104, Trades=170
[INFO] Cluster 48 cluster: Short SMA=202, Long SMA=216, Sharpe=-0.4229, Trades=38
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=134, Long SMA=138, Sharpe=0.5321, Trades=69
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=120, Long SMA=200, Sharpe=0.3609, Trades=14
[INFO] Top 2: Short SMA=280, Long SMA=294, Sharpe=0.3256, Trades=36
[INFO] Top 3: Short SMA=130, Long SMA=188, Sharpe=0.3046, Trades=18
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10405 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 134, Long SMA: 138
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(120/200) - Original Sharpe: 0.3609, Trades: 14
[INFO] Hierarchical cluster 2: SMA(280/294) - Original Sharpe: 0.3256, Trades: 36
[INFO] Hierarchical cluster 3: SMA(130/188) - Original Sharpe: 0.3046, Trades: 18
[INFO] Hierarchical cluster 4: SMA(28/34) - Original Sharpe: 0.2304, Trades: 133
[INFO] Hierarchical cluster 5: SMA(144/150) - Original Sharpe: 0.1853, Trades: 58
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (134/138)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (120/200) - Sharpe: 0.3609
[INFO] cluster 2: (280/294) - Sharpe: 0.3256
[INFO] cluster 3: (130/188) - Sharpe: 0.3046
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.716042           -1.716042
1    2021-11-14 2021-11-14            43    -1.188262           -2.566552
2    2022-01-14 2022-01-14            41    -0.404804            1.652075
3    2022-03-14 2022-03-14            44    -3.078018           -1.466536
4    2022-05-14 2022-05-14            43    -1.026268           -1.026268
5    2022-07-14 2022-07-14            44     2.174461            2.174461
6    2022-09-14 2022-09-14            43     2.833979            2.833979
7    2022-11-14 2022-11-14            43     2.673356            2.849639
8    2023-01-14 2023-01-14            41     0.249214            0.249214
9    2023-03-14 2023-03-14            44     4.663682            4.663682
10   2023-05-14 2023-05-14            44     3.615384            3.615384
11   2023-07-14 2023-07-14            44    -0.398216           -0.398216
12   2023-09-14 2023-09-14            43    -1.304784           -1.304784
13   2023-11-14 2023-11-14            42     3.397164            3.397164
14   2024-01-14 2024-01-14            43    -3.986215            2.512948
15   2024-03-14 2024-03-14            42    -0.165280           -0.165280
16   2024-05-14 2024-05-14            44    -1.994953           -1.994953
17   2024-07-14 2024-07-14            45    -0.809966           -4.455653
18   2024-09-14 2024-09-14            43     2.955873            1.717531
19   2024-11-14 2024-11-14            33     0.878530            2.038273
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.2 |             -2.6 |         -1.4 | False         
[INFO] 2022-01-14   |         -0.4 |              1.7 |          2.1 | True          
[INFO] 2022-03-14   |         -3.1 |             -1.5 |          1.6 | True          
[INFO] 2022-05-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.7 |              2.8 |          0.1 | True          
[INFO] 2023-01-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          4.7 |              4.7 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -4.0 |              2.5 |          6.5 | True          
[INFO] 2024-03-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.8 |             -4.5 |         -3.7 | False         
[INFO] 2024-09-14   |          3.0 |              1.7 |         -1.3 | False         
[INFO] 2024-11-14   |          0.9 |              2.0 |          1.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-03-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 8 periods (62.50% win rate)
[INFO] Updating Excel file with Hierarchical results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Hierarchical win rate 62.5% in row 34
[INFO] Added best Sharpe parameters 134/138 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 134, Long SMA: 138
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(120/200) - Original Sharpe: 0.3609
[INFO] Added cluster 2 to portfolio: SMA(280/294) - Original Sharpe: 0.3256
[INFO] Added cluster 3 to portfolio: SMA(130/188) - Original Sharpe: 0.3046
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MP1_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3829
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1651
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MP1
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NE1 in column D: 9.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 64
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 72.25s
[INFO] Best parameters: Short SMA = 158, Long SMA = 288
[INFO] Best Sharpe ratio: 0.601145, Trades: 14
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NE1
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.80 contracts
[INFO] Maximum Position Size: 16 contracts
[INFO] Strategy Total P&L: $355,980.00
[INFO] Market Buy & Hold P&L: $-19,895.00
[INFO] Outperformance: $375,875.00
[INFO] Sharpe ratio (entire period, annualized): 0.489962
[INFO] Sharpe ratio (in-sample, annualized): 0.601145
[INFO] Sharpe ratio (out-of-sample, annualized): 0.226030
[INFO] Maximum Drawdown: $99,250.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 9
[INFO] Out-of-sample period trades: 5
[INFO] Total trades: 14
[INFO] In-sample P&L: $307,448.00
[INFO] Out-of-sample P&L: $48,722.00
[INFO] 
Best parameters from GA: Short SMA = 158, Long SMA = 288, Sharpe = 0.601145
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8463 to 0.6011
[INFO] 
Best parameters:
[INFO] Short SMA: 158
[INFO] Long SMA: 288
[INFO] Sharpe Ratio: 0.601145
[INFO] Number of Trades: 14
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8463 to 0.6011
[INFO] Trades range: 12.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8285 to 2.8656
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 274 elements
[INFO] Kmeans Cluster 1: 258 elements
[INFO] Kmeans Cluster 2: 67 elements
[INFO] Kmeans Cluster 3: 201 elements
[INFO] Kmeans Cluster 4: 269 elements
[INFO] Kmeans Cluster 5: 199 elements
[INFO] Kmeans Cluster 6: 242 elements
[INFO] Kmeans Cluster 7: 202 elements
[INFO] Kmeans Cluster 8: 220 elements
[INFO] Kmeans Cluster 9: 203 elements
[INFO] Kmeans Cluster 10: 159 elements
[INFO] Kmeans Cluster 11: 237 elements
[INFO] Kmeans Cluster 12: 191 elements
[INFO] Kmeans Cluster 13: 201 elements
[INFO] Kmeans Cluster 14: 187 elements
[INFO] Kmeans Cluster 15: 226 elements
[INFO] Kmeans Cluster 16: 193 elements
[INFO] Kmeans Cluster 17: 242 elements
[INFO] Kmeans Cluster 18: 195 elements
[INFO] Kmeans Cluster 19: 213 elements
[INFO] Kmeans Cluster 20: 161 elements
[INFO] Kmeans Cluster 21: 238 elements
[INFO] Kmeans Cluster 22: 208 elements
[INFO] Kmeans Cluster 23: 175 elements
[INFO] Kmeans Cluster 24: 229 elements
[INFO] Kmeans Cluster 25: 237 elements
[INFO] Kmeans Cluster 26: 174 elements
[INFO] Kmeans Cluster 27: 237 elements
[INFO] Kmeans Cluster 28: 246 elements
[INFO] Kmeans Cluster 29: 307 elements
[INFO] Kmeans Cluster 30: 283 elements
[INFO] Kmeans Cluster 31: 307 elements
[INFO] Kmeans Cluster 32: 350 elements
[INFO] Kmeans Cluster 33: 255 elements
[INFO] Kmeans Cluster 34: 198 elements
[INFO] Kmeans Cluster 35: 222 elements
[INFO] Kmeans Cluster 36: 254 elements
[INFO] Kmeans Cluster 37: 168 elements
[INFO] Kmeans Cluster 38: 181 elements
[INFO] Kmeans Cluster 39: 192 elements
[INFO] Kmeans Cluster 40: 63 elements
[INFO] Kmeans Cluster 41: 223 elements
[INFO] Kmeans Cluster 42: 92 elements
[INFO] Kmeans Cluster 43: 236 elements
[INFO] Kmeans Cluster 44: 168 elements
[INFO] Kmeans Cluster 45: 209 elements
[INFO] Kmeans Cluster 46: 109 elements
[INFO] Kmeans Cluster 47: 220 elements
[INFO] Kmeans Cluster 48: 228 elements
[INFO] Kmeans Cluster 49: 236 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=71.08, Long SMA=175.50, Sharpe=-0.6543
[INFO] Centroid 1: Short SMA=96.21, Long SMA=260.74, Sharpe=-0.0561
[INFO] Centroid 2: Short SMA=20.27, Long SMA=40.75, Sharpe=-0.2337
[INFO] Centroid 3: Short SMA=271.00, Long SMA=288.87, Sharpe=0.2659
[INFO] Centroid 4: Short SMA=190.09, Long SMA=218.27, Sharpe=-0.1612
[INFO] Centroid 5: Short SMA=173.07, Long SMA=197.18, Sharpe=-0.0102
[INFO] Centroid 6: Short SMA=127.45, Long SMA=287.00, Sharpe=0.2351
[INFO] Centroid 7: Short SMA=70.75, Long SMA=93.75, Sharpe=-0.3810
[INFO] Centroid 8: Short SMA=46.63, Long SMA=233.91, Sharpe=-0.3148
[INFO] Centroid 9: Short SMA=45.46, Long SMA=156.66, Sharpe=-0.4592
[INFO] Centroid 10: Short SMA=20.30, Long SMA=226.89, Sharpe=-0.1413
[INFO] Centroid 11: Short SMA=183.21, Long SMA=273.23, Sharpe=0.0952
[INFO] Centroid 12: Short SMA=27.75, Long SMA=92.64, Sharpe=-0.0489
[INFO] Centroid 13: Short SMA=238.93, Long SMA=280.73, Sharpe=0.1339
[INFO] Centroid 14: Short SMA=113.64, Long SMA=144.29, Sharpe=-0.3635
[INFO] Centroid 15: Short SMA=24.20, Long SMA=121.73, Sharpe=-0.1512
[INFO] Centroid 16: Short SMA=25.90, Long SMA=289.50, Sharpe=0.1617
[INFO] Centroid 17: Short SMA=205.44, Long SMA=281.52, Sharpe=-0.0513
[INFO] Centroid 18: Short SMA=30.33, Long SMA=63.98, Sharpe=0.0803
[INFO] Centroid 19: Short SMA=60.03, Long SMA=220.61, Sharpe=-0.4601
[INFO] Centroid 20: Short SMA=19.17, Long SMA=167.29, Sharpe=-0.2389
[INFO] Centroid 21: Short SMA=149.71, Long SMA=279.15, Sharpe=0.3472
[INFO] Centroid 22: Short SMA=46.21, Long SMA=88.41, Sharpe=-0.2007
[INFO] Centroid 23: Short SMA=218.02, Long SMA=237.87, Sharpe=-0.3110
[INFO] Centroid 24: Short SMA=98.18, Long SMA=122.53, Sharpe=-0.2483
[INFO] Centroid 25: Short SMA=131.18, Long SMA=247.56, Sharpe=0.1608
[INFO] Centroid 26: Short SMA=48.75, Long SMA=257.40, Sharpe=-0.1400
[INFO] Centroid 27: Short SMA=95.69, Long SMA=285.94, Sharpe=0.0952
[INFO] Centroid 28: Short SMA=23.14, Long SMA=260.84, Sharpe=-0.0016
[INFO] Centroid 29: Short SMA=60.12, Long SMA=281.64, Sharpe=0.0542
[INFO] Centroid 30: Short SMA=94.70, Long SMA=195.80, Sharpe=-0.4301
[INFO] Centroid 31: Short SMA=90.28, Long SMA=235.41, Sharpe=-0.2531
[INFO] Centroid 32: Short SMA=139.73, Long SMA=227.21, Sharpe=0.0068
[INFO] Centroid 33: Short SMA=136.60, Long SMA=171.64, Sharpe=-0.0296
[INFO] Centroid 34: Short SMA=119.01, Long SMA=201.60, Sharpe=-0.1662
[INFO] Centroid 35: Short SMA=85.78, Long SMA=157.59, Sharpe=-0.5161
[INFO] Centroid 36: Short SMA=43.02, Long SMA=196.97, Sharpe=-0.5428
[INFO] Centroid 37: Short SMA=151.60, Long SMA=196.48, Sharpe=-0.1468
[INFO] Centroid 38: Short SMA=169.83, Long SMA=269.01, Sharpe=0.2248
[INFO] Centroid 39: Short SMA=217.43, Long SMA=256.19, Sharpe=-0.1858
[INFO] Centroid 40: Short SMA=31.78, Long SMA=45.62, Sharpe=0.2355
[INFO] Centroid 41: Short SMA=119.61, Long SMA=156.53, Sharpe=-0.2228
[INFO] Centroid 42: Short SMA=161.89, Long SMA=175.15, Sharpe=0.1861
[INFO] Centroid 43: Short SMA=181.39, Long SMA=238.02, Sharpe=-0.0370
[INFO] Centroid 44: Short SMA=24.89, Long SMA=47.48, Sharpe=-0.0494
[INFO] Centroid 45: Short SMA=34.64, Long SMA=129.67, Sharpe=-0.2913
[INFO] Centroid 46: Short SMA=77.89, Long SMA=93.16, Sharpe=-0.5319
[INFO] Centroid 47: Short SMA=32.02, Long SMA=184.85, Sharpe=-0.3769
[INFO] Centroid 48: Short SMA=67.59, Long SMA=128.67, Sharpe=-0.4176
[INFO] Centroid 49: Short SMA=244.62, Long SMA=276.74, Sharpe=0.3484
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=158, Long SMA=288, Sharpe=0.6011, Trades=14
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=272, Long SMA=288, Sharpe=0.3702, Trades=24
[INFO] Kmeans Top 2: Short SMA=244, Long SMA=276, Sharpe=0.3684, Trades=20
[INFO] Kmeans Top 3: Short SMA=150, Long SMA=280, Sharpe=0.3054, Trades=16
[INFO] Kmeans Top 4: Short SMA=170, Long SMA=268, Sharpe=0.2703, Trades=16
[INFO] Kmeans Top 5: Short SMA=126, Long SMA=288, Sharpe=0.2107, Trades=18
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (71, 176)
[INFO]   Nearest: (72.0, 176.0)
[INFO]   Rounded: (96, 261)
[INFO]   Nearest: (96.0, 260.0)
[INFO]   Rounded: (20, 41)
[INFO]   Nearest: (20.0, 40.0)
[INFO]   Rounded: (271, 289)
[INFO]   Nearest: (270.0, 288.0)
[INFO]   Rounded: (190, 218)
[INFO]   Rounded: (173, 197)
[INFO]   Nearest: (174.0, 198.0)
[INFO]   Rounded: (127, 287)
[INFO]   Nearest: (128.0, 286.0)
[INFO]   Rounded: (71, 94)
[INFO]   Nearest: (70.0, 94.0)
[INFO]   Rounded: (47, 234)
[INFO]   Nearest: (46.0, 234.0)
[INFO]   Rounded: (45, 157)
[INFO]   Nearest: (46.0, 156.0)
[INFO]   Rounded: (20, 227)
[INFO]   Nearest: (20.0, 226.0)
[INFO]   Rounded: (183, 273)
[INFO]   Nearest: (184.0, 274.0)
[INFO]   Rounded: (28, 93)
[INFO]   Nearest: (28.0, 92.0)
[INFO]   Rounded: (239, 281)
[INFO]   Nearest: (238.0, 280.0)
[INFO]   Rounded: (114, 144)
[INFO]   Rounded: (24, 122)
[INFO]   Rounded: (26, 290)
[INFO]   Rounded: (205, 282)
[INFO]   Nearest: (206.0, 282.0)
[INFO]   Rounded: (30, 64)
[INFO]   Rounded: (60, 221)
[INFO]   Nearest: (60.0, 220.0)
[INFO]   Rounded: (19, 167)
[INFO]   Nearest: (20.0, 168.0)
[INFO]   Rounded: (150, 279)
[INFO]   Nearest: (150.0, 280.0)
[INFO]   Rounded: (46, 88)
[INFO]   Rounded: (218, 238)
[INFO]   Rounded: (98, 123)
[INFO]   Nearest: (98.0, 122.0)
[INFO]   Rounded: (131, 248)
[INFO]   Nearest: (132.0, 248.0)
[INFO]   Rounded: (49, 257)
[INFO]   Nearest: (48.0, 258.0)
[INFO]   Rounded: (96, 286)
[INFO]   Rounded: (23, 261)
[INFO]   Nearest: (24.0, 260.0)
[INFO]   Rounded: (60, 282)
[INFO]   Rounded: (95, 196)
[INFO]   Nearest: (94.0, 196.0)
[INFO]   Rounded: (90, 235)
[INFO]   Nearest: (90.0, 236.0)
[INFO]   Rounded: (140, 227)
[INFO]   Nearest: (140.0, 228.0)
[INFO]   Rounded: (137, 172)
[INFO]   Nearest: (136.0, 172.0)
[INFO]   Rounded: (119, 202)
[INFO]   Nearest: (120.0, 202.0)
[INFO]   Rounded: (86, 158)
[INFO]   Rounded: (43, 197)
[INFO]   Nearest: (44.0, 196.0)
[INFO]   Rounded: (152, 196)
[INFO]   Rounded: (170, 269)
[INFO]   Nearest: (170.0, 270.0)
[INFO]   Rounded: (217, 256)
[INFO]   Nearest: (218.0, 256.0)
[INFO]   Rounded: (32, 46)
[INFO]   Rounded: (120, 157)
[INFO]   Nearest: (120.0, 156.0)
[INFO]   Rounded: (162, 175)
[INFO]   Nearest: (162.0, 176.0)
[INFO]   Rounded: (181, 238)
[INFO]   Nearest: (182.0, 238.0)
[INFO]   Rounded: (25, 47)
[INFO]   Nearest: (24.0, 48.0)
[INFO]   Rounded: (35, 130)
[INFO]   Nearest: (34.0, 130.0)
[INFO]   Rounded: (78, 93)
[INFO]   Nearest: (78.0, 94.0)
[INFO]   Rounded: (32, 185)
[INFO]   Nearest: (32.0, 184.0)
[INFO]   Rounded: (68, 129)
[INFO]   Nearest: (68.0, 128.0)
[INFO]   Rounded: (245, 277)
[INFO]   Nearest: (244.0, 276.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 158, Long SMA: 288
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 64
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(272/288) - Original Sharpe: 0.3702, Trades: 24
[INFO] Kmeans cluster 2: SMA(244/276) - Original Sharpe: 0.3684, Trades: 20
[INFO] Kmeans cluster 3: SMA(150/280) - Original Sharpe: 0.3054, Trades: 16
[INFO] Kmeans cluster 4: SMA(170/268) - Original Sharpe: 0.2703, Trades: 16
[INFO] Kmeans cluster 5: SMA(126/288) - Original Sharpe: 0.2107, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (158/288)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (272/288) - Sharpe: 0.3702
[INFO] cluster 2: (244/276) - Sharpe: 0.3684
[INFO] cluster 3: (150/280) - Sharpe: 0.3054
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.711854           -0.711854
1    2021-11-14 2021-11-14            43    -2.704530           -3.410821
2    2022-01-14 2022-01-14            41     0.749001            0.749001
3    2022-03-14 2022-03-14            44     3.657765            3.657765
4    2022-05-14 2022-05-14            43     1.252080            1.252080
5    2022-07-14 2022-07-14            44     0.795112            0.795112
6    2022-09-14 2022-09-14            43    -0.063770           -0.063770
7    2022-11-14 2022-11-14            43    -1.653258           -1.653258
8    2023-01-14 2023-01-14            41     1.658465            1.658465
9    2023-03-14 2023-03-14            44     0.152591            0.152591
10   2023-05-14 2023-05-14            44     4.106633           -2.087496
11   2023-07-14 2023-07-14            44    -5.609635            4.959210
12   2023-09-14 2023-09-14            43     2.029860           -0.449464
13   2023-11-14 2023-11-14            42    -3.851886            0.057989
14   2024-01-14 2024-01-14            43     0.911910            0.911910
15   2024-03-14 2024-03-14            42     1.804454            1.804454
16   2024-05-14 2024-05-14            44    -3.279202           -2.301413
17   2024-07-14 2024-07-14            45     0.210954            0.850085
18   2024-09-14 2024-09-14            43    -0.935269           -2.631803
19   2024-11-14 2024-11-14            33     3.782667            3.685213
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -2.7 |             -3.4 |         -0.7 | False         
[INFO] 2022-01-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-05-14   |          4.1 |             -2.1 |         -6.2 | False         
[INFO] 2023-07-14   |         -5.6 |              5.0 |         10.6 | True          
[INFO] 2023-09-14   |          2.0 |             -0.4 |         -2.4 | False         
[INFO] 2023-11-14   |         -3.9 |              0.1 |          4.0 | True          
[INFO] 2024-01-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -3.3 |             -2.3 |          1.0 | True          
[INFO] 2024-07-14   |          0.2 |              0.9 |          0.7 | True          
[INFO] 2024-09-14   |         -0.9 |             -2.6 |         -1.7 | False         
[INFO] 2024-11-14   |          3.8 |              3.7 |         -0.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-03-14, 2024-01-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 4 of 9 periods (44.44% win rate)
[INFO] Updating Excel file with Kmeans results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Kmeans win rate 44.4% in row 35
[INFO] Added best Sharpe parameters 158/288 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 158, Long SMA: 288
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(272/288) - Original Sharpe: 0.3702
[INFO] Added cluster 2 to portfolio: SMA(244/276) - Original Sharpe: 0.3684
[INFO] Added cluster 3 to portfolio: SMA(150/280) - Original Sharpe: 0.3054
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NE1_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3217
[INFO] Kmeans Best out-of-sample Sharpe: 0.2260
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NE1
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8463 to 0.6011
[INFO] 
Best parameters:
[INFO] Short SMA: 158
[INFO] Long SMA: 288
[INFO] Sharpe Ratio: 0.601145
[INFO] Number of Trades: 14
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8463 to 0.6011
[INFO] Trades range: 12.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8285 to 2.8656
[INFO] Scaled Trades range: -0.7866 to 14.7605
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5460
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 467 elements
[INFO] Cluster 1: 43 elements
[INFO] Cluster 2: 310 elements
[INFO] Cluster 3: 67 elements
[INFO] Cluster 4: 252 elements
[INFO] Cluster 5: 56 elements
[INFO] Cluster 6: 323 elements
[INFO] Cluster 7: 283 elements
[INFO] Cluster 8: 348 elements
[INFO] Cluster 9: 191 elements
[INFO] Cluster 10: 461 elements
[INFO] Cluster 11: 487 elements
[INFO] Cluster 12: 314 elements
[INFO] Cluster 13: 15 elements
[INFO] Cluster 14: 183 elements
[INFO] Cluster 15: 327 elements
[INFO] Cluster 16: 113 elements
[INFO] Cluster 17: 107 elements
[INFO] Cluster 18: 222 elements
[INFO] Cluster 19: 115 elements
[INFO] Cluster 20: 240 elements
[INFO] Cluster 21: 341 elements
[INFO] Cluster 22: 413 elements
[INFO] Cluster 23: 302 elements
[INFO] Cluster 24: 64 elements
[INFO] Cluster 25: 356 elements
[INFO] Cluster 26: 28 elements
[INFO] Cluster 27: 84 elements
[INFO] Cluster 28: 413 elements
[INFO] Cluster 29: 350 elements
[INFO] Cluster 30: 138 elements
[INFO] Cluster 31: 226 elements
[INFO] Cluster 32: 62 elements
[INFO] Cluster 33: 258 elements
[INFO] Cluster 34: 202 elements
[INFO] Cluster 35: 14 elements
[INFO] Cluster 36: 318 elements
[INFO] Cluster 37: 278 elements
[INFO] Cluster 38: 199 elements
[INFO] Cluster 39: 102 elements
[INFO] Cluster 40: 233 elements
[INFO] Cluster 41: 127 elements
[INFO] Cluster 42: 248 elements
[INFO] Cluster 43: 93 elements
[INFO] Cluster 44: 196 elements
[INFO] Cluster 45: 162 elements
[INFO] Cluster 46: 28 elements
[INFO] Cluster 47: 53 elements
[INFO] Cluster 48: 223 elements
[INFO] Cluster 49: 150 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=126, Long SMA=192, Sharpe=-0.1636, Trades=18
[INFO] Cluster 1 cluster: Short SMA=200, Long SMA=202, Sharpe=-0.0337, Trades=69
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=244, Sharpe=-0.0711, Trades=26
[INFO] Cluster 3 cluster: Short SMA=32, Long SMA=42, Sharpe=-0.2025, Trades=102
[INFO] Cluster 4 cluster: Short SMA=26, Long SMA=76, Sharpe=0.1000, Trades=48
[INFO] Cluster 5 cluster: Short SMA=110, Long SMA=114, Sharpe=-0.2692, Trades=83
[INFO] Cluster 6 cluster: Short SMA=204, Long SMA=264, Sharpe=-0.0757, Trades=18
[INFO] Cluster 7 cluster: Short SMA=172, Long SMA=262, Sharpe=0.1926, Trades=16
[INFO] Cluster 8 cluster: Short SMA=28, Long SMA=282, Sharpe=0.0269, Trades=28
[INFO] Cluster 9 cluster: Short SMA=248, Long SMA=288, Sharpe=0.1881, Trades=20
[INFO] Cluster 10 cluster: Short SMA=130, Long SMA=274, Sharpe=0.2175, Trades=20
[INFO] Cluster 11 cluster: Short SMA=148, Long SMA=228, Sharpe=0.0607, Trades=18
[INFO] Cluster 12 cluster: Short SMA=104, Long SMA=262, Sharpe=-0.0873, Trades=18
[INFO] Cluster 14 cluster: Short SMA=24, Long SMA=56, Sharpe=-0.0537, Trades=60
[INFO] Cluster 15 cluster: Short SMA=34, Long SMA=172, Sharpe=-0.3605, Trades=26
[INFO] Cluster 16 cluster: Short SMA=78, Long SMA=92, Sharpe=-0.3570, Trades=58
[INFO] Cluster 17 cluster: Short SMA=212, Long SMA=220, Sharpe=-0.2441, Trades=36
[INFO] Cluster 18 cluster: Short SMA=138, Long SMA=168, Sharpe=0.0148, Trades=22
[INFO] Cluster 19 cluster: Short SMA=266, Long SMA=274, Sharpe=0.2905, Trades=38
[INFO] Cluster 20 cluster: Short SMA=220, Long SMA=246, Sharpe=-0.1058, Trades=22
[INFO] Cluster 21 cluster: Short SMA=90, Long SMA=236, Sharpe=-0.2423, Trades=20
[INFO] Cluster 22 cluster: Short SMA=64, Long SMA=138, Sharpe=-0.4574, Trades=24
[INFO] Cluster 23 cluster: Short SMA=56, Long SMA=228, Sharpe=-0.3097, Trades=22
[INFO] Cluster 24 cluster: Short SMA=24, Long SMA=32, Sharpe=-0.1606, Trades=126
[INFO] Cluster 25 cluster: Short SMA=70, Long SMA=180, Sharpe=-0.6340, Trades=20
[INFO] Cluster 26 cluster: Short SMA=28, Long SMA=32, Sharpe=-0.2422, Trades=176
[INFO] Cluster 27 cluster: Short SMA=178, Long SMA=186, Sharpe=0.0666, Trades=37
[INFO] Cluster 28 cluster: Short SMA=76, Long SMA=286, Sharpe=0.0801, Trades=16
[INFO] Cluster 29 cluster: Short SMA=110, Long SMA=138, Sharpe=-0.1897, Trades=24
[INFO] Cluster 30 cluster: Short SMA=16, Long SMA=244, Sharpe=-0.0428, Trades=40
[INFO] Cluster 31 cluster: Short SMA=40, Long SMA=128, Sharpe=-0.2669, Trades=32
[INFO] Cluster 32 cluster: Short SMA=24, Long SMA=42, Sharpe=-0.0099, Trades=88
[INFO] Cluster 33 cluster: Short SMA=36, Long SMA=202, Sharpe=-0.5968, Trades=26
[INFO] Cluster 34 cluster: Short SMA=182, Long SMA=220, Sharpe=-0.1044, Trades=20
[INFO] Cluster 36 cluster: Short SMA=246, Long SMA=280, Sharpe=0.3562, Trades=20
[INFO] Cluster 37 cluster: Short SMA=28, Long SMA=112, Sharpe=-0.1281, Trades=36
[INFO] Cluster 38 cluster: Short SMA=154, Long SMA=282, Sharpe=0.3631, Trades=14
[INFO] Cluster 39 cluster: Short SMA=70, Long SMA=102, Sharpe=-0.3718, Trades=36
[INFO] Cluster 40 cluster: Short SMA=188, Long SMA=288, Sharpe=-0.0384, Trades=14
[INFO] Cluster 41 cluster: Short SMA=14, Long SMA=168, Sharpe=-0.2926, Trades=38
[INFO] Cluster 42 cluster: Short SMA=94, Long SMA=200, Sharpe=-0.3686, Trades=20
[INFO] Cluster 43 cluster: Short SMA=104, Long SMA=116, Sharpe=-0.1970, Trades=49
[INFO] Cluster 44 cluster: Short SMA=46, Long SMA=88, Sharpe=-0.3323, Trades=38
[INFO] Cluster 45 cluster: Short SMA=170, Long SMA=198, Sharpe=-0.0971, Trades=19
[INFO] Cluster 46 cluster: Short SMA=270, Long SMA=272, Sharpe=0.1828, Trades=66
[INFO] Cluster 47 cluster: Short SMA=166, Long SMA=176, Sharpe=0.2642, Trades=31
[INFO] Cluster 48 cluster: Short SMA=94, Long SMA=162, Sharpe=-0.4856, Trades=20
[INFO] Cluster 49 cluster: Short SMA=66, Long SMA=262, Sharpe=-0.0878, Trades=18
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=158, Long SMA=288, Sharpe=0.6011, Trades=14
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=154, Long SMA=282, Sharpe=0.3631, Trades=14
[INFO] Top 2: Short SMA=246, Long SMA=280, Sharpe=0.3562, Trades=20
[INFO] Top 3: Short SMA=266, Long SMA=274, Sharpe=0.2905, Trades=38
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10556 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 158, Long SMA: 288
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 64
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(154/282) - Original Sharpe: 0.3631, Trades: 14
[INFO] Hierarchical cluster 2: SMA(246/280) - Original Sharpe: 0.3562, Trades: 20
[INFO] Hierarchical cluster 3: SMA(266/274) - Original Sharpe: 0.2905, Trades: 38
[INFO] Hierarchical cluster 4: SMA(166/176) - Original Sharpe: 0.2642, Trades: 31
[INFO] Hierarchical cluster 5: SMA(130/274) - Original Sharpe: 0.2175, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (158/288)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (154/282) - Sharpe: 0.3631
[INFO] cluster 2: (246/280) - Sharpe: 0.3562
[INFO] cluster 3: (266/274) - Sharpe: 0.2905
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.711854           -0.711854
1    2021-11-14 2021-11-14            43    -2.704530           -3.462553
2    2022-01-14 2022-01-14            41     0.749001            0.749001
3    2022-03-14 2022-03-14            44     3.657765            3.657765
4    2022-05-14 2022-05-14            43     1.252080            1.252080
5    2022-07-14 2022-07-14            44     0.795112            0.795112
6    2022-09-14 2022-09-14            43    -0.063770           -0.063770
7    2022-11-14 2022-11-14            43    -1.653258           -1.653258
8    2023-01-14 2023-01-14            41     1.658465            1.658465
9    2023-03-14 2023-03-14            44     0.152591            0.152591
10   2023-05-14 2023-05-14            44     4.106633           -2.613112
11   2023-07-14 2023-07-14            44    -5.609635            6.092190
12   2023-09-14 2023-09-14            43     2.029860           -0.081770
13   2023-11-14 2023-11-14            42    -3.851886           -0.188831
14   2024-01-14 2024-01-14            43     0.911910            0.911910
15   2024-03-14 2024-03-14            42     1.804454            1.804454
16   2024-05-14 2024-05-14            44    -3.279202           -2.858681
17   2024-07-14 2024-07-14            45     0.210954            0.556488
18   2024-09-14 2024-09-14            43    -0.935269           -2.537509
19   2024-11-14 2024-11-14            33     3.782667            3.542820
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -2.7 |             -3.5 |         -0.8 | False         
[INFO] 2022-01-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-05-14   |          4.1 |             -2.6 |         -6.7 | False         
[INFO] 2023-07-14   |         -5.6 |              6.1 |         11.7 | True          
[INFO] 2023-09-14   |          2.0 |             -0.1 |         -2.1 | False         
[INFO] 2023-11-14   |         -3.9 |             -0.2 |          3.7 | True          
[INFO] 2024-01-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -3.3 |             -2.9 |          0.4 | True          
[INFO] 2024-07-14   |          0.2 |              0.6 |          0.4 | True          
[INFO] 2024-09-14   |         -0.9 |             -2.5 |         -1.6 | False         
[INFO] 2024-11-14   |          3.8 |              3.5 |         -0.3 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-03-14, 2024-01-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 9 periods (44.44% win rate)
[INFO] Updating Excel file with Hierarchical results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Hierarchical win rate 44.4% in row 35
[INFO] Added best Sharpe parameters 158/288 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 158, Long SMA: 288
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(154/282) - Original Sharpe: 0.3631
[INFO] Added cluster 2 to portfolio: SMA(246/280) - Original Sharpe: 0.3562
[INFO] Added cluster 3 to portfolio: SMA(266/274) - Original Sharpe: 0.2905
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NE1_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3074
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2260
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NE1
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NG in column D: 15.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.68s
[INFO] Best parameters: Short SMA = 38, Long SMA = 96
[INFO] Best Sharpe ratio: 0.840516, Trades: 34
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 2104 bad combos; keeping 1962 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NG
[INFO] Big Point Value (from data): 10000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.73 contracts
[INFO] Maximum Position Size: 13 contracts
[INFO] Strategy Total P&L: $311,555.00
[INFO] Market Buy & Hold P&L: $-82,800.00
[INFO] Outperformance: $394,355.00
[INFO] Sharpe ratio (entire period, annualized): 0.431735
[INFO] Sharpe ratio (in-sample, annualized): 0.840516
[INFO] Sharpe ratio (out-of-sample, annualized): -0.397004
[INFO] Maximum Drawdown: $168,255.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 22
[INFO] Out-of-sample period trades: 12
[INFO] Total trades: 34
[INFO] In-sample P&L: $479,775.00
[INFO] Out-of-sample P&L: $-111,340.00
[INFO] 
Best parameters from GA: Short SMA = 38, Long SMA = 96, Sharpe = 0.840516
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5760 to 0.8405
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 96
[INFO] Sharpe Ratio: 0.840516
[INFO] Number of Trades: 34
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8481 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5760 to 0.8405
[INFO] Trades range: 10.0 to 351.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2490 to 2.7470
[INFO] Scaled Long SMA range: -2.6028 to 1.6263
[INFO] Scaled Sharpe ratio range: -2.8606 to 1.8769
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 260 elements
[INFO] Kmeans Cluster 1: 163 elements
[INFO] Kmeans Cluster 2: 197 elements
[INFO] Kmeans Cluster 3: 213 elements
[INFO] Kmeans Cluster 4: 226 elements
[INFO] Kmeans Cluster 5: 137 elements
[INFO] Kmeans Cluster 6: 139 elements
[INFO] Kmeans Cluster 7: 124 elements
[INFO] Kmeans Cluster 8: 192 elements
[INFO] Kmeans Cluster 9: 129 elements
[INFO] Kmeans Cluster 10: 182 elements
[INFO] Kmeans Cluster 11: 169 elements
[INFO] Kmeans Cluster 12: 266 elements
[INFO] Kmeans Cluster 13: 88 elements
[INFO] Kmeans Cluster 14: 161 elements
[INFO] Kmeans Cluster 15: 293 elements
[INFO] Kmeans Cluster 16: 150 elements
[INFO] Kmeans Cluster 17: 205 elements
[INFO] Kmeans Cluster 18: 278 elements
[INFO] Kmeans Cluster 19: 115 elements
[INFO] Kmeans Cluster 20: 204 elements
[INFO] Kmeans Cluster 21: 142 elements
[INFO] Kmeans Cluster 22: 108 elements
[INFO] Kmeans Cluster 23: 186 elements
[INFO] Kmeans Cluster 24: 132 elements
[INFO] Kmeans Cluster 25: 200 elements
[INFO] Kmeans Cluster 26: 212 elements
[INFO] Kmeans Cluster 27: 178 elements
[INFO] Kmeans Cluster 28: 135 elements
[INFO] Kmeans Cluster 29: 168 elements
[INFO] Kmeans Cluster 30: 186 elements
[INFO] Kmeans Cluster 31: 182 elements
[INFO] Kmeans Cluster 32: 79 elements
[INFO] Kmeans Cluster 33: 72 elements
[INFO] Kmeans Cluster 34: 193 elements
[INFO] Kmeans Cluster 35: 265 elements
[INFO] Kmeans Cluster 36: 124 elements
[INFO] Kmeans Cluster 37: 230 elements
[INFO] Kmeans Cluster 38: 63 elements
[INFO] Kmeans Cluster 39: 107 elements
[INFO] Kmeans Cluster 40: 267 elements
[INFO] Kmeans Cluster 41: 188 elements
[INFO] Kmeans Cluster 42: 177 elements
[INFO] Kmeans Cluster 43: 149 elements
[INFO] Kmeans Cluster 44: 207 elements
[INFO] Kmeans Cluster 45: 191 elements
[INFO] Kmeans Cluster 46: 119 elements
[INFO] Kmeans Cluster 47: 131 elements
[INFO] Kmeans Cluster 48: 43 elements
[INFO] Kmeans Cluster 49: 156 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=45.58, Long SMA=250.02, Sharpe=0.6037
[INFO] Centroid 1: Short SMA=170.17, Long SMA=190.48, Sharpe=-0.1301
[INFO] Centroid 2: Short SMA=140.72, Long SMA=162.58, Sharpe=0.3832
[INFO] Centroid 3: Short SMA=47.98, Long SMA=70.86, Sharpe=0.5639
[INFO] Centroid 4: Short SMA=78.34, Long SMA=207.86, Sharpe=0.3458
[INFO] Centroid 5: Short SMA=266.61, Long SMA=291.56, Sharpe=-0.3980
[INFO] Centroid 6: Short SMA=24.60, Long SMA=63.66, Sharpe=0.1367
[INFO] Centroid 7: Short SMA=119.15, Long SMA=239.87, Sharpe=0.1015
[INFO] Centroid 8: Short SMA=106.26, Long SMA=162.48, Sharpe=0.5677
[INFO] Centroid 9: Short SMA=15.30, Long SMA=250.81, Sharpe=0.2871
[INFO] Centroid 10: Short SMA=22.99, Long SMA=144.85, Sharpe=0.3303
[INFO] Centroid 11: Short SMA=212.52, Long SMA=241.31, Sharpe=-0.1332
[INFO] Centroid 12: Short SMA=50.72, Long SMA=134.83, Sharpe=0.5614
[INFO] Centroid 13: Short SMA=234.11, Long SMA=247.27, Sharpe=0.1176
[INFO] Centroid 14: Short SMA=244.30, Long SMA=267.09, Sharpe=-0.0850
[INFO] Centroid 15: Short SMA=43.49, Long SMA=203.61, Sharpe=0.6534
[INFO] Centroid 16: Short SMA=38.65, Long SMA=291.67, Sharpe=0.3145
[INFO] Centroid 17: Short SMA=102.41, Long SMA=222.17, Sharpe=0.3183
[INFO] Centroid 18: Short SMA=104.95, Long SMA=133.58, Sharpe=0.4428
[INFO] Centroid 19: Short SMA=15.72, Long SMA=172.68, Sharpe=0.2027
[INFO] Centroid 20: Short SMA=81.92, Long SMA=112.20, Sharpe=0.6293
[INFO] Centroid 21: Short SMA=121.00, Long SMA=133.49, Sharpe=0.2109
[INFO] Centroid 22: Short SMA=26.91, Long SMA=226.59, Sharpe=0.4431
[INFO] Centroid 23: Short SMA=212.76, Long SMA=272.23, Sharpe=-0.2488
[INFO] Centroid 24: Short SMA=19.77, Long SMA=43.05, Sharpe=-0.0420
[INFO] Centroid 25: Short SMA=133.74, Long SMA=258.85, Sharpe=0.2196
[INFO] Centroid 26: Short SMA=158.95, Long SMA=201.63, Sharpe=0.0456
[INFO] Centroid 27: Short SMA=160.03, Long SMA=283.88, Sharpe=0.0550
[INFO] Centroid 28: Short SMA=18.73, Long SMA=118.10, Sharpe=0.1821
[INFO] Centroid 29: Short SMA=222.01, Long SMA=290.43, Sharpe=-0.4121
[INFO] Centroid 30: Short SMA=71.70, Long SMA=177.96, Sharpe=0.6524
[INFO] Centroid 31: Short SMA=51.00, Long SMA=78.92, Sharpe=0.3608
[INFO] Centroid 32: Short SMA=19.06, Long SMA=33.57, Sharpe=-0.2349
[INFO] Centroid 33: Short SMA=18.03, Long SMA=291.42, Sharpe=0.1376
[INFO] Centroid 34: Short SMA=68.09, Long SMA=230.69, Sharpe=0.4361
[INFO] Centroid 35: Short SMA=43.05, Long SMA=168.51, Sharpe=0.5415
[INFO] Centroid 36: Short SMA=143.84, Long SMA=182.11, Sharpe=0.1790
[INFO] Centroid 37: Short SMA=76.04, Long SMA=149.11, Sharpe=0.6921
[INFO] Centroid 38: Short SMA=214.76, Long SMA=230.48, Sharpe=-0.3706
[INFO] Centroid 39: Short SMA=192.99, Long SMA=218.64, Sharpe=0.3071
[INFO] Centroid 40: Short SMA=117.83, Long SMA=192.98, Sharpe=0.2924
[INFO] Centroid 41: Short SMA=63.88, Long SMA=101.21, Sharpe=0.4937
[INFO] Centroid 42: Short SMA=30.32, Long SMA=270.44, Sharpe=0.4523
[INFO] Centroid 43: Short SMA=42.78, Long SMA=105.88, Sharpe=0.6804
[INFO] Centroid 44: Short SMA=188.60, Long SMA=215.96, Sharpe=0.1470
[INFO] Centroid 45: Short SMA=261.64, Long SMA=282.53, Sharpe=-0.2480
[INFO] Centroid 46: Short SMA=94.66, Long SMA=184.89, Sharpe=0.4415
[INFO] Centroid 47: Short SMA=17.65, Long SMA=93.27, Sharpe=-0.0467
[INFO] Centroid 48: Short SMA=96.84, Long SMA=291.49, Sharpe=0.2222
[INFO] Centroid 49: Short SMA=17.38, Long SMA=205.90, Sharpe=0.2677
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=96, Sharpe=0.8405, Trades=34
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=42, Long SMA=106, Sharpe=0.7471, Trades=31
[INFO] Kmeans Top 2: Short SMA=76, Long SMA=150, Sharpe=0.7179, Trades=17
[INFO] Kmeans Top 3: Short SMA=44, Long SMA=204, Sharpe=0.6502, Trades=14
[INFO] Kmeans Top 4: Short SMA=48, Long SMA=70, Sharpe=0.6220, Trades=47
[INFO] Kmeans Top 5: Short SMA=46, Long SMA=250, Sharpe=0.6180, Trades=10
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (46, 250)
[INFO]   Rounded: (170, 190)
[INFO]   Rounded: (141, 163)
[INFO]   Nearest: (140.0, 162.0)
[INFO]   Rounded: (48, 71)
[INFO]   Nearest: (48.0, 70.0)
[INFO]   Rounded: (78, 208)
[INFO]   Rounded: (267, 292)
[INFO]   Nearest: (266.0, 292.0)
[INFO]   Rounded: (25, 64)
[INFO]   Nearest: (24.0, 64.0)
[INFO]   Rounded: (119, 240)
[INFO]   Nearest: (120.0, 240.0)
[INFO]   Rounded: (106, 162)
[INFO]   Rounded: (15, 251)
[INFO]   Nearest: (16.0, 250.0)
[INFO]   Rounded: (23, 145)
[INFO]   Nearest: (22.0, 144.0)
[INFO]   Rounded: (213, 241)
[INFO]   Nearest: (212.0, 242.0)
[INFO]   Rounded: (51, 135)
[INFO]   Nearest: (50.0, 134.0)
[INFO]   Rounded: (234, 247)
[INFO]   Nearest: (234.0, 248.0)
[INFO]   Rounded: (244, 267)
[INFO]   Nearest: (244.0, 268.0)
[INFO]   Rounded: (43, 204)
[INFO]   Nearest: (44.0, 204.0)
[INFO]   Rounded: (39, 292)
[INFO]   Nearest: (38.0, 292.0)
[INFO]   Rounded: (102, 222)
[INFO]   Rounded: (105, 134)
[INFO]   Nearest: (104.0, 134.0)
[INFO]   Rounded: (16, 173)
[INFO]   Nearest: (16.0, 172.0)
[INFO]   Rounded: (82, 112)
[INFO]   Rounded: (121, 133)
[INFO]   Nearest: (120.0, 134.0)
[INFO]   Rounded: (27, 227)
[INFO]   Nearest: (26.0, 226.0)
[INFO]   Rounded: (213, 272)
[INFO]   Nearest: (212.0, 272.0)
[INFO]   Rounded: (20, 43)
[INFO]   Nearest: (20.0, 44.0)
[INFO]   Rounded: (134, 259)
[INFO]   Nearest: (134.0, 258.0)
[INFO]   Rounded: (159, 202)
[INFO]   Nearest: (158.0, 202.0)
[INFO]   Rounded: (160, 284)
[INFO]   Rounded: (19, 118)
[INFO]   Nearest: (18.0, 118.0)
[INFO]   Rounded: (222, 290)
[INFO]   Rounded: (72, 178)
[INFO]   Rounded: (51, 79)
[INFO]   Nearest: (50.0, 78.0)
[INFO]   Rounded: (19, 34)
[INFO]   Nearest: (20.0, 34.0)
[INFO]   Rounded: (18, 291)
[INFO]   Nearest: (18.0, 292.0)
[INFO]   Rounded: (68, 231)
[INFO]   Nearest: (68.0, 230.0)
[INFO]   Rounded: (43, 169)
[INFO]   Nearest: (44.0, 168.0)
[INFO]   Rounded: (144, 182)
[INFO]   Rounded: (76, 149)
[INFO]   Nearest: (76.0, 150.0)
[INFO]   Rounded: (215, 230)
[INFO]   Nearest: (214.0, 230.0)
[INFO]   Rounded: (193, 219)
[INFO]   Nearest: (192.0, 218.0)
[INFO]   Rounded: (118, 193)
[INFO]   Nearest: (118.0, 192.0)
[INFO]   Rounded: (64, 101)
[INFO]   Nearest: (64.0, 102.0)
[INFO]   Rounded: (30, 270)
[INFO]   Rounded: (43, 106)
[INFO]   Nearest: (42.0, 106.0)
[INFO]   Rounded: (189, 216)
[INFO]   Nearest: (188.0, 216.0)
[INFO]   Rounded: (262, 283)
[INFO]   Nearest: (262.0, 282.0)
[INFO]   Rounded: (95, 185)
[INFO]   Nearest: (94.0, 184.0)
[INFO]   Rounded: (18, 93)
[INFO]   Nearest: (18.0, 94.0)
[INFO]   Rounded: (97, 291)
[INFO]   Nearest: (96.0, 292.0)
[INFO]   Rounded: (17, 206)
[INFO]   Nearest: (18.0, 206.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 96
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(42/106) - Original Sharpe: 0.7471, Trades: 31
[INFO] Kmeans cluster 2: SMA(76/150) - Original Sharpe: 0.7179, Trades: 17
[INFO] Kmeans cluster 3: SMA(44/204) - Original Sharpe: 0.6502, Trades: 14
[INFO] Kmeans cluster 4: SMA(48/70) - Original Sharpe: 0.6220, Trades: 47
[INFO] Kmeans cluster 5: SMA(46/250) - Original Sharpe: 0.6180, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/96)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (42/106) - Sharpe: 0.7471
[INFO] cluster 2: (76/150) - Sharpe: 0.7179
[INFO] cluster 3: (44/204) - Sharpe: 0.6502
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.445674           -0.445674
1    2021-11-14 2021-11-14            43    -2.014680           -1.721909
2    2022-01-14 2022-01-14            41    -2.486703           -2.897352
3    2022-03-14 2022-03-14            44     3.957702            1.464056
4    2022-05-14 2022-05-14            43    -0.023760           -0.023760
5    2022-07-14 2022-07-14            44    -1.042803           -0.210108
6    2022-09-14 2022-09-14            43    -2.178995           -3.765982
7    2022-11-14 2022-11-14            43     3.472189            3.472189
8    2023-01-14 2023-01-14            41     1.369071            1.369071
9    2023-03-14 2023-03-14            43     2.324517            2.324517
10   2023-05-14 2023-05-14            44    -0.121506           -0.121506
11   2023-07-14 2023-07-14            44    -0.937897           -0.256242
12   2023-09-14 2023-09-14            43    -3.674779           -0.204970
13   2023-11-14 2023-11-14            42    -5.314334           -3.493336
14   2024-01-14 2024-01-14            43     5.971629            5.971629
15   2024-03-14 2024-03-14            42    -1.552883           -1.552883
16   2024-05-14 2024-05-14            44    -1.549107           -1.589507
17   2024-07-14 2024-07-14            45    -1.110970           -0.427497
18   2024-09-14 2024-09-14            43     0.410531            0.410531
19   2024-11-14 2024-11-14            33    -3.830386           -2.575162
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -2.0 |             -1.7 |          0.3 | True          
[INFO] 2022-01-14   |         -2.5 |             -2.9 |         -0.4 | False         
[INFO] 2022-03-14   |          4.0 |              1.5 |         -2.5 | False         
[INFO] 2022-05-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |             -0.2 |          0.8 | True          
[INFO] 2022-09-14   |         -2.2 |             -3.8 |         -1.6 | False         
[INFO] 2022-11-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.9 |             -0.3 |          0.6 | True          
[INFO] 2023-09-14   |         -3.7 |             -0.2 |          3.5 | True          
[INFO] 2023-11-14   |         -5.3 |             -3.5 |          1.8 | True          
[INFO] 2024-01-14   |          6.0 |              6.0 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -1.5 |             -1.6 |         -0.1 | False         
[INFO] 2024-07-14   |         -1.1 |             -0.4 |          0.7 | True          
[INFO] 2024-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -3.8 |             -2.6 |          1.2 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2022-11-14, 2023-01-14, 2023-03-14, 2023-05-14, 2024-01-14, 2024-03-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Kmeans cluster wins (rounded comparison): 7 of 11 periods (63.64% win rate)
[INFO] Updating Excel file with Kmeans results for NG...
[INFO] Excel file updated successfully. Added NG with Kmeans win rate 63.6% in row 36
[INFO] Added best Sharpe parameters 38/96 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 96
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(42/106) - Original Sharpe: 0.7471
[INFO] Added cluster 2 to portfolio: SMA(76/150) - Original Sharpe: 0.7179
[INFO] Added cluster 3 to portfolio: SMA(44/204) - Original Sharpe: 0.6502
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NG_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.2014
[INFO] Kmeans Best out-of-sample Sharpe: -0.3970
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NG...
[INFO] Excel file updated successfully. Added NG with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NG
[INFO] Big Point Value: 10000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5760 to 0.8405
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 96
[INFO] Sharpe Ratio: 0.840516
[INFO] Number of Trades: 34
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8481 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5760 to 0.8405
[INFO] Trades range: 10.0 to 351.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2490 to 2.7470
[INFO] Scaled Long SMA range: -2.6028 to 1.6263
[INFO] Scaled Sharpe ratio range: -2.8606 to 1.8769
[INFO] Scaled Trades range: -0.6507 to 13.6551
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8481 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5908
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 258 elements
[INFO] Cluster 1: 295 elements
[INFO] Cluster 2: 308 elements
[INFO] Cluster 3: 452 elements
[INFO] Cluster 4: 370 elements
[INFO] Cluster 5: 10 elements
[INFO] Cluster 6: 313 elements
[INFO] Cluster 7: 65 elements
[INFO] Cluster 8: 263 elements
[INFO] Cluster 9: 58 elements
[INFO] Cluster 10: 195 elements
[INFO] Cluster 11: 267 elements
[INFO] Cluster 12: 349 elements
[INFO] Cluster 13: 294 elements
[INFO] Cluster 14: 147 elements
[INFO] Cluster 15: 61 elements
[INFO] Cluster 16: 225 elements
[INFO] Cluster 17: 231 elements
[INFO] Cluster 18: 196 elements
[INFO] Cluster 19: 120 elements
[INFO] Cluster 20: 116 elements
[INFO] Cluster 21: 16 elements
[INFO] Cluster 22: 106 elements
[INFO] Cluster 23: 276 elements
[INFO] Cluster 24: 124 elements
[INFO] Cluster 25: 302 elements
[INFO] Cluster 26: 36 elements
[INFO] Cluster 27: 160 elements
[INFO] Cluster 28: 155 elements
[INFO] Cluster 29: 176 elements
[INFO] Cluster 30: 154 elements
[INFO] Cluster 31: 62 elements
[INFO] Cluster 32: 123 elements
[INFO] Cluster 33: 77 elements
[INFO] Cluster 34: 150 elements
[INFO] Cluster 35: 33 elements
[INFO] Cluster 36: 262 elements
[INFO] Cluster 37: 227 elements
[INFO] Cluster 38: 144 elements
[INFO] Cluster 39: 203 elements
[INFO] Cluster 40: 220 elements
[INFO] Cluster 41: 65 elements
[INFO] Cluster 42: 225 elements
[INFO] Cluster 43: 131 elements
[INFO] Cluster 44: 195 elements
[INFO] Cluster 45: 69 elements
[INFO] Cluster 46: 70 elements
[INFO] Cluster 47: 85 elements
[INFO] Cluster 48: 9 elements
[INFO] Cluster 49: 33 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=190, Long SMA=218, Sharpe=0.2471, Trades=12
[INFO] Cluster 1 cluster: Short SMA=224, Long SMA=252, Sharpe=-0.1365, Trades=15
[INFO] Cluster 2 cluster: Short SMA=22, Long SMA=254, Sharpe=0.4397, Trades=17
[INFO] Cluster 3 cluster: Short SMA=110, Long SMA=194, Sharpe=0.3625, Trades=12
[INFO] Cluster 4 cluster: Short SMA=126, Long SMA=254, Sharpe=0.2080, Trades=10
[INFO] Cluster 6 cluster: Short SMA=262, Long SMA=288, Sharpe=-0.4239, Trades=14
[INFO] Cluster 7 cluster: Short SMA=20, Long SMA=30, Sharpe=-0.2355, Trades=124
[INFO] Cluster 8 cluster: Short SMA=20, Long SMA=158, Sharpe=0.2497, Trades=29
[INFO] Cluster 9 cluster: Short SMA=180, Long SMA=184, Sharpe=-0.3609, Trades=48
[INFO] Cluster 10 cluster: Short SMA=34, Long SMA=84, Sharpe=0.4163, Trades=42
[INFO] Cluster 11 cluster: Short SMA=98, Long SMA=172, Sharpe=0.6215, Trades=14
[INFO] Cluster 12 cluster: Short SMA=46, Long SMA=170, Sharpe=0.5767, Trades=21
[INFO] Cluster 13 cluster: Short SMA=44, Long SMA=208, Sharpe=0.7493, Trades=14
[INFO] Cluster 14 cluster: Short SMA=144, Long SMA=180, Sharpe=0.1691, Trades=16
[INFO] Cluster 15 cluster: Short SMA=58, Long SMA=64, Sharpe=0.5052, Trades=85
[INFO] Cluster 16 cluster: Short SMA=74, Long SMA=106, Sharpe=0.4397, Trades=36
[INFO] Cluster 17 cluster: Short SMA=104, Long SMA=138, Sharpe=0.4873, Trades=26
[INFO] Cluster 18 cluster: Short SMA=18, Long SMA=210, Sharpe=0.2980, Trades=23
[INFO] Cluster 19 cluster: Short SMA=20, Long SMA=42, Sharpe=-0.0946, Trades=82
[INFO] Cluster 20 cluster: Short SMA=16, Long SMA=68, Sharpe=0.0125, Trades=60
[INFO] Cluster 22 cluster: Short SMA=122, Long SMA=130, Sharpe=0.4823, Trades=56
[INFO] Cluster 23 cluster: Short SMA=44, Long SMA=254, Sharpe=0.6114, Trades=10
[INFO] Cluster 24 cluster: Short SMA=18, Long SMA=94, Sharpe=0.0059, Trades=52
[INFO] Cluster 25 cluster: Short SMA=68, Long SMA=226, Sharpe=0.3727, Trades=12
[INFO] Cluster 26 cluster: Short SMA=70, Long SMA=72, Sharpe=0.4925, Trades=132
[INFO] Cluster 27 cluster: Short SMA=40, Long SMA=292, Sharpe=0.3298, Trades=12
[INFO] Cluster 28 cluster: Short SMA=134, Long SMA=164, Sharpe=0.4617, Trades=18
[INFO] Cluster 29 cluster: Short SMA=160, Long SMA=284, Sharpe=0.1137, Trades=10
[INFO] Cluster 30 cluster: Short SMA=44, Long SMA=82, Sharpe=0.5643, Trades=39
[INFO] Cluster 31 cluster: Short SMA=260, Long SMA=264, Sharpe=-0.0852, Trades=33
[INFO] Cluster 32 cluster: Short SMA=16, Long SMA=124, Sharpe=0.0803, Trades=44
[INFO] Cluster 33 cluster: Short SMA=236, Long SMA=248, Sharpe=0.3461, Trades=25
[INFO] Cluster 34 cluster: Short SMA=166, Long SMA=192, Sharpe=-0.0887, Trades=16
[INFO] Cluster 35 cluster: Short SMA=132, Long SMA=134, Sharpe=0.1703, Trades=108
[INFO] Cluster 36 cluster: Short SMA=74, Long SMA=132, Sharpe=0.6321, Trades=23
[INFO] Cluster 37 cluster: Short SMA=74, Long SMA=164, Sharpe=0.5918, Trades=18
[INFO] Cluster 38 cluster: Short SMA=222, Long SMA=290, Sharpe=-0.4451, Trades=10
[INFO] Cluster 39 cluster: Short SMA=158, Long SMA=208, Sharpe=0.0484, Trades=10
[INFO] Cluster 40 cluster: Short SMA=216, Long SMA=272, Sharpe=-0.3105, Trades=10
[INFO] Cluster 41 cluster: Short SMA=214, Long SMA=230, Sharpe=-0.4203, Trades=19
[INFO] Cluster 42 cluster: Short SMA=98, Long SMA=222, Sharpe=0.3392, Trades=12
[INFO] Cluster 43 cluster: Short SMA=42, Long SMA=108, Sharpe=0.7129, Trades=31
[INFO] Cluster 44 cluster: Short SMA=50, Long SMA=130, Sharpe=0.5197, Trades=25
[INFO] Cluster 45 cluster: Short SMA=148, Long SMA=160, Sharpe=0.4499, Trades=34
[INFO] Cluster 46 cluster: Short SMA=18, Long SMA=292, Sharpe=0.0897, Trades=16
[INFO] Cluster 47 cluster: Short SMA=50, Long SMA=66, Sharpe=0.4968, Trades=61
[INFO] Cluster 49 cluster: Short SMA=90, Long SMA=98, Sharpe=0.7000, Trades=67
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=96, Sharpe=0.8405, Trades=34
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=44, Long SMA=208, Sharpe=0.7493, Trades=14
[INFO] Top 2: Short SMA=42, Long SMA=108, Sharpe=0.7129, Trades=31
[INFO] Top 3: Short SMA=90, Long SMA=98, Sharpe=0.7000, Trades=67
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 8446 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 96
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(44/208) - Original Sharpe: 0.7493, Trades: 14
[INFO] Hierarchical cluster 2: SMA(42/108) - Original Sharpe: 0.7129, Trades: 31
[INFO] Hierarchical cluster 3: SMA(90/98) - Original Sharpe: 0.7000, Trades: 67
[INFO] Hierarchical cluster 4: SMA(74/132) - Original Sharpe: 0.6321, Trades: 23
[INFO] Hierarchical cluster 5: SMA(98/172) - Original Sharpe: 0.6215, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/96)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (44/208) - Sharpe: 0.7493
[INFO] cluster 2: (42/108) - Sharpe: 0.7129
[INFO] cluster 3: (90/98) - Sharpe: 0.7000
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.445674           -0.445674
1    2021-11-14 2021-11-14            43    -2.014680           -0.597213
2    2022-01-14 2022-01-14            41    -2.486703           -2.112319
3    2022-03-14 2022-03-14            44     3.957702            2.445021
4    2022-05-14 2022-05-14            43    -0.023760           -0.023760
5    2022-07-14 2022-07-14            44    -1.042803            0.422861
6    2022-09-14 2022-09-14            43    -2.178995           -3.295520
7    2022-11-14 2022-11-14            43     3.472189            4.246928
8    2023-01-14 2023-01-14            41     1.369071            1.369071
9    2023-03-14 2023-03-14            43     2.324517            2.324517
10   2023-05-14 2023-05-14            44    -0.121506           -0.121506
11   2023-07-14 2023-07-14            44    -0.937897           -1.074236
12   2023-09-14 2023-09-14            43    -3.674779            0.159552
13   2023-11-14 2023-11-14            42    -5.314334           -2.385422
14   2024-01-14 2024-01-14            43     5.971629            5.971629
15   2024-03-14 2024-03-14            42    -1.552883           -1.552883
16   2024-05-14 2024-05-14            44    -1.549107           -2.928021
17   2024-07-14 2024-07-14            45    -1.110970            0.274758
18   2024-09-14 2024-09-14            43     0.410531            0.410531
19   2024-11-14 2024-11-14            33    -3.830386           -2.165135
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -2.0 |             -0.6 |          1.4 | True          
[INFO] 2022-01-14   |         -2.5 |             -2.1 |          0.4 | True          
[INFO] 2022-03-14   |          4.0 |              2.4 |         -1.6 | False         
[INFO] 2022-05-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |              0.4 |          1.4 | True          
[INFO] 2022-09-14   |         -2.2 |             -3.3 |         -1.1 | False         
[INFO] 2022-11-14   |          3.5 |              4.2 |          0.7 | True          
[INFO] 2023-01-14   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.9 |             -1.1 |         -0.2 | False         
[INFO] 2023-09-14   |         -3.7 |              0.2 |          3.9 | True          
[INFO] 2023-11-14   |         -5.3 |             -2.4 |          2.9 | True          
[INFO] 2024-01-14   |          6.0 |              6.0 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -1.5 |             -2.9 |         -1.4 | False         
[INFO] 2024-07-14   |         -1.1 |              0.3 |          1.4 | True          
[INFO] 2024-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -3.8 |             -2.2 |          1.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2023-01-14, 2023-03-14, 2023-05-14, 2024-01-14, 2024-03-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 12 periods (66.67% win rate)
[INFO] Updating Excel file with Hierarchical results for NG...
[INFO] Excel file updated successfully. Added NG with Hierarchical win rate 66.7% in row 36
[INFO] Added best Sharpe parameters 38/96 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 96
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(44/208) - Original Sharpe: 0.7493
[INFO] Added cluster 2 to portfolio: SMA(42/108) - Original Sharpe: 0.7129
[INFO] Added cluster 3 to portfolio: SMA(90/98) - Original Sharpe: 0.7000
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NG_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0975
[INFO] Hierarchical Best out-of-sample Sharpe: -0.3970
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NG...
[INFO] Excel file updated successfully. Added NG with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NG
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NK in column D: 35.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.80s
[INFO] Best parameters: Short SMA = 20, Long SMA = 22
[INFO] Best Sharpe ratio: 0.860889, Trades: 251
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 168 bad combos; keeping 2104 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NK
[INFO] Big Point Value (from data): 5.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.91 contracts
[INFO] Maximum Position Size: 8 contracts
[INFO] Strategy Total P&L: $555,050.00
[INFO] Market Buy & Hold P&L: $123,500.00
[INFO] Outperformance: $431,550.00
[INFO] Sharpe ratio (entire period, annualized): 0.567140
[INFO] Sharpe ratio (in-sample, annualized): 0.860889
[INFO] Sharpe ratio (out-of-sample, annualized): -0.084305
[INFO] Maximum Drawdown: $146,255.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 175
[INFO] Out-of-sample period trades: 76
[INFO] Total trades: 251
[INFO] In-sample P&L: $540,320.00
[INFO] Out-of-sample P&L: $-23,830.00
[INFO] 
Best parameters from GA: Short SMA = 20, Long SMA = 22, Sharpe = 0.860889
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 5.0
[INFO] Slippage: 35.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6475 to 0.8609
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 22
[INFO] Sharpe Ratio: 0.860889
[INFO] Number of Trades: 251
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10417 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6475 to 0.8609
[INFO] Trades range: 10.0 to 343.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3841 to 2.7941
[INFO] Scaled Long SMA range: -2.7959 to 1.4302
[INFO] Scaled Sharpe ratio range: -3.3641 to 4.1025
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 235 elements
[INFO] Kmeans Cluster 1: 300 elements
[INFO] Kmeans Cluster 2: 208 elements
[INFO] Kmeans Cluster 3: 234 elements
[INFO] Kmeans Cluster 4: 121 elements
[INFO] Kmeans Cluster 5: 260 elements
[INFO] Kmeans Cluster 6: 162 elements
[INFO] Kmeans Cluster 7: 183 elements
[INFO] Kmeans Cluster 8: 180 elements
[INFO] Kmeans Cluster 9: 224 elements
[INFO] Kmeans Cluster 10: 224 elements
[INFO] Kmeans Cluster 11: 201 elements
[INFO] Kmeans Cluster 12: 232 elements
[INFO] Kmeans Cluster 13: 274 elements
[INFO] Kmeans Cluster 14: 350 elements
[INFO] Kmeans Cluster 15: 279 elements
[INFO] Kmeans Cluster 16: 219 elements
[INFO] Kmeans Cluster 17: 180 elements
[INFO] Kmeans Cluster 18: 128 elements
[INFO] Kmeans Cluster 19: 80 elements
[INFO] Kmeans Cluster 20: 162 elements
[INFO] Kmeans Cluster 21: 125 elements
[INFO] Kmeans Cluster 22: 183 elements
[INFO] Kmeans Cluster 23: 196 elements
[INFO] Kmeans Cluster 24: 207 elements
[INFO] Kmeans Cluster 25: 125 elements
[INFO] Kmeans Cluster 26: 297 elements
[INFO] Kmeans Cluster 27: 292 elements
[INFO] Kmeans Cluster 28: 96 elements
[INFO] Kmeans Cluster 29: 224 elements
[INFO] Kmeans Cluster 30: 136 elements
[INFO] Kmeans Cluster 31: 195 elements
[INFO] Kmeans Cluster 32: 247 elements
[INFO] Kmeans Cluster 33: 75 elements
[INFO] Kmeans Cluster 34: 314 elements
[INFO] Kmeans Cluster 35: 138 elements
[INFO] Kmeans Cluster 36: 198 elements
[INFO] Kmeans Cluster 37: 213 elements
[INFO] Kmeans Cluster 38: 330 elements
[INFO] Kmeans Cluster 39: 329 elements
[INFO] Kmeans Cluster 40: 213 elements
[INFO] Kmeans Cluster 41: 292 elements
[INFO] Kmeans Cluster 42: 274 elements
[INFO] Kmeans Cluster 43: 232 elements
[INFO] Kmeans Cluster 44: 201 elements
[INFO] Kmeans Cluster 45: 122 elements
[INFO] Kmeans Cluster 46: 294 elements
[INFO] Kmeans Cluster 47: 299 elements
[INFO] Kmeans Cluster 48: 124 elements
[INFO] Kmeans Cluster 49: 10 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=72.56, Long SMA=264.34, Sharpe=0.1901
[INFO] Centroid 1: Short SMA=129.52, Long SMA=168.70, Sharpe=0.0539
[INFO] Centroid 2: Short SMA=32.50, Long SMA=59.28, Sharpe=-0.0189
[INFO] Centroid 3: Short SMA=70.88, Long SMA=157.55, Sharpe=-0.0528
[INFO] Centroid 4: Short SMA=225.39, Long SMA=251.60, Sharpe=-0.3376
[INFO] Centroid 5: Short SMA=138.03, Long SMA=276.33, Sharpe=0.1283
[INFO] Centroid 6: Short SMA=17.16, Long SMA=105.05, Sharpe=-0.3447
[INFO] Centroid 7: Short SMA=158.56, Long SMA=200.84, Sharpe=0.5774
[INFO] Centroid 8: Short SMA=235.56, Long SMA=273.63, Sharpe=-0.0432
[INFO] Centroid 9: Short SMA=32.61, Long SMA=249.81, Sharpe=0.0156
[INFO] Centroid 10: Short SMA=105.62, Long SMA=237.56, Sharpe=0.3215
[INFO] Centroid 11: Short SMA=55.36, Long SMA=81.98, Sharpe=-0.3002
[INFO] Centroid 12: Short SMA=130.15, Long SMA=250.45, Sharpe=0.2176
[INFO] Centroid 13: Short SMA=197.34, Long SMA=227.82, Sharpe=0.0072
[INFO] Centroid 14: Short SMA=34.87, Long SMA=160.31, Sharpe=-0.1010
[INFO] Centroid 15: Short SMA=74.23, Long SMA=190.77, Sharpe=0.0525
[INFO] Centroid 16: Short SMA=75.46, Long SMA=218.32, Sharpe=0.1589
[INFO] Centroid 17: Short SMA=85.17, Long SMA=128.57, Sharpe=-0.1721
[INFO] Centroid 18: Short SMA=71.33, Long SMA=93.80, Sharpe=-0.4727
[INFO] Centroid 19: Short SMA=268.20, Long SMA=282.03, Sharpe=-0.3297
[INFO] Centroid 20: Short SMA=20.12, Long SMA=182.33, Sharpe=-0.2241
[INFO] Centroid 21: Short SMA=81.10, Long SMA=288.90, Sharpe=0.2496
[INFO] Centroid 22: Short SMA=87.39, Long SMA=118.27, Sharpe=-0.0140
[INFO] Centroid 23: Short SMA=182.64, Long SMA=213.76, Sharpe=0.2021
[INFO] Centroid 24: Short SMA=25.58, Long SMA=56.73, Sharpe=-0.1492
[INFO] Centroid 25: Short SMA=146.02, Long SMA=170.66, Sharpe=0.2015
[INFO] Centroid 26: Short SMA=97.72, Long SMA=181.97, Sharpe=-0.0530
[INFO] Centroid 27: Short SMA=64.53, Long SMA=239.11, Sharpe=0.2761
[INFO] Centroid 28: Short SMA=17.40, Long SMA=289.00, Sharpe=0.3349
[INFO] Centroid 29: Short SMA=219.88, Long SMA=256.90, Sharpe=-0.1759
[INFO] Centroid 30: Short SMA=264.31, Long SMA=282.35, Sharpe=-0.2167
[INFO] Centroid 31: Short SMA=189.10, Long SMA=244.40, Sharpe=0.1509
[INFO] Centroid 32: Short SMA=138.87, Long SMA=222.95, Sharpe=0.3703
[INFO] Centroid 33: Short SMA=21.04, Long SMA=36.80, Sharpe=0.1504
[INFO] Centroid 34: Short SMA=189.92, Long SMA=284.87, Sharpe=-0.1064
[INFO] Centroid 35: Short SMA=63.29, Long SMA=119.51, Sharpe=0.1313
[INFO] Centroid 36: Short SMA=164.65, Long SMA=182.52, Sharpe=0.3698
[INFO] Centroid 37: Short SMA=116.59, Long SMA=207.50, Sharpe=0.2406
[INFO] Centroid 38: Short SMA=110.36, Long SMA=145.46, Sharpe=-0.1073
[INFO] Centroid 39: Short SMA=167.61, Long SMA=258.81, Sharpe=-0.0139
[INFO] Centroid 40: Short SMA=20.56, Long SMA=258.81, Sharpe=0.1784
[INFO] Centroid 41: Short SMA=101.88, Long SMA=279.06, Sharpe=0.1552
[INFO] Centroid 42: Short SMA=41.50, Long SMA=96.38, Sharpe=-0.1728
[INFO] Centroid 43: Short SMA=40.24, Long SMA=200.11, Sharpe=-0.0207
[INFO] Centroid 44: Short SMA=25.34, Long SMA=213.03, Sharpe=-0.1272
[INFO] Centroid 45: Short SMA=263.11, Long SMA=291.61, Sharpe=-0.1094
[INFO] Centroid 46: Short SMA=47.37, Long SMA=283.97, Sharpe=0.0926
[INFO] Centroid 47: Short SMA=38.31, Long SMA=131.51, Sharpe=0.0028
[INFO] Centroid 48: Short SMA=230.06, Long SMA=288.69, Sharpe=0.0768
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=22, Sharpe=0.8609, Trades=251
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=158, Long SMA=202, Sharpe=0.7042, Trades=17
[INFO] Kmeans Top 2: Short SMA=164, Long SMA=180, Sharpe=0.4439, Trades=30
[INFO] Kmeans Top 3: Short SMA=138, Long SMA=224, Sharpe=0.4036, Trades=17
[INFO] Kmeans Top 4: Short SMA=18, Long SMA=290, Sharpe=0.3821, Trades=21
[INFO] Kmeans Top 5: Short SMA=106, Long SMA=238, Sharpe=0.3686, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48}
[INFO]   Rounded: (73, 264)
[INFO]   Nearest: (72.0, 264.0)
[INFO]   Rounded: (130, 169)
[INFO]   Nearest: (130.0, 168.0)
[INFO]   Rounded: (32, 59)
[INFO]   Nearest: (32.0, 60.0)
[INFO]   Rounded: (71, 158)
[INFO]   Nearest: (70.0, 158.0)
[INFO]   Rounded: (225, 252)
[INFO]   Nearest: (226.0, 252.0)
[INFO]   Rounded: (138, 276)
[INFO]   Rounded: (17, 105)
[INFO]   Nearest: (18.0, 106.0)
[INFO]   Rounded: (159, 201)
[INFO]   Nearest: (158.0, 200.0)
[INFO]   Rounded: (236, 274)
[INFO]   Rounded: (33, 250)
[INFO]   Nearest: (32.0, 250.0)
[INFO]   Rounded: (106, 238)
[INFO]   Rounded: (55, 82)
[INFO]   Nearest: (56.0, 82.0)
[INFO]   Rounded: (130, 250)
[INFO]   Rounded: (197, 228)
[INFO]   Nearest: (198.0, 228.0)
[INFO]   Rounded: (35, 160)
[INFO]   Nearest: (34.0, 160.0)
[INFO]   Rounded: (74, 191)
[INFO]   Nearest: (74.0, 190.0)
[INFO]   Rounded: (75, 218)
[INFO]   Nearest: (76.0, 218.0)
[INFO]   Rounded: (85, 129)
[INFO]   Nearest: (86.0, 128.0)
[INFO]   Rounded: (71, 94)
[INFO]   Nearest: (72.0, 94.0)
[INFO]   Rounded: (268, 282)
[INFO]   Rounded: (20, 182)
[INFO]   Rounded: (81, 289)
[INFO]   Nearest: (82.0, 288.0)
[INFO]   Rounded: (87, 118)
[INFO]   Nearest: (88.0, 118.0)
[INFO]   Rounded: (183, 214)
[INFO]   Nearest: (182.0, 214.0)
[INFO]   Rounded: (26, 57)
[INFO]   Nearest: (26.0, 56.0)
[INFO]   Rounded: (146, 171)
[INFO]   Nearest: (146.0, 170.0)
[INFO]   Rounded: (98, 182)
[INFO]   Rounded: (65, 239)
[INFO]   Nearest: (64.0, 240.0)
[INFO]   Rounded: (17, 289)
[INFO]   Nearest: (18.0, 288.0)
[INFO]   Rounded: (220, 257)
[INFO]   Nearest: (220.0, 256.0)
[INFO]   Rounded: (264, 282)
[INFO]   Rounded: (189, 244)
[INFO]   Nearest: (190.0, 244.0)
[INFO]   Rounded: (139, 223)
[INFO]   Nearest: (138.0, 222.0)
[INFO]   Rounded: (21, 37)
[INFO]   Nearest: (22.0, 36.0)
[INFO]   Rounded: (190, 285)
[INFO]   Nearest: (190.0, 284.0)
[INFO]   Rounded: (63, 120)
[INFO]   Nearest: (64.0, 120.0)
[INFO]   Rounded: (165, 183)
[INFO]   Nearest: (164.0, 182.0)
[INFO]   Rounded: (117, 208)
[INFO]   Nearest: (116.0, 208.0)
[INFO]   Rounded: (110, 145)
[INFO]   Nearest: (110.0, 146.0)
[INFO]   Rounded: (168, 259)
[INFO]   Nearest: (168.0, 258.0)
[INFO]   Rounded: (21, 259)
[INFO]   Nearest: (20.0, 258.0)
[INFO]   Rounded: (102, 279)
[INFO]   Nearest: (102.0, 280.0)
[INFO]   Rounded: (41, 96)
[INFO]   Nearest: (42.0, 96.0)
[INFO]   Rounded: (40, 200)
[INFO]   Rounded: (25, 213)
[INFO]   Nearest: (26.0, 214.0)
[INFO]   Rounded: (263, 292)
[INFO]   Nearest: (264.0, 292.0)
[INFO]   Rounded: (47, 284)
[INFO]   Nearest: (48.0, 284.0)
[INFO]   Rounded: (38, 132)
[INFO]   Rounded: (230, 289)
[INFO]   Nearest: (230.0, 288.0)
[INFO] Successfully plotted 49 out of 49 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 22
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(158/202) - Original Sharpe: 0.7042, Trades: 17
[INFO] Kmeans cluster 2: SMA(164/180) - Original Sharpe: 0.4439, Trades: 30
[INFO] Kmeans cluster 3: SMA(138/224) - Original Sharpe: 0.4036, Trades: 17
[INFO] Kmeans cluster 4: SMA(18/290) - Original Sharpe: 0.3821, Trades: 21
[INFO] Kmeans cluster 5: SMA(106/238) - Original Sharpe: 0.3686, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/22)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (158/202) - Sharpe: 0.7042
[INFO] cluster 2: (164/180) - Sharpe: 0.4439
[INFO] cluster 3: (138/224) - Sharpe: 0.4036
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -3.504421           -3.540834
1    2021-11-14 2021-11-14            43    -3.098247            1.101579
2    2022-01-14 2022-01-14            41     1.372559            1.678451
3    2022-03-14 2022-03-14            44    -1.165984            2.213675
4    2022-05-14 2022-05-14            43    -1.900497            0.242755
5    2022-07-14 2022-07-14            44     2.319224           -1.151355
6    2022-09-14 2022-09-14            43     2.556621            5.175426
7    2022-11-14 2022-11-14            43    -0.052453           -3.059292
8    2023-01-14 2023-01-14            41    -4.424461            2.415927
9    2023-03-14 2023-03-14            44     3.997800           -2.071776
10   2023-05-14 2023-05-14            44     3.172571            3.471599
11   2023-07-14 2023-07-14            44     0.164211            0.071497
12   2023-09-14 2023-09-14            43    -0.266138            0.098898
13   2023-11-14 2023-11-14            42     0.656100            3.424369
14   2024-01-14 2024-01-14            43     2.638804            2.638804
15   2024-03-14 2024-03-14            42    -0.568643           -0.255646
16   2024-05-14 2024-05-14            44    -0.714126            2.633261
17   2024-07-14 2024-07-14            45    -1.907394           -2.110069
18   2024-09-14 2024-09-14            43    -1.733867            2.347567
19   2024-11-14 2024-11-14            33     2.409760            0.047730
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -3.5 |             -3.5 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -3.1 |              1.1 |          4.2 | True          
[INFO] 2022-01-14   |          1.4 |              1.7 |          0.3 | True          
[INFO] 2022-03-14   |         -1.2 |              2.2 |          3.4 | True          
[INFO] 2022-05-14   |         -1.9 |              0.2 |          2.1 | True          
[INFO] 2022-07-14   |          2.3 |             -1.2 |         -3.5 | False         
[INFO] 2022-09-14   |          2.6 |              5.2 |          2.6 | True          
[INFO] 2022-11-14   |         -0.1 |             -3.1 |         -3.0 | False         
[INFO] 2023-01-14   |         -4.4 |              2.4 |          6.8 | True          
[INFO] 2023-03-14   |          4.0 |             -2.1 |         -6.1 | False         
[INFO] 2023-05-14   |          3.2 |              3.5 |          0.3 | True          
[INFO] 2023-07-14   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2023-09-14   |         -0.3 |              0.1 |          0.4 | True          
[INFO] 2023-11-14   |          0.7 |              3.4 |          2.7 | True          
[INFO] 2024-01-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.6 |             -0.3 |          0.3 | True          
[INFO] 2024-05-14   |         -0.7 |              2.6 |          3.3 | True          
[INFO] 2024-07-14   |         -1.9 |             -2.1 |         -0.2 | False         
[INFO] 2024-09-14   |         -1.7 |              2.3 |          4.0 | True          
[INFO] 2024-11-14   |          2.4 |              0.0 |         -2.4 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2024-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 12 of 18 periods (66.67% win rate)
[INFO] Updating Excel file with Kmeans results for NK...
[INFO] Excel file updated successfully. Added NK with Kmeans win rate 66.7% in row 37
[INFO] Added best Sharpe parameters 20/22 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 22
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(158/202) - Original Sharpe: 0.7042
[INFO] Added cluster 2 to portfolio: SMA(164/180) - Original Sharpe: 0.4439
[INFO] Added cluster 3 to portfolio: SMA(138/224) - Original Sharpe: 0.4036
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NK_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.7061
[INFO] Kmeans Best out-of-sample Sharpe: -0.0843
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NK...
[INFO] Excel file updated successfully. Added NK with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NK
[INFO] Big Point Value: 5.0
[INFO] Slippage: 35.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6475 to 0.8609
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 22
[INFO] Sharpe Ratio: 0.860889
[INFO] Number of Trades: 251
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10417 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6475 to 0.8609
[INFO] Trades range: 10.0 to 343.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3841 to 2.7941
[INFO] Scaled Long SMA range: -2.7959 to 1.4302
[INFO] Scaled Sharpe ratio range: -3.3641 to 4.1025
[INFO] Scaled Trades range: -0.7787 to 13.9661
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10417 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5252
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 375 elements
[INFO] Cluster 1: 39 elements
[INFO] Cluster 2: 272 elements
[INFO] Cluster 3: 408 elements
[INFO] Cluster 4: 497 elements
[INFO] Cluster 5: 515 elements
[INFO] Cluster 6: 203 elements
[INFO] Cluster 7: 410 elements
[INFO] Cluster 8: 230 elements
[INFO] Cluster 9: 175 elements
[INFO] Cluster 10: 563 elements
[INFO] Cluster 11: 416 elements
[INFO] Cluster 12: 293 elements
[INFO] Cluster 13: 115 elements
[INFO] Cluster 14: 362 elements
[INFO] Cluster 15: 24 elements
[INFO] Cluster 16: 195 elements
[INFO] Cluster 17: 298 elements
[INFO] Cluster 18: 120 elements
[INFO] Cluster 19: 17 elements
[INFO] Cluster 20: 299 elements
[INFO] Cluster 21: 279 elements
[INFO] Cluster 22: 105 elements
[INFO] Cluster 23: 124 elements
[INFO] Cluster 24: 156 elements
[INFO] Cluster 25: 256 elements
[INFO] Cluster 26: 246 elements
[INFO] Cluster 27: 33 elements
[INFO] Cluster 28: 511 elements
[INFO] Cluster 29: 201 elements
[INFO] Cluster 30: 195 elements
[INFO] Cluster 31: 75 elements
[INFO] Cluster 32: 53 elements
[INFO] Cluster 33: 181 elements
[INFO] Cluster 34: 329 elements
[INFO] Cluster 35: 27 elements
[INFO] Cluster 36: 163 elements
[INFO] Cluster 37: 253 elements
[INFO] Cluster 38: 321 elements
[INFO] Cluster 39: 154 elements
[INFO] Cluster 40: 5 elements
[INFO] Cluster 41: 270 elements
[INFO] Cluster 42: 182 elements
[INFO] Cluster 43: 57 elements
[INFO] Cluster 44: 40 elements
[INFO] Cluster 45: 197 elements
[INFO] Cluster 46: 39 elements
[INFO] Cluster 47: 32 elements
[INFO] Cluster 48: 79 elements
[INFO] Cluster 49: 28 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=20, Long SMA=172, Sharpe=-0.2627, Trades=36
[INFO] Cluster 1 cluster: Short SMA=22, Long SMA=28, Sharpe=-0.0432, Trades=150
[INFO] Cluster 2 cluster: Short SMA=58, Long SMA=96, Sharpe=-0.5076, Trades=44
[INFO] Cluster 3 cluster: Short SMA=48, Long SMA=130, Sharpe=-0.0690, Trades=26
[INFO] Cluster 4 cluster: Short SMA=128, Long SMA=266, Sharpe=0.1849, Trades=12
[INFO] Cluster 5 cluster: Short SMA=170, Long SMA=254, Sharpe=-0.0101, Trades=14
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=218, Sharpe=-0.2018, Trades=28
[INFO] Cluster 7 cluster: Short SMA=102, Long SMA=168, Sharpe=-0.0572, Trades=19
[INFO] Cluster 8 cluster: Short SMA=200, Long SMA=220, Sharpe=0.0528, Trades=23
[INFO] Cluster 9 cluster: Short SMA=160, Long SMA=204, Sharpe=0.5506, Trades=19
[INFO] Cluster 10 cluster: Short SMA=62, Long SMA=192, Sharpe=0.0678, Trades=20
[INFO] Cluster 11 cluster: Short SMA=126, Long SMA=232, Sharpe=0.2675, Trades=15
[INFO] Cluster 12 cluster: Short SMA=40, Long SMA=86, Sharpe=-0.2618, Trades=44
[INFO] Cluster 13 cluster: Short SMA=24, Long SMA=46, Sharpe=-0.0243, Trades=78
[INFO] Cluster 14 cluster: Short SMA=190, Long SMA=284, Sharpe=-0.1203, Trades=15
[INFO] Cluster 15 cluster: Short SMA=74, Long SMA=76, Sharpe=-0.4688, Trades=144
[INFO] Cluster 16 cluster: Short SMA=42, Long SMA=106, Sharpe=0.0276, Trades=36
[INFO] Cluster 17 cluster: Short SMA=128, Long SMA=180, Sharpe=0.0283, Trades=23
[INFO] Cluster 18 cluster: Short SMA=254, Long SMA=260, Sharpe=-0.1763, Trades=42
[INFO] Cluster 20 cluster: Short SMA=68, Long SMA=244, Sharpe=0.2308, Trades=12
[INFO] Cluster 21 cluster: Short SMA=20, Long SMA=264, Sharpe=0.2446, Trades=22
[INFO] Cluster 22 cluster: Short SMA=170, Long SMA=178, Sharpe=0.3492, Trades=48
[INFO] Cluster 23 cluster: Short SMA=126, Long SMA=142, Sharpe=0.0521, Trades=45
[INFO] Cluster 24 cluster: Short SMA=154, Long SMA=180, Sharpe=0.2104, Trades=29
[INFO] Cluster 25 cluster: Short SMA=180, Long SMA=224, Sharpe=0.1478, Trades=17
[INFO] Cluster 26 cluster: Short SMA=108, Long SMA=130, Sharpe=-0.1908, Trades=41
[INFO] Cluster 27 cluster: Short SMA=186, Long SMA=188, Sharpe=0.4529, Trades=89
[INFO] Cluster 28 cluster: Short SMA=86, Long SMA=278, Sharpe=0.1857, Trades=13
[INFO] Cluster 29 cluster: Short SMA=214, Long SMA=264, Sharpe=-0.2533, Trades=14
[INFO] Cluster 30 cluster: Short SMA=232, Long SMA=286, Sharpe=0.0997, Trades=13
[INFO] Cluster 31 cluster: Short SMA=44, Long SMA=58, Sharpe=-0.3386, Trades=67
[INFO] Cluster 32 cluster: Short SMA=22, Long SMA=36, Sharpe=-0.0038, Trades=104
[INFO] Cluster 33 cluster: Short SMA=250, Long SMA=280, Sharpe=-0.1648, Trades=19
[INFO] Cluster 34 cluster: Short SMA=50, Long SMA=160, Sharpe=-0.1597, Trades=20
[INFO] Cluster 35 cluster: Short SMA=126, Long SMA=128, Sharpe=-0.1278, Trades=119
[INFO] Cluster 36 cluster: Short SMA=26, Long SMA=64, Sharpe=0.1103, Trades=60
[INFO] Cluster 37 cluster: Short SMA=76, Long SMA=220, Sharpe=0.0850, Trades=18
[INFO] Cluster 38 cluster: Short SMA=48, Long SMA=282, Sharpe=0.0976, Trades=17
[INFO] Cluster 39 cluster: Short SMA=266, Long SMA=284, Sharpe=-0.3492, Trades=23
[INFO] Cluster 41 cluster: Short SMA=116, Long SMA=210, Sharpe=0.2544, Trades=17
[INFO] Cluster 42 cluster: Short SMA=82, Long SMA=136, Sharpe=-0.1311, Trades=24
[INFO] Cluster 43 cluster: Short SMA=16, Long SMA=292, Sharpe=0.3897, Trades=21
[INFO] Cluster 44 cluster: Short SMA=122, Long SMA=128, Sharpe=-0.0894, Trades=73
[INFO] Cluster 45 cluster: Short SMA=34, Long SMA=248, Sharpe=0.0269, Trades=18
[INFO] Cluster 46 cluster: Short SMA=32, Long SMA=42, Sharpe=-0.2041, Trades=107
[INFO] Cluster 47 cluster: Short SMA=264, Long SMA=268, Sharpe=-0.4519, Trades=51
[INFO] Cluster 48 cluster: Short SMA=226, Long SMA=252, Sharpe=-0.3654, Trades=20
[INFO] Cluster 49 cluster: Short SMA=82, Long SMA=88, Sharpe=-0.3371, Trades=76
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=22, Sharpe=0.8609, Trades=251
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=160, Long SMA=204, Sharpe=0.5506, Trades=19
[INFO] Top 2: Short SMA=186, Long SMA=188, Sharpe=0.4529, Trades=89
[INFO] Top 3: Short SMA=16, Long SMA=292, Sharpe=0.3897, Trades=21
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10395 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 22
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(160/204) - Original Sharpe: 0.5506, Trades: 19
[INFO] Hierarchical cluster 2: SMA(186/188) - Original Sharpe: 0.4529, Trades: 89
[INFO] Hierarchical cluster 3: SMA(16/292) - Original Sharpe: 0.3897, Trades: 21
[INFO] Hierarchical cluster 4: SMA(170/178) - Original Sharpe: 0.3492, Trades: 48
[INFO] Hierarchical cluster 5: SMA(126/232) - Original Sharpe: 0.2675, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/22)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (160/204) - Sharpe: 0.5506
[INFO] cluster 2: (186/188) - Sharpe: 0.4529
[INFO] cluster 3: (16/292) - Sharpe: 0.3897
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -3.504421           -1.934701
1    2021-11-14 2021-11-14            43    -3.098247            0.342835
2    2022-01-14 2022-01-14            41     1.372559            3.810394
3    2022-03-14 2022-03-14            44    -1.165984           -5.113138
4    2022-05-14 2022-05-14            43    -1.900497            0.601996
5    2022-07-14 2022-07-14            44     2.319224           -2.997022
6    2022-09-14 2022-09-14            43     2.556621            0.565802
7    2022-11-14 2022-11-14            43    -0.052453           -2.689306
8    2023-01-14 2023-01-14            41    -4.424461            0.136376
9    2023-03-14 2023-03-14            44     3.997800            0.016651
10   2023-05-14 2023-05-14            44     3.172571            1.345870
11   2023-07-14 2023-07-14            44     0.164211            0.071497
12   2023-09-14 2023-09-14            43    -0.266138            0.098898
13   2023-11-14 2023-11-14            42     0.656100            3.424369
14   2024-01-14 2024-01-14            43     2.638804            2.638804
15   2024-03-14 2024-03-14            42    -0.568643           -0.255646
16   2024-05-14 2024-05-14            44    -0.714126            2.633261
17   2024-07-14 2024-07-14            45    -1.907394           -2.110069
18   2024-09-14 2024-09-14            43    -1.733867            2.042672
19   2024-11-14 2024-11-14            33     2.409760            3.221314
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -3.5 |             -1.9 |          1.6 | True          
[INFO] 2021-11-14   |         -3.1 |              0.3 |          3.4 | True          
[INFO] 2022-01-14   |          1.4 |              3.8 |          2.4 | True          
[INFO] 2022-03-14   |         -1.2 |             -5.1 |         -3.9 | False         
[INFO] 2022-05-14   |         -1.9 |              0.6 |          2.5 | True          
[INFO] 2022-07-14   |          2.3 |             -3.0 |         -5.3 | False         
[INFO] 2022-09-14   |          2.6 |              0.6 |         -2.0 | False         
[INFO] 2022-11-14   |         -0.1 |             -2.7 |         -2.6 | False         
[INFO] 2023-01-14   |         -4.4 |              0.1 |          4.5 | True          
[INFO] 2023-03-14   |          4.0 |              0.0 |         -4.0 | False         
[INFO] 2023-05-14   |          3.2 |              1.3 |         -1.9 | False         
[INFO] 2023-07-14   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2023-09-14   |         -0.3 |              0.1 |          0.4 | True          
[INFO] 2023-11-14   |          0.7 |              3.4 |          2.7 | True          
[INFO] 2024-01-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.6 |             -0.3 |          0.3 | True          
[INFO] 2024-05-14   |         -0.7 |              2.6 |          3.3 | True          
[INFO] 2024-07-14   |         -1.9 |             -2.1 |         -0.2 | False         
[INFO] 2024-09-14   |         -1.7 |              2.0 |          3.7 | True          
[INFO] 2024-11-14   |          2.4 |              3.2 |          0.8 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 19 periods (57.89% win rate)
[INFO] Updating Excel file with Hierarchical results for NK...
[INFO] Excel file updated successfully. Added NK with Hierarchical win rate 57.9% in row 37
[INFO] Added best Sharpe parameters 20/22 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 22
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(160/204) - Original Sharpe: 0.5506
[INFO] Added cluster 2 to portfolio: SMA(186/188) - Original Sharpe: 0.4529
[INFO] Added cluster 3 to portfolio: SMA(16/292) - Original Sharpe: 0.3897
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NK_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3793
[INFO] Hierarchical Best out-of-sample Sharpe: -0.0843
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NK...
[INFO] Excel file updated successfully. Added NK with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NK
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NQ in column D: 11.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 69.23s
[INFO] Best parameters: Short SMA = 210, Long SMA = 234
[INFO] Best Sharpe ratio: 1.114521, Trades: 10
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 4095 bad combos; keeping 909 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NQ
[INFO] Big Point Value (from data): 20.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.56 contracts
[INFO] Maximum Position Size: 11 contracts
[INFO] Strategy Total P&L: $690,104.00
[INFO] Market Buy & Hold P&L: $312,105.00
[INFO] Outperformance: $377,999.00
[INFO] Sharpe ratio (entire period, annualized): 0.738582
[INFO] Sharpe ratio (in-sample, annualized): 1.114521
[INFO] Sharpe ratio (out-of-sample, annualized): 0.029416
[INFO] Maximum Drawdown: $205,067.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 6
[INFO] Out-of-sample period trades: 4
[INFO] Total trades: 10
[INFO] In-sample P&L: $742,024.00
[INFO] Out-of-sample P&L: $10,238.00
[INFO] 
Best parameters from GA: Short SMA = 210, Long SMA = 234, Sharpe = 1.114521
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 20.0
[INFO] Slippage: 11.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.2377 to 1.1145
[INFO] 
Best parameters:
[INFO] Short SMA: 210
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.114521
[INFO] Number of Trades: 10
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 6490 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.2377 to 1.1145
[INFO] Trades range: 10.0 to 305.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0679 to 2.6754
[INFO] Scaled Long SMA range: -2.3404 to 1.7698
[INFO] Scaled Sharpe ratio range: -4.0912 to 2.6527
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 187 elements
[INFO] Kmeans Cluster 1: 170 elements
[INFO] Kmeans Cluster 2: 191 elements
[INFO] Kmeans Cluster 3: 85 elements
[INFO] Kmeans Cluster 4: 57 elements
[INFO] Kmeans Cluster 5: 151 elements
[INFO] Kmeans Cluster 6: 85 elements
[INFO] Kmeans Cluster 7: 229 elements
[INFO] Kmeans Cluster 8: 202 elements
[INFO] Kmeans Cluster 9: 168 elements
[INFO] Kmeans Cluster 10: 59 elements
[INFO] Kmeans Cluster 11: 154 elements
[INFO] Kmeans Cluster 12: 216 elements
[INFO] Kmeans Cluster 13: 152 elements
[INFO] Kmeans Cluster 14: 112 elements
[INFO] Kmeans Cluster 15: 156 elements
[INFO] Kmeans Cluster 16: 145 elements
[INFO] Kmeans Cluster 17: 132 elements
[INFO] Kmeans Cluster 18: 133 elements
[INFO] Kmeans Cluster 19: 166 elements
[INFO] Kmeans Cluster 20: 155 elements
[INFO] Kmeans Cluster 21: 155 elements
[INFO] Kmeans Cluster 22: 198 elements
[INFO] Kmeans Cluster 23: 156 elements
[INFO] Kmeans Cluster 24: 127 elements
[INFO] Kmeans Cluster 25: 173 elements
[INFO] Kmeans Cluster 26: 212 elements
[INFO] Kmeans Cluster 27: 86 elements
[INFO] Kmeans Cluster 28: 80 elements
[INFO] Kmeans Cluster 29: 136 elements
[INFO] Kmeans Cluster 30: 104 elements
[INFO] Kmeans Cluster 31: 109 elements
[INFO] Kmeans Cluster 32: 112 elements
[INFO] Kmeans Cluster 33: 37 elements
[INFO] Kmeans Cluster 34: 117 elements
[INFO] Kmeans Cluster 35: 116 elements
[INFO] Kmeans Cluster 36: 64 elements
[INFO] Kmeans Cluster 37: 138 elements
[INFO] Kmeans Cluster 38: 67 elements
[INFO] Kmeans Cluster 39: 106 elements
[INFO] Kmeans Cluster 40: 14 elements
[INFO] Kmeans Cluster 41: 160 elements
[INFO] Kmeans Cluster 42: 170 elements
[INFO] Kmeans Cluster 43: 100 elements
[INFO] Kmeans Cluster 44: 113 elements
[INFO] Kmeans Cluster 45: 82 elements
[INFO] Kmeans Cluster 46: 118 elements
[INFO] Kmeans Cluster 47: 123 elements
[INFO] Kmeans Cluster 48: 98 elements
[INFO] Kmeans Cluster 49: 114 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=57.85, Long SMA=118.92, Sharpe=0.5749
[INFO] Centroid 1: Short SMA=212.75, Long SMA=237.25, Sharpe=0.9849
[INFO] Centroid 2: Short SMA=23.86, Long SMA=253.98, Sharpe=0.5597
[INFO] Centroid 3: Short SMA=63.62, Long SMA=76.24, Sharpe=0.1521
[INFO] Centroid 4: Short SMA=107.16, Long SMA=227.72, Sharpe=0.7857
[INFO] Centroid 5: Short SMA=251.23, Long SMA=268.58, Sharpe=0.7420
[INFO] Centroid 6: Short SMA=150.61, Long SMA=165.91, Sharpe=0.7559
[INFO] Centroid 7: Short SMA=73.47, Long SMA=148.45, Sharpe=0.5350
[INFO] Centroid 8: Short SMA=182.90, Long SMA=201.86, Sharpe=0.6827
[INFO] Centroid 9: Short SMA=22.15, Long SMA=162.12, Sharpe=0.5519
[INFO] Centroid 10: Short SMA=96.68, Long SMA=113.49, Sharpe=0.4107
[INFO] Centroid 11: Short SMA=33.60, Long SMA=78.26, Sharpe=0.2487
[INFO] Centroid 12: Short SMA=229.35, Long SMA=254.08, Sharpe=0.8743
[INFO] Centroid 13: Short SMA=48.91, Long SMA=217.24, Sharpe=0.6271
[INFO] Centroid 14: Short SMA=106.43, Long SMA=130.46, Sharpe=0.7294
[INFO] Centroid 15: Short SMA=30.21, Long SMA=282.06, Sharpe=0.6049
[INFO] Centroid 16: Short SMA=23.41, Long SMA=62.59, Sharpe=0.0721
[INFO] Centroid 17: Short SMA=39.03, Long SMA=156.82, Sharpe=0.6231
[INFO] Centroid 18: Short SMA=61.01, Long SMA=88.42, Sharpe=0.3823
[INFO] Centroid 19: Short SMA=135.90, Long SMA=163.86, Sharpe=0.6582
[INFO] Centroid 20: Short SMA=18.29, Long SMA=194.91, Sharpe=0.5015
[INFO] Centroid 21: Short SMA=108.26, Long SMA=157.77, Sharpe=0.8030
[INFO] Centroid 22: Short SMA=34.66, Long SMA=107.31, Sharpe=0.4848
[INFO] Centroid 23: Short SMA=244.50, Long SMA=285.72, Sharpe=0.8108
[INFO] Centroid 24: Short SMA=199.64, Long SMA=221.20, Sharpe=0.8461
[INFO] Centroid 25: Short SMA=58.81, Long SMA=172.66, Sharpe=0.5068
[INFO] Centroid 26: Short SMA=24.82, Long SMA=224.67, Sharpe=0.5750
[INFO] Centroid 27: Short SMA=276.26, Long SMA=289.02, Sharpe=0.6220
[INFO] Centroid 28: Short SMA=27.40, Long SMA=39.85, Sharpe=0.3163
[INFO] Centroid 29: Short SMA=49.96, Long SMA=195.38, Sharpe=0.5659
[INFO] Centroid 30: Short SMA=129.21, Long SMA=143.71, Sharpe=0.5602
[INFO] Centroid 31: Short SMA=163.17, Long SMA=182.86, Sharpe=0.5786
[INFO] Centroid 32: Short SMA=75.91, Long SMA=92.09, Sharpe=0.2781
[INFO] Centroid 33: Short SMA=29.73, Long SMA=39.03, Sharpe=0.4749
[INFO] Centroid 34: Short SMA=103.33, Long SMA=130.09, Sharpe=0.6266
[INFO] Centroid 35: Short SMA=37.48, Long SMA=285.50, Sharpe=0.6939
[INFO] Centroid 36: Short SMA=13.38, Long SMA=285.94, Sharpe=0.4747
[INFO] Centroid 37: Short SMA=84.68, Long SMA=178.26, Sharpe=0.6022
[INFO] Centroid 38: Short SMA=26.24, Long SMA=50.33, Sharpe=-0.0441
[INFO] Centroid 39: Short SMA=24.92, Long SMA=90.00, Sharpe=0.3648
[INFO] Centroid 41: Short SMA=82.17, Long SMA=120.12, Sharpe=0.5017
[INFO] Centroid 42: Short SMA=20.63, Long SMA=129.35, Sharpe=0.5706
[INFO] Centroid 43: Short SMA=23.60, Long SMA=46.58, Sharpe=0.1658
[INFO] Centroid 44: Short SMA=33.47, Long SMA=186.46, Sharpe=0.6168
[INFO] Centroid 45: Short SMA=272.41, Long SMA=289.95, Sharpe=0.7182
[INFO] Centroid 46: Short SMA=40.49, Long SMA=249.15, Sharpe=0.6546
[INFO] Centroid 47: Short SMA=40.52, Long SMA=134.80, Sharpe=0.6597
[INFO] Centroid 48: Short SMA=99.80, Long SMA=176.94, Sharpe=0.7418
[INFO] Centroid 49: Short SMA=213.88, Long SMA=277.30, Sharpe=0.9051
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=210, Long SMA=234, Sharpe=1.1145, Trades=10
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=212, Long SMA=236, Sharpe=0.9823, Trades=10
[INFO] Kmeans Top 2: Short SMA=230, Long SMA=254, Sharpe=0.9022, Trades=10
[INFO] Kmeans Top 3: Short SMA=218, Long SMA=276, Sharpe=0.8594, Trades=11
[INFO] Kmeans Top 4: Short SMA=246, Long SMA=286, Sharpe=0.8519, Trades=11
[INFO] Kmeans Top 5: Short SMA=200, Long SMA=220, Sharpe=0.8263, Trades=10
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (58, 119)
[INFO]   Nearest: (58.0, 118.0)
[INFO]   Rounded: (213, 237)
[INFO]   Nearest: (212.0, 238.0)
[INFO]   Rounded: (24, 254)
[INFO]   Rounded: (64, 76)
[INFO]   Rounded: (107, 228)
[INFO]   Nearest: (108.0, 228.0)
[INFO]   Rounded: (251, 269)
[INFO]   Nearest: (252.0, 268.0)
[INFO]   Rounded: (151, 166)
[INFO]   Nearest: (150.0, 166.0)
[INFO]   Rounded: (73, 148)
[INFO]   Nearest: (74.0, 148.0)
[INFO]   Rounded: (183, 202)
[INFO]   Nearest: (182.0, 202.0)
[INFO]   Rounded: (22, 162)
[INFO]   Rounded: (97, 113)
[INFO]   Nearest: (96.0, 114.0)
[INFO]   Rounded: (34, 78)
[INFO]   Rounded: (229, 254)
[INFO]   Nearest: (230.0, 254.0)
[INFO]   Rounded: (49, 217)
[INFO]   Nearest: (48.0, 218.0)
[INFO]   Rounded: (106, 130)
[INFO]   Rounded: (30, 282)
[INFO]   Rounded: (23, 63)
[INFO]   Nearest: (24.0, 62.0)
[INFO]   Rounded: (39, 157)
[INFO]   Nearest: (40.0, 156.0)
[INFO]   Rounded: (61, 88)
[INFO]   Nearest: (62.0, 88.0)
[INFO]   Rounded: (136, 164)
[INFO]   Rounded: (18, 195)
[INFO]   Nearest: (18.0, 194.0)
[INFO]   Rounded: (108, 158)
[INFO]   Rounded: (35, 107)
[INFO]   Nearest: (34.0, 108.0)
[INFO]   Rounded: (244, 286)
[INFO]   Rounded: (200, 221)
[INFO]   Nearest: (200.0, 222.0)
[INFO]   Rounded: (59, 173)
[INFO]   Nearest: (58.0, 172.0)
[INFO]   Rounded: (25, 225)
[INFO]   Nearest: (24.0, 224.0)
[INFO]   Rounded: (276, 289)
[INFO]   Nearest: (276.0, 290.0)
[INFO]   Rounded: (27, 40)
[INFO]   Nearest: (28.0, 40.0)
[INFO]   Rounded: (50, 195)
[INFO]   Nearest: (50.0, 196.0)
[INFO]   Rounded: (129, 144)
[INFO]   Nearest: (130.0, 144.0)
[INFO]   Rounded: (163, 183)
[INFO]   Nearest: (164.0, 182.0)
[INFO]   Rounded: (76, 92)
[INFO]   Rounded: (30, 39)
[INFO]   Nearest: (30.0, 40.0)
[INFO]   Rounded: (103, 130)
[INFO]   Nearest: (104.0, 130.0)
[INFO]   Rounded: (37, 286)
[INFO]   Nearest: (38.0, 286.0)
[INFO]   Rounded: (13, 286)
[INFO]   Nearest: (14.0, 286.0)
[INFO]   Rounded: (85, 178)
[INFO]   Nearest: (84.0, 178.0)
[INFO]   Rounded: (26, 50)
[INFO]   Rounded: (25, 90)
[INFO]   Nearest: (24.0, 90.0)
[INFO]   Rounded: (82, 120)
[INFO]   Rounded: (21, 129)
[INFO]   Nearest: (20.0, 130.0)
[INFO]   Rounded: (24, 47)
[INFO]   Nearest: (24.0, 46.0)
[INFO]   Rounded: (33, 186)
[INFO]   Nearest: (34.0, 186.0)
[INFO]   Rounded: (272, 290)
[INFO]   Rounded: (40, 249)
[INFO]   Nearest: (40.0, 250.0)
[INFO]   Rounded: (41, 135)
[INFO]   Nearest: (40.0, 134.0)
[INFO]   Rounded: (100, 177)
[INFO]   Nearest: (100.0, 176.0)
[INFO]   Rounded: (214, 277)
[INFO]   Nearest: (214.0, 278.0)
[INFO] Successfully plotted 49 out of 49 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 210, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(212/236) - Original Sharpe: 0.9823, Trades: 10
[INFO] Kmeans cluster 2: SMA(230/254) - Original Sharpe: 0.9022, Trades: 10
[INFO] Kmeans cluster 3: SMA(218/276) - Original Sharpe: 0.8594, Trades: 11
[INFO] Kmeans cluster 4: SMA(246/286) - Original Sharpe: 0.8519, Trades: 11
[INFO] Kmeans cluster 5: SMA(200/220) - Original Sharpe: 0.8263, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (210/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (212/236) - Sharpe: 0.9823
[INFO] cluster 2: (230/254) - Sharpe: 0.9022
[INFO] cluster 3: (218/276) - Sharpe: 0.8594
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     1.806484            1.806484
1    2021-11-14 2021-11-14            43    -0.977041           -0.977041
2    2022-01-14 2022-01-14            41    -2.947949           -2.947949
3    2022-03-14 2022-03-14            44    -1.115967           -1.115967
4    2022-05-14 2022-05-14            43     1.940963           -0.028797
5    2022-07-14 2022-07-14            44     0.287301            0.287301
6    2022-09-14 2022-09-14            43     0.419792            0.419792
7    2022-11-14 2022-11-14            43     0.548831            0.548831
8    2023-01-14 2023-01-14            41    -0.831080           -0.831080
9    2023-03-14 2023-03-14            44    -1.028325           -3.708892
10   2023-05-14 2023-05-14            44    -3.465831           -5.194937
11   2023-07-14 2023-07-14            44    -0.679801           -0.684754
12   2023-09-14 2023-09-14            43    -0.029656           -0.029656
13   2023-11-14 2023-11-14            42     3.419744            3.419744
14   2024-01-14 2024-01-14            43     2.462763            2.462763
15   2024-03-14 2024-03-14            42    -1.004018           -1.004018
16   2024-05-14 2024-05-14            44     4.245445            4.245445
17   2024-07-14 2024-07-14            45    -2.152848           -2.152848
18   2024-09-14 2024-09-14            43     2.552179            2.552179
19   2024-11-14 2024-11-14            33    -1.170159           -1.170159
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.9 |             -2.9 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.9 |             -0.0 |         -1.9 | False         
[INFO] 2022-07-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -1.0 |             -3.7 |         -2.7 | False         
[INFO] 2023-05-14   |         -3.5 |             -5.2 |         -1.7 | False         
[INFO] 2023-07-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 3
[INFO] Kmeans cluster wins (rounded comparison): 0 of 3 periods (0.00% win rate)
[INFO] Updating Excel file with Kmeans results for NQ...
[INFO] Excel file updated successfully. Added NQ with Kmeans win rate 0.0% in row 38
[INFO] Added best Sharpe parameters 210/234 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 210, Long SMA: 234
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(212/236) - Original Sharpe: 0.9823
[INFO] Added cluster 2 to portfolio: SMA(230/254) - Original Sharpe: 0.9022
[INFO] Added cluster 3 to portfolio: SMA(218/276) - Original Sharpe: 0.8594
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NQ_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1141
[INFO] Kmeans Best out-of-sample Sharpe: 0.0294
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for NQ...
[INFO] Excel file updated successfully. Added NQ with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NQ
[INFO] Big Point Value: 20.0
[INFO] Slippage: 11.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.2377 to 1.1145
[INFO] 
Best parameters:
[INFO] Short SMA: 210
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.114521
[INFO] Number of Trades: 10
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 6490 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.2377 to 1.1145
[INFO] Trades range: 10.0 to 305.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0679 to 2.6754
[INFO] Scaled Long SMA range: -2.3404 to 1.7698
[INFO] Scaled Sharpe ratio range: -4.0912 to 2.6527
[INFO] Scaled Trades range: -0.5631 to 13.6657
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 6490 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.7509
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 41 elements
[INFO] Cluster 1: 111 elements
[INFO] Cluster 2: 392 elements
[INFO] Cluster 3: 305 elements
[INFO] Cluster 4: 176 elements
[INFO] Cluster 5: 237 elements
[INFO] Cluster 6: 269 elements
[INFO] Cluster 7: 111 elements
[INFO] Cluster 8: 66 elements
[INFO] Cluster 9: 10 elements
[INFO] Cluster 10: 71 elements
[INFO] Cluster 11: 23 elements
[INFO] Cluster 12: 234 elements
[INFO] Cluster 13: 49 elements
[INFO] Cluster 14: 200 elements
[INFO] Cluster 15: 300 elements
[INFO] Cluster 16: 73 elements
[INFO] Cluster 17: 30 elements
[INFO] Cluster 18: 243 elements
[INFO] Cluster 19: 96 elements
[INFO] Cluster 20: 170 elements
[INFO] Cluster 21: 240 elements
[INFO] Cluster 22: 87 elements
[INFO] Cluster 23: 126 elements
[INFO] Cluster 24: 259 elements
[INFO] Cluster 25: 92 elements
[INFO] Cluster 26: 124 elements
[INFO] Cluster 27: 4 elements
[INFO] Cluster 28: 50 elements
[INFO] Cluster 29: 232 elements
[INFO] Cluster 30: 187 elements
[INFO] Cluster 31: 224 elements
[INFO] Cluster 32: 187 elements
[INFO] Cluster 33: 106 elements
[INFO] Cluster 34: 168 elements
[INFO] Cluster 35: 107 elements
[INFO] Cluster 36: 139 elements
[INFO] Cluster 37: 32 elements
[INFO] Cluster 38: 32 elements
[INFO] Cluster 39: 34 elements
[INFO] Cluster 40: 81 elements
[INFO] Cluster 41: 55 elements
[INFO] Cluster 42: 20 elements
[INFO] Cluster 43: 105 elements
[INFO] Cluster 44: 110 elements
[INFO] Cluster 45: 172 elements
[INFO] Cluster 46: 162 elements
[INFO] Cluster 47: 63 elements
[INFO] Cluster 48: 66 elements
[INFO] Cluster 49: 19 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=24, Long SMA=32, Sharpe=0.3245, Trades=96
[INFO] Cluster 1 cluster: Short SMA=136, Long SMA=148, Sharpe=0.5980, Trades=26
[INFO] Cluster 2 cluster: Short SMA=24, Long SMA=240, Sharpe=0.5709, Trades=12
[INFO] Cluster 3 cluster: Short SMA=36, Long SMA=280, Sharpe=0.6048, Trades=11
[INFO] Cluster 4 cluster: Short SMA=104, Long SMA=132, Sharpe=0.6193, Trades=20
[INFO] Cluster 5 cluster: Short SMA=60, Long SMA=90, Sharpe=0.3426, Trades=30
[INFO] Cluster 6 cluster: Short SMA=104, Long SMA=164, Sharpe=0.7264, Trades=12
[INFO] Cluster 7 cluster: Short SMA=228, Long SMA=236, Sharpe=0.8887, Trades=20
[INFO] Cluster 8 cluster: Short SMA=106, Long SMA=118, Sharpe=0.6443, Trades=30
[INFO] Cluster 10 cluster: Short SMA=108, Long SMA=234, Sharpe=0.8133, Trades=10
[INFO] Cluster 11 cluster: Short SMA=34, Long SMA=36, Sharpe=0.0838, Trades=134
[INFO] Cluster 12 cluster: Short SMA=60, Long SMA=174, Sharpe=0.5253, Trades=10
[INFO] Cluster 13 cluster: Short SMA=120, Long SMA=126, Sharpe=0.6601, Trades=41
[INFO] Cluster 14 cluster: Short SMA=210, Long SMA=242, Sharpe=1.0053, Trades=10
[INFO] Cluster 15 cluster: Short SMA=24, Long SMA=158, Sharpe=0.5499, Trades=12
[INFO] Cluster 16 cluster: Short SMA=160, Long SMA=168, Sharpe=0.7100, Trades=22
[INFO] Cluster 17 cluster: Short SMA=116, Long SMA=118, Sharpe=0.4186, Trades=66
[INFO] Cluster 18 cluster: Short SMA=36, Long SMA=108, Sharpe=0.4683, Trades=20
[INFO] Cluster 19 cluster: Short SMA=200, Long SMA=222, Sharpe=0.8696, Trades=10
[INFO] Cluster 20 cluster: Short SMA=78, Long SMA=120, Sharpe=0.4869, Trades=16
[INFO] Cluster 21 cluster: Short SMA=40, Long SMA=202, Sharpe=0.5941, Trades=10
[INFO] Cluster 22 cluster: Short SMA=18, Long SMA=44, Sharpe=0.1873, Trades=66
[INFO] Cluster 23 cluster: Short SMA=32, Long SMA=60, Sharpe=0.1280, Trades=50
[INFO] Cluster 24 cluster: Short SMA=228, Long SMA=270, Sharpe=0.8855, Trades=11
[INFO] Cluster 25 cluster: Short SMA=14, Long SMA=284, Sharpe=0.3848, Trades=21
[INFO] Cluster 26 cluster: Short SMA=18, Long SMA=194, Sharpe=0.4855, Trades=14
[INFO] Cluster 28 cluster: Short SMA=34, Long SMA=54, Sharpe=0.2833, Trades=56
[INFO] Cluster 29 cluster: Short SMA=44, Long SMA=148, Sharpe=0.6478, Trades=12
[INFO] Cluster 30 cluster: Short SMA=136, Long SMA=166, Sharpe=0.7517, Trades=12
[INFO] Cluster 31 cluster: Short SMA=252, Long SMA=284, Sharpe=0.7770, Trades=11
[INFO] Cluster 32 cluster: Short SMA=182, Long SMA=204, Sharpe=0.6891, Trades=10
[INFO] Cluster 33 cluster: Short SMA=278, Long SMA=290, Sharpe=0.6614, Trades=21
[INFO] Cluster 34 cluster: Short SMA=84, Long SMA=174, Sharpe=0.6200, Trades=10
[INFO] Cluster 35 cluster: Short SMA=22, Long SMA=90, Sharpe=0.2576, Trades=38
[INFO] Cluster 36 cluster: Short SMA=22, Long SMA=122, Sharpe=0.5736, Trades=24
[INFO] Cluster 37 cluster: Short SMA=268, Long SMA=270, Sharpe=0.7938, Trades=43
[INFO] Cluster 38 cluster: Short SMA=30, Long SMA=38, Sharpe=0.0154, Trades=84
[INFO] Cluster 39 cluster: Short SMA=32, Long SMA=44, Sharpe=0.4018, Trades=68
[INFO] Cluster 40 cluster: Short SMA=162, Long SMA=184, Sharpe=0.5887, Trades=10
[INFO] Cluster 41 cluster: Short SMA=82, Long SMA=90, Sharpe=0.2420, Trades=52
[INFO] Cluster 42 cluster: Short SMA=24, Long SMA=28, Sharpe=0.3773, Trades=130
[INFO] Cluster 43 cluster: Short SMA=38, Long SMA=74, Sharpe=0.2794, Trades=40
[INFO] Cluster 44 cluster: Short SMA=62, Long SMA=122, Sharpe=0.5880, Trades=16
[INFO] Cluster 45 cluster: Short SMA=72, Long SMA=146, Sharpe=0.4788, Trades=12
[INFO] Cluster 46 cluster: Short SMA=48, Long SMA=224, Sharpe=0.6016, Trades=10
[INFO] Cluster 47 cluster: Short SMA=258, Long SMA=266, Sharpe=0.7872, Trades=24
[INFO] Cluster 48 cluster: Short SMA=24, Long SMA=66, Sharpe=-0.0718, Trades=46
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=210, Long SMA=234, Sharpe=1.1145, Trades=10
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=210, Long SMA=242, Sharpe=1.0053, Trades=10
[INFO] Top 2: Short SMA=228, Long SMA=236, Sharpe=0.8887, Trades=20
[INFO] Top 3: Short SMA=228, Long SMA=270, Sharpe=0.8855, Trades=11
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 6457 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 210, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(210/242) - Original Sharpe: 1.0053, Trades: 10
[INFO] Hierarchical cluster 2: SMA(228/236) - Original Sharpe: 0.8887, Trades: 20
[INFO] Hierarchical cluster 3: SMA(228/270) - Original Sharpe: 0.8855, Trades: 11
[INFO] Hierarchical cluster 4: SMA(200/222) - Original Sharpe: 0.8696, Trades: 10
[INFO] Hierarchical cluster 5: SMA(108/234) - Original Sharpe: 0.8133, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (210/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (210/242) - Sharpe: 1.0053
[INFO] cluster 2: (228/236) - Sharpe: 0.8887
[INFO] cluster 3: (228/270) - Sharpe: 0.8855
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     1.806484            1.806484
1    2021-11-14 2021-11-14            43    -0.977041           -0.977041
2    2022-01-14 2022-01-14            41    -2.947949           -2.947949
3    2022-03-14 2022-03-14            44    -1.115967           -1.115967
4    2022-05-14 2022-05-14            43     1.940963            1.197127
5    2022-07-14 2022-07-14            44     0.287301            0.287301
6    2022-09-14 2022-09-14            43     0.419792            0.419792
7    2022-11-14 2022-11-14            43     0.548831            0.548831
8    2023-01-14 2023-01-14            41    -0.831080           -0.831080
9    2023-03-14 2023-03-14            44    -1.028325           -2.536456
10   2023-05-14 2023-05-14            44    -3.465831            0.305935
11   2023-07-14 2023-07-14            44    -0.679801            0.248236
12   2023-09-14 2023-09-14            43    -0.029656           -0.029656
13   2023-11-14 2023-11-14            42     3.419744            3.419744
14   2024-01-14 2024-01-14            43     2.462763            2.462763
15   2024-03-14 2024-03-14            42    -1.004018           -1.004018
16   2024-05-14 2024-05-14            44     4.245445            4.245445
17   2024-07-14 2024-07-14            45    -2.152848           -2.152848
18   2024-09-14 2024-09-14            43     2.552179            2.552179
19   2024-11-14 2024-11-14            33    -1.170159           -1.170159
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.9 |             -2.9 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.9 |              1.2 |         -0.7 | False         
[INFO] 2022-07-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -1.0 |             -2.5 |         -1.5 | False         
[INFO] 2023-05-14   |         -3.5 |              0.3 |          3.8 | True          
[INFO] 2023-07-14   |         -0.7 |              0.2 |          0.9 | True          
[INFO] 2023-09-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 4
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 4 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for NQ...
[INFO] Excel file updated successfully. Added NQ with Hierarchical win rate 50.0% in row 38
[INFO] Added best Sharpe parameters 210/234 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 210, Long SMA: 234
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(210/242) - Original Sharpe: 1.0053
[INFO] Added cluster 2 to portfolio: SMA(228/236) - Original Sharpe: 0.8887
[INFO] Added cluster 3 to portfolio: SMA(228/270) - Original Sharpe: 0.8855
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NQ_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1594
[INFO] Hierarchical Best out-of-sample Sharpe: 0.0294
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NQ...
[INFO] Excel file updated successfully. Added NQ with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NQ
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for PA in column D: 80.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.77s
[INFO] Best parameters: Short SMA = 112, Long SMA = 174
[INFO] Best Sharpe ratio: 0.926948, Trades: 16
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 1928 bad combos; keeping 1962 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @PA=13INC
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 2.59 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $712,220.00
[INFO] Market Buy & Hold P&L: $9,530.00
[INFO] Outperformance: $702,690.00
[INFO] Sharpe ratio (entire period, annualized): 0.716294
[INFO] Sharpe ratio (in-sample, annualized): 0.926948
[INFO] Sharpe ratio (out-of-sample, annualized): 0.281614
[INFO] Maximum Drawdown: $241,380.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 10
[INFO] Out-of-sample period trades: 6
[INFO] Total trades: 16
[INFO] In-sample P&L: $597,115.00
[INFO] Out-of-sample P&L: $87,290.00
[INFO] 
Best parameters from GA: Short SMA = 112, Long SMA = 174, Sharpe = 0.926948
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 80.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5147 to 0.9269
[INFO] 
Best parameters:
[INFO] Short SMA: 112
[INFO] Long SMA: 174
[INFO] Sharpe Ratio: 0.926948
[INFO] Number of Trades: 16
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8657 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5147 to 0.9269
[INFO] Trades range: 10.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2463 to 2.7391
[INFO] Scaled Long SMA range: -2.6546 to 1.6587
[INFO] Scaled Sharpe ratio range: -4.6266 to 2.1322
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 187 elements
[INFO] Kmeans Cluster 1: 211 elements
[INFO] Kmeans Cluster 2: 229 elements
[INFO] Kmeans Cluster 3: 163 elements
[INFO] Kmeans Cluster 4: 165 elements
[INFO] Kmeans Cluster 5: 137 elements
[INFO] Kmeans Cluster 6: 216 elements
[INFO] Kmeans Cluster 7: 93 elements
[INFO] Kmeans Cluster 8: 123 elements
[INFO] Kmeans Cluster 9: 90 elements
[INFO] Kmeans Cluster 10: 234 elements
[INFO] Kmeans Cluster 11: 120 elements
[INFO] Kmeans Cluster 12: 208 elements
[INFO] Kmeans Cluster 13: 229 elements
[INFO] Kmeans Cluster 14: 104 elements
[INFO] Kmeans Cluster 15: 98 elements
[INFO] Kmeans Cluster 16: 259 elements
[INFO] Kmeans Cluster 17: 94 elements
[INFO] Kmeans Cluster 18: 198 elements
[INFO] Kmeans Cluster 19: 164 elements
[INFO] Kmeans Cluster 20: 215 elements
[INFO] Kmeans Cluster 21: 191 elements
[INFO] Kmeans Cluster 22: 226 elements
[INFO] Kmeans Cluster 23: 151 elements
[INFO] Kmeans Cluster 24: 161 elements
[INFO] Kmeans Cluster 25: 309 elements
[INFO] Kmeans Cluster 26: 179 elements
[INFO] Kmeans Cluster 27: 301 elements
[INFO] Kmeans Cluster 28: 175 elements
[INFO] Kmeans Cluster 29: 169 elements
[INFO] Kmeans Cluster 30: 344 elements
[INFO] Kmeans Cluster 31: 267 elements
[INFO] Kmeans Cluster 32: 140 elements
[INFO] Kmeans Cluster 33: 247 elements
[INFO] Kmeans Cluster 34: 165 elements
[INFO] Kmeans Cluster 35: 132 elements
[INFO] Kmeans Cluster 36: 171 elements
[INFO] Kmeans Cluster 37: 143 elements
[INFO] Kmeans Cluster 38: 207 elements
[INFO] Kmeans Cluster 39: 123 elements
[INFO] Kmeans Cluster 40: 63 elements
[INFO] Kmeans Cluster 41: 124 elements
[INFO] Kmeans Cluster 42: 88 elements
[INFO] Kmeans Cluster 43: 153 elements
[INFO] Kmeans Cluster 44: 106 elements
[INFO] Kmeans Cluster 45: 86 elements
[INFO] Kmeans Cluster 46: 221 elements
[INFO] Kmeans Cluster 47: 81 elements
[INFO] Kmeans Cluster 48: 170 elements
[INFO] Kmeans Cluster 49: 227 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=38.39, Long SMA=66.26, Sharpe=0.0994
[INFO] Centroid 1: Short SMA=121.35, Long SMA=214.98, Sharpe=0.5114
[INFO] Centroid 2: Short SMA=30.45, Long SMA=204.25, Sharpe=0.5888
[INFO] Centroid 3: Short SMA=89.57, Long SMA=111.99, Sharpe=0.5361
[INFO] Centroid 4: Short SMA=224.01, Long SMA=242.96, Sharpe=0.3852
[INFO] Centroid 5: Short SMA=25.09, Long SMA=278.93, Sharpe=0.5951
[INFO] Centroid 6: Short SMA=58.60, Long SMA=228.01, Sharpe=0.6557
[INFO] Centroid 7: Short SMA=40.11, Long SMA=60.30, Sharpe=0.3592
[INFO] Centroid 8: Short SMA=276.62, Long SMA=289.82, Sharpe=0.1826
[INFO] Centroid 9: Short SMA=13.11, Long SMA=82.02, Sharpe=-0.1833
[INFO] Centroid 10: Short SMA=104.15, Long SMA=176.05, Sharpe=0.7846
[INFO] Centroid 11: Short SMA=21.25, Long SMA=113.50, Sharpe=0.1181
[INFO] Centroid 12: Short SMA=80.05, Long SMA=155.12, Sharpe=0.5809
[INFO] Centroid 13: Short SMA=184.16, Long SMA=203.96, Sharpe=0.3183
[INFO] Centroid 14: Short SMA=16.25, Long SMA=205.52, Sharpe=0.4302
[INFO] Centroid 15: Short SMA=195.96, Long SMA=224.73, Sharpe=0.5827
[INFO] Centroid 16: Short SMA=49.14, Long SMA=169.20, Sharpe=0.7655
[INFO] Centroid 17: Short SMA=16.28, Long SMA=33.83, Sharpe=-0.2834
[INFO] Centroid 18: Short SMA=256.22, Long SMA=285.48, Sharpe=0.2516
[INFO] Centroid 19: Short SMA=128.52, Long SMA=181.21, Sharpe=0.6155
[INFO] Centroid 20: Short SMA=25.32, Long SMA=249.58, Sharpe=0.6683
[INFO] Centroid 21: Short SMA=44.60, Long SMA=120.04, Sharpe=0.5177
[INFO] Centroid 22: Short SMA=47.00, Long SMA=76.34, Sharpe=0.2146
[INFO] Centroid 23: Short SMA=145.71, Long SMA=160.25, Sharpe=0.3482
[INFO] Centroid 24: Short SMA=23.54, Long SMA=159.39, Sharpe=0.5321
[INFO] Centroid 25: Short SMA=103.18, Long SMA=137.85, Sharpe=0.6939
[INFO] Centroid 26: Short SMA=216.74, Long SMA=271.45, Sharpe=0.4352
[INFO] Centroid 27: Short SMA=155.04, Long SMA=187.58, Sharpe=0.4787
[INFO] Centroid 28: Short SMA=205.27, Long SMA=234.83, Sharpe=0.4728
[INFO] Centroid 29: Short SMA=138.96, Long SMA=213.30, Sharpe=0.3962
[INFO] Centroid 30: Short SMA=52.98, Long SMA=285.69, Sharpe=0.4842
[INFO] Centroid 31: Short SMA=164.40, Long SMA=229.51, Sharpe=0.4893
[INFO] Centroid 32: Short SMA=127.30, Long SMA=145.30, Sharpe=0.5421
[INFO] Centroid 33: Short SMA=45.42, Long SMA=146.40, Sharpe=0.6628
[INFO] Centroid 34: Short SMA=62.51, Long SMA=204.79, Sharpe=0.5384
[INFO] Centroid 35: Short SMA=33.36, Long SMA=234.53, Sharpe=0.7620
[INFO] Centroid 36: Short SMA=69.64, Long SMA=180.28, Sharpe=0.6619
[INFO] Centroid 37: Short SMA=62.44, Long SMA=103.41, Sharpe=0.2946
[INFO] Centroid 38: Short SMA=74.15, Long SMA=109.29, Sharpe=0.4168
[INFO] Centroid 39: Short SMA=237.64, Long SMA=286.75, Sharpe=0.3641
[INFO] Centroid 40: Short SMA=10.73, Long SMA=183.71, Sharpe=0.2185
[INFO] Centroid 41: Short SMA=130.94, Long SMA=250.10, Sharpe=0.4116
[INFO] Centroid 42: Short SMA=21.39, Long SMA=44.07, Sharpe=-0.0601
[INFO] Centroid 43: Short SMA=191.50, Long SMA=253.83, Sharpe=0.3959
[INFO] Centroid 44: Short SMA=26.74, Long SMA=94.43, Sharpe=-0.0261
[INFO] Centroid 45: Short SMA=21.84, Long SMA=129.72, Sharpe=0.3278
[INFO] Centroid 46: Short SMA=61.67, Long SMA=252.36, Sharpe=0.5717
[INFO] Centroid 47: Short SMA=14.52, Long SMA=282.00, Sharpe=0.7195
[INFO] Centroid 48: Short SMA=239.94, Long SMA=261.96, Sharpe=0.5051
[INFO] Centroid 49: Short SMA=89.45, Long SMA=204.83, Sharpe=0.6725
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=112, Long SMA=174, Sharpe=0.9269, Trades=16
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=104, Long SMA=176, Sharpe=0.8646, Trades=14
[INFO] Kmeans Top 2: Short SMA=34, Long SMA=234, Sharpe=0.8457, Trades=16
[INFO] Kmeans Top 3: Short SMA=50, Long SMA=170, Sharpe=0.8061, Trades=14
[INFO] Kmeans Top 4: Short SMA=104, Long SMA=140, Sharpe=0.6779, Trades=22
[INFO] Kmeans Top 5: Short SMA=126, Long SMA=182, Sharpe=0.6707, Trades=14
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (38, 66)
[INFO]   Rounded: (121, 215)
[INFO]   Nearest: (122.0, 214.0)
[INFO]   Rounded: (30, 204)
[INFO]   Rounded: (90, 112)
[INFO]   Rounded: (224, 243)
[INFO]   Nearest: (224.0, 242.0)
[INFO]   Rounded: (25, 279)
[INFO]   Nearest: (26.0, 278.0)
[INFO]   Rounded: (59, 228)
[INFO]   Nearest: (58.0, 228.0)
[INFO]   Rounded: (40, 60)
[INFO]   Rounded: (277, 290)
[INFO]   Nearest: (276.0, 290.0)
[INFO]   Rounded: (13, 82)
[INFO]   Nearest: (14.0, 82.0)
[INFO]   Rounded: (104, 176)
[INFO]   Rounded: (21, 114)
[INFO]   Nearest: (22.0, 114.0)
[INFO]   Rounded: (80, 155)
[INFO]   Nearest: (80.0, 156.0)
[INFO]   Rounded: (184, 204)
[INFO]   Rounded: (16, 206)
[INFO]   Rounded: (196, 225)
[INFO]   Nearest: (196.0, 224.0)
[INFO]   Rounded: (49, 169)
[INFO]   Nearest: (50.0, 170.0)
[INFO]   Rounded: (16, 34)
[INFO]   Rounded: (256, 285)
[INFO]   Nearest: (256.0, 286.0)
[INFO]   Rounded: (129, 181)
[INFO]   Nearest: (128.0, 182.0)
[INFO]   Rounded: (25, 250)
[INFO]   Nearest: (26.0, 250.0)
[INFO]   Rounded: (45, 120)
[INFO]   Nearest: (44.0, 120.0)
[INFO]   Rounded: (47, 76)
[INFO]   Nearest: (48.0, 76.0)
[INFO]   Rounded: (146, 160)
[INFO]   Rounded: (24, 159)
[INFO]   Nearest: (24.0, 160.0)
[INFO]   Rounded: (103, 138)
[INFO]   Nearest: (104.0, 138.0)
[INFO]   Rounded: (217, 271)
[INFO]   Nearest: (216.0, 272.0)
[INFO]   Rounded: (155, 188)
[INFO]   Nearest: (156.0, 188.0)
[INFO]   Rounded: (205, 235)
[INFO]   Nearest: (206.0, 234.0)
[INFO]   Rounded: (139, 213)
[INFO]   Nearest: (138.0, 214.0)
[INFO]   Rounded: (53, 286)
[INFO]   Nearest: (52.0, 286.0)
[INFO]   Rounded: (164, 230)
[INFO]   Rounded: (127, 145)
[INFO]   Nearest: (128.0, 146.0)
[INFO]   Rounded: (45, 146)
[INFO]   Nearest: (46.0, 146.0)
[INFO]   Rounded: (63, 205)
[INFO]   Nearest: (62.0, 204.0)
[INFO]   Rounded: (33, 235)
[INFO]   Nearest: (34.0, 234.0)
[INFO]   Rounded: (70, 180)
[INFO]   Rounded: (62, 103)
[INFO]   Nearest: (62.0, 104.0)
[INFO]   Rounded: (74, 109)
[INFO]   Nearest: (74.0, 110.0)
[INFO]   Rounded: (238, 287)
[INFO]   Nearest: (238.0, 286.0)
[INFO]   Rounded: (11, 184)
[INFO]   Nearest: (10.0, 184.0)
[INFO]   Rounded: (131, 250)
[INFO]   Nearest: (130.0, 250.0)
[INFO]   Rounded: (21, 44)
[INFO]   Nearest: (22.0, 44.0)
[INFO]   Rounded: (192, 254)
[INFO]   Rounded: (27, 94)
[INFO]   Nearest: (26.0, 94.0)
[INFO]   Rounded: (22, 130)
[INFO]   Rounded: (62, 252)
[INFO]   Rounded: (15, 282)
[INFO]   Nearest: (14.0, 282.0)
[INFO]   Rounded: (240, 262)
[INFO]   Rounded: (89, 205)
[INFO]   Nearest: (90.0, 204.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 112, Long SMA: 174
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(104/176) - Original Sharpe: 0.8646, Trades: 14
[INFO] Kmeans cluster 2: SMA(34/234) - Original Sharpe: 0.8457, Trades: 16
[INFO] Kmeans cluster 3: SMA(50/170) - Original Sharpe: 0.8061, Trades: 14
[INFO] Kmeans cluster 4: SMA(104/140) - Original Sharpe: 0.6779, Trades: 22
[INFO] Kmeans cluster 5: SMA(126/182) - Original Sharpe: 0.6707, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (112/174)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (104/176) - Sharpe: 0.8646
[INFO] cluster 2: (34/234) - Sharpe: 0.8457
[INFO] cluster 3: (50/170) - Sharpe: 0.8061
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.848635           -1.266577
1    2021-11-14 2021-11-14            43     1.505824            1.505824
2    2022-01-14 2022-01-14            41    -4.150479           -6.638249
3    2022-03-14 2022-03-14            44    -0.356482           -3.531464
4    2022-05-14 2022-05-14            43     0.314844           -0.458489
5    2022-07-14 2022-07-14            44     2.699252           -1.368918
6    2022-09-14 2022-09-14            43     0.350844           -1.276693
7    2022-11-14 2022-11-14            43     3.719452            1.732588
8    2023-01-14 2023-01-14            41     2.654910            3.406412
9    2023-03-14 2023-03-14            43    -1.548584           -1.548584
10   2023-05-14 2023-05-14            44     3.059517            3.059517
11   2023-07-14 2023-07-14            44     0.609800            0.609800
12   2023-09-14 2023-09-14            43     4.868598            4.868598
13   2023-11-14 2023-11-14            42     0.159231            0.159231
14   2024-01-14 2024-01-14            43    -1.143094           -1.143094
15   2024-03-14 2024-03-14            42     1.807282            1.807282
16   2024-05-14 2024-05-14            44     0.086225            0.086225
17   2024-07-14 2024-07-14            45    -1.430493           -1.430493
18   2024-09-14 2024-09-14            43     1.688514            0.212627
19   2024-11-14 2024-11-14            33    -3.034107           -3.406660
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.8 |             -1.3 |          1.5 | True          
[INFO] 2021-11-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -4.2 |             -6.6 |         -2.4 | False         
[INFO] 2022-03-14   |         -0.4 |             -3.5 |         -3.1 | False         
[INFO] 2022-05-14   |          0.3 |             -0.5 |         -0.8 | False         
[INFO] 2022-07-14   |          2.7 |             -1.4 |         -4.1 | False         
[INFO] 2022-09-14   |          0.4 |             -1.3 |         -1.7 | False         
[INFO] 2022-11-14   |          3.7 |              1.7 |         -2.0 | False         
[INFO] 2023-01-14   |          2.7 |              3.4 |          0.7 | True          
[INFO] 2023-03-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          4.9 |              4.9 |          0.0 | Excluded      
[INFO] 2023-11-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          1.7 |              0.2 |         -1.5 | False         
[INFO] 2024-11-14   |         -3.0 |             -3.4 |         -0.4 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Kmeans cluster wins (rounded comparison): 2 of 10 periods (20.00% win rate)
[INFO] Updating Excel file with Kmeans results for PA...
[INFO] Excel file updated successfully. Added PA with Kmeans win rate 20.0% in row 39
[INFO] Added best Sharpe parameters 112/174 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 112, Long SMA: 174
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(104/176) - Original Sharpe: 0.8646
[INFO] Added cluster 2 to portfolio: SMA(34/234) - Original Sharpe: 0.8457
[INFO] Added cluster 3 to portfolio: SMA(50/170) - Original Sharpe: 0.8061
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'PA_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.4152
[INFO] Kmeans Best out-of-sample Sharpe: 0.2816
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for PA...
[INFO] Excel file updated successfully. Added PA with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PA
[INFO] Big Point Value: 100.0
[INFO] Slippage: 80.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5147 to 0.9269
[INFO] 
Best parameters:
[INFO] Short SMA: 112
[INFO] Long SMA: 174
[INFO] Sharpe Ratio: 0.926948
[INFO] Number of Trades: 16
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8657 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5147 to 0.9269
[INFO] Trades range: 10.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2463 to 2.7391
[INFO] Scaled Long SMA range: -2.6546 to 1.6587
[INFO] Scaled Sharpe ratio range: -4.6266 to 2.1322
[INFO] Scaled Trades range: -0.6520 to 13.4916
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8657 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5757
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 13 elements
[INFO] Cluster 1: 226 elements
[INFO] Cluster 2: 371 elements
[INFO] Cluster 3: 461 elements
[INFO] Cluster 4: 271 elements
[INFO] Cluster 5: 394 elements
[INFO] Cluster 6: 340 elements
[INFO] Cluster 7: 36 elements
[INFO] Cluster 8: 71 elements
[INFO] Cluster 9: 359 elements
[INFO] Cluster 10: 159 elements
[INFO] Cluster 11: 184 elements
[INFO] Cluster 12: 135 elements
[INFO] Cluster 13: 243 elements
[INFO] Cluster 14: 387 elements
[INFO] Cluster 15: 334 elements
[INFO] Cluster 16: 75 elements
[INFO] Cluster 17: 432 elements
[INFO] Cluster 18: 216 elements
[INFO] Cluster 19: 167 elements
[INFO] Cluster 20: 67 elements
[INFO] Cluster 21: 262 elements
[INFO] Cluster 22: 85 elements
[INFO] Cluster 23: 241 elements
[INFO] Cluster 24: 200 elements
[INFO] Cluster 25: 349 elements
[INFO] Cluster 26: 40 elements
[INFO] Cluster 27: 74 elements
[INFO] Cluster 28: 214 elements
[INFO] Cluster 29: 18 elements
[INFO] Cluster 30: 273 elements
[INFO] Cluster 31: 146 elements
[INFO] Cluster 32: 24 elements
[INFO] Cluster 33: 121 elements
[INFO] Cluster 34: 91 elements
[INFO] Cluster 35: 179 elements
[INFO] Cluster 36: 28 elements
[INFO] Cluster 37: 194 elements
[INFO] Cluster 38: 147 elements
[INFO] Cluster 39: 230 elements
[INFO] Cluster 40: 59 elements
[INFO] Cluster 41: 34 elements
[INFO] Cluster 42: 85 elements
[INFO] Cluster 43: 164 elements
[INFO] Cluster 44: 95 elements
[INFO] Cluster 45: 48 elements
[INFO] Cluster 46: 46 elements
[INFO] Cluster 47: 93 elements
[INFO] Cluster 48: 20 elements
[INFO] Cluster 49: 156 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 1 cluster: Short SMA=22, Long SMA=200, Sharpe=0.5665, Trades=20
[INFO] Cluster 2 cluster: Short SMA=26, Long SMA=242, Sharpe=0.6478, Trades=18
[INFO] Cluster 3 cluster: Short SMA=52, Long SMA=164, Sharpe=0.8329, Trades=14
[INFO] Cluster 4 cluster: Short SMA=132, Long SMA=228, Sharpe=0.3622, Trades=12
[INFO] Cluster 5 cluster: Short SMA=58, Long SMA=246, Sharpe=0.5595, Trades=11
[INFO] Cluster 6 cluster: Short SMA=154, Long SMA=182, Sharpe=0.4860, Trades=21
[INFO] Cluster 7 cluster: Short SMA=24, Long SMA=30, Sharpe=-0.2123, Trades=136
[INFO] Cluster 8 cluster: Short SMA=52, Long SMA=58, Sharpe=0.4209, Trades=91
[INFO] Cluster 9 cluster: Short SMA=228, Long SMA=274, Sharpe=0.4606, Trades=12
[INFO] Cluster 10 cluster: Short SMA=14, Long SMA=74, Sharpe=-0.1913, Trades=54
[INFO] Cluster 11 cluster: Short SMA=46, Long SMA=98, Sharpe=0.3282, Trades=35
[INFO] Cluster 12 cluster: Short SMA=106, Long SMA=124, Sharpe=0.6784, Trades=37
[INFO] Cluster 13 cluster: Short SMA=126, Long SMA=176, Sharpe=0.5200, Trades=16
[INFO] Cluster 14 cluster: Short SMA=84, Long SMA=198, Sharpe=0.7637, Trades=13
[INFO] Cluster 15 cluster: Short SMA=162, Long SMA=228, Sharpe=0.4092, Trades=10
[INFO] Cluster 16 cluster: Short SMA=30, Long SMA=52, Sharpe=0.1167, Trades=64
[INFO] Cluster 17 cluster: Short SMA=208, Long SMA=248, Sharpe=0.5116, Trades=13
[INFO] Cluster 18 cluster: Short SMA=256, Long SMA=288, Sharpe=0.1753, Trades=16
[INFO] Cluster 19 cluster: Short SMA=48, Long SMA=66, Sharpe=0.3383, Trades=55
[INFO] Cluster 20 cluster: Short SMA=16, Long SMA=38, Sharpe=-0.4073, Trades=94
[INFO] Cluster 21 cluster: Short SMA=32, Long SMA=90, Sharpe=0.0572, Trades=38
[INFO] Cluster 22 cluster: Short SMA=140, Long SMA=150, Sharpe=0.4752, Trades=51
[INFO] Cluster 23 cluster: Short SMA=46, Long SMA=122, Sharpe=0.6266, Trades=25
[INFO] Cluster 24 cluster: Short SMA=106, Long SMA=176, Sharpe=0.8639, Trades=14
[INFO] Cluster 25 cluster: Short SMA=54, Long SMA=286, Sharpe=0.5264, Trades=11
[INFO] Cluster 26 cluster: Short SMA=220, Long SMA=222, Sharpe=0.3329, Trades=56
[INFO] Cluster 27 cluster: Short SMA=10, Long SMA=178, Sharpe=0.2539, Trades=36
[INFO] Cluster 28 cluster: Short SMA=74, Long SMA=114, Sharpe=0.3427, Trades=29
[INFO] Cluster 30 cluster: Short SMA=102, Long SMA=144, Sharpe=0.7465, Trades=22
[INFO] Cluster 31 cluster: Short SMA=184, Long SMA=210, Sharpe=0.3522, Trades=16
[INFO] Cluster 32 cluster: Short SMA=60, Long SMA=62, Sharpe=0.3320, Trades=149
[INFO] Cluster 33 cluster: Short SMA=278, Long SMA=290, Sharpe=0.1694, Trades=26
[INFO] Cluster 34 cluster: Short SMA=236, Long SMA=242, Sharpe=0.4595, Trades=34
[INFO] Cluster 35 cluster: Short SMA=18, Long SMA=282, Sharpe=0.5515, Trades=18
[INFO] Cluster 36 cluster: Short SMA=120, Long SMA=122, Sharpe=0.4426, Trades=108
[INFO] Cluster 37 cluster: Short SMA=60, Long SMA=208, Sharpe=0.4662, Trades=15
[INFO] Cluster 38 cluster: Short SMA=80, Long SMA=156, Sharpe=0.5587, Trades=15
[INFO] Cluster 39 cluster: Short SMA=120, Long SMA=210, Sharpe=0.4580, Trades=13
[INFO] Cluster 40 cluster: Short SMA=142, Long SMA=148, Sharpe=0.2880, Trades=61
[INFO] Cluster 41 cluster: Short SMA=102, Long SMA=106, Sharpe=0.7068, Trades=71
[INFO] Cluster 42 cluster: Short SMA=26, Long SMA=96, Sharpe=-0.0888, Trades=38
[INFO] Cluster 43 cluster: Short SMA=28, Long SMA=154, Sharpe=0.6050, Trades=20
[INFO] Cluster 44 cluster: Short SMA=78, Long SMA=100, Sharpe=0.4269, Trades=41
[INFO] Cluster 45 cluster: Short SMA=186, Long SMA=194, Sharpe=0.2193, Trades=38
[INFO] Cluster 46 cluster: Short SMA=18, Long SMA=144, Sharpe=0.3793, Trades=34
[INFO] Cluster 47 cluster: Short SMA=196, Long SMA=226, Sharpe=0.5980, Trades=14
[INFO] Cluster 48 cluster: Short SMA=280, Long SMA=282, Sharpe=0.1625, Trades=54
[INFO] Cluster 49 cluster: Short SMA=38, Long SMA=196, Sharpe=0.6188, Trades=14
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=112, Long SMA=174, Sharpe=0.9269, Trades=16
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=106, Long SMA=176, Sharpe=0.8639, Trades=14
[INFO] Top 2: Short SMA=52, Long SMA=164, Sharpe=0.8329, Trades=14
[INFO] Top 3: Short SMA=84, Long SMA=198, Sharpe=0.7637, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 8626 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 112, Long SMA: 174
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(106/176) - Original Sharpe: 0.8639, Trades: 14
[INFO] Hierarchical cluster 2: SMA(52/164) - Original Sharpe: 0.8329, Trades: 14
[INFO] Hierarchical cluster 3: SMA(84/198) - Original Sharpe: 0.7637, Trades: 13
[INFO] Hierarchical cluster 4: SMA(102/144) - Original Sharpe: 0.7465, Trades: 22
[INFO] Hierarchical cluster 5: SMA(102/106) - Original Sharpe: 0.7068, Trades: 71
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (112/174)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (106/176) - Sharpe: 0.8639
[INFO] cluster 2: (52/164) - Sharpe: 0.8329
[INFO] cluster 3: (84/198) - Sharpe: 0.7637
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.848635           -1.971409
1    2021-11-14 2021-11-14            43     1.505824            1.505824
2    2022-01-14 2022-01-14            41    -4.150479           -5.734840
3    2022-03-14 2022-03-14            44    -0.356482           -1.923233
4    2022-05-14 2022-05-14            43     0.314844            0.098190
5    2022-07-14 2022-07-14            44     2.699252           -0.322790
6    2022-09-14 2022-09-14            43     0.350844            0.350844
7    2022-11-14 2022-11-14            43     3.719452            2.324357
8    2023-01-14 2023-01-14            41     2.654910            3.406412
9    2023-03-14 2023-03-14            43    -1.548584           -1.548584
10   2023-05-14 2023-05-14            44     3.059517            3.059517
11   2023-07-14 2023-07-14            44     0.609800            0.609800
12   2023-09-14 2023-09-14            43     4.868598            4.868598
13   2023-11-14 2023-11-14            42     0.159231            0.159231
14   2024-01-14 2024-01-14            43    -1.143094           -1.143094
15   2024-03-14 2024-03-14            42     1.807282            1.807282
16   2024-05-14 2024-05-14            44     0.086225            0.086225
17   2024-07-14 2024-07-14            45    -1.430493           -1.430493
18   2024-09-14 2024-09-14            43     1.688514           -0.929645
19   2024-11-14 2024-11-14            33    -3.034107           -3.027354
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.8 |             -2.0 |          0.8 | True          
[INFO] 2021-11-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -4.2 |             -5.7 |         -1.5 | False         
[INFO] 2022-03-14   |         -0.4 |             -1.9 |         -1.5 | False         
[INFO] 2022-05-14   |          0.3 |              0.1 |         -0.2 | False         
[INFO] 2022-07-14   |          2.7 |             -0.3 |         -3.0 | False         
[INFO] 2022-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |          3.7 |              2.3 |         -1.4 | False         
[INFO] 2023-01-14   |          2.7 |              3.4 |          0.7 | True          
[INFO] 2023-03-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          4.9 |              4.9 |          0.0 | Excluded      
[INFO] 2023-11-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          1.7 |             -0.9 |         -2.6 | False         
[INFO] 2024-11-14   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-09-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 8 periods (25.00% win rate)
[INFO] Updating Excel file with Hierarchical results for PA...
[INFO] Excel file updated successfully. Added PA with Hierarchical win rate 25.0% in row 39
[INFO] Added best Sharpe parameters 112/174 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 112, Long SMA: 174
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(106/176) - Original Sharpe: 0.8639
[INFO] Added cluster 2 to portfolio: SMA(52/164) - Original Sharpe: 0.8329
[INFO] Added cluster 3 to portfolio: SMA(84/198) - Original Sharpe: 0.7637
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'PA_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1063
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2816
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for PA...
[INFO] Excel file updated successfully. Added PA with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PA
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for PL in column D: 20.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.53s
[INFO] Best parameters: Short SMA = 122, Long SMA = 126
[INFO] Best Sharpe ratio: 0.489096, Trades: 97
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @PL
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 6.07 contracts
[INFO] Maximum Position Size: 11 contracts
[INFO] Strategy Total P&L: $256,175.00
[INFO] Market Buy & Hold P&L: $-30,695.00
[INFO] Outperformance: $286,870.00
[INFO] Sharpe ratio (entire period, annualized): 0.308659
[INFO] Sharpe ratio (in-sample, annualized): 0.489096
[INFO] Sharpe ratio (out-of-sample, annualized): -0.104550
[INFO] Maximum Drawdown: $174,145.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 55
[INFO] Out-of-sample period trades: 42
[INFO] Total trades: 97
[INFO] In-sample P&L: $254,115.00
[INFO] Out-of-sample P&L: $-23,720.00
[INFO] 
Best parameters from GA: Short SMA = 122, Long SMA = 126, Sharpe = 0.489096
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 20.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9850 to 0.4891
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 126
[INFO] Sharpe Ratio: 0.489096
[INFO] Number of Trades: 97
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9850 to 0.4891
[INFO] Trades range: 11.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.2033 to 3.3492
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 212 elements
[INFO] Kmeans Cluster 1: 212 elements
[INFO] Kmeans Cluster 2: 315 elements
[INFO] Kmeans Cluster 3: 256 elements
[INFO] Kmeans Cluster 4: 189 elements
[INFO] Kmeans Cluster 5: 294 elements
[INFO] Kmeans Cluster 6: 282 elements
[INFO] Kmeans Cluster 7: 189 elements
[INFO] Kmeans Cluster 8: 309 elements
[INFO] Kmeans Cluster 9: 179 elements
[INFO] Kmeans Cluster 10: 181 elements
[INFO] Kmeans Cluster 11: 150 elements
[INFO] Kmeans Cluster 12: 209 elements
[INFO] Kmeans Cluster 13: 210 elements
[INFO] Kmeans Cluster 14: 118 elements
[INFO] Kmeans Cluster 15: 157 elements
[INFO] Kmeans Cluster 16: 175 elements
[INFO] Kmeans Cluster 17: 325 elements
[INFO] Kmeans Cluster 18: 137 elements
[INFO] Kmeans Cluster 19: 253 elements
[INFO] Kmeans Cluster 20: 127 elements
[INFO] Kmeans Cluster 21: 125 elements
[INFO] Kmeans Cluster 22: 289 elements
[INFO] Kmeans Cluster 23: 108 elements
[INFO] Kmeans Cluster 24: 270 elements
[INFO] Kmeans Cluster 25: 239 elements
[INFO] Kmeans Cluster 26: 118 elements
[INFO] Kmeans Cluster 27: 203 elements
[INFO] Kmeans Cluster 28: 323 elements
[INFO] Kmeans Cluster 29: 204 elements
[INFO] Kmeans Cluster 30: 98 elements
[INFO] Kmeans Cluster 31: 279 elements
[INFO] Kmeans Cluster 32: 272 elements
[INFO] Kmeans Cluster 33: 158 elements
[INFO] Kmeans Cluster 34: 258 elements
[INFO] Kmeans Cluster 35: 205 elements
[INFO] Kmeans Cluster 36: 364 elements
[INFO] Kmeans Cluster 37: 217 elements
[INFO] Kmeans Cluster 38: 203 elements
[INFO] Kmeans Cluster 39: 209 elements
[INFO] Kmeans Cluster 40: 180 elements
[INFO] Kmeans Cluster 41: 164 elements
[INFO] Kmeans Cluster 42: 170 elements
[INFO] Kmeans Cluster 43: 127 elements
[INFO] Kmeans Cluster 44: 297 elements
[INFO] Kmeans Cluster 45: 232 elements
[INFO] Kmeans Cluster 46: 242 elements
[INFO] Kmeans Cluster 47: 198 elements
[INFO] Kmeans Cluster 48: 200 elements
[INFO] Kmeans Cluster 49: 154 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=184.73, Long SMA=243.92, Sharpe=-0.5687
[INFO] Centroid 1: Short SMA=41.69, Long SMA=186.22, Sharpe=-0.1350
[INFO] Centroid 2: Short SMA=133.63, Long SMA=190.34, Sharpe=-0.1082
[INFO] Centroid 3: Short SMA=83.43, Long SMA=177.37, Sharpe=-0.4224
[INFO] Centroid 4: Short SMA=95.49, Long SMA=266.41, Sharpe=-0.1851
[INFO] Centroid 5: Short SMA=222.01, Long SMA=285.25, Sharpe=-0.0313
[INFO] Centroid 6: Short SMA=30.40, Long SMA=277.45, Sharpe=-0.5755
[INFO] Centroid 7: Short SMA=25.64, Long SMA=48.52, Sharpe=-0.1203
[INFO] Centroid 8: Short SMA=47.89, Long SMA=237.14, Sharpe=-0.4227
[INFO] Centroid 9: Short SMA=205.42, Long SMA=233.46, Sharpe=-0.4079
[INFO] Centroid 10: Short SMA=106.40, Long SMA=146.48, Sharpe=-0.0777
[INFO] Centroid 11: Short SMA=52.73, Long SMA=137.61, Sharpe=-0.4551
[INFO] Centroid 12: Short SMA=209.43, Long SMA=271.60, Sharpe=-0.1872
[INFO] Centroid 13: Short SMA=59.26, Long SMA=108.51, Sharpe=-0.6544
[INFO] Centroid 14: Short SMA=35.58, Long SMA=122.05, Sharpe=-0.2506
[INFO] Centroid 15: Short SMA=88.74, Long SMA=116.51, Sharpe=-0.2141
[INFO] Centroid 16: Short SMA=119.89, Long SMA=144.42, Sharpe=0.1244
[INFO] Centroid 17: Short SMA=36.44, Long SMA=213.54, Sharpe=-0.2905
[INFO] Centroid 18: Short SMA=20.85, Long SMA=112.63, Sharpe=0.1040
[INFO] Centroid 19: Short SMA=121.42, Long SMA=251.23, Sharpe=-0.0059
[INFO] Centroid 20: Short SMA=268.30, Long SMA=283.78, Sharpe=-0.1525
[INFO] Centroid 21: Short SMA=178.85, Long SMA=203.01, Sharpe=-0.8475
[INFO] Centroid 22: Short SMA=70.23, Long SMA=256.92, Sharpe=-0.5001
[INFO] Centroid 23: Short SMA=162.22, Long SMA=185.56, Sharpe=-0.4128
[INFO] Centroid 24: Short SMA=142.63, Long SMA=279.32, Sharpe=-0.2188
[INFO] Centroid 25: Short SMA=40.16, Long SMA=70.60, Sharpe=-0.3007
[INFO] Centroid 26: Short SMA=14.95, Long SMA=226.29, Sharpe=-0.1274
[INFO] Centroid 27: Short SMA=152.75, Long SMA=242.57, Sharpe=-0.3162
[INFO] Centroid 28: Short SMA=61.96, Long SMA=285.60, Sharpe=-0.3912
[INFO] Centroid 29: Short SMA=68.38, Long SMA=97.06, Sharpe=-0.4965
[INFO] Centroid 30: Short SMA=125.06, Long SMA=139.00, Sharpe=0.2926
[INFO] Centroid 31: Short SMA=113.03, Long SMA=283.91, Sharpe=-0.0477
[INFO] Centroid 32: Short SMA=57.59, Long SMA=164.63, Sharpe=-0.2480
[INFO] Centroid 33: Short SMA=163.61, Long SMA=228.70, Sharpe=-0.4855
[INFO] Centroid 34: Short SMA=78.33, Long SMA=206.19, Sharpe=-0.5564
[INFO] Centroid 35: Short SMA=18.86, Long SMA=178.01, Sharpe=0.0277
[INFO] Centroid 36: Short SMA=175.30, Long SMA=281.40, Sharpe=-0.3897
[INFO] Centroid 37: Short SMA=255.69, Long SMA=283.00, Sharpe=0.0954
[INFO] Centroid 38: Short SMA=91.45, Long SMA=228.60, Sharpe=-0.3681
[INFO] Centroid 39: Short SMA=27.01, Long SMA=88.79, Sharpe=-0.0628
[INFO] Centroid 40: Short SMA=222.19, Long SMA=236.33, Sharpe=-0.1633
[INFO] Centroid 41: Short SMA=26.24, Long SMA=49.07, Sharpe=0.0764
[INFO] Centroid 42: Short SMA=116.06, Long SMA=181.01, Sharpe=-0.2376
[INFO] Centroid 43: Short SMA=15.04, Long SMA=270.94, Sharpe=-0.3384
[INFO] Centroid 44: Short SMA=122.36, Long SMA=223.16, Sharpe=-0.1764
[INFO] Centroid 45: Short SMA=177.51, Long SMA=210.69, Sharpe=-0.6657
[INFO] Centroid 46: Short SMA=81.63, Long SMA=126.41, Sharpe=-0.3568
[INFO] Centroid 47: Short SMA=23.86, Long SMA=143.40, Sharpe=-0.1066
[INFO] Centroid 48: Short SMA=133.50, Long SMA=170.27, Sharpe=0.0115
[INFO] Centroid 49: Short SMA=245.08, Long SMA=264.65, Sharpe=-0.3378
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=126, Sharpe=0.4891, Trades=97
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=126, Long SMA=142, Sharpe=0.3438, Trades=47
[INFO] Kmeans Top 2: Short SMA=20, Long SMA=114, Sharpe=0.2089, Trades=38
[INFO] Kmeans Top 3: Short SMA=118, Long SMA=144, Sharpe=0.1980, Trades=39
[INFO] Kmeans Top 4: Short SMA=256, Long SMA=284, Sharpe=0.1327, Trades=28
[INFO] Kmeans Top 5: Short SMA=18, Long SMA=176, Sharpe=0.1222, Trades=28
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (185, 244)
[INFO]   Nearest: (184.0, 244.0)
[INFO]   Rounded: (42, 186)
[INFO]   Rounded: (134, 190)
[INFO]   Rounded: (83, 177)
[INFO]   Nearest: (84.0, 178.0)
[INFO]   Rounded: (95, 266)
[INFO]   Nearest: (96.0, 266.0)
[INFO]   Rounded: (222, 285)
[INFO]   Nearest: (222.0, 286.0)
[INFO]   Rounded: (30, 277)
[INFO]   Nearest: (30.0, 278.0)
[INFO]   Rounded: (26, 49)
[INFO]   Nearest: (26.0, 48.0)
[INFO]   Rounded: (48, 237)
[INFO]   Nearest: (48.0, 238.0)
[INFO]   Rounded: (205, 233)
[INFO]   Nearest: (206.0, 234.0)
[INFO]   Rounded: (106, 146)
[INFO]   Rounded: (53, 138)
[INFO]   Nearest: (52.0, 138.0)
[INFO]   Rounded: (209, 272)
[INFO]   Nearest: (210.0, 272.0)
[INFO]   Rounded: (59, 109)
[INFO]   Nearest: (60.0, 108.0)
[INFO]   Rounded: (36, 122)
[INFO]   Rounded: (89, 117)
[INFO]   Nearest: (88.0, 116.0)
[INFO]   Rounded: (120, 144)
[INFO]   Rounded: (36, 214)
[INFO]   Rounded: (21, 113)
[INFO]   Nearest: (20.0, 112.0)
[INFO]   Rounded: (121, 251)
[INFO]   Nearest: (122.0, 252.0)
[INFO]   Rounded: (268, 284)
[INFO]   Rounded: (179, 203)
[INFO]   Nearest: (178.0, 204.0)
[INFO]   Rounded: (70, 257)
[INFO]   Nearest: (70.0, 256.0)
[INFO]   Rounded: (162, 186)
[INFO]   Rounded: (143, 279)
[INFO]   Nearest: (142.0, 280.0)
[INFO]   Rounded: (40, 71)
[INFO]   Nearest: (40.0, 70.0)
[INFO]   Rounded: (15, 226)
[INFO]   Nearest: (14.0, 226.0)
[INFO]   Rounded: (153, 243)
[INFO]   Nearest: (152.0, 242.0)
[INFO]   Rounded: (62, 286)
[INFO]   Rounded: (68, 97)
[INFO]   Nearest: (68.0, 98.0)
[INFO]   Rounded: (125, 139)
[INFO]   Nearest: (126.0, 138.0)
[INFO]   Rounded: (113, 284)
[INFO]   Nearest: (114.0, 284.0)
[INFO]   Rounded: (58, 165)
[INFO]   Nearest: (58.0, 164.0)
[INFO]   Rounded: (164, 229)
[INFO]   Nearest: (164.0, 228.0)
[INFO]   Rounded: (78, 206)
[INFO]   Rounded: (19, 178)
[INFO]   Nearest: (18.0, 178.0)
[INFO]   Rounded: (175, 281)
[INFO]   Nearest: (176.0, 282.0)
[INFO]   Rounded: (256, 283)
[INFO]   Nearest: (256.0, 284.0)
[INFO]   Rounded: (91, 229)
[INFO]   Nearest: (92.0, 228.0)
[INFO]   Rounded: (27, 89)
[INFO]   Nearest: (28.0, 88.0)
[INFO]   Rounded: (222, 236)
[INFO]   Rounded: (26, 49)
[INFO]   Nearest: (26.0, 50.0)
[INFO]   Rounded: (116, 181)
[INFO]   Nearest: (116.0, 182.0)
[INFO]   Rounded: (15, 271)
[INFO]   Nearest: (16.0, 270.0)
[INFO]   Rounded: (122, 223)
[INFO]   Nearest: (122.0, 224.0)
[INFO]   Rounded: (178, 211)
[INFO]   Nearest: (178.0, 210.0)
[INFO]   Rounded: (82, 126)
[INFO]   Rounded: (24, 143)
[INFO]   Nearest: (24.0, 144.0)
[INFO]   Rounded: (133, 170)
[INFO]   Nearest: (134.0, 170.0)
[INFO]   Rounded: (245, 265)
[INFO]   Nearest: (246.0, 264.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 126
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] File size: 288521 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(126/142) - Original Sharpe: 0.3438, Trades: 47
[INFO] Kmeans cluster 2: SMA(20/114) - Original Sharpe: 0.2089, Trades: 38
[INFO] Kmeans cluster 3: SMA(118/144) - Original Sharpe: 0.1980, Trades: 39
[INFO] Kmeans cluster 4: SMA(256/284) - Original Sharpe: 0.1327, Trades: 28
[INFO] Kmeans cluster 5: SMA(18/176) - Original Sharpe: 0.1222, Trades: 28
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/126)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (126/142) - Sharpe: 0.3438
[INFO] cluster 2: (20/114) - Sharpe: 0.2089
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] File size: 288521 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.390225           -1.936513
1    2021-11-14 2021-11-14            43     2.404429           -1.284561
2    2022-01-14 2022-01-14            41     1.324381           -0.868048
3    2022-03-14 2022-03-14            44    -0.555883           -0.978061
4    2022-05-14 2022-05-14            43    -0.825815           -3.648856
5    2022-07-14 2022-07-14            44    -0.988424           -0.385516
6    2022-09-14 2022-09-14            43    -3.137421           -1.421497
7    2022-11-14 2022-11-14            43     0.541975            1.373629
8    2023-01-14 2023-01-14            41    -0.915581           -3.901921
9    2023-03-14 2023-03-14            43     0.468407           -0.983402
10   2023-05-14 2023-05-14            44    -0.475481           -2.156310
11   2023-07-14 2023-07-14            44    -0.395339            3.078643
12   2023-09-14 2023-09-14            43     0.952901            2.169123
13   2023-11-14 2023-11-14            42    -0.229236           -3.379086
14   2024-01-14 2024-01-14            43    -2.215671           -0.854874
15   2024-03-14 2024-03-14            42     1.536450            0.862388
16   2024-05-14 2024-05-14            44     0.589741           -0.534214
17   2024-07-14 2024-07-14            45    -0.019681           -2.517239
18   2024-09-14 2024-09-14            43     2.214737           -1.343125
19   2024-11-14 2024-11-14            33     1.167163            3.030917
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.4 |             -1.9 |          0.5 | True          
[INFO] 2021-11-14   |          2.4 |             -1.3 |         -3.7 | False         
[INFO] 2022-01-14   |          1.3 |             -0.9 |         -2.2 | False         
[INFO] 2022-03-14   |         -0.6 |             -1.0 |         -0.4 | False         
[INFO] 2022-05-14   |         -0.8 |             -3.6 |         -2.8 | False         
[INFO] 2022-07-14   |         -1.0 |             -0.4 |          0.6 | True          
[INFO] 2022-09-14   |         -3.1 |             -1.4 |          1.7 | True          
[INFO] 2022-11-14   |          0.5 |              1.4 |          0.9 | True          
[INFO] 2023-01-14   |         -0.9 |             -3.9 |         -3.0 | False         
[INFO] 2023-03-14   |          0.5 |             -1.0 |         -1.5 | False         
[INFO] 2023-05-14   |         -0.5 |             -2.2 |         -1.7 | False         
[INFO] 2023-07-14   |         -0.4 |              3.1 |          3.5 | True          
[INFO] 2023-09-14   |          1.0 |              2.2 |          1.2 | True          
[INFO] 2023-11-14   |         -0.2 |             -3.4 |         -3.2 | False         
[INFO] 2024-01-14   |         -2.2 |             -0.9 |          1.3 | True          
[INFO] 2024-03-14   |          1.5 |              0.9 |         -0.6 | False         
[INFO] 2024-05-14   |          0.6 |             -0.5 |         -1.1 | False         
[INFO] 2024-07-14   |         -0.0 |             -2.5 |         -2.5 | False         
[INFO] 2024-09-14   |          2.2 |             -1.3 |         -3.5 | False         
[INFO] 2024-11-14   |          1.2 |              3.0 |          1.8 | True          
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 8 of 20 periods (40.00% win rate)
[INFO] Updating Excel file with Kmeans results for PL...
[INFO] Excel file updated successfully. Added PL with Kmeans win rate 40.0% in row 40
[INFO] Added best Sharpe parameters 122/126 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 126
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(126/142) - Original Sharpe: 0.3438
[INFO] Added cluster 2 to portfolio: SMA(20/114) - Original Sharpe: 0.2089
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'PL_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.7053
[INFO] Kmeans Best out-of-sample Sharpe: -0.1046
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for PL...
[INFO] Excel file updated successfully. Added PL with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PL
[INFO] Big Point Value: 50.0
[INFO] Slippage: 20.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9850 to 0.4891
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 126
[INFO] Sharpe Ratio: 0.489096
[INFO] Number of Trades: 97
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9850 to 0.4891
[INFO] Trades range: 11.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.2033 to 3.3492
[INFO] Scaled Trades range: -0.9147 to 14.1485
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5795
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 312 elements
[INFO] Cluster 1: 171 elements
[INFO] Cluster 2: 616 elements
[INFO] Cluster 3: 385 elements
[INFO] Cluster 4: 479 elements
[INFO] Cluster 5: 244 elements
[INFO] Cluster 6: 33 elements
[INFO] Cluster 7: 359 elements
[INFO] Cluster 8: 274 elements
[INFO] Cluster 9: 238 elements
[INFO] Cluster 10: 150 elements
[INFO] Cluster 11: 54 elements
[INFO] Cluster 12: 148 elements
[INFO] Cluster 13: 64 elements
[INFO] Cluster 14: 378 elements
[INFO] Cluster 15: 73 elements
[INFO] Cluster 16: 71 elements
[INFO] Cluster 17: 33 elements
[INFO] Cluster 18: 406 elements
[INFO] Cluster 19: 281 elements
[INFO] Cluster 20: 260 elements
[INFO] Cluster 21: 247 elements
[INFO] Cluster 22: 157 elements
[INFO] Cluster 23: 441 elements
[INFO] Cluster 24: 135 elements
[INFO] Cluster 25: 426 elements
[INFO] Cluster 26: 273 elements
[INFO] Cluster 27: 299 elements
[INFO] Cluster 28: 356 elements
[INFO] Cluster 29: 228 elements
[INFO] Cluster 30: 126 elements
[INFO] Cluster 31: 6 elements
[INFO] Cluster 32: 37 elements
[INFO] Cluster 33: 217 elements
[INFO] Cluster 34: 182 elements
[INFO] Cluster 35: 215 elements
[INFO] Cluster 36: 123 elements
[INFO] Cluster 37: 192 elements
[INFO] Cluster 38: 42 elements
[INFO] Cluster 39: 195 elements
[INFO] Cluster 40: 259 elements
[INFO] Cluster 41: 34 elements
[INFO] Cluster 42: 262 elements
[INFO] Cluster 43: 153 elements
[INFO] Cluster 44: 184 elements
[INFO] Cluster 45: 40 elements
[INFO] Cluster 46: 143 elements
[INFO] Cluster 47: 89 elements
[INFO] Cluster 48: 274 elements
[INFO] Cluster 49: 221 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=26, Long SMA=80, Sharpe=-0.2037, Trades=44
[INFO] Cluster 1 cluster: Short SMA=164, Long SMA=194, Sharpe=-0.6285, Trades=39
[INFO] Cluster 2 cluster: Short SMA=172, Long SMA=274, Sharpe=-0.5194, Trades=13
[INFO] Cluster 3 cluster: Short SMA=76, Long SMA=216, Sharpe=-0.6215, Trades=22
[INFO] Cluster 4 cluster: Short SMA=126, Long SMA=206, Sharpe=-0.1477, Trades=20
[INFO] Cluster 5 cluster: Short SMA=18, Long SMA=190, Sharpe=0.0540, Trades=34
[INFO] Cluster 6 cluster: Short SMA=30, Long SMA=32, Sharpe=-0.0852, Trades=186
[INFO] Cluster 7 cluster: Short SMA=34, Long SMA=192, Sharpe=-0.2864, Trades=24
[INFO] Cluster 8 cluster: Short SMA=56, Long SMA=112, Sharpe=-0.7207, Trades=34
[INFO] Cluster 9 cluster: Short SMA=84, Long SMA=134, Sharpe=-0.2490, Trades=30
[INFO] Cluster 10 cluster: Short SMA=180, Long SMA=200, Sharpe=-0.8905, Trades=43
[INFO] Cluster 11 cluster: Short SMA=80, Long SMA=86, Sharpe=-0.5097, Trades=87
[INFO] Cluster 12 cluster: Short SMA=272, Long SMA=284, Sharpe=0.0523, Trades=45
[INFO] Cluster 13 cluster: Short SMA=106, Long SMA=114, Sharpe=-0.1456, Trades=68
[INFO] Cluster 14 cluster: Short SMA=40, Long SMA=224, Sharpe=-0.2958, Trades=24
[INFO] Cluster 15 cluster: Short SMA=26, Long SMA=34, Sharpe=-0.0893, Trades=102
[INFO] Cluster 16 cluster: Short SMA=236, Long SMA=240, Sharpe=-0.2128, Trades=83
[INFO] Cluster 17 cluster: Short SMA=134, Long SMA=136, Sharpe=0.0653, Trades=129
[INFO] Cluster 18 cluster: Short SMA=60, Long SMA=266, Sharpe=-0.5358, Trades=20
[INFO] Cluster 19 cluster: Short SMA=122, Long SMA=204, Sharpe=-0.0996, Trades=20
[INFO] Cluster 20 cluster: Short SMA=218, Long SMA=248, Sharpe=-0.3160, Trades=31
[INFO] Cluster 21 cluster: Short SMA=132, Long SMA=166, Sharpe=0.0122, Trades=36
[INFO] Cluster 22 cluster: Short SMA=26, Long SMA=44, Sharpe=-0.1448, Trades=78
[INFO] Cluster 23 cluster: Short SMA=74, Long SMA=128, Sharpe=-0.4180, Trades=33
[INFO] Cluster 24 cluster: Short SMA=120, Long SMA=134, Sharpe=0.1051, Trades=53
[INFO] Cluster 25 cluster: Short SMA=116, Long SMA=268, Sharpe=-0.0501, Trades=16
[INFO] Cluster 26 cluster: Short SMA=68, Long SMA=288, Sharpe=-0.3671, Trades=18
[INFO] Cluster 27 cluster: Short SMA=78, Long SMA=184, Sharpe=-0.4580, Trades=20
[INFO] Cluster 28 cluster: Short SMA=182, Long SMA=234, Sharpe=-0.6989, Trades=23
[INFO] Cluster 29 cluster: Short SMA=20, Long SMA=142, Sharpe=-0.1463, Trades=36
[INFO] Cluster 30 cluster: Short SMA=256, Long SMA=286, Sharpe=0.1131, Trades=28
[INFO] Cluster 32 cluster: Short SMA=196, Long SMA=198, Sharpe=-0.7240, Trades=113
[INFO] Cluster 33 cluster: Short SMA=98, Long SMA=260, Sharpe=-0.0758, Trades=14
[INFO] Cluster 34 cluster: Short SMA=40, Long SMA=74, Sharpe=-0.2633, Trades=48
[INFO] Cluster 35 cluster: Short SMA=90, Long SMA=228, Sharpe=-0.4460, Trades=18
[INFO] Cluster 36 cluster: Short SMA=20, Long SMA=112, Sharpe=0.1920, Trades=40
[INFO] Cluster 37 cluster: Short SMA=18, Long SMA=264, Sharpe=-0.3988, Trades=30
[INFO] Cluster 38 cluster: Short SMA=256, Long SMA=258, Sharpe=-0.1841, Trades=110
[INFO] Cluster 39 cluster: Short SMA=28, Long SMA=280, Sharpe=-0.6239, Trades=26
[INFO] Cluster 40 cluster: Short SMA=222, Long SMA=286, Sharpe=0.0187, Trades=15
[INFO] Cluster 41 cluster: Short SMA=36, Long SMA=40, Sharpe=-0.0476, Trades=132
[INFO] Cluster 42 cluster: Short SMA=52, Long SMA=164, Sharpe=-0.2323, Trades=24
[INFO] Cluster 43 cluster: Short SMA=224, Long SMA=240, Sharpe=-0.1494, Trades=45
[INFO] Cluster 44 cluster: Short SMA=130, Long SMA=162, Sharpe=0.0573, Trades=36
[INFO] Cluster 45 cluster: Short SMA=128, Long SMA=134, Sharpe=0.0496, Trades=89
[INFO] Cluster 46 cluster: Short SMA=158, Long SMA=234, Sharpe=-0.4870, Trades=17
[INFO] Cluster 47 cluster: Short SMA=70, Long SMA=84, Sharpe=-0.5669, Trades=55
[INFO] Cluster 48 cluster: Short SMA=138, Long SMA=284, Sharpe=-0.2238, Trades=12
[INFO] Cluster 49 cluster: Short SMA=212, Long SMA=274, Sharpe=-0.1171, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=126, Sharpe=0.4891, Trades=97
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=20, Long SMA=112, Sharpe=0.1920, Trades=40
[INFO] Top 2: Short SMA=256, Long SMA=286, Sharpe=0.1131, Trades=28
[INFO] Top 3: Short SMA=120, Long SMA=134, Sharpe=0.1051, Trades=53
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10579 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 126
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] File size: 288521 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(20/112) - Original Sharpe: 0.1920, Trades: 40
[INFO] Hierarchical cluster 2: SMA(256/286) - Original Sharpe: 0.1131, Trades: 28
[INFO] Hierarchical cluster 3: SMA(120/134) - Original Sharpe: 0.1051, Trades: 53
[INFO] Hierarchical cluster 4: SMA(134/136) - Original Sharpe: 0.0653, Trades: 129
[INFO] Hierarchical cluster 5: SMA(130/162) - Original Sharpe: 0.0573, Trades: 36
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/126)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 126
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PL
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for RB in column D: 22.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.79s
[INFO] Best parameters: Short SMA = 42, Long SMA = 50
[INFO] Best Sharpe ratio: 0.800794, Trades: 96
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @RB
[INFO] Big Point Value (from data): 42000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.08 contracts
[INFO] Maximum Position Size: 5 contracts
[INFO] Strategy Total P&L: $291,724.40
[INFO] Market Buy & Hold P&L: $61,933.20
[INFO] Outperformance: $229,791.20
[INFO] Sharpe ratio (entire period, annualized): 0.421463
[INFO] Sharpe ratio (in-sample, annualized): 0.800794
[INFO] Sharpe ratio (out-of-sample, annualized): -0.404535
[INFO] Maximum Drawdown: $177,916.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 68
[INFO] Out-of-sample period trades: 28
[INFO] Total trades: 96
[INFO] In-sample P&L: $477,036.20
[INFO] Out-of-sample P&L: $-110,507.20
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 50, Sharpe = 0.800794
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.0498 to 0.8008
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.800794
[INFO] Number of Trades: 96
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.0498 to 0.8008
[INFO] Trades range: 10.0 to 319.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8627 to 2.8926
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 257 elements
[INFO] Kmeans Cluster 1: 197 elements
[INFO] Kmeans Cluster 2: 266 elements
[INFO] Kmeans Cluster 3: 207 elements
[INFO] Kmeans Cluster 4: 144 elements
[INFO] Kmeans Cluster 5: 255 elements
[INFO] Kmeans Cluster 6: 247 elements
[INFO] Kmeans Cluster 7: 218 elements
[INFO] Kmeans Cluster 8: 256 elements
[INFO] Kmeans Cluster 9: 302 elements
[INFO] Kmeans Cluster 10: 292 elements
[INFO] Kmeans Cluster 11: 172 elements
[INFO] Kmeans Cluster 12: 274 elements
[INFO] Kmeans Cluster 13: 233 elements
[INFO] Kmeans Cluster 14: 137 elements
[INFO] Kmeans Cluster 15: 264 elements
[INFO] Kmeans Cluster 16: 116 elements
[INFO] Kmeans Cluster 17: 223 elements
[INFO] Kmeans Cluster 18: 231 elements
[INFO] Kmeans Cluster 19: 240 elements
[INFO] Kmeans Cluster 20: 104 elements
[INFO] Kmeans Cluster 21: 216 elements
[INFO] Kmeans Cluster 22: 236 elements
[INFO] Kmeans Cluster 23: 54 elements
[INFO] Kmeans Cluster 24: 128 elements
[INFO] Kmeans Cluster 25: 142 elements
[INFO] Kmeans Cluster 26: 195 elements
[INFO] Kmeans Cluster 27: 257 elements
[INFO] Kmeans Cluster 28: 238 elements
[INFO] Kmeans Cluster 29: 387 elements
[INFO] Kmeans Cluster 30: 176 elements
[INFO] Kmeans Cluster 31: 248 elements
[INFO] Kmeans Cluster 32: 180 elements
[INFO] Kmeans Cluster 33: 230 elements
[INFO] Kmeans Cluster 34: 210 elements
[INFO] Kmeans Cluster 35: 136 elements
[INFO] Kmeans Cluster 36: 214 elements
[INFO] Kmeans Cluster 37: 127 elements
[INFO] Kmeans Cluster 38: 207 elements
[INFO] Kmeans Cluster 39: 274 elements
[INFO] Kmeans Cluster 40: 120 elements
[INFO] Kmeans Cluster 41: 213 elements
[INFO] Kmeans Cluster 42: 113 elements
[INFO] Kmeans Cluster 43: 254 elements
[INFO] Kmeans Cluster 44: 267 elements
[INFO] Kmeans Cluster 45: 282 elements
[INFO] Kmeans Cluster 46: 196 elements
[INFO] Kmeans Cluster 47: 213 elements
[INFO] Kmeans Cluster 48: 207 elements
[INFO] Kmeans Cluster 49: 230 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=25.31, Long SMA=117.23, Sharpe=0.3954
[INFO] Centroid 1: Short SMA=141.09, Long SMA=224.76, Sharpe=0.0657
[INFO] Centroid 2: Short SMA=35.74, Long SMA=200.68, Sharpe=-0.1138
[INFO] Centroid 3: Short SMA=238.08, Long SMA=285.64, Sharpe=-0.9004
[INFO] Centroid 4: Short SMA=98.53, Long SMA=124.10, Sharpe=-0.4158
[INFO] Centroid 5: Short SMA=169.66, Long SMA=286.41, Sharpe=-0.4692
[INFO] Centroid 6: Short SMA=67.70, Long SMA=106.49, Sharpe=0.1329
[INFO] Centroid 7: Short SMA=34.75, Long SMA=247.17, Sharpe=0.1945
[INFO] Centroid 8: Short SMA=89.54, Long SMA=218.16, Sharpe=-0.1831
[INFO] Centroid 9: Short SMA=219.93, Long SMA=246.42, Sharpe=-0.1993
[INFO] Centroid 10: Short SMA=111.78, Long SMA=164.84, Sharpe=-0.3214
[INFO] Centroid 11: Short SMA=32.40, Long SMA=55.64, Sharpe=0.4036
[INFO] Centroid 12: Short SMA=116.25, Long SMA=243.77, Sharpe=-0.2181
[INFO] Centroid 13: Short SMA=25.02, Long SMA=176.53, Sharpe=0.0246
[INFO] Centroid 14: Short SMA=276.32, Long SMA=292.25, Sharpe=-0.4795
[INFO] Centroid 15: Short SMA=61.55, Long SMA=283.27, Sharpe=-0.1331
[INFO] Centroid 16: Short SMA=142.05, Long SMA=189.21, Sharpe=-0.1701
[INFO] Centroid 17: Short SMA=133.05, Long SMA=163.30, Sharpe=-0.5476
[INFO] Centroid 18: Short SMA=27.16, Long SMA=143.03, Sharpe=0.2081
[INFO] Centroid 19: Short SMA=32.37, Long SMA=282.11, Sharpe=0.1360
[INFO] Centroid 20: Short SMA=156.98, Long SMA=174.79, Sharpe=0.2195
[INFO] Centroid 21: Short SMA=172.93, Long SMA=222.69, Sharpe=0.1436
[INFO] Centroid 22: Short SMA=40.53, Long SMA=78.40, Sharpe=0.5903
[INFO] Centroid 23: Short SMA=23.07, Long SMA=35.93, Sharpe=-0.0766
[INFO] Centroid 24: Short SMA=228.00, Long SMA=265.61, Sharpe=-0.4569
[INFO] Centroid 25: Short SMA=126.24, Long SMA=285.79, Sharpe=-0.6210
[INFO] Centroid 26: Short SMA=58.44, Long SMA=134.52, Sharpe=0.0148
[INFO] Centroid 27: Short SMA=150.57, Long SMA=251.07, Sharpe=-0.0736
[INFO] Centroid 28: Short SMA=191.45, Long SMA=249.62, Sharpe=-0.0954
[INFO] Centroid 29: Short SMA=73.81, Long SMA=194.03, Sharpe=-0.3320
[INFO] Centroid 30: Short SMA=204.33, Long SMA=289.01, Sharpe=-0.6698
[INFO] Centroid 31: Short SMA=117.07, Long SMA=200.01, Sharpe=-0.4035
[INFO] Centroid 32: Short SMA=20.91, Long SMA=86.31, Sharpe=0.4550
[INFO] Centroid 33: Short SMA=51.49, Long SMA=162.01, Sharpe=-0.1521
[INFO] Centroid 34: Short SMA=198.77, Long SMA=221.39, Sharpe=-0.0029
[INFO] Centroid 35: Short SMA=18.26, Long SMA=41.01, Sharpe=0.1917
[INFO] Centroid 36: Short SMA=172.06, Long SMA=271.25, Sharpe=-0.2750
[INFO] Centroid 37: Short SMA=14.27, Long SMA=275.54, Sharpe=-0.0786
[INFO] Centroid 38: Short SMA=253.57, Long SMA=279.01, Sharpe=-0.7403
[INFO] Centroid 39: Short SMA=24.34, Long SMA=224.90, Sharpe=0.0186
[INFO] Centroid 40: Short SMA=179.62, Long SMA=199.33, Sharpe=-0.2586
[INFO] Centroid 41: Short SMA=66.83, Long SMA=85.52, Sharpe=0.3276
[INFO] Centroid 42: Short SMA=127.52, Long SMA=292.16, Sharpe=-0.7736
[INFO] Centroid 43: Short SMA=80.92, Long SMA=158.98, Sharpe=-0.4054
[INFO] Centroid 44: Short SMA=59.03, Long SMA=245.93, Sharpe=0.0306
[INFO] Centroid 45: Short SMA=101.79, Long SMA=128.71, Sharpe=-0.1806
[INFO] Centroid 46: Short SMA=87.80, Long SMA=282.49, Sharpe=-0.1886
[INFO] Centroid 47: Short SMA=158.70, Long SMA=190.78, Sharpe=0.0145
[INFO] Centroid 48: Short SMA=114.07, Long SMA=273.62, Sharpe=-0.4328
[INFO] Centroid 49: Short SMA=84.28, Long SMA=248.18, Sharpe=-0.0416
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=50, Sharpe=0.8008, Trades=96
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=42, Long SMA=80, Sharpe=0.6230, Trades=38
[INFO] Kmeans Top 2: Short SMA=34, Long SMA=56, Sharpe=0.4735, Trades=58
[INFO] Kmeans Top 3: Short SMA=20, Long SMA=86, Sharpe=0.3878, Trades=44
[INFO] Kmeans Top 4: Short SMA=66, Long SMA=84, Sharpe=0.3575, Trades=45
[INFO] Kmeans Top 5: Short SMA=26, Long SMA=116, Sharpe=0.3309, Trades=29
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (25, 117)
[INFO]   Nearest: (26.0, 118.0)
[INFO]   Rounded: (141, 225)
[INFO]   Nearest: (142.0, 224.0)
[INFO]   Rounded: (36, 201)
[INFO]   Nearest: (36.0, 200.0)
[INFO]   Rounded: (238, 286)
[INFO]   Rounded: (99, 124)
[INFO]   Nearest: (98.0, 124.0)
[INFO]   Rounded: (170, 286)
[INFO]   Rounded: (68, 106)
[INFO]   Rounded: (35, 247)
[INFO]   Nearest: (34.0, 248.0)
[INFO]   Rounded: (90, 218)
[INFO]   Rounded: (220, 246)
[INFO]   Rounded: (112, 165)
[INFO]   Nearest: (112.0, 164.0)
[INFO]   Rounded: (32, 56)
[INFO]   Rounded: (116, 244)
[INFO]   Rounded: (25, 177)
[INFO]   Nearest: (26.0, 176.0)
[INFO]   Rounded: (276, 292)
[INFO]   Rounded: (62, 283)
[INFO]   Nearest: (62.0, 284.0)
[INFO]   Rounded: (142, 189)
[INFO]   Nearest: (142.0, 190.0)
[INFO]   Rounded: (133, 163)
[INFO]   Nearest: (134.0, 164.0)
[INFO]   Rounded: (27, 143)
[INFO]   Nearest: (28.0, 144.0)
[INFO]   Rounded: (32, 282)
[INFO]   Rounded: (157, 175)
[INFO]   Nearest: (156.0, 174.0)
[INFO]   Rounded: (173, 223)
[INFO]   Nearest: (172.0, 222.0)
[INFO]   Rounded: (41, 78)
[INFO]   Nearest: (40.0, 78.0)
[INFO]   Rounded: (23, 36)
[INFO]   Nearest: (24.0, 36.0)
[INFO]   Rounded: (228, 266)
[INFO]   Rounded: (126, 286)
[INFO]   Rounded: (58, 135)
[INFO]   Nearest: (58.0, 134.0)
[INFO]   Rounded: (151, 251)
[INFO]   Nearest: (150.0, 252.0)
[INFO]   Rounded: (191, 250)
[INFO]   Nearest: (192.0, 250.0)
[INFO]   Rounded: (74, 194)
[INFO]   Rounded: (204, 289)
[INFO]   Nearest: (204.0, 290.0)
[INFO]   Rounded: (117, 200)
[INFO]   Nearest: (118.0, 200.0)
[INFO]   Rounded: (21, 86)
[INFO]   Nearest: (20.0, 86.0)
[INFO]   Rounded: (51, 162)
[INFO]   Nearest: (52.0, 162.0)
[INFO]   Rounded: (199, 221)
[INFO]   Nearest: (198.0, 222.0)
[INFO]   Rounded: (18, 41)
[INFO]   Nearest: (18.0, 42.0)
[INFO]   Rounded: (172, 271)
[INFO]   Nearest: (172.0, 272.0)
[INFO]   Rounded: (14, 276)
[INFO]   Rounded: (254, 279)
[INFO]   Nearest: (254.0, 280.0)
[INFO]   Rounded: (24, 225)
[INFO]   Nearest: (24.0, 224.0)
[INFO]   Rounded: (180, 199)
[INFO]   Nearest: (180.0, 200.0)
[INFO]   Rounded: (67, 86)
[INFO]   Nearest: (66.0, 86.0)
[INFO]   Rounded: (128, 292)
[INFO]   Rounded: (81, 159)
[INFO]   Nearest: (80.0, 158.0)
[INFO]   Rounded: (59, 246)
[INFO]   Nearest: (60.0, 246.0)
[INFO]   Rounded: (102, 129)
[INFO]   Nearest: (102.0, 128.0)
[INFO]   Rounded: (88, 282)
[INFO]   Rounded: (159, 191)
[INFO]   Nearest: (158.0, 190.0)
[INFO]   Rounded: (114, 274)
[INFO]   Rounded: (84, 248)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(42/80) - Original Sharpe: 0.6230, Trades: 38
[INFO] Kmeans cluster 2: SMA(34/56) - Original Sharpe: 0.4735, Trades: 58
[INFO] Kmeans cluster 3: SMA(20/86) - Original Sharpe: 0.3878, Trades: 44
[INFO] Kmeans cluster 4: SMA(66/84) - Original Sharpe: 0.3575, Trades: 45
[INFO] Kmeans cluster 5: SMA(26/116) - Original Sharpe: 0.3309, Trades: 29
[INFO] Trimmed warm-up period. Evaluation data length: 2838
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (42/80) - Sharpe: 0.6230
[INFO] cluster 2: (34/56) - Sharpe: 0.4735
[INFO] cluster 3: (20/86) - Sharpe: 0.3878
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.735456            2.522680
1    2021-11-14 2021-11-14            43    -2.165624           -1.890882
2    2022-01-14 2022-01-14            41     1.793648            2.645752
3    2022-03-14 2022-03-14            44    -0.267645            2.625333
4    2022-05-14 2022-05-14            43    -1.664283           -1.664283
5    2022-07-14 2022-07-14            44     2.545316            0.673691
6    2022-09-14 2022-09-14            43    -1.824873           -3.004190
7    2022-11-14 2022-11-14            43    -2.147754           -2.804907
8    2023-01-14 2023-01-14            41     0.173521           -1.457560
9    2023-03-14 2023-03-14            43    -5.761990           -4.200758
10   2023-05-14 2023-05-14            44     1.051850            3.874442
11   2023-07-14 2023-07-14            44     2.639646            2.639646
12   2023-09-14 2023-09-14            43     0.320827           -3.152078
13   2023-11-14 2023-11-14            42     0.697919            0.891761
14   2024-01-14 2024-01-14            43     0.380540            0.263405
15   2024-03-14 2024-03-14            42    -1.088742           -1.088742
16   2024-05-14 2024-05-14            44    -0.468733           -2.501065
17   2024-07-14 2024-07-14            45     0.730155            2.912206
18   2024-09-14 2024-09-14            43    -2.244826           -0.857076
19   2024-11-14 2024-11-14            33     0.455012           -0.630197
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |              2.5 |          4.2 | True          
[INFO] 2021-11-14   |         -2.2 |             -1.9 |          0.3 | True          
[INFO] 2022-01-14   |          1.8 |              2.6 |          0.8 | True          
[INFO] 2022-03-14   |         -0.3 |              2.6 |          2.9 | True          
[INFO] 2022-05-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.5 |              0.7 |         -1.8 | False         
[INFO] 2022-09-14   |         -1.8 |             -3.0 |         -1.2 | False         
[INFO] 2022-11-14   |         -2.1 |             -2.8 |         -0.7 | False         
[INFO] 2023-01-14   |          0.2 |             -1.5 |         -1.7 | False         
[INFO] 2023-03-14   |         -5.8 |             -4.2 |          1.6 | True          
[INFO] 2023-05-14   |          1.1 |              3.9 |          2.8 | True          
[INFO] 2023-07-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          0.3 |             -3.2 |         -3.5 | False         
[INFO] 2023-11-14   |          0.7 |              0.9 |          0.2 | True          
[INFO] 2024-01-14   |          0.4 |              0.3 |         -0.1 | False         
[INFO] 2024-03-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -0.5 |             -2.5 |         -2.0 | False         
[INFO] 2024-07-14   |          0.7 |              2.9 |          2.2 | True          
[INFO] 2024-09-14   |         -2.2 |             -0.9 |          1.3 | True          
[INFO] 2024-11-14   |          0.5 |             -0.6 |         -1.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2023-07-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 9 of 17 periods (52.94% win rate)
[INFO] Updating Excel file with Kmeans results for RB...
[INFO] Excel file updated successfully. Added RB with Kmeans win rate 52.9% in row 41
[INFO] Added best Sharpe parameters 42/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(42/80) - Original Sharpe: 0.6230
[INFO] Added cluster 2 to portfolio: SMA(34/56) - Original Sharpe: 0.4735
[INFO] Added cluster 3 to portfolio: SMA(20/86) - Original Sharpe: 0.3878
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RB_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1102
[INFO] Kmeans Best out-of-sample Sharpe: -0.4045
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for RB...
[INFO] Excel file updated successfully. Added RB with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RB
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.0498 to 0.8008
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.800794
[INFO] Number of Trades: 96
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.0498 to 0.8008
[INFO] Trades range: 10.0 to 319.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8627 to 2.8926
[INFO] Scaled Trades range: -0.8928 to 15.4926
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6084
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 472 elements
[INFO] Cluster 1: 245 elements
[INFO] Cluster 2: 322 elements
[INFO] Cluster 3: 412 elements
[INFO] Cluster 4: 52 elements
[INFO] Cluster 5: 155 elements
[INFO] Cluster 6: 197 elements
[INFO] Cluster 7: 344 elements
[INFO] Cluster 8: 400 elements
[INFO] Cluster 9: 377 elements
[INFO] Cluster 10: 123 elements
[INFO] Cluster 11: 282 elements
[INFO] Cluster 12: 256 elements
[INFO] Cluster 13: 255 elements
[INFO] Cluster 14: 146 elements
[INFO] Cluster 15: 532 elements
[INFO] Cluster 16: 344 elements
[INFO] Cluster 17: 93 elements
[INFO] Cluster 18: 228 elements
[INFO] Cluster 19: 446 elements
[INFO] Cluster 20: 270 elements
[INFO] Cluster 21: 7 elements
[INFO] Cluster 22: 425 elements
[INFO] Cluster 23: 124 elements
[INFO] Cluster 24: 187 elements
[INFO] Cluster 25: 28 elements
[INFO] Cluster 26: 397 elements
[INFO] Cluster 27: 165 elements
[INFO] Cluster 28: 109 elements
[INFO] Cluster 29: 320 elements
[INFO] Cluster 30: 178 elements
[INFO] Cluster 31: 219 elements
[INFO] Cluster 32: 295 elements
[INFO] Cluster 33: 44 elements
[INFO] Cluster 34: 272 elements
[INFO] Cluster 35: 71 elements
[INFO] Cluster 36: 191 elements
[INFO] Cluster 37: 29 elements
[INFO] Cluster 38: 203 elements
[INFO] Cluster 39: 84 elements
[INFO] Cluster 40: 163 elements
[INFO] Cluster 41: 152 elements
[INFO] Cluster 42: 30 elements
[INFO] Cluster 43: 17 elements
[INFO] Cluster 44: 286 elements
[INFO] Cluster 45: 145 elements
[INFO] Cluster 46: 169 elements
[INFO] Cluster 47: 34 elements
[INFO] Cluster 48: 126 elements
[INFO] Cluster 49: 164 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=178, Long SMA=246, Sharpe=-0.0665, Trades=20
[INFO] Cluster 1 cluster: Short SMA=202, Long SMA=284, Sharpe=-0.6629, Trades=18
[INFO] Cluster 2 cluster: Short SMA=218, Long SMA=250, Sharpe=-0.2792, Trades=22
[INFO] Cluster 3 cluster: Short SMA=126, Long SMA=250, Sharpe=-0.2085, Trades=18
[INFO] Cluster 4 cluster: Short SMA=128, Long SMA=130, Sharpe=-0.1576, Trades=85
[INFO] Cluster 5 cluster: Short SMA=116, Long SMA=128, Sharpe=-0.1055, Trades=38
[INFO] Cluster 6 cluster: Short SMA=132, Long SMA=158, Sharpe=-0.4824, Trades=29
[INFO] Cluster 7 cluster: Short SMA=170, Long SMA=280, Sharpe=-0.2724, Trades=14
[INFO] Cluster 8 cluster: Short SMA=238, Long SMA=286, Sharpe=-0.9548, Trades=19
[INFO] Cluster 9 cluster: Short SMA=50, Long SMA=172, Sharpe=-0.1267, Trades=22
[INFO] Cluster 10 cluster: Short SMA=20, Long SMA=42, Sharpe=0.0084, Trades=80
[INFO] Cluster 11 cluster: Short SMA=26, Long SMA=220, Sharpe=-0.1399, Trades=27
[INFO] Cluster 12 cluster: Short SMA=126, Long SMA=288, Sharpe=-0.7376, Trades=14
[INFO] Cluster 13 cluster: Short SMA=42, Long SMA=90, Sharpe=0.6355, Trades=35
[INFO] Cluster 14 cluster: Short SMA=68, Long SMA=84, Sharpe=0.3465, Trades=47
[INFO] Cluster 15 cluster: Short SMA=78, Long SMA=192, Sharpe=-0.3043, Trades=20
[INFO] Cluster 16 cluster: Short SMA=36, Long SMA=274, Sharpe=0.1229, Trades=14
[INFO] Cluster 17 cluster: Short SMA=176, Long SMA=182, Sharpe=0.0287, Trades=51
[INFO] Cluster 18 cluster: Short SMA=96, Long SMA=130, Sharpe=-0.2624, Trades=26
[INFO] Cluster 19 cluster: Short SMA=72, Long SMA=282, Sharpe=-0.1361, Trades=12
[INFO] Cluster 20 cluster: Short SMA=176, Long SMA=222, Sharpe=0.1002, Trades=20
[INFO] Cluster 22 cluster: Short SMA=94, Long SMA=160, Sharpe=-0.4204, Trades=20
[INFO] Cluster 23 cluster: Short SMA=274, Long SMA=294, Sharpe=-0.5406, Trades=25
[INFO] Cluster 24 cluster: Short SMA=170, Long SMA=200, Sharpe=-0.3019, Trades=25
[INFO] Cluster 25 cluster: Short SMA=272, Long SMA=274, Sharpe=-0.7232, Trades=71
[INFO] Cluster 26 cluster: Short SMA=70, Long SMA=248, Sharpe=0.0687, Trades=14
[INFO] Cluster 27 cluster: Short SMA=16, Long SMA=276, Sharpe=0.0465, Trades=28
[INFO] Cluster 28 cluster: Short SMA=34, Long SMA=52, Sharpe=0.3856, Trades=68
[INFO] Cluster 29 cluster: Short SMA=92, Long SMA=224, Sharpe=-0.3119, Trades=22
[INFO] Cluster 30 cluster: Short SMA=24, Long SMA=150, Sharpe=0.2931, Trades=27
[INFO] Cluster 31 cluster: Short SMA=114, Long SMA=274, Sharpe=-0.5213, Trades=14
[INFO] Cluster 32 cluster: Short SMA=64, Long SMA=110, Sharpe=0.0960, Trades=27
[INFO] Cluster 33 cluster: Short SMA=32, Long SMA=38, Sharpe=-0.0730, Trades=122
[INFO] Cluster 34 cluster: Short SMA=120, Long SMA=198, Sharpe=-0.6046, Trades=21
[INFO] Cluster 35 cluster: Short SMA=226, Long SMA=230, Sharpe=-0.2189, Trades=50
[INFO] Cluster 36 cluster: Short SMA=28, Long SMA=122, Sharpe=0.2883, Trades=27
[INFO] Cluster 37 cluster: Short SMA=24, Long SMA=28, Sharpe=0.4863, Trades=147
[INFO] Cluster 38 cluster: Short SMA=22, Long SMA=72, Sharpe=0.5452, Trades=50
[INFO] Cluster 39 cluster: Short SMA=260, Long SMA=270, Sharpe=-0.9132, Trades=37
[INFO] Cluster 40 cluster: Short SMA=158, Long SMA=182, Sharpe=0.2142, Trades=27
[INFO] Cluster 41 cluster: Short SMA=14, Long SMA=192, Sharpe=-0.0487, Trades=37
[INFO] Cluster 42 cluster: Short SMA=192, Long SMA=194, Sharpe=-0.1167, Trades=80
[INFO] Cluster 44 cluster: Short SMA=142, Long SMA=216, Sharpe=0.0599, Trades=19
[INFO] Cluster 45 cluster: Short SMA=38, Long SMA=236, Sharpe=0.2968, Trades=20
[INFO] Cluster 46 cluster: Short SMA=58, Long SMA=134, Sharpe=0.0234, Trades=22
[INFO] Cluster 47 cluster: Short SMA=60, Long SMA=64, Sharpe=0.5439, Trades=105
[INFO] Cluster 48 cluster: Short SMA=20, Long SMA=100, Sharpe=0.4060, Trades=42
[INFO] Cluster 49 cluster: Short SMA=28, Long SMA=178, Sharpe=-0.0252, Trades=29
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=50, Sharpe=0.8008, Trades=96
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=42, Long SMA=90, Sharpe=0.6355, Trades=35
[INFO] Top 2: Short SMA=22, Long SMA=72, Sharpe=0.5452, Trades=50
[INFO] Top 3: Short SMA=60, Long SMA=64, Sharpe=0.5439, Trades=105
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10561 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(42/90) - Original Sharpe: 0.6355, Trades: 35
[INFO] Hierarchical cluster 2: SMA(22/72) - Original Sharpe: 0.5452, Trades: 50
[INFO] Hierarchical cluster 3: SMA(60/64) - Original Sharpe: 0.5439, Trades: 105
[INFO] Hierarchical cluster 4: SMA(24/28) - Original Sharpe: 0.4863, Trades: 147
[INFO] Hierarchical cluster 5: SMA(20/100) - Original Sharpe: 0.4060, Trades: 42
[INFO] Trimmed warm-up period. Evaluation data length: 2838
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (42/90) - Sharpe: 0.6355
[INFO] cluster 2: (22/72) - Sharpe: 0.5452
[INFO] cluster 3: (60/64) - Sharpe: 0.5439
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.735456            2.522680
1    2021-11-14 2021-11-14            43    -2.165624           -1.220792
2    2022-01-14 2022-01-14            41     1.793648            1.714653
3    2022-03-14 2022-03-14            44    -0.267645            2.625333
4    2022-05-14 2022-05-14            43    -1.664283           -2.296185
5    2022-07-14 2022-07-14            44     2.545316            1.105075
6    2022-09-14 2022-09-14            43    -1.824873           -2.625909
7    2022-11-14 2022-11-14            43    -2.147754           -1.334633
8    2023-01-14 2023-01-14            41     0.173521            0.096931
9    2023-03-14 2023-03-14            43    -5.761990           -2.060383
10   2023-05-14 2023-05-14            44     1.051850           -2.666823
11   2023-07-14 2023-07-14            44     2.639646            2.844248
12   2023-09-14 2023-09-14            43     0.320827           -3.276833
13   2023-11-14 2023-11-14            42     0.697919            0.712261
14   2024-01-14 2024-01-14            43     0.380540            0.055574
15   2024-03-14 2024-03-14            42    -1.088742           -1.088742
16   2024-05-14 2024-05-14            44    -0.468733           -1.660786
17   2024-07-14 2024-07-14            45     0.730155            1.727778
18   2024-09-14 2024-09-14            43    -2.244826           -1.274846
19   2024-11-14 2024-11-14            33     0.455012           -0.963783
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |              2.5 |          4.2 | True          
[INFO] 2021-11-14   |         -2.2 |             -1.2 |          1.0 | True          
[INFO] 2022-01-14   |          1.8 |              1.7 |         -0.1 | False         
[INFO] 2022-03-14   |         -0.3 |              2.6 |          2.9 | True          
[INFO] 2022-05-14   |         -1.7 |             -2.3 |         -0.6 | False         
[INFO] 2022-07-14   |          2.5 |              1.1 |         -1.4 | False         
[INFO] 2022-09-14   |         -1.8 |             -2.6 |         -0.8 | False         
[INFO] 2022-11-14   |         -2.1 |             -1.3 |          0.8 | True          
[INFO] 2023-01-14   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2023-03-14   |         -5.8 |             -2.1 |          3.7 | True          
[INFO] 2023-05-14   |          1.1 |             -2.7 |         -3.8 | False         
[INFO] 2023-07-14   |          2.6 |              2.8 |          0.2 | True          
[INFO] 2023-09-14   |          0.3 |             -3.3 |         -3.6 | False         
[INFO] 2023-11-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-01-14   |          0.4 |              0.1 |         -0.3 | False         
[INFO] 2024-03-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -0.5 |             -1.7 |         -1.2 | False         
[INFO] 2024-07-14   |          0.7 |              1.7 |          1.0 | True          
[INFO] 2024-09-14   |         -2.2 |             -1.3 |          0.9 | True          
[INFO] 2024-11-14   |          0.5 |             -1.0 |         -1.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-11-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 18 periods (44.44% win rate)
[INFO] Updating Excel file with Hierarchical results for RB...
[INFO] Excel file updated successfully. Added RB with Hierarchical win rate 44.4% in row 41
[INFO] Added best Sharpe parameters 42/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(42/90) - Original Sharpe: 0.6355
[INFO] Added cluster 2 to portfolio: SMA(22/72) - Original Sharpe: 0.5452
[INFO] Added cluster 3 to portfolio: SMA(60/64) - Original Sharpe: 0.5439
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RB_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1782
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4045
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for RB...
[INFO] Excel file updated successfully. Added RB with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RB
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for RTY in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.28s
[INFO] Best parameters: Short SMA = 122, Long SMA = 142
[INFO] Best Sharpe ratio: 0.356940, Trades: 40
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 3 bad combos; keeping 2115 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @RTY
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.21 contracts
[INFO] Maximum Position Size: 11 contracts
[INFO] Strategy Total P&L: $181,223.00
[INFO] Market Buy & Hold P&L: $47,790.00
[INFO] Outperformance: $133,433.00
[INFO] Sharpe ratio (entire period, annualized): 0.190911
[INFO] Sharpe ratio (in-sample, annualized): 0.356940
[INFO] Sharpe ratio (out-of-sample, annualized): -0.184654
[INFO] Maximum Drawdown: $212,021.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 18
[INFO] Out-of-sample period trades: 22
[INFO] Total trades: 40
[INFO] In-sample P&L: $206,561.00
[INFO] Out-of-sample P&L: $-47,237.00
[INFO] 
Best parameters from GA: Short SMA = 122, Long SMA = 142, Sharpe = 0.356940
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.0509 to 0.3569
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 142
[INFO] Sharpe Ratio: 0.356940
[INFO] Number of Trades: 40
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10582 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.0509 to 0.3569
[INFO] Trades range: 10.0 to 329.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3995 to 2.7991
[INFO] Scaled Long SMA range: -2.7993 to 1.4002
[INFO] Scaled Sharpe ratio range: -4.4788 to 3.0252
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 347 elements
[INFO] Kmeans Cluster 1: 380 elements
[INFO] Kmeans Cluster 2: 217 elements
[INFO] Kmeans Cluster 3: 278 elements
[INFO] Kmeans Cluster 4: 213 elements
[INFO] Kmeans Cluster 5: 231 elements
[INFO] Kmeans Cluster 6: 158 elements
[INFO] Kmeans Cluster 7: 187 elements
[INFO] Kmeans Cluster 8: 288 elements
[INFO] Kmeans Cluster 9: 205 elements
[INFO] Kmeans Cluster 10: 281 elements
[INFO] Kmeans Cluster 11: 71 elements
[INFO] Kmeans Cluster 12: 134 elements
[INFO] Kmeans Cluster 13: 130 elements
[INFO] Kmeans Cluster 14: 296 elements
[INFO] Kmeans Cluster 15: 101 elements
[INFO] Kmeans Cluster 16: 216 elements
[INFO] Kmeans Cluster 17: 117 elements
[INFO] Kmeans Cluster 18: 296 elements
[INFO] Kmeans Cluster 19: 218 elements
[INFO] Kmeans Cluster 20: 249 elements
[INFO] Kmeans Cluster 21: 110 elements
[INFO] Kmeans Cluster 22: 297 elements
[INFO] Kmeans Cluster 23: 269 elements
[INFO] Kmeans Cluster 24: 101 elements
[INFO] Kmeans Cluster 25: 165 elements
[INFO] Kmeans Cluster 26: 188 elements
[INFO] Kmeans Cluster 27: 235 elements
[INFO] Kmeans Cluster 28: 211 elements
[INFO] Kmeans Cluster 29: 243 elements
[INFO] Kmeans Cluster 30: 159 elements
[INFO] Kmeans Cluster 31: 209 elements
[INFO] Kmeans Cluster 32: 235 elements
[INFO] Kmeans Cluster 33: 196 elements
[INFO] Kmeans Cluster 34: 327 elements
[INFO] Kmeans Cluster 35: 277 elements
[INFO] Kmeans Cluster 36: 237 elements
[INFO] Kmeans Cluster 37: 85 elements
[INFO] Kmeans Cluster 38: 145 elements
[INFO] Kmeans Cluster 39: 213 elements
[INFO] Kmeans Cluster 40: 288 elements
[INFO] Kmeans Cluster 41: 136 elements
[INFO] Kmeans Cluster 42: 243 elements
[INFO] Kmeans Cluster 43: 249 elements
[INFO] Kmeans Cluster 44: 110 elements
[INFO] Kmeans Cluster 45: 58 elements
[INFO] Kmeans Cluster 46: 302 elements
[INFO] Kmeans Cluster 47: 220 elements
[INFO] Kmeans Cluster 48: 262 elements
[INFO] Kmeans Cluster 49: 199 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=83.56, Long SMA=274.89, Sharpe=0.0095
[INFO] Centroid 1: Short SMA=148.73, Long SMA=201.99, Sharpe=-0.3999
[INFO] Centroid 2: Short SMA=65.69, Long SMA=89.77, Sharpe=-0.2071
[INFO] Centroid 3: Short SMA=75.57, Long SMA=176.83, Sharpe=-0.2926
[INFO] Centroid 4: Short SMA=243.92, Long SMA=281.67, Sharpe=-0.6223
[INFO] Centroid 5: Short SMA=194.72, Long SMA=251.39, Sharpe=-0.2216
[INFO] Centroid 6: Short SMA=138.75, Long SMA=173.25, Sharpe=-0.2579
[INFO] Centroid 7: Short SMA=48.00, Long SMA=190.98, Sharpe=-0.0946
[INFO] Centroid 8: Short SMA=49.09, Long SMA=265.25, Sharpe=-0.1500
[INFO] Centroid 9: Short SMA=117.69, Long SMA=153.22, Sharpe=0.0275
[INFO] Centroid 10: Short SMA=141.40, Long SMA=261.45, Sharpe=-0.1424
[INFO] Centroid 11: Short SMA=213.72, Long SMA=229.35, Sharpe=0.1860
[INFO] Centroid 12: Short SMA=228.93, Long SMA=262.79, Sharpe=-0.4866
[INFO] Centroid 13: Short SMA=18.40, Long SMA=37.05, Sharpe=-0.3850
[INFO] Centroid 14: Short SMA=40.23, Long SMA=115.35, Sharpe=-0.1004
[INFO] Centroid 15: Short SMA=14.00, Long SMA=206.95, Sharpe=0.0357
[INFO] Centroid 16: Short SMA=86.38, Long SMA=113.73, Sharpe=-0.1173
[INFO] Centroid 17: Short SMA=252.97, Long SMA=274.84, Sharpe=-0.8652
[INFO] Centroid 18: Short SMA=93.57, Long SMA=201.11, Sharpe=-0.1823
[INFO] Centroid 19: Short SMA=30.11, Long SMA=57.39, Sharpe=-0.1695
[INFO] Centroid 20: Short SMA=22.63, Long SMA=91.45, Sharpe=-0.2530
[INFO] Centroid 21: Short SMA=213.82, Long SMA=235.00, Sharpe=-0.0142
[INFO] Centroid 22: Short SMA=165.21, Long SMA=285.76, Sharpe=-0.2186
[INFO] Centroid 23: Short SMA=34.28, Long SMA=164.93, Sharpe=-0.1586
[INFO] Centroid 24: Short SMA=14.53, Long SMA=280.26, Sharpe=0.1219
[INFO] Centroid 25: Short SMA=90.19, Long SMA=237.84, Sharpe=-0.0913
[INFO] Centroid 26: Short SMA=150.78, Long SMA=176.26, Sharpe=-0.4983
[INFO] Centroid 27: Short SMA=59.77, Long SMA=134.89, Sharpe=-0.0039
[INFO] Centroid 28: Short SMA=21.73, Long SMA=141.11, Sharpe=-0.0069
[INFO] Centroid 29: Short SMA=84.64, Long SMA=146.10, Sharpe=-0.1812
[INFO] Centroid 30: Short SMA=42.19, Long SMA=81.07, Sharpe=-0.3696
[INFO] Centroid 31: Short SMA=181.60, Long SMA=218.30, Sharpe=-0.1523
[INFO] Centroid 32: Short SMA=120.37, Long SMA=221.48, Sharpe=-0.3303
[INFO] Centroid 33: Short SMA=208.20, Long SMA=286.57, Sharpe=-0.4187
[INFO] Centroid 34: Short SMA=67.05, Long SMA=232.21, Sharpe=-0.2719
[INFO] Centroid 35: Short SMA=37.09, Long SMA=217.96, Sharpe=-0.1821
[INFO] Centroid 36: Short SMA=26.03, Long SMA=240.24, Sharpe=-0.0736
[INFO] Centroid 37: Short SMA=36.99, Long SMA=56.26, Sharpe=-0.0086
[INFO] Centroid 38: Short SMA=32.44, Long SMA=182.19, Sharpe=-0.3124
[INFO] Centroid 39: Short SMA=187.07, Long SMA=208.26, Sharpe=-0.2864
[INFO] Centroid 40: Short SMA=187.18, Long SMA=267.22, Sharpe=-0.3099
[INFO] Centroid 41: Short SMA=95.53, Long SMA=116.48, Sharpe=-0.2776
[INFO] Centroid 42: Short SMA=147.96, Long SMA=232.02, Sharpe=-0.2735
[INFO] Centroid 43: Short SMA=110.78, Long SMA=264.95, Sharpe=-0.1898
[INFO] Centroid 44: Short SMA=119.09, Long SMA=140.69, Sharpe=0.1702
[INFO] Centroid 45: Short SMA=283.10, Long SMA=293.62, Sharpe=-0.4103
[INFO] Centroid 46: Short SMA=37.72, Long SMA=285.00, Sharpe=-0.0378
[INFO] Centroid 47: Short SMA=251.66, Long SMA=277.71, Sharpe=-0.7334
[INFO] Centroid 48: Short SMA=118.53, Long SMA=285.36, Sharpe=-0.0905
[INFO] Centroid 49: Short SMA=111.09, Long SMA=173.90, Sharpe=-0.0857
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=142, Sharpe=0.3569, Trades=40
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=120, Long SMA=140, Sharpe=0.2704, Trades=40
[INFO] Kmeans Top 2: Short SMA=214, Long SMA=230, Sharpe=0.2300, Trades=32
[INFO] Kmeans Top 3: Short SMA=118, Long SMA=156, Sharpe=0.0961, Trades=32
[INFO] Kmeans Top 4: Short SMA=14, Long SMA=282, Sharpe=0.0938, Trades=21
[INFO] Kmeans Top 5: Short SMA=214, Long SMA=238, Sharpe=0.0864, Trades=28
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (84, 275)
[INFO]   Nearest: (84.0, 274.0)
[INFO]   Rounded: (149, 202)
[INFO]   Nearest: (148.0, 202.0)
[INFO]   Rounded: (66, 90)
[INFO]   Rounded: (76, 177)
[INFO]   Nearest: (76.0, 176.0)
[INFO]   Rounded: (244, 282)
[INFO]   Rounded: (195, 251)
[INFO]   Nearest: (194.0, 252.0)
[INFO]   Rounded: (139, 173)
[INFO]   Nearest: (138.0, 174.0)
[INFO]   Rounded: (48, 191)
[INFO]   Nearest: (48.0, 190.0)
[INFO]   Rounded: (49, 265)
[INFO]   Nearest: (50.0, 266.0)
[INFO]   Rounded: (118, 153)
[INFO]   Nearest: (118.0, 154.0)
[INFO]   Rounded: (141, 261)
[INFO]   Nearest: (142.0, 262.0)
[INFO]   Rounded: (214, 229)
[INFO]   Nearest: (214.0, 230.0)
[INFO]   Rounded: (229, 263)
[INFO]   Nearest: (228.0, 262.0)
[INFO]   Rounded: (18, 37)
[INFO]   Nearest: (18.0, 38.0)
[INFO]   Rounded: (40, 115)
[INFO]   Nearest: (40.0, 116.0)
[INFO]   Rounded: (14, 207)
[INFO]   Nearest: (14.0, 206.0)
[INFO]   Rounded: (86, 114)
[INFO]   Rounded: (253, 275)
[INFO]   Nearest: (252.0, 274.0)
[INFO]   Rounded: (94, 201)
[INFO]   Nearest: (94.0, 202.0)
[INFO]   Rounded: (30, 57)
[INFO]   Nearest: (30.0, 58.0)
[INFO]   Rounded: (23, 91)
[INFO]   Nearest: (22.0, 92.0)
[INFO]   Rounded: (214, 235)
[INFO]   Nearest: (214.0, 234.0)
[INFO]   Rounded: (165, 286)
[INFO]   Nearest: (166.0, 286.0)
[INFO]   Rounded: (34, 165)
[INFO]   Nearest: (34.0, 164.0)
[INFO]   Rounded: (15, 280)
[INFO]   Nearest: (14.0, 280.0)
[INFO]   Rounded: (90, 238)
[INFO]   Rounded: (151, 176)
[INFO]   Nearest: (150.0, 176.0)
[INFO]   Rounded: (60, 135)
[INFO]   Nearest: (60.0, 134.0)
[INFO]   Rounded: (22, 141)
[INFO]   Nearest: (22.0, 142.0)
[INFO]   Rounded: (85, 146)
[INFO]   Nearest: (84.0, 146.0)
[INFO]   Rounded: (42, 81)
[INFO]   Nearest: (42.0, 82.0)
[INFO]   Rounded: (182, 218)
[INFO]   Rounded: (120, 221)
[INFO]   Nearest: (120.0, 222.0)
[INFO]   Rounded: (208, 287)
[INFO]   Nearest: (208.0, 286.0)
[INFO]   Rounded: (67, 232)
[INFO]   Nearest: (68.0, 232.0)
[INFO]   Rounded: (37, 218)
[INFO]   Nearest: (38.0, 218.0)
[INFO]   Rounded: (26, 240)
[INFO]   Rounded: (37, 56)
[INFO]   Nearest: (36.0, 56.0)
[INFO]   Rounded: (32, 182)
[INFO]   Rounded: (187, 208)
[INFO]   Nearest: (188.0, 208.0)
[INFO]   Rounded: (187, 267)
[INFO]   Nearest: (188.0, 268.0)
[INFO]   Rounded: (96, 116)
[INFO]   Rounded: (148, 232)
[INFO]   Rounded: (111, 265)
[INFO]   Nearest: (110.0, 264.0)
[INFO]   Rounded: (119, 141)
[INFO]   Nearest: (120.0, 140.0)
[INFO]   Rounded: (283, 294)
[INFO]   Nearest: (284.0, 294.0)
[INFO]   Rounded: (38, 285)
[INFO]   Nearest: (38.0, 284.0)
[INFO]   Rounded: (252, 278)
[INFO]   Rounded: (119, 285)
[INFO]   Nearest: (118.0, 286.0)
[INFO]   Rounded: (111, 174)
[INFO]   Nearest: (112.0, 174.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 142
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(120/140) - Original Sharpe: 0.2704, Trades: 40
[INFO] Kmeans cluster 2: SMA(214/230) - Original Sharpe: 0.2300, Trades: 32
[INFO] Kmeans cluster 3: SMA(118/156) - Original Sharpe: 0.0961, Trades: 32
[INFO] Kmeans cluster 4: SMA(14/282) - Original Sharpe: 0.0938, Trades: 21
[INFO] Kmeans cluster 5: SMA(214/238) - Original Sharpe: 0.0864, Trades: 28
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/142)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (120/140) - Sharpe: 0.2704
[INFO] cluster 2: (214/230) - Sharpe: 0.2300
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.951309            1.735835
1    2021-11-14 2021-11-14            43    -3.779143           -3.456181
2    2022-01-14 2022-01-14            41    -1.606093            1.031402
3    2022-03-14 2022-03-14            44     2.272090            2.272090
4    2022-05-14 2022-05-14            43     1.217919            1.217919
5    2022-07-14 2022-07-14            44    -0.981609           -0.981609
6    2022-09-14 2022-09-14            43    -0.503510           -0.503510
7    2022-11-14 2022-11-14            43     2.546707            0.704527
8    2023-01-14 2023-01-14            41     2.799352            2.536047
9    2023-03-14 2023-03-14            44    -0.771622           -0.301506
10   2023-05-14 2023-05-14            44    -1.092872           -3.322567
11   2023-07-14 2023-07-14            44     2.002487           -1.993986
12   2023-09-14 2023-09-14            43    -2.691940            0.048279
13   2023-11-14 2023-11-14            42     1.074911           -0.574736
14   2024-01-14 2024-01-14            43    -1.539506            0.841593
15   2024-03-14 2024-03-14            42    -0.907679           -0.907679
16   2024-05-14 2024-05-14            44     1.119288            3.640728
17   2024-07-14 2024-07-14            45    -0.484134           -0.333357
18   2024-09-14 2024-09-14            43     1.944401            2.153971
19   2024-11-14 2024-11-14            33    -2.760739           -2.760739
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |              1.7 |          2.7 | True          
[INFO] 2021-11-14   |         -3.8 |             -3.5 |          0.3 | True          
[INFO] 2022-01-14   |         -1.6 |              1.0 |          2.6 | True          
[INFO] 2022-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.5 |              0.7 |         -1.8 | False         
[INFO] 2023-01-14   |          2.8 |              2.5 |         -0.3 | False         
[INFO] 2023-03-14   |         -0.8 |             -0.3 |          0.5 | True          
[INFO] 2023-05-14   |         -1.1 |             -3.3 |         -2.2 | False         
[INFO] 2023-07-14   |          2.0 |             -2.0 |         -4.0 | False         
[INFO] 2023-09-14   |         -2.7 |              0.0 |          2.7 | True          
[INFO] 2023-11-14   |          1.1 |             -0.6 |         -1.7 | False         
[INFO] 2024-01-14   |         -1.5 |              0.8 |          2.3 | True          
[INFO] 2024-03-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.1 |              3.6 |          2.5 | True          
[INFO] 2024-07-14   |         -0.5 |             -0.3 |          0.2 | True          
[INFO] 2024-09-14   |          1.9 |              2.2 |          0.3 | True          
[INFO] 2024-11-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2024-03-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 9 of 14 periods (64.29% win rate)
[INFO] Updating Excel file with Kmeans results for RTY...
[INFO] Excel file updated successfully. Added RTY with Kmeans win rate 64.3% in row 42
[INFO] Added best Sharpe parameters 122/142 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 142
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(120/140) - Original Sharpe: 0.2704
[INFO] Added cluster 2 to portfolio: SMA(214/230) - Original Sharpe: 0.2300
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RTY_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1060
[INFO] Kmeans Best out-of-sample Sharpe: -0.1847
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for RTY...
[INFO] Excel file updated successfully. Added RTY with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RTY
[INFO] Big Point Value: 50.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.0509 to 0.3569
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 142
[INFO] Sharpe Ratio: 0.356940
[INFO] Number of Trades: 40
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10582 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.0509 to 0.3569
[INFO] Trades range: 10.0 to 329.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3995 to 2.7991
[INFO] Scaled Long SMA range: -2.7993 to 1.4002
[INFO] Scaled Sharpe ratio range: -4.4788 to 3.0252
[INFO] Scaled Trades range: -0.8038 to 13.2173
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10582 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5539
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 338 elements
[INFO] Cluster 1: 418 elements
[INFO] Cluster 2: 397 elements
[INFO] Cluster 3: 421 elements
[INFO] Cluster 4: 199 elements
[INFO] Cluster 5: 211 elements
[INFO] Cluster 6: 699 elements
[INFO] Cluster 7: 568 elements
[INFO] Cluster 8: 127 elements
[INFO] Cluster 9: 216 elements
[INFO] Cluster 10: 442 elements
[INFO] Cluster 11: 31 elements
[INFO] Cluster 12: 451 elements
[INFO] Cluster 13: 389 elements
[INFO] Cluster 14: 127 elements
[INFO] Cluster 15: 33 elements
[INFO] Cluster 16: 439 elements
[INFO] Cluster 17: 213 elements
[INFO] Cluster 18: 275 elements
[INFO] Cluster 19: 271 elements
[INFO] Cluster 20: 126 elements
[INFO] Cluster 21: 394 elements
[INFO] Cluster 22: 457 elements
[INFO] Cluster 23: 52 elements
[INFO] Cluster 24: 93 elements
[INFO] Cluster 25: 166 elements
[INFO] Cluster 26: 216 elements
[INFO] Cluster 27: 330 elements
[INFO] Cluster 28: 34 elements
[INFO] Cluster 29: 71 elements
[INFO] Cluster 30: 10 elements
[INFO] Cluster 31: 320 elements
[INFO] Cluster 32: 41 elements
[INFO] Cluster 33: 236 elements
[INFO] Cluster 34: 73 elements
[INFO] Cluster 35: 27 elements
[INFO] Cluster 36: 154 elements
[INFO] Cluster 37: 125 elements
[INFO] Cluster 38: 245 elements
[INFO] Cluster 39: 226 elements
[INFO] Cluster 40: 79 elements
[INFO] Cluster 41: 40 elements
[INFO] Cluster 42: 188 elements
[INFO] Cluster 43: 58 elements
[INFO] Cluster 44: 67 elements
[INFO] Cluster 45: 160 elements
[INFO] Cluster 46: 80 elements
[INFO] Cluster 47: 82 elements
[INFO] Cluster 48: 27 elements
[INFO] Cluster 49: 140 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=208, Long SMA=282, Sharpe=-0.4817, Trades=15
[INFO] Cluster 1 cluster: Short SMA=62, Long SMA=172, Sharpe=-0.2240, Trades=20
[INFO] Cluster 2 cluster: Short SMA=140, Long SMA=192, Sharpe=-0.4521, Trades=22
[INFO] Cluster 3 cluster: Short SMA=42, Long SMA=196, Sharpe=-0.1438, Trades=18
[INFO] Cluster 4 cluster: Short SMA=94, Long SMA=114, Sharpe=-0.1495, Trades=48
[INFO] Cluster 5 cluster: Short SMA=44, Long SMA=86, Sharpe=-0.1944, Trades=40
[INFO] Cluster 6 cluster: Short SMA=124, Long SMA=276, Sharpe=-0.0743, Trades=13
[INFO] Cluster 7 cluster: Short SMA=42, Long SMA=256, Sharpe=-0.1085, Trades=14
[INFO] Cluster 8 cluster: Short SMA=210, Long SMA=236, Sharpe=0.1619, Trades=28
[INFO] Cluster 9 cluster: Short SMA=116, Long SMA=158, Sharpe=0.0949, Trades=28
[INFO] Cluster 10 cluster: Short SMA=64, Long SMA=226, Sharpe=-0.2911, Trades=16
[INFO] Cluster 11 cluster: Short SMA=268, Long SMA=270, Sharpe=-0.7124, Trades=95
[INFO] Cluster 12 cluster: Short SMA=58, Long SMA=128, Sharpe=-0.0565, Trades=24
[INFO] Cluster 13 cluster: Short SMA=98, Long SMA=194, Sharpe=-0.1363, Trades=22
[INFO] Cluster 14 cluster: Short SMA=24, Long SMA=42, Sharpe=-0.3091, Trades=93
[INFO] Cluster 15 cluster: Short SMA=36, Long SMA=38, Sharpe=-0.1345, Trades=191
[INFO] Cluster 16 cluster: Short SMA=190, Long SMA=256, Sharpe=-0.2732, Trades=18
[INFO] Cluster 17 cluster: Short SMA=252, Long SMA=282, Sharpe=-0.8849, Trades=23
[INFO] Cluster 18 cluster: Short SMA=168, Long SMA=284, Sharpe=-0.2524, Trades=15
[INFO] Cluster 19 cluster: Short SMA=28, Long SMA=84, Sharpe=-0.2894, Trades=54
[INFO] Cluster 20 cluster: Short SMA=130, Long SMA=174, Sharpe=-0.2370, Trades=26
[INFO] Cluster 21 cluster: Short SMA=80, Long SMA=276, Sharpe=0.0043, Trades=15
[INFO] Cluster 22 cluster: Short SMA=142, Long SMA=222, Sharpe=-0.2796, Trades=18
[INFO] Cluster 23 cluster: Short SMA=40, Long SMA=48, Sharpe=0.0250, Trades=108
[INFO] Cluster 24 cluster: Short SMA=280, Long SMA=290, Sharpe=-0.4140, Trades=41
[INFO] Cluster 25 cluster: Short SMA=26, Long SMA=160, Sharpe=-0.1425, Trades=34
[INFO] Cluster 26 cluster: Short SMA=54, Long SMA=74, Sharpe=-0.1190, Trades=60
[INFO] Cluster 27 cluster: Short SMA=86, Long SMA=142, Sharpe=-0.1829, Trades=24
[INFO] Cluster 28 cluster: Short SMA=102, Long SMA=104, Sharpe=-0.1538, Trades=128
[INFO] Cluster 29 cluster: Short SMA=126, Long SMA=136, Sharpe=0.2687, Trades=60
[INFO] Cluster 31 cluster: Short SMA=174, Long SMA=232, Sharpe=-0.1135, Trades=18
[INFO] Cluster 32 cluster: Short SMA=26, Long SMA=32, Sharpe=-0.4201, Trades=126
[INFO] Cluster 33 cluster: Short SMA=240, Long SMA=284, Sharpe=-0.7191, Trades=21
[INFO] Cluster 34 cluster: Short SMA=260, Long SMA=268, Sharpe=-0.6594, Trades=49
[INFO] Cluster 35 cluster: Short SMA=162, Long SMA=164, Sharpe=-0.3650, Trades=104
[INFO] Cluster 36 cluster: Short SMA=176, Long SMA=198, Sharpe=-0.2798, Trades=28
[INFO] Cluster 37 cluster: Short SMA=14, Long SMA=230, Sharpe=-0.0582, Trades=24
[INFO] Cluster 38 cluster: Short SMA=30, Long SMA=286, Sharpe=-0.0601, Trades=15
[INFO] Cluster 39 cluster: Short SMA=22, Long SMA=146, Sharpe=-0.0107, Trades=34
[INFO] Cluster 40 cluster: Short SMA=188, Long SMA=194, Sharpe=-0.1538, Trades=58
[INFO] Cluster 41 cluster: Short SMA=160, Long SMA=166, Sharpe=-0.4306, Trades=62
[INFO] Cluster 42 cluster: Short SMA=112, Long SMA=242, Sharpe=-0.3111, Trades=14
[INFO] Cluster 43 cluster: Short SMA=214, Long SMA=228, Sharpe=0.2116, Trades=36
[INFO] Cluster 44 cluster: Short SMA=12, Long SMA=278, Sharpe=0.1307, Trades=21
[INFO] Cluster 45 cluster: Short SMA=90, Long SMA=232, Sharpe=-0.1111, Trades=16
[INFO] Cluster 46 cluster: Short SMA=32, Long SMA=52, Sharpe=-0.0500, Trades=74
[INFO] Cluster 47 cluster: Short SMA=100, Long SMA=126, Sharpe=-0.0995, Trades=40
[INFO] Cluster 48 cluster: Short SMA=216, Long SMA=218, Sharpe=0.1038, Trades=94
[INFO] Cluster 49 cluster: Short SMA=28, Long SMA=116, Sharpe=-0.0628, Trades=42
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=142, Sharpe=0.3569, Trades=40
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=126, Long SMA=136, Sharpe=0.2687, Trades=60
[INFO] Top 2: Short SMA=214, Long SMA=228, Sharpe=0.2116, Trades=36
[INFO] Top 3: Short SMA=210, Long SMA=236, Sharpe=0.1619, Trades=28
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10572 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 142
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(126/136) - Original Sharpe: 0.2687, Trades: 60
[INFO] Hierarchical cluster 2: SMA(214/228) - Original Sharpe: 0.2116, Trades: 36
[INFO] Hierarchical cluster 3: SMA(210/236) - Original Sharpe: 0.1619, Trades: 28
[INFO] Hierarchical cluster 4: SMA(12/278) - Original Sharpe: 0.1307, Trades: 21
[INFO] Hierarchical cluster 5: SMA(216/218) - Original Sharpe: 0.1038, Trades: 94
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/142)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (126/136) - Sharpe: 0.2687
[INFO] cluster 2: (214/228) - Sharpe: 0.2116
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.951309            2.773103
1    2021-11-14 2021-11-14            43    -3.779143           -4.667560
2    2022-01-14 2022-01-14            41    -1.606093            1.303927
3    2022-03-14 2022-03-14            44     2.272090            2.197609
4    2022-05-14 2022-05-14            43     1.217919            1.217919
5    2022-07-14 2022-07-14            44    -0.981609           -0.981609
6    2022-09-14 2022-09-14            43    -0.503510            0.858116
7    2022-11-14 2022-11-14            43     2.546707            1.685441
8    2023-01-14 2023-01-14            41     2.799352            2.681676
9    2023-03-14 2023-03-14            44    -0.771622           -0.515786
10   2023-05-14 2023-05-14            44    -1.092872           -3.993825
11   2023-07-14 2023-07-14            44     2.002487           -0.917702
12   2023-09-14 2023-09-14            43    -2.691940           -0.712246
13   2023-11-14 2023-11-14            42     1.074911           -1.060133
14   2024-01-14 2024-01-14            43    -1.539506            1.939479
15   2024-03-14 2024-03-14            42    -0.907679           -0.907679
16   2024-05-14 2024-05-14            44     1.119288            4.249095
17   2024-07-14 2024-07-14            45    -0.484134            0.875267
18   2024-09-14 2024-09-14            43     1.944401            2.436455
19   2024-11-14 2024-11-14            33    -2.760739           -2.760739
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |              2.8 |          3.8 | True          
[INFO] 2021-11-14   |         -3.8 |             -4.7 |         -0.9 | False         
[INFO] 2022-01-14   |         -1.6 |              1.3 |          2.9 | True          
[INFO] 2022-03-14   |          2.3 |              2.2 |         -0.1 | False         
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.5 |              0.9 |          1.4 | True          
[INFO] 2022-11-14   |          2.5 |              1.7 |         -0.8 | False         
[INFO] 2023-01-14   |          2.8 |              2.7 |         -0.1 | False         
[INFO] 2023-03-14   |         -0.8 |             -0.5 |          0.3 | True          
[INFO] 2023-05-14   |         -1.1 |             -4.0 |         -2.9 | False         
[INFO] 2023-07-14   |          2.0 |             -0.9 |         -2.9 | False         
[INFO] 2023-09-14   |         -2.7 |             -0.7 |          2.0 | True          
[INFO] 2023-11-14   |          1.1 |             -1.1 |         -2.2 | False         
[INFO] 2024-01-14   |         -1.5 |              1.9 |          3.4 | True          
[INFO] 2024-03-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.1 |              4.2 |          3.1 | True          
[INFO] 2024-07-14   |         -0.5 |              0.9 |          1.4 | True          
[INFO] 2024-09-14   |          1.9 |              2.4 |          0.5 | True          
[INFO] 2024-11-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2022-07-14, 2024-03-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 9 of 16 periods (56.25% win rate)
[INFO] Updating Excel file with Hierarchical results for RTY...
[INFO] Excel file updated successfully. Added RTY with Hierarchical win rate 56.2% in row 42
[INFO] Added best Sharpe parameters 122/142 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 142
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(126/136) - Original Sharpe: 0.2687
[INFO] Added cluster 2 to portfolio: SMA(214/228) - Original Sharpe: 0.2116
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RTY_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2671
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1847
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for RTY...
[INFO] Excel file updated successfully. Added RTY with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RTY
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for S in column D: 15.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.36s
[INFO] Best parameters: Short SMA = 180, Long SMA = 184
[INFO] Best Sharpe ratio: 0.926274, Trades: 64
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 467 bad combos; keeping 2067 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SB
[INFO] Big Point Value (from data): 1120.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 14.27 contracts
[INFO] Maximum Position Size: 30 contracts
[INFO] Strategy Total P&L: $739,428.00
[INFO] Market Buy & Hold P&L: $-3,248.00
[INFO] Outperformance: $742,676.00
[INFO] Sharpe ratio (entire period, annualized): 0.939613
[INFO] Sharpe ratio (in-sample, annualized): 0.926274
[INFO] Sharpe ratio (out-of-sample, annualized): 0.970879
[INFO] Maximum Drawdown: $93,066.80
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 37
[INFO] Out-of-sample period trades: 27
[INFO] Total trades: 64
[INFO] In-sample P&L: $473,072.00
[INFO] Out-of-sample P&L: $208,676.00
[INFO] 
Best parameters from GA: Short SMA = 180, Long SMA = 184, Sharpe = 0.926274
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5070 to 0.9263
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.926274
[INFO] Number of Trades: 64
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10118 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5070 to 0.9263
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3602 to 2.7902
[INFO] Scaled Long SMA range: -2.7801 to 1.4751
[INFO] Scaled Sharpe ratio range: -5.3285 to 3.8001
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 271 elements
[INFO] Kmeans Cluster 1: 364 elements
[INFO] Kmeans Cluster 2: 215 elements
[INFO] Kmeans Cluster 3: 262 elements
[INFO] Kmeans Cluster 4: 136 elements
[INFO] Kmeans Cluster 5: 230 elements
[INFO] Kmeans Cluster 6: 248 elements
[INFO] Kmeans Cluster 7: 180 elements
[INFO] Kmeans Cluster 8: 194 elements
[INFO] Kmeans Cluster 9: 270 elements
[INFO] Kmeans Cluster 10: 105 elements
[INFO] Kmeans Cluster 11: 133 elements
[INFO] Kmeans Cluster 12: 116 elements
[INFO] Kmeans Cluster 13: 90 elements
[INFO] Kmeans Cluster 14: 196 elements
[INFO] Kmeans Cluster 15: 273 elements
[INFO] Kmeans Cluster 16: 217 elements
[INFO] Kmeans Cluster 17: 236 elements
[INFO] Kmeans Cluster 18: 235 elements
[INFO] Kmeans Cluster 19: 72 elements
[INFO] Kmeans Cluster 20: 216 elements
[INFO] Kmeans Cluster 21: 254 elements
[INFO] Kmeans Cluster 22: 203 elements
[INFO] Kmeans Cluster 23: 249 elements
[INFO] Kmeans Cluster 24: 76 elements
[INFO] Kmeans Cluster 25: 230 elements
[INFO] Kmeans Cluster 26: 207 elements
[INFO] Kmeans Cluster 27: 204 elements
[INFO] Kmeans Cluster 28: 318 elements
[INFO] Kmeans Cluster 29: 170 elements
[INFO] Kmeans Cluster 30: 218 elements
[INFO] Kmeans Cluster 31: 185 elements
[INFO] Kmeans Cluster 32: 185 elements
[INFO] Kmeans Cluster 33: 93 elements
[INFO] Kmeans Cluster 34: 276 elements
[INFO] Kmeans Cluster 35: 132 elements
[INFO] Kmeans Cluster 36: 229 elements
[INFO] Kmeans Cluster 37: 240 elements
[INFO] Kmeans Cluster 38: 241 elements
[INFO] Kmeans Cluster 39: 179 elements
[INFO] Kmeans Cluster 40: 241 elements
[INFO] Kmeans Cluster 41: 195 elements
[INFO] Kmeans Cluster 42: 227 elements
[INFO] Kmeans Cluster 43: 196 elements
[INFO] Kmeans Cluster 44: 173 elements
[INFO] Kmeans Cluster 45: 164 elements
[INFO] Kmeans Cluster 46: 233 elements
[INFO] Kmeans Cluster 47: 78 elements
[INFO] Kmeans Cluster 48: 256 elements
[INFO] Kmeans Cluster 49: 207 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=115.29, Long SMA=203.51, Sharpe=0.3745
[INFO] Centroid 1: Short SMA=243.91, Long SMA=274.78, Sharpe=0.2027
[INFO] Centroid 2: Short SMA=29.24, Long SMA=78.95, Sharpe=0.2835
[INFO] Centroid 3: Short SMA=67.91, Long SMA=268.31, Sharpe=0.2621
[INFO] Centroid 4: Short SMA=136.00, Long SMA=178.23, Sharpe=0.2782
[INFO] Centroid 5: Short SMA=207.57, Long SMA=239.78, Sharpe=0.4285
[INFO] Centroid 6: Short SMA=38.48, Long SMA=129.45, Sharpe=0.3612
[INFO] Centroid 7: Short SMA=165.96, Long SMA=197.53, Sharpe=0.6889
[INFO] Centroid 8: Short SMA=38.91, Long SMA=224.84, Sharpe=0.5096
[INFO] Centroid 9: Short SMA=176.10, Long SMA=255.73, Sharpe=0.3490
[INFO] Centroid 10: Short SMA=122.59, Long SMA=139.49, Sharpe=-0.0433
[INFO] Centroid 11: Short SMA=66.87, Long SMA=96.38, Sharpe=0.1083
[INFO] Centroid 12: Short SMA=29.81, Long SMA=43.33, Sharpe=0.0212
[INFO] Centroid 13: Short SMA=74.93, Long SMA=96.76, Sharpe=0.5248
[INFO] Centroid 14: Short SMA=15.30, Long SMA=229.65, Sharpe=0.2491
[INFO] Centroid 15: Short SMA=40.98, Long SMA=156.08, Sharpe=0.4766
[INFO] Centroid 16: Short SMA=36.02, Long SMA=279.94, Sharpe=0.3417
[INFO] Centroid 17: Short SMA=134.93, Long SMA=267.77, Sharpe=0.4337
[INFO] Centroid 18: Short SMA=38.44, Long SMA=104.12, Sharpe=0.4809
[INFO] Centroid 19: Short SMA=21.67, Long SMA=42.11, Sharpe=-0.1841
[INFO] Centroid 20: Short SMA=98.65, Long SMA=132.64, Sharpe=0.1862
[INFO] Centroid 21: Short SMA=103.28, Long SMA=255.51, Sharpe=0.2240
[INFO] Centroid 22: Short SMA=192.46, Long SMA=272.25, Sharpe=0.2323
[INFO] Centroid 23: Short SMA=259.99, Long SMA=290.64, Sharpe=0.2999
[INFO] Centroid 24: Short SMA=47.18, Long SMA=185.00, Sharpe=0.7020
[INFO] Centroid 25: Short SMA=32.57, Long SMA=285.53, Sharpe=0.4752
[INFO] Centroid 26: Short SMA=74.66, Long SMA=111.44, Sharpe=0.2507
[INFO] Centroid 27: Short SMA=35.86, Long SMA=248.28, Sharpe=0.4006
[INFO] Centroid 28: Short SMA=74.91, Long SMA=208.54, Sharpe=0.4578
[INFO] Centroid 29: Short SMA=31.12, Long SMA=69.84, Sharpe=0.3959
[INFO] Centroid 30: Short SMA=44.34, Long SMA=182.73, Sharpe=0.5807
[INFO] Centroid 31: Short SMA=125.10, Long SMA=276.36, Sharpe=0.3463
[INFO] Centroid 32: Short SMA=22.96, Long SMA=194.09, Sharpe=0.3620
[INFO] Centroid 33: Short SMA=240.00, Long SMA=248.69, Sharpe=0.0407
[INFO] Centroid 34: Short SMA=151.02, Long SMA=233.80, Sharpe=0.5039
[INFO] Centroid 35: Short SMA=161.29, Long SMA=195.52, Sharpe=0.4697
[INFO] Centroid 36: Short SMA=209.85, Long SMA=283.40, Sharpe=0.1239
[INFO] Centroid 37: Short SMA=76.80, Long SMA=179.14, Sharpe=0.3820
[INFO] Centroid 38: Short SMA=67.15, Long SMA=240.35, Sharpe=0.3373
[INFO] Centroid 39: Short SMA=17.80, Long SMA=144.82, Sharpe=0.2081
[INFO] Centroid 40: Short SMA=111.19, Long SMA=224.63, Sharpe=0.2985
[INFO] Centroid 41: Short SMA=201.88, Long SMA=228.07, Sharpe=0.3219
[INFO] Centroid 42: Short SMA=126.03, Long SMA=168.02, Sharpe=0.1848
[INFO] Centroid 43: Short SMA=87.24, Long SMA=272.65, Sharpe=0.1696
[INFO] Centroid 44: Short SMA=30.35, Long SMA=61.16, Sharpe=0.1859
[INFO] Centroid 45: Short SMA=82.79, Long SMA=121.79, Sharpe=0.3715
[INFO] Centroid 46: Short SMA=163.15, Long SMA=205.85, Sharpe=0.6014
[INFO] Centroid 47: Short SMA=200.51, Long SMA=216.67, Sharpe=0.1745
[INFO] Centroid 48: Short SMA=85.26, Long SMA=154.39, Sharpe=0.2759
[INFO] Centroid 49: Short SMA=126.71, Long SMA=157.81, Sharpe=0.0772
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9263, Trades=64
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=48, Long SMA=184, Sharpe=0.6866, Trades=13
[INFO] Kmeans Top 2: Short SMA=166, Long SMA=198, Sharpe=0.6608, Trades=16
[INFO] Kmeans Top 3: Short SMA=162, Long SMA=210, Sharpe=0.6395, Trades=14
[INFO] Kmeans Top 4: Short SMA=44, Long SMA=184, Sharpe=0.6381, Trades=13
[INFO] Kmeans Top 5: Short SMA=38, Long SMA=226, Sharpe=0.6011, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (115, 204)
[INFO]   Nearest: (116.0, 204.0)
[INFO]   Rounded: (244, 275)
[INFO]   Nearest: (244.0, 274.0)
[INFO]   Rounded: (29, 79)
[INFO]   Nearest: (30.0, 78.0)
[INFO]   Rounded: (68, 268)
[INFO]   Rounded: (136, 178)
[INFO]   Rounded: (208, 240)
[INFO]   Rounded: (38, 129)
[INFO]   Nearest: (38.0, 130.0)
[INFO]   Rounded: (166, 198)
[INFO]   Rounded: (39, 225)
[INFO]   Nearest: (38.0, 224.0)
[INFO]   Rounded: (176, 256)
[INFO]   Rounded: (123, 139)
[INFO]   Nearest: (122.0, 140.0)
[INFO]   Rounded: (67, 96)
[INFO]   Nearest: (66.0, 96.0)
[INFO]   Rounded: (30, 43)
[INFO]   Nearest: (30.0, 44.0)
[INFO]   Rounded: (75, 97)
[INFO]   Nearest: (74.0, 96.0)
[INFO]   Rounded: (15, 230)
[INFO]   Nearest: (16.0, 230.0)
[INFO]   Rounded: (41, 156)
[INFO]   Nearest: (40.0, 156.0)
[INFO]   Rounded: (36, 280)
[INFO]   Rounded: (135, 268)
[INFO]   Nearest: (134.0, 268.0)
[INFO]   Rounded: (38, 104)
[INFO]   Rounded: (22, 42)
[INFO]   Rounded: (99, 133)
[INFO]   Nearest: (98.0, 132.0)
[INFO]   Rounded: (103, 256)
[INFO]   Nearest: (104.0, 256.0)
[INFO]   Rounded: (192, 272)
[INFO]   Rounded: (260, 291)
[INFO]   Nearest: (260.0, 290.0)
[INFO]   Rounded: (47, 185)
[INFO]   Nearest: (48.0, 184.0)
[INFO]   Rounded: (33, 286)
[INFO]   Nearest: (32.0, 286.0)
[INFO]   Rounded: (75, 111)
[INFO]   Nearest: (74.0, 112.0)
[INFO]   Rounded: (36, 248)
[INFO]   Rounded: (75, 209)
[INFO]   Nearest: (74.0, 208.0)
[INFO]   Rounded: (31, 70)
[INFO]   Nearest: (32.0, 70.0)
[INFO]   Rounded: (44, 183)
[INFO]   Nearest: (44.0, 182.0)
[INFO]   Rounded: (125, 276)
[INFO]   Nearest: (126.0, 276.0)
[INFO]   Rounded: (23, 194)
[INFO]   Nearest: (22.0, 194.0)
[INFO]   Rounded: (240, 249)
[INFO]   Nearest: (240.0, 248.0)
[INFO]   Rounded: (151, 234)
[INFO]   Nearest: (152.0, 234.0)
[INFO]   Rounded: (161, 196)
[INFO]   Nearest: (162.0, 196.0)
[INFO]   Rounded: (210, 283)
[INFO]   Nearest: (210.0, 284.0)
[INFO]   Rounded: (77, 179)
[INFO]   Nearest: (76.0, 180.0)
[INFO]   Rounded: (67, 240)
[INFO]   Nearest: (68.0, 240.0)
[INFO]   Rounded: (18, 145)
[INFO]   Nearest: (18.0, 144.0)
[INFO]   Rounded: (111, 225)
[INFO]   Nearest: (112.0, 224.0)
[INFO]   Rounded: (202, 228)
[INFO]   Rounded: (126, 168)
[INFO]   Rounded: (87, 273)
[INFO]   Nearest: (88.0, 272.0)
[INFO]   Rounded: (30, 61)
[INFO]   Nearest: (30.0, 62.0)
[INFO]   Rounded: (83, 122)
[INFO]   Nearest: (82.0, 122.0)
[INFO]   Rounded: (163, 206)
[INFO]   Nearest: (164.0, 206.0)
[INFO]   Rounded: (201, 217)
[INFO]   Nearest: (200.0, 216.0)
[INFO]   Rounded: (85, 154)
[INFO]   Nearest: (86.0, 154.0)
[INFO]   Rounded: (127, 158)
[INFO]   Nearest: (126.0, 158.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(48/184) - Original Sharpe: 0.6866, Trades: 13
[INFO] Kmeans cluster 2: SMA(166/198) - Original Sharpe: 0.6608, Trades: 16
[INFO] Kmeans cluster 3: SMA(162/210) - Original Sharpe: 0.6395, Trades: 14
[INFO] Kmeans cluster 4: SMA(44/184) - Original Sharpe: 0.6381, Trades: 13
[INFO] Kmeans cluster 5: SMA(38/226) - Original Sharpe: 0.6011, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (48/184) - Sharpe: 0.6866
[INFO] cluster 2: (166/198) - Sharpe: 0.6608
[INFO] cluster 3: (162/210) - Sharpe: 0.6395
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.457400
2    2022-01-10 2022-01-10            41     2.600539            3.249703
3    2022-03-10 2022-03-10            42     0.191454           -0.672550
4    2022-05-10 2022-05-10            41    -0.735414           -0.735414
5    2022-07-10 2022-07-10            44     4.954980            0.048346
6    2022-09-10 2022-09-10            43     2.825703            2.825703
7    2022-11-10 2022-11-10            40     1.572256           -0.736454
8    2023-01-10 2023-01-10            41     3.123023            0.982890
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.978898
12   2023-09-10 2023-09-10            44     1.003709            1.003709
13   2023-11-10 2023-11-10            40    -4.602392           -5.059262
14   2024-01-10 2024-01-10            41     1.471174            3.266054
15   2024-03-10 2024-03-10            43    -0.286079           -1.930513
16   2024-05-10 2024-05-10            40    -2.453105           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.736674
18   2024-09-10 2024-09-10            44     3.195301           -3.194214
19   2024-11-10 2024-11-10            35     3.533315            3.533315
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |              3.2 |          0.6 | True          
[INFO] 2022-03-10   |          0.2 |             -0.7 |         -0.9 | False         
[INFO] 2022-05-10   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2022-07-10   |          5.0 |              0.0 |         -5.0 | False         
[INFO] 2022-09-10   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-10   |          1.6 |             -0.7 |         -2.3 | False         
[INFO] 2023-01-10   |          3.1 |              1.0 |         -2.1 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-10   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -4.6 |             -5.1 |         -0.5 | False         
[INFO] 2024-01-10   |          1.5 |              3.3 |          1.8 | True          
[INFO] 2024-03-10   |         -0.3 |             -1.9 |         -1.6 | False         
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -3.2 |         -6.4 | False         
[INFO] 2024-11-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-05-10, 2022-09-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2024-07-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Kmeans cluster wins (rounded comparison): 3 of 10 periods (30.00% win rate)
[INFO] Updating Excel file with Kmeans results for S...
[INFO] Excel file updated successfully. Added S with Kmeans win rate 30.0% in row 43
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(48/184) - Original Sharpe: 0.6866
[INFO] Added cluster 2 to portfolio: SMA(166/198) - Original Sharpe: 0.6608
[INFO] Added cluster 3 to portfolio: SMA(162/210) - Original Sharpe: 0.6395
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'S_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0542
[INFO] Kmeans Best out-of-sample Sharpe: 0.9709
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for S...
[INFO] Excel file updated successfully. Added S with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\S
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5070 to 0.9263
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.926274
[INFO] Number of Trades: 64
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10118 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5070 to 0.9263
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3602 to 2.7902
[INFO] Scaled Long SMA range: -2.7801 to 1.4751
[INFO] Scaled Sharpe ratio range: -5.3285 to 3.8001
[INFO] Scaled Trades range: -0.6229 to 16.0045
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10118 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4517
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 525 elements
[INFO] Cluster 1: 48 elements
[INFO] Cluster 2: 349 elements
[INFO] Cluster 3: 374 elements
[INFO] Cluster 4: 492 elements
[INFO] Cluster 5: 467 elements
[INFO] Cluster 6: 355 elements
[INFO] Cluster 7: 301 elements
[INFO] Cluster 8: 271 elements
[INFO] Cluster 9: 66 elements
[INFO] Cluster 10: 337 elements
[INFO] Cluster 11: 267 elements
[INFO] Cluster 12: 147 elements
[INFO] Cluster 13: 309 elements
[INFO] Cluster 14: 259 elements
[INFO] Cluster 15: 324 elements
[INFO] Cluster 16: 251 elements
[INFO] Cluster 17: 118 elements
[INFO] Cluster 18: 84 elements
[INFO] Cluster 19: 366 elements
[INFO] Cluster 20: 57 elements
[INFO] Cluster 21: 233 elements
[INFO] Cluster 22: 505 elements
[INFO] Cluster 23: 163 elements
[INFO] Cluster 24: 211 elements
[INFO] Cluster 25: 77 elements
[INFO] Cluster 26: 88 elements
[INFO] Cluster 27: 43 elements
[INFO] Cluster 28: 125 elements
[INFO] Cluster 29: 235 elements
[INFO] Cluster 30: 79 elements
[INFO] Cluster 31: 66 elements
[INFO] Cluster 32: 224 elements
[INFO] Cluster 33: 269 elements
[INFO] Cluster 34: 276 elements
[INFO] Cluster 35: 45 elements
[INFO] Cluster 36: 118 elements
[INFO] Cluster 37: 143 elements
[INFO] Cluster 38: 136 elements
[INFO] Cluster 39: 277 elements
[INFO] Cluster 40: 13 elements
[INFO] Cluster 41: 18 elements
[INFO] Cluster 42: 3 elements
[INFO] Cluster 43: 138 elements
[INFO] Cluster 44: 297 elements
[INFO] Cluster 45: 209 elements
[INFO] Cluster 46: 230 elements
[INFO] Cluster 47: 27 elements
[INFO] Cluster 48: 76 elements
[INFO] Cluster 49: 27 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=186, Long SMA=250, Sharpe=0.2936, Trades=10
[INFO] Cluster 1 cluster: Short SMA=28, Long SMA=32, Sharpe=-0.0045, Trades=140
[INFO] Cluster 2 cluster: Short SMA=44, Long SMA=94, Sharpe=0.5105, Trades=26
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=268, Sharpe=0.3323, Trades=18
[INFO] Cluster 4 cluster: Short SMA=108, Long SMA=210, Sharpe=0.2624, Trades=13
[INFO] Cluster 5 cluster: Short SMA=72, Long SMA=196, Sharpe=0.4252, Trades=14
[INFO] Cluster 6 cluster: Short SMA=76, Long SMA=130, Sharpe=0.2757, Trades=24
[INFO] Cluster 7 cluster: Short SMA=206, Long SMA=274, Sharpe=0.2027, Trades=10
[INFO] Cluster 8 cluster: Short SMA=16, Long SMA=222, Sharpe=0.1902, Trades=26
[INFO] Cluster 9 cluster: Short SMA=176, Long SMA=182, Sharpe=0.7296, Trades=49
[INFO] Cluster 10 cluster: Short SMA=142, Long SMA=234, Sharpe=0.5013, Trades=12
[INFO] Cluster 11 cluster: Short SMA=264, Long SMA=288, Sharpe=0.2482, Trades=12
[INFO] Cluster 12 cluster: Short SMA=116, Long SMA=130, Sharpe=0.2942, Trades=32
[INFO] Cluster 13 cluster: Short SMA=126, Long SMA=174, Sharpe=0.2550, Trades=19
[INFO] Cluster 14 cluster: Short SMA=32, Long SMA=72, Sharpe=0.3697, Trades=40
[INFO] Cluster 15 cluster: Short SMA=128, Long SMA=276, Sharpe=0.4893, Trades=14
[INFO] Cluster 16 cluster: Short SMA=200, Long SMA=236, Sharpe=0.4727, Trades=12
[INFO] Cluster 17 cluster: Short SMA=244, Long SMA=254, Sharpe=0.1249, Trades=24
[INFO] Cluster 18 cluster: Short SMA=26, Long SMA=52, Sharpe=0.2389, Trades=60
[INFO] Cluster 19 cluster: Short SMA=220, Long SMA=282, Sharpe=0.1204, Trades=10
[INFO] Cluster 20 cluster: Short SMA=102, Long SMA=104, Sharpe=0.3028, Trades=90
[INFO] Cluster 21 cluster: Short SMA=122, Long SMA=158, Sharpe=0.0952, Trades=18
[INFO] Cluster 22 cluster: Short SMA=96, Long SMA=268, Sharpe=0.2692, Trades=13
[INFO] Cluster 23 cluster: Short SMA=14, Long SMA=148, Sharpe=0.2394, Trades=32
[INFO] Cluster 24 cluster: Short SMA=40, Long SMA=134, Sharpe=0.4244, Trades=19
[INFO] Cluster 25 cluster: Short SMA=196, Long SMA=204, Sharpe=0.2884, Trades=40
[INFO] Cluster 26 cluster: Short SMA=30, Long SMA=54, Sharpe=0.4075, Trades=58
[INFO] Cluster 27 cluster: Short SMA=30, Long SMA=38, Sharpe=0.2313, Trades=100
[INFO] Cluster 28 cluster: Short SMA=168, Long SMA=190, Sharpe=0.6195, Trades=22
[INFO] Cluster 29 cluster: Short SMA=36, Long SMA=120, Sharpe=0.3139, Trades=21
[INFO] Cluster 30 cluster: Short SMA=132, Long SMA=140, Sharpe=0.0391, Trades=48
[INFO] Cluster 31 cluster: Short SMA=14, Long SMA=42, Sharpe=-0.2525, Trades=82
[INFO] Cluster 32 cluster: Short SMA=54, Long SMA=208, Sharpe=0.5139, Trades=13
[INFO] Cluster 33 cluster: Short SMA=72, Long SMA=238, Sharpe=0.3442, Trades=13
[INFO] Cluster 34 cluster: Short SMA=28, Long SMA=276, Sharpe=0.4571, Trades=16
[INFO] Cluster 35 cluster: Short SMA=212, Long SMA=216, Sharpe=0.1147, Trades=52
[INFO] Cluster 36 cluster: Short SMA=90, Long SMA=116, Sharpe=0.0344, Trades=30
[INFO] Cluster 37 cluster: Short SMA=46, Long SMA=184, Sharpe=0.6988, Trades=13
[INFO] Cluster 38 cluster: Short SMA=28, Long SMA=198, Sharpe=0.3428, Trades=19
[INFO] Cluster 39 cluster: Short SMA=76, Long SMA=140, Sharpe=0.2883, Trades=20
[INFO] Cluster 43 cluster: Short SMA=160, Long SMA=206, Sharpe=0.6884, Trades=14
[INFO] Cluster 44 cluster: Short SMA=64, Long SMA=262, Sharpe=0.2398, Trades=15
[INFO] Cluster 45 cluster: Short SMA=40, Long SMA=166, Sharpe=0.4420, Trades=15
[INFO] Cluster 46 cluster: Short SMA=156, Long SMA=222, Sharpe=0.6021, Trades=12
[INFO] Cluster 47 cluster: Short SMA=16, Long SMA=30, Sharpe=-0.0556, Trades=100
[INFO] Cluster 48 cluster: Short SMA=58, Long SMA=70, Sharpe=-0.0447, Trades=50
[INFO] Cluster 49 cluster: Short SMA=280, Long SMA=282, Sharpe=0.3182, Trades=42
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9263, Trades=64
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=176, Long SMA=182, Sharpe=0.7296, Trades=49
[INFO] Top 2: Short SMA=46, Long SMA=184, Sharpe=0.6988, Trades=13
[INFO] Top 3: Short SMA=160, Long SMA=206, Sharpe=0.6884, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10084 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(176/182) - Original Sharpe: 0.7296, Trades: 49
[INFO] Hierarchical cluster 2: SMA(46/184) - Original Sharpe: 0.6988, Trades: 13
[INFO] Hierarchical cluster 3: SMA(160/206) - Original Sharpe: 0.6884, Trades: 14
[INFO] Hierarchical cluster 4: SMA(168/190) - Original Sharpe: 0.6195, Trades: 22
[INFO] Hierarchical cluster 5: SMA(156/222) - Original Sharpe: 0.6021, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (176/182) - Sharpe: 0.7296
[INFO] cluster 2: (46/184) - Sharpe: 0.6988
[INFO] cluster 3: (160/206) - Sharpe: 0.6884
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.457400
2    2022-01-10 2022-01-10            41     2.600539            3.589524
3    2022-03-10 2022-03-10            42     0.191454           -1.283318
4    2022-05-10 2022-05-10            41    -0.735414            2.726310
5    2022-07-10 2022-07-10            44     4.954980           -0.331299
6    2022-09-10 2022-09-10            43     2.825703            2.825703
7    2022-11-10 2022-11-10            40     1.572256            0.384571
8    2023-01-10 2023-01-10            41     3.123023            2.334728
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.978898
12   2023-09-10 2023-09-10            44     1.003709            1.003709
13   2023-11-10 2023-11-10            40    -4.602392           -4.718006
14   2024-01-10 2024-01-10            41     1.471174            1.470234
15   2024-03-10 2024-03-10            43    -0.286079            2.103984
16   2024-05-10 2024-05-10            40    -2.453105           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.732101
18   2024-09-10 2024-09-10            44     3.195301           -2.491589
19   2024-11-10 2024-11-10            35     3.533315            4.167585
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |              3.6 |          1.0 | True          
[INFO] 2022-03-10   |          0.2 |             -1.3 |         -1.5 | False         
[INFO] 2022-05-10   |         -0.7 |              2.7 |          3.4 | True          
[INFO] 2022-07-10   |          5.0 |             -0.3 |         -5.3 | False         
[INFO] 2022-09-10   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-10   |          1.6 |              0.4 |         -1.2 | False         
[INFO] 2023-01-10   |          3.1 |              2.3 |         -0.8 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-10   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -4.6 |             -4.7 |         -0.1 | False         
[INFO] 2024-01-10   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -0.3 |              2.1 |          2.4 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -2.5 |         -5.7 | False         
[INFO] 2024-11-10   |          3.5 |              4.2 |          0.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-09-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2024-01-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 11 periods (45.45% win rate)
[INFO] Updating Excel file with Hierarchical results for S...
[INFO] Excel file updated successfully. Added S with Hierarchical win rate 45.5% in row 43
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(176/182) - Original Sharpe: 0.7296
[INFO] Added cluster 2 to portfolio: SMA(46/184) - Original Sharpe: 0.6988
[INFO] Added cluster 3 to portfolio: SMA(160/206) - Original Sharpe: 0.6884
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'S_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3556
[INFO] Hierarchical Best out-of-sample Sharpe: 0.9709
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for S...
[INFO] Excel file updated successfully. Added S with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\S
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SB in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.39s
[INFO] Best parameters: Short SMA = 180, Long SMA = 184
[INFO] Best Sharpe ratio: 0.927384, Trades: 64
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 467 bad combos; keeping 2067 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SB
[INFO] Big Point Value (from data): 1120.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 14.27 contracts
[INFO] Maximum Position Size: 30 contracts
[INFO] Strategy Total P&L: $740,320.00
[INFO] Market Buy & Hold P&L: $-3,248.00
[INFO] Outperformance: $743,568.00
[INFO] Sharpe ratio (entire period, annualized): 0.940831
[INFO] Sharpe ratio (in-sample, annualized): 0.927384
[INFO] Sharpe ratio (out-of-sample, annualized): 0.972353
[INFO] Maximum Drawdown: $93,032.80
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 37
[INFO] Out-of-sample period trades: 27
[INFO] Total trades: 64
[INFO] In-sample P&L: $473,648.00
[INFO] Out-of-sample P&L: $208,992.00
[INFO] 
Best parameters from GA: Short SMA = 180, Long SMA = 184, Sharpe = 0.927384
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5052 to 0.9274
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.927384
[INFO] Number of Trades: 64
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10118 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5052 to 0.9274
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3602 to 2.7902
[INFO] Scaled Long SMA range: -2.7801 to 1.4751
[INFO] Scaled Sharpe ratio range: -5.3247 to 3.8078
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 184 elements
[INFO] Kmeans Cluster 1: 158 elements
[INFO] Kmeans Cluster 2: 167 elements
[INFO] Kmeans Cluster 3: 173 elements
[INFO] Kmeans Cluster 4: 194 elements
[INFO] Kmeans Cluster 5: 179 elements
[INFO] Kmeans Cluster 6: 234 elements
[INFO] Kmeans Cluster 7: 126 elements
[INFO] Kmeans Cluster 8: 326 elements
[INFO] Kmeans Cluster 9: 308 elements
[INFO] Kmeans Cluster 10: 193 elements
[INFO] Kmeans Cluster 11: 150 elements
[INFO] Kmeans Cluster 12: 99 elements
[INFO] Kmeans Cluster 13: 69 elements
[INFO] Kmeans Cluster 14: 166 elements
[INFO] Kmeans Cluster 15: 217 elements
[INFO] Kmeans Cluster 16: 243 elements
[INFO] Kmeans Cluster 17: 208 elements
[INFO] Kmeans Cluster 18: 95 elements
[INFO] Kmeans Cluster 19: 97 elements
[INFO] Kmeans Cluster 20: 228 elements
[INFO] Kmeans Cluster 21: 166 elements
[INFO] Kmeans Cluster 22: 224 elements
[INFO] Kmeans Cluster 23: 221 elements
[INFO] Kmeans Cluster 24: 252 elements
[INFO] Kmeans Cluster 25: 195 elements
[INFO] Kmeans Cluster 26: 277 elements
[INFO] Kmeans Cluster 27: 198 elements
[INFO] Kmeans Cluster 28: 233 elements
[INFO] Kmeans Cluster 29: 108 elements
[INFO] Kmeans Cluster 30: 194 elements
[INFO] Kmeans Cluster 31: 239 elements
[INFO] Kmeans Cluster 32: 219 elements
[INFO] Kmeans Cluster 33: 56 elements
[INFO] Kmeans Cluster 34: 237 elements
[INFO] Kmeans Cluster 35: 75 elements
[INFO] Kmeans Cluster 36: 216 elements
[INFO] Kmeans Cluster 37: 266 elements
[INFO] Kmeans Cluster 38: 270 elements
[INFO] Kmeans Cluster 39: 289 elements
[INFO] Kmeans Cluster 40: 240 elements
[INFO] Kmeans Cluster 41: 187 elements
[INFO] Kmeans Cluster 42: 310 elements
[INFO] Kmeans Cluster 43: 262 elements
[INFO] Kmeans Cluster 44: 222 elements
[INFO] Kmeans Cluster 45: 222 elements
[INFO] Kmeans Cluster 46: 260 elements
[INFO] Kmeans Cluster 47: 243 elements
[INFO] Kmeans Cluster 48: 191 elements
[INFO] Kmeans Cluster 49: 232 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=165.84, Long SMA=197.17, Sharpe=0.6881
[INFO] Centroid 1: Short SMA=129.37, Long SMA=183.28, Sharpe=0.3045
[INFO] Centroid 2: Short SMA=41.03, Long SMA=143.07, Sharpe=0.4295
[INFO] Centroid 3: Short SMA=189.71, Long SMA=275.73, Sharpe=0.2231
[INFO] Centroid 4: Short SMA=81.48, Long SMA=105.91, Sharpe=0.1318
[INFO] Centroid 5: Short SMA=198.04, Long SMA=222.86, Sharpe=0.2920
[INFO] Centroid 6: Short SMA=41.97, Long SMA=280.96, Sharpe=0.3208
[INFO] Centroid 7: Short SMA=19.06, Long SMA=117.71, Sharpe=0.1963
[INFO] Centroid 8: Short SMA=74.13, Long SMA=209.97, Sharpe=0.4562
[INFO] Centroid 9: Short SMA=132.68, Long SMA=273.94, Sharpe=0.4048
[INFO] Centroid 10: Short SMA=259.51, Long SMA=291.28, Sharpe=0.3151
[INFO] Centroid 11: Short SMA=31.12, Long SMA=49.12, Sharpe=0.0414
[INFO] Centroid 12: Short SMA=75.49, Long SMA=97.43, Sharpe=0.5174
[INFO] Centroid 13: Short SMA=46.93, Long SMA=185.04, Sharpe=0.7081
[INFO] Centroid 14: Short SMA=81.25, Long SMA=277.70, Sharpe=0.1788
[INFO] Centroid 15: Short SMA=75.31, Long SMA=111.88, Sharpe=0.2527
[INFO] Centroid 16: Short SMA=32.86, Long SMA=285.96, Sharpe=0.4714
[INFO] Centroid 17: Short SMA=102.91, Long SMA=249.80, Sharpe=0.1967
[INFO] Centroid 18: Short SMA=246.65, Long SMA=256.78, Sharpe=0.0720
[INFO] Centroid 19: Short SMA=13.63, Long SMA=163.51, Sharpe=0.2205
[INFO] Centroid 20: Short SMA=130.27, Long SMA=169.08, Sharpe=0.1932
[INFO] Centroid 21: Short SMA=164.45, Long SMA=201.58, Sharpe=0.4726
[INFO] Centroid 22: Short SMA=33.21, Long SMA=64.08, Sharpe=0.2249
[INFO] Centroid 23: Short SMA=30.63, Long SMA=72.22, Sharpe=0.3554
[INFO] Centroid 24: Short SMA=92.12, Long SMA=272.69, Sharpe=0.2622
[INFO] Centroid 25: Short SMA=38.84, Long SMA=225.72, Sharpe=0.5090
[INFO] Centroid 26: Short SMA=146.57, Long SMA=238.06, Sharpe=0.4969
[INFO] Centroid 27: Short SMA=260.11, Long SMA=284.01, Sharpe=0.2025
[INFO] Centroid 28: Short SMA=81.30, Long SMA=137.57, Sharpe=0.3509
[INFO] Centroid 29: Short SMA=122.41, Long SMA=139.76, Sharpe=-0.0407
[INFO] Centroid 30: Short SMA=15.28, Long SMA=229.93, Sharpe=0.2506
[INFO] Centroid 31: Short SMA=113.99, Long SMA=206.30, Sharpe=0.3836
[INFO] Centroid 32: Short SMA=39.44, Long SMA=160.83, Sharpe=0.5036
[INFO] Centroid 33: Short SMA=204.00, Long SMA=213.57, Sharpe=0.0820
[INFO] Centroid 34: Short SMA=230.52, Long SMA=269.05, Sharpe=0.2282
[INFO] Centroid 35: Short SMA=21.95, Long SMA=42.08, Sharpe=-0.1778
[INFO] Centroid 36: Short SMA=126.58, Long SMA=159.02, Sharpe=0.0833
[INFO] Centroid 37: Short SMA=208.11, Long SMA=239.75, Sharpe=0.4167
[INFO] Centroid 38: Short SMA=66.32, Long SMA=243.30, Sharpe=0.3152
[INFO] Centroid 39: Short SMA=176.45, Long SMA=256.16, Sharpe=0.3453
[INFO] Centroid 40: Short SMA=35.79, Long SMA=251.82, Sharpe=0.3927
[INFO] Centroid 41: Short SMA=23.73, Long SMA=195.03, Sharpe=0.3669
[INFO] Centroid 42: Short SMA=94.81, Long SMA=149.15, Sharpe=0.2316
[INFO] Centroid 43: Short SMA=37.88, Long SMA=97.88, Sharpe=0.4750
[INFO] Centroid 44: Short SMA=210.76, Long SMA=283.73, Sharpe=0.1228
[INFO] Centroid 45: Short SMA=38.50, Long SMA=123.68, Sharpe=0.3414
[INFO] Centroid 46: Short SMA=110.94, Long SMA=226.68, Sharpe=0.2999
[INFO] Centroid 47: Short SMA=163.00, Long SMA=207.65, Sharpe=0.5991
[INFO] Centroid 48: Short SMA=46.24, Long SMA=185.26, Sharpe=0.5905
[INFO] Centroid 49: Short SMA=77.69, Long SMA=182.23, Sharpe=0.3821
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9274, Trades=64
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=48, Long SMA=184, Sharpe=0.6869, Trades=13
[INFO] Kmeans Top 2: Short SMA=166, Long SMA=198, Sharpe=0.6611, Trades=16
[INFO] Kmeans Top 3: Short SMA=162, Long SMA=210, Sharpe=0.6397, Trades=14
[INFO] Kmeans Top 4: Short SMA=44, Long SMA=184, Sharpe=0.6384, Trades=13
[INFO] Kmeans Top 5: Short SMA=38, Long SMA=226, Sharpe=0.6014, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (166, 197)
[INFO]   Nearest: (166.0, 198.0)
[INFO]   Rounded: (129, 183)
[INFO]   Nearest: (130.0, 184.0)
[INFO]   Rounded: (41, 143)
[INFO]   Nearest: (42.0, 144.0)
[INFO]   Rounded: (190, 276)
[INFO]   Rounded: (81, 106)
[INFO]   Nearest: (82.0, 106.0)
[INFO]   Rounded: (198, 223)
[INFO]   Nearest: (198.0, 222.0)
[INFO]   Rounded: (42, 281)
[INFO]   Nearest: (42.0, 280.0)
[INFO]   Rounded: (19, 118)
[INFO]   Nearest: (20.0, 118.0)
[INFO]   Rounded: (74, 210)
[INFO]   Rounded: (133, 274)
[INFO]   Nearest: (132.0, 274.0)
[INFO]   Rounded: (260, 291)
[INFO]   Nearest: (260.0, 292.0)
[INFO]   Rounded: (31, 49)
[INFO]   Nearest: (32.0, 50.0)
[INFO]   Rounded: (75, 97)
[INFO]   Nearest: (76.0, 98.0)
[INFO]   Rounded: (47, 185)
[INFO]   Nearest: (46.0, 186.0)
[INFO]   Rounded: (81, 278)
[INFO]   Nearest: (82.0, 278.0)
[INFO]   Rounded: (75, 112)
[INFO]   Nearest: (76.0, 112.0)
[INFO]   Rounded: (33, 286)
[INFO]   Nearest: (32.0, 286.0)
[INFO]   Rounded: (103, 250)
[INFO]   Nearest: (102.0, 250.0)
[INFO]   Rounded: (247, 257)
[INFO]   Nearest: (246.0, 256.0)
[INFO]   Rounded: (14, 164)
[INFO]   Rounded: (130, 169)
[INFO]   Nearest: (130.0, 170.0)
[INFO]   Rounded: (164, 202)
[INFO]   Rounded: (33, 64)
[INFO]   Nearest: (34.0, 64.0)
[INFO]   Rounded: (31, 72)
[INFO]   Nearest: (30.0, 72.0)
[INFO]   Rounded: (92, 273)
[INFO]   Nearest: (92.0, 272.0)
[INFO]   Rounded: (39, 226)
[INFO]   Nearest: (38.0, 226.0)
[INFO]   Rounded: (147, 238)
[INFO]   Nearest: (146.0, 238.0)
[INFO]   Rounded: (260, 284)
[INFO]   Rounded: (81, 138)
[INFO]   Nearest: (82.0, 138.0)
[INFO]   Rounded: (122, 140)
[INFO]   Rounded: (15, 230)
[INFO]   Nearest: (16.0, 230.0)
[INFO]   Rounded: (114, 206)
[INFO]   Rounded: (39, 161)
[INFO]   Nearest: (40.0, 160.0)
[INFO]   Rounded: (204, 214)
[INFO]   Rounded: (231, 269)
[INFO]   Nearest: (230.0, 270.0)
[INFO]   Rounded: (22, 42)
[INFO]   Rounded: (127, 159)
[INFO]   Nearest: (126.0, 160.0)
[INFO]   Rounded: (208, 240)
[INFO]   Rounded: (66, 243)
[INFO]   Nearest: (66.0, 244.0)
[INFO]   Rounded: (176, 256)
[INFO]   Rounded: (36, 252)
[INFO]   Rounded: (24, 195)
[INFO]   Nearest: (24.0, 196.0)
[INFO]   Rounded: (95, 149)
[INFO]   Nearest: (94.0, 150.0)
[INFO]   Rounded: (38, 98)
[INFO]   Rounded: (211, 284)
[INFO]   Nearest: (210.0, 284.0)
[INFO]   Rounded: (39, 124)
[INFO]   Nearest: (38.0, 124.0)
[INFO]   Rounded: (111, 227)
[INFO]   Nearest: (110.0, 226.0)
[INFO]   Rounded: (163, 208)
[INFO]   Nearest: (162.0, 208.0)
[INFO]   Rounded: (46, 185)
[INFO]   Nearest: (46.0, 186.0)
[INFO]   Rounded: (78, 182)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(48/184) - Original Sharpe: 0.6869, Trades: 13
[INFO] Kmeans cluster 2: SMA(166/198) - Original Sharpe: 0.6611, Trades: 16
[INFO] Kmeans cluster 3: SMA(162/210) - Original Sharpe: 0.6397, Trades: 14
[INFO] Kmeans cluster 4: SMA(44/184) - Original Sharpe: 0.6384, Trades: 13
[INFO] Kmeans cluster 5: SMA(38/226) - Original Sharpe: 0.6014, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (48/184) - Sharpe: 0.6869
[INFO] cluster 2: (166/198) - Sharpe: 0.6611
[INFO] cluster 3: (162/210) - Sharpe: 0.6397
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.457400
2    2022-01-10 2022-01-10            41     2.600539            3.250796
3    2022-03-10 2022-03-10            42     0.192786           -0.670175
4    2022-05-10 2022-05-10            41    -0.735414           -0.735414
5    2022-07-10 2022-07-10            44     4.961128            0.050166
6    2022-09-10 2022-09-10            43     2.825703            2.825703
7    2022-11-10 2022-11-10            40     1.576583           -0.733974
8    2023-01-10 2023-01-10            41     3.128890            0.983827
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.978898
12   2023-09-10 2023-09-10            44     1.003709            1.003709
13   2023-11-10 2023-11-10            40    -4.602392           -5.059174
14   2024-01-10 2024-01-10            41     1.473702            3.267181
15   2024-03-10 2024-03-10            43    -0.280949           -1.929022
16   2024-05-10 2024-05-10            40    -2.452361           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.736674
18   2024-09-10 2024-09-10            44     3.198404           -3.193950
19   2024-11-10 2024-11-10            35     3.533315            3.533315
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |              3.3 |          0.7 | True          
[INFO] 2022-03-10   |          0.2 |             -0.7 |         -0.9 | False         
[INFO] 2022-05-10   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2022-07-10   |          5.0 |              0.1 |         -4.9 | False         
[INFO] 2022-09-10   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-10   |          1.6 |             -0.7 |         -2.3 | False         
[INFO] 2023-01-10   |          3.1 |              1.0 |         -2.1 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-10   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -4.6 |             -5.1 |         -0.5 | False         
[INFO] 2024-01-10   |          1.5 |              3.3 |          1.8 | True          
[INFO] 2024-03-10   |         -0.3 |             -1.9 |         -1.6 | False         
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -3.2 |         -6.4 | False         
[INFO] 2024-11-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-05-10, 2022-09-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2024-07-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Kmeans cluster wins (rounded comparison): 3 of 10 periods (30.00% win rate)
[INFO] Updating Excel file with Kmeans results for SB...
[INFO] Excel file updated successfully. Added SB with Kmeans win rate 30.0% in row 44
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(48/184) - Original Sharpe: 0.6869
[INFO] Added cluster 2 to portfolio: SMA(166/198) - Original Sharpe: 0.6611
[INFO] Added cluster 3 to portfolio: SMA(162/210) - Original Sharpe: 0.6397
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SB_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0547
[INFO] Kmeans Best out-of-sample Sharpe: 0.9724
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for SB...
[INFO] Excel file updated successfully. Added SB with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SB
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5052 to 0.9274
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.927384
[INFO] Number of Trades: 64
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10118 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5052 to 0.9274
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3602 to 2.7902
[INFO] Scaled Long SMA range: -2.7801 to 1.4751
[INFO] Scaled Sharpe ratio range: -5.3247 to 3.8078
[INFO] Scaled Trades range: -0.6229 to 16.0045
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10118 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4517
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 145 elements
[INFO] Cluster 1: 525 elements
[INFO] Cluster 2: 391 elements
[INFO] Cluster 3: 48 elements
[INFO] Cluster 4: 66 elements
[INFO] Cluster 5: 414 elements
[INFO] Cluster 6: 271 elements
[INFO] Cluster 7: 175 elements
[INFO] Cluster 8: 467 elements
[INFO] Cluster 9: 301 elements
[INFO] Cluster 10: 355 elements
[INFO] Cluster 11: 77 elements
[INFO] Cluster 12: 88 elements
[INFO] Cluster 13: 276 elements
[INFO] Cluster 14: 147 elements
[INFO] Cluster 15: 251 elements
[INFO] Cluster 16: 337 elements
[INFO] Cluster 17: 507 elements
[INFO] Cluster 18: 224 elements
[INFO] Cluster 19: 57 elements
[INFO] Cluster 20: 125 elements
[INFO] Cluster 21: 309 elements
[INFO] Cluster 22: 267 elements
[INFO] Cluster 23: 163 elements
[INFO] Cluster 24: 43 elements
[INFO] Cluster 25: 84 elements
[INFO] Cluster 26: 259 elements
[INFO] Cluster 27: 236 elements
[INFO] Cluster 28: 13 elements
[INFO] Cluster 29: 307 elements
[INFO] Cluster 30: 66 elements
[INFO] Cluster 31: 324 elements
[INFO] Cluster 32: 91 elements
[INFO] Cluster 33: 235 elements
[INFO] Cluster 34: 143 elements
[INFO] Cluster 35: 45 elements
[INFO] Cluster 36: 295 elements
[INFO] Cluster 37: 103 elements
[INFO] Cluster 38: 136 elements
[INFO] Cluster 39: 277 elements
[INFO] Cluster 40: 366 elements
[INFO] Cluster 41: 18 elements
[INFO] Cluster 42: 3 elements
[INFO] Cluster 43: 297 elements
[INFO] Cluster 44: 138 elements
[INFO] Cluster 45: 203 elements
[INFO] Cluster 46: 230 elements
[INFO] Cluster 47: 27 elements
[INFO] Cluster 48: 76 elements
[INFO] Cluster 49: 117 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=248, Long SMA=258, Sharpe=-0.0389, Trades=23
[INFO] Cluster 1 cluster: Short SMA=186, Long SMA=250, Sharpe=0.2938, Trades=10
[INFO] Cluster 2 cluster: Short SMA=38, Long SMA=118, Sharpe=0.4278, Trades=21
[INFO] Cluster 3 cluster: Short SMA=28, Long SMA=32, Sharpe=-0.0016, Trades=140
[INFO] Cluster 4 cluster: Short SMA=176, Long SMA=182, Sharpe=0.7303, Trades=49
[INFO] Cluster 5 cluster: Short SMA=38, Long SMA=252, Sharpe=0.4071, Trades=14
[INFO] Cluster 6 cluster: Short SMA=16, Long SMA=222, Sharpe=0.1907, Trades=26
[INFO] Cluster 7 cluster: Short SMA=54, Long SMA=88, Sharpe=0.4530, Trades=34
[INFO] Cluster 8 cluster: Short SMA=72, Long SMA=196, Sharpe=0.4254, Trades=14
[INFO] Cluster 9 cluster: Short SMA=206, Long SMA=274, Sharpe=0.2029, Trades=10
[INFO] Cluster 10 cluster: Short SMA=76, Long SMA=130, Sharpe=0.2763, Trades=24
[INFO] Cluster 11 cluster: Short SMA=196, Long SMA=204, Sharpe=0.2891, Trades=40
[INFO] Cluster 12 cluster: Short SMA=30, Long SMA=54, Sharpe=0.4088, Trades=58
[INFO] Cluster 13 cluster: Short SMA=28, Long SMA=276, Sharpe=0.4574, Trades=16
[INFO] Cluster 14 cluster: Short SMA=116, Long SMA=130, Sharpe=0.2949, Trades=32
[INFO] Cluster 15 cluster: Short SMA=200, Long SMA=236, Sharpe=0.4729, Trades=12
[INFO] Cluster 16 cluster: Short SMA=142, Long SMA=234, Sharpe=0.5015, Trades=12
[INFO] Cluster 17 cluster: Short SMA=96, Long SMA=268, Sharpe=0.2695, Trades=13
[INFO] Cluster 18 cluster: Short SMA=54, Long SMA=208, Sharpe=0.5141, Trades=13
[INFO] Cluster 19 cluster: Short SMA=102, Long SMA=104, Sharpe=0.3049, Trades=90
[INFO] Cluster 20 cluster: Short SMA=168, Long SMA=190, Sharpe=0.6199, Trades=22
[INFO] Cluster 21 cluster: Short SMA=126, Long SMA=174, Sharpe=0.2554, Trades=19
[INFO] Cluster 22 cluster: Short SMA=264, Long SMA=288, Sharpe=0.2485, Trades=12
[INFO] Cluster 23 cluster: Short SMA=14, Long SMA=148, Sharpe=0.2402, Trades=32
[INFO] Cluster 24 cluster: Short SMA=30, Long SMA=38, Sharpe=0.2332, Trades=100
[INFO] Cluster 25 cluster: Short SMA=26, Long SMA=52, Sharpe=0.2402, Trades=60
[INFO] Cluster 26 cluster: Short SMA=32, Long SMA=72, Sharpe=0.3705, Trades=40
[INFO] Cluster 27 cluster: Short SMA=122, Long SMA=158, Sharpe=0.0956, Trades=18
[INFO] Cluster 29 cluster: Short SMA=104, Long SMA=228, Sharpe=0.3052, Trades=13
[INFO] Cluster 30 cluster: Short SMA=14, Long SMA=42, Sharpe=-0.2509, Trades=82
[INFO] Cluster 31 cluster: Short SMA=128, Long SMA=276, Sharpe=0.4896, Trades=14
[INFO] Cluster 32 cluster: Short SMA=128, Long SMA=138, Sharpe=-0.2254, Trades=45
[INFO] Cluster 33 cluster: Short SMA=36, Long SMA=120, Sharpe=0.3144, Trades=21
[INFO] Cluster 34 cluster: Short SMA=46, Long SMA=184, Sharpe=0.6990, Trades=13
[INFO] Cluster 35 cluster: Short SMA=212, Long SMA=216, Sharpe=0.1159, Trades=52
[INFO] Cluster 36 cluster: Short SMA=64, Long SMA=262, Sharpe=0.2400, Trades=15
[INFO] Cluster 37 cluster: Short SMA=86, Long SMA=114, Sharpe=0.0817, Trades=30
[INFO] Cluster 38 cluster: Short SMA=28, Long SMA=198, Sharpe=0.3432, Trades=19
[INFO] Cluster 39 cluster: Short SMA=76, Long SMA=140, Sharpe=0.2888, Trades=20
[INFO] Cluster 40 cluster: Short SMA=220, Long SMA=282, Sharpe=0.1206, Trades=10
[INFO] Cluster 43 cluster: Short SMA=104, Long SMA=196, Sharpe=0.3596, Trades=13
[INFO] Cluster 44 cluster: Short SMA=160, Long SMA=206, Sharpe=0.6886, Trades=14
[INFO] Cluster 45 cluster: Short SMA=40, Long SMA=166, Sharpe=0.4423, Trades=15
[INFO] Cluster 46 cluster: Short SMA=156, Long SMA=222, Sharpe=0.6024, Trades=12
[INFO] Cluster 47 cluster: Short SMA=16, Long SMA=30, Sharpe=-0.0535, Trades=100
[INFO] Cluster 48 cluster: Short SMA=58, Long SMA=70, Sharpe=-0.0436, Trades=50
[INFO] Cluster 49 cluster: Short SMA=50, Long SMA=292, Sharpe=0.3697, Trades=10
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9274, Trades=64
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=176, Long SMA=182, Sharpe=0.7303, Trades=49
[INFO] Top 2: Short SMA=46, Long SMA=184, Sharpe=0.6990, Trades=13
[INFO] Top 3: Short SMA=160, Long SMA=206, Sharpe=0.6886, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10084 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(176/182) - Original Sharpe: 0.7303, Trades: 49
[INFO] Hierarchical cluster 2: SMA(46/184) - Original Sharpe: 0.6990, Trades: 13
[INFO] Hierarchical cluster 3: SMA(160/206) - Original Sharpe: 0.6886, Trades: 14
[INFO] Hierarchical cluster 4: SMA(168/190) - Original Sharpe: 0.6199, Trades: 22
[INFO] Hierarchical cluster 5: SMA(156/222) - Original Sharpe: 0.6024, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (176/182) - Sharpe: 0.7303
[INFO] cluster 2: (46/184) - Sharpe: 0.6990
[INFO] cluster 3: (160/206) - Sharpe: 0.6886
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.457400
2    2022-01-10 2022-01-10            41     2.600539            3.589819
3    2022-03-10 2022-03-10            42     0.192786           -1.281426
4    2022-05-10 2022-05-10            41    -0.735414            2.728050
5    2022-07-10 2022-07-10            44     4.961128           -0.327129
6    2022-09-10 2022-09-10            43     2.825703            2.825703
7    2022-11-10 2022-11-10            40     1.576583            0.391502
8    2023-01-10 2023-01-10            41     3.128890            2.336813
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.978898
12   2023-09-10 2023-09-10            44     1.003709            1.003709
13   2023-11-10 2023-11-10            40    -4.602392           -4.717555
14   2024-01-10 2024-01-10            41     1.473702            1.471297
15   2024-03-10 2024-03-10            43    -0.280949            2.109730
16   2024-05-10 2024-05-10            40    -2.452361           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.732406
18   2024-09-10 2024-09-10            44     3.198404           -2.490902
19   2024-11-10 2024-11-10            35     3.533315            4.168880
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |              3.6 |          1.0 | True          
[INFO] 2022-03-10   |          0.2 |             -1.3 |         -1.5 | False         
[INFO] 2022-05-10   |         -0.7 |              2.7 |          3.4 | True          
[INFO] 2022-07-10   |          5.0 |             -0.3 |         -5.3 | False         
[INFO] 2022-09-10   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-10   |          1.6 |              0.4 |         -1.2 | False         
[INFO] 2023-01-10   |          3.1 |              2.3 |         -0.8 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-10   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -4.6 |             -4.7 |         -0.1 | False         
[INFO] 2024-01-10   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -0.3 |              2.1 |          2.4 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -2.5 |         -5.7 | False         
[INFO] 2024-11-10   |          3.5 |              4.2 |          0.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-09-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2024-01-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 11 periods (45.45% win rate)
[INFO] Updating Excel file with Hierarchical results for SB...
[INFO] Excel file updated successfully. Added SB with Hierarchical win rate 45.5% in row 44
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(176/182) - Original Sharpe: 0.7303
[INFO] Added cluster 2 to portfolio: SMA(46/184) - Original Sharpe: 0.6990
[INFO] Added cluster 3 to portfolio: SMA(160/206) - Original Sharpe: 0.6886
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SB_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3564
[INFO] Hierarchical Best out-of-sample Sharpe: 0.9724
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for SB...
[INFO] Excel file updated successfully. Added SB with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SB
[INFO] Loading SF data from local files...
[INFO] Found data file: A_OHLCV_@SF_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SF in column D: 13.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.57s
[INFO] Best parameters: Short SMA = 192, Long SMA = 194
[INFO] Best Sharpe ratio: 0.202683, Trades: 104
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172', 'SMA_SF_TOP5_192/194', 'SMA_SF_TOP5_186/204', 'SMA_SF_TOP5_190/196', 'SMA_SF_TOP5_186/206', 'SMA_SF_TOP5_184/206']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SF
[INFO] Big Point Value (from data): 125000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 7.05 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $344,481.50
[INFO] Market Buy & Hold P&L: $-34,818.75
[INFO] Outperformance: $379,300.25
[INFO] Sharpe ratio (entire period, annualized): 0.354150
[INFO] Sharpe ratio (in-sample, annualized): 0.202683
[INFO] Sharpe ratio (out-of-sample, annualized): 0.811300
[INFO] Maximum Drawdown: $171,886.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 79
[INFO] Out-of-sample period trades: 25
[INFO] Total trades: 104
[INFO] In-sample P&L: $140,603.50
[INFO] Out-of-sample P&L: $189,643.50
[INFO] 
Best parameters from GA: Short SMA = 192, Long SMA = 194, Sharpe = 0.202683
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] 
Best parameters:
[INFO] Short SMA: 192
[INFO] Long SMA: 194
[INFO] Sharpe Ratio: 0.202683
[INFO] Number of Trades: 104
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.3580 to 3.2380
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 113 elements
[INFO] Kmeans Cluster 1: 391 elements
[INFO] Kmeans Cluster 2: 218 elements
[INFO] Kmeans Cluster 3: 268 elements
[INFO] Kmeans Cluster 4: 207 elements
[INFO] Kmeans Cluster 5: 300 elements
[INFO] Kmeans Cluster 6: 316 elements
[INFO] Kmeans Cluster 7: 141 elements
[INFO] Kmeans Cluster 8: 193 elements
[INFO] Kmeans Cluster 9: 241 elements
[INFO] Kmeans Cluster 10: 283 elements
[INFO] Kmeans Cluster 11: 290 elements
[INFO] Kmeans Cluster 12: 135 elements
[INFO] Kmeans Cluster 13: 180 elements
[INFO] Kmeans Cluster 14: 68 elements
[INFO] Kmeans Cluster 15: 252 elements
[INFO] Kmeans Cluster 16: 302 elements
[INFO] Kmeans Cluster 17: 285 elements
[INFO] Kmeans Cluster 18: 235 elements
[INFO] Kmeans Cluster 19: 244 elements
[INFO] Kmeans Cluster 20: 196 elements
[INFO] Kmeans Cluster 21: 104 elements
[INFO] Kmeans Cluster 22: 199 elements
[INFO] Kmeans Cluster 23: 239 elements
[INFO] Kmeans Cluster 24: 174 elements
[INFO] Kmeans Cluster 25: 178 elements
[INFO] Kmeans Cluster 26: 197 elements
[INFO] Kmeans Cluster 27: 311 elements
[INFO] Kmeans Cluster 28: 257 elements
[INFO] Kmeans Cluster 29: 169 elements
[INFO] Kmeans Cluster 30: 297 elements
[INFO] Kmeans Cluster 31: 135 elements
[INFO] Kmeans Cluster 32: 134 elements
[INFO] Kmeans Cluster 33: 168 elements
[INFO] Kmeans Cluster 34: 202 elements
[INFO] Kmeans Cluster 35: 258 elements
[INFO] Kmeans Cluster 36: 173 elements
[INFO] Kmeans Cluster 37: 301 elements
[INFO] Kmeans Cluster 38: 117 elements
[INFO] Kmeans Cluster 39: 152 elements
[INFO] Kmeans Cluster 40: 75 elements
[INFO] Kmeans Cluster 41: 171 elements
[INFO] Kmeans Cluster 42: 172 elements
[INFO] Kmeans Cluster 43: 270 elements
[INFO] Kmeans Cluster 44: 238 elements
[INFO] Kmeans Cluster 45: 139 elements
[INFO] Kmeans Cluster 46: 323 elements
[INFO] Kmeans Cluster 47: 184 elements
[INFO] Kmeans Cluster 48: 243 elements
[INFO] Kmeans Cluster 49: 147 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=48.73, Long SMA=83.66, Sharpe=-0.5527
[INFO] Centroid 1: Short SMA=177.27, Long SMA=273.19, Sharpe=-0.2340
[INFO] Centroid 2: Short SMA=125.03, Long SMA=251.41, Sharpe=-0.1206
[INFO] Centroid 3: Short SMA=58.30, Long SMA=188.62, Sharpe=-0.3342
[INFO] Centroid 4: Short SMA=77.51, Long SMA=120.73, Sharpe=-0.1862
[INFO] Centroid 5: Short SMA=31.11, Long SMA=285.99, Sharpe=-0.3040
[INFO] Centroid 6: Short SMA=27.34, Long SMA=234.40, Sharpe=-0.5168
[INFO] Centroid 7: Short SMA=164.68, Long SMA=267.49, Sharpe=-0.3532
[INFO] Centroid 8: Short SMA=225.70, Long SMA=260.29, Sharpe=-0.4671
[INFO] Centroid 9: Short SMA=26.17, Long SMA=93.18, Sharpe=-0.3473
[INFO] Centroid 10: Short SMA=134.39, Long SMA=286.42, Sharpe=-0.1083
[INFO] Centroid 11: Short SMA=165.46, Long SMA=207.37, Sharpe=-0.0802
[INFO] Centroid 12: Short SMA=93.90, Long SMA=129.82, Sharpe=-0.0810
[INFO] Centroid 13: Short SMA=150.87, Long SMA=173.42, Sharpe=-0.3440
[INFO] Centroid 14: Short SMA=271.76, Long SMA=292.68, Sharpe=-0.1362
[INFO] Centroid 15: Short SMA=88.47, Long SMA=228.61, Sharpe=-0.1913
[INFO] Centroid 16: Short SMA=63.39, Long SMA=158.67, Sharpe=-0.2608
[INFO] Centroid 17: Short SMA=88.06, Long SMA=194.69, Sharpe=-0.2415
[INFO] Centroid 18: Short SMA=253.86, Long SMA=280.56, Sharpe=-0.3396
[INFO] Centroid 19: Short SMA=29.83, Long SMA=124.19, Sharpe=-0.4620
[INFO] Centroid 20: Short SMA=77.41, Long SMA=105.71, Sharpe=-0.2835
[INFO] Centroid 21: Short SMA=38.31, Long SMA=61.04, Sharpe=-0.1039
[INFO] Centroid 22: Short SMA=79.86, Long SMA=270.07, Sharpe=-0.3494
[INFO] Centroid 23: Short SMA=156.03, Long SMA=255.23, Sharpe=-0.1708
[INFO] Centroid 24: Short SMA=63.79, Long SMA=86.82, Sharpe=-0.4128
[INFO] Centroid 25: Short SMA=36.67, Long SMA=77.10, Sharpe=-0.2368
[INFO] Centroid 26: Short SMA=194.06, Long SMA=222.73, Sharpe=-0.1798
[INFO] Centroid 27: Short SMA=85.41, Long SMA=239.42, Sharpe=-0.2872
[INFO] Centroid 28: Short SMA=27.70, Long SMA=179.34, Sharpe=-0.4642
[INFO] Centroid 29: Short SMA=66.30, Long SMA=283.76, Sharpe=-0.1574
[INFO] Centroid 30: Short SMA=202.35, Long SMA=243.16, Sharpe=-0.3230
[INFO] Centroid 31: Short SMA=224.86, Long SMA=255.38, Sharpe=-0.5866
[INFO] Centroid 32: Short SMA=21.38, Long SMA=43.92, Sharpe=-0.3082
[INFO] Centroid 33: Short SMA=204.93, Long SMA=289.14, Sharpe=-0.4004
[INFO] Centroid 34: Short SMA=115.10, Long SMA=149.11, Sharpe=-0.1750
[INFO] Centroid 35: Short SMA=120.19, Long SMA=165.22, Sharpe=-0.0562
[INFO] Centroid 36: Short SMA=145.95, Long SMA=180.76, Sharpe=-0.2298
[INFO] Centroid 37: Short SMA=97.91, Long SMA=281.38, Sharpe=-0.2362
[INFO] Centroid 38: Short SMA=105.02, Long SMA=143.93, Sharpe=-0.3377
[INFO] Centroid 39: Short SMA=179.86, Long SMA=203.89, Sharpe=0.0376
[INFO] Centroid 40: Short SMA=101.52, Long SMA=131.68, Sharpe=0.0422
[INFO] Centroid 41: Short SMA=137.45, Long SMA=229.60, Sharpe=-0.0265
[INFO] Centroid 42: Short SMA=21.20, Long SMA=147.29, Sharpe=-0.5553
[INFO] Centroid 43: Short SMA=35.06, Long SMA=262.59, Sharpe=-0.4103
[INFO] Centroid 44: Short SMA=249.92, Long SMA=283.71, Sharpe=-0.2456
[INFO] Centroid 45: Short SMA=18.81, Long SMA=46.36, Sharpe=-0.4573
[INFO] Centroid 46: Short SMA=119.66, Long SMA=202.71, Sharpe=-0.1396
[INFO] Centroid 47: Short SMA=52.56, Long SMA=141.71, Sharpe=-0.3390
[INFO] Centroid 48: Short SMA=46.23, Long SMA=217.57, Sharpe=-0.4110
[INFO] Centroid 49: Short SMA=26.67, Long SMA=209.51, Sharpe=-0.6224
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=192, Long SMA=194, Sharpe=0.2027, Trades=104
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=182, Long SMA=204, Sharpe=0.0982, Trades=30
[INFO] Kmeans Top 2: Short SMA=100, Long SMA=128, Sharpe=0.0400, Trades=36
[INFO] Kmeans Top 3: Short SMA=136, Long SMA=230, Sharpe=0.0051, Trades=16
[INFO] Kmeans Top 4: Short SMA=164, Long SMA=208, Sharpe=-0.0175, Trades=22
[INFO] Kmeans Top 5: Short SMA=66, Long SMA=284, Sharpe=-0.0729, Trades=16
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (49, 84)
[INFO]   Nearest: (48.0, 84.0)
[INFO]   Rounded: (177, 273)
[INFO]   Nearest: (178.0, 274.0)
[INFO]   Rounded: (125, 251)
[INFO]   Nearest: (126.0, 252.0)
[INFO]   Rounded: (58, 189)
[INFO]   Nearest: (58.0, 188.0)
[INFO]   Rounded: (78, 121)
[INFO]   Nearest: (78.0, 120.0)
[INFO]   Rounded: (31, 286)
[INFO]   Nearest: (32.0, 286.0)
[INFO]   Rounded: (27, 234)
[INFO]   Nearest: (28.0, 234.0)
[INFO]   Rounded: (165, 267)
[INFO]   Nearest: (164.0, 268.0)
[INFO]   Rounded: (226, 260)
[INFO]   Rounded: (26, 93)
[INFO]   Nearest: (26.0, 94.0)
[INFO]   Rounded: (134, 286)
[INFO]   Rounded: (165, 207)
[INFO]   Nearest: (166.0, 208.0)
[INFO]   Rounded: (94, 130)
[INFO]   Rounded: (151, 173)
[INFO]   Nearest: (150.0, 174.0)
[INFO]   Rounded: (272, 293)
[INFO]   Nearest: (272.0, 292.0)
[INFO]   Rounded: (88, 229)
[INFO]   Nearest: (88.0, 228.0)
[INFO]   Rounded: (63, 159)
[INFO]   Nearest: (64.0, 158.0)
[INFO]   Rounded: (88, 195)
[INFO]   Nearest: (88.0, 194.0)
[INFO]   Rounded: (254, 281)
[INFO]   Nearest: (254.0, 280.0)
[INFO]   Rounded: (30, 124)
[INFO]   Rounded: (77, 106)
[INFO]   Nearest: (78.0, 106.0)
[INFO]   Rounded: (38, 61)
[INFO]   Nearest: (38.0, 62.0)
[INFO]   Rounded: (80, 270)
[INFO]   Rounded: (156, 255)
[INFO]   Nearest: (156.0, 256.0)
[INFO]   Rounded: (64, 87)
[INFO]   Nearest: (64.0, 86.0)
[INFO]   Rounded: (37, 77)
[INFO]   Nearest: (36.0, 78.0)
[INFO]   Rounded: (194, 223)
[INFO]   Nearest: (194.0, 222.0)
[INFO]   Rounded: (85, 239)
[INFO]   Nearest: (86.0, 240.0)
[INFO]   Rounded: (28, 179)
[INFO]   Nearest: (28.0, 180.0)
[INFO]   Rounded: (66, 284)
[INFO]   Rounded: (202, 243)
[INFO]   Nearest: (202.0, 244.0)
[INFO]   Rounded: (225, 255)
[INFO]   Nearest: (224.0, 256.0)
[INFO]   Rounded: (21, 44)
[INFO]   Nearest: (22.0, 44.0)
[INFO]   Rounded: (205, 289)
[INFO]   Nearest: (204.0, 290.0)
[INFO]   Rounded: (115, 149)
[INFO]   Nearest: (116.0, 150.0)
[INFO]   Rounded: (120, 165)
[INFO]   Nearest: (120.0, 166.0)
[INFO]   Rounded: (146, 181)
[INFO]   Nearest: (146.0, 180.0)
[INFO]   Rounded: (98, 281)
[INFO]   Nearest: (98.0, 282.0)
[INFO]   Rounded: (105, 144)
[INFO]   Nearest: (106.0, 144.0)
[INFO]   Rounded: (180, 204)
[INFO]   Rounded: (102, 132)
[INFO]   Rounded: (137, 230)
[INFO]   Nearest: (138.0, 230.0)
[INFO]   Rounded: (21, 147)
[INFO]   Nearest: (22.0, 148.0)
[INFO]   Rounded: (35, 263)
[INFO]   Nearest: (36.0, 262.0)
[INFO]   Rounded: (250, 284)
[INFO]   Rounded: (19, 46)
[INFO]   Nearest: (18.0, 46.0)
[INFO]   Rounded: (120, 203)
[INFO]   Nearest: (120.0, 202.0)
[INFO]   Rounded: (53, 142)
[INFO]   Nearest: (52.0, 142.0)
[INFO]   Rounded: (46, 218)
[INFO]   Rounded: (27, 210)
[INFO]   Nearest: (26.0, 210.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 192, Long SMA: 194
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SF data from local files...
[INFO] Found data file: A_OHLCV_@SF_minutes_1440_1703-1557.dat
[INFO] File size: 296586 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(182/204) - Original Sharpe: 0.0982, Trades: 30
[INFO] Kmeans cluster 2: SMA(100/128) - Original Sharpe: 0.0400, Trades: 36
[INFO] Kmeans cluster 3: SMA(136/230) - Original Sharpe: 0.0051, Trades: 16
[INFO] Kmeans cluster 4: SMA(164/208) - Original Sharpe: -0.0175, Trades: 22
[INFO] Kmeans cluster 5: SMA(66/284) - Original Sharpe: -0.0729, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (192/194)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 192, Long SMA: 194
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] Error: No Kmeans cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SF
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] 
Best parameters:
[INFO] Short SMA: 192
[INFO] Long SMA: 194
[INFO] Sharpe Ratio: 0.202683
[INFO] Number of Trades: 104
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.3580 to 3.2380
[INFO] Scaled Trades range: -0.9245 to 13.5719
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5212
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 304 elements
[INFO] Cluster 1: 211 elements
[INFO] Cluster 2: 340 elements
[INFO] Cluster 3: 161 elements
[INFO] Cluster 4: 368 elements
[INFO] Cluster 5: 71 elements
[INFO] Cluster 6: 434 elements
[INFO] Cluster 7: 28 elements
[INFO] Cluster 8: 240 elements
[INFO] Cluster 9: 73 elements
[INFO] Cluster 10: 379 elements
[INFO] Cluster 11: 109 elements
[INFO] Cluster 12: 549 elements
[INFO] Cluster 13: 112 elements
[INFO] Cluster 14: 323 elements
[INFO] Cluster 15: 165 elements
[INFO] Cluster 16: 260 elements
[INFO] Cluster 17: 191 elements
[INFO] Cluster 18: 82 elements
[INFO] Cluster 19: 45 elements
[INFO] Cluster 20: 410 elements
[INFO] Cluster 21: 218 elements
[INFO] Cluster 22: 60 elements
[INFO] Cluster 23: 178 elements
[INFO] Cluster 24: 468 elements
[INFO] Cluster 25: 144 elements
[INFO] Cluster 26: 300 elements
[INFO] Cluster 27: 289 elements
[INFO] Cluster 28: 245 elements
[INFO] Cluster 29: 242 elements
[INFO] Cluster 30: 256 elements
[INFO] Cluster 31: 324 elements
[INFO] Cluster 32: 390 elements
[INFO] Cluster 33: 381 elements
[INFO] Cluster 34: 33 elements
[INFO] Cluster 35: 186 elements
[INFO] Cluster 36: 245 elements
[INFO] Cluster 37: 4 elements
[INFO] Cluster 38: 78 elements
[INFO] Cluster 39: 37 elements
[INFO] Cluster 40: 102 elements
[INFO] Cluster 41: 129 elements
[INFO] Cluster 42: 187 elements
[INFO] Cluster 43: 104 elements
[INFO] Cluster 44: 164 elements
[INFO] Cluster 45: 374 elements
[INFO] Cluster 46: 248 elements
[INFO] Cluster 47: 138 elements
[INFO] Cluster 48: 152 elements
[INFO] Cluster 49: 54 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=68, Long SMA=100, Sharpe=-0.2385, Trades=39
[INFO] Cluster 1 cluster: Short SMA=224, Long SMA=252, Sharpe=-0.6497, Trades=26
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=192, Sharpe=-0.3876, Trades=29
[INFO] Cluster 3 cluster: Short SMA=100, Long SMA=130, Sharpe=0.0584, Trades=32
[INFO] Cluster 4 cluster: Short SMA=30, Long SMA=284, Sharpe=-0.2852, Trades=30
[INFO] Cluster 5 cluster: Short SMA=152, Long SMA=156, Sharpe=-0.1714, Trades=78
[INFO] Cluster 6 cluster: Short SMA=146, Long SMA=224, Sharpe=-0.1003, Trades=18
[INFO] Cluster 7 cluster: Short SMA=30, Long SMA=32, Sharpe=-0.5467, Trades=201
[INFO] Cluster 8 cluster: Short SMA=150, Long SMA=172, Sharpe=-0.2989, Trades=30
[INFO] Cluster 9 cluster: Short SMA=44, Long SMA=50, Sharpe=-0.3100, Trades=108
[INFO] Cluster 10 cluster: Short SMA=38, Long SMA=116, Sharpe=-0.4953, Trades=35
[INFO] Cluster 11 cluster: Short SMA=24, Long SMA=40, Sharpe=-0.4860, Trades=91
[INFO] Cluster 12 cluster: Short SMA=176, Long SMA=272, Sharpe=-0.2369, Trades=14
[INFO] Cluster 13 cluster: Short SMA=38, Long SMA=64, Sharpe=-0.1155, Trades=59
[INFO] Cluster 14 cluster: Short SMA=116, Long SMA=200, Sharpe=-0.1724, Trades=20
[INFO] Cluster 15 cluster: Short SMA=268, Long SMA=280, Sharpe=-0.3190, Trades=38
[INFO] Cluster 16 cluster: Short SMA=210, Long SMA=286, Sharpe=-0.4030, Trades=16
[INFO] Cluster 17 cluster: Short SMA=50, Long SMA=74, Sharpe=-0.4008, Trades=61
[INFO] Cluster 18 cluster: Short SMA=190, Long SMA=196, Sharpe=0.1824, Trades=60
[INFO] Cluster 19 cluster: Short SMA=252, Long SMA=254, Sharpe=-0.2306, Trades=84
[INFO] Cluster 20 cluster: Short SMA=132, Long SMA=280, Sharpe=-0.1564, Trades=10
[INFO] Cluster 21 cluster: Short SMA=160, Long SMA=244, Sharpe=-0.2106, Trades=13
[INFO] Cluster 22 cluster: Short SMA=236, Long SMA=242, Sharpe=-0.5591, Trades=56
[INFO] Cluster 23 cluster: Short SMA=22, Long SMA=192, Sharpe=-0.6219, Trades=39
[INFO] Cluster 24 cluster: Short SMA=82, Long SMA=254, Sharpe=-0.3090, Trades=17
[INFO] Cluster 25 cluster: Short SMA=204, Long SMA=226, Sharpe=-0.2441, Trades=27
[INFO] Cluster 26 cluster: Short SMA=98, Long SMA=228, Sharpe=-0.2277, Trades=18
[INFO] Cluster 27 cluster: Short SMA=44, Long SMA=256, Sharpe=-0.4767, Trades=25
[INFO] Cluster 28 cluster: Short SMA=62, Long SMA=196, Sharpe=-0.3366, Trades=21
[INFO] Cluster 29 cluster: Short SMA=244, Long SMA=290, Sharpe=-0.1631, Trades=18
[INFO] Cluster 30 cluster: Short SMA=100, Long SMA=284, Sharpe=-0.2670, Trades=16
[INFO] Cluster 31 cluster: Short SMA=26, Long SMA=234, Sharpe=-0.5118, Trades=31
[INFO] Cluster 32 cluster: Short SMA=56, Long SMA=154, Sharpe=-0.3364, Trades=23
[INFO] Cluster 33 cluster: Short SMA=118, Long SMA=164, Sharpe=-0.0917, Trades=28
[INFO] Cluster 34 cluster: Short SMA=66, Long SMA=68, Sharpe=-0.5792, Trades=153
[INFO] Cluster 35 cluster: Short SMA=24, Long SMA=86, Sharpe=-0.3322, Trades=51
[INFO] Cluster 36 cluster: Short SMA=190, Long SMA=248, Sharpe=-0.3413, Trades=19
[INFO] Cluster 38 cluster: Short SMA=180, Long SMA=202, Sharpe=0.0662, Trades=32
[INFO] Cluster 39 cluster: Short SMA=150, Long SMA=154, Sharpe=-0.3646, Trades=74
[INFO] Cluster 40 cluster: Short SMA=26, Long SMA=66, Sharpe=-0.3255, Trades=67
[INFO] Cluster 41 cluster: Short SMA=80, Long SMA=124, Sharpe=-0.1500, Trades=31
[INFO] Cluster 42 cluster: Short SMA=26, Long SMA=150, Sharpe=-0.5173, Trades=33
[INFO] Cluster 43 cluster: Short SMA=252, Long SMA=274, Sharpe=-0.3841, Trades=30
[INFO] Cluster 44 cluster: Short SMA=68, Long SMA=284, Sharpe=-0.1279, Trades=16
[INFO] Cluster 45 cluster: Short SMA=76, Long SMA=156, Sharpe=-0.2439, Trades=23
[INFO] Cluster 46 cluster: Short SMA=88, Long SMA=204, Sharpe=-0.2924, Trades=20
[INFO] Cluster 47 cluster: Short SMA=136, Long SMA=182, Sharpe=-0.2842, Trades=26
[INFO] Cluster 48 cluster: Short SMA=176, Long SMA=214, Sharpe=-0.0670, Trades=26
[INFO] Cluster 49 cluster: Short SMA=82, Long SMA=90, Sharpe=-0.3567, Trades=79
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=192, Long SMA=194, Sharpe=0.2027, Trades=104
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=190, Long SMA=196, Sharpe=0.1824, Trades=60
[INFO] Top 2: Short SMA=180, Long SMA=202, Sharpe=0.0662, Trades=32
[INFO] Top 3: Short SMA=100, Long SMA=130, Sharpe=0.0584, Trades=32
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10581 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 192, Long SMA: 194
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SF data from local files...
[INFO] Found data file: A_OHLCV_@SF_minutes_1440_1703-1557.dat
[INFO] File size: 296586 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(190/196) - Original Sharpe: 0.1824, Trades: 60
[INFO] Hierarchical cluster 2: SMA(180/202) - Original Sharpe: 0.0662, Trades: 32
[INFO] Hierarchical cluster 3: SMA(100/130) - Original Sharpe: 0.0584, Trades: 32
[INFO] Hierarchical cluster 4: SMA(176/214) - Original Sharpe: -0.0670, Trades: 26
[INFO] Hierarchical cluster 5: SMA(118/164) - Original Sharpe: -0.0917, Trades: 28
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (192/194)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 192, Long SMA: 194
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SF
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SI in column D: 27.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.62s
[INFO] Best parameters: Short SMA = 48, Long SMA = 50
[INFO] Best Sharpe ratio: 0.669797, Trades: 154
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 1925 bad combos; keeping 1637 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172', 'SMA_SF_TOP5_192/194', 'SMA_SF_TOP5_186/204', 'SMA_SF_TOP5_190/196', 'SMA_SF_TOP5_186/206', 'SMA_SF_TOP5_184/206', 'SMA_SI_TOP5_48/50', 'SMA_SI_TOP5_42/58', 'SMA_SI_TOP5_44/56', 'SMA_SI_TOP5_40/60', 'SMA_SI_TOP5_234/258']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SI
[INFO] Big Point Value (from data): 5000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.38 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $414,360.00
[INFO] Market Buy & Hold P&L: $17,375.00
[INFO] Outperformance: $396,985.00
[INFO] Sharpe ratio (entire period, annualized): 0.321215
[INFO] Sharpe ratio (in-sample, annualized): 0.669797
[INFO] Sharpe ratio (out-of-sample, annualized): -0.408321
[INFO] Maximum Drawdown: $246,379.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 112
[INFO] Out-of-sample period trades: 42
[INFO] Total trades: 154
[INFO] In-sample P&L: $407,662.00
[INFO] Out-of-sample P&L: $-118,498.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.669797
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 5000.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9380 to 0.6698
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.669797
[INFO] Number of Trades: 154
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8660 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9380 to 0.6698
[INFO] Trades range: 11.0 to 337.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2464 to 2.7541
[INFO] Scaled Long SMA range: -2.6696 to 1.6829
[INFO] Scaled Sharpe ratio range: -3.7133 to 3.4043
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 56 elements
[INFO] Kmeans Cluster 1: 172 elements
[INFO] Kmeans Cluster 2: 216 elements
[INFO] Kmeans Cluster 3: 110 elements
[INFO] Kmeans Cluster 4: 149 elements
[INFO] Kmeans Cluster 5: 344 elements
[INFO] Kmeans Cluster 6: 224 elements
[INFO] Kmeans Cluster 7: 141 elements
[INFO] Kmeans Cluster 8: 174 elements
[INFO] Kmeans Cluster 9: 222 elements
[INFO] Kmeans Cluster 10: 200 elements
[INFO] Kmeans Cluster 11: 201 elements
[INFO] Kmeans Cluster 12: 214 elements
[INFO] Kmeans Cluster 13: 166 elements
[INFO] Kmeans Cluster 14: 148 elements
[INFO] Kmeans Cluster 15: 128 elements
[INFO] Kmeans Cluster 16: 117 elements
[INFO] Kmeans Cluster 17: 202 elements
[INFO] Kmeans Cluster 18: 189 elements
[INFO] Kmeans Cluster 19: 147 elements
[INFO] Kmeans Cluster 20: 223 elements
[INFO] Kmeans Cluster 21: 123 elements
[INFO] Kmeans Cluster 22: 253 elements
[INFO] Kmeans Cluster 23: 97 elements
[INFO] Kmeans Cluster 24: 248 elements
[INFO] Kmeans Cluster 25: 220 elements
[INFO] Kmeans Cluster 26: 210 elements
[INFO] Kmeans Cluster 27: 171 elements
[INFO] Kmeans Cluster 28: 79 elements
[INFO] Kmeans Cluster 29: 144 elements
[INFO] Kmeans Cluster 30: 74 elements
[INFO] Kmeans Cluster 31: 53 elements
[INFO] Kmeans Cluster 32: 233 elements
[INFO] Kmeans Cluster 33: 106 elements
[INFO] Kmeans Cluster 34: 158 elements
[INFO] Kmeans Cluster 35: 100 elements
[INFO] Kmeans Cluster 36: 193 elements
[INFO] Kmeans Cluster 37: 147 elements
[INFO] Kmeans Cluster 38: 237 elements
[INFO] Kmeans Cluster 39: 151 elements
[INFO] Kmeans Cluster 40: 190 elements
[INFO] Kmeans Cluster 41: 138 elements
[INFO] Kmeans Cluster 42: 192 elements
[INFO] Kmeans Cluster 43: 254 elements
[INFO] Kmeans Cluster 44: 198 elements
[INFO] Kmeans Cluster 45: 233 elements
[INFO] Kmeans Cluster 46: 257 elements
[INFO] Kmeans Cluster 47: 167 elements
[INFO] Kmeans Cluster 48: 142 elements
[INFO] Kmeans Cluster 49: 149 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=152.82, Long SMA=169.57, Sharpe=-0.0013
[INFO] Centroid 1: Short SMA=36.77, Long SMA=156.94, Sharpe=0.0636
[INFO] Centroid 2: Short SMA=63.36, Long SMA=161.44, Sharpe=-0.3073
[INFO] Centroid 3: Short SMA=205.20, Long SMA=266.67, Sharpe=-0.0525
[INFO] Centroid 4: Short SMA=42.03, Long SMA=257.23, Sharpe=0.2777
[INFO] Centroid 5: Short SMA=192.91, Long SMA=236.60, Sharpe=0.2422
[INFO] Centroid 6: Short SMA=27.01, Long SMA=98.45, Sharpe=-0.3197
[INFO] Centroid 7: Short SMA=100.65, Long SMA=203.38, Sharpe=-0.2939
[INFO] Centroid 8: Short SMA=25.92, Long SMA=53.32, Sharpe=0.0679
[INFO] Centroid 9: Short SMA=35.41, Long SMA=235.91, Sharpe=0.1666
[INFO] Centroid 10: Short SMA=169.87, Long SMA=198.06, Sharpe=-0.2910
[INFO] Centroid 11: Short SMA=78.38, Long SMA=116.45, Sharpe=-0.2147
[INFO] Centroid 12: Short SMA=119.02, Long SMA=176.25, Sharpe=-0.4272
[INFO] Centroid 13: Short SMA=129.22, Long SMA=210.22, Sharpe=-0.0452
[INFO] Centroid 14: Short SMA=18.28, Long SMA=256.35, Sharpe=-0.0220
[INFO] Centroid 15: Short SMA=50.97, Long SMA=77.94, Sharpe=-0.6069
[INFO] Centroid 16: Short SMA=274.80, Long SMA=292.84, Sharpe=-0.3075
[INFO] Centroid 17: Short SMA=113.75, Long SMA=145.07, Sharpe=-0.1313
[INFO] Centroid 18: Short SMA=78.83, Long SMA=120.12, Sharpe=-0.0800
[INFO] Centroid 19: Short SMA=228.30, Long SMA=278.37, Sharpe=0.1152
[INFO] Centroid 20: Short SMA=52.79, Long SMA=87.78, Sharpe=-0.4684
[INFO] Centroid 21: Short SMA=39.58, Long SMA=147.97, Sharpe=0.2629
[INFO] Centroid 22: Short SMA=26.50, Long SMA=211.37, Sharpe=0.0568
[INFO] Centroid 23: Short SMA=107.13, Long SMA=185.26, Sharpe=-0.6284
[INFO] Centroid 24: Short SMA=56.33, Long SMA=201.94, Sharpe=-0.0314
[INFO] Centroid 25: Short SMA=217.53, Long SMA=246.97, Sharpe=0.1240
[INFO] Centroid 26: Short SMA=81.78, Long SMA=210.30, Sharpe=-0.1647
[INFO] Centroid 27: Short SMA=99.93, Long SMA=138.07, Sharpe=0.0070
[INFO] Centroid 28: Short SMA=18.35, Long SMA=34.76, Sharpe=-0.2905
[INFO] Centroid 29: Short SMA=190.94, Long SMA=215.57, Sharpe=0.0446
[INFO] Centroid 30: Short SMA=34.49, Long SMA=50.43, Sharpe=0.2627
[INFO] Centroid 31: Short SMA=114.79, Long SMA=273.58, Sharpe=-0.0407
[INFO] Centroid 32: Short SMA=71.81, Long SMA=107.43, Sharpe=-0.3647
[INFO] Centroid 33: Short SMA=21.68, Long SMA=140.32, Sharpe=-0.2726
[INFO] Centroid 34: Short SMA=60.05, Long SMA=238.59, Sharpe=0.0733
[INFO] Centroid 35: Short SMA=162.48, Long SMA=178.20, Sharpe=-0.5235
[INFO] Centroid 36: Short SMA=147.22, Long SMA=189.66, Sharpe=-0.1654
[INFO] Centroid 37: Short SMA=19.61, Long SMA=121.13, Sharpe=-0.4762
[INFO] Centroid 38: Short SMA=44.80, Long SMA=279.91, Sharpe=0.1537
[INFO] Centroid 39: Short SMA=263.72, Long SMA=282.58, Sharpe=-0.1960
[INFO] Centroid 40: Short SMA=166.73, Long SMA=222.58, Sharpe=-0.1105
[INFO] Centroid 41: Short SMA=233.68, Long SMA=259.16, Sharpe=0.2805
[INFO] Centroid 42: Short SMA=29.76, Long SMA=290.04, Sharpe=0.0217
[INFO] Centroid 43: Short SMA=75.65, Long SMA=165.76, Sharpe=-0.1371
[INFO] Centroid 44: Short SMA=124.64, Long SMA=160.86, Sharpe=-0.2902
[INFO] Centroid 45: Short SMA=88.73, Long SMA=238.45, Sharpe=-0.1608
[INFO] Centroid 46: Short SMA=23.89, Long SMA=177.61, Sharpe=-0.0760
[INFO] Centroid 47: Short SMA=245.25, Long SMA=280.66, Sharpe=-0.0186
[INFO] Centroid 48: Short SMA=23.90, Long SMA=62.48, Sharpe=-0.1033
[INFO] Centroid 49: Short SMA=128.38, Long SMA=223.15, Sharpe=0.0735
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.6698, Trades=154
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=234, Long SMA=258, Sharpe=0.4412, Trades=19
[INFO] Kmeans Top 2: Short SMA=40, Long SMA=148, Sharpe=0.3269, Trades=31
[INFO] Kmeans Top 3: Short SMA=42, Long SMA=258, Sharpe=0.3134, Trades=11
[INFO] Kmeans Top 4: Short SMA=38, Long SMA=52, Sharpe=0.3037, Trades=72
[INFO] Kmeans Top 5: Short SMA=192, Long SMA=236, Sharpe=0.2634, Trades=19
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (153, 170)
[INFO]   Nearest: (152.0, 170.0)
[INFO]   Rounded: (37, 157)
[INFO]   Nearest: (36.0, 156.0)
[INFO]   Rounded: (63, 161)
[INFO]   Nearest: (64.0, 162.0)
[INFO]   Rounded: (205, 267)
[INFO]   Nearest: (206.0, 266.0)
[INFO]   Rounded: (42, 257)
[INFO]   Nearest: (42.0, 258.0)
[INFO]   Rounded: (193, 237)
[INFO]   Nearest: (192.0, 236.0)
[INFO]   Rounded: (27, 98)
[INFO]   Nearest: (28.0, 98.0)
[INFO]   Rounded: (101, 203)
[INFO]   Nearest: (100.0, 204.0)
[INFO]   Rounded: (26, 53)
[INFO]   Nearest: (26.0, 54.0)
[INFO]   Rounded: (35, 236)
[INFO]   Nearest: (36.0, 236.0)
[INFO]   Rounded: (170, 198)
[INFO]   Rounded: (78, 116)
[INFO]   Rounded: (119, 176)
[INFO]   Nearest: (120.0, 176.0)
[INFO]   Rounded: (129, 210)
[INFO]   Nearest: (130.0, 210.0)
[INFO]   Rounded: (18, 256)
[INFO]   Rounded: (51, 78)
[INFO]   Nearest: (50.0, 78.0)
[INFO]   Rounded: (275, 293)
[INFO]   Nearest: (274.0, 292.0)
[INFO]   Rounded: (114, 145)
[INFO]   Nearest: (114.0, 146.0)
[INFO]   Rounded: (79, 120)
[INFO]   Nearest: (78.0, 120.0)
[INFO]   Rounded: (228, 278)
[INFO]   Rounded: (53, 88)
[INFO]   Nearest: (52.0, 88.0)
[INFO]   Rounded: (40, 148)
[INFO]   Rounded: (26, 211)
[INFO]   Nearest: (26.0, 212.0)
[INFO]   Rounded: (107, 185)
[INFO]   Nearest: (108.0, 186.0)
[INFO]   Rounded: (56, 202)
[INFO]   Rounded: (218, 247)
[INFO]   Nearest: (218.0, 246.0)
[INFO]   Rounded: (82, 210)
[INFO]   Rounded: (100, 138)
[INFO]   Rounded: (18, 35)
[INFO]   Nearest: (18.0, 34.0)
[INFO]   Rounded: (191, 216)
[INFO]   Nearest: (190.0, 216.0)
[INFO]   Rounded: (34, 50)
[INFO]   Rounded: (115, 274)
[INFO]   Nearest: (114.0, 274.0)
[INFO]   Rounded: (72, 107)
[INFO]   Nearest: (72.0, 108.0)
[INFO]   Rounded: (22, 140)
[INFO]   Rounded: (60, 239)
[INFO]   Nearest: (60.0, 238.0)
[INFO]   Rounded: (162, 178)
[INFO]   Rounded: (147, 190)
[INFO]   Nearest: (148.0, 190.0)
[INFO]   Rounded: (20, 121)
[INFO]   Nearest: (20.0, 122.0)
[INFO]   Rounded: (45, 280)
[INFO]   Nearest: (44.0, 280.0)
[INFO]   Rounded: (264, 283)
[INFO]   Nearest: (264.0, 282.0)
[INFO]   Rounded: (167, 223)
[INFO]   Nearest: (166.0, 222.0)
[INFO]   Rounded: (234, 259)
[INFO]   Nearest: (234.0, 260.0)
[INFO]   Rounded: (30, 290)
[INFO]   Rounded: (76, 166)
[INFO]   Rounded: (125, 161)
[INFO]   Nearest: (124.0, 160.0)
[INFO]   Rounded: (89, 238)
[INFO]   Nearest: (88.0, 238.0)
[INFO]   Rounded: (24, 178)
[INFO]   Rounded: (245, 281)
[INFO]   Nearest: (246.0, 280.0)
[INFO]   Rounded: (24, 62)
[INFO]   Rounded: (128, 223)
[INFO]   Nearest: (128.0, 224.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(234/258) - Original Sharpe: 0.4412, Trades: 19
[INFO] Kmeans cluster 2: SMA(40/148) - Original Sharpe: 0.3269, Trades: 31
[INFO] Kmeans cluster 3: SMA(42/258) - Original Sharpe: 0.3134, Trades: 11
[INFO] Kmeans cluster 4: SMA(38/52) - Original Sharpe: 0.3037, Trades: 72
[INFO] Kmeans cluster 5: SMA(192/236) - Original Sharpe: 0.2634, Trades: 19
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (234/258) - Sharpe: 0.4412
[INFO] cluster 2: (40/148) - Sharpe: 0.3269
[INFO] cluster 3: (42/258) - Sharpe: 0.3134
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.846146           -1.499253
1    2021-11-14 2021-11-14            43     1.283193            0.875645
2    2022-01-14 2022-01-14            41     2.565750           -2.599547
3    2022-03-14 2022-03-14            44    -3.404503           -1.590626
4    2022-05-14 2022-05-14            43     2.893818            3.555903
5    2022-07-14 2022-07-14            44     0.011366            0.011366
6    2022-09-14 2022-09-14            43     3.966370           -1.875590
7    2022-11-14 2022-11-14            43     1.499239           -0.140957
8    2023-01-14 2023-01-14            41    -2.431921           -1.645791
9    2023-03-14 2023-03-14            43    -5.362105            2.972700
10   2023-05-14 2023-05-14            44    -0.525137            0.121407
11   2023-07-14 2023-07-14            44    -4.645863           -4.581097
12   2023-09-14 2023-09-14            43     1.669521           -0.227084
13   2023-11-14 2023-11-14            42    -3.736541           -0.707157
14   2024-01-14 2024-01-14            43    -2.734966           -2.174761
15   2024-03-14 2024-03-14            42     2.485153           -1.005391
16   2024-05-14 2024-05-14            44     1.052155            0.294202
17   2024-07-14 2024-07-14            45    -2.506040           -0.245055
18   2024-09-14 2024-09-14            43    -1.009444           -0.349255
19   2024-11-14 2024-11-14            33     1.294467           -1.444151
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.8 |             -1.5 |          0.3 | True          
[INFO] 2021-11-14   |          1.3 |              0.9 |         -0.4 | False         
[INFO] 2022-01-14   |          2.6 |             -2.6 |         -5.2 | False         
[INFO] 2022-03-14   |         -3.4 |             -1.6 |          1.8 | True          
[INFO] 2022-05-14   |          2.9 |              3.6 |          0.7 | True          
[INFO] 2022-07-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |          4.0 |             -1.9 |         -5.9 | False         
[INFO] 2022-11-14   |          1.5 |             -0.1 |         -1.6 | False         
[INFO] 2023-01-14   |         -2.4 |             -1.6 |          0.8 | True          
[INFO] 2023-03-14   |         -5.4 |              3.0 |          8.4 | True          
[INFO] 2023-05-14   |         -0.5 |              0.1 |          0.6 | True          
[INFO] 2023-07-14   |         -4.6 |             -4.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.7 |             -0.2 |         -1.9 | False         
[INFO] 2023-11-14   |         -3.7 |             -0.7 |          3.0 | True          
[INFO] 2024-01-14   |         -2.7 |             -2.2 |          0.5 | True          
[INFO] 2024-03-14   |          2.5 |             -1.0 |         -3.5 | False         
[INFO] 2024-05-14   |          1.1 |              0.3 |         -0.8 | False         
[INFO] 2024-07-14   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-09-14   |         -1.0 |             -0.3 |          0.7 | True          
[INFO] 2024-11-14   |          1.3 |             -1.4 |         -2.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-14, 2023-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 10 of 18 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for SI...
[INFO] Excel file updated successfully. Added SI with Kmeans win rate 55.6% in row 45
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(234/258) - Original Sharpe: 0.4412
[INFO] Added cluster 2 to portfolio: SMA(40/148) - Original Sharpe: 0.3269
[INFO] Added cluster 3 to portfolio: SMA(42/258) - Original Sharpe: 0.3134
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SI_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.5632
[INFO] Kmeans Best out-of-sample Sharpe: -0.4083
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for SI...
[INFO] Excel file updated successfully. Added SI with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SI
[INFO] Big Point Value: 5000.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9380 to 0.6698
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.669797
[INFO] Number of Trades: 154
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8660 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9380 to 0.6698
[INFO] Trades range: 11.0 to 337.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2464 to 2.7541
[INFO] Scaled Long SMA range: -2.6696 to 1.6829
[INFO] Scaled Sharpe ratio range: -3.7133 to 3.4043
[INFO] Scaled Trades range: -0.9008 to 12.8274
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8660 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6294
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 402 elements
[INFO] Cluster 1: 327 elements
[INFO] Cluster 2: 420 elements
[INFO] Cluster 3: 331 elements
[INFO] Cluster 4: 321 elements
[INFO] Cluster 5: 376 elements
[INFO] Cluster 6: 243 elements
[INFO] Cluster 7: 119 elements
[INFO] Cluster 8: 239 elements
[INFO] Cluster 9: 337 elements
[INFO] Cluster 10: 76 elements
[INFO] Cluster 11: 31 elements
[INFO] Cluster 12: 152 elements
[INFO] Cluster 13: 188 elements
[INFO] Cluster 14: 211 elements
[INFO] Cluster 15: 76 elements
[INFO] Cluster 16: 252 elements
[INFO] Cluster 17: 30 elements
[INFO] Cluster 18: 351 elements
[INFO] Cluster 19: 246 elements
[INFO] Cluster 20: 177 elements
[INFO] Cluster 21: 288 elements
[INFO] Cluster 22: 347 elements
[INFO] Cluster 23: 39 elements
[INFO] Cluster 24: 82 elements
[INFO] Cluster 25: 35 elements
[INFO] Cluster 26: 110 elements
[INFO] Cluster 27: 301 elements
[INFO] Cluster 28: 190 elements
[INFO] Cluster 29: 77 elements
[INFO] Cluster 30: 5 elements
[INFO] Cluster 31: 267 elements
[INFO] Cluster 32: 114 elements
[INFO] Cluster 33: 107 elements
[INFO] Cluster 34: 49 elements
[INFO] Cluster 35: 21 elements
[INFO] Cluster 36: 78 elements
[INFO] Cluster 37: 130 elements
[INFO] Cluster 38: 191 elements
[INFO] Cluster 39: 108 elements
[INFO] Cluster 40: 222 elements
[INFO] Cluster 41: 39 elements
[INFO] Cluster 42: 122 elements
[INFO] Cluster 43: 220 elements
[INFO] Cluster 44: 201 elements
[INFO] Cluster 45: 20 elements
[INFO] Cluster 46: 36 elements
[INFO] Cluster 47: 105 elements
[INFO] Cluster 48: 145 elements
[INFO] Cluster 49: 106 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=72, Long SMA=174, Sharpe=-0.1124, Trades=19
[INFO] Cluster 1 cluster: Short SMA=126, Long SMA=222, Sharpe=0.1184, Trades=11
[INFO] Cluster 2 cluster: Short SMA=218, Long SMA=262, Sharpe=0.1051, Trades=19
[INFO] Cluster 3 cluster: Short SMA=36, Long SMA=114, Sharpe=-0.3942, Trades=42
[INFO] Cluster 4 cluster: Short SMA=100, Long SMA=144, Sharpe=-0.0810, Trades=32
[INFO] Cluster 5 cluster: Short SMA=134, Long SMA=174, Sharpe=-0.5098, Trades=31
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=172, Sharpe=-0.0427, Trades=34
[INFO] Cluster 7 cluster: Short SMA=92, Long SMA=100, Sharpe=-0.1934, Trades=67
[INFO] Cluster 8 cluster: Short SMA=68, Long SMA=172, Sharpe=-0.3369, Trades=19
[INFO] Cluster 9 cluster: Short SMA=190, Long SMA=236, Sharpe=0.2728, Trades=19
[INFO] Cluster 10 cluster: Short SMA=228, Long SMA=232, Sharpe=0.0863, Trades=49
[INFO] Cluster 11 cluster: Short SMA=22, Long SMA=28, Sharpe=-0.3516, Trades=148
[INFO] Cluster 12 cluster: Short SMA=170, Long SMA=228, Sharpe=-0.0167, Trades=19
[INFO] Cluster 13 cluster: Short SMA=24, Long SMA=60, Sharpe=0.1711, Trades=58
[INFO] Cluster 14 cluster: Short SMA=238, Long SMA=276, Sharpe=-0.0126, Trades=17
[INFO] Cluster 15 cluster: Short SMA=118, Long SMA=126, Sharpe=0.0282, Trades=61
[INFO] Cluster 16 cluster: Short SMA=266, Long SMA=288, Sharpe=-0.2702, Trades=17
[INFO] Cluster 17 cluster: Short SMA=112, Long SMA=114, Sharpe=-0.3473, Trades=120
[INFO] Cluster 18 cluster: Short SMA=82, Long SMA=232, Sharpe=-0.1861, Trades=13
[INFO] Cluster 19 cluster: Short SMA=38, Long SMA=252, Sharpe=0.3019, Trades=17
[INFO] Cluster 20 cluster: Short SMA=40, Long SMA=148, Sharpe=0.3269, Trades=31
[INFO] Cluster 21 cluster: Short SMA=52, Long SMA=96, Sharpe=-0.4638, Trades=47
[INFO] Cluster 22 cluster: Short SMA=24, Long SMA=276, Sharpe=0.0784, Trades=23
[INFO] Cluster 23 cluster: Short SMA=180, Long SMA=182, Sharpe=-0.3418, Trades=105
[INFO] Cluster 24 cluster: Short SMA=68, Long SMA=76, Sharpe=-0.6505, Trades=73
[INFO] Cluster 25 cluster: Short SMA=36, Long SMA=40, Sharpe=-0.1049, Trades=134
[INFO] Cluster 26 cluster: Short SMA=170, Long SMA=182, Sharpe=-0.3833, Trades=53
[INFO] Cluster 27 cluster: Short SMA=42, Long SMA=204, Sharpe=0.0749, Trades=19
[INFO] Cluster 28 cluster: Short SMA=16, Long SMA=224, Sharpe=-0.0291, Trades=33
[INFO] Cluster 29 cluster: Short SMA=24, Long SMA=40, Sharpe=-0.0098, Trades=80
[INFO] Cluster 31 cluster: Short SMA=96, Long SMA=208, Sharpe=-0.1891, Trades=13
[INFO] Cluster 32 cluster: Short SMA=22, Long SMA=80, Sharpe=-0.1906, Trades=54
[INFO] Cluster 33 cluster: Short SMA=14, Long SMA=124, Sharpe=-0.5745, Trades=66
[INFO] Cluster 34 cluster: Short SMA=164, Long SMA=176, Sharpe=-0.6324, Trades=55
[INFO] Cluster 35 cluster: Short SMA=16, Long SMA=20, Sharpe=-0.1691, Trades=203
[INFO] Cluster 36 cluster: Short SMA=192, Long SMA=200, Sharpe=0.0774, Trades=51
[INFO] Cluster 37 cluster: Short SMA=106, Long SMA=186, Sharpe=-0.7948, Trades=19
[INFO] Cluster 38 cluster: Short SMA=164, Long SMA=210, Sharpe=-0.2925, Trades=23
[INFO] Cluster 39 cluster: Short SMA=234, Long SMA=260, Sharpe=0.3309, Trades=19
[INFO] Cluster 40 cluster: Short SMA=52, Long SMA=278, Sharpe=0.2104, Trades=13
[INFO] Cluster 41 cluster: Short SMA=40, Long SMA=52, Sharpe=0.3034, Trades=76
[INFO] Cluster 42 cluster: Short SMA=66, Long SMA=136, Sharpe=-0.1849, Trades=29
[INFO] Cluster 43 cluster: Short SMA=50, Long SMA=232, Sharpe=0.1589, Trades=17
[INFO] Cluster 44 cluster: Short SMA=98, Long SMA=128, Sharpe=-0.1404, Trades=38
[INFO] Cluster 45 cluster: Short SMA=278, Long SMA=280, Sharpe=-0.2265, Trades=57
[INFO] Cluster 46 cluster: Short SMA=14, Long SMA=36, Sharpe=-0.4249, Trades=96
[INFO] Cluster 47 cluster: Short SMA=46, Long SMA=82, Sharpe=-0.6745, Trades=48
[INFO] Cluster 48 cluster: Short SMA=146, Long SMA=192, Sharpe=-0.1586, Trades=29
[INFO] Cluster 49 cluster: Short SMA=40, Long SMA=128, Sharpe=-0.0321, Trades=40
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.6698, Trades=154
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=234, Long SMA=260, Sharpe=0.3309, Trades=19
[INFO] Top 2: Short SMA=40, Long SMA=148, Sharpe=0.3269, Trades=31
[INFO] Top 3: Short SMA=40, Long SMA=52, Sharpe=0.3034, Trades=76
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 8655 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(234/260) - Original Sharpe: 0.3309, Trades: 19
[INFO] Hierarchical cluster 2: SMA(40/148) - Original Sharpe: 0.3269, Trades: 31
[INFO] Hierarchical cluster 3: SMA(40/52) - Original Sharpe: 0.3034, Trades: 76
[INFO] Hierarchical cluster 4: SMA(38/252) - Original Sharpe: 0.3019, Trades: 17
[INFO] Hierarchical cluster 5: SMA(190/236) - Original Sharpe: 0.2728, Trades: 19
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (234/260) - Sharpe: 0.3309
[INFO] cluster 2: (40/148) - Sharpe: 0.3269
[INFO] cluster 3: (40/52) - Sharpe: 0.3034
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.846146           -1.499253
1    2021-11-14 2021-11-14            43     1.283193           -2.944700
2    2022-01-14 2022-01-14            41     2.565750            0.056918
3    2022-03-14 2022-03-14            44    -3.404503           -1.157682
4    2022-05-14 2022-05-14            43     2.893818            3.555903
5    2022-07-14 2022-07-14            44     0.011366           -0.283268
6    2022-09-14 2022-09-14            43     3.966370           -1.577335
7    2022-11-14 2022-11-14            43     1.499239            3.478177
8    2023-01-14 2023-01-14            41    -2.431921           -2.431921
9    2023-03-14 2023-03-14            43    -5.362105           -5.362105
10   2023-05-14 2023-05-14            44    -0.525137           -2.832263
11   2023-07-14 2023-07-14            44    -4.645863           -4.361701
12   2023-09-14 2023-09-14            43     1.669521            0.419633
13   2023-11-14 2023-11-14            42    -3.736541           -3.935676
14   2024-01-14 2024-01-14            43    -2.734966           -2.628153
15   2024-03-14 2024-03-14            42     2.485153            2.684074
16   2024-05-14 2024-05-14            44     1.052155            0.294202
17   2024-07-14 2024-07-14            45    -2.506040           -1.648631
18   2024-09-14 2024-09-14            43    -1.009444           -0.863697
19   2024-11-14 2024-11-14            33     1.294467           -0.857797
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.8 |             -1.5 |          0.3 | True          
[INFO] 2021-11-14   |          1.3 |             -2.9 |         -4.2 | False         
[INFO] 2022-01-14   |          2.6 |              0.1 |         -2.5 | False         
[INFO] 2022-03-14   |         -3.4 |             -1.2 |          2.2 | True          
[INFO] 2022-05-14   |          2.9 |              3.6 |          0.7 | True          
[INFO] 2022-07-14   |          0.0 |             -0.3 |         -0.3 | False         
[INFO] 2022-09-14   |          4.0 |             -1.6 |         -5.6 | False         
[INFO] 2022-11-14   |          1.5 |              3.5 |          2.0 | True          
[INFO] 2023-01-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -5.4 |             -5.4 |          0.0 | Excluded      
[INFO] 2023-05-14   |         -0.5 |             -2.8 |         -2.3 | False         
[INFO] 2023-07-14   |         -4.6 |             -4.4 |          0.2 | True          
[INFO] 2023-09-14   |          1.7 |              0.4 |         -1.3 | False         
[INFO] 2023-11-14   |         -3.7 |             -3.9 |         -0.2 | False         
[INFO] 2024-01-14   |         -2.7 |             -2.6 |          0.1 | True          
[INFO] 2024-03-14   |          2.5 |              2.7 |          0.2 | True          
[INFO] 2024-05-14   |          1.1 |              0.3 |         -0.8 | False         
[INFO] 2024-07-14   |         -2.5 |             -1.6 |          0.9 | True          
[INFO] 2024-09-14   |         -1.0 |             -0.9 |          0.1 | True          
[INFO] 2024-11-14   |          1.3 |             -0.9 |         -2.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-01-14, 2023-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 9 of 18 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for SI...
[INFO] Excel file updated successfully. Added SI with Hierarchical win rate 50.0% in row 45
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(234/260) - Original Sharpe: 0.3309
[INFO] Added cluster 2 to portfolio: SMA(40/148) - Original Sharpe: 0.3269
[INFO] Added cluster 3 to portfolio: SMA(40/52) - Original Sharpe: 0.3034
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SI_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.8256
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4083
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for SI...
[INFO] Excel file updated successfully. Added SI with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SI
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SM in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 68.60s
[INFO] Best parameters: Short SMA = 70, Long SMA = 74
[INFO] Best Sharpe ratio: 0.679896, Trades: 87
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172', 'SMA_SF_TOP5_192/194', 'SMA_SF_TOP5_186/204', 'SMA_SF_TOP5_190/196', 'SMA_SF_TOP5_186/206', 'SMA_SF_TOP5_184/206', 'SMA_SI_TOP5_48/50', 'SMA_SI_TOP5_42/58', 'SMA_SI_TOP5_44/56', 'SMA_SI_TOP5_40/60', 'SMA_SI_TOP5_234/258', 'SMA_SM_TOP5_70/74', 'SMA_SM_TOP5_12/20', 'SMA_SM_TOP5_14/22', 'SMA_SM_TOP5_66/78', 'SMA_SM_TOP5_14/24']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SM
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.37 contracts
[INFO] Maximum Position Size: 19 contracts
[INFO] Strategy Total P&L: $214,754.00
[INFO] Market Buy & Hold P&L: $10,810.00
[INFO] Outperformance: $203,944.00
[INFO] Sharpe ratio (entire period, annualized): 0.196631
[INFO] Sharpe ratio (in-sample, annualized): 0.679896
[INFO] Sharpe ratio (out-of-sample, annualized): -0.899276
[INFO] Maximum Drawdown: $250,628.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 63
[INFO] Out-of-sample period trades: 24
[INFO] Total trades: 87
[INFO] In-sample P&L: $356,944.00
[INFO] Out-of-sample P&L: $-208,076.00
[INFO] 
Best parameters from GA: Short SMA = 70, Long SMA = 74, Sharpe = 0.679896
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.3858 to 0.6799
[INFO] 
Best parameters:
[INFO] Short SMA: 70
[INFO] Long SMA: 74
[INFO] Sharpe Ratio: 0.679896
[INFO] Number of Trades: 87
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.3858 to 0.6799
[INFO] Trades range: 12.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.2107 to 3.4208
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 170 elements
[INFO] Kmeans Cluster 1: 319 elements
[INFO] Kmeans Cluster 2: 137 elements
[INFO] Kmeans Cluster 3: 176 elements
[INFO] Kmeans Cluster 4: 334 elements
[INFO] Kmeans Cluster 5: 230 elements
[INFO] Kmeans Cluster 6: 259 elements
[INFO] Kmeans Cluster 7: 244 elements
[INFO] Kmeans Cluster 8: 158 elements
[INFO] Kmeans Cluster 9: 226 elements
[INFO] Kmeans Cluster 10: 269 elements
[INFO] Kmeans Cluster 11: 167 elements
[INFO] Kmeans Cluster 12: 302 elements
[INFO] Kmeans Cluster 13: 301 elements
[INFO] Kmeans Cluster 14: 257 elements
[INFO] Kmeans Cluster 15: 206 elements
[INFO] Kmeans Cluster 16: 251 elements
[INFO] Kmeans Cluster 17: 155 elements
[INFO] Kmeans Cluster 18: 311 elements
[INFO] Kmeans Cluster 19: 146 elements
[INFO] Kmeans Cluster 20: 173 elements
[INFO] Kmeans Cluster 21: 253 elements
[INFO] Kmeans Cluster 22: 218 elements
[INFO] Kmeans Cluster 23: 161 elements
[INFO] Kmeans Cluster 24: 289 elements
[INFO] Kmeans Cluster 25: 189 elements
[INFO] Kmeans Cluster 26: 315 elements
[INFO] Kmeans Cluster 27: 205 elements
[INFO] Kmeans Cluster 28: 170 elements
[INFO] Kmeans Cluster 29: 191 elements
[INFO] Kmeans Cluster 30: 139 elements
[INFO] Kmeans Cluster 31: 186 elements
[INFO] Kmeans Cluster 32: 92 elements
[INFO] Kmeans Cluster 33: 183 elements
[INFO] Kmeans Cluster 34: 238 elements
[INFO] Kmeans Cluster 35: 323 elements
[INFO] Kmeans Cluster 36: 189 elements
[INFO] Kmeans Cluster 37: 136 elements
[INFO] Kmeans Cluster 38: 137 elements
[INFO] Kmeans Cluster 39: 184 elements
[INFO] Kmeans Cluster 40: 177 elements
[INFO] Kmeans Cluster 41: 171 elements
[INFO] Kmeans Cluster 42: 158 elements
[INFO] Kmeans Cluster 43: 235 elements
[INFO] Kmeans Cluster 44: 326 elements
[INFO] Kmeans Cluster 45: 146 elements
[INFO] Kmeans Cluster 46: 190 elements
[INFO] Kmeans Cluster 47: 95 elements
[INFO] Kmeans Cluster 48: 246 elements
[INFO] Kmeans Cluster 49: 252 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=126.28, Long SMA=226.01, Sharpe=-0.4812
[INFO] Centroid 1: Short SMA=35.99, Long SMA=132.31, Sharpe=-0.1356
[INFO] Centroid 2: Short SMA=260.70, Long SMA=285.20, Sharpe=-0.8644
[INFO] Centroid 3: Short SMA=96.34, Long SMA=282.84, Sharpe=-0.8665
[INFO] Centroid 4: Short SMA=195.13, Long SMA=247.62, Sharpe=-0.3274
[INFO] Centroid 5: Short SMA=22.55, Long SMA=57.66, Sharpe=0.1467
[INFO] Centroid 6: Short SMA=28.71, Long SMA=266.12, Sharpe=-0.4030
[INFO] Centroid 7: Short SMA=196.16, Long SMA=289.61, Sharpe=-0.6383
[INFO] Centroid 8: Short SMA=112.71, Long SMA=140.30, Sharpe=-0.6723
[INFO] Centroid 9: Short SMA=163.78, Long SMA=201.05, Sharpe=-0.0047
[INFO] Centroid 10: Short SMA=54.60, Long SMA=155.60, Sharpe=-0.2601
[INFO] Centroid 11: Short SMA=132.53, Long SMA=158.49, Sharpe=-0.9754
[INFO] Centroid 12: Short SMA=163.63, Long SMA=262.26, Sharpe=-0.2311
[INFO] Centroid 13: Short SMA=85.47, Long SMA=171.77, Sharpe=-0.4699
[INFO] Centroid 14: Short SMA=22.93, Long SMA=181.43, Sharpe=-0.2092
[INFO] Centroid 15: Short SMA=91.83, Long SMA=263.38, Sharpe=-0.6502
[INFO] Centroid 16: Short SMA=27.00, Long SMA=101.08, Sharpe=0.0459
[INFO] Centroid 17: Short SMA=149.63, Long SMA=178.59, Sharpe=-0.4994
[INFO] Centroid 18: Short SMA=73.62, Long SMA=209.14, Sharpe=-0.2659
[INFO] Centroid 19: Short SMA=80.56, Long SMA=293.56, Sharpe=-1.0653
[INFO] Centroid 20: Short SMA=56.40, Long SMA=81.19, Sharpe=0.3412
[INFO] Centroid 21: Short SMA=227.21, Long SMA=273.82, Sharpe=-0.4897
[INFO] Centroid 22: Short SMA=25.15, Long SMA=243.35, Sharpe=-0.2504
[INFO] Centroid 23: Short SMA=35.57, Long SMA=54.97, Sharpe=-0.1036
[INFO] Centroid 24: Short SMA=117.92, Long SMA=201.47, Sharpe=-0.6535
[INFO] Centroid 25: Short SMA=90.56, Long SMA=115.49, Sharpe=-0.2687
[INFO] Centroid 26: Short SMA=32.30, Long SMA=215.69, Sharpe=-0.3202
[INFO] Centroid 27: Short SMA=124.65, Long SMA=265.66, Sharpe=-0.5057
[INFO] Centroid 28: Short SMA=223.54, Long SMA=237.99, Sharpe=-0.1088
[INFO] Centroid 29: Short SMA=30.93, Long SMA=287.35, Sharpe=-0.5984
[INFO] Centroid 30: Short SMA=271.93, Long SMA=295.01, Sharpe=-1.0944
[INFO] Centroid 31: Short SMA=142.58, Long SMA=257.84, Sharpe=-0.3355
[INFO] Centroid 32: Short SMA=15.09, Long SMA=37.04, Sharpe=0.3658
[INFO] Centroid 33: Short SMA=73.56, Long SMA=106.07, Sharpe=-0.0720
[INFO] Centroid 34: Short SMA=153.73, Long SMA=222.69, Sharpe=-0.2431
[INFO] Centroid 35: Short SMA=61.22, Long SMA=247.85, Sharpe=-0.3768
[INFO] Centroid 36: Short SMA=121.14, Long SMA=171.84, Sharpe=-0.8386
[INFO] Centroid 37: Short SMA=234.00, Long SMA=256.40, Sharpe=-0.2674
[INFO] Centroid 38: Short SMA=243.31, Long SMA=282.70, Sharpe=-0.6439
[INFO] Centroid 39: Short SMA=21.79, Long SMA=140.08, Sharpe=-0.3367
[INFO] Centroid 40: Short SMA=169.54, Long SMA=284.93, Sharpe=-0.4497
[INFO] Centroid 41: Short SMA=175.13, Long SMA=196.80, Sharpe=-0.1781
[INFO] Centroid 42: Short SMA=127.25, Long SMA=290.82, Sharpe=-0.7101
[INFO] Centroid 43: Short SMA=53.01, Long SMA=90.45, Sharpe=0.1760
[INFO] Centroid 44: Short SMA=98.64, Long SMA=232.63, Sharpe=-0.5790
[INFO] Centroid 45: Short SMA=55.16, Long SMA=288.75, Sharpe=-0.8149
[INFO] Centroid 46: Short SMA=194.40, Long SMA=217.87, Sharpe=-0.4132
[INFO] Centroid 47: Short SMA=129.22, Long SMA=149.60, Sharpe=-1.1823
[INFO] Centroid 48: Short SMA=90.38, Long SMA=136.39, Sharpe=-0.4308
[INFO] Centroid 49: Short SMA=53.26, Long SMA=188.07, Sharpe=-0.3569
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=70, Long SMA=74, Sharpe=0.6799, Trades=87
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=56, Long SMA=82, Sharpe=0.3221, Trades=35
[INFO] Kmeans Top 2: Short SMA=16, Long SMA=34, Sharpe=0.2589, Trades=82
[INFO] Kmeans Top 3: Short SMA=52, Long SMA=94, Sharpe=0.2189, Trades=33
[INFO] Kmeans Top 4: Short SMA=22, Long SMA=58, Sharpe=0.1150, Trades=55
[INFO] Kmeans Top 5: Short SMA=164, Long SMA=202, Sharpe=0.0296, Trades=29
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (126, 226)
[INFO]   Rounded: (36, 132)
[INFO]   Rounded: (261, 285)
[INFO]   Nearest: (260.0, 286.0)
[INFO]   Rounded: (96, 283)
[INFO]   Nearest: (96.0, 282.0)
[INFO]   Rounded: (195, 248)
[INFO]   Nearest: (196.0, 248.0)
[INFO]   Rounded: (23, 58)
[INFO]   Nearest: (22.0, 58.0)
[INFO]   Rounded: (29, 266)
[INFO]   Nearest: (28.0, 266.0)
[INFO]   Rounded: (196, 290)
[INFO]   Rounded: (113, 140)
[INFO]   Nearest: (112.0, 140.0)
[INFO]   Rounded: (164, 201)
[INFO]   Nearest: (164.0, 202.0)
[INFO]   Rounded: (55, 156)
[INFO]   Nearest: (54.0, 156.0)
[INFO]   Rounded: (133, 158)
[INFO]   Nearest: (132.0, 158.0)
[INFO]   Rounded: (164, 262)
[INFO]   Rounded: (85, 172)
[INFO]   Nearest: (86.0, 172.0)
[INFO]   Rounded: (23, 181)
[INFO]   Nearest: (22.0, 182.0)
[INFO]   Rounded: (92, 263)
[INFO]   Nearest: (92.0, 264.0)
[INFO]   Rounded: (27, 101)
[INFO]   Nearest: (26.0, 102.0)
[INFO]   Rounded: (150, 179)
[INFO]   Nearest: (150.0, 178.0)
[INFO]   Rounded: (74, 209)
[INFO]   Nearest: (74.0, 210.0)
[INFO]   Rounded: (81, 294)
[INFO]   Nearest: (80.0, 294.0)
[INFO]   Rounded: (56, 81)
[INFO]   Nearest: (56.0, 82.0)
[INFO]   Rounded: (227, 274)
[INFO]   Nearest: (228.0, 274.0)
[INFO]   Rounded: (25, 243)
[INFO]   Nearest: (26.0, 244.0)
[INFO]   Rounded: (36, 55)
[INFO]   Nearest: (36.0, 54.0)
[INFO]   Rounded: (118, 201)
[INFO]   Nearest: (118.0, 202.0)
[INFO]   Rounded: (91, 115)
[INFO]   Nearest: (90.0, 116.0)
[INFO]   Rounded: (32, 216)
[INFO]   Rounded: (125, 266)
[INFO]   Nearest: (124.0, 266.0)
[INFO]   Rounded: (224, 238)
[INFO]   Rounded: (31, 287)
[INFO]   Nearest: (30.0, 288.0)
[INFO]   Rounded: (272, 295)
[INFO]   Nearest: (272.0, 296.0)
[INFO]   Rounded: (143, 258)
[INFO]   Nearest: (142.0, 258.0)
[INFO]   Rounded: (15, 37)
[INFO]   Nearest: (16.0, 38.0)
[INFO]   Rounded: (74, 106)
[INFO]   Rounded: (154, 223)
[INFO]   Nearest: (154.0, 222.0)
[INFO]   Rounded: (61, 248)
[INFO]   Nearest: (62.0, 248.0)
[INFO]   Rounded: (121, 172)
[INFO]   Nearest: (122.0, 172.0)
[INFO]   Rounded: (234, 256)
[INFO]   Rounded: (243, 283)
[INFO]   Nearest: (244.0, 282.0)
[INFO]   Rounded: (22, 140)
[INFO]   Rounded: (170, 285)
[INFO]   Nearest: (170.0, 284.0)
[INFO]   Rounded: (175, 197)
[INFO]   Nearest: (176.0, 196.0)
[INFO]   Rounded: (127, 291)
[INFO]   Nearest: (128.0, 290.0)
[INFO]   Rounded: (53, 90)
[INFO]   Nearest: (54.0, 90.0)
[INFO]   Rounded: (99, 233)
[INFO]   Nearest: (98.0, 232.0)
[INFO]   Rounded: (55, 289)
[INFO]   Nearest: (56.0, 288.0)
[INFO]   Rounded: (194, 218)
[INFO]   Rounded: (129, 150)
[INFO]   Nearest: (130.0, 150.0)
[INFO]   Rounded: (90, 136)
[INFO]   Rounded: (53, 188)
[INFO]   Nearest: (54.0, 188.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 70, Long SMA: 74
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(56/82) - Original Sharpe: 0.3221, Trades: 35
[INFO] Kmeans cluster 2: SMA(16/34) - Original Sharpe: 0.2589, Trades: 82
[INFO] Kmeans cluster 3: SMA(52/94) - Original Sharpe: 0.2189, Trades: 33
[INFO] Kmeans cluster 4: SMA(22/58) - Original Sharpe: 0.1150, Trades: 55
[INFO] Kmeans cluster 5: SMA(164/202) - Original Sharpe: 0.0296, Trades: 29
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (70/74)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (56/82) - Sharpe: 0.3221
[INFO] cluster 2: (16/34) - Sharpe: 0.2589
[INFO] cluster 3: (52/94) - Sharpe: 0.2189
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.297409            0.298548
1    2021-11-10 2021-11-10            41     0.579196            2.974072
2    2022-01-10 2022-01-10            41     2.725389            2.725389
3    2022-03-10 2022-03-10            42    -4.090683           -2.235583
4    2022-05-10 2022-05-10            41    -3.216020           -2.647452
5    2022-07-10 2022-07-10            44    -0.228249            0.257273
6    2022-09-10 2022-09-10            43     0.723663           -1.008980
7    2022-11-10 2022-11-10            40    -1.624676           -0.724996
8    2023-01-10 2023-01-10            41     1.963421            1.963421
9    2023-03-10 2023-03-10            42    -4.781168           -4.298443
10   2023-05-10 2023-05-10            40     1.697903            0.045088
11   2023-07-10 2023-07-10            44    -0.986722           -3.597011
12   2023-09-10 2023-09-10            44    -0.465397           -5.005636
13   2023-11-10 2023-11-10            40    -3.397712           -1.927991
14   2024-01-10 2024-01-10            41     0.698756            1.232955
15   2024-03-10 2024-03-10            43    -2.269644           -2.373258
16   2024-05-10 2024-05-10            40    -2.839898           -1.011553
17   2024-07-10 2024-07-10            43    -2.557415            0.109116
18   2024-09-10 2024-09-10            44    -1.365575            3.055191
19   2024-11-10 2024-11-10            35    -0.851426           -2.114796
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.3 |              0.3 |          0.6 | True          
[INFO] 2021-11-10   |          0.6 |              3.0 |          2.4 | True          
[INFO] 2022-01-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -4.1 |             -2.2 |          1.9 | True          
[INFO] 2022-05-10   |         -3.2 |             -2.6 |          0.6 | True          
[INFO] 2022-07-10   |         -0.2 |              0.3 |          0.5 | True          
[INFO] 2022-09-10   |          0.7 |             -1.0 |         -1.7 | False         
[INFO] 2022-11-10   |         -1.6 |             -0.7 |          0.9 | True          
[INFO] 2023-01-10   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -4.8 |             -4.3 |          0.5 | True          
[INFO] 2023-05-10   |          1.7 |              0.0 |         -1.7 | False         
[INFO] 2023-07-10   |         -1.0 |             -3.6 |         -2.6 | False         
[INFO] 2023-09-10   |         -0.5 |             -5.0 |         -4.5 | False         
[INFO] 2023-11-10   |         -3.4 |             -1.9 |          1.5 | True          
[INFO] 2024-01-10   |          0.7 |              1.2 |          0.5 | True          
[INFO] 2024-03-10   |         -2.3 |             -2.4 |         -0.1 | False         
[INFO] 2024-05-10   |         -2.8 |             -1.0 |          1.8 | True          
[INFO] 2024-07-10   |         -2.6 |              0.1 |          2.7 | True          
[INFO] 2024-09-10   |         -1.4 |              3.1 |          4.5 | True          
[INFO] 2024-11-10   |         -0.9 |             -2.1 |         -1.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-10, 2023-01-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 12 of 18 periods (66.67% win rate)
[INFO] Updating Excel file with Kmeans results for SM...
[INFO] Excel file updated successfully. Added SM with Kmeans win rate 66.7% in row 46
[INFO] Added best Sharpe parameters 70/74 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 70, Long SMA: 74
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(56/82) - Original Sharpe: 0.3221
[INFO] Added cluster 2 to portfolio: SMA(16/34) - Original Sharpe: 0.2589
[INFO] Added cluster 3 to portfolio: SMA(52/94) - Original Sharpe: 0.2189
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SM_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.5619
[INFO] Kmeans Best out-of-sample Sharpe: -0.8993
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for SM...
[INFO] Excel file updated successfully. Added SM with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SM
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.3858 to 0.6799
[INFO] 
Best parameters:
[INFO] Short SMA: 70
[INFO] Long SMA: 74
[INFO] Sharpe Ratio: 0.679896
[INFO] Number of Trades: 87
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.3858 to 0.6799
[INFO] Trades range: 12.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.2107 to 3.4208
[INFO] Scaled Trades range: -0.7741 to 18.1739
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6539
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 317 elements
[INFO] Cluster 1: 89 elements
[INFO] Cluster 2: 411 elements
[INFO] Cluster 3: 626 elements
[INFO] Cluster 4: 52 elements
[INFO] Cluster 5: 23 elements
[INFO] Cluster 6: 8 elements
[INFO] Cluster 7: 238 elements
[INFO] Cluster 8: 416 elements
[INFO] Cluster 9: 277 elements
[INFO] Cluster 10: 142 elements
[INFO] Cluster 11: 500 elements
[INFO] Cluster 12: 118 elements
[INFO] Cluster 13: 158 elements
[INFO] Cluster 14: 337 elements
[INFO] Cluster 15: 223 elements
[INFO] Cluster 16: 264 elements
[INFO] Cluster 17: 128 elements
[INFO] Cluster 18: 141 elements
[INFO] Cluster 19: 186 elements
[INFO] Cluster 20: 405 elements
[INFO] Cluster 21: 268 elements
[INFO] Cluster 22: 70 elements
[INFO] Cluster 23: 343 elements
[INFO] Cluster 24: 156 elements
[INFO] Cluster 25: 220 elements
[INFO] Cluster 26: 417 elements
[INFO] Cluster 27: 217 elements
[INFO] Cluster 28: 28 elements
[INFO] Cluster 29: 134 elements
[INFO] Cluster 30: 216 elements
[INFO] Cluster 31: 151 elements
[INFO] Cluster 32: 318 elements
[INFO] Cluster 33: 228 elements
[INFO] Cluster 34: 311 elements
[INFO] Cluster 35: 206 elements
[INFO] Cluster 36: 214 elements
[INFO] Cluster 37: 305 elements
[INFO] Cluster 38: 25 elements
[INFO] Cluster 39: 42 elements
[INFO] Cluster 40: 133 elements
[INFO] Cluster 41: 115 elements
[INFO] Cluster 42: 239 elements
[INFO] Cluster 43: 82 elements
[INFO] Cluster 44: 203 elements
[INFO] Cluster 45: 291 elements
[INFO] Cluster 46: 34 elements
[INFO] Cluster 47: 139 elements
[INFO] Cluster 48: 300 elements
[INFO] Cluster 49: 121 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=88, Long SMA=288, Sharpe=-0.9847, Trades=18
[INFO] Cluster 1 cluster: Short SMA=30, Long SMA=38, Sharpe=-0.1145, Trades=91
[INFO] Cluster 2 cluster: Short SMA=194, Long SMA=288, Sharpe=-0.6163, Trades=14
[INFO] Cluster 3 cluster: Short SMA=106, Long SMA=230, Sharpe=-0.6006, Trades=15
[INFO] Cluster 4 cluster: Short SMA=58, Long SMA=60, Sharpe=0.1305, Trades=123
[INFO] Cluster 5 cluster: Short SMA=18, Long SMA=22, Sharpe=0.3862, Trades=174
[INFO] Cluster 7 cluster: Short SMA=232, Long SMA=276, Sharpe=-0.4580, Trades=18
[INFO] Cluster 8 cluster: Short SMA=24, Long SMA=240, Sharpe=-0.2928, Trades=25
[INFO] Cluster 9 cluster: Short SMA=54, Long SMA=92, Sharpe=0.2839, Trades=33
[INFO] Cluster 10 cluster: Short SMA=194, Long SMA=202, Sharpe=-0.3285, Trades=43
[INFO] Cluster 11 cluster: Short SMA=54, Long SMA=252, Sharpe=-0.3003, Trades=17
[INFO] Cluster 12 cluster: Short SMA=276, Long SMA=286, Sharpe=-0.7979, Trades=34
[INFO] Cluster 13 cluster: Short SMA=150, Long SMA=176, Sharpe=-0.4528, Trades=27
[INFO] Cluster 14 cluster: Short SMA=52, Long SMA=160, Sharpe=-0.2707, Trades=19
[INFO] Cluster 15 cluster: Short SMA=22, Long SMA=72, Sharpe=0.1556, Trades=49
[INFO] Cluster 16 cluster: Short SMA=92, Long SMA=128, Sharpe=-0.3757, Trades=25
[INFO] Cluster 17 cluster: Short SMA=130, Long SMA=150, Sharpe=-1.2389, Trades=31
[INFO] Cluster 18 cluster: Short SMA=248, Long SMA=286, Sharpe=-0.6771, Trades=20
[INFO] Cluster 19 cluster: Short SMA=20, Long SMA=288, Sharpe=-0.5997, Trades=30
[INFO] Cluster 20 cluster: Short SMA=166, Long SMA=246, Sharpe=-0.1913, Trades=15
[INFO] Cluster 21 cluster: Short SMA=112, Long SMA=280, Sharpe=-0.7975, Trades=14
[INFO] Cluster 22 cluster: Short SMA=94, Long SMA=102, Sharpe=-0.1703, Trades=45
[INFO] Cluster 23 cluster: Short SMA=144, Long SMA=266, Sharpe=-0.3486, Trades=16
[INFO] Cluster 24 cluster: Short SMA=20, Long SMA=124, Sharpe=-0.2770, Trades=33
[INFO] Cluster 25 cluster: Short SMA=190, Long SMA=218, Sharpe=-0.3573, Trades=28
[INFO] Cluster 26 cluster: Short SMA=50, Long SMA=196, Sharpe=-0.3802, Trades=17
[INFO] Cluster 27 cluster: Short SMA=64, Long SMA=114, Sharpe=-0.1420, Trades=27
[INFO] Cluster 28 cluster: Short SMA=140, Long SMA=142, Sharpe=-1.2270, Trades=83
[INFO] Cluster 29 cluster: Short SMA=28, Long SMA=48, Sharpe=-0.0114, Trades=63
[INFO] Cluster 30 cluster: Short SMA=56, Long SMA=284, Sharpe=-0.7728, Trades=18
[INFO] Cluster 31 cluster: Short SMA=30, Long SMA=68, Sharpe=-0.0380, Trades=45
[INFO] Cluster 32 cluster: Short SMA=122, Long SMA=168, Sharpe=-1.0215, Trades=23
[INFO] Cluster 33 cluster: Short SMA=228, Long SMA=252, Sharpe=-0.1478, Trades=23
[INFO] Cluster 34 cluster: Short SMA=196, Long SMA=254, Sharpe=-0.3159, Trades=17
[INFO] Cluster 35 cluster: Short SMA=18, Long SMA=186, Sharpe=-0.1439, Trades=31
[INFO] Cluster 36 cluster: Short SMA=116, Long SMA=196, Sharpe=-0.6534, Trades=21
[INFO] Cluster 37 cluster: Short SMA=84, Long SMA=162, Sharpe=-0.5062, Trades=21
[INFO] Cluster 38 cluster: Short SMA=264, Long SMA=266, Sharpe=-0.6418, Trades=66
[INFO] Cluster 39 cluster: Short SMA=208, Long SMA=210, Sharpe=-0.3453, Trades=84
[INFO] Cluster 40 cluster: Short SMA=148, Long SMA=202, Sharpe=-0.1779, Trades=23
[INFO] Cluster 41 cluster: Short SMA=114, Long SMA=136, Sharpe=-0.6931, Trades=27
[INFO] Cluster 42 cluster: Short SMA=166, Long SMA=204, Sharpe=0.0236, Trades=27
[INFO] Cluster 43 cluster: Short SMA=262, Long SMA=296, Sharpe=-1.1275, Trades=18
[INFO] Cluster 44 cluster: Short SMA=122, Long SMA=262, Sharpe=-0.4833, Trades=14
[INFO] Cluster 45 cluster: Short SMA=42, Long SMA=140, Sharpe=-0.1363, Trades=23
[INFO] Cluster 46 cluster: Short SMA=182, Long SMA=186, Sharpe=-0.3289, Trades=62
[INFO] Cluster 47 cluster: Short SMA=26, Long SMA=94, Sharpe=0.0173, Trades=37
[INFO] Cluster 48 cluster: Short SMA=76, Long SMA=208, Sharpe=-0.2999, Trades=15
[INFO] Cluster 49 cluster: Short SMA=20, Long SMA=150, Sharpe=-0.4061, Trades=31
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=70, Long SMA=74, Sharpe=0.6799, Trades=87
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=18, Long SMA=22, Sharpe=0.3862, Trades=174
[INFO] Top 2: Short SMA=54, Long SMA=92, Sharpe=0.2839, Trades=33
[INFO] Top 3: Short SMA=22, Long SMA=72, Sharpe=0.1556, Trades=49
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10577 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 70, Long SMA: 74
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(18/22) - Original Sharpe: 0.3862, Trades: 174
[INFO] Hierarchical cluster 2: SMA(54/92) - Original Sharpe: 0.2839, Trades: 33
[INFO] Hierarchical cluster 3: SMA(22/72) - Original Sharpe: 0.1556, Trades: 49
[INFO] Hierarchical cluster 4: SMA(58/60) - Original Sharpe: 0.1305, Trades: 123
[INFO] Hierarchical cluster 5: SMA(166/204) - Original Sharpe: 0.0236, Trades: 27
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (70/74)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (18/22) - Sharpe: 0.3862
[INFO] cluster 2: (54/92) - Sharpe: 0.2839
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.297409            0.161417
1    2021-11-10 2021-11-10            41     0.579196            2.703706
2    2022-01-10 2022-01-10            41     2.725389           -0.610872
3    2022-03-10 2022-03-10            42    -4.090683           -0.993479
4    2022-05-10 2022-05-10            41    -3.216020           -2.893520
5    2022-07-10 2022-07-10            44    -0.228249           -0.277284
6    2022-09-10 2022-09-10            43     0.723663            0.411627
7    2022-11-10 2022-11-10            40    -1.624676           -1.471062
8    2023-01-10 2023-01-10            41     1.963421            1.963421
9    2023-03-10 2023-03-10            42    -4.781168           -5.766633
10   2023-05-10 2023-05-10            40     1.697903            0.181415
11   2023-07-10 2023-07-10            44    -0.986722           -3.229754
12   2023-09-10 2023-09-10            44    -0.465397           -1.512927
13   2023-11-10 2023-11-10            40    -3.397712           -1.439697
14   2024-01-10 2024-01-10            41     0.698756            1.442986
15   2024-03-10 2024-03-10            43    -2.269644           -2.400578
16   2024-05-10 2024-05-10            40    -2.839898           -2.952396
17   2024-07-10 2024-07-10            43    -2.557415           -3.558109
18   2024-09-10 2024-09-10            44    -1.365575            4.459353
19   2024-11-10 2024-11-10            35    -0.851426           -1.804521
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.3 |              0.2 |          0.5 | True          
[INFO] 2021-11-10   |          0.6 |              2.7 |          2.1 | True          
[INFO] 2022-01-10   |          2.7 |             -0.6 |         -3.3 | False         
[INFO] 2022-03-10   |         -4.1 |             -1.0 |          3.1 | True          
[INFO] 2022-05-10   |         -3.2 |             -2.9 |          0.3 | True          
[INFO] 2022-07-10   |         -0.2 |             -0.3 |         -0.1 | False         
[INFO] 2022-09-10   |          0.7 |              0.4 |         -0.3 | False         
[INFO] 2022-11-10   |         -1.6 |             -1.5 |          0.1 | True          
[INFO] 2023-01-10   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -4.8 |             -5.8 |         -1.0 | False         
[INFO] 2023-05-10   |          1.7 |              0.2 |         -1.5 | False         
[INFO] 2023-07-10   |         -1.0 |             -3.2 |         -2.2 | False         
[INFO] 2023-09-10   |         -0.5 |             -1.5 |         -1.0 | False         
[INFO] 2023-11-10   |         -3.4 |             -1.4 |          2.0 | True          
[INFO] 2024-01-10   |          0.7 |              1.4 |          0.7 | True          
[INFO] 2024-03-10   |         -2.3 |             -2.4 |         -0.1 | False         
[INFO] 2024-05-10   |         -2.8 |             -3.0 |         -0.2 | False         
[INFO] 2024-07-10   |         -2.6 |             -3.6 |         -1.0 | False         
[INFO] 2024-09-10   |         -1.4 |              4.5 |          5.9 | True          
[INFO] 2024-11-10   |         -0.9 |             -1.8 |         -0.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-01-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 19 periods (42.11% win rate)
[INFO] Updating Excel file with Hierarchical results for SM...
[INFO] Excel file updated successfully. Added SM with Hierarchical win rate 42.1% in row 46
[INFO] Added best Sharpe parameters 70/74 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 70, Long SMA: 74
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(18/22) - Original Sharpe: 0.3862
[INFO] Added cluster 2 to portfolio: SMA(54/92) - Original Sharpe: 0.2839
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SM_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.7466
[INFO] Hierarchical Best out-of-sample Sharpe: -0.8993
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for SM...
[INFO] Excel file updated successfully. Added SM with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SM
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for TEN in column D: 18.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 72.38s
[INFO] Best parameters: Short SMA = 58, Long SMA = 76
[INFO] Best Sharpe ratio: 1.262627, Trades: 37
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 1441 bad combos; keeping 1895 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172', 'SMA_SF_TOP5_192/194', 'SMA_SF_TOP5_186/204', 'SMA_SF_TOP5_190/196', 'SMA_SF_TOP5_186/206', 'SMA_SF_TOP5_184/206', 'SMA_SI_TOP5_48/50', 'SMA_SI_TOP5_42/58', 'SMA_SI_TOP5_44/56', 'SMA_SI_TOP5_40/60', 'SMA_SI_TOP5_234/258', 'SMA_SM_TOP5_70/74', 'SMA_SM_TOP5_12/20', 'SMA_SM_TOP5_14/22', 'SMA_SM_TOP5_66/78', 'SMA_SM_TOP5_14/24', 'SMA_TEN_TOP5_58/76', 'SMA_TEN_TOP5_60/76', 'SMA_TEN_TOP5_60/74', 'SMA_TEN_TOP5_40/44', 'SMA_TEN_TOP5_58/74']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @TEN=117XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.08 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $411,204.62
[INFO] Market Buy & Hold P&L: $-18,312.50
[INFO] Outperformance: $429,517.12
[INFO] Sharpe ratio (entire period, annualized): 0.642709
[INFO] Sharpe ratio (in-sample, annualized): 1.262627
[INFO] Sharpe ratio (out-of-sample, annualized): -0.813918
[INFO] Maximum Drawdown: $216,784.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 23
[INFO] Out-of-sample period trades: 14
[INFO] Total trades: 37
[INFO] In-sample P&L: $566,161.25
[INFO] Out-of-sample P&L: $-154,956.62
[INFO] 
Best parameters from GA: Short SMA = 58, Long SMA = 76, Sharpe = 1.262627
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5303 to 1.2626
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 76
[INFO] Sharpe Ratio: 1.262627
[INFO] Number of Trades: 37
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9144 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5303 to 1.2626
[INFO] Trades range: 10.0 to 263.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3303 to 2.6446
[INFO] Scaled Long SMA range: -2.7069 to 1.6060
[INFO] Scaled Sharpe ratio range: -2.5233 to 3.4723
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 229 elements
[INFO] Kmeans Cluster 1: 292 elements
[INFO] Kmeans Cluster 2: 203 elements
[INFO] Kmeans Cluster 3: 269 elements
[INFO] Kmeans Cluster 4: 230 elements
[INFO] Kmeans Cluster 5: 203 elements
[INFO] Kmeans Cluster 6: 150 elements
[INFO] Kmeans Cluster 7: 222 elements
[INFO] Kmeans Cluster 8: 231 elements
[INFO] Kmeans Cluster 9: 132 elements
[INFO] Kmeans Cluster 10: 179 elements
[INFO] Kmeans Cluster 11: 196 elements
[INFO] Kmeans Cluster 12: 186 elements
[INFO] Kmeans Cluster 13: 51 elements
[INFO] Kmeans Cluster 14: 231 elements
[INFO] Kmeans Cluster 15: 210 elements
[INFO] Kmeans Cluster 16: 208 elements
[INFO] Kmeans Cluster 17: 206 elements
[INFO] Kmeans Cluster 18: 196 elements
[INFO] Kmeans Cluster 19: 98 elements
[INFO] Kmeans Cluster 20: 392 elements
[INFO] Kmeans Cluster 21: 226 elements
[INFO] Kmeans Cluster 22: 146 elements
[INFO] Kmeans Cluster 23: 119 elements
[INFO] Kmeans Cluster 24: 152 elements
[INFO] Kmeans Cluster 25: 166 elements
[INFO] Kmeans Cluster 26: 158 elements
[INFO] Kmeans Cluster 27: 219 elements
[INFO] Kmeans Cluster 28: 149 elements
[INFO] Kmeans Cluster 29: 193 elements
[INFO] Kmeans Cluster 30: 130 elements
[INFO] Kmeans Cluster 31: 81 elements
[INFO] Kmeans Cluster 32: 117 elements
[INFO] Kmeans Cluster 33: 246 elements
[INFO] Kmeans Cluster 34: 338 elements
[INFO] Kmeans Cluster 35: 160 elements
[INFO] Kmeans Cluster 36: 123 elements
[INFO] Kmeans Cluster 37: 147 elements
[INFO] Kmeans Cluster 38: 226 elements
[INFO] Kmeans Cluster 39: 146 elements
[INFO] Kmeans Cluster 40: 152 elements
[INFO] Kmeans Cluster 41: 134 elements
[INFO] Kmeans Cluster 42: 200 elements
[INFO] Kmeans Cluster 43: 130 elements
[INFO] Kmeans Cluster 44: 160 elements
[INFO] Kmeans Cluster 45: 62 elements
[INFO] Kmeans Cluster 46: 59 elements
[INFO] Kmeans Cluster 47: 179 elements
[INFO] Kmeans Cluster 48: 249 elements
[INFO] Kmeans Cluster 49: 263 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=82.86, Long SMA=154.39, Sharpe=-0.1828
[INFO] Centroid 1: Short SMA=133.05, Long SMA=234.21, Sharpe=0.2811
[INFO] Centroid 2: Short SMA=49.93, Long SMA=83.85, Sharpe=0.8505
[INFO] Centroid 3: Short SMA=191.60, Long SMA=234.81, Sharpe=-0.0335
[INFO] Centroid 4: Short SMA=25.37, Long SMA=159.64, Sharpe=0.3065
[INFO] Centroid 5: Short SMA=19.79, Long SMA=245.07, Sharpe=0.4430
[INFO] Centroid 6: Short SMA=51.32, Long SMA=127.24, Sharpe=0.2829
[INFO] Centroid 7: Short SMA=102.06, Long SMA=178.04, Sharpe=0.1351
[INFO] Centroid 8: Short SMA=217.91, Long SMA=240.10, Sharpe=0.0289
[INFO] Centroid 9: Short SMA=265.23, Long SMA=282.21, Sharpe=0.1051
[INFO] Centroid 10: Short SMA=115.50, Long SMA=141.78, Sharpe=0.0229
[INFO] Centroid 11: Short SMA=25.12, Long SMA=61.93, Sharpe=0.9304
[INFO] Centroid 12: Short SMA=24.44, Long SMA=93.40, Sharpe=0.7811
[INFO] Centroid 13: Short SMA=14.39, Long SMA=25.02, Sharpe=0.1678
[INFO] Centroid 14: Short SMA=38.48, Long SMA=269.70, Sharpe=0.2750
[INFO] Centroid 15: Short SMA=39.57, Long SMA=231.52, Sharpe=0.4427
[INFO] Centroid 16: Short SMA=144.25, Long SMA=176.14, Sharpe=0.2015
[INFO] Centroid 17: Short SMA=264.64, Long SMA=285.96, Sharpe=-0.0304
[INFO] Centroid 18: Short SMA=173.63, Long SMA=202.06, Sharpe=-0.0103
[INFO] Centroid 19: Short SMA=70.78, Long SMA=101.80, Sharpe=0.4177
[INFO] Centroid 20: Short SMA=174.25, Long SMA=270.81, Sharpe=-0.0949
[INFO] Centroid 21: Short SMA=55.36, Long SMA=181.80, Sharpe=0.2488
[INFO] Centroid 22: Short SMA=234.90, Long SMA=290.33, Sharpe=-0.1762
[INFO] Centroid 23: Short SMA=68.22, Long SMA=90.03, Sharpe=0.6081
[INFO] Centroid 24: Short SMA=21.92, Long SMA=189.32, Sharpe=0.4302
[INFO] Centroid 25: Short SMA=104.37, Long SMA=232.42, Sharpe=0.3277
[INFO] Centroid 26: Short SMA=32.08, Long SMA=53.96, Sharpe=0.7800
[INFO] Centroid 27: Short SMA=48.48, Long SMA=206.31, Sharpe=0.2912
[INFO] Centroid 28: Short SMA=238.38, Long SMA=258.04, Sharpe=-0.1584
[INFO] Centroid 29: Short SMA=60.36, Long SMA=161.26, Sharpe=0.0298
[INFO] Centroid 30: Short SMA=92.26, Long SMA=120.26, Sharpe=-0.2239
[INFO] Centroid 31: Short SMA=133.14, Long SMA=145.73, Sharpe=-0.3266
[INFO] Centroid 32: Short SMA=19.21, Long SMA=206.02, Sharpe=0.5868
[INFO] Centroid 33: Short SMA=158.72, Long SMA=245.15, Sharpe=0.0769
[INFO] Centroid 34: Short SMA=211.75, Long SMA=278.01, Sharpe=-0.0227
[INFO] Centroid 35: Short SMA=77.34, Long SMA=223.45, Sharpe=0.5196
[INFO] Centroid 36: Short SMA=26.50, Long SMA=111.04, Sharpe=0.5863
[INFO] Centroid 37: Short SMA=61.40, Long SMA=265.62, Sharpe=0.3491
[INFO] Centroid 38: Short SMA=85.64, Long SMA=202.74, Sharpe=0.2884
[INFO] Centroid 39: Short SMA=119.51, Long SMA=150.73, Sharpe=-0.1326
[INFO] Centroid 40: Short SMA=191.34, Long SMA=205.87, Sharpe=-0.1926
[INFO] Centroid 41: Short SMA=80.31, Long SMA=115.90, Sharpe=0.1198
[INFO] Centroid 42: Short SMA=152.88, Long SMA=208.73, Sharpe=0.1996
[INFO] Centroid 43: Short SMA=150.45, Long SMA=175.28, Sharpe=0.3562
[INFO] Centroid 44: Short SMA=85.21, Long SMA=126.59, Sharpe=-0.0782
[INFO] Centroid 45: Short SMA=50.23, Long SMA=71.13, Sharpe=1.0846
[INFO] Centroid 46: Short SMA=22.78, Long SMA=38.71, Sharpe=0.5108
[INFO] Centroid 47: Short SMA=19.93, Long SMA=284.97, Sharpe=0.4264
[INFO] Centroid 48: Short SMA=28.58, Long SMA=133.32, Sharpe=0.4509
[INFO] Centroid 49: Short SMA=119.85, Long SMA=202.15, Sharpe=0.1700
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=76, Sharpe=1.2626, Trades=37
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=56, Long SMA=76, Sharpe=1.1496, Trades=33
[INFO] Kmeans Top 2: Short SMA=26, Long SMA=62, Sharpe=0.8969, Trades=35
[INFO] Kmeans Top 3: Short SMA=50, Long SMA=84, Sharpe=0.8944, Trades=27
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=54, Sharpe=0.8270, Trades=43
[INFO] Kmeans Top 5: Short SMA=24, Long SMA=94, Sharpe=0.7881, Trades=27
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (83, 154)
[INFO]   Nearest: (82.0, 154.0)
[INFO]   Rounded: (133, 234)
[INFO]   Nearest: (134.0, 234.0)
[INFO]   Rounded: (50, 84)
[INFO]   Rounded: (192, 235)
[INFO]   Nearest: (192.0, 234.0)
[INFO]   Rounded: (25, 160)
[INFO]   Nearest: (26.0, 160.0)
[INFO]   Rounded: (20, 245)
[INFO]   Nearest: (20.0, 246.0)
[INFO]   Rounded: (51, 127)
[INFO]   Nearest: (52.0, 128.0)
[INFO]   Rounded: (102, 178)
[INFO]   Rounded: (218, 240)
[INFO]   Rounded: (265, 282)
[INFO]   Nearest: (266.0, 282.0)
[INFO]   Rounded: (115, 142)
[INFO]   Nearest: (116.0, 142.0)
[INFO]   Rounded: (25, 62)
[INFO]   Nearest: (26.0, 62.0)
[INFO]   Rounded: (24, 93)
[INFO]   Nearest: (24.0, 94.0)
[INFO]   Rounded: (14, 25)
[INFO]   Nearest: (14.0, 26.0)
[INFO]   Rounded: (38, 270)
[INFO]   Rounded: (40, 232)
[INFO]   Rounded: (144, 176)
[INFO]   Rounded: (265, 286)
[INFO]   Nearest: (264.0, 286.0)
[INFO]   Rounded: (174, 202)
[INFO]   Rounded: (71, 102)
[INFO]   Nearest: (70.0, 102.0)
[INFO]   Rounded: (174, 271)
[INFO]   Nearest: (174.0, 270.0)
[INFO]   Rounded: (55, 182)
[INFO]   Nearest: (56.0, 182.0)
[INFO]   Rounded: (235, 290)
[INFO]   Nearest: (234.0, 290.0)
[INFO]   Rounded: (68, 90)
[INFO]   Rounded: (22, 189)
[INFO]   Nearest: (22.0, 190.0)
[INFO]   Rounded: (104, 232)
[INFO]   Rounded: (32, 54)
[INFO]   Rounded: (48, 206)
[INFO]   Rounded: (238, 258)
[INFO]   Rounded: (60, 161)
[INFO]   Nearest: (60.0, 162.0)
[INFO]   Rounded: (92, 120)
[INFO]   Rounded: (133, 146)
[INFO]   Nearest: (134.0, 146.0)
[INFO]   Rounded: (19, 206)
[INFO]   Nearest: (20.0, 206.0)
[INFO]   Rounded: (159, 245)
[INFO]   Nearest: (158.0, 246.0)
[INFO]   Rounded: (212, 278)
[INFO]   Rounded: (77, 223)
[INFO]   Nearest: (78.0, 224.0)
[INFO]   Rounded: (27, 111)
[INFO]   Nearest: (26.0, 112.0)
[INFO]   Rounded: (61, 266)
[INFO]   Nearest: (62.0, 266.0)
[INFO]   Rounded: (86, 203)
[INFO]   Nearest: (86.0, 202.0)
[INFO]   Rounded: (120, 151)
[INFO]   Nearest: (120.0, 150.0)
[INFO]   Rounded: (191, 206)
[INFO]   Nearest: (192.0, 206.0)
[INFO]   Rounded: (80, 116)
[INFO]   Rounded: (153, 209)
[INFO]   Nearest: (152.0, 208.0)
[INFO]   Rounded: (150, 175)
[INFO]   Nearest: (150.0, 176.0)
[INFO]   Rounded: (85, 127)
[INFO]   Nearest: (86.0, 126.0)
[INFO]   Rounded: (50, 71)
[INFO]   Nearest: (50.0, 72.0)
[INFO]   Rounded: (23, 39)
[INFO]   Nearest: (22.0, 38.0)
[INFO]   Rounded: (20, 285)
[INFO]   Nearest: (20.0, 284.0)
[INFO]   Rounded: (29, 133)
[INFO]   Nearest: (28.0, 134.0)
[INFO]   Rounded: (120, 202)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 76
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(56/76) - Original Sharpe: 1.1496, Trades: 33
[INFO] Kmeans cluster 2: SMA(26/62) - Original Sharpe: 0.8969, Trades: 35
[INFO] Kmeans cluster 3: SMA(50/84) - Original Sharpe: 0.8944, Trades: 27
[INFO] Kmeans cluster 4: SMA(36/54) - Original Sharpe: 0.8270, Trades: 43
[INFO] Kmeans cluster 5: SMA(24/94) - Original Sharpe: 0.7881, Trades: 27
[INFO] Trimmed warm-up period. Evaluation data length: 2318
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/76)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (56/76) - Sharpe: 1.1496
[INFO] cluster 2: (26/62) - Sharpe: 0.8969
[INFO] cluster 3: (50/84) - Sharpe: 0.8944
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Out-of-sample period starts on: 2022-04-25
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2022-04-25 2022-04-25            45     0.869705            0.869705
1    2022-06-25 2022-06-25            43    -0.666869           -2.617366
2    2022-08-25 2022-08-25            43    -1.133345            0.627810
3    2022-10-25 2022-10-25            44    -2.239033           -3.312642
4    2022-12-25 2022-12-25            43    -3.070652           -1.477177
5    2023-02-25 2023-02-25            41    -3.791965           -3.229386
6    2023-04-25 2023-04-25            44    -2.516428           -2.742635
7    2023-06-25 2023-06-25            44     2.949798            2.949798
8    2023-08-25 2023-08-25            43     3.401253            3.401253
9    2023-10-25 2023-10-25            43    -4.105859           -3.602811
10   2023-12-25 2023-12-25            43    -3.479188           -2.810365
11   2024-02-25 2024-02-25            42     2.392603            3.706874
12   2024-04-25 2024-04-25            43    -2.501372           -1.886393
13   2024-06-25 2024-06-25            44     2.619489            3.629607
14   2024-08-25 2024-08-25            44    -3.660489           -3.172702
15   2024-10-25 2024-10-25            43     0.789016            1.300319
16   2024-12-25 2024-12-25             4    -0.779051           -0.779051
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2022-04-25   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2022-06-25   |         -0.7 |             -2.6 |         -1.9 | False         
[INFO] 2022-08-25   |         -1.1 |              0.6 |          1.7 | True          
[INFO] 2022-10-25   |         -2.2 |             -3.3 |         -1.1 | False         
[INFO] 2022-12-25   |         -3.1 |             -1.5 |          1.6 | True          
[INFO] 2023-02-25   |         -3.8 |             -3.2 |          0.6 | True          
[INFO] 2023-04-25   |         -2.5 |             -2.7 |         -0.2 | False         
[INFO] 2023-06-25   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-08-25   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-10-25   |         -4.1 |             -3.6 |          0.5 | True          
[INFO] 2023-12-25   |         -3.5 |             -2.8 |          0.7 | True          
[INFO] 2024-02-25   |          2.4 |              3.7 |          1.3 | True          
[INFO] 2024-04-25   |         -2.5 |             -1.9 |          0.6 | True          
[INFO] 2024-06-25   |          2.6 |              3.6 |          1.0 | True          
[INFO] 2024-08-25   |         -3.7 |             -3.2 |          0.5 | True          
[INFO] 2024-10-25   |          0.8 |              1.3 |          0.5 | True          
[INFO] 2024-12-25   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-25, 2023-06-25, 2023-08-25, 2024-12-25
[INFO] 
Total periods before exclusion: 17
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 10 of 13 periods (76.92% win rate)
[INFO] Updating Excel file with Kmeans results for TEN...
[INFO] Excel file updated successfully. Added TEN with Kmeans win rate 76.9% in row 47
[INFO] Added best Sharpe parameters 58/76 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 76
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(56/76) - Original Sharpe: 1.1496
[INFO] Added cluster 2 to portfolio: SMA(26/62) - Original Sharpe: 0.8969
[INFO] Added cluster 3 to portfolio: SMA(50/84) - Original Sharpe: 0.8944
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TEN_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3445
[INFO] Kmeans Best out-of-sample Sharpe: -0.8139
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for TEN...
[INFO] Excel file updated successfully. Added TEN with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TEN
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5303 to 1.2626
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 76
[INFO] Sharpe Ratio: 1.262627
[INFO] Number of Trades: 37
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9144 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5303 to 1.2626
[INFO] Trades range: 10.0 to 263.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3303 to 2.6446
[INFO] Scaled Long SMA range: -2.7069 to 1.6060
[INFO] Scaled Sharpe ratio range: -2.5233 to 3.4723
[INFO] Scaled Trades range: -0.7128 to 16.0622
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9144 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6785
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 230 elements
[INFO] Cluster 1: 36 elements
[INFO] Cluster 2: 308 elements
[INFO] Cluster 3: 246 elements
[INFO] Cluster 4: 421 elements
[INFO] Cluster 5: 263 elements
[INFO] Cluster 6: 425 elements
[INFO] Cluster 7: 479 elements
[INFO] Cluster 8: 135 elements
[INFO] Cluster 9: 187 elements
[INFO] Cluster 10: 227 elements
[INFO] Cluster 11: 43 elements
[INFO] Cluster 12: 40 elements
[INFO] Cluster 13: 281 elements
[INFO] Cluster 14: 74 elements
[INFO] Cluster 15: 60 elements
[INFO] Cluster 16: 63 elements
[INFO] Cluster 17: 201 elements
[INFO] Cluster 18: 273 elements
[INFO] Cluster 19: 157 elements
[INFO] Cluster 20: 185 elements
[INFO] Cluster 21: 72 elements
[INFO] Cluster 22: 14 elements
[INFO] Cluster 23: 203 elements
[INFO] Cluster 24: 169 elements
[INFO] Cluster 25: 374 elements
[INFO] Cluster 26: 390 elements
[INFO] Cluster 27: 221 elements
[INFO] Cluster 28: 180 elements
[INFO] Cluster 29: 275 elements
[INFO] Cluster 30: 363 elements
[INFO] Cluster 31: 259 elements
[INFO] Cluster 32: 255 elements
[INFO] Cluster 33: 237 elements
[INFO] Cluster 34: 217 elements
[INFO] Cluster 35: 210 elements
[INFO] Cluster 36: 51 elements
[INFO] Cluster 37: 47 elements
[INFO] Cluster 38: 62 elements
[INFO] Cluster 39: 217 elements
[INFO] Cluster 40: 116 elements
[INFO] Cluster 41: 197 elements
[INFO] Cluster 42: 8 elements
[INFO] Cluster 43: 248 elements
[INFO] Cluster 44: 31 elements
[INFO] Cluster 45: 101 elements
[INFO] Cluster 46: 103 elements
[INFO] Cluster 47: 33 elements
[INFO] Cluster 48: 153 elements
[INFO] Cluster 49: 4 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=104, Long SMA=126, Sharpe=-0.0961, Trades=26
[INFO] Cluster 1 cluster: Short SMA=16, Long SMA=26, Sharpe=-0.0308, Trades=107
[INFO] Cluster 2 cluster: Short SMA=26, Long SMA=130, Sharpe=0.4459, Trades=23
[INFO] Cluster 3 cluster: Short SMA=18, Long SMA=198, Sharpe=0.5236, Trades=23
[INFO] Cluster 4 cluster: Short SMA=126, Long SMA=234, Sharpe=0.2314, Trades=12
[INFO] Cluster 5 cluster: Short SMA=240, Long SMA=280, Sharpe=-0.1538, Trades=13
[INFO] Cluster 6 cluster: Short SMA=138, Long SMA=198, Sharpe=0.2172, Trades=14
[INFO] Cluster 7 cluster: Short SMA=84, Long SMA=150, Sharpe=-0.1540, Trades=21
[INFO] Cluster 8 cluster: Short SMA=108, Long SMA=122, Sharpe=0.2158, Trades=32
[INFO] Cluster 9 cluster: Short SMA=44, Long SMA=74, Sharpe=0.8656, Trades=33
[INFO] Cluster 10 cluster: Short SMA=58, Long SMA=160, Sharpe=0.1619, Trades=19
[INFO] Cluster 11 cluster: Short SMA=130, Long SMA=132, Sharpe=-0.0789, Trades=72
[INFO] Cluster 12 cluster: Short SMA=46, Long SMA=48, Sharpe=0.6569, Trades=103
[INFO] Cluster 13 cluster: Short SMA=266, Long SMA=284, Sharpe=0.1623, Trades=17
[INFO] Cluster 14 cluster: Short SMA=32, Long SMA=46, Sharpe=0.9446, Trades=59
[INFO] Cluster 15 cluster: Short SMA=192, Long SMA=196, Sharpe=0.0704, Trades=38
[INFO] Cluster 16 cluster: Short SMA=48, Long SMA=56, Sharpe=0.7163, Trades=59
[INFO] Cluster 17 cluster: Short SMA=34, Long SMA=104, Sharpe=0.7299, Trades=23
[INFO] Cluster 18 cluster: Short SMA=216, Long SMA=256, Sharpe=-0.0114, Trades=13
[INFO] Cluster 19 cluster: Short SMA=148, Long SMA=174, Sharpe=0.3044, Trades=22
[INFO] Cluster 20 cluster: Short SMA=24, Long SMA=58, Sharpe=0.8879, Trades=37
[INFO] Cluster 21 cluster: Short SMA=76, Long SMA=92, Sharpe=0.5221, Trades=35
[INFO] Cluster 23 cluster: Short SMA=180, Long SMA=206, Sharpe=-0.1658, Trades=16
[INFO] Cluster 24 cluster: Short SMA=214, Long SMA=288, Sharpe=0.0368, Trades=11
[INFO] Cluster 25 cluster: Short SMA=46, Long SMA=270, Sharpe=0.3043, Trades=11
[INFO] Cluster 26 cluster: Short SMA=62, Long SMA=192, Sharpe=0.2816, Trades=15
[INFO] Cluster 27 cluster: Short SMA=160, Long SMA=238, Sharpe=0.0647, Trades=14
[INFO] Cluster 28 cluster: Short SMA=78, Long SMA=222, Sharpe=0.5302, Trades=15
[INFO] Cluster 29 cluster: Short SMA=190, Long SMA=274, Sharpe=-0.0661, Trades=11
[INFO] Cluster 30 cluster: Short SMA=32, Long SMA=238, Sharpe=0.3904, Trades=11
[INFO] Cluster 31 cluster: Short SMA=160, Long SMA=264, Sharpe=-0.1436, Trades=12
[INFO] Cluster 32 cluster: Short SMA=98, Long SMA=204, Sharpe=0.2240, Trades=14
[INFO] Cluster 33 cluster: Short SMA=26, Long SMA=160, Sharpe=0.3510, Trades=21
[INFO] Cluster 34 cluster: Short SMA=38, Long SMA=88, Sharpe=0.7439, Trades=27
[INFO] Cluster 35 cluster: Short SMA=18, Long SMA=280, Sharpe=0.4274, Trades=13
[INFO] Cluster 36 cluster: Short SMA=156, Long SMA=164, Sharpe=0.4545, Trades=36
[INFO] Cluster 37 cluster: Short SMA=138, Long SMA=144, Sharpe=-0.3464, Trades=40
[INFO] Cluster 38 cluster: Short SMA=240, Long SMA=244, Sharpe=-0.2077, Trades=27
[INFO] Cluster 39 cluster: Short SMA=108, Long SMA=178, Sharpe=0.1208, Trades=14
[INFO] Cluster 40 cluster: Short SMA=110, Long SMA=144, Sharpe=-0.0110, Trades=24
[INFO] Cluster 41 cluster: Short SMA=56, Long SMA=122, Sharpe=0.2357, Trades=21
[INFO] Cluster 43 cluster: Short SMA=190, Long SMA=236, Sharpe=-0.0313, Trades=13
[INFO] Cluster 44 cluster: Short SMA=16, Long SMA=36, Sharpe=0.4967, Trades=77
[INFO] Cluster 45 cluster: Short SMA=168, Long SMA=202, Sharpe=0.0656, Trades=14
[INFO] Cluster 46 cluster: Short SMA=216, Long SMA=230, Sharpe=0.0436, Trades=20
[INFO] Cluster 47 cluster: Short SMA=58, Long SMA=76, Sharpe=1.2626, Trades=37
[INFO] Cluster 48 cluster: Short SMA=38, Long SMA=204, Sharpe=0.2445, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=76, Sharpe=1.2626, Trades=37
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=58, Long SMA=76, Sharpe=1.2626, Trades=37
[INFO] Top 2: Short SMA=32, Long SMA=46, Sharpe=0.9446, Trades=59
[INFO] Top 3: Short SMA=24, Long SMA=58, Sharpe=0.8879, Trades=37
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 9118 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 76
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(58/76) - Original Sharpe: 1.2626, Trades: 37
[INFO] Hierarchical cluster 2: SMA(32/46) - Original Sharpe: 0.9446, Trades: 59
[INFO] Hierarchical cluster 3: SMA(24/58) - Original Sharpe: 0.8879, Trades: 37
[INFO] Hierarchical cluster 4: SMA(44/74) - Original Sharpe: 0.8656, Trades: 33
[INFO] Hierarchical cluster 5: SMA(38/88) - Original Sharpe: 0.7439, Trades: 27
[INFO] Trimmed warm-up period. Evaluation data length: 2318
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/76)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (58/76) - Sharpe: 1.2626
[INFO] cluster 2: (32/46) - Sharpe: 0.9446
[INFO] cluster 3: (24/58) - Sharpe: 0.8879
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Out-of-sample period starts on: 2022-04-25
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2022-04-25 2022-04-25            45     0.869705            0.869705
1    2022-06-25 2022-06-25            43    -0.666869           -3.511422
2    2022-08-25 2022-08-25            43    -1.133345            2.580894
3    2022-10-25 2022-10-25            44    -2.239033           -4.238186
4    2022-12-25 2022-12-25            43    -3.070652           -1.425237
5    2023-02-25 2023-02-25            41    -3.791965           -4.091036
6    2023-04-25 2023-04-25            44    -2.516428           -3.781111
7    2023-06-25 2023-06-25            44     2.949798            2.949798
8    2023-08-25 2023-08-25            43     3.401253            3.401253
9    2023-10-25 2023-10-25            43    -4.105859           -2.141573
10   2023-12-25 2023-12-25            43    -3.479188           -2.989934
11   2024-02-25 2024-02-25            42     2.392603            2.982375
12   2024-04-25 2024-04-25            43    -2.501372           -2.606682
13   2024-06-25 2024-06-25            44     2.619489            2.919669
14   2024-08-25 2024-08-25            44    -3.660489           -2.112777
15   2024-10-25 2024-10-25            43     0.789016            2.729776
16   2024-12-25 2024-12-25             4    -0.779051           -0.779051
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2022-04-25   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2022-06-25   |         -0.7 |             -3.5 |         -2.8 | False         
[INFO] 2022-08-25   |         -1.1 |              2.6 |          3.7 | True          
[INFO] 2022-10-25   |         -2.2 |             -4.2 |         -2.0 | False         
[INFO] 2022-12-25   |         -3.1 |             -1.4 |          1.7 | True          
[INFO] 2023-02-25   |         -3.8 |             -4.1 |         -0.3 | False         
[INFO] 2023-04-25   |         -2.5 |             -3.8 |         -1.3 | False         
[INFO] 2023-06-25   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-08-25   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-10-25   |         -4.1 |             -2.1 |          2.0 | True          
[INFO] 2023-12-25   |         -3.5 |             -3.0 |          0.5 | True          
[INFO] 2024-02-25   |          2.4 |              3.0 |          0.6 | True          
[INFO] 2024-04-25   |         -2.5 |             -2.6 |         -0.1 | False         
[INFO] 2024-06-25   |          2.6 |              2.9 |          0.3 | True          
[INFO] 2024-08-25   |         -3.7 |             -2.1 |          1.6 | True          
[INFO] 2024-10-25   |          0.8 |              2.7 |          1.9 | True          
[INFO] 2024-12-25   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-25, 2023-06-25, 2023-08-25, 2024-12-25
[INFO] 
Total periods before exclusion: 17
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 13 periods (61.54% win rate)
[INFO] Updating Excel file with Hierarchical results for TEN...
[INFO] Excel file updated successfully. Added TEN with Hierarchical win rate 61.5% in row 47
[INFO] Added best Sharpe parameters 58/76 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 76
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(58/76) - Original Sharpe: 1.2626
[INFO] Added cluster 2 to portfolio: SMA(32/46) - Original Sharpe: 0.9446
[INFO] Added cluster 3 to portfolio: SMA(24/58) - Original Sharpe: 0.8879
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TEN_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3178
[INFO] Hierarchical Best out-of-sample Sharpe: -0.8139
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for TEN...
[INFO] Excel file updated successfully. Added TEN with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TEN
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for TY in column D: 18.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 78.10s
[INFO] Best parameters: Short SMA = 56, Long SMA = 82
[INFO] Best Sharpe ratio: 1.031512, Trades: 33
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 1734 bad combos; keeping 2102 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172', 'SMA_SF_TOP5_192/194', 'SMA_SF_TOP5_186/204', 'SMA_SF_TOP5_190/196', 'SMA_SF_TOP5_186/206', 'SMA_SF_TOP5_184/206', 'SMA_SI_TOP5_48/50', 'SMA_SI_TOP5_42/58', 'SMA_SI_TOP5_44/56', 'SMA_SI_TOP5_40/60', 'SMA_SI_TOP5_234/258', 'SMA_SM_TOP5_70/74', 'SMA_SM_TOP5_12/20', 'SMA_SM_TOP5_14/22', 'SMA_SM_TOP5_66/78', 'SMA_SM_TOP5_14/24', 'SMA_TEN_TOP5_58/76', 'SMA_TEN_TOP5_60/76', 'SMA_TEN_TOP5_60/74', 'SMA_TEN_TOP5_40/44', 'SMA_TEN_TOP5_58/74', 'SMA_TY_TOP5_56/82', 'SMA_TY_TOP5_54/84', 'SMA_TY_TOP5_56/84', 'SMA_TY_TOP5_60/78', 'SMA_TY_TOP5_66/70']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @TY
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 11.36 contracts
[INFO] Maximum Position Size: 20 contracts
[INFO] Strategy Total P&L: $283,342.50
[INFO] Market Buy & Hold P&L: $-4,734.38
[INFO] Outperformance: $288,076.88
[INFO] Sharpe ratio (entire period, annualized): 0.579425
[INFO] Sharpe ratio (in-sample, annualized): 1.031512
[INFO] Sharpe ratio (out-of-sample, annualized): -0.443143
[INFO] Maximum Drawdown: $211,316.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 22
[INFO] Out-of-sample period trades: 11
[INFO] Total trades: 33
[INFO] In-sample P&L: $541,716.12
[INFO] Out-of-sample P&L: $-102,735.12
[INFO] 
Best parameters from GA: Short SMA = 56, Long SMA = 82, Sharpe = 1.031512
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] 
Best parameters:
[INFO] Short SMA: 56
[INFO] Long SMA: 82
[INFO] Sharpe Ratio: 1.031512
[INFO] Number of Trades: 33
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8851 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] Trades range: 10.0 to 328.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2970 to 2.7663
[INFO] Scaled Long SMA range: -2.7173 to 1.6949
[INFO] Scaled Sharpe ratio range: -2.9375 to 3.3040
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 181 elements
[INFO] Kmeans Cluster 1: 142 elements
[INFO] Kmeans Cluster 2: 203 elements
[INFO] Kmeans Cluster 3: 221 elements
[INFO] Kmeans Cluster 4: 272 elements
[INFO] Kmeans Cluster 5: 165 elements
[INFO] Kmeans Cluster 6: 123 elements
[INFO] Kmeans Cluster 7: 152 elements
[INFO] Kmeans Cluster 8: 128 elements
[INFO] Kmeans Cluster 9: 118 elements
[INFO] Kmeans Cluster 10: 184 elements
[INFO] Kmeans Cluster 11: 206 elements
[INFO] Kmeans Cluster 12: 177 elements
[INFO] Kmeans Cluster 13: 143 elements
[INFO] Kmeans Cluster 14: 224 elements
[INFO] Kmeans Cluster 15: 258 elements
[INFO] Kmeans Cluster 16: 149 elements
[INFO] Kmeans Cluster 17: 122 elements
[INFO] Kmeans Cluster 18: 165 elements
[INFO] Kmeans Cluster 19: 200 elements
[INFO] Kmeans Cluster 20: 108 elements
[INFO] Kmeans Cluster 21: 250 elements
[INFO] Kmeans Cluster 22: 204 elements
[INFO] Kmeans Cluster 23: 176 elements
[INFO] Kmeans Cluster 24: 206 elements
[INFO] Kmeans Cluster 25: 217 elements
[INFO] Kmeans Cluster 26: 170 elements
[INFO] Kmeans Cluster 27: 213 elements
[INFO] Kmeans Cluster 28: 208 elements
[INFO] Kmeans Cluster 29: 247 elements
[INFO] Kmeans Cluster 30: 161 elements
[INFO] Kmeans Cluster 31: 135 elements
[INFO] Kmeans Cluster 32: 55 elements
[INFO] Kmeans Cluster 33: 93 elements
[INFO] Kmeans Cluster 34: 179 elements
[INFO] Kmeans Cluster 35: 114 elements
[INFO] Kmeans Cluster 36: 218 elements
[INFO] Kmeans Cluster 37: 155 elements
[INFO] Kmeans Cluster 38: 156 elements
[INFO] Kmeans Cluster 39: 202 elements
[INFO] Kmeans Cluster 40: 224 elements
[INFO] Kmeans Cluster 41: 123 elements
[INFO] Kmeans Cluster 42: 221 elements
[INFO] Kmeans Cluster 43: 136 elements
[INFO] Kmeans Cluster 44: 198 elements
[INFO] Kmeans Cluster 45: 107 elements
[INFO] Kmeans Cluster 46: 166 elements
[INFO] Kmeans Cluster 47: 209 elements
[INFO] Kmeans Cluster 48: 234 elements
[INFO] Kmeans Cluster 49: 233 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=90.96, Long SMA=199.69, Sharpe=0.4008
[INFO] Centroid 1: Short SMA=220.87, Long SMA=275.42, Sharpe=-0.0138
[INFO] Centroid 2: Short SMA=43.76, Long SMA=131.41, Sharpe=0.3228
[INFO] Centroid 3: Short SMA=39.44, Long SMA=81.77, Sharpe=0.6504
[INFO] Centroid 4: Short SMA=28.44, Long SMA=170.22, Sharpe=0.3946
[INFO] Centroid 5: Short SMA=154.98, Long SMA=243.81, Sharpe=-0.0212
[INFO] Centroid 6: Short SMA=34.36, Long SMA=286.42, Sharpe=0.1590
[INFO] Centroid 7: Short SMA=66.62, Long SMA=157.33, Sharpe=0.0889
[INFO] Centroid 8: Short SMA=158.59, Long SMA=184.45, Sharpe=0.2650
[INFO] Centroid 9: Short SMA=23.25, Long SMA=43.53, Sharpe=0.1373
[INFO] Centroid 10: Short SMA=36.89, Long SMA=247.24, Sharpe=0.3817
[INFO] Centroid 11: Short SMA=120.52, Long SMA=144.03, Sharpe=0.2241
[INFO] Centroid 12: Short SMA=187.79, Long SMA=264.87, Sharpe=-0.2384
[INFO] Centroid 13: Short SMA=59.01, Long SMA=94.60, Sharpe=0.4663
[INFO] Centroid 14: Short SMA=140.66, Long SMA=168.75, Sharpe=0.5157
[INFO] Centroid 15: Short SMA=213.88, Long SMA=235.98, Sharpe=-0.0356
[INFO] Centroid 16: Short SMA=90.50, Long SMA=179.14, Sharpe=0.2237
[INFO] Centroid 17: Short SMA=28.69, Long SMA=52.46, Sharpe=0.3500
[INFO] Centroid 18: Short SMA=181.94, Long SMA=203.76, Sharpe=-0.0560
[INFO] Centroid 19: Short SMA=20.59, Long SMA=106.91, Sharpe=0.5668
[INFO] Centroid 20: Short SMA=240.63, Long SMA=256.65, Sharpe=-0.3547
[INFO] Centroid 21: Short SMA=56.54, Long SMA=196.78, Sharpe=0.3568
[INFO] Centroid 22: Short SMA=189.23, Long SMA=229.69, Sharpe=-0.1942
[INFO] Centroid 23: Short SMA=20.67, Long SMA=251.26, Sharpe=0.2461
[INFO] Centroid 24: Short SMA=21.98, Long SMA=137.11, Sharpe=0.4785
[INFO] Centroid 25: Short SMA=98.65, Long SMA=123.76, Sharpe=0.0669
[INFO] Centroid 26: Short SMA=137.11, Long SMA=235.40, Sharpe=0.1492
[INFO] Centroid 27: Short SMA=73.34, Long SMA=115.97, Sharpe=0.1699
[INFO] Centroid 28: Short SMA=25.39, Long SMA=215.18, Sharpe=0.4484
[INFO] Centroid 29: Short SMA=125.27, Long SMA=188.68, Sharpe=0.3836
[INFO] Centroid 30: Short SMA=28.35, Long SMA=68.50, Sharpe=0.5274
[INFO] Centroid 31: Short SMA=230.57, Long SMA=262.29, Sharpe=-0.1494
[INFO] Centroid 32: Short SMA=17.05, Long SMA=26.65, Sharpe=-0.1109
[INFO] Centroid 33: Short SMA=277.98, Long SMA=292.58, Sharpe=-0.1622
[INFO] Centroid 34: Short SMA=109.71, Long SMA=157.27, Sharpe=0.0802
[INFO] Centroid 35: Short SMA=19.21, Long SMA=194.86, Sharpe=0.5625
[INFO] Centroid 36: Short SMA=167.45, Long SMA=254.54, Sharpe=-0.1393
[INFO] Centroid 37: Short SMA=48.71, Long SMA=222.52, Sharpe=0.3008
[INFO] Centroid 38: Short SMA=53.15, Long SMA=170.79, Sharpe=0.2342
[INFO] Centroid 39: Short SMA=102.71, Long SMA=221.29, Sharpe=0.2799
[INFO] Centroid 40: Short SMA=72.11, Long SMA=230.29, Sharpe=0.4111
[INFO] Centroid 41: Short SMA=196.12, Long SMA=278.31, Sharpe=-0.1361
[INFO] Centroid 42: Short SMA=131.62, Long SMA=214.63, Sharpe=0.3244
[INFO] Centroid 43: Short SMA=75.34, Long SMA=98.50, Sharpe=0.3190
[INFO] Centroid 44: Short SMA=25.07, Long SMA=282.20, Sharpe=0.2865
[INFO] Centroid 45: Short SMA=50.58, Long SMA=75.91, Sharpe=0.7840
[INFO] Centroid 46: Short SMA=62.16, Long SMA=258.65, Sharpe=0.3659
[INFO] Centroid 47: Short SMA=260.66, Long SMA=279.94, Sharpe=-0.0320
[INFO] Centroid 48: Short SMA=82.97, Long SMA=146.10, Sharpe=-0.0348
[INFO] Centroid 49: Short SMA=170.85, Long SMA=202.03, Sharpe=0.0749
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=56, Long SMA=82, Sharpe=1.0315, Trades=33
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=54, Long SMA=76, Sharpe=0.7927, Trades=35
[INFO] Kmeans Top 2: Short SMA=38, Long SMA=82, Sharpe=0.6608, Trades=33
[INFO] Kmeans Top 3: Short SMA=26, Long SMA=68, Sharpe=0.5963, Trades=40
[INFO] Kmeans Top 4: Short SMA=140, Long SMA=168, Sharpe=0.5791, Trades=25
[INFO] Kmeans Top 5: Short SMA=20, Long SMA=196, Sharpe=0.5373, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (91, 200)
[INFO]   Nearest: (90.0, 200.0)
[INFO]   Rounded: (221, 275)
[INFO]   Nearest: (220.0, 276.0)
[INFO]   Rounded: (44, 131)
[INFO]   Nearest: (44.0, 132.0)
[INFO]   Rounded: (39, 82)
[INFO]   Nearest: (40.0, 82.0)
[INFO]   Rounded: (28, 170)
[INFO]   Rounded: (155, 244)
[INFO]   Nearest: (154.0, 244.0)
[INFO]   Rounded: (34, 286)
[INFO]   Rounded: (67, 157)
[INFO]   Nearest: (66.0, 158.0)
[INFO]   Rounded: (159, 184)
[INFO]   Nearest: (158.0, 184.0)
[INFO]   Rounded: (23, 44)
[INFO]   Nearest: (24.0, 44.0)
[INFO]   Rounded: (37, 247)
[INFO]   Nearest: (36.0, 248.0)
[INFO]   Rounded: (121, 144)
[INFO]   Nearest: (120.0, 144.0)
[INFO]   Rounded: (188, 265)
[INFO]   Nearest: (188.0, 264.0)
[INFO]   Rounded: (59, 95)
[INFO]   Nearest: (60.0, 94.0)
[INFO]   Rounded: (141, 169)
[INFO]   Nearest: (140.0, 168.0)
[INFO]   Rounded: (214, 236)
[INFO]   Rounded: (90, 179)
[INFO]   Nearest: (90.0, 180.0)
[INFO]   Rounded: (29, 52)
[INFO]   Nearest: (28.0, 52.0)
[INFO]   Rounded: (182, 204)
[INFO]   Rounded: (21, 107)
[INFO]   Nearest: (20.0, 106.0)
[INFO]   Rounded: (241, 257)
[INFO]   Nearest: (240.0, 256.0)
[INFO]   Rounded: (57, 197)
[INFO]   Nearest: (56.0, 196.0)
[INFO]   Rounded: (189, 230)
[INFO]   Nearest: (190.0, 230.0)
[INFO]   Rounded: (21, 251)
[INFO]   Nearest: (20.0, 252.0)
[INFO]   Rounded: (22, 137)
[INFO]   Nearest: (22.0, 138.0)
[INFO]   Rounded: (99, 124)
[INFO]   Nearest: (98.0, 124.0)
[INFO]   Rounded: (137, 235)
[INFO]   Nearest: (138.0, 236.0)
[INFO]   Rounded: (73, 116)
[INFO]   Nearest: (74.0, 116.0)
[INFO]   Rounded: (25, 215)
[INFO]   Nearest: (26.0, 216.0)
[INFO]   Rounded: (125, 189)
[INFO]   Nearest: (126.0, 188.0)
[INFO]   Rounded: (28, 68)
[INFO]   Rounded: (231, 262)
[INFO]   Nearest: (230.0, 262.0)
[INFO]   Rounded: (17, 27)
[INFO]   Nearest: (18.0, 26.0)
[INFO]   Rounded: (278, 293)
[INFO]   Nearest: (278.0, 292.0)
[INFO]   Rounded: (110, 157)
[INFO]   Nearest: (110.0, 158.0)
[INFO]   Rounded: (19, 195)
[INFO]   Nearest: (20.0, 194.0)
[INFO]   Rounded: (167, 255)
[INFO]   Nearest: (168.0, 254.0)
[INFO]   Rounded: (49, 223)
[INFO]   Nearest: (48.0, 222.0)
[INFO]   Rounded: (53, 171)
[INFO]   Nearest: (54.0, 170.0)
[INFO]   Rounded: (103, 221)
[INFO]   Nearest: (102.0, 222.0)
[INFO]   Rounded: (72, 230)
[INFO]   Rounded: (196, 278)
[INFO]   Rounded: (132, 215)
[INFO]   Nearest: (132.0, 214.0)
[INFO]   Rounded: (75, 98)
[INFO]   Nearest: (76.0, 98.0)
[INFO]   Rounded: (25, 282)
[INFO]   Nearest: (26.0, 282.0)
[INFO]   Rounded: (51, 76)
[INFO]   Nearest: (50.0, 76.0)
[INFO]   Rounded: (62, 259)
[INFO]   Nearest: (62.0, 258.0)
[INFO]   Rounded: (261, 280)
[INFO]   Nearest: (260.0, 280.0)
[INFO]   Rounded: (83, 146)
[INFO]   Nearest: (82.0, 146.0)
[INFO]   Rounded: (171, 202)
[INFO]   Nearest: (170.0, 202.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 56, Long SMA: 82
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(54/76) - Original Sharpe: 0.7927, Trades: 35
[INFO] Kmeans cluster 2: SMA(38/82) - Original Sharpe: 0.6608, Trades: 33
[INFO] Kmeans cluster 3: SMA(26/68) - Original Sharpe: 0.5963, Trades: 40
[INFO] Kmeans cluster 4: SMA(140/168) - Original Sharpe: 0.5791, Trades: 25
[INFO] Kmeans cluster 5: SMA(20/196) - Original Sharpe: 0.5373, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (56/82)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (54/76) - Sharpe: 0.7927
[INFO] cluster 2: (38/82) - Sharpe: 0.6608
[INFO] cluster 3: (26/68) - Sharpe: 0.5963
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.704271           -1.682427
1    2021-11-14 2021-11-14            43     0.838842           -0.543614
2    2022-01-14 2022-01-14            41     1.984191            1.984191
3    2022-03-14 2022-03-14            44     4.120920            4.120920
4    2022-05-14 2022-05-14            43     0.411261            0.411261
5    2022-07-14 2022-07-14            44     0.308673           -3.458123
6    2022-09-14 2022-09-14            43    -1.526198           -0.185451
7    2022-11-14 2022-11-14            43    -1.104580            0.378588
8    2023-01-14 2023-01-14            41    -5.413014           -5.435796
9    2023-03-14 2023-03-14            44    -1.314612           -0.543511
10   2023-05-14 2023-05-14            44    -1.913035           -1.607174
11   2023-07-14 2023-07-14            44     3.093754            3.093754
12   2023-09-14 2023-09-14            43     2.065825            2.065825
13   2023-11-14 2023-11-14            42    -3.774049           -3.536756
14   2024-01-14 2024-01-14            43    -1.733531           -2.147203
15   2024-03-14 2024-03-14            42     0.586636            2.123587
16   2024-05-14 2024-05-14            44    -1.885239           -0.014944
17   2024-07-14 2024-07-14            45     3.577993            3.577993
18   2024-09-14 2024-09-14            43    -4.939107           -4.512239
19   2024-11-14 2024-11-14            33     1.144905            1.144905
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.7 |             -1.7 |          1.0 | True          
[INFO] 2021-11-14   |          0.8 |             -0.5 |         -1.3 | False         
[INFO] 2022-01-14   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2022-03-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.3 |             -3.5 |         -3.8 | False         
[INFO] 2022-09-14   |         -1.5 |             -0.2 |          1.3 | True          
[INFO] 2022-11-14   |         -1.1 |              0.4 |          1.5 | True          
[INFO] 2023-01-14   |         -5.4 |             -5.4 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -1.3 |             -0.5 |          0.8 | True          
[INFO] 2023-05-14   |         -1.9 |             -1.6 |          0.3 | True          
[INFO] 2023-07-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.8 |             -3.5 |          0.3 | True          
[INFO] 2024-01-14   |         -1.7 |             -2.1 |         -0.4 | False         
[INFO] 2024-03-14   |          0.6 |              2.1 |          1.5 | True          
[INFO] 2024-05-14   |         -1.9 |             -0.0 |          1.9 | True          
[INFO] 2024-07-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -4.9 |             -4.5 |          0.4 | True          
[INFO] 2024-11-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14, 2022-03-14, 2022-05-14, 2023-01-14, 2023-07-14, 2023-09-14, 2024-07-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 9 of 12 periods (75.00% win rate)
[INFO] Updating Excel file with Kmeans results for TY...
[INFO] Excel file updated successfully. Added TY with Kmeans win rate 75.0% in row 48
[INFO] Added best Sharpe parameters 56/82 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 56, Long SMA: 82
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(54/76) - Original Sharpe: 0.7927
[INFO] Added cluster 2 to portfolio: SMA(38/82) - Original Sharpe: 0.6608
[INFO] Added cluster 3 to portfolio: SMA(26/68) - Original Sharpe: 0.5963
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TY_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0769
[INFO] Kmeans Best out-of-sample Sharpe: -0.4431
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for TY...
[INFO] Excel file updated successfully. Added TY with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TY
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] 
Best parameters:
[INFO] Short SMA: 56
[INFO] Long SMA: 82
[INFO] Sharpe Ratio: 1.031512
[INFO] Number of Trades: 33
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8851 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] Trades range: 10.0 to 328.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2970 to 2.7663
[INFO] Scaled Long SMA range: -2.7173 to 1.6949
[INFO] Scaled Sharpe ratio range: -2.9375 to 3.3040
[INFO] Scaled Trades range: -0.7511 to 15.9532
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8851 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5979
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 197 elements
[INFO] Cluster 1: 465 elements
[INFO] Cluster 2: 273 elements
[INFO] Cluster 3: 23 elements
[INFO] Cluster 4: 113 elements
[INFO] Cluster 5: 254 elements
[INFO] Cluster 6: 406 elements
[INFO] Cluster 7: 38 elements
[INFO] Cluster 8: 326 elements
[INFO] Cluster 9: 320 elements
[INFO] Cluster 10: 28 elements
[INFO] Cluster 11: 55 elements
[INFO] Cluster 12: 328 elements
[INFO] Cluster 13: 62 elements
[INFO] Cluster 14: 223 elements
[INFO] Cluster 15: 308 elements
[INFO] Cluster 16: 427 elements
[INFO] Cluster 17: 317 elements
[INFO] Cluster 18: 35 elements
[INFO] Cluster 19: 201 elements
[INFO] Cluster 20: 31 elements
[INFO] Cluster 21: 162 elements
[INFO] Cluster 22: 379 elements
[INFO] Cluster 23: 185 elements
[INFO] Cluster 24: 230 elements
[INFO] Cluster 25: 124 elements
[INFO] Cluster 26: 224 elements
[INFO] Cluster 27: 254 elements
[INFO] Cluster 28: 162 elements
[INFO] Cluster 29: 41 elements
[INFO] Cluster 30: 75 elements
[INFO] Cluster 31: 52 elements
[INFO] Cluster 32: 160 elements
[INFO] Cluster 33: 205 elements
[INFO] Cluster 34: 193 elements
[INFO] Cluster 35: 373 elements
[INFO] Cluster 36: 189 elements
[INFO] Cluster 37: 24 elements
[INFO] Cluster 38: 190 elements
[INFO] Cluster 39: 101 elements
[INFO] Cluster 40: 72 elements
[INFO] Cluster 41: 163 elements
[INFO] Cluster 42: 16 elements
[INFO] Cluster 43: 217 elements
[INFO] Cluster 44: 121 elements
[INFO] Cluster 45: 81 elements
[INFO] Cluster 46: 148 elements
[INFO] Cluster 47: 4 elements
[INFO] Cluster 48: 110 elements
[INFO] Cluster 49: 166 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=190, Long SMA=202, Sharpe=-0.0442, Trades=29
[INFO] Cluster 1 cluster: Short SMA=54, Long SMA=254, Sharpe=0.3957, Trades=10
[INFO] Cluster 2 cluster: Short SMA=264, Long SMA=282, Sharpe=-0.0488, Trades=18
[INFO] Cluster 3 cluster: Short SMA=16, Long SMA=20, Sharpe=0.0002, Trades=194
[INFO] Cluster 4 cluster: Short SMA=34, Long SMA=62, Sharpe=0.7541, Trades=48
[INFO] Cluster 5 cluster: Short SMA=26, Long SMA=212, Sharpe=0.3879, Trades=20
[INFO] Cluster 6 cluster: Short SMA=196, Long SMA=268, Sharpe=-0.2418, Trades=12
[INFO] Cluster 7 cluster: Short SMA=138, Long SMA=140, Sharpe=0.2017, Trades=83
[INFO] Cluster 8 cluster: Short SMA=112, Long SMA=222, Sharpe=0.2856, Trades=15
[INFO] Cluster 9 cluster: Short SMA=66, Long SMA=174, Sharpe=0.1379, Trades=19
[INFO] Cluster 10 cluster: Short SMA=72, Long SMA=76, Sharpe=0.5345, Trades=73
[INFO] Cluster 11 cluster: Short SMA=18, Long SMA=36, Sharpe=0.0231, Trades=82
[INFO] Cluster 12 cluster: Short SMA=52, Long SMA=214, Sharpe=0.2560, Trades=18
[INFO] Cluster 13 cluster: Short SMA=44, Long SMA=50, Sharpe=0.3776, Trades=88
[INFO] Cluster 14 cluster: Short SMA=16, Long SMA=254, Sharpe=0.1875, Trades=22
[INFO] Cluster 15 cluster: Short SMA=38, Long SMA=178, Sharpe=0.4506, Trades=20
[INFO] Cluster 16 cluster: Short SMA=128, Long SMA=198, Sharpe=0.3281, Trades=15
[INFO] Cluster 17 cluster: Short SMA=84, Long SMA=208, Sharpe=0.3975, Trades=15
[INFO] Cluster 18 cluster: Short SMA=18, Long SMA=26, Sharpe=-0.0762, Trades=124
[INFO] Cluster 19 cluster: Short SMA=46, Long SMA=128, Sharpe=0.3194, Trades=25
[INFO] Cluster 20 cluster: Short SMA=268, Long SMA=270, Sharpe=0.0120, Trades=42
[INFO] Cluster 21 cluster: Short SMA=16, Long SMA=88, Sharpe=0.5757, Trades=38
[INFO] Cluster 22 cluster: Short SMA=80, Long SMA=144, Sharpe=-0.0377, Trades=23
[INFO] Cluster 23 cluster: Short SMA=18, Long SMA=172, Sharpe=0.3840, Trades=26
[INFO] Cluster 24 cluster: Short SMA=30, Long SMA=288, Sharpe=0.2216, Trades=12
[INFO] Cluster 25 cluster: Short SMA=22, Long SMA=52, Sharpe=0.1949, Trades=54
[INFO] Cluster 26 cluster: Short SMA=22, Long SMA=130, Sharpe=0.6045, Trades=26
[INFO] Cluster 27 cluster: Short SMA=212, Long SMA=238, Sharpe=-0.0277, Trades=16
[INFO] Cluster 28 cluster: Short SMA=92, Long SMA=114, Sharpe=0.2257, Trades=33
[INFO] Cluster 29 cluster: Short SMA=166, Long SMA=174, Sharpe=0.1823, Trades=35
[INFO] Cluster 30 cluster: Short SMA=80, Long SMA=92, Sharpe=0.3014, Trades=45
[INFO] Cluster 31 cluster: Short SMA=118, Long SMA=124, Sharpe=0.0776, Trades=54
[INFO] Cluster 32 cluster: Short SMA=66, Long SMA=122, Sharpe=0.1280, Trades=25
[INFO] Cluster 33 cluster: Short SMA=40, Long SMA=80, Sharpe=0.7834, Trades=33
[INFO] Cluster 34 cluster: Short SMA=144, Long SMA=238, Sharpe=0.1305, Trades=13
[INFO] Cluster 35 cluster: Short SMA=166, Long SMA=248, Sharpe=-0.1803, Trades=13
[INFO] Cluster 36 cluster: Short SMA=228, Long SMA=276, Sharpe=0.0138, Trades=12
[INFO] Cluster 37 cluster: Short SMA=196, Long SMA=198, Sharpe=-0.0033, Trades=68
[INFO] Cluster 38 cluster: Short SMA=168, Long SMA=202, Sharpe=0.1099, Trades=19
[INFO] Cluster 39 cluster: Short SMA=240, Long SMA=258, Sharpe=-0.3996, Trades=20
[INFO] Cluster 40 cluster: Short SMA=148, Long SMA=160, Sharpe=0.6097, Trades=33
[INFO] Cluster 41 cluster: Short SMA=116, Long SMA=146, Sharpe=0.2522, Trades=27
[INFO] Cluster 43 cluster: Short SMA=136, Long SMA=178, Sharpe=0.5118, Trades=19
[INFO] Cluster 44 cluster: Short SMA=186, Long SMA=230, Sharpe=-0.2483, Trades=17
[INFO] Cluster 45 cluster: Short SMA=110, Long SMA=128, Sharpe=-0.0170, Trades=36
[INFO] Cluster 46 cluster: Short SMA=104, Long SMA=162, Sharpe=0.0754, Trades=19
[INFO] Cluster 48 cluster: Short SMA=56, Long SMA=100, Sharpe=0.4819, Trades=29
[INFO] Cluster 49 cluster: Short SMA=40, Long SMA=92, Sharpe=0.5052, Trades=27
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=56, Long SMA=82, Sharpe=1.0315, Trades=33
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=40, Long SMA=80, Sharpe=0.7834, Trades=33
[INFO] Top 2: Short SMA=34, Long SMA=62, Sharpe=0.7541, Trades=48
[INFO] Top 3: Short SMA=148, Long SMA=160, Sharpe=0.6097, Trades=33
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 8831 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 56, Long SMA: 82
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(40/80) - Original Sharpe: 0.7834, Trades: 33
[INFO] Hierarchical cluster 2: SMA(34/62) - Original Sharpe: 0.7541, Trades: 48
[INFO] Hierarchical cluster 3: SMA(148/160) - Original Sharpe: 0.6097, Trades: 33
[INFO] Hierarchical cluster 4: SMA(22/130) - Original Sharpe: 0.6045, Trades: 26
[INFO] Hierarchical cluster 5: SMA(16/88) - Original Sharpe: 0.5757, Trades: 38
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (56/82)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (40/80) - Sharpe: 0.7834
[INFO] cluster 2: (34/62) - Sharpe: 0.7541
[INFO] cluster 3: (148/160) - Sharpe: 0.6097
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.704271           -1.545410
1    2021-11-14 2021-11-14            43     0.838842           -2.150376
2    2022-01-14 2022-01-14            41     1.984191            0.793367
3    2022-03-14 2022-03-14            44     4.120920            4.120920
4    2022-05-14 2022-05-14            43     0.411261            0.411261
5    2022-07-14 2022-07-14            44     0.308673           -2.818461
6    2022-09-14 2022-09-14            43    -1.526198            1.234189
7    2022-11-14 2022-11-14            43    -1.104580           -1.035674
8    2023-01-14 2023-01-14            41    -5.413014           -4.922401
9    2023-03-14 2023-03-14            44    -1.314612           -0.216955
10   2023-05-14 2023-05-14            44    -1.913035           -2.681257
11   2023-07-14 2023-07-14            44     3.093754            2.924176
12   2023-09-14 2023-09-14            43     2.065825            1.822853
13   2023-11-14 2023-11-14            42    -3.774049           -4.025181
14   2024-01-14 2024-01-14            43    -1.733531           -1.818473
15   2024-03-14 2024-03-14            42     0.586636            2.947021
16   2024-05-14 2024-05-14            44    -1.885239           -0.076741
17   2024-07-14 2024-07-14            45     3.577993            3.577993
18   2024-09-14 2024-09-14            43    -4.939107           -5.521874
19   2024-11-14 2024-11-14            33     1.144905            1.144905
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.7 |             -1.5 |          1.2 | True          
[INFO] 2021-11-14   |          0.8 |             -2.2 |         -3.0 | False         
[INFO] 2022-01-14   |          2.0 |              0.8 |         -1.2 | False         
[INFO] 2022-03-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.3 |             -2.8 |         -3.1 | False         
[INFO] 2022-09-14   |         -1.5 |              1.2 |          2.7 | True          
[INFO] 2022-11-14   |         -1.1 |             -1.0 |          0.1 | True          
[INFO] 2023-01-14   |         -5.4 |             -4.9 |          0.5 | True          
[INFO] 2023-03-14   |         -1.3 |             -0.2 |          1.1 | True          
[INFO] 2023-05-14   |         -1.9 |             -2.7 |         -0.8 | False         
[INFO] 2023-07-14   |          3.1 |              2.9 |         -0.2 | False         
[INFO] 2023-09-14   |          2.1 |              1.8 |         -0.3 | False         
[INFO] 2023-11-14   |         -3.8 |             -4.0 |         -0.2 | False         
[INFO] 2024-01-14   |         -1.7 |             -1.8 |         -0.1 | False         
[INFO] 2024-03-14   |          0.6 |              2.9 |          2.3 | True          
[INFO] 2024-05-14   |         -1.9 |             -0.1 |          1.8 | True          
[INFO] 2024-07-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -4.9 |             -5.5 |         -0.6 | False         
[INFO] 2024-11-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2024-07-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 16 periods (43.75% win rate)
[INFO] Updating Excel file with Hierarchical results for TY...
[INFO] Excel file updated successfully. Added TY with Hierarchical win rate 43.8% in row 48
[INFO] Added best Sharpe parameters 56/82 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 56, Long SMA: 82
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(40/80) - Original Sharpe: 0.7834
[INFO] Added cluster 2 to portfolio: SMA(34/62) - Original Sharpe: 0.7541
[INFO] Added cluster 3 to portfolio: SMA(148/160) - Original Sharpe: 0.6097
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TY_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0591
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4431
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for TY...
[INFO] Excel file updated successfully. Added TY with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TY
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for TU in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 109.01s
[INFO] Best parameters: Short SMA = 274, Long SMA = 284
[INFO] Best Sharpe ratio: 0.774149, Trades: 18
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 2785 bad combos; keeping 887 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172', 'SMA_SF_TOP5_192/194', 'SMA_SF_TOP5_186/204', 'SMA_SF_TOP5_190/196', 'SMA_SF_TOP5_186/206', 'SMA_SF_TOP5_184/206', 'SMA_SI_TOP5_48/50', 'SMA_SI_TOP5_42/58', 'SMA_SI_TOP5_44/56', 'SMA_SI_TOP5_40/60', 'SMA_SI_TOP5_234/258', 'SMA_SM_TOP5_70/74', 'SMA_SM_TOP5_12/20', 'SMA_SM_TOP5_14/22', 'SMA_SM_TOP5_66/78', 'SMA_SM_TOP5_14/24', 'SMA_TEN_TOP5_58/76', 'SMA_TEN_TOP5_60/76', 'SMA_TEN_TOP5_60/74', 'SMA_TEN_TOP5_40/44', 'SMA_TEN_TOP5_58/74', 'SMA_TY_TOP5_56/82', 'SMA_TY_TOP5_54/84', 'SMA_TY_TOP5_56/84', 'SMA_TY_TOP5_60/78', 'SMA_TY_TOP5_66/70', 'SMA_TU_TOP5_274/284', 'SMA_TU_TOP5_272/288', 'SMA_TU_TOP5_274/282', 'SMA_TU_TOP5_272/284', 'SMA_TU_TOP5_276/278']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @TU
[INFO] Big Point Value (from data): 2000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 36.04 contracts
[INFO] Maximum Position Size: 152 contracts
[INFO] Strategy Total P&L: $685,372.50
[INFO] Market Buy & Hold P&L: $-12,695.31
[INFO] Outperformance: $698,067.81
[INFO] Sharpe ratio (entire period, annualized): 0.880451
[INFO] Sharpe ratio (in-sample, annualized): 0.774149
[INFO] Sharpe ratio (out-of-sample, annualized): 1.105817
[INFO] Maximum Drawdown: $100,651.25
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 16
[INFO] Out-of-sample period trades: 2
[INFO] Total trades: 18
[INFO] In-sample P&L: $401,453.44
[INFO] Out-of-sample P&L: $274,450.31
[INFO] 
Best parameters from GA: Short SMA = 274, Long SMA = 284, Sharpe = 0.774149
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 2000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9208 to 0.7741
[INFO] 
Best parameters:
[INFO] Short SMA: 274
[INFO] Long SMA: 284
[INFO] Sharpe Ratio: 0.774149
[INFO] Number of Trades: 18
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7800 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9208 to 0.7741
[INFO] Trades range: 10.0 to 366.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2341 to 2.7587
[INFO] Scaled Long SMA range: -2.5984 to 1.8280
[INFO] Scaled Sharpe ratio range: -5.1407 to 2.7922
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 120 elements
[INFO] Kmeans Cluster 1: 131 elements
[INFO] Kmeans Cluster 2: 170 elements
[INFO] Kmeans Cluster 3: 180 elements
[INFO] Kmeans Cluster 4: 179 elements
[INFO] Kmeans Cluster 5: 150 elements
[INFO] Kmeans Cluster 6: 254 elements
[INFO] Kmeans Cluster 7: 113 elements
[INFO] Kmeans Cluster 8: 177 elements
[INFO] Kmeans Cluster 9: 231 elements
[INFO] Kmeans Cluster 10: 188 elements
[INFO] Kmeans Cluster 11: 108 elements
[INFO] Kmeans Cluster 12: 154 elements
[INFO] Kmeans Cluster 13: 229 elements
[INFO] Kmeans Cluster 14: 237 elements
[INFO] Kmeans Cluster 15: 217 elements
[INFO] Kmeans Cluster 16: 61 elements
[INFO] Kmeans Cluster 17: 98 elements
[INFO] Kmeans Cluster 18: 151 elements
[INFO] Kmeans Cluster 19: 156 elements
[INFO] Kmeans Cluster 20: 196 elements
[INFO] Kmeans Cluster 21: 200 elements
[INFO] Kmeans Cluster 22: 170 elements
[INFO] Kmeans Cluster 23: 190 elements
[INFO] Kmeans Cluster 24: 335 elements
[INFO] Kmeans Cluster 25: 48 elements
[INFO] Kmeans Cluster 26: 70 elements
[INFO] Kmeans Cluster 27: 51 elements
[INFO] Kmeans Cluster 28: 103 elements
[INFO] Kmeans Cluster 29: 279 elements
[INFO] Kmeans Cluster 30: 91 elements
[INFO] Kmeans Cluster 31: 27 elements
[INFO] Kmeans Cluster 32: 71 elements
[INFO] Kmeans Cluster 33: 96 elements
[INFO] Kmeans Cluster 34: 208 elements
[INFO] Kmeans Cluster 35: 94 elements
[INFO] Kmeans Cluster 36: 52 elements
[INFO] Kmeans Cluster 37: 131 elements
[INFO] Kmeans Cluster 38: 143 elements
[INFO] Kmeans Cluster 39: 161 elements
[INFO] Kmeans Cluster 40: 237 elements
[INFO] Kmeans Cluster 41: 235 elements
[INFO] Kmeans Cluster 42: 101 elements
[INFO] Kmeans Cluster 43: 194 elements
[INFO] Kmeans Cluster 44: 134 elements
[INFO] Kmeans Cluster 45: 176 elements
[INFO] Kmeans Cluster 46: 112 elements
[INFO] Kmeans Cluster 47: 254 elements
[INFO] Kmeans Cluster 48: 134 elements
[INFO] Kmeans Cluster 49: 203 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=35.48, Long SMA=70.58, Sharpe=-0.0227
[INFO] Centroid 1: Short SMA=157.15, Long SMA=233.36, Sharpe=0.1271
[INFO] Centroid 2: Short SMA=28.29, Long SMA=183.54, Sharpe=0.1100
[INFO] Centroid 3: Short SMA=235.60, Long SMA=261.68, Sharpe=0.3158
[INFO] Centroid 4: Short SMA=56.01, Long SMA=112.34, Sharpe=0.2209
[INFO] Centroid 5: Short SMA=81.07, Long SMA=210.27, Sharpe=0.2786
[INFO] Centroid 6: Short SMA=116.72, Long SMA=190.19, Sharpe=0.0251
[INFO] Centroid 7: Short SMA=22.30, Long SMA=42.58, Sharpe=-0.4846
[INFO] Centroid 8: Short SMA=48.12, Long SMA=280.00, Sharpe=0.4034
[INFO] Centroid 9: Short SMA=29.08, Long SMA=165.06, Sharpe=0.2020
[INFO] Centroid 10: Short SMA=135.50, Long SMA=170.96, Sharpe=0.1732
[INFO] Centroid 11: Short SMA=33.93, Long SMA=120.56, Sharpe=0.3924
[INFO] Centroid 12: Short SMA=120.89, Long SMA=152.07, Sharpe=-0.0325
[INFO] Centroid 13: Short SMA=185.67, Long SMA=214.48, Sharpe=0.2739
[INFO] Centroid 14: Short SMA=28.50, Long SMA=207.05, Sharpe=0.2556
[INFO] Centroid 15: Short SMA=21.12, Long SMA=264.65, Sharpe=0.3248
[INFO] Centroid 16: Short SMA=69.41, Long SMA=87.90, Sharpe=0.5507
[INFO] Centroid 17: Short SMA=207.63, Long SMA=275.18, Sharpe=0.2630
[INFO] Centroid 18: Short SMA=86.94, Long SMA=104.09, Sharpe=-0.1732
[INFO] Centroid 19: Short SMA=209.27, Long SMA=228.54, Sharpe=0.4915
[INFO] Centroid 20: Short SMA=83.78, Long SMA=133.13, Sharpe=-0.0084
[INFO] Centroid 21: Short SMA=142.63, Long SMA=216.29, Sharpe=0.2286
[INFO] Centroid 22: Short SMA=25.85, Long SMA=139.38, Sharpe=0.2751
[INFO] Centroid 23: Short SMA=95.48, Long SMA=183.62, Sharpe=0.1716
[INFO] Centroid 24: Short SMA=66.75, Long SMA=173.30, Sharpe=0.0483
[INFO] Centroid 25: Short SMA=17.50, Long SMA=30.29, Sharpe=-0.6965
[INFO] Centroid 26: Short SMA=14.51, Long SMA=103.51, Sharpe=-0.0893
[INFO] Centroid 27: Short SMA=274.00, Long SMA=283.45, Sharpe=0.6292
[INFO] Centroid 28: Short SMA=87.11, Long SMA=225.17, Sharpe=0.5037
[INFO] Centroid 29: Short SMA=59.41, Long SMA=137.34, Sharpe=0.1163
[INFO] Centroid 30: Short SMA=109.08, Long SMA=124.55, Sharpe=0.3007
[INFO] Centroid 31: Short SMA=172.81, Long SMA=182.81, Sharpe=-0.3142
[INFO] Centroid 32: Short SMA=168.45, Long SMA=185.04, Sharpe=-0.0765
[INFO] Centroid 33: Short SMA=270.42, Long SMA=294.08, Sharpe=0.2568
[INFO] Centroid 34: Short SMA=127.11, Long SMA=221.62, Sharpe=0.3162
[INFO] Centroid 35: Short SMA=237.85, Long SMA=253.70, Sharpe=0.1751
[INFO] Centroid 36: Short SMA=152.62, Long SMA=167.54, Sharpe=0.5025
[INFO] Centroid 37: Short SMA=22.21, Long SMA=290.09, Sharpe=0.2233
[INFO] Centroid 38: Short SMA=30.34, Long SMA=60.17, Sharpe=-0.2116
[INFO] Centroid 39: Short SMA=149.96, Long SMA=183.75, Sharpe=0.3351
[INFO] Centroid 40: Short SMA=110.02, Long SMA=141.47, Sharpe=0.1026
[INFO] Centroid 41: Short SMA=203.22, Long SMA=241.75, Sharpe=0.3823
[INFO] Centroid 42: Short SMA=19.13, Long SMA=116.81, Sharpe=0.1032
[INFO] Centroid 43: Short SMA=48.82, Long SMA=88.37, Sharpe=0.1073
[INFO] Centroid 44: Short SMA=24.07, Long SMA=61.48, Sharpe=-0.3525
[INFO] Centroid 45: Short SMA=64.20, Long SMA=199.97, Sharpe=0.1220
[INFO] Centroid 46: Short SMA=173.69, Long SMA=200.11, Sharpe=0.1412
[INFO] Centroid 47: Short SMA=31.39, Long SMA=226.57, Sharpe=0.3641
[INFO] Centroid 48: Short SMA=55.42, Long SMA=85.10, Sharpe=0.3256
[INFO] Centroid 49: Short SMA=256.80, Long SMA=281.79, Sharpe=0.4109
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=18
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=18
[INFO] Kmeans Top 2: Short SMA=64, Long SMA=82, Sharpe=0.5637, Trades=37
[INFO] Kmeans Top 3: Short SMA=210, Long SMA=228, Sharpe=0.5541, Trades=21
[INFO] Kmeans Top 4: Short SMA=88, Long SMA=224, Sharpe=0.5524, Trades=10
[INFO] Kmeans Top 5: Short SMA=154, Long SMA=166, Sharpe=0.4860, Trades=36
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (35, 71)
[INFO]   Nearest: (36.0, 70.0)
[INFO]   Rounded: (157, 233)
[INFO]   Nearest: (158.0, 234.0)
[INFO]   Rounded: (28, 184)
[INFO]   Rounded: (236, 262)
[INFO]   Rounded: (56, 112)
[INFO]   Rounded: (81, 210)
[INFO]   Nearest: (82.0, 210.0)
[INFO]   Rounded: (117, 190)
[INFO]   Nearest: (116.0, 190.0)
[INFO]   Rounded: (22, 43)
[INFO]   Nearest: (22.0, 42.0)
[INFO]   Rounded: (48, 280)
[INFO]   Rounded: (29, 165)
[INFO]   Nearest: (30.0, 166.0)
[INFO]   Rounded: (136, 171)
[INFO]   Nearest: (136.0, 170.0)
[INFO]   Rounded: (34, 121)
[INFO]   Nearest: (34.0, 120.0)
[INFO]   Rounded: (121, 152)
[INFO]   Nearest: (120.0, 152.0)
[INFO]   Rounded: (186, 214)
[INFO]   Rounded: (28, 207)
[INFO]   Nearest: (28.0, 208.0)
[INFO]   Rounded: (21, 265)
[INFO]   Nearest: (22.0, 264.0)
[INFO]   Rounded: (69, 88)
[INFO]   Nearest: (70.0, 88.0)
[INFO]   Rounded: (208, 275)
[INFO]   Nearest: (208.0, 276.0)
[INFO]   Rounded: (87, 104)
[INFO]   Nearest: (86.0, 104.0)
[INFO]   Rounded: (209, 229)
[INFO]   Nearest: (210.0, 228.0)
[INFO]   Rounded: (84, 133)
[INFO]   Nearest: (84.0, 134.0)
[INFO]   Rounded: (143, 216)
[INFO]   Nearest: (142.0, 216.0)
[INFO]   Rounded: (26, 139)
[INFO]   Nearest: (26.0, 140.0)
[INFO]   Rounded: (95, 184)
[INFO]   Nearest: (96.0, 184.0)
[INFO]   Rounded: (67, 173)
[INFO]   Nearest: (66.0, 174.0)
[INFO]   Rounded: (18, 30)
[INFO]   Rounded: (15, 104)
[INFO]   Nearest: (14.0, 104.0)
[INFO]   Rounded: (274, 283)
[INFO]   Nearest: (274.0, 284.0)
[INFO]   Rounded: (87, 225)
[INFO]   Nearest: (88.0, 226.0)
[INFO]   Rounded: (59, 137)
[INFO]   Nearest: (60.0, 138.0)
[INFO]   Rounded: (109, 125)
[INFO]   Nearest: (110.0, 124.0)
[INFO]   Rounded: (173, 183)
[INFO]   Nearest: (172.0, 182.0)
[INFO]   Rounded: (168, 185)
[INFO]   Nearest: (168.0, 186.0)
[INFO]   Rounded: (270, 294)
[INFO]   Rounded: (127, 222)
[INFO]   Nearest: (128.0, 222.0)
[INFO]   Rounded: (238, 254)
[INFO]   Rounded: (153, 168)
[INFO]   Nearest: (152.0, 168.0)
[INFO]   Rounded: (22, 290)
[INFO]   Rounded: (30, 60)
[INFO]   Rounded: (150, 184)
[INFO]   Rounded: (110, 141)
[INFO]   Nearest: (110.0, 142.0)
[INFO]   Rounded: (203, 242)
[INFO]   Nearest: (204.0, 242.0)
[INFO]   Rounded: (19, 117)
[INFO]   Nearest: (20.0, 116.0)
[INFO]   Rounded: (49, 88)
[INFO]   Nearest: (48.0, 88.0)
[INFO]   Rounded: (24, 61)
[INFO]   Nearest: (24.0, 62.0)
[INFO]   Rounded: (64, 200)
[INFO]   Rounded: (174, 200)
[INFO]   Rounded: (31, 227)
[INFO]   Nearest: (32.0, 226.0)
[INFO]   Rounded: (55, 85)
[INFO]   Nearest: (56.0, 86.0)
[INFO]   Rounded: (257, 282)
[INFO]   Nearest: (256.0, 282.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 274, Long SMA: 284
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(274/284) - Original Sharpe: 0.7741, Trades: 18
[INFO] Kmeans cluster 2: SMA(64/82) - Original Sharpe: 0.5637, Trades: 37
[INFO] Kmeans cluster 3: SMA(210/228) - Original Sharpe: 0.5541, Trades: 21
[INFO] Kmeans cluster 4: SMA(88/224) - Original Sharpe: 0.5524, Trades: 10
[INFO] Kmeans cluster 5: SMA(154/166) - Original Sharpe: 0.4860, Trades: 36
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (274/284)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (274/284) - Sharpe: 0.7741
[INFO] cluster 2: (64/82) - Sharpe: 0.5637
[INFO] cluster 3: (210/228) - Sharpe: 0.5541
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     5.346901            2.503769
1    2021-11-14 2021-11-14            43     1.829328            1.829328
2    2022-01-14 2022-01-14            41     4.222575            4.222575
3    2022-03-14 2022-03-14            44     3.242182            3.242182
4    2022-05-14 2022-05-14            43     1.473801            1.473801
5    2022-07-14 2022-07-14            44     2.919931            2.919931
6    2022-09-14 2022-09-14            43     2.385425            2.385425
7    2022-11-14 2022-11-14            43    -0.436907           -0.436907
8    2023-01-14 2023-01-14            41    -0.202608           -2.015105
9    2023-03-14 2023-03-14            44     0.324596            0.324596
10   2023-05-14 2023-05-14            44     3.890567            2.021830
11   2023-07-14 2023-07-14            44     3.021284            3.021284
12   2023-09-14 2023-09-14            43     1.135707            1.135707
13   2023-11-14 2023-11-14            42    -3.433823           -3.393658
14   2024-01-14 2024-01-14            43     3.467114            3.467114
15   2024-03-14 2024-03-14            42     2.327772            2.517183
16   2024-05-14 2024-05-14            44    -2.234806           -2.234806
17   2024-07-14 2024-07-14            45    -3.677302            4.078903
18   2024-09-14 2024-09-14            43     0.511850           -0.893823
19   2024-11-14 2024-11-14            33    -2.294343           -1.352254
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          5.3 |              2.5 |         -2.8 | False         
[INFO] 2021-11-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2022-01-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.2 |              3.2 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.2 |             -2.0 |         -1.8 | False         
[INFO] 2023-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.9 |              2.0 |         -1.9 | False         
[INFO] 2023-07-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.4 |             -3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |          2.3 |              2.5 |          0.2 | True          
[INFO] 2024-05-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -3.7 |              4.1 |          7.8 | True          
[INFO] 2024-09-14   |          0.5 |             -0.9 |         -1.4 | False         
[INFO] 2024-11-14   |         -2.3 |             -1.4 |          0.9 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-03-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 7
[INFO] Kmeans cluster wins (rounded comparison): 3 of 7 periods (42.86% win rate)
[INFO] Updating Excel file with Kmeans results for TU...
[INFO] Excel file updated successfully. Added TU with Kmeans win rate 42.9% in row 49
[INFO] Added best Sharpe parameters 274/284 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 274, Long SMA: 284
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(274/284) - Original Sharpe: 0.7741
[INFO] Added cluster 2 to portfolio: SMA(64/82) - Original Sharpe: 0.5637
[INFO] Added cluster 3 to portfolio: SMA(210/228) - Original Sharpe: 0.5541
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TU_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 1.0184
[INFO] Kmeans Best out-of-sample Sharpe: 1.1058
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for TU...
[INFO] Excel file updated successfully. Added TU with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TU
[INFO] Big Point Value: 2000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9208 to 0.7741
[INFO] 
Best parameters:
[INFO] Short SMA: 274
[INFO] Long SMA: 284
[INFO] Sharpe Ratio: 0.774149
[INFO] Number of Trades: 18
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7800 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9208 to 0.7741
[INFO] Trades range: 10.0 to 366.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2341 to 2.7587
[INFO] Scaled Long SMA range: -2.5984 to 1.8280
[INFO] Scaled Sharpe ratio range: -5.1407 to 2.7922
[INFO] Scaled Trades range: -0.6610 to 14.6335
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 7800 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6561
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 117 elements
[INFO] Cluster 1: 71 elements
[INFO] Cluster 2: 86 elements
[INFO] Cluster 3: 378 elements
[INFO] Cluster 4: 320 elements
[INFO] Cluster 5: 137 elements
[INFO] Cluster 6: 161 elements
[INFO] Cluster 7: 40 elements
[INFO] Cluster 8: 306 elements
[INFO] Cluster 9: 218 elements
[INFO] Cluster 10: 149 elements
[INFO] Cluster 11: 66 elements
[INFO] Cluster 12: 178 elements
[INFO] Cluster 13: 282 elements
[INFO] Cluster 14: 471 elements
[INFO] Cluster 15: 276 elements
[INFO] Cluster 16: 269 elements
[INFO] Cluster 17: 20 elements
[INFO] Cluster 18: 279 elements
[INFO] Cluster 19: 56 elements
[INFO] Cluster 20: 87 elements
[INFO] Cluster 21: 163 elements
[INFO] Cluster 22: 272 elements
[INFO] Cluster 23: 197 elements
[INFO] Cluster 24: 48 elements
[INFO] Cluster 25: 160 elements
[INFO] Cluster 26: 126 elements
[INFO] Cluster 27: 82 elements
[INFO] Cluster 28: 390 elements
[INFO] Cluster 29: 16 elements
[INFO] Cluster 30: 160 elements
[INFO] Cluster 31: 111 elements
[INFO] Cluster 32: 4 elements
[INFO] Cluster 33: 176 elements
[INFO] Cluster 34: 107 elements
[INFO] Cluster 35: 130 elements
[INFO] Cluster 36: 16 elements
[INFO] Cluster 37: 347 elements
[INFO] Cluster 38: 241 elements
[INFO] Cluster 39: 199 elements
[INFO] Cluster 40: 119 elements
[INFO] Cluster 41: 264 elements
[INFO] Cluster 42: 34 elements
[INFO] Cluster 43: 82 elements
[INFO] Cluster 44: 140 elements
[INFO] Cluster 45: 40 elements
[INFO] Cluster 46: 27 elements
[INFO] Cluster 47: 33 elements
[INFO] Cluster 48: 136 elements
[INFO] Cluster 49: 13 elements
[INFO] Using 46 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=182, Long SMA=190, Sharpe=0.2467, Trades=44
[INFO] Cluster 1 cluster: Short SMA=56, Long SMA=62, Sharpe=0.0102, Trades=79
[INFO] Cluster 2 cluster: Short SMA=64, Long SMA=80, Sharpe=0.4016, Trades=45
[INFO] Cluster 3 cluster: Short SMA=98, Long SMA=146, Sharpe=0.0609, Trades=20
[INFO] Cluster 4 cluster: Short SMA=204, Long SMA=238, Sharpe=0.3352, Trades=15
[INFO] Cluster 5 cluster: Short SMA=88, Long SMA=106, Sharpe=-0.2822, Trades=35
[INFO] Cluster 6 cluster: Short SMA=16, Long SMA=60, Sharpe=-0.3494, Trades=62
[INFO] Cluster 7 cluster: Short SMA=104, Long SMA=106, Sharpe=0.0933, Trades=121
[INFO] Cluster 8 cluster: Short SMA=42, Long SMA=114, Sharpe=0.3773, Trades=23
[INFO] Cluster 9 cluster: Short SMA=42, Long SMA=86, Sharpe=0.0945, Trades=35
[INFO] Cluster 10 cluster: Short SMA=240, Long SMA=256, Sharpe=0.2022, Trades=19
[INFO] Cluster 11 cluster: Short SMA=18, Long SMA=32, Sharpe=-0.6461, Trades=98
[INFO] Cluster 12 cluster: Short SMA=22, Long SMA=88, Sharpe=-0.0889, Trades=41
[INFO] Cluster 13 cluster: Short SMA=30, Long SMA=232, Sharpe=0.3421, Trades=13
[INFO] Cluster 14 cluster: Short SMA=138, Long SMA=216, Sharpe=0.2523, Trades=12
[INFO] Cluster 15 cluster: Short SMA=22, Long SMA=280, Sharpe=0.2396, Trades=12
[INFO] Cluster 16 cluster: Short SMA=124, Long SMA=194, Sharpe=0.0263, Trades=14
[INFO] Cluster 17 cluster: Short SMA=22, Long SMA=26, Sharpe=-0.7707, Trades=158
[INFO] Cluster 18 cluster: Short SMA=224, Long SMA=266, Sharpe=0.2985, Trades=13
[INFO] Cluster 19 cluster: Short SMA=170, Long SMA=184, Sharpe=-0.1086, Trades=33
[INFO] Cluster 20 cluster: Short SMA=112, Long SMA=126, Sharpe=0.3611, Trades=36
[INFO] Cluster 21 cluster: Short SMA=16, Long SMA=184, Sharpe=0.1547, Trades=27
[INFO] Cluster 22 cluster: Short SMA=92, Long SMA=176, Sharpe=0.2799, Trades=14
[INFO] Cluster 23 cluster: Short SMA=26, Long SMA=160, Sharpe=0.3206, Trades=21
[INFO] Cluster 24 cluster: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=18
[INFO] Cluster 25 cluster: Short SMA=162, Long SMA=226, Sharpe=0.1586, Trades=12
[INFO] Cluster 26 cluster: Short SMA=260, Long SMA=294, Sharpe=0.3575, Trades=12
[INFO] Cluster 27 cluster: Short SMA=150, Long SMA=168, Sharpe=0.4001, Trades=28
[INFO] Cluster 28 cluster: Short SMA=56, Long SMA=178, Sharpe=0.0308, Trades=17
[INFO] Cluster 30 cluster: Short SMA=134, Long SMA=172, Sharpe=0.1686, Trades=18
[INFO] Cluster 31 cluster: Short SMA=82, Long SMA=214, Sharpe=0.3537, Trades=12
[INFO] Cluster 33 cluster: Short SMA=48, Long SMA=280, Sharpe=0.3968, Trades=10
[INFO] Cluster 34 cluster: Short SMA=30, Long SMA=60, Sharpe=-0.2320, Trades=53
[INFO] Cluster 35 cluster: Short SMA=130, Long SMA=146, Sharpe=0.0772, Trades=34
[INFO] Cluster 37 cluster: Short SMA=56, Long SMA=140, Sharpe=0.0951, Trades=17
[INFO] Cluster 38 cluster: Short SMA=26, Long SMA=210, Sharpe=0.2580, Trades=19
[INFO] Cluster 39 cluster: Short SMA=182, Long SMA=212, Sharpe=0.3327, Trades=16
[INFO] Cluster 40 cluster: Short SMA=20, Long SMA=124, Sharpe=0.2642, Trades=33
[INFO] Cluster 41 cluster: Short SMA=80, Long SMA=204, Sharpe=0.1425, Trades=12
[INFO] Cluster 42 cluster: Short SMA=32, Long SMA=38, Sharpe=-0.4500, Trades=116
[INFO] Cluster 43 cluster: Short SMA=88, Long SMA=226, Sharpe=0.5412, Trades=10
[INFO] Cluster 44 cluster: Short SMA=260, Long SMA=282, Sharpe=0.4584, Trades=14
[INFO] Cluster 45 cluster: Short SMA=212, Long SMA=220, Sharpe=0.4220, Trades=39
[INFO] Cluster 46 cluster: Short SMA=118, Long SMA=124, Sharpe=0.3883, Trades=64
[INFO] Cluster 47 cluster: Short SMA=202, Long SMA=204, Sharpe=0.3739, Trades=75
[INFO] Cluster 48 cluster: Short SMA=64, Long SMA=108, Sharpe=0.1584, Trades=27
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=18
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=18
[INFO] Top 2: Short SMA=88, Long SMA=226, Sharpe=0.5412, Trades=10
[INFO] Top 3: Short SMA=260, Long SMA=282, Sharpe=0.4584, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 46 valid clusters with clusters
[INFO] Filtering to 7751 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 274, Long SMA: 284
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(274/284) - Original Sharpe: 0.7741, Trades: 18
[INFO] Hierarchical cluster 2: SMA(88/226) - Original Sharpe: 0.5412, Trades: 10
[INFO] Hierarchical cluster 3: SMA(260/282) - Original Sharpe: 0.4584, Trades: 14
[INFO] Hierarchical cluster 4: SMA(212/220) - Original Sharpe: 0.4220, Trades: 39
[INFO] Hierarchical cluster 5: SMA(64/80) - Original Sharpe: 0.4016, Trades: 45
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (274/284)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (274/284) - Sharpe: 0.7741
[INFO] cluster 2: (88/226) - Sharpe: 0.5412
[INFO] cluster 3: (260/282) - Sharpe: 0.4584
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     5.346901            5.346901
1    2021-11-14 2021-11-14            43     1.829328            1.829328
2    2022-01-14 2022-01-14            41     4.222575            4.222575
3    2022-03-14 2022-03-14            44     3.242182            3.242182
4    2022-05-14 2022-05-14            43     1.473801            1.473801
5    2022-07-14 2022-07-14            44     2.919931            2.919931
6    2022-09-14 2022-09-14            43     2.385425            2.385425
7    2022-11-14 2022-11-14            43    -0.436907           -0.436907
8    2023-01-14 2023-01-14            41    -0.202608           -0.202608
9    2023-03-14 2023-03-14            44     0.324596            0.324596
10   2023-05-14 2023-05-14            44     3.890567            3.890567
11   2023-07-14 2023-07-14            44     3.021284            3.021284
12   2023-09-14 2023-09-14            43     1.135707            1.135707
13   2023-11-14 2023-11-14            42    -3.433823           -3.433823
14   2024-01-14 2024-01-14            43     3.467114            3.467114
15   2024-03-14 2024-03-14            42     2.327772            1.525188
16   2024-05-14 2024-05-14            44    -2.234806           -2.234806
17   2024-07-14 2024-07-14            45    -3.677302           -3.677302
18   2024-09-14 2024-09-14            43     0.511850           -4.780599
19   2024-11-14 2024-11-14            33    -2.294343            0.268884
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          5.3 |              5.3 |          0.0 | Excluded      
[INFO] 2021-11-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2022-01-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.2 |              3.2 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2023-07-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.4 |             -3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |          2.3 |              1.5 |         -0.8 | False         
[INFO] 2024-05-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -3.7 |             -3.7 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.5 |             -4.8 |         -5.3 | False         
[INFO] 2024-11-14   |         -2.3 |              0.3 |          2.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 3
[INFO] Hierarchical cluster wins (rounded comparison): 1 of 3 periods (33.33% win rate)
[INFO] Updating Excel file with Hierarchical results for TU...
[INFO] Excel file updated successfully. Added TU with Hierarchical win rate 33.3% in row 49
[INFO] Added best Sharpe parameters 274/284 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 274, Long SMA: 284
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(274/284) - Original Sharpe: 0.7741
[INFO] Added cluster 2 to portfolio: SMA(88/226) - Original Sharpe: 0.5412
[INFO] Added cluster 3 to portfolio: SMA(260/282) - Original Sharpe: 0.4584
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TU_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.9735
[INFO] Hierarchical Best out-of-sample Sharpe: 1.1058
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for TU...
[INFO] Excel file updated successfully. Added TU with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TU
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for UB in column D: 34.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 108.54s
[INFO] Best parameters: Short SMA = 62, Long SMA = 80
[INFO] Best Sharpe ratio: 0.952489, Trades: 45
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172', 'SMA_SF_TOP5_192/194', 'SMA_SF_TOP5_186/204', 'SMA_SF_TOP5_190/196', 'SMA_SF_TOP5_186/206', 'SMA_SF_TOP5_184/206', 'SMA_SI_TOP5_48/50', 'SMA_SI_TOP5_42/58', 'SMA_SI_TOP5_44/56', 'SMA_SI_TOP5_40/60', 'SMA_SI_TOP5_234/258', 'SMA_SM_TOP5_70/74', 'SMA_SM_TOP5_12/20', 'SMA_SM_TOP5_14/22', 'SMA_SM_TOP5_66/78', 'SMA_SM_TOP5_14/24', 'SMA_TEN_TOP5_58/76', 'SMA_TEN_TOP5_60/76', 'SMA_TEN_TOP5_60/74', 'SMA_TEN_TOP5_40/44', 'SMA_TEN_TOP5_58/74', 'SMA_TY_TOP5_56/82', 'SMA_TY_TOP5_54/84', 'SMA_TY_TOP5_56/84', 'SMA_TY_TOP5_60/78', 'SMA_TY_TOP5_66/70', 'SMA_TU_TOP5_274/284', 'SMA_TU_TOP5_272/288', 'SMA_TU_TOP5_274/282', 'SMA_TU_TOP5_272/284', 'SMA_TU_TOP5_276/278', 'SMA_UB_TOP5_62/80', 'SMA_UB_TOP5_62/82', 'SMA_UB_TOP5_68/72', 'SMA_UB_TOP5_70/72', 'SMA_UB_TOP5_52/70']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @UB=117XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.63 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $499,619.00
[INFO] Market Buy & Hold P&L: $-15,562.50
[INFO] Outperformance: $515,181.50
[INFO] Sharpe ratio (entire period, annualized): 0.694675
[INFO] Sharpe ratio (in-sample, annualized): 0.952489
[INFO] Sharpe ratio (out-of-sample, annualized): 0.089749
[INFO] Maximum Drawdown: $135,012.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 30
[INFO] Out-of-sample period trades: 15
[INFO] Total trades: 45
[INFO] In-sample P&L: $564,104.75
[INFO] Out-of-sample P&L: $22,641.00
[INFO] 
Best parameters from GA: Short SMA = 62, Long SMA = 80, Sharpe = 0.952489
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5904 to 0.9525
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 80
[INFO] Sharpe Ratio: 0.952489
[INFO] Number of Trades: 45
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5904 to 0.9525
[INFO] Trades range: 11.0 to 334.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6592 to 3.0565
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 286 elements
[INFO] Kmeans Cluster 1: 302 elements
[INFO] Kmeans Cluster 2: 251 elements
[INFO] Kmeans Cluster 3: 225 elements
[INFO] Kmeans Cluster 4: 244 elements
[INFO] Kmeans Cluster 5: 268 elements
[INFO] Kmeans Cluster 6: 275 elements
[INFO] Kmeans Cluster 7: 161 elements
[INFO] Kmeans Cluster 8: 190 elements
[INFO] Kmeans Cluster 9: 233 elements
[INFO] Kmeans Cluster 10: 217 elements
[INFO] Kmeans Cluster 11: 56 elements
[INFO] Kmeans Cluster 12: 170 elements
[INFO] Kmeans Cluster 13: 245 elements
[INFO] Kmeans Cluster 14: 154 elements
[INFO] Kmeans Cluster 15: 197 elements
[INFO] Kmeans Cluster 16: 95 elements
[INFO] Kmeans Cluster 17: 230 elements
[INFO] Kmeans Cluster 18: 217 elements
[INFO] Kmeans Cluster 19: 211 elements
[INFO] Kmeans Cluster 20: 216 elements
[INFO] Kmeans Cluster 21: 163 elements
[INFO] Kmeans Cluster 22: 189 elements
[INFO] Kmeans Cluster 23: 331 elements
[INFO] Kmeans Cluster 24: 167 elements
[INFO] Kmeans Cluster 25: 183 elements
[INFO] Kmeans Cluster 26: 186 elements
[INFO] Kmeans Cluster 27: 257 elements
[INFO] Kmeans Cluster 28: 271 elements
[INFO] Kmeans Cluster 29: 223 elements
[INFO] Kmeans Cluster 30: 190 elements
[INFO] Kmeans Cluster 31: 278 elements
[INFO] Kmeans Cluster 32: 151 elements
[INFO] Kmeans Cluster 33: 244 elements
[INFO] Kmeans Cluster 34: 294 elements
[INFO] Kmeans Cluster 35: 151 elements
[INFO] Kmeans Cluster 36: 328 elements
[INFO] Kmeans Cluster 37: 187 elements
[INFO] Kmeans Cluster 38: 263 elements
[INFO] Kmeans Cluster 39: 182 elements
[INFO] Kmeans Cluster 40: 215 elements
[INFO] Kmeans Cluster 41: 125 elements
[INFO] Kmeans Cluster 42: 136 elements
[INFO] Kmeans Cluster 43: 152 elements
[INFO] Kmeans Cluster 44: 262 elements
[INFO] Kmeans Cluster 45: 279 elements
[INFO] Kmeans Cluster 46: 191 elements
[INFO] Kmeans Cluster 47: 221 elements
[INFO] Kmeans Cluster 48: 80 elements
[INFO] Kmeans Cluster 49: 243 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=112.16, Long SMA=225.78, Sharpe=0.1467
[INFO] Centroid 1: Short SMA=29.93, Long SMA=148.19, Sharpe=0.4736
[INFO] Centroid 2: Short SMA=227.69, Long SMA=256.67, Sharpe=-0.3264
[INFO] Centroid 3: Short SMA=65.88, Long SMA=286.14, Sharpe=-0.1228
[INFO] Centroid 4: Short SMA=51.19, Long SMA=209.65, Sharpe=0.2880
[INFO] Centroid 5: Short SMA=174.80, Long SMA=241.69, Sharpe=-0.1455
[INFO] Centroid 6: Short SMA=66.66, Long SMA=177.88, Sharpe=0.0995
[INFO] Centroid 7: Short SMA=19.79, Long SMA=89.95, Sharpe=0.6630
[INFO] Centroid 8: Short SMA=71.92, Long SMA=250.78, Sharpe=0.1285
[INFO] Centroid 9: Short SMA=192.49, Long SMA=268.95, Sharpe=-0.2812
[INFO] Centroid 10: Short SMA=160.62, Long SMA=184.94, Sharpe=0.1957
[INFO] Centroid 11: Short SMA=19.00, Long SMA=31.14, Sharpe=0.0233
[INFO] Centroid 12: Short SMA=98.69, Long SMA=119.07, Sharpe=0.0030
[INFO] Centroid 13: Short SMA=150.65, Long SMA=259.26, Sharpe=-0.0540
[INFO] Centroid 14: Short SMA=189.39, Long SMA=203.76, Sharpe=0.0475
[INFO] Centroid 15: Short SMA=29.84, Long SMA=290.53, Sharpe=-0.0315
[INFO] Centroid 16: Short SMA=278.46, Long SMA=292.99, Sharpe=-0.3432
[INFO] Centroid 17: Short SMA=106.40, Long SMA=183.72, Sharpe=0.1895
[INFO] Centroid 18: Short SMA=26.70, Long SMA=174.77, Sharpe=0.3215
[INFO] Centroid 19: Short SMA=61.57, Long SMA=92.64, Sharpe=0.6091
[INFO] Centroid 20: Short SMA=69.91, Long SMA=230.94, Sharpe=0.2173
[INFO] Centroid 21: Short SMA=33.15, Long SMA=61.26, Sharpe=0.6143
[INFO] Centroid 22: Short SMA=107.58, Long SMA=135.20, Sharpe=0.1438
[INFO] Centroid 23: Short SMA=89.37, Long SMA=275.37, Sharpe=-0.0055
[INFO] Centroid 24: Short SMA=27.08, Long SMA=59.26, Sharpe=0.4802
[INFO] Centroid 25: Short SMA=124.49, Long SMA=152.63, Sharpe=-0.0983
[INFO] Centroid 26: Short SMA=76.12, Long SMA=126.08, Sharpe=0.1693
[INFO] Centroid 27: Short SMA=194.47, Long SMA=222.29, Sharpe=-0.0646
[INFO] Centroid 28: Short SMA=86.49, Long SMA=200.75, Sharpe=0.2736
[INFO] Centroid 29: Short SMA=27.64, Long SMA=192.39, Sharpe=0.4663
[INFO] Centroid 30: Short SMA=54.92, Long SMA=79.55, Sharpe=0.7505
[INFO] Centroid 31: Short SMA=166.28, Long SMA=285.34, Sharpe=-0.1667
[INFO] Centroid 32: Short SMA=155.76, Long SMA=222.24, Sharpe=0.0592
[INFO] Centroid 33: Short SMA=228.55, Long SMA=288.45, Sharpe=-0.2637
[INFO] Centroid 34: Short SMA=256.04, Long SMA=278.50, Sharpe=-0.1687
[INFO] Centroid 35: Short SMA=49.40, Long SMA=136.90, Sharpe=0.3278
[INFO] Centroid 36: Short SMA=122.42, Long SMA=283.79, Sharpe=-0.0640
[INFO] Centroid 37: Short SMA=78.65, Long SMA=151.65, Sharpe=0.0033
[INFO] Centroid 38: Short SMA=119.70, Long SMA=250.11, Sharpe=0.0413
[INFO] Centroid 39: Short SMA=31.33, Long SMA=272.67, Sharpe=0.0612
[INFO] Centroid 40: Short SMA=134.26, Long SMA=209.36, Sharpe=0.2588
[INFO] Centroid 41: Short SMA=196.54, Long SMA=290.85, Sharpe=-0.3948
[INFO] Centroid 42: Short SMA=215.09, Long SMA=237.71, Sharpe=-0.1830
[INFO] Centroid 43: Short SMA=67.47, Long SMA=107.84, Sharpe=0.4001
[INFO] Centroid 44: Short SMA=28.78, Long SMA=112.90, Sharpe=0.5345
[INFO] Centroid 45: Short SMA=32.39, Long SMA=253.78, Sharpe=0.2150
[INFO] Centroid 46: Short SMA=123.75, Long SMA=162.72, Sharpe=0.0619
[INFO] Centroid 47: Short SMA=146.41, Long SMA=182.57, Sharpe=0.3455
[INFO] Centroid 48: Short SMA=19.72, Long SMA=35.20, Sharpe=0.2619
[INFO] Centroid 49: Short SMA=23.94, Long SMA=226.36, Sharpe=0.3555
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=80, Sharpe=0.9525, Trades=45
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=58, Long SMA=82, Sharpe=0.6991, Trades=45
[INFO] Kmeans Top 2: Short SMA=62, Long SMA=94, Sharpe=0.6693, Trades=35
[INFO] Kmeans Top 3: Short SMA=20, Long SMA=90, Sharpe=0.6528, Trades=36
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=148, Sharpe=0.6266, Trades=22
[INFO] Kmeans Top 5: Short SMA=28, Long SMA=114, Sharpe=0.6050, Trades=28
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (112, 226)
[INFO]   Rounded: (30, 148)
[INFO]   Rounded: (228, 257)
[INFO]   Nearest: (228.0, 256.0)
[INFO]   Rounded: (66, 286)
[INFO]   Rounded: (51, 210)
[INFO]   Nearest: (52.0, 210.0)
[INFO]   Rounded: (175, 242)
[INFO]   Nearest: (174.0, 242.0)
[INFO]   Rounded: (67, 178)
[INFO]   Nearest: (66.0, 178.0)
[INFO]   Rounded: (20, 90)
[INFO]   Rounded: (72, 251)
[INFO]   Nearest: (72.0, 250.0)
[INFO]   Rounded: (192, 269)
[INFO]   Nearest: (192.0, 268.0)
[INFO]   Rounded: (161, 185)
[INFO]   Nearest: (160.0, 184.0)
[INFO]   Rounded: (19, 31)
[INFO]   Nearest: (18.0, 32.0)
[INFO]   Rounded: (99, 119)
[INFO]   Nearest: (98.0, 120.0)
[INFO]   Rounded: (151, 259)
[INFO]   Nearest: (150.0, 260.0)
[INFO]   Rounded: (189, 204)
[INFO]   Nearest: (190.0, 204.0)
[INFO]   Rounded: (30, 291)
[INFO]   Nearest: (30.0, 290.0)
[INFO]   Rounded: (278, 293)
[INFO]   Nearest: (278.0, 292.0)
[INFO]   Rounded: (106, 184)
[INFO]   Rounded: (27, 175)
[INFO]   Nearest: (26.0, 174.0)
[INFO]   Rounded: (62, 93)
[INFO]   Nearest: (62.0, 92.0)
[INFO]   Rounded: (70, 231)
[INFO]   Nearest: (70.0, 230.0)
[INFO]   Rounded: (33, 61)
[INFO]   Nearest: (34.0, 62.0)
[INFO]   Rounded: (108, 135)
[INFO]   Nearest: (108.0, 136.0)
[INFO]   Rounded: (89, 275)
[INFO]   Nearest: (90.0, 276.0)
[INFO]   Rounded: (27, 59)
[INFO]   Nearest: (28.0, 60.0)
[INFO]   Rounded: (124, 153)
[INFO]   Nearest: (124.0, 152.0)
[INFO]   Rounded: (76, 126)
[INFO]   Rounded: (194, 222)
[INFO]   Rounded: (86, 201)
[INFO]   Nearest: (86.0, 200.0)
[INFO]   Rounded: (28, 192)
[INFO]   Rounded: (55, 80)
[INFO]   Nearest: (54.0, 80.0)
[INFO]   Rounded: (166, 285)
[INFO]   Nearest: (166.0, 286.0)
[INFO]   Rounded: (156, 222)
[INFO]   Rounded: (229, 288)
[INFO]   Nearest: (228.0, 288.0)
[INFO]   Rounded: (256, 279)
[INFO]   Nearest: (256.0, 278.0)
[INFO]   Rounded: (49, 137)
[INFO]   Nearest: (50.0, 136.0)
[INFO]   Rounded: (122, 284)
[INFO]   Rounded: (79, 152)
[INFO]   Nearest: (78.0, 152.0)
[INFO]   Rounded: (120, 250)
[INFO]   Rounded: (31, 273)
[INFO]   Nearest: (32.0, 272.0)
[INFO]   Rounded: (134, 209)
[INFO]   Nearest: (134.0, 210.0)
[INFO]   Rounded: (197, 291)
[INFO]   Nearest: (196.0, 290.0)
[INFO]   Rounded: (215, 238)
[INFO]   Nearest: (216.0, 238.0)
[INFO]   Rounded: (67, 108)
[INFO]   Nearest: (68.0, 108.0)
[INFO]   Rounded: (29, 113)
[INFO]   Nearest: (28.0, 112.0)
[INFO]   Rounded: (32, 254)
[INFO]   Rounded: (124, 163)
[INFO]   Nearest: (124.0, 162.0)
[INFO]   Rounded: (146, 183)
[INFO]   Nearest: (146.0, 182.0)
[INFO]   Rounded: (20, 35)
[INFO]   Nearest: (20.0, 36.0)
[INFO]   Rounded: (24, 226)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 80
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(58/82) - Original Sharpe: 0.6991, Trades: 45
[INFO] Kmeans cluster 2: SMA(62/94) - Original Sharpe: 0.6693, Trades: 35
[INFO] Kmeans cluster 3: SMA(20/90) - Original Sharpe: 0.6528, Trades: 36
[INFO] Kmeans cluster 4: SMA(30/148) - Original Sharpe: 0.6266, Trades: 22
[INFO] Kmeans cluster 5: SMA(28/114) - Original Sharpe: 0.6050, Trades: 28
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/80)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (58/82) - Sharpe: 0.6991
[INFO] cluster 2: (62/94) - Sharpe: 0.6693
[INFO] cluster 3: (20/90) - Sharpe: 0.6528
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.086204           -2.286403
1    2021-11-14 2021-11-14            43     0.984700            0.771359
2    2022-01-14 2022-01-14            41    -0.851035           -0.000550
3    2022-03-14 2022-03-14            44     4.626773            4.626773
4    2022-05-14 2022-05-14            43     0.064197            0.064197
5    2022-07-14 2022-07-14            44     2.151092            1.491875
6    2022-09-14 2022-09-14            43     0.507963            2.330258
7    2022-11-14 2022-11-14            43    -2.397546           -3.533089
8    2023-01-14 2023-01-14            41    -0.385884           -3.462746
9    2023-03-14 2023-03-14            44    -1.291343           -2.387850
10   2023-05-14 2023-05-14            44     1.653847            2.185983
11   2023-07-14 2023-07-14            44     3.431170            3.431170
12   2023-09-14 2023-09-14            43     2.602377            2.602377
13   2023-11-14 2023-11-14            42    -4.883992           -4.875640
14   2024-01-14 2024-01-14            43    -1.084920           -1.137711
15   2024-03-14 2024-03-14            42     0.609020            1.781804
16   2024-05-14 2024-05-14            44    -1.255123           -1.738571
17   2024-07-14 2024-07-14            45     2.338417            3.495608
18   2024-09-14 2024-09-14            43    -3.629115           -4.013766
19   2024-11-14 2024-11-14            33     1.699993            1.876114
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |             -2.3 |         -0.2 | False         
[INFO] 2021-11-14   |          1.0 |              0.8 |         -0.2 | False         
[INFO] 2022-01-14   |         -0.9 |             -0.0 |          0.9 | True          
[INFO] 2022-03-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.2 |              1.5 |         -0.7 | False         
[INFO] 2022-09-14   |          0.5 |              2.3 |          1.8 | True          
[INFO] 2022-11-14   |         -2.4 |             -3.5 |         -1.1 | False         
[INFO] 2023-01-14   |         -0.4 |             -3.5 |         -3.1 | False         
[INFO] 2023-03-14   |         -1.3 |             -2.4 |         -1.1 | False         
[INFO] 2023-05-14   |          1.7 |              2.2 |          0.5 | True          
[INFO] 2023-07-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -4.9 |             -4.9 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-03-14   |          0.6 |              1.8 |          1.2 | True          
[INFO] 2024-05-14   |         -1.3 |             -1.7 |         -0.4 | False         
[INFO] 2024-07-14   |          2.3 |              3.5 |          1.2 | True          
[INFO] 2024-09-14   |         -3.6 |             -4.0 |         -0.4 | False         
[INFO] 2024-11-14   |          1.7 |              1.9 |          0.2 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 6 of 14 periods (42.86% win rate)
[INFO] Updating Excel file with Kmeans results for UB...
[INFO] Excel file updated successfully. Added UB with Kmeans win rate 42.9% in row 50
[INFO] Added best Sharpe parameters 62/80 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 80
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(58/82) - Original Sharpe: 0.6991
[INFO] Added cluster 2 to portfolio: SMA(62/94) - Original Sharpe: 0.6693
[INFO] Added cluster 3 to portfolio: SMA(20/90) - Original Sharpe: 0.6528
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'UB_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3017
[INFO] Kmeans Best out-of-sample Sharpe: 0.0897
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for UB...
[INFO] Excel file updated successfully. Added UB with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\UB
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5904 to 0.9525
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 80
[INFO] Sharpe Ratio: 0.952489
[INFO] Number of Trades: 45
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5904 to 0.9525
[INFO] Trades range: 11.0 to 334.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6592 to 3.0565
[INFO] Scaled Trades range: -0.6464 to 16.5656
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6383
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 415 elements
[INFO] Cluster 1: 396 elements
[INFO] Cluster 2: 399 elements
[INFO] Cluster 3: 293 elements
[INFO] Cluster 4: 412 elements
[INFO] Cluster 5: 137 elements
[INFO] Cluster 6: 116 elements
[INFO] Cluster 7: 41 elements
[INFO] Cluster 8: 261 elements
[INFO] Cluster 9: 143 elements
[INFO] Cluster 10: 405 elements
[INFO] Cluster 11: 249 elements
[INFO] Cluster 12: 428 elements
[INFO] Cluster 13: 488 elements
[INFO] Cluster 14: 246 elements
[INFO] Cluster 15: 282 elements
[INFO] Cluster 16: 34 elements
[INFO] Cluster 17: 289 elements
[INFO] Cluster 18: 73 elements
[INFO] Cluster 19: 214 elements
[INFO] Cluster 20: 321 elements
[INFO] Cluster 21: 503 elements
[INFO] Cluster 22: 320 elements
[INFO] Cluster 23: 218 elements
[INFO] Cluster 24: 334 elements
[INFO] Cluster 25: 6 elements
[INFO] Cluster 26: 223 elements
[INFO] Cluster 27: 326 elements
[INFO] Cluster 28: 334 elements
[INFO] Cluster 29: 154 elements
[INFO] Cluster 30: 45 elements
[INFO] Cluster 31: 19 elements
[INFO] Cluster 32: 26 elements
[INFO] Cluster 33: 172 elements
[INFO] Cluster 34: 79 elements
[INFO] Cluster 35: 45 elements
[INFO] Cluster 36: 146 elements
[INFO] Cluster 37: 283 elements
[INFO] Cluster 38: 261 elements
[INFO] Cluster 39: 134 elements
[INFO] Cluster 40: 46 elements
[INFO] Cluster 41: 101 elements
[INFO] Cluster 42: 122 elements
[INFO] Cluster 43: 75 elements
[INFO] Cluster 44: 163 elements
[INFO] Cluster 45: 111 elements
[INFO] Cluster 46: 155 elements
[INFO] Cluster 47: 207 elements
[INFO] Cluster 48: 145 elements
[INFO] Cluster 49: 190 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=54, Long SMA=90, Sharpe=0.6221, Trades=35
[INFO] Cluster 1 cluster: Short SMA=218, Long SMA=254, Sharpe=-0.3344, Trades=18
[INFO] Cluster 2 cluster: Short SMA=172, Long SMA=282, Sharpe=-0.1116, Trades=12
[INFO] Cluster 3 cluster: Short SMA=260, Long SMA=284, Sharpe=-0.1608, Trades=18
[INFO] Cluster 4 cluster: Short SMA=138, Long SMA=202, Sharpe=0.2826, Trades=15
[INFO] Cluster 5 cluster: Short SMA=260, Long SMA=264, Sharpe=-0.1723, Trades=36
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=52, Sharpe=0.5684, Trades=62
[INFO] Cluster 7 cluster: Short SMA=180, Long SMA=182, Sharpe=-0.0280, Trades=71
[INFO] Cluster 8 cluster: Short SMA=110, Long SMA=126, Sharpe=0.1162, Trades=35
[INFO] Cluster 9 cluster: Short SMA=154, Long SMA=172, Sharpe=0.3050, Trades=27
[INFO] Cluster 10 cluster: Short SMA=52, Long SMA=212, Sharpe=0.3250, Trades=14
[INFO] Cluster 11 cluster: Short SMA=28, Long SMA=112, Sharpe=0.6101, Trades=30
[INFO] Cluster 12 cluster: Short SMA=130, Long SMA=280, Sharpe=0.0035, Trades=11
[INFO] Cluster 13 cluster: Short SMA=100, Long SMA=194, Sharpe=0.3128, Trades=17
[INFO] Cluster 14 cluster: Short SMA=164, Long SMA=206, Sharpe=0.1354, Trades=17
[INFO] Cluster 15 cluster: Short SMA=24, Long SMA=190, Sharpe=0.4235, Trades=26
[INFO] Cluster 16 cluster: Short SMA=20, Long SMA=26, Sharpe=0.0816, Trades=146
[INFO] Cluster 17 cluster: Short SMA=36, Long SMA=148, Sharpe=0.5243, Trades=22
[INFO] Cluster 18 cluster: Short SMA=16, Long SMA=36, Sharpe=0.2355, Trades=94
[INFO] Cluster 19 cluster: Short SMA=22, Long SMA=74, Sharpe=0.5976, Trades=42
[INFO] Cluster 20 cluster: Short SMA=84, Long SMA=134, Sharpe=0.1365, Trades=22
[INFO] Cluster 21 cluster: Short SMA=78, Long SMA=238, Sharpe=0.1713, Trades=12
[INFO] Cluster 22 cluster: Short SMA=222, Long SMA=286, Sharpe=-0.1850, Trades=12
[INFO] Cluster 23 cluster: Short SMA=104, Long SMA=256, Sharpe=0.0049, Trades=11
[INFO] Cluster 24 cluster: Short SMA=192, Long SMA=222, Sharpe=-0.1266, Trades=18
[INFO] Cluster 26 cluster: Short SMA=58, Long SMA=290, Sharpe=-0.1202, Trades=14
[INFO] Cluster 27 cluster: Short SMA=68, Long SMA=176, Sharpe=0.0401, Trades=18
[INFO] Cluster 28 cluster: Short SMA=86, Long SMA=280, Sharpe=0.0288, Trades=12
[INFO] Cluster 29 cluster: Short SMA=124, Long SMA=156, Sharpe=-0.0575, Trades=23
[INFO] Cluster 30 cluster: Short SMA=86, Long SMA=96, Sharpe=0.1599, Trades=51
[INFO] Cluster 32 cluster: Short SMA=66, Long SMA=68, Sharpe=0.4564, Trades=122
[INFO] Cluster 33 cluster: Short SMA=54, Long SMA=120, Sharpe=0.3819, Trades=28
[INFO] Cluster 34 cluster: Short SMA=204, Long SMA=210, Sharpe=-0.0148, Trades=38
[INFO] Cluster 35 cluster: Short SMA=60, Long SMA=64, Sharpe=0.7061, Trades=88
[INFO] Cluster 36 cluster: Short SMA=18, Long SMA=260, Sharpe=0.1615, Trades=20
[INFO] Cluster 37 cluster: Short SMA=30, Long SMA=280, Sharpe=-0.0805, Trades=18
[INFO] Cluster 38 cluster: Short SMA=174, Long SMA=246, Sharpe=-0.1769, Trades=15
[INFO] Cluster 39 cluster: Short SMA=16, Long SMA=156, Sharpe=0.2735, Trades=32
[INFO] Cluster 40 cluster: Short SMA=114, Long SMA=118, Sharpe=-0.1891, Trades=63
[INFO] Cluster 41 cluster: Short SMA=48, Long SMA=64, Sharpe=0.6688, Trades=50
[INFO] Cluster 42 cluster: Short SMA=52, Long SMA=156, Sharpe=0.3992, Trades=20
[INFO] Cluster 43 cluster: Short SMA=194, Long SMA=296, Sharpe=-0.4664, Trades=14
[INFO] Cluster 44 cluster: Short SMA=20, Long SMA=226, Sharpe=0.3372, Trades=20
[INFO] Cluster 45 cluster: Short SMA=80, Long SMA=150, Sharpe=-0.0201, Trades=22
[INFO] Cluster 46 cluster: Short SMA=114, Long SMA=168, Sharpe=-0.0091, Trades=19
[INFO] Cluster 47 cluster: Short SMA=130, Long SMA=240, Sharpe=0.1815, Trades=15
[INFO] Cluster 48 cluster: Short SMA=150, Long SMA=244, Sharpe=-0.0066, Trades=13
[INFO] Cluster 49 cluster: Short SMA=44, Long SMA=252, Sharpe=0.2472, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=80, Sharpe=0.9525, Trades=45
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=60, Long SMA=64, Sharpe=0.7061, Trades=88
[INFO] Top 2: Short SMA=48, Long SMA=64, Sharpe=0.6688, Trades=50
[INFO] Top 3: Short SMA=54, Long SMA=90, Sharpe=0.6221, Trades=35
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10560 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 80
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(60/64) - Original Sharpe: 0.7061, Trades: 88
[INFO] Hierarchical cluster 2: SMA(48/64) - Original Sharpe: 0.6688, Trades: 50
[INFO] Hierarchical cluster 3: SMA(54/90) - Original Sharpe: 0.6221, Trades: 35
[INFO] Hierarchical cluster 4: SMA(28/112) - Original Sharpe: 0.6101, Trades: 30
[INFO] Hierarchical cluster 5: SMA(22/74) - Original Sharpe: 0.5976, Trades: 42
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/80)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (60/64) - Sharpe: 0.7061
[INFO] cluster 2: (48/64) - Sharpe: 0.6688
[INFO] cluster 3: (54/90) - Sharpe: 0.6221
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.086204           -2.074869
1    2021-11-14 2021-11-14            43     0.984700           -2.290956
2    2022-01-14 2022-01-14            41    -0.851035           -0.009415
3    2022-03-14 2022-03-14            44     4.626773            4.626773
4    2022-05-14 2022-05-14            43     0.064197            0.064197
5    2022-07-14 2022-07-14            44     2.151092            0.712755
6    2022-09-14 2022-09-14            43     0.507963            2.290963
7    2022-11-14 2022-11-14            43    -2.397546           -0.748217
8    2023-01-14 2023-01-14            41    -0.385884           -3.585391
9    2023-03-14 2023-03-14            44    -1.291343            0.800706
10   2023-05-14 2023-05-14            44     1.653847            0.048075
11   2023-07-14 2023-07-14            44     3.431170            3.431170
12   2023-09-14 2023-09-14            43     2.602377            2.602377
13   2023-11-14 2023-11-14            42    -4.883992           -6.150152
14   2024-01-14 2024-01-14            43    -1.084920           -1.296782
15   2024-03-14 2024-03-14            42     0.609020            1.791878
16   2024-05-14 2024-05-14            44    -1.255123           -0.844297
17   2024-07-14 2024-07-14            45     2.338417            2.976320
18   2024-09-14 2024-09-14            43    -3.629115           -3.427246
19   2024-11-14 2024-11-14            33     1.699993            1.699993
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |             -2.1 |          0.0 | Excluded      
[INFO] 2021-11-14   |          1.0 |             -2.3 |         -3.3 | False         
[INFO] 2022-01-14   |         -0.9 |             -0.0 |          0.9 | True          
[INFO] 2022-03-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.2 |              0.7 |         -1.5 | False         
[INFO] 2022-09-14   |          0.5 |              2.3 |          1.8 | True          
[INFO] 2022-11-14   |         -2.4 |             -0.7 |          1.7 | True          
[INFO] 2023-01-14   |         -0.4 |             -3.6 |         -3.2 | False         
[INFO] 2023-03-14   |         -1.3 |              0.8 |          2.1 | True          
[INFO] 2023-05-14   |          1.7 |              0.0 |         -1.7 | False         
[INFO] 2023-07-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -4.9 |             -6.2 |         -1.3 | False         
[INFO] 2024-01-14   |         -1.1 |             -1.3 |         -0.2 | False         
[INFO] 2024-03-14   |          0.6 |              1.8 |          1.2 | True          
[INFO] 2024-05-14   |         -1.3 |             -0.8 |          0.5 | True          
[INFO] 2024-07-14   |          2.3 |              3.0 |          0.7 | True          
[INFO] 2024-09-14   |         -3.6 |             -3.4 |          0.2 | True          
[INFO] 2024-11-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 14 periods (57.14% win rate)
[INFO] Updating Excel file with Hierarchical results for UB...
[INFO] Excel file updated successfully. Added UB with Hierarchical win rate 57.1% in row 50
[INFO] Added best Sharpe parameters 62/80 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 80
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(60/64) - Original Sharpe: 0.7061
[INFO] Added cluster 2 to portfolio: SMA(48/64) - Original Sharpe: 0.6688
[INFO] Added cluster 3 to portfolio: SMA(54/90) - Original Sharpe: 0.6221
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'UB_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1318
[INFO] Hierarchical Best out-of-sample Sharpe: 0.0897
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for UB...
[INFO] Excel file updated successfully. Added UB with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\UB
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for ULS in column D: 27.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 2
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 99.42s
[INFO] Best parameters: Short SMA = 166, Long SMA = 168
[INFO] Best Sharpe ratio: 1.113971, Trades: 62
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 1047 bad combos; keeping 1969 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172', 'SMA_SF_TOP5_192/194', 'SMA_SF_TOP5_186/204', 'SMA_SF_TOP5_190/196', 'SMA_SF_TOP5_186/206', 'SMA_SF_TOP5_184/206', 'SMA_SI_TOP5_48/50', 'SMA_SI_TOP5_42/58', 'SMA_SI_TOP5_44/56', 'SMA_SI_TOP5_40/60', 'SMA_SI_TOP5_234/258', 'SMA_SM_TOP5_70/74', 'SMA_SM_TOP5_12/20', 'SMA_SM_TOP5_14/22', 'SMA_SM_TOP5_66/78', 'SMA_SM_TOP5_14/24', 'SMA_TEN_TOP5_58/76', 'SMA_TEN_TOP5_60/76', 'SMA_TEN_TOP5_60/74', 'SMA_TEN_TOP5_40/44', 'SMA_TEN_TOP5_58/74', 'SMA_TY_TOP5_56/82', 'SMA_TY_TOP5_54/84', 'SMA_TY_TOP5_56/84', 'SMA_TY_TOP5_60/78', 'SMA_TY_TOP5_66/70', 'SMA_TU_TOP5_274/284', 'SMA_TU_TOP5_272/288', 'SMA_TU_TOP5_274/282', 'SMA_TU_TOP5_272/284', 'SMA_TU_TOP5_276/278', 'SMA_UB_TOP5_62/80', 'SMA_UB_TOP5_62/82', 'SMA_UB_TOP5_68/72', 'SMA_UB_TOP5_70/72', 'SMA_UB_TOP5_52/70', 'SMA_ULS_TOP5_166/168', 'SMA_ULS_TOP5_164/170', 'SMA_ULS_TOP5_180/214', 'SMA_ULS_TOP5_166/172', 'SMA_ULS_TOP5_10/30']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @ULS=116XC
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.30 contracts
[INFO] Maximum Position Size: 8 contracts
[INFO] Strategy Total P&L: $545,860.00
[INFO] Market Buy & Hold P&L: $27,400.00
[INFO] Outperformance: $518,460.00
[INFO] Sharpe ratio (entire period, annualized): 0.653386
[INFO] Sharpe ratio (in-sample, annualized): 1.113971
[INFO] Sharpe ratio (out-of-sample, annualized): -0.211071
[INFO] Maximum Drawdown: $292,053.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 31
[INFO] Out-of-sample period trades: 31
[INFO] Total trades: 62
[INFO] In-sample P&L: $606,384.00
[INFO] Out-of-sample P&L: $-60,524.00
[INFO] 
Best parameters from GA: Short SMA = 166, Long SMA = 168, Sharpe = 1.113971
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3504 to 1.1140
[INFO] 
Best parameters:
[INFO] Short SMA: 166
[INFO] Long SMA: 168
[INFO] Sharpe Ratio: 1.113971
[INFO] Number of Trades: 62
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9538 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3504 to 1.1140
[INFO] Trades range: 10.0 to 302.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3195 to 2.7315
[INFO] Scaled Long SMA range: -2.7051 to 1.5032
[INFO] Scaled Sharpe ratio range: -3.2164 to 2.3607
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 170 elements
[INFO] Kmeans Cluster 1: 154 elements
[INFO] Kmeans Cluster 2: 87 elements
[INFO] Kmeans Cluster 3: 290 elements
[INFO] Kmeans Cluster 4: 244 elements
[INFO] Kmeans Cluster 5: 145 elements
[INFO] Kmeans Cluster 6: 91 elements
[INFO] Kmeans Cluster 7: 169 elements
[INFO] Kmeans Cluster 8: 254 elements
[INFO] Kmeans Cluster 9: 225 elements
[INFO] Kmeans Cluster 10: 234 elements
[INFO] Kmeans Cluster 11: 183 elements
[INFO] Kmeans Cluster 12: 279 elements
[INFO] Kmeans Cluster 13: 237 elements
[INFO] Kmeans Cluster 14: 96 elements
[INFO] Kmeans Cluster 15: 112 elements
[INFO] Kmeans Cluster 16: 171 elements
[INFO] Kmeans Cluster 17: 195 elements
[INFO] Kmeans Cluster 18: 194 elements
[INFO] Kmeans Cluster 19: 264 elements
[INFO] Kmeans Cluster 20: 214 elements
[INFO] Kmeans Cluster 21: 192 elements
[INFO] Kmeans Cluster 22: 294 elements
[INFO] Kmeans Cluster 23: 249 elements
[INFO] Kmeans Cluster 24: 210 elements
[INFO] Kmeans Cluster 25: 90 elements
[INFO] Kmeans Cluster 26: 204 elements
[INFO] Kmeans Cluster 27: 177 elements
[INFO] Kmeans Cluster 28: 224 elements
[INFO] Kmeans Cluster 29: 179 elements
[INFO] Kmeans Cluster 30: 195 elements
[INFO] Kmeans Cluster 31: 238 elements
[INFO] Kmeans Cluster 32: 137 elements
[INFO] Kmeans Cluster 33: 185 elements
[INFO] Kmeans Cluster 34: 307 elements
[INFO] Kmeans Cluster 35: 164 elements
[INFO] Kmeans Cluster 36: 257 elements
[INFO] Kmeans Cluster 37: 183 elements
[INFO] Kmeans Cluster 38: 132 elements
[INFO] Kmeans Cluster 39: 282 elements
[INFO] Kmeans Cluster 40: 198 elements
[INFO] Kmeans Cluster 41: 127 elements
[INFO] Kmeans Cluster 42: 242 elements
[INFO] Kmeans Cluster 43: 150 elements
[INFO] Kmeans Cluster 44: 78 elements
[INFO] Kmeans Cluster 45: 195 elements
[INFO] Kmeans Cluster 46: 187 elements
[INFO] Kmeans Cluster 47: 127 elements
[INFO] Kmeans Cluster 48: 210 elements
[INFO] Kmeans Cluster 49: 117 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=112.05, Long SMA=143.52, Sharpe=-0.0746
[INFO] Centroid 1: Short SMA=102.84, Long SMA=204.53, Sharpe=0.7043
[INFO] Centroid 2: Short SMA=14.99, Long SMA=131.45, Sharpe=0.1825
[INFO] Centroid 3: Short SMA=155.30, Long SMA=245.09, Sharpe=0.7820
[INFO] Centroid 4: Short SMA=22.53, Long SMA=277.69, Sharpe=0.5435
[INFO] Centroid 5: Short SMA=259.68, Long SMA=284.19, Sharpe=0.4266
[INFO] Centroid 6: Short SMA=15.14, Long SMA=37.96, Sharpe=0.8510
[INFO] Centroid 7: Short SMA=24.65, Long SMA=229.05, Sharpe=0.4625
[INFO] Centroid 8: Short SMA=73.83, Long SMA=145.07, Sharpe=0.0770
[INFO] Centroid 9: Short SMA=221.08, Long SMA=239.62, Sharpe=0.6424
[INFO] Centroid 10: Short SMA=66.07, Long SMA=102.86, Sharpe=0.3059
[INFO] Centroid 11: Short SMA=40.28, Long SMA=193.23, Sharpe=0.4455
[INFO] Centroid 12: Short SMA=167.48, Long SMA=213.58, Sharpe=0.9223
[INFO] Centroid 13: Short SMA=46.60, Long SMA=286.67, Sharpe=0.4371
[INFO] Centroid 14: Short SMA=127.67, Long SMA=155.23, Sharpe=0.2757
[INFO] Centroid 15: Short SMA=278.91, Long SMA=293.43, Sharpe=0.1710
[INFO] Centroid 16: Short SMA=40.75, Long SMA=115.54, Sharpe=0.4966
[INFO] Centroid 17: Short SMA=177.70, Long SMA=279.10, Sharpe=0.7849
[INFO] Centroid 18: Short SMA=49.60, Long SMA=71.56, Sharpe=0.2070
[INFO] Centroid 19: Short SMA=64.73, Long SMA=161.70, Sharpe=0.2189
[INFO] Centroid 20: Short SMA=235.50, Long SMA=284.02, Sharpe=0.7438
[INFO] Centroid 21: Short SMA=121.27, Long SMA=151.48, Sharpe=0.0988
[INFO] Centroid 22: Short SMA=125.03, Long SMA=217.80, Sharpe=0.8017
[INFO] Centroid 23: Short SMA=29.49, Long SMA=154.95, Sharpe=0.4229
[INFO] Centroid 24: Short SMA=98.10, Long SMA=189.67, Sharpe=0.5647
[INFO] Centroid 25: Short SMA=79.36, Long SMA=256.71, Sharpe=0.6823
[INFO] Centroid 26: Short SMA=152.75, Long SMA=176.41, Sharpe=0.9097
[INFO] Centroid 27: Short SMA=83.07, Long SMA=114.93, Sharpe=-0.0104
[INFO] Centroid 28: Short SMA=203.20, Long SMA=273.71, Sharpe=0.7347
[INFO] Centroid 29: Short SMA=62.82, Long SMA=191.80, Sharpe=0.3086
[INFO] Centroid 30: Short SMA=24.06, Long SMA=116.61, Sharpe=0.3123
[INFO] Centroid 31: Short SMA=57.83, Long SMA=221.23, Sharpe=0.4073
[INFO] Centroid 32: Short SMA=98.19, Long SMA=119.91, Sharpe=0.1428
[INFO] Centroid 33: Short SMA=168.02, Long SMA=189.08, Sharpe=0.7136
[INFO] Centroid 34: Short SMA=35.60, Long SMA=83.50, Sharpe=0.3676
[INFO] Centroid 35: Short SMA=95.37, Long SMA=281.44, Sharpe=0.4290
[INFO] Centroid 36: Short SMA=195.53, Long SMA=223.55, Sharpe=0.7744
[INFO] Centroid 37: Short SMA=25.74, Long SMA=179.31, Sharpe=0.5506
[INFO] Centroid 38: Short SMA=20.27, Long SMA=49.62, Sharpe=0.6871
[INFO] Centroid 39: Short SMA=34.49, Long SMA=251.29, Sharpe=0.3595
[INFO] Centroid 40: Short SMA=190.36, Long SMA=251.07, Sharpe=0.8939
[INFO] Centroid 41: Short SMA=142.80, Long SMA=256.80, Sharpe=0.6429
[INFO] Centroid 42: Short SMA=236.96, Long SMA=268.11, Sharpe=0.5946
[INFO] Centroid 43: Short SMA=22.51, Long SMA=210.17, Sharpe=0.3444
[INFO] Centroid 44: Short SMA=85.67, Long SMA=113.26, Sharpe=-0.1825
[INFO] Centroid 45: Short SMA=65.90, Long SMA=257.47, Sharpe=0.5483
[INFO] Centroid 46: Short SMA=82.34, Long SMA=291.54, Sharpe=0.2919
[INFO] Centroid 47: Short SMA=90.96, Long SMA=180.27, Sharpe=0.4005
[INFO] Centroid 48: Short SMA=132.24, Long SMA=189.69, Sharpe=0.7825
[INFO] Centroid 49: Short SMA=29.01, Long SMA=49.26, Sharpe=0.5204
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=166, Long SMA=168, Sharpe=1.1140, Trades=62
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=168, Long SMA=214, Sharpe=0.9575, Trades=16
[INFO] Kmeans Top 2: Short SMA=190, Long SMA=250, Sharpe=0.9470, Trades=12
[INFO] Kmeans Top 3: Short SMA=124, Long SMA=218, Sharpe=0.8376, Trades=12
[INFO] Kmeans Top 4: Short SMA=196, Long SMA=224, Sharpe=0.8312, Trades=18
[INFO] Kmeans Top 5: Short SMA=152, Long SMA=176, Sharpe=0.8297, Trades=24
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (112, 144)
[INFO]   Rounded: (103, 205)
[INFO]   Nearest: (102.0, 204.0)
[INFO]   Rounded: (15, 131)
[INFO]   Nearest: (14.0, 132.0)
[INFO]   Rounded: (155, 245)
[INFO]   Nearest: (156.0, 246.0)
[INFO]   Rounded: (23, 278)
[INFO]   Nearest: (22.0, 278.0)
[INFO]   Rounded: (260, 284)
[INFO]   Rounded: (15, 38)
[INFO]   Nearest: (16.0, 38.0)
[INFO]   Rounded: (25, 229)
[INFO]   Nearest: (24.0, 230.0)
[INFO]   Rounded: (74, 145)
[INFO]   Nearest: (74.0, 146.0)
[INFO]   Rounded: (221, 240)
[INFO]   Nearest: (222.0, 240.0)
[INFO]   Rounded: (66, 103)
[INFO]   Nearest: (66.0, 102.0)
[INFO]   Rounded: (40, 193)
[INFO]   Nearest: (40.0, 194.0)
[INFO]   Rounded: (167, 214)
[INFO]   Nearest: (168.0, 214.0)
[INFO]   Rounded: (47, 287)
[INFO]   Nearest: (46.0, 286.0)
[INFO]   Rounded: (128, 155)
[INFO]   Nearest: (128.0, 156.0)
[INFO]   Rounded: (279, 293)
[INFO]   Nearest: (278.0, 294.0)
[INFO]   Rounded: (41, 116)
[INFO]   Nearest: (40.0, 116.0)
[INFO]   Rounded: (178, 279)
[INFO]   Nearest: (178.0, 280.0)
[INFO]   Rounded: (50, 72)
[INFO]   Rounded: (65, 162)
[INFO]   Nearest: (64.0, 162.0)
[INFO]   Rounded: (235, 284)
[INFO]   Nearest: (236.0, 284.0)
[INFO]   Rounded: (121, 151)
[INFO]   Nearest: (122.0, 152.0)
[INFO]   Rounded: (125, 218)
[INFO]   Nearest: (126.0, 218.0)
[INFO]   Rounded: (29, 155)
[INFO]   Nearest: (30.0, 154.0)
[INFO]   Rounded: (98, 190)
[INFO]   Rounded: (79, 257)
[INFO]   Nearest: (80.0, 256.0)
[INFO]   Rounded: (153, 176)
[INFO]   Nearest: (152.0, 176.0)
[INFO]   Rounded: (83, 115)
[INFO]   Nearest: (84.0, 114.0)
[INFO]   Rounded: (203, 274)
[INFO]   Nearest: (204.0, 274.0)
[INFO]   Rounded: (63, 192)
[INFO]   Nearest: (62.0, 192.0)
[INFO]   Rounded: (24, 117)
[INFO]   Nearest: (24.0, 116.0)
[INFO]   Rounded: (58, 221)
[INFO]   Nearest: (58.0, 222.0)
[INFO]   Rounded: (98, 120)
[INFO]   Rounded: (168, 189)
[INFO]   Nearest: (168.0, 190.0)
[INFO]   Rounded: (36, 84)
[INFO]   Rounded: (95, 281)
[INFO]   Nearest: (96.0, 282.0)
[INFO]   Rounded: (196, 224)
[INFO]   Rounded: (26, 179)
[INFO]   Nearest: (26.0, 180.0)
[INFO]   Rounded: (20, 50)
[INFO]   Rounded: (34, 251)
[INFO]   Nearest: (34.0, 252.0)
[INFO]   Rounded: (190, 251)
[INFO]   Nearest: (190.0, 252.0)
[INFO]   Rounded: (143, 257)
[INFO]   Nearest: (142.0, 256.0)
[INFO]   Rounded: (237, 268)
[INFO]   Nearest: (236.0, 268.0)
[INFO]   Rounded: (23, 210)
[INFO]   Nearest: (22.0, 210.0)
[INFO]   Rounded: (86, 113)
[INFO]   Nearest: (86.0, 114.0)
[INFO]   Rounded: (66, 257)
[INFO]   Nearest: (66.0, 258.0)
[INFO]   Rounded: (82, 292)
[INFO]   Rounded: (91, 180)
[INFO]   Nearest: (90.0, 180.0)
[INFO]   Rounded: (132, 190)
[INFO]   Rounded: (29, 49)
[INFO]   Nearest: (30.0, 50.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 166, Long SMA: 168
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 2
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(168/214) - Original Sharpe: 0.9575, Trades: 16
[INFO] Kmeans cluster 2: SMA(190/250) - Original Sharpe: 0.9470, Trades: 12
[INFO] Kmeans cluster 3: SMA(124/218) - Original Sharpe: 0.8376, Trades: 12
[INFO] Kmeans cluster 4: SMA(196/224) - Original Sharpe: 0.8312, Trades: 18
[INFO] Kmeans cluster 5: SMA(152/176) - Original Sharpe: 0.8297, Trades: 24
[INFO] Trimmed warm-up period. Evaluation data length: 2681
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (166/168)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (168/214) - Sharpe: 0.9575
[INFO] cluster 2: (190/250) - Sharpe: 0.9470
[INFO] cluster 3: (124/218) - Sharpe: 0.8376
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Out-of-sample period starts on: 2021-11-19
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-11-19 2021-11-19            43     1.280342            1.280342
1    2022-01-19 2022-01-19            43     2.581626            2.581626
2    2022-03-19 2022-03-19            42     0.329627            0.329627
3    2022-05-19 2022-05-19            43     1.402034            1.402034
4    2022-07-19 2022-07-19            44    -1.324002           -1.324002
5    2022-09-19 2022-09-19            45     1.312950            1.385705
6    2022-11-19 2022-11-19            41    -0.638271           -0.060679
7    2023-01-19 2023-01-19            42     3.607885           -0.973686
8    2023-03-19 2023-03-19            43     3.055470            1.617238
9    2023-05-19 2023-05-19            43    -2.250970           -2.086250
10   2023-07-19 2023-07-19            44    -5.185486           -4.566868
11   2023-09-19 2023-09-19            44    -2.773541           -0.234121
12   2023-11-19 2023-11-19            42     0.667456            0.667456
13   2024-01-19 2024-01-19            42     2.912396            2.912396
14   2024-03-19 2024-03-19            43    -2.656666           -2.872706
15   2024-05-19 2024-05-19            44    -6.949862            3.968680
16   2024-07-19 2024-07-19            44    -3.716464           -2.294350
17   2024-09-19 2024-09-19            43    -1.541732            0.053749
18   2024-11-19 2024-11-19            30    -1.144354           -1.144354
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-11-19   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-01-19   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2022-03-19   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-05-19   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-07-19   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2022-09-19   |          1.3 |              1.4 |          0.1 | True          
[INFO] 2022-11-19   |         -0.6 |             -0.1 |          0.5 | True          
[INFO] 2023-01-19   |          3.6 |             -1.0 |         -4.6 | False         
[INFO] 2023-03-19   |          3.1 |              1.6 |         -1.5 | False         
[INFO] 2023-05-19   |         -2.3 |             -2.1 |          0.2 | True          
[INFO] 2023-07-19   |         -5.2 |             -4.6 |          0.6 | True          
[INFO] 2023-09-19   |         -2.8 |             -0.2 |          2.6 | True          
[INFO] 2023-11-19   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-01-19   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-03-19   |         -2.7 |             -2.9 |         -0.2 | False         
[INFO] 2024-05-19   |         -6.9 |              4.0 |         10.9 | True          
[INFO] 2024-07-19   |         -3.7 |             -2.3 |          1.4 | True          
[INFO] 2024-09-19   |         -1.5 |              0.1 |          1.6 | True          
[INFO] 2024-11-19   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-19, 2022-01-19, 2022-03-19, 2022-05-19, 2022-07-19, 2023-11-19, 2024-01-19, 2024-11-19
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Kmeans cluster wins (rounded comparison): 8 of 11 periods (72.73% win rate)
[INFO] Updating Excel file with Kmeans results for ULS...
[INFO] Excel file updated successfully. Added ULS with Kmeans win rate 72.7% in row 51
[INFO] Added best Sharpe parameters 166/168 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 166, Long SMA: 168
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(168/214) - Original Sharpe: 0.9575
[INFO] Added cluster 2 to portfolio: SMA(190/250) - Original Sharpe: 0.9470
[INFO] Added cluster 3 to portfolio: SMA(124/218) - Original Sharpe: 0.8376
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ULS_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2501
[INFO] Kmeans Best out-of-sample Sharpe: -0.2111
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for ULS...
[INFO] Excel file updated successfully. Added ULS with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ULS
[INFO] Big Point Value: 100.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3504 to 1.1140
[INFO] 
Best parameters:
[INFO] Short SMA: 166
[INFO] Long SMA: 168
[INFO] Sharpe Ratio: 1.113971
[INFO] Number of Trades: 62
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9538 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3504 to 1.1140
[INFO] Trades range: 10.0 to 302.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3195 to 2.7315
[INFO] Scaled Long SMA range: -2.7051 to 1.5032
[INFO] Scaled Sharpe ratio range: -3.2164 to 2.3607
[INFO] Scaled Trades range: -0.7285 to 15.7469
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9538 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5728
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 318 elements
[INFO] Cluster 1: 249 elements
[INFO] Cluster 2: 343 elements
[INFO] Cluster 3: 211 elements
[INFO] Cluster 4: 498 elements
[INFO] Cluster 5: 415 elements
[INFO] Cluster 6: 241 elements
[INFO] Cluster 7: 387 elements
[INFO] Cluster 8: 53 elements
[INFO] Cluster 9: 306 elements
[INFO] Cluster 10: 202 elements
[INFO] Cluster 11: 232 elements
[INFO] Cluster 12: 42 elements
[INFO] Cluster 13: 241 elements
[INFO] Cluster 14: 138 elements
[INFO] Cluster 15: 321 elements
[INFO] Cluster 16: 23 elements
[INFO] Cluster 17: 50 elements
[INFO] Cluster 18: 269 elements
[INFO] Cluster 19: 77 elements
[INFO] Cluster 20: 280 elements
[INFO] Cluster 21: 304 elements
[INFO] Cluster 22: 309 elements
[INFO] Cluster 23: 9 elements
[INFO] Cluster 24: 56 elements
[INFO] Cluster 25: 148 elements
[INFO] Cluster 26: 36 elements
[INFO] Cluster 27: 343 elements
[INFO] Cluster 28: 101 elements
[INFO] Cluster 29: 98 elements
[INFO] Cluster 30: 224 elements
[INFO] Cluster 31: 185 elements
[INFO] Cluster 32: 108 elements
[INFO] Cluster 33: 302 elements
[INFO] Cluster 34: 152 elements
[INFO] Cluster 35: 105 elements
[INFO] Cluster 36: 285 elements
[INFO] Cluster 37: 189 elements
[INFO] Cluster 38: 217 elements
[INFO] Cluster 39: 262 elements
[INFO] Cluster 40: 95 elements
[INFO] Cluster 41: 199 elements
[INFO] Cluster 42: 14 elements
[INFO] Cluster 43: 192 elements
[INFO] Cluster 44: 27 elements
[INFO] Cluster 45: 28 elements
[INFO] Cluster 46: 361 elements
[INFO] Cluster 47: 100 elements
[INFO] Cluster 48: 44 elements
[INFO] Cluster 49: 149 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=74, Long SMA=268, Sharpe=0.5809, Trades=10
[INFO] Cluster 1 cluster: Short SMA=228, Long SMA=246, Sharpe=0.6497, Trades=24
[INFO] Cluster 2 cluster: Short SMA=34, Long SMA=84, Sharpe=0.2920, Trades=37
[INFO] Cluster 3 cluster: Short SMA=42, Long SMA=106, Sharpe=0.4826, Trades=26
[INFO] Cluster 4 cluster: Short SMA=202, Long SMA=278, Sharpe=0.7414, Trades=12
[INFO] Cluster 5 cluster: Short SMA=48, Long SMA=122, Sharpe=0.3982, Trades=22
[INFO] Cluster 6 cluster: Short SMA=90, Long SMA=120, Sharpe=0.0496, Trades=28
[INFO] Cluster 7 cluster: Short SMA=82, Long SMA=142, Sharpe=0.0739, Trades=22
[INFO] Cluster 8 cluster: Short SMA=274, Long SMA=282, Sharpe=0.2847, Trades=31
[INFO] Cluster 9 cluster: Short SMA=164, Long SMA=216, Sharpe=0.9442, Trades=16
[INFO] Cluster 10 cluster: Short SMA=24, Long SMA=268, Sharpe=0.4929, Trades=20
[INFO] Cluster 11 cluster: Short SMA=118, Long SMA=136, Sharpe=0.0518, Trades=38
[INFO] Cluster 12 cluster: Short SMA=22, Long SMA=28, Sharpe=0.8414, Trades=108
[INFO] Cluster 13 cluster: Short SMA=178, Long SMA=192, Sharpe=0.7727, Trades=26
[INFO] Cluster 14 cluster: Short SMA=116, Long SMA=166, Sharpe=0.2042, Trades=22
[INFO] Cluster 15 cluster: Short SMA=26, Long SMA=168, Sharpe=0.5328, Trades=20
[INFO] Cluster 16 cluster: Short SMA=30, Long SMA=32, Sharpe=0.5434, Trades=147
[INFO] Cluster 17 cluster: Short SMA=98, Long SMA=100, Sharpe=0.1218, Trades=96
[INFO] Cluster 18 cluster: Short SMA=52, Long SMA=220, Sharpe=0.4284, Trades=12
[INFO] Cluster 19 cluster: Short SMA=30, Long SMA=58, Sharpe=0.5378, Trades=51
[INFO] Cluster 20 cluster: Short SMA=92, Long SMA=192, Sharpe=0.6031, Trades=14
[INFO] Cluster 21 cluster: Short SMA=120, Long SMA=214, Sharpe=0.8114, Trades=12
[INFO] Cluster 22 cluster: Short SMA=132, Long SMA=194, Sharpe=0.8027, Trades=18
[INFO] Cluster 24 cluster: Short SMA=26, Long SMA=42, Sharpe=0.6581, Trades=69
[INFO] Cluster 25 cluster: Short SMA=254, Long SMA=286, Sharpe=0.5131, Trades=13
[INFO] Cluster 26 cluster: Short SMA=178, Long SMA=180, Sharpe=0.7296, Trades=60
[INFO] Cluster 27 cluster: Short SMA=22, Long SMA=228, Sharpe=0.3914, Trades=22
[INFO] Cluster 28 cluster: Short SMA=18, Long SMA=56, Sharpe=0.7115, Trades=53
[INFO] Cluster 29 cluster: Short SMA=152, Long SMA=264, Sharpe=0.6421, Trades=10
[INFO] Cluster 30 cluster: Short SMA=196, Long SMA=228, Sharpe=0.8475, Trades=18
[INFO] Cluster 31 cluster: Short SMA=148, Long SMA=178, Sharpe=0.9442, Trades=20
[INFO] Cluster 32 cluster: Short SMA=64, Long SMA=74, Sharpe=0.1179, Trades=59
[INFO] Cluster 33 cluster: Short SMA=68, Long SMA=164, Sharpe=0.1958, Trades=18
[INFO] Cluster 34 cluster: Short SMA=80, Long SMA=246, Sharpe=0.7275, Trades=10
[INFO] Cluster 35 cluster: Short SMA=14, Long SMA=134, Sharpe=0.1421, Trades=36
[INFO] Cluster 36 cluster: Short SMA=80, Long SMA=290, Sharpe=0.2271, Trades=12
[INFO] Cluster 37 cluster: Short SMA=190, Long SMA=252, Sharpe=0.9588, Trades=12
[INFO] Cluster 38 cluster: Short SMA=38, Long SMA=196, Sharpe=0.4953, Trades=14
[INFO] Cluster 39 cluster: Short SMA=38, Long SMA=288, Sharpe=0.4570, Trades=12
[INFO] Cluster 40 cluster: Short SMA=276, Long SMA=294, Sharpe=0.1517, Trades=17
[INFO] Cluster 41 cluster: Short SMA=242, Long SMA=276, Sharpe=0.6812, Trades=15
[INFO] Cluster 43 cluster: Short SMA=62, Long SMA=186, Sharpe=0.2968, Trades=14
[INFO] Cluster 44 cluster: Short SMA=126, Long SMA=130, Sharpe=0.3121, Trades=64
[INFO] Cluster 45 cluster: Short SMA=244, Long SMA=246, Sharpe=0.5135, Trades=60
[INFO] Cluster 46 cluster: Short SMA=158, Long SMA=250, Sharpe=0.7837, Trades=12
[INFO] Cluster 47 cluster: Short SMA=52, Long SMA=72, Sharpe=0.3587, Trades=48
[INFO] Cluster 48 cluster: Short SMA=16, Long SMA=34, Sharpe=0.7668, Trades=81
[INFO] Cluster 49 cluster: Short SMA=44, Long SMA=252, Sharpe=0.3863, Trades=16
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=166, Long SMA=168, Sharpe=1.1140, Trades=62
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=190, Long SMA=252, Sharpe=0.9588, Trades=12
[INFO] Top 2: Short SMA=148, Long SMA=178, Sharpe=0.9442, Trades=20
[INFO] Top 3: Short SMA=164, Long SMA=216, Sharpe=0.9442, Trades=16
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 9515 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 166, Long SMA: 168
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 2
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(190/252) - Original Sharpe: 0.9588, Trades: 12
[INFO] Hierarchical cluster 2: SMA(148/178) - Original Sharpe: 0.9442, Trades: 20
[INFO] Hierarchical cluster 3: SMA(164/216) - Original Sharpe: 0.9442, Trades: 16
[INFO] Hierarchical cluster 4: SMA(196/228) - Original Sharpe: 0.8475, Trades: 18
[INFO] Hierarchical cluster 5: SMA(22/28) - Original Sharpe: 0.8414, Trades: 108
[INFO] Trimmed warm-up period. Evaluation data length: 2681
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (166/168)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (190/252) - Sharpe: 0.9588
[INFO] cluster 2: (148/178) - Sharpe: 0.9442
[INFO] cluster 3: (164/216) - Sharpe: 0.9442
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Out-of-sample period starts on: 2021-11-19
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-11-19 2021-11-19            43     1.280342            1.280342
1    2022-01-19 2022-01-19            43     2.581626            2.581626
2    2022-03-19 2022-03-19            42     0.329627            0.329627
3    2022-05-19 2022-05-19            43     1.402034            1.402034
4    2022-07-19 2022-07-19            44    -1.324002           -1.324002
5    2022-09-19 2022-09-19            45     1.312950            1.385705
6    2022-11-19 2022-11-19            41    -0.638271           -0.566612
7    2023-01-19 2023-01-19            42     3.607885           -2.420138
8    2023-03-19 2023-03-19            43     3.055470            1.709660
9    2023-05-19 2023-05-19            43    -2.250970           -2.086250
10   2023-07-19 2023-07-19            44    -5.185486           -4.566868
11   2023-09-19 2023-09-19            44    -2.773541           -0.116589
12   2023-11-19 2023-11-19            42     0.667456            0.667456
13   2024-01-19 2024-01-19            42     2.912396            2.912396
14   2024-03-19 2024-03-19            43    -2.656666           -1.832001
15   2024-05-19 2024-05-19            44    -6.949862            1.139049
16   2024-07-19 2024-07-19            44    -3.716464           -3.437992
17   2024-09-19 2024-09-19            43    -1.541732            0.117452
18   2024-11-19 2024-11-19            30    -1.144354           -1.144354
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-11-19   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-01-19   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2022-03-19   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-05-19   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-07-19   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2022-09-19   |          1.3 |              1.4 |          0.1 | True          
[INFO] 2022-11-19   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2023-01-19   |          3.6 |             -2.4 |         -6.0 | False         
[INFO] 2023-03-19   |          3.1 |              1.7 |         -1.4 | False         
[INFO] 2023-05-19   |         -2.3 |             -2.1 |          0.2 | True          
[INFO] 2023-07-19   |         -5.2 |             -4.6 |          0.6 | True          
[INFO] 2023-09-19   |         -2.8 |             -0.1 |          2.7 | True          
[INFO] 2023-11-19   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-01-19   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-03-19   |         -2.7 |             -1.8 |          0.9 | True          
[INFO] 2024-05-19   |         -6.9 |              1.1 |          8.0 | True          
[INFO] 2024-07-19   |         -3.7 |             -3.4 |          0.3 | True          
[INFO] 2024-09-19   |         -1.5 |              0.1 |          1.6 | True          
[INFO] 2024-11-19   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-19, 2022-01-19, 2022-03-19, 2022-05-19, 2022-07-19, 2022-11-19, 2023-11-19, 2024-01-19, 2024-11-19
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 10 periods (80.00% win rate)
[INFO] Updating Excel file with Hierarchical results for ULS...
[INFO] Excel file updated successfully. Added ULS with Hierarchical win rate 80.0% in row 51
[INFO] Added best Sharpe parameters 166/168 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 166, Long SMA: 168
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(190/252) - Original Sharpe: 0.9588
[INFO] Added cluster 2 to portfolio: SMA(148/178) - Original Sharpe: 0.9442
[INFO] Added cluster 3 to portfolio: SMA(164/216) - Original Sharpe: 0.9442
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ULS_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2511
[INFO] Hierarchical Best out-of-sample Sharpe: -0.2111
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for ULS...
[INFO] Excel file updated successfully. Added ULS with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ULS
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for US in column D: 34.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 98.19s
[INFO] Best parameters: Short SMA = 62, Long SMA = 94
[INFO] Best Sharpe ratio: 1.040882, Trades: 39
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172', 'SMA_SF_TOP5_192/194', 'SMA_SF_TOP5_186/204', 'SMA_SF_TOP5_190/196', 'SMA_SF_TOP5_186/206', 'SMA_SF_TOP5_184/206', 'SMA_SI_TOP5_48/50', 'SMA_SI_TOP5_42/58', 'SMA_SI_TOP5_44/56', 'SMA_SI_TOP5_40/60', 'SMA_SI_TOP5_234/258', 'SMA_SM_TOP5_70/74', 'SMA_SM_TOP5_12/20', 'SMA_SM_TOP5_14/22', 'SMA_SM_TOP5_66/78', 'SMA_SM_TOP5_14/24', 'SMA_TEN_TOP5_58/76', 'SMA_TEN_TOP5_60/76', 'SMA_TEN_TOP5_60/74', 'SMA_TEN_TOP5_40/44', 'SMA_TEN_TOP5_58/74', 'SMA_TY_TOP5_56/82', 'SMA_TY_TOP5_54/84', 'SMA_TY_TOP5_56/84', 'SMA_TY_TOP5_60/78', 'SMA_TY_TOP5_66/70', 'SMA_TU_TOP5_274/284', 'SMA_TU_TOP5_272/288', 'SMA_TU_TOP5_274/282', 'SMA_TU_TOP5_272/284', 'SMA_TU_TOP5_276/278', 'SMA_UB_TOP5_62/80', 'SMA_UB_TOP5_62/82', 'SMA_UB_TOP5_68/72', 'SMA_UB_TOP5_70/72', 'SMA_UB_TOP5_52/70', 'SMA_ULS_TOP5_166/168', 'SMA_ULS_TOP5_164/170', 'SMA_ULS_TOP5_180/214', 'SMA_ULS_TOP5_166/172', 'SMA_ULS_TOP5_10/30', 'SMA_US_TOP5_62/94', 'SMA_US_TOP5_58/92', 'SMA_US_TOP5_50/54', 'SMA_US_TOP5_62/96', 'SMA_US_TOP5_58/94']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @US
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.13 contracts
[INFO] Maximum Position Size: 9 contracts
[INFO] Strategy Total P&L: $514,847.25
[INFO] Market Buy & Hold P&L: $2,093.75
[INFO] Outperformance: $512,753.50
[INFO] Sharpe ratio (entire period, annualized): 0.785212
[INFO] Sharpe ratio (in-sample, annualized): 1.040882
[INFO] Sharpe ratio (out-of-sample, annualized): 0.193643
[INFO] Maximum Drawdown: $114,216.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 26
[INFO] Out-of-sample period trades: 13
[INFO] Total trades: 39
[INFO] In-sample P&L: $581,161.00
[INFO] Out-of-sample P&L: $46,701.75
[INFO] 
Best parameters from GA: Short SMA = 62, Long SMA = 94, Sharpe = 1.040882
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4882 to 1.0409
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 94
[INFO] Sharpe Ratio: 1.040882
[INFO] Number of Trades: 39
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4882 to 1.0409
[INFO] Trades range: 11.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.5262 to 3.2566
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 191 elements
[INFO] Kmeans Cluster 1: 208 elements
[INFO] Kmeans Cluster 2: 314 elements
[INFO] Kmeans Cluster 3: 287 elements
[INFO] Kmeans Cluster 4: 209 elements
[INFO] Kmeans Cluster 5: 205 elements
[INFO] Kmeans Cluster 6: 191 elements
[INFO] Kmeans Cluster 7: 296 elements
[INFO] Kmeans Cluster 8: 258 elements
[INFO] Kmeans Cluster 9: 130 elements
[INFO] Kmeans Cluster 10: 140 elements
[INFO] Kmeans Cluster 11: 206 elements
[INFO] Kmeans Cluster 12: 295 elements
[INFO] Kmeans Cluster 13: 65 elements
[INFO] Kmeans Cluster 14: 315 elements
[INFO] Kmeans Cluster 15: 179 elements
[INFO] Kmeans Cluster 16: 212 elements
[INFO] Kmeans Cluster 17: 149 elements
[INFO] Kmeans Cluster 18: 275 elements
[INFO] Kmeans Cluster 19: 244 elements
[INFO] Kmeans Cluster 20: 197 elements
[INFO] Kmeans Cluster 21: 276 elements
[INFO] Kmeans Cluster 22: 318 elements
[INFO] Kmeans Cluster 23: 110 elements
[INFO] Kmeans Cluster 24: 101 elements
[INFO] Kmeans Cluster 25: 291 elements
[INFO] Kmeans Cluster 26: 209 elements
[INFO] Kmeans Cluster 27: 202 elements
[INFO] Kmeans Cluster 28: 200 elements
[INFO] Kmeans Cluster 29: 197 elements
[INFO] Kmeans Cluster 30: 161 elements
[INFO] Kmeans Cluster 31: 267 elements
[INFO] Kmeans Cluster 32: 212 elements
[INFO] Kmeans Cluster 33: 62 elements
[INFO] Kmeans Cluster 34: 241 elements
[INFO] Kmeans Cluster 35: 179 elements
[INFO] Kmeans Cluster 36: 211 elements
[INFO] Kmeans Cluster 37: 248 elements
[INFO] Kmeans Cluster 38: 208 elements
[INFO] Kmeans Cluster 39: 263 elements
[INFO] Kmeans Cluster 40: 305 elements
[INFO] Kmeans Cluster 41: 128 elements
[INFO] Kmeans Cluster 42: 336 elements
[INFO] Kmeans Cluster 43: 276 elements
[INFO] Kmeans Cluster 44: 109 elements
[INFO] Kmeans Cluster 45: 248 elements
[INFO] Kmeans Cluster 46: 189 elements
[INFO] Kmeans Cluster 47: 176 elements
[INFO] Kmeans Cluster 48: 185 elements
[INFO] Kmeans Cluster 49: 111 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=22.03, Long SMA=118.85, Sharpe=0.5772
[INFO] Centroid 1: Short SMA=149.13, Long SMA=237.15, Sharpe=0.1165
[INFO] Centroid 2: Short SMA=29.90, Long SMA=283.61, Sharpe=0.1041
[INFO] Centroid 3: Short SMA=207.53, Long SMA=287.25, Sharpe=-0.2531
[INFO] Centroid 4: Short SMA=72.56, Long SMA=165.71, Sharpe=0.1072
[INFO] Centroid 5: Short SMA=30.16, Long SMA=160.94, Sharpe=0.5354
[INFO] Centroid 6: Short SMA=134.98, Long SMA=288.21, Sharpe=-0.0517
[INFO] Centroid 7: Short SMA=26.84, Long SMA=63.81, Sharpe=0.5718
[INFO] Centroid 8: Short SMA=120.56, Long SMA=182.43, Sharpe=0.2149
[INFO] Centroid 9: Short SMA=52.28, Long SMA=80.57, Sharpe=0.8701
[INFO] Centroid 10: Short SMA=128.04, Long SMA=148.66, Sharpe=-0.1177
[INFO] Centroid 11: Short SMA=91.83, Long SMA=194.67, Sharpe=0.3630
[INFO] Centroid 12: Short SMA=177.16, Long SMA=241.79, Sharpe=0.0075
[INFO] Centroid 13: Short SMA=19.63, Long SMA=31.17, Sharpe=0.1575
[INFO] Centroid 14: Short SMA=65.85, Long SMA=284.39, Sharpe=-0.0146
[INFO] Centroid 15: Short SMA=261.77, Long SMA=280.22, Sharpe=-0.1129
[INFO] Centroid 16: Short SMA=60.51, Long SMA=245.15, Sharpe=0.1781
[INFO] Centroid 17: Short SMA=68.40, Long SMA=96.15, Sharpe=0.5753
[INFO] Centroid 18: Short SMA=158.47, Long SMA=191.11, Sharpe=0.2762
[INFO] Centroid 19: Short SMA=24.75, Long SMA=197.48, Sharpe=0.4939
[INFO] Centroid 20: Short SMA=66.49, Long SMA=180.91, Sharpe=0.2488
[INFO] Centroid 21: Short SMA=88.10, Long SMA=259.65, Sharpe=0.0206
[INFO] Centroid 22: Short SMA=54.99, Long SMA=213.67, Sharpe=0.2943
[INFO] Centroid 23: Short SMA=157.00, Long SMA=172.51, Sharpe=0.4524
[INFO] Centroid 24: Short SMA=96.24, Long SMA=114.22, Sharpe=-0.0584
[INFO] Centroid 25: Short SMA=165.73, Long SMA=283.48, Sharpe=-0.1229
[INFO] Centroid 26: Short SMA=56.06, Long SMA=84.17, Sharpe=0.7376
[INFO] Centroid 27: Short SMA=124.56, Long SMA=156.40, Sharpe=0.0340
[INFO] Centroid 28: Short SMA=23.76, Long SMA=96.97, Sharpe=0.7091
[INFO] Centroid 29: Short SMA=27.46, Long SMA=167.66, Sharpe=0.3913
[INFO] Centroid 30: Short SMA=62.86, Long SMA=122.48, Sharpe=0.3879
[INFO] Centroid 31: Short SMA=105.27, Long SMA=284.37, Sharpe=0.0740
[INFO] Centroid 32: Short SMA=28.04, Long SMA=227.44, Sharpe=0.3588
[INFO] Centroid 33: Short SMA=283.35, Long SMA=292.52, Sharpe=-0.3697
[INFO] Centroid 34: Short SMA=175.20, Long SMA=204.49, Sharpe=0.1406
[INFO] Centroid 35: Short SMA=226.59, Long SMA=255.74, Sharpe=-0.1733
[INFO] Centroid 36: Short SMA=98.69, Long SMA=126.43, Sharpe=0.0946
[INFO] Centroid 37: Short SMA=43.97, Long SMA=134.54, Sharpe=0.4673
[INFO] Centroid 38: Short SMA=247.40, Long SMA=289.11, Sharpe=-0.2584
[INFO] Centroid 39: Short SMA=115.09, Long SMA=244.97, Sharpe=0.1083
[INFO] Centroid 40: Short SMA=128.64, Long SMA=215.15, Sharpe=0.2052
[INFO] Centroid 41: Short SMA=239.02, Long SMA=261.42, Sharpe=-0.3174
[INFO] Centroid 42: Short SMA=206.31, Long SMA=229.71, Sharpe=0.0400
[INFO] Centroid 43: Short SMA=26.09, Long SMA=253.89, Sharpe=0.2169
[INFO] Centroid 44: Short SMA=24.99, Long SMA=40.79, Sharpe=0.3886
[INFO] Centroid 45: Short SMA=89.77, Long SMA=223.21, Sharpe=0.2352
[INFO] Centroid 46: Short SMA=90.88, Long SMA=152.51, Sharpe=-0.0642
[INFO] Centroid 47: Short SMA=142.56, Long SMA=262.90, Sharpe=0.0160
[INFO] Centroid 48: Short SMA=193.63, Long SMA=266.23, Sharpe=-0.0802
[INFO] Centroid 49: Short SMA=86.38, Long SMA=122.68, Sharpe=0.2311
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=94, Sharpe=1.0409, Trades=39
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=54, Long SMA=82, Sharpe=0.9260, Trades=37
[INFO] Kmeans Top 2: Short SMA=58, Long SMA=86, Sharpe=0.7204, Trades=39
[INFO] Kmeans Top 3: Short SMA=26, Long SMA=98, Sharpe=0.6971, Trades=34
[INFO] Kmeans Top 4: Short SMA=32, Long SMA=160, Sharpe=0.6126, Trades=20
[INFO] Kmeans Top 5: Short SMA=22, Long SMA=120, Sharpe=0.6112, Trades=32
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (22, 119)
[INFO]   Nearest: (22.0, 118.0)
[INFO]   Rounded: (149, 237)
[INFO]   Nearest: (150.0, 238.0)
[INFO]   Rounded: (30, 284)
[INFO]   Rounded: (208, 287)
[INFO]   Nearest: (208.0, 288.0)
[INFO]   Rounded: (73, 166)
[INFO]   Nearest: (72.0, 166.0)
[INFO]   Rounded: (30, 161)
[INFO]   Nearest: (30.0, 160.0)
[INFO]   Rounded: (135, 288)
[INFO]   Nearest: (134.0, 288.0)
[INFO]   Rounded: (27, 64)
[INFO]   Nearest: (26.0, 64.0)
[INFO]   Rounded: (121, 182)
[INFO]   Nearest: (120.0, 182.0)
[INFO]   Rounded: (52, 81)
[INFO]   Nearest: (52.0, 80.0)
[INFO]   Rounded: (128, 149)
[INFO]   Nearest: (128.0, 148.0)
[INFO]   Rounded: (92, 195)
[INFO]   Nearest: (92.0, 194.0)
[INFO]   Rounded: (177, 242)
[INFO]   Nearest: (178.0, 242.0)
[INFO]   Rounded: (20, 31)
[INFO]   Nearest: (20.0, 32.0)
[INFO]   Rounded: (66, 284)
[INFO]   Rounded: (262, 280)
[INFO]   Rounded: (61, 245)
[INFO]   Nearest: (60.0, 246.0)
[INFO]   Rounded: (68, 96)
[INFO]   Rounded: (158, 191)
[INFO]   Nearest: (158.0, 192.0)
[INFO]   Rounded: (25, 197)
[INFO]   Nearest: (24.0, 198.0)
[INFO]   Rounded: (66, 181)
[INFO]   Nearest: (66.0, 180.0)
[INFO]   Rounded: (88, 260)
[INFO]   Rounded: (55, 214)
[INFO]   Nearest: (54.0, 214.0)
[INFO]   Rounded: (157, 173)
[INFO]   Nearest: (158.0, 172.0)
[INFO]   Rounded: (96, 114)
[INFO]   Rounded: (166, 283)
[INFO]   Nearest: (166.0, 284.0)
[INFO]   Rounded: (56, 84)
[INFO]   Rounded: (125, 156)
[INFO]   Nearest: (124.0, 156.0)
[INFO]   Rounded: (24, 97)
[INFO]   Nearest: (24.0, 96.0)
[INFO]   Rounded: (27, 168)
[INFO]   Nearest: (28.0, 168.0)
[INFO]   Rounded: (63, 122)
[INFO]   Nearest: (62.0, 122.0)
[INFO]   Rounded: (105, 284)
[INFO]   Nearest: (106.0, 284.0)
[INFO]   Rounded: (28, 227)
[INFO]   Nearest: (28.0, 228.0)
[INFO]   Rounded: (283, 293)
[INFO]   Nearest: (284.0, 292.0)
[INFO]   Rounded: (175, 204)
[INFO]   Nearest: (176.0, 204.0)
[INFO]   Rounded: (227, 256)
[INFO]   Nearest: (226.0, 256.0)
[INFO]   Rounded: (99, 126)
[INFO]   Nearest: (98.0, 126.0)
[INFO]   Rounded: (44, 135)
[INFO]   Nearest: (44.0, 134.0)
[INFO]   Rounded: (247, 289)
[INFO]   Nearest: (248.0, 290.0)
[INFO]   Rounded: (115, 245)
[INFO]   Nearest: (116.0, 244.0)
[INFO]   Rounded: (129, 215)
[INFO]   Nearest: (128.0, 216.0)
[INFO]   Rounded: (239, 261)
[INFO]   Nearest: (240.0, 262.0)
[INFO]   Rounded: (206, 230)
[INFO]   Rounded: (26, 254)
[INFO]   Rounded: (25, 41)
[INFO]   Nearest: (24.0, 40.0)
[INFO]   Rounded: (90, 223)
[INFO]   Nearest: (90.0, 224.0)
[INFO]   Rounded: (91, 153)
[INFO]   Nearest: (90.0, 152.0)
[INFO]   Rounded: (143, 263)
[INFO]   Nearest: (142.0, 262.0)
[INFO]   Rounded: (194, 266)
[INFO]   Rounded: (86, 123)
[INFO]   Nearest: (86.0, 122.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 94
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(54/82) - Original Sharpe: 0.9260, Trades: 37
[INFO] Kmeans cluster 2: SMA(58/86) - Original Sharpe: 0.7204, Trades: 39
[INFO] Kmeans cluster 3: SMA(26/98) - Original Sharpe: 0.6971, Trades: 34
[INFO] Kmeans cluster 4: SMA(32/160) - Original Sharpe: 0.6126, Trades: 20
[INFO] Kmeans cluster 5: SMA(22/120) - Original Sharpe: 0.6112, Trades: 32
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/94)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (54/82) - Sharpe: 0.9260
[INFO] cluster 2: (58/86) - Sharpe: 0.7204
[INFO] cluster 3: (26/98) - Sharpe: 0.6971
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.475522           -3.072994
1    2021-11-14 2021-11-14            43     1.219983           -2.302795
2    2022-01-14 2022-01-14            41    -0.358176           -0.016393
3    2022-03-14 2022-03-14            44     4.804528            4.804528
4    2022-05-14 2022-05-14            43    -0.181247           -0.181247
5    2022-07-14 2022-07-14            44     1.120787           -3.361824
6    2022-09-14 2022-09-14            43    -1.028981            0.449134
7    2022-11-14 2022-11-14            43    -2.298651           -1.801660
8    2023-01-14 2023-01-14            41    -0.223635           -3.943357
9    2023-03-14 2023-03-14            44     0.355798           -1.015931
10   2023-05-14 2023-05-14            44     1.277535           -1.136861
11   2023-07-14 2023-07-14            44     3.299199            3.299199
12   2023-09-14 2023-09-14            43     2.565820            2.565820
13   2023-11-14 2023-11-14            42    -2.979453           -4.866696
14   2024-01-14 2024-01-14            43    -1.306968           -1.306968
15   2024-03-14 2024-03-14            42     0.596356            0.555469
16   2024-05-14 2024-05-14            44    -1.478112           -1.269939
17   2024-07-14 2024-07-14            45     3.789391            3.131795
18   2024-09-14 2024-09-14            43    -5.219166           -5.193163
19   2024-11-14 2024-11-14            33     2.330861            1.824419
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.5 |             -3.1 |         -1.6 | False         
[INFO] 2021-11-14   |          1.2 |             -2.3 |         -3.5 | False         
[INFO] 2022-01-14   |         -0.4 |             -0.0 |          0.4 | True          
[INFO] 2022-03-14   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |             -3.4 |         -4.5 | False         
[INFO] 2022-09-14   |         -1.0 |              0.4 |          1.4 | True          
[INFO] 2022-11-14   |         -2.3 |             -1.8 |          0.5 | True          
[INFO] 2023-01-14   |         -0.2 |             -3.9 |         -3.7 | False         
[INFO] 2023-03-14   |          0.4 |             -1.0 |         -1.4 | False         
[INFO] 2023-05-14   |          1.3 |             -1.1 |         -2.4 | False         
[INFO] 2023-07-14   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.0 |             -4.9 |         -1.9 | False         
[INFO] 2024-01-14   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2024-03-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -1.5 |             -1.3 |          0.2 | True          
[INFO] 2024-07-14   |          3.8 |              3.1 |         -0.7 | False         
[INFO] 2024-09-14   |         -5.2 |             -5.2 |          0.0 | Excluded      
[INFO] 2024-11-14   |          2.3 |              1.8 |         -0.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14, 2024-01-14, 2024-03-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 4 of 13 periods (30.77% win rate)
[INFO] Updating Excel file with Kmeans results for US...
[INFO] Excel file updated successfully. Added US with Kmeans win rate 30.8% in row 52
[INFO] Added best Sharpe parameters 62/94 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 94
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(54/82) - Original Sharpe: 0.9260
[INFO] Added cluster 2 to portfolio: SMA(58/86) - Original Sharpe: 0.7204
[INFO] Added cluster 3 to portfolio: SMA(26/98) - Original Sharpe: 0.6971
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'US_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.4398
[INFO] Kmeans Best out-of-sample Sharpe: 0.1936
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for US...
[INFO] Excel file updated successfully. Added US with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\US
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4882 to 1.0409
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 94
[INFO] Sharpe Ratio: 1.040882
[INFO] Number of Trades: 39
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4882 to 1.0409
[INFO] Trades range: 11.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.5262 to 3.2566
[INFO] Scaled Trades range: -0.6643 to 16.8688
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6209
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 325 elements
[INFO] Cluster 1: 446 elements
[INFO] Cluster 2: 358 elements
[INFO] Cluster 3: 159 elements
[INFO] Cluster 4: 321 elements
[INFO] Cluster 5: 298 elements
[INFO] Cluster 6: 33 elements
[INFO] Cluster 7: 427 elements
[INFO] Cluster 8: 336 elements
[INFO] Cluster 9: 302 elements
[INFO] Cluster 10: 497 elements
[INFO] Cluster 11: 327 elements
[INFO] Cluster 12: 459 elements
[INFO] Cluster 13: 389 elements
[INFO] Cluster 14: 311 elements
[INFO] Cluster 15: 52 elements
[INFO] Cluster 16: 130 elements
[INFO] Cluster 17: 356 elements
[INFO] Cluster 18: 194 elements
[INFO] Cluster 19: 510 elements
[INFO] Cluster 20: 97 elements
[INFO] Cluster 21: 7 elements
[INFO] Cluster 22: 270 elements
[INFO] Cluster 23: 152 elements
[INFO] Cluster 24: 242 elements
[INFO] Cluster 25: 205 elements
[INFO] Cluster 26: 54 elements
[INFO] Cluster 27: 388 elements
[INFO] Cluster 28: 56 elements
[INFO] Cluster 29: 97 elements
[INFO] Cluster 30: 38 elements
[INFO] Cluster 31: 279 elements
[INFO] Cluster 32: 162 elements
[INFO] Cluster 33: 211 elements
[INFO] Cluster 34: 58 elements
[INFO] Cluster 35: 205 elements
[INFO] Cluster 36: 188 elements
[INFO] Cluster 37: 157 elements
[INFO] Cluster 38: 21 elements
[INFO] Cluster 39: 259 elements
[INFO] Cluster 40: 6 elements
[INFO] Cluster 41: 180 elements
[INFO] Cluster 42: 213 elements
[INFO] Cluster 43: 29 elements
[INFO] Cluster 44: 47 elements
[INFO] Cluster 45: 191 elements
[INFO] Cluster 46: 213 elements
[INFO] Cluster 47: 134 elements
[INFO] Cluster 48: 55 elements
[INFO] Cluster 49: 141 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=66, Long SMA=176, Sharpe=0.2698, Trades=18
[INFO] Cluster 1 cluster: Short SMA=148, Long SMA=286, Sharpe=-0.0257, Trades=11
[INFO] Cluster 2 cluster: Short SMA=118, Long SMA=178, Sharpe=0.2548, Trades=17
[INFO] Cluster 3 cluster: Short SMA=50, Long SMA=64, Sharpe=0.7811, Trades=50
[INFO] Cluster 4 cluster: Short SMA=96, Long SMA=154, Sharpe=-0.1684, Trades=21
[INFO] Cluster 5 cluster: Short SMA=208, Long SMA=228, Sharpe=0.0203, Trades=20
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=30, Sharpe=-0.0312, Trades=155
[INFO] Cluster 7 cluster: Short SMA=178, Long SMA=246, Sharpe=0.0285, Trades=15
[INFO] Cluster 8 cluster: Short SMA=238, Long SMA=272, Sharpe=-0.3654, Trades=16
[INFO] Cluster 9 cluster: Short SMA=100, Long SMA=128, Sharpe=0.1113, Trades=32
[INFO] Cluster 10 cluster: Short SMA=86, Long SMA=268, Sharpe=0.0694, Trades=14
[INFO] Cluster 11 cluster: Short SMA=22, Long SMA=108, Sharpe=0.6658, Trades=34
[INFO] Cluster 12 cluster: Short SMA=128, Long SMA=248, Sharpe=0.1480, Trades=11
[INFO] Cluster 13 cluster: Short SMA=108, Long SMA=218, Sharpe=0.1458, Trades=15
[INFO] Cluster 14 cluster: Short SMA=38, Long SMA=168, Sharpe=0.4320, Trades=20
[INFO] Cluster 15 cluster: Short SMA=130, Long SMA=134, Sharpe=0.0551, Trades=59
[INFO] Cluster 16 cluster: Short SMA=128, Long SMA=142, Sharpe=-0.0112, Trades=35
[INFO] Cluster 17 cluster: Short SMA=206, Long SMA=286, Sharpe=-0.2600, Trades=12
[INFO] Cluster 18 cluster: Short SMA=50, Long SMA=96, Sharpe=0.7294, Trades=33
[INFO] Cluster 19 cluster: Short SMA=60, Long SMA=218, Sharpe=0.2872, Trades=16
[INFO] Cluster 20 cluster: Short SMA=38, Long SMA=50, Sharpe=0.4097, Trades=64
[INFO] Cluster 22 cluster: Short SMA=24, Long SMA=258, Sharpe=0.1885, Trades=18
[INFO] Cluster 23 cluster: Short SMA=70, Long SMA=124, Sharpe=0.2673, Trades=25
[INFO] Cluster 24 cluster: Short SMA=200, Long SMA=264, Sharpe=-0.0891, Trades=14
[INFO] Cluster 25 cluster: Short SMA=26, Long SMA=226, Sharpe=0.2835, Trades=22
[INFO] Cluster 26 cluster: Short SMA=256, Long SMA=260, Sharpe=-0.0173, Trades=34
[INFO] Cluster 27 cluster: Short SMA=48, Long SMA=130, Sharpe=0.4321, Trades=25
[INFO] Cluster 28 cluster: Short SMA=18, Long SMA=30, Sharpe=0.2196, Trades=104
[INFO] Cluster 29 cluster: Short SMA=154, Long SMA=174, Sharpe=0.4533, Trades=27
[INFO] Cluster 30 cluster: Short SMA=64, Long SMA=66, Sharpe=0.5895, Trades=108
[INFO] Cluster 31 cluster: Short SMA=32, Long SMA=284, Sharpe=0.1537, Trades=16
[INFO] Cluster 32 cluster: Short SMA=94, Long SMA=194, Sharpe=0.3683, Trades=15
[INFO] Cluster 33 cluster: Short SMA=262, Long SMA=280, Sharpe=-0.1489, Trades=20
[INFO] Cluster 34 cluster: Short SMA=188, Long SMA=192, Sharpe=0.0895, Trades=53
[INFO] Cluster 35 cluster: Short SMA=170, Long SMA=192, Sharpe=0.2807, Trades=23
[INFO] Cluster 36 cluster: Short SMA=26, Long SMA=70, Sharpe=0.5185, Trades=42
[INFO] Cluster 37 cluster: Short SMA=18, Long SMA=160, Sharpe=0.3640, Trades=30
[INFO] Cluster 38 cluster: Short SMA=118, Long SMA=120, Sharpe=0.0825, Trades=95
[INFO] Cluster 39 cluster: Short SMA=146, Long SMA=204, Sharpe=0.2828, Trades=17
[INFO] Cluster 41 cluster: Short SMA=58, Long SMA=248, Sharpe=0.1623, Trades=14
[INFO] Cluster 42 cluster: Short SMA=162, Long SMA=226, Sharpe=0.0426, Trades=15
[INFO] Cluster 43 cluster: Short SMA=164, Long SMA=168, Sharpe=0.4630, Trades=59
[INFO] Cluster 44 cluster: Short SMA=24, Long SMA=40, Sharpe=0.3060, Trades=80
[INFO] Cluster 45 cluster: Short SMA=20, Long SMA=196, Sharpe=0.4552, Trades=24
[INFO] Cluster 46 cluster: Short SMA=64, Long SMA=290, Sharpe=0.0545, Trades=12
[INFO] Cluster 47 cluster: Short SMA=112, Long SMA=282, Sharpe=0.1875, Trades=11
[INFO] Cluster 48 cluster: Short SMA=282, Long SMA=292, Sharpe=-0.3440, Trades=23
[INFO] Cluster 49 cluster: Short SMA=52, Long SMA=78, Sharpe=0.7402, Trades=41
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=94, Sharpe=1.0409, Trades=39
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=50, Long SMA=64, Sharpe=0.7811, Trades=50
[INFO] Top 2: Short SMA=52, Long SMA=78, Sharpe=0.7402, Trades=41
[INFO] Top 3: Short SMA=50, Long SMA=96, Sharpe=0.7294, Trades=33
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10572 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 94
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(50/64) - Original Sharpe: 0.7811, Trades: 50
[INFO] Hierarchical cluster 2: SMA(52/78) - Original Sharpe: 0.7402, Trades: 41
[INFO] Hierarchical cluster 3: SMA(50/96) - Original Sharpe: 0.7294, Trades: 33
[INFO] Hierarchical cluster 4: SMA(22/108) - Original Sharpe: 0.6658, Trades: 34
[INFO] Hierarchical cluster 5: SMA(64/66) - Original Sharpe: 0.5895, Trades: 108
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/94)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (50/64) - Sharpe: 0.7811
[INFO] cluster 2: (52/78) - Sharpe: 0.7402
[INFO] cluster 3: (50/96) - Sharpe: 0.7294
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.475522           -2.712830
1    2021-11-14 2021-11-14            43     1.219983           -2.291798
2    2022-01-14 2022-01-14            41    -0.358176            0.394480
3    2022-03-14 2022-03-14            44     4.804528            4.804528
4    2022-05-14 2022-05-14            43    -0.181247           -0.181247
5    2022-07-14 2022-07-14            44     1.120787           -2.550575
6    2022-09-14 2022-09-14            43    -1.028981           -0.263340
7    2022-11-14 2022-11-14            43    -2.298651           -1.083985
8    2023-01-14 2023-01-14            41    -0.223635           -4.870428
9    2023-03-14 2023-03-14            44     0.355798           -1.477944
10   2023-05-14 2023-05-14            44     1.277535           -1.119596
11   2023-07-14 2023-07-14            44     3.299199            3.299199
12   2023-09-14 2023-09-14            43     2.565820            2.565820
13   2023-11-14 2023-11-14            42    -2.979453           -5.385308
14   2024-01-14 2024-01-14            43    -1.306968           -1.499704
15   2024-03-14 2024-03-14            42     0.596356            1.980382
16   2024-05-14 2024-05-14            44    -1.478112           -0.506821
17   2024-07-14 2024-07-14            45     3.789391            3.131795
18   2024-09-14 2024-09-14            43    -5.219166           -6.108205
19   2024-11-14 2024-11-14            33     2.330861            1.824419
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.5 |             -2.7 |         -1.2 | False         
[INFO] 2021-11-14   |          1.2 |             -2.3 |         -3.5 | False         
[INFO] 2022-01-14   |         -0.4 |              0.4 |          0.8 | True          
[INFO] 2022-03-14   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |             -2.6 |         -3.7 | False         
[INFO] 2022-09-14   |         -1.0 |             -0.3 |          0.7 | True          
[INFO] 2022-11-14   |         -2.3 |             -1.1 |          1.2 | True          
[INFO] 2023-01-14   |         -0.2 |             -4.9 |         -4.7 | False         
[INFO] 2023-03-14   |          0.4 |             -1.5 |         -1.9 | False         
[INFO] 2023-05-14   |          1.3 |             -1.1 |         -2.4 | False         
[INFO] 2023-07-14   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.0 |             -5.4 |         -2.4 | False         
[INFO] 2024-01-14   |         -1.3 |             -1.5 |         -0.2 | False         
[INFO] 2024-03-14   |          0.6 |              2.0 |          1.4 | True          
[INFO] 2024-05-14   |         -1.5 |             -0.5 |          1.0 | True          
[INFO] 2024-07-14   |          3.8 |              3.1 |         -0.7 | False         
[INFO] 2024-09-14   |         -5.2 |             -6.1 |         -0.9 | False         
[INFO] 2024-11-14   |          2.3 |              1.8 |         -0.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 16 periods (31.25% win rate)
[INFO] Updating Excel file with Hierarchical results for US...
[INFO] Excel file updated successfully. Added US with Hierarchical win rate 31.2% in row 52
[INFO] Added best Sharpe parameters 62/94 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 94
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(50/64) - Original Sharpe: 0.7811
[INFO] Added cluster 2 to portfolio: SMA(52/78) - Original Sharpe: 0.7402
[INFO] Added cluster 3 to portfolio: SMA(50/96) - Original Sharpe: 0.7294
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'US_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3812
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1936
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for US...
[INFO] Excel file updated successfully. Added US with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\US
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for VX in column D: 52.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 105.93s
[INFO] Best parameters: Short SMA = 20, Long SMA = 26
[INFO] Best Sharpe ratio: 0.498120, Trades: 112
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 213 bad combos; keeping 2061 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172', 'SMA_SF_TOP5_192/194', 'SMA_SF_TOP5_186/204', 'SMA_SF_TOP5_190/196', 'SMA_SF_TOP5_186/206', 'SMA_SF_TOP5_184/206', 'SMA_SI_TOP5_48/50', 'SMA_SI_TOP5_42/58', 'SMA_SI_TOP5_44/56', 'SMA_SI_TOP5_40/60', 'SMA_SI_TOP5_234/258', 'SMA_SM_TOP5_70/74', 'SMA_SM_TOP5_12/20', 'SMA_SM_TOP5_14/22', 'SMA_SM_TOP5_66/78', 'SMA_SM_TOP5_14/24', 'SMA_TEN_TOP5_58/76', 'SMA_TEN_TOP5_60/76', 'SMA_TEN_TOP5_60/74', 'SMA_TEN_TOP5_40/44', 'SMA_TEN_TOP5_58/74', 'SMA_TY_TOP5_56/82', 'SMA_TY_TOP5_54/84', 'SMA_TY_TOP5_56/84', 'SMA_TY_TOP5_60/78', 'SMA_TY_TOP5_66/70', 'SMA_TU_TOP5_274/284', 'SMA_TU_TOP5_272/288', 'SMA_TU_TOP5_274/282', 'SMA_TU_TOP5_272/284', 'SMA_TU_TOP5_276/278', 'SMA_UB_TOP5_62/80', 'SMA_UB_TOP5_62/82', 'SMA_UB_TOP5_68/72', 'SMA_UB_TOP5_70/72', 'SMA_UB_TOP5_52/70', 'SMA_ULS_TOP5_166/168', 'SMA_ULS_TOP5_164/170', 'SMA_ULS_TOP5_180/214', 'SMA_ULS_TOP5_166/172', 'SMA_ULS_TOP5_10/30', 'SMA_US_TOP5_62/94', 'SMA_US_TOP5_58/92', 'SMA_US_TOP5_50/54', 'SMA_US_TOP5_62/96', 'SMA_US_TOP5_58/94', 'SMA_VX_TOP5_20/26', 'SMA_VX_TOP5_18/40', 'SMA_VX_TOP5_20/28', 'SMA_VX_TOP5_20/38', 'SMA_VX_TOP5_20/24']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @VX
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 6.89 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $374,312.00
[INFO] Market Buy & Hold P&L: $-118,870.00
[INFO] Outperformance: $493,182.00
[INFO] Sharpe ratio (entire period, annualized): 0.348523
[INFO] Sharpe ratio (in-sample, annualized): 0.498120
[INFO] Sharpe ratio (out-of-sample, annualized): -0.080129
[INFO] Maximum Drawdown: $275,228.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 77
[INFO] Out-of-sample period trades: 35
[INFO] Total trades: 112
[INFO] In-sample P&L: $452,028.00
[INFO] Out-of-sample P&L: $-25,006.00
[INFO] 
Best parameters from GA: Short SMA = 20, Long SMA = 26, Sharpe = 0.498120
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 52.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6289 to 0.4981
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 0.498120
[INFO] Number of Trades: 112
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10372 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6289 to 0.4981
[INFO] Trades range: 10.0 to 319.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3877 to 2.8531
[INFO] Scaled Long SMA range: -2.7953 to 1.4389
[INFO] Scaled Sharpe ratio range: -2.2865 to 4.5954
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 256 elements
[INFO] Kmeans Cluster 1: 247 elements
[INFO] Kmeans Cluster 2: 139 elements
[INFO] Kmeans Cluster 3: 246 elements
[INFO] Kmeans Cluster 4: 168 elements
[INFO] Kmeans Cluster 5: 271 elements
[INFO] Kmeans Cluster 6: 186 elements
[INFO] Kmeans Cluster 7: 202 elements
[INFO] Kmeans Cluster 8: 271 elements
[INFO] Kmeans Cluster 9: 334 elements
[INFO] Kmeans Cluster 10: 146 elements
[INFO] Kmeans Cluster 11: 197 elements
[INFO] Kmeans Cluster 12: 173 elements
[INFO] Kmeans Cluster 13: 184 elements
[INFO] Kmeans Cluster 14: 177 elements
[INFO] Kmeans Cluster 15: 222 elements
[INFO] Kmeans Cluster 16: 152 elements
[INFO] Kmeans Cluster 17: 267 elements
[INFO] Kmeans Cluster 18: 271 elements
[INFO] Kmeans Cluster 19: 196 elements
[INFO] Kmeans Cluster 20: 138 elements
[INFO] Kmeans Cluster 21: 234 elements
[INFO] Kmeans Cluster 22: 213 elements
[INFO] Kmeans Cluster 23: 256 elements
[INFO] Kmeans Cluster 24: 106 elements
[INFO] Kmeans Cluster 25: 242 elements
[INFO] Kmeans Cluster 26: 234 elements
[INFO] Kmeans Cluster 27: 165 elements
[INFO] Kmeans Cluster 28: 232 elements
[INFO] Kmeans Cluster 29: 203 elements
[INFO] Kmeans Cluster 30: 288 elements
[INFO] Kmeans Cluster 31: 78 elements
[INFO] Kmeans Cluster 32: 275 elements
[INFO] Kmeans Cluster 33: 99 elements
[INFO] Kmeans Cluster 34: 214 elements
[INFO] Kmeans Cluster 35: 161 elements
[INFO] Kmeans Cluster 36: 28 elements
[INFO] Kmeans Cluster 37: 163 elements
[INFO] Kmeans Cluster 38: 250 elements
[INFO] Kmeans Cluster 39: 218 elements
[INFO] Kmeans Cluster 40: 309 elements
[INFO] Kmeans Cluster 41: 252 elements
[INFO] Kmeans Cluster 42: 220 elements
[INFO] Kmeans Cluster 43: 171 elements
[INFO] Kmeans Cluster 44: 211 elements
[INFO] Kmeans Cluster 45: 325 elements
[INFO] Kmeans Cluster 46: 214 elements
[INFO] Kmeans Cluster 47: 300 elements
[INFO] Kmeans Cluster 48: 209 elements
[INFO] Kmeans Cluster 49: 59 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=149.54, Long SMA=251.68, Sharpe=-0.3568
[INFO] Centroid 1: Short SMA=26.43, Long SMA=167.46, Sharpe=-0.1894
[INFO] Centroid 2: Short SMA=176.10, Long SMA=279.01, Sharpe=-0.0862
[INFO] Centroid 3: Short SMA=50.44, Long SMA=232.56, Sharpe=-0.3892
[INFO] Centroid 4: Short SMA=22.25, Long SMA=99.43, Sharpe=0.0114
[INFO] Centroid 5: Short SMA=68.64, Long SMA=201.39, Sharpe=-0.4102
[INFO] Centroid 6: Short SMA=18.55, Long SMA=282.35, Sharpe=-0.1668
[INFO] Centroid 7: Short SMA=96.44, Long SMA=259.87, Sharpe=-0.4189
[INFO] Centroid 8: Short SMA=115.56, Long SMA=152.81, Sharpe=-0.2364
[INFO] Centroid 9: Short SMA=73.87, Long SMA=136.85, Sharpe=-0.2931
[INFO] Centroid 10: Short SMA=266.52, Long SMA=285.51, Sharpe=-0.1934
[INFO] Centroid 11: Short SMA=48.39, Long SMA=84.89, Sharpe=-0.1277
[INFO] Centroid 12: Short SMA=196.80, Long SMA=224.24, Sharpe=-0.1877
[INFO] Centroid 13: Short SMA=25.26, Long SMA=62.96, Sharpe=0.1082
[INFO] Centroid 14: Short SMA=18.47, Long SMA=240.66, Sharpe=-0.1592
[INFO] Centroid 15: Short SMA=35.71, Long SMA=256.99, Sharpe=-0.3019
[INFO] Centroid 16: Short SMA=235.51, Long SMA=249.47, Sharpe=0.1451
[INFO] Centroid 17: Short SMA=150.94, Long SMA=183.57, Sharpe=-0.4237
[INFO] Centroid 18: Short SMA=56.51, Long SMA=160.68, Sharpe=-0.3118
[INFO] Centroid 19: Short SMA=20.19, Long SMA=202.18, Sharpe=-0.1925
[INFO] Centroid 20: Short SMA=106.35, Long SMA=291.04, Sharpe=-0.2796
[INFO] Centroid 21: Short SMA=103.58, Long SMA=127.29, Sharpe=-0.1816
[INFO] Centroid 22: Short SMA=22.11, Long SMA=133.59, Sharpe=-0.0851
[INFO] Centroid 23: Short SMA=51.77, Long SMA=287.13, Sharpe=-0.3742
[INFO] Centroid 24: Short SMA=77.47, Long SMA=102.30, Sharpe=-0.4111
[INFO] Centroid 25: Short SMA=203.17, Long SMA=261.57, Sharpe=-0.0101
[INFO] Centroid 26: Short SMA=73.65, Long SMA=103.64, Sharpe=-0.2793
[INFO] Centroid 27: Short SMA=22.82, Long SMA=45.73, Sharpe=-0.0411
[INFO] Centroid 28: Short SMA=145.95, Long SMA=221.66, Sharpe=-0.3060
[INFO] Centroid 29: Short SMA=177.12, Long SMA=202.04, Sharpe=-0.3564
[INFO] Centroid 30: Short SMA=228.58, Long SMA=277.69, Sharpe=-0.0669
[INFO] Centroid 31: Short SMA=18.33, Long SMA=57.95, Sharpe=-0.2072
[INFO] Centroid 32: Short SMA=75.61, Long SMA=235.99, Sharpe=-0.4881
[INFO] Centroid 33: Short SMA=158.79, Long SMA=272.04, Sharpe=-0.2496
[INFO] Centroid 34: Short SMA=117.54, Long SMA=256.94, Sharpe=-0.4660
[INFO] Centroid 35: Short SMA=170.93, Long SMA=221.03, Sharpe=-0.4165
[INFO] Centroid 36: Short SMA=24.36, Long SMA=35.86, Sharpe=0.3266
[INFO] Centroid 37: Short SMA=264.43, Long SMA=286.66, Sharpe=-0.2954
[INFO] Centroid 38: Short SMA=116.29, Long SMA=198.27, Sharpe=-0.4477
[INFO] Centroid 39: Short SMA=136.07, Long SMA=159.04, Sharpe=-0.3267
[INFO] Centroid 40: Short SMA=112.86, Long SMA=224.35, Sharpe=-0.4056
[INFO] Centroid 41: Short SMA=204.39, Long SMA=239.48, Sharpe=-0.0726
[INFO] Centroid 42: Short SMA=186.12, Long SMA=277.81, Sharpe=0.0453
[INFO] Centroid 43: Short SMA=50.98, Long SMA=72.53, Sharpe=-0.0379
[INFO] Centroid 44: Short SMA=39.44, Long SMA=197.93, Sharpe=-0.2793
[INFO] Centroid 45: Short SMA=90.52, Long SMA=178.30, Sharpe=-0.3404
[INFO] Centroid 46: Short SMA=127.97, Long SMA=282.39, Sharpe=-0.3637
[INFO] Centroid 47: Short SMA=72.49, Long SMA=276.57, Sharpe=-0.4573
[INFO] Centroid 48: Short SMA=37.69, Long SMA=127.01, Sharpe=-0.1750
[INFO] Centroid 49: Short SMA=164.68, Long SMA=180.10, Sharpe=-0.5324
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=26, Sharpe=0.4981, Trades=112
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=20, Long SMA=34, Sharpe=0.3363, Trades=76
[INFO] Kmeans Top 2: Short SMA=236, Long SMA=250, Sharpe=0.1560, Trades=16
[INFO] Kmeans Top 3: Short SMA=186, Long SMA=278, Sharpe=0.0565, Trades=10
[INFO] Kmeans Top 4: Short SMA=26, Long SMA=64, Sharpe=0.0387, Trades=44
[INFO] Kmeans Top 5: Short SMA=24, Long SMA=98, Sharpe=0.0004, Trades=24
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (150, 252)
[INFO]   Rounded: (26, 167)
[INFO]   Nearest: (26.0, 168.0)
[INFO]   Rounded: (176, 279)
[INFO]   Nearest: (176.0, 280.0)
[INFO]   Rounded: (50, 233)
[INFO]   Nearest: (50.0, 232.0)
[INFO]   Rounded: (22, 99)
[INFO]   Nearest: (22.0, 100.0)
[INFO]   Rounded: (69, 201)
[INFO]   Nearest: (68.0, 202.0)
[INFO]   Rounded: (19, 282)
[INFO]   Nearest: (18.0, 282.0)
[INFO]   Rounded: (96, 260)
[INFO]   Rounded: (116, 153)
[INFO]   Nearest: (116.0, 152.0)
[INFO]   Rounded: (74, 137)
[INFO]   Nearest: (74.0, 136.0)
[INFO]   Rounded: (267, 286)
[INFO]   Nearest: (266.0, 286.0)
[INFO]   Rounded: (48, 85)
[INFO]   Nearest: (48.0, 84.0)
[INFO]   Rounded: (197, 224)
[INFO]   Nearest: (196.0, 224.0)
[INFO]   Rounded: (25, 63)
[INFO]   Nearest: (26.0, 62.0)
[INFO]   Rounded: (18, 241)
[INFO]   Nearest: (18.0, 240.0)
[INFO]   Rounded: (36, 257)
[INFO]   Nearest: (36.0, 256.0)
[INFO]   Rounded: (236, 249)
[INFO]   Nearest: (236.0, 250.0)
[INFO]   Rounded: (151, 184)
[INFO]   Nearest: (150.0, 184.0)
[INFO]   Rounded: (57, 161)
[INFO]   Nearest: (56.0, 160.0)
[INFO]   Rounded: (20, 202)
[INFO]   Rounded: (106, 291)
[INFO]   Nearest: (106.0, 292.0)
[INFO]   Rounded: (104, 127)
[INFO]   Nearest: (104.0, 128.0)
[INFO]   Rounded: (22, 134)
[INFO]   Rounded: (52, 287)
[INFO]   Nearest: (52.0, 288.0)
[INFO]   Rounded: (77, 102)
[INFO]   Nearest: (78.0, 102.0)
[INFO]   Rounded: (203, 262)
[INFO]   Nearest: (204.0, 262.0)
[INFO]   Rounded: (74, 104)
[INFO]   Rounded: (23, 46)
[INFO]   Nearest: (22.0, 46.0)
[INFO]   Rounded: (146, 222)
[INFO]   Rounded: (177, 202)
[INFO]   Nearest: (178.0, 202.0)
[INFO]   Rounded: (229, 278)
[INFO]   Nearest: (228.0, 278.0)
[INFO]   Rounded: (18, 58)
[INFO]   Rounded: (76, 236)
[INFO]   Rounded: (159, 272)
[INFO]   Nearest: (158.0, 272.0)
[INFO]   Rounded: (118, 257)
[INFO]   Nearest: (118.0, 256.0)
[INFO]   Rounded: (171, 221)
[INFO]   Nearest: (170.0, 222.0)
[INFO]   Rounded: (24, 36)
[INFO]   Rounded: (264, 287)
[INFO]   Nearest: (264.0, 286.0)
[INFO]   Rounded: (116, 198)
[INFO]   Rounded: (136, 159)
[INFO]   Nearest: (136.0, 160.0)
[INFO]   Rounded: (113, 224)
[INFO]   Nearest: (112.0, 224.0)
[INFO]   Rounded: (204, 239)
[INFO]   Nearest: (204.0, 240.0)
[INFO]   Rounded: (186, 278)
[INFO]   Rounded: (51, 73)
[INFO]   Nearest: (50.0, 72.0)
[INFO]   Rounded: (39, 198)
[INFO]   Nearest: (40.0, 198.0)
[INFO]   Rounded: (91, 178)
[INFO]   Nearest: (90.0, 178.0)
[INFO]   Rounded: (128, 282)
[INFO]   Rounded: (72, 277)
[INFO]   Nearest: (72.0, 276.0)
[INFO]   Rounded: (38, 127)
[INFO]   Nearest: (38.0, 128.0)
[INFO]   Rounded: (165, 180)
[INFO]   Nearest: (164.0, 180.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] File size: 186438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(20/34) - Original Sharpe: 0.3363, Trades: 76
[INFO] Kmeans cluster 2: SMA(236/250) - Original Sharpe: 0.1560, Trades: 16
[INFO] Kmeans cluster 3: SMA(186/278) - Original Sharpe: 0.0565, Trades: 10
[INFO] Kmeans cluster 4: SMA(26/64) - Original Sharpe: 0.0387, Trades: 44
[INFO] Kmeans cluster 5: SMA(24/98) - Original Sharpe: 0.0004, Trades: 24
[INFO] Trimmed warm-up period. Evaluation data length: 2811
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (20/34) - Sharpe: 0.3363
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] File size: 186438 bytes
[INFO] Out-of-sample period starts on: 2021-09-21
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-21 2021-09-21            44    -0.805050           -1.056289
1    2021-11-21 2021-11-21            43    -3.658865           -3.352766
2    2022-01-21 2022-01-21            41    -3.169670           -1.828407
3    2022-03-21 2022-03-21            44    -2.653829           -2.294902
4    2022-05-21 2022-05-21            43    -0.674806           -0.913614
5    2022-07-21 2022-07-21            44     2.031682            0.101092
6    2022-09-21 2022-09-21            43     1.062687            0.383555
7    2022-11-21 2022-11-21            43     3.891653            3.891653
8    2023-01-21 2023-01-21            41     2.035036            2.782648
9    2023-03-21 2023-03-21            43    -0.328875           -0.832180
10   2023-05-21 2023-05-21            44     4.995280            4.995280
11   2023-07-21 2023-07-21            42    -2.139299           -1.573226
12   2023-09-21 2023-09-21            43    -2.742992            0.033536
13   2023-11-21 2023-11-21            42     2.723792            2.723792
14   2024-01-21 2024-01-21            43     2.153976            2.153976
15   2024-03-21 2024-03-21            42    -3.174471           -4.425604
16   2024-05-21 2024-05-21            43    -0.220985           -0.220985
17   2024-07-21 2024-07-21            45     1.033071            0.773490
18   2024-09-21 2024-09-21            43     0.907216           -1.067625
19   2024-11-21 2024-11-21            28    -0.090414           -0.071379
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-21   |         -0.8 |             -1.1 |         -0.3 | False         
[INFO] 2021-11-21   |         -3.7 |             -3.4 |          0.3 | True          
[INFO] 2022-01-21   |         -3.2 |             -1.8 |          1.4 | True          
[INFO] 2022-03-21   |         -2.7 |             -2.3 |          0.4 | True          
[INFO] 2022-05-21   |         -0.7 |             -0.9 |         -0.2 | False         
[INFO] 2022-07-21   |          2.0 |              0.1 |         -1.9 | False         
[INFO] 2022-09-21   |          1.1 |              0.4 |         -0.7 | False         
[INFO] 2022-11-21   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2023-01-21   |          2.0 |              2.8 |          0.8 | True          
[INFO] 2023-03-21   |         -0.3 |             -0.8 |         -0.5 | False         
[INFO] 2023-05-21   |          5.0 |              5.0 |          0.0 | Excluded      
[INFO] 2023-07-21   |         -2.1 |             -1.6 |          0.5 | True          
[INFO] 2023-09-21   |         -2.7 |              0.0 |          2.7 | True          
[INFO] 2023-11-21   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2024-01-21   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-03-21   |         -3.2 |             -4.4 |         -1.2 | False         
[INFO] 2024-05-21   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2024-07-21   |          1.0 |              0.8 |         -0.2 | False         
[INFO] 2024-09-21   |          0.9 |             -1.1 |         -2.0 | False         
[INFO] 2024-11-21   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-11-21, 2023-05-21, 2023-11-21, 2024-01-21, 2024-05-21, 2024-11-21
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 6 of 14 periods (42.86% win rate)
[INFO] Updating Excel file with Kmeans results for VX...
[INFO] Excel file updated successfully. Added VX with Kmeans win rate 42.9% in row 53
[INFO] Added best Sharpe parameters 20/26 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 26
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(20/34) - Original Sharpe: 0.3363
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'VX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0880
[INFO] Kmeans Best out-of-sample Sharpe: -0.0801
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for VX...
[INFO] Excel file updated successfully. Added VX with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\VX
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 52.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6289 to 0.4981
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 0.498120
[INFO] Number of Trades: 112
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10372 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6289 to 0.4981
[INFO] Trades range: 10.0 to 319.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3877 to 2.8531
[INFO] Scaled Long SMA range: -2.7953 to 1.4389
[INFO] Scaled Sharpe ratio range: -2.2865 to 4.5954
[INFO] Scaled Trades range: -0.5516 to 19.0730
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10372 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5367
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 313 elements
[INFO] Cluster 1: 287 elements
[INFO] Cluster 2: 322 elements
[INFO] Cluster 3: 359 elements
[INFO] Cluster 4: 244 elements
[INFO] Cluster 5: 362 elements
[INFO] Cluster 6: 170 elements
[INFO] Cluster 7: 152 elements
[INFO] Cluster 8: 358 elements
[INFO] Cluster 9: 242 elements
[INFO] Cluster 10: 280 elements
[INFO] Cluster 11: 263 elements
[INFO] Cluster 12: 243 elements
[INFO] Cluster 13: 369 elements
[INFO] Cluster 14: 403 elements
[INFO] Cluster 15: 406 elements
[INFO] Cluster 16: 144 elements
[INFO] Cluster 17: 40 elements
[INFO] Cluster 18: 422 elements
[INFO] Cluster 19: 380 elements
[INFO] Cluster 20: 34 elements
[INFO] Cluster 21: 437 elements
[INFO] Cluster 22: 200 elements
[INFO] Cluster 23: 85 elements
[INFO] Cluster 24: 11 elements
[INFO] Cluster 25: 82 elements
[INFO] Cluster 26: 155 elements
[INFO] Cluster 27: 133 elements
[INFO] Cluster 28: 267 elements
[INFO] Cluster 29: 6 elements
[INFO] Cluster 30: 271 elements
[INFO] Cluster 31: 84 elements
[INFO] Cluster 32: 61 elements
[INFO] Cluster 33: 280 elements
[INFO] Cluster 34: 216 elements
[INFO] Cluster 35: 49 elements
[INFO] Cluster 36: 279 elements
[INFO] Cluster 37: 24 elements
[INFO] Cluster 38: 113 elements
[INFO] Cluster 39: 326 elements
[INFO] Cluster 40: 24 elements
[INFO] Cluster 41: 123 elements
[INFO] Cluster 42: 31 elements
[INFO] Cluster 43: 224 elements
[INFO] Cluster 44: 261 elements
[INFO] Cluster 45: 172 elements
[INFO] Cluster 46: 2 elements
[INFO] Cluster 47: 255 elements
[INFO] Cluster 48: 236 elements
[INFO] Cluster 49: 172 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=264, Long SMA=286, Sharpe=-0.2594, Trades=12
[INFO] Cluster 1 cluster: Short SMA=52, Long SMA=106, Sharpe=-0.2545, Trades=24
[INFO] Cluster 2 cluster: Short SMA=18, Long SMA=224, Sharpe=-0.1808, Trades=20
[INFO] Cluster 3 cluster: Short SMA=30, Long SMA=154, Sharpe=-0.1240, Trades=22
[INFO] Cluster 4 cluster: Short SMA=200, Long SMA=224, Sharpe=-0.2473, Trades=12
[INFO] Cluster 5 cluster: Short SMA=142, Long SMA=184, Sharpe=-0.4671, Trades=14
[INFO] Cluster 6 cluster: Short SMA=234, Long SMA=250, Sharpe=0.1637, Trades=16
[INFO] Cluster 7 cluster: Short SMA=166, Long SMA=280, Sharpe=-0.0962, Trades=10
[INFO] Cluster 8 cluster: Short SMA=224, Long SMA=276, Sharpe=-0.0858, Trades=10
[INFO] Cluster 9 cluster: Short SMA=22, Long SMA=280, Sharpe=-0.0972, Trades=12
[INFO] Cluster 10 cluster: Short SMA=110, Long SMA=152, Sharpe=-0.2702, Trades=15
[INFO] Cluster 11 cluster: Short SMA=116, Long SMA=290, Sharpe=-0.3470, Trades=10
[INFO] Cluster 12 cluster: Short SMA=46, Long SMA=72, Sharpe=-0.1613, Trades=38
[INFO] Cluster 13 cluster: Short SMA=150, Long SMA=256, Sharpe=-0.3929, Trades=10
[INFO] Cluster 14 cluster: Short SMA=172, Long SMA=206, Sharpe=-0.3733, Trades=12
[INFO] Cluster 15 cluster: Short SMA=88, Long SMA=182, Sharpe=-0.3380, Trades=15
[INFO] Cluster 16 cluster: Short SMA=98, Long SMA=116, Sharpe=-0.2209, Trades=30
[INFO] Cluster 17 cluster: Short SMA=114, Long SMA=116, Sharpe=-0.2530, Trades=61
[INFO] Cluster 18 cluster: Short SMA=108, Long SMA=260, Sharpe=-0.4614, Trades=10
[INFO] Cluster 19 cluster: Short SMA=60, Long SMA=150, Sharpe=-0.3522, Trades=19
[INFO] Cluster 20 cluster: Short SMA=16, Long SMA=28, Sharpe=0.0080, Trades=99
[INFO] Cluster 21 cluster: Short SMA=110, Long SMA=222, Sharpe=-0.4028, Trades=10
[INFO] Cluster 22 cluster: Short SMA=52, Long SMA=238, Sharpe=-0.3532, Trades=10
[INFO] Cluster 23 cluster: Short SMA=32, Long SMA=48, Sharpe=0.0838, Trades=54
[INFO] Cluster 25 cluster: Short SMA=26, Long SMA=40, Sharpe=-0.0153, Trades=68
[INFO] Cluster 26 cluster: Short SMA=78, Long SMA=102, Sharpe=-0.4326, Trades=30
[INFO] Cluster 27 cluster: Short SMA=130, Long SMA=144, Sharpe=-0.3127, Trades=25
[INFO] Cluster 28 cluster: Short SMA=42, Long SMA=192, Sharpe=-0.3176, Trades=18
[INFO] Cluster 30 cluster: Short SMA=188, Long SMA=278, Sharpe=0.0210, Trades=10
[INFO] Cluster 31 cluster: Short SMA=26, Long SMA=64, Sharpe=0.0387, Trades=44
[INFO] Cluster 32 cluster: Short SMA=162, Long SMA=164, Sharpe=-0.3585, Trades=41
[INFO] Cluster 33 cluster: Short SMA=60, Long SMA=208, Sharpe=-0.3795, Trades=16
[INFO] Cluster 34 cluster: Short SMA=30, Long SMA=106, Sharpe=-0.0417, Trades=24
[INFO] Cluster 35 cluster: Short SMA=12, Long SMA=70, Sharpe=-0.1765, Trades=54
[INFO] Cluster 36 cluster: Short SMA=52, Long SMA=288, Sharpe=-0.3902, Trades=10
[INFO] Cluster 37 cluster: Short SMA=38, Long SMA=40, Sharpe=-0.0130, Trades=126
[INFO] Cluster 38 cluster: Short SMA=16, Long SMA=98, Sharpe=0.0635, Trades=30
[INFO] Cluster 39 cluster: Short SMA=198, Long SMA=250, Sharpe=-0.0232, Trades=10
[INFO] Cluster 40 cluster: Short SMA=16, Long SMA=40, Sharpe=0.1997, Trades=72
[INFO] Cluster 41 cluster: Short SMA=14, Long SMA=156, Sharpe=-0.1001, Trades=32
[INFO] Cluster 42 cluster: Short SMA=24, Long SMA=32, Sharpe=-0.1437, Trades=92
[INFO] Cluster 43 cluster: Short SMA=144, Long SMA=222, Sharpe=-0.2769, Trades=10
[INFO] Cluster 44 cluster: Short SMA=74, Long SMA=276, Sharpe=-0.4641, Trades=10
[INFO] Cluster 45 cluster: Short SMA=128, Long SMA=172, Sharpe=-0.2895, Trades=17
[INFO] Cluster 47 cluster: Short SMA=74, Long SMA=240, Sharpe=-0.5050, Trades=10
[INFO] Cluster 48 cluster: Short SMA=84, Long SMA=138, Sharpe=-0.3194, Trades=15
[INFO] Cluster 49 cluster: Short SMA=40, Long SMA=254, Sharpe=-0.3300, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=26, Sharpe=0.4981, Trades=112
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=16, Long SMA=40, Sharpe=0.1997, Trades=72
[INFO] Top 2: Short SMA=234, Long SMA=250, Sharpe=0.1637, Trades=16
[INFO] Top 3: Short SMA=32, Long SMA=48, Sharpe=0.0838, Trades=54
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10353 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] File size: 186438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(16/40) - Original Sharpe: 0.1997, Trades: 72
[INFO] Hierarchical cluster 2: SMA(234/250) - Original Sharpe: 0.1637, Trades: 16
[INFO] Hierarchical cluster 3: SMA(32/48) - Original Sharpe: 0.0838, Trades: 54
[INFO] Hierarchical cluster 4: SMA(16/98) - Original Sharpe: 0.0635, Trades: 30
[INFO] Hierarchical cluster 5: SMA(26/64) - Original Sharpe: 0.0387, Trades: 44
[INFO] Trimmed warm-up period. Evaluation data length: 2811
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 26
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\VX
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for W in column D: 15.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 105.03s
[INFO] Best parameters: Short SMA = 48, Long SMA = 50
[INFO] Best Sharpe ratio: 0.887053, Trades: 170
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172', 'SMA_SF_TOP5_192/194', 'SMA_SF_TOP5_186/204', 'SMA_SF_TOP5_190/196', 'SMA_SF_TOP5_186/206', 'SMA_SF_TOP5_184/206', 'SMA_SI_TOP5_48/50', 'SMA_SI_TOP5_42/58', 'SMA_SI_TOP5_44/56', 'SMA_SI_TOP5_40/60', 'SMA_SI_TOP5_234/258', 'SMA_SM_TOP5_70/74', 'SMA_SM_TOP5_12/20', 'SMA_SM_TOP5_14/22', 'SMA_SM_TOP5_66/78', 'SMA_SM_TOP5_14/24', 'SMA_TEN_TOP5_58/76', 'SMA_TEN_TOP5_60/76', 'SMA_TEN_TOP5_60/74', 'SMA_TEN_TOP5_40/44', 'SMA_TEN_TOP5_58/74', 'SMA_TY_TOP5_56/82', 'SMA_TY_TOP5_54/84', 'SMA_TY_TOP5_56/84', 'SMA_TY_TOP5_60/78', 'SMA_TY_TOP5_66/70', 'SMA_TU_TOP5_274/284', 'SMA_TU_TOP5_272/288', 'SMA_TU_TOP5_274/282', 'SMA_TU_TOP5_272/284', 'SMA_TU_TOP5_276/278', 'SMA_UB_TOP5_62/80', 'SMA_UB_TOP5_62/82', 'SMA_UB_TOP5_68/72', 'SMA_UB_TOP5_70/72', 'SMA_UB_TOP5_52/70', 'SMA_ULS_TOP5_166/168', 'SMA_ULS_TOP5_164/170', 'SMA_ULS_TOP5_180/214', 'SMA_ULS_TOP5_166/172', 'SMA_ULS_TOP5_10/30', 'SMA_US_TOP5_62/94', 'SMA_US_TOP5_58/92', 'SMA_US_TOP5_50/54', 'SMA_US_TOP5_62/96', 'SMA_US_TOP5_58/94', 'SMA_VX_TOP5_20/26', 'SMA_VX_TOP5_18/40', 'SMA_VX_TOP5_20/28', 'SMA_VX_TOP5_20/38', 'SMA_VX_TOP5_20/24', 'SMA_W_TOP5_48/50', 'SMA_W_TOP5_42/48', 'SMA_W_TOP5_38/60', 'SMA_W_TOP5_38/58', 'SMA_W_TOP5_42/50']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @WBS=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.86 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $387,570.00
[INFO] Market Buy & Hold P&L: $-29,470.00
[INFO] Outperformance: $417,040.00
[INFO] Sharpe ratio (entire period, annualized): 0.439905
[INFO] Sharpe ratio (in-sample, annualized): 0.887053
[INFO] Sharpe ratio (out-of-sample, annualized): -0.550168
[INFO] Maximum Drawdown: $231,315.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 108
[INFO] Out-of-sample period trades: 62
[INFO] Total trades: 170
[INFO] In-sample P&L: $528,290.00
[INFO] Out-of-sample P&L: $-147,780.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.887053
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7249 to 0.8871
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.887053
[INFO] Number of Trades: 170
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7249 to 0.8871
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.3475 to 3.5609
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 209 elements
[INFO] Kmeans Cluster 1: 252 elements
[INFO] Kmeans Cluster 2: 240 elements
[INFO] Kmeans Cluster 3: 186 elements
[INFO] Kmeans Cluster 4: 259 elements
[INFO] Kmeans Cluster 5: 217 elements
[INFO] Kmeans Cluster 6: 205 elements
[INFO] Kmeans Cluster 7: 252 elements
[INFO] Kmeans Cluster 8: 175 elements
[INFO] Kmeans Cluster 9: 205 elements
[INFO] Kmeans Cluster 10: 202 elements
[INFO] Kmeans Cluster 11: 187 elements
[INFO] Kmeans Cluster 12: 307 elements
[INFO] Kmeans Cluster 13: 338 elements
[INFO] Kmeans Cluster 14: 312 elements
[INFO] Kmeans Cluster 15: 189 elements
[INFO] Kmeans Cluster 16: 146 elements
[INFO] Kmeans Cluster 17: 259 elements
[INFO] Kmeans Cluster 18: 185 elements
[INFO] Kmeans Cluster 19: 290 elements
[INFO] Kmeans Cluster 20: 287 elements
[INFO] Kmeans Cluster 21: 140 elements
[INFO] Kmeans Cluster 22: 232 elements
[INFO] Kmeans Cluster 23: 167 elements
[INFO] Kmeans Cluster 24: 223 elements
[INFO] Kmeans Cluster 25: 168 elements
[INFO] Kmeans Cluster 26: 245 elements
[INFO] Kmeans Cluster 27: 284 elements
[INFO] Kmeans Cluster 28: 107 elements
[INFO] Kmeans Cluster 29: 250 elements
[INFO] Kmeans Cluster 30: 99 elements
[INFO] Kmeans Cluster 31: 195 elements
[INFO] Kmeans Cluster 32: 97 elements
[INFO] Kmeans Cluster 33: 63 elements
[INFO] Kmeans Cluster 34: 272 elements
[INFO] Kmeans Cluster 35: 286 elements
[INFO] Kmeans Cluster 36: 255 elements
[INFO] Kmeans Cluster 37: 128 elements
[INFO] Kmeans Cluster 38: 126 elements
[INFO] Kmeans Cluster 39: 163 elements
[INFO] Kmeans Cluster 40: 288 elements
[INFO] Kmeans Cluster 41: 186 elements
[INFO] Kmeans Cluster 42: 274 elements
[INFO] Kmeans Cluster 43: 258 elements
[INFO] Kmeans Cluster 44: 243 elements
[INFO] Kmeans Cluster 45: 208 elements
[INFO] Kmeans Cluster 46: 196 elements
[INFO] Kmeans Cluster 47: 213 elements
[INFO] Kmeans Cluster 48: 113 elements
[INFO] Kmeans Cluster 49: 204 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=96.34, Long SMA=290.28, Sharpe=0.0332
[INFO] Centroid 1: Short SMA=56.93, Long SMA=142.83, Sharpe=0.0306
[INFO] Centroid 2: Short SMA=232.13, Long SMA=257.88, Sharpe=0.0773
[INFO] Centroid 3: Short SMA=156.77, Long SMA=196.24, Sharpe=0.2197
[INFO] Centroid 4: Short SMA=29.82, Long SMA=61.66, Sharpe=0.4823
[INFO] Centroid 5: Short SMA=86.19, Long SMA=166.49, Sharpe=-0.1390
[INFO] Centroid 6: Short SMA=38.50, Long SMA=185.14, Sharpe=0.3104
[INFO] Centroid 7: Short SMA=37.09, Long SMA=285.80, Sharpe=0.3185
[INFO] Centroid 8: Short SMA=189.77, Long SMA=290.37, Sharpe=0.0509
[INFO] Centroid 9: Short SMA=257.71, Long SMA=288.32, Sharpe=-0.1746
[INFO] Centroid 10: Short SMA=154.27, Long SMA=177.38, Sharpe=0.4046
[INFO] Centroid 11: Short SMA=188.44, Long SMA=263.74, Sharpe=0.3473
[INFO] Centroid 12: Short SMA=74.59, Long SMA=269.63, Sharpe=0.1808
[INFO] Centroid 13: Short SMA=25.86, Long SMA=210.82, Sharpe=0.2015
[INFO] Centroid 14: Short SMA=30.78, Long SMA=132.30, Sharpe=0.2482
[INFO] Centroid 15: Short SMA=147.39, Long SMA=290.87, Sharpe=-0.0871
[INFO] Centroid 16: Short SMA=92.73, Long SMA=123.38, Sharpe=-0.4546
[INFO] Centroid 17: Short SMA=221.66, Long SMA=258.55, Sharpe=0.1900
[INFO] Centroid 18: Short SMA=117.28, Long SMA=182.69, Sharpe=0.1615
[INFO] Centroid 19: Short SMA=28.23, Long SMA=98.26, Sharpe=0.3793
[INFO] Centroid 20: Short SMA=142.53, Long SMA=261.34, Sharpe=0.0369
[INFO] Centroid 21: Short SMA=28.17, Long SMA=52.69, Sharpe=0.6681
[INFO] Centroid 22: Short SMA=164.83, Long SMA=218.34, Sharpe=0.2989
[INFO] Centroid 23: Short SMA=66.66, Long SMA=95.23, Sharpe=0.1399
[INFO] Centroid 24: Short SMA=62.89, Long SMA=185.33, Sharpe=0.1559
[INFO] Centroid 25: Short SMA=125.25, Long SMA=149.62, Sharpe=-0.0301
[INFO] Centroid 26: Short SMA=100.59, Long SMA=255.54, Sharpe=0.2722
[INFO] Centroid 27: Short SMA=69.54, Long SMA=219.31, Sharpe=0.2687
[INFO] Centroid 28: Short SMA=20.86, Long SMA=39.21, Sharpe=0.3224
[INFO] Centroid 29: Short SMA=90.42, Long SMA=136.75, Sharpe=-0.2922
[INFO] Centroid 30: Short SMA=271.39, Long SMA=294.00, Sharpe=-0.3042
[INFO] Centroid 31: Short SMA=175.92, Long SMA=272.57, Sharpe=0.2051
[INFO] Centroid 32: Short SMA=181.86, Long SMA=198.02, Sharpe=-0.0479
[INFO] Centroid 33: Short SMA=201.68, Long SMA=212.19, Sharpe=0.4932
[INFO] Centroid 34: Short SMA=52.38, Long SMA=87.21, Sharpe=0.2860
[INFO] Centroid 35: Short SMA=33.90, Long SMA=250.97, Sharpe=0.2852
[INFO] Centroid 36: Short SMA=33.04, Long SMA=275.44, Sharpe=0.4309
[INFO] Centroid 37: Short SMA=122.67, Long SMA=138.69, Sharpe=0.1201
[INFO] Centroid 38: Short SMA=82.06, Long SMA=109.83, Sharpe=-0.1123
[INFO] Centroid 39: Short SMA=83.84, Long SMA=191.71, Sharpe=0.0176
[INFO] Centroid 40: Short SMA=195.33, Long SMA=230.01, Sharpe=0.2086
[INFO] Centroid 41: Short SMA=98.11, Long SMA=218.08, Sharpe=0.3602
[INFO] Centroid 42: Short SMA=25.90, Long SMA=158.26, Sharpe=0.1262
[INFO] Centroid 43: Short SMA=158.64, Long SMA=238.36, Sharpe=0.1377
[INFO] Centroid 44: Short SMA=119.44, Long SMA=229.88, Sharpe=0.2097
[INFO] Centroid 45: Short SMA=116.48, Long SMA=273.65, Sharpe=0.1569
[INFO] Centroid 46: Short SMA=45.70, Long SMA=234.31, Sharpe=0.0854
[INFO] Centroid 47: Short SMA=235.92, Long SMA=282.91, Sharpe=-0.0468
[INFO] Centroid 48: Short SMA=128.27, Long SMA=157.20, Sharpe=-0.2014
[INFO] Centroid 49: Short SMA=122.67, Long SMA=192.49, Sharpe=0.2967
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8871, Trades=170
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=32, Long SMA=52, Sharpe=0.6984, Trades=64
[INFO] Kmeans Top 2: Short SMA=30, Long SMA=64, Sharpe=0.5101, Trades=56
[INFO] Kmeans Top 3: Short SMA=100, Long SMA=216, Sharpe=0.3991, Trades=17
[INFO] Kmeans Top 4: Short SMA=188, Long SMA=264, Sharpe=0.3940, Trades=16
[INFO] Kmeans Top 5: Short SMA=26, Long SMA=98, Sharpe=0.3878, Trades=34
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (96, 290)
[INFO]   Rounded: (57, 143)
[INFO]   Nearest: (56.0, 142.0)
[INFO]   Rounded: (232, 258)
[INFO]   Rounded: (157, 196)
[INFO]   Nearest: (156.0, 196.0)
[INFO]   Rounded: (30, 62)
[INFO]   Rounded: (86, 166)
[INFO]   Rounded: (38, 185)
[INFO]   Nearest: (38.0, 186.0)
[INFO]   Rounded: (37, 286)
[INFO]   Nearest: (38.0, 286.0)
[INFO]   Rounded: (190, 290)
[INFO]   Rounded: (258, 288)
[INFO]   Rounded: (154, 177)
[INFO]   Nearest: (154.0, 178.0)
[INFO]   Rounded: (188, 264)
[INFO]   Rounded: (75, 270)
[INFO]   Nearest: (74.0, 270.0)
[INFO]   Rounded: (26, 211)
[INFO]   Nearest: (26.0, 210.0)
[INFO]   Rounded: (31, 132)
[INFO]   Nearest: (30.0, 132.0)
[INFO]   Rounded: (147, 291)
[INFO]   Nearest: (148.0, 290.0)
[INFO]   Rounded: (93, 123)
[INFO]   Nearest: (92.0, 124.0)
[INFO]   Rounded: (222, 259)
[INFO]   Nearest: (222.0, 258.0)
[INFO]   Rounded: (117, 183)
[INFO]   Nearest: (118.0, 182.0)
[INFO]   Rounded: (28, 98)
[INFO]   Rounded: (143, 261)
[INFO]   Nearest: (142.0, 262.0)
[INFO]   Rounded: (28, 53)
[INFO]   Nearest: (28.0, 52.0)
[INFO]   Rounded: (165, 218)
[INFO]   Nearest: (164.0, 218.0)
[INFO]   Rounded: (67, 95)
[INFO]   Nearest: (66.0, 96.0)
[INFO]   Rounded: (63, 185)
[INFO]   Nearest: (62.0, 186.0)
[INFO]   Rounded: (125, 150)
[INFO]   Nearest: (126.0, 150.0)
[INFO]   Rounded: (101, 256)
[INFO]   Nearest: (100.0, 256.0)
[INFO]   Rounded: (70, 219)
[INFO]   Nearest: (70.0, 220.0)
[INFO]   Rounded: (21, 39)
[INFO]   Nearest: (20.0, 40.0)
[INFO]   Rounded: (90, 137)
[INFO]   Nearest: (90.0, 136.0)
[INFO]   Rounded: (271, 294)
[INFO]   Nearest: (272.0, 294.0)
[INFO]   Rounded: (176, 273)
[INFO]   Nearest: (176.0, 272.0)
[INFO]   Rounded: (182, 198)
[INFO]   Rounded: (202, 212)
[INFO]   Rounded: (52, 87)
[INFO]   Nearest: (52.0, 88.0)
[INFO]   Rounded: (34, 251)
[INFO]   Nearest: (34.0, 250.0)
[INFO]   Rounded: (33, 275)
[INFO]   Nearest: (34.0, 276.0)
[INFO]   Rounded: (123, 139)
[INFO]   Nearest: (122.0, 138.0)
[INFO]   Rounded: (82, 110)
[INFO]   Rounded: (84, 192)
[INFO]   Rounded: (195, 230)
[INFO]   Nearest: (196.0, 230.0)
[INFO]   Rounded: (98, 218)
[INFO]   Rounded: (26, 158)
[INFO]   Rounded: (159, 238)
[INFO]   Nearest: (158.0, 238.0)
[INFO]   Rounded: (119, 230)
[INFO]   Nearest: (120.0, 230.0)
[INFO]   Rounded: (116, 274)
[INFO]   Rounded: (46, 234)
[INFO]   Rounded: (236, 283)
[INFO]   Nearest: (236.0, 282.0)
[INFO]   Rounded: (128, 157)
[INFO]   Nearest: (128.0, 158.0)
[INFO]   Rounded: (123, 192)
[INFO]   Nearest: (122.0, 192.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(32/52) - Original Sharpe: 0.6984, Trades: 64
[INFO] Kmeans cluster 2: SMA(30/64) - Original Sharpe: 0.5101, Trades: 56
[INFO] Kmeans cluster 3: SMA(100/216) - Original Sharpe: 0.3991, Trades: 17
[INFO] Kmeans cluster 4: SMA(188/264) - Original Sharpe: 0.3940, Trades: 16
[INFO] Kmeans cluster 5: SMA(26/98) - Original Sharpe: 0.3878, Trades: 34
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (32/52) - Sharpe: 0.6984
[INFO] cluster 2: (30/64) - Sharpe: 0.5101
[INFO] cluster 3: (100/216) - Sharpe: 0.3991
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.967409            1.995758
1    2021-11-14 2021-11-14            44    -3.438860           -2.486038
2    2022-01-14 2022-01-14            41     1.436141            2.730878
3    2022-03-14 2022-03-14            44    -2.274052           -0.241435
4    2022-05-14 2022-05-14            43    -2.489614           -1.250504
5    2022-07-14 2022-07-14            44     1.425601            2.793397
6    2022-09-14 2022-09-14            43     0.424917           -0.407180
7    2022-11-14 2022-11-14            43    -1.042455           -3.533186
8    2023-01-14 2023-01-14            41     3.089660            2.583009
9    2023-03-14 2023-03-14            43    -2.849337           -0.033793
10   2023-05-14 2023-05-14            44    -0.357970           -0.688602
11   2023-07-14 2023-07-14            44     5.884227            2.820382
12   2023-09-14 2023-09-14            43    -1.305448           -1.963553
13   2023-11-14 2023-11-14            42     1.296328            1.458682
14   2024-01-14 2024-01-14            43    -0.582105            1.252026
15   2024-03-14 2024-03-14            42     0.280722            0.280722
16   2024-05-14 2024-05-14            44    -5.328325           -2.197026
17   2024-07-14 2024-07-14            45     0.233819           -0.906054
18   2024-09-14 2024-09-14            43    -1.778911           -1.794378
19   2024-11-14 2024-11-14            33    -0.446965           -2.218427
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              2.0 |          4.0 | True          
[INFO] 2021-11-14   |         -3.4 |             -2.5 |          0.9 | True          
[INFO] 2022-01-14   |          1.4 |              2.7 |          1.3 | True          
[INFO] 2022-03-14   |         -2.3 |             -0.2 |          2.1 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.3 |          1.2 | True          
[INFO] 2022-07-14   |          1.4 |              2.8 |          1.4 | True          
[INFO] 2022-09-14   |          0.4 |             -0.4 |         -0.8 | False         
[INFO] 2022-11-14   |         -1.0 |             -3.5 |         -2.5 | False         
[INFO] 2023-01-14   |          3.1 |              2.6 |         -0.5 | False         
[INFO] 2023-03-14   |         -2.8 |             -0.0 |          2.8 | True          
[INFO] 2023-05-14   |         -0.4 |             -0.7 |         -0.3 | False         
[INFO] 2023-07-14   |          5.9 |              2.8 |         -3.1 | False         
[INFO] 2023-09-14   |         -1.3 |             -2.0 |         -0.7 | False         
[INFO] 2023-11-14   |          1.3 |              1.5 |          0.2 | True          
[INFO] 2024-01-14   |         -0.6 |              1.3 |          1.9 | True          
[INFO] 2024-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -2.2 |          3.1 | True          
[INFO] 2024-07-14   |          0.2 |             -0.9 |         -1.1 | False         
[INFO] 2024-09-14   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -0.4 |             -2.2 |         -1.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 10 of 18 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for W...
[INFO] Excel file updated successfully. Added W with Kmeans win rate 55.6% in row 54
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(32/52) - Original Sharpe: 0.6984
[INFO] Added cluster 2 to portfolio: SMA(30/64) - Original Sharpe: 0.5101
[INFO] Added cluster 3 to portfolio: SMA(100/216) - Original Sharpe: 0.3991
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'W_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1355
[INFO] Kmeans Best out-of-sample Sharpe: -0.5502
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for W...
[INFO] Excel file updated successfully. Added W with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\W
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7249 to 0.8871
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.887053
[INFO] Number of Trades: 170
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7249 to 0.8871
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.3475 to 3.5609
[INFO] Scaled Trades range: -0.7942 to 16.0301
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5985
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 167 elements
[INFO] Cluster 1: 89 elements
[INFO] Cluster 2: 42 elements
[INFO] Cluster 3: 591 elements
[INFO] Cluster 4: 285 elements
[INFO] Cluster 5: 215 elements
[INFO] Cluster 6: 105 elements
[INFO] Cluster 7: 561 elements
[INFO] Cluster 8: 521 elements
[INFO] Cluster 9: 395 elements
[INFO] Cluster 10: 435 elements
[INFO] Cluster 11: 74 elements
[INFO] Cluster 12: 99 elements
[INFO] Cluster 13: 296 elements
[INFO] Cluster 14: 43 elements
[INFO] Cluster 15: 246 elements
[INFO] Cluster 16: 431 elements
[INFO] Cluster 17: 392 elements
[INFO] Cluster 18: 188 elements
[INFO] Cluster 19: 289 elements
[INFO] Cluster 20: 335 elements
[INFO] Cluster 21: 305 elements
[INFO] Cluster 22: 111 elements
[INFO] Cluster 23: 240 elements
[INFO] Cluster 24: 130 elements
[INFO] Cluster 25: 7 elements
[INFO] Cluster 26: 161 elements
[INFO] Cluster 27: 187 elements
[INFO] Cluster 28: 518 elements
[INFO] Cluster 29: 194 elements
[INFO] Cluster 30: 197 elements
[INFO] Cluster 31: 157 elements
[INFO] Cluster 32: 42 elements
[INFO] Cluster 33: 12 elements
[INFO] Cluster 34: 65 elements
[INFO] Cluster 35: 61 elements
[INFO] Cluster 36: 72 elements
[INFO] Cluster 37: 135 elements
[INFO] Cluster 38: 125 elements
[INFO] Cluster 39: 115 elements
[INFO] Cluster 40: 178 elements
[INFO] Cluster 41: 229 elements
[INFO] Cluster 42: 301 elements
[INFO] Cluster 43: 222 elements
[INFO] Cluster 44: 20 elements
[INFO] Cluster 45: 278 elements
[INFO] Cluster 46: 95 elements
[INFO] Cluster 47: 194 elements
[INFO] Cluster 48: 293 elements
[INFO] Cluster 49: 142 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=70, Long SMA=88, Sharpe=0.2531, Trades=47
[INFO] Cluster 1 cluster: Short SMA=198, Long SMA=204, Sharpe=0.4514, Trades=45
[INFO] Cluster 2 cluster: Short SMA=28, Long SMA=32, Sharpe=0.3654, Trades=132
[INFO] Cluster 3 cluster: Short SMA=90, Long SMA=266, Sharpe=0.1555, Trades=15
[INFO] Cluster 4 cluster: Short SMA=88, Long SMA=136, Sharpe=-0.3660, Trades=22
[INFO] Cluster 5 cluster: Short SMA=32, Long SMA=62, Sharpe=0.4990, Trades=56
[INFO] Cluster 6 cluster: Short SMA=148, Long SMA=154, Sharpe=-0.0178, Trades=58
[INFO] Cluster 7 cluster: Short SMA=182, Long SMA=256, Sharpe=0.2540, Trades=17
[INFO] Cluster 8 cluster: Short SMA=36, Long SMA=280, Sharpe=0.3306, Trades=16
[INFO] Cluster 9 cluster: Short SMA=132, Long SMA=224, Sharpe=0.2314, Trades=19
[INFO] Cluster 10 cluster: Short SMA=138, Long SMA=262, Sharpe=-0.0165, Trades=17
[INFO] Cluster 11 cluster: Short SMA=278, Long SMA=282, Sharpe=-0.2191, Trades=49
[INFO] Cluster 12 cluster: Short SMA=240, Long SMA=246, Sharpe=0.1933, Trades=42
[INFO] Cluster 13 cluster: Short SMA=30, Long SMA=106, Sharpe=0.3052, Trades=32
[INFO] Cluster 14 cluster: Short SMA=102, Long SMA=106, Sharpe=-0.3177, Trades=76
[INFO] Cluster 15 cluster: Short SMA=194, Long SMA=292, Sharpe=0.0495, Trades=15
[INFO] Cluster 16 cluster: Short SMA=226, Long SMA=260, Sharpe=0.1323, Trades=20
[INFO] Cluster 17 cluster: Short SMA=158, Long SMA=214, Sharpe=0.3615, Trades=17
[INFO] Cluster 18 cluster: Short SMA=124, Long SMA=156, Sharpe=-0.0645, Trades=29
[INFO] Cluster 19 cluster: Short SMA=36, Long SMA=226, Sharpe=0.1312, Trades=20
[INFO] Cluster 20 cluster: Short SMA=48, Long SMA=176, Sharpe=0.1779, Trades=20
[INFO] Cluster 21 cluster: Short SMA=62, Long SMA=136, Sharpe=0.0368, Trades=22
[INFO] Cluster 22 cluster: Short SMA=124, Long SMA=140, Sharpe=0.1168, Trades=37
[INFO] Cluster 23 cluster: Short SMA=22, Long SMA=86, Sharpe=0.4070, Trades=39
[INFO] Cluster 24 cluster: Short SMA=20, Long SMA=38, Sharpe=0.4185, Trades=78
[INFO] Cluster 26 cluster: Short SMA=236, Long SMA=286, Sharpe=-0.0726, Trades=19
[INFO] Cluster 27 cluster: Short SMA=112, Long SMA=202, Sharpe=0.3418, Trades=19
[INFO] Cluster 28 cluster: Short SMA=58, Long SMA=220, Sharpe=0.2035, Trades=18
[INFO] Cluster 29 cluster: Short SMA=154, Long SMA=178, Sharpe=0.3073, Trades=25
[INFO] Cluster 30 cluster: Short SMA=90, Long SMA=292, Sharpe=-0.0155, Trades=16
[INFO] Cluster 31 cluster: Short SMA=14, Long SMA=196, Sharpe=0.2707, Trades=34
[INFO] Cluster 32 cluster: Short SMA=64, Long SMA=66, Sharpe=0.3812, Trades=127
[INFO] Cluster 34 cluster: Short SMA=182, Long SMA=202, Sharpe=-0.0786, Trades=25
[INFO] Cluster 35 cluster: Short SMA=38, Long SMA=52, Sharpe=0.6611, Trades=70
[INFO] Cluster 36 cluster: Short SMA=96, Long SMA=110, Sharpe=-0.2382, Trades=40
[INFO] Cluster 37 cluster: Short SMA=146, Long SMA=292, Sharpe=-0.0538, Trades=14
[INFO] Cluster 38 cluster: Short SMA=86, Long SMA=196, Sharpe=-0.0587, Trades=19
[INFO] Cluster 39 cluster: Short SMA=186, Long SMA=266, Sharpe=0.3846, Trades=16
[INFO] Cluster 40 cluster: Short SMA=22, Long SMA=250, Sharpe=0.1943, Trades=24
[INFO] Cluster 41 cluster: Short SMA=116, Long SMA=180, Sharpe=0.1281, Trades=19
[INFO] Cluster 42 cluster: Short SMA=86, Long SMA=160, Sharpe=-0.0821, Trades=21
[INFO] Cluster 43 cluster: Short SMA=24, Long SMA=152, Sharpe=0.0782, Trades=28
[INFO] Cluster 44 cluster: Short SMA=138, Long SMA=140, Sharpe=0.1136, Trades=87
[INFO] Cluster 45 cluster: Short SMA=94, Long SMA=234, Sharpe=0.2197, Trades=13
[INFO] Cluster 46 cluster: Short SMA=38, Long SMA=180, Sharpe=0.3800, Trades=22
[INFO] Cluster 47 cluster: Short SMA=264, Long SMA=292, Sharpe=-0.2126, Trades=23
[INFO] Cluster 48 cluster: Short SMA=46, Long SMA=120, Sharpe=0.2232, Trades=22
[INFO] Cluster 49 cluster: Short SMA=196, Long SMA=222, Sharpe=0.2998, Trades=25
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8871, Trades=170
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=52, Sharpe=0.6611, Trades=70
[INFO] Top 2: Short SMA=32, Long SMA=62, Sharpe=0.4990, Trades=56
[INFO] Top 3: Short SMA=198, Long SMA=204, Sharpe=0.4514, Trades=45
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10566 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/52) - Original Sharpe: 0.6611, Trades: 70
[INFO] Hierarchical cluster 2: SMA(32/62) - Original Sharpe: 0.4990, Trades: 56
[INFO] Hierarchical cluster 3: SMA(198/204) - Original Sharpe: 0.4514, Trades: 45
[INFO] Hierarchical cluster 4: SMA(20/38) - Original Sharpe: 0.4185, Trades: 78
[INFO] Hierarchical cluster 5: SMA(22/86) - Original Sharpe: 0.4070, Trades: 39
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/52) - Sharpe: 0.6611
[INFO] cluster 2: (32/62) - Sharpe: 0.4990
[INFO] cluster 3: (198/204) - Sharpe: 0.4514
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.967409            0.939467
1    2021-11-14 2021-11-14            44    -3.438860           -2.440223
2    2022-01-14 2022-01-14            41     1.436141            2.920840
3    2022-03-14 2022-03-14            44    -2.274052            0.026981
4    2022-05-14 2022-05-14            43    -2.489614           -1.288618
5    2022-07-14 2022-07-14            44     1.425601            1.404730
6    2022-09-14 2022-09-14            43     0.424917            1.489596
7    2022-11-14 2022-11-14            43    -1.042455           -4.560456
8    2023-01-14 2023-01-14            41     3.089660            2.787021
9    2023-03-14 2023-03-14            43    -2.849337            0.559362
10   2023-05-14 2023-05-14            44    -0.357970           -1.761277
11   2023-07-14 2023-07-14            44     5.884227            1.361783
12   2023-09-14 2023-09-14            43    -1.305448           -0.571550
13   2023-11-14 2023-11-14            42     1.296328            2.469072
14   2024-01-14 2024-01-14            43    -0.582105           -0.032573
15   2024-03-14 2024-03-14            42     0.280722            0.280722
16   2024-05-14 2024-05-14            44    -5.328325           -1.465193
17   2024-07-14 2024-07-14            45     0.233819           -0.836219
18   2024-09-14 2024-09-14            43    -1.778911           -3.070610
19   2024-11-14 2024-11-14            33    -0.446965           -1.631488
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              0.9 |          2.9 | True          
[INFO] 2021-11-14   |         -3.4 |             -2.4 |          1.0 | True          
[INFO] 2022-01-14   |          1.4 |              2.9 |          1.5 | True          
[INFO] 2022-03-14   |         -2.3 |              0.0 |          2.3 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.3 |          1.2 | True          
[INFO] 2022-07-14   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.4 |              1.5 |          1.1 | True          
[INFO] 2022-11-14   |         -1.0 |             -4.6 |         -3.6 | False         
[INFO] 2023-01-14   |          3.1 |              2.8 |         -0.3 | False         
[INFO] 2023-03-14   |         -2.8 |              0.6 |          3.4 | True          
[INFO] 2023-05-14   |         -0.4 |             -1.8 |         -1.4 | False         
[INFO] 2023-07-14   |          5.9 |              1.4 |         -4.5 | False         
[INFO] 2023-09-14   |         -1.3 |             -0.6 |          0.7 | True          
[INFO] 2023-11-14   |          1.3 |              2.5 |          1.2 | True          
[INFO] 2024-01-14   |         -0.6 |             -0.0 |          0.6 | True          
[INFO] 2024-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -1.5 |          3.8 | True          
[INFO] 2024-07-14   |          0.2 |             -0.8 |         -1.0 | False         
[INFO] 2024-09-14   |         -1.8 |             -3.1 |         -1.3 | False         
[INFO] 2024-11-14   |         -0.4 |             -1.6 |         -1.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 18 periods (61.11% win rate)
[INFO] Updating Excel file with Hierarchical results for W...
[INFO] Excel file updated successfully. Added W with Hierarchical win rate 61.1% in row 54
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/52) - Original Sharpe: 0.6611
[INFO] Added cluster 2 to portfolio: SMA(32/62) - Original Sharpe: 0.4990
[INFO] Added cluster 3 to portfolio: SMA(198/204) - Original Sharpe: 0.4514
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'W_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1479
[INFO] Hierarchical Best out-of-sample Sharpe: -0.5502
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for W...
[INFO] Excel file updated successfully. Added W with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\W
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for WBS in column D: 17.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 103.57s
[INFO] Best parameters: Short SMA = 48, Long SMA = 50
[INFO] Best Sharpe ratio: 0.885528, Trades: 170
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Filtered out 0 bad combos; keeping 2117 of top 2117
[INFO] Master file path: '.\\master_daily_pnl.pkl', exists? True
[INFO] Columns AFTER append: ['SMA_AD_TOP5_106/160', 'SMA_AD_TOP5_98/174', 'SMA_AD_TOP5_102/160', 'SMA_AD_TOP5_104/158', 'SMA_AD_TOP5_106/156', 'SMA_BO_TOP5_48/54', 'SMA_BO_TOP5_48/66', 'SMA_BO_TOP5_50/54', 'SMA_BO_TOP5_48/56', 'SMA_BO_TOP5_50/52', 'SMA_BP_TOP5_42/58', 'SMA_BP_TOP5_38/60', 'SMA_BP_TOP5_40/58', 'SMA_BP_TOP5_16/114', 'SMA_BP_TOP5_16/120', 'SMA_BRN_TOP5_10/26', 'SMA_BRN_TOP5_10/20', 'SMA_BRN_TOP5_14/26', 'SMA_BRN_TOP5_10/24', 'SMA_BRN_TOP5_12/22', 'SMA_C_TOP5_118/134', 'SMA_C_TOP5_120/130', 'SMA_C_TOP5_116/136', 'SMA_C_TOP5_120/132', 'SMA_C_TOP5_122/126', 'SMA_CC_TOP5_118/134', 'SMA_CC_TOP5_120/130', 'SMA_CC_TOP5_116/136', 'SMA_CC_TOP5_120/132', 'SMA_CC_TOP5_122/126', 'SMA_CD_TOP5_38/44', 'SMA_CD_TOP5_16/22', 'SMA_CD_TOP5_18/52', 'SMA_CD_TOP5_14/24', 'SMA_CD_TOP5_20/46', 'SMA_CL_TOP5_48/50', 'SMA_CL_TOP5_42/48', 'SMA_CL_TOP5_38/40', 'SMA_CL_TOP5_12/30', 'SMA_CL_TOP5_38/60', 'SMA_CT_TOP5_34/46', 'SMA_CT_TOP5_32/46', 'SMA_CT_TOP5_38/42', 'SMA_CT_TOP5_40/42', 'SMA_CT_TOP5_38/44', 'SMA_DX_TOP5_38/46', 'SMA_DX_TOP5_32/52', 'SMA_DX_TOP5_36/46', 'SMA_DX_TOP5_38/44', 'SMA_DX_TOP5_40/42', 'SMA_EC_TOP5_102/106', 'SMA_EC_TOP5_104/106', 'SMA_EC_TOP5_100/108', 'SMA_EC_TOP5_100/112', 'SMA_EC_TOP5_100/102', 'SMA_EMD_TOP5_216/222', 'SMA_EMD_TOP5_216/224', 'SMA_EMD_TOP5_20/26', 'SMA_EMD_TOP5_22/26', 'SMA_EMD_TOP5_218/224', 'SMA_ES_TOP5_162/274', 'SMA_ES_TOP5_162/268', 'SMA_ES_TOP5_194/220', 'SMA_ES_TOP5_162/276', 'SMA_ES_TOP5_162/270', 'SMA_FC_TOP5_212/214', 'SMA_FC_TOP5_48/58', 'SMA_FC_TOP5_200/220', 'SMA_FC_TOP5_48/62', 'SMA_FC_TOP5_212/216', 'SMA_FDAX_TOP5_160/262', 'SMA_FDAX_TOP5_160/264', 'SMA_FDAX_TOP5_162/262', 'SMA_FDAX_TOP5_20/32', 'SMA_FDAX_TOP5_162/258', 'SMA_FESX_TOP5_106/108', 'SMA_FESX_TOP5_38/44', 'SMA_FESX_TOP5_108/254', 'SMA_FESX_TOP5_102/108', 'SMA_FESX_TOP5_186/200', 'SMA_FGBL_TOP5_36/62', 'SMA_FGBL_TOP5_38/66', 'SMA_FGBL_TOP5_252/258', 'SMA_FGBL_TOP5_242/270', 'SMA_FGBL_TOP5_38/62', 'SMA_FGBM_TOP5_222/234', 'SMA_FGBM_TOP5_206/228', 'SMA_FGBM_TOP5_222/236', 'SMA_FGBM_TOP5_208/228', 'SMA_FGBM_TOP5_224/226', 'SMA_FGBX_TOP5_50/56', 'SMA_FGBX_TOP5_42/44', 'SMA_FGBX_TOP5_46/52', 'SMA_FGBX_TOP5_44/48', 'SMA_FGBX_TOP5_44/54', 'SMA_FV_TOP5_72/80', 'SMA_FV_TOP5_66/80', 'SMA_FV_TOP5_154/158', 'SMA_FV_TOP5_68/80', 'SMA_FV_TOP5_74/78', 'SMA_GC_TOP5_34/40', 'SMA_GC_TOP5_34/38', 'SMA_GC_TOP5_32/40', 'SMA_GC_TOP5_34/36', 'SMA_GC_TOP5_32/38', 'SMA_HG_TOP5_202/204', 'SMA_HG_TOP5_36/48', 'SMA_HG_TOP5_250/252', 'SMA_HG_TOP5_30/48', 'SMA_HG_TOP5_86/266', 'SMA_HO_TOP5_22/28', 'SMA_HO_TOP5_22/26', 'SMA_HO_TOP5_46/50', 'SMA_HO_TOP5_24/28', 'SMA_HO_TOP5_144/180', 'SMA_JY_TOP5_58/60', 'SMA_JY_TOP5_254/256', 'SMA_JY_TOP5_62/70', 'SMA_JY_TOP5_60/70', 'SMA_JY_TOP5_56/60', 'SMA_KC_TOP5_126/144', 'SMA_KC_TOP5_126/142', 'SMA_KC_TOP5_134/136', 'SMA_KC_TOP5_126/146', 'SMA_KC_TOP5_130/136', 'SMA_KW_TOP5_218/300', 'SMA_KW_TOP5_222/292', 'SMA_KW_TOP5_216/300', 'SMA_KW_TOP5_218/294', 'SMA_KW_TOP5_228/300', 'SMA_LC_TOP5_132/256', 'SMA_LC_TOP5_140/246', 'SMA_LC_TOP5_142/244', 'SMA_LC_TOP5_128/262', 'SMA_LC_TOP5_142/246', 'SMA_LH_TOP5_22/32', 'SMA_LH_TOP5_20/32', 'SMA_LH_TOP5_18/34', 'SMA_LH_TOP5_20/34', 'SMA_LH_TOP5_22/30', 'SMA_LJ_TOP5_172/190', 'SMA_LJ_TOP5_172/186', 'SMA_LJ_TOP5_172/188', 'SMA_LJ_TOP5_170/190', 'SMA_LJ_TOP5_154/158', 'SMA_LZ_TOP5_156/158', 'SMA_LZ_TOP5_152/160', 'SMA_LZ_TOP5_150/164', 'SMA_LZ_TOP5_158/160', 'SMA_LZ_TOP5_156/166', 'SMA_MME_TOP5_42/46', 'SMA_MME_TOP5_20/22', 'SMA_MME_TOP5_214/244', 'SMA_MME_TOP5_26/48', 'SMA_MME_TOP5_24/60', 'SMA_MP1_TOP5_134/138', 'SMA_MP1_TOP5_40/42', 'SMA_MP1_TOP5_280/296', 'SMA_MP1_TOP5_126/192', 'SMA_MP1_TOP5_296/298', 'SMA_NE1_TOP5_158/288', 'SMA_NE1_TOP5_256/258', 'SMA_NE1_TOP5_254/258', 'SMA_NE1_TOP5_160/284', 'SMA_NE1_TOP5_160/286', 'SMA_NG_TOP5_38/96', 'SMA_NG_TOP5_66/188', 'SMA_NG_TOP5_66/190', 'SMA_NG_TOP5_80/154', 'SMA_NG_TOP5_68/110', 'SMA_NK_TOP5_20/22', 'SMA_NK_TOP5_168/194', 'SMA_NK_TOP5_156/198', 'SMA_NK_TOP5_168/196', 'SMA_NK_TOP5_154/200', 'SMA_NQ_TOP5_210/234', 'SMA_NQ_TOP5_198/252', 'SMA_NQ_TOP5_208/244', 'SMA_NQ_TOP5_208/238', 'SMA_NQ_TOP5_212/232', 'SMA_PA_TOP5_112/174', 'SMA_PA_TOP5_108/174', 'SMA_PA_TOP5_112/176', 'SMA_PA_TOP5_104/180', 'SMA_PA_TOP5_104/174', 'SMA_PL_TOP5_122/126', 'SMA_PL_TOP5_132/138', 'SMA_PL_TOP5_120/122', 'SMA_PL_TOP5_118/124', 'SMA_PL_TOP5_120/144', 'SMA_RB_TOP5_42/50', 'SMA_RB_TOP5_46/50', 'SMA_RB_TOP5_44/50', 'SMA_RB_TOP5_42/94', 'SMA_RB_TOP5_44/52', 'SMA_RTY_TOP5_122/142', 'SMA_RTY_TOP5_208/234', 'SMA_RTY_TOP5_120/146', 'SMA_RTY_TOP5_120/144', 'SMA_RTY_TOP5_22/24', 'SMA_S_TOP5_180/184', 'SMA_S_TOP5_182/184', 'SMA_S_TOP5_180/182', 'SMA_S_TOP5_54/170', 'SMA_S_TOP5_52/172', 'SMA_SB_TOP5_180/184', 'SMA_SB_TOP5_182/184', 'SMA_SB_TOP5_180/182', 'SMA_SB_TOP5_54/170', 'SMA_SB_TOP5_52/172', 'SMA_SF_TOP5_192/194', 'SMA_SF_TOP5_186/204', 'SMA_SF_TOP5_190/196', 'SMA_SF_TOP5_186/206', 'SMA_SF_TOP5_184/206', 'SMA_SI_TOP5_48/50', 'SMA_SI_TOP5_42/58', 'SMA_SI_TOP5_44/56', 'SMA_SI_TOP5_40/60', 'SMA_SI_TOP5_234/258', 'SMA_SM_TOP5_70/74', 'SMA_SM_TOP5_12/20', 'SMA_SM_TOP5_14/22', 'SMA_SM_TOP5_66/78', 'SMA_SM_TOP5_14/24', 'SMA_TEN_TOP5_58/76', 'SMA_TEN_TOP5_60/76', 'SMA_TEN_TOP5_60/74', 'SMA_TEN_TOP5_40/44', 'SMA_TEN_TOP5_58/74', 'SMA_TY_TOP5_56/82', 'SMA_TY_TOP5_54/84', 'SMA_TY_TOP5_56/84', 'SMA_TY_TOP5_60/78', 'SMA_TY_TOP5_66/70', 'SMA_TU_TOP5_274/284', 'SMA_TU_TOP5_272/288', 'SMA_TU_TOP5_274/282', 'SMA_TU_TOP5_272/284', 'SMA_TU_TOP5_276/278', 'SMA_UB_TOP5_62/80', 'SMA_UB_TOP5_62/82', 'SMA_UB_TOP5_68/72', 'SMA_UB_TOP5_70/72', 'SMA_UB_TOP5_52/70', 'SMA_ULS_TOP5_166/168', 'SMA_ULS_TOP5_164/170', 'SMA_ULS_TOP5_180/214', 'SMA_ULS_TOP5_166/172', 'SMA_ULS_TOP5_10/30', 'SMA_US_TOP5_62/94', 'SMA_US_TOP5_58/92', 'SMA_US_TOP5_50/54', 'SMA_US_TOP5_62/96', 'SMA_US_TOP5_58/94', 'SMA_VX_TOP5_20/26', 'SMA_VX_TOP5_18/40', 'SMA_VX_TOP5_20/28', 'SMA_VX_TOP5_20/38', 'SMA_VX_TOP5_20/24', 'SMA_W_TOP5_48/50', 'SMA_W_TOP5_42/48', 'SMA_W_TOP5_38/60', 'SMA_W_TOP5_38/58', 'SMA_W_TOP5_42/50', 'SMA_WBS_TOP5_48/50', 'SMA_WBS_TOP5_42/48', 'SMA_WBS_TOP5_38/60', 'SMA_WBS_TOP5_38/58', 'SMA_WBS_TOP5_42/50']
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @WBS=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.86 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $386,182.00
[INFO] Market Buy & Hold P&L: $-29,470.00
[INFO] Outperformance: $415,652.00
[INFO] Sharpe ratio (entire period, annualized): 0.438437
[INFO] Sharpe ratio (in-sample, annualized): 0.885528
[INFO] Sharpe ratio (out-of-sample, annualized): -0.551536
[INFO] Maximum Drawdown: $231,617.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 108
[INFO] Out-of-sample period trades: 62
[INFO] Total trades: 170
[INFO] In-sample P&L: $527,382.00
[INFO] Out-of-sample P&L: $-148,144.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.885528
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7259 to 0.8855
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.885528
[INFO] Number of Trades: 170
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7259 to 0.8855
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.3515 to 3.5551
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 304 elements
[INFO] Kmeans Cluster 1: 245 elements
[INFO] Kmeans Cluster 2: 110 elements
[INFO] Kmeans Cluster 3: 224 elements
[INFO] Kmeans Cluster 4: 269 elements
[INFO] Kmeans Cluster 5: 216 elements
[INFO] Kmeans Cluster 6: 227 elements
[INFO] Kmeans Cluster 7: 325 elements
[INFO] Kmeans Cluster 8: 210 elements
[INFO] Kmeans Cluster 9: 171 elements
[INFO] Kmeans Cluster 10: 207 elements
[INFO] Kmeans Cluster 11: 195 elements
[INFO] Kmeans Cluster 12: 184 elements
[INFO] Kmeans Cluster 13: 194 elements
[INFO] Kmeans Cluster 14: 207 elements
[INFO] Kmeans Cluster 15: 134 elements
[INFO] Kmeans Cluster 16: 194 elements
[INFO] Kmeans Cluster 17: 95 elements
[INFO] Kmeans Cluster 18: 95 elements
[INFO] Kmeans Cluster 19: 232 elements
[INFO] Kmeans Cluster 20: 192 elements
[INFO] Kmeans Cluster 21: 173 elements
[INFO] Kmeans Cluster 22: 208 elements
[INFO] Kmeans Cluster 23: 239 elements
[INFO] Kmeans Cluster 24: 126 elements
[INFO] Kmeans Cluster 25: 254 elements
[INFO] Kmeans Cluster 26: 267 elements
[INFO] Kmeans Cluster 27: 278 elements
[INFO] Kmeans Cluster 28: 239 elements
[INFO] Kmeans Cluster 29: 111 elements
[INFO] Kmeans Cluster 30: 264 elements
[INFO] Kmeans Cluster 31: 180 elements
[INFO] Kmeans Cluster 32: 186 elements
[INFO] Kmeans Cluster 33: 190 elements
[INFO] Kmeans Cluster 34: 337 elements
[INFO] Kmeans Cluster 35: 233 elements
[INFO] Kmeans Cluster 36: 320 elements
[INFO] Kmeans Cluster 37: 314 elements
[INFO] Kmeans Cluster 38: 171 elements
[INFO] Kmeans Cluster 39: 75 elements
[INFO] Kmeans Cluster 40: 101 elements
[INFO] Kmeans Cluster 41: 320 elements
[INFO] Kmeans Cluster 42: 93 elements
[INFO] Kmeans Cluster 43: 293 elements
[INFO] Kmeans Cluster 44: 237 elements
[INFO] Kmeans Cluster 45: 190 elements
[INFO] Kmeans Cluster 46: 254 elements
[INFO] Kmeans Cluster 47: 303 elements
[INFO] Kmeans Cluster 48: 226 elements
[INFO] Kmeans Cluster 49: 173 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=172.17, Long SMA=228.46, Sharpe=0.1686
[INFO] Centroid 1: Short SMA=56.16, Long SMA=142.73, Sharpe=0.0381
[INFO] Centroid 2: Short SMA=20.65, Long SMA=38.53, Sharpe=0.3267
[INFO] Centroid 3: Short SMA=62.57, Long SMA=187.30, Sharpe=0.1780
[INFO] Centroid 4: Short SMA=239.14, Long SMA=281.98, Sharpe=-0.0544
[INFO] Centroid 5: Short SMA=91.94, Long SMA=141.85, Sharpe=-0.2234
[INFO] Centroid 6: Short SMA=81.37, Long SMA=280.96, Sharpe=0.1395
[INFO] Centroid 7: Short SMA=228.54, Long SMA=258.71, Sharpe=0.1042
[INFO] Centroid 8: Short SMA=152.94, Long SMA=177.52, Sharpe=0.3926
[INFO] Centroid 9: Short SMA=24.84, Long SMA=132.74, Sharpe=0.3031
[INFO] Centroid 10: Short SMA=104.55, Long SMA=256.03, Sharpe=0.2789
[INFO] Centroid 11: Short SMA=148.22, Long SMA=290.11, Sharpe=-0.0833
[INFO] Centroid 12: Short SMA=186.15, Long SMA=262.00, Sharpe=0.3514
[INFO] Centroid 13: Short SMA=47.60, Long SMA=276.79, Sharpe=0.4058
[INFO] Centroid 14: Short SMA=25.87, Long SMA=56.18, Sharpe=0.5221
[INFO] Centroid 15: Short SMA=122.84, Long SMA=140.25, Sharpe=0.1196
[INFO] Centroid 16: Short SMA=85.23, Long SMA=172.65, Sharpe=-0.1092
[INFO] Centroid 17: Short SMA=92.36, Long SMA=122.02, Sharpe=-0.4889
[INFO] Centroid 18: Short SMA=181.71, Long SMA=198.04, Sharpe=-0.0476
[INFO] Centroid 19: Short SMA=34.91, Long SMA=130.17, Sharpe=0.1936
[INFO] Centroid 20: Short SMA=67.92, Long SMA=91.97, Sharpe=0.1721
[INFO] Centroid 21: Short SMA=188.98, Long SMA=290.77, Sharpe=0.0474
[INFO] Centroid 22: Short SMA=43.74, Long SMA=233.94, Sharpe=0.0898
[INFO] Centroid 23: Short SMA=178.58, Long SMA=271.48, Sharpe=0.2057
[INFO] Centroid 24: Short SMA=77.94, Long SMA=110.62, Sharpe=-0.0837
[INFO] Centroid 25: Short SMA=31.29, Long SMA=250.87, Sharpe=0.2779
[INFO] Centroid 26: Short SMA=124.46, Long SMA=185.03, Sharpe=0.1881
[INFO] Centroid 27: Short SMA=44.81, Long SMA=89.82, Sharpe=0.3016
[INFO] Centroid 28: Short SMA=111.87, Long SMA=203.57, Sharpe=0.3445
[INFO] Centroid 29: Short SMA=13.87, Long SMA=271.95, Sharpe=0.4443
[INFO] Centroid 30: Short SMA=263.55, Long SMA=290.81, Sharpe=-0.2316
[INFO] Centroid 31: Short SMA=80.32, Long SMA=191.28, Sharpe=0.0502
[INFO] Centroid 32: Short SMA=90.84, Long SMA=132.82, Sharpe=-0.3467
[INFO] Centroid 33: Short SMA=121.86, Long SMA=270.51, Sharpe=0.1601
[INFO] Centroid 34: Short SMA=144.50, Long SMA=256.49, Sharpe=0.0509
[INFO] Centroid 35: Short SMA=24.66, Long SMA=165.07, Sharpe=0.1259
[INFO] Centroid 36: Short SMA=163.47, Long SMA=209.99, Sharpe=0.2818
[INFO] Centroid 37: Short SMA=73.23, Long SMA=223.41, Sharpe=0.2899
[INFO] Centroid 38: Short SMA=125.09, Long SMA=150.18, Sharpe=-0.0282
[INFO] Centroid 39: Short SMA=197.95, Long SMA=208.59, Sharpe=0.4892
[INFO] Centroid 40: Short SMA=30.51, Long SMA=50.44, Sharpe=0.6978
[INFO] Centroid 41: Short SMA=26.12, Long SMA=209.69, Sharpe=0.2082
[INFO] Centroid 42: Short SMA=134.71, Long SMA=159.05, Sharpe=-0.1980
[INFO] Centroid 43: Short SMA=31.06, Long SMA=87.62, Sharpe=0.4105
[INFO] Centroid 44: Short SMA=76.70, Long SMA=255.20, Sharpe=0.2074
[INFO] Centroid 45: Short SMA=38.77, Long SMA=186.25, Sharpe=0.3156
[INFO] Centroid 46: Short SMA=124.26, Long SMA=226.76, Sharpe=0.2119
[INFO] Centroid 47: Short SMA=213.31, Long SMA=243.72, Sharpe=0.2184
[INFO] Centroid 48: Short SMA=35.88, Long SMA=285.99, Sharpe=0.3094
[INFO] Centroid 49: Short SMA=100.95, Long SMA=292.07, Sharpe=0.0142
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8855, Trades=170
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=36, Long SMA=52, Sharpe=0.7468, Trades=64
[INFO] Kmeans Top 2: Short SMA=14, Long SMA=274, Sharpe=0.5082, Trades=20
[INFO] Kmeans Top 3: Short SMA=200, Long SMA=212, Sharpe=0.4895, Trades=31
[INFO] Kmeans Top 4: Short SMA=186, Long SMA=264, Sharpe=0.4713, Trades=16
[INFO] Kmeans Top 5: Short SMA=26, Long SMA=56, Sharpe=0.4290, Trades=58
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (172, 228)
[INFO]   Rounded: (56, 143)
[INFO]   Nearest: (56.0, 142.0)
[INFO]   Rounded: (21, 39)
[INFO]   Nearest: (20.0, 38.0)
[INFO]   Rounded: (63, 187)
[INFO]   Nearest: (62.0, 188.0)
[INFO]   Rounded: (239, 282)
[INFO]   Nearest: (240.0, 282.0)
[INFO]   Rounded: (92, 142)
[INFO]   Rounded: (81, 281)
[INFO]   Nearest: (82.0, 280.0)
[INFO]   Rounded: (229, 259)
[INFO]   Nearest: (228.0, 258.0)
[INFO]   Rounded: (153, 178)
[INFO]   Nearest: (152.0, 178.0)
[INFO]   Rounded: (25, 133)
[INFO]   Nearest: (24.0, 132.0)
[INFO]   Rounded: (105, 256)
[INFO]   Nearest: (104.0, 256.0)
[INFO]   Rounded: (148, 290)
[INFO]   Rounded: (186, 262)
[INFO]   Rounded: (48, 277)
[INFO]   Nearest: (48.0, 276.0)
[INFO]   Rounded: (26, 56)
[INFO]   Rounded: (123, 140)
[INFO]   Nearest: (122.0, 140.0)
[INFO]   Rounded: (85, 173)
[INFO]   Nearest: (86.0, 172.0)
[INFO]   Rounded: (92, 122)
[INFO]   Rounded: (182, 198)
[INFO]   Rounded: (35, 130)
[INFO]   Nearest: (34.0, 130.0)
[INFO]   Rounded: (68, 92)
[INFO]   Rounded: (189, 291)
[INFO]   Nearest: (188.0, 290.0)
[INFO]   Rounded: (44, 234)
[INFO]   Rounded: (179, 271)
[INFO]   Nearest: (178.0, 272.0)
[INFO]   Rounded: (78, 111)
[INFO]   Nearest: (78.0, 110.0)
[INFO]   Rounded: (31, 251)
[INFO]   Nearest: (32.0, 250.0)
[INFO]   Rounded: (124, 185)
[INFO]   Nearest: (124.0, 186.0)
[INFO]   Rounded: (45, 90)
[INFO]   Nearest: (44.0, 90.0)
[INFO]   Rounded: (112, 204)
[INFO]   Rounded: (14, 272)
[INFO]   Rounded: (264, 291)
[INFO]   Nearest: (264.0, 290.0)
[INFO]   Rounded: (80, 191)
[INFO]   Nearest: (80.0, 192.0)
[INFO]   Rounded: (91, 133)
[INFO]   Nearest: (90.0, 132.0)
[INFO]   Rounded: (122, 271)
[INFO]   Nearest: (122.0, 270.0)
[INFO]   Rounded: (144, 256)
[INFO]   Rounded: (25, 165)
[INFO]   Nearest: (24.0, 166.0)
[INFO]   Rounded: (163, 210)
[INFO]   Nearest: (164.0, 210.0)
[INFO]   Rounded: (73, 223)
[INFO]   Nearest: (74.0, 224.0)
[INFO]   Rounded: (125, 150)
[INFO]   Nearest: (126.0, 150.0)
[INFO]   Rounded: (198, 209)
[INFO]   Nearest: (198.0, 208.0)
[INFO]   Rounded: (31, 50)
[INFO]   Nearest: (30.0, 50.0)
[INFO]   Rounded: (26, 210)
[INFO]   Rounded: (135, 159)
[INFO]   Nearest: (134.0, 160.0)
[INFO]   Rounded: (31, 88)
[INFO]   Nearest: (32.0, 88.0)
[INFO]   Rounded: (77, 255)
[INFO]   Nearest: (76.0, 256.0)
[INFO]   Rounded: (39, 186)
[INFO]   Nearest: (38.0, 186.0)
[INFO]   Rounded: (124, 227)
[INFO]   Nearest: (124.0, 226.0)
[INFO]   Rounded: (213, 244)
[INFO]   Nearest: (214.0, 244.0)
[INFO]   Rounded: (36, 286)
[INFO]   Rounded: (101, 292)
[INFO]   Nearest: (100.0, 292.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(36/52) - Original Sharpe: 0.7468, Trades: 64
[INFO] Kmeans cluster 2: SMA(14/274) - Original Sharpe: 0.5082, Trades: 20
[INFO] Kmeans cluster 3: SMA(200/212) - Original Sharpe: 0.4895, Trades: 31
[INFO] Kmeans cluster 4: SMA(186/264) - Original Sharpe: 0.4713, Trades: 16
[INFO] Kmeans cluster 5: SMA(26/56) - Original Sharpe: 0.4290, Trades: 58
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] Updated KMeans top-5 daily-PnL file: .\top5_kmeans_strategies_daily_pnl.pkl
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (36/52) - Sharpe: 0.7468
[INFO] cluster 2: (14/274) - Sharpe: 0.5082
[INFO] cluster 3: (200/212) - Sharpe: 0.4895
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.969108            2.636553
1    2021-11-14 2021-11-14            44    -3.439143           -1.406741
2    2022-01-14 2022-01-14            41     1.435275            3.226370
3    2022-03-14 2022-03-14            44    -2.274282            0.026893
4    2022-05-14 2022-05-14            43    -2.490349           -1.241897
5    2022-07-14 2022-07-14            44     1.424645            0.015857
6    2022-09-14 2022-09-14            43     0.423005           -2.472217
7    2022-11-14 2022-11-14            43    -1.044126           -4.062387
8    2023-01-14 2023-01-14            41     3.087546            2.279178
9    2023-03-14 2023-03-14            43    -2.851713            0.459602
10   2023-05-14 2023-05-14            44    -0.359960           -2.565350
11   2023-07-14 2023-07-14            44     5.881769            0.585246
12   2023-09-14 2023-09-14            43    -1.305448           -2.037940
13   2023-11-14 2023-11-14            42     1.295824           -0.825099
14   2024-01-14 2024-01-14            43    -0.582717            1.562701
15   2024-03-14 2024-03-14            42     0.280722            0.280722
16   2024-05-14 2024-05-14            44    -5.331792           -0.811660
17   2024-07-14 2024-07-14            45     0.232453           -1.964997
18   2024-09-14 2024-09-14            43    -1.780293           -0.759452
19   2024-11-14 2024-11-14            33    -0.454091           -3.311903
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              2.6 |          4.6 | True          
[INFO] 2021-11-14   |         -3.4 |             -1.4 |          2.0 | True          
[INFO] 2022-01-14   |          1.4 |              3.2 |          1.8 | True          
[INFO] 2022-03-14   |         -2.3 |              0.0 |          2.3 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.2 |          1.3 | True          
[INFO] 2022-07-14   |          1.4 |              0.0 |         -1.4 | False         
[INFO] 2022-09-14   |          0.4 |             -2.5 |         -2.9 | False         
[INFO] 2022-11-14   |         -1.0 |             -4.1 |         -3.1 | False         
[INFO] 2023-01-14   |          3.1 |              2.3 |         -0.8 | False         
[INFO] 2023-03-14   |         -2.9 |              0.5 |          3.4 | True          
[INFO] 2023-05-14   |         -0.4 |             -2.6 |         -2.2 | False         
[INFO] 2023-07-14   |          5.9 |              0.6 |         -5.3 | False         
[INFO] 2023-09-14   |         -1.3 |             -2.0 |         -0.7 | False         
[INFO] 2023-11-14   |          1.3 |             -0.8 |         -2.1 | False         
[INFO] 2024-01-14   |         -0.6 |              1.6 |          2.2 | True          
[INFO] 2024-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -0.8 |          4.5 | True          
[INFO] 2024-07-14   |          0.2 |             -2.0 |         -2.2 | False         
[INFO] 2024-09-14   |         -1.8 |             -0.8 |          1.0 | True          
[INFO] 2024-11-14   |         -0.5 |             -3.3 |         -2.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 9 of 19 periods (47.37% win rate)
[INFO] Updating Excel file with Kmeans results for WBS...
[INFO] Excel file updated successfully. Added WBS with Kmeans win rate 47.4% in row 55
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(36/52) - Original Sharpe: 0.7468
[INFO] Added cluster 2 to portfolio: SMA(14/274) - Original Sharpe: 0.5082
[INFO] Added cluster 3 to portfolio: SMA(200/212) - Original Sharpe: 0.4895
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'WBS_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1711
[INFO] Kmeans Best out-of-sample Sharpe: -0.5515
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for WBS...
[INFO] Excel file updated successfully. Added WBS with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\WBS
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7259 to 0.8855
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.885528
[INFO] Number of Trades: 170
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7259 to 0.8855
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.3515 to 3.5551
[INFO] Scaled Trades range: -0.7942 to 16.0301
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5985
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 131 elements
[INFO] Cluster 1: 561 elements
[INFO] Cluster 2: 285 elements
[INFO] Cluster 3: 329 elements
[INFO] Cluster 4: 521 elements
[INFO] Cluster 5: 42 elements
[INFO] Cluster 6: 358 elements
[INFO] Cluster 7: 188 elements
[INFO] Cluster 8: 43 elements
[INFO] Cluster 9: 246 elements
[INFO] Cluster 10: 302 elements
[INFO] Cluster 11: 145 elements
[INFO] Cluster 12: 594 elements
[INFO] Cluster 13: 296 elements
[INFO] Cluster 14: 105 elements
[INFO] Cluster 15: 42 elements
[INFO] Cluster 16: 518 elements
[INFO] Cluster 17: 161 elements
[INFO] Cluster 18: 74 elements
[INFO] Cluster 19: 71 elements
[INFO] Cluster 20: 301 elements
[INFO] Cluster 21: 431 elements
[INFO] Cluster 22: 142 elements
[INFO] Cluster 23: 305 elements
[INFO] Cluster 24: 100 elements
[INFO] Cluster 25: 99 elements
[INFO] Cluster 26: 335 elements
[INFO] Cluster 27: 289 elements
[INFO] Cluster 28: 435 elements
[INFO] Cluster 29: 111 elements
[INFO] Cluster 30: 157 elements
[INFO] Cluster 31: 197 elements
[INFO] Cluster 32: 7 elements
[INFO] Cluster 33: 12 elements
[INFO] Cluster 34: 441 elements
[INFO] Cluster 35: 65 elements
[INFO] Cluster 36: 72 elements
[INFO] Cluster 37: 135 elements
[INFO] Cluster 38: 125 elements
[INFO] Cluster 39: 178 elements
[INFO] Cluster 40: 128 elements
[INFO] Cluster 41: 224 elements
[INFO] Cluster 42: 222 elements
[INFO] Cluster 43: 115 elements
[INFO] Cluster 44: 20 elements
[INFO] Cluster 45: 278 elements
[INFO] Cluster 46: 95 elements
[INFO] Cluster 47: 194 elements
[INFO] Cluster 48: 293 elements
[INFO] Cluster 49: 67 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=176, Long SMA=184, Sharpe=0.3371, Trades=47
[INFO] Cluster 1 cluster: Short SMA=182, Long SMA=256, Sharpe=0.2538, Trades=17
[INFO] Cluster 2 cluster: Short SMA=88, Long SMA=136, Sharpe=-0.3663, Trades=22
[INFO] Cluster 3 cluster: Short SMA=128, Long SMA=190, Sharpe=0.3310, Trades=19
[INFO] Cluster 4 cluster: Short SMA=36, Long SMA=280, Sharpe=0.3304, Trades=16
[INFO] Cluster 5 cluster: Short SMA=28, Long SMA=32, Sharpe=0.3642, Trades=132
[INFO] Cluster 6 cluster: Short SMA=120, Long SMA=244, Sharpe=0.2648, Trades=17
[INFO] Cluster 7 cluster: Short SMA=124, Long SMA=156, Sharpe=-0.0648, Trades=29
[INFO] Cluster 8 cluster: Short SMA=102, Long SMA=106, Sharpe=-0.3184, Trades=76
[INFO] Cluster 9 cluster: Short SMA=194, Long SMA=292, Sharpe=0.0494, Trades=15
[INFO] Cluster 10 cluster: Short SMA=24, Long SMA=82, Sharpe=0.4209, Trades=42
[INFO] Cluster 11 cluster: Short SMA=24, Long SMA=42, Sharpe=0.3820, Trades=74
[INFO] Cluster 12 cluster: Short SMA=154, Long SMA=214, Sharpe=0.2467, Trades=17
[INFO] Cluster 13 cluster: Short SMA=30, Long SMA=106, Sharpe=0.3049, Trades=32
[INFO] Cluster 14 cluster: Short SMA=148, Long SMA=154, Sharpe=-0.0183, Trades=58
[INFO] Cluster 15 cluster: Short SMA=64, Long SMA=66, Sharpe=0.3801, Trades=127
[INFO] Cluster 16 cluster: Short SMA=58, Long SMA=220, Sharpe=0.2033, Trades=18
[INFO] Cluster 17 cluster: Short SMA=236, Long SMA=286, Sharpe=-0.0728, Trades=19
[INFO] Cluster 18 cluster: Short SMA=278, Long SMA=282, Sharpe=-0.2195, Trades=49
[INFO] Cluster 19 cluster: Short SMA=36, Long SMA=50, Sharpe=0.7976, Trades=72
[INFO] Cluster 20 cluster: Short SMA=86, Long SMA=160, Sharpe=-0.0824, Trades=21
[INFO] Cluster 21 cluster: Short SMA=226, Long SMA=260, Sharpe=0.1321, Trades=20
[INFO] Cluster 22 cluster: Short SMA=196, Long SMA=222, Sharpe=0.2995, Trades=25
[INFO] Cluster 23 cluster: Short SMA=62, Long SMA=136, Sharpe=0.0365, Trades=22
[INFO] Cluster 24 cluster: Short SMA=70, Long SMA=92, Sharpe=0.1722, Trades=43
[INFO] Cluster 25 cluster: Short SMA=240, Long SMA=246, Sharpe=0.1929, Trades=42
[INFO] Cluster 26 cluster: Short SMA=48, Long SMA=176, Sharpe=0.1777, Trades=20
[INFO] Cluster 27 cluster: Short SMA=36, Long SMA=226, Sharpe=0.1310, Trades=20
[INFO] Cluster 28 cluster: Short SMA=138, Long SMA=262, Sharpe=-0.0167, Trades=17
[INFO] Cluster 29 cluster: Short SMA=124, Long SMA=140, Sharpe=0.1164, Trades=37
[INFO] Cluster 30 cluster: Short SMA=14, Long SMA=196, Sharpe=0.2704, Trades=34
[INFO] Cluster 31 cluster: Short SMA=90, Long SMA=292, Sharpe=-0.0157, Trades=16
[INFO] Cluster 34 cluster: Short SMA=80, Long SMA=264, Sharpe=0.2194, Trades=17
[INFO] Cluster 35 cluster: Short SMA=182, Long SMA=202, Sharpe=-0.0788, Trades=25
[INFO] Cluster 36 cluster: Short SMA=96, Long SMA=110, Sharpe=-0.2386, Trades=40
[INFO] Cluster 37 cluster: Short SMA=146, Long SMA=292, Sharpe=-0.0540, Trades=14
[INFO] Cluster 38 cluster: Short SMA=86, Long SMA=196, Sharpe=-0.0589, Trades=19
[INFO] Cluster 39 cluster: Short SMA=22, Long SMA=250, Sharpe=0.1941, Trades=24
[INFO] Cluster 40 cluster: Short SMA=26, Long SMA=58, Sharpe=0.5397, Trades=58
[INFO] Cluster 41 cluster: Short SMA=116, Long SMA=180, Sharpe=0.1278, Trades=19
[INFO] Cluster 42 cluster: Short SMA=24, Long SMA=152, Sharpe=0.0779, Trades=28
[INFO] Cluster 43 cluster: Short SMA=186, Long SMA=266, Sharpe=0.3844, Trades=16
[INFO] Cluster 44 cluster: Short SMA=138, Long SMA=140, Sharpe=0.1129, Trades=87
[INFO] Cluster 45 cluster: Short SMA=94, Long SMA=234, Sharpe=0.2195, Trades=13
[INFO] Cluster 46 cluster: Short SMA=38, Long SMA=180, Sharpe=0.3797, Trades=22
[INFO] Cluster 47 cluster: Short SMA=264, Long SMA=292, Sharpe=-0.2128, Trades=23
[INFO] Cluster 48 cluster: Short SMA=46, Long SMA=120, Sharpe=0.2229, Trades=22
[INFO] Cluster 49 cluster: Short SMA=74, Long SMA=84, Sharpe=0.2665, Trades=57
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8855, Trades=170
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=36, Long SMA=50, Sharpe=0.7976, Trades=72
[INFO] Top 2: Short SMA=26, Long SMA=58, Sharpe=0.5397, Trades=58
[INFO] Top 3: Short SMA=24, Long SMA=82, Sharpe=0.4209, Trades=42
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10566 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(36/50) - Original Sharpe: 0.7976, Trades: 72
[INFO] Hierarchical cluster 2: SMA(26/58) - Original Sharpe: 0.5397, Trades: 58
[INFO] Hierarchical cluster 3: SMA(24/82) - Original Sharpe: 0.4209, Trades: 42
[INFO] Hierarchical cluster 4: SMA(186/266) - Original Sharpe: 0.3844, Trades: 16
[INFO] Hierarchical cluster 5: SMA(24/42) - Original Sharpe: 0.3820, Trades: 74
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] Updated Hierarchical top-5 daily-PnL file: .\top5_hierarchy_strategies_daily_pnl.pkl
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (36/50) - Sharpe: 0.7976
[INFO] cluster 2: (26/58) - Sharpe: 0.5397
[INFO] cluster 3: (24/82) - Sharpe: 0.4209
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.969108            0.091224
1    2021-11-14 2021-11-14            44    -3.439143           -3.607556
2    2022-01-14 2022-01-14            41     1.435275            2.631849
3    2022-03-14 2022-03-14            44    -2.274282           -0.241525
4    2022-05-14 2022-05-14            43    -2.490349           -1.622520
5    2022-07-14 2022-07-14            44     1.424645            2.265683
6    2022-09-14 2022-09-14            43     0.423005           -0.559552
7    2022-11-14 2022-11-14            43    -1.044126           -2.522884
8    2023-01-14 2023-01-14            41     3.087546            1.047232
9    2023-03-14 2023-03-14            43    -2.851713           -1.752452
10   2023-05-14 2023-05-14            44    -0.359960           -1.741991
11   2023-07-14 2023-07-14            44     5.881769            3.955995
12   2023-09-14 2023-09-14            43    -1.305448           -1.861232
13   2023-11-14 2023-11-14            42     1.295824            0.619975
14   2024-01-14 2024-01-14            43    -0.582717            1.002612
15   2024-03-14 2024-03-14            42     0.280722            0.280722
16   2024-05-14 2024-05-14            44    -5.331792           -2.320956
17   2024-07-14 2024-07-14            45     0.232453            0.375567
18   2024-09-14 2024-09-14            43    -1.780293           -0.755620
19   2024-11-14 2024-11-14            33    -0.454091           -2.244215
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              0.1 |          2.1 | True          
[INFO] 2021-11-14   |         -3.4 |             -3.6 |         -0.2 | False         
[INFO] 2022-01-14   |          1.4 |              2.6 |          1.2 | True          
[INFO] 2022-03-14   |         -2.3 |             -0.2 |          2.1 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.6 |          0.9 | True          
[INFO] 2022-07-14   |          1.4 |              2.3 |          0.9 | True          
[INFO] 2022-09-14   |          0.4 |             -0.6 |         -1.0 | False         
[INFO] 2022-11-14   |         -1.0 |             -2.5 |         -1.5 | False         
[INFO] 2023-01-14   |          3.1 |              1.0 |         -2.1 | False         
[INFO] 2023-03-14   |         -2.9 |             -1.8 |          1.1 | True          
[INFO] 2023-05-14   |         -0.4 |             -1.7 |         -1.3 | False         
[INFO] 2023-07-14   |          5.9 |              4.0 |         -1.9 | False         
[INFO] 2023-09-14   |         -1.3 |             -1.9 |         -0.6 | False         
[INFO] 2023-11-14   |          1.3 |              0.6 |         -0.7 | False         
[INFO] 2024-01-14   |         -0.6 |              1.0 |          1.6 | True          
[INFO] 2024-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -2.3 |          3.0 | True          
[INFO] 2024-07-14   |          0.2 |              0.4 |          0.2 | True          
[INFO] 2024-09-14   |         -1.8 |             -0.8 |          1.0 | True          
[INFO] 2024-11-14   |         -0.5 |             -2.2 |         -1.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 19 periods (52.63% win rate)
[INFO] Updating Excel file with Hierarchical results for WBS...
[INFO] Excel file updated successfully. Added WBS with Hierarchical win rate 52.6% in row 55
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(36/50) - Original Sharpe: 0.7976
[INFO] Added cluster 2 to portfolio: SMA(26/58) - Original Sharpe: 0.5397
[INFO] Added cluster 3 to portfolio: SMA(24/82) - Original Sharpe: 0.4209
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'WBS_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2822
[INFO] Hierarchical Best out-of-sample Sharpe: -0.5515
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for WBS...
[INFO] Excel file updated successfully. Added WBS with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\WBS
