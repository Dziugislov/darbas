[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for AD in column D: 8.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 207.00s
[INFO] Best parameters: Short SMA = 106, Long SMA = 160
[INFO] Best Sharpe ratio: 0.627696, Trades: 22
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_AD_best_106/160 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @AD
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.51 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $555,481.00
[INFO] Market Buy & Hold P&L: $-24,520.00
[INFO] Outperformance: $580,001.00
[INFO] Sharpe ratio (entire period, annualized): 0.632989
[INFO] Sharpe ratio (in-sample, annualized): 0.627696
[INFO] Sharpe ratio (out-of-sample, annualized): 0.644916
[INFO] Maximum Drawdown: $102,820.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 14
[INFO] Out-of-sample period trades: 8
[INFO] Total trades: 22
[INFO] In-sample P&L: $318,183.00
[INFO] Out-of-sample P&L: $140,738.00
[INFO] 
Best parameters from GA: Short SMA = 106, Long SMA = 160, Sharpe = 0.627696
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 22
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9874 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] Trades range: 10.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3635 to 2.7332
[INFO] Scaled Long SMA range: -2.7723 to 1.5199
[INFO] Scaled Sharpe ratio range: -3.8904 to 2.8778
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 14
[INFO] Using 14 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=14...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 877 elements
[INFO] Kmeans Cluster 1: 670 elements
[INFO] Kmeans Cluster 2: 786 elements
[INFO] Kmeans Cluster 3: 543 elements
[INFO] Kmeans Cluster 4: 834 elements
[INFO] Kmeans Cluster 5: 903 elements
[INFO] Kmeans Cluster 6: 756 elements
[INFO] Kmeans Cluster 7: 558 elements
[INFO] Kmeans Cluster 8: 587 elements
[INFO] Kmeans Cluster 9: 670 elements
[INFO] Kmeans Cluster 10: 645 elements
[INFO] Kmeans Cluster 11: 787 elements
[INFO] Kmeans Cluster 12: 915 elements
[INFO] Kmeans Cluster 13: 343 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=53.91, Long SMA=114.68, Sharpe=-0.1051
[INFO] Centroid 1: Short SMA=173.51, Long SMA=214.13, Sharpe=-0.0912
[INFO] Centroid 2: Short SMA=121.44, Long SMA=180.75, Sharpe=0.2628
[INFO] Centroid 3: Short SMA=64.66, Long SMA=101.53, Sharpe=-0.3494
[INFO] Centroid 4: Short SMA=92.79, Long SMA=232.87, Sharpe=0.1570
[INFO] Centroid 5: Short SMA=238.86, Long SMA=279.00, Sharpe=-0.0988
[INFO] Centroid 6: Short SMA=35.84, Long SMA=269.98, Sharpe=0.0831
[INFO] Centroid 7: Short SMA=46.03, Long SMA=156.47, Sharpe=0.0800
[INFO] Centroid 8: Short SMA=26.69, Long SMA=63.56, Sharpe=0.1484
[INFO] Centroid 9: Short SMA=45.70, Long SMA=213.50, Sharpe=-0.0649
[INFO] Centroid 10: Short SMA=203.69, Long SMA=249.23, Sharpe=0.0537
[INFO] Centroid 11: Short SMA=112.34, Long SMA=165.10, Sharpe=0.4434
[INFO] Centroid 12: Short SMA=145.50, Long SMA=260.56, Sharpe=0.0211
[INFO] Centroid 13: Short SMA=17.64, Long SMA=194.79, Sharpe=0.2660
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=22
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=110, Long SMA=164, Sharpe=0.3641, Trades=20
[INFO] Kmeans Top 2: Short SMA=124, Long SMA=186, Sharpe=0.2571, Trades=20
[INFO] Kmeans Top 3: Short SMA=18, Long SMA=198, Sharpe=0.2279, Trades=26
[INFO] Kmeans Top 4: Short SMA=92, Long SMA=234, Sharpe=0.2055, Trades=14
[INFO] Kmeans Top 5: Short SMA=28, Long SMA=62, Sharpe=0.1981, Trades=52
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}
[INFO]   Rounded: (54, 115)
[INFO]   Nearest: (54.0, 114.0)
[INFO]   Rounded: (174, 214)
[INFO]   Rounded: (121, 181)
[INFO]   Nearest: (122.0, 180.0)
[INFO]   Rounded: (65, 102)
[INFO]   Nearest: (64.0, 102.0)
[INFO]   Rounded: (93, 233)
[INFO]   Nearest: (92.0, 232.0)
[INFO]   Rounded: (239, 279)
[INFO]   Nearest: (238.0, 278.0)
[INFO]   Rounded: (36, 270)
[INFO]   Rounded: (46, 156)
[INFO]   Rounded: (27, 64)
[INFO]   Nearest: (26.0, 64.0)
[INFO]   Rounded: (46, 214)
[INFO]   Rounded: (204, 249)
[INFO]   Nearest: (204.0, 250.0)
[INFO]   Rounded: (112, 165)
[INFO]   Nearest: (112.0, 166.0)
[INFO]   Rounded: (146, 261)
[INFO]   Nearest: (146.0, 260.0)
[INFO]   Rounded: (18, 195)
[INFO]   Nearest: (18.0, 194.0)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(110/164) - Original Sharpe: 0.3641, Trades: 20
[INFO] Kmeans cluster 2: SMA(124/186) - Original Sharpe: 0.2571, Trades: 20
[INFO] Kmeans cluster 3: SMA(18/198) - Original Sharpe: 0.2279, Trades: 26
[INFO] Kmeans cluster 4: SMA(92/234) - Original Sharpe: 0.2055, Trades: 14
[INFO] Kmeans cluster 5: SMA(28/62) - Original Sharpe: 0.1981, Trades: 52
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (110/164) - Sharpe: 0.3641
[INFO] cluster 2: (124/186) - Sharpe: 0.2571
[INFO] cluster 3: (18/198) - Sharpe: 0.2279
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            0.551202
1    2021-11-14 2021-11-14            43     0.620829            0.620829
2    2022-01-14 2022-01-14            41     0.058063            0.058063
3    2022-03-14 2022-03-14            44     1.979608            0.617939
4    2022-05-14 2022-05-14            43    -1.220633            1.436266
5    2022-07-14 2022-07-14            44     0.448047            0.448047
6    2022-09-14 2022-09-14            43     0.790083            0.790083
7    2022-11-14 2022-11-14            43    -1.736792           -1.736792
8    2023-01-14 2023-01-14            41     2.493082            1.362225
9    2023-03-14 2023-03-14            44    -0.132668           -0.930875
10   2023-05-14 2023-05-14            44     0.580825           -0.318252
11   2023-07-14 2023-07-14            44     4.541233            4.541233
12   2023-09-14 2023-09-14            43     0.691612            0.691612
13   2023-11-14 2023-11-14            42    -2.563801           -3.132506
14   2024-01-14 2024-01-14            43     4.073536            0.533978
15   2024-03-14 2024-03-14            42    -0.424007            2.349392
16   2024-05-14 2024-05-14            44    -1.116674            0.442488
17   2024-07-14 2024-07-14            45     3.495207           -2.774511
18   2024-09-14 2024-09-14            43    -2.003748           -1.831898
19   2024-11-14 2024-11-14            33     3.170976            1.715690
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          2.0 |              0.6 |         -1.4 | False         
[INFO] 2022-05-14   |         -1.2 |              1.4 |          2.6 | True          
[INFO] 2022-07-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          2.5 |              1.4 |         -1.1 | False         
[INFO] 2023-03-14   |         -0.1 |             -0.9 |         -0.8 | False         
[INFO] 2023-05-14   |          0.6 |             -0.3 |         -0.9 | False         
[INFO] 2023-07-14   |          4.5 |              4.5 |          0.0 | Excluded      
[INFO] 2023-09-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -2.6 |             -3.1 |         -0.5 | False         
[INFO] 2024-01-14   |          4.1 |              0.5 |         -3.6 | False         
[INFO] 2024-03-14   |         -0.4 |              2.3 |          2.7 | True          
[INFO] 2024-05-14   |         -1.1 |              0.4 |          1.5 | True          
[INFO] 2024-07-14   |          3.5 |             -2.8 |         -6.3 | False         
[INFO] 2024-09-14   |         -2.0 |             -1.8 |          0.2 | True          
[INFO] 2024-11-14   |          3.2 |              1.7 |         -1.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-07-14, 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 4 of 12 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans win rate 33.3% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(110/164) - Original Sharpe: 0.3641
[INFO] Added cluster 2 to portfolio: SMA(124/186) - Original Sharpe: 0.2571
[INFO] Added cluster 3 to portfolio: SMA(18/198) - Original Sharpe: 0.2279
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2165
[INFO] Kmeans Best out-of-sample Sharpe: 0.6449
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 22
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9874 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] Trades range: 10.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3635 to 2.7332
[INFO] Scaled Long SMA range: -2.7723 to 1.5199
[INFO] Scaled Sharpe ratio range: -3.8904 to 2.8778
[INFO] Scaled Trades range: -0.7421 to 14.7138
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9874 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5641
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 1407 elements
[INFO] Cluster 1: 186 elements
[INFO] Cluster 2: 1299 elements
[INFO] Cluster 3: 1315 elements
[INFO] Cluster 4: 974 elements
[INFO] Cluster 5: 187 elements
[INFO] Cluster 6: 506 elements
[INFO] Cluster 7: 208 elements
[INFO] Cluster 8: 34 elements
[INFO] Cluster 9: 388 elements
[INFO] Cluster 10: 682 elements
[INFO] Cluster 11: 953 elements
[INFO] Cluster 12: 531 elements
[INFO] Cluster 13: 518 elements
[INFO] Cluster 14: 541 elements
[INFO] Cluster 15: 145 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=224, Long SMA=268, Sharpe=-0.0729, Trades=18
[INFO] Cluster 1 cluster: Short SMA=32, Long SMA=40, Sharpe=0.3634, Trades=100
[INFO] Cluster 2 cluster: Short SMA=112, Long SMA=174, Sharpe=0.3795, Trades=18
[INFO] Cluster 3 cluster: Short SMA=144, Long SMA=252, Sharpe=0.0174, Trades=11
[INFO] Cluster 4 cluster: Short SMA=46, Long SMA=190, Sharpe=-0.1063, Trades=22
[INFO] Cluster 5 cluster: Short SMA=138, Long SMA=146, Sharpe=-0.0134, Trades=48
[INFO] Cluster 6 cluster: Short SMA=22, Long SMA=72, Sharpe=0.1815, Trades=52
[INFO] Cluster 7 cluster: Short SMA=78, Long SMA=88, Sharpe=-0.1356, Trades=65
[INFO] Cluster 8 cluster: Short SMA=38, Long SMA=40, Sharpe=0.4677, Trades=200
[INFO] Cluster 9 cluster: Short SMA=18, Long SMA=208, Sharpe=0.2323, Trades=28
[INFO] Cluster 10 cluster: Short SMA=40, Long SMA=122, Sharpe=-0.1151, Trades=28
[INFO] Cluster 11 cluster: Short SMA=80, Long SMA=242, Sharpe=0.1084, Trades=14
[INFO] Cluster 12 cluster: Short SMA=172, Long SMA=214, Sharpe=-0.1394, Trades=19
[INFO] Cluster 13 cluster: Short SMA=30, Long SMA=266, Sharpe=-0.0347, Trades=20
[INFO] Cluster 14 cluster: Short SMA=60, Long SMA=110, Sharpe=-0.3545, Trades=35
[INFO] Cluster 15 cluster: Short SMA=230, Long SMA=234, Sharpe=-0.1039, Trades=47
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=22
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=40, Sharpe=0.4677, Trades=200
[INFO] Top 2: Short SMA=112, Long SMA=174, Sharpe=0.3795, Trades=18
[INFO] Top 3: Short SMA=32, Long SMA=40, Sharpe=0.3634, Trades=100
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 9874 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/40) - Original Sharpe: 0.4677, Trades: 200
[INFO] Hierarchical cluster 2: SMA(112/174) - Original Sharpe: 0.3795, Trades: 18
[INFO] Hierarchical cluster 3: SMA(32/40) - Original Sharpe: 0.3634, Trades: 100
[INFO] Hierarchical cluster 4: SMA(18/208) - Original Sharpe: 0.2323, Trades: 28
[INFO] Hierarchical cluster 5: SMA(22/72) - Original Sharpe: 0.1815, Trades: 52
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/40) - Sharpe: 0.4677
[INFO] cluster 2: (112/174) - Sharpe: 0.3795
[INFO] cluster 3: (32/40) - Sharpe: 0.3634
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            1.055816
1    2021-11-14 2021-11-14            43     0.620829           -3.391430
2    2022-01-14 2022-01-14            41     0.058063           -1.138184
3    2022-03-14 2022-03-14            44     1.979608           -2.309447
4    2022-05-14 2022-05-14            43    -1.220633            0.197042
5    2022-07-14 2022-07-14            44     0.448047           -1.716850
6    2022-09-14 2022-09-14            43     0.790083            0.844593
7    2022-11-14 2022-11-14            43    -1.736792            0.716913
8    2023-01-14 2023-01-14            41     2.493082           -2.144162
9    2023-03-14 2023-03-14            44    -0.132668            0.826408
10   2023-05-14 2023-05-14            44     0.580825           -3.066739
11   2023-07-14 2023-07-14            44     4.541233            2.249561
12   2023-09-14 2023-09-14            43     0.691612            0.008725
13   2023-11-14 2023-11-14            42    -2.563801           -2.231887
14   2024-01-14 2024-01-14            43     4.073536           -2.672153
15   2024-03-14 2024-03-14            42    -0.424007           -1.170125
16   2024-05-14 2024-05-14            44    -1.116674           -3.003691
17   2024-07-14 2024-07-14            45     3.495207           -4.037267
18   2024-09-14 2024-09-14            43    -2.003748            0.787045
19   2024-11-14 2024-11-14            33     3.170976            4.487936
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              1.1 |          0.5 | True          
[INFO] 2021-11-14   |          0.6 |             -3.4 |         -4.0 | False         
[INFO] 2022-01-14   |          0.1 |             -1.1 |         -1.2 | False         
[INFO] 2022-03-14   |          2.0 |             -2.3 |         -4.3 | False         
[INFO] 2022-05-14   |         -1.2 |              0.2 |          1.4 | True          
[INFO] 2022-07-14   |          0.4 |             -1.7 |         -2.1 | False         
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |              0.7 |          2.4 | True          
[INFO] 2023-01-14   |          2.5 |             -2.1 |         -4.6 | False         
[INFO] 2023-03-14   |         -0.1 |              0.8 |          0.9 | True          
[INFO] 2023-05-14   |          0.6 |             -3.1 |         -3.7 | False         
[INFO] 2023-07-14   |          4.5 |              2.2 |         -2.3 | False         
[INFO] 2023-09-14   |          0.7 |              0.0 |         -0.7 | False         
[INFO] 2023-11-14   |         -2.6 |             -2.2 |          0.4 | True          
[INFO] 2024-01-14   |          4.1 |             -2.7 |         -6.8 | False         
[INFO] 2024-03-14   |         -0.4 |             -1.2 |         -0.8 | False         
[INFO] 2024-05-14   |         -1.1 |             -3.0 |         -1.9 | False         
[INFO] 2024-07-14   |          3.5 |             -4.0 |         -7.5 | False         
[INFO] 2024-09-14   |         -2.0 |              0.8 |          2.8 | True          
[INFO] 2024-11-14   |          3.2 |              4.5 |          1.3 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 19 periods (36.84% win rate)
[INFO] Updating Excel file with Hierarchical results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical win rate 36.8% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/40) - Original Sharpe: 0.4677
[INFO] Added cluster 2 to portfolio: SMA(112/174) - Original Sharpe: 0.3795
[INFO] Added cluster 3 to portfolio: SMA(32/40) - Original Sharpe: 0.3634
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.7571
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6449
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BO in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 190.47s
[INFO] Best parameters: Short SMA = 48, Long SMA = 54
[INFO] Best Sharpe ratio: 1.148397, Trades: 89
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO]  Saved PnL for SMA_BO_best_48/54 to pnl_temp.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BO
[INFO] Big Point Value (from data): 600.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 13.60 contracts
[INFO] Maximum Position Size: 31 contracts
[INFO] Strategy Total P&L: $553,098.00
[INFO] Market Buy & Hold P&L: $8,556.00
[INFO] Outperformance: $544,542.00
[INFO] Sharpe ratio (entire period, annualized): 0.651163
[INFO] Sharpe ratio (in-sample, annualized): 1.148397
[INFO] Sharpe ratio (out-of-sample, annualized): -0.439751
[INFO] Maximum Drawdown: $162,660.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 63
[INFO] Out-of-sample period trades: 26
[INFO] Total trades: 89
[INFO] In-sample P&L: $556,682.00
[INFO] Out-of-sample P&L: $-96,936.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 54, Sharpe = 1.148397
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 89
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9834 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3624 to 2.7150
[INFO] Scaled Long SMA range: -2.7630 to 1.5177
[INFO] Scaled Sharpe ratio range: -2.5920 to 4.1745
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 20
[INFO] Using 20 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=20...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 450 elements
[INFO] Kmeans Cluster 1: 549 elements
[INFO] Kmeans Cluster 2: 453 elements
[INFO] Kmeans Cluster 3: 390 elements
[INFO] Kmeans Cluster 4: 622 elements
[INFO] Kmeans Cluster 5: 513 elements
[INFO] Kmeans Cluster 6: 321 elements
[INFO] Kmeans Cluster 7: 624 elements
[INFO] Kmeans Cluster 8: 553 elements
[INFO] Kmeans Cluster 9: 725 elements
[INFO] Kmeans Cluster 10: 635 elements
[INFO] Kmeans Cluster 11: 811 elements
[INFO] Kmeans Cluster 12: 549 elements
[INFO] Kmeans Cluster 13: 572 elements
[INFO] Kmeans Cluster 14: 414 elements
[INFO] Kmeans Cluster 15: 109 elements
[INFO] Kmeans Cluster 16: 119 elements
[INFO] Kmeans Cluster 17: 627 elements
[INFO] Kmeans Cluster 18: 292 elements
[INFO] Kmeans Cluster 19: 506 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=70.72, Long SMA=161.40, Sharpe=-0.3203
[INFO] Centroid 1: Short SMA=92.54, Long SMA=217.49, Sharpe=0.0305
[INFO] Centroid 2: Short SMA=98.76, Long SMA=251.44, Sharpe=0.1973
[INFO] Centroid 3: Short SMA=32.91, Long SMA=66.44, Sharpe=0.7578
[INFO] Centroid 4: Short SMA=190.33, Long SMA=224.68, Sharpe=0.1779
[INFO] Centroid 5: Short SMA=29.39, Long SMA=94.92, Sharpe=0.4577
[INFO] Centroid 6: Short SMA=252.96, Long SMA=278.97, Sharpe=0.1798
[INFO] Centroid 7: Short SMA=84.26, Long SMA=122.11, Sharpe=-0.0898
[INFO] Centroid 8: Short SMA=26.39, Long SMA=200.87, Sharpe=0.0900
[INFO] Centroid 9: Short SMA=119.14, Long SMA=164.16, Sharpe=-0.1200
[INFO] Centroid 10: Short SMA=223.03, Long SMA=269.38, Sharpe=0.4453
[INFO] Centroid 11: Short SMA=34.42, Long SMA=270.56, Sharpe=0.2537
[INFO] Centroid 12: Short SMA=141.23, Long SMA=246.47, Sharpe=-0.0178
[INFO] Centroid 13: Short SMA=176.10, Long SMA=272.19, Sharpe=0.1555
[INFO] Centroid 14: Short SMA=28.72, Long SMA=146.13, Sharpe=0.2817
[INFO] Centroid 15: Short SMA=275.39, Long SMA=293.23, Sharpe=-0.1450
[INFO] Centroid 16: Short SMA=18.30, Long SMA=32.30, Sharpe=-0.0340
[INFO] Centroid 17: Short SMA=151.77, Long SMA=192.32, Sharpe=0.0205
[INFO] Centroid 18: Short SMA=63.64, Long SMA=95.98, Sharpe=0.1224
[INFO] Centroid 19: Short SMA=59.74, Long SMA=204.05, Sharpe=-0.1333
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=54, Sharpe=1.1484, Trades=89
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=34, Long SMA=66, Sharpe=0.7147, Trades=40
[INFO] Kmeans Top 2: Short SMA=222, Long SMA=270, Sharpe=0.5040, Trades=14
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=100, Sharpe=0.4464, Trades=30
[INFO] Kmeans Top 4: Short SMA=34, Long SMA=270, Sharpe=0.3813, Trades=10
[INFO] Kmeans Top 5: Short SMA=100, Long SMA=252, Sharpe=0.2484, Trades=10
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19}
[INFO]   Rounded: (71, 161)
[INFO]   Nearest: (70.0, 162.0)
[INFO]   Rounded: (93, 217)
[INFO]   Nearest: (92.0, 218.0)
[INFO]   Rounded: (99, 251)
[INFO]   Nearest: (98.0, 252.0)
[INFO]   Rounded: (33, 66)
[INFO]   Nearest: (32.0, 66.0)
[INFO]   Rounded: (190, 225)
[INFO]   Nearest: (190.0, 224.0)
[INFO]   Rounded: (29, 95)
[INFO]   Nearest: (30.0, 94.0)
[INFO]   Rounded: (253, 279)
[INFO]   Nearest: (252.0, 278.0)
[INFO]   Rounded: (84, 122)
[INFO]   Rounded: (26, 201)
[INFO]   Nearest: (26.0, 200.0)
[INFO]   Rounded: (119, 164)
[INFO]   Nearest: (120.0, 164.0)
[INFO]   Rounded: (223, 269)
[INFO]   Nearest: (224.0, 270.0)
[INFO]   Rounded: (34, 271)
[INFO]   Nearest: (34.0, 270.0)
[INFO]   Rounded: (141, 246)
[INFO]   Nearest: (142.0, 246.0)
[INFO]   Rounded: (176, 272)
[INFO]   Rounded: (29, 146)
[INFO]   Nearest: (28.0, 146.0)
[INFO]   Rounded: (275, 293)
[INFO]   Nearest: (276.0, 294.0)
[INFO]   Rounded: (18, 32)
[INFO]   Rounded: (152, 192)
[INFO]   Rounded: (64, 96)
[INFO]   Rounded: (60, 204)
[INFO] Successfully plotted 20 out of 20 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 54
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(34/66) - Original Sharpe: 0.7147, Trades: 40
[INFO] Kmeans cluster 2: SMA(222/270) - Original Sharpe: 0.5040, Trades: 14
[INFO] Kmeans cluster 3: SMA(28/100) - Original Sharpe: 0.4464, Trades: 30
[INFO] Kmeans cluster 4: SMA(34/270) - Original Sharpe: 0.3813, Trades: 10
[INFO] Kmeans cluster 5: SMA(100/252) - Original Sharpe: 0.2484, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/54)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/66) - Sharpe: 0.7147
[INFO] cluster 2: (222/270) - Sharpe: 0.5040
[INFO] cluster 3: (28/100) - Sharpe: 0.4464
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -3.408887           -4.707395
1    2021-11-10 2021-11-10            41    -4.249630           -2.782165
2    2022-01-10 2022-01-10            41     1.218137            1.939137
3    2022-03-10 2022-03-10            42     2.126254            2.126254
4    2022-05-10 2022-05-10            41    -5.000926           -4.174328
5    2022-07-10 2022-07-10            44    -0.790260           -0.790260
6    2022-09-10 2022-09-10            43     1.268514            3.138868
7    2022-11-10 2022-11-10            40    -2.869549           -2.585532
8    2023-01-10 2023-01-10            41     1.869806            2.621060
9    2023-03-10 2023-03-10            42     1.878823            2.222624
10   2023-05-10 2023-05-10            40    -1.601658           -1.740458
11   2023-07-10 2023-07-10            44     0.545769            1.585851
12   2023-09-10 2023-09-10            44     0.229410            2.312997
13   2023-11-10 2023-11-10            40     0.831968            0.831968
14   2024-01-10 2024-01-10            41     1.354455            1.633020
15   2024-03-10 2024-03-10            43    -1.598528           -2.607613
16   2024-05-10 2024-05-10            40     1.637085           -1.616171
17   2024-07-10 2024-07-10            43    -1.484568            1.507953
18   2024-09-10 2024-09-10            44     1.814989           -0.699935
19   2024-11-10 2024-11-10            35    -2.317816           -4.332633
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -3.4 |             -4.7 |         -1.3 | False         
[INFO] 2021-11-10   |         -4.2 |             -2.8 |          1.4 | True          
[INFO] 2022-01-10   |          1.2 |              1.9 |          0.7 | True          
[INFO] 2022-03-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -5.0 |             -4.2 |          0.8 | True          
[INFO] 2022-07-10   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2022-09-10   |          1.3 |              3.1 |          1.8 | True          
[INFO] 2022-11-10   |         -2.9 |             -2.6 |          0.3 | True          
[INFO] 2023-01-10   |          1.9 |              2.6 |          0.7 | True          
[INFO] 2023-03-10   |          1.9 |              2.2 |          0.3 | True          
[INFO] 2023-05-10   |         -1.6 |             -1.7 |         -0.1 | False         
[INFO] 2023-07-10   |          0.5 |              1.6 |          1.1 | True          
[INFO] 2023-09-10   |          0.2 |              2.3 |          2.1 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.4 |              1.6 |          0.2 | True          
[INFO] 2024-03-10   |         -1.6 |             -2.6 |         -1.0 | False         
[INFO] 2024-05-10   |          1.6 |             -1.6 |         -3.2 | False         
[INFO] 2024-07-10   |         -1.5 |              1.5 |          3.0 | True          
[INFO] 2024-09-10   |          1.8 |             -0.7 |         -2.5 | False         
[INFO] 2024-11-10   |         -2.3 |             -4.3 |         -2.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-10, 2022-07-10, 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 11 of 17 periods (64.71% win rate)
[INFO] Updating Excel file with Kmeans results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans win rate 64.7% in row 4
[INFO] Added best Sharpe parameters 48/54 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 54
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/66) - Original Sharpe: 0.7147
[INFO] Added cluster 2 to portfolio: SMA(222/270) - Original Sharpe: 0.5040
[INFO] Added cluster 3 to portfolio: SMA(28/100) - Original Sharpe: 0.4464
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BO_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.2042
[INFO] Kmeans Best out-of-sample Sharpe: -0.4398
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BO
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 89
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9834 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3624 to 2.7150
[INFO] Scaled Long SMA range: -2.7630 to 1.5177
[INFO] Scaled Sharpe ratio range: -2.5920 to 4.1745
[INFO] Scaled Trades range: -0.7949 to 15.6625
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9834 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5858
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
