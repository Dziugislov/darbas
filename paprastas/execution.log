[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for AD in column D: 8.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 152.66s
[INFO] Best parameters: Short SMA = 106, Long SMA = 160
[INFO] Best Sharpe ratio: 0.627696, Trades: 22
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @AD
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.51 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $555,481.00
[INFO] Market Buy & Hold P&L: $-24,520.00
[INFO] Outperformance: $580,001.00
[INFO] Sharpe ratio (entire period, annualized): 0.632989
[INFO] Sharpe ratio (in-sample, annualized): 0.627696
[INFO] Sharpe ratio (out-of-sample, annualized): 0.644916
[INFO] Maximum Drawdown: $102,820.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 14
[INFO] Out-of-sample period trades: 8
[INFO] Total trades: 22
[INFO] In-sample P&L: $318,183.00
[INFO] Out-of-sample P&L: $140,738.00
[INFO] 
Best parameters from GA: Short SMA = 106, Long SMA = 160, Sharpe = 0.627696
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 22
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9874 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] Trades range: 10.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3635 to 2.7332
[INFO] Scaled Long SMA range: -2.7723 to 1.5199
[INFO] Scaled Sharpe ratio range: -3.8904 to 2.8778
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 194 elements
[INFO] Kmeans Cluster 1: 210 elements
[INFO] Kmeans Cluster 2: 233 elements
[INFO] Kmeans Cluster 3: 143 elements
[INFO] Kmeans Cluster 4: 301 elements
[INFO] Kmeans Cluster 5: 231 elements
[INFO] Kmeans Cluster 6: 203 elements
[INFO] Kmeans Cluster 7: 202 elements
[INFO] Kmeans Cluster 8: 204 elements
[INFO] Kmeans Cluster 9: 176 elements
[INFO] Kmeans Cluster 10: 133 elements
[INFO] Kmeans Cluster 11: 200 elements
[INFO] Kmeans Cluster 12: 196 elements
[INFO] Kmeans Cluster 13: 127 elements
[INFO] Kmeans Cluster 14: 286 elements
[INFO] Kmeans Cluster 15: 180 elements
[INFO] Kmeans Cluster 16: 120 elements
[INFO] Kmeans Cluster 17: 289 elements
[INFO] Kmeans Cluster 18: 287 elements
[INFO] Kmeans Cluster 19: 196 elements
[INFO] Kmeans Cluster 20: 266 elements
[INFO] Kmeans Cluster 21: 148 elements
[INFO] Kmeans Cluster 22: 216 elements
[INFO] Kmeans Cluster 23: 178 elements
[INFO] Kmeans Cluster 24: 231 elements
[INFO] Kmeans Cluster 25: 207 elements
[INFO] Kmeans Cluster 26: 223 elements
[INFO] Kmeans Cluster 27: 165 elements
[INFO] Kmeans Cluster 28: 156 elements
[INFO] Kmeans Cluster 29: 231 elements
[INFO] Kmeans Cluster 30: 286 elements
[INFO] Kmeans Cluster 31: 205 elements
[INFO] Kmeans Cluster 32: 177 elements
[INFO] Kmeans Cluster 33: 164 elements
[INFO] Kmeans Cluster 34: 89 elements
[INFO] Kmeans Cluster 35: 35 elements
[INFO] Kmeans Cluster 36: 108 elements
[INFO] Kmeans Cluster 37: 214 elements
[INFO] Kmeans Cluster 38: 253 elements
[INFO] Kmeans Cluster 39: 126 elements
[INFO] Kmeans Cluster 40: 252 elements
[INFO] Kmeans Cluster 41: 137 elements
[INFO] Kmeans Cluster 42: 179 elements
[INFO] Kmeans Cluster 43: 168 elements
[INFO] Kmeans Cluster 44: 208 elements
[INFO] Kmeans Cluster 45: 315 elements
[INFO] Kmeans Cluster 46: 329 elements
[INFO] Kmeans Cluster 47: 163 elements
[INFO] Kmeans Cluster 48: 190 elements
[INFO] Kmeans Cluster 49: 144 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=112.61, Long SMA=142.27, Sharpe=0.3758
[INFO] Centroid 1: Short SMA=211.54, Long SMA=236.61, Sharpe=0.0258
[INFO] Centroid 2: Short SMA=26.45, Long SMA=106.73, Sharpe=-0.0099
[INFO] Centroid 3: Short SMA=18.64, Long SMA=235.22, Sharpe=0.1642
[INFO] Centroid 4: Short SMA=65.31, Long SMA=104.33, Sharpe=-0.3028
[INFO] Centroid 5: Short SMA=127.32, Long SMA=223.51, Sharpe=0.0928
[INFO] Centroid 6: Short SMA=244.18, Long SMA=283.39, Sharpe=-0.1806
[INFO] Centroid 7: Short SMA=42.22, Long SMA=192.90, Sharpe=0.0311
[INFO] Centroid 8: Short SMA=163.44, Long SMA=275.03, Sharpe=-0.0476
[INFO] Centroid 9: Short SMA=20.64, Long SMA=146.66, Sharpe=0.1094
[INFO] Centroid 10: Short SMA=30.00, Long SMA=54.24, Sharpe=0.0149
[INFO] Centroid 11: Short SMA=95.39, Long SMA=252.52, Sharpe=0.2088
[INFO] Centroid 12: Short SMA=97.37, Long SMA=196.89, Sharpe=0.3494
[INFO] Centroid 13: Short SMA=28.19, Long SMA=50.61, Sharpe=0.2871
[INFO] Centroid 14: Short SMA=41.52, Long SMA=243.59, Sharpe=-0.0439
[INFO] Centroid 15: Short SMA=69.33, Long SMA=99.12, Sharpe=-0.4504
[INFO] Centroid 16: Short SMA=187.80, Long SMA=215.37, Sharpe=-0.2410
[INFO] Centroid 17: Short SMA=135.02, Long SMA=276.40, Sharpe=0.0850
[INFO] Centroid 18: Short SMA=27.34, Long SMA=65.62, Sharpe=0.1448
[INFO] Centroid 19: Short SMA=141.42, Long SMA=178.99, Sharpe=0.3100
[INFO] Centroid 20: Short SMA=50.02, Long SMA=207.10, Sharpe=-0.0985
[INFO] Centroid 21: Short SMA=91.89, Long SMA=122.74, Sharpe=-0.0158
[INFO] Centroid 22: Short SMA=97.32, Long SMA=172.24, Sharpe=0.4534
[INFO] Centroid 23: Short SMA=63.97, Long SMA=162.14, Sharpe=0.1123
[INFO] Centroid 24: Short SMA=41.36, Long SMA=156.09, Sharpe=-0.0676
[INFO] Centroid 25: Short SMA=133.97, Long SMA=195.46, Sharpe=0.2215
[INFO] Centroid 26: Short SMA=168.20, Long SMA=196.32, Sharpe=0.0320
[INFO] Centroid 27: Short SMA=16.75, Long SMA=205.01, Sharpe=0.2693
[INFO] Centroid 28: Short SMA=184.14, Long SMA=211.44, Sharpe=-0.1008
[INFO] Centroid 29: Short SMA=174.35, Long SMA=249.51, Sharpe=0.0144
[INFO] Centroid 30: Short SMA=263.80, Long SMA=285.05, Sharpe=-0.0281
[INFO] Centroid 31: Short SMA=48.01, Long SMA=280.45, Sharpe=0.1706
[INFO] Centroid 32: Short SMA=141.14, Long SMA=168.00, Sharpe=0.4325
[INFO] Centroid 33: Short SMA=205.63, Long SMA=274.26, Sharpe=0.0082
[INFO] Centroid 34: Short SMA=126.67, Long SMA=143.01, Sharpe=0.1912
[INFO] Centroid 35: Short SMA=15.60, Long SMA=24.29, Sharpe=-0.2558
[INFO] Centroid 36: Short SMA=13.50, Long SMA=158.57, Sharpe=0.3139
[INFO] Centroid 37: Short SMA=130.23, Long SMA=245.64, Sharpe=0.0040
[INFO] Centroid 38: Short SMA=231.45, Long SMA=256.93, Sharpe=-0.0793
[INFO] Centroid 39: Short SMA=77.33, Long SMA=167.16, Sharpe=0.2625
[INFO] Centroid 40: Short SMA=89.50, Long SMA=216.85, Sharpe=0.2043
[INFO] Centroid 41: Short SMA=89.75, Long SMA=119.46, Sharpe=-0.1439
[INFO] Centroid 42: Short SMA=199.77, Long SMA=250.79, Sharpe=0.1306
[INFO] Centroid 43: Short SMA=205.81, Long SMA=288.02, Sharpe=-0.1410
[INFO] Centroid 44: Short SMA=45.47, Long SMA=95.63, Sharpe=-0.1421
[INFO] Centroid 45: Short SMA=23.97, Long SMA=276.44, Sharpe=0.0330
[INFO] Centroid 46: Short SMA=71.19, Long SMA=240.99, Sharpe=0.0970
[INFO] Centroid 47: Short SMA=53.51, Long SMA=139.56, Sharpe=-0.2016
[INFO] Centroid 48: Short SMA=155.08, Long SMA=234.89, Sharpe=-0.1028
[INFO] Centroid 49: Short SMA=109.17, Long SMA=161.51, Sharpe=0.5396
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=22
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=22
[INFO] Kmeans Top 2: Short SMA=94, Long SMA=172, Sharpe=0.4992, Trades=18
[INFO] Kmeans Top 3: Short SMA=140, Long SMA=168, Sharpe=0.4355, Trades=22
[INFO] Kmeans Top 4: Short SMA=98, Long SMA=198, Sharpe=0.4087, Trades=16
[INFO] Kmeans Top 5: Short SMA=114, Long SMA=142, Sharpe=0.3344, Trades=27
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (113, 142)
[INFO]   Nearest: (112.0, 142.0)
[INFO]   Rounded: (212, 237)
[INFO]   Nearest: (212.0, 236.0)
[INFO]   Rounded: (26, 107)
[INFO]   Nearest: (26.0, 106.0)
[INFO]   Rounded: (19, 235)
[INFO]   Nearest: (18.0, 236.0)
[INFO]   Rounded: (65, 104)
[INFO]   Nearest: (66.0, 104.0)
[INFO]   Rounded: (127, 224)
[INFO]   Nearest: (128.0, 224.0)
[INFO]   Rounded: (244, 283)
[INFO]   Nearest: (244.0, 284.0)
[INFO]   Rounded: (42, 193)
[INFO]   Nearest: (42.0, 192.0)
[INFO]   Rounded: (163, 275)
[INFO]   Nearest: (164.0, 276.0)
[INFO]   Rounded: (21, 147)
[INFO]   Nearest: (20.0, 146.0)
[INFO]   Rounded: (30, 54)
[INFO]   Rounded: (95, 253)
[INFO]   Nearest: (96.0, 252.0)
[INFO]   Rounded: (97, 197)
[INFO]   Nearest: (98.0, 196.0)
[INFO]   Rounded: (28, 51)
[INFO]   Nearest: (28.0, 50.0)
[INFO]   Rounded: (42, 244)
[INFO]   Rounded: (69, 99)
[INFO]   Nearest: (70.0, 100.0)
[INFO]   Rounded: (188, 215)
[INFO]   Nearest: (188.0, 216.0)
[INFO]   Rounded: (135, 276)
[INFO]   Nearest: (136.0, 276.0)
[INFO]   Rounded: (27, 66)
[INFO]   Nearest: (28.0, 66.0)
[INFO]   Rounded: (141, 179)
[INFO]   Nearest: (142.0, 178.0)
[INFO]   Rounded: (50, 207)
[INFO]   Nearest: (50.0, 208.0)
[INFO]   Rounded: (92, 123)
[INFO]   Nearest: (92.0, 122.0)
[INFO]   Rounded: (97, 172)
[INFO]   Nearest: (98.0, 172.0)
[INFO]   Rounded: (64, 162)
[INFO]   Rounded: (41, 156)
[INFO]   Nearest: (42.0, 156.0)
[INFO]   Rounded: (134, 195)
[INFO]   Nearest: (134.0, 196.0)
[INFO]   Rounded: (168, 196)
[INFO]   Rounded: (17, 205)
[INFO]   Nearest: (16.0, 206.0)
[INFO]   Rounded: (184, 211)
[INFO]   Nearest: (184.0, 212.0)
[INFO]   Rounded: (174, 250)
[INFO]   Rounded: (264, 285)
[INFO]   Nearest: (264.0, 286.0)
[INFO]   Rounded: (48, 280)
[INFO]   Rounded: (141, 168)
[INFO]   Nearest: (142.0, 168.0)
[INFO]   Rounded: (206, 274)
[INFO]   Rounded: (127, 143)
[INFO]   Nearest: (126.0, 144.0)
[INFO]   Rounded: (16, 24)
[INFO]   Rounded: (14, 159)
[INFO]   Nearest: (14.0, 158.0)
[INFO]   Rounded: (130, 246)
[INFO]   Rounded: (231, 257)
[INFO]   Nearest: (232.0, 256.0)
[INFO]   Rounded: (77, 167)
[INFO]   Nearest: (78.0, 168.0)
[INFO]   Rounded: (90, 217)
[INFO]   Nearest: (90.0, 216.0)
[INFO]   Rounded: (90, 119)
[INFO]   Nearest: (90.0, 120.0)
[INFO]   Rounded: (200, 251)
[INFO]   Nearest: (200.0, 250.0)
[INFO]   Rounded: (206, 288)
[INFO]   Rounded: (45, 96)
[INFO]   Nearest: (46.0, 96.0)
[INFO]   Rounded: (24, 276)
[INFO]   Rounded: (71, 241)
[INFO]   Nearest: (72.0, 240.0)
[INFO]   Rounded: (54, 140)
[INFO]   Rounded: (155, 235)
[INFO]   Nearest: (156.0, 234.0)
[INFO]   Rounded: (109, 162)
[INFO]   Nearest: (110.0, 162.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(106/160) - Original Sharpe: 0.6277, Trades: 22
[INFO] Kmeans cluster 2: SMA(94/172) - Original Sharpe: 0.4992, Trades: 18
[INFO] Kmeans cluster 3: SMA(140/168) - Original Sharpe: 0.4355, Trades: 22
[INFO] Kmeans cluster 4: SMA(98/198) - Original Sharpe: 0.4087, Trades: 16
[INFO] Kmeans cluster 5: SMA(114/142) - Original Sharpe: 0.3344, Trades: 27
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (106/160) - Sharpe: 0.6277
[INFO] cluster 2: (94/172) - Sharpe: 0.4992
[INFO] cluster 3: (140/168) - Sharpe: 0.4355
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            0.551202
1    2021-11-14 2021-11-14            43     0.620829            0.620829
2    2022-01-14 2022-01-14            41     0.058063            0.058063
3    2022-03-14 2022-03-14            44     1.979608            1.979608
4    2022-05-14 2022-05-14            43    -1.220633            0.035235
5    2022-07-14 2022-07-14            44     0.448047            0.448047
6    2022-09-14 2022-09-14            43     0.790083            0.790083
7    2022-11-14 2022-11-14            43    -1.736792           -1.736792
8    2023-01-14 2023-01-14            41     2.493082            2.248992
9    2023-03-14 2023-03-14            44    -0.132668           -0.623035
10   2023-05-14 2023-05-14            44     0.580825           -0.486945
11   2023-07-14 2023-07-14            44     4.541233            4.541233
12   2023-09-14 2023-09-14            43     0.691612            0.691612
13   2023-11-14 2023-11-14            42    -2.563801           -2.563801
14   2024-01-14 2024-01-14            43     4.073536            2.743531
15   2024-03-14 2024-03-14            42    -0.424007           -0.080170
16   2024-05-14 2024-05-14            44    -1.116674           -0.626408
17   2024-07-14 2024-07-14            45     3.495207            1.650041
18   2024-09-14 2024-09-14            43    -2.003748           -2.003748
19   2024-11-14 2024-11-14            33     3.170976            0.344063
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -1.2 |              0.0 |          1.2 | True          
[INFO] 2022-07-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          2.5 |              2.2 |         -0.3 | False         
[INFO] 2023-03-14   |         -0.1 |             -0.6 |         -0.5 | False         
[INFO] 2023-05-14   |          0.6 |             -0.5 |         -1.1 | False         
[INFO] 2023-07-14   |          4.5 |              4.5 |          0.0 | Excluded      
[INFO] 2023-09-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2024-01-14   |          4.1 |              2.7 |         -1.4 | False         
[INFO] 2024-03-14   |         -0.4 |             -0.1 |          0.3 | True          
[INFO] 2024-05-14   |         -1.1 |             -0.6 |          0.5 | True          
[INFO] 2024-07-14   |          3.5 |              1.7 |         -1.8 | False         
[INFO] 2024-09-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-11-14   |          3.2 |              0.3 |         -2.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 3 of 9 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans win rate 33.3% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(106/160) - Original Sharpe: 0.6277
[INFO] Added cluster 2 to portfolio: SMA(94/172) - Original Sharpe: 0.4992
[INFO] Added cluster 3 to portfolio: SMA(140/168) - Original Sharpe: 0.4355
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.4120
[INFO] Kmeans Best out-of-sample Sharpe: 0.6449
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 22
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9874 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7174 to 0.6277
[INFO] Trades range: 10.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3635 to 2.7332
[INFO] Scaled Long SMA range: -2.7723 to 1.5199
[INFO] Scaled Sharpe ratio range: -3.8904 to 2.8778
[INFO] Scaled Trades range: -0.7421 to 14.7138
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9874 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5641
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 185 elements
[INFO] Cluster 1: 391 elements
[INFO] Cluster 2: 321 elements
[INFO] Cluster 3: 415 elements
[INFO] Cluster 4: 62 elements
[INFO] Cluster 5: 314 elements
[INFO] Cluster 6: 98 elements
[INFO] Cluster 7: 227 elements
[INFO] Cluster 8: 285 elements
[INFO] Cluster 9: 269 elements
[INFO] Cluster 10: 45 elements
[INFO] Cluster 11: 9 elements
[INFO] Cluster 12: 363 elements
[INFO] Cluster 13: 386 elements
[INFO] Cluster 14: 420 elements
[INFO] Cluster 15: 320 elements
[INFO] Cluster 16: 204 elements
[INFO] Cluster 17: 233 elements
[INFO] Cluster 18: 36 elements
[INFO] Cluster 19: 370 elements
[INFO] Cluster 20: 71 elements
[INFO] Cluster 21: 328 elements
[INFO] Cluster 22: 25 elements
[INFO] Cluster 23: 40 elements
[INFO] Cluster 24: 294 elements
[INFO] Cluster 25: 245 elements
[INFO] Cluster 26: 33 elements
[INFO] Cluster 27: 242 elements
[INFO] Cluster 28: 282 elements
[INFO] Cluster 29: 183 elements
[INFO] Cluster 30: 272 elements
[INFO] Cluster 31: 106 elements
[INFO] Cluster 32: 193 elements
[INFO] Cluster 33: 241 elements
[INFO] Cluster 34: 156 elements
[INFO] Cluster 35: 295 elements
[INFO] Cluster 36: 244 elements
[INFO] Cluster 37: 68 elements
[INFO] Cluster 38: 230 elements
[INFO] Cluster 39: 74 elements
[INFO] Cluster 40: 255 elements
[INFO] Cluster 41: 116 elements
[INFO] Cluster 42: 187 elements
[INFO] Cluster 43: 57 elements
[INFO] Cluster 44: 12 elements
[INFO] Cluster 45: 155 elements
[INFO] Cluster 46: 198 elements
[INFO] Cluster 47: 189 elements
[INFO] Cluster 48: 70 elements
[INFO] Cluster 49: 60 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=32, Long SMA=56, Sharpe=0.1933, Trades=66
[INFO] Cluster 1 cluster: Short SMA=52, Long SMA=164, Sharpe=0.0707, Trades=21
[INFO] Cluster 2 cluster: Short SMA=22, Long SMA=82, Sharpe=0.1277, Trades=46
[INFO] Cluster 3 cluster: Short SMA=94, Long SMA=232, Sharpe=0.2030, Trades=12
[INFO] Cluster 4 cluster: Short SMA=146, Long SMA=150, Sharpe=0.3705, Trades=76
[INFO] Cluster 5 cluster: Short SMA=88, Long SMA=188, Sharpe=0.3597, Trades=16
[INFO] Cluster 6 cluster: Short SMA=66, Long SMA=80, Sharpe=-0.3947, Trades=68
[INFO] Cluster 7 cluster: Short SMA=268, Long SMA=290, Sharpe=-0.0592, Trades=16
[INFO] Cluster 8 cluster: Short SMA=136, Long SMA=170, Sharpe=0.4235, Trades=20
[INFO] Cluster 9 cluster: Short SMA=56, Long SMA=98, Sharpe=-0.2678, Trades=39
[INFO] Cluster 10 cluster: Short SMA=46, Long SMA=50, Sharpe=-0.1409, Trades=132
[INFO] Cluster 12 cluster: Short SMA=224, Long SMA=286, Sharpe=-0.1259, Trades=12
[INFO] Cluster 13 cluster: Short SMA=224, Long SMA=270, Sharpe=-0.0797, Trades=16
[INFO] Cluster 14 cluster: Short SMA=168, Long SMA=262, Sharpe=0.0630, Trades=13
[INFO] Cluster 15 cluster: Short SMA=22, Long SMA=276, Sharpe=0.0127, Trades=24
[INFO] Cluster 16 cluster: Short SMA=86, Long SMA=126, Sharpe=-0.0077, Trades=29
[INFO] Cluster 17 cluster: Short SMA=40, Long SMA=146, Sharpe=-0.0482, Trades=24
[INFO] Cluster 18 cluster: Short SMA=32, Long SMA=38, Sharpe=0.2564, Trades=118
[INFO] Cluster 19 cluster: Short SMA=132, Long SMA=216, Sharpe=0.0913, Trades=15
[INFO] Cluster 20 cluster: Short SMA=196, Long SMA=200, Sharpe=-0.2224, Trades=47
[INFO] Cluster 21 cluster: Short SMA=48, Long SMA=222, Sharpe=-0.0986, Trades=20
[INFO] Cluster 22 cluster: Short SMA=36, Long SMA=38, Sharpe=0.2695, Trades=194
[INFO] Cluster 23 cluster: Short SMA=108, Long SMA=114, Sharpe=0.0573, Trades=72
[INFO] Cluster 24 cluster: Short SMA=54, Long SMA=274, Sharpe=0.1810, Trades=12
[INFO] Cluster 25 cluster: Short SMA=30, Long SMA=104, Sharpe=-0.0385, Trades=38
[INFO] Cluster 26 cluster: Short SMA=38, Long SMA=46, Sharpe=0.2736, Trades=92
[INFO] Cluster 27 cluster: Short SMA=198, Long SMA=246, Sharpe=0.1064, Trades=17
[INFO] Cluster 28 cluster: Short SMA=18, Long SMA=218, Sharpe=0.2753, Trades=26
[INFO] Cluster 29 cluster: Short SMA=186, Long SMA=214, Sharpe=-0.1823, Trades=19
[INFO] Cluster 30 cluster: Short SMA=98, Long SMA=168, Sharpe=0.5574, Trades=20
[INFO] Cluster 31 cluster: Short SMA=14, Long SMA=164, Sharpe=0.2813, Trades=30
[INFO] Cluster 32 cluster: Short SMA=168, Long SMA=202, Sharpe=0.0055, Trades=19
[INFO] Cluster 33 cluster: Short SMA=134, Long SMA=192, Sharpe=0.2328, Trades=18
[INFO] Cluster 34 cluster: Short SMA=62, Long SMA=114, Sharpe=-0.4367, Trades=31
[INFO] Cluster 35 cluster: Short SMA=134, Long SMA=278, Sharpe=0.1207, Trades=10
[INFO] Cluster 36 cluster: Short SMA=72, Long SMA=230, Sharpe=0.1160, Trades=16
[INFO] Cluster 37 cluster: Short SMA=130, Long SMA=146, Sharpe=0.2610, Trades=34
[INFO] Cluster 38 cluster: Short SMA=130, Long SMA=248, Sharpe=-0.0543, Trades=11
[INFO] Cluster 39 cluster: Short SMA=248, Long SMA=254, Sharpe=0.0996, Trades=42
[INFO] Cluster 40 cluster: Short SMA=40, Long SMA=188, Sharpe=0.0009, Trades=22
[INFO] Cluster 41 cluster: Short SMA=56, Long SMA=136, Sharpe=-0.2503, Trades=25
[INFO] Cluster 42 cluster: Short SMA=110, Long SMA=142, Sharpe=0.2572, Trades=27
[INFO] Cluster 43 cluster: Short SMA=142, Long SMA=150, Sharpe=0.2987, Trades=48
[INFO] Cluster 45 cluster: Short SMA=156, Long SMA=234, Sharpe=-0.1261, Trades=13
[INFO] Cluster 46 cluster: Short SMA=40, Long SMA=252, Sharpe=0.0066, Trades=20
[INFO] Cluster 47 cluster: Short SMA=210, Long SMA=238, Sharpe=0.0482, Trades=19
[INFO] Cluster 48 cluster: Short SMA=78, Long SMA=90, Sharpe=-0.2917, Trades=57
[INFO] Cluster 49 cluster: Short SMA=20, Long SMA=38, Sharpe=-0.1420, Trades=88
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=22
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=98, Long SMA=168, Sharpe=0.5574, Trades=20
[INFO] Top 2: Short SMA=136, Long SMA=170, Sharpe=0.4235, Trades=20
[INFO] Top 3: Short SMA=146, Long SMA=150, Sharpe=0.3705, Trades=76
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 9853 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(98/168) - Original Sharpe: 0.5574, Trades: 20
[INFO] Hierarchical cluster 2: SMA(136/170) - Original Sharpe: 0.4235, Trades: 20
[INFO] Hierarchical cluster 3: SMA(146/150) - Original Sharpe: 0.3705, Trades: 76
[INFO] Hierarchical cluster 4: SMA(88/188) - Original Sharpe: 0.3597, Trades: 16
[INFO] Hierarchical cluster 5: SMA(142/150) - Original Sharpe: 0.2987, Trades: 48
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (98/168) - Sharpe: 0.5574
[INFO] cluster 2: (136/170) - Sharpe: 0.4235
[INFO] cluster 3: (146/150) - Sharpe: 0.3705
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            0.551202
1    2021-11-14 2021-11-14            43     0.620829            0.620829
2    2022-01-14 2022-01-14            41     0.058063            0.058063
3    2022-03-14 2022-03-14            44     1.979608            2.054112
4    2022-05-14 2022-05-14            43    -1.220633            0.036652
5    2022-07-14 2022-07-14            44     0.448047            0.940266
6    2022-09-14 2022-09-14            43     0.790083            0.790083
7    2022-11-14 2022-11-14            43    -1.736792           -1.736792
8    2023-01-14 2023-01-14            41     2.493082            2.990355
9    2023-03-14 2023-03-14            44    -0.132668           -1.367119
10   2023-05-14 2023-05-14            44     0.580825           -1.261239
11   2023-07-14 2023-07-14            44     4.541233            3.994579
12   2023-09-14 2023-09-14            43     0.691612            0.324974
13   2023-11-14 2023-11-14            42    -2.563801           -2.235847
14   2024-01-14 2024-01-14            43     4.073536            1.531242
15   2024-03-14 2024-03-14            42    -0.424007           -0.080170
16   2024-05-14 2024-05-14            44    -1.116674           -1.596447
17   2024-07-14 2024-07-14            45     3.495207           -0.124020
18   2024-09-14 2024-09-14            43    -2.003748           -2.003748
19   2024-11-14 2024-11-14            33     3.170976           -0.031119
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          2.0 |              2.1 |          0.1 | True          
[INFO] 2022-05-14   |         -1.2 |              0.0 |          1.2 | True          
[INFO] 2022-07-14   |          0.4 |              0.9 |          0.5 | True          
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          2.5 |              3.0 |          0.5 | True          
[INFO] 2023-03-14   |         -0.1 |             -1.4 |         -1.3 | False         
[INFO] 2023-05-14   |          0.6 |             -1.3 |         -1.9 | False         
[INFO] 2023-07-14   |          4.5 |              4.0 |         -0.5 | False         
[INFO] 2023-09-14   |          0.7 |              0.3 |         -0.4 | False         
[INFO] 2023-11-14   |         -2.6 |             -2.2 |          0.4 | True          
[INFO] 2024-01-14   |          4.1 |              1.5 |         -2.6 | False         
[INFO] 2024-03-14   |         -0.4 |             -0.1 |          0.3 | True          
[INFO] 2024-05-14   |         -1.1 |             -1.6 |         -0.5 | False         
[INFO] 2024-07-14   |          3.5 |             -0.1 |         -3.6 | False         
[INFO] 2024-09-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-11-14   |          3.2 |             -0.0 |         -3.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-09-14, 2022-11-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 14 periods (42.86% win rate)
[INFO] Updating Excel file with Hierarchical results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical win rate 42.9% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(98/168) - Original Sharpe: 0.5574
[INFO] Added cluster 2 to portfolio: SMA(136/170) - Original Sharpe: 0.4235
[INFO] Added cluster 3 to portfolio: SMA(146/150) - Original Sharpe: 0.3705
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1991
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6449
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BO in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 144.65s
[INFO] Best parameters: Short SMA = 48, Long SMA = 54
[INFO] Best Sharpe ratio: 1.148397, Trades: 89
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BO
[INFO] Big Point Value (from data): 600.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 13.60 contracts
[INFO] Maximum Position Size: 31 contracts
[INFO] Strategy Total P&L: $553,098.00
[INFO] Market Buy & Hold P&L: $8,556.00
[INFO] Outperformance: $544,542.00
[INFO] Sharpe ratio (entire period, annualized): 0.651163
[INFO] Sharpe ratio (in-sample, annualized): 1.148397
[INFO] Sharpe ratio (out-of-sample, annualized): -0.439751
[INFO] Maximum Drawdown: $162,660.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 63
[INFO] Out-of-sample period trades: 26
[INFO] Total trades: 89
[INFO] In-sample P&L: $556,682.00
[INFO] Out-of-sample P&L: $-96,936.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 54, Sharpe = 1.148397
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 89
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9834 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3624 to 2.7150
[INFO] Scaled Long SMA range: -2.7630 to 1.5177
[INFO] Scaled Sharpe ratio range: -2.5920 to 4.1745
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 209 elements
[INFO] Kmeans Cluster 1: 258 elements
[INFO] Kmeans Cluster 2: 153 elements
[INFO] Kmeans Cluster 3: 169 elements
[INFO] Kmeans Cluster 4: 285 elements
[INFO] Kmeans Cluster 5: 238 elements
[INFO] Kmeans Cluster 6: 235 elements
[INFO] Kmeans Cluster 7: 186 elements
[INFO] Kmeans Cluster 8: 199 elements
[INFO] Kmeans Cluster 9: 162 elements
[INFO] Kmeans Cluster 10: 183 elements
[INFO] Kmeans Cluster 11: 188 elements
[INFO] Kmeans Cluster 12: 243 elements
[INFO] Kmeans Cluster 13: 241 elements
[INFO] Kmeans Cluster 14: 241 elements
[INFO] Kmeans Cluster 15: 92 elements
[INFO] Kmeans Cluster 16: 273 elements
[INFO] Kmeans Cluster 17: 277 elements
[INFO] Kmeans Cluster 18: 220 elements
[INFO] Kmeans Cluster 19: 215 elements
[INFO] Kmeans Cluster 20: 63 elements
[INFO] Kmeans Cluster 21: 174 elements
[INFO] Kmeans Cluster 22: 153 elements
[INFO] Kmeans Cluster 23: 154 elements
[INFO] Kmeans Cluster 24: 194 elements
[INFO] Kmeans Cluster 25: 238 elements
[INFO] Kmeans Cluster 26: 109 elements
[INFO] Kmeans Cluster 27: 286 elements
[INFO] Kmeans Cluster 28: 117 elements
[INFO] Kmeans Cluster 29: 316 elements
[INFO] Kmeans Cluster 30: 190 elements
[INFO] Kmeans Cluster 31: 224 elements
[INFO] Kmeans Cluster 32: 270 elements
[INFO] Kmeans Cluster 33: 63 elements
[INFO] Kmeans Cluster 34: 206 elements
[INFO] Kmeans Cluster 35: 178 elements
[INFO] Kmeans Cluster 36: 270 elements
[INFO] Kmeans Cluster 37: 240 elements
[INFO] Kmeans Cluster 38: 234 elements
[INFO] Kmeans Cluster 39: 207 elements
[INFO] Kmeans Cluster 40: 220 elements
[INFO] Kmeans Cluster 41: 239 elements
[INFO] Kmeans Cluster 42: 90 elements
[INFO] Kmeans Cluster 43: 184 elements
[INFO] Kmeans Cluster 44: 141 elements
[INFO] Kmeans Cluster 45: 135 elements
[INFO] Kmeans Cluster 46: 205 elements
[INFO] Kmeans Cluster 47: 230 elements
[INFO] Kmeans Cluster 48: 51 elements
[INFO] Kmeans Cluster 49: 186 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=160.77, Long SMA=185.79, Sharpe=-0.0583
[INFO] Centroid 1: Short SMA=29.26, Long SMA=68.81, Sharpe=0.7040
[INFO] Centroid 2: Short SMA=253.62, Long SMA=277.14, Sharpe=0.3165
[INFO] Centroid 3: Short SMA=54.77, Long SMA=280.41, Sharpe=0.1596
[INFO] Centroid 4: Short SMA=28.80, Long SMA=150.62, Sharpe=0.2715
[INFO] Centroid 5: Short SMA=75.26, Long SMA=136.12, Sharpe=-0.2109
[INFO] Centroid 6: Short SMA=174.72, Long SMA=249.69, Sharpe=0.1372
[INFO] Centroid 7: Short SMA=198.22, Long SMA=254.69, Sharpe=0.2818
[INFO] Centroid 8: Short SMA=29.77, Long SMA=97.96, Sharpe=0.5147
[INFO] Centroid 9: Short SMA=62.35, Long SMA=183.54, Sharpe=-0.2455
[INFO] Centroid 10: Short SMA=69.07, Long SMA=95.26, Sharpe=0.0491
[INFO] Centroid 11: Short SMA=92.90, Long SMA=188.20, Sharpe=-0.0153
[INFO] Centroid 12: Short SMA=217.85, Long SMA=286.58, Sharpe=0.4554
[INFO] Centroid 13: Short SMA=145.85, Long SMA=271.00, Sharpe=0.0605
[INFO] Centroid 14: Short SMA=28.56, Long SMA=227.54, Sharpe=0.1424
[INFO] Centroid 15: Short SMA=264.91, Long SMA=287.37, Sharpe=-0.0111
[INFO] Centroid 16: Short SMA=104.95, Long SMA=184.47, Sharpe=-0.1370
[INFO] Centroid 17: Short SMA=175.07, Long SMA=206.20, Sharpe=0.0929
[INFO] Centroid 18: Short SMA=25.09, Long SMA=276.81, Sharpe=0.3450
[INFO] Centroid 19: Short SMA=110.07, Long SMA=246.14, Sharpe=0.1640
[INFO] Centroid 20: Short SMA=17.21, Long SMA=29.65, Sharpe=-0.1654
[INFO] Centroid 21: Short SMA=61.56, Long SMA=224.61, Sharpe=-0.0604
[INFO] Centroid 22: Short SMA=139.05, Long SMA=222.73, Sharpe=-0.1241
[INFO] Centroid 23: Short SMA=59.69, Long SMA=93.42, Sharpe=0.2438
[INFO] Centroid 24: Short SMA=22.51, Long SMA=198.41, Sharpe=0.0170
[INFO] Centroid 25: Short SMA=103.39, Long SMA=134.81, Sharpe=-0.0535
[INFO] Centroid 26: Short SMA=227.96, Long SMA=257.28, Sharpe=0.5924
[INFO] Centroid 27: Short SMA=25.49, Long SMA=117.26, Sharpe=0.4004
[INFO] Centroid 28: Short SMA=40.68, Long SMA=63.98, Sharpe=0.8984
[INFO] Centroid 29: Short SMA=197.66, Long SMA=223.73, Sharpe=0.1817
[INFO] Centroid 30: Short SMA=250.94, Long SMA=279.73, Sharpe=0.1494
[INFO] Centroid 31: Short SMA=55.46, Long SMA=203.88, Sharpe=-0.1423
[INFO] Centroid 32: Short SMA=143.41, Long SMA=244.97, Sharpe=0.0000
[INFO] Centroid 33: Short SMA=17.94, Long SMA=35.75, Sharpe=0.1452
[INFO] Centroid 34: Short SMA=122.05, Long SMA=148.22, Sharpe=-0.1990
[INFO] Centroid 35: Short SMA=26.46, Long SMA=176.36, Sharpe=0.1380
[INFO] Centroid 36: Short SMA=180.83, Long SMA=282.30, Sharpe=0.1761
[INFO] Centroid 37: Short SMA=136.37, Long SMA=162.65, Sharpe=-0.0500
[INFO] Centroid 38: Short SMA=79.52, Long SMA=230.34, Sharpe=0.0739
[INFO] Centroid 39: Short SMA=113.96, Long SMA=215.44, Sharpe=0.0222
[INFO] Centroid 40: Short SMA=82.66, Long SMA=108.65, Sharpe=-0.0978
[INFO] Centroid 41: Short SMA=69.10, Long SMA=164.69, Sharpe=-0.3721
[INFO] Centroid 42: Short SMA=29.11, Long SMA=48.47, Sharpe=0.4983
[INFO] Centroid 43: Short SMA=222.74, Long SMA=251.35, Sharpe=0.3952
[INFO] Centroid 44: Short SMA=33.08, Long SMA=290.30, Sharpe=0.2414
[INFO] Centroid 45: Short SMA=51.11, Long SMA=143.41, Sharpe=0.0019
[INFO] Centroid 46: Short SMA=91.81, Long SMA=257.34, Sharpe=0.2444
[INFO] Centroid 47: Short SMA=29.27, Long SMA=251.82, Sharpe=0.2552
[INFO] Centroid 48: Short SMA=284.86, Long SMA=296.71, Sharpe=-0.2597
[INFO] Centroid 49: Short SMA=137.02, Long SMA=194.53, Sharpe=0.0917
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=54, Sharpe=1.1484, Trades=89
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=44, Long SMA=64, Sharpe=0.9054, Trades=50
[INFO] Kmeans Top 2: Short SMA=30, Long SMA=70, Sharpe=0.6828, Trades=36
[INFO] Kmeans Top 3: Short SMA=230, Long SMA=254, Sharpe=0.5395, Trades=22
[INFO] Kmeans Top 4: Short SMA=28, Long SMA=48, Sharpe=0.5328, Trades=66
[INFO] Kmeans Top 5: Short SMA=32, Long SMA=98, Sharpe=0.4420, Trades=30
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (161, 186)
[INFO]   Nearest: (160.0, 186.0)
[INFO]   Rounded: (29, 69)
[INFO]   Nearest: (30.0, 68.0)
[INFO]   Rounded: (254, 277)
[INFO]   Nearest: (254.0, 278.0)
[INFO]   Rounded: (55, 280)
[INFO]   Nearest: (54.0, 280.0)
[INFO]   Rounded: (29, 151)
[INFO]   Nearest: (28.0, 150.0)
[INFO]   Rounded: (75, 136)
[INFO]   Nearest: (76.0, 136.0)
[INFO]   Rounded: (175, 250)
[INFO]   Nearest: (174.0, 250.0)
[INFO]   Rounded: (198, 255)
[INFO]   Nearest: (198.0, 254.0)
[INFO]   Rounded: (30, 98)
[INFO]   Rounded: (62, 184)
[INFO]   Rounded: (69, 95)
[INFO]   Nearest: (70.0, 96.0)
[INFO]   Rounded: (93, 188)
[INFO]   Nearest: (92.0, 188.0)
[INFO]   Rounded: (218, 287)
[INFO]   Nearest: (218.0, 286.0)
[INFO]   Rounded: (146, 271)
[INFO]   Nearest: (146.0, 270.0)
[INFO]   Rounded: (29, 228)
[INFO]   Nearest: (28.0, 228.0)
[INFO]   Rounded: (265, 287)
[INFO]   Nearest: (264.0, 288.0)
[INFO]   Rounded: (105, 184)
[INFO]   Nearest: (104.0, 184.0)
[INFO]   Rounded: (175, 206)
[INFO]   Nearest: (176.0, 206.0)
[INFO]   Rounded: (25, 277)
[INFO]   Nearest: (26.0, 276.0)
[INFO]   Rounded: (110, 246)
[INFO]   Rounded: (17, 30)
[INFO]   Nearest: (18.0, 30.0)
[INFO]   Rounded: (62, 225)
[INFO]   Nearest: (62.0, 224.0)
[INFO]   Rounded: (139, 223)
[INFO]   Nearest: (140.0, 222.0)
[INFO]   Rounded: (60, 93)
[INFO]   Nearest: (60.0, 94.0)
[INFO]   Rounded: (23, 198)
[INFO]   Nearest: (22.0, 198.0)
[INFO]   Rounded: (103, 135)
[INFO]   Nearest: (104.0, 134.0)
[INFO]   Rounded: (228, 257)
[INFO]   Nearest: (228.0, 258.0)
[INFO]   Rounded: (25, 117)
[INFO]   Nearest: (26.0, 118.0)
[INFO]   Rounded: (41, 64)
[INFO]   Nearest: (40.0, 64.0)
[INFO]   Rounded: (198, 224)
[INFO]   Rounded: (251, 280)
[INFO]   Nearest: (250.0, 280.0)
[INFO]   Rounded: (55, 204)
[INFO]   Nearest: (56.0, 204.0)
[INFO]   Rounded: (143, 245)
[INFO]   Nearest: (144.0, 244.0)
[INFO]   Rounded: (18, 36)
[INFO]   Rounded: (122, 148)
[INFO]   Rounded: (26, 176)
[INFO]   Rounded: (181, 282)
[INFO]   Nearest: (180.0, 282.0)
[INFO]   Rounded: (136, 163)
[INFO]   Nearest: (136.0, 162.0)
[INFO]   Rounded: (80, 230)
[INFO]   Rounded: (114, 215)
[INFO]   Nearest: (114.0, 216.0)
[INFO]   Rounded: (83, 109)
[INFO]   Nearest: (82.0, 108.0)
[INFO]   Rounded: (69, 165)
[INFO]   Nearest: (70.0, 164.0)
[INFO]   Rounded: (29, 48)
[INFO]   Nearest: (30.0, 48.0)
[INFO]   Rounded: (223, 251)
[INFO]   Nearest: (222.0, 252.0)
[INFO]   Rounded: (33, 290)
[INFO]   Nearest: (34.0, 290.0)
[INFO]   Rounded: (51, 143)
[INFO]   Nearest: (52.0, 144.0)
[INFO]   Rounded: (92, 257)
[INFO]   Nearest: (92.0, 258.0)
[INFO]   Rounded: (29, 252)
[INFO]   Nearest: (30.0, 252.0)
[INFO]   Rounded: (285, 297)
[INFO]   Nearest: (284.0, 296.0)
[INFO]   Rounded: (137, 195)
[INFO]   Nearest: (138.0, 194.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 54
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(44/64) - Original Sharpe: 0.9054, Trades: 50
[INFO] Kmeans cluster 2: SMA(30/70) - Original Sharpe: 0.6828, Trades: 36
[INFO] Kmeans cluster 3: SMA(230/254) - Original Sharpe: 0.5395, Trades: 22
[INFO] Kmeans cluster 4: SMA(28/48) - Original Sharpe: 0.5328, Trades: 66
[INFO] Kmeans cluster 5: SMA(32/98) - Original Sharpe: 0.4420, Trades: 30
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/54)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (44/64) - Sharpe: 0.9054
[INFO] cluster 2: (30/70) - Sharpe: 0.6828
[INFO] cluster 3: (230/254) - Sharpe: 0.5395
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -3.408887           -3.548196
1    2021-11-10 2021-11-10            41    -4.249630           -2.455196
2    2022-01-10 2022-01-10            41     1.218137            2.156790
3    2022-03-10 2022-03-10            42     2.126254            2.262674
4    2022-05-10 2022-05-10            41    -5.000926           -5.030735
5    2022-07-10 2022-07-10            44    -0.790260           -0.790260
6    2022-09-10 2022-09-10            43     1.268514            3.204948
7    2022-11-10 2022-11-10            40    -2.869549           -1.881657
8    2023-01-10 2023-01-10            41     1.869806            2.198292
9    2023-03-10 2023-03-10            42     1.878823            1.030365
10   2023-05-10 2023-05-10            40    -1.601658           -2.071226
11   2023-07-10 2023-07-10            44     0.545769           -0.431089
12   2023-09-10 2023-09-10            44     0.229410            1.941283
13   2023-11-10 2023-11-10            40     0.831968            0.831968
14   2024-01-10 2024-01-10            41     1.354455            1.633020
15   2024-03-10 2024-03-10            43    -1.598528           -4.376842
16   2024-05-10 2024-05-10            40     1.637085           -1.240902
17   2024-07-10 2024-07-10            43    -1.484568            0.180638
18   2024-09-10 2024-09-10            44     1.814989            0.215277
19   2024-11-10 2024-11-10            35    -2.317816           -5.950780
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -3.4 |             -3.5 |         -0.1 | False         
[INFO] 2021-11-10   |         -4.2 |             -2.5 |          1.7 | True          
[INFO] 2022-01-10   |          1.2 |              2.2 |          1.0 | True          
[INFO] 2022-03-10   |          2.1 |              2.3 |          0.2 | True          
[INFO] 2022-05-10   |         -5.0 |             -5.0 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2022-09-10   |          1.3 |              3.2 |          1.9 | True          
[INFO] 2022-11-10   |         -2.9 |             -1.9 |          1.0 | True          
[INFO] 2023-01-10   |          1.9 |              2.2 |          0.3 | True          
[INFO] 2023-03-10   |          1.9 |              1.0 |         -0.9 | False         
[INFO] 2023-05-10   |         -1.6 |             -2.1 |         -0.5 | False         
[INFO] 2023-07-10   |          0.5 |             -0.4 |         -0.9 | False         
[INFO] 2023-09-10   |          0.2 |              1.9 |          1.7 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.4 |              1.6 |          0.2 | True          
[INFO] 2024-03-10   |         -1.6 |             -4.4 |         -2.8 | False         
[INFO] 2024-05-10   |          1.6 |             -1.2 |         -2.8 | False         
[INFO] 2024-07-10   |         -1.5 |              0.2 |          1.7 | True          
[INFO] 2024-09-10   |          1.8 |              0.2 |         -1.6 | False         
[INFO] 2024-11-10   |         -2.3 |             -6.0 |         -3.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-10, 2022-07-10, 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 9 of 17 periods (52.94% win rate)
[INFO] Updating Excel file with Kmeans results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans win rate 52.9% in row 4
[INFO] Added best Sharpe parameters 48/54 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 54
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(44/64) - Original Sharpe: 0.9054
[INFO] Added cluster 2 to portfolio: SMA(30/70) - Original Sharpe: 0.6828
[INFO] Added cluster 3 to portfolio: SMA(230/254) - Original Sharpe: 0.5395
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BO_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3114
[INFO] Kmeans Best out-of-sample Sharpe: -0.4398
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BO
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 89
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9834 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5129 to 1.1484
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3624 to 2.7150
[INFO] Scaled Long SMA range: -2.7630 to 1.5177
[INFO] Scaled Sharpe ratio range: -2.5920 to 4.1745
[INFO] Scaled Trades range: -0.7949 to 15.6625
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9834 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5858
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 340 elements
[INFO] Cluster 1: 90 elements
[INFO] Cluster 2: 213 elements
[INFO] Cluster 3: 310 elements
[INFO] Cluster 4: 382 elements
[INFO] Cluster 5: 479 elements
[INFO] Cluster 6: 362 elements
[INFO] Cluster 7: 300 elements
[INFO] Cluster 8: 23 elements
[INFO] Cluster 9: 50 elements
[INFO] Cluster 10: 446 elements
[INFO] Cluster 11: 316 elements
[INFO] Cluster 12: 93 elements
[INFO] Cluster 13: 359 elements
[INFO] Cluster 14: 346 elements
[INFO] Cluster 15: 333 elements
[INFO] Cluster 16: 354 elements
[INFO] Cluster 17: 262 elements
[INFO] Cluster 18: 44 elements
[INFO] Cluster 19: 274 elements
[INFO] Cluster 20: 71 elements
[INFO] Cluster 21: 480 elements
[INFO] Cluster 22: 44 elements
[INFO] Cluster 23: 44 elements
[INFO] Cluster 24: 106 elements
[INFO] Cluster 25: 6 elements
[INFO] Cluster 26: 296 elements
[INFO] Cluster 27: 421 elements
[INFO] Cluster 28: 416 elements
[INFO] Cluster 29: 125 elements
[INFO] Cluster 30: 12 elements
[INFO] Cluster 31: 156 elements
[INFO] Cluster 32: 24 elements
[INFO] Cluster 33: 39 elements
[INFO] Cluster 34: 248 elements
[INFO] Cluster 35: 111 elements
[INFO] Cluster 36: 121 elements
[INFO] Cluster 37: 13 elements
[INFO] Cluster 38: 198 elements
[INFO] Cluster 39: 32 elements
[INFO] Cluster 40: 179 elements
[INFO] Cluster 41: 78 elements
[INFO] Cluster 42: 208 elements
[INFO] Cluster 43: 245 elements
[INFO] Cluster 44: 219 elements
[INFO] Cluster 45: 41 elements
[INFO] Cluster 46: 175 elements
[INFO] Cluster 47: 31 elements
[INFO] Cluster 48: 57 elements
[INFO] Cluster 49: 262 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=24, Long SMA=186, Sharpe=0.1139, Trades=30
[INFO] Cluster 1 cluster: Short SMA=30, Long SMA=46, Sharpe=0.5812, Trades=70
[INFO] Cluster 2 cluster: Short SMA=254, Long SMA=288, Sharpe=0.1842, Trades=20
[INFO] Cluster 3 cluster: Short SMA=32, Long SMA=70, Sharpe=0.7812, Trades=38
[INFO] Cluster 4 cluster: Short SMA=90, Long SMA=126, Sharpe=-0.1403, Trades=26
[INFO] Cluster 5 cluster: Short SMA=98, Long SMA=218, Sharpe=0.0029, Trades=16
[INFO] Cluster 6 cluster: Short SMA=148, Long SMA=180, Sharpe=-0.0181, Trades=20
[INFO] Cluster 7 cluster: Short SMA=26, Long SMA=100, Sharpe=0.3490, Trades=30
[INFO] Cluster 8 cluster: Short SMA=22, Long SMA=26, Sharpe=0.0143, Trades=148
[INFO] Cluster 9 cluster: Short SMA=24, Long SMA=36, Sharpe=0.1100, Trades=86
[INFO] Cluster 10 cluster: Short SMA=218, Long SMA=274, Sharpe=0.5041, Trades=14
[INFO] Cluster 11 cluster: Short SMA=30, Long SMA=152, Sharpe=0.2654, Trades=26
[INFO] Cluster 12 cluster: Short SMA=198, Long SMA=204, Sharpe=0.1083, Trades=42
[INFO] Cluster 13 cluster: Short SMA=50, Long SMA=264, Sharpe=0.2242, Trades=10
[INFO] Cluster 14 cluster: Short SMA=160, Long SMA=212, Sharpe=0.0904, Trades=16
[INFO] Cluster 15 cluster: Short SMA=76, Long SMA=134, Sharpe=-0.1901, Trades=23
[INFO] Cluster 16 cluster: Short SMA=190, Long SMA=224, Sharpe=0.1549, Trades=16
[INFO] Cluster 17 cluster: Short SMA=90, Long SMA=198, Sharpe=-0.0669, Trades=20
[INFO] Cluster 18 cluster: Short SMA=264, Long SMA=268, Sharpe=0.1688, Trades=52
[INFO] Cluster 19 cluster: Short SMA=22, Long SMA=258, Sharpe=0.3267, Trades=18
[INFO] Cluster 20 cluster: Short SMA=248, Long SMA=254, Sharpe=0.2372, Trades=48
[INFO] Cluster 21 cluster: Short SMA=142, Long SMA=260, Sharpe=0.0462, Trades=10
[INFO] Cluster 22 cluster: Short SMA=22, Long SMA=46, Sharpe=0.3097, Trades=66
[INFO] Cluster 23 cluster: Short SMA=180, Long SMA=182, Sharpe=-0.0657, Trades=82
[INFO] Cluster 24 cluster: Short SMA=150, Long SMA=156, Sharpe=0.0285, Trades=48
[INFO] Cluster 26 cluster: Short SMA=72, Long SMA=168, Sharpe=-0.4065, Trades=22
[INFO] Cluster 27 cluster: Short SMA=102, Long SMA=250, Sharpe=0.2315, Trades=10
[INFO] Cluster 28 cluster: Short SMA=178, Long SMA=274, Sharpe=0.1082, Trades=10
[INFO] Cluster 29 cluster: Short SMA=88, Long SMA=100, Sharpe=-0.0705, Trades=41
[INFO] Cluster 31 cluster: Short SMA=254, Long SMA=276, Sharpe=0.2620, Trades=24
[INFO] Cluster 32 cluster: Short SMA=246, Long SMA=248, Sharpe=0.3374, Trades=74
[INFO] Cluster 33 cluster: Short SMA=46, Long SMA=58, Sharpe=0.9701, Trades=65
[INFO] Cluster 34 cluster: Short SMA=52, Long SMA=196, Sharpe=-0.2592, Trades=22
[INFO] Cluster 35 cluster: Short SMA=58, Long SMA=102, Sharpe=0.1465, Trades=23
[INFO] Cluster 36 cluster: Short SMA=138, Long SMA=224, Sharpe=-0.1283, Trades=16
[INFO] Cluster 38 cluster: Short SMA=26, Long SMA=220, Sharpe=0.1416, Trades=24
[INFO] Cluster 39 cluster: Short SMA=106, Long SMA=108, Sharpe=-0.0325, Trades=84
[INFO] Cluster 40 cluster: Short SMA=116, Long SMA=152, Sharpe=-0.2537, Trades=24
[INFO] Cluster 41 cluster: Short SMA=68, Long SMA=82, Sharpe=0.2526, Trades=45
[INFO] Cluster 42 cluster: Short SMA=194, Long SMA=252, Sharpe=0.2381, Trades=14
[INFO] Cluster 43 cluster: Short SMA=30, Long SMA=286, Sharpe=0.4272, Trades=12
[INFO] Cluster 44 cluster: Short SMA=34, Long SMA=124, Sharpe=0.3680, Trades=24
[INFO] Cluster 45 cluster: Short SMA=16, Long SMA=30, Sharpe=-0.4021, Trades=102
[INFO] Cluster 46 cluster: Short SMA=50, Long SMA=224, Sharpe=-0.1033, Trades=20
[INFO] Cluster 47 cluster: Short SMA=288, Long SMA=298, Sharpe=-0.3307, Trades=44
[INFO] Cluster 48 cluster: Short SMA=230, Long SMA=244, Sharpe=0.4999, Trades=30
[INFO] Cluster 49 cluster: Short SMA=112, Long SMA=174, Sharpe=-0.1331, Trades=20
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=54, Sharpe=1.1484, Trades=89
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=46, Long SMA=58, Sharpe=0.9701, Trades=65
[INFO] Top 2: Short SMA=32, Long SMA=70, Sharpe=0.7812, Trades=38
[INFO] Top 3: Short SMA=30, Long SMA=46, Sharpe=0.5812, Trades=70
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 9803 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 54
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(46/58) - Original Sharpe: 0.9701, Trades: 65
[INFO] Hierarchical cluster 2: SMA(32/70) - Original Sharpe: 0.7812, Trades: 38
[INFO] Hierarchical cluster 3: SMA(30/46) - Original Sharpe: 0.5812, Trades: 70
[INFO] Hierarchical cluster 4: SMA(218/274) - Original Sharpe: 0.5041, Trades: 14
[INFO] Hierarchical cluster 5: SMA(230/244) - Original Sharpe: 0.4999, Trades: 30
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/54)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (46/58) - Sharpe: 0.9701
[INFO] cluster 2: (32/70) - Sharpe: 0.7812
[INFO] cluster 3: (30/46) - Sharpe: 0.5812
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -3.408887           -3.011985
1    2021-11-10 2021-11-10            41    -4.249630           -3.681542
2    2022-01-10 2022-01-10            41     1.218137            0.614105
3    2022-03-10 2022-03-10            42     2.126254            2.126254
4    2022-05-10 2022-05-10            41    -5.000926           -4.561856
5    2022-07-10 2022-07-10            44    -0.790260           -1.220528
6    2022-09-10 2022-09-10            43     1.268514            1.793897
7    2022-11-10 2022-11-10            40    -2.869549           -2.698271
8    2023-01-10 2023-01-10            41     1.869806            2.821585
9    2023-03-10 2023-03-10            42     1.878823            1.878823
10   2023-05-10 2023-05-10            40    -1.601658           -1.838660
11   2023-07-10 2023-07-10            44     0.545769            0.545769
12   2023-09-10 2023-09-10            44     0.229410            0.547246
13   2023-11-10 2023-11-10            40     0.831968            0.493203
14   2024-01-10 2024-01-10            41     1.354455            1.633020
15   2024-03-10 2024-03-10            43    -1.598528           -2.679757
16   2024-05-10 2024-05-10            40     1.637085           -0.158051
17   2024-07-10 2024-07-10            43    -1.484568           -1.077636
18   2024-09-10 2024-09-10            44     1.814989            1.495754
19   2024-11-10 2024-11-10            35    -2.317816           -4.987295
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -3.4 |             -3.0 |          0.4 | True          
[INFO] 2021-11-10   |         -4.2 |             -3.7 |          0.5 | True          
[INFO] 2022-01-10   |          1.2 |              0.6 |         -0.6 | False         
[INFO] 2022-03-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -5.0 |             -4.6 |          0.4 | True          
[INFO] 2022-07-10   |         -0.8 |             -1.2 |         -0.4 | False         
[INFO] 2022-09-10   |          1.3 |              1.8 |          0.5 | True          
[INFO] 2022-11-10   |         -2.9 |             -2.7 |          0.2 | True          
[INFO] 2023-01-10   |          1.9 |              2.8 |          0.9 | True          
[INFO] 2023-03-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -1.6 |             -1.8 |         -0.2 | False         
[INFO] 2023-07-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-09-10   |          0.2 |              0.5 |          0.3 | True          
[INFO] 2023-11-10   |          0.8 |              0.5 |         -0.3 | False         
[INFO] 2024-01-10   |          1.4 |              1.6 |          0.2 | True          
[INFO] 2024-03-10   |         -1.6 |             -2.7 |         -1.1 | False         
[INFO] 2024-05-10   |          1.6 |             -0.2 |         -1.8 | False         
[INFO] 2024-07-10   |         -1.5 |             -1.1 |          0.4 | True          
[INFO] 2024-09-10   |          1.8 |              1.5 |         -0.3 | False         
[INFO] 2024-11-10   |         -2.3 |             -5.0 |         -2.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-10, 2023-03-10, 2023-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 9 of 17 periods (52.94% win rate)
[INFO] Updating Excel file with Hierarchical results for BO...
[INFO] Excel file updated successfully. Added BO with Hierarchical win rate 52.9% in row 4
[INFO] Added best Sharpe parameters 48/54 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 54
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(46/58) - Original Sharpe: 0.9701
[INFO] Added cluster 2 to portfolio: SMA(32/70) - Original Sharpe: 0.7812
[INFO] Added cluster 3 to portfolio: SMA(30/46) - Original Sharpe: 0.5812
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BO_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.4732
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4398
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for BO...
[INFO] Excel file updated successfully. Added BO with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BO
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BP in column D: 8.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 129.55s
[INFO] Best parameters: Short SMA = 42, Long SMA = 58
[INFO] Best Sharpe ratio: 0.774978, Trades: 55
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BP
[INFO] Big Point Value (from data): 62500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.80 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $603,751.00
[INFO] Market Buy & Hold P&L: $-29,593.75
[INFO] Outperformance: $633,344.75
[INFO] Sharpe ratio (entire period, annualized): 0.716232
[INFO] Sharpe ratio (in-sample, annualized): 0.774978
[INFO] Sharpe ratio (out-of-sample, annualized): 0.572860
[INFO] Maximum Drawdown: $88,641.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 39
[INFO] Out-of-sample period trades: 16
[INFO] Total trades: 55
[INFO] In-sample P&L: $424,013.75
[INFO] Out-of-sample P&L: $128,250.00
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 58, Sharpe = 0.774978
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 62500.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5932 to 0.7750
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 58
[INFO] Sharpe Ratio: 0.774978
[INFO] Number of Trades: 55
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5932 to 0.7750
[INFO] Trades range: 11.0 to 357.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.8418 to 3.9473
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 124 elements
[INFO] Kmeans Cluster 1: 203 elements
[INFO] Kmeans Cluster 2: 230 elements
[INFO] Kmeans Cluster 3: 216 elements
[INFO] Kmeans Cluster 4: 303 elements
[INFO] Kmeans Cluster 5: 157 elements
[INFO] Kmeans Cluster 6: 216 elements
[INFO] Kmeans Cluster 7: 283 elements
[INFO] Kmeans Cluster 8: 170 elements
[INFO] Kmeans Cluster 9: 276 elements
[INFO] Kmeans Cluster 10: 167 elements
[INFO] Kmeans Cluster 11: 260 elements
[INFO] Kmeans Cluster 12: 249 elements
[INFO] Kmeans Cluster 13: 113 elements
[INFO] Kmeans Cluster 14: 202 elements
[INFO] Kmeans Cluster 15: 198 elements
[INFO] Kmeans Cluster 16: 188 elements
[INFO] Kmeans Cluster 17: 145 elements
[INFO] Kmeans Cluster 18: 246 elements
[INFO] Kmeans Cluster 19: 104 elements
[INFO] Kmeans Cluster 20: 212 elements
[INFO] Kmeans Cluster 21: 204 elements
[INFO] Kmeans Cluster 22: 393 elements
[INFO] Kmeans Cluster 23: 175 elements
[INFO] Kmeans Cluster 24: 354 elements
[INFO] Kmeans Cluster 25: 291 elements
[INFO] Kmeans Cluster 26: 220 elements
[INFO] Kmeans Cluster 27: 204 elements
[INFO] Kmeans Cluster 28: 194 elements
[INFO] Kmeans Cluster 29: 95 elements
[INFO] Kmeans Cluster 30: 261 elements
[INFO] Kmeans Cluster 31: 92 elements
[INFO] Kmeans Cluster 32: 157 elements
[INFO] Kmeans Cluster 33: 259 elements
[INFO] Kmeans Cluster 34: 172 elements
[INFO] Kmeans Cluster 35: 221 elements
[INFO] Kmeans Cluster 36: 213 elements
[INFO] Kmeans Cluster 37: 217 elements
[INFO] Kmeans Cluster 38: 163 elements
[INFO] Kmeans Cluster 39: 294 elements
[INFO] Kmeans Cluster 40: 273 elements
[INFO] Kmeans Cluster 41: 68 elements
[INFO] Kmeans Cluster 42: 147 elements
[INFO] Kmeans Cluster 43: 250 elements
[INFO] Kmeans Cluster 44: 151 elements
[INFO] Kmeans Cluster 45: 209 elements
[INFO] Kmeans Cluster 46: 249 elements
[INFO] Kmeans Cluster 47: 203 elements
[INFO] Kmeans Cluster 48: 220 elements
[INFO] Kmeans Cluster 49: 374 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=55.21, Long SMA=97.76, Sharpe=0.1676
[INFO] Centroid 1: Short SMA=116.72, Long SMA=237.80, Sharpe=-0.0288
[INFO] Centroid 2: Short SMA=242.82, Long SMA=282.29, Sharpe=0.0044
[INFO] Centroid 3: Short SMA=23.11, Long SMA=259.54, Sharpe=0.2595
[INFO] Centroid 4: Short SMA=34.86, Long SMA=82.27, Sharpe=0.4626
[INFO] Centroid 5: Short SMA=68.23, Long SMA=111.97, Sharpe=-0.1630
[INFO] Centroid 6: Short SMA=167.33, Long SMA=271.27, Sharpe=0.2622
[INFO] Centroid 7: Short SMA=47.24, Long SMA=153.87, Sharpe=0.1197
[INFO] Centroid 8: Short SMA=82.55, Long SMA=171.13, Sharpe=-0.1057
[INFO] Centroid 9: Short SMA=182.39, Long SMA=248.13, Sharpe=0.1876
[INFO] Centroid 10: Short SMA=96.23, Long SMA=285.90, Sharpe=0.0365
[INFO] Centroid 11: Short SMA=36.44, Long SMA=248.12, Sharpe=0.1731
[INFO] Centroid 12: Short SMA=37.52, Long SMA=220.51, Sharpe=0.0841
[INFO] Centroid 13: Short SMA=242.34, Long SMA=261.40, Sharpe=-0.2320
[INFO] Centroid 14: Short SMA=154.69, Long SMA=199.91, Sharpe=-0.0473
[INFO] Centroid 15: Short SMA=132.94, Long SMA=251.06, Sharpe=-0.1781
[INFO] Centroid 16: Short SMA=69.89, Long SMA=159.78, Sharpe=0.0317
[INFO] Centroid 17: Short SMA=209.68, Long SMA=234.90, Sharpe=0.2922
[INFO] Centroid 18: Short SMA=147.96, Long SMA=216.38, Sharpe=-0.1331
[INFO] Centroid 19: Short SMA=21.46, Long SMA=38.60, Sharpe=-0.0492
[INFO] Centroid 20: Short SMA=96.04, Long SMA=186.38, Sharpe=-0.0059
[INFO] Centroid 21: Short SMA=20.69, Long SMA=139.97, Sharpe=0.3334
[INFO] Centroid 22: Short SMA=107.54, Long SMA=201.36, Sharpe=0.0731
[INFO] Centroid 23: Short SMA=22.07, Long SMA=286.79, Sharpe=0.4059
[INFO] Centroid 24: Short SMA=186.98, Long SMA=219.43, Sharpe=0.1283
[INFO] Centroid 25: Short SMA=75.54, Long SMA=278.74, Sharpe=0.1686
[INFO] Centroid 26: Short SMA=194.89, Long SMA=284.08, Sharpe=-0.0246
[INFO] Centroid 27: Short SMA=38.90, Long SMA=69.93, Sharpe=0.3356
[INFO] Centroid 28: Short SMA=49.52, Long SMA=131.53, Sharpe=-0.0375
[INFO] Centroid 29: Short SMA=104.13, Long SMA=124.55, Sharpe=0.2607
[INFO] Centroid 30: Short SMA=45.31, Long SMA=192.90, Sharpe=0.0186
[INFO] Centroid 31: Short SMA=147.93, Long SMA=161.70, Sharpe=-0.2774
[INFO] Centroid 32: Short SMA=172.31, Long SMA=190.83, Sharpe=0.0710
[INFO] Centroid 33: Short SMA=19.10, Long SMA=185.39, Sharpe=0.1979
[INFO] Centroid 34: Short SMA=138.52, Long SMA=280.66, Sharpe=0.0247
[INFO] Centroid 35: Short SMA=25.77, Long SMA=99.64, Sharpe=0.5601
[INFO] Centroid 36: Short SMA=269.73, Long SMA=289.66, Sharpe=-0.0970
[INFO] Centroid 37: Short SMA=116.77, Long SMA=274.30, Sharpe=-0.0896
[INFO] Centroid 38: Short SMA=85.90, Long SMA=109.67, Sharpe=-0.0423
[INFO] Centroid 39: Short SMA=114.28, Long SMA=154.48, Sharpe=-0.0026
[INFO] Centroid 40: Short SMA=216.56, Long SMA=272.62, Sharpe=0.0824
[INFO] Centroid 41: Short SMA=73.09, Long SMA=87.35, Sharpe=-0.3877
[INFO] Centroid 42: Short SMA=19.52, Long SMA=47.09, Sharpe=0.1581
[INFO] Centroid 43: Short SMA=97.40, Long SMA=128.98, Sharpe=0.1204
[INFO] Centroid 44: Short SMA=231.81, Long SMA=259.63, Sharpe=-0.0977
[INFO] Centroid 45: Short SMA=155.92, Long SMA=281.66, Sharpe=0.1262
[INFO] Centroid 46: Short SMA=55.26, Long SMA=277.99, Sharpe=0.0914
[INFO] Centroid 47: Short SMA=141.42, Long SMA=171.19, Sharpe=-0.1514
[INFO] Centroid 48: Short SMA=60.60, Long SMA=222.35, Sharpe=-0.0269
[INFO] Centroid 49: Short SMA=86.22, Long SMA=237.35, Sharpe=0.0837
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=58, Sharpe=0.7750, Trades=55
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=24, Long SMA=102, Sharpe=0.5844, Trades=27
[INFO] Kmeans Top 2: Short SMA=36, Long SMA=82, Sharpe=0.4258, Trades=29
[INFO] Kmeans Top 3: Short SMA=166, Long SMA=272, Sharpe=0.3623, Trades=13
[INFO] Kmeans Top 4: Short SMA=22, Long SMA=288, Sharpe=0.3587, Trades=16
[INFO] Kmeans Top 5: Short SMA=20, Long SMA=140, Sharpe=0.3427, Trades=21
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (55, 98)
[INFO]   Nearest: (56.0, 98.0)
[INFO]   Rounded: (117, 238)
[INFO]   Nearest: (116.0, 238.0)
[INFO]   Rounded: (243, 282)
[INFO]   Nearest: (242.0, 282.0)
[INFO]   Rounded: (23, 260)
[INFO]   Nearest: (24.0, 260.0)
[INFO]   Rounded: (35, 82)
[INFO]   Nearest: (34.0, 82.0)
[INFO]   Rounded: (68, 112)
[INFO]   Rounded: (167, 271)
[INFO]   Nearest: (168.0, 272.0)
[INFO]   Rounded: (47, 154)
[INFO]   Nearest: (48.0, 154.0)
[INFO]   Rounded: (83, 171)
[INFO]   Nearest: (82.0, 172.0)
[INFO]   Rounded: (182, 248)
[INFO]   Rounded: (96, 286)
[INFO]   Rounded: (36, 248)
[INFO]   Rounded: (38, 221)
[INFO]   Nearest: (38.0, 220.0)
[INFO]   Rounded: (242, 261)
[INFO]   Nearest: (242.0, 262.0)
[INFO]   Rounded: (155, 200)
[INFO]   Nearest: (154.0, 200.0)
[INFO]   Rounded: (133, 251)
[INFO]   Nearest: (132.0, 252.0)
[INFO]   Rounded: (70, 160)
[INFO]   Rounded: (210, 235)
[INFO]   Nearest: (210.0, 234.0)
[INFO]   Rounded: (148, 216)
[INFO]   Rounded: (21, 39)
[INFO]   Nearest: (22.0, 38.0)
[INFO]   Rounded: (96, 186)
[INFO]   Rounded: (21, 140)
[INFO]   Nearest: (20.0, 140.0)
[INFO]   Rounded: (108, 201)
[INFO]   Nearest: (108.0, 202.0)
[INFO]   Rounded: (22, 287)
[INFO]   Nearest: (22.0, 286.0)
[INFO]   Rounded: (187, 219)
[INFO]   Nearest: (186.0, 220.0)
[INFO]   Rounded: (76, 279)
[INFO]   Nearest: (76.0, 278.0)
[INFO]   Rounded: (195, 284)
[INFO]   Nearest: (194.0, 284.0)
[INFO]   Rounded: (39, 70)
[INFO]   Nearest: (38.0, 70.0)
[INFO]   Rounded: (50, 132)
[INFO]   Rounded: (104, 125)
[INFO]   Nearest: (104.0, 124.0)
[INFO]   Rounded: (45, 193)
[INFO]   Nearest: (46.0, 192.0)
[INFO]   Rounded: (148, 162)
[INFO]   Rounded: (172, 191)
[INFO]   Nearest: (172.0, 190.0)
[INFO]   Rounded: (19, 185)
[INFO]   Nearest: (20.0, 186.0)
[INFO]   Rounded: (139, 281)
[INFO]   Nearest: (138.0, 280.0)
[INFO]   Rounded: (26, 100)
[INFO]   Rounded: (270, 290)
[INFO]   Rounded: (117, 274)
[INFO]   Nearest: (116.0, 274.0)
[INFO]   Rounded: (86, 110)
[INFO]   Rounded: (114, 154)
[INFO]   Rounded: (217, 273)
[INFO]   Nearest: (216.0, 272.0)
[INFO]   Rounded: (73, 87)
[INFO]   Nearest: (74.0, 88.0)
[INFO]   Rounded: (20, 47)
[INFO]   Nearest: (20.0, 48.0)
[INFO]   Rounded: (97, 129)
[INFO]   Nearest: (98.0, 128.0)
[INFO]   Rounded: (232, 260)
[INFO]   Rounded: (156, 282)
[INFO]   Rounded: (55, 278)
[INFO]   Nearest: (56.0, 278.0)
[INFO]   Rounded: (141, 171)
[INFO]   Nearest: (142.0, 172.0)
[INFO]   Rounded: (61, 222)
[INFO]   Nearest: (60.0, 222.0)
[INFO]   Rounded: (86, 237)
[INFO]   Nearest: (86.0, 238.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 58
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(24/102) - Original Sharpe: 0.5844, Trades: 27
[INFO] Kmeans cluster 2: SMA(36/82) - Original Sharpe: 0.4258, Trades: 29
[INFO] Kmeans cluster 3: SMA(166/272) - Original Sharpe: 0.3623, Trades: 13
[INFO] Kmeans cluster 4: SMA(22/288) - Original Sharpe: 0.3587, Trades: 16
[INFO] Kmeans cluster 5: SMA(20/140) - Original Sharpe: 0.3427, Trades: 21
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/58)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/102) - Sharpe: 0.5844
[INFO] cluster 2: (36/82) - Sharpe: 0.4258
[INFO] cluster 3: (166/272) - Sharpe: 0.3623
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.987883            2.470739
1    2021-11-14 2021-11-14            43    -2.596797           -5.029925
2    2022-01-14 2022-01-14            41    -0.015731            1.524414
3    2022-03-14 2022-03-14            44     3.605243            3.630872
4    2022-05-14 2022-05-14            43     1.166814            1.166814
5    2022-07-14 2022-07-14            44     2.275295            2.275295
6    2022-09-14 2022-09-14            43     0.019017            0.019017
7    2022-11-14 2022-11-14            43    -0.093903           -0.589705
8    2023-01-14 2023-01-14            41     1.898865           -1.677760
9    2023-03-14 2023-03-14            44    -0.658221           -3.476513
10   2023-05-14 2023-05-14            44     4.055520            4.451812
11   2023-07-14 2023-07-14            44    -5.179654           -4.876798
12   2023-09-14 2023-09-14            43     1.327473            1.327473
13   2023-11-14 2023-11-14            42    -1.340773            0.783415
14   2024-01-14 2024-01-14            43    -2.266886            0.578669
15   2024-03-14 2024-03-14            42     2.522025           -1.580754
16   2024-05-14 2024-05-14            44    -0.336600            0.308378
17   2024-07-14 2024-07-14            45     0.798888            0.798888
18   2024-09-14 2024-09-14            43     0.601562           -1.488728
19   2024-11-14 2024-11-14            33     1.741863            0.952043
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              2.5 |          1.5 | True          
[INFO] 2021-11-14   |         -2.6 |             -5.0 |         -2.4 | False         
[INFO] 2022-01-14   |         -0.0 |              1.5 |          1.5 | True          
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.1 |             -0.6 |         -0.5 | False         
[INFO] 2023-01-14   |          1.9 |             -1.7 |         -3.6 | False         
[INFO] 2023-03-14   |         -0.7 |             -3.5 |         -2.8 | False         
[INFO] 2023-05-14   |          4.1 |              4.5 |          0.4 | True          
[INFO] 2023-07-14   |         -5.2 |             -4.9 |          0.3 | True          
[INFO] 2023-09-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -1.3 |              0.8 |          2.1 | True          
[INFO] 2024-01-14   |         -2.3 |              0.6 |          2.9 | True          
[INFO] 2024-03-14   |          2.5 |             -1.6 |         -4.1 | False         
[INFO] 2024-05-14   |         -0.3 |              0.3 |          0.6 | True          
[INFO] 2024-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.6 |             -1.5 |         -2.1 | False         
[INFO] 2024-11-14   |          1.7 |              1.0 |         -0.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-09-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 7 of 14 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for BP...
[INFO] Excel file updated successfully. Added BP with Kmeans win rate 50.0% in row 5
[INFO] Added best Sharpe parameters 42/58 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 58
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/102) - Original Sharpe: 0.5844
[INFO] Added cluster 2 to portfolio: SMA(36/82) - Original Sharpe: 0.4258
[INFO] Added cluster 3 to portfolio: SMA(166/272) - Original Sharpe: 0.3623
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BP_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3147
[INFO] Kmeans Best out-of-sample Sharpe: 0.5729
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for BP...
[INFO] Excel file updated successfully. Added BP with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BP
[INFO] Big Point Value: 62500.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5932 to 0.7750
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 58
[INFO] Sharpe Ratio: 0.774978
[INFO] Number of Trades: 55
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5932 to 0.7750
[INFO] Trades range: 11.0 to 357.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.8418 to 3.9473
[INFO] Scaled Trades range: -0.5447 to 17.8407
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4399
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 425 elements
[INFO] Cluster 1: 640 elements
[INFO] Cluster 2: 122 elements
[INFO] Cluster 3: 242 elements
[INFO] Cluster 4: 44 elements
[INFO] Cluster 5: 69 elements
[INFO] Cluster 6: 258 elements
[INFO] Cluster 7: 236 elements
[INFO] Cluster 8: 678 elements
[INFO] Cluster 9: 362 elements
[INFO] Cluster 10: 272 elements
[INFO] Cluster 11: 157 elements
[INFO] Cluster 12: 249 elements
[INFO] Cluster 13: 257 elements
[INFO] Cluster 14: 354 elements
[INFO] Cluster 15: 524 elements
[INFO] Cluster 16: 287 elements
[INFO] Cluster 17: 272 elements
[INFO] Cluster 18: 147 elements
[INFO] Cluster 19: 204 elements
[INFO] Cluster 20: 232 elements
[INFO] Cluster 21: 177 elements
[INFO] Cluster 22: 119 elements
[INFO] Cluster 23: 407 elements
[INFO] Cluster 24: 308 elements
[INFO] Cluster 25: 281 elements
[INFO] Cluster 26: 105 elements
[INFO] Cluster 27: 10 elements
[INFO] Cluster 28: 428 elements
[INFO] Cluster 29: 337 elements
[INFO] Cluster 30: 202 elements
[INFO] Cluster 31: 77 elements
[INFO] Cluster 32: 263 elements
[INFO] Cluster 33: 37 elements
[INFO] Cluster 34: 216 elements
[INFO] Cluster 35: 273 elements
[INFO] Cluster 36: 14 elements
[INFO] Cluster 37: 32 elements
[INFO] Cluster 38: 3 elements
[INFO] Cluster 39: 46 elements
[INFO] Cluster 40: 231 elements
[INFO] Cluster 41: 13 elements
[INFO] Cluster 42: 121 elements
[INFO] Cluster 43: 164 elements
[INFO] Cluster 44: 314 elements
[INFO] Cluster 45: 55 elements
[INFO] Cluster 46: 34 elements
[INFO] Cluster 47: 39 elements
[INFO] Cluster 48: 237 elements
[INFO] Cluster 49: 11 elements
[INFO] Using 45 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=74, Long SMA=200, Sharpe=-0.0093, Trades=14
[INFO] Cluster 1 cluster: Short SMA=72, Long SMA=272, Sharpe=0.1718, Trades=13
[INFO] Cluster 2 cluster: Short SMA=18, Long SMA=40, Sharpe=0.0390, Trades=77
[INFO] Cluster 3 cluster: Short SMA=62, Long SMA=118, Sharpe=-0.2032, Trades=21
[INFO] Cluster 4 cluster: Short SMA=114, Long SMA=116, Sharpe=0.0090, Trades=81
[INFO] Cluster 5 cluster: Short SMA=42, Long SMA=46, Sharpe=0.3136, Trades=115
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=284, Sharpe=0.3257, Trades=14
[INFO] Cluster 7 cluster: Short SMA=242, Long SMA=266, Sharpe=-0.1544, Trades=19
[INFO] Cluster 8 cluster: Short SMA=104, Long SMA=212, Sharpe=0.1087, Trades=14
[INFO] Cluster 9 cluster: Short SMA=30, Long SMA=248, Sharpe=0.1320, Trades=19
[INFO] Cluster 10 cluster: Short SMA=24, Long SMA=96, Sharpe=0.6073, Trades=29
[INFO] Cluster 11 cluster: Short SMA=86, Long SMA=104, Sharpe=0.2444, Trades=39
[INFO] Cluster 12 cluster: Short SMA=56, Long SMA=162, Sharpe=0.0439, Trades=17
[INFO] Cluster 13 cluster: Short SMA=144, Long SMA=172, Sharpe=-0.2206, Trades=20
[INFO] Cluster 14 cluster: Short SMA=150, Long SMA=202, Sharpe=-0.1117, Trades=12
[INFO] Cluster 15 cluster: Short SMA=182, Long SMA=234, Sharpe=0.0999, Trades=12
[INFO] Cluster 16 cluster: Short SMA=42, Long SMA=236, Sharpe=0.1172, Trades=19
[INFO] Cluster 17 cluster: Short SMA=236, Long SMA=282, Sharpe=0.0066, Trades=13
[INFO] Cluster 18 cluster: Short SMA=36, Long SMA=72, Sharpe=0.3774, Trades=43
[INFO] Cluster 19 cluster: Short SMA=32, Long SMA=112, Sharpe=0.3735, Trades=23
[INFO] Cluster 20 cluster: Short SMA=166, Long SMA=272, Sharpe=0.3623, Trades=13
[INFO] Cluster 21 cluster: Short SMA=72, Long SMA=120, Sharpe=-0.0659, Trades=19
[INFO] Cluster 22 cluster: Short SMA=210, Long SMA=236, Sharpe=0.2845, Trades=14
[INFO] Cluster 23 cluster: Short SMA=114, Long SMA=264, Sharpe=-0.1700, Trades=12
[INFO] Cluster 24 cluster: Short SMA=58, Long SMA=144, Sharpe=0.1157, Trades=17
[INFO] Cluster 25 cluster: Short SMA=20, Long SMA=186, Sharpe=0.2483, Trades=21
[INFO] Cluster 26 cluster: Short SMA=26, Long SMA=58, Sharpe=0.1090, Trades=53
[INFO] Cluster 28 cluster: Short SMA=102, Long SMA=160, Sharpe=-0.0366, Trades=18
[INFO] Cluster 29 cluster: Short SMA=140, Long SMA=234, Sharpe=-0.1603, Trades=12
[INFO] Cluster 30 cluster: Short SMA=188, Long SMA=202, Sharpe=0.1420, Trades=22
[INFO] Cluster 31 cluster: Short SMA=106, Long SMA=116, Sharpe=-0.1848, Trades=50
[INFO] Cluster 32 cluster: Short SMA=150, Long SMA=276, Sharpe=0.1468, Trades=13
[INFO] Cluster 33 cluster: Short SMA=194, Long SMA=196, Sharpe=-0.0893, Trades=60
[INFO] Cluster 34 cluster: Short SMA=100, Long SMA=130, Sharpe=0.1545, Trades=22
[INFO] Cluster 35 cluster: Short SMA=218, Long SMA=276, Sharpe=0.0735, Trades=13
[INFO] Cluster 37 cluster: Short SMA=48, Long SMA=54, Sharpe=0.4104, Trades=77
[INFO] Cluster 39 cluster: Short SMA=76, Long SMA=92, Sharpe=-0.5321, Trades=47
[INFO] Cluster 40 cluster: Short SMA=116, Long SMA=292, Sharpe=-0.0142, Trades=13
[INFO] Cluster 42 cluster: Short SMA=22, Long SMA=148, Sharpe=0.2367, Trades=19
[INFO] Cluster 43 cluster: Short SMA=274, Long SMA=284, Sharpe=-0.0344, Trades=25
[INFO] Cluster 44 cluster: Short SMA=40, Long SMA=200, Sharpe=0.0327, Trades=17
[INFO] Cluster 45 cluster: Short SMA=42, Long SMA=60, Sharpe=0.5796, Trades=53
[INFO] Cluster 46 cluster: Short SMA=270, Long SMA=272, Sharpe=-0.1811, Trades=51
[INFO] Cluster 47 cluster: Short SMA=154, Long SMA=160, Sharpe=-0.3481, Trades=34
[INFO] Cluster 48 cluster: Short SMA=196, Long SMA=284, Sharpe=-0.0450, Trades=13
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=58, Sharpe=0.7750, Trades=55
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=24, Long SMA=96, Sharpe=0.6073, Trades=29
[INFO] Top 2: Short SMA=42, Long SMA=60, Sharpe=0.5796, Trades=53
[INFO] Top 3: Short SMA=48, Long SMA=54, Sharpe=0.4104, Trades=77
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 45 valid clusters with clusters
[INFO] Filtering to 10534 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 58
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(24/96) - Original Sharpe: 0.6073, Trades: 29
[INFO] Hierarchical cluster 2: SMA(42/60) - Original Sharpe: 0.5796, Trades: 53
[INFO] Hierarchical cluster 3: SMA(48/54) - Original Sharpe: 0.4104, Trades: 77
[INFO] Hierarchical cluster 4: SMA(36/72) - Original Sharpe: 0.3774, Trades: 43
[INFO] Hierarchical cluster 5: SMA(32/112) - Original Sharpe: 0.3735, Trades: 23
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/58)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/96) - Sharpe: 0.6073
[INFO] cluster 2: (42/60) - Sharpe: 0.5796
[INFO] cluster 3: (48/54) - Sharpe: 0.4104
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.987883            2.738014
1    2021-11-14 2021-11-14            43    -2.596797           -2.596797
2    2022-01-14 2022-01-14            41    -0.015731           -1.440824
3    2022-03-14 2022-03-14            44     3.605243            3.605243
4    2022-05-14 2022-05-14            43     1.166814            1.166814
5    2022-07-14 2022-07-14            44     2.275295            2.275295
6    2022-09-14 2022-09-14            43     0.019017            0.019017
7    2022-11-14 2022-11-14            43    -0.093903            0.054652
8    2023-01-14 2023-01-14            41     1.898865           -1.388452
9    2023-03-14 2023-03-14            44    -0.658221           -1.279125
10   2023-05-14 2023-05-14            44     4.055520            4.055520
11   2023-07-14 2023-07-14            44    -5.179654           -5.594133
12   2023-09-14 2023-09-14            43     1.327473            1.013722
13   2023-11-14 2023-11-14            42    -1.340773           -1.621553
14   2024-01-14 2024-01-14            43    -2.266886           -1.582944
15   2024-03-14 2024-03-14            42     2.522025            1.503154
16   2024-05-14 2024-05-14            44    -0.336600            0.099506
17   2024-07-14 2024-07-14            45     0.798888            0.798888
18   2024-09-14 2024-09-14            43     0.601562            0.327296
19   2024-11-14 2024-11-14            33     1.741863            1.741863
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              2.7 |          1.7 | True          
[INFO] 2021-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -0.0 |             -1.4 |         -1.4 | False         
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.1 |              0.1 |          0.2 | True          
[INFO] 2023-01-14   |          1.9 |             -1.4 |         -3.3 | False         
[INFO] 2023-03-14   |         -0.7 |             -1.3 |         -0.6 | False         
[INFO] 2023-05-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -5.2 |             -5.6 |         -0.4 | False         
[INFO] 2023-09-14   |          1.3 |              1.0 |         -0.3 | False         
[INFO] 2023-11-14   |         -1.3 |             -1.6 |         -0.3 | False         
[INFO] 2024-01-14   |         -2.3 |             -1.6 |          0.7 | True          
[INFO] 2024-03-14   |          2.5 |              1.5 |         -1.0 | False         
[INFO] 2024-05-14   |         -0.3 |              0.1 |          0.4 | True          
[INFO] 2024-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.6 |              0.3 |         -0.3 | False         
[INFO] 2024-11-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-05-14, 2024-07-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 12 periods (33.33% win rate)
[INFO] Updating Excel file with Hierarchical results for BP...
[INFO] Excel file updated successfully. Added BP with Hierarchical win rate 33.3% in row 5
[INFO] Added best Sharpe parameters 42/58 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 58
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/96) - Original Sharpe: 0.6073
[INFO] Added cluster 2 to portfolio: SMA(42/60) - Original Sharpe: 0.5796
[INFO] Added cluster 3 to portfolio: SMA(48/54) - Original Sharpe: 0.4104
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BP_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3470
[INFO] Hierarchical Best out-of-sample Sharpe: 0.5729
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for BP...
[INFO] Excel file updated successfully. Added BP with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BP
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BRN in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 130.04s
[INFO] Best parameters: Short SMA = 10, Long SMA = 26
[INFO] Best Sharpe ratio: 1.115955, Trades: 106
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BRN=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.82 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $738,554.00
[INFO] Market Buy & Hold P&L: $-13,990.00
[INFO] Outperformance: $752,544.00
[INFO] Sharpe ratio (entire period, annualized): 0.960879
[INFO] Sharpe ratio (in-sample, annualized): 1.115955
[INFO] Sharpe ratio (out-of-sample, annualized): 0.618723
[INFO] Maximum Drawdown: $146,756.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 66
[INFO] Out-of-sample period trades: 40
[INFO] Total trades: 106
[INFO] In-sample P&L: $658,590.00
[INFO] Out-of-sample P&L: $165,200.00
[INFO] 
Best parameters from GA: Short SMA = 10, Long SMA = 26, Sharpe = 1.115955
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8116 to 1.1160
[INFO] 
Best parameters:
[INFO] Short SMA: 10
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 1.115955
[INFO] Number of Trades: 106
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8116 to 1.1160
[INFO] Trades range: 11.0 to 325.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6772 to 3.5491
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 215 elements
[INFO] Kmeans Cluster 1: 138 elements
[INFO] Kmeans Cluster 2: 125 elements
[INFO] Kmeans Cluster 3: 136 elements
[INFO] Kmeans Cluster 4: 256 elements
[INFO] Kmeans Cluster 5: 236 elements
[INFO] Kmeans Cluster 6: 261 elements
[INFO] Kmeans Cluster 7: 232 elements
[INFO] Kmeans Cluster 8: 160 elements
[INFO] Kmeans Cluster 9: 222 elements
[INFO] Kmeans Cluster 10: 187 elements
[INFO] Kmeans Cluster 11: 174 elements
[INFO] Kmeans Cluster 12: 277 elements
[INFO] Kmeans Cluster 13: 77 elements
[INFO] Kmeans Cluster 14: 321 elements
[INFO] Kmeans Cluster 15: 35 elements
[INFO] Kmeans Cluster 16: 121 elements
[INFO] Kmeans Cluster 17: 151 elements
[INFO] Kmeans Cluster 18: 267 elements
[INFO] Kmeans Cluster 19: 401 elements
[INFO] Kmeans Cluster 20: 177 elements
[INFO] Kmeans Cluster 21: 243 elements
[INFO] Kmeans Cluster 22: 259 elements
[INFO] Kmeans Cluster 23: 99 elements
[INFO] Kmeans Cluster 24: 87 elements
[INFO] Kmeans Cluster 25: 250 elements
[INFO] Kmeans Cluster 26: 250 elements
[INFO] Kmeans Cluster 27: 92 elements
[INFO] Kmeans Cluster 28: 282 elements
[INFO] Kmeans Cluster 29: 187 elements
[INFO] Kmeans Cluster 30: 165 elements
[INFO] Kmeans Cluster 31: 110 elements
[INFO] Kmeans Cluster 32: 228 elements
[INFO] Kmeans Cluster 33: 139 elements
[INFO] Kmeans Cluster 34: 255 elements
[INFO] Kmeans Cluster 35: 207 elements
[INFO] Kmeans Cluster 36: 271 elements
[INFO] Kmeans Cluster 37: 174 elements
[INFO] Kmeans Cluster 38: 140 elements
[INFO] Kmeans Cluster 39: 212 elements
[INFO] Kmeans Cluster 40: 335 elements
[INFO] Kmeans Cluster 41: 257 elements
[INFO] Kmeans Cluster 42: 336 elements
[INFO] Kmeans Cluster 43: 321 elements
[INFO] Kmeans Cluster 44: 294 elements
[INFO] Kmeans Cluster 45: 293 elements
[INFO] Kmeans Cluster 46: 221 elements
[INFO] Kmeans Cluster 47: 265 elements
[INFO] Kmeans Cluster 48: 187 elements
[INFO] Kmeans Cluster 49: 257 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=124.05, Long SMA=239.48, Sharpe=0.3562
[INFO] Centroid 1: Short SMA=65.48, Long SMA=102.00, Sharpe=-0.0019
[INFO] Centroid 2: Short SMA=47.36, Long SMA=64.77, Sharpe=0.3861
[INFO] Centroid 3: Short SMA=169.68, Long SMA=292.32, Sharpe=-0.0088
[INFO] Centroid 4: Short SMA=65.11, Long SMA=191.97, Sharpe=0.1126
[INFO] Centroid 5: Short SMA=103.90, Long SMA=187.07, Sharpe=-0.0444
[INFO] Centroid 6: Short SMA=219.77, Long SMA=247.59, Sharpe=0.2344
[INFO] Centroid 7: Short SMA=188.24, Long SMA=218.03, Sharpe=0.5804
[INFO] Centroid 8: Short SMA=115.01, Long SMA=265.49, Sharpe=0.1361
[INFO] Centroid 9: Short SMA=88.33, Long SMA=120.99, Sharpe=-0.3839
[INFO] Centroid 10: Short SMA=28.07, Long SMA=279.69, Sharpe=0.4642
[INFO] Centroid 11: Short SMA=140.49, Long SMA=186.91, Sharpe=0.1434
[INFO] Centroid 12: Short SMA=27.32, Long SMA=135.17, Sharpe=0.1935
[INFO] Centroid 13: Short SMA=23.87, Long SMA=35.35, Sharpe=0.8348
[INFO] Centroid 14: Short SMA=155.82, Long SMA=225.98, Sharpe=0.4647
[INFO] Centroid 15: Short SMA=286.06, Long SMA=294.97, Sharpe=-0.2238
[INFO] Centroid 16: Short SMA=108.71, Long SMA=295.34, Sharpe=-0.2022
[INFO] Centroid 17: Short SMA=29.23, Long SMA=190.89, Sharpe=0.5100
[INFO] Centroid 18: Short SMA=196.07, Long SMA=279.42, Sharpe=0.1760
[INFO] Centroid 19: Short SMA=31.67, Long SMA=244.49, Sharpe=0.3740
[INFO] Centroid 20: Short SMA=148.67, Long SMA=287.03, Sharpe=0.1166
[INFO] Centroid 21: Short SMA=34.59, Long SMA=281.67, Sharpe=0.2980
[INFO] Centroid 22: Short SMA=116.01, Long SMA=152.09, Sharpe=-0.2065
[INFO] Centroid 23: Short SMA=182.08, Long SMA=197.39, Sharpe=0.1735
[INFO] Centroid 24: Short SMA=90.00, Long SMA=120.37, Sharpe=-0.5933
[INFO] Centroid 25: Short SMA=26.68, Long SMA=53.30, Sharpe=0.6254
[INFO] Centroid 26: Short SMA=66.57, Long SMA=247.82, Sharpe=0.0745
[INFO] Centroid 27: Short SMA=159.11, Long SMA=174.02, Sharpe=0.5456
[INFO] Centroid 28: Short SMA=90.45, Long SMA=233.19, Sharpe=-0.1257
[INFO] Centroid 29: Short SMA=165.42, Long SMA=191.03, Sharpe=0.3510
[INFO] Centroid 30: Short SMA=221.05, Long SMA=288.15, Sharpe=0.0379
[INFO] Centroid 31: Short SMA=53.58, Long SMA=86.98, Sharpe=0.2322
[INFO] Centroid 32: Short SMA=71.05, Long SMA=207.79, Sharpe=-0.0168
[INFO] Centroid 33: Short SMA=107.21, Long SMA=152.43, Sharpe=-0.3967
[INFO] Centroid 34: Short SMA=98.75, Long SMA=277.31, Sharpe=-0.0229
[INFO] Centroid 35: Short SMA=212.00, Long SMA=242.97, Sharpe=0.4367
[INFO] Centroid 36: Short SMA=28.40, Long SMA=163.58, Sharpe=0.3332
[INFO] Centroid 37: Short SMA=133.74, Long SMA=150.83, Sharpe=-0.0235
[INFO] Centroid 38: Short SMA=59.94, Long SMA=157.17, Sharpe=-0.1115
[INFO] Centroid 39: Short SMA=27.68, Long SMA=74.02, Sharpe=0.4919
[INFO] Centroid 40: Short SMA=28.00, Long SMA=206.72, Sharpe=0.3377
[INFO] Centroid 41: Short SMA=181.02, Long SMA=253.63, Sharpe=0.2850
[INFO] Centroid 42: Short SMA=30.86, Long SMA=106.14, Sharpe=0.3856
[INFO] Centroid 43: Short SMA=75.45, Long SMA=154.31, Sharpe=-0.2640
[INFO] Centroid 44: Short SMA=146.24, Long SMA=263.63, Sharpe=0.3376
[INFO] Centroid 45: Short SMA=119.94, Long SMA=207.45, Sharpe=0.0711
[INFO] Centroid 46: Short SMA=245.67, Long SMA=279.85, Sharpe=0.1960
[INFO] Centroid 47: Short SMA=68.63, Long SMA=282.53, Sharpe=0.1473
[INFO] Centroid 48: Short SMA=76.14, Long SMA=104.87, Sharpe=-0.1913
[INFO] Centroid 49: Short SMA=261.43, Long SMA=281.74, Sharpe=0.0243
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=10, Long SMA=26, Sharpe=1.1160, Trades=106
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=20, Long SMA=30, Sharpe=0.7359, Trades=90
[INFO] Kmeans Top 2: Short SMA=190, Long SMA=218, Sharpe=0.6844, Trades=25
[INFO] Kmeans Top 3: Short SMA=26, Long SMA=54, Sharpe=0.5986, Trades=57
[INFO] Kmeans Top 4: Short SMA=28, Long SMA=188, Sharpe=0.5777, Trades=19
[INFO] Kmeans Top 5: Short SMA=158, Long SMA=174, Sharpe=0.5702, Trades=37
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (124, 239)
[INFO]   Nearest: (124.0, 240.0)
[INFO]   Rounded: (65, 102)
[INFO]   Nearest: (66.0, 102.0)
[INFO]   Rounded: (47, 65)
[INFO]   Nearest: (48.0, 64.0)
[INFO]   Rounded: (170, 292)
[INFO]   Rounded: (65, 192)
[INFO]   Nearest: (66.0, 192.0)
[INFO]   Rounded: (104, 187)
[INFO]   Nearest: (104.0, 188.0)
[INFO]   Rounded: (220, 248)
[INFO]   Rounded: (188, 218)
[INFO]   Rounded: (115, 265)
[INFO]   Nearest: (116.0, 266.0)
[INFO]   Rounded: (88, 121)
[INFO]   Nearest: (88.0, 120.0)
[INFO]   Rounded: (28, 280)
[INFO]   Rounded: (140, 187)
[INFO]   Nearest: (140.0, 186.0)
[INFO]   Rounded: (27, 135)
[INFO]   Nearest: (28.0, 136.0)
[INFO]   Rounded: (24, 35)
[INFO]   Nearest: (24.0, 36.0)
[INFO]   Rounded: (156, 226)
[INFO]   Rounded: (286, 295)
[INFO]   Nearest: (286.0, 294.0)
[INFO]   Rounded: (109, 295)
[INFO]   Nearest: (108.0, 296.0)
[INFO]   Rounded: (29, 191)
[INFO]   Nearest: (30.0, 190.0)
[INFO]   Rounded: (196, 279)
[INFO]   Nearest: (196.0, 280.0)
[INFO]   Rounded: (32, 244)
[INFO]   Rounded: (149, 287)
[INFO]   Nearest: (148.0, 288.0)
[INFO]   Rounded: (35, 282)
[INFO]   Nearest: (34.0, 282.0)
[INFO]   Rounded: (116, 152)
[INFO]   Rounded: (182, 197)
[INFO]   Nearest: (182.0, 198.0)
[INFO]   Rounded: (90, 120)
[INFO]   Rounded: (27, 53)
[INFO]   Nearest: (26.0, 54.0)
[INFO]   Rounded: (67, 248)
[INFO]   Nearest: (66.0, 248.0)
[INFO]   Rounded: (159, 174)
[INFO]   Nearest: (160.0, 174.0)
[INFO]   Rounded: (90, 233)
[INFO]   Nearest: (90.0, 234.0)
[INFO]   Rounded: (165, 191)
[INFO]   Nearest: (166.0, 192.0)
[INFO]   Rounded: (221, 288)
[INFO]   Nearest: (222.0, 288.0)
[INFO]   Rounded: (54, 87)
[INFO]   Nearest: (54.0, 86.0)
[INFO]   Rounded: (71, 208)
[INFO]   Nearest: (72.0, 208.0)
[INFO]   Rounded: (107, 152)
[INFO]   Nearest: (108.0, 152.0)
[INFO]   Rounded: (99, 277)
[INFO]   Nearest: (98.0, 278.0)
[INFO]   Rounded: (212, 243)
[INFO]   Nearest: (212.0, 242.0)
[INFO]   Rounded: (28, 164)
[INFO]   Rounded: (134, 151)
[INFO]   Nearest: (134.0, 150.0)
[INFO]   Rounded: (60, 157)
[INFO]   Nearest: (60.0, 158.0)
[INFO]   Rounded: (28, 74)
[INFO]   Rounded: (28, 207)
[INFO]   Nearest: (28.0, 206.0)
[INFO]   Rounded: (181, 254)
[INFO]   Nearest: (182.0, 254.0)
[INFO]   Rounded: (31, 106)
[INFO]   Nearest: (30.0, 106.0)
[INFO]   Rounded: (75, 154)
[INFO]   Nearest: (76.0, 154.0)
[INFO]   Rounded: (146, 264)
[INFO]   Rounded: (120, 207)
[INFO]   Nearest: (120.0, 208.0)
[INFO]   Rounded: (246, 280)
[INFO]   Rounded: (69, 283)
[INFO]   Nearest: (68.0, 282.0)
[INFO]   Rounded: (76, 105)
[INFO]   Nearest: (76.0, 104.0)
[INFO]   Rounded: (261, 282)
[INFO]   Nearest: (262.0, 282.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 10, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(20/30) - Original Sharpe: 0.7359, Trades: 90
[INFO] Kmeans cluster 2: SMA(190/218) - Original Sharpe: 0.6844, Trades: 25
[INFO] Kmeans cluster 3: SMA(26/54) - Original Sharpe: 0.5986, Trades: 57
[INFO] Kmeans cluster 4: SMA(28/188) - Original Sharpe: 0.5777, Trades: 19
[INFO] Kmeans cluster 5: SMA(158/174) - Original Sharpe: 0.5702, Trades: 37
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (10/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (20/30) - Sharpe: 0.7359
[INFO] cluster 2: (190/218) - Sharpe: 0.6844
[INFO] cluster 3: (26/54) - Sharpe: 0.5986
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     4.800806            2.796250
1    2021-11-14 2021-11-14            44     2.049644           -2.412465
2    2022-01-14 2022-01-14            41     3.528418            3.315988
3    2022-03-14 2022-03-14            44     0.138982           -1.599655
4    2022-05-14 2022-05-14            43     1.388289           -0.355206
5    2022-07-14 2022-07-14            44    -3.155014           -1.152645
6    2022-09-14 2022-09-14            43    -0.180219           -0.150621
7    2022-11-14 2022-11-14            43    -1.334805           -3.843286
8    2023-01-14 2023-01-14            41    -0.581478           -0.075977
9    2023-03-14 2023-03-14            43    -0.524319           -0.609580
10   2023-05-14 2023-05-14            44    -1.200228           -1.316817
11   2023-07-14 2023-07-14            44     0.362193            3.945409
12   2023-09-14 2023-09-14            43    -2.369631            0.701895
13   2023-11-14 2023-11-14            42     1.581330            1.380372
14   2024-01-14 2024-01-14            43     1.622963            1.225494
15   2024-03-14 2024-03-14            42     4.138827            0.453107
16   2024-05-14 2024-05-14            44    -0.527309           -3.184312
17   2024-07-14 2024-07-14            45     1.437611            0.816162
18   2024-09-14 2024-09-14            43    -0.271801           -1.180325
19   2024-11-14 2024-11-14            33     1.096941            0.035438
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          4.8 |              2.8 |         -2.0 | False         
[INFO] 2021-11-14   |          2.0 |             -2.4 |         -4.4 | False         
[INFO] 2022-01-14   |          3.5 |              3.3 |         -0.2 | False         
[INFO] 2022-03-14   |          0.1 |             -1.6 |         -1.7 | False         
[INFO] 2022-05-14   |          1.4 |             -0.4 |         -1.8 | False         
[INFO] 2022-07-14   |         -3.2 |             -1.2 |          2.0 | True          
[INFO] 2022-09-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.3 |             -3.8 |         -2.5 | False         
[INFO] 2023-01-14   |         -0.6 |             -0.1 |          0.5 | True          
[INFO] 2023-03-14   |         -0.5 |             -0.6 |         -0.1 | False         
[INFO] 2023-05-14   |         -1.2 |             -1.3 |         -0.1 | False         
[INFO] 2023-07-14   |          0.4 |              3.9 |          3.5 | True          
[INFO] 2023-09-14   |         -2.4 |              0.7 |          3.1 | True          
[INFO] 2023-11-14   |          1.6 |              1.4 |         -0.2 | False         
[INFO] 2024-01-14   |          1.6 |              1.2 |         -0.4 | False         
[INFO] 2024-03-14   |          4.1 |              0.5 |         -3.6 | False         
[INFO] 2024-05-14   |         -0.5 |             -3.2 |         -2.7 | False         
[INFO] 2024-07-14   |          1.4 |              0.8 |         -0.6 | False         
[INFO] 2024-09-14   |         -0.3 |             -1.2 |         -0.9 | False         
[INFO] 2024-11-14   |          1.1 |              0.0 |         -1.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 4 of 19 periods (21.05% win rate)
[INFO] Updating Excel file with Kmeans results for BRN...
[INFO] Excel file updated successfully. Added BRN with Kmeans win rate 21.1% in row 6
[INFO] Added best Sharpe parameters 10/26 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 10, Long SMA: 26
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(20/30) - Original Sharpe: 0.7359
[INFO] Added cluster 2 to portfolio: SMA(190/218) - Original Sharpe: 0.6844
[INFO] Added cluster 3 to portfolio: SMA(26/54) - Original Sharpe: 0.5986
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BRN_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1671
[INFO] Kmeans Best out-of-sample Sharpe: 0.6187
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for BRN...
[INFO] Excel file updated successfully. Added BRN with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BRN
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8116 to 1.1160
[INFO] 
Best parameters:
[INFO] Short SMA: 10
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 1.115955
[INFO] Number of Trades: 106
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8116 to 1.1160
[INFO] Trades range: 11.0 to 325.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6772 to 3.5491
[INFO] Scaled Trades range: -0.7653 to 15.8184
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5971
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 281 elements
[INFO] Cluster 1: 406 elements
[INFO] Cluster 2: 634 elements
[INFO] Cluster 3: 498 elements
[INFO] Cluster 4: 109 elements
[INFO] Cluster 5: 478 elements
[INFO] Cluster 6: 10 elements
[INFO] Cluster 7: 194 elements
[INFO] Cluster 8: 56 elements
[INFO] Cluster 9: 339 elements
[INFO] Cluster 10: 100 elements
[INFO] Cluster 11: 42 elements
[INFO] Cluster 12: 101 elements
[INFO] Cluster 13: 33 elements
[INFO] Cluster 14: 213 elements
[INFO] Cluster 15: 274 elements
[INFO] Cluster 16: 49 elements
[INFO] Cluster 17: 227 elements
[INFO] Cluster 18: 307 elements
[INFO] Cluster 19: 196 elements
[INFO] Cluster 20: 110 elements
[INFO] Cluster 21: 440 elements
[INFO] Cluster 22: 477 elements
[INFO] Cluster 23: 418 elements
[INFO] Cluster 24: 203 elements
[INFO] Cluster 25: 244 elements
[INFO] Cluster 26: 342 elements
[INFO] Cluster 27: 337 elements
[INFO] Cluster 28: 64 elements
[INFO] Cluster 29: 115 elements
[INFO] Cluster 30: 151 elements
[INFO] Cluster 31: 253 elements
[INFO] Cluster 32: 318 elements
[INFO] Cluster 33: 342 elements
[INFO] Cluster 34: 331 elements
[INFO] Cluster 35: 84 elements
[INFO] Cluster 36: 325 elements
[INFO] Cluster 37: 180 elements
[INFO] Cluster 38: 93 elements
[INFO] Cluster 39: 125 elements
[INFO] Cluster 40: 95 elements
[INFO] Cluster 41: 245 elements
[INFO] Cluster 42: 201 elements
[INFO] Cluster 43: 133 elements
[INFO] Cluster 44: 63 elements
[INFO] Cluster 45: 132 elements
[INFO] Cluster 46: 59 elements
[INFO] Cluster 47: 25 elements
[INFO] Cluster 48: 52 elements
[INFO] Cluster 49: 81 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=26, Long SMA=62, Sharpe=0.6563, Trades=55
[INFO] Cluster 1 cluster: Short SMA=182, Long SMA=268, Sharpe=0.1654, Trades=14
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=274, Sharpe=0.4765, Trades=18
[INFO] Cluster 3 cluster: Short SMA=66, Long SMA=196, Sharpe=0.0464, Trades=15
[INFO] Cluster 4 cluster: Short SMA=274, Long SMA=280, Sharpe=0.1020, Trades=43
[INFO] Cluster 5 cluster: Short SMA=36, Long SMA=214, Sharpe=0.3906, Trades=17
[INFO] Cluster 7 cluster: Short SMA=230, Long SMA=242, Sharpe=0.3876, Trades=31
[INFO] Cluster 8 cluster: Short SMA=196, Long SMA=198, Sharpe=0.2362, Trades=71
[INFO] Cluster 9 cluster: Short SMA=30, Long SMA=92, Sharpe=0.4099, Trades=41
[INFO] Cluster 10 cluster: Short SMA=160, Long SMA=176, Sharpe=0.5862, Trades=37
[INFO] Cluster 11 cluster: Short SMA=22, Long SMA=26, Sharpe=0.7741, Trades=149
[INFO] Cluster 12 cluster: Short SMA=20, Long SMA=42, Sharpe=0.4849, Trades=72
[INFO] Cluster 13 cluster: Short SMA=88, Long SMA=90, Sharpe=0.0030, Trades=118
[INFO] Cluster 14 cluster: Short SMA=18, Long SMA=172, Sharpe=0.3186, Trades=25
[INFO] Cluster 15 cluster: Short SMA=98, Long SMA=148, Sharpe=-0.4096, Trades=21
[INFO] Cluster 16 cluster: Short SMA=24, Long SMA=32, Sharpe=0.6952, Trades=98
[INFO] Cluster 17 cluster: Short SMA=64, Long SMA=114, Sharpe=-0.0633, Trades=29
[INFO] Cluster 18 cluster: Short SMA=144, Long SMA=266, Sharpe=0.2905, Trades=13
[INFO] Cluster 19 cluster: Short SMA=114, Long SMA=160, Sharpe=-0.1952, Trades=23
[INFO] Cluster 20 cluster: Short SMA=130, Long SMA=150, Sharpe=-0.0866, Trades=31
[INFO] Cluster 21 cluster: Short SMA=128, Long SMA=202, Sharpe=-0.0019, Trades=17
[INFO] Cluster 22 cluster: Short SMA=68, Long SMA=268, Sharpe=0.0705, Trades=14
[INFO] Cluster 23 cluster: Short SMA=138, Long SMA=234, Sharpe=0.3068, Trades=13
[INFO] Cluster 24 cluster: Short SMA=108, Long SMA=294, Sharpe=-0.0888, Trades=12
[INFO] Cluster 25 cluster: Short SMA=260, Long SMA=286, Sharpe=0.1002, Trades=23
[INFO] Cluster 26 cluster: Short SMA=90, Long SMA=234, Sharpe=-0.2568, Trades=15
[INFO] Cluster 27 cluster: Short SMA=74, Long SMA=154, Sharpe=-0.2518, Trades=21
[INFO] Cluster 28 cluster: Short SMA=92, Long SMA=98, Sharpe=-0.2270, Trades=69
[INFO] Cluster 29 cluster: Short SMA=100, Long SMA=118, Sharpe=-0.3050, Trades=41
[INFO] Cluster 30 cluster: Short SMA=40, Long SMA=144, Sharpe=0.1623, Trades=25
[INFO] Cluster 31 cluster: Short SMA=158, Long SMA=290, Sharpe=0.1202, Trades=12
[INFO] Cluster 32 cluster: Short SMA=102, Long SMA=186, Sharpe=-0.0369, Trades=17
[INFO] Cluster 33 cluster: Short SMA=222, Long SMA=264, Sharpe=0.2256, Trades=19
[INFO] Cluster 34 cluster: Short SMA=108, Long SMA=270, Sharpe=0.0633, Trades=14
[INFO] Cluster 35 cluster: Short SMA=134, Long SMA=142, Sharpe=0.2050, Trades=55
[INFO] Cluster 36 cluster: Short SMA=36, Long SMA=118, Sharpe=0.4645, Trades=29
[INFO] Cluster 37 cluster: Short SMA=194, Long SMA=246, Sharpe=0.4863, Trades=19
[INFO] Cluster 38 cluster: Short SMA=180, Long SMA=196, Sharpe=0.1633, Trades=39
[INFO] Cluster 39 cluster: Short SMA=16, Long SMA=230, Sharpe=0.2960, Trades=25
[INFO] Cluster 40 cluster: Short SMA=14, Long SMA=136, Sharpe=0.2028, Trades=39
[INFO] Cluster 41 cluster: Short SMA=170, Long SMA=218, Sharpe=0.5344, Trades=19
[INFO] Cluster 42 cluster: Short SMA=220, Long SMA=286, Sharpe=-0.0045, Trades=19
[INFO] Cluster 43 cluster: Short SMA=160, Long SMA=190, Sharpe=0.2476, Trades=25
[INFO] Cluster 44 cluster: Short SMA=76, Long SMA=90, Sharpe=-0.1882, Trades=51
[INFO] Cluster 45 cluster: Short SMA=200, Long SMA=214, Sharpe=0.6025, Trades=35
[INFO] Cluster 46 cluster: Short SMA=56, Long SMA=70, Sharpe=0.3648, Trades=61
[INFO] Cluster 47 cluster: Short SMA=128, Long SMA=130, Sharpe=0.0149, Trades=93
[INFO] Cluster 48 cluster: Short SMA=88, Long SMA=118, Sharpe=-0.8070, Trades=29
[INFO] Cluster 49 cluster: Short SMA=28, Long SMA=180, Sharpe=0.5903, Trades=21
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=10, Long SMA=26, Sharpe=1.1160, Trades=106
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=22, Long SMA=26, Sharpe=0.7741, Trades=149
[INFO] Top 2: Short SMA=24, Long SMA=32, Sharpe=0.6952, Trades=98
[INFO] Top 3: Short SMA=26, Long SMA=62, Sharpe=0.6563, Trades=55
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10575 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 10, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(22/26) - Original Sharpe: 0.7741, Trades: 149
[INFO] Hierarchical cluster 2: SMA(24/32) - Original Sharpe: 0.6952, Trades: 98
[INFO] Hierarchical cluster 3: SMA(26/62) - Original Sharpe: 0.6563, Trades: 55
[INFO] Hierarchical cluster 4: SMA(200/214) - Original Sharpe: 0.6025, Trades: 35
[INFO] Hierarchical cluster 5: SMA(28/180) - Original Sharpe: 0.5903, Trades: 21
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (10/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (22/26) - Sharpe: 0.7741
[INFO] cluster 2: (24/32) - Sharpe: 0.6952
[INFO] cluster 3: (26/62) - Sharpe: 0.6563
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     4.800806            2.483854
1    2021-11-14 2021-11-14            44     2.049644           -1.125306
2    2022-01-14 2022-01-14            41     3.528418            3.131964
3    2022-03-14 2022-03-14            44     0.138982           -1.536136
4    2022-05-14 2022-05-14            43     1.388289            0.547650
5    2022-07-14 2022-07-14            44    -3.155014            1.156005
6    2022-09-14 2022-09-14            43    -0.180219           -0.800320
7    2022-11-14 2022-11-14            43    -1.334805           -3.006287
8    2023-01-14 2023-01-14            41    -0.581478           -3.353172
9    2023-03-14 2023-03-14            43    -0.524319           -3.667248
10   2023-05-14 2023-05-14            44    -1.200228           -0.287598
11   2023-07-14 2023-07-14            44     0.362193            4.454866
12   2023-09-14 2023-09-14            43    -2.369631           -0.552777
13   2023-11-14 2023-11-14            42     1.581330            1.027634
14   2024-01-14 2024-01-14            43     1.622963            2.341427
15   2024-03-14 2024-03-14            42     4.138827            0.448668
16   2024-05-14 2024-05-14            44    -0.527309           -1.768440
17   2024-07-14 2024-07-14            45     1.437611           -0.214296
18   2024-09-14 2024-09-14            43    -0.271801           -2.174034
19   2024-11-14 2024-11-14            33     1.096941           -2.603502
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          4.8 |              2.5 |         -2.3 | False         
[INFO] 2021-11-14   |          2.0 |             -1.1 |         -3.1 | False         
[INFO] 2022-01-14   |          3.5 |              3.1 |         -0.4 | False         
[INFO] 2022-03-14   |          0.1 |             -1.5 |         -1.6 | False         
[INFO] 2022-05-14   |          1.4 |              0.5 |         -0.9 | False         
[INFO] 2022-07-14   |         -3.2 |              1.2 |          4.4 | True          
[INFO] 2022-09-14   |         -0.2 |             -0.8 |         -0.6 | False         
[INFO] 2022-11-14   |         -1.3 |             -3.0 |         -1.7 | False         
[INFO] 2023-01-14   |         -0.6 |             -3.4 |         -2.8 | False         
[INFO] 2023-03-14   |         -0.5 |             -3.7 |         -3.2 | False         
[INFO] 2023-05-14   |         -1.2 |             -0.3 |          0.9 | True          
[INFO] 2023-07-14   |          0.4 |              4.5 |          4.1 | True          
[INFO] 2023-09-14   |         -2.4 |             -0.6 |          1.8 | True          
[INFO] 2023-11-14   |          1.6 |              1.0 |         -0.6 | False         
[INFO] 2024-01-14   |          1.6 |              2.3 |          0.7 | True          
[INFO] 2024-03-14   |          4.1 |              0.4 |         -3.7 | False         
[INFO] 2024-05-14   |         -0.5 |             -1.8 |         -1.3 | False         
[INFO] 2024-07-14   |          1.4 |             -0.2 |         -1.6 | False         
[INFO] 2024-09-14   |         -0.3 |             -2.2 |         -1.9 | False         
[INFO] 2024-11-14   |          1.1 |             -2.6 |         -3.7 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 20 periods (25.00% win rate)
[INFO] Updating Excel file with Hierarchical results for BRN...
[INFO] Excel file updated successfully. Added BRN with Hierarchical win rate 25.0% in row 6
[INFO] Added best Sharpe parameters 10/26 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 10, Long SMA: 26
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(22/26) - Original Sharpe: 0.7741
[INFO] Added cluster 2 to portfolio: SMA(24/32) - Original Sharpe: 0.6952
[INFO] Added cluster 3 to portfolio: SMA(26/62) - Original Sharpe: 0.6563
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BRN_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0016
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6187
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for BRN...
[INFO] Excel file updated successfully. Added BRN with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BRN
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for C in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 142.07s
[INFO] Best parameters: Short SMA = 118, Long SMA = 134
[INFO] Best Sharpe ratio: 0.630269, Trades: 52
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CC
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 10.33 contracts
[INFO] Maximum Position Size: 18 contracts
[INFO] Strategy Total P&L: $777,426.00
[INFO] Market Buy & Hold P&L: $114,720.00
[INFO] Outperformance: $662,706.00
[INFO] Sharpe ratio (entire period, annualized): 0.965941
[INFO] Sharpe ratio (in-sample, annualized): 0.630269
[INFO] Sharpe ratio (out-of-sample, annualized): 1.618642
[INFO] Maximum Drawdown: $143,374.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 39
[INFO] Out-of-sample period trades: 13
[INFO] Total trades: 52
[INFO] In-sample P&L: $325,636.00
[INFO] Out-of-sample P&L: $439,720.00
[INFO] 
Best parameters from GA: Short SMA = 118, Long SMA = 134, Sharpe = 0.630269
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.7127 to 0.6303
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.630269
[INFO] Number of Trades: 52
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.7127 to 0.6303
[INFO] Trades range: 12.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.9917 to 2.9163
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 269 elements
[INFO] Kmeans Cluster 1: 295 elements
[INFO] Kmeans Cluster 2: 230 elements
[INFO] Kmeans Cluster 3: 264 elements
[INFO] Kmeans Cluster 4: 69 elements
[INFO] Kmeans Cluster 5: 261 elements
[INFO] Kmeans Cluster 6: 115 elements
[INFO] Kmeans Cluster 7: 186 elements
[INFO] Kmeans Cluster 8: 193 elements
[INFO] Kmeans Cluster 9: 239 elements
[INFO] Kmeans Cluster 10: 318 elements
[INFO] Kmeans Cluster 11: 233 elements
[INFO] Kmeans Cluster 12: 265 elements
[INFO] Kmeans Cluster 13: 289 elements
[INFO] Kmeans Cluster 14: 156 elements
[INFO] Kmeans Cluster 15: 252 elements
[INFO] Kmeans Cluster 16: 138 elements
[INFO] Kmeans Cluster 17: 207 elements
[INFO] Kmeans Cluster 18: 59 elements
[INFO] Kmeans Cluster 19: 208 elements
[INFO] Kmeans Cluster 20: 96 elements
[INFO] Kmeans Cluster 21: 312 elements
[INFO] Kmeans Cluster 22: 172 elements
[INFO] Kmeans Cluster 23: 167 elements
[INFO] Kmeans Cluster 24: 136 elements
[INFO] Kmeans Cluster 25: 217 elements
[INFO] Kmeans Cluster 26: 76 elements
[INFO] Kmeans Cluster 27: 262 elements
[INFO] Kmeans Cluster 28: 200 elements
[INFO] Kmeans Cluster 29: 212 elements
[INFO] Kmeans Cluster 30: 319 elements
[INFO] Kmeans Cluster 31: 280 elements
[INFO] Kmeans Cluster 32: 220 elements
[INFO] Kmeans Cluster 33: 169 elements
[INFO] Kmeans Cluster 34: 139 elements
[INFO] Kmeans Cluster 35: 257 elements
[INFO] Kmeans Cluster 36: 245 elements
[INFO] Kmeans Cluster 37: 260 elements
[INFO] Kmeans Cluster 38: 330 elements
[INFO] Kmeans Cluster 39: 228 elements
[INFO] Kmeans Cluster 40: 228 elements
[INFO] Kmeans Cluster 41: 262 elements
[INFO] Kmeans Cluster 42: 39 elements
[INFO] Kmeans Cluster 43: 272 elements
[INFO] Kmeans Cluster 44: 215 elements
[INFO] Kmeans Cluster 45: 241 elements
[INFO] Kmeans Cluster 46: 184 elements
[INFO] Kmeans Cluster 47: 289 elements
[INFO] Kmeans Cluster 48: 64 elements
[INFO] Kmeans Cluster 49: 248 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=48.68, Long SMA=239.68, Sharpe=-0.2774
[INFO] Centroid 1: Short SMA=181.90, Long SMA=259.70, Sharpe=-0.0229
[INFO] Centroid 2: Short SMA=82.79, Long SMA=114.75, Sharpe=-0.3347
[INFO] Centroid 3: Short SMA=92.72, Long SMA=194.68, Sharpe=-0.1715
[INFO] Centroid 4: Short SMA=16.09, Long SMA=91.68, Sharpe=-1.0299
[INFO] Centroid 5: Short SMA=268.41, Long SMA=286.55, Sharpe=0.0595
[INFO] Centroid 6: Short SMA=120.05, Long SMA=139.17, Sharpe=0.3504
[INFO] Centroid 7: Short SMA=128.74, Long SMA=226.98, Sharpe=-0.0685
[INFO] Centroid 8: Short SMA=204.82, Long SMA=233.98, Sharpe=-0.1456
[INFO] Centroid 9: Short SMA=25.69, Long SMA=257.76, Sharpe=-0.5332
[INFO] Centroid 10: Short SMA=33.41, Long SMA=170.30, Sharpe=-0.4010
[INFO] Centroid 11: Short SMA=54.21, Long SMA=285.97, Sharpe=-0.3621
[INFO] Centroid 12: Short SMA=144.98, Long SMA=242.02, Sharpe=0.1628
[INFO] Centroid 13: Short SMA=78.04, Long SMA=254.91, Sharpe=0.0237
[INFO] Centroid 14: Short SMA=148.12, Long SMA=169.68, Sharpe=-0.1095
[INFO] Centroid 15: Short SMA=37.28, Long SMA=126.85, Sharpe=-0.2994
[INFO] Centroid 16: Short SMA=15.23, Long SMA=133.57, Sharpe=-0.6768
[INFO] Centroid 17: Short SMA=227.45, Long SMA=248.15, Sharpe=0.0048
[INFO] Centroid 18: Short SMA=25.56, Long SMA=44.20, Sharpe=-0.9392
[INFO] Centroid 19: Short SMA=140.26, Long SMA=167.68, Sharpe=-0.3836
[INFO] Centroid 20: Short SMA=41.48, Long SMA=55.73, Sharpe=-0.0918
[INFO] Centroid 21: Short SMA=107.24, Long SMA=242.42, Sharpe=-0.2115
[INFO] Centroid 22: Short SMA=18.66, Long SMA=192.27, Sharpe=-0.5887
[INFO] Centroid 23: Short SMA=38.06, Long SMA=94.47, Sharpe=-0.7656
[INFO] Centroid 24: Short SMA=91.41, Long SMA=110.74, Sharpe=-0.1003
[INFO] Centroid 25: Short SMA=111.78, Long SMA=141.61, Sharpe=0.1589
[INFO] Centroid 26: Short SMA=17.63, Long SMA=58.13, Sharpe=-1.4729
[INFO] Centroid 27: Short SMA=134.91, Long SMA=287.11, Sharpe=-0.0943
[INFO] Centroid 28: Short SMA=166.99, Long SMA=209.61, Sharpe=-0.0938
[INFO] Centroid 29: Short SMA=171.60, Long SMA=193.92, Sharpe=-0.2337
[INFO] Centroid 30: Short SMA=76.09, Long SMA=216.66, Sharpe=-0.0721
[INFO] Centroid 31: Short SMA=51.87, Long SMA=191.35, Sharpe=-0.2611
[INFO] Centroid 32: Short SMA=82.28, Long SMA=160.74, Sharpe=-0.0992
[INFO] Centroid 33: Short SMA=75.76, Long SMA=278.26, Sharpe=-0.1612
[INFO] Centroid 34: Short SMA=19.44, Long SMA=53.45, Sharpe=-1.2497
[INFO] Centroid 35: Short SMA=50.67, Long SMA=139.16, Sharpe=-0.4574
[INFO] Centroid 36: Short SMA=24.85, Long SMA=224.93, Sharpe=-0.4383
[INFO] Centroid 37: Short SMA=149.55, Long SMA=268.09, Sharpe=0.0997
[INFO] Centroid 38: Short SMA=126.25, Long SMA=194.67, Sharpe=-0.2640
[INFO] Centroid 39: Short SMA=44.39, Long SMA=75.71, Sharpe=-0.3840
[INFO] Centroid 40: Short SMA=221.37, Long SMA=264.63, Sharpe=0.1000
[INFO] Centroid 41: Short SMA=60.80, Long SMA=101.60, Sharpe=-0.5554
[INFO] Centroid 42: Short SMA=255.23, Long SMA=265.23, Sharpe=-0.2886
[INFO] Centroid 43: Short SMA=233.89, Long SMA=286.69, Sharpe=-0.0317
[INFO] Centroid 44: Short SMA=23.62, Long SMA=286.11, Sharpe=-0.6435
[INFO] Centroid 45: Short SMA=103.07, Long SMA=284.69, Sharpe=-0.3273
[INFO] Centroid 46: Short SMA=91.20, Long SMA=161.20, Sharpe=0.0553
[INFO] Centroid 47: Short SMA=186.80, Long SMA=289.38, Sharpe=-0.1478
[INFO] Centroid 48: Short SMA=28.59, Long SMA=45.78, Sharpe=-0.6166
[INFO] Centroid 49: Short SMA=184.53, Long SMA=223.97, Sharpe=0.0276
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6303, Trades=52
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=120, Long SMA=138, Sharpe=0.2949, Trades=44
[INFO] Kmeans Top 2: Short SMA=144, Long SMA=242, Sharpe=0.2464, Trades=12
[INFO] Kmeans Top 3: Short SMA=110, Long SMA=142, Sharpe=0.2405, Trades=30
[INFO] Kmeans Top 4: Short SMA=150, Long SMA=268, Sharpe=0.2009, Trades=13
[INFO] Kmeans Top 5: Short SMA=186, Long SMA=224, Sharpe=0.0806, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (49, 240)
[INFO]   Nearest: (48.0, 240.0)
[INFO]   Rounded: (182, 260)
[INFO]   Rounded: (83, 115)
[INFO]   Nearest: (82.0, 114.0)
[INFO]   Rounded: (93, 195)
[INFO]   Nearest: (92.0, 194.0)
[INFO]   Rounded: (16, 92)
[INFO]   Rounded: (268, 287)
[INFO]   Nearest: (268.0, 286.0)
[INFO]   Rounded: (120, 139)
[INFO]   Nearest: (120.0, 140.0)
[INFO]   Rounded: (129, 227)
[INFO]   Nearest: (128.0, 226.0)
[INFO]   Rounded: (205, 234)
[INFO]   Nearest: (204.0, 234.0)
[INFO]   Rounded: (26, 258)
[INFO]   Rounded: (33, 170)
[INFO]   Nearest: (34.0, 170.0)
[INFO]   Rounded: (54, 286)
[INFO]   Rounded: (145, 242)
[INFO]   Nearest: (144.0, 242.0)
[INFO]   Rounded: (78, 255)
[INFO]   Nearest: (78.0, 254.0)
[INFO]   Rounded: (148, 170)
[INFO]   Rounded: (37, 127)
[INFO]   Nearest: (38.0, 126.0)
[INFO]   Rounded: (15, 134)
[INFO]   Nearest: (16.0, 134.0)
[INFO]   Rounded: (227, 248)
[INFO]   Nearest: (228.0, 248.0)
[INFO]   Rounded: (26, 44)
[INFO]   Rounded: (140, 168)
[INFO]   Rounded: (41, 56)
[INFO]   Nearest: (42.0, 56.0)
[INFO]   Rounded: (107, 242)
[INFO]   Nearest: (108.0, 242.0)
[INFO]   Rounded: (19, 192)
[INFO]   Nearest: (18.0, 192.0)
[INFO]   Rounded: (38, 94)
[INFO]   Rounded: (91, 111)
[INFO]   Nearest: (92.0, 110.0)
[INFO]   Rounded: (112, 142)
[INFO]   Rounded: (18, 58)
[INFO]   Rounded: (135, 287)
[INFO]   Nearest: (134.0, 288.0)
[INFO]   Rounded: (167, 210)
[INFO]   Nearest: (166.0, 210.0)
[INFO]   Rounded: (172, 194)
[INFO]   Rounded: (76, 217)
[INFO]   Nearest: (76.0, 216.0)
[INFO]   Rounded: (52, 191)
[INFO]   Nearest: (52.0, 192.0)
[INFO]   Rounded: (82, 161)
[INFO]   Nearest: (82.0, 160.0)
[INFO]   Rounded: (76, 278)
[INFO]   Rounded: (19, 53)
[INFO]   Nearest: (20.0, 54.0)
[INFO]   Rounded: (51, 139)
[INFO]   Nearest: (50.0, 140.0)
[INFO]   Rounded: (25, 225)
[INFO]   Nearest: (24.0, 224.0)
[INFO]   Rounded: (150, 268)
[INFO]   Rounded: (126, 195)
[INFO]   Nearest: (126.0, 194.0)
[INFO]   Rounded: (44, 76)
[INFO]   Rounded: (221, 265)
[INFO]   Nearest: (222.0, 264.0)
[INFO]   Rounded: (61, 102)
[INFO]   Nearest: (60.0, 102.0)
[INFO]   Rounded: (255, 265)
[INFO]   Nearest: (256.0, 266.0)
[INFO]   Rounded: (234, 287)
[INFO]   Nearest: (234.0, 286.0)
[INFO]   Rounded: (24, 286)
[INFO]   Rounded: (103, 285)
[INFO]   Nearest: (104.0, 284.0)
[INFO]   Rounded: (91, 161)
[INFO]   Nearest: (92.0, 162.0)
[INFO]   Rounded: (187, 289)
[INFO]   Nearest: (186.0, 290.0)
[INFO]   Rounded: (29, 46)
[INFO]   Nearest: (28.0, 46.0)
[INFO]   Rounded: (185, 224)
[INFO]   Nearest: (184.0, 224.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(120/138) - Original Sharpe: 0.2949, Trades: 44
[INFO] Kmeans cluster 2: SMA(144/242) - Original Sharpe: 0.2464, Trades: 12
[INFO] Kmeans cluster 3: SMA(110/142) - Original Sharpe: 0.2405, Trades: 30
[INFO] Kmeans cluster 4: SMA(150/268) - Original Sharpe: 0.2009, Trades: 13
[INFO] Kmeans cluster 5: SMA(186/224) - Original Sharpe: 0.0806, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (120/138) - Sharpe: 0.2949
[INFO] cluster 2: (144/242) - Sharpe: 0.2464
[INFO] cluster 3: (110/142) - Sharpe: 0.2405
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.387066           -0.400513
1    2021-11-10 2021-11-10            41    -1.369000            1.266661
2    2022-01-10 2022-01-10            41     1.348855            2.045474
3    2022-03-10 2022-03-10            42     3.066197            3.206562
4    2022-05-10 2022-05-10            41     0.256065            3.039830
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.313270           -0.299691
8    2023-01-10 2023-01-10            41     0.018666            0.018666
9    2023-03-10 2023-03-10            42     3.526516            4.253554
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.369719           -0.875410
19   2024-11-10 2024-11-10            35     2.120478            4.192711
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.4 |             -0.4 |         -0.8 | False         
[INFO] 2021-11-10   |         -1.4 |              1.3 |          2.7 | True          
[INFO] 2022-01-10   |          1.3 |              2.0 |          0.7 | True          
[INFO] 2022-03-10   |          3.1 |              3.2 |          0.1 | True          
[INFO] 2022-05-10   |          0.3 |              3.0 |          2.7 | True          
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |             -0.3 |         -0.6 | False         
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              4.3 |          0.8 | True          
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |             -0.9 |          0.5 | True          
[INFO] 2024-11-10   |          2.1 |              4.2 |          2.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-10, 2022-09-10, 2023-01-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 7 of 9 periods (77.78% win rate)
[INFO] Updating Excel file with Kmeans results for C...
[INFO] Excel file updated successfully. Added C with Kmeans win rate 77.8% in row 7
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(120/138) - Original Sharpe: 0.2949
[INFO] Added cluster 2 to portfolio: SMA(144/242) - Original Sharpe: 0.2464
[INFO] Added cluster 3 to portfolio: SMA(110/142) - Original Sharpe: 0.2405
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'C_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 2.0015
[INFO] Kmeans Best out-of-sample Sharpe: 1.6186
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for C...
[INFO] Excel file updated successfully. Added C with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\C
[INFO] Big Point Value: 10.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.7127 to 0.6303
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.630269
[INFO] Number of Trades: 52
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.7127 to 0.6303
[INFO] Trades range: 12.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.9917 to 2.9163
[INFO] Scaled Trades range: -0.6807 to 13.5867
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5249
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 201 elements
[INFO] Cluster 1: 159 elements
[INFO] Cluster 2: 271 elements
[INFO] Cluster 3: 451 elements
[INFO] Cluster 4: 60 elements
[INFO] Cluster 5: 244 elements
[INFO] Cluster 6: 221 elements
[INFO] Cluster 7: 397 elements
[INFO] Cluster 8: 383 elements
[INFO] Cluster 9: 265 elements
[INFO] Cluster 10: 98 elements
[INFO] Cluster 11: 54 elements
[INFO] Cluster 12: 261 elements
[INFO] Cluster 13: 10 elements
[INFO] Cluster 14: 277 elements
[INFO] Cluster 15: 239 elements
[INFO] Cluster 16: 332 elements
[INFO] Cluster 17: 284 elements
[INFO] Cluster 18: 282 elements
[INFO] Cluster 19: 533 elements
[INFO] Cluster 20: 25 elements
[INFO] Cluster 21: 156 elements
[INFO] Cluster 22: 318 elements
[INFO] Cluster 23: 297 elements
[INFO] Cluster 24: 239 elements
[INFO] Cluster 25: 307 elements
[INFO] Cluster 26: 54 elements
[INFO] Cluster 27: 363 elements
[INFO] Cluster 28: 342 elements
[INFO] Cluster 29: 200 elements
[INFO] Cluster 30: 285 elements
[INFO] Cluster 31: 50 elements
[INFO] Cluster 32: 260 elements
[INFO] Cluster 33: 291 elements
[INFO] Cluster 34: 72 elements
[INFO] Cluster 35: 340 elements
[INFO] Cluster 36: 311 elements
[INFO] Cluster 37: 145 elements
[INFO] Cluster 38: 246 elements
[INFO] Cluster 39: 242 elements
[INFO] Cluster 40: 77 elements
[INFO] Cluster 41: 121 elements
[INFO] Cluster 42: 209 elements
[INFO] Cluster 43: 11 elements
[INFO] Cluster 44: 42 elements
[INFO] Cluster 45: 176 elements
[INFO] Cluster 46: 64 elements
[INFO] Cluster 47: 5 elements
[INFO] Cluster 48: 245 elements
[INFO] Cluster 49: 70 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=20, Long SMA=56, Sharpe=-1.5878, Trades=72
[INFO] Cluster 1 cluster: Short SMA=56, Long SMA=72, Sharpe=-0.2605, Trades=62
[INFO] Cluster 2 cluster: Short SMA=234, Long SMA=254, Sharpe=0.0088, Trades=28
[INFO] Cluster 3 cluster: Short SMA=108, Long SMA=228, Sharpe=-0.1860, Trades=12
[INFO] Cluster 4 cluster: Short SMA=64, Long SMA=66, Sharpe=-0.6467, Trades=134
[INFO] Cluster 5 cluster: Short SMA=16, Long SMA=198, Sharpe=-0.6704, Trades=30
[INFO] Cluster 6 cluster: Short SMA=52, Long SMA=82, Sharpe=-0.6673, Trades=44
[INFO] Cluster 7 cluster: Short SMA=34, Long SMA=124, Sharpe=-0.2056, Trades=26
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=276, Sharpe=-0.5355, Trades=21
[INFO] Cluster 9 cluster: Short SMA=68, Long SMA=292, Sharpe=-0.3607, Trades=13
[INFO] Cluster 10 cluster: Short SMA=166, Long SMA=170, Sharpe=-0.1459, Trades=68
[INFO] Cluster 11 cluster: Short SMA=26, Long SMA=34, Sharpe=-1.3176, Trades=108
[INFO] Cluster 12 cluster: Short SMA=22, Long SMA=108, Sharpe=-0.6717, Trades=38
[INFO] Cluster 14 cluster: Short SMA=100, Long SMA=156, Sharpe=0.1466, Trades=20
[INFO] Cluster 15 cluster: Short SMA=174, Long SMA=192, Sharpe=-0.3266, Trades=33
[INFO] Cluster 16 cluster: Short SMA=36, Long SMA=166, Sharpe=-0.3604, Trades=26
[INFO] Cluster 17 cluster: Short SMA=62, Long SMA=124, Sharpe=-0.4461, Trades=26
[INFO] Cluster 18 cluster: Short SMA=164, Long SMA=206, Sharpe=-0.0803, Trades=18
[INFO] Cluster 19 cluster: Short SMA=148, Long SMA=250, Sharpe=0.2391, Trades=12
[INFO] Cluster 20 cluster: Short SMA=20, Long SMA=24, Sharpe=-0.7264, Trades=172
[INFO] Cluster 21 cluster: Short SMA=114, Long SMA=136, Sharpe=0.4568, Trades=40
[INFO] Cluster 22 cluster: Short SMA=180, Long SMA=258, Sharpe=-0.0903, Trades=12
[INFO] Cluster 23 cluster: Short SMA=80, Long SMA=194, Sharpe=-0.2441, Trades=16
[INFO] Cluster 24 cluster: Short SMA=226, Long SMA=290, Sharpe=-0.0616, Trades=15
[INFO] Cluster 25 cluster: Short SMA=48, Long SMA=192, Sharpe=-0.2598, Trades=18
[INFO] Cluster 26 cluster: Short SMA=246, Long SMA=248, Sharpe=0.0845, Trades=80
[INFO] Cluster 27 cluster: Short SMA=130, Long SMA=186, Sharpe=-0.2631, Trades=16
[INFO] Cluster 28 cluster: Short SMA=52, Long SMA=254, Sharpe=-0.2480, Trades=20
[INFO] Cluster 29 cluster: Short SMA=268, Long SMA=288, Sharpe=0.0039, Trades=25
[INFO] Cluster 30 cluster: Short SMA=216, Long SMA=268, Sharpe=0.0557, Trades=15
[INFO] Cluster 31 cluster: Short SMA=60, Long SMA=66, Sharpe=-0.3171, Trades=90
[INFO] Cluster 32 cluster: Short SMA=26, Long SMA=230, Sharpe=-0.4711, Trades=20
[INFO] Cluster 33 cluster: Short SMA=140, Long SMA=288, Sharpe=-0.0875, Trades=13
[INFO] Cluster 34 cluster: Short SMA=124, Long SMA=132, Sharpe=0.2665, Trades=64
[INFO] Cluster 35 cluster: Short SMA=78, Long SMA=222, Sharpe=-0.1219, Trades=14
[INFO] Cluster 36 cluster: Short SMA=100, Long SMA=276, Sharpe=-0.2965, Trades=13
[INFO] Cluster 37 cluster: Short SMA=84, Long SMA=106, Sharpe=-0.1518, Trades=46
[INFO] Cluster 38 cluster: Short SMA=78, Long SMA=258, Sharpe=-0.0174, Trades=12
[INFO] Cluster 39 cluster: Short SMA=200, Long SMA=230, Sharpe=-0.0093, Trades=22
[INFO] Cluster 40 cluster: Short SMA=248, Long SMA=252, Sharpe=0.0691, Trades=50
[INFO] Cluster 41 cluster: Short SMA=80, Long SMA=134, Sharpe=-0.2538, Trades=28
[INFO] Cluster 42 cluster: Short SMA=184, Long SMA=290, Sharpe=-0.1121, Trades=13
[INFO] Cluster 44 cluster: Short SMA=32, Long SMA=54, Sharpe=-0.7663, Trades=68
[INFO] Cluster 45 cluster: Short SMA=132, Long SMA=226, Sharpe=0.0269, Trades=12
[INFO] Cluster 46 cluster: Short SMA=144, Long SMA=162, Sharpe=-0.5548, Trades=36
[INFO] Cluster 48 cluster: Short SMA=88, Long SMA=162, Sharpe=-0.0208, Trades=18
[INFO] Cluster 49 cluster: Short SMA=14, Long SMA=88, Sharpe=-1.1458, Trades=56
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6303, Trades=52
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=114, Long SMA=136, Sharpe=0.4568, Trades=40
[INFO] Top 2: Short SMA=124, Long SMA=132, Sharpe=0.2665, Trades=64
[INFO] Top 3: Short SMA=148, Long SMA=250, Sharpe=0.2391, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10559 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(114/136) - Original Sharpe: 0.4568, Trades: 40
[INFO] Hierarchical cluster 2: SMA(124/132) - Original Sharpe: 0.2665, Trades: 64
[INFO] Hierarchical cluster 3: SMA(148/250) - Original Sharpe: 0.2391, Trades: 12
[INFO] Hierarchical cluster 4: SMA(100/156) - Original Sharpe: 0.1466, Trades: 20
[INFO] Hierarchical cluster 5: SMA(246/248) - Original Sharpe: 0.0845, Trades: 80
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (114/136) - Sharpe: 0.4568
[INFO] cluster 2: (124/132) - Sharpe: 0.2665
[INFO] cluster 3: (148/250) - Sharpe: 0.2391
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.387066            1.199940
1    2021-11-10 2021-11-10            41    -1.369000           -1.958181
2    2022-01-10 2022-01-10            41     1.348855            3.009380
3    2022-03-10 2022-03-10            42     3.066197            2.768531
4    2022-05-10 2022-05-10            41     0.256065            0.062162
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.313270           -0.791676
8    2023-01-10 2023-01-10            41     0.018666            0.018666
9    2023-03-10 2023-03-10            42     3.526516            3.028973
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.369719            0.101703
19   2024-11-10 2024-11-10            35     2.120478            3.502000
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.4 |              1.2 |          0.8 | True          
[INFO] 2021-11-10   |         -1.4 |             -2.0 |         -0.6 | False         
[INFO] 2022-01-10   |          1.3 |              3.0 |          1.7 | True          
[INFO] 2022-03-10   |          3.1 |              2.8 |         -0.3 | False         
[INFO] 2022-05-10   |          0.3 |              0.1 |         -0.2 | False         
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |             -0.8 |         -1.1 | False         
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              3.0 |         -0.5 | False         
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |              0.1 |          1.5 | True          
[INFO] 2024-11-10   |          2.1 |              3.5 |          1.4 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-10, 2022-09-10, 2023-01-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 9 periods (44.44% win rate)
[INFO] Updating Excel file with Hierarchical results for C...
[INFO] Excel file updated successfully. Added C with Hierarchical win rate 44.4% in row 7
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(114/136) - Original Sharpe: 0.4568
[INFO] Added cluster 2 to portfolio: SMA(124/132) - Original Sharpe: 0.2665
[INFO] Added cluster 3 to portfolio: SMA(148/250) - Original Sharpe: 0.2391
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'C_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 1.8603
[INFO] Hierarchical Best out-of-sample Sharpe: 1.6186
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for C...
[INFO] Excel file updated successfully. Added C with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\C
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CC in column D: 40.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 109.47s
[INFO] Best parameters: Short SMA = 118, Long SMA = 134
[INFO] Best Sharpe ratio: 0.608029, Trades: 52
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CC
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 10.33 contracts
[INFO] Maximum Position Size: 18 contracts
[INFO] Strategy Total P&L: $762,710.00
[INFO] Market Buy & Hold P&L: $114,720.00
[INFO] Outperformance: $647,990.00
[INFO] Sharpe ratio (entire period, annualized): 0.947776
[INFO] Sharpe ratio (in-sample, annualized): 0.608029
[INFO] Sharpe ratio (out-of-sample, annualized): 1.607980
[INFO] Maximum Drawdown: $144,700.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 39
[INFO] Out-of-sample period trades: 13
[INFO] Total trades: 52
[INFO] In-sample P&L: $314,170.00
[INFO] Out-of-sample P&L: $436,860.00
[INFO] 
Best parameters from GA: Short SMA = 118, Long SMA = 134, Sharpe = 0.608029
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10.0
[INFO] Slippage: 40.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.7425 to 0.6080
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.608029
[INFO] Number of Trades: 52
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.7425 to 0.6080
[INFO] Trades range: 12.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.9880 to 2.8413
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 254 elements
[INFO] Kmeans Cluster 1: 150 elements
[INFO] Kmeans Cluster 2: 293 elements
[INFO] Kmeans Cluster 3: 136 elements
[INFO] Kmeans Cluster 4: 277 elements
[INFO] Kmeans Cluster 5: 213 elements
[INFO] Kmeans Cluster 6: 215 elements
[INFO] Kmeans Cluster 7: 201 elements
[INFO] Kmeans Cluster 8: 149 elements
[INFO] Kmeans Cluster 9: 314 elements
[INFO] Kmeans Cluster 10: 267 elements
[INFO] Kmeans Cluster 11: 320 elements
[INFO] Kmeans Cluster 12: 199 elements
[INFO] Kmeans Cluster 13: 292 elements
[INFO] Kmeans Cluster 14: 286 elements
[INFO] Kmeans Cluster 15: 273 elements
[INFO] Kmeans Cluster 16: 107 elements
[INFO] Kmeans Cluster 17: 237 elements
[INFO] Kmeans Cluster 18: 279 elements
[INFO] Kmeans Cluster 19: 236 elements
[INFO] Kmeans Cluster 20: 249 elements
[INFO] Kmeans Cluster 21: 235 elements
[INFO] Kmeans Cluster 22: 160 elements
[INFO] Kmeans Cluster 23: 367 elements
[INFO] Kmeans Cluster 24: 331 elements
[INFO] Kmeans Cluster 25: 75 elements
[INFO] Kmeans Cluster 26: 266 elements
[INFO] Kmeans Cluster 27: 136 elements
[INFO] Kmeans Cluster 28: 138 elements
[INFO] Kmeans Cluster 29: 114 elements
[INFO] Kmeans Cluster 30: 277 elements
[INFO] Kmeans Cluster 31: 164 elements
[INFO] Kmeans Cluster 32: 177 elements
[INFO] Kmeans Cluster 33: 242 elements
[INFO] Kmeans Cluster 34: 222 elements
[INFO] Kmeans Cluster 35: 94 elements
[INFO] Kmeans Cluster 36: 198 elements
[INFO] Kmeans Cluster 37: 244 elements
[INFO] Kmeans Cluster 38: 243 elements
[INFO] Kmeans Cluster 39: 246 elements
[INFO] Kmeans Cluster 40: 86 elements
[INFO] Kmeans Cluster 41: 227 elements
[INFO] Kmeans Cluster 42: 66 elements
[INFO] Kmeans Cluster 43: 320 elements
[INFO] Kmeans Cluster 44: 225 elements
[INFO] Kmeans Cluster 45: 175 elements
[INFO] Kmeans Cluster 46: 89 elements
[INFO] Kmeans Cluster 47: 293 elements
[INFO] Kmeans Cluster 48: 39 elements
[INFO] Kmeans Cluster 49: 189 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=105.88, Long SMA=258.35, Sharpe=-0.2236
[INFO] Centroid 1: Short SMA=39.48, Long SMA=107.95, Sharpe=-0.2905
[INFO] Centroid 2: Short SMA=233.34, Long SMA=284.38, Sharpe=-0.0417
[INFO] Centroid 3: Short SMA=19.53, Long SMA=53.54, Sharpe=-1.2684
[INFO] Centroid 4: Short SMA=32.61, Long SMA=170.16, Sharpe=-0.4385
[INFO] Centroid 5: Short SMA=112.38, Long SMA=142.25, Sharpe=0.1456
[INFO] Centroid 6: Short SMA=23.49, Long SMA=285.99, Sharpe=-0.6545
[INFO] Centroid 7: Short SMA=153.89, Long SMA=214.13, Sharpe=-0.0797
[INFO] Centroid 8: Short SMA=54.93, Long SMA=91.66, Sharpe=-0.6833
[INFO] Centroid 9: Short SMA=126.78, Long SMA=192.12, Sharpe=-0.2807
[INFO] Centroid 10: Short SMA=49.29, Long SMA=210.91, Sharpe=-0.2537
[INFO] Centroid 11: Short SMA=76.72, Long SMA=217.63, Sharpe=-0.0731
[INFO] Centroid 12: Short SMA=55.21, Long SMA=171.92, Sharpe=-0.3140
[INFO] Centroid 13: Short SMA=186.27, Long SMA=289.27, Sharpe=-0.1527
[INFO] Centroid 14: Short SMA=145.20, Long SMA=261.01, Sharpe=0.1577
[INFO] Centroid 15: Short SMA=27.52, Long SMA=228.39, Sharpe=-0.4260
[INFO] Centroid 16: Short SMA=25.27, Long SMA=97.29, Sharpe=-0.8210
[INFO] Centroid 17: Short SMA=100.11, Long SMA=288.58, Sharpe=-0.3248
[INFO] Centroid 18: Short SMA=135.78, Long SMA=285.25, Sharpe=-0.0807
[INFO] Centroid 19: Short SMA=62.53, Long SMA=121.59, Sharpe=-0.5283
[INFO] Centroid 20: Short SMA=173.94, Long SMA=196.10, Sharpe=-0.2283
[INFO] Centroid 21: Short SMA=206.99, Long SMA=236.96, Sharpe=-0.1340
[INFO] Centroid 22: Short SMA=148.45, Long SMA=169.98, Sharpe=-0.1306
[INFO] Centroid 23: Short SMA=224.17, Long SMA=258.38, Sharpe=0.0644
[INFO] Centroid 24: Short SMA=78.32, Long SMA=259.41, Sharpe=-0.0008
[INFO] Centroid 25: Short SMA=43.84, Long SMA=56.61, Sharpe=-0.1013
[INFO] Centroid 26: Short SMA=268.14, Long SMA=286.71, Sharpe=0.0473
[INFO] Centroid 27: Short SMA=91.65, Long SMA=110.90, Sharpe=-0.1124
[INFO] Centroid 28: Short SMA=15.77, Long SMA=133.29, Sharpe=-0.6870
[INFO] Centroid 29: Short SMA=119.96, Long SMA=139.39, Sharpe=0.3305
[INFO] Centroid 30: Short SMA=38.09, Long SMA=138.51, Sharpe=-0.3848
[INFO] Centroid 31: Short SMA=90.02, Long SMA=160.57, Sharpe=0.0575
[INFO] Centroid 32: Short SMA=55.91, Long SMA=289.31, Sharpe=-0.3941
[INFO] Centroid 33: Short SMA=89.66, Long SMA=191.07, Sharpe=-0.1704
[INFO] Centroid 34: Short SMA=84.65, Long SMA=160.65, Sharpe=-0.0949
[INFO] Centroid 35: Short SMA=39.00, Long SMA=56.15, Sharpe=-0.3382
[INFO] Centroid 36: Short SMA=142.53, Long SMA=167.68, Sharpe=-0.4039
[INFO] Centroid 37: Short SMA=53.83, Long SMA=261.88, Sharpe=-0.2617
[INFO] Centroid 38: Short SMA=25.33, Long SMA=256.68, Sharpe=-0.5457
[INFO] Centroid 39: Short SMA=188.02, Long SMA=221.83, Sharpe=0.0006
[INFO] Centroid 40: Short SMA=17.98, Long SMA=56.63, Sharpe=-1.4915
[INFO] Centroid 41: Short SMA=149.00, Long SMA=236.48, Sharpe=0.0939
[INFO] Centroid 42: Short SMA=24.00, Long SMA=39.18, Sharpe=-0.7932
[INFO] Centroid 43: Short SMA=179.04, Long SMA=261.60, Sharpe=-0.0142
[INFO] Centroid 44: Short SMA=83.05, Long SMA=114.67, Sharpe=-0.3457
[INFO] Centroid 45: Short SMA=18.05, Long SMA=194.21, Sharpe=-0.6002
[INFO] Centroid 46: Short SMA=21.35, Long SMA=79.19, Sharpe=-1.0496
[INFO] Centroid 47: Short SMA=112.69, Long SMA=224.51, Sharpe=-0.1781
[INFO] Centroid 48: Short SMA=255.23, Long SMA=265.23, Sharpe=-0.3040
[INFO] Centroid 49: Short SMA=48.93, Long SMA=79.64, Sharpe=-0.5007
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6080, Trades=52
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=120, Long SMA=138, Sharpe=0.2779, Trades=44
[INFO] Kmeans Top 2: Short SMA=150, Long SMA=236, Sharpe=0.1702, Trades=12
[INFO] Kmeans Top 3: Short SMA=110, Long SMA=144, Sharpe=0.1652, Trades=30
[INFO] Kmeans Top 4: Short SMA=144, Long SMA=262, Sharpe=0.1452, Trades=13
[INFO] Kmeans Top 5: Short SMA=90, Long SMA=162, Sharpe=0.0706, Trades=18
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (106, 258)
[INFO]   Rounded: (39, 108)
[INFO]   Nearest: (40.0, 108.0)
[INFO]   Rounded: (233, 284)
[INFO]   Nearest: (234.0, 284.0)
[INFO]   Rounded: (20, 54)
[INFO]   Rounded: (33, 170)
[INFO]   Nearest: (32.0, 170.0)
[INFO]   Rounded: (112, 142)
[INFO]   Rounded: (23, 286)
[INFO]   Nearest: (24.0, 286.0)
[INFO]   Rounded: (154, 214)
[INFO]   Rounded: (55, 92)
[INFO]   Nearest: (54.0, 92.0)
[INFO]   Rounded: (127, 192)
[INFO]   Nearest: (126.0, 192.0)
[INFO]   Rounded: (49, 211)
[INFO]   Nearest: (50.0, 210.0)
[INFO]   Rounded: (77, 218)
[INFO]   Nearest: (76.0, 218.0)
[INFO]   Rounded: (55, 172)
[INFO]   Nearest: (56.0, 172.0)
[INFO]   Rounded: (186, 289)
[INFO]   Nearest: (186.0, 290.0)
[INFO]   Rounded: (145, 261)
[INFO]   Nearest: (146.0, 262.0)
[INFO]   Rounded: (28, 228)
[INFO]   Rounded: (25, 97)
[INFO]   Nearest: (26.0, 98.0)
[INFO]   Rounded: (100, 289)
[INFO]   Nearest: (100.0, 288.0)
[INFO]   Rounded: (136, 285)
[INFO]   Nearest: (136.0, 286.0)
[INFO]   Rounded: (63, 122)
[INFO]   Nearest: (62.0, 122.0)
[INFO]   Rounded: (174, 196)
[INFO]   Rounded: (207, 237)
[INFO]   Nearest: (206.0, 236.0)
[INFO]   Rounded: (148, 170)
[INFO]   Rounded: (224, 258)
[INFO]   Rounded: (78, 259)
[INFO]   Nearest: (78.0, 260.0)
[INFO]   Rounded: (44, 57)
[INFO]   Nearest: (44.0, 56.0)
[INFO]   Rounded: (268, 287)
[INFO]   Nearest: (268.0, 286.0)
[INFO]   Rounded: (92, 111)
[INFO]   Nearest: (92.0, 110.0)
[INFO]   Rounded: (16, 133)
[INFO]   Nearest: (16.0, 134.0)
[INFO]   Rounded: (120, 139)
[INFO]   Nearest: (120.0, 140.0)
[INFO]   Rounded: (38, 139)
[INFO]   Nearest: (38.0, 138.0)
[INFO]   Rounded: (90, 161)
[INFO]   Nearest: (90.0, 160.0)
[INFO]   Rounded: (56, 289)
[INFO]   Nearest: (56.0, 290.0)
[INFO]   Rounded: (90, 191)
[INFO]   Nearest: (90.0, 192.0)
[INFO]   Rounded: (85, 161)
[INFO]   Nearest: (84.0, 160.0)
[INFO]   Rounded: (39, 56)
[INFO]   Nearest: (38.0, 56.0)
[INFO]   Rounded: (143, 168)
[INFO]   Nearest: (142.0, 168.0)
[INFO]   Rounded: (54, 262)
[INFO]   Rounded: (25, 257)
[INFO]   Nearest: (26.0, 256.0)
[INFO]   Rounded: (188, 222)
[INFO]   Rounded: (18, 57)
[INFO]   Nearest: (18.0, 56.0)
[INFO]   Rounded: (149, 236)
[INFO]   Nearest: (150.0, 236.0)
[INFO]   Rounded: (24, 39)
[INFO]   Nearest: (24.0, 40.0)
[INFO]   Rounded: (179, 262)
[INFO]   Nearest: (180.0, 262.0)
[INFO]   Rounded: (83, 115)
[INFO]   Nearest: (84.0, 114.0)
[INFO]   Rounded: (18, 194)
[INFO]   Rounded: (21, 79)
[INFO]   Nearest: (22.0, 80.0)
[INFO]   Rounded: (113, 225)
[INFO]   Nearest: (112.0, 224.0)
[INFO]   Rounded: (255, 265)
[INFO]   Nearest: (256.0, 266.0)
[INFO]   Rounded: (49, 80)
[INFO]   Nearest: (48.0, 80.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(120/138) - Original Sharpe: 0.2779, Trades: 44
[INFO] Kmeans cluster 2: SMA(150/236) - Original Sharpe: 0.1702, Trades: 12
[INFO] Kmeans cluster 3: SMA(110/144) - Original Sharpe: 0.1652, Trades: 30
[INFO] Kmeans cluster 4: SMA(144/262) - Original Sharpe: 0.1452, Trades: 13
[INFO] Kmeans cluster 5: SMA(90/162) - Original Sharpe: 0.0706, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (120/138) - Sharpe: 0.2779
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.295900           -0.518242
1    2021-11-10 2021-11-10            41    -1.394418            3.096673
2    2022-01-10 2022-01-10            41     1.323900            2.175039
3    2022-03-10 2022-03-10            42     3.066197            3.066197
4    2022-05-10 2022-05-10            41     0.194831            2.132039
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.282908           -0.015888
8    2023-01-10 2023-01-10            41     0.018666            0.018666
9    2023-03-10 2023-03-10            42     3.526516            3.526516
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.376819           -1.442327
19   2024-11-10 2024-11-10            35     2.115676            3.772589
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.3 |             -0.5 |         -0.8 | False         
[INFO] 2021-11-10   |         -1.4 |              3.1 |          4.5 | True          
[INFO] 2022-01-10   |          1.3 |              2.2 |          0.9 | True          
[INFO] 2022-03-10   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2022-05-10   |          0.2 |              2.1 |          1.9 | True          
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |             -0.0 |         -0.3 | False         
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2024-11-10   |          2.1 |              3.8 |          1.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-10, 2022-07-10, 2022-09-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 6
[INFO] Kmeans cluster wins (rounded comparison): 4 of 6 periods (66.67% win rate)
[INFO] Updating Excel file with Kmeans results for CC...
[INFO] Excel file updated successfully. Added CC with Kmeans win rate 66.7% in row 8
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(120/138) - Original Sharpe: 0.2779
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 1.9769
[INFO] Kmeans Best out-of-sample Sharpe: 1.6080
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for CC...
[INFO] Excel file updated successfully. Added CC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CC
[INFO] Big Point Value: 10.0
[INFO] Slippage: 40.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.7425 to 0.6080
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.608029
[INFO] Number of Trades: 52
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.7425 to 0.6080
[INFO] Trades range: 12.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.9880 to 2.8413
[INFO] Scaled Trades range: -0.6807 to 13.5867
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5223
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 41 elements
[INFO] Cluster 1: 397 elements
[INFO] Cluster 2: 461 elements
[INFO] Cluster 3: 267 elements
[INFO] Cluster 4: 438 elements
[INFO] Cluster 5: 50 elements
[INFO] Cluster 6: 112 elements
[INFO] Cluster 7: 586 elements
[INFO] Cluster 8: 416 elements
[INFO] Cluster 9: 60 elements
[INFO] Cluster 10: 494 elements
[INFO] Cluster 11: 98 elements
[INFO] Cluster 12: 249 elements
[INFO] Cluster 13: 10 elements
[INFO] Cluster 14: 202 elements
[INFO] Cluster 15: 310 elements
[INFO] Cluster 16: 70 elements
[INFO] Cluster 17: 279 elements
[INFO] Cluster 18: 262 elements
[INFO] Cluster 19: 349 elements
[INFO] Cluster 20: 242 elements
[INFO] Cluster 21: 297 elements
[INFO] Cluster 22: 65 elements
[INFO] Cluster 23: 259 elements
[INFO] Cluster 24: 54 elements
[INFO] Cluster 25: 391 elements
[INFO] Cluster 26: 453 elements
[INFO] Cluster 27: 220 elements
[INFO] Cluster 28: 163 elements
[INFO] Cluster 29: 67 elements
[INFO] Cluster 30: 275 elements
[INFO] Cluster 31: 185 elements
[INFO] Cluster 32: 317 elements
[INFO] Cluster 33: 254 elements
[INFO] Cluster 34: 86 elements
[INFO] Cluster 35: 70 elements
[INFO] Cluster 36: 229 elements
[INFO] Cluster 37: 145 elements
[INFO] Cluster 38: 128 elements
[INFO] Cluster 39: 246 elements
[INFO] Cluster 40: 283 elements
[INFO] Cluster 41: 331 elements
[INFO] Cluster 42: 93 elements
[INFO] Cluster 43: 64 elements
[INFO] Cluster 44: 42 elements
[INFO] Cluster 45: 25 elements
[INFO] Cluster 46: 80 elements
[INFO] Cluster 47: 246 elements
[INFO] Cluster 48: 5 elements
[INFO] Cluster 49: 119 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=160, Long SMA=162, Sharpe=-0.1667, Trades=90
[INFO] Cluster 1 cluster: Short SMA=146, Long SMA=220, Sharpe=-0.0727, Trades=14
[INFO] Cluster 2 cluster: Short SMA=228, Long SMA=278, Sharpe=0.1003, Trades=17
[INFO] Cluster 3 cluster: Short SMA=232, Long SMA=252, Sharpe=0.0930, Trades=28
[INFO] Cluster 4 cluster: Short SMA=34, Long SMA=124, Sharpe=-0.2176, Trades=26
[INFO] Cluster 5 cluster: Short SMA=26, Long SMA=34, Sharpe=-1.3572, Trades=108
[INFO] Cluster 6 cluster: Short SMA=178, Long SMA=184, Sharpe=-0.4368, Trades=57
[INFO] Cluster 7 cluster: Short SMA=150, Long SMA=252, Sharpe=0.2058, Trades=12
[INFO] Cluster 8 cluster: Short SMA=88, Long SMA=176, Sharpe=-0.0752, Trades=16
[INFO] Cluster 9 cluster: Short SMA=64, Long SMA=66, Sharpe=-0.7054, Trades=134
[INFO] Cluster 10 cluster: Short SMA=126, Long SMA=190, Sharpe=-0.2236, Trades=16
[INFO] Cluster 11 cluster: Short SMA=48, Long SMA=64, Sharpe=-0.0548, Trades=66
[INFO] Cluster 12 cluster: Short SMA=20, Long SMA=112, Sharpe=-0.7925, Trades=40
[INFO] Cluster 14 cluster: Short SMA=48, Long SMA=80, Sharpe=-0.6905, Trades=44
[INFO] Cluster 15 cluster: Short SMA=100, Long SMA=276, Sharpe=-0.3021, Trades=13
[INFO] Cluster 16 cluster: Short SMA=122, Long SMA=132, Sharpe=0.3302, Trades=64
[INFO] Cluster 17 cluster: Short SMA=62, Long SMA=126, Sharpe=-0.5148, Trades=26
[INFO] Cluster 18 cluster: Short SMA=24, Long SMA=216, Sharpe=-0.5453, Trades=22
[INFO] Cluster 19 cluster: Short SMA=194, Long SMA=288, Sharpe=-0.2352, Trades=13
[INFO] Cluster 20 cluster: Short SMA=200, Long SMA=230, Sharpe=-0.0180, Trades=22
[INFO] Cluster 21 cluster: Short SMA=166, Long SMA=188, Sharpe=-0.2561, Trades=30
[INFO] Cluster 22 cluster: Short SMA=244, Long SMA=248, Sharpe=0.0593, Trades=52
[INFO] Cluster 23 cluster: Short SMA=70, Long SMA=292, Sharpe=-0.3702, Trades=13
[INFO] Cluster 24 cluster: Short SMA=246, Long SMA=248, Sharpe=0.0601, Trades=80
[INFO] Cluster 25 cluster: Short SMA=50, Long SMA=254, Sharpe=-0.3023, Trades=18
[INFO] Cluster 26 cluster: Short SMA=40, Long SMA=172, Sharpe=-0.3227, Trades=24
[INFO] Cluster 27 cluster: Short SMA=24, Long SMA=286, Sharpe=-0.6136, Trades=21
[INFO] Cluster 28 cluster: Short SMA=114, Long SMA=138, Sharpe=0.3696, Trades=36
[INFO] Cluster 29 cluster: Short SMA=62, Long SMA=70, Sharpe=-0.4002, Trades=82
[INFO] Cluster 30 cluster: Short SMA=100, Long SMA=158, Sharpe=0.1172, Trades=20
[INFO] Cluster 31 cluster: Short SMA=266, Long SMA=286, Sharpe=0.1193, Trades=27
[INFO] Cluster 32 cluster: Short SMA=106, Long SMA=232, Sharpe=-0.2352, Trades=12
[INFO] Cluster 33 cluster: Short SMA=52, Long SMA=206, Sharpe=-0.1766, Trades=18
[INFO] Cluster 34 cluster: Short SMA=22, Long SMA=40, Sharpe=-1.3436, Trades=84
[INFO] Cluster 35 cluster: Short SMA=14, Long SMA=88, Sharpe=-1.1715, Trades=56
[INFO] Cluster 36 cluster: Short SMA=138, Long SMA=290, Sharpe=-0.0933, Trades=13
[INFO] Cluster 37 cluster: Short SMA=84, Long SMA=108, Sharpe=-0.4672, Trades=42
[INFO] Cluster 38 cluster: Short SMA=78, Long SMA=136, Sharpe=-0.2458, Trades=24
[INFO] Cluster 39 cluster: Short SMA=78, Long SMA=258, Sharpe=-0.0225, Trades=12
[INFO] Cluster 40 cluster: Short SMA=178, Long SMA=258, Sharpe=-0.0835, Trades=12
[INFO] Cluster 41 cluster: Short SMA=78, Long SMA=222, Sharpe=-0.1280, Trades=14
[INFO] Cluster 42 cluster: Short SMA=14, Long SMA=182, Sharpe=-0.7995, Trades=34
[INFO] Cluster 43 cluster: Short SMA=144, Long SMA=162, Sharpe=-0.5711, Trades=36
[INFO] Cluster 44 cluster: Short SMA=32, Long SMA=54, Sharpe=-0.7978, Trades=68
[INFO] Cluster 45 cluster: Short SMA=20, Long SMA=24, Sharpe=-0.7862, Trades=172
[INFO] Cluster 46 cluster: Short SMA=86, Long SMA=98, Sharpe=-0.2207, Trades=56
[INFO] Cluster 47 cluster: Short SMA=28, Long SMA=258, Sharpe=-0.5227, Trades=20
[INFO] Cluster 49 cluster: Short SMA=18, Long SMA=60, Sharpe=-1.5675, Trades=68
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6080, Trades=52
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=114, Long SMA=138, Sharpe=0.3696, Trades=36
[INFO] Top 2: Short SMA=122, Long SMA=132, Sharpe=0.3302, Trades=64
[INFO] Top 3: Short SMA=150, Long SMA=252, Sharpe=0.2058, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10570 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(114/138) - Original Sharpe: 0.3696, Trades: 36
[INFO] Hierarchical cluster 2: SMA(122/132) - Original Sharpe: 0.3302, Trades: 64
[INFO] Hierarchical cluster 3: SMA(150/252) - Original Sharpe: 0.2058, Trades: 12
[INFO] Hierarchical cluster 4: SMA(266/286) - Original Sharpe: 0.1193, Trades: 27
[INFO] Hierarchical cluster 5: SMA(100/158) - Original Sharpe: 0.1172, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (114/138) - Sharpe: 0.3696
[INFO] cluster 2: (122/132) - Sharpe: 0.3302
[INFO] cluster 3: (150/252) - Sharpe: 0.2058
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.295900            1.719348
1    2021-11-10 2021-11-10            41    -1.394418           -1.651113
2    2022-01-10 2022-01-10            41     1.323900            2.986415
3    2022-03-10 2022-03-10            42     3.066197            2.261628
4    2022-05-10 2022-05-10            41     0.194831            2.823237
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.282908           -0.454282
8    2023-01-10 2023-01-10            41     0.018666            0.018666
9    2023-03-10 2023-03-10            42     3.526516            2.903279
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.376819           -1.208058
19   2024-11-10 2024-11-10            35     2.115676            3.101950
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.3 |              1.7 |          1.4 | True          
[INFO] 2021-11-10   |         -1.4 |             -1.7 |         -0.3 | False         
[INFO] 2022-01-10   |          1.3 |              3.0 |          1.7 | True          
[INFO] 2022-03-10   |          3.1 |              2.3 |         -0.8 | False         
[INFO] 2022-05-10   |          0.2 |              2.8 |          2.6 | True          
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |             -0.5 |         -0.8 | False         
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              2.9 |         -0.6 | False         
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |             -1.2 |          0.2 | True          
[INFO] 2024-11-10   |          2.1 |              3.1 |          1.0 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-10, 2022-09-10, 2023-01-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 9 periods (55.56% win rate)
[INFO] Updating Excel file with Hierarchical results for CC...
[INFO] Excel file updated successfully. Added CC with Hierarchical win rate 55.6% in row 8
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(114/138) - Original Sharpe: 0.3696
[INFO] Added cluster 2 to portfolio: SMA(122/132) - Original Sharpe: 0.3302
[INFO] Added cluster 3 to portfolio: SMA(150/252) - Original Sharpe: 0.2058
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 1.8442
[INFO] Hierarchical Best out-of-sample Sharpe: 1.6080
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for CC...
[INFO] Excel file updated successfully. Added CC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CC
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CD in column D: 7.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 159.41s
[INFO] Best parameters: Short SMA = 38, Long SMA = 44
[INFO] Best Sharpe ratio: 0.791094, Trades: 100
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CD
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 12.56 contracts
[INFO] Maximum Position Size: 24 contracts
[INFO] Strategy Total P&L: $198,897.00
[INFO] Market Buy & Hold P&L: $-25,775.00
[INFO] Outperformance: $224,672.00
[INFO] Sharpe ratio (entire period, annualized): 0.265370
[INFO] Sharpe ratio (in-sample, annualized): 0.791094
[INFO] Sharpe ratio (out-of-sample, annualized): -0.999272
[INFO] Maximum Drawdown: $290,984.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 67
[INFO] Out-of-sample period trades: 33
[INFO] Total trades: 100
[INFO] In-sample P&L: $408,450.00
[INFO] Out-of-sample P&L: $-214,288.00
[INFO] 
Best parameters from GA: Short SMA = 38, Long SMA = 44, Sharpe = 0.791094
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 7.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7997 to 0.7911
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 44
[INFO] Sharpe Ratio: 0.791094
[INFO] Number of Trades: 100
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7997 to 0.7911
[INFO] Trades range: 10.0 to 354.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6320 to 3.9805
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 163 elements
[INFO] Kmeans Cluster 1: 196 elements
[INFO] Kmeans Cluster 2: 239 elements
[INFO] Kmeans Cluster 3: 249 elements
[INFO] Kmeans Cluster 4: 156 elements
[INFO] Kmeans Cluster 5: 278 elements
[INFO] Kmeans Cluster 6: 225 elements
[INFO] Kmeans Cluster 7: 272 elements
[INFO] Kmeans Cluster 8: 218 elements
[INFO] Kmeans Cluster 9: 94 elements
[INFO] Kmeans Cluster 10: 161 elements
[INFO] Kmeans Cluster 11: 236 elements
[INFO] Kmeans Cluster 12: 163 elements
[INFO] Kmeans Cluster 13: 126 elements
[INFO] Kmeans Cluster 14: 306 elements
[INFO] Kmeans Cluster 15: 308 elements
[INFO] Kmeans Cluster 16: 299 elements
[INFO] Kmeans Cluster 17: 252 elements
[INFO] Kmeans Cluster 18: 96 elements
[INFO] Kmeans Cluster 19: 299 elements
[INFO] Kmeans Cluster 20: 222 elements
[INFO] Kmeans Cluster 21: 291 elements
[INFO] Kmeans Cluster 22: 239 elements
[INFO] Kmeans Cluster 23: 77 elements
[INFO] Kmeans Cluster 24: 145 elements
[INFO] Kmeans Cluster 25: 199 elements
[INFO] Kmeans Cluster 26: 179 elements
[INFO] Kmeans Cluster 27: 258 elements
[INFO] Kmeans Cluster 28: 255 elements
[INFO] Kmeans Cluster 29: 247 elements
[INFO] Kmeans Cluster 30: 207 elements
[INFO] Kmeans Cluster 31: 236 elements
[INFO] Kmeans Cluster 32: 150 elements
[INFO] Kmeans Cluster 33: 277 elements
[INFO] Kmeans Cluster 34: 156 elements
[INFO] Kmeans Cluster 35: 322 elements
[INFO] Kmeans Cluster 36: 205 elements
[INFO] Kmeans Cluster 37: 251 elements
[INFO] Kmeans Cluster 38: 173 elements
[INFO] Kmeans Cluster 39: 165 elements
[INFO] Kmeans Cluster 40: 358 elements
[INFO] Kmeans Cluster 41: 228 elements
[INFO] Kmeans Cluster 42: 112 elements
[INFO] Kmeans Cluster 43: 290 elements
[INFO] Kmeans Cluster 44: 188 elements
[INFO] Kmeans Cluster 45: 98 elements
[INFO] Kmeans Cluster 46: 217 elements
[INFO] Kmeans Cluster 47: 84 elements
[INFO] Kmeans Cluster 48: 185 elements
[INFO] Kmeans Cluster 49: 235 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=23.90, Long SMA=67.29, Sharpe=0.2384
[INFO] Centroid 1: Short SMA=166.47, Long SMA=261.72, Sharpe=-0.1070
[INFO] Centroid 2: Short SMA=68.19, Long SMA=131.78, Sharpe=-0.3523
[INFO] Centroid 3: Short SMA=56.61, Long SMA=276.75, Sharpe=-0.0552
[INFO] Centroid 4: Short SMA=235.05, Long SMA=272.74, Sharpe=-0.0171
[INFO] Centroid 5: Short SMA=92.26, Long SMA=177.77, Sharpe=0.1226
[INFO] Centroid 6: Short SMA=60.48, Long SMA=164.12, Sharpe=-0.1012
[INFO] Centroid 7: Short SMA=190.86, Long SMA=289.79, Sharpe=-0.3375
[INFO] Centroid 8: Short SMA=210.39, Long SMA=236.53, Sharpe=-0.4739
[INFO] Centroid 9: Short SMA=23.53, Long SMA=44.62, Sharpe=0.6023
[INFO] Centroid 10: Short SMA=156.12, Long SMA=204.60, Sharpe=0.0367
[INFO] Centroid 11: Short SMA=24.12, Long SMA=165.57, Sharpe=0.2416
[INFO] Centroid 12: Short SMA=249.53, Long SMA=285.33, Sharpe=0.1554
[INFO] Centroid 13: Short SMA=63.87, Long SMA=80.37, Sharpe=-0.3879
[INFO] Centroid 14: Short SMA=26.64, Long SMA=221.99, Sharpe=0.1310
[INFO] Centroid 15: Short SMA=184.75, Long SMA=227.84, Sharpe=-0.3276
[INFO] Centroid 16: Short SMA=122.12, Long SMA=288.09, Sharpe=-0.1083
[INFO] Centroid 17: Short SMA=87.24, Long SMA=206.17, Sharpe=-0.0176
[INFO] Centroid 18: Short SMA=84.48, Long SMA=100.42, Sharpe=0.0096
[INFO] Centroid 19: Short SMA=118.25, Long SMA=215.47, Sharpe=-0.0711
[INFO] Centroid 20: Short SMA=95.79, Long SMA=136.94, Sharpe=-0.2174
[INFO] Centroid 21: Short SMA=148.91, Long SMA=184.86, Sharpe=0.1627
[INFO] Centroid 22: Short SMA=30.98, Long SMA=116.65, Sharpe=-0.0101
[INFO] Centroid 23: Short SMA=90.34, Long SMA=106.70, Sharpe=-0.5952
[INFO] Centroid 24: Short SMA=118.00, Long SMA=176.86, Sharpe=0.2912
[INFO] Centroid 25: Short SMA=22.12, Long SMA=283.91, Sharpe=-0.0436
[INFO] Centroid 26: Short SMA=220.20, Long SMA=251.51, Sharpe=-0.3673
[INFO] Centroid 27: Short SMA=113.32, Long SMA=149.84, Sharpe=-0.0647
[INFO] Centroid 28: Short SMA=111.98, Long SMA=254.33, Sharpe=-0.0764
[INFO] Centroid 29: Short SMA=28.70, Long SMA=149.72, Sharpe=0.1348
[INFO] Centroid 30: Short SMA=139.29, Long SMA=234.43, Sharpe=-0.2139
[INFO] Centroid 31: Short SMA=59.82, Long SMA=202.77, Sharpe=-0.1397
[INFO] Centroid 32: Short SMA=135.01, Long SMA=157.45, Sharpe=0.0614
[INFO] Centroid 33: Short SMA=144.53, Long SMA=266.20, Sharpe=-0.0046
[INFO] Centroid 34: Short SMA=274.33, Long SMA=291.83, Sharpe=-0.0067
[INFO] Centroid 35: Short SMA=64.14, Long SMA=235.44, Sharpe=-0.0740
[INFO] Centroid 36: Short SMA=88.50, Long SMA=250.44, Sharpe=0.0571
[INFO] Centroid 37: Short SMA=59.23, Long SMA=105.09, Sharpe=-0.1729
[INFO] Centroid 38: Short SMA=184.64, Long SMA=216.71, Sharpe=-0.1795
[INFO] Centroid 39: Short SMA=160.93, Long SMA=190.78, Sharpe=0.2979
[INFO] Centroid 40: Short SMA=30.91, Long SMA=261.31, Sharpe=0.0763
[INFO] Centroid 41: Short SMA=28.69, Long SMA=95.73, Sharpe=0.1167
[INFO] Centroid 42: Short SMA=41.80, Long SMA=62.16, Sharpe=-0.0103
[INFO] Centroid 43: Short SMA=81.00, Long SMA=285.02, Sharpe=0.0439
[INFO] Centroid 44: Short SMA=23.37, Long SMA=49.64, Sharpe=0.4157
[INFO] Centroid 45: Short SMA=102.73, Long SMA=120.69, Sharpe=-0.3903
[INFO] Centroid 46: Short SMA=177.34, Long SMA=273.50, Sharpe=-0.2256
[INFO] Centroid 47: Short SMA=256.76, Long SMA=278.79, Sharpe=0.3104
[INFO] Centroid 48: Short SMA=225.54, Long SMA=272.11, Sharpe=-0.2126
[INFO] Centroid 49: Short SMA=32.30, Long SMA=192.53, Sharpe=0.0262
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=44, Sharpe=0.7911, Trades=100
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=24, Long SMA=46, Sharpe=0.5423, Trades=64
[INFO] Kmeans Top 2: Short SMA=24, Long SMA=52, Sharpe=0.4683, Trades=60
[INFO] Kmeans Top 3: Short SMA=256, Long SMA=278, Sharpe=0.4184, Trades=22
[INFO] Kmeans Top 4: Short SMA=22, Long SMA=72, Sharpe=0.3145, Trades=50
[INFO] Kmeans Top 5: Short SMA=24, Long SMA=166, Sharpe=0.3033, Trades=30
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (24, 67)
[INFO]   Nearest: (24.0, 68.0)
[INFO]   Rounded: (166, 262)
[INFO]   Rounded: (68, 132)
[INFO]   Rounded: (57, 277)
[INFO]   Nearest: (56.0, 276.0)
[INFO]   Rounded: (235, 273)
[INFO]   Nearest: (236.0, 272.0)
[INFO]   Rounded: (92, 178)
[INFO]   Rounded: (60, 164)
[INFO]   Rounded: (191, 290)
[INFO]   Nearest: (190.0, 290.0)
[INFO]   Rounded: (210, 237)
[INFO]   Nearest: (210.0, 236.0)
[INFO]   Rounded: (24, 45)
[INFO]   Nearest: (24.0, 44.0)
[INFO]   Rounded: (156, 205)
[INFO]   Nearest: (156.0, 204.0)
[INFO]   Rounded: (24, 166)
[INFO]   Rounded: (250, 285)
[INFO]   Nearest: (250.0, 286.0)
[INFO]   Rounded: (64, 80)
[INFO]   Rounded: (27, 222)
[INFO]   Nearest: (26.0, 222.0)
[INFO]   Rounded: (185, 228)
[INFO]   Nearest: (184.0, 228.0)
[INFO]   Rounded: (122, 288)
[INFO]   Rounded: (87, 206)
[INFO]   Nearest: (88.0, 206.0)
[INFO]   Rounded: (84, 100)
[INFO]   Rounded: (118, 215)
[INFO]   Nearest: (118.0, 216.0)
[INFO]   Rounded: (96, 137)
[INFO]   Nearest: (96.0, 136.0)
[INFO]   Rounded: (149, 185)
[INFO]   Nearest: (148.0, 184.0)
[INFO]   Rounded: (31, 117)
[INFO]   Nearest: (30.0, 116.0)
[INFO]   Rounded: (90, 107)
[INFO]   Nearest: (90.0, 106.0)
[INFO]   Rounded: (118, 177)
[INFO]   Nearest: (118.0, 176.0)
[INFO]   Rounded: (22, 284)
[INFO]   Rounded: (220, 252)
[INFO]   Rounded: (113, 150)
[INFO]   Nearest: (114.0, 150.0)
[INFO]   Rounded: (112, 254)
[INFO]   Rounded: (29, 150)
[INFO]   Nearest: (28.0, 150.0)
[INFO]   Rounded: (139, 234)
[INFO]   Nearest: (140.0, 234.0)
[INFO]   Rounded: (60, 203)
[INFO]   Nearest: (60.0, 202.0)
[INFO]   Rounded: (135, 157)
[INFO]   Nearest: (136.0, 158.0)
[INFO]   Rounded: (145, 266)
[INFO]   Nearest: (144.0, 266.0)
[INFO]   Rounded: (274, 292)
[INFO]   Rounded: (64, 235)
[INFO]   Nearest: (64.0, 236.0)
[INFO]   Rounded: (88, 250)
[INFO]   Rounded: (59, 105)
[INFO]   Nearest: (60.0, 106.0)
[INFO]   Rounded: (185, 217)
[INFO]   Nearest: (184.0, 216.0)
[INFO]   Rounded: (161, 191)
[INFO]   Nearest: (160.0, 190.0)
[INFO]   Rounded: (31, 261)
[INFO]   Nearest: (30.0, 262.0)
[INFO]   Rounded: (29, 96)
[INFO]   Nearest: (28.0, 96.0)
[INFO]   Rounded: (42, 62)
[INFO]   Rounded: (81, 285)
[INFO]   Nearest: (80.0, 286.0)
[INFO]   Rounded: (23, 50)
[INFO]   Nearest: (24.0, 50.0)
[INFO]   Rounded: (103, 121)
[INFO]   Nearest: (102.0, 120.0)
[INFO]   Rounded: (177, 274)
[INFO]   Nearest: (178.0, 274.0)
[INFO]   Rounded: (257, 279)
[INFO]   Nearest: (256.0, 278.0)
[INFO]   Rounded: (226, 272)
[INFO]   Rounded: (32, 193)
[INFO]   Nearest: (32.0, 192.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 44
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(24/46) - Original Sharpe: 0.5423, Trades: 64
[INFO] Kmeans cluster 2: SMA(24/52) - Original Sharpe: 0.4683, Trades: 60
[INFO] Kmeans cluster 3: SMA(256/278) - Original Sharpe: 0.4184, Trades: 22
[INFO] Kmeans cluster 4: SMA(22/72) - Original Sharpe: 0.3145, Trades: 50
[INFO] Kmeans cluster 5: SMA(24/166) - Original Sharpe: 0.3033, Trades: 30
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/44)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/46) - Sharpe: 0.5423
[INFO] cluster 2: (24/52) - Sharpe: 0.4683
[INFO] cluster 3: (256/278) - Sharpe: 0.4184
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -4.559447           -3.366935
1    2021-11-14 2021-11-14            43    -2.832319           -3.784963
2    2022-01-14 2022-01-14            41    -0.950707           -2.875425
3    2022-03-14 2022-03-14            44    -3.892117           -2.552112
4    2022-05-14 2022-05-14            43     0.644192            0.238603
5    2022-07-14 2022-07-14            44    -4.160323           -1.613770
6    2022-09-14 2022-09-14            43     1.032024            0.987674
7    2022-11-14 2022-11-14            43    -0.748377           -0.692060
8    2023-01-14 2023-01-14            41    -4.124943           -0.165707
9    2023-03-14 2023-03-14            44     0.052422           -3.773470
10   2023-05-14 2023-05-14            44    -2.505249           -0.714782
11   2023-07-14 2023-07-14            44    -2.114246           -0.169890
12   2023-09-14 2023-09-14            43     1.988935            1.887059
13   2023-11-14 2023-11-14            42    -3.835381           -1.121809
14   2024-01-14 2024-01-14            43    -1.838269            0.119416
15   2024-03-14 2024-03-14            42     1.898357            0.096444
16   2024-05-14 2024-05-14            44     1.248914           -0.361520
17   2024-07-14 2024-07-14            45     0.220219           -3.023481
18   2024-09-14 2024-09-14            43     0.081170            1.440385
19   2024-11-14 2024-11-14            33     3.870625            4.000879
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -4.6 |             -3.4 |          1.2 | True          
[INFO] 2021-11-14   |         -2.8 |             -3.8 |         -1.0 | False         
[INFO] 2022-01-14   |         -1.0 |             -2.9 |         -1.9 | False         
[INFO] 2022-03-14   |         -3.9 |             -2.6 |          1.3 | True          
[INFO] 2022-05-14   |          0.6 |              0.2 |         -0.4 | False         
[INFO] 2022-07-14   |         -4.2 |             -1.6 |          2.6 | True          
[INFO] 2022-09-14   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -4.1 |             -0.2 |          3.9 | True          
[INFO] 2023-03-14   |          0.1 |             -3.8 |         -3.9 | False         
[INFO] 2023-05-14   |         -2.5 |             -0.7 |          1.8 | True          
[INFO] 2023-07-14   |         -2.1 |             -0.2 |          1.9 | True          
[INFO] 2023-09-14   |          2.0 |              1.9 |         -0.1 | False         
[INFO] 2023-11-14   |         -3.8 |             -1.1 |          2.7 | True          
[INFO] 2024-01-14   |         -1.8 |              0.1 |          1.9 | True          
[INFO] 2024-03-14   |          1.9 |              0.1 |         -1.8 | False         
[INFO] 2024-05-14   |          1.2 |             -0.4 |         -1.6 | False         
[INFO] 2024-07-14   |          0.2 |             -3.0 |         -3.2 | False         
[INFO] 2024-09-14   |          0.1 |              1.4 |          1.3 | True          
[INFO] 2024-11-14   |          3.9 |              4.0 |          0.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-09-14, 2022-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 10 of 18 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for CD...
[INFO] Excel file updated successfully. Added CD with Kmeans win rate 55.6% in row 9
[INFO] Added best Sharpe parameters 38/44 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 44
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/46) - Original Sharpe: 0.5423
[INFO] Added cluster 2 to portfolio: SMA(24/52) - Original Sharpe: 0.4683
[INFO] Added cluster 3 to portfolio: SMA(256/278) - Original Sharpe: 0.4184
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.7492
[INFO] Kmeans Best out-of-sample Sharpe: -0.9993
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for CD...
[INFO] Excel file updated successfully. Added CD with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CD
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 7.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7997 to 0.7911
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 44
[INFO] Sharpe Ratio: 0.791094
[INFO] Number of Trades: 100
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7997 to 0.7911
[INFO] Trades range: 10.0 to 354.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6320 to 3.9805
[INFO] Scaled Trades range: -0.8077 to 15.1655
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5960
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 452 elements
[INFO] Cluster 1: 513 elements
[INFO] Cluster 2: 91 elements
[INFO] Cluster 3: 471 elements
[INFO] Cluster 4: 223 elements
[INFO] Cluster 5: 313 elements
[INFO] Cluster 6: 314 elements
[INFO] Cluster 7: 560 elements
[INFO] Cluster 8: 307 elements
[INFO] Cluster 9: 162 elements
[INFO] Cluster 10: 21 elements
[INFO] Cluster 11: 188 elements
[INFO] Cluster 12: 490 elements
[INFO] Cluster 13: 153 elements
[INFO] Cluster 14: 290 elements
[INFO] Cluster 15: 311 elements
[INFO] Cluster 16: 73 elements
[INFO] Cluster 17: 121 elements
[INFO] Cluster 18: 22 elements
[INFO] Cluster 19: 390 elements
[INFO] Cluster 20: 409 elements
[INFO] Cluster 21: 6 elements
[INFO] Cluster 22: 311 elements
[INFO] Cluster 23: 319 elements
[INFO] Cluster 24: 257 elements
[INFO] Cluster 25: 140 elements
[INFO] Cluster 26: 165 elements
[INFO] Cluster 27: 190 elements
[INFO] Cluster 28: 266 elements
[INFO] Cluster 29: 125 elements
[INFO] Cluster 30: 203 elements
[INFO] Cluster 31: 261 elements
[INFO] Cluster 32: 58 elements
[INFO] Cluster 33: 25 elements
[INFO] Cluster 34: 54 elements
[INFO] Cluster 35: 138 elements
[INFO] Cluster 36: 98 elements
[INFO] Cluster 37: 30 elements
[INFO] Cluster 38: 35 elements
[INFO] Cluster 39: 57 elements
[INFO] Cluster 40: 239 elements
[INFO] Cluster 41: 91 elements
[INFO] Cluster 42: 281 elements
[INFO] Cluster 43: 144 elements
[INFO] Cluster 44: 235 elements
[INFO] Cluster 45: 72 elements
[INFO] Cluster 46: 111 elements
[INFO] Cluster 47: 332 elements
[INFO] Cluster 48: 292 elements
[INFO] Cluster 49: 176 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=28, Long SMA=104, Sharpe=-0.0422, Trades=40
[INFO] Cluster 1 cluster: Short SMA=190, Long SMA=286, Sharpe=-0.3084, Trades=14
[INFO] Cluster 2 cluster: Short SMA=276, Long SMA=280, Sharpe=0.0124, Trades=52
[INFO] Cluster 3 cluster: Short SMA=60, Long SMA=256, Sharpe=-0.1211, Trades=14
[INFO] Cluster 4 cluster: Short SMA=250, Long SMA=284, Sharpe=0.3276, Trades=22
[INFO] Cluster 5 cluster: Short SMA=30, Long SMA=158, Sharpe=0.1779, Trades=28
[INFO] Cluster 6 cluster: Short SMA=130, Long SMA=182, Sharpe=0.1883, Trades=22
[INFO] Cluster 7 cluster: Short SMA=102, Long SMA=214, Sharpe=0.0149, Trades=14
[INFO] Cluster 8 cluster: Short SMA=146, Long SMA=192, Sharpe=0.1213, Trades=20
[INFO] Cluster 9 cluster: Short SMA=20, Long SMA=48, Sharpe=0.6373, Trades=66
[INFO] Cluster 10 cluster: Short SMA=30, Long SMA=32, Sharpe=0.0247, Trades=200
[INFO] Cluster 11 cluster: Short SMA=18, Long SMA=164, Sharpe=0.2591, Trades=36
[INFO] Cluster 12 cluster: Short SMA=84, Long SMA=274, Sharpe=0.0461, Trades=12
[INFO] Cluster 13 cluster: Short SMA=202, Long SMA=216, Sharpe=-0.2219, Trades=30
[INFO] Cluster 14 cluster: Short SMA=98, Long SMA=138, Sharpe=-0.3051, Trades=34
[INFO] Cluster 15 cluster: Short SMA=58, Long SMA=110, Sharpe=-0.2515, Trades=34
[INFO] Cluster 16 cluster: Short SMA=160, Long SMA=168, Sharpe=0.1671, Trades=54
[INFO] Cluster 17 cluster: Short SMA=102, Long SMA=120, Sharpe=-0.4915, Trades=44
[INFO] Cluster 18 cluster: Short SMA=30, Long SMA=34, Sharpe=0.0441, Trades=146
[INFO] Cluster 19 cluster: Short SMA=30, Long SMA=258, Sharpe=0.0865, Trades=20
[INFO] Cluster 20 cluster: Short SMA=60, Long SMA=168, Sharpe=-0.0436, Trades=18
[INFO] Cluster 22 cluster: Short SMA=182, Long SMA=236, Sharpe=-0.2634, Trades=20
[INFO] Cluster 23 cluster: Short SMA=210, Long SMA=242, Sharpe=-0.4873, Trades=22
[INFO] Cluster 24 cluster: Short SMA=124, Long SMA=290, Sharpe=-0.0418, Trades=10
[INFO] Cluster 25 cluster: Short SMA=116, Long SMA=158, Sharpe=-0.0028, Trades=34
[INFO] Cluster 26 cluster: Short SMA=22, Long SMA=70, Sharpe=0.2588, Trades=52
[INFO] Cluster 27 cluster: Short SMA=262, Long SMA=290, Sharpe=0.0371, Trades=20
[INFO] Cluster 28 cluster: Short SMA=148, Long SMA=234, Sharpe=-0.3138, Trades=18
[INFO] Cluster 29 cluster: Short SMA=48, Long SMA=68, Sharpe=0.0646, Trades=58
[INFO] Cluster 30 cluster: Short SMA=22, Long SMA=284, Sharpe=-0.1046, Trades=26
[INFO] Cluster 31 cluster: Short SMA=66, Long SMA=128, Sharpe=-0.5548, Trades=32
[INFO] Cluster 32 cluster: Short SMA=26, Long SMA=36, Sharpe=-0.0145, Trades=100
[INFO] Cluster 33 cluster: Short SMA=16, Long SMA=26, Sharpe=0.6297, Trades=124
[INFO] Cluster 34 cluster: Short SMA=78, Long SMA=84, Sharpe=-0.6506, Trades=75
[INFO] Cluster 35 cluster: Short SMA=20, Long SMA=200, Sharpe=-0.0813, Trades=30
[INFO] Cluster 36 cluster: Short SMA=164, Long SMA=214, Sharpe=0.0045, Trades=18
[INFO] Cluster 37 cluster: Short SMA=82, Long SMA=84, Sharpe=-0.3214, Trades=121
[INFO] Cluster 38 cluster: Short SMA=144, Long SMA=146, Sharpe=-0.0178, Trades=112
[INFO] Cluster 39 cluster: Short SMA=146, Long SMA=152, Sharpe=0.0277, Trades=76
[INFO] Cluster 40 cluster: Short SMA=56, Long SMA=206, Sharpe=-0.1903, Trades=16
[INFO] Cluster 41 cluster: Short SMA=58, Long SMA=78, Sharpe=-0.4408, Trades=54
[INFO] Cluster 42 cluster: Short SMA=144, Long SMA=266, Sharpe=0.0216, Trades=10
[INFO] Cluster 43 cluster: Short SMA=228, Long SMA=270, Sharpe=-0.0565, Trades=16
[INFO] Cluster 44 cluster: Short SMA=30, Long SMA=224, Sharpe=0.1818, Trades=22
[INFO] Cluster 45 cluster: Short SMA=222, Long SMA=226, Sharpe=-0.4034, Trades=56
[INFO] Cluster 46 cluster: Short SMA=130, Long SMA=148, Sharpe=0.0091, Trades=50
[INFO] Cluster 47 cluster: Short SMA=114, Long SMA=254, Sharpe=-0.0751, Trades=10
[INFO] Cluster 48 cluster: Short SMA=88, Long SMA=182, Sharpe=0.0166, Trades=14
[INFO] Cluster 49 cluster: Short SMA=170, Long SMA=264, Sharpe=-0.1064, Trades=16
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=44, Sharpe=0.7911, Trades=100
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=20, Long SMA=48, Sharpe=0.6373, Trades=66
[INFO] Top 2: Short SMA=16, Long SMA=26, Sharpe=0.6297, Trades=124
[INFO] Top 3: Short SMA=250, Long SMA=284, Sharpe=0.3276, Trades=22
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10579 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 44
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(20/48) - Original Sharpe: 0.6373, Trades: 66
[INFO] Hierarchical cluster 2: SMA(16/26) - Original Sharpe: 0.6297, Trades: 124
[INFO] Hierarchical cluster 3: SMA(250/284) - Original Sharpe: 0.3276, Trades: 22
[INFO] Hierarchical cluster 4: SMA(18/164) - Original Sharpe: 0.2591, Trades: 36
[INFO] Hierarchical cluster 5: SMA(22/70) - Original Sharpe: 0.2588, Trades: 52
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/44)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (20/48) - Sharpe: 0.6373
[INFO] cluster 2: (16/26) - Sharpe: 0.6297
[INFO] cluster 3: (250/284) - Sharpe: 0.3276
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -4.559447           -3.279724
1    2021-11-14 2021-11-14            43    -2.832319           -0.764695
2    2022-01-14 2022-01-14            41    -0.950707           -2.228976
3    2022-03-14 2022-03-14            44    -3.892117           -0.710241
4    2022-05-14 2022-05-14            43     0.644192           -1.708740
5    2022-07-14 2022-07-14            44    -4.160323           -1.008933
6    2022-09-14 2022-09-14            43     1.032024            2.299271
7    2022-11-14 2022-11-14            43    -0.748377           -1.930487
8    2023-01-14 2023-01-14            41    -4.124943            1.928573
9    2023-03-14 2023-03-14            44     0.052422           -4.974505
10   2023-05-14 2023-05-14            44    -2.505249           -3.037270
11   2023-07-14 2023-07-14            44    -2.114246            0.645298
12   2023-09-14 2023-09-14            43     1.988935            0.230364
13   2023-11-14 2023-11-14            42    -3.835381           -2.562235
14   2024-01-14 2024-01-14            43    -1.838269            0.238900
15   2024-03-14 2024-03-14            42     1.898357            0.943989
16   2024-05-14 2024-05-14            44     1.248914           -2.500041
17   2024-07-14 2024-07-14            45     0.220219           -6.192219
18   2024-09-14 2024-09-14            43     0.081170            1.207796
19   2024-11-14 2024-11-14            33     3.870625            4.000879
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -4.6 |             -3.3 |          1.3 | True          
[INFO] 2021-11-14   |         -2.8 |             -0.8 |          2.0 | True          
[INFO] 2022-01-14   |         -1.0 |             -2.2 |         -1.2 | False         
[INFO] 2022-03-14   |         -3.9 |             -0.7 |          3.2 | True          
[INFO] 2022-05-14   |          0.6 |             -1.7 |         -2.3 | False         
[INFO] 2022-07-14   |         -4.2 |             -1.0 |          3.2 | True          
[INFO] 2022-09-14   |          1.0 |              2.3 |          1.3 | True          
[INFO] 2022-11-14   |         -0.7 |             -1.9 |         -1.2 | False         
[INFO] 2023-01-14   |         -4.1 |              1.9 |          6.0 | True          
[INFO] 2023-03-14   |          0.1 |             -5.0 |         -5.1 | False         
[INFO] 2023-05-14   |         -2.5 |             -3.0 |         -0.5 | False         
[INFO] 2023-07-14   |         -2.1 |              0.6 |          2.7 | True          
[INFO] 2023-09-14   |          2.0 |              0.2 |         -1.8 | False         
[INFO] 2023-11-14   |         -3.8 |             -2.6 |          1.2 | True          
[INFO] 2024-01-14   |         -1.8 |              0.2 |          2.0 | True          
[INFO] 2024-03-14   |          1.9 |              0.9 |         -1.0 | False         
[INFO] 2024-05-14   |          1.2 |             -2.5 |         -3.7 | False         
[INFO] 2024-07-14   |          0.2 |             -6.2 |         -6.4 | False         
[INFO] 2024-09-14   |          0.1 |              1.2 |          1.1 | True          
[INFO] 2024-11-14   |          3.9 |              4.0 |          0.1 | True          
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 20 periods (55.00% win rate)
[INFO] Updating Excel file with Hierarchical results for CD...
[INFO] Excel file updated successfully. Added CD with Hierarchical win rate 55.0% in row 9
[INFO] Added best Sharpe parameters 38/44 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 44
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(20/48) - Original Sharpe: 0.6373
[INFO] Added cluster 2 to portfolio: SMA(16/26) - Original Sharpe: 0.6297
[INFO] Added cluster 3 to portfolio: SMA(250/284) - Original Sharpe: 0.3276
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CD_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.8242
[INFO] Hierarchical Best out-of-sample Sharpe: -0.9993
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for CD...
[INFO] Excel file updated successfully. Added CD with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CD
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CL in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 115.48s
[INFO] Best parameters: Short SMA = 48, Long SMA = 50
[INFO] Best Sharpe ratio: 0.878812, Trades: 162
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CL
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.78 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $355,616.00
[INFO] Market Buy & Hold P&L: $-27,500.00
[INFO] Outperformance: $383,116.00
[INFO] Sharpe ratio (entire period, annualized): 0.399775
[INFO] Sharpe ratio (in-sample, annualized): 0.878812
[INFO] Sharpe ratio (out-of-sample, annualized): -0.653072
[INFO] Maximum Drawdown: $261,660.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 108
[INFO] Out-of-sample period trades: 54
[INFO] Total trades: 162
[INFO] In-sample P&L: $513,068.00
[INFO] Out-of-sample P&L: $-173,232.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.878812
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6266 to 0.8788
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.878812
[INFO] Number of Trades: 162
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6266 to 0.8788
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.0216 to 3.8079
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 237 elements
[INFO] Kmeans Cluster 1: 288 elements
[INFO] Kmeans Cluster 2: 207 elements
[INFO] Kmeans Cluster 3: 248 elements
[INFO] Kmeans Cluster 4: 312 elements
[INFO] Kmeans Cluster 5: 170 elements
[INFO] Kmeans Cluster 6: 157 elements
[INFO] Kmeans Cluster 7: 211 elements
[INFO] Kmeans Cluster 8: 251 elements
[INFO] Kmeans Cluster 9: 204 elements
[INFO] Kmeans Cluster 10: 281 elements
[INFO] Kmeans Cluster 11: 305 elements
[INFO] Kmeans Cluster 12: 165 elements
[INFO] Kmeans Cluster 13: 129 elements
[INFO] Kmeans Cluster 14: 261 elements
[INFO] Kmeans Cluster 15: 75 elements
[INFO] Kmeans Cluster 16: 115 elements
[INFO] Kmeans Cluster 17: 277 elements
[INFO] Kmeans Cluster 18: 272 elements
[INFO] Kmeans Cluster 19: 105 elements
[INFO] Kmeans Cluster 20: 221 elements
[INFO] Kmeans Cluster 21: 186 elements
[INFO] Kmeans Cluster 22: 253 elements
[INFO] Kmeans Cluster 23: 186 elements
[INFO] Kmeans Cluster 24: 221 elements
[INFO] Kmeans Cluster 25: 395 elements
[INFO] Kmeans Cluster 26: 277 elements
[INFO] Kmeans Cluster 27: 163 elements
[INFO] Kmeans Cluster 28: 69 elements
[INFO] Kmeans Cluster 29: 297 elements
[INFO] Kmeans Cluster 30: 86 elements
[INFO] Kmeans Cluster 31: 203 elements
[INFO] Kmeans Cluster 32: 278 elements
[INFO] Kmeans Cluster 33: 214 elements
[INFO] Kmeans Cluster 34: 298 elements
[INFO] Kmeans Cluster 35: 185 elements
[INFO] Kmeans Cluster 36: 189 elements
[INFO] Kmeans Cluster 37: 205 elements
[INFO] Kmeans Cluster 38: 222 elements
[INFO] Kmeans Cluster 39: 262 elements
[INFO] Kmeans Cluster 40: 111 elements
[INFO] Kmeans Cluster 41: 93 elements
[INFO] Kmeans Cluster 42: 100 elements
[INFO] Kmeans Cluster 43: 200 elements
[INFO] Kmeans Cluster 44: 273 elements
[INFO] Kmeans Cluster 45: 135 elements
[INFO] Kmeans Cluster 46: 237 elements
[INFO] Kmeans Cluster 47: 231 elements
[INFO] Kmeans Cluster 48: 337 elements
[INFO] Kmeans Cluster 49: 188 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=91.05, Long SMA=155.53, Sharpe=-0.1483
[INFO] Centroid 1: Short SMA=124.48, Long SMA=242.09, Sharpe=0.1147
[INFO] Centroid 2: Short SMA=32.08, Long SMA=126.87, Sharpe=0.1911
[INFO] Centroid 3: Short SMA=65.98, Long SMA=259.48, Sharpe=0.1921
[INFO] Centroid 4: Short SMA=219.00, Long SMA=248.22, Sharpe=0.1119
[INFO] Centroid 5: Short SMA=153.45, Long SMA=178.65, Sharpe=0.4056
[INFO] Centroid 6: Short SMA=27.53, Long SMA=55.85, Sharpe=0.4846
[INFO] Centroid 7: Short SMA=135.36, Long SMA=287.83, Sharpe=-0.0858
[INFO] Centroid 8: Short SMA=252.21, Long SMA=283.79, Sharpe=-0.1431
[INFO] Centroid 9: Short SMA=77.17, Long SMA=184.04, Sharpe=0.0381
[INFO] Centroid 10: Short SMA=25.50, Long SMA=223.37, Sharpe=0.2426
[INFO] Centroid 11: Short SMA=139.06, Long SMA=221.37, Sharpe=0.1889
[INFO] Centroid 12: Short SMA=91.41, Long SMA=215.24, Sharpe=0.3946
[INFO] Centroid 13: Short SMA=69.09, Long SMA=97.02, Sharpe=0.1146
[INFO] Centroid 14: Short SMA=30.05, Long SMA=277.53, Sharpe=0.4262
[INFO] Centroid 15: Short SMA=184.56, Long SMA=197.84, Sharpe=-0.0615
[INFO] Centroid 16: Short SMA=124.80, Long SMA=137.63, Sharpe=0.1438
[INFO] Centroid 17: Short SMA=37.70, Long SMA=86.27, Sharpe=0.3760
[INFO] Centroid 18: Short SMA=102.62, Long SMA=265.10, Sharpe=0.1893
[INFO] Centroid 19: Short SMA=93.70, Long SMA=122.84, Sharpe=-0.4356
[INFO] Centroid 20: Short SMA=22.05, Long SMA=177.80, Sharpe=0.1553
[INFO] Centroid 21: Short SMA=125.09, Long SMA=150.26, Sharpe=-0.0066
[INFO] Centroid 22: Short SMA=142.13, Long SMA=269.92, Sharpe=0.0194
[INFO] Centroid 23: Short SMA=186.83, Long SMA=224.56, Sharpe=0.2397
[INFO] Centroid 24: Short SMA=66.91, Long SMA=189.03, Sharpe=0.1837
[INFO] Centroid 25: Short SMA=36.30, Long SMA=274.23, Sharpe=0.3047
[INFO] Centroid 26: Short SMA=236.46, Long SMA=263.13, Sharpe=0.0025
[INFO] Centroid 27: Short SMA=263.56, Long SMA=293.55, Sharpe=-0.2748
[INFO] Centroid 28: Short SMA=201.45, Long SMA=213.68, Sharpe=0.4408
[INFO] Centroid 29: Short SMA=88.77, Long SMA=286.08, Sharpe=0.0385
[INFO] Centroid 30: Short SMA=133.51, Long SMA=158.88, Sharpe=-0.1962
[INFO] Centroid 31: Short SMA=199.84, Long SMA=292.36, Sharpe=-0.0506
[INFO] Centroid 32: Short SMA=171.06, Long SMA=275.00, Sharpe=0.1313
[INFO] Centroid 33: Short SMA=189.82, Long SMA=266.70, Sharpe=0.2317
[INFO] Centroid 34: Short SMA=157.66, Long SMA=196.15, Sharpe=0.2683
[INFO] Centroid 35: Short SMA=115.22, Long SMA=181.60, Sharpe=0.1568
[INFO] Centroid 36: Short SMA=115.74, Long SMA=193.43, Sharpe=0.2848
[INFO] Centroid 37: Short SMA=63.93, Long SMA=147.43, Sharpe=-0.0403
[INFO] Centroid 38: Short SMA=40.77, Long SMA=230.05, Sharpe=0.1499
[INFO] Centroid 39: Short SMA=35.06, Long SMA=148.59, Sharpe=0.0711
[INFO] Centroid 40: Short SMA=19.01, Long SMA=39.77, Sharpe=0.3498
[INFO] Centroid 41: Short SMA=84.88, Long SMA=109.55, Sharpe=-0.1192
[INFO] Centroid 42: Short SMA=30.06, Long SMA=52.44, Sharpe=0.6481
[INFO] Centroid 43: Short SMA=40.05, Long SMA=189.93, Sharpe=0.3247
[INFO] Centroid 44: Short SMA=179.39, Long SMA=234.81, Sharpe=0.0856
[INFO] Centroid 45: Short SMA=27.39, Long SMA=67.39, Sharpe=0.2202
[INFO] Centroid 46: Short SMA=60.04, Long SMA=91.37, Sharpe=0.2690
[INFO] Centroid 47: Short SMA=30.70, Long SMA=124.28, Sharpe=0.3074
[INFO] Centroid 48: Short SMA=78.87, Long SMA=228.43, Sharpe=0.2900
[INFO] Centroid 49: Short SMA=92.30, Long SMA=128.44, Sharpe=-0.2915
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8788, Trades=162
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=36, Long SMA=52, Sharpe=0.7165, Trades=64
[INFO] Kmeans Top 2: Short SMA=28, Long SMA=56, Sharpe=0.5552, Trades=58
[INFO] Kmeans Top 3: Short SMA=202, Long SMA=214, Sharpe=0.5236, Trades=33
[INFO] Kmeans Top 4: Short SMA=96, Long SMA=216, Sharpe=0.4374, Trades=15
[INFO] Kmeans Top 5: Short SMA=18, Long SMA=40, Sharpe=0.4070, Trades=72
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (91, 156)
[INFO]   Nearest: (92.0, 156.0)
[INFO]   Rounded: (124, 242)
[INFO]   Rounded: (32, 127)
[INFO]   Nearest: (32.0, 126.0)
[INFO]   Rounded: (66, 259)
[INFO]   Nearest: (66.0, 260.0)
[INFO]   Rounded: (219, 248)
[INFO]   Nearest: (218.0, 248.0)
[INFO]   Rounded: (153, 179)
[INFO]   Nearest: (154.0, 178.0)
[INFO]   Rounded: (28, 56)
[INFO]   Rounded: (135, 288)
[INFO]   Nearest: (136.0, 288.0)
[INFO]   Rounded: (252, 284)
[INFO]   Rounded: (77, 184)
[INFO]   Nearest: (78.0, 184.0)
[INFO]   Rounded: (26, 223)
[INFO]   Nearest: (26.0, 224.0)
[INFO]   Rounded: (139, 221)
[INFO]   Nearest: (140.0, 222.0)
[INFO]   Rounded: (91, 215)
[INFO]   Nearest: (92.0, 216.0)
[INFO]   Rounded: (69, 97)
[INFO]   Nearest: (70.0, 98.0)
[INFO]   Rounded: (30, 278)
[INFO]   Rounded: (185, 198)
[INFO]   Nearest: (184.0, 198.0)
[INFO]   Rounded: (125, 138)
[INFO]   Nearest: (124.0, 138.0)
[INFO]   Rounded: (38, 86)
[INFO]   Rounded: (103, 265)
[INFO]   Nearest: (102.0, 266.0)
[INFO]   Rounded: (94, 123)
[INFO]   Nearest: (94.0, 122.0)
[INFO]   Rounded: (22, 178)
[INFO]   Rounded: (125, 150)
[INFO]   Nearest: (126.0, 150.0)
[INFO]   Rounded: (142, 270)
[INFO]   Rounded: (187, 225)
[INFO]   Nearest: (186.0, 224.0)
[INFO]   Rounded: (67, 189)
[INFO]   Nearest: (66.0, 190.0)
[INFO]   Rounded: (36, 274)
[INFO]   Rounded: (236, 263)
[INFO]   Nearest: (236.0, 264.0)
[INFO]   Rounded: (264, 294)
[INFO]   Rounded: (201, 214)
[INFO]   Nearest: (202.0, 214.0)
[INFO]   Rounded: (89, 286)
[INFO]   Nearest: (88.0, 286.0)
[INFO]   Rounded: (134, 159)
[INFO]   Nearest: (134.0, 158.0)
[INFO]   Rounded: (200, 292)
[INFO]   Rounded: (171, 275)
[INFO]   Nearest: (172.0, 274.0)
[INFO]   Rounded: (190, 267)
[INFO]   Nearest: (190.0, 266.0)
[INFO]   Rounded: (158, 196)
[INFO]   Rounded: (115, 182)
[INFO]   Nearest: (116.0, 182.0)
[INFO]   Rounded: (116, 193)
[INFO]   Nearest: (116.0, 194.0)
[INFO]   Rounded: (64, 147)
[INFO]   Nearest: (64.0, 148.0)
[INFO]   Rounded: (41, 230)
[INFO]   Nearest: (40.0, 230.0)
[INFO]   Rounded: (35, 149)
[INFO]   Nearest: (36.0, 148.0)
[INFO]   Rounded: (19, 40)
[INFO]   Nearest: (20.0, 40.0)
[INFO]   Rounded: (85, 110)
[INFO]   Nearest: (84.0, 110.0)
[INFO]   Rounded: (30, 52)
[INFO]   Rounded: (40, 190)
[INFO]   Rounded: (179, 235)
[INFO]   Nearest: (180.0, 234.0)
[INFO]   Rounded: (27, 67)
[INFO]   Nearest: (28.0, 68.0)
[INFO]   Rounded: (60, 91)
[INFO]   Nearest: (60.0, 92.0)
[INFO]   Rounded: (31, 124)
[INFO]   Nearest: (30.0, 124.0)
[INFO]   Rounded: (79, 228)
[INFO]   Nearest: (78.0, 228.0)
[INFO]   Rounded: (92, 128)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(36/52) - Original Sharpe: 0.7165, Trades: 64
[INFO] Kmeans cluster 2: SMA(28/56) - Original Sharpe: 0.5552, Trades: 58
[INFO] Kmeans cluster 3: SMA(202/214) - Original Sharpe: 0.5236, Trades: 33
[INFO] Kmeans cluster 4: SMA(96/216) - Original Sharpe: 0.4374, Trades: 15
[INFO] Kmeans cluster 5: SMA(18/40) - Original Sharpe: 0.4070, Trades: 72
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (36/52) - Sharpe: 0.7165
[INFO] cluster 2: (28/56) - Sharpe: 0.5552
[INFO] cluster 3: (202/214) - Sharpe: 0.5236
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.084997            1.178283
1    2021-11-14 2021-11-14            43    -3.371493           -2.776162
2    2022-01-14 2022-01-14            41     0.999580            2.676256
3    2022-03-14 2022-03-14            44    -2.172742           -1.019148
4    2022-05-14 2022-05-14            43    -2.742027           -1.512862
5    2022-07-14 2022-07-14            44     1.611941            2.622592
6    2022-09-14 2022-09-14            43    -0.389136           -0.498538
7    2022-11-14 2022-11-14            43    -1.067985           -4.201534
8    2023-01-14 2023-01-14            41     3.157482            1.716127
9    2023-03-14 2023-03-14            43    -3.021412           -0.207377
10   2023-05-14 2023-05-14            44    -0.333860           -2.180488
11   2023-07-14 2023-07-14            44     5.741367            3.583385
12   2023-09-14 2023-09-14            43    -1.017661           -2.910446
13   2023-11-14 2023-11-14            42     1.520442            1.142278
14   2024-01-14 2024-01-14            43    -0.905207            1.429360
15   2024-03-14 2024-03-14            42     0.235563            0.235563
16   2024-05-14 2024-05-14            44    -5.318006           -2.900340
17   2024-07-14 2024-07-14            45    -0.143393           -0.361917
18   2024-09-14 2024-09-14            43    -1.755618           -2.021088
19   2024-11-14 2024-11-14            33    -0.116449           -0.891781
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |              1.2 |          3.3 | True          
[INFO] 2021-11-14   |         -3.4 |             -2.8 |          0.6 | True          
[INFO] 2022-01-14   |          1.0 |              2.7 |          1.7 | True          
[INFO] 2022-03-14   |         -2.2 |             -1.0 |          1.2 | True          
[INFO] 2022-05-14   |         -2.7 |             -1.5 |          1.2 | True          
[INFO] 2022-07-14   |          1.6 |              2.6 |          1.0 | True          
[INFO] 2022-09-14   |         -0.4 |             -0.5 |         -0.1 | False         
[INFO] 2022-11-14   |         -1.1 |             -4.2 |         -3.1 | False         
[INFO] 2023-01-14   |          3.2 |              1.7 |         -1.5 | False         
[INFO] 2023-03-14   |         -3.0 |             -0.2 |          2.8 | True          
[INFO] 2023-05-14   |         -0.3 |             -2.2 |         -1.9 | False         
[INFO] 2023-07-14   |          5.7 |              3.6 |         -2.1 | False         
[INFO] 2023-09-14   |         -1.0 |             -2.9 |         -1.9 | False         
[INFO] 2023-11-14   |          1.5 |              1.1 |         -0.4 | False         
[INFO] 2024-01-14   |         -0.9 |              1.4 |          2.3 | True          
[INFO] 2024-03-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -2.9 |          2.4 | True          
[INFO] 2024-07-14   |         -0.1 |             -0.4 |         -0.3 | False         
[INFO] 2024-09-14   |         -1.8 |             -2.0 |         -0.2 | False         
[INFO] 2024-11-14   |         -0.1 |             -0.9 |         -0.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 9 of 19 periods (47.37% win rate)
[INFO] Updating Excel file with Kmeans results for CL...
[INFO] Excel file updated successfully. Added CL with Kmeans win rate 47.4% in row 10
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(36/52) - Original Sharpe: 0.7165
[INFO] Added cluster 2 to portfolio: SMA(28/56) - Original Sharpe: 0.5552
[INFO] Added cluster 3 to portfolio: SMA(202/214) - Original Sharpe: 0.5236
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CL_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.4382
[INFO] Kmeans Best out-of-sample Sharpe: -0.6531
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for CL...
[INFO] Excel file updated successfully. Added CL with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CL
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6266 to 0.8788
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.878812
[INFO] Number of Trades: 162
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6266 to 0.8788
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.0216 to 3.8079
[INFO] Scaled Trades range: -0.7951 to 15.7640
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6071
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 253 elements
[INFO] Cluster 1: 438 elements
[INFO] Cluster 2: 233 elements
[INFO] Cluster 3: 51 elements
[INFO] Cluster 4: 321 elements
[INFO] Cluster 5: 333 elements
[INFO] Cluster 6: 423 elements
[INFO] Cluster 7: 298 elements
[INFO] Cluster 8: 432 elements
[INFO] Cluster 9: 46 elements
[INFO] Cluster 10: 492 elements
[INFO] Cluster 11: 425 elements
[INFO] Cluster 12: 284 elements
[INFO] Cluster 13: 354 elements
[INFO] Cluster 14: 253 elements
[INFO] Cluster 15: 140 elements
[INFO] Cluster 16: 325 elements
[INFO] Cluster 17: 289 elements
[INFO] Cluster 18: 279 elements
[INFO] Cluster 19: 280 elements
[INFO] Cluster 20: 269 elements
[INFO] Cluster 21: 61 elements
[INFO] Cluster 22: 259 elements
[INFO] Cluster 23: 66 elements
[INFO] Cluster 24: 448 elements
[INFO] Cluster 25: 107 elements
[INFO] Cluster 26: 77 elements
[INFO] Cluster 27: 125 elements
[INFO] Cluster 28: 81 elements
[INFO] Cluster 29: 287 elements
[INFO] Cluster 30: 73 elements
[INFO] Cluster 31: 10 elements
[INFO] Cluster 32: 163 elements
[INFO] Cluster 33: 72 elements
[INFO] Cluster 34: 177 elements
[INFO] Cluster 35: 36 elements
[INFO] Cluster 36: 267 elements
[INFO] Cluster 37: 47 elements
[INFO] Cluster 38: 217 elements
[INFO] Cluster 39: 315 elements
[INFO] Cluster 40: 263 elements
[INFO] Cluster 41: 270 elements
[INFO] Cluster 42: 296 elements
[INFO] Cluster 43: 82 elements
[INFO] Cluster 44: 4 elements
[INFO] Cluster 45: 103 elements
[INFO] Cluster 46: 204 elements
[INFO] Cluster 47: 71 elements
[INFO] Cluster 48: 154 elements
[INFO] Cluster 49: 32 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=92, Long SMA=126, Sharpe=-0.3423, Trades=26
[INFO] Cluster 1 cluster: Short SMA=42, Long SMA=110, Sharpe=0.4037, Trades=26
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=62, Sharpe=0.4966, Trades=56
[INFO] Cluster 3 cluster: Short SMA=38, Long SMA=42, Sharpe=0.4436, Trades=111
[INFO] Cluster 4 cluster: Short SMA=170, Long SMA=210, Sharpe=0.2837, Trades=19
[INFO] Cluster 5 cluster: Short SMA=98, Long SMA=154, Sharpe=-0.2063, Trades=21
[INFO] Cluster 6 cluster: Short SMA=90, Long SMA=260, Sharpe=0.1130, Trades=13
[INFO] Cluster 7 cluster: Short SMA=252, Long SMA=292, Sharpe=-0.1272, Trades=21
[INFO] Cluster 8 cluster: Short SMA=230, Long SMA=256, Sharpe=0.0264, Trades=22
[INFO] Cluster 9 cluster: Short SMA=42, Long SMA=44, Sharpe=0.5017, Trades=146
[INFO] Cluster 10 cluster: Short SMA=84, Long SMA=220, Sharpe=0.2709, Trades=15
[INFO] Cluster 11 cluster: Short SMA=122, Long SMA=192, Sharpe=0.2381, Trades=19
[INFO] Cluster 12 cluster: Short SMA=52, Long SMA=136, Sharpe=0.1933, Trades=22
[INFO] Cluster 13 cluster: Short SMA=198, Long SMA=258, Sharpe=0.2886, Trades=16
[INFO] Cluster 14 cluster: Short SMA=24, Long SMA=90, Sharpe=0.4327, Trades=36
[INFO] Cluster 15 cluster: Short SMA=20, Long SMA=44, Sharpe=0.2535, Trades=74
[INFO] Cluster 16 cluster: Short SMA=140, Long SMA=286, Sharpe=-0.1127, Trades=13
[INFO] Cluster 17 cluster: Short SMA=142, Long SMA=180, Sharpe=0.3321, Trades=23
[INFO] Cluster 18 cluster: Short SMA=24, Long SMA=270, Sharpe=0.3776, Trades=20
[INFO] Cluster 19 cluster: Short SMA=22, Long SMA=154, Sharpe=0.0176, Trades=28
[INFO] Cluster 20 cluster: Short SMA=82, Long SMA=176, Sharpe=0.0449, Trades=20
[INFO] Cluster 21 cluster: Short SMA=108, Long SMA=116, Sharpe=-0.3614, Trades=56
[INFO] Cluster 22 cluster: Short SMA=20, Long SMA=208, Sharpe=0.2667, Trades=28
[INFO] Cluster 23 cluster: Short SMA=150, Long SMA=154, Sharpe=0.0009, Trades=67
[INFO] Cluster 24 cluster: Short SMA=126, Long SMA=246, Sharpe=0.1194, Trades=15
[INFO] Cluster 25 cluster: Short SMA=64, Long SMA=80, Sharpe=0.1572, Trades=53
[INFO] Cluster 26 cluster: Short SMA=176, Long SMA=184, Sharpe=0.2977, Trades=47
[INFO] Cluster 27 cluster: Short SMA=124, Long SMA=138, Sharpe=0.0844, Trades=41
[INFO] Cluster 28 cluster: Short SMA=242, Long SMA=246, Sharpe=0.1017, Trades=58
[INFO] Cluster 29 cluster: Short SMA=66, Long SMA=188, Sharpe=0.1746, Trades=18
[INFO] Cluster 30 cluster: Short SMA=270, Long SMA=280, Sharpe=-0.1083, Trades=37
[INFO] Cluster 32 cluster: Short SMA=206, Long SMA=292, Sharpe=-0.0738, Trades=15
[INFO] Cluster 33 cluster: Short SMA=184, Long SMA=198, Sharpe=-0.0192, Trades=29
[INFO] Cluster 34 cluster: Short SMA=38, Long SMA=186, Sharpe=0.3097, Trades=20
[INFO] Cluster 35 cluster: Short SMA=106, Long SMA=110, Sharpe=-0.2315, Trades=84
[INFO] Cluster 36 cluster: Short SMA=172, Long SMA=278, Sharpe=0.1972, Trades=17
[INFO] Cluster 37 cluster: Short SMA=38, Long SMA=48, Sharpe=0.7150, Trades=74
[INFO] Cluster 38 cluster: Short SMA=42, Long SMA=286, Sharpe=0.4796, Trades=14
[INFO] Cluster 39 cluster: Short SMA=92, Long SMA=288, Sharpe=0.0643, Trades=14
[INFO] Cluster 40 cluster: Short SMA=40, Long SMA=228, Sharpe=0.1698, Trades=18
[INFO] Cluster 41 cluster: Short SMA=56, Long SMA=258, Sharpe=0.2905, Trades=16
[INFO] Cluster 42 cluster: Short SMA=164, Long SMA=232, Sharpe=0.1008, Trades=17
[INFO] Cluster 43 cluster: Short SMA=12, Long SMA=250, Sharpe=0.5293, Trades=28
[INFO] Cluster 45 cluster: Short SMA=114, Long SMA=148, Sharpe=-0.0496, Trades=25
[INFO] Cluster 46 cluster: Short SMA=160, Long SMA=254, Sharpe=0.0366, Trades=19
[INFO] Cluster 47 cluster: Short SMA=70, Long SMA=94, Sharpe=0.2147, Trades=41
[INFO] Cluster 48 cluster: Short SMA=68, Long SMA=138, Sharpe=-0.0908, Trades=22
[INFO] Cluster 49 cluster: Short SMA=280, Long SMA=284, Sharpe=-0.1702, Trades=57
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8788, Trades=162
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=48, Sharpe=0.7150, Trades=74
[INFO] Top 2: Short SMA=12, Long SMA=250, Sharpe=0.5293, Trades=28
[INFO] Top 3: Short SMA=42, Long SMA=44, Sharpe=0.5017, Trades=146
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10571 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/48) - Original Sharpe: 0.7150, Trades: 74
[INFO] Hierarchical cluster 2: SMA(12/250) - Original Sharpe: 0.5293, Trades: 28
[INFO] Hierarchical cluster 3: SMA(42/44) - Original Sharpe: 0.5017, Trades: 146
[INFO] Hierarchical cluster 4: SMA(32/62) - Original Sharpe: 0.4966, Trades: 56
[INFO] Hierarchical cluster 5: SMA(42/286) - Original Sharpe: 0.4796, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/48) - Sharpe: 0.7150
[INFO] cluster 2: (12/250) - Sharpe: 0.5293
[INFO] cluster 3: (42/44) - Sharpe: 0.5017
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.084997            0.380274
1    2021-11-14 2021-11-14            43    -3.371493           -2.320114
2    2022-01-14 2022-01-14            41     0.999580            2.633910
3    2022-03-14 2022-03-14            44    -2.172742           -0.210781
4    2022-05-14 2022-05-14            43    -2.742027           -2.524345
5    2022-07-14 2022-07-14            44     1.611941            1.798501
6    2022-09-14 2022-09-14            43    -0.389136           -3.175985
7    2022-11-14 2022-11-14            43    -1.067985           -1.481491
8    2023-01-14 2023-01-14            41     3.157482           -1.415664
9    2023-03-14 2023-03-14            43    -3.021412           -0.534803
10   2023-05-14 2023-05-14            44    -0.333860           -1.977833
11   2023-07-14 2023-07-14            44     5.741367            2.261066
12   2023-09-14 2023-09-14            43    -1.017661           -1.791434
13   2023-11-14 2023-11-14            42     1.520442            1.252467
14   2024-01-14 2024-01-14            43    -0.905207            1.493713
15   2024-03-14 2024-03-14            42     0.235563            0.235563
16   2024-05-14 2024-05-14            44    -5.318006           -3.465176
17   2024-07-14 2024-07-14            45    -0.143393           -0.583365
18   2024-09-14 2024-09-14            43    -1.755618           -0.696694
19   2024-11-14 2024-11-14            33    -0.116449           -2.889909
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |              0.4 |          2.5 | True          
[INFO] 2021-11-14   |         -3.4 |             -2.3 |          1.1 | True          
[INFO] 2022-01-14   |          1.0 |              2.6 |          1.6 | True          
[INFO] 2022-03-14   |         -2.2 |             -0.2 |          2.0 | True          
[INFO] 2022-05-14   |         -2.7 |             -2.5 |          0.2 | True          
[INFO] 2022-07-14   |          1.6 |              1.8 |          0.2 | True          
[INFO] 2022-09-14   |         -0.4 |             -3.2 |         -2.8 | False         
[INFO] 2022-11-14   |         -1.1 |             -1.5 |         -0.4 | False         
[INFO] 2023-01-14   |          3.2 |             -1.4 |         -4.6 | False         
[INFO] 2023-03-14   |         -3.0 |             -0.5 |          2.5 | True          
[INFO] 2023-05-14   |         -0.3 |             -2.0 |         -1.7 | False         
[INFO] 2023-07-14   |          5.7 |              2.3 |         -3.4 | False         
[INFO] 2023-09-14   |         -1.0 |             -1.8 |         -0.8 | False         
[INFO] 2023-11-14   |          1.5 |              1.3 |         -0.2 | False         
[INFO] 2024-01-14   |         -0.9 |              1.5 |          2.4 | True          
[INFO] 2024-03-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -3.5 |          1.8 | True          
[INFO] 2024-07-14   |         -0.1 |             -0.6 |         -0.5 | False         
[INFO] 2024-09-14   |         -1.8 |             -0.7 |          1.1 | True          
[INFO] 2024-11-14   |         -0.1 |             -2.9 |         -2.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 19 periods (52.63% win rate)
[INFO] Updating Excel file with Hierarchical results for CL...
[INFO] Excel file updated successfully. Added CL with Hierarchical win rate 52.6% in row 10
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/48) - Original Sharpe: 0.7150
[INFO] Added cluster 2 to portfolio: SMA(12/250) - Original Sharpe: 0.5293
[INFO] Added cluster 3 to portfolio: SMA(42/44) - Original Sharpe: 0.5017
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CL_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.5540
[INFO] Hierarchical Best out-of-sample Sharpe: -0.6531
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for CL...
[INFO] Excel file updated successfully. Added CL with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CL
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CT in column D: 16.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 145.69s
[INFO] Best parameters: Short SMA = 34, Long SMA = 46
[INFO] Best Sharpe ratio: 0.962456, Trades: 81
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CT
[INFO] Big Point Value (from data): 500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.39 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $473,067.00
[INFO] Market Buy & Hold P&L: $-135.00
[INFO] Outperformance: $473,202.00
[INFO] Sharpe ratio (entire period, annualized): 0.734813
[INFO] Sharpe ratio (in-sample, annualized): 0.962456
[INFO] Sharpe ratio (out-of-sample, annualized): 0.233362
[INFO] Maximum Drawdown: $139,161.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 60
[INFO] Out-of-sample period trades: 21
[INFO] Total trades: 81
[INFO] In-sample P&L: $500,879.00
[INFO] Out-of-sample P&L: $55,046.00
[INFO] 
Best parameters from GA: Short SMA = 34, Long SMA = 46, Sharpe = 0.962456
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 500.0
[INFO] Slippage: 16.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6979 to 0.9625
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.962456
[INFO] Number of Trades: 81
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6979 to 0.9625
[INFO] Trades range: 10.0 to 339.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6852 to 3.9097
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 207 elements
[INFO] Kmeans Cluster 1: 305 elements
[INFO] Kmeans Cluster 2: 227 elements
[INFO] Kmeans Cluster 3: 240 elements
[INFO] Kmeans Cluster 4: 187 elements
[INFO] Kmeans Cluster 5: 127 elements
[INFO] Kmeans Cluster 6: 172 elements
[INFO] Kmeans Cluster 7: 227 elements
[INFO] Kmeans Cluster 8: 267 elements
[INFO] Kmeans Cluster 9: 157 elements
[INFO] Kmeans Cluster 10: 141 elements
[INFO] Kmeans Cluster 11: 301 elements
[INFO] Kmeans Cluster 12: 223 elements
[INFO] Kmeans Cluster 13: 159 elements
[INFO] Kmeans Cluster 14: 130 elements
[INFO] Kmeans Cluster 15: 110 elements
[INFO] Kmeans Cluster 16: 332 elements
[INFO] Kmeans Cluster 17: 179 elements
[INFO] Kmeans Cluster 18: 155 elements
[INFO] Kmeans Cluster 19: 293 elements
[INFO] Kmeans Cluster 20: 171 elements
[INFO] Kmeans Cluster 21: 410 elements
[INFO] Kmeans Cluster 22: 193 elements
[INFO] Kmeans Cluster 23: 224 elements
[INFO] Kmeans Cluster 24: 253 elements
[INFO] Kmeans Cluster 25: 52 elements
[INFO] Kmeans Cluster 26: 149 elements
[INFO] Kmeans Cluster 27: 207 elements
[INFO] Kmeans Cluster 28: 154 elements
[INFO] Kmeans Cluster 29: 224 elements
[INFO] Kmeans Cluster 30: 134 elements
[INFO] Kmeans Cluster 31: 254 elements
[INFO] Kmeans Cluster 32: 324 elements
[INFO] Kmeans Cluster 33: 59 elements
[INFO] Kmeans Cluster 34: 311 elements
[INFO] Kmeans Cluster 35: 197 elements
[INFO] Kmeans Cluster 36: 269 elements
[INFO] Kmeans Cluster 37: 275 elements
[INFO] Kmeans Cluster 38: 210 elements
[INFO] Kmeans Cluster 39: 187 elements
[INFO] Kmeans Cluster 40: 224 elements
[INFO] Kmeans Cluster 41: 257 elements
[INFO] Kmeans Cluster 42: 82 elements
[INFO] Kmeans Cluster 43: 109 elements
[INFO] Kmeans Cluster 44: 310 elements
[INFO] Kmeans Cluster 45: 231 elements
[INFO] Kmeans Cluster 46: 180 elements
[INFO] Kmeans Cluster 47: 200 elements
[INFO] Kmeans Cluster 48: 275 elements
[INFO] Kmeans Cluster 49: 321 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=87.99, Long SMA=134.59, Sharpe=-0.2030
[INFO] Centroid 1: Short SMA=135.14, Long SMA=237.70, Sharpe=-0.0468
[INFO] Centroid 2: Short SMA=67.39, Long SMA=103.85, Sharpe=0.2936
[INFO] Centroid 3: Short SMA=45.97, Long SMA=280.18, Sharpe=0.2585
[INFO] Centroid 4: Short SMA=213.29, Long SMA=232.27, Sharpe=-0.0559
[INFO] Centroid 5: Short SMA=133.62, Long SMA=193.86, Sharpe=-0.1960
[INFO] Centroid 6: Short SMA=26.47, Long SMA=171.20, Sharpe=0.2547
[INFO] Centroid 7: Short SMA=154.14, Long SMA=193.43, Sharpe=0.0744
[INFO] Centroid 8: Short SMA=208.77, Long SMA=251.93, Sharpe=-0.2103
[INFO] Centroid 9: Short SMA=19.20, Long SMA=86.99, Sharpe=0.1257
[INFO] Centroid 10: Short SMA=31.82, Long SMA=59.94, Sharpe=0.4684
[INFO] Centroid 11: Short SMA=59.73, Long SMA=243.07, Sharpe=0.0870
[INFO] Centroid 12: Short SMA=98.35, Long SMA=290.39, Sharpe=-0.1763
[INFO] Centroid 13: Short SMA=134.20, Long SMA=167.35, Sharpe=-0.4735
[INFO] Centroid 14: Short SMA=274.31, Long SMA=290.49, Sharpe=0.0422
[INFO] Centroid 15: Short SMA=32.15, Long SMA=146.25, Sharpe=0.5521
[INFO] Centroid 16: Short SMA=70.71, Long SMA=181.84, Sharpe=-0.2559
[INFO] Centroid 17: Short SMA=63.22, Long SMA=78.63, Sharpe=0.1091
[INFO] Centroid 18: Short SMA=87.57, Long SMA=113.21, Sharpe=-0.0530
[INFO] Centroid 19: Short SMA=101.40, Long SMA=243.97, Sharpe=-0.1680
[INFO] Centroid 20: Short SMA=54.65, Long SMA=169.30, Sharpe=-0.0087
[INFO] Centroid 21: Short SMA=143.35, Long SMA=280.20, Sharpe=-0.1308
[INFO] Centroid 22: Short SMA=27.70, Long SMA=286.66, Sharpe=0.3990
[INFO] Centroid 23: Short SMA=173.04, Long SMA=201.15, Sharpe=-0.0571
[INFO] Centroid 24: Short SMA=32.58, Long SMA=109.34, Sharpe=0.2450
[INFO] Centroid 25: Short SMA=34.88, Long SMA=48.69, Sharpe=0.6813
[INFO] Centroid 26: Short SMA=238.39, Long SMA=275.95, Sharpe=-0.4429
[INFO] Centroid 27: Short SMA=175.26, Long SMA=283.61, Sharpe=0.0326
[INFO] Centroid 28: Short SMA=195.65, Long SMA=217.87, Sharpe=0.1247
[INFO] Centroid 29: Short SMA=58.22, Long SMA=134.76, Sharpe=0.1160
[INFO] Centroid 30: Short SMA=261.64, Long SMA=280.43, Sharpe=-0.1466
[INFO] Centroid 31: Short SMA=25.05, Long SMA=136.23, Sharpe=0.3843
[INFO] Centroid 32: Short SMA=24.70, Long SMA=252.70, Sharpe=0.2028
[INFO] Centroid 33: Short SMA=16.07, Long SMA=28.58, Sharpe=-0.1123
[INFO] Centroid 34: Short SMA=105.13, Long SMA=186.18, Sharpe=-0.4061
[INFO] Centroid 35: Short SMA=177.11, Long SMA=254.05, Sharpe=-0.0664
[INFO] Centroid 36: Short SMA=106.30, Long SMA=141.41, Sharpe=-0.4419
[INFO] Centroid 37: Short SMA=59.98, Long SMA=215.83, Sharpe=-0.1471
[INFO] Centroid 38: Short SMA=126.85, Long SMA=151.25, Sharpe=-0.2531
[INFO] Centroid 39: Short SMA=26.31, Long SMA=191.47, Sharpe=0.3545
[INFO] Centroid 40: Short SMA=23.78, Long SMA=214.02, Sharpe=0.1832
[INFO] Centroid 41: Short SMA=163.63, Long SMA=232.88, Sharpe=-0.1738
[INFO] Centroid 42: Short SMA=18.32, Long SMA=38.66, Sharpe=0.1523
[INFO] Centroid 43: Short SMA=163.52, Long SMA=184.02, Sharpe=0.2521
[INFO] Centroid 44: Short SMA=235.43, Long SMA=275.53, Sharpe=-0.3025
[INFO] Centroid 45: Short SMA=202.53, Long SMA=284.45, Sharpe=-0.1682
[INFO] Centroid 46: Short SMA=68.97, Long SMA=276.89, Sharpe=0.0530
[INFO] Centroid 47: Short SMA=36.99, Long SMA=72.29, Sharpe=0.3033
[INFO] Centroid 48: Short SMA=102.54, Long SMA=272.07, Sharpe=-0.1013
[INFO] Centroid 49: Short SMA=99.05, Long SMA=210.93, Sharpe=-0.3233
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=46, Sharpe=0.9625, Trades=81
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=32, Long SMA=146, Sharpe=0.8063, Trades=20
[INFO] Kmeans Top 2: Short SMA=36, Long SMA=48, Sharpe=0.6032, Trades=83
[INFO] Kmeans Top 3: Short SMA=26, Long SMA=288, Sharpe=0.4214, Trades=14
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=56, Sharpe=0.3805, Trades=49
[INFO] Kmeans Top 5: Short SMA=26, Long SMA=190, Sharpe=0.3446, Trades=22
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (88, 135)
[INFO]   Nearest: (88.0, 134.0)
[INFO]   Rounded: (135, 238)
[INFO]   Nearest: (136.0, 238.0)
[INFO]   Rounded: (67, 104)
[INFO]   Nearest: (68.0, 104.0)
[INFO]   Rounded: (46, 280)
[INFO]   Rounded: (213, 232)
[INFO]   Nearest: (214.0, 232.0)
[INFO]   Rounded: (134, 194)
[INFO]   Rounded: (26, 171)
[INFO]   Nearest: (26.0, 172.0)
[INFO]   Rounded: (154, 193)
[INFO]   Nearest: (154.0, 194.0)
[INFO]   Rounded: (209, 252)
[INFO]   Nearest: (208.0, 252.0)
[INFO]   Rounded: (19, 87)
[INFO]   Nearest: (20.0, 86.0)
[INFO]   Rounded: (32, 60)
[INFO]   Rounded: (60, 243)
[INFO]   Nearest: (60.0, 244.0)
[INFO]   Rounded: (98, 290)
[INFO]   Rounded: (134, 167)
[INFO]   Nearest: (134.0, 168.0)
[INFO]   Rounded: (274, 290)
[INFO]   Rounded: (32, 146)
[INFO]   Rounded: (71, 182)
[INFO]   Nearest: (70.0, 182.0)
[INFO]   Rounded: (63, 79)
[INFO]   Nearest: (64.0, 78.0)
[INFO]   Rounded: (88, 113)
[INFO]   Nearest: (88.0, 114.0)
[INFO]   Rounded: (101, 244)
[INFO]   Nearest: (102.0, 244.0)
[INFO]   Rounded: (55, 169)
[INFO]   Nearest: (54.0, 170.0)
[INFO]   Rounded: (143, 280)
[INFO]   Nearest: (144.0, 280.0)
[INFO]   Rounded: (28, 287)
[INFO]   Nearest: (28.0, 286.0)
[INFO]   Rounded: (173, 201)
[INFO]   Nearest: (174.0, 202.0)
[INFO]   Rounded: (33, 109)
[INFO]   Nearest: (32.0, 110.0)
[INFO]   Rounded: (35, 49)
[INFO]   Nearest: (34.0, 48.0)
[INFO]   Rounded: (238, 276)
[INFO]   Rounded: (175, 284)
[INFO]   Nearest: (176.0, 284.0)
[INFO]   Rounded: (196, 218)
[INFO]   Rounded: (58, 135)
[INFO]   Nearest: (58.0, 134.0)
[INFO]   Rounded: (262, 280)
[INFO]   Rounded: (25, 136)
[INFO]   Nearest: (26.0, 136.0)
[INFO]   Rounded: (25, 253)
[INFO]   Nearest: (24.0, 252.0)
[INFO]   Rounded: (16, 29)
[INFO]   Nearest: (16.0, 28.0)
[INFO]   Rounded: (105, 186)
[INFO]   Nearest: (106.0, 186.0)
[INFO]   Rounded: (177, 254)
[INFO]   Nearest: (178.0, 254.0)
[INFO]   Rounded: (106, 141)
[INFO]   Nearest: (106.0, 142.0)
[INFO]   Rounded: (60, 216)
[INFO]   Rounded: (127, 151)
[INFO]   Nearest: (126.0, 152.0)
[INFO]   Rounded: (26, 191)
[INFO]   Nearest: (26.0, 192.0)
[INFO]   Rounded: (24, 214)
[INFO]   Rounded: (164, 233)
[INFO]   Nearest: (164.0, 232.0)
[INFO]   Rounded: (18, 39)
[INFO]   Nearest: (18.0, 38.0)
[INFO]   Rounded: (164, 184)
[INFO]   Rounded: (235, 276)
[INFO]   Nearest: (236.0, 276.0)
[INFO]   Rounded: (203, 284)
[INFO]   Nearest: (202.0, 284.0)
[INFO]   Rounded: (69, 277)
[INFO]   Nearest: (68.0, 276.0)
[INFO]   Rounded: (37, 72)
[INFO]   Nearest: (36.0, 72.0)
[INFO]   Rounded: (103, 272)
[INFO]   Nearest: (102.0, 272.0)
[INFO]   Rounded: (99, 211)
[INFO]   Nearest: (100.0, 210.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(32/146) - Original Sharpe: 0.8063, Trades: 20
[INFO] Kmeans cluster 2: SMA(36/48) - Original Sharpe: 0.6032, Trades: 83
[INFO] Kmeans cluster 3: SMA(26/288) - Original Sharpe: 0.4214, Trades: 14
[INFO] Kmeans cluster 4: SMA(30/56) - Original Sharpe: 0.3805, Trades: 49
[INFO] Kmeans cluster 5: SMA(26/190) - Original Sharpe: 0.3446, Trades: 22
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (32/146) - Sharpe: 0.8063
[INFO] cluster 2: (36/48) - Sharpe: 0.6032
[INFO] cluster 3: (26/288) - Sharpe: 0.4214
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     4.813792            4.813792
1    2021-11-10 2021-11-10            41    -1.040578           -0.181232
2    2022-01-10 2022-01-10            41    -1.414548            0.240465
3    2022-03-10 2022-03-10            42     3.891271            3.891271
4    2022-05-10 2022-05-10            41    -1.433874           -3.115806
5    2022-07-10 2022-07-10            44    -4.366290           -6.511913
6    2022-09-10 2022-09-10            43    -3.101727           -1.531688
7    2022-11-10 2022-11-10            40     2.171378            0.388156
8    2023-01-10 2023-01-10            41     0.013687            0.085091
9    2023-03-10 2023-03-10            42    -1.173054           -0.098393
10   2023-05-10 2023-05-10            40     0.876456            0.001692
11   2023-07-10 2023-07-10            44    -0.240108           -1.822792
12   2023-09-10 2023-09-10            44     1.293828           -1.819593
13   2023-11-10 2023-11-10            40    -0.460322           -0.625512
14   2024-01-10 2024-01-10            41     3.165454           -0.744174
15   2024-03-10 2024-03-10            43    -1.060941           -4.650580
16   2024-05-10 2024-05-10            40     2.090657            2.090657
17   2024-07-10 2024-07-10            43     1.137725            1.137725
18   2024-09-10 2024-09-10            44    -3.483824           -2.901935
19   2024-11-10 2024-11-10            35     0.406321            2.347072
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -1.0 |             -0.2 |          0.8 | True          
[INFO] 2022-01-10   |         -1.4 |              0.2 |          1.6 | True          
[INFO] 2022-03-10   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.4 |             -3.1 |         -1.7 | False         
[INFO] 2022-07-10   |         -4.4 |             -6.5 |         -2.1 | False         
[INFO] 2022-09-10   |         -3.1 |             -1.5 |          1.6 | True          
[INFO] 2022-11-10   |          2.2 |              0.4 |         -1.8 | False         
[INFO] 2023-01-10   |          0.0 |              0.1 |          0.1 | True          
[INFO] 2023-03-10   |         -1.2 |             -0.1 |          1.1 | True          
[INFO] 2023-05-10   |          0.9 |              0.0 |         -0.9 | False         
[INFO] 2023-07-10   |         -0.2 |             -1.8 |         -1.6 | False         
[INFO] 2023-09-10   |          1.3 |             -1.8 |         -3.1 | False         
[INFO] 2023-11-10   |         -0.5 |             -0.6 |         -0.1 | False         
[INFO] 2024-01-10   |          3.2 |             -0.7 |         -3.9 | False         
[INFO] 2024-03-10   |         -1.1 |             -4.7 |         -3.6 | False         
[INFO] 2024-05-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -3.5 |             -2.9 |          0.6 | True          
[INFO] 2024-11-10   |          0.4 |              2.3 |          1.9 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2022-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 7 of 16 periods (43.75% win rate)
[INFO] Updating Excel file with Kmeans results for CT...
[INFO] Excel file updated successfully. Added CT with Kmeans win rate 43.8% in row 11
[INFO] Added best Sharpe parameters 34/46 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 46
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(32/146) - Original Sharpe: 0.8063
[INFO] Added cluster 2 to portfolio: SMA(36/48) - Original Sharpe: 0.6032
[INFO] Added cluster 3 to portfolio: SMA(26/288) - Original Sharpe: 0.4214
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CT_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0067
[INFO] Kmeans Best out-of-sample Sharpe: 0.2334
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for CT...
[INFO] Excel file updated successfully. Added CT with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CT
[INFO] Big Point Value: 500.0
[INFO] Slippage: 16.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6979 to 0.9625
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.962456
[INFO] Number of Trades: 81
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6979 to 0.9625
[INFO] Trades range: 10.0 to 339.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6852 to 3.9097
[INFO] Scaled Trades range: -0.7533 to 16.0364
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5572
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 565 elements
[INFO] Cluster 1: 417 elements
[INFO] Cluster 2: 143 elements
[INFO] Cluster 3: 204 elements
[INFO] Cluster 4: 496 elements
[INFO] Cluster 5: 236 elements
[INFO] Cluster 6: 603 elements
[INFO] Cluster 7: 241 elements
[INFO] Cluster 8: 141 elements
[INFO] Cluster 9: 34 elements
[INFO] Cluster 10: 556 elements
[INFO] Cluster 11: 315 elements
[INFO] Cluster 12: 378 elements
[INFO] Cluster 13: 96 elements
[INFO] Cluster 14: 237 elements
[INFO] Cluster 15: 480 elements
[INFO] Cluster 16: 251 elements
[INFO] Cluster 17: 88 elements
[INFO] Cluster 18: 6 elements
[INFO] Cluster 19: 281 elements
[INFO] Cluster 20: 261 elements
[INFO] Cluster 21: 230 elements
[INFO] Cluster 22: 179 elements
[INFO] Cluster 23: 252 elements
[INFO] Cluster 24: 31 elements
[INFO] Cluster 25: 106 elements
[INFO] Cluster 26: 228 elements
[INFO] Cluster 27: 63 elements
[INFO] Cluster 28: 359 elements
[INFO] Cluster 29: 338 elements
[INFO] Cluster 30: 44 elements
[INFO] Cluster 31: 343 elements
[INFO] Cluster 32: 66 elements
[INFO] Cluster 33: 14 elements
[INFO] Cluster 34: 326 elements
[INFO] Cluster 35: 174 elements
[INFO] Cluster 36: 166 elements
[INFO] Cluster 37: 114 elements
[INFO] Cluster 38: 106 elements
[INFO] Cluster 39: 278 elements
[INFO] Cluster 40: 24 elements
[INFO] Cluster 41: 31 elements
[INFO] Cluster 42: 245 elements
[INFO] Cluster 43: 39 elements
[INFO] Cluster 44: 118 elements
[INFO] Cluster 45: 271 elements
[INFO] Cluster 46: 123 elements
[INFO] Cluster 47: 205 elements
[INFO] Cluster 48: 59 elements
[INFO] Cluster 49: 24 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=110, Long SMA=160, Sharpe=-0.3858, Trades=20
[INFO] Cluster 1 cluster: Short SMA=20, Long SMA=238, Sharpe=0.1752, Trades=24
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=54, Sharpe=0.5346, Trades=55
[INFO] Cluster 3 cluster: Short SMA=126, Long SMA=158, Sharpe=-0.2617, Trades=22
[INFO] Cluster 4 cluster: Short SMA=202, Long SMA=264, Sharpe=-0.1898, Trades=18
[INFO] Cluster 5 cluster: Short SMA=18, Long SMA=82, Sharpe=0.1345, Trades=46
[INFO] Cluster 6 cluster: Short SMA=136, Long SMA=278, Sharpe=-0.1557, Trades=12
[INFO] Cluster 7 cluster: Short SMA=54, Long SMA=158, Sharpe=0.0841, Trades=16
[INFO] Cluster 8 cluster: Short SMA=166, Long SMA=188, Sharpe=0.1141, Trades=34
[INFO] Cluster 9 cluster: Short SMA=26, Long SMA=30, Sharpe=0.1042, Trades=140
[INFO] Cluster 10 cluster: Short SMA=48, Long SMA=100, Sharpe=0.2755, Trades=32
[INFO] Cluster 11 cluster: Short SMA=178, Long SMA=278, Sharpe=0.0840, Trades=10
[INFO] Cluster 12 cluster: Short SMA=26, Long SMA=182, Sharpe=0.3874, Trades=20
[INFO] Cluster 13 cluster: Short SMA=132, Long SMA=138, Sharpe=-0.2471, Trades=46
[INFO] Cluster 14 cluster: Short SMA=52, Long SMA=224, Sharpe=-0.1211, Trades=16
[INFO] Cluster 15 cluster: Short SMA=104, Long SMA=202, Sharpe=-0.4130, Trades=16
[INFO] Cluster 16 cluster: Short SMA=88, Long SMA=124, Sharpe=-0.1556, Trades=25
[INFO] Cluster 17 cluster: Short SMA=276, Long SMA=284, Sharpe=0.0915, Trades=54
[INFO] Cluster 19 cluster: Short SMA=134, Long SMA=230, Sharpe=-0.0117, Trades=12
[INFO] Cluster 20 cluster: Short SMA=234, Long SMA=284, Sharpe=-0.4889, Trades=18
[INFO] Cluster 21 cluster: Short SMA=240, Long SMA=268, Sharpe=-0.2752, Trades=22
[INFO] Cluster 22 cluster: Short SMA=198, Long SMA=228, Sharpe=-0.0760, Trades=22
[INFO] Cluster 23 cluster: Short SMA=158, Long SMA=246, Sharpe=-0.1415, Trades=12
[INFO] Cluster 24 cluster: Short SMA=264, Long SMA=266, Sharpe=-0.1655, Trades=94
[INFO] Cluster 25 cluster: Short SMA=48, Long SMA=58, Sharpe=0.1460, Trades=76
[INFO] Cluster 26 cluster: Short SMA=22, Long SMA=136, Sharpe=0.4058, Trades=26
[INFO] Cluster 27 cluster: Short SMA=186, Long SMA=190, Sharpe=-0.0681, Trades=66
[INFO] Cluster 28 cluster: Short SMA=46, Long SMA=264, Sharpe=0.1201, Trades=16
[INFO] Cluster 29 cluster: Short SMA=66, Long SMA=206, Sharpe=-0.2540, Trades=16
[INFO] Cluster 30 cluster: Short SMA=198, Long SMA=200, Sharpe=0.2267, Trades=90
[INFO] Cluster 31 cluster: Short SMA=94, Long SMA=284, Sharpe=-0.1501, Trades=14
[INFO] Cluster 32 cluster: Short SMA=20, Long SMA=34, Sharpe=0.1037, Trades=97
[INFO] Cluster 34 cluster: Short SMA=70, Long SMA=260, Sharpe=0.0622, Trades=14
[INFO] Cluster 35 cluster: Short SMA=152, Long SMA=202, Sharpe=0.1428, Trades=16
[INFO] Cluster 36 cluster: Short SMA=58, Long SMA=122, Sharpe=0.1737, Trades=28
[INFO] Cluster 37 cluster: Short SMA=74, Long SMA=86, Sharpe=0.0215, Trades=49
[INFO] Cluster 38 cluster: Short SMA=268, Long SMA=292, Sharpe=-0.0478, Trades=32
[INFO] Cluster 39 cluster: Short SMA=100, Long SMA=244, Sharpe=-0.1381, Trades=14
[INFO] Cluster 40 cluster: Short SMA=46, Long SMA=50, Sharpe=0.2951, Trades=112
[INFO] Cluster 41 cluster: Short SMA=128, Long SMA=130, Sharpe=-0.0129, Trades=80
[INFO] Cluster 42 cluster: Short SMA=28, Long SMA=286, Sharpe=0.4472, Trades=14
[INFO] Cluster 43 cluster: Short SMA=250, Long SMA=256, Sharpe=-0.4934, Trades=61
[INFO] Cluster 44 cluster: Short SMA=172, Long SMA=190, Sharpe=-0.0860, Trades=36
[INFO] Cluster 45 cluster: Short SMA=76, Long SMA=170, Sharpe=-0.3031, Trades=16
[INFO] Cluster 46 cluster: Short SMA=34, Long SMA=146, Sharpe=0.5774, Trades=22
[INFO] Cluster 47 cluster: Short SMA=172, Long SMA=218, Sharpe=-0.0974, Trades=18
[INFO] Cluster 48 cluster: Short SMA=220, Long SMA=228, Sharpe=-0.0897, Trades=45
[INFO] Cluster 49 cluster: Short SMA=38, Long SMA=46, Sharpe=0.6996, Trades=93
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=46, Sharpe=0.9625, Trades=81
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=46, Sharpe=0.6996, Trades=93
[INFO] Top 2: Short SMA=34, Long SMA=146, Sharpe=0.5774, Trades=22
[INFO] Top 3: Short SMA=32, Long SMA=54, Sharpe=0.5346, Trades=55
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10565 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/46) - Original Sharpe: 0.6996, Trades: 93
[INFO] Hierarchical cluster 2: SMA(34/146) - Original Sharpe: 0.5774, Trades: 22
[INFO] Hierarchical cluster 3: SMA(32/54) - Original Sharpe: 0.5346, Trades: 55
[INFO] Hierarchical cluster 4: SMA(28/286) - Original Sharpe: 0.4472, Trades: 14
[INFO] Hierarchical cluster 5: SMA(22/136) - Original Sharpe: 0.4058, Trades: 26
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/46) - Sharpe: 0.6996
[INFO] cluster 2: (34/146) - Sharpe: 0.5774
[INFO] cluster 3: (32/54) - Sharpe: 0.5346
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     4.813792            4.813792
1    2021-11-10 2021-11-10            41    -1.040578           -0.508406
2    2022-01-10 2022-01-10            41    -1.414548           -0.941785
3    2022-03-10 2022-03-10            42     3.891271            3.891271
4    2022-05-10 2022-05-10            41    -1.433874           -3.280444
5    2022-07-10 2022-07-10            44    -4.366290           -5.695941
6    2022-09-10 2022-09-10            43    -3.101727           -1.648852
7    2022-11-10 2022-11-10            40     2.171378            1.584969
8    2023-01-10 2023-01-10            41     0.013687           -3.149596
9    2023-03-10 2023-03-10            42    -1.173054           -0.104846
10   2023-05-10 2023-05-10            40     0.876456            0.988355
11   2023-07-10 2023-07-10            44    -0.240108           -0.975262
12   2023-09-10 2023-09-10            44     1.293828           -0.101590
13   2023-11-10 2023-11-10            40    -0.460322           -0.293809
14   2024-01-10 2024-01-10            41     3.165454            1.692757
15   2024-03-10 2024-03-10            43    -1.060941           -4.192162
16   2024-05-10 2024-05-10            40     2.090657            2.090657
17   2024-07-10 2024-07-10            43     1.137725            1.137725
18   2024-09-10 2024-09-10            44    -3.483824           -3.761869
19   2024-11-10 2024-11-10            35     0.406321            1.225750
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -1.0 |             -0.5 |          0.5 | True          
[INFO] 2022-01-10   |         -1.4 |             -0.9 |          0.5 | True          
[INFO] 2022-03-10   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.4 |             -3.3 |         -1.9 | False         
[INFO] 2022-07-10   |         -4.4 |             -5.7 |         -1.3 | False         
[INFO] 2022-09-10   |         -3.1 |             -1.6 |          1.5 | True          
[INFO] 2022-11-10   |          2.2 |              1.6 |         -0.6 | False         
[INFO] 2023-01-10   |          0.0 |             -3.1 |         -3.1 | False         
[INFO] 2023-03-10   |         -1.2 |             -0.1 |          1.1 | True          
[INFO] 2023-05-10   |          0.9 |              1.0 |          0.1 | True          
[INFO] 2023-07-10   |         -0.2 |             -1.0 |         -0.8 | False         
[INFO] 2023-09-10   |          1.3 |             -0.1 |         -1.4 | False         
[INFO] 2023-11-10   |         -0.5 |             -0.3 |          0.2 | True          
[INFO] 2024-01-10   |          3.2 |              1.7 |         -1.5 | False         
[INFO] 2024-03-10   |         -1.1 |             -4.2 |         -3.1 | False         
[INFO] 2024-05-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -3.5 |             -3.8 |         -0.3 | False         
[INFO] 2024-11-10   |          0.4 |              1.2 |          0.8 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2022-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 16 periods (43.75% win rate)
[INFO] Updating Excel file with Hierarchical results for CT...
[INFO] Excel file updated successfully. Added CT with Hierarchical win rate 43.8% in row 11
[INFO] Added best Sharpe parameters 34/46 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 46
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/46) - Original Sharpe: 0.6996
[INFO] Added cluster 2 to portfolio: SMA(34/146) - Original Sharpe: 0.5774
[INFO] Added cluster 3 to portfolio: SMA(32/54) - Original Sharpe: 0.5346
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CT_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0475
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2334
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for CT...
[INFO] Excel file updated successfully. Added CT with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CT
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for DX in column D: 9.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 157.35s
[INFO] Best parameters: Short SMA = 38, Long SMA = 46
[INFO] Best Sharpe ratio: 0.858167, Trades: 78
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @DX
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 11.44 contracts
[INFO] Maximum Position Size: 27 contracts
[INFO] Strategy Total P&L: $299,542.00
[INFO] Market Buy & Hold P&L: $34,961.00
[INFO] Outperformance: $264,581.00
[INFO] Sharpe ratio (entire period, annualized): 0.447473
[INFO] Sharpe ratio (in-sample, annualized): 0.858167
[INFO] Sharpe ratio (out-of-sample, annualized): -0.499666
[INFO] Maximum Drawdown: $282,207.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 58
[INFO] Out-of-sample period trades: 20
[INFO] Total trades: 78
[INFO] In-sample P&L: $454,390.00
[INFO] Out-of-sample P&L: $-114,613.00
[INFO] 
Best parameters from GA: Short SMA = 38, Long SMA = 46, Sharpe = 0.858167
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7443 to 0.8582
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.858167
[INFO] Number of Trades: 78
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10189 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7443 to 0.8582
[INFO] Trades range: 10.0 to 340.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3620 to 2.7774
[INFO] Scaled Long SMA range: -2.7580 to 1.4307
[INFO] Scaled Sharpe ratio range: -2.5342 to 2.5444
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 237 elements
[INFO] Kmeans Cluster 1: 312 elements
[INFO] Kmeans Cluster 2: 154 elements
[INFO] Kmeans Cluster 3: 176 elements
[INFO] Kmeans Cluster 4: 126 elements
[INFO] Kmeans Cluster 5: 154 elements
[INFO] Kmeans Cluster 6: 153 elements
[INFO] Kmeans Cluster 7: 168 elements
[INFO] Kmeans Cluster 8: 232 elements
[INFO] Kmeans Cluster 9: 152 elements
[INFO] Kmeans Cluster 10: 180 elements
[INFO] Kmeans Cluster 11: 251 elements
[INFO] Kmeans Cluster 12: 99 elements
[INFO] Kmeans Cluster 13: 125 elements
[INFO] Kmeans Cluster 14: 232 elements
[INFO] Kmeans Cluster 15: 200 elements
[INFO] Kmeans Cluster 16: 203 elements
[INFO] Kmeans Cluster 17: 279 elements
[INFO] Kmeans Cluster 18: 246 elements
[INFO] Kmeans Cluster 19: 138 elements
[INFO] Kmeans Cluster 20: 198 elements
[INFO] Kmeans Cluster 21: 255 elements
[INFO] Kmeans Cluster 22: 287 elements
[INFO] Kmeans Cluster 23: 237 elements
[INFO] Kmeans Cluster 24: 255 elements
[INFO] Kmeans Cluster 25: 251 elements
[INFO] Kmeans Cluster 26: 126 elements
[INFO] Kmeans Cluster 27: 168 elements
[INFO] Kmeans Cluster 28: 167 elements
[INFO] Kmeans Cluster 29: 198 elements
[INFO] Kmeans Cluster 30: 99 elements
[INFO] Kmeans Cluster 31: 282 elements
[INFO] Kmeans Cluster 32: 290 elements
[INFO] Kmeans Cluster 33: 148 elements
[INFO] Kmeans Cluster 34: 262 elements
[INFO] Kmeans Cluster 35: 266 elements
[INFO] Kmeans Cluster 36: 356 elements
[INFO] Kmeans Cluster 37: 176 elements
[INFO] Kmeans Cluster 38: 217 elements
[INFO] Kmeans Cluster 39: 177 elements
[INFO] Kmeans Cluster 40: 327 elements
[INFO] Kmeans Cluster 41: 255 elements
[INFO] Kmeans Cluster 42: 191 elements
[INFO] Kmeans Cluster 43: 270 elements
[INFO] Kmeans Cluster 44: 25 elements
[INFO] Kmeans Cluster 45: 253 elements
[INFO] Kmeans Cluster 46: 117 elements
[INFO] Kmeans Cluster 47: 223 elements
[INFO] Kmeans Cluster 48: 202 elements
[INFO] Kmeans Cluster 49: 94 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=160.41, Long SMA=284.68, Sharpe=-0.4637
[INFO] Centroid 1: Short SMA=56.99, Long SMA=217.21, Sharpe=0.2680
[INFO] Centroid 2: Short SMA=34.56, Long SMA=57.61, Sharpe=0.4318
[INFO] Centroid 3: Short SMA=152.73, Long SMA=180.35, Sharpe=-0.2630
[INFO] Centroid 4: Short SMA=213.35, Long SMA=232.44, Sharpe=0.0280
[INFO] Centroid 5: Short SMA=66.12, Long SMA=84.32, Sharpe=0.0587
[INFO] Centroid 6: Short SMA=23.40, Long SMA=199.93, Sharpe=0.4778
[INFO] Centroid 7: Short SMA=83.89, Long SMA=283.78, Sharpe=-0.1522
[INFO] Centroid 8: Short SMA=93.97, Long SMA=117.97, Sharpe=0.4543
[INFO] Centroid 9: Short SMA=274.29, Long SMA=288.59, Sharpe=-0.2402
[INFO] Centroid 10: Short SMA=193.02, Long SMA=230.22, Sharpe=-0.4009
[INFO] Centroid 11: Short SMA=111.89, Long SMA=211.32, Sharpe=-0.1600
[INFO] Centroid 12: Short SMA=52.81, Long SMA=278.26, Sharpe=0.2421
[INFO] Centroid 13: Short SMA=15.50, Long SMA=151.57, Sharpe=0.2821
[INFO] Centroid 14: Short SMA=83.63, Long SMA=241.06, Sharpe=0.0602
[INFO] Centroid 15: Short SMA=134.23, Long SMA=230.41, Sharpe=-0.3002
[INFO] Centroid 16: Short SMA=209.52, Long SMA=245.63, Sharpe=-0.1844
[INFO] Centroid 17: Short SMA=115.11, Long SMA=178.65, Sharpe=-0.0580
[INFO] Centroid 18: Short SMA=68.74, Long SMA=275.32, Sharpe=0.0076
[INFO] Centroid 19: Short SMA=16.68, Long SMA=41.57, Sharpe=0.0993
[INFO] Centroid 20: Short SMA=180.69, Long SMA=195.57, Sharpe=-0.0826
[INFO] Centroid 21: Short SMA=33.25, Long SMA=157.73, Sharpe=0.4444
[INFO] Centroid 22: Short SMA=28.61, Long SMA=284.06, Sharpe=0.4465
[INFO] Centroid 23: Short SMA=173.86, Long SMA=258.72, Sharpe=-0.3336
[INFO] Centroid 24: Short SMA=146.94, Long SMA=204.62, Sharpe=-0.4025
[INFO] Centroid 25: Short SMA=28.50, Long SMA=119.63, Sharpe=0.3164
[INFO] Centroid 26: Short SMA=93.62, Long SMA=118.52, Sharpe=0.6152
[INFO] Centroid 27: Short SMA=80.25, Long SMA=146.32, Sharpe=0.3491
[INFO] Centroid 28: Short SMA=19.83, Long SMA=228.76, Sharpe=0.3880
[INFO] Centroid 29: Short SMA=88.99, Long SMA=175.05, Sharpe=0.1539
[INFO] Centroid 30: Short SMA=32.69, Long SMA=54.32, Sharpe=0.6661
[INFO] Centroid 31: Short SMA=110.60, Long SMA=286.32, Sharpe=-0.3357
[INFO] Centroid 32: Short SMA=131.68, Long SMA=155.83, Sharpe=-0.0331
[INFO] Centroid 33: Short SMA=63.14, Long SMA=152.92, Sharpe=0.5142
[INFO] Centroid 34: Short SMA=222.79, Long SMA=281.55, Sharpe=-0.3142
[INFO] Centroid 35: Short SMA=193.83, Long SMA=284.56, Sharpe=-0.3904
[INFO] Centroid 36: Short SMA=60.90, Long SMA=115.96, Sharpe=0.2128
[INFO] Centroid 37: Short SMA=29.53, Long SMA=192.72, Sharpe=0.3598
[INFO] Centroid 38: Short SMA=85.39, Long SMA=206.79, Sharpe=0.0883
[INFO] Centroid 39: Short SMA=22.31, Long SMA=257.31, Sharpe=0.5636
[INFO] Centroid 40: Short SMA=37.30, Long SMA=83.09, Sharpe=0.2378
[INFO] Centroid 41: Short SMA=58.48, Long SMA=178.52, Sharpe=0.3356
[INFO] Centroid 42: Short SMA=107.66, Long SMA=253.05, Sharpe=-0.2730
[INFO] Centroid 43: Short SMA=170.47, Long SMA=223.06, Sharpe=-0.2044
[INFO] Centroid 44: Short SMA=14.56, Long SMA=22.24, Sharpe=-0.2173
[INFO] Centroid 45: Short SMA=46.00, Long SMA=247.33, Sharpe=0.4464
[INFO] Centroid 46: Short SMA=115.91, Long SMA=136.14, Sharpe=0.2163
[INFO] Centroid 47: Short SMA=240.23, Long SMA=259.66, Sharpe=-0.2365
[INFO] Centroid 48: Short SMA=253.72, Long SMA=286.62, Sharpe=-0.1230
[INFO] Centroid 49: Short SMA=13.13, Long SMA=96.45, Sharpe=0.0241
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=46, Sharpe=0.8582, Trades=78
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=32, Long SMA=54, Sharpe=0.7377, Trades=50
[INFO] Kmeans Top 2: Short SMA=64, Long SMA=152, Sharpe=0.6060, Trades=19
[INFO] Kmeans Top 3: Short SMA=22, Long SMA=258, Sharpe=0.5819, Trades=13
[INFO] Kmeans Top 4: Short SMA=92, Long SMA=116, Sharpe=0.5371, Trades=27
[INFO] Kmeans Top 5: Short SMA=46, Long SMA=248, Sharpe=0.5318, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (160, 285)
[INFO]   Nearest: (160.0, 284.0)
[INFO]   Rounded: (57, 217)
[INFO]   Nearest: (56.0, 218.0)
[INFO]   Rounded: (35, 58)
[INFO]   Nearest: (34.0, 58.0)
[INFO]   Rounded: (153, 180)
[INFO]   Nearest: (152.0, 180.0)
[INFO]   Rounded: (213, 232)
[INFO]   Nearest: (214.0, 232.0)
[INFO]   Rounded: (66, 84)
[INFO]   Rounded: (23, 200)
[INFO]   Nearest: (24.0, 200.0)
[INFO]   Rounded: (84, 284)
[INFO]   Rounded: (94, 118)
[INFO]   Rounded: (274, 289)
[INFO]   Nearest: (274.0, 288.0)
[INFO]   Rounded: (193, 230)
[INFO]   Nearest: (194.0, 230.0)
[INFO]   Rounded: (112, 211)
[INFO]   Nearest: (112.0, 212.0)
[INFO]   Rounded: (53, 278)
[INFO]   Nearest: (52.0, 278.0)
[INFO]   Rounded: (16, 152)
[INFO]   Rounded: (84, 241)
[INFO]   Nearest: (84.0, 242.0)
[INFO]   Rounded: (134, 230)
[INFO]   Rounded: (210, 246)
[INFO]   Rounded: (115, 179)
[INFO]   Nearest: (116.0, 178.0)
[INFO]   Rounded: (69, 275)
[INFO]   Nearest: (68.0, 276.0)
[INFO]   Rounded: (17, 42)
[INFO]   Nearest: (16.0, 42.0)
[INFO]   Rounded: (181, 196)
[INFO]   Nearest: (180.0, 196.0)
[INFO]   Rounded: (33, 158)
[INFO]   Nearest: (34.0, 158.0)
[INFO]   Rounded: (29, 284)
[INFO]   Nearest: (28.0, 284.0)
[INFO]   Rounded: (174, 259)
[INFO]   Nearest: (174.0, 258.0)
[INFO]   Rounded: (147, 205)
[INFO]   Nearest: (146.0, 204.0)
[INFO]   Rounded: (29, 120)
[INFO]   Nearest: (28.0, 120.0)
[INFO]   Rounded: (94, 119)
[INFO]   Nearest: (94.0, 118.0)
[INFO]   Rounded: (80, 146)
[INFO]   Rounded: (20, 229)
[INFO]   Nearest: (20.0, 228.0)
[INFO]   Rounded: (89, 175)
[INFO]   Nearest: (88.0, 176.0)
[INFO]   Rounded: (33, 54)
[INFO]   Nearest: (32.0, 54.0)
[INFO]   Rounded: (111, 286)
[INFO]   Nearest: (110.0, 286.0)
[INFO]   Rounded: (132, 156)
[INFO]   Rounded: (63, 153)
[INFO]   Nearest: (64.0, 152.0)
[INFO]   Rounded: (223, 282)
[INFO]   Nearest: (222.0, 282.0)
[INFO]   Rounded: (194, 285)
[INFO]   Nearest: (194.0, 284.0)
[INFO]   Rounded: (61, 116)
[INFO]   Nearest: (60.0, 116.0)
[INFO]   Rounded: (30, 193)
[INFO]   Nearest: (30.0, 192.0)
[INFO]   Rounded: (85, 207)
[INFO]   Nearest: (86.0, 206.0)
[INFO]   Rounded: (22, 257)
[INFO]   Nearest: (22.0, 258.0)
[INFO]   Rounded: (37, 83)
[INFO]   Nearest: (38.0, 84.0)
[INFO]   Rounded: (58, 179)
[INFO]   Nearest: (58.0, 178.0)
[INFO]   Rounded: (108, 253)
[INFO]   Nearest: (108.0, 254.0)
[INFO]   Rounded: (170, 223)
[INFO]   Nearest: (170.0, 224.0)
[INFO]   Rounded: (15, 22)
[INFO]   Nearest: (14.0, 22.0)
[INFO]   Rounded: (46, 247)
[INFO]   Nearest: (46.0, 248.0)
[INFO]   Rounded: (116, 136)
[INFO]   Rounded: (240, 260)
[INFO]   Rounded: (254, 287)
[INFO]   Nearest: (254.0, 286.0)
[INFO]   Rounded: (13, 96)
[INFO]   Nearest: (14.0, 96.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(32/54) - Original Sharpe: 0.7377, Trades: 50
[INFO] Kmeans cluster 2: SMA(64/152) - Original Sharpe: 0.6060, Trades: 19
[INFO] Kmeans cluster 3: SMA(22/258) - Original Sharpe: 0.5819, Trades: 13
[INFO] Kmeans cluster 4: SMA(92/116) - Original Sharpe: 0.5371, Trades: 27
[INFO] Kmeans cluster 5: SMA(46/248) - Original Sharpe: 0.5318, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2816
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (32/54) - Sharpe: 0.7377
[INFO] cluster 2: (64/152) - Sharpe: 0.6060
[INFO] cluster 3: (22/258) - Sharpe: 0.5819
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Out-of-sample period starts on: 2021-09-24
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-24 2021-09-24            43     3.830825            3.830825
1    2021-11-24 2021-11-24            42    -0.750030           -0.975845
2    2022-01-24 2022-01-24            43    -1.158438            2.908511
3    2022-03-24 2022-03-24            42     2.899845            2.899845
4    2022-05-24 2022-05-24            44    -0.772793            3.060061
5    2022-07-24 2022-07-24            45     4.284626            3.795241
6    2022-09-24 2022-09-24            43    -1.964998           -2.488069
7    2022-11-24 2022-11-24            41     2.719154           -0.334743
8    2023-01-24 2023-01-24            43    -4.933460           -2.259249
9    2023-03-24 2023-03-24            43    -4.230774           -2.841267
10   2023-05-24 2023-05-24            43    -5.713874           -0.807369
11   2023-07-24 2023-07-24            45    -1.713757           -2.848788
12   2023-09-24 2023-09-24            44    -0.948650           -1.107919
13   2023-11-24 2023-11-24            41    -0.015249           -4.842828
14   2024-01-24 2024-01-24            43    -1.669992            0.138047
15   2024-03-24 2024-03-24            43    -3.457983           -0.173413
16   2024-05-24 2024-05-24            43    -0.337335           -0.526494
17   2024-07-24 2024-07-24            44     0.689877           -1.629529
18   2024-09-24 2024-09-24            44     0.685285           -2.907787
19   2024-11-24 2024-11-24            26     1.390507            3.116659
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-24   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2021-11-24   |         -0.8 |             -1.0 |         -0.2 | False         
[INFO] 2022-01-24   |         -1.2 |              2.9 |          4.1 | True          
[INFO] 2022-03-24   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-05-24   |         -0.8 |              3.1 |          3.9 | True          
[INFO] 2022-07-24   |          4.3 |              3.8 |         -0.5 | False         
[INFO] 2022-09-24   |         -2.0 |             -2.5 |         -0.5 | False         
[INFO] 2022-11-24   |          2.7 |             -0.3 |         -3.0 | False         
[INFO] 2023-01-24   |         -4.9 |             -2.3 |          2.6 | True          
[INFO] 2023-03-24   |         -4.2 |             -2.8 |          1.4 | True          
[INFO] 2023-05-24   |         -5.7 |             -0.8 |          4.9 | True          
[INFO] 2023-07-24   |         -1.7 |             -2.8 |         -1.1 | False         
[INFO] 2023-09-24   |         -0.9 |             -1.1 |         -0.2 | False         
[INFO] 2023-11-24   |         -0.0 |             -4.8 |         -4.8 | False         
[INFO] 2024-01-24   |         -1.7 |              0.1 |          1.8 | True          
[INFO] 2024-03-24   |         -3.5 |             -0.2 |          3.3 | True          
[INFO] 2024-05-24   |         -0.3 |             -0.5 |         -0.2 | False         
[INFO] 2024-07-24   |          0.7 |             -1.6 |         -2.3 | False         
[INFO] 2024-09-24   |          0.7 |             -2.9 |         -3.6 | False         
[INFO] 2024-11-24   |          1.4 |              3.1 |          1.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-24, 2022-03-24
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 8 of 18 periods (44.44% win rate)
[INFO] Updating Excel file with Kmeans results for DX...
[INFO] Excel file updated successfully. Added DX with Kmeans win rate 44.4% in row 12
[INFO] Added best Sharpe parameters 38/46 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 46
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(32/54) - Original Sharpe: 0.7377
[INFO] Added cluster 2 to portfolio: SMA(64/152) - Original Sharpe: 0.6060
[INFO] Added cluster 3 to portfolio: SMA(22/258) - Original Sharpe: 0.5819
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'DX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1265
[INFO] Kmeans Best out-of-sample Sharpe: -0.4997
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for DX...
[INFO] Excel file updated successfully. Added DX with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\DX
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7443 to 0.8582
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.858167
[INFO] Number of Trades: 78
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10189 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7443 to 0.8582
[INFO] Trades range: 10.0 to 340.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3620 to 2.7774
[INFO] Scaled Long SMA range: -2.7580 to 1.4307
[INFO] Scaled Sharpe ratio range: -2.5342 to 2.5444
[INFO] Scaled Trades range: -0.6914 to 16.4374
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10189 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5345
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 184 elements
[INFO] Cluster 1: 369 elements
[INFO] Cluster 2: 330 elements
[INFO] Cluster 3: 81 elements
[INFO] Cluster 4: 48 elements
[INFO] Cluster 5: 21 elements
[INFO] Cluster 6: 310 elements
[INFO] Cluster 7: 479 elements
[INFO] Cluster 8: 299 elements
[INFO] Cluster 9: 91 elements
[INFO] Cluster 10: 109 elements
[INFO] Cluster 11: 156 elements
[INFO] Cluster 12: 312 elements
[INFO] Cluster 13: 48 elements
[INFO] Cluster 14: 298 elements
[INFO] Cluster 15: 375 elements
[INFO] Cluster 16: 339 elements
[INFO] Cluster 17: 228 elements
[INFO] Cluster 18: 100 elements
[INFO] Cluster 19: 227 elements
[INFO] Cluster 20: 370 elements
[INFO] Cluster 21: 384 elements
[INFO] Cluster 22: 316 elements
[INFO] Cluster 23: 297 elements
[INFO] Cluster 24: 354 elements
[INFO] Cluster 25: 321 elements
[INFO] Cluster 26: 135 elements
[INFO] Cluster 27: 287 elements
[INFO] Cluster 28: 246 elements
[INFO] Cluster 29: 11 elements
[INFO] Cluster 30: 38 elements
[INFO] Cluster 31: 211 elements
[INFO] Cluster 32: 108 elements
[INFO] Cluster 33: 4 elements
[INFO] Cluster 34: 40 elements
[INFO] Cluster 35: 45 elements
[INFO] Cluster 36: 254 elements
[INFO] Cluster 37: 82 elements
[INFO] Cluster 38: 53 elements
[INFO] Cluster 39: 169 elements
[INFO] Cluster 40: 162 elements
[INFO] Cluster 41: 205 elements
[INFO] Cluster 42: 124 elements
[INFO] Cluster 43: 382 elements
[INFO] Cluster 44: 207 elements
[INFO] Cluster 45: 357 elements
[INFO] Cluster 46: 148 elements
[INFO] Cluster 47: 329 elements
[INFO] Cluster 48: 65 elements
[INFO] Cluster 49: 81 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=32, Long SMA=62, Sharpe=0.6664, Trades=48
[INFO] Cluster 1 cluster: Short SMA=68, Long SMA=278, Sharpe=0.0002, Trades=11
[INFO] Cluster 2 cluster: Short SMA=190, Long SMA=236, Sharpe=-0.4990, Trades=19
[INFO] Cluster 3 cluster: Short SMA=258, Long SMA=262, Sharpe=-0.2417, Trades=55
[INFO] Cluster 4 cluster: Short SMA=32, Long SMA=38, Sharpe=0.2864, Trades=101
[INFO] Cluster 5 cluster: Short SMA=34, Long SMA=36, Sharpe=0.3559, Trades=173
[INFO] Cluster 6 cluster: Short SMA=42, Long SMA=84, Sharpe=0.2915, Trades=37
[INFO] Cluster 7 cluster: Short SMA=112, Long SMA=184, Sharpe=-0.0415, Trades=14
[INFO] Cluster 8 cluster: Short SMA=72, Long SMA=156, Sharpe=0.5084, Trades=15
[INFO] Cluster 9 cluster: Short SMA=64, Long SMA=74, Sharpe=0.0907, Trades=63
[INFO] Cluster 10 cluster: Short SMA=14, Long SMA=50, Sharpe=0.0652, Trades=67
[INFO] Cluster 11 cluster: Short SMA=14, Long SMA=212, Sharpe=0.3527, Trades=23
[INFO] Cluster 12 cluster: Short SMA=116, Long SMA=224, Sharpe=-0.3028, Trades=12
[INFO] Cluster 13 cluster: Short SMA=110, Long SMA=114, Sharpe=0.4147, Trades=52
[INFO] Cluster 14 cluster: Short SMA=34, Long SMA=152, Sharpe=0.3887, Trades=25
[INFO] Cluster 15 cluster: Short SMA=58, Long SMA=118, Sharpe=0.1921, Trades=25
[INFO] Cluster 16 cluster: Short SMA=146, Long SMA=216, Sharpe=-0.3949, Trades=15
[INFO] Cluster 17 cluster: Short SMA=28, Long SMA=288, Sharpe=0.4546, Trades=15
[INFO] Cluster 18 cluster: Short SMA=12, Long SMA=94, Sharpe=0.0380, Trades=47
[INFO] Cluster 19 cluster: Short SMA=194, Long SMA=286, Sharpe=-0.4110, Trades=15
[INFO] Cluster 20 cluster: Short SMA=44, Long SMA=250, Sharpe=0.5251, Trades=13
[INFO] Cluster 21 cluster: Short SMA=256, Long SMA=284, Sharpe=-0.1933, Trades=21
[INFO] Cluster 22 cluster: Short SMA=24, Long SMA=126, Sharpe=0.3643, Trades=31
[INFO] Cluster 23 cluster: Short SMA=28, Long SMA=198, Sharpe=0.3799, Trades=17
[INFO] Cluster 24 cluster: Short SMA=84, Long SMA=230, Sharpe=0.1593, Trades=13
[INFO] Cluster 25 cluster: Short SMA=224, Long SMA=280, Sharpe=-0.3848, Trades=19
[INFO] Cluster 26 cluster: Short SMA=160, Long SMA=168, Sharpe=-0.2702, Trades=38
[INFO] Cluster 27 cluster: Short SMA=92, Long SMA=122, Sharpe=0.5068, Trades=27
[INFO] Cluster 28 cluster: Short SMA=84, Long SMA=180, Sharpe=0.1744, Trades=15
[INFO] Cluster 30 cluster: Short SMA=168, Long SMA=170, Sharpe=-0.0417, Trades=70
[INFO] Cluster 31 cluster: Short SMA=132, Long SMA=158, Sharpe=-0.0078, Trades=22
[INFO] Cluster 32 cluster: Short SMA=98, Long SMA=114, Sharpe=0.3266, Trades=33
[INFO] Cluster 34 cluster: Short SMA=54, Long SMA=56, Sharpe=0.3441, Trades=131
[INFO] Cluster 35 cluster: Short SMA=38, Long SMA=48, Sharpe=0.7196, Trades=72
[INFO] Cluster 36 cluster: Short SMA=166, Long SMA=226, Sharpe=-0.1665, Trades=13
[INFO] Cluster 37 cluster: Short SMA=242, Long SMA=250, Sharpe=-0.2476, Trades=34
[INFO] Cluster 38 cluster: Short SMA=216, Long SMA=224, Sharpe=-0.0933, Trades=40
[INFO] Cluster 39 cluster: Short SMA=208, Long SMA=252, Sharpe=-0.1440, Trades=18
[INFO] Cluster 40 cluster: Short SMA=154, Long SMA=184, Sharpe=-0.4435, Trades=20
[INFO] Cluster 41 cluster: Short SMA=52, Long SMA=182, Sharpe=0.3503, Trades=15
[INFO] Cluster 42 cluster: Short SMA=180, Long SMA=202, Sharpe=-0.0620, Trades=24
[INFO] Cluster 43 cluster: Short SMA=110, Long SMA=280, Sharpe=-0.3242, Trades=11
[INFO] Cluster 44 cluster: Short SMA=22, Long SMA=256, Sharpe=0.6281, Trades=13
[INFO] Cluster 45 cluster: Short SMA=164, Long SMA=280, Sharpe=-0.3715, Trades=11
[INFO] Cluster 46 cluster: Short SMA=90, Long SMA=274, Sharpe=-0.1615, Trades=11
[INFO] Cluster 47 cluster: Short SMA=56, Long SMA=216, Sharpe=0.2599, Trades=13
[INFO] Cluster 48 cluster: Short SMA=114, Long SMA=140, Sharpe=0.1431, Trades=26
[INFO] Cluster 49 cluster: Short SMA=212, Long SMA=236, Sharpe=0.0143, Trades=24
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=46, Sharpe=0.8582, Trades=78
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=48, Sharpe=0.7196, Trades=72
[INFO] Top 2: Short SMA=32, Long SMA=62, Sharpe=0.6664, Trades=48
[INFO] Top 3: Short SMA=22, Long SMA=256, Sharpe=0.6281, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10174 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/48) - Original Sharpe: 0.7196, Trades: 72
[INFO] Hierarchical cluster 2: SMA(32/62) - Original Sharpe: 0.6664, Trades: 48
[INFO] Hierarchical cluster 3: SMA(22/256) - Original Sharpe: 0.6281, Trades: 13
[INFO] Hierarchical cluster 4: SMA(44/250) - Original Sharpe: 0.5251, Trades: 13
[INFO] Hierarchical cluster 5: SMA(72/156) - Original Sharpe: 0.5084, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2816
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/48) - Sharpe: 0.7196
[INFO] cluster 2: (32/62) - Sharpe: 0.6664
[INFO] cluster 3: (22/256) - Sharpe: 0.6281
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Out-of-sample period starts on: 2021-09-24
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-24 2021-09-24            43     3.830825            3.830825
1    2021-11-24 2021-11-24            42    -0.750030           -1.040813
2    2022-01-24 2022-01-24            43    -1.158438            0.134840
3    2022-03-24 2022-03-24            42     2.899845            2.899845
4    2022-05-24 2022-05-24            44    -0.772793            2.004411
5    2022-07-24 2022-07-24            45     4.284626            4.094274
6    2022-09-24 2022-09-24            43    -1.964998           -2.208997
7    2022-11-24 2022-11-24            41     2.719154            2.715267
8    2023-01-24 2023-01-24            43    -4.933460           -3.833336
9    2023-03-24 2023-03-24            43    -4.230774           -2.893967
10   2023-05-24 2023-05-24            43    -5.713874           -6.016551
11   2023-07-24 2023-07-24            45    -1.713757           -1.613246
12   2023-09-24 2023-09-24            44    -0.948650           -1.107919
13   2023-11-24 2023-11-24            41    -0.015249           -3.333935
14   2024-01-24 2024-01-24            43    -1.669992            0.161003
15   2024-03-24 2024-03-24            43    -3.457983           -0.342823
16   2024-05-24 2024-05-24            43    -0.337335            0.121698
17   2024-07-24 2024-07-24            44     0.689877            0.174487
18   2024-09-24 2024-09-24            44     0.685285            0.169151
19   2024-11-24 2024-11-24            26     1.390507            1.390507
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-24   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2021-11-24   |         -0.8 |             -1.0 |         -0.2 | False         
[INFO] 2022-01-24   |         -1.2 |              0.1 |          1.3 | True          
[INFO] 2022-03-24   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-05-24   |         -0.8 |              2.0 |          2.8 | True          
[INFO] 2022-07-24   |          4.3 |              4.1 |         -0.2 | False         
[INFO] 2022-09-24   |         -2.0 |             -2.2 |         -0.2 | False         
[INFO] 2022-11-24   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2023-01-24   |         -4.9 |             -3.8 |          1.1 | True          
[INFO] 2023-03-24   |         -4.2 |             -2.9 |          1.3 | True          
[INFO] 2023-05-24   |         -5.7 |             -6.0 |         -0.3 | False         
[INFO] 2023-07-24   |         -1.7 |             -1.6 |          0.1 | True          
[INFO] 2023-09-24   |         -0.9 |             -1.1 |         -0.2 | False         
[INFO] 2023-11-24   |         -0.0 |             -3.3 |         -3.3 | False         
[INFO] 2024-01-24   |         -1.7 |              0.2 |          1.9 | True          
[INFO] 2024-03-24   |         -3.5 |             -0.3 |          3.2 | True          
[INFO] 2024-05-24   |         -0.3 |              0.1 |          0.4 | True          
[INFO] 2024-07-24   |          0.7 |              0.2 |         -0.5 | False         
[INFO] 2024-09-24   |          0.7 |              0.2 |         -0.5 | False         
[INFO] 2024-11-24   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-24, 2022-03-24, 2022-11-24, 2024-11-24
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 16 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for DX...
[INFO] Excel file updated successfully. Added DX with Hierarchical win rate 50.0% in row 12
[INFO] Added best Sharpe parameters 38/46 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 46
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/48) - Original Sharpe: 0.7196
[INFO] Added cluster 2 to portfolio: SMA(32/62) - Original Sharpe: 0.6664
[INFO] Added cluster 3 to portfolio: SMA(22/256) - Original Sharpe: 0.6281
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'DX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0029
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4997
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for DX...
[INFO] Excel file updated successfully. Added DX with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\DX
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for EC in column D: 9.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 131.46s
[INFO] Best parameters: Short SMA = 102, Long SMA = 106
[INFO] Best Sharpe ratio: 1.205170, Trades: 61
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @EC
[INFO] Big Point Value (from data): 125000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 6.80 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $719,557.00
[INFO] Market Buy & Hold P&L: $-67,087.50
[INFO] Outperformance: $786,644.50
[INFO] Sharpe ratio (entire period, annualized): 0.852974
[INFO] Sharpe ratio (in-sample, annualized): 1.205170
[INFO] Sharpe ratio (out-of-sample, annualized): 0.038724
[INFO] Maximum Drawdown: $200,630.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 45
[INFO] Out-of-sample period trades: 16
[INFO] Total trades: 61
[INFO] In-sample P&L: $643,237.25
[INFO] Out-of-sample P&L: $8,927.75
[INFO] 
Best parameters from GA: Short SMA = 102, Long SMA = 106, Sharpe = 1.205170
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5845 to 1.2052
[INFO] 
Best parameters:
[INFO] Short SMA: 102
[INFO] Long SMA: 106
[INFO] Sharpe Ratio: 1.205170
[INFO] Number of Trades: 61
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10425 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5845 to 1.2052
[INFO] Trades range: 10.0 to 346.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3845 to 2.7910
[INFO] Scaled Long SMA range: -2.7782 to 1.4049
[INFO] Scaled Sharpe ratio range: -2.3779 to 3.4455
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 74 elements
[INFO] Kmeans Cluster 1: 267 elements
[INFO] Kmeans Cluster 2: 196 elements
[INFO] Kmeans Cluster 3: 265 elements
[INFO] Kmeans Cluster 4: 172 elements
[INFO] Kmeans Cluster 5: 201 elements
[INFO] Kmeans Cluster 6: 269 elements
[INFO] Kmeans Cluster 7: 176 elements
[INFO] Kmeans Cluster 8: 182 elements
[INFO] Kmeans Cluster 9: 330 elements
[INFO] Kmeans Cluster 10: 230 elements
[INFO] Kmeans Cluster 11: 193 elements
[INFO] Kmeans Cluster 12: 214 elements
[INFO] Kmeans Cluster 13: 194 elements
[INFO] Kmeans Cluster 14: 276 elements
[INFO] Kmeans Cluster 15: 141 elements
[INFO] Kmeans Cluster 16: 39 elements
[INFO] Kmeans Cluster 17: 278 elements
[INFO] Kmeans Cluster 18: 217 elements
[INFO] Kmeans Cluster 19: 211 elements
[INFO] Kmeans Cluster 20: 161 elements
[INFO] Kmeans Cluster 21: 245 elements
[INFO] Kmeans Cluster 22: 219 elements
[INFO] Kmeans Cluster 23: 138 elements
[INFO] Kmeans Cluster 24: 127 elements
[INFO] Kmeans Cluster 25: 169 elements
[INFO] Kmeans Cluster 26: 238 elements
[INFO] Kmeans Cluster 27: 200 elements
[INFO] Kmeans Cluster 28: 247 elements
[INFO] Kmeans Cluster 29: 203 elements
[INFO] Kmeans Cluster 30: 120 elements
[INFO] Kmeans Cluster 31: 181 elements
[INFO] Kmeans Cluster 32: 312 elements
[INFO] Kmeans Cluster 33: 227 elements
[INFO] Kmeans Cluster 34: 240 elements
[INFO] Kmeans Cluster 35: 259 elements
[INFO] Kmeans Cluster 36: 299 elements
[INFO] Kmeans Cluster 37: 335 elements
[INFO] Kmeans Cluster 38: 157 elements
[INFO] Kmeans Cluster 39: 91 elements
[INFO] Kmeans Cluster 40: 301 elements
[INFO] Kmeans Cluster 41: 147 elements
[INFO] Kmeans Cluster 42: 219 elements
[INFO] Kmeans Cluster 43: 193 elements
[INFO] Kmeans Cluster 44: 160 elements
[INFO] Kmeans Cluster 45: 200 elements
[INFO] Kmeans Cluster 46: 218 elements
[INFO] Kmeans Cluster 47: 262 elements
[INFO] Kmeans Cluster 48: 235 elements
[INFO] Kmeans Cluster 49: 197 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=96.32, Long SMA=116.22, Sharpe=0.8406
[INFO] Centroid 1: Short SMA=118.32, Long SMA=220.94, Sharpe=0.0622
[INFO] Centroid 2: Short SMA=25.11, Long SMA=193.79, Sharpe=0.4350
[INFO] Centroid 3: Short SMA=183.46, Long SMA=285.81, Sharpe=-0.3986
[INFO] Centroid 4: Short SMA=31.63, Long SMA=61.86, Sharpe=0.4122
[INFO] Centroid 5: Short SMA=211.77, Long SMA=281.64, Sharpe=-0.2699
[INFO] Centroid 6: Short SMA=50.68, Long SMA=253.11, Sharpe=0.3783
[INFO] Centroid 7: Short SMA=98.52, Long SMA=158.78, Sharpe=0.3296
[INFO] Centroid 8: Short SMA=274.21, Long SMA=289.22, Sharpe=-0.1757
[INFO] Centroid 9: Short SMA=163.95, Long SMA=227.69, Sharpe=-0.1903
[INFO] Centroid 10: Short SMA=134.97, Long SMA=281.17, Sharpe=-0.3076
[INFO] Centroid 11: Short SMA=146.42, Long SMA=167.40, Sharpe=-0.0532
[INFO] Centroid 12: Short SMA=28.15, Long SMA=156.36, Sharpe=0.5037
[INFO] Centroid 13: Short SMA=94.65, Long SMA=191.65, Sharpe=0.2972
[INFO] Centroid 14: Short SMA=90.16, Long SMA=253.19, Sharpe=0.1154
[INFO] Centroid 15: Short SMA=60.98, Long SMA=82.44, Sharpe=0.1152
[INFO] Centroid 16: Short SMA=14.05, Long SMA=22.77, Sharpe=-0.1523
[INFO] Centroid 17: Short SMA=33.49, Long SMA=286.86, Sharpe=0.4375
[INFO] Centroid 18: Short SMA=179.94, Long SMA=202.78, Sharpe=-0.0928
[INFO] Centroid 19: Short SMA=91.77, Long SMA=121.26, Sharpe=0.6355
[INFO] Centroid 20: Short SMA=28.58, Long SMA=238.88, Sharpe=0.4996
[INFO] Centroid 21: Short SMA=61.13, Long SMA=114.64, Sharpe=0.4350
[INFO] Centroid 22: Short SMA=27.96, Long SMA=96.32, Sharpe=0.2628
[INFO] Centroid 23: Short SMA=34.26, Long SMA=56.81, Sharpe=0.6118
[INFO] Centroid 24: Short SMA=167.62, Long SMA=182.83, Sharpe=0.1374
[INFO] Centroid 25: Short SMA=113.43, Long SMA=287.48, Sharpe=-0.1461
[INFO] Centroid 26: Short SMA=71.18, Long SMA=172.86, Sharpe=0.4476
[INFO] Centroid 27: Short SMA=159.83, Long SMA=278.49, Sharpe=-0.2224
[INFO] Centroid 28: Short SMA=141.74, Long SMA=200.70, Sharpe=-0.0624
[INFO] Centroid 29: Short SMA=96.17, Long SMA=221.07, Sharpe=0.1650
[INFO] Centroid 30: Short SMA=19.25, Long SMA=42.20, Sharpe=0.2464
[INFO] Centroid 31: Short SMA=19.30, Long SMA=265.14, Sharpe=0.4680
[INFO] Centroid 32: Short SMA=70.74, Long SMA=284.31, Sharpe=0.2256
[INFO] Centroid 33: Short SMA=69.79, Long SMA=224.25, Sharpe=0.3622
[INFO] Centroid 34: Short SMA=232.55, Long SMA=256.31, Sharpe=-0.3373
[INFO] Centroid 35: Short SMA=190.40, Long SMA=254.73, Sharpe=-0.3225
[INFO] Centroid 36: Short SMA=120.82, Long SMA=169.72, Sharpe=0.1786
[INFO] Centroid 37: Short SMA=242.99, Long SMA=283.62, Sharpe=-0.1045
[INFO] Centroid 38: Short SMA=199.46, Long SMA=224.38, Sharpe=-0.3805
[INFO] Centroid 39: Short SMA=12.68, Long SMA=88.24, Sharpe=0.0332
[INFO] Centroid 40: Short SMA=30.05, Long SMA=126.82, Sharpe=0.4356
[INFO] Centroid 41: Short SMA=146.26, Long SMA=245.27, Sharpe=-0.3449
[INFO] Centroid 42: Short SMA=57.27, Long SMA=204.16, Sharpe=0.2926
[INFO] Centroid 43: Short SMA=65.74, Long SMA=87.06, Sharpe=0.2947
[INFO] Centroid 44: Short SMA=217.49, Long SMA=234.53, Sharpe=-0.1693
[INFO] Centroid 45: Short SMA=116.97, Long SMA=136.46, Sharpe=0.3926
[INFO] Centroid 46: Short SMA=25.23, Long SMA=217.44, Sharpe=0.3416
[INFO] Centroid 47: Short SMA=37.89, Long SMA=171.46, Sharpe=0.3563
[INFO] Centroid 48: Short SMA=69.24, Long SMA=143.06, Sharpe=0.5621
[INFO] Centroid 49: Short SMA=103.11, Long SMA=270.35, Sharpe=0.0157
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=102, Long SMA=106, Sharpe=1.2052, Trades=61
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=98, Long SMA=116, Sharpe=0.8371, Trades=33
[INFO] Kmeans Top 2: Short SMA=92, Long SMA=124, Sharpe=0.7075, Trades=25
[INFO] Kmeans Top 3: Short SMA=34, Long SMA=56, Sharpe=0.6238, Trades=53
[INFO] Kmeans Top 4: Short SMA=28, Long SMA=156, Sharpe=0.6013, Trades=21
[INFO] Kmeans Top 5: Short SMA=68, Long SMA=144, Sharpe=0.5616, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (96, 116)
[INFO]   Rounded: (118, 221)
[INFO]   Nearest: (118.0, 220.0)
[INFO]   Rounded: (25, 194)
[INFO]   Nearest: (26.0, 194.0)
[INFO]   Rounded: (183, 286)
[INFO]   Nearest: (184.0, 286.0)
[INFO]   Rounded: (32, 62)
[INFO]   Rounded: (212, 282)
[INFO]   Rounded: (51, 253)
[INFO]   Nearest: (50.0, 254.0)
[INFO]   Rounded: (99, 159)
[INFO]   Nearest: (98.0, 158.0)
[INFO]   Rounded: (274, 289)
[INFO]   Nearest: (274.0, 290.0)
[INFO]   Rounded: (164, 228)
[INFO]   Rounded: (135, 281)
[INFO]   Nearest: (134.0, 282.0)
[INFO]   Rounded: (146, 167)
[INFO]   Nearest: (146.0, 168.0)
[INFO]   Rounded: (28, 156)
[INFO]   Rounded: (95, 192)
[INFO]   Nearest: (94.0, 192.0)
[INFO]   Rounded: (90, 253)
[INFO]   Nearest: (90.0, 254.0)
[INFO]   Rounded: (61, 82)
[INFO]   Nearest: (60.0, 82.0)
[INFO]   Rounded: (14, 23)
[INFO]   Nearest: (14.0, 22.0)
[INFO]   Rounded: (33, 287)
[INFO]   Nearest: (34.0, 286.0)
[INFO]   Rounded: (180, 203)
[INFO]   Nearest: (180.0, 202.0)
[INFO]   Rounded: (92, 121)
[INFO]   Nearest: (92.0, 122.0)
[INFO]   Rounded: (29, 239)
[INFO]   Nearest: (28.0, 238.0)
[INFO]   Rounded: (61, 115)
[INFO]   Nearest: (62.0, 114.0)
[INFO]   Rounded: (28, 96)
[INFO]   Rounded: (34, 57)
[INFO]   Nearest: (34.0, 56.0)
[INFO]   Rounded: (168, 183)
[INFO]   Nearest: (168.0, 182.0)
[INFO]   Rounded: (113, 287)
[INFO]   Nearest: (114.0, 288.0)
[INFO]   Rounded: (71, 173)
[INFO]   Nearest: (72.0, 172.0)
[INFO]   Rounded: (160, 278)
[INFO]   Rounded: (142, 201)
[INFO]   Nearest: (142.0, 200.0)
[INFO]   Rounded: (96, 221)
[INFO]   Nearest: (96.0, 222.0)
[INFO]   Rounded: (19, 42)
[INFO]   Nearest: (20.0, 42.0)
[INFO]   Rounded: (19, 265)
[INFO]   Nearest: (20.0, 266.0)
[INFO]   Rounded: (71, 284)
[INFO]   Nearest: (70.0, 284.0)
[INFO]   Rounded: (70, 224)
[INFO]   Rounded: (233, 256)
[INFO]   Nearest: (232.0, 256.0)
[INFO]   Rounded: (190, 255)
[INFO]   Nearest: (190.0, 254.0)
[INFO]   Rounded: (121, 170)
[INFO]   Nearest: (120.0, 170.0)
[INFO]   Rounded: (243, 284)
[INFO]   Nearest: (242.0, 284.0)
[INFO]   Rounded: (199, 224)
[INFO]   Nearest: (200.0, 224.0)
[INFO]   Rounded: (13, 88)
[INFO]   Nearest: (12.0, 88.0)
[INFO]   Rounded: (30, 127)
[INFO]   Nearest: (30.0, 126.0)
[INFO]   Rounded: (146, 245)
[INFO]   Nearest: (146.0, 246.0)
[INFO]   Rounded: (57, 204)
[INFO]   Nearest: (58.0, 204.0)
[INFO]   Rounded: (66, 87)
[INFO]   Nearest: (66.0, 88.0)
[INFO]   Rounded: (217, 235)
[INFO]   Nearest: (218.0, 234.0)
[INFO]   Rounded: (117, 136)
[INFO]   Nearest: (116.0, 136.0)
[INFO]   Rounded: (25, 217)
[INFO]   Nearest: (26.0, 218.0)
[INFO]   Rounded: (38, 171)
[INFO]   Nearest: (38.0, 172.0)
[INFO]   Rounded: (69, 143)
[INFO]   Nearest: (70.0, 144.0)
[INFO]   Rounded: (103, 270)
[INFO]   Nearest: (104.0, 270.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 102, Long SMA: 106
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(98/116) - Original Sharpe: 0.8371, Trades: 33
[INFO] Kmeans cluster 2: SMA(92/124) - Original Sharpe: 0.7075, Trades: 25
[INFO] Kmeans cluster 3: SMA(34/56) - Original Sharpe: 0.6238, Trades: 53
[INFO] Kmeans cluster 4: SMA(28/156) - Original Sharpe: 0.6013, Trades: 21
[INFO] Kmeans cluster 5: SMA(68/144) - Original Sharpe: 0.5616, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (102/106)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (98/116) - Sharpe: 0.8371
[INFO] cluster 2: (92/124) - Sharpe: 0.7075
[INFO] cluster 3: (34/56) - Sharpe: 0.6238
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     3.487734            3.487734
1    2021-11-14 2021-11-14            43     0.321475            0.321475
2    2022-01-14 2022-01-14            41     3.270794            3.377129
3    2022-03-14 2022-03-14            44     3.649515            3.649515
4    2022-05-14 2022-05-14            43     1.818210            1.818210
5    2022-07-14 2022-07-14            44     0.788062            0.788062
6    2022-09-14 2022-09-14            43    -1.170570           -1.170570
7    2022-11-14 2022-11-14            43    -2.242409           -2.166930
8    2023-01-14 2023-01-14            41    -0.989824           -1.770478
9    2023-03-14 2023-03-14            44     0.488570           -0.887998
10   2023-05-14 2023-05-14            44    -0.377326           -2.039253
11   2023-07-14 2023-07-14            44    -3.130408           -2.586458
12   2023-09-14 2023-09-14            43     2.281930            0.573726
13   2023-11-14 2023-11-14            42    -1.565980           -2.389151
14   2024-01-14 2024-01-14            43     1.745773            4.449314
15   2024-03-14 2024-03-14            42    -3.416207           -3.871378
16   2024-05-14 2024-05-14            44    -0.027797           -2.280527
17   2024-07-14 2024-07-14            45    -0.762846           -1.210301
18   2024-09-14 2024-09-14            43    -3.897937           -4.326979
19   2024-11-14 2024-11-14            33     0.919641            2.399222
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-01-14   |          3.3 |              3.4 |          0.1 | True          
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -1.0 |             -1.8 |         -0.8 | False         
[INFO] 2023-03-14   |          0.5 |             -0.9 |         -1.4 | False         
[INFO] 2023-05-14   |         -0.4 |             -2.0 |         -1.6 | False         
[INFO] 2023-07-14   |         -3.1 |             -2.6 |          0.5 | True          
[INFO] 2023-09-14   |          2.3 |              0.6 |         -1.7 | False         
[INFO] 2023-11-14   |         -1.6 |             -2.4 |         -0.8 | False         
[INFO] 2024-01-14   |          1.7 |              4.4 |          2.7 | True          
[INFO] 2024-03-14   |         -3.4 |             -3.9 |         -0.5 | False         
[INFO] 2024-05-14   |         -0.0 |             -2.3 |         -2.3 | False         
[INFO] 2024-07-14   |         -0.8 |             -1.2 |         -0.4 | False         
[INFO] 2024-09-14   |         -3.9 |             -4.3 |         -0.4 | False         
[INFO] 2024-11-14   |          0.9 |              2.4 |          1.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 4 of 13 periods (30.77% win rate)
[INFO] Updating Excel file with Kmeans results for EC...
[INFO] Excel file updated successfully. Added EC with Kmeans win rate 30.8% in row 13
[INFO] Added best Sharpe parameters 102/106 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 102, Long SMA: 106
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(98/116) - Original Sharpe: 0.8371
[INFO] Added cluster 2 to portfolio: SMA(92/124) - Original Sharpe: 0.7075
[INFO] Added cluster 3 to portfolio: SMA(34/56) - Original Sharpe: 0.6238
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'EC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1186
[INFO] Kmeans Best out-of-sample Sharpe: 0.0387
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for EC...
[INFO] Excel file updated successfully. Added EC with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EC
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5845 to 1.2052
[INFO] 
Best parameters:
[INFO] Short SMA: 102
[INFO] Long SMA: 106
[INFO] Sharpe Ratio: 1.205170
[INFO] Number of Trades: 61
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10425 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5845 to 1.2052
[INFO] Trades range: 10.0 to 346.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3845 to 2.7910
[INFO] Scaled Long SMA range: -2.7782 to 1.4049
[INFO] Scaled Sharpe ratio range: -2.3779 to 3.4455
[INFO] Scaled Trades range: -0.6847 to 16.6990
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10425 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6116
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 455 elements
[INFO] Cluster 1: 140 elements
[INFO] Cluster 2: 502 elements
[INFO] Cluster 3: 88 elements
[INFO] Cluster 4: 144 elements
[INFO] Cluster 5: 406 elements
[INFO] Cluster 6: 488 elements
[INFO] Cluster 7: 305 elements
[INFO] Cluster 8: 182 elements
[INFO] Cluster 9: 55 elements
[INFO] Cluster 10: 137 elements
[INFO] Cluster 11: 361 elements
[INFO] Cluster 12: 417 elements
[INFO] Cluster 13: 153 elements
[INFO] Cluster 14: 381 elements
[INFO] Cluster 15: 188 elements
[INFO] Cluster 16: 90 elements
[INFO] Cluster 17: 7 elements
[INFO] Cluster 18: 54 elements
[INFO] Cluster 19: 312 elements
[INFO] Cluster 20: 305 elements
[INFO] Cluster 21: 25 elements
[INFO] Cluster 22: 19 elements
[INFO] Cluster 23: 315 elements
[INFO] Cluster 24: 249 elements
[INFO] Cluster 25: 91 elements
[INFO] Cluster 26: 265 elements
[INFO] Cluster 27: 295 elements
[INFO] Cluster 28: 164 elements
[INFO] Cluster 29: 339 elements
[INFO] Cluster 30: 371 elements
[INFO] Cluster 31: 29 elements
[INFO] Cluster 32: 361 elements
[INFO] Cluster 33: 169 elements
[INFO] Cluster 34: 236 elements
[INFO] Cluster 35: 354 elements
[INFO] Cluster 36: 51 elements
[INFO] Cluster 37: 164 elements
[INFO] Cluster 38: 123 elements
[INFO] Cluster 39: 35 elements
[INFO] Cluster 40: 292 elements
[INFO] Cluster 41: 9 elements
[INFO] Cluster 42: 271 elements
[INFO] Cluster 43: 226 elements
[INFO] Cluster 44: 29 elements
[INFO] Cluster 45: 260 elements
[INFO] Cluster 46: 104 elements
[INFO] Cluster 47: 132 elements
[INFO] Cluster 48: 220 elements
[INFO] Cluster 49: 57 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=60, Long SMA=174, Sharpe=0.4251, Trades=17
[INFO] Cluster 1 cluster: Short SMA=86, Long SMA=104, Sharpe=0.3999, Trades=37
[INFO] Cluster 2 cluster: Short SMA=192, Long SMA=282, Sharpe=-0.3433, Trades=16
[INFO] Cluster 3 cluster: Short SMA=260, Long SMA=264, Sharpe=0.0929, Trades=53
[INFO] Cluster 4 cluster: Short SMA=16, Long SMA=80, Sharpe=-0.0183, Trades=53
[INFO] Cluster 5 cluster: Short SMA=166, Long SMA=250, Sharpe=-0.2317, Trades=13
[INFO] Cluster 6 cluster: Short SMA=72, Long SMA=206, Sharpe=0.3047, Trades=15
[INFO] Cluster 7 cluster: Short SMA=212, Long SMA=250, Sharpe=-0.3292, Trades=20
[INFO] Cluster 8 cluster: Short SMA=178, Long SMA=198, Sharpe=-0.1282, Trades=26
[INFO] Cluster 9 cluster: Short SMA=30, Long SMA=36, Sharpe=0.2324, Trades=103
[INFO] Cluster 10 cluster: Short SMA=158, Long SMA=180, Sharpe=0.1560, Trades=23
[INFO] Cluster 11 cluster: Short SMA=40, Long SMA=90, Sharpe=0.2456, Trades=33
[INFO] Cluster 12 cluster: Short SMA=48, Long SMA=118, Sharpe=0.3718, Trades=21
[INFO] Cluster 13 cluster: Short SMA=34, Long SMA=66, Sharpe=0.5798, Trades=49
[INFO] Cluster 14 cluster: Short SMA=112, Long SMA=218, Sharpe=0.0221, Trades=15
[INFO] Cluster 15 cluster: Short SMA=216, Long SMA=232, Sharpe=-0.1533, Trades=28
[INFO] Cluster 16 cluster: Short SMA=26, Long SMA=40, Sharpe=0.2601, Trades=75
[INFO] Cluster 18 cluster: Short SMA=126, Long SMA=130, Sharpe=0.4411, Trades=71
[INFO] Cluster 19 cluster: Short SMA=32, Long SMA=286, Sharpe=0.4430, Trades=16
[INFO] Cluster 20 cluster: Short SMA=236, Long SMA=284, Sharpe=-0.1571, Trades=16
[INFO] Cluster 21 cluster: Short SMA=52, Long SMA=56, Sharpe=0.5362, Trades=99
[INFO] Cluster 23 cluster: Short SMA=26, Long SMA=212, Sharpe=0.3151, Trades=21
[INFO] Cluster 24 cluster: Short SMA=100, Long SMA=266, Sharpe=0.1053, Trades=11
[INFO] Cluster 25 cluster: Short SMA=114, Long SMA=140, Sharpe=0.3261, Trades=23
[INFO] Cluster 26 cluster: Short SMA=74, Long SMA=140, Sharpe=0.5864, Trades=15
[INFO] Cluster 27 cluster: Short SMA=118, Long SMA=176, Sharpe=0.2083, Trades=15
[INFO] Cluster 28 cluster: Short SMA=90, Long SMA=120, Sharpe=0.7415, Trades=27
[INFO] Cluster 29 cluster: Short SMA=52, Long SMA=250, Sharpe=0.4063, Trades=15
[INFO] Cluster 30 cluster: Short SMA=164, Long SMA=222, Sharpe=-0.2159, Trades=13
[INFO] Cluster 31 cluster: Short SMA=48, Long SMA=50, Sharpe=0.6007, Trades=138
[INFO] Cluster 32 cluster: Short SMA=142, Long SMA=282, Sharpe=-0.4139, Trades=12
[INFO] Cluster 33 cluster: Short SMA=20, Long SMA=184, Sharpe=0.4880, Trades=23
[INFO] Cluster 34 cluster: Short SMA=140, Long SMA=198, Sharpe=-0.0809, Trades=15
[INFO] Cluster 35 cluster: Short SMA=72, Long SMA=284, Sharpe=0.2911, Trades=12
[INFO] Cluster 36 cluster: Short SMA=158, Long SMA=162, Sharpe=-0.2452, Trades=55
[INFO] Cluster 37 cluster: Short SMA=112, Long SMA=290, Sharpe=-0.1572, Trades=12
[INFO] Cluster 38 cluster: Short SMA=20, Long SMA=60, Sharpe=0.3831, Trades=55
[INFO] Cluster 39 cluster: Short SMA=100, Long SMA=108, Sharpe=1.0603, Trades=43
[INFO] Cluster 40 cluster: Short SMA=24, Long SMA=250, Sharpe=0.5009, Trades=17
[INFO] Cluster 42 cluster: Short SMA=30, Long SMA=146, Sharpe=0.5186, Trades=21
[INFO] Cluster 43 cluster: Short SMA=268, Long SMA=286, Sharpe=-0.1507, Trades=22
[INFO] Cluster 44 cluster: Short SMA=36, Long SMA=48, Sharpe=0.7012, Trades=68
[INFO] Cluster 45 cluster: Short SMA=90, Long SMA=242, Sharpe=0.0643, Trades=11
[INFO] Cluster 46 cluster: Short SMA=12, Long SMA=152, Sharpe=0.3678, Trades=31
[INFO] Cluster 47 cluster: Short SMA=148, Long SMA=166, Sharpe=-0.1707, Trades=27
[INFO] Cluster 48 cluster: Short SMA=96, Long SMA=158, Sharpe=0.3788, Trades=15
[INFO] Cluster 49 cluster: Short SMA=242, Long SMA=252, Sharpe=-0.3431, Trades=34
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=102, Long SMA=106, Sharpe=1.2052, Trades=61
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=100, Long SMA=108, Sharpe=1.0603, Trades=43
[INFO] Top 2: Short SMA=90, Long SMA=120, Sharpe=0.7415, Trades=27
[INFO] Top 3: Short SMA=36, Long SMA=48, Sharpe=0.7012, Trades=68
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10390 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 102, Long SMA: 106
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(100/108) - Original Sharpe: 1.0603, Trades: 43
[INFO] Hierarchical cluster 2: SMA(90/120) - Original Sharpe: 0.7415, Trades: 27
[INFO] Hierarchical cluster 3: SMA(36/48) - Original Sharpe: 0.7012, Trades: 68
[INFO] Hierarchical cluster 4: SMA(48/50) - Original Sharpe: 0.6007, Trades: 138
[INFO] Hierarchical cluster 5: SMA(74/140) - Original Sharpe: 0.5864, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (102/106)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (100/108) - Sharpe: 1.0603
[INFO] cluster 2: (90/120) - Sharpe: 0.7415
[INFO] cluster 3: (36/48) - Sharpe: 0.7012
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     3.487734            3.487734
1    2021-11-14 2021-11-14            43     0.321475            0.321475
2    2022-01-14 2022-01-14            41     3.270794            2.368390
3    2022-03-14 2022-03-14            44     3.649515            3.649515
4    2022-05-14 2022-05-14            43     1.818210            0.469325
5    2022-07-14 2022-07-14            44     0.788062            0.788062
6    2022-09-14 2022-09-14            43    -1.170570           -1.170570
7    2022-11-14 2022-11-14            43    -2.242409           -1.787640
8    2023-01-14 2023-01-14            41    -0.989824           -2.006603
9    2023-03-14 2023-03-14            44     0.488570           -0.838319
10   2023-05-14 2023-05-14            44    -0.377326           -2.224363
11   2023-07-14 2023-07-14            44    -3.130408           -3.382348
12   2023-09-14 2023-09-14            43     2.281930            1.359621
13   2023-11-14 2023-11-14            42    -1.565980           -2.389151
14   2024-01-14 2024-01-14            43     1.745773            1.740406
15   2024-03-14 2024-03-14            42    -3.416207           -3.826669
16   2024-05-14 2024-05-14            44    -0.027797           -1.721581
17   2024-07-14 2024-07-14            45    -0.762846           -1.331605
18   2024-09-14 2024-09-14            43    -3.897937           -3.876528
19   2024-11-14 2024-11-14            33     0.919641            1.884721
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-01-14   |          3.3 |              2.4 |         -0.9 | False         
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.8 |              0.5 |         -1.3 | False         
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -2.2 |             -1.8 |          0.4 | True          
[INFO] 2023-01-14   |         -1.0 |             -2.0 |         -1.0 | False         
[INFO] 2023-03-14   |          0.5 |             -0.8 |         -1.3 | False         
[INFO] 2023-05-14   |         -0.4 |             -2.2 |         -1.8 | False         
[INFO] 2023-07-14   |         -3.1 |             -3.4 |         -0.3 | False         
[INFO] 2023-09-14   |          2.3 |              1.4 |         -0.9 | False         
[INFO] 2023-11-14   |         -1.6 |             -2.4 |         -0.8 | False         
[INFO] 2024-01-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -3.4 |             -3.8 |         -0.4 | False         
[INFO] 2024-05-14   |         -0.0 |             -1.7 |         -1.7 | False         
[INFO] 2024-07-14   |         -0.8 |             -1.3 |         -0.5 | False         
[INFO] 2024-09-14   |         -3.9 |             -3.9 |          0.0 | Excluded      
[INFO] 2024-11-14   |          0.9 |              1.9 |          1.0 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-03-14, 2022-07-14, 2022-09-14, 2024-01-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 13 periods (15.38% win rate)
[INFO] Updating Excel file with Hierarchical results for EC...
[INFO] Excel file updated successfully. Added EC with Hierarchical win rate 15.4% in row 13
[INFO] Added best Sharpe parameters 102/106 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 102, Long SMA: 106
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(100/108) - Original Sharpe: 1.0603
[INFO] Added cluster 2 to portfolio: SMA(90/120) - Original Sharpe: 0.7415
[INFO] Added cluster 3 to portfolio: SMA(36/48) - Original Sharpe: 0.7012
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'EC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2857
[INFO] Hierarchical Best out-of-sample Sharpe: 0.0387
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for EC...
[INFO] Excel file updated successfully. Added EC with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EC
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for EMD in column D: 55.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 131.32s
[INFO] Best parameters: Short SMA = 216, Long SMA = 222
[INFO] Best Sharpe ratio: 0.453823, Trades: 36
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @EMD
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 2.80 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $195,360.00
[INFO] Market Buy & Hold P&L: $161,780.00
[INFO] Outperformance: $33,580.00
[INFO] Sharpe ratio (entire period, annualized): 0.255399
[INFO] Sharpe ratio (in-sample, annualized): 0.453823
[INFO] Sharpe ratio (out-of-sample, annualized): -0.167302
[INFO] Maximum Drawdown: $265,775.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 20
[INFO] Out-of-sample period trades: 16
[INFO] Total trades: 36
[INFO] In-sample P&L: $302,580.00
[INFO] Out-of-sample P&L: $-52,280.00
[INFO] 
Best parameters from GA: Short SMA = 216, Long SMA = 222, Sharpe = 0.453823
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 55.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] 
Best parameters:
[INFO] Short SMA: 216
[INFO] Long SMA: 222
[INFO] Sharpe Ratio: 0.453823
[INFO] Number of Trades: 36
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10530 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] Trades range: 10.0 to 335.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3944 to 2.7966
[INFO] Scaled Long SMA range: -2.7981 to 1.4094
[INFO] Scaled Sharpe ratio range: -4.0417 to 3.3900
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 193 elements
[INFO] Kmeans Cluster 1: 256 elements
[INFO] Kmeans Cluster 2: 193 elements
[INFO] Kmeans Cluster 3: 209 elements
[INFO] Kmeans Cluster 4: 317 elements
[INFO] Kmeans Cluster 5: 166 elements
[INFO] Kmeans Cluster 6: 207 elements
[INFO] Kmeans Cluster 7: 353 elements
[INFO] Kmeans Cluster 8: 212 elements
[INFO] Kmeans Cluster 9: 208 elements
[INFO] Kmeans Cluster 10: 259 elements
[INFO] Kmeans Cluster 11: 375 elements
[INFO] Kmeans Cluster 12: 297 elements
[INFO] Kmeans Cluster 13: 230 elements
[INFO] Kmeans Cluster 14: 134 elements
[INFO] Kmeans Cluster 15: 176 elements
[INFO] Kmeans Cluster 16: 77 elements
[INFO] Kmeans Cluster 17: 342 elements
[INFO] Kmeans Cluster 18: 118 elements
[INFO] Kmeans Cluster 19: 211 elements
[INFO] Kmeans Cluster 20: 52 elements
[INFO] Kmeans Cluster 21: 387 elements
[INFO] Kmeans Cluster 22: 233 elements
[INFO] Kmeans Cluster 23: 140 elements
[INFO] Kmeans Cluster 24: 259 elements
[INFO] Kmeans Cluster 25: 143 elements
[INFO] Kmeans Cluster 26: 258 elements
[INFO] Kmeans Cluster 27: 221 elements
[INFO] Kmeans Cluster 28: 182 elements
[INFO] Kmeans Cluster 29: 177 elements
[INFO] Kmeans Cluster 30: 328 elements
[INFO] Kmeans Cluster 31: 22 elements
[INFO] Kmeans Cluster 32: 212 elements
[INFO] Kmeans Cluster 33: 199 elements
[INFO] Kmeans Cluster 34: 212 elements
[INFO] Kmeans Cluster 35: 85 elements
[INFO] Kmeans Cluster 36: 241 elements
[INFO] Kmeans Cluster 37: 434 elements
[INFO] Kmeans Cluster 38: 178 elements
[INFO] Kmeans Cluster 39: 219 elements
[INFO] Kmeans Cluster 40: 194 elements
[INFO] Kmeans Cluster 41: 188 elements
[INFO] Kmeans Cluster 42: 188 elements
[INFO] Kmeans Cluster 43: 98 elements
[INFO] Kmeans Cluster 44: 88 elements
[INFO] Kmeans Cluster 45: 189 elements
[INFO] Kmeans Cluster 46: 201 elements
[INFO] Kmeans Cluster 47: 183 elements
[INFO] Kmeans Cluster 48: 262 elements
[INFO] Kmeans Cluster 49: 224 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=74.85, Long SMA=147.68, Sharpe=-0.2347
[INFO] Centroid 1: Short SMA=162.38, Long SMA=249.70, Sharpe=-0.1478
[INFO] Centroid 2: Short SMA=229.11, Long SMA=256.97, Sharpe=-0.4156
[INFO] Centroid 3: Short SMA=62.11, Long SMA=188.62, Sharpe=-0.1599
[INFO] Centroid 4: Short SMA=36.20, Long SMA=133.92, Sharpe=0.0480
[INFO] Centroid 5: Short SMA=22.52, Long SMA=281.19, Sharpe=-0.0253
[INFO] Centroid 6: Short SMA=33.45, Long SMA=63.27, Sharpe=-0.0488
[INFO] Centroid 7: Short SMA=91.09, Long SMA=203.46, Sharpe=0.0121
[INFO] Centroid 8: Short SMA=253.18, Long SMA=282.62, Sharpe=-0.5512
[INFO] Centroid 9: Short SMA=60.29, Long SMA=94.97, Sharpe=-0.2968
[INFO] Centroid 10: Short SMA=137.69, Long SMA=194.39, Sharpe=-0.2167
[INFO] Centroid 11: Short SMA=49.39, Long SMA=275.23, Sharpe=-0.1201
[INFO] Centroid 12: Short SMA=116.34, Long SMA=278.89, Sharpe=-0.1342
[INFO] Centroid 13: Short SMA=114.62, Long SMA=145.03, Sharpe=-0.0425
[INFO] Centroid 14: Short SMA=12.95, Long SMA=244.12, Sharpe=0.1033
[INFO] Centroid 15: Short SMA=198.78, Long SMA=224.72, Sharpe=-0.0371
[INFO] Centroid 16: Short SMA=55.40, Long SMA=70.70, Sharpe=-0.4450
[INFO] Centroid 17: Short SMA=87.52, Long SMA=242.74, Sharpe=0.0173
[INFO] Centroid 18: Short SMA=255.90, Long SMA=278.53, Sharpe=-0.7005
[INFO] Centroid 19: Short SMA=110.47, Long SMA=160.77, Sharpe=0.0394
[INFO] Centroid 20: Short SMA=23.27, Long SMA=40.00, Sharpe=0.2377
[INFO] Centroid 21: Short SMA=127.93, Long SMA=233.14, Sharpe=-0.1531
[INFO] Centroid 22: Short SMA=53.18, Long SMA=94.58, Sharpe=-0.1808
[INFO] Centroid 23: Short SMA=147.50, Long SMA=165.76, Sharpe=-0.2951
[INFO] Centroid 24: Short SMA=29.95, Long SMA=210.11, Sharpe=-0.1299
[INFO] Centroid 25: Short SMA=18.85, Long SMA=176.80, Sharpe=0.0789
[INFO] Centroid 26: Short SMA=162.22, Long SMA=283.16, Sharpe=-0.2089
[INFO] Centroid 27: Short SMA=198.45, Long SMA=251.33, Sharpe=-0.2222
[INFO] Centroid 28: Short SMA=36.14, Long SMA=266.46, Sharpe=-0.2100
[INFO] Centroid 29: Short SMA=225.71, Long SMA=278.21, Sharpe=-0.6073
[INFO] Centroid 30: Short SMA=84.91, Long SMA=282.68, Sharpe=-0.0201
[INFO] Centroid 31: Short SMA=216.45, Long SMA=222.00, Sharpe=0.2934
[INFO] Centroid 32: Short SMA=172.57, Long SMA=205.34, Sharpe=-0.2324
[INFO] Centroid 33: Short SMA=213.91, Long SMA=283.95, Sharpe=-0.4910
[INFO] Centroid 34: Short SMA=76.89, Long SMA=116.52, Sharpe=-0.0568
[INFO] Centroid 35: Short SMA=25.20, Long SMA=40.64, Sharpe=-0.2063
[INFO] Centroid 36: Short SMA=177.45, Long SMA=218.15, Sharpe=-0.1084
[INFO] Centroid 37: Short SMA=51.38, Long SMA=231.19, Sharpe=-0.0619
[INFO] Centroid 38: Short SMA=76.33, Long SMA=162.60, Sharpe=-0.1061
[INFO] Centroid 39: Short SMA=24.85, Long SMA=63.82, Sharpe=0.0685
[INFO] Centroid 40: Short SMA=114.77, Long SMA=195.41, Sharpe=-0.0793
[INFO] Centroid 41: Short SMA=151.90, Long SMA=171.78, Sharpe=-0.1342
[INFO] Centroid 42: Short SMA=26.43, Long SMA=104.03, Sharpe=-0.0798
[INFO] Centroid 43: Short SMA=210.67, Long SMA=224.96, Sharpe=0.1010
[INFO] Centroid 44: Short SMA=278.70, Long SMA=293.64, Sharpe=-0.4450
[INFO] Centroid 45: Short SMA=187.07, Long SMA=283.04, Sharpe=-0.3144
[INFO] Centroid 46: Short SMA=136.36, Long SMA=265.31, Sharpe=-0.2551
[INFO] Centroid 47: Short SMA=27.07, Long SMA=144.30, Sharpe=0.1651
[INFO] Centroid 48: Short SMA=37.31, Long SMA=176.50, Sharpe=-0.0414
[INFO] Centroid 49: Short SMA=97.58, Long SMA=127.39, Sharpe=-0.1622
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=216, Long SMA=222, Sharpe=0.4538, Trades=36
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=218, Long SMA=224, Sharpe=0.4112, Trades=36
[INFO] Kmeans Top 2: Short SMA=26, Long SMA=146, Sharpe=0.2133, Trades=26
[INFO] Kmeans Top 3: Short SMA=24, Long SMA=40, Sharpe=0.1435, Trades=81
[INFO] Kmeans Top 4: Short SMA=216, Long SMA=230, Sharpe=0.1223, Trades=28
[INFO] Kmeans Top 5: Short SMA=18, Long SMA=176, Sharpe=0.0742, Trades=24
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (75, 148)
[INFO]   Nearest: (74.0, 148.0)
[INFO]   Rounded: (162, 250)
[INFO]   Rounded: (229, 257)
[INFO]   Nearest: (230.0, 256.0)
[INFO]   Rounded: (62, 189)
[INFO]   Nearest: (62.0, 188.0)
[INFO]   Rounded: (36, 134)
[INFO]   Rounded: (23, 281)
[INFO]   Nearest: (22.0, 282.0)
[INFO]   Rounded: (33, 63)
[INFO]   Nearest: (34.0, 64.0)
[INFO]   Rounded: (91, 203)
[INFO]   Nearest: (92.0, 204.0)
[INFO]   Rounded: (253, 283)
[INFO]   Nearest: (254.0, 282.0)
[INFO]   Rounded: (60, 95)
[INFO]   Nearest: (60.0, 94.0)
[INFO]   Rounded: (138, 194)
[INFO]   Rounded: (49, 275)
[INFO]   Nearest: (50.0, 276.0)
[INFO]   Rounded: (116, 279)
[INFO]   Nearest: (116.0, 278.0)
[INFO]   Rounded: (115, 145)
[INFO]   Nearest: (114.0, 146.0)
[INFO]   Rounded: (13, 244)
[INFO]   Nearest: (12.0, 244.0)
[INFO]   Rounded: (199, 225)
[INFO]   Nearest: (198.0, 224.0)
[INFO]   Rounded: (55, 71)
[INFO]   Nearest: (56.0, 70.0)
[INFO]   Rounded: (88, 243)
[INFO]   Nearest: (88.0, 242.0)
[INFO]   Rounded: (256, 279)
[INFO]   Nearest: (256.0, 278.0)
[INFO]   Rounded: (110, 161)
[INFO]   Nearest: (110.0, 160.0)
[INFO]   Rounded: (23, 40)
[INFO]   Nearest: (24.0, 40.0)
[INFO]   Rounded: (128, 233)
[INFO]   Nearest: (128.0, 234.0)
[INFO]   Rounded: (53, 95)
[INFO]   Nearest: (54.0, 94.0)
[INFO]   Rounded: (147, 166)
[INFO]   Nearest: (148.0, 166.0)
[INFO]   Rounded: (30, 210)
[INFO]   Rounded: (19, 177)
[INFO]   Nearest: (18.0, 176.0)
[INFO]   Rounded: (162, 283)
[INFO]   Nearest: (162.0, 284.0)
[INFO]   Rounded: (198, 251)
[INFO]   Nearest: (198.0, 252.0)
[INFO]   Rounded: (36, 266)
[INFO]   Rounded: (226, 278)
[INFO]   Rounded: (85, 283)
[INFO]   Nearest: (84.0, 282.0)
[INFO]   Rounded: (216, 222)
[INFO]   Rounded: (173, 205)
[INFO]   Nearest: (172.0, 206.0)
[INFO]   Rounded: (214, 284)
[INFO]   Rounded: (77, 117)
[INFO]   Nearest: (76.0, 116.0)
[INFO]   Rounded: (25, 41)
[INFO]   Nearest: (26.0, 40.0)
[INFO]   Rounded: (177, 218)
[INFO]   Nearest: (178.0, 218.0)
[INFO]   Rounded: (51, 231)
[INFO]   Nearest: (52.0, 232.0)
[INFO]   Rounded: (76, 163)
[INFO]   Nearest: (76.0, 162.0)
[INFO]   Rounded: (25, 64)
[INFO]   Nearest: (24.0, 64.0)
[INFO]   Rounded: (115, 195)
[INFO]   Nearest: (114.0, 196.0)
[INFO]   Rounded: (152, 172)
[INFO]   Rounded: (26, 104)
[INFO]   Rounded: (211, 225)
[INFO]   Nearest: (210.0, 224.0)
[INFO]   Rounded: (279, 294)
[INFO]   Nearest: (278.0, 294.0)
[INFO]   Rounded: (187, 283)
[INFO]   Nearest: (188.0, 284.0)
[INFO]   Rounded: (136, 265)
[INFO]   Nearest: (136.0, 266.0)
[INFO]   Rounded: (27, 144)
[INFO]   Nearest: (28.0, 144.0)
[INFO]   Rounded: (37, 176)
[INFO]   Nearest: (38.0, 176.0)
[INFO]   Rounded: (98, 127)
[INFO]   Nearest: (98.0, 128.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 216, Long SMA: 222
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] File size: 287237 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(218/224) - Original Sharpe: 0.4112, Trades: 36
[INFO] Kmeans cluster 2: SMA(26/146) - Original Sharpe: 0.2133, Trades: 26
[INFO] Kmeans cluster 3: SMA(24/40) - Original Sharpe: 0.1435, Trades: 81
[INFO] Kmeans cluster 4: SMA(216/230) - Original Sharpe: 0.1223, Trades: 28
[INFO] Kmeans cluster 5: SMA(18/176) - Original Sharpe: 0.0742, Trades: 24
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (216/222)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (218/224) - Sharpe: 0.4112
[INFO] cluster 2: (26/146) - Sharpe: 0.2133
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] File size: 287237 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     2.819527            1.050795
1    2021-11-14 2021-11-14            43    -1.145321           -1.145321
2    2022-01-14 2022-01-14            41    -2.030834           -2.708072
3    2022-03-14 2022-03-14            44    -1.744332           -0.148019
4    2022-05-14 2022-05-14            43     3.502737            3.157939
5    2022-07-14 2022-07-14            44    -1.329484           -3.608220
6    2022-09-14 2022-09-14            43     0.741490            0.537385
7    2022-11-14 2022-11-14            43    -0.351982            1.267399
8    2023-01-14 2023-01-14            41     2.520987            0.000000
9    2023-03-14 2023-03-14            44    -1.655688            0.849533
10   2023-05-14 2023-05-14            44    -1.226126           -0.872156
11   2023-07-14 2023-07-14            44    -2.793162           -2.793162
12   2023-09-14 2023-09-14            43    -1.709353           -2.007071
13   2023-11-14 2023-11-14            42    -3.498659           -3.848166
14   2024-01-14 2024-01-14            43     3.360693            3.616636
15   2024-03-14 2024-03-14            42     0.057655            0.057655
16   2024-05-14 2024-05-14            44     3.250284            1.946010
17   2024-07-14 2024-07-14            45    -0.486251           -0.486251
18   2024-09-14 2024-09-14            43     2.886146            2.886146
19   2024-11-14 2024-11-14            33    -2.653916           -2.653916
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          2.8 |              1.1 |         -1.7 | False         
[INFO] 2021-11-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.0 |             -2.7 |         -0.7 | False         
[INFO] 2022-03-14   |         -1.7 |             -0.1 |          1.6 | True          
[INFO] 2022-05-14   |          3.5 |              3.2 |         -0.3 | False         
[INFO] 2022-07-14   |         -1.3 |             -3.6 |         -2.3 | False         
[INFO] 2022-09-14   |          0.7 |              0.5 |         -0.2 | False         
[INFO] 2022-11-14   |         -0.4 |              1.3 |          1.7 | True          
[INFO] 2023-01-14   |          2.5 |              0.0 |         -2.5 | False         
[INFO] 2023-03-14   |         -1.7 |              0.8 |          2.5 | True          
[INFO] 2023-05-14   |         -1.2 |             -0.9 |          0.3 | True          
[INFO] 2023-07-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.7 |             -2.0 |         -0.3 | False         
[INFO] 2023-11-14   |         -3.5 |             -3.8 |         -0.3 | False         
[INFO] 2024-01-14   |          3.4 |              3.6 |          0.2 | True          
[INFO] 2024-03-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-05-14   |          3.3 |              1.9 |         -1.4 | False         
[INFO] 2024-07-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -2.7 |             -2.7 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2023-07-14, 2024-03-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 5 of 14 periods (35.71% win rate)
[INFO] Updating Excel file with Kmeans results for EMD...
[INFO] Excel file updated successfully. Added EMD with Kmeans win rate 35.7% in row 14
[INFO] Added best Sharpe parameters 216/222 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 216, Long SMA: 222
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(218/224) - Original Sharpe: 0.4112
[INFO] Added cluster 2 to portfolio: SMA(26/146) - Original Sharpe: 0.2133
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'EMD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.2906
[INFO] Kmeans Best out-of-sample Sharpe: -0.1673
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for EMD...
[INFO] Excel file updated successfully. Added EMD with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EMD
[INFO] Big Point Value: 100.0
[INFO] Slippage: 55.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] 
Best parameters:
[INFO] Short SMA: 216
[INFO] Long SMA: 222
[INFO] Sharpe Ratio: 0.453823
[INFO] Number of Trades: 36
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10530 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] Trades range: 10.0 to 335.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3944 to 2.7966
[INFO] Scaled Long SMA range: -2.7981 to 1.4094
[INFO] Scaled Sharpe ratio range: -4.0417 to 3.3900
[INFO] Scaled Trades range: -0.6701 to 14.8618
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10530 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4875
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 289 elements
[INFO] Cluster 1: 128 elements
[INFO] Cluster 2: 60 elements
[INFO] Cluster 3: 103 elements
[INFO] Cluster 4: 286 elements
[INFO] Cluster 5: 624 elements
[INFO] Cluster 6: 284 elements
[INFO] Cluster 7: 138 elements
[INFO] Cluster 8: 338 elements
[INFO] Cluster 9: 377 elements
[INFO] Cluster 10: 548 elements
[INFO] Cluster 11: 328 elements
[INFO] Cluster 12: 266 elements
[INFO] Cluster 13: 342 elements
[INFO] Cluster 14: 97 elements
[INFO] Cluster 15: 23 elements
[INFO] Cluster 16: 53 elements
[INFO] Cluster 17: 367 elements
[INFO] Cluster 18: 254 elements
[INFO] Cluster 19: 207 elements
[INFO] Cluster 20: 26 elements
[INFO] Cluster 21: 233 elements
[INFO] Cluster 22: 105 elements
[INFO] Cluster 23: 7 elements
[INFO] Cluster 24: 207 elements
[INFO] Cluster 25: 480 elements
[INFO] Cluster 26: 38 elements
[INFO] Cluster 27: 253 elements
[INFO] Cluster 28: 227 elements
[INFO] Cluster 29: 196 elements
[INFO] Cluster 30: 240 elements
[INFO] Cluster 31: 340 elements
[INFO] Cluster 32: 235 elements
[INFO] Cluster 33: 196 elements
[INFO] Cluster 34: 153 elements
[INFO] Cluster 35: 134 elements
[INFO] Cluster 36: 38 elements
[INFO] Cluster 37: 222 elements
[INFO] Cluster 38: 172 elements
[INFO] Cluster 39: 112 elements
[INFO] Cluster 40: 422 elements
[INFO] Cluster 41: 327 elements
[INFO] Cluster 42: 221 elements
[INFO] Cluster 43: 225 elements
[INFO] Cluster 44: 192 elements
[INFO] Cluster 45: 100 elements
[INFO] Cluster 46: 96 elements
[INFO] Cluster 47: 85 elements
[INFO] Cluster 48: 26 elements
[INFO] Cluster 49: 110 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=116, Long SMA=146, Sharpe=-0.0507, Trades=28
[INFO] Cluster 1 cluster: Short SMA=14, Long SMA=58, Sharpe=0.0551, Trades=67
[INFO] Cluster 2 cluster: Short SMA=148, Long SMA=150, Sharpe=-0.1243, Trades=78
[INFO] Cluster 3 cluster: Short SMA=74, Long SMA=84, Sharpe=-0.4245, Trades=62
[INFO] Cluster 4 cluster: Short SMA=212, Long SMA=272, Sharpe=-0.5165, Trades=13
[INFO] Cluster 5 cluster: Short SMA=134, Long SMA=234, Sharpe=-0.1293, Trades=10
[INFO] Cluster 6 cluster: Short SMA=38, Long SMA=176, Sharpe=-0.0088, Trades=16
[INFO] Cluster 7 cluster: Short SMA=102, Long SMA=114, Sharpe=-0.2518, Trades=42
[INFO] Cluster 8 cluster: Short SMA=36, Long SMA=276, Sharpe=-0.1219, Trades=17
[INFO] Cluster 9 cluster: Short SMA=150, Long SMA=190, Sharpe=-0.2620, Trades=18
[INFO] Cluster 10 cluster: Short SMA=50, Long SMA=230, Sharpe=-0.0733, Trades=12
[INFO] Cluster 11 cluster: Short SMA=56, Long SMA=98, Sharpe=-0.1603, Trades=34
[INFO] Cluster 12 cluster: Short SMA=66, Long SMA=122, Sharpe=-0.0615, Trades=28
[INFO] Cluster 13 cluster: Short SMA=28, Long SMA=96, Sharpe=-0.1026, Trades=38
[INFO] Cluster 14 cluster: Short SMA=26, Long SMA=38, Sharpe=-0.0390, Trades=93
[INFO] Cluster 15 cluster: Short SMA=36, Long SMA=38, Sharpe=-0.0742, Trades=179
[INFO] Cluster 16 cluster: Short SMA=196, Long SMA=202, Sharpe=0.0690, Trades=53
[INFO] Cluster 17 cluster: Short SMA=158, Long SMA=272, Sharpe=-0.1801, Trades=11
[INFO] Cluster 18 cluster: Short SMA=190, Long SMA=252, Sharpe=-0.2075, Trades=10
[INFO] Cluster 19 cluster: Short SMA=28, Long SMA=64, Sharpe=-0.0352, Trades=50
[INFO] Cluster 20 cluster: Short SMA=16, Long SMA=22, Sharpe=-0.5247, Trades=143
[INFO] Cluster 21 cluster: Short SMA=256, Long SMA=290, Sharpe=-0.5859, Trades=17
[INFO] Cluster 22 cluster: Short SMA=214, Long SMA=230, Sharpe=0.1704, Trades=30
[INFO] Cluster 24 cluster: Short SMA=130, Long SMA=272, Sharpe=-0.2357, Trades=13
[INFO] Cluster 25 cluster: Short SMA=90, Long SMA=210, Sharpe=0.0071, Trades=12
[INFO] Cluster 26 cluster: Short SMA=22, Long SMA=32, Sharpe=0.1813, Trades=111
[INFO] Cluster 27 cluster: Short SMA=80, Long SMA=142, Sharpe=-0.3009, Trades=26
[INFO] Cluster 28 cluster: Short SMA=184, Long SMA=286, Sharpe=-0.2548, Trades=11
[INFO] Cluster 29 cluster: Short SMA=172, Long SMA=194, Sharpe=-0.1715, Trades=26
[INFO] Cluster 30 cluster: Short SMA=112, Long SMA=280, Sharpe=-0.1264, Trades=11
[INFO] Cluster 31 cluster: Short SMA=58, Long SMA=274, Sharpe=-0.1375, Trades=15
[INFO] Cluster 32 cluster: Short SMA=118, Long SMA=190, Sharpe=-0.1347, Trades=14
[INFO] Cluster 33 cluster: Short SMA=184, Long SMA=228, Sharpe=-0.0527, Trades=14
[INFO] Cluster 34 cluster: Short SMA=12, Long SMA=244, Sharpe=0.1334, Trades=26
[INFO] Cluster 35 cluster: Short SMA=248, Long SMA=258, Sharpe=-0.3545, Trades=32
[INFO] Cluster 36 cluster: Short SMA=270, Long SMA=272, Sharpe=-0.7611, Trades=65
[INFO] Cluster 37 cluster: Short SMA=108, Long SMA=164, Sharpe=0.0086, Trades=16
[INFO] Cluster 38 cluster: Short SMA=20, Long SMA=154, Sharpe=0.1176, Trades=28
[INFO] Cluster 39 cluster: Short SMA=260, Long SMA=276, Sharpe=-0.7198, Trades=23
[INFO] Cluster 40 cluster: Short SMA=86, Long SMA=264, Sharpe=-0.0324, Trades=12
[INFO] Cluster 41 cluster: Short SMA=68, Long SMA=182, Sharpe=-0.1983, Trades=14
[INFO] Cluster 42 cluster: Short SMA=28, Long SMA=202, Sharpe=-0.0977, Trades=18
[INFO] Cluster 43 cluster: Short SMA=42, Long SMA=146, Sharpe=0.0910, Trades=20
[INFO] Cluster 44 cluster: Short SMA=226, Long SMA=278, Sharpe=-0.6763, Trades=15
[INFO] Cluster 45 cluster: Short SMA=212, Long SMA=230, Sharpe=-0.0355, Trades=26
[INFO] Cluster 46 cluster: Short SMA=16, Long SMA=138, Sharpe=0.0400, Trades=38
[INFO] Cluster 47 cluster: Short SMA=16, Long SMA=284, Sharpe=-0.0382, Trades=21
[INFO] Cluster 48 cluster: Short SMA=88, Long SMA=90, Sharpe=-0.2417, Trades=110
[INFO] Cluster 49 cluster: Short SMA=152, Long SMA=160, Sharpe=-0.2035, Trades=44
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=216, Long SMA=222, Sharpe=0.4538, Trades=36
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=22, Long SMA=32, Sharpe=0.1813, Trades=111
[INFO] Top 2: Short SMA=214, Long SMA=230, Sharpe=0.1704, Trades=30
[INFO] Top 3: Short SMA=12, Long SMA=244, Sharpe=0.1334, Trades=26
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10523 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 216, Long SMA: 222
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] File size: 287237 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(22/32) - Original Sharpe: 0.1813, Trades: 111
[INFO] Hierarchical cluster 2: SMA(214/230) - Original Sharpe: 0.1704, Trades: 30
[INFO] Hierarchical cluster 3: SMA(12/244) - Original Sharpe: 0.1334, Trades: 26
[INFO] Hierarchical cluster 4: SMA(20/154) - Original Sharpe: 0.1176, Trades: 28
[INFO] Hierarchical cluster 5: SMA(42/146) - Original Sharpe: 0.0910, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (216/222)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 216, Long SMA: 222
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EMD
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for ES in column D: 13.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 146.38s
[INFO] Best parameters: Short SMA = 162, Long SMA = 274
[INFO] Best Sharpe ratio: 0.900987, Trades: 9
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @ES
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.31 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $510,692.50
[INFO] Market Buy & Hold P&L: $187,962.50
[INFO] Outperformance: $322,730.00
[INFO] Sharpe ratio (entire period, annualized): 0.672117
[INFO] Sharpe ratio (in-sample, annualized): 0.900987
[INFO] Sharpe ratio (out-of-sample, annualized): 0.183475
[INFO] Maximum Drawdown: $136,852.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 7
[INFO] Out-of-sample period trades: 2
[INFO] Total trades: 9
[INFO] In-sample P&L: $574,895.00
[INFO] Out-of-sample P&L: $54,647.50
[INFO] 
Best parameters from GA: Short SMA = 162, Long SMA = 274, Sharpe = 0.900987
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3535 to 0.9010
[INFO] 
Best parameters:
[INFO] Short SMA: 162
[INFO] Long SMA: 274
[INFO] Sharpe Ratio: 0.900987
[INFO] Number of Trades: 9
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7619 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3535 to 0.8709
[INFO] Trades range: 10.0 to 333.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1625 to 2.6459
[INFO] Scaled Long SMA range: -2.4904 to 1.6638
[INFO] Scaled Sharpe ratio range: -4.7529 to 3.5059
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 179 elements
[INFO] Kmeans Cluster 1: 80 elements
[INFO] Kmeans Cluster 2: 184 elements
[INFO] Kmeans Cluster 3: 151 elements
[INFO] Kmeans Cluster 4: 226 elements
[INFO] Kmeans Cluster 5: 59 elements
[INFO] Kmeans Cluster 6: 190 elements
[INFO] Kmeans Cluster 7: 48 elements
[INFO] Kmeans Cluster 8: 129 elements
[INFO] Kmeans Cluster 9: 75 elements
[INFO] Kmeans Cluster 10: 167 elements
[INFO] Kmeans Cluster 11: 229 elements
[INFO] Kmeans Cluster 12: 199 elements
[INFO] Kmeans Cluster 13: 234 elements
[INFO] Kmeans Cluster 14: 230 elements
[INFO] Kmeans Cluster 15: 121 elements
[INFO] Kmeans Cluster 16: 216 elements
[INFO] Kmeans Cluster 17: 126 elements
[INFO] Kmeans Cluster 18: 51 elements
[INFO] Kmeans Cluster 19: 243 elements
[INFO] Kmeans Cluster 20: 98 elements
[INFO] Kmeans Cluster 21: 119 elements
[INFO] Kmeans Cluster 22: 125 elements
[INFO] Kmeans Cluster 23: 74 elements
[INFO] Kmeans Cluster 24: 214 elements
[INFO] Kmeans Cluster 25: 108 elements
[INFO] Kmeans Cluster 26: 174 elements
[INFO] Kmeans Cluster 27: 186 elements
[INFO] Kmeans Cluster 28: 118 elements
[INFO] Kmeans Cluster 29: 186 elements
[INFO] Kmeans Cluster 30: 65 elements
[INFO] Kmeans Cluster 31: 156 elements
[INFO] Kmeans Cluster 32: 187 elements
[INFO] Kmeans Cluster 33: 143 elements
[INFO] Kmeans Cluster 34: 176 elements
[INFO] Kmeans Cluster 35: 102 elements
[INFO] Kmeans Cluster 36: 125 elements
[INFO] Kmeans Cluster 37: 197 elements
[INFO] Kmeans Cluster 38: 97 elements
[INFO] Kmeans Cluster 39: 240 elements
[INFO] Kmeans Cluster 40: 174 elements
[INFO] Kmeans Cluster 41: 128 elements
[INFO] Kmeans Cluster 42: 177 elements
[INFO] Kmeans Cluster 43: 51 elements
[INFO] Kmeans Cluster 44: 151 elements
[INFO] Kmeans Cluster 45: 137 elements
[INFO] Kmeans Cluster 46: 197 elements
[INFO] Kmeans Cluster 47: 164 elements
[INFO] Kmeans Cluster 48: 166 elements
[INFO] Kmeans Cluster 49: 247 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=110.72, Long SMA=163.71, Sharpe=0.2391
[INFO] Centroid 1: Short SMA=277.03, Long SMA=289.60, Sharpe=0.5522
[INFO] Centroid 2: Short SMA=25.75, Long SMA=130.05, Sharpe=0.3804
[INFO] Centroid 3: Short SMA=40.37, Long SMA=246.16, Sharpe=0.3587
[INFO] Centroid 4: Short SMA=175.75, Long SMA=206.88, Sharpe=0.5733
[INFO] Centroid 5: Short SMA=25.56, Long SMA=107.80, Sharpe=0.1113
[INFO] Centroid 6: Short SMA=67.28, Long SMA=103.39, Sharpe=0.1936
[INFO] Centroid 7: Short SMA=245.08, Long SMA=267.54, Sharpe=0.2413
[INFO] Centroid 8: Short SMA=145.43, Long SMA=162.74, Sharpe=0.3913
[INFO] Centroid 9: Short SMA=26.56, Long SMA=67.04, Sharpe=0.5620
[INFO] Centroid 10: Short SMA=192.75, Long SMA=224.68, Sharpe=0.6929
[INFO] Centroid 11: Short SMA=45.44, Long SMA=88.93, Sharpe=0.2961
[INFO] Centroid 12: Short SMA=22.88, Long SMA=181.67, Sharpe=0.4098
[INFO] Centroid 13: Short SMA=42.90, Long SMA=203.91, Sharpe=0.3144
[INFO] Centroid 14: Short SMA=133.42, Long SMA=197.79, Sharpe=0.3953
[INFO] Centroid 15: Short SMA=64.58, Long SMA=278.18, Sharpe=0.2404
[INFO] Centroid 16: Short SMA=123.92, Long SMA=163.00, Sharpe=0.3031
[INFO] Centroid 17: Short SMA=28.33, Long SMA=285.03, Sharpe=0.4470
[INFO] Centroid 18: Short SMA=24.82, Long SMA=37.06, Sharpe=-0.1295
[INFO] Centroid 19: Short SMA=62.69, Long SMA=161.95, Sharpe=0.2577
[INFO] Centroid 20: Short SMA=92.53, Long SMA=161.94, Sharpe=0.1336
[INFO] Centroid 21: Short SMA=263.23, Long SMA=289.09, Sharpe=0.4694
[INFO] Centroid 22: Short SMA=216.05, Long SMA=235.78, Sharpe=0.5274
[INFO] Centroid 23: Short SMA=61.65, Long SMA=91.76, Sharpe=-0.0251
[INFO] Centroid 24: Short SMA=38.81, Long SMA=165.07, Sharpe=0.3263
[INFO] Centroid 25: Short SMA=76.09, Long SMA=93.13, Sharpe=0.0867
[INFO] Centroid 26: Short SMA=47.60, Long SMA=272.44, Sharpe=0.3119
[INFO] Centroid 27: Short SMA=31.62, Long SMA=60.59, Sharpe=0.3453
[INFO] Centroid 28: Short SMA=16.53, Long SMA=204.08, Sharpe=0.5019
[INFO] Centroid 29: Short SMA=53.59, Long SMA=139.10, Sharpe=0.1759
[INFO] Centroid 30: Short SMA=192.18, Long SMA=215.69, Sharpe=0.7784
[INFO] Centroid 31: Short SMA=60.69, Long SMA=200.64, Sharpe=0.2153
[INFO] Centroid 32: Short SMA=252.70, Long SMA=277.38, Sharpe=0.3784
[INFO] Centroid 33: Short SMA=199.22, Long SMA=236.99, Sharpe=0.6238
[INFO] Centroid 34: Short SMA=156.35, Long SMA=213.15, Sharpe=0.4785
[INFO] Centroid 35: Short SMA=14.61, Long SMA=270.75, Sharpe=0.5368
[INFO] Centroid 36: Short SMA=92.78, Long SMA=125.41, Sharpe=0.3372
[INFO] Centroid 37: Short SMA=53.55, Long SMA=237.33, Sharpe=0.2805
[INFO] Centroid 38: Short SMA=226.93, Long SMA=291.07, Sharpe=0.5723
[INFO] Centroid 39: Short SMA=226.46, Long SMA=262.40, Sharpe=0.4386
[INFO] Centroid 40: Short SMA=29.63, Long SMA=126.26, Sharpe=0.2628
[INFO] Centroid 41: Short SMA=28.77, Long SMA=55.73, Sharpe=0.2189
[INFO] Centroid 42: Short SMA=21.71, Long SMA=234.64, Sharpe=0.4291
[INFO] Centroid 43: Short SMA=27.41, Long SMA=42.20, Sharpe=0.0865
[INFO] Centroid 44: Short SMA=25.01, Long SMA=78.20, Sharpe=0.4495
[INFO] Centroid 45: Short SMA=219.08, Long SMA=263.26, Sharpe=0.3465
[INFO] Centroid 46: Short SMA=153.86, Long SMA=182.31, Sharpe=0.3058
[INFO] Centroid 47: Short SMA=110.90, Long SMA=139.13, Sharpe=0.1934
[INFO] Centroid 48: Short SMA=37.12, Long SMA=283.77, Sharpe=0.3766
[INFO] Centroid 49: Short SMA=88.37, Long SMA=127.72, Sharpe=0.2551
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=162, Long SMA=274, Sharpe=0.9010, Trades=9
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=194, Long SMA=220, Sharpe=0.8709, Trades=16
[INFO] Kmeans Top 2: Short SMA=192, Long SMA=228, Sharpe=0.7036, Trades=12
[INFO] Kmeans Top 3: Short SMA=200, Long SMA=238, Sharpe=0.6555, Trades=12
[INFO] Kmeans Top 4: Short SMA=20, Long SMA=64, Sharpe=0.6266, Trades=44
[INFO] Kmeans Top 5: Short SMA=176, Long SMA=210, Sharpe=0.6235, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (111, 164)
[INFO]   Nearest: (110.0, 164.0)
[INFO]   Rounded: (277, 290)
[INFO]   Nearest: (278.0, 290.0)
[INFO]   Rounded: (26, 130)
[INFO]   Rounded: (40, 246)
[INFO]   Rounded: (176, 207)
[INFO]   Nearest: (176.0, 206.0)
[INFO]   Rounded: (26, 108)
[INFO]   Rounded: (67, 103)
[INFO]   Nearest: (68.0, 104.0)
[INFO]   Rounded: (245, 268)
[INFO]   Nearest: (246.0, 268.0)
[INFO]   Rounded: (145, 163)
[INFO]   Nearest: (146.0, 162.0)
[INFO]   Rounded: (27, 67)
[INFO]   Nearest: (26.0, 68.0)
[INFO]   Rounded: (193, 225)
[INFO]   Nearest: (192.0, 224.0)
[INFO]   Rounded: (45, 89)
[INFO]   Nearest: (46.0, 88.0)
[INFO]   Rounded: (23, 182)
[INFO]   Nearest: (22.0, 182.0)
[INFO]   Rounded: (43, 204)
[INFO]   Nearest: (42.0, 204.0)
[INFO]   Rounded: (133, 198)
[INFO]   Nearest: (134.0, 198.0)
[INFO]   Rounded: (65, 278)
[INFO]   Nearest: (64.0, 278.0)
[INFO]   Rounded: (124, 163)
[INFO]   Nearest: (124.0, 162.0)
[INFO]   Rounded: (28, 285)
[INFO]   Nearest: (28.0, 286.0)
[INFO]   Rounded: (25, 37)
[INFO]   Nearest: (24.0, 38.0)
[INFO]   Rounded: (63, 162)
[INFO]   Nearest: (62.0, 162.0)
[INFO]   Rounded: (93, 162)
[INFO]   Nearest: (92.0, 162.0)
[INFO]   Rounded: (263, 289)
[INFO]   Nearest: (264.0, 290.0)
[INFO]   Rounded: (216, 236)
[INFO]   Rounded: (62, 92)
[INFO]   Rounded: (39, 165)
[INFO]   Nearest: (38.0, 166.0)
[INFO]   Rounded: (76, 93)
[INFO]   Nearest: (76.0, 94.0)
[INFO]   Rounded: (48, 272)
[INFO]   Rounded: (32, 61)
[INFO]   Nearest: (32.0, 60.0)
[INFO]   Rounded: (17, 204)
[INFO]   Nearest: (16.0, 204.0)
[INFO]   Rounded: (54, 139)
[INFO]   Nearest: (54.0, 140.0)
[INFO]   Rounded: (192, 216)
[INFO]   Rounded: (61, 201)
[INFO]   Nearest: (60.0, 200.0)
[INFO]   Rounded: (253, 277)
[INFO]   Nearest: (252.0, 278.0)
[INFO]   Rounded: (199, 237)
[INFO]   Nearest: (200.0, 236.0)
[INFO]   Rounded: (156, 213)
[INFO]   Nearest: (156.0, 214.0)
[INFO]   Rounded: (15, 271)
[INFO]   Nearest: (14.0, 270.0)
[INFO]   Rounded: (93, 125)
[INFO]   Nearest: (92.0, 126.0)
[INFO]   Rounded: (54, 237)
[INFO]   Nearest: (54.0, 238.0)
[INFO]   Rounded: (227, 291)
[INFO]   Nearest: (226.0, 292.0)
[INFO]   Rounded: (226, 262)
[INFO]   Rounded: (30, 126)
[INFO]   Rounded: (29, 56)
[INFO]   Nearest: (28.0, 56.0)
[INFO]   Rounded: (22, 235)
[INFO]   Nearest: (22.0, 234.0)
[INFO]   Rounded: (27, 42)
[INFO]   Nearest: (28.0, 42.0)
[INFO]   Rounded: (25, 78)
[INFO]   Nearest: (26.0, 78.0)
[INFO]   Rounded: (219, 263)
[INFO]   Nearest: (220.0, 264.0)
[INFO]   Rounded: (154, 182)
[INFO]   Rounded: (111, 139)
[INFO]   Nearest: (110.0, 140.0)
[INFO]   Rounded: (37, 284)
[INFO]   Nearest: (38.0, 284.0)
[INFO]   Rounded: (88, 128)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 162, Long SMA: 274
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(194/220) - Original Sharpe: 0.8709, Trades: 16
[INFO] Kmeans cluster 2: SMA(192/228) - Original Sharpe: 0.7036, Trades: 12
[INFO] Kmeans cluster 3: SMA(200/238) - Original Sharpe: 0.6555, Trades: 12
[INFO] Kmeans cluster 4: SMA(20/64) - Original Sharpe: 0.6266, Trades: 44
[INFO] Kmeans cluster 5: SMA(176/210) - Original Sharpe: 0.6235, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (162/274)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (194/220) - Sharpe: 0.8709
[INFO] cluster 2: (192/228) - Sharpe: 0.7036
[INFO] cluster 3: (200/238) - Sharpe: 0.6555
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.911391            0.911391
1    2021-11-14 2021-11-14            43    -0.628261           -0.628261
2    2022-01-14 2022-01-14            41    -2.812439           -2.812439
3    2022-03-14 2022-03-14            44    -0.960414           -0.960414
4    2022-05-14 2022-05-14            43     0.052587            1.028282
5    2022-07-14 2022-07-14            44    -0.911692           -0.911692
6    2022-09-14 2022-09-14            43    -0.232210           -0.232210
7    2022-11-14 2022-11-14            43     0.093646            0.093646
8    2023-01-14 2023-01-14            41     1.619125            1.619125
9    2023-03-14 2023-03-14            44    -1.939764           -2.126196
10   2023-05-14 2023-05-14            44     2.318419           -1.753136
11   2023-07-14 2023-07-14            44    -0.689668           -0.689668
12   2023-09-14 2023-09-14            43    -1.587437           -1.587437
13   2023-11-14 2023-11-14            42     3.878695            3.878695
14   2024-01-14 2024-01-14            43     3.930264            3.930264
15   2024-03-14 2024-03-14            42    -0.498348           -0.498348
16   2024-05-14 2024-05-14            44     4.604239            4.604239
17   2024-07-14 2024-07-14            45    -0.424050           -0.424050
18   2024-09-14 2024-09-14            43     2.451837            2.451837
19   2024-11-14 2024-11-14            33    -1.823399           -1.823399
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.1 |              1.0 |          0.9 | True          
[INFO] 2022-07-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -1.9 |             -2.1 |         -0.2 | False         
[INFO] 2023-05-14   |          2.3 |             -1.8 |         -4.1 | False         
[INFO] 2023-07-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 3
[INFO] Kmeans cluster wins (rounded comparison): 1 of 3 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for ES...
[INFO] Excel file updated successfully. Added ES with Kmeans win rate 33.3% in row 15
[INFO] Added best Sharpe parameters 162/274 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 162, Long SMA: 274
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(194/220) - Original Sharpe: 0.8709
[INFO] Added cluster 2 to portfolio: SMA(192/228) - Original Sharpe: 0.7036
[INFO] Added cluster 3 to portfolio: SMA(200/238) - Original Sharpe: 0.6555
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ES_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0792
[INFO] Kmeans Best out-of-sample Sharpe: 0.1835
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for ES...
[INFO] Excel file updated successfully. Added ES with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ES
[INFO] Big Point Value: 50.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3535 to 0.9010
[INFO] 
Best parameters:
[INFO] Short SMA: 162
[INFO] Long SMA: 274
[INFO] Sharpe Ratio: 0.900987
[INFO] Number of Trades: 9
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7619 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3535 to 0.8709
[INFO] Trades range: 10.0 to 333.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1625 to 2.6459
[INFO] Scaled Long SMA range: -2.4904 to 1.6638
[INFO] Scaled Sharpe ratio range: -4.7529 to 3.5059
[INFO] Scaled Trades range: -0.6029 to 16.9141
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 7619 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6710
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 85 elements
[INFO] Cluster 1: 214 elements
[INFO] Cluster 2: 107 elements
[INFO] Cluster 3: 411 elements
[INFO] Cluster 4: 361 elements
[INFO] Cluster 5: 285 elements
[INFO] Cluster 6: 104 elements
[INFO] Cluster 7: 138 elements
[INFO] Cluster 8: 198 elements
[INFO] Cluster 9: 291 elements
[INFO] Cluster 10: 262 elements
[INFO] Cluster 11: 229 elements
[INFO] Cluster 12: 253 elements
[INFO] Cluster 13: 292 elements
[INFO] Cluster 14: 97 elements
[INFO] Cluster 15: 203 elements
[INFO] Cluster 16: 79 elements
[INFO] Cluster 17: 41 elements
[INFO] Cluster 18: 35 elements
[INFO] Cluster 19: 311 elements
[INFO] Cluster 20: 9 elements
[INFO] Cluster 21: 77 elements
[INFO] Cluster 22: 203 elements
[INFO] Cluster 23: 68 elements
[INFO] Cluster 24: 253 elements
[INFO] Cluster 25: 34 elements
[INFO] Cluster 26: 218 elements
[INFO] Cluster 27: 321 elements
[INFO] Cluster 28: 270 elements
[INFO] Cluster 29: 183 elements
[INFO] Cluster 30: 200 elements
[INFO] Cluster 31: 133 elements
[INFO] Cluster 32: 2 elements
[INFO] Cluster 33: 26 elements
[INFO] Cluster 34: 88 elements
[INFO] Cluster 35: 42 elements
[INFO] Cluster 36: 166 elements
[INFO] Cluster 37: 172 elements
[INFO] Cluster 38: 217 elements
[INFO] Cluster 39: 10 elements
[INFO] Cluster 40: 64 elements
[INFO] Cluster 41: 95 elements
[INFO] Cluster 42: 110 elements
[INFO] Cluster 43: 68 elements
[INFO] Cluster 44: 114 elements
[INFO] Cluster 45: 96 elements
[INFO] Cluster 46: 185 elements
[INFO] Cluster 47: 55 elements
[INFO] Cluster 48: 123 elements
[INFO] Cluster 49: 21 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=78, Long SMA=88, Sharpe=0.0344, Trades=42
[INFO] Cluster 1 cluster: Short SMA=202, Long SMA=240, Sharpe=0.6069, Trades=14
[INFO] Cluster 2 cluster: Short SMA=210, Long SMA=214, Sharpe=0.4890, Trades=44
[INFO] Cluster 3 cluster: Short SMA=42, Long SMA=276, Sharpe=0.3357, Trades=11
[INFO] Cluster 4 cluster: Short SMA=104, Long SMA=152, Sharpe=0.2369, Trades=16
[INFO] Cluster 5 cluster: Short SMA=44, Long SMA=106, Sharpe=0.2968, Trades=20
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=40, Sharpe=0.1497, Trades=72
[INFO] Cluster 7 cluster: Short SMA=22, Long SMA=80, Sharpe=0.3603, Trades=42
[INFO] Cluster 8 cluster: Short SMA=86, Long SMA=134, Sharpe=0.2960, Trades=16
[INFO] Cluster 9 cluster: Short SMA=50, Long SMA=236, Sharpe=0.3781, Trades=10
[INFO] Cluster 10 cluster: Short SMA=32, Long SMA=132, Sharpe=0.3128, Trades=18
[INFO] Cluster 11 cluster: Short SMA=126, Long SMA=180, Sharpe=0.2591, Trades=12
[INFO] Cluster 12 cluster: Short SMA=66, Long SMA=186, Sharpe=0.2242, Trades=10
[INFO] Cluster 13 cluster: Short SMA=138, Long SMA=166, Sharpe=0.4052, Trades=16
[INFO] Cluster 14 cluster: Short SMA=250, Long SMA=258, Sharpe=0.3445, Trades=26
[INFO] Cluster 15 cluster: Short SMA=16, Long SMA=272, Sharpe=0.4970, Trades=17
[INFO] Cluster 16 cluster: Short SMA=120, Long SMA=130, Sharpe=0.5726, Trades=32
[INFO] Cluster 17 cluster: Short SMA=134, Long SMA=138, Sharpe=0.3516, Trades=46
[INFO] Cluster 18 cluster: Short SMA=32, Long SMA=36, Sharpe=0.2530, Trades=113
[INFO] Cluster 19 cluster: Short SMA=240, Long SMA=274, Sharpe=0.4151, Trades=13
[INFO] Cluster 21 cluster: Short SMA=12, Long SMA=132, Sharpe=0.3278, Trades=32
[INFO] Cluster 22 cluster: Short SMA=190, Long SMA=224, Sharpe=0.6978, Trades=14
[INFO] Cluster 23 cluster: Short SMA=216, Long SMA=262, Sharpe=0.2952, Trades=12
[INFO] Cluster 24 cluster: Short SMA=24, Long SMA=190, Sharpe=0.4247, Trades=14
[INFO] Cluster 25 cluster: Short SMA=40, Long SMA=46, Sharpe=0.5802, Trades=76
[INFO] Cluster 26 cluster: Short SMA=176, Long SMA=212, Sharpe=0.5942, Trades=14
[INFO] Cluster 27 cluster: Short SMA=48, Long SMA=164, Sharpe=0.2712, Trades=14
[INFO] Cluster 28 cluster: Short SMA=62, Long SMA=134, Sharpe=0.2282, Trades=14
[INFO] Cluster 29 cluster: Short SMA=66, Long SMA=98, Sharpe=0.1766, Trades=24
[INFO] Cluster 30 cluster: Short SMA=224, Long SMA=272, Sharpe=0.4509, Trades=13
[INFO] Cluster 31 cluster: Short SMA=66, Long SMA=280, Sharpe=0.2091, Trades=11
[INFO] Cluster 33 cluster: Short SMA=14, Long SMA=34, Sharpe=-0.0245, Trades=87
[INFO] Cluster 34 cluster: Short SMA=24, Long SMA=52, Sharpe=0.3069, Trades=56
[INFO] Cluster 35 cluster: Short SMA=282, Long SMA=286, Sharpe=0.5461, Trades=29
[INFO] Cluster 36 cluster: Short SMA=24, Long SMA=246, Sharpe=0.4037, Trades=16
[INFO] Cluster 37 cluster: Short SMA=152, Long SMA=212, Sharpe=0.4987, Trades=12
[INFO] Cluster 38 cluster: Short SMA=134, Long SMA=198, Sharpe=0.4453, Trades=10
[INFO] Cluster 40 cluster: Short SMA=70, Long SMA=98, Sharpe=0.0235, Trades=26
[INFO] Cluster 41 cluster: Short SMA=104, Long SMA=120, Sharpe=0.2737, Trades=24
[INFO] Cluster 42 cluster: Short SMA=14, Long SMA=208, Sharpe=0.4733, Trades=16
[INFO] Cluster 43 cluster: Short SMA=226, Long SMA=292, Sharpe=0.6233, Trades=13
[INFO] Cluster 44 cluster: Short SMA=38, Long SMA=66, Sharpe=0.3151, Trades=44
[INFO] Cluster 45 cluster: Short SMA=42, Long SMA=82, Sharpe=0.3643, Trades=28
[INFO] Cluster 46 cluster: Short SMA=44, Long SMA=200, Sharpe=0.2641, Trades=12
[INFO] Cluster 47 cluster: Short SMA=20, Long SMA=60, Sharpe=0.5871, Trades=46
[INFO] Cluster 48 cluster: Short SMA=270, Long SMA=292, Sharpe=0.5976, Trades=13
[INFO] Cluster 49 cluster: Short SMA=12, Long SMA=24, Sharpe=-0.0446, Trades=123
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=162, Long SMA=274, Sharpe=0.9010, Trades=9
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=190, Long SMA=224, Sharpe=0.6978, Trades=14
[INFO] Top 2: Short SMA=226, Long SMA=292, Sharpe=0.6233, Trades=13
[INFO] Top 3: Short SMA=202, Long SMA=240, Sharpe=0.6069, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 7598 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 162, Long SMA: 274
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(190/224) - Original Sharpe: 0.6978, Trades: 14
[INFO] Hierarchical cluster 2: SMA(226/292) - Original Sharpe: 0.6233, Trades: 13
[INFO] Hierarchical cluster 3: SMA(202/240) - Original Sharpe: 0.6069, Trades: 14
[INFO] Hierarchical cluster 4: SMA(270/292) - Original Sharpe: 0.5976, Trades: 13
[INFO] Hierarchical cluster 5: SMA(176/212) - Original Sharpe: 0.5942, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (162/274)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (190/224) - Sharpe: 0.6978
[INFO] cluster 2: (226/292) - Sharpe: 0.6233
[INFO] cluster 3: (202/240) - Sharpe: 0.6069
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.911391            0.911391
1    2021-11-14 2021-11-14            43    -0.628261           -0.628261
2    2022-01-14 2022-01-14            41    -2.812439           -2.812439
3    2022-03-14 2022-03-14            44    -0.960414           -0.960414
4    2022-05-14 2022-05-14            43     0.052587           -0.428037
5    2022-07-14 2022-07-14            44    -0.911692           -0.218178
6    2022-09-14 2022-09-14            43    -0.232210           -0.232210
7    2022-11-14 2022-11-14            43     0.093646            0.093646
8    2023-01-14 2023-01-14            41     1.619125            1.619125
9    2023-03-14 2023-03-14            44    -1.939764           -3.852542
10   2023-05-14 2023-05-14            44     2.318419           -3.577272
11   2023-07-14 2023-07-14            44    -0.689668           -1.140430
12   2023-09-14 2023-09-14            43    -1.587437           -1.587437
13   2023-11-14 2023-11-14            42     3.878695            3.878695
14   2024-01-14 2024-01-14            43     3.930264            3.930264
15   2024-03-14 2024-03-14            42    -0.498348           -0.498348
16   2024-05-14 2024-05-14            44     4.604239            4.604239
17   2024-07-14 2024-07-14            45    -0.424050           -0.424050
18   2024-09-14 2024-09-14            43     2.451837            2.451837
19   2024-11-14 2024-11-14            33    -1.823399           -1.823399
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.1 |             -0.4 |         -0.5 | False         
[INFO] 2022-07-14   |         -0.9 |             -0.2 |          0.7 | True          
[INFO] 2022-09-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -1.9 |             -3.9 |         -2.0 | False         
[INFO] 2023-05-14   |          2.3 |             -3.6 |         -5.9 | False         
[INFO] 2023-07-14   |         -0.7 |             -1.1 |         -0.4 | False         
[INFO] 2023-09-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 5
[INFO] Hierarchical cluster wins (rounded comparison): 1 of 5 periods (20.00% win rate)
[INFO] Updating Excel file with Hierarchical results for ES...
[INFO] Excel file updated successfully. Added ES with Hierarchical win rate 20.0% in row 15
[INFO] Added best Sharpe parameters 162/274 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 162, Long SMA: 274
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(190/224) - Original Sharpe: 0.6978
[INFO] Added cluster 2 to portfolio: SMA(226/292) - Original Sharpe: 0.6233
[INFO] Added cluster 3 to portfolio: SMA(202/240) - Original Sharpe: 0.6069
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ES_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0128
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1835
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for ES...
[INFO] Excel file updated successfully. Added ES with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ES
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FC in column D: 25.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 109.74s
[INFO] Best parameters: Short SMA = 212, Long SMA = 214
[INFO] Best Sharpe ratio: 0.759717, Trades: 91
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FC
[INFO] Big Point Value (from data): 500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.42 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $335,425.00
[INFO] Market Buy & Hold P&L: $4,212.50
[INFO] Outperformance: $331,212.50
[INFO] Sharpe ratio (entire period, annualized): 0.465159
[INFO] Sharpe ratio (in-sample, annualized): 0.759717
[INFO] Sharpe ratio (out-of-sample, annualized): -0.209532
[INFO] Maximum Drawdown: $225,162.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 56
[INFO] Out-of-sample period trades: 35
[INFO] Total trades: 91
[INFO] In-sample P&L: $438,112.50
[INFO] Out-of-sample P&L: $-52,725.00
[INFO] 
Best parameters from GA: Short SMA = 212, Long SMA = 214, Sharpe = 0.759717
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 500.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4652 to 0.7597
[INFO] 
Best parameters:
[INFO] Short SMA: 212
[INFO] Long SMA: 214
[INFO] Sharpe Ratio: 0.759717
[INFO] Number of Trades: 91
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4652 to 0.7597
[INFO] Trades range: 10.0 to 377.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6102 to 4.0054
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 309 elements
[INFO] Kmeans Cluster 1: 228 elements
[INFO] Kmeans Cluster 2: 300 elements
[INFO] Kmeans Cluster 3: 103 elements
[INFO] Kmeans Cluster 4: 234 elements
[INFO] Kmeans Cluster 5: 226 elements
[INFO] Kmeans Cluster 6: 318 elements
[INFO] Kmeans Cluster 7: 128 elements
[INFO] Kmeans Cluster 8: 294 elements
[INFO] Kmeans Cluster 9: 179 elements
[INFO] Kmeans Cluster 10: 301 elements
[INFO] Kmeans Cluster 11: 235 elements
[INFO] Kmeans Cluster 12: 196 elements
[INFO] Kmeans Cluster 13: 80 elements
[INFO] Kmeans Cluster 14: 204 elements
[INFO] Kmeans Cluster 15: 191 elements
[INFO] Kmeans Cluster 16: 243 elements
[INFO] Kmeans Cluster 17: 259 elements
[INFO] Kmeans Cluster 18: 202 elements
[INFO] Kmeans Cluster 19: 132 elements
[INFO] Kmeans Cluster 20: 202 elements
[INFO] Kmeans Cluster 21: 220 elements
[INFO] Kmeans Cluster 22: 226 elements
[INFO] Kmeans Cluster 23: 155 elements
[INFO] Kmeans Cluster 24: 285 elements
[INFO] Kmeans Cluster 25: 249 elements
[INFO] Kmeans Cluster 26: 161 elements
[INFO] Kmeans Cluster 27: 173 elements
[INFO] Kmeans Cluster 28: 161 elements
[INFO] Kmeans Cluster 29: 295 elements
[INFO] Kmeans Cluster 30: 286 elements
[INFO] Kmeans Cluster 31: 206 elements
[INFO] Kmeans Cluster 32: 228 elements
[INFO] Kmeans Cluster 33: 188 elements
[INFO] Kmeans Cluster 34: 134 elements
[INFO] Kmeans Cluster 35: 175 elements
[INFO] Kmeans Cluster 36: 219 elements
[INFO] Kmeans Cluster 37: 173 elements
[INFO] Kmeans Cluster 38: 145 elements
[INFO] Kmeans Cluster 39: 156 elements
[INFO] Kmeans Cluster 40: 287 elements
[INFO] Kmeans Cluster 41: 256 elements
[INFO] Kmeans Cluster 42: 231 elements
[INFO] Kmeans Cluster 43: 183 elements
[INFO] Kmeans Cluster 44: 296 elements
[INFO] Kmeans Cluster 45: 237 elements
[INFO] Kmeans Cluster 46: 137 elements
[INFO] Kmeans Cluster 47: 185 elements
[INFO] Kmeans Cluster 48: 176 elements
[INFO] Kmeans Cluster 49: 198 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=96.01, Long SMA=141.37, Sharpe=0.0865
[INFO] Centroid 1: Short SMA=52.04, Long SMA=271.18, Sharpe=0.0660
[INFO] Centroid 2: Short SMA=203.00, Long SMA=277.97, Sharpe=0.1888
[INFO] Centroid 3: Short SMA=50.97, Long SMA=84.06, Sharpe=0.5064
[INFO] Centroid 4: Short SMA=43.50, Long SMA=177.12, Sharpe=0.0216
[INFO] Centroid 5: Short SMA=150.02, Long SMA=182.27, Sharpe=0.2987
[INFO] Centroid 6: Short SMA=249.62, Long SMA=275.31, Sharpe=-0.0170
[INFO] Centroid 7: Short SMA=21.87, Long SMA=47.59, Sharpe=-0.0528
[INFO] Centroid 8: Short SMA=113.84, Long SMA=171.46, Sharpe=-0.0452
[INFO] Centroid 9: Short SMA=86.89, Long SMA=276.84, Sharpe=-0.1517
[INFO] Centroid 10: Short SMA=162.38, Long SMA=249.28, Sharpe=0.2100
[INFO] Centroid 11: Short SMA=47.50, Long SMA=244.77, Sharpe=0.1956
[INFO] Centroid 12: Short SMA=40.34, Long SMA=73.47, Sharpe=0.2764
[INFO] Centroid 13: Short SMA=204.12, Long SMA=219.47, Sharpe=0.4980
[INFO] Centroid 14: Short SMA=81.22, Long SMA=137.82, Sharpe=-0.0089
[INFO] Centroid 15: Short SMA=141.42, Long SMA=174.59, Sharpe=0.0952
[INFO] Centroid 16: Short SMA=76.37, Long SMA=219.93, Sharpe=0.3063
[INFO] Centroid 17: Short SMA=71.58, Long SMA=193.48, Sharpe=0.1812
[INFO] Centroid 18: Short SMA=208.92, Long SMA=233.86, Sharpe=0.2675
[INFO] Centroid 19: Short SMA=21.27, Long SMA=42.50, Sharpe=-0.2757
[INFO] Centroid 20: Short SMA=33.10, Long SMA=121.20, Sharpe=0.3228
[INFO] Centroid 21: Short SMA=44.61, Long SMA=215.67, Sharpe=-0.0187
[INFO] Centroid 22: Short SMA=27.03, Long SMA=138.12, Sharpe=0.2175
[INFO] Centroid 23: Short SMA=19.51, Long SMA=193.10, Sharpe=-0.0729
[INFO] Centroid 24: Short SMA=47.56, Long SMA=94.60, Sharpe=0.4005
[INFO] Centroid 25: Short SMA=101.50, Long SMA=192.58, Sharpe=0.0511
[INFO] Centroid 26: Short SMA=77.24, Long SMA=102.61, Sharpe=0.1871
[INFO] Centroid 27: Short SMA=21.20, Long SMA=285.90, Sharpe=-0.2105
[INFO] Centroid 28: Short SMA=24.41, Long SMA=266.22, Sharpe=-0.0645
[INFO] Centroid 29: Short SMA=115.47, Long SMA=251.84, Sharpe=0.1572
[INFO] Centroid 30: Short SMA=121.42, Long SMA=225.83, Sharpe=0.2297
[INFO] Centroid 31: Short SMA=99.45, Long SMA=262.87, Sharpe=0.0452
[INFO] Centroid 32: Short SMA=173.62, Long SMA=220.11, Sharpe=0.0901
[INFO] Centroid 33: Short SMA=167.76, Long SMA=196.74, Sharpe=0.1993
[INFO] Centroid 34: Short SMA=268.13, Long SMA=283.33, Sharpe=0.1148
[INFO] Centroid 35: Short SMA=175.45, Long SMA=288.58, Sharpe=0.0403
[INFO] Centroid 36: Short SMA=138.77, Long SMA=272.24, Sharpe=0.3252
[INFO] Centroid 37: Short SMA=242.42, Long SMA=284.46, Sharpe=-0.1405
[INFO] Centroid 38: Short SMA=168.57, Long SMA=204.32, Sharpe=-0.0496
[INFO] Centroid 39: Short SMA=137.26, Long SMA=215.86, Sharpe=0.3562
[INFO] Centroid 40: Short SMA=29.36, Long SMA=228.51, Sharpe=0.0778
[INFO] Centroid 41: Short SMA=158.23, Long SMA=284.82, Sharpe=0.1333
[INFO] Centroid 42: Short SMA=28.81, Long SMA=154.04, Sharpe=0.1151
[INFO] Centroid 43: Short SMA=78.02, Long SMA=106.38, Sharpe=0.3090
[INFO] Centroid 44: Short SMA=214.26, Long SMA=258.24, Sharpe=0.0994
[INFO] Centroid 45: Short SMA=63.76, Long SMA=280.95, Sharpe=-0.0579
[INFO] Centroid 46: Short SMA=98.91, Long SMA=287.62, Sharpe=-0.0572
[INFO] Centroid 47: Short SMA=23.33, Long SMA=72.38, Sharpe=0.1424
[INFO] Centroid 48: Short SMA=119.11, Long SMA=141.93, Sharpe=0.2009
[INFO] Centroid 49: Short SMA=60.63, Long SMA=157.44, Sharpe=-0.1136
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=212, Long SMA=214, Sharpe=0.7597, Trades=91
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=50, Long SMA=84, Sharpe=0.5416, Trades=30
[INFO] Kmeans Top 2: Short SMA=204, Long SMA=220, Sharpe=0.5081, Trades=31
[INFO] Kmeans Top 3: Short SMA=138, Long SMA=272, Sharpe=0.3810, Trades=12
[INFO] Kmeans Top 4: Short SMA=46, Long SMA=96, Sharpe=0.3788, Trades=30
[INFO] Kmeans Top 5: Short SMA=78, Long SMA=108, Sharpe=0.3152, Trades=28
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (96, 141)
[INFO]   Nearest: (96.0, 142.0)
[INFO]   Rounded: (52, 271)
[INFO]   Nearest: (52.0, 272.0)
[INFO]   Rounded: (203, 278)
[INFO]   Nearest: (202.0, 278.0)
[INFO]   Rounded: (51, 84)
[INFO]   Nearest: (50.0, 84.0)
[INFO]   Rounded: (43, 177)
[INFO]   Nearest: (44.0, 178.0)
[INFO]   Rounded: (150, 182)
[INFO]   Rounded: (250, 275)
[INFO]   Nearest: (250.0, 276.0)
[INFO]   Rounded: (22, 48)
[INFO]   Rounded: (114, 171)
[INFO]   Nearest: (114.0, 172.0)
[INFO]   Rounded: (87, 277)
[INFO]   Nearest: (86.0, 276.0)
[INFO]   Rounded: (162, 249)
[INFO]   Nearest: (162.0, 250.0)
[INFO]   Rounded: (47, 245)
[INFO]   Nearest: (48.0, 244.0)
[INFO]   Rounded: (40, 73)
[INFO]   Nearest: (40.0, 74.0)
[INFO]   Rounded: (204, 219)
[INFO]   Nearest: (204.0, 220.0)
[INFO]   Rounded: (81, 138)
[INFO]   Nearest: (82.0, 138.0)
[INFO]   Rounded: (141, 175)
[INFO]   Nearest: (142.0, 174.0)
[INFO]   Rounded: (76, 220)
[INFO]   Rounded: (72, 193)
[INFO]   Nearest: (72.0, 194.0)
[INFO]   Rounded: (209, 234)
[INFO]   Nearest: (208.0, 234.0)
[INFO]   Rounded: (21, 42)
[INFO]   Nearest: (22.0, 42.0)
[INFO]   Rounded: (33, 121)
[INFO]   Nearest: (34.0, 122.0)
[INFO]   Rounded: (45, 216)
[INFO]   Nearest: (44.0, 216.0)
[INFO]   Rounded: (27, 138)
[INFO]   Nearest: (28.0, 138.0)
[INFO]   Rounded: (20, 193)
[INFO]   Nearest: (20.0, 194.0)
[INFO]   Rounded: (48, 95)
[INFO]   Nearest: (48.0, 94.0)
[INFO]   Rounded: (102, 193)
[INFO]   Nearest: (102.0, 192.0)
[INFO]   Rounded: (77, 103)
[INFO]   Nearest: (78.0, 102.0)
[INFO]   Rounded: (21, 286)
[INFO]   Nearest: (22.0, 286.0)
[INFO]   Rounded: (24, 266)
[INFO]   Rounded: (115, 252)
[INFO]   Nearest: (116.0, 252.0)
[INFO]   Rounded: (121, 226)
[INFO]   Nearest: (122.0, 226.0)
[INFO]   Rounded: (99, 263)
[INFO]   Nearest: (100.0, 262.0)
[INFO]   Rounded: (174, 220)
[INFO]   Rounded: (168, 197)
[INFO]   Nearest: (168.0, 196.0)
[INFO]   Rounded: (268, 283)
[INFO]   Nearest: (268.0, 284.0)
[INFO]   Rounded: (175, 289)
[INFO]   Nearest: (176.0, 288.0)
[INFO]   Rounded: (139, 272)
[INFO]   Nearest: (138.0, 272.0)
[INFO]   Rounded: (242, 284)
[INFO]   Rounded: (169, 204)
[INFO]   Nearest: (168.0, 204.0)
[INFO]   Rounded: (137, 216)
[INFO]   Nearest: (138.0, 216.0)
[INFO]   Rounded: (29, 229)
[INFO]   Nearest: (30.0, 228.0)
[INFO]   Rounded: (158, 285)
[INFO]   Nearest: (158.0, 284.0)
[INFO]   Rounded: (29, 154)
[INFO]   Nearest: (28.0, 154.0)
[INFO]   Rounded: (78, 106)
[INFO]   Rounded: (214, 258)
[INFO]   Rounded: (64, 281)
[INFO]   Nearest: (64.0, 280.0)
[INFO]   Rounded: (99, 288)
[INFO]   Nearest: (98.0, 288.0)
[INFO]   Rounded: (23, 72)
[INFO]   Nearest: (24.0, 72.0)
[INFO]   Rounded: (119, 142)
[INFO]   Nearest: (120.0, 142.0)
[INFO]   Rounded: (61, 157)
[INFO]   Nearest: (60.0, 158.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 212, Long SMA: 214
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(50/84) - Original Sharpe: 0.5416, Trades: 30
[INFO] Kmeans cluster 2: SMA(204/220) - Original Sharpe: 0.5081, Trades: 31
[INFO] Kmeans cluster 3: SMA(138/272) - Original Sharpe: 0.3810, Trades: 12
[INFO] Kmeans cluster 4: SMA(46/96) - Original Sharpe: 0.3788, Trades: 30
[INFO] Kmeans cluster 5: SMA(78/108) - Original Sharpe: 0.3152, Trades: 28
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (212/214)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (50/84) - Sharpe: 0.5416
[INFO] cluster 2: (204/220) - Sharpe: 0.5081
[INFO] cluster 3: (138/272) - Sharpe: 0.3810
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.243014           -0.346311
1    2021-11-10 2021-11-10            41    -1.727839           -1.520211
2    2022-01-10 2022-01-10            41    -1.491477           -2.043836
3    2022-03-10 2022-03-10            42    -2.601234           -0.597735
4    2022-05-10 2022-05-10            41     0.452239            0.452239
5    2022-07-10 2022-07-10            44    -0.869854           -2.008672
6    2022-09-10 2022-09-10            43     2.218651            1.826055
7    2022-11-10 2022-11-10            40    -1.000002           -0.817513
8    2023-01-10 2023-01-10            41    -0.351051            2.282290
9    2023-03-10 2023-03-10            42     1.488556            1.313178
10   2023-05-10 2023-05-10            40    -0.521278            3.457536
11   2023-07-10 2023-07-10            44     2.056252            2.056252
12   2023-09-10 2023-09-10            44    -4.792962           -4.479590
13   2023-11-10 2023-11-10            40    -0.611143           -0.611143
14   2024-01-10 2024-01-10            41     4.588013            1.794716
15   2024-03-10 2024-03-10            43    -2.405032            0.558021
16   2024-05-10 2024-05-10            40    -0.870401           -0.870401
17   2024-07-10 2024-07-10            43     2.708529            1.069096
18   2024-09-10 2024-09-10            44     0.264177           -3.658762
19   2024-11-10 2024-11-10            35     3.696891            1.878062
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.2 |             -0.3 |         -0.1 | False         
[INFO] 2021-11-10   |         -1.7 |             -1.5 |          0.2 | True          
[INFO] 2022-01-10   |         -1.5 |             -2.0 |         -0.5 | False         
[INFO] 2022-03-10   |         -2.6 |             -0.6 |          2.0 | True          
[INFO] 2022-05-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.9 |             -2.0 |         -1.1 | False         
[INFO] 2022-09-10   |          2.2 |              1.8 |         -0.4 | False         
[INFO] 2022-11-10   |         -1.0 |             -0.8 |          0.2 | True          
[INFO] 2023-01-10   |         -0.4 |              2.3 |          2.7 | True          
[INFO] 2023-03-10   |          1.5 |              1.3 |         -0.2 | False         
[INFO] 2023-05-10   |         -0.5 |              3.5 |          4.0 | True          
[INFO] 2023-07-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -4.8 |             -4.5 |          0.3 | True          
[INFO] 2023-11-10   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2024-01-10   |          4.6 |              1.8 |         -2.8 | False         
[INFO] 2024-03-10   |         -2.4 |              0.6 |          3.0 | True          
[INFO] 2024-05-10   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-07-10   |          2.7 |              1.1 |         -1.6 | False         
[INFO] 2024-09-10   |          0.3 |             -3.7 |         -4.0 | False         
[INFO] 2024-11-10   |          3.7 |              1.9 |         -1.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-10, 2023-07-10, 2023-11-10, 2024-05-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 7 of 16 periods (43.75% win rate)
[INFO] Updating Excel file with Kmeans results for FC...
[INFO] Excel file updated successfully. Added FC with Kmeans win rate 43.8% in row 16
[INFO] Added best Sharpe parameters 212/214 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 212, Long SMA: 214
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(50/84) - Original Sharpe: 0.5416
[INFO] Added cluster 2 to portfolio: SMA(204/220) - Original Sharpe: 0.5081
[INFO] Added cluster 3 to portfolio: SMA(138/272) - Original Sharpe: 0.3810
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0741
[INFO] Kmeans Best out-of-sample Sharpe: -0.2095
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FC...
[INFO] Excel file updated successfully. Added FC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FC
[INFO] Big Point Value: 500.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4652 to 0.7597
[INFO] 
Best parameters:
[INFO] Short SMA: 212
[INFO] Long SMA: 214
[INFO] Sharpe Ratio: 0.759717
[INFO] Number of Trades: 91
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4652 to 0.7597
[INFO] Trades range: 10.0 to 377.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.6102 to 4.0054
[INFO] Scaled Trades range: -0.8971 to 17.2706
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5547
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 106 elements
[INFO] Cluster 1: 529 elements
[INFO] Cluster 2: 401 elements
[INFO] Cluster 3: 41 elements
[INFO] Cluster 4: 396 elements
[INFO] Cluster 5: 225 elements
[INFO] Cluster 6: 26 elements
[INFO] Cluster 7: 251 elements
[INFO] Cluster 8: 361 elements
[INFO] Cluster 9: 510 elements
[INFO] Cluster 10: 361 elements
[INFO] Cluster 11: 363 elements
[INFO] Cluster 12: 69 elements
[INFO] Cluster 13: 321 elements
[INFO] Cluster 14: 395 elements
[INFO] Cluster 15: 50 elements
[INFO] Cluster 16: 215 elements
[INFO] Cluster 17: 282 elements
[INFO] Cluster 18: 255 elements
[INFO] Cluster 19: 276 elements
[INFO] Cluster 20: 342 elements
[INFO] Cluster 21: 297 elements
[INFO] Cluster 22: 306 elements
[INFO] Cluster 23: 369 elements
[INFO] Cluster 24: 57 elements
[INFO] Cluster 25: 74 elements
[INFO] Cluster 26: 369 elements
[INFO] Cluster 27: 3 elements
[INFO] Cluster 28: 71 elements
[INFO] Cluster 29: 332 elements
[INFO] Cluster 30: 97 elements
[INFO] Cluster 31: 231 elements
[INFO] Cluster 32: 108 elements
[INFO] Cluster 33: 169 elements
[INFO] Cluster 34: 196 elements
[INFO] Cluster 35: 193 elements
[INFO] Cluster 36: 311 elements
[INFO] Cluster 37: 114 elements
[INFO] Cluster 38: 93 elements
[INFO] Cluster 39: 168 elements
[INFO] Cluster 40: 153 elements
[INFO] Cluster 41: 28 elements
[INFO] Cluster 42: 239 elements
[INFO] Cluster 43: 36 elements
[INFO] Cluster 44: 78 elements
[INFO] Cluster 45: 253 elements
[INFO] Cluster 46: 156 elements
[INFO] Cluster 47: 179 elements
[INFO] Cluster 48: 81 elements
[INFO] Cluster 49: 49 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=158, Long SMA=164, Sharpe=0.1300, Trades=58
[INFO] Cluster 1 cluster: Short SMA=86, Long SMA=276, Sharpe=-0.2802, Trades=15
[INFO] Cluster 2 cluster: Short SMA=90, Long SMA=182, Sharpe=0.0462, Trades=18
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=38, Sharpe=-0.0631, Trades=138
[INFO] Cluster 4 cluster: Short SMA=122, Long SMA=276, Sharpe=0.1057, Trades=12
[INFO] Cluster 5 cluster: Short SMA=194, Long SMA=214, Sharpe=0.1260, Trades=31
[INFO] Cluster 6 cluster: Short SMA=28, Long SMA=30, Sharpe=-0.3392, Trades=206
[INFO] Cluster 7 cluster: Short SMA=16, Long SMA=92, Sharpe=0.1847, Trades=42
[INFO] Cluster 8 cluster: Short SMA=114, Long SMA=168, Sharpe=-0.0310, Trades=25
[INFO] Cluster 9 cluster: Short SMA=156, Long SMA=250, Sharpe=0.1432, Trades=13
[INFO] Cluster 10 cluster: Short SMA=74, Long SMA=210, Sharpe=0.2948, Trades=22
[INFO] Cluster 11 cluster: Short SMA=70, Long SMA=148, Sharpe=-0.0793, Trades=24
[INFO] Cluster 12 cluster: Short SMA=246, Long SMA=250, Sharpe=0.2759, Trades=53
[INFO] Cluster 13 cluster: Short SMA=178, Long SMA=272, Sharpe=0.1103, Trades=14
[INFO] Cluster 14 cluster: Short SMA=246, Long SMA=274, Sharpe=-0.0602, Trades=21
[INFO] Cluster 15 cluster: Short SMA=62, Long SMA=66, Sharpe=0.3531, Trades=102
[INFO] Cluster 16 cluster: Short SMA=44, Long SMA=84, Sharpe=0.2796, Trades=36
[INFO] Cluster 17 cluster: Short SMA=32, Long SMA=280, Sharpe=-0.0481, Trades=29
[INFO] Cluster 18 cluster: Short SMA=222, Long SMA=260, Sharpe=0.0811, Trades=21
[INFO] Cluster 19 cluster: Short SMA=16, Long SMA=198, Sharpe=-0.0340, Trades=42
[INFO] Cluster 20 cluster: Short SMA=200, Long SMA=282, Sharpe=0.2118, Trades=13
[INFO] Cluster 21 cluster: Short SMA=148, Long SMA=196, Sharpe=0.1840, Trades=23
[INFO] Cluster 22 cluster: Short SMA=38, Long SMA=176, Sharpe=0.0668, Trades=26
[INFO] Cluster 23 cluster: Short SMA=48, Long SMA=100, Sharpe=0.3988, Trades=32
[INFO] Cluster 24 cluster: Short SMA=52, Long SMA=64, Sharpe=0.3404, Trades=67
[INFO] Cluster 25 cluster: Short SMA=204, Long SMA=220, Sharpe=0.5081, Trades=31
[INFO] Cluster 26 cluster: Short SMA=34, Long SMA=236, Sharpe=0.1178, Trades=28
[INFO] Cluster 28 cluster: Short SMA=22, Long SMA=34, Sharpe=-0.2216, Trades=98
[INFO] Cluster 29 cluster: Short SMA=108, Long SMA=232, Sharpe=0.2603, Trades=15
[INFO] Cluster 30 cluster: Short SMA=22, Long SMA=46, Sharpe=-0.2176, Trades=70
[INFO] Cluster 31 cluster: Short SMA=132, Long SMA=214, Sharpe=0.3115, Trades=21
[INFO] Cluster 32 cluster: Short SMA=14, Long SMA=282, Sharpe=-0.2799, Trades=41
[INFO] Cluster 33 cluster: Short SMA=138, Long SMA=272, Sharpe=0.3810, Trades=12
[INFO] Cluster 34 cluster: Short SMA=58, Long SMA=120, Sharpe=0.2762, Trades=26
[INFO] Cluster 35 cluster: Short SMA=50, Long SMA=214, Sharpe=-0.0164, Trades=26
[INFO] Cluster 36 cluster: Short SMA=98, Long SMA=128, Sharpe=0.1197, Trades=27
[INFO] Cluster 37 cluster: Short SMA=242, Long SMA=290, Sharpe=-0.1649, Trades=17
[INFO] Cluster 38 cluster: Short SMA=22, Long SMA=62, Sharpe=0.0543, Trades=52
[INFO] Cluster 39 cluster: Short SMA=58, Long SMA=276, Sharpe=0.0068, Trades=19
[INFO] Cluster 40 cluster: Short SMA=168, Long SMA=210, Sharpe=0.0294, Trades=23
[INFO] Cluster 41 cluster: Short SMA=208, Long SMA=210, Sharpe=0.1792, Trades=91
[INFO] Cluster 42 cluster: Short SMA=28, Long SMA=140, Sharpe=0.2319, Trades=34
[INFO] Cluster 43 cluster: Short SMA=140, Long SMA=142, Sharpe=-0.1260, Trades=93
[INFO] Cluster 44 cluster: Short SMA=268, Long SMA=274, Sharpe=0.0294, Trades=45
[INFO] Cluster 45 cluster: Short SMA=142, Long SMA=186, Sharpe=0.2510, Trades=23
[INFO] Cluster 46 cluster: Short SMA=58, Long SMA=160, Sharpe=-0.1336, Trades=24
[INFO] Cluster 47 cluster: Short SMA=48, Long SMA=248, Sharpe=0.3163, Trades=24
[INFO] Cluster 48 cluster: Short SMA=108, Long SMA=122, Sharpe=0.0830, Trades=35
[INFO] Cluster 49 cluster: Short SMA=84, Long SMA=90, Sharpe=0.1122, Trades=68
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=212, Long SMA=214, Sharpe=0.7597, Trades=91
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=204, Long SMA=220, Sharpe=0.5081, Trades=31
[INFO] Top 2: Short SMA=48, Long SMA=100, Sharpe=0.3988, Trades=32
[INFO] Top 3: Short SMA=138, Long SMA=272, Sharpe=0.3810, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10582 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 212, Long SMA: 214
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(204/220) - Original Sharpe: 0.5081, Trades: 31
[INFO] Hierarchical cluster 2: SMA(48/100) - Original Sharpe: 0.3988, Trades: 32
[INFO] Hierarchical cluster 3: SMA(138/272) - Original Sharpe: 0.3810, Trades: 12
[INFO] Hierarchical cluster 4: SMA(62/66) - Original Sharpe: 0.3531, Trades: 102
[INFO] Hierarchical cluster 5: SMA(52/64) - Original Sharpe: 0.3404, Trades: 67
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (212/214)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (204/220) - Sharpe: 0.5081
[INFO] cluster 2: (48/100) - Sharpe: 0.3988
[INFO] cluster 3: (138/272) - Sharpe: 0.3810
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.243014            0.548539
1    2021-11-10 2021-11-10            41    -1.727839           -1.729910
2    2022-01-10 2022-01-10            41    -1.491477           -2.043836
3    2022-03-10 2022-03-10            42    -2.601234            0.157045
4    2022-05-10 2022-05-10            41     0.452239            0.452239
5    2022-07-10 2022-07-10            44    -0.869854           -2.241745
6    2022-09-10 2022-09-10            43     2.218651            2.242787
7    2022-11-10 2022-11-10            40    -1.000002           -0.987037
8    2023-01-10 2023-01-10            41    -0.351051            3.473554
9    2023-03-10 2023-03-10            42     1.488556            1.313178
10   2023-05-10 2023-05-10            40    -0.521278            3.457536
11   2023-07-10 2023-07-10            44     2.056252            2.056252
12   2023-09-10 2023-09-10            44    -4.792962           -3.979653
13   2023-11-10 2023-11-10            40    -0.611143           -0.611143
14   2024-01-10 2024-01-10            41     4.588013            1.147273
15   2024-03-10 2024-03-10            43    -2.405032            0.217589
16   2024-05-10 2024-05-10            40    -0.870401           -0.355726
17   2024-07-10 2024-07-10            43     2.708529            1.129969
18   2024-09-10 2024-09-10            44     0.264177           -3.132565
19   2024-11-10 2024-11-10            35     3.696891            0.615651
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.2 |              0.5 |          0.7 | True          
[INFO] 2021-11-10   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2022-01-10   |         -1.5 |             -2.0 |         -0.5 | False         
[INFO] 2022-03-10   |         -2.6 |              0.2 |          2.8 | True          
[INFO] 2022-05-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.9 |             -2.2 |         -1.3 | False         
[INFO] 2022-09-10   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2022-11-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2023-01-10   |         -0.4 |              3.5 |          3.9 | True          
[INFO] 2023-03-10   |          1.5 |              1.3 |         -0.2 | False         
[INFO] 2023-05-10   |         -0.5 |              3.5 |          4.0 | True          
[INFO] 2023-07-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -4.8 |             -4.0 |          0.8 | True          
[INFO] 2023-11-10   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2024-01-10   |          4.6 |              1.1 |         -3.5 | False         
[INFO] 2024-03-10   |         -2.4 |              0.2 |          2.6 | True          
[INFO] 2024-05-10   |         -0.9 |             -0.4 |          0.5 | True          
[INFO] 2024-07-10   |          2.7 |              1.1 |         -1.6 | False         
[INFO] 2024-09-10   |          0.3 |             -3.1 |         -3.4 | False         
[INFO] 2024-11-10   |          3.7 |              0.6 |         -3.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-10, 2022-05-10, 2022-09-10, 2022-11-10, 2023-07-10, 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 14 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for FC...
[INFO] Excel file updated successfully. Added FC with Hierarchical win rate 50.0% in row 16
[INFO] Added best Sharpe parameters 212/214 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 212, Long SMA: 214
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(204/220) - Original Sharpe: 0.5081
[INFO] Added cluster 2 to portfolio: SMA(48/100) - Original Sharpe: 0.3988
[INFO] Added cluster 3 to portfolio: SMA(138/272) - Original Sharpe: 0.3810
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0383
[INFO] Hierarchical Best out-of-sample Sharpe: -0.2095
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FC...
[INFO] Excel file updated successfully. Added FC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FC
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FDAX in column D: 27.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 164.75s
[INFO] Best parameters: Short SMA = 160, Long SMA = 262
[INFO] Best Sharpe ratio: 0.607501, Trades: 11
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FDAX
[INFO] Big Point Value (from data): 25.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 1.84 contracts
[INFO] Maximum Position Size: 3 contracts
[INFO] Strategy Total P&L: $341,785.00
[INFO] Market Buy & Hold P&L: $221,350.00
[INFO] Outperformance: $120,435.00
[INFO] Sharpe ratio (entire period, annualized): 0.414119
[INFO] Sharpe ratio (in-sample, annualized): 0.607501
[INFO] Sharpe ratio (out-of-sample, annualized): -0.028574
[INFO] Maximum Drawdown: $183,656.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 7
[INFO] Out-of-sample period trades: 4
[INFO] Total trades: 11
[INFO] In-sample P&L: $450,899.00
[INFO] Out-of-sample P&L: $-9,264.00
[INFO] 
Best parameters from GA: Short SMA = 160, Long SMA = 262, Sharpe = 0.607501
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 25.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9414 to 0.6075
[INFO] 
Best parameters:
[INFO] Short SMA: 160
[INFO] Long SMA: 262
[INFO] Sharpe Ratio: 0.607501
[INFO] Number of Trades: 11
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10240 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9414 to 0.6075
[INFO] Trades range: 10.0 to 339.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3672 to 2.8326
[INFO] Scaled Long SMA range: -2.7807 to 1.4497
[INFO] Scaled Sharpe ratio range: -4.1879 to 3.3270
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 269 elements
[INFO] Kmeans Cluster 1: 212 elements
[INFO] Kmeans Cluster 2: 220 elements
[INFO] Kmeans Cluster 3: 257 elements
[INFO] Kmeans Cluster 4: 204 elements
[INFO] Kmeans Cluster 5: 177 elements
[INFO] Kmeans Cluster 6: 230 elements
[INFO] Kmeans Cluster 7: 256 elements
[INFO] Kmeans Cluster 8: 239 elements
[INFO] Kmeans Cluster 9: 124 elements
[INFO] Kmeans Cluster 10: 105 elements
[INFO] Kmeans Cluster 11: 151 elements
[INFO] Kmeans Cluster 12: 127 elements
[INFO] Kmeans Cluster 13: 231 elements
[INFO] Kmeans Cluster 14: 209 elements
[INFO] Kmeans Cluster 15: 245 elements
[INFO] Kmeans Cluster 16: 257 elements
[INFO] Kmeans Cluster 17: 210 elements
[INFO] Kmeans Cluster 18: 251 elements
[INFO] Kmeans Cluster 19: 227 elements
[INFO] Kmeans Cluster 20: 120 elements
[INFO] Kmeans Cluster 21: 211 elements
[INFO] Kmeans Cluster 22: 247 elements
[INFO] Kmeans Cluster 23: 151 elements
[INFO] Kmeans Cluster 24: 194 elements
[INFO] Kmeans Cluster 25: 247 elements
[INFO] Kmeans Cluster 26: 194 elements
[INFO] Kmeans Cluster 27: 277 elements
[INFO] Kmeans Cluster 28: 235 elements
[INFO] Kmeans Cluster 29: 52 elements
[INFO] Kmeans Cluster 30: 97 elements
[INFO] Kmeans Cluster 31: 298 elements
[INFO] Kmeans Cluster 32: 200 elements
[INFO] Kmeans Cluster 33: 188 elements
[INFO] Kmeans Cluster 34: 278 elements
[INFO] Kmeans Cluster 35: 233 elements
[INFO] Kmeans Cluster 36: 163 elements
[INFO] Kmeans Cluster 37: 237 elements
[INFO] Kmeans Cluster 38: 180 elements
[INFO] Kmeans Cluster 39: 246 elements
[INFO] Kmeans Cluster 40: 321 elements
[INFO] Kmeans Cluster 41: 284 elements
[INFO] Kmeans Cluster 42: 149 elements
[INFO] Kmeans Cluster 43: 187 elements
[INFO] Kmeans Cluster 44: 12 elements
[INFO] Kmeans Cluster 45: 251 elements
[INFO] Kmeans Cluster 46: 138 elements
[INFO] Kmeans Cluster 47: 163 elements
[INFO] Kmeans Cluster 48: 248 elements
[INFO] Kmeans Cluster 49: 238 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=49.76, Long SMA=247.10, Sharpe=-0.1183
[INFO] Centroid 1: Short SMA=159.91, Long SMA=209.08, Sharpe=0.1505
[INFO] Centroid 2: Short SMA=108.41, Long SMA=180.81, Sharpe=-0.1337
[INFO] Centroid 3: Short SMA=25.66, Long SMA=110.08, Sharpe=-0.2778
[INFO] Centroid 4: Short SMA=32.05, Long SMA=280.06, Sharpe=-0.2335
[INFO] Centroid 5: Short SMA=270.20, Long SMA=289.85, Sharpe=-0.3613
[INFO] Centroid 6: Short SMA=28.50, Long SMA=63.11, Sharpe=-0.0421
[INFO] Centroid 7: Short SMA=105.61, Long SMA=280.01, Sharpe=0.0531
[INFO] Centroid 8: Short SMA=216.01, Long SMA=282.04, Sharpe=-0.0298
[INFO] Centroid 9: Short SMA=70.31, Long SMA=91.74, Sharpe=-0.5334
[INFO] Centroid 10: Short SMA=95.22, Long SMA=120.32, Sharpe=0.1679
[INFO] Centroid 11: Short SMA=90.15, Long SMA=123.01, Sharpe=-0.0036
[INFO] Centroid 12: Short SMA=200.87, Long SMA=243.61, Sharpe=0.1765
[INFO] Centroid 13: Short SMA=21.68, Long SMA=234.06, Sharpe=-0.2639
[INFO] Centroid 14: Short SMA=165.69, Long SMA=193.16, Sharpe=-0.0034
[INFO] Centroid 15: Short SMA=112.35, Long SMA=144.15, Sharpe=-0.1721
[INFO] Centroid 16: Short SMA=75.12, Long SMA=258.08, Sharpe=-0.2133
[INFO] Centroid 17: Short SMA=240.95, Long SMA=280.35, Sharpe=-0.1481
[INFO] Centroid 18: Short SMA=30.02, Long SMA=143.71, Sharpe=-0.1862
[INFO] Centroid 19: Short SMA=138.88, Long SMA=253.18, Sharpe=0.1550
[INFO] Centroid 20: Short SMA=90.17, Long SMA=122.52, Sharpe=-0.3239
[INFO] Centroid 21: Short SMA=228.26, Long SMA=245.85, Sharpe=-0.0668
[INFO] Centroid 22: Short SMA=102.70, Long SMA=234.38, Sharpe=-0.0624
[INFO] Centroid 23: Short SMA=170.16, Long SMA=244.89, Sharpe=0.4842
[INFO] Centroid 24: Short SMA=51.73, Long SMA=85.39, Sharpe=-0.3716
[INFO] Centroid 25: Short SMA=80.77, Long SMA=219.69, Sharpe=-0.2106
[INFO] Centroid 26: Short SMA=20.80, Long SMA=164.58, Sharpe=-0.3220
[INFO] Centroid 27: Short SMA=213.94, Long SMA=261.83, Sharpe=0.0645
[INFO] Centroid 28: Short SMA=66.00, Long SMA=285.00, Sharpe=-0.0864
[INFO] Centroid 29: Short SMA=17.42, Long SMA=53.54, Sharpe=0.2911
[INFO] Centroid 30: Short SMA=262.19, Long SMA=282.41, Sharpe=-0.5314
[INFO] Centroid 31: Short SMA=120.64, Long SMA=201.65, Sharpe=-0.0360
[INFO] Centroid 32: Short SMA=38.78, Long SMA=62.83, Sharpe=-0.1764
[INFO] Centroid 33: Short SMA=128.27, Long SMA=154.71, Sharpe=-0.0458
[INFO] Centroid 34: Short SMA=54.45, Long SMA=144.51, Sharpe=-0.0726
[INFO] Centroid 35: Short SMA=29.36, Long SMA=192.58, Sharpe=-0.1831
[INFO] Centroid 36: Short SMA=111.39, Long SMA=283.12, Sharpe=0.1522
[INFO] Centroid 37: Short SMA=150.45, Long SMA=174.66, Sharpe=-0.1641
[INFO] Centroid 38: Short SMA=167.39, Long SMA=259.11, Sharpe=0.3623
[INFO] Centroid 39: Short SMA=126.50, Long SMA=233.37, Sharpe=0.0447
[INFO] Centroid 40: Short SMA=42.19, Long SMA=210.77, Sharpe=-0.0738
[INFO] Centroid 41: Short SMA=65.02, Long SMA=186.67, Sharpe=-0.1367
[INFO] Centroid 42: Short SMA=188.20, Long SMA=218.58, Sharpe=0.2977
[INFO] Centroid 43: Short SMA=134.00, Long SMA=283.23, Sharpe=0.2651
[INFO] Centroid 45: Short SMA=60.58, Long SMA=114.16, Sharpe=-0.1790
[INFO] Centroid 46: Short SMA=23.54, Long SMA=52.84, Sharpe=0.0942
[INFO] Centroid 47: Short SMA=187.41, Long SMA=222.69, Sharpe=0.4243
[INFO] Centroid 48: Short SMA=83.54, Long SMA=166.45, Sharpe=-0.2227
[INFO] Centroid 49: Short SMA=26.08, Long SMA=277.66, Sharpe=-0.3619
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=160, Long SMA=262, Sharpe=0.6075, Trades=11
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=188, Long SMA=222, Sharpe=0.4928, Trades=18
[INFO] Kmeans Top 2: Short SMA=170, Long SMA=244, Sharpe=0.4524, Trades=12
[INFO] Kmeans Top 3: Short SMA=168, Long SMA=256, Sharpe=0.3927, Trades=12
[INFO] Kmeans Top 4: Short SMA=194, Long SMA=216, Sharpe=0.3495, Trades=20
[INFO] Kmeans Top 5: Short SMA=136, Long SMA=284, Sharpe=0.2653, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 45, 46, 47, 48, 49}
[INFO]   Rounded: (50, 247)
[INFO]   Nearest: (50.0, 248.0)
[INFO]   Rounded: (160, 209)
[INFO]   Nearest: (160.0, 210.0)
[INFO]   Rounded: (108, 181)
[INFO]   Nearest: (108.0, 180.0)
[INFO]   Rounded: (26, 110)
[INFO]   Rounded: (32, 280)
[INFO]   Rounded: (270, 290)
[INFO]   Rounded: (29, 63)
[INFO]   Nearest: (28.0, 64.0)
[INFO]   Rounded: (106, 280)
[INFO]   Rounded: (216, 282)
[INFO]   Rounded: (70, 92)
[INFO]   Rounded: (95, 120)
[INFO]   Nearest: (96.0, 120.0)
[INFO]   Rounded: (90, 123)
[INFO]   Nearest: (90.0, 124.0)
[INFO]   Rounded: (201, 244)
[INFO]   Nearest: (200.0, 244.0)
[INFO]   Rounded: (22, 234)
[INFO]   Rounded: (166, 193)
[INFO]   Nearest: (166.0, 194.0)
[INFO]   Rounded: (112, 144)
[INFO]   Rounded: (75, 258)
[INFO]   Nearest: (76.0, 258.0)
[INFO]   Rounded: (241, 280)
[INFO]   Nearest: (240.0, 280.0)
[INFO]   Rounded: (30, 144)
[INFO]   Rounded: (139, 253)
[INFO]   Nearest: (138.0, 254.0)
[INFO]   Rounded: (90, 123)
[INFO]   Nearest: (90.0, 122.0)
[INFO]   Rounded: (228, 246)
[INFO]   Rounded: (103, 234)
[INFO]   Nearest: (102.0, 234.0)
[INFO]   Rounded: (170, 245)
[INFO]   Nearest: (170.0, 244.0)
[INFO]   Rounded: (52, 85)
[INFO]   Nearest: (52.0, 86.0)
[INFO]   Rounded: (81, 220)
[INFO]   Nearest: (80.0, 220.0)
[INFO]   Rounded: (21, 165)
[INFO]   Nearest: (20.0, 164.0)
[INFO]   Rounded: (214, 262)
[INFO]   Rounded: (66, 285)
[INFO]   Nearest: (66.0, 286.0)
[INFO]   Rounded: (17, 54)
[INFO]   Nearest: (18.0, 54.0)
[INFO]   Rounded: (262, 282)
[INFO]   Rounded: (121, 202)
[INFO]   Nearest: (120.0, 202.0)
[INFO]   Rounded: (39, 63)
[INFO]   Nearest: (38.0, 62.0)
[INFO]   Rounded: (128, 155)
[INFO]   Nearest: (128.0, 154.0)
[INFO]   Rounded: (54, 145)
[INFO]   Nearest: (54.0, 144.0)
[INFO]   Rounded: (29, 193)
[INFO]   Nearest: (30.0, 192.0)
[INFO]   Rounded: (111, 283)
[INFO]   Nearest: (112.0, 284.0)
[INFO]   Rounded: (150, 175)
[INFO]   Nearest: (150.0, 174.0)
[INFO]   Rounded: (167, 259)
[INFO]   Nearest: (168.0, 260.0)
[INFO]   Rounded: (127, 233)
[INFO]   Nearest: (126.0, 234.0)
[INFO]   Rounded: (42, 211)
[INFO]   Nearest: (42.0, 210.0)
[INFO]   Rounded: (65, 187)
[INFO]   Nearest: (66.0, 186.0)
[INFO]   Rounded: (188, 219)
[INFO]   Nearest: (188.0, 218.0)
[INFO]   Rounded: (134, 283)
[INFO]   Nearest: (134.0, 284.0)
[INFO]   Rounded: (61, 114)
[INFO]   Nearest: (60.0, 114.0)
[INFO]   Rounded: (24, 53)
[INFO]   Nearest: (24.0, 52.0)
[INFO]   Rounded: (187, 223)
[INFO]   Nearest: (188.0, 222.0)
[INFO]   Rounded: (84, 166)
[INFO]   Rounded: (26, 278)
[INFO] Successfully plotted 49 out of 49 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 160, Long SMA: 262
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(188/222) - Original Sharpe: 0.4928, Trades: 18
[INFO] Kmeans cluster 2: SMA(170/244) - Original Sharpe: 0.4524, Trades: 12
[INFO] Kmeans cluster 3: SMA(168/256) - Original Sharpe: 0.3927, Trades: 12
[INFO] Kmeans cluster 4: SMA(194/216) - Original Sharpe: 0.3495, Trades: 20
[INFO] Kmeans cluster 5: SMA(136/284) - Original Sharpe: 0.2653, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2794
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (160/262)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (188/222) - Sharpe: 0.4928
[INFO] cluster 2: (170/244) - Sharpe: 0.4524
[INFO] cluster 3: (168/256) - Sharpe: 0.3927
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Out-of-sample period starts on: 2021-09-20
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-20 2021-09-20            45     1.874942            1.874942
1    2021-11-20 2021-11-20            41    -1.542081           -1.542081
2    2022-01-20 2022-01-20            42    -2.017855           -2.090102
3    2022-03-20 2022-03-20            42     1.424244            0.939266
4    2022-05-20 2022-05-20            43     0.980542            0.980542
5    2022-07-20 2022-07-20            44     1.402100            1.402100
6    2022-09-20 2022-09-20            44    -3.031215           -3.031215
7    2022-11-20 2022-11-20            43    -1.359366           -1.359366
8    2023-01-20 2023-01-20            41    -2.575891           -3.104593
9    2023-03-20 2023-03-20            42     4.502487            4.502487
10   2023-05-20 2023-05-20            43    -0.783470           -0.783470
11   2023-07-20 2023-07-20            44    -1.705868           -1.705868
12   2023-09-20 2023-09-20            43     0.424324            0.424324
13   2023-11-20 2023-11-20            42     2.238515            2.238515
14   2024-01-20 2024-01-20            42     1.404552           -0.497942
15   2024-03-20 2024-03-20            40     1.567381            0.556603
16   2024-05-20 2024-05-20            45    -1.796289           -1.796289
17   2024-07-20 2024-07-20            44     0.668910            0.668910
18   2024-09-20 2024-09-20            43     0.376154            0.376154
19   2024-11-20 2024-11-20            26     2.631388            2.631388
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-20   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-20   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-01-20   |         -2.0 |             -2.1 |         -0.1 | False         
[INFO] 2022-03-20   |          1.4 |              0.9 |         -0.5 | False         
[INFO] 2022-05-20   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-07-20   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-09-20   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-11-20   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2023-01-20   |         -2.6 |             -3.1 |         -0.5 | False         
[INFO] 2023-03-20   |          4.5 |              4.5 |          0.0 | Excluded      
[INFO] 2023-05-20   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-07-20   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2023-11-20   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-01-20   |          1.4 |             -0.5 |         -1.9 | False         
[INFO] 2024-03-20   |          1.6 |              0.6 |         -1.0 | False         
[INFO] 2024-05-20   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 2024-07-20   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-20   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-20, 2021-11-20, 2022-05-20, 2022-07-20, 2022-09-20, 2022-11-20, 2023-03-20, 2023-05-20, 2023-07-20, 2023-09-20, 2023-11-20, 2024-05-20, 2024-07-20, 2024-09-20, 2024-11-20
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 5
[INFO] Kmeans cluster wins (rounded comparison): 0 of 5 periods (0.00% win rate)
[INFO] Updating Excel file with Kmeans results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Kmeans win rate 0.0% in row 17
[INFO] Added best Sharpe parameters 160/262 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 160, Long SMA: 262
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(188/222) - Original Sharpe: 0.4928
[INFO] Added cluster 2 to portfolio: SMA(170/244) - Original Sharpe: 0.4524
[INFO] Added cluster 3 to portfolio: SMA(168/256) - Original Sharpe: 0.3927
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FDAX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1648
[INFO] Kmeans Best out-of-sample Sharpe: -0.0286
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FDAX
[INFO] Big Point Value: 25.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9414 to 0.6075
[INFO] 
Best parameters:
[INFO] Short SMA: 160
[INFO] Long SMA: 262
[INFO] Sharpe Ratio: 0.607501
[INFO] Number of Trades: 11
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10240 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9414 to 0.6075
[INFO] Trades range: 10.0 to 339.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3672 to 2.8326
[INFO] Scaled Long SMA range: -2.7807 to 1.4497
[INFO] Scaled Sharpe ratio range: -4.1879 to 3.3270
[INFO] Scaled Trades range: -0.6811 to 15.7386
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10240 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5273
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 327 elements
[INFO] Cluster 1: 248 elements
[INFO] Cluster 2: 195 elements
[INFO] Cluster 3: 257 elements
[INFO] Cluster 4: 86 elements
[INFO] Cluster 5: 23 elements
[INFO] Cluster 6: 564 elements
[INFO] Cluster 7: 62 elements
[INFO] Cluster 8: 185 elements
[INFO] Cluster 9: 378 elements
[INFO] Cluster 10: 342 elements
[INFO] Cluster 11: 386 elements
[INFO] Cluster 12: 397 elements
[INFO] Cluster 13: 158 elements
[INFO] Cluster 14: 255 elements
[INFO] Cluster 15: 335 elements
[INFO] Cluster 16: 84 elements
[INFO] Cluster 17: 283 elements
[INFO] Cluster 18: 287 elements
[INFO] Cluster 19: 378 elements
[INFO] Cluster 20: 234 elements
[INFO] Cluster 21: 46 elements
[INFO] Cluster 22: 198 elements
[INFO] Cluster 23: 371 elements
[INFO] Cluster 24: 386 elements
[INFO] Cluster 25: 334 elements
[INFO] Cluster 26: 282 elements
[INFO] Cluster 27: 250 elements
[INFO] Cluster 28: 64 elements
[INFO] Cluster 29: 111 elements
[INFO] Cluster 30: 78 elements
[INFO] Cluster 31: 159 elements
[INFO] Cluster 32: 308 elements
[INFO] Cluster 33: 64 elements
[INFO] Cluster 34: 210 elements
[INFO] Cluster 35: 244 elements
[INFO] Cluster 36: 3 elements
[INFO] Cluster 37: 6 elements
[INFO] Cluster 38: 18 elements
[INFO] Cluster 39: 20 elements
[INFO] Cluster 40: 170 elements
[INFO] Cluster 41: 230 elements
[INFO] Cluster 42: 80 elements
[INFO] Cluster 43: 379 elements
[INFO] Cluster 44: 26 elements
[INFO] Cluster 45: 109 elements
[INFO] Cluster 46: 179 elements
[INFO] Cluster 47: 60 elements
[INFO] Cluster 48: 180 elements
[INFO] Cluster 49: 211 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=24, Long SMA=218, Sharpe=-0.2225, Trades=16
[INFO] Cluster 1 cluster: Short SMA=268, Long SMA=286, Sharpe=-0.4305, Trades=21
[INFO] Cluster 2 cluster: Short SMA=90, Long SMA=126, Sharpe=0.2288, Trades=24
[INFO] Cluster 3 cluster: Short SMA=20, Long SMA=142, Sharpe=-0.3926, Trades=36
[INFO] Cluster 4 cluster: Short SMA=246, Long SMA=250, Sharpe=-0.2662, Trades=42
[INFO] Cluster 5 cluster: Short SMA=34, Long SMA=36, Sharpe=-0.0554, Trades=184
[INFO] Cluster 6 cluster: Short SMA=66, Long SMA=194, Sharpe=-0.1029, Trades=12
[INFO] Cluster 7 cluster: Short SMA=28, Long SMA=34, Sharpe=-0.0170, Trades=122
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=76, Sharpe=0.0178, Trades=42
[INFO] Cluster 9 cluster: Short SMA=24, Long SMA=276, Sharpe=-0.3299, Trades=21
[INFO] Cluster 10 cluster: Short SMA=120, Long SMA=152, Sharpe=-0.2014, Trades=20
[INFO] Cluster 11 cluster: Short SMA=132, Long SMA=180, Sharpe=-0.1173, Trades=16
[INFO] Cluster 12 cluster: Short SMA=46, Long SMA=210, Sharpe=-0.1026, Trades=14
[INFO] Cluster 13 cluster: Short SMA=22, Long SMA=54, Sharpe=0.0166, Trades=66
[INFO] Cluster 14 cluster: Short SMA=70, Long SMA=124, Sharpe=-0.3128, Trades=24
[INFO] Cluster 15 cluster: Short SMA=232, Long SMA=282, Sharpe=-0.0556, Trades=13
[INFO] Cluster 16 cluster: Short SMA=198, Long SMA=208, Sharpe=0.4023, Trades=38
[INFO] Cluster 17 cluster: Short SMA=142, Long SMA=202, Sharpe=-0.0188, Trades=14
[INFO] Cluster 18 cluster: Short SMA=46, Long SMA=98, Sharpe=-0.2728, Trades=34
[INFO] Cluster 19 cluster: Short SMA=112, Long SMA=276, Sharpe=0.0761, Trades=13
[INFO] Cluster 20 cluster: Short SMA=154, Long SMA=272, Sharpe=0.2975, Trades=11
[INFO] Cluster 21 cluster: Short SMA=144, Long SMA=146, Sharpe=-0.2599, Trades=86
[INFO] Cluster 22 cluster: Short SMA=52, Long SMA=88, Sharpe=-0.3536, Trades=32
[INFO] Cluster 23 cluster: Short SMA=54, Long SMA=148, Sharpe=-0.1166, Trades=22
[INFO] Cluster 24 cluster: Short SMA=60, Long SMA=252, Sharpe=-0.0616, Trades=14
[INFO] Cluster 25 cluster: Short SMA=108, Long SMA=212, Sharpe=-0.1028, Trades=12
[INFO] Cluster 26 cluster: Short SMA=170, Long SMA=242, Sharpe=0.4285, Trades=12
[INFO] Cluster 27 cluster: Short SMA=54, Long SMA=274, Sharpe=-0.1905, Trades=15
[INFO] Cluster 28 cluster: Short SMA=80, Long SMA=88, Sharpe=-0.3865, Trades=62
[INFO] Cluster 29 cluster: Short SMA=42, Long SMA=58, Sharpe=-0.1751, Trades=58
[INFO] Cluster 30 cluster: Short SMA=174, Long SMA=186, Sharpe=-0.0358, Trades=38
[INFO] Cluster 31 cluster: Short SMA=234, Long SMA=248, Sharpe=-0.0886, Trades=26
[INFO] Cluster 32 cluster: Short SMA=148, Long SMA=228, Sharpe=0.1161, Trades=12
[INFO] Cluster 33 cluster: Short SMA=22, Long SMA=38, Sharpe=0.0541, Trades=84
[INFO] Cluster 34 cluster: Short SMA=92, Long SMA=166, Sharpe=-0.2111, Trades=16
[INFO] Cluster 35 cluster: Short SMA=122, Long SMA=280, Sharpe=0.1766, Trades=13
[INFO] Cluster 39 cluster: Short SMA=200, Long SMA=202, Sharpe=0.2470, Trades=82
[INFO] Cluster 40 cluster: Short SMA=192, Long SMA=220, Sharpe=0.3821, Trades=20
[INFO] Cluster 41 cluster: Short SMA=26, Long SMA=134, Sharpe=-0.1883, Trades=32
[INFO] Cluster 42 cluster: Short SMA=144, Long SMA=152, Sharpe=-0.2437, Trades=44
[INFO] Cluster 43 cluster: Short SMA=210, Long SMA=268, Sharpe=-0.0089, Trades=11
[INFO] Cluster 44 cluster: Short SMA=16, Long SMA=74, Sharpe=0.2423, Trades=46
[INFO] Cluster 45 cluster: Short SMA=198, Long SMA=246, Sharpe=0.2329, Trades=16
[INFO] Cluster 46 cluster: Short SMA=78, Long SMA=230, Sharpe=-0.2315, Trades=12
[INFO] Cluster 47 cluster: Short SMA=108, Long SMA=118, Sharpe=-0.0252, Trades=42
[INFO] Cluster 48 cluster: Short SMA=66, Long SMA=288, Sharpe=-0.0359, Trades=15
[INFO] Cluster 49 cluster: Short SMA=114, Long SMA=244, Sharpe=0.0680, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=160, Long SMA=262, Sharpe=0.6075, Trades=11
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=170, Long SMA=242, Sharpe=0.4285, Trades=12
[INFO] Top 2: Short SMA=198, Long SMA=208, Sharpe=0.4023, Trades=38
[INFO] Top 3: Short SMA=192, Long SMA=220, Sharpe=0.3821, Trades=20
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10213 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 160, Long SMA: 262
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(170/242) - Original Sharpe: 0.4285, Trades: 12
[INFO] Hierarchical cluster 2: SMA(198/208) - Original Sharpe: 0.4023, Trades: 38
[INFO] Hierarchical cluster 3: SMA(192/220) - Original Sharpe: 0.3821, Trades: 20
[INFO] Hierarchical cluster 4: SMA(154/272) - Original Sharpe: 0.2975, Trades: 11
[INFO] Hierarchical cluster 5: SMA(200/202) - Original Sharpe: 0.2470, Trades: 82
[INFO] Trimmed warm-up period. Evaluation data length: 2794
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (160/262)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (170/242) - Sharpe: 0.4285
[INFO] cluster 2: (198/208) - Sharpe: 0.4023
[INFO] cluster 3: (192/220) - Sharpe: 0.3821
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Out-of-sample period starts on: 2021-09-20
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-20 2021-09-20            45     1.874942            1.874942
1    2021-11-20 2021-11-20            41    -1.542081           -1.542081
2    2022-01-20 2022-01-20            42    -2.017855           -2.969025
3    2022-03-20 2022-03-20            42     1.424244            1.175750
4    2022-05-20 2022-05-20            43     0.980542            0.980542
5    2022-07-20 2022-07-20            44     1.402100            1.402100
6    2022-09-20 2022-09-20            44    -3.031215           -3.031215
7    2022-11-20 2022-11-20            43    -1.359366           -1.122281
8    2023-01-20 2023-01-20            41    -2.575891           -1.378293
9    2023-03-20 2023-03-20            42     4.502487            3.451302
10   2023-05-20 2023-05-20            43    -0.783470           -0.783470
11   2023-07-20 2023-07-20            44    -1.705868           -1.705868
12   2023-09-20 2023-09-20            43     0.424324            0.424324
13   2023-11-20 2023-11-20            42     2.238515            1.444379
14   2024-01-20 2024-01-20            42     1.404552           -3.653111
15   2024-03-20 2024-03-20            40     1.567381           -0.488950
16   2024-05-20 2024-05-20            45    -1.796289           -1.796289
17   2024-07-20 2024-07-20            44     0.668910            0.668910
18   2024-09-20 2024-09-20            43     0.376154            0.376154
19   2024-11-20 2024-11-20            26     2.631388            2.631388
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-20   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-20   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-01-20   |         -2.0 |             -3.0 |         -1.0 | False         
[INFO] 2022-03-20   |          1.4 |              1.2 |         -0.2 | False         
[INFO] 2022-05-20   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-07-20   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-09-20   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-11-20   |         -1.4 |             -1.1 |          0.3 | True          
[INFO] 2023-01-20   |         -2.6 |             -1.4 |          1.2 | True          
[INFO] 2023-03-20   |          4.5 |              3.5 |         -1.0 | False         
[INFO] 2023-05-20   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-07-20   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2023-11-20   |          2.2 |              1.4 |         -0.8 | False         
[INFO] 2024-01-20   |          1.4 |             -3.7 |         -5.1 | False         
[INFO] 2024-03-20   |          1.6 |             -0.5 |         -2.1 | False         
[INFO] 2024-05-20   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 2024-07-20   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-20   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-20, 2021-11-20, 2022-05-20, 2022-07-20, 2022-09-20, 2023-05-20, 2023-07-20, 2023-09-20, 2024-05-20, 2024-07-20, 2024-09-20, 2024-11-20
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 8 periods (25.00% win rate)
[INFO] Updating Excel file with Hierarchical results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Hierarchical win rate 25.0% in row 17
[INFO] Added best Sharpe parameters 160/262 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 160, Long SMA: 262
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(170/242) - Original Sharpe: 0.4285
[INFO] Added cluster 2 to portfolio: SMA(198/208) - Original Sharpe: 0.4023
[INFO] Added cluster 3 to portfolio: SMA(192/220) - Original Sharpe: 0.3821
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FDAX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3559
[INFO] Hierarchical Best out-of-sample Sharpe: -0.0286
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FDAX
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FESX in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 111.04s
[INFO] Best parameters: Short SMA = 106, Long SMA = 108
[INFO] Best Sharpe ratio: 0.401709, Trades: 83
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FESX
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 12.10 contracts
[INFO] Maximum Position Size: 27 contracts
[INFO] Strategy Total P&L: $187,176.00
[INFO] Market Buy & Hold P&L: $27,270.00
[INFO] Outperformance: $159,906.00
[INFO] Sharpe ratio (entire period, annualized): 0.239297
[INFO] Sharpe ratio (in-sample, annualized): 0.401709
[INFO] Sharpe ratio (out-of-sample, annualized): -0.147499
[INFO] Maximum Drawdown: $198,118.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 56
[INFO] Out-of-sample period trades: 27
[INFO] Total trades: 83
[INFO] In-sample P&L: $221,772.00
[INFO] Out-of-sample P&L: $-34,192.00
[INFO] 
Best parameters from GA: Short SMA = 106, Long SMA = 108, Sharpe = 0.401709
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9619 to 0.4017
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 108
[INFO] Sharpe Ratio: 0.401709
[INFO] Number of Trades: 83
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9868 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9619 to 0.4017
[INFO] Trades range: 10.0 to 337.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3348 to 2.8905
[INFO] Scaled Long SMA range: -2.7505 to 1.4945
[INFO] Scaled Sharpe ratio range: -5.5305 to 2.9544
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 141 elements
[INFO] Kmeans Cluster 1: 213 elements
[INFO] Kmeans Cluster 2: 224 elements
[INFO] Kmeans Cluster 3: 250 elements
[INFO] Kmeans Cluster 4: 332 elements
[INFO] Kmeans Cluster 5: 311 elements
[INFO] Kmeans Cluster 6: 122 elements
[INFO] Kmeans Cluster 7: 386 elements
[INFO] Kmeans Cluster 8: 203 elements
[INFO] Kmeans Cluster 9: 274 elements
[INFO] Kmeans Cluster 10: 132 elements
[INFO] Kmeans Cluster 11: 187 elements
[INFO] Kmeans Cluster 12: 155 elements
[INFO] Kmeans Cluster 13: 212 elements
[INFO] Kmeans Cluster 14: 247 elements
[INFO] Kmeans Cluster 15: 237 elements
[INFO] Kmeans Cluster 16: 111 elements
[INFO] Kmeans Cluster 17: 156 elements
[INFO] Kmeans Cluster 18: 288 elements
[INFO] Kmeans Cluster 19: 152 elements
[INFO] Kmeans Cluster 20: 176 elements
[INFO] Kmeans Cluster 21: 300 elements
[INFO] Kmeans Cluster 22: 168 elements
[INFO] Kmeans Cluster 23: 144 elements
[INFO] Kmeans Cluster 24: 210 elements
[INFO] Kmeans Cluster 25: 305 elements
[INFO] Kmeans Cluster 26: 162 elements
[INFO] Kmeans Cluster 27: 208 elements
[INFO] Kmeans Cluster 28: 204 elements
[INFO] Kmeans Cluster 29: 197 elements
[INFO] Kmeans Cluster 30: 195 elements
[INFO] Kmeans Cluster 31: 183 elements
[INFO] Kmeans Cluster 32: 93 elements
[INFO] Kmeans Cluster 33: 196 elements
[INFO] Kmeans Cluster 34: 141 elements
[INFO] Kmeans Cluster 35: 210 elements
[INFO] Kmeans Cluster 36: 226 elements
[INFO] Kmeans Cluster 37: 175 elements
[INFO] Kmeans Cluster 38: 167 elements
[INFO] Kmeans Cluster 39: 272 elements
[INFO] Kmeans Cluster 40: 116 elements
[INFO] Kmeans Cluster 41: 152 elements
[INFO] Kmeans Cluster 42: 79 elements
[INFO] Kmeans Cluster 43: 264 elements
[INFO] Kmeans Cluster 44: 118 elements
[INFO] Kmeans Cluster 45: 199 elements
[INFO] Kmeans Cluster 46: 97 elements
[INFO] Kmeans Cluster 47: 225 elements
[INFO] Kmeans Cluster 48: 160 elements
[INFO] Kmeans Cluster 49: 193 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=121.91, Long SMA=224.96, Sharpe=0.2360
[INFO] Centroid 1: Short SMA=55.68, Long SMA=105.92, Sharpe=-0.1431
[INFO] Centroid 2: Short SMA=46.38, Long SMA=214.04, Sharpe=-0.0164
[INFO] Centroid 3: Short SMA=154.04, Long SMA=217.34, Sharpe=-0.0439
[INFO] Centroid 4: Short SMA=187.43, Long SMA=228.48, Sharpe=0.0751
[INFO] Centroid 5: Short SMA=70.65, Long SMA=167.48, Sharpe=-0.1314
[INFO] Centroid 6: Short SMA=263.97, Long SMA=285.85, Sharpe=-0.2063
[INFO] Centroid 7: Short SMA=131.71, Long SMA=175.65, Sharpe=0.0541
[INFO] Centroid 8: Short SMA=62.04, Long SMA=256.45, Sharpe=-0.1833
[INFO] Centroid 9: Short SMA=98.39, Long SMA=266.89, Sharpe=0.1641
[INFO] Centroid 10: Short SMA=49.98, Long SMA=77.29, Sharpe=0.1406
[INFO] Centroid 11: Short SMA=38.52, Long SMA=163.49, Sharpe=-0.0483
[INFO] Centroid 12: Short SMA=26.57, Long SMA=109.34, Sharpe=-0.2620
[INFO] Centroid 13: Short SMA=29.70, Long SMA=277.81, Sharpe=-0.1934
[INFO] Centroid 14: Short SMA=229.64, Long SMA=277.81, Sharpe=-0.1164
[INFO] Centroid 15: Short SMA=120.32, Long SMA=234.56, Sharpe=0.0992
[INFO] Centroid 16: Short SMA=21.82, Long SMA=57.77, Sharpe=-0.4081
[INFO] Centroid 17: Short SMA=86.41, Long SMA=191.94, Sharpe=-0.3226
[INFO] Centroid 18: Short SMA=146.75, Long SMA=244.81, Sharpe=0.0369
[INFO] Centroid 19: Short SMA=81.95, Long SMA=126.67, Sharpe=0.1691
[INFO] Centroid 20: Short SMA=197.52, Long SMA=218.69, Sharpe=0.1803
[INFO] Centroid 21: Short SMA=215.05, Long SMA=249.08, Sharpe=-0.0207
[INFO] Centroid 22: Short SMA=118.37, Long SMA=141.69, Sharpe=-0.1478
[INFO] Centroid 23: Short SMA=128.92, Long SMA=282.46, Sharpe=-0.0564
[INFO] Centroid 24: Short SMA=50.04, Long SMA=81.87, Sharpe=0.0052
[INFO] Centroid 25: Short SMA=93.01, Long SMA=281.04, Sharpe=0.0608
[INFO] Centroid 26: Short SMA=23.01, Long SMA=159.67, Sharpe=-0.2368
[INFO] Centroid 27: Short SMA=24.53, Long SMA=54.15, Sharpe=-0.2391
[INFO] Centroid 28: Short SMA=21.68, Long SMA=202.44, Sharpe=-0.1440
[INFO] Centroid 29: Short SMA=72.29, Long SMA=205.74, Sharpe=-0.2002
[INFO] Centroid 30: Short SMA=238.84, Long SMA=278.82, Sharpe=-0.0158
[INFO] Centroid 31: Short SMA=83.22, Long SMA=125.99, Sharpe=0.0392
[INFO] Centroid 32: Short SMA=279.74, Long SMA=293.25, Sharpe=-0.4202
[INFO] Centroid 33: Short SMA=86.49, Long SMA=135.88, Sharpe=-0.0694
[INFO] Centroid 34: Short SMA=78.03, Long SMA=101.50, Sharpe=-0.3170
[INFO] Centroid 35: Short SMA=59.02, Long SMA=278.95, Sharpe=-0.0672
[INFO] Centroid 36: Short SMA=144.93, Long SMA=164.54, Sharpe=-0.0450
[INFO] Centroid 37: Short SMA=24.39, Long SMA=127.17, Sharpe=-0.3899
[INFO] Centroid 38: Short SMA=34.84, Long SMA=273.25, Sharpe=-0.2975
[INFO] Centroid 39: Short SMA=27.47, Long SMA=228.71, Sharpe=-0.2616
[INFO] Centroid 40: Short SMA=15.05, Long SMA=273.16, Sharpe=-0.0639
[INFO] Centroid 41: Short SMA=95.92, Long SMA=166.88, Sharpe=-0.2177
[INFO] Centroid 42: Short SMA=34.41, Long SMA=111.32, Sharpe=-0.5808
[INFO] Centroid 43: Short SMA=72.86, Long SMA=227.70, Sharpe=-0.1086
[INFO] Centroid 44: Short SMA=245.10, Long SMA=264.31, Sharpe=0.0954
[INFO] Centroid 45: Short SMA=165.22, Long SMA=193.06, Sharpe=0.1350
[INFO] Centroid 46: Short SMA=133.96, Long SMA=293.22, Sharpe=-0.1772
[INFO] Centroid 47: Short SMA=106.22, Long SMA=206.58, Sharpe=-0.0253
[INFO] Centroid 48: Short SMA=42.69, Long SMA=167.56, Sharpe=0.0631
[INFO] Centroid 49: Short SMA=27.23, Long SMA=63.34, Sharpe=-0.1002
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=108, Sharpe=0.4017, Trades=83
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=122, Long SMA=222, Sharpe=0.3174, Trades=17
[INFO] Kmeans Top 2: Short SMA=166, Long SMA=192, Sharpe=0.2047, Trades=19
[INFO] Kmeans Top 3: Short SMA=200, Long SMA=220, Sharpe=0.1855, Trades=18
[INFO] Kmeans Top 4: Short SMA=120, Long SMA=234, Sharpe=0.1491, Trades=19
[INFO] Kmeans Top 5: Short SMA=248, Long SMA=264, Sharpe=0.1487, Trades=21
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (122, 225)
[INFO]   Nearest: (122.0, 224.0)
[INFO]   Rounded: (56, 106)
[INFO]   Rounded: (46, 214)
[INFO]   Rounded: (154, 217)
[INFO]   Nearest: (154.0, 218.0)
[INFO]   Rounded: (187, 228)
[INFO]   Nearest: (188.0, 228.0)
[INFO]   Rounded: (71, 167)
[INFO]   Nearest: (70.0, 168.0)
[INFO]   Rounded: (264, 286)
[INFO]   Rounded: (132, 176)
[INFO]   Rounded: (62, 256)
[INFO]   Rounded: (98, 267)
[INFO]   Nearest: (98.0, 266.0)
[INFO]   Rounded: (50, 77)
[INFO]   Nearest: (50.0, 78.0)
[INFO]   Rounded: (39, 163)
[INFO]   Nearest: (38.0, 164.0)
[INFO]   Rounded: (27, 109)
[INFO]   Nearest: (26.0, 110.0)
[INFO]   Rounded: (30, 278)
[INFO]   Rounded: (230, 278)
[INFO]   Rounded: (120, 235)
[INFO]   Nearest: (120.0, 234.0)
[INFO]   Rounded: (22, 58)
[INFO]   Rounded: (86, 192)
[INFO]   Rounded: (147, 245)
[INFO]   Nearest: (146.0, 244.0)
[INFO]   Rounded: (82, 127)
[INFO]   Nearest: (82.0, 126.0)
[INFO]   Rounded: (198, 219)
[INFO]   Nearest: (198.0, 218.0)
[INFO]   Rounded: (215, 249)
[INFO]   Nearest: (216.0, 250.0)
[INFO]   Rounded: (118, 142)
[INFO]   Rounded: (129, 282)
[INFO]   Nearest: (128.0, 282.0)
[INFO]   Rounded: (50, 82)
[INFO]   Rounded: (93, 281)
[INFO]   Nearest: (94.0, 282.0)
[INFO]   Rounded: (23, 160)
[INFO]   Nearest: (24.0, 160.0)
[INFO]   Rounded: (25, 54)
[INFO]   Nearest: (24.0, 54.0)
[INFO]   Rounded: (22, 202)
[INFO]   Rounded: (72, 206)
[INFO]   Rounded: (239, 279)
[INFO]   Nearest: (238.0, 278.0)
[INFO]   Rounded: (83, 126)
[INFO]   Nearest: (84.0, 126.0)
[INFO]   Rounded: (280, 293)
[INFO]   Nearest: (280.0, 294.0)
[INFO]   Rounded: (86, 136)
[INFO]   Rounded: (78, 102)
[INFO]   Rounded: (59, 279)
[INFO]   Nearest: (60.0, 278.0)
[INFO]   Rounded: (145, 165)
[INFO]   Nearest: (144.0, 164.0)
[INFO]   Rounded: (24, 127)
[INFO]   Nearest: (24.0, 128.0)
[INFO]   Rounded: (35, 273)
[INFO]   Nearest: (34.0, 274.0)
[INFO]   Rounded: (27, 229)
[INFO]   Nearest: (28.0, 228.0)
[INFO]   Rounded: (15, 273)
[INFO]   Nearest: (16.0, 274.0)
[INFO]   Rounded: (96, 167)
[INFO]   Nearest: (96.0, 166.0)
[INFO]   Rounded: (34, 111)
[INFO]   Nearest: (34.0, 112.0)
[INFO]   Rounded: (73, 228)
[INFO]   Nearest: (72.0, 228.0)
[INFO]   Rounded: (245, 264)
[INFO]   Nearest: (246.0, 264.0)
[INFO]   Rounded: (165, 193)
[INFO]   Nearest: (166.0, 194.0)
[INFO]   Rounded: (134, 293)
[INFO]   Nearest: (134.0, 294.0)
[INFO]   Rounded: (106, 207)
[INFO]   Nearest: (106.0, 206.0)
[INFO]   Rounded: (43, 168)
[INFO]   Nearest: (42.0, 168.0)
[INFO]   Rounded: (27, 63)
[INFO]   Nearest: (28.0, 64.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 108
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(122/222) - Original Sharpe: 0.3174, Trades: 17
[INFO] Kmeans cluster 2: SMA(166/192) - Original Sharpe: 0.2047, Trades: 19
[INFO] Kmeans cluster 3: SMA(200/220) - Original Sharpe: 0.1855, Trades: 18
[INFO] Kmeans cluster 4: SMA(120/234) - Original Sharpe: 0.1491, Trades: 19
[INFO] Kmeans cluster 5: SMA(248/264) - Original Sharpe: 0.1487, Trades: 21
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/108)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (122/222) - Sharpe: 0.3174
[INFO] cluster 2: (166/192) - Sharpe: 0.2047
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.819258            1.819258
1    2021-11-16 2021-11-16            42    -0.990182           -1.393676
2    2022-01-16 2022-01-16            42    -3.234063           -3.234063
3    2022-03-16 2022-03-16            41     1.259415            1.232166
4    2022-05-16 2022-05-16            45     1.642319            1.642319
5    2022-07-16 2022-07-16            44     0.816637           -0.103327
6    2022-09-16 2022-09-16            43    -1.315674           -2.305190
7    2022-11-16 2022-11-16            42    -4.141997            1.680704
8    2023-01-16 2023-01-16            43    -0.549165           -0.875610
9    2023-03-16 2023-03-16            40     2.960185            2.960185
10   2023-05-16 2023-05-16            44     0.373260            0.373260
11   2023-07-16 2023-07-16            45    -1.929853           -1.162382
12   2023-09-16 2023-09-16            43    -1.339093            0.025666
13   2023-11-16 2023-11-16            40    -1.599206            4.580108
14   2024-01-16 2024-01-16            44     7.610619           -1.893399
15   2024-03-16 2024-03-16            40     1.356364            1.356364
16   2024-05-16 2024-05-16            43    -1.239630           -1.239630
17   2024-07-16 2024-07-16            44    -2.440824           -1.421227
18   2024-09-16 2024-09-16            45     0.297766           -0.309976
19   2024-11-16 2024-11-16            28    -0.195314           -2.123414
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-16   |         -1.0 |             -1.4 |         -0.4 | False         
[INFO] 2022-01-16   |         -3.2 |             -3.2 |          0.0 | Excluded      
[INFO] 2022-03-16   |          1.3 |              1.2 |         -0.1 | False         
[INFO] 2022-05-16   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2022-07-16   |          0.8 |             -0.1 |         -0.9 | False         
[INFO] 2022-09-16   |         -1.3 |             -2.3 |         -1.0 | False         
[INFO] 2022-11-16   |         -4.1 |              1.7 |          5.8 | True          
[INFO] 2023-01-16   |         -0.5 |             -0.9 |         -0.4 | False         
[INFO] 2023-03-16   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-05-16   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2023-07-16   |         -1.9 |             -1.2 |          0.7 | True          
[INFO] 2023-09-16   |         -1.3 |              0.0 |          1.3 | True          
[INFO] 2023-11-16   |         -1.6 |              4.6 |          6.2 | True          
[INFO] 2024-01-16   |          7.6 |             -1.9 |         -9.5 | False         
[INFO] 2024-03-16   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2024-05-16   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2024-07-16   |         -2.4 |             -1.4 |          1.0 | True          
[INFO] 2024-09-16   |          0.3 |             -0.3 |         -0.6 | False         
[INFO] 2024-11-16   |         -0.2 |             -2.1 |         -1.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-01-16, 2022-05-16, 2023-03-16, 2023-05-16, 2024-03-16, 2024-05-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 5 of 13 periods (38.46% win rate)
[INFO] Updating Excel file with Kmeans results for FESX...
[INFO] Excel file updated successfully. Added FESX with Kmeans win rate 38.5% in row 18
[INFO] Added best Sharpe parameters 106/108 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 108
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(122/222) - Original Sharpe: 0.3174
[INFO] Added cluster 2 to portfolio: SMA(166/192) - Original Sharpe: 0.2047
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FESX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.2042
[INFO] Kmeans Best out-of-sample Sharpe: -0.1475
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FESX...
[INFO] Excel file updated successfully. Added FESX with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FESX
[INFO] Big Point Value: 10.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9619 to 0.4017
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 108
[INFO] Sharpe Ratio: 0.401709
[INFO] Number of Trades: 83
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9868 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9619 to 0.4017
[INFO] Trades range: 10.0 to 337.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3348 to 2.8905
[INFO] Scaled Long SMA range: -2.7505 to 1.4945
[INFO] Scaled Sharpe ratio range: -5.5305 to 2.9544
[INFO] Scaled Trades range: -0.6994 to 15.5517
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9868 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4669
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 87 elements
[INFO] Cluster 1: 464 elements
[INFO] Cluster 2: 266 elements
[INFO] Cluster 3: 334 elements
[INFO] Cluster 4: 134 elements
[INFO] Cluster 5: 265 elements
[INFO] Cluster 6: 200 elements
[INFO] Cluster 7: 258 elements
[INFO] Cluster 8: 341 elements
[INFO] Cluster 9: 310 elements
[INFO] Cluster 10: 7 elements
[INFO] Cluster 11: 102 elements
[INFO] Cluster 12: 192 elements
[INFO] Cluster 13: 303 elements
[INFO] Cluster 14: 315 elements
[INFO] Cluster 15: 358 elements
[INFO] Cluster 16: 147 elements
[INFO] Cluster 17: 22 elements
[INFO] Cluster 18: 81 elements
[INFO] Cluster 19: 427 elements
[INFO] Cluster 20: 370 elements
[INFO] Cluster 21: 291 elements
[INFO] Cluster 22: 240 elements
[INFO] Cluster 23: 32 elements
[INFO] Cluster 24: 224 elements
[INFO] Cluster 25: 231 elements
[INFO] Cluster 26: 196 elements
[INFO] Cluster 27: 172 elements
[INFO] Cluster 28: 362 elements
[INFO] Cluster 29: 11 elements
[INFO] Cluster 30: 20 elements
[INFO] Cluster 31: 267 elements
[INFO] Cluster 32: 28 elements
[INFO] Cluster 33: 424 elements
[INFO] Cluster 34: 330 elements
[INFO] Cluster 35: 203 elements
[INFO] Cluster 36: 38 elements
[INFO] Cluster 37: 30 elements
[INFO] Cluster 38: 138 elements
[INFO] Cluster 39: 182 elements
[INFO] Cluster 40: 96 elements
[INFO] Cluster 41: 362 elements
[INFO] Cluster 42: 133 elements
[INFO] Cluster 43: 17 elements
[INFO] Cluster 44: 199 elements
[INFO] Cluster 45: 210 elements
[INFO] Cluster 46: 68 elements
[INFO] Cluster 47: 160 elements
[INFO] Cluster 48: 155 elements
[INFO] Cluster 49: 66 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=30, Long SMA=38, Sharpe=-0.0703, Trades=107
[INFO] Cluster 1 cluster: Short SMA=60, Long SMA=260, Sharpe=-0.0856, Trades=18
[INFO] Cluster 2 cluster: Short SMA=26, Long SMA=118, Sharpe=-0.3628, Trades=33
[INFO] Cluster 3 cluster: Short SMA=242, Long SMA=286, Sharpe=-0.1203, Trades=13
[INFO] Cluster 4 cluster: Short SMA=120, Long SMA=128, Sharpe=-0.0926, Trades=41
[INFO] Cluster 5 cluster: Short SMA=90, Long SMA=126, Sharpe=-0.0093, Trades=28
[INFO] Cluster 6 cluster: Short SMA=52, Long SMA=86, Sharpe=0.0922, Trades=33
[INFO] Cluster 7 cluster: Short SMA=244, Long SMA=274, Sharpe=-0.0248, Trades=15
[INFO] Cluster 8 cluster: Short SMA=178, Long SMA=234, Sharpe=0.0757, Trades=14
[INFO] Cluster 9 cluster: Short SMA=46, Long SMA=118, Sharpe=-0.1857, Trades=27
[INFO] Cluster 11 cluster: Short SMA=282, Long SMA=292, Sharpe=-0.3850, Trades=21
[INFO] Cluster 12 cluster: Short SMA=14, Long SMA=266, Sharpe=-0.1659, Trades=29
[INFO] Cluster 13 cluster: Short SMA=46, Long SMA=158, Sharpe=0.0543, Trades=15
[INFO] Cluster 14 cluster: Short SMA=42, Long SMA=278, Sharpe=-0.2141, Trades=20
[INFO] Cluster 15 cluster: Short SMA=70, Long SMA=206, Sharpe=-0.1862, Trades=17
[INFO] Cluster 16 cluster: Short SMA=26, Long SMA=58, Sharpe=-0.2450, Trades=61
[INFO] Cluster 17 cluster: Short SMA=22, Long SMA=26, Sharpe=-0.2488, Trades=159
[INFO] Cluster 18 cluster: Short SMA=28, Long SMA=130, Sharpe=-0.5856, Trades=33
[INFO] Cluster 19 cluster: Short SMA=138, Long SMA=246, Sharpe=0.0885, Trades=11
[INFO] Cluster 20 cluster: Short SMA=186, Long SMA=212, Sharpe=0.1425, Trades=19
[INFO] Cluster 21 cluster: Short SMA=70, Long SMA=162, Sharpe=-0.1410, Trades=15
[INFO] Cluster 22 cluster: Short SMA=118, Long SMA=230, Sharpe=0.2020, Trades=15
[INFO] Cluster 23 cluster: Short SMA=238, Long SMA=240, Sharpe=-0.0059, Trades=44
[INFO] Cluster 24 cluster: Short SMA=22, Long SMA=182, Sharpe=-0.1315, Trades=23
[INFO] Cluster 25 cluster: Short SMA=150, Long SMA=168, Sharpe=-0.0126, Trades=25
[INFO] Cluster 26 cluster: Short SMA=106, Long SMA=206, Sharpe=-0.0550, Trades=15
[INFO] Cluster 27 cluster: Short SMA=60, Long SMA=100, Sharpe=-0.0716, Trades=31
[INFO] Cluster 28 cluster: Short SMA=126, Long SMA=180, Sharpe=0.1708, Trades=15
[INFO] Cluster 30 cluster: Short SMA=56, Long SMA=62, Sharpe=0.1677, Trades=87
[INFO] Cluster 31 cluster: Short SMA=48, Long SMA=212, Sharpe=-0.0258, Trades=17
[INFO] Cluster 32 cluster: Short SMA=186, Long SMA=188, Sharpe=0.0472, Trades=71
[INFO] Cluster 33 cluster: Short SMA=100, Long SMA=266, Sharpe=0.1042, Trades=13
[INFO] Cluster 34 cluster: Short SMA=32, Long SMA=244, Sharpe=-0.2771, Trades=19
[INFO] Cluster 35 cluster: Short SMA=130, Long SMA=290, Sharpe=-0.0624, Trades=11
[INFO] Cluster 36 cluster: Short SMA=48, Long SMA=54, Sharpe=-0.3712, Trades=95
[INFO] Cluster 37 cluster: Short SMA=138, Long SMA=140, Sharpe=-0.0902, Trades=81
[INFO] Cluster 38 cluster: Short SMA=20, Long SMA=86, Sharpe=-0.3242, Trades=44
[INFO] Cluster 39 cluster: Short SMA=110, Long SMA=144, Sharpe=-0.1190, Trades=21
[INFO] Cluster 40 cluster: Short SMA=14, Long SMA=86, Sharpe=-0.0376, Trades=48
[INFO] Cluster 41 cluster: Short SMA=214, Long SMA=254, Sharpe=0.0071, Trades=14
[INFO] Cluster 42 cluster: Short SMA=16, Long SMA=210, Sharpe=-0.2610, Trades=29
[INFO] Cluster 44 cluster: Short SMA=156, Long SMA=214, Sharpe=0.0017, Trades=15
[INFO] Cluster 45 cluster: Short SMA=96, Long SMA=162, Sharpe=-0.2428, Trades=15
[INFO] Cluster 46 cluster: Short SMA=56, Long SMA=68, Sharpe=-0.0360, Trades=65
[INFO] Cluster 47 cluster: Short SMA=86, Long SMA=192, Sharpe=-0.3954, Trades=15
[INFO] Cluster 48 cluster: Short SMA=78, Long SMA=288, Sharpe=0.0036, Trades=15
[INFO] Cluster 49 cluster: Short SMA=24, Long SMA=44, Sharpe=-0.3298, Trades=83
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=108, Sharpe=0.4017, Trades=83
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=118, Long SMA=230, Sharpe=0.2020, Trades=15
[INFO] Top 2: Short SMA=126, Long SMA=180, Sharpe=0.1708, Trades=15
[INFO] Top 3: Short SMA=56, Long SMA=62, Sharpe=0.1677, Trades=87
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 9833 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 108
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(118/230) - Original Sharpe: 0.2020, Trades: 15
[INFO] Hierarchical cluster 2: SMA(126/180) - Original Sharpe: 0.1708, Trades: 15
[INFO] Hierarchical cluster 3: SMA(56/62) - Original Sharpe: 0.1677, Trades: 87
[INFO] Hierarchical cluster 4: SMA(186/212) - Original Sharpe: 0.1425, Trades: 19
[INFO] Hierarchical cluster 5: SMA(100/266) - Original Sharpe: 0.1042, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/108)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (118/230) - Sharpe: 0.2020
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.819258            1.819258
1    2021-11-16 2021-11-16            42    -0.990182           -1.393676
2    2022-01-16 2022-01-16            42    -3.234063           -3.234063
3    2022-03-16 2022-03-16            41     1.259415            0.819373
4    2022-05-16 2022-05-16            45     1.642319            1.642319
5    2022-07-16 2022-07-16            44     0.816637           -0.103327
6    2022-09-16 2022-09-16            43    -1.315674           -2.305190
7    2022-11-16 2022-11-16            42    -4.141997            2.722207
8    2023-01-16 2023-01-16            43    -0.549165           -0.875610
9    2023-03-16 2023-03-16            40     2.960185            2.960185
10   2023-05-16 2023-05-16            44     0.373260            0.373260
11   2023-07-16 2023-07-16            45    -1.929853           -1.162382
12   2023-09-16 2023-09-16            43    -1.339093            0.025666
13   2023-11-16 2023-11-16            40    -1.599206            5.419019
14   2024-01-16 2024-01-16            44     7.610619           -0.483500
15   2024-03-16 2024-03-16            40     1.356364            1.356364
16   2024-05-16 2024-05-16            43    -1.239630           -1.239630
17   2024-07-16 2024-07-16            44    -2.440824           -1.421227
18   2024-09-16 2024-09-16            45     0.297766           -0.309976
19   2024-11-16 2024-11-16            28    -0.195314           -1.444204
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-16   |         -1.0 |             -1.4 |         -0.4 | False         
[INFO] 2022-01-16   |         -3.2 |             -3.2 |          0.0 | Excluded      
[INFO] 2022-03-16   |          1.3 |              0.8 |         -0.5 | False         
[INFO] 2022-05-16   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2022-07-16   |          0.8 |             -0.1 |         -0.9 | False         
[INFO] 2022-09-16   |         -1.3 |             -2.3 |         -1.0 | False         
[INFO] 2022-11-16   |         -4.1 |              2.7 |          6.8 | True          
[INFO] 2023-01-16   |         -0.5 |             -0.9 |         -0.4 | False         
[INFO] 2023-03-16   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-05-16   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2023-07-16   |         -1.9 |             -1.2 |          0.7 | True          
[INFO] 2023-09-16   |         -1.3 |              0.0 |          1.3 | True          
[INFO] 2023-11-16   |         -1.6 |              5.4 |          7.0 | True          
[INFO] 2024-01-16   |          7.6 |             -0.5 |         -8.1 | False         
[INFO] 2024-03-16   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2024-05-16   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2024-07-16   |         -2.4 |             -1.4 |          1.0 | True          
[INFO] 2024-09-16   |          0.3 |             -0.3 |         -0.6 | False         
[INFO] 2024-11-16   |         -0.2 |             -1.4 |         -1.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-01-16, 2022-05-16, 2023-03-16, 2023-05-16, 2024-03-16, 2024-05-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 13 periods (38.46% win rate)
[INFO] Updating Excel file with Hierarchical results for FESX...
[INFO] Excel file updated successfully. Added FESX with Hierarchical win rate 38.5% in row 18
[INFO] Added best Sharpe parameters 106/108 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 108
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(118/230) - Original Sharpe: 0.2020
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FESX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0102
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1475
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FESX...
[INFO] Excel file updated successfully. Added FESX with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FESX
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FGBL in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 152.38s
[INFO] Best parameters: Short SMA = 36, Long SMA = 62
[INFO] Best Sharpe ratio: 1.001266, Trades: 41
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FGBL
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.50 contracts
[INFO] Maximum Position Size: 13 contracts
[INFO] Strategy Total P&L: $427,442.00
[INFO] Market Buy & Hold P&L: $23,030.00
[INFO] Outperformance: $404,412.00
[INFO] Sharpe ratio (entire period, annualized): 0.670529
[INFO] Sharpe ratio (in-sample, annualized): 1.001266
[INFO] Sharpe ratio (out-of-sample, annualized): -0.101266
[INFO] Maximum Drawdown: $157,502.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 28
[INFO] Out-of-sample period trades: 13
[INFO] Total trades: 41
[INFO] In-sample P&L: $532,570.00
[INFO] Out-of-sample P&L: $-23,060.00
[INFO] 
Best parameters from GA: Short SMA = 36, Long SMA = 62, Sharpe = 1.001266
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.2062 to 1.0013
[INFO] 
Best parameters:
[INFO] Short SMA: 36
[INFO] Long SMA: 62
[INFO] Sharpe Ratio: 1.001266
[INFO] Number of Trades: 41
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10508 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.2062 to 1.0013
[INFO] Trades range: 10.0 to 294.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3925 to 2.8029
[INFO] Scaled Long SMA range: -2.7982 to 1.4140
[INFO] Scaled Sharpe ratio range: -3.6757 to 3.4265
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 200 elements
[INFO] Kmeans Cluster 1: 222 elements
[INFO] Kmeans Cluster 2: 271 elements
[INFO] Kmeans Cluster 3: 206 elements
[INFO] Kmeans Cluster 4: 232 elements
[INFO] Kmeans Cluster 5: 241 elements
[INFO] Kmeans Cluster 6: 252 elements
[INFO] Kmeans Cluster 7: 292 elements
[INFO] Kmeans Cluster 8: 257 elements
[INFO] Kmeans Cluster 9: 177 elements
[INFO] Kmeans Cluster 10: 229 elements
[INFO] Kmeans Cluster 11: 94 elements
[INFO] Kmeans Cluster 12: 201 elements
[INFO] Kmeans Cluster 13: 193 elements
[INFO] Kmeans Cluster 14: 398 elements
[INFO] Kmeans Cluster 15: 240 elements
[INFO] Kmeans Cluster 16: 262 elements
[INFO] Kmeans Cluster 17: 219 elements
[INFO] Kmeans Cluster 18: 215 elements
[INFO] Kmeans Cluster 19: 282 elements
[INFO] Kmeans Cluster 20: 214 elements
[INFO] Kmeans Cluster 21: 265 elements
[INFO] Kmeans Cluster 22: 144 elements
[INFO] Kmeans Cluster 23: 320 elements
[INFO] Kmeans Cluster 24: 130 elements
[INFO] Kmeans Cluster 25: 226 elements
[INFO] Kmeans Cluster 26: 280 elements
[INFO] Kmeans Cluster 27: 248 elements
[INFO] Kmeans Cluster 28: 236 elements
[INFO] Kmeans Cluster 29: 76 elements
[INFO] Kmeans Cluster 30: 246 elements
[INFO] Kmeans Cluster 31: 91 elements
[INFO] Kmeans Cluster 32: 71 elements
[INFO] Kmeans Cluster 33: 254 elements
[INFO] Kmeans Cluster 34: 151 elements
[INFO] Kmeans Cluster 35: 204 elements
[INFO] Kmeans Cluster 36: 243 elements
[INFO] Kmeans Cluster 37: 173 elements
[INFO] Kmeans Cluster 38: 244 elements
[INFO] Kmeans Cluster 39: 31 elements
[INFO] Kmeans Cluster 40: 229 elements
[INFO] Kmeans Cluster 41: 230 elements
[INFO] Kmeans Cluster 42: 242 elements
[INFO] Kmeans Cluster 43: 141 elements
[INFO] Kmeans Cluster 44: 234 elements
[INFO] Kmeans Cluster 45: 267 elements
[INFO] Kmeans Cluster 46: 152 elements
[INFO] Kmeans Cluster 47: 64 elements
[INFO] Kmeans Cluster 48: 202 elements
[INFO] Kmeans Cluster 49: 217 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=158.14, Long SMA=179.06, Sharpe=0.6236
[INFO] Centroid 1: Short SMA=25.72, Long SMA=145.95, Sharpe=0.3723
[INFO] Centroid 2: Short SMA=26.79, Long SMA=285.32, Sharpe=0.4009
[INFO] Centroid 3: Short SMA=220.24, Long SMA=250.75, Sharpe=0.5085
[INFO] Centroid 4: Short SMA=32.72, Long SMA=199.85, Sharpe=0.0423
[INFO] Centroid 5: Short SMA=26.82, Long SMA=105.78, Sharpe=0.6608
[INFO] Centroid 6: Short SMA=179.12, Long SMA=256.45, Sharpe=0.3178
[INFO] Centroid 7: Short SMA=89.20, Long SMA=274.84, Sharpe=0.5642
[INFO] Centroid 8: Short SMA=258.72, Long SMA=288.80, Sharpe=0.4739
[INFO] Centroid 9: Short SMA=92.32, Long SMA=121.34, Sharpe=0.1004
[INFO] Centroid 10: Short SMA=120.33, Long SMA=197.81, Sharpe=0.4317
[INFO] Centroid 11: Short SMA=19.60, Long SMA=45.32, Sharpe=0.4262
[INFO] Centroid 12: Short SMA=73.99, Long SMA=167.90, Sharpe=0.3548
[INFO] Centroid 13: Short SMA=34.81, Long SMA=69.73, Sharpe=0.7016
[INFO] Centroid 14: Short SMA=80.11, Long SMA=237.83, Sharpe=0.4706
[INFO] Centroid 15: Short SMA=60.83, Long SMA=143.60, Sharpe=0.2807
[INFO] Centroid 16: Short SMA=142.88, Long SMA=274.33, Sharpe=0.5679
[INFO] Centroid 17: Short SMA=39.42, Long SMA=168.89, Sharpe=0.2445
[INFO] Centroid 18: Short SMA=31.25, Long SMA=71.48, Sharpe=0.5583
[INFO] Centroid 19: Short SMA=126.98, Long SMA=256.29, Sharpe=0.6459
[INFO] Centroid 20: Short SMA=220.18, Long SMA=263.33, Sharpe=0.6433
[INFO] Centroid 21: Short SMA=37.47, Long SMA=192.41, Sharpe=0.1469
[INFO] Centroid 22: Short SMA=63.67, Long SMA=87.42, Sharpe=0.4395
[INFO] Centroid 23: Short SMA=165.92, Long SMA=232.48, Sharpe=0.4288
[INFO] Centroid 24: Short SMA=130.17, Long SMA=215.51, Sharpe=0.7157
[INFO] Centroid 25: Short SMA=53.84, Long SMA=257.61, Sharpe=0.3602
[INFO] Centroid 26: Short SMA=89.81, Long SMA=181.24, Sharpe=0.4695
[INFO] Centroid 27: Short SMA=111.79, Long SMA=284.00, Sharpe=0.4389
[INFO] Centroid 28: Short SMA=208.78, Long SMA=231.84, Sharpe=0.4008
[INFO] Centroid 29: Short SMA=19.18, Long SMA=33.18, Sharpe=0.2635
[INFO] Centroid 30: Short SMA=66.63, Long SMA=105.08, Sharpe=0.3042
[INFO] Centroid 31: Short SMA=98.26, Long SMA=118.97, Sharpe=-0.0189
[INFO] Centroid 32: Short SMA=39.15, Long SMA=63.38, Sharpe=0.8506
[INFO] Centroid 33: Short SMA=126.37, Long SMA=162.01, Sharpe=0.3645
[INFO] Centroid 34: Short SMA=261.81, Long SMA=281.66, Sharpe=0.3503
[INFO] Centroid 35: Short SMA=25.39, Long SMA=253.25, Sharpe=0.2675
[INFO] Centroid 36: Short SMA=60.63, Long SMA=282.47, Sharpe=0.4599
[INFO] Centroid 37: Short SMA=52.44, Long SMA=219.50, Sharpe=0.2646
[INFO] Centroid 38: Short SMA=94.75, Long SMA=213.26, Sharpe=0.3651
[INFO] Centroid 39: Short SMA=23.10, Long SMA=35.10, Sharpe=0.0703
[INFO] Centroid 40: Short SMA=213.39, Long SMA=285.59, Sharpe=0.5547
[INFO] Centroid 41: Short SMA=137.83, Long SMA=218.66, Sharpe=0.5598
[INFO] Centroid 42: Short SMA=177.86, Long SMA=281.22, Sharpe=0.4412
[INFO] Centroid 43: Short SMA=25.01, Long SMA=132.06, Sharpe=0.4926
[INFO] Centroid 44: Short SMA=74.97, Long SMA=123.64, Sharpe=0.1931
[INFO] Centroid 45: Short SMA=181.99, Long SMA=208.49, Sharpe=0.5011
[INFO] Centroid 46: Short SMA=112.34, Long SMA=140.80, Sharpe=0.2451
[INFO] Centroid 47: Short SMA=239.59, Long SMA=265.72, Sharpe=0.7786
[INFO] Centroid 48: Short SMA=24.45, Long SMA=233.53, Sharpe=0.1205
[INFO] Centroid 49: Short SMA=139.71, Long SMA=169.35, Sharpe=0.5043
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=36, Long SMA=62, Sharpe=1.0013, Trades=41
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=42, Long SMA=62, Sharpe=0.9392, Trades=47
[INFO] Kmeans Top 2: Short SMA=242, Long SMA=266, Sharpe=0.7978, Trades=24
[INFO] Kmeans Top 3: Short SMA=130, Long SMA=220, Sharpe=0.7460, Trades=15
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=70, Sharpe=0.7060, Trades=33
[INFO] Kmeans Top 5: Short SMA=218, Long SMA=262, Sharpe=0.6363, Trades=14
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (158, 179)
[INFO]   Nearest: (158.0, 180.0)
[INFO]   Rounded: (26, 146)
[INFO]   Rounded: (27, 285)
[INFO]   Nearest: (26.0, 286.0)
[INFO]   Rounded: (220, 251)
[INFO]   Nearest: (220.0, 250.0)
[INFO]   Rounded: (33, 200)
[INFO]   Nearest: (32.0, 200.0)
[INFO]   Rounded: (27, 106)
[INFO]   Nearest: (26.0, 106.0)
[INFO]   Rounded: (179, 256)
[INFO]   Nearest: (180.0, 256.0)
[INFO]   Rounded: (89, 275)
[INFO]   Nearest: (90.0, 274.0)
[INFO]   Rounded: (259, 289)
[INFO]   Nearest: (258.0, 288.0)
[INFO]   Rounded: (92, 121)
[INFO]   Nearest: (92.0, 122.0)
[INFO]   Rounded: (120, 198)
[INFO]   Rounded: (20, 45)
[INFO]   Nearest: (20.0, 46.0)
[INFO]   Rounded: (74, 168)
[INFO]   Rounded: (35, 70)
[INFO]   Nearest: (34.0, 70.0)
[INFO]   Rounded: (80, 238)
[INFO]   Rounded: (61, 144)
[INFO]   Nearest: (60.0, 144.0)
[INFO]   Rounded: (143, 274)
[INFO]   Nearest: (142.0, 274.0)
[INFO]   Rounded: (39, 169)
[INFO]   Nearest: (40.0, 168.0)
[INFO]   Rounded: (31, 71)
[INFO]   Nearest: (32.0, 72.0)
[INFO]   Rounded: (127, 256)
[INFO]   Nearest: (126.0, 256.0)
[INFO]   Rounded: (220, 263)
[INFO]   Nearest: (220.0, 264.0)
[INFO]   Rounded: (37, 192)
[INFO]   Nearest: (38.0, 192.0)
[INFO]   Rounded: (64, 87)
[INFO]   Nearest: (64.0, 88.0)
[INFO]   Rounded: (166, 232)
[INFO]   Rounded: (130, 216)
[INFO]   Rounded: (54, 258)
[INFO]   Rounded: (90, 181)
[INFO]   Nearest: (90.0, 182.0)
[INFO]   Rounded: (112, 284)
[INFO]   Rounded: (209, 232)
[INFO]   Nearest: (208.0, 232.0)
[INFO]   Rounded: (19, 33)
[INFO]   Nearest: (20.0, 34.0)
[INFO]   Rounded: (67, 105)
[INFO]   Nearest: (66.0, 106.0)
[INFO]   Rounded: (98, 119)
[INFO]   Nearest: (98.0, 118.0)
[INFO]   Rounded: (39, 63)
[INFO]   Nearest: (40.0, 64.0)
[INFO]   Rounded: (126, 162)
[INFO]   Rounded: (262, 282)
[INFO]   Rounded: (25, 253)
[INFO]   Nearest: (26.0, 254.0)
[INFO]   Rounded: (61, 282)
[INFO]   Nearest: (60.0, 282.0)
[INFO]   Rounded: (52, 220)
[INFO]   Rounded: (95, 213)
[INFO]   Nearest: (94.0, 214.0)
[INFO]   Rounded: (23, 35)
[INFO]   Nearest: (24.0, 36.0)
[INFO]   Rounded: (213, 286)
[INFO]   Nearest: (214.0, 286.0)
[INFO]   Rounded: (138, 219)
[INFO]   Nearest: (138.0, 218.0)
[INFO]   Rounded: (178, 281)
[INFO]   Nearest: (178.0, 282.0)
[INFO]   Rounded: (25, 132)
[INFO]   Nearest: (26.0, 132.0)
[INFO]   Rounded: (75, 124)
[INFO]   Nearest: (74.0, 124.0)
[INFO]   Rounded: (182, 208)
[INFO]   Rounded: (112, 141)
[INFO]   Nearest: (112.0, 140.0)
[INFO]   Rounded: (240, 266)
[INFO]   Rounded: (24, 234)
[INFO]   Rounded: (140, 169)
[INFO]   Nearest: (140.0, 170.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 36, Long SMA: 62
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(42/62) - Original Sharpe: 0.9392, Trades: 47
[INFO] Kmeans cluster 2: SMA(242/266) - Original Sharpe: 0.7978, Trades: 24
[INFO] Kmeans cluster 3: SMA(130/220) - Original Sharpe: 0.7460, Trades: 15
[INFO] Kmeans cluster 4: SMA(36/70) - Original Sharpe: 0.7060, Trades: 33
[INFO] Kmeans cluster 5: SMA(218/262) - Original Sharpe: 0.6363, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (36/62)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (42/62) - Sharpe: 0.9392
[INFO] cluster 2: (242/266) - Sharpe: 0.7978
[INFO] cluster 3: (130/220) - Sharpe: 0.7460
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -1.923691            0.003050
1    2021-11-16 2021-11-16            42    -5.059052           -4.530853
2    2022-01-16 2022-01-16            42     2.440556            0.617332
3    2022-03-16 2022-03-16            41     3.634012            3.634012
4    2022-05-16 2022-05-16            45     1.252348            1.252348
5    2022-07-16 2022-07-16            44    -7.003364            0.610248
6    2022-09-16 2022-09-16            43     0.563233            0.305290
7    2022-11-16 2022-11-16            42    -3.204331           -0.112261
8    2023-01-16 2023-01-16            43     0.674222           -0.135632
9    2023-03-16 2023-03-16            40     2.331121            0.104776
10   2023-05-16 2023-05-16            44     0.759333            1.274717
11   2023-07-16 2023-07-16            45     1.110941            1.110941
12   2023-09-16 2023-09-16            43    -0.006381           -0.006381
13   2023-11-16 2023-11-16            40     1.543347           -3.252575
14   2024-01-16 2024-01-16            44    -1.381398            1.225006
15   2024-03-16 2024-03-16            40     0.255891           -0.308473
16   2024-05-16 2024-05-16            43     0.307612            0.307612
17   2024-07-16 2024-07-16            44     2.232450           -1.982065
18   2024-09-16 2024-09-16            45    -2.889253           -2.789184
19   2024-11-16 2024-11-16            28     0.360194            6.656079
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -1.9 |              0.0 |          1.9 | True          
[INFO] 2021-11-16   |         -5.1 |             -4.5 |          0.6 | True          
[INFO] 2022-01-16   |          2.4 |              0.6 |         -1.8 | False         
[INFO] 2022-03-16   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -7.0 |              0.6 |          7.6 | True          
[INFO] 2022-09-16   |          0.6 |              0.3 |         -0.3 | False         
[INFO] 2022-11-16   |         -3.2 |             -0.1 |          3.1 | True          
[INFO] 2023-01-16   |          0.7 |             -0.1 |         -0.8 | False         
[INFO] 2023-03-16   |          2.3 |              0.1 |         -2.2 | False         
[INFO] 2023-05-16   |          0.8 |              1.3 |          0.5 | True          
[INFO] 2023-07-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-16   |          1.5 |             -3.3 |         -4.8 | False         
[INFO] 2024-01-16   |         -1.4 |              1.2 |          2.6 | True          
[INFO] 2024-03-16   |          0.3 |             -0.3 |         -0.6 | False         
[INFO] 2024-05-16   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-16   |          2.2 |             -2.0 |         -4.2 | False         
[INFO] 2024-09-16   |         -2.9 |             -2.8 |          0.1 | True          
[INFO] 2024-11-16   |          0.4 |              6.7 |          6.3 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16, 2023-07-16, 2023-09-16, 2024-05-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Kmeans cluster wins (rounded comparison): 8 of 15 periods (53.33% win rate)
[INFO] Updating Excel file with Kmeans results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Kmeans win rate 53.3% in row 19
[INFO] Added best Sharpe parameters 36/62 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 36, Long SMA: 62
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(42/62) - Original Sharpe: 0.9392
[INFO] Added cluster 2 to portfolio: SMA(242/266) - Original Sharpe: 0.7978
[INFO] Added cluster 3 to portfolio: SMA(130/220) - Original Sharpe: 0.7460
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBL_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3249
[INFO] Kmeans Best out-of-sample Sharpe: -0.1013
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBL
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.2062 to 1.0013
[INFO] 
Best parameters:
[INFO] Short SMA: 36
[INFO] Long SMA: 62
[INFO] Sharpe Ratio: 1.001266
[INFO] Number of Trades: 41
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10508 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.2062 to 1.0013
[INFO] Trades range: 10.0 to 294.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3925 to 2.8029
[INFO] Scaled Long SMA range: -2.7982 to 1.4140
[INFO] Scaled Sharpe ratio range: -3.6757 to 3.4265
[INFO] Scaled Trades range: -0.7803 to 14.9447
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10508 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5242
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 285 elements
[INFO] Cluster 1: 48 elements
[INFO] Cluster 2: 403 elements
[INFO] Cluster 3: 76 elements
[INFO] Cluster 4: 102 elements
[INFO] Cluster 5: 597 elements
[INFO] Cluster 6: 487 elements
[INFO] Cluster 7: 84 elements
[INFO] Cluster 8: 48 elements
[INFO] Cluster 9: 172 elements
[INFO] Cluster 10: 433 elements
[INFO] Cluster 11: 205 elements
[INFO] Cluster 12: 200 elements
[INFO] Cluster 13: 252 elements
[INFO] Cluster 14: 264 elements
[INFO] Cluster 15: 376 elements
[INFO] Cluster 16: 115 elements
[INFO] Cluster 17: 167 elements
[INFO] Cluster 18: 288 elements
[INFO] Cluster 19: 279 elements
[INFO] Cluster 20: 10 elements
[INFO] Cluster 21: 160 elements
[INFO] Cluster 22: 243 elements
[INFO] Cluster 23: 78 elements
[INFO] Cluster 24: 137 elements
[INFO] Cluster 25: 372 elements
[INFO] Cluster 26: 98 elements
[INFO] Cluster 27: 242 elements
[INFO] Cluster 28: 63 elements
[INFO] Cluster 29: 355 elements
[INFO] Cluster 30: 358 elements
[INFO] Cluster 31: 332 elements
[INFO] Cluster 32: 183 elements
[INFO] Cluster 33: 450 elements
[INFO] Cluster 34: 46 elements
[INFO] Cluster 35: 234 elements
[INFO] Cluster 36: 96 elements
[INFO] Cluster 37: 15 elements
[INFO] Cluster 38: 246 elements
[INFO] Cluster 39: 121 elements
[INFO] Cluster 40: 188 elements
[INFO] Cluster 41: 314 elements
[INFO] Cluster 42: 218 elements
[INFO] Cluster 43: 104 elements
[INFO] Cluster 44: 230 elements
[INFO] Cluster 45: 18 elements
[INFO] Cluster 46: 209 elements
[INFO] Cluster 47: 193 elements
[INFO] Cluster 48: 129 elements
[INFO] Cluster 49: 185 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=220, Long SMA=264, Sharpe=0.5665, Trades=18
[INFO] Cluster 1 cluster: Short SMA=78, Long SMA=80, Sharpe=0.2867, Trades=93
[INFO] Cluster 2 cluster: Short SMA=44, Long SMA=192, Sharpe=0.0826, Trades=20
[INFO] Cluster 3 cluster: Short SMA=214, Long SMA=216, Sharpe=0.3948, Trades=85
[INFO] Cluster 4 cluster: Short SMA=274, Long SMA=280, Sharpe=0.3537, Trades=37
[INFO] Cluster 5 cluster: Short SMA=80, Long SMA=240, Sharpe=0.4674, Trades=13
[INFO] Cluster 6 cluster: Short SMA=100, Long SMA=190, Sharpe=0.4336, Trades=15
[INFO] Cluster 7 cluster: Short SMA=16, Long SMA=36, Sharpe=0.2252, Trades=81
[INFO] Cluster 8 cluster: Short SMA=30, Long SMA=34, Sharpe=0.4317, Trades=127
[INFO] Cluster 9 cluster: Short SMA=164, Long SMA=176, Sharpe=0.6341, Trades=39
[INFO] Cluster 10 cluster: Short SMA=178, Long SMA=262, Sharpe=0.3565, Trades=12
[INFO] Cluster 11 cluster: Short SMA=64, Long SMA=108, Sharpe=0.2456, Trades=29
[INFO] Cluster 12 cluster: Short SMA=30, Long SMA=78, Sharpe=0.6545, Trades=37
[INFO] Cluster 13 cluster: Short SMA=158, Long SMA=272, Sharpe=0.4891, Trades=10
[INFO] Cluster 14 cluster: Short SMA=258, Long SMA=288, Sharpe=0.4410, Trades=18
[INFO] Cluster 15 cluster: Short SMA=214, Long SMA=274, Sharpe=0.4853, Trades=16
[INFO] Cluster 16 cluster: Short SMA=228, Long SMA=236, Sharpe=0.4796, Trades=45
[INFO] Cluster 17 cluster: Short SMA=30, Long SMA=82, Sharpe=0.6785, Trades=37
[INFO] Cluster 18 cluster: Short SMA=90, Long SMA=128, Sharpe=-0.0024, Trades=25
[INFO] Cluster 19 cluster: Short SMA=110, Long SMA=282, Sharpe=0.3838, Trades=13
[INFO] Cluster 21 cluster: Short SMA=176, Long SMA=194, Sharpe=0.5909, Trades=31
[INFO] Cluster 22 cluster: Short SMA=24, Long SMA=234, Sharpe=0.0212, Trades=25
[INFO] Cluster 23 cluster: Short SMA=10, Long SMA=236, Sharpe=0.3147, Trades=36
[INFO] Cluster 24 cluster: Short SMA=130, Long SMA=152, Sharpe=0.4025, Trades=31
[INFO] Cluster 25 cluster: Short SMA=102, Long SMA=166, Sharpe=0.3963, Trades=17
[INFO] Cluster 26 cluster: Short SMA=60, Long SMA=70, Sharpe=0.4044, Trades=53
[INFO] Cluster 27 cluster: Short SMA=22, Long SMA=138, Sharpe=0.4344, Trades=30
[INFO] Cluster 28 cluster: Short SMA=98, Long SMA=104, Sharpe=0.1350, Trades=58
[INFO] Cluster 29 cluster: Short SMA=162, Long SMA=226, Sharpe=0.4420, Trades=15
[INFO] Cluster 30 cluster: Short SMA=30, Long SMA=282, Sharpe=0.3182, Trades=19
[INFO] Cluster 31 cluster: Short SMA=126, Long SMA=242, Sharpe=0.6148, Trades=15
[INFO] Cluster 32 cluster: Short SMA=206, Long SMA=232, Sharpe=0.4454, Trades=23
[INFO] Cluster 33 cluster: Short SMA=48, Long SMA=158, Sharpe=0.2582, Trades=18
[INFO] Cluster 34 cluster: Short SMA=46, Long SMA=56, Sharpe=0.7064, Trades=67
[INFO] Cluster 35 cluster: Short SMA=88, Long SMA=280, Sharpe=0.6570, Trades=13
[INFO] Cluster 36 cluster: Short SMA=100, Long SMA=118, Sharpe=0.0966, Trades=37
[INFO] Cluster 38 cluster: Short SMA=96, Long SMA=210, Sharpe=0.3650, Trades=15
[INFO] Cluster 39 cluster: Short SMA=62, Long SMA=88, Sharpe=0.3362, Trades=33
[INFO] Cluster 40 cluster: Short SMA=162, Long SMA=208, Sharpe=0.4651, Trades=17
[INFO] Cluster 41 cluster: Short SMA=44, Long SMA=240, Sharpe=0.2690, Trades=20
[INFO] Cluster 42 cluster: Short SMA=72, Long SMA=134, Sharpe=0.2362, Trades=20
[INFO] Cluster 43 cluster: Short SMA=20, Long SMA=58, Sharpe=0.4759, Trades=53
[INFO] Cluster 44 cluster: Short SMA=58, Long SMA=288, Sharpe=0.4937, Trades=11
[INFO] Cluster 46 cluster: Short SMA=138, Long SMA=280, Sharpe=0.6690, Trades=13
[INFO] Cluster 47 cluster: Short SMA=28, Long SMA=112, Sharpe=0.7305, Trades=27
[INFO] Cluster 48 cluster: Short SMA=16, Long SMA=194, Sharpe=0.0185, Trades=31
[INFO] Cluster 49 cluster: Short SMA=130, Long SMA=198, Sharpe=0.5390, Trades=15
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=36, Long SMA=62, Sharpe=1.0013, Trades=41
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=28, Long SMA=112, Sharpe=0.7305, Trades=27
[INFO] Top 2: Short SMA=46, Long SMA=56, Sharpe=0.7064, Trades=67
[INFO] Top 3: Short SMA=30, Long SMA=82, Sharpe=0.6785, Trades=37
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10465 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 36, Long SMA: 62
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(28/112) - Original Sharpe: 0.7305, Trades: 27
[INFO] Hierarchical cluster 2: SMA(46/56) - Original Sharpe: 0.7064, Trades: 67
[INFO] Hierarchical cluster 3: SMA(30/82) - Original Sharpe: 0.6785, Trades: 37
[INFO] Hierarchical cluster 4: SMA(138/280) - Original Sharpe: 0.6690, Trades: 13
[INFO] Hierarchical cluster 5: SMA(88/280) - Original Sharpe: 0.6570, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (36/62)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (28/112) - Sharpe: 0.7305
[INFO] cluster 2: (46/56) - Sharpe: 0.7064
[INFO] cluster 3: (30/82) - Sharpe: 0.6785
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -1.923691           -2.032207
1    2021-11-16 2021-11-16            42    -5.059052           -5.030328
2    2022-01-16 2022-01-16            42     2.440556            2.238433
3    2022-03-16 2022-03-16            41     3.634012            3.634012
4    2022-05-16 2022-05-16            45     1.252348            1.252348
5    2022-07-16 2022-07-16            44    -7.003364           -5.946865
6    2022-09-16 2022-09-16            43     0.563233            0.485647
7    2022-11-16 2022-11-16            42    -3.204331           -0.256095
8    2023-01-16 2023-01-16            43     0.674222            2.261096
9    2023-03-16 2023-03-16            40     2.331121            2.038604
10   2023-05-16 2023-05-16            44     0.759333           -2.464239
11   2023-07-16 2023-07-16            45     1.110941            1.110941
12   2023-09-16 2023-09-16            43    -0.006381           -0.006381
13   2023-11-16 2023-11-16            40     1.543347           -0.515934
14   2024-01-16 2024-01-16            44    -1.381398           -2.176824
15   2024-03-16 2024-03-16            40     0.255891            0.255891
16   2024-05-16 2024-05-16            43     0.307612            0.733773
17   2024-07-16 2024-07-16            44     2.232450            0.931064
18   2024-09-16 2024-09-16            45    -2.889253           -1.664865
19   2024-11-16 2024-11-16            28     0.360194            0.360194
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -1.9 |             -2.0 |         -0.1 | False         
[INFO] 2021-11-16   |         -5.1 |             -5.0 |          0.1 | True          
[INFO] 2022-01-16   |          2.4 |              2.2 |         -0.2 | False         
[INFO] 2022-03-16   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -7.0 |             -5.9 |          1.1 | True          
[INFO] 2022-09-16   |          0.6 |              0.5 |         -0.1 | False         
[INFO] 2022-11-16   |         -3.2 |             -0.3 |          2.9 | True          
[INFO] 2023-01-16   |          0.7 |              2.3 |          1.6 | True          
[INFO] 2023-03-16   |          2.3 |              2.0 |         -0.3 | False         
[INFO] 2023-05-16   |          0.8 |             -2.5 |         -3.3 | False         
[INFO] 2023-07-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-16   |          1.5 |             -0.5 |         -2.0 | False         
[INFO] 2024-01-16   |         -1.4 |             -2.2 |         -0.8 | False         
[INFO] 2024-03-16   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-16   |          0.3 |              0.7 |          0.4 | True          
[INFO] 2024-07-16   |          2.2 |              0.9 |         -1.3 | False         
[INFO] 2024-09-16   |         -2.9 |             -1.7 |          1.2 | True          
[INFO] 2024-11-16   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16, 2023-07-16, 2023-09-16, 2024-03-16, 2024-11-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 14 periods (42.86% win rate)
[INFO] Updating Excel file with Hierarchical results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Hierarchical win rate 42.9% in row 19
[INFO] Added best Sharpe parameters 36/62 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 36, Long SMA: 62
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(28/112) - Original Sharpe: 0.7305
[INFO] Added cluster 2 to portfolio: SMA(46/56) - Original Sharpe: 0.7064
[INFO] Added cluster 3 to portfolio: SMA(30/82) - Original Sharpe: 0.6785
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBL_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1171
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1013
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBL
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FGBM in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 115.41s
[INFO] Best parameters: Short SMA = 222, Long SMA = 234
[INFO] Best Sharpe ratio: 1.126980, Trades: 33
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FGBM
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 22.84 contracts
[INFO] Maximum Position Size: 41 contracts
[INFO] Strategy Total P&L: $669,998.00
[INFO] Market Buy & Hold P&L: $3,260.00
[INFO] Outperformance: $666,738.00
[INFO] Sharpe ratio (entire period, annualized): 1.001723
[INFO] Sharpe ratio (in-sample, annualized): 1.126980
[INFO] Sharpe ratio (out-of-sample, annualized): 0.717761
[INFO] Maximum Drawdown: $90,124.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 21
[INFO] Out-of-sample period trades: 12
[INFO] Total trades: 33
[INFO] In-sample P&L: $582,388.00
[INFO] Out-of-sample P&L: $163,678.00
[INFO] 
Best parameters from GA: Short SMA = 222, Long SMA = 234, Sharpe = 1.126980
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] 
Best parameters:
[INFO] Short SMA: 222
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.126980
[INFO] Number of Trades: 33
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10257 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3726 to 2.8264
[INFO] Scaled Long SMA range: -2.7886 to 1.4556
[INFO] Scaled Sharpe ratio range: -4.6012 to 3.8231
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 138 elements
[INFO] Kmeans Cluster 1: 259 elements
[INFO] Kmeans Cluster 2: 242 elements
[INFO] Kmeans Cluster 3: 194 elements
[INFO] Kmeans Cluster 4: 323 elements
[INFO] Kmeans Cluster 5: 165 elements
[INFO] Kmeans Cluster 6: 217 elements
[INFO] Kmeans Cluster 7: 158 elements
[INFO] Kmeans Cluster 8: 219 elements
[INFO] Kmeans Cluster 9: 335 elements
[INFO] Kmeans Cluster 10: 166 elements
[INFO] Kmeans Cluster 11: 258 elements
[INFO] Kmeans Cluster 12: 176 elements
[INFO] Kmeans Cluster 13: 258 elements
[INFO] Kmeans Cluster 14: 249 elements
[INFO] Kmeans Cluster 15: 190 elements
[INFO] Kmeans Cluster 16: 281 elements
[INFO] Kmeans Cluster 17: 179 elements
[INFO] Kmeans Cluster 18: 221 elements
[INFO] Kmeans Cluster 19: 239 elements
[INFO] Kmeans Cluster 20: 133 elements
[INFO] Kmeans Cluster 21: 259 elements
[INFO] Kmeans Cluster 22: 101 elements
[INFO] Kmeans Cluster 23: 199 elements
[INFO] Kmeans Cluster 24: 216 elements
[INFO] Kmeans Cluster 25: 206 elements
[INFO] Kmeans Cluster 26: 216 elements
[INFO] Kmeans Cluster 27: 236 elements
[INFO] Kmeans Cluster 28: 60 elements
[INFO] Kmeans Cluster 29: 212 elements
[INFO] Kmeans Cluster 30: 244 elements
[INFO] Kmeans Cluster 31: 180 elements
[INFO] Kmeans Cluster 32: 203 elements
[INFO] Kmeans Cluster 33: 174 elements
[INFO] Kmeans Cluster 34: 196 elements
[INFO] Kmeans Cluster 35: 299 elements
[INFO] Kmeans Cluster 36: 228 elements
[INFO] Kmeans Cluster 37: 178 elements
[INFO] Kmeans Cluster 38: 259 elements
[INFO] Kmeans Cluster 39: 114 elements
[INFO] Kmeans Cluster 40: 203 elements
[INFO] Kmeans Cluster 41: 178 elements
[INFO] Kmeans Cluster 42: 233 elements
[INFO] Kmeans Cluster 43: 174 elements
[INFO] Kmeans Cluster 44: 233 elements
[INFO] Kmeans Cluster 45: 129 elements
[INFO] Kmeans Cluster 46: 160 elements
[INFO] Kmeans Cluster 47: 202 elements
[INFO] Kmeans Cluster 48: 159 elements
[INFO] Kmeans Cluster 49: 206 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=208.88, Long SMA=230.55, Sharpe=0.9301
[INFO] Centroid 1: Short SMA=27.85, Long SMA=190.22, Sharpe=0.2115
[INFO] Centroid 2: Short SMA=102.36, Long SMA=253.01, Sharpe=0.5182
[INFO] Centroid 3: Short SMA=21.70, Long SMA=83.08, Sharpe=0.4002
[INFO] Centroid 4: Short SMA=246.40, Long SMA=285.08, Sharpe=0.3351
[INFO] Centroid 5: Short SMA=68.38, Long SMA=233.88, Sharpe=0.4261
[INFO] Centroid 6: Short SMA=162.42, Long SMA=264.08, Sharpe=0.5842
[INFO] Centroid 7: Short SMA=90.72, Long SMA=119.22, Sharpe=-0.0669
[INFO] Centroid 8: Short SMA=114.26, Long SMA=159.56, Sharpe=0.2682
[INFO] Centroid 9: Short SMA=105.98, Long SMA=212.21, Sharpe=0.4253
[INFO] Centroid 10: Short SMA=62.61, Long SMA=84.12, Sharpe=0.2893
[INFO] Centroid 11: Short SMA=45.75, Long SMA=129.34, Sharpe=0.2508
[INFO] Centroid 12: Short SMA=72.70, Long SMA=277.77, Sharpe=0.3186
[INFO] Centroid 13: Short SMA=215.11, Long SMA=261.04, Sharpe=0.7103
[INFO] Centroid 14: Short SMA=169.94, Long SMA=197.77, Sharpe=0.4625
[INFO] Centroid 15: Short SMA=33.09, Long SMA=283.98, Sharpe=0.3044
[INFO] Centroid 16: Short SMA=36.70, Long SMA=169.90, Sharpe=0.3384
[INFO] Centroid 17: Short SMA=181.52, Long SMA=211.93, Sharpe=0.6247
[INFO] Centroid 18: Short SMA=132.14, Long SMA=247.25, Sharpe=0.4151
[INFO] Centroid 19: Short SMA=99.96, Long SMA=142.34, Sharpe=0.1828
[INFO] Centroid 20: Short SMA=276.50, Long SMA=291.65, Sharpe=0.5119
[INFO] Centroid 21: Short SMA=66.25, Long SMA=173.38, Sharpe=0.2652
[INFO] Centroid 22: Short SMA=21.64, Long SMA=34.67, Sharpe=0.0665
[INFO] Centroid 23: Short SMA=100.21, Long SMA=248.21, Sharpe=0.6236
[INFO] Centroid 24: Short SMA=25.32, Long SMA=223.56, Sharpe=0.3894
[INFO] Centroid 25: Short SMA=30.08, Long SMA=279.71, Sharpe=0.4038
[INFO] Centroid 26: Short SMA=90.26, Long SMA=288.84, Sharpe=0.4469
[INFO] Centroid 27: Short SMA=86.75, Long SMA=186.95, Sharpe=0.3412
[INFO] Centroid 28: Short SMA=85.33, Long SMA=109.50, Sharpe=-0.2648
[INFO] Centroid 29: Short SMA=211.82, Long SMA=275.26, Sharpe=0.6091
[INFO] Centroid 30: Short SMA=48.36, Long SMA=230.77, Sharpe=0.3085
[INFO] Centroid 31: Short SMA=67.42, Long SMA=103.74, Sharpe=0.1019
[INFO] Centroid 32: Short SMA=136.19, Long SMA=198.75, Sharpe=0.3308
[INFO] Centroid 33: Short SMA=239.66, Long SMA=263.75, Sharpe=0.4858
[INFO] Centroid 34: Short SMA=65.33, Long SMA=206.73, Sharpe=0.4453
[INFO] Centroid 35: Short SMA=127.73, Long SMA=284.60, Sharpe=0.4303
[INFO] Centroid 36: Short SMA=139.62, Long SMA=167.96, Sharpe=0.4076
[INFO] Centroid 37: Short SMA=18.44, Long SMA=249.63, Sharpe=0.4850
[INFO] Centroid 38: Short SMA=144.77, Long SMA=219.55, Sharpe=0.5387
[INFO] Centroid 39: Short SMA=30.25, Long SMA=56.63, Sharpe=0.5553
[INFO] Centroid 40: Short SMA=51.28, Long SMA=74.03, Sharpe=0.4222
[INFO] Centroid 41: Short SMA=57.60, Long SMA=264.69, Sharpe=0.2170
[INFO] Centroid 42: Short SMA=199.59, Long SMA=236.21, Sharpe=0.7936
[INFO] Centroid 43: Short SMA=48.93, Long SMA=142.36, Sharpe=0.1384
[INFO] Centroid 44: Short SMA=170.76, Long SMA=247.85, Sharpe=0.6746
[INFO] Centroid 45: Short SMA=20.65, Long SMA=50.09, Sharpe=0.2757
[INFO] Centroid 46: Short SMA=141.55, Long SMA=168.95, Sharpe=0.5347
[INFO] Centroid 47: Short SMA=98.00, Long SMA=135.34, Sharpe=0.0669
[INFO] Centroid 48: Short SMA=26.14, Long SMA=105.71, Sharpe=0.5369
[INFO] Centroid 49: Short SMA=21.90, Long SMA=133.40, Sharpe=0.3722
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=222, Long SMA=234, Sharpe=1.1270, Trades=33
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=208, Long SMA=230, Sharpe=1.0017, Trades=31
[INFO] Kmeans Top 2: Short SMA=198, Long SMA=238, Sharpe=0.8114, Trades=19
[INFO] Kmeans Top 3: Short SMA=214, Long SMA=262, Sharpe=0.7283, Trades=16
[INFO] Kmeans Top 4: Short SMA=32, Long SMA=56, Sharpe=0.6672, Trades=54
[INFO] Kmeans Top 5: Short SMA=208, Long SMA=280, Sharpe=0.6438, Trades=10
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (209, 231)
[INFO]   Nearest: (208.0, 230.0)
[INFO]   Rounded: (28, 190)
[INFO]   Rounded: (102, 253)
[INFO]   Nearest: (102.0, 254.0)
[INFO]   Rounded: (22, 83)
[INFO]   Nearest: (22.0, 84.0)
[INFO]   Rounded: (246, 285)
[INFO]   Nearest: (246.0, 286.0)
[INFO]   Rounded: (68, 234)
[INFO]   Rounded: (162, 264)
[INFO]   Rounded: (91, 119)
[INFO]   Nearest: (90.0, 120.0)
[INFO]   Rounded: (114, 160)
[INFO]   Rounded: (106, 212)
[INFO]   Rounded: (63, 84)
[INFO]   Nearest: (62.0, 84.0)
[INFO]   Rounded: (46, 129)
[INFO]   Nearest: (46.0, 130.0)
[INFO]   Rounded: (73, 278)
[INFO]   Nearest: (72.0, 278.0)
[INFO]   Rounded: (215, 261)
[INFO]   Nearest: (216.0, 262.0)
[INFO]   Rounded: (170, 198)
[INFO]   Rounded: (33, 284)
[INFO]   Nearest: (34.0, 284.0)
[INFO]   Rounded: (37, 170)
[INFO]   Nearest: (36.0, 170.0)
[INFO]   Rounded: (182, 212)
[INFO]   Rounded: (132, 247)
[INFO]   Nearest: (132.0, 248.0)
[INFO]   Rounded: (100, 142)
[INFO]   Rounded: (276, 292)
[INFO]   Rounded: (66, 173)
[INFO]   Nearest: (66.0, 174.0)
[INFO]   Rounded: (22, 35)
[INFO]   Nearest: (22.0, 34.0)
[INFO]   Rounded: (100, 248)
[INFO]   Rounded: (25, 224)
[INFO]   Nearest: (26.0, 224.0)
[INFO]   Rounded: (30, 280)
[INFO]   Rounded: (90, 289)
[INFO]   Nearest: (90.0, 288.0)
[INFO]   Rounded: (87, 187)
[INFO]   Nearest: (86.0, 186.0)
[INFO]   Rounded: (85, 110)
[INFO]   Nearest: (86.0, 110.0)
[INFO]   Rounded: (212, 275)
[INFO]   Nearest: (212.0, 276.0)
[INFO]   Rounded: (48, 231)
[INFO]   Nearest: (48.0, 230.0)
[INFO]   Rounded: (67, 104)
[INFO]   Nearest: (68.0, 104.0)
[INFO]   Rounded: (136, 199)
[INFO]   Nearest: (136.0, 198.0)
[INFO]   Rounded: (240, 264)
[INFO]   Rounded: (65, 207)
[INFO]   Nearest: (66.0, 206.0)
[INFO]   Rounded: (128, 285)
[INFO]   Nearest: (128.0, 284.0)
[INFO]   Rounded: (140, 168)
[INFO]   Rounded: (18, 250)
[INFO]   Rounded: (145, 220)
[INFO]   Nearest: (144.0, 220.0)
[INFO]   Rounded: (30, 57)
[INFO]   Nearest: (30.0, 56.0)
[INFO]   Rounded: (51, 74)
[INFO]   Nearest: (52.0, 74.0)
[INFO]   Rounded: (58, 265)
[INFO]   Nearest: (58.0, 264.0)
[INFO]   Rounded: (200, 236)
[INFO]   Rounded: (49, 142)
[INFO]   Nearest: (48.0, 142.0)
[INFO]   Rounded: (171, 248)
[INFO]   Nearest: (170.0, 248.0)
[INFO]   Rounded: (21, 50)
[INFO]   Nearest: (20.0, 50.0)
[INFO]   Rounded: (142, 169)
[INFO]   Nearest: (142.0, 168.0)
[INFO]   Rounded: (98, 135)
[INFO]   Nearest: (98.0, 136.0)
[INFO]   Rounded: (26, 106)
[INFO]   Rounded: (22, 133)
[INFO]   Nearest: (22.0, 134.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 222, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(208/230) - Original Sharpe: 1.0017, Trades: 31
[INFO] Kmeans cluster 2: SMA(198/238) - Original Sharpe: 0.8114, Trades: 19
[INFO] Kmeans cluster 3: SMA(214/262) - Original Sharpe: 0.7283, Trades: 16
[INFO] Kmeans cluster 4: SMA(32/56) - Original Sharpe: 0.6672, Trades: 54
[INFO] Kmeans cluster 5: SMA(208/280) - Original Sharpe: 0.6438, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (222/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (208/230) - Sharpe: 1.0017
[INFO] cluster 2: (198/238) - Sharpe: 0.8114
[INFO] cluster 3: (214/262) - Sharpe: 0.7283
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.487748            1.487748
1    2021-11-16 2021-11-16            42     1.336541            0.549202
2    2022-01-16 2022-01-16            42     0.385142            1.438249
3    2022-03-16 2022-03-16            41     2.717615            2.453804
4    2022-05-16 2022-05-16            45     1.180567            1.180567
5    2022-07-16 2022-07-16            44     3.343289            3.343289
6    2022-09-16 2022-09-16            43     1.239321            1.239321
7    2022-11-16 2022-11-16            42     0.648774            0.648774
8    2023-01-16 2023-01-16            43     0.128552            0.128552
9    2023-03-16 2023-03-16            40    -0.229572           -0.229572
10   2023-05-16 2023-05-16            44     2.110030            2.110030
11   2023-07-16 2023-07-16            45     0.849981            0.849981
12   2023-09-16 2023-09-16            43    -0.445153           -0.445153
13   2023-11-16 2023-11-16            40    -3.244508           -4.596200
14   2024-01-16 2024-01-16            44     3.758682            2.476811
15   2024-03-16 2024-03-16            40     0.479300            0.639507
16   2024-05-16 2024-05-16            43    -0.511733            0.340589
17   2024-07-16 2024-07-16            44    -0.791530            2.845600
18   2024-09-16 2024-09-16            45     0.783900            2.262038
19   2024-11-16 2024-11-16            28    -0.078821           -0.078821
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2021-11-16   |          1.3 |              0.5 |         -0.8 | False         
[INFO] 2022-01-16   |          0.4 |              1.4 |          1.0 | True          
[INFO] 2022-03-16   |          2.7 |              2.5 |         -0.2 | False         
[INFO] 2022-05-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-16   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2022-09-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-11-16   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-01-16   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-03-16   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-05-16   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-07-16   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-11-16   |         -3.2 |             -4.6 |         -1.4 | False         
[INFO] 2024-01-16   |          3.8 |              2.5 |         -1.3 | False         
[INFO] 2024-03-16   |          0.5 |              0.6 |          0.1 | True          
[INFO] 2024-05-16   |         -0.5 |              0.3 |          0.8 | True          
[INFO] 2024-07-16   |         -0.8 |              2.8 |          3.6 | True          
[INFO] 2024-09-16   |          0.8 |              2.3 |          1.5 | True          
[INFO] 2024-11-16   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-05-16, 2022-07-16, 2022-09-16, 2022-11-16, 2023-01-16, 2023-03-16, 2023-05-16, 2023-07-16, 2023-09-16, 2024-11-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 5 of 9 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Kmeans win rate 55.6% in row 20
[INFO] Added best Sharpe parameters 222/234 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 222, Long SMA: 234
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(208/230) - Original Sharpe: 1.0017
[INFO] Added cluster 2 to portfolio: SMA(198/238) - Original Sharpe: 0.8114
[INFO] Added cluster 3 to portfolio: SMA(214/262) - Original Sharpe: 0.7283
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBM_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.9463
[INFO] Kmeans Best out-of-sample Sharpe: 0.7178
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBM
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] 
Best parameters:
[INFO] Short SMA: 222
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.126980
[INFO] Number of Trades: 33
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10257 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] Trades range: 10.0 to 314.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3726 to 2.8264
[INFO] Scaled Long SMA range: -2.7886 to 1.4556
[INFO] Scaled Sharpe ratio range: -4.6012 to 3.8231
[INFO] Scaled Trades range: -0.7504 to 15.6375
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10257 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5627
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 446 elements
[INFO] Cluster 1: 464 elements
[INFO] Cluster 2: 483 elements
[INFO] Cluster 3: 192 elements
[INFO] Cluster 4: 392 elements
[INFO] Cluster 5: 143 elements
[INFO] Cluster 6: 73 elements
[INFO] Cluster 7: 263 elements
[INFO] Cluster 8: 44 elements
[INFO] Cluster 9: 378 elements
[INFO] Cluster 10: 252 elements
[INFO] Cluster 11: 405 elements
[INFO] Cluster 12: 381 elements
[INFO] Cluster 13: 340 elements
[INFO] Cluster 14: 334 elements
[INFO] Cluster 15: 175 elements
[INFO] Cluster 16: 485 elements
[INFO] Cluster 17: 439 elements
[INFO] Cluster 18: 213 elements
[INFO] Cluster 19: 40 elements
[INFO] Cluster 20: 18 elements
[INFO] Cluster 21: 345 elements
[INFO] Cluster 22: 186 elements
[INFO] Cluster 23: 218 elements
[INFO] Cluster 24: 253 elements
[INFO] Cluster 25: 243 elements
[INFO] Cluster 26: 103 elements
[INFO] Cluster 27: 307 elements
[INFO] Cluster 28: 134 elements
[INFO] Cluster 29: 141 elements
[INFO] Cluster 30: 54 elements
[INFO] Cluster 31: 68 elements
[INFO] Cluster 32: 227 elements
[INFO] Cluster 33: 87 elements
[INFO] Cluster 34: 114 elements
[INFO] Cluster 35: 63 elements
[INFO] Cluster 36: 188 elements
[INFO] Cluster 37: 3 elements
[INFO] Cluster 38: 318 elements
[INFO] Cluster 39: 130 elements
[INFO] Cluster 40: 193 elements
[INFO] Cluster 41: 151 elements
[INFO] Cluster 42: 33 elements
[INFO] Cluster 43: 80 elements
[INFO] Cluster 44: 231 elements
[INFO] Cluster 45: 88 elements
[INFO] Cluster 46: 31 elements
[INFO] Cluster 47: 64 elements
[INFO] Cluster 48: 55 elements
[INFO] Cluster 49: 189 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=24, Long SMA=256, Sharpe=0.4577, Trades=20
[INFO] Cluster 1 cluster: Short SMA=50, Long SMA=280, Sharpe=0.2744, Trades=15
[INFO] Cluster 2 cluster: Short SMA=110, Long SMA=288, Sharpe=0.3957, Trades=13
[INFO] Cluster 3 cluster: Short SMA=266, Long SMA=280, Sharpe=0.4039, Trades=30
[INFO] Cluster 4 cluster: Short SMA=74, Long SMA=146, Sharpe=0.1265, Trades=20
[INFO] Cluster 5 cluster: Short SMA=30, Long SMA=60, Sharpe=0.5859, Trades=48
[INFO] Cluster 6 cluster: Short SMA=86, Long SMA=118, Sharpe=-0.1486, Trades=32
[INFO] Cluster 7 cluster: Short SMA=54, Long SMA=118, Sharpe=0.2167, Trades=25
[INFO] Cluster 8 cluster: Short SMA=44, Long SMA=46, Sharpe=0.4209, Trades=129
[INFO] Cluster 9 cluster: Short SMA=98, Long SMA=256, Sharpe=0.5319, Trades=13
[INFO] Cluster 10 cluster: Short SMA=52, Long SMA=246, Sharpe=0.2006, Trades=16
[INFO] Cluster 11 cluster: Short SMA=166, Long SMA=256, Sharpe=0.6342, Trades=13
[INFO] Cluster 12 cluster: Short SMA=124, Long SMA=198, Sharpe=0.4249, Trades=17
[INFO] Cluster 13 cluster: Short SMA=164, Long SMA=200, Sharpe=0.5560, Trades=21
[INFO] Cluster 14 cluster: Short SMA=204, Long SMA=260, Sharpe=0.7291, Trades=14
[INFO] Cluster 15 cluster: Short SMA=18, Long SMA=148, Sharpe=0.3811, Trades=32
[INFO] Cluster 16 cluster: Short SMA=76, Long SMA=182, Sharpe=0.3590, Trades=14
[INFO] Cluster 17 cluster: Short SMA=94, Long SMA=224, Sharpe=0.4534, Trades=13
[INFO] Cluster 18 cluster: Short SMA=16, Long SMA=94, Sharpe=0.3641, Trades=43
[INFO] Cluster 19 cluster: Short SMA=108, Long SMA=110, Sharpe=0.0911, Trades=90
[INFO] Cluster 21 cluster: Short SMA=42, Long SMA=158, Sharpe=0.2560, Trades=16
[INFO] Cluster 22 cluster: Short SMA=78, Long SMA=116, Sharpe=-0.0432, Trades=26
[INFO] Cluster 23 cluster: Short SMA=206, Long SMA=230, Sharpe=1.0178, Trades=29
[INFO] Cluster 24 cluster: Short SMA=34, Long SMA=194, Sharpe=0.1897, Trades=18
[INFO] Cluster 25 cluster: Short SMA=110, Long SMA=160, Sharpe=0.3123, Trades=19
[INFO] Cluster 26 cluster: Short SMA=144, Long SMA=156, Sharpe=0.3654, Trades=39
[INFO] Cluster 27 cluster: Short SMA=244, Long SMA=288, Sharpe=0.2866, Trades=14
[INFO] Cluster 28 cluster: Short SMA=28, Long SMA=102, Sharpe=0.5017, Trades=31
[INFO] Cluster 29 cluster: Short SMA=236, Long SMA=252, Sharpe=0.6488, Trades=29
[INFO] Cluster 30 cluster: Short SMA=266, Long SMA=270, Sharpe=0.2141, Trades=48
[INFO] Cluster 31 cluster: Short SMA=20, Long SMA=44, Sharpe=0.0163, Trades=67
[INFO] Cluster 32 cluster: Short SMA=138, Long SMA=250, Sharpe=0.3884, Trades=11
[INFO] Cluster 33 cluster: Short SMA=44, Long SMA=50, Sharpe=0.3473, Trades=81
[INFO] Cluster 34 cluster: Short SMA=110, Long SMA=124, Sharpe=0.1615, Trades=39
[INFO] Cluster 35 cluster: Short SMA=98, Long SMA=104, Sharpe=0.1197, Trades=57
[INFO] Cluster 36 cluster: Short SMA=204, Long SMA=282, Sharpe=0.6499, Trades=10
[INFO] Cluster 38 cluster: Short SMA=146, Long SMA=228, Sharpe=0.5392, Trades=13
[INFO] Cluster 39 cluster: Short SMA=62, Long SMA=84, Sharpe=0.3319, Trades=37
[INFO] Cluster 40 cluster: Short SMA=136, Long SMA=166, Sharpe=0.3265, Trades=25
[INFO] Cluster 41 cluster: Short SMA=24, Long SMA=210, Sharpe=0.3002, Trades=22
[INFO] Cluster 42 cluster: Short SMA=16, Long SMA=30, Sharpe=0.1297, Trades=98
[INFO] Cluster 43 cluster: Short SMA=214, Long SMA=218, Sharpe=0.8782, Trades=55
[INFO] Cluster 44 cluster: Short SMA=56, Long SMA=222, Sharpe=0.4733, Trades=14
[INFO] Cluster 45 cluster: Short SMA=50, Long SMA=66, Sharpe=0.3670, Trades=57
[INFO] Cluster 46 cluster: Short SMA=174, Long SMA=176, Sharpe=0.7194, Trades=107
[INFO] Cluster 47 cluster: Short SMA=164, Long SMA=170, Sharpe=0.3865, Trades=55
[INFO] Cluster 48 cluster: Short SMA=192, Long SMA=208, Sharpe=0.5675, Trades=34
[INFO] Cluster 49 cluster: Short SMA=42, Long SMA=86, Sharpe=0.4450, Trades=33
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=222, Long SMA=234, Sharpe=1.1270, Trades=33
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=206, Long SMA=230, Sharpe=1.0178, Trades=29
[INFO] Top 2: Short SMA=214, Long SMA=218, Sharpe=0.8782, Trades=55
[INFO] Top 3: Short SMA=204, Long SMA=260, Sharpe=0.7291, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10236 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 222, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(206/230) - Original Sharpe: 1.0178, Trades: 29
[INFO] Hierarchical cluster 2: SMA(214/218) - Original Sharpe: 0.8782, Trades: 55
[INFO] Hierarchical cluster 3: SMA(204/260) - Original Sharpe: 0.7291, Trades: 14
[INFO] Hierarchical cluster 4: SMA(174/176) - Original Sharpe: 0.7194, Trades: 107
[INFO] Hierarchical cluster 5: SMA(204/282) - Original Sharpe: 0.6499, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (222/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (206/230) - Sharpe: 1.0178
[INFO] cluster 2: (214/218) - Sharpe: 0.8782
[INFO] cluster 3: (204/260) - Sharpe: 0.7291
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.487748            1.487748
1    2021-11-16 2021-11-16            42     1.336541           -2.460190
2    2022-01-16 2022-01-16            42     0.385142            0.994781
3    2022-03-16 2022-03-16            41     2.717615            1.677018
4    2022-05-16 2022-05-16            45     1.180567            1.180567
5    2022-07-16 2022-07-16            44     3.343289            3.343289
6    2022-09-16 2022-09-16            43     1.239321            1.239321
7    2022-11-16 2022-11-16            42     0.648774            0.648774
8    2023-01-16 2023-01-16            43     0.128552            0.128552
9    2023-03-16 2023-03-16            40    -0.229572           -0.229572
10   2023-05-16 2023-05-16            44     2.110030            2.110030
11   2023-07-16 2023-07-16            45     0.849981            0.849981
12   2023-09-16 2023-09-16            43    -0.445153           -0.202107
13   2023-11-16 2023-11-16            40    -3.244508           -6.324060
14   2024-01-16 2024-01-16            44     3.758682            2.309361
15   2024-03-16 2024-03-16            40     0.479300            0.540060
16   2024-05-16 2024-05-16            43    -0.511733           -1.505887
17   2024-07-16 2024-07-16            44    -0.791530            3.771965
18   2024-09-16 2024-09-16            45     0.783900            1.623013
19   2024-11-16 2024-11-16            28    -0.078821           -0.078821
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2021-11-16   |          1.3 |             -2.5 |         -3.8 | False         
[INFO] 2022-01-16   |          0.4 |              1.0 |          0.6 | True          
[INFO] 2022-03-16   |          2.7 |              1.7 |         -1.0 | False         
[INFO] 2022-05-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-16   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2022-09-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-11-16   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-01-16   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-03-16   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-05-16   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-07-16   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.4 |             -0.2 |          0.2 | True          
[INFO] 2023-11-16   |         -3.2 |             -6.3 |         -3.1 | False         
[INFO] 2024-01-16   |          3.8 |              2.3 |         -1.5 | False         
[INFO] 2024-03-16   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2024-05-16   |         -0.5 |             -1.5 |         -1.0 | False         
[INFO] 2024-07-16   |         -0.8 |              3.8 |          4.6 | True          
[INFO] 2024-09-16   |          0.8 |              1.6 |          0.8 | True          
[INFO] 2024-11-16   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-05-16, 2022-07-16, 2022-09-16, 2022-11-16, 2023-01-16, 2023-03-16, 2023-05-16, 2023-07-16, 2024-03-16, 2024-11-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 9 periods (44.44% win rate)
[INFO] Updating Excel file with Hierarchical results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Hierarchical win rate 44.4% in row 20
[INFO] Added best Sharpe parameters 222/234 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 222, Long SMA: 234
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(206/230) - Original Sharpe: 1.0178
[INFO] Added cluster 2 to portfolio: SMA(214/218) - Original Sharpe: 0.8782
[INFO] Added cluster 3 to portfolio: SMA(204/260) - Original Sharpe: 0.7291
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBM_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.6846
[INFO] Hierarchical Best out-of-sample Sharpe: 0.7178
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBM
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FGBX in column D: 22.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 136.12s
[INFO] Best parameters: Short SMA = 50, Long SMA = 56
[INFO] Best Sharpe ratio: 1.001858, Trades: 82
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FGBX=105XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.64 contracts
[INFO] Maximum Position Size: 8 contracts
[INFO] Strategy Total P&L: $350,036.00
[INFO] Market Buy & Hold P&L: $24,200.00
[INFO] Outperformance: $325,836.00
[INFO] Sharpe ratio (entire period, annualized): 0.452533
[INFO] Sharpe ratio (in-sample, annualized): 1.001858
[INFO] Sharpe ratio (out-of-sample, annualized): -0.816874
[INFO] Maximum Drawdown: $268,780.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 56
[INFO] Out-of-sample period trades: 26
[INFO] Total trades: 82
[INFO] In-sample P&L: $585,486.00
[INFO] Out-of-sample P&L: $-206,288.00
[INFO] 
Best parameters from GA: Short SMA = 50, Long SMA = 56, Sharpe = 1.001858
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3871 to 1.0019
[INFO] 
Best parameters:
[INFO] Short SMA: 50
[INFO] Long SMA: 56
[INFO] Sharpe Ratio: 1.001858
[INFO] Number of Trades: 82
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10582 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3871 to 1.0019
[INFO] Trades range: 10.0 to 301.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3994 to 2.7993
[INFO] Scaled Long SMA range: -2.7994 to 1.4003
[INFO] Scaled Sharpe ratio range: -4.8665 to 4.5092
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 227 elements
[INFO] Kmeans Cluster 1: 296 elements
[INFO] Kmeans Cluster 2: 293 elements
[INFO] Kmeans Cluster 3: 183 elements
[INFO] Kmeans Cluster 4: 323 elements
[INFO] Kmeans Cluster 5: 265 elements
[INFO] Kmeans Cluster 6: 80 elements
[INFO] Kmeans Cluster 7: 144 elements
[INFO] Kmeans Cluster 8: 152 elements
[INFO] Kmeans Cluster 9: 202 elements
[INFO] Kmeans Cluster 10: 287 elements
[INFO] Kmeans Cluster 11: 147 elements
[INFO] Kmeans Cluster 12: 176 elements
[INFO] Kmeans Cluster 13: 212 elements
[INFO] Kmeans Cluster 14: 174 elements
[INFO] Kmeans Cluster 15: 61 elements
[INFO] Kmeans Cluster 16: 292 elements
[INFO] Kmeans Cluster 17: 295 elements
[INFO] Kmeans Cluster 18: 49 elements
[INFO] Kmeans Cluster 19: 247 elements
[INFO] Kmeans Cluster 20: 277 elements
[INFO] Kmeans Cluster 21: 202 elements
[INFO] Kmeans Cluster 22: 255 elements
[INFO] Kmeans Cluster 23: 286 elements
[INFO] Kmeans Cluster 24: 222 elements
[INFO] Kmeans Cluster 25: 231 elements
[INFO] Kmeans Cluster 26: 157 elements
[INFO] Kmeans Cluster 27: 184 elements
[INFO] Kmeans Cluster 28: 232 elements
[INFO] Kmeans Cluster 29: 235 elements
[INFO] Kmeans Cluster 30: 340 elements
[INFO] Kmeans Cluster 31: 227 elements
[INFO] Kmeans Cluster 32: 245 elements
[INFO] Kmeans Cluster 33: 249 elements
[INFO] Kmeans Cluster 34: 284 elements
[INFO] Kmeans Cluster 35: 123 elements
[INFO] Kmeans Cluster 36: 285 elements
[INFO] Kmeans Cluster 37: 242 elements
[INFO] Kmeans Cluster 38: 106 elements
[INFO] Kmeans Cluster 39: 345 elements
[INFO] Kmeans Cluster 40: 72 elements
[INFO] Kmeans Cluster 41: 220 elements
[INFO] Kmeans Cluster 42: 66 elements
[INFO] Kmeans Cluster 43: 230 elements
[INFO] Kmeans Cluster 44: 179 elements
[INFO] Kmeans Cluster 45: 245 elements
[INFO] Kmeans Cluster 46: 218 elements
[INFO] Kmeans Cluster 47: 90 elements
[INFO] Kmeans Cluster 48: 255 elements
[INFO] Kmeans Cluster 49: 175 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=99.66, Long SMA=145.45, Sharpe=0.2115
[INFO] Centroid 1: Short SMA=154.38, Long SMA=208.30, Sharpe=0.4710
[INFO] Centroid 2: Short SMA=227.82, Long SMA=266.74, Sharpe=0.1325
[INFO] Centroid 3: Short SMA=30.73, Long SMA=70.19, Sharpe=0.6545
[INFO] Centroid 4: Short SMA=32.06, Long SMA=228.92, Sharpe=0.3921
[INFO] Centroid 5: Short SMA=103.34, Long SMA=267.85, Sharpe=0.3194
[INFO] Centroid 6: Short SMA=23.07, Long SMA=50.20, Sharpe=0.4299
[INFO] Centroid 7: Short SMA=141.57, Long SMA=171.74, Sharpe=0.6542
[INFO] Centroid 8: Short SMA=205.91, Long SMA=235.82, Sharpe=0.3449
[INFO] Centroid 9: Short SMA=77.69, Long SMA=130.34, Sharpe=0.1199
[INFO] Centroid 10: Short SMA=82.45, Long SMA=180.20, Sharpe=0.3832
[INFO] Centroid 11: Short SMA=90.95, Long SMA=290.26, Sharpe=0.1981
[INFO] Centroid 12: Short SMA=64.72, Long SMA=92.22, Sharpe=0.3636
[INFO] Centroid 13: Short SMA=27.53, Long SMA=127.12, Sharpe=0.3421
[INFO] Centroid 14: Short SMA=252.20, Long SMA=280.08, Sharpe=0.3361
[INFO] Centroid 15: Short SMA=20.46, Long SMA=31.28, Sharpe=0.0617
[INFO] Centroid 16: Short SMA=68.47, Long SMA=264.00, Sharpe=0.4287
[INFO] Centroid 17: Short SMA=54.56, Long SMA=184.83, Sharpe=0.2761
[INFO] Centroid 18: Short SMA=284.86, Long SMA=294.94, Sharpe=-0.0043
[INFO] Centroid 19: Short SMA=34.26, Long SMA=248.12, Sharpe=0.3011
[INFO] Centroid 20: Short SMA=110.85, Long SMA=222.17, Sharpe=0.3993
[INFO] Centroid 21: Short SMA=37.93, Long SMA=273.82, Sharpe=0.1854
[INFO] Centroid 22: Short SMA=32.39, Long SMA=138.35, Sharpe=0.2543
[INFO] Centroid 23: Short SMA=159.27, Long SMA=274.24, Sharpe=0.2043
[INFO] Centroid 24: Short SMA=35.95, Long SMA=97.47, Sharpe=0.4531
[INFO] Centroid 25: Short SMA=26.26, Long SMA=194.09, Sharpe=0.3571
[INFO] Centroid 26: Short SMA=224.19, Long SMA=260.89, Sharpe=0.0218
[INFO] Centroid 27: Short SMA=175.25, Long SMA=201.24, Sharpe=0.3629
[INFO] Centroid 28: Short SMA=101.51, Long SMA=189.59, Sharpe=0.4850
[INFO] Centroid 29: Short SMA=175.64, Long SMA=289.51, Sharpe=0.3047
[INFO] Centroid 30: Short SMA=73.37, Long SMA=227.54, Sharpe=0.5044
[INFO] Centroid 31: Short SMA=201.37, Long SMA=273.89, Sharpe=0.2158
[INFO] Centroid 32: Short SMA=124.51, Long SMA=280.03, Sharpe=0.3919
[INFO] Centroid 33: Short SMA=254.32, Long SMA=281.82, Sharpe=0.2324
[INFO] Centroid 34: Short SMA=100.07, Long SMA=137.97, Sharpe=0.3073
[INFO] Centroid 35: Short SMA=15.85, Long SMA=281.40, Sharpe=0.4550
[INFO] Centroid 36: Short SMA=141.19, Long SMA=246.88, Sharpe=0.3305
[INFO] Centroid 37: Short SMA=177.21, Long SMA=249.12, Sharpe=0.1046
[INFO] Centroid 38: Short SMA=16.70, Long SMA=187.23, Sharpe=0.4832
[INFO] Centroid 39: Short SMA=145.47, Long SMA=188.21, Sharpe=0.5493
[INFO] Centroid 40: Short SMA=90.06, Long SMA=118.44, Sharpe=0.0123
[INFO] Centroid 41: Short SMA=36.06, Long SMA=77.74, Sharpe=0.5552
[INFO] Centroid 42: Short SMA=19.79, Long SMA=37.03, Sharpe=0.2493
[INFO] Centroid 43: Short SMA=52.22, Long SMA=287.38, Sharpe=0.3357
[INFO] Centroid 44: Short SMA=126.07, Long SMA=154.95, Sharpe=0.4337
[INFO] Centroid 45: Short SMA=194.24, Long SMA=221.80, Sharpe=0.2292
[INFO] Centroid 46: Short SMA=68.63, Long SMA=106.39, Sharpe=0.2238
[INFO] Centroid 47: Short SMA=42.93, Long SMA=62.69, Sharpe=0.7719
[INFO] Centroid 48: Short SMA=45.47, Long SMA=159.98, Sharpe=0.1813
[INFO] Centroid 49: Short SMA=109.66, Long SMA=233.99, Sharpe=0.2833
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=50, Long SMA=56, Sharpe=1.0019, Trades=82
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=46, Long SMA=56, Sharpe=0.7346, Trades=68
[INFO] Kmeans Top 2: Short SMA=30, Long SMA=70, Sharpe=0.6982, Trades=48
[INFO] Kmeans Top 3: Short SMA=142, Long SMA=170, Sharpe=0.6095, Trades=25
[INFO] Kmeans Top 4: Short SMA=34, Long SMA=80, Sharpe=0.5479, Trades=38
[INFO] Kmeans Top 5: Short SMA=18, Long SMA=186, Sharpe=0.5039, Trades=27
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (100, 145)
[INFO]   Nearest: (100.0, 146.0)
[INFO]   Rounded: (154, 208)
[INFO]   Rounded: (228, 267)
[INFO]   Nearest: (228.0, 266.0)
[INFO]   Rounded: (31, 70)
[INFO]   Nearest: (30.0, 70.0)
[INFO]   Rounded: (32, 229)
[INFO]   Nearest: (32.0, 228.0)
[INFO]   Rounded: (103, 268)
[INFO]   Nearest: (104.0, 268.0)
[INFO]   Rounded: (23, 50)
[INFO]   Nearest: (24.0, 50.0)
[INFO]   Rounded: (142, 172)
[INFO]   Rounded: (206, 236)
[INFO]   Rounded: (78, 130)
[INFO]   Rounded: (82, 180)
[INFO]   Rounded: (91, 290)
[INFO]   Nearest: (90.0, 290.0)
[INFO]   Rounded: (65, 92)
[INFO]   Nearest: (64.0, 92.0)
[INFO]   Rounded: (28, 127)
[INFO]   Nearest: (28.0, 128.0)
[INFO]   Rounded: (252, 280)
[INFO]   Rounded: (20, 31)
[INFO]   Nearest: (20.0, 32.0)
[INFO]   Rounded: (68, 264)
[INFO]   Rounded: (55, 185)
[INFO]   Nearest: (54.0, 184.0)
[INFO]   Rounded: (285, 295)
[INFO]   Nearest: (284.0, 294.0)
[INFO]   Rounded: (34, 248)
[INFO]   Rounded: (111, 222)
[INFO]   Nearest: (110.0, 222.0)
[INFO]   Rounded: (38, 274)
[INFO]   Rounded: (32, 138)
[INFO]   Rounded: (159, 274)
[INFO]   Nearest: (160.0, 274.0)
[INFO]   Rounded: (36, 97)
[INFO]   Nearest: (36.0, 98.0)
[INFO]   Rounded: (26, 194)
[INFO]   Rounded: (224, 261)
[INFO]   Nearest: (224.0, 260.0)
[INFO]   Rounded: (175, 201)
[INFO]   Nearest: (176.0, 202.0)
[INFO]   Rounded: (102, 190)
[INFO]   Rounded: (176, 290)
[INFO]   Rounded: (73, 228)
[INFO]   Nearest: (74.0, 228.0)
[INFO]   Rounded: (201, 274)
[INFO]   Nearest: (202.0, 274.0)
[INFO]   Rounded: (125, 280)
[INFO]   Nearest: (124.0, 280.0)
[INFO]   Rounded: (254, 282)
[INFO]   Rounded: (100, 138)
[INFO]   Rounded: (16, 281)
[INFO]   Nearest: (16.0, 282.0)
[INFO]   Rounded: (141, 247)
[INFO]   Nearest: (142.0, 246.0)
[INFO]   Rounded: (177, 249)
[INFO]   Nearest: (178.0, 250.0)
[INFO]   Rounded: (17, 187)
[INFO]   Nearest: (16.0, 188.0)
[INFO]   Rounded: (145, 188)
[INFO]   Nearest: (146.0, 188.0)
[INFO]   Rounded: (90, 118)
[INFO]   Rounded: (36, 78)
[INFO]   Rounded: (20, 37)
[INFO]   Nearest: (20.0, 38.0)
[INFO]   Rounded: (52, 287)
[INFO]   Nearest: (52.0, 288.0)
[INFO]   Rounded: (126, 155)
[INFO]   Nearest: (126.0, 154.0)
[INFO]   Rounded: (194, 222)
[INFO]   Rounded: (69, 106)
[INFO]   Nearest: (68.0, 106.0)
[INFO]   Rounded: (43, 63)
[INFO]   Nearest: (42.0, 62.0)
[INFO]   Rounded: (45, 160)
[INFO]   Nearest: (46.0, 160.0)
[INFO]   Rounded: (110, 234)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 50, Long SMA: 56
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(46/56) - Original Sharpe: 0.7346, Trades: 68
[INFO] Kmeans cluster 2: SMA(30/70) - Original Sharpe: 0.6982, Trades: 48
[INFO] Kmeans cluster 3: SMA(142/170) - Original Sharpe: 0.6095, Trades: 25
[INFO] Kmeans cluster 4: SMA(34/80) - Original Sharpe: 0.5479, Trades: 38
[INFO] Kmeans cluster 5: SMA(18/186) - Original Sharpe: 0.5039, Trades: 27
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (50/56)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (46/56) - Sharpe: 0.7346
[INFO] cluster 2: (30/70) - Sharpe: 0.6982
[INFO] cluster 3: (142/170) - Sharpe: 0.6095
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -2.493074           -0.126929
1    2021-11-16 2021-11-16            42    -3.189982           -2.646314
2    2022-01-16 2022-01-16            42     1.294092            0.342553
3    2022-03-16 2022-03-16            41     4.339011            4.339011
4    2022-05-16 2022-05-16            45     1.113246            1.113246
5    2022-07-16 2022-07-16            44    -3.870262           -4.548707
6    2022-09-16 2022-09-16            43    -0.767104            0.515832
7    2022-11-16 2022-11-16            42    -4.333365           -5.505828
8    2023-01-16 2023-01-16            43     2.406742            1.479877
9    2023-03-16 2023-03-16            40     0.982602            1.487888
10   2023-05-16 2023-05-16            44    -4.191287           -1.462003
11   2023-07-16 2023-07-16            45    -0.015977           -0.411899
12   2023-09-16 2023-09-16            43     0.712175            0.712175
13   2023-11-16 2023-11-16            40    -3.685762           -4.330750
14   2024-01-16 2024-01-16            44    -0.038296           -0.372860
15   2024-03-16 2024-03-16            40     0.200895           -0.144274
16   2024-05-16 2024-05-16            43     1.126451            0.711627
17   2024-07-16 2024-07-16            44    -4.492154           -1.257278
18   2024-09-16 2024-09-16            45    -1.267614           -0.621377
19   2024-11-16 2024-11-16            28    -1.014734           -6.835511
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -2.5 |             -0.1 |          2.4 | True          
[INFO] 2021-11-16   |         -3.2 |             -2.6 |          0.6 | True          
[INFO] 2022-01-16   |          1.3 |              0.3 |         -1.0 | False         
[INFO] 2022-03-16   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -3.9 |             -4.5 |         -0.6 | False         
[INFO] 2022-09-16   |         -0.8 |              0.5 |          1.3 | True          
[INFO] 2022-11-16   |         -4.3 |             -5.5 |         -1.2 | False         
[INFO] 2023-01-16   |          2.4 |              1.5 |         -0.9 | False         
[INFO] 2023-03-16   |          1.0 |              1.5 |          0.5 | True          
[INFO] 2023-05-16   |         -4.2 |             -1.5 |          2.7 | True          
[INFO] 2023-07-16   |         -0.0 |             -0.4 |         -0.4 | False         
[INFO] 2023-09-16   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-16   |         -3.7 |             -4.3 |         -0.6 | False         
[INFO] 2024-01-16   |         -0.0 |             -0.4 |         -0.4 | False         
[INFO] 2024-03-16   |          0.2 |             -0.1 |         -0.3 | False         
[INFO] 2024-05-16   |          1.1 |              0.7 |         -0.4 | False         
[INFO] 2024-07-16   |         -4.5 |             -1.3 |          3.2 | True          
[INFO] 2024-09-16   |         -1.3 |             -0.6 |          0.7 | True          
[INFO] 2024-11-16   |         -1.0 |             -6.8 |         -5.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16, 2023-09-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 7 of 17 periods (41.18% win rate)
[INFO] Updating Excel file with Kmeans results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Kmeans win rate 41.2% in row 21
[INFO] Added best Sharpe parameters 50/56 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 50, Long SMA: 56
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(46/56) - Original Sharpe: 0.7346
[INFO] Added cluster 2 to portfolio: SMA(30/70) - Original Sharpe: 0.6982
[INFO] Added cluster 3 to portfolio: SMA(142/170) - Original Sharpe: 0.6095
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.4633
[INFO] Kmeans Best out-of-sample Sharpe: -0.8169
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBX
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3871 to 1.0019
[INFO] 
Best parameters:
[INFO] Short SMA: 50
[INFO] Long SMA: 56
[INFO] Sharpe Ratio: 1.001858
[INFO] Number of Trades: 82
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10582 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3871 to 1.0019
[INFO] Trades range: 10.0 to 301.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3994 to 2.7993
[INFO] Scaled Long SMA range: -2.7994 to 1.4003
[INFO] Scaled Sharpe ratio range: -4.8665 to 4.5092
[INFO] Scaled Trades range: -0.7931 to 14.9015
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10582 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6276
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 407 elements
[INFO] Cluster 1: 140 elements
[INFO] Cluster 2: 341 elements
[INFO] Cluster 3: 89 elements
[INFO] Cluster 4: 51 elements
[INFO] Cluster 5: 275 elements
[INFO] Cluster 6: 14 elements
[INFO] Cluster 7: 403 elements
[INFO] Cluster 8: 232 elements
[INFO] Cluster 9: 346 elements
[INFO] Cluster 10: 506 elements
[INFO] Cluster 11: 403 elements
[INFO] Cluster 12: 48 elements
[INFO] Cluster 13: 414 elements
[INFO] Cluster 14: 260 elements
[INFO] Cluster 15: 304 elements
[INFO] Cluster 16: 89 elements
[INFO] Cluster 17: 226 elements
[INFO] Cluster 18: 327 elements
[INFO] Cluster 19: 18 elements
[INFO] Cluster 20: 83 elements
[INFO] Cluster 21: 445 elements
[INFO] Cluster 22: 570 elements
[INFO] Cluster 23: 89 elements
[INFO] Cluster 24: 176 elements
[INFO] Cluster 25: 240 elements
[INFO] Cluster 26: 93 elements
[INFO] Cluster 27: 138 elements
[INFO] Cluster 28: 52 elements
[INFO] Cluster 29: 126 elements
[INFO] Cluster 30: 271 elements
[INFO] Cluster 31: 236 elements
[INFO] Cluster 32: 336 elements
[INFO] Cluster 33: 340 elements
[INFO] Cluster 34: 122 elements
[INFO] Cluster 35: 132 elements
[INFO] Cluster 36: 268 elements
[INFO] Cluster 37: 112 elements
[INFO] Cluster 38: 302 elements
[INFO] Cluster 39: 202 elements
[INFO] Cluster 40: 7 elements
[INFO] Cluster 41: 96 elements
[INFO] Cluster 42: 193 elements
[INFO] Cluster 43: 254 elements
[INFO] Cluster 44: 22 elements
[INFO] Cluster 45: 313 elements
[INFO] Cluster 46: 132 elements
[INFO] Cluster 47: 54 elements
[INFO] Cluster 48: 219 elements
[INFO] Cluster 49: 66 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=36, Long SMA=130, Sharpe=0.2344, Trades=29
[INFO] Cluster 1 cluster: Short SMA=266, Long SMA=278, Sharpe=0.1320, Trades=32
[INFO] Cluster 2 cluster: Short SMA=162, Long SMA=288, Sharpe=0.2684, Trades=12
[INFO] Cluster 3 cluster: Short SMA=18, Long SMA=34, Sharpe=0.1257, Trades=89
[INFO] Cluster 4 cluster: Short SMA=38, Long SMA=44, Sharpe=0.6061, Trades=101
[INFO] Cluster 5 cluster: Short SMA=248, Long SMA=286, Sharpe=0.2385, Trades=18
[INFO] Cluster 7 cluster: Short SMA=102, Long SMA=180, Sharpe=0.5294, Trades=17
[INFO] Cluster 8 cluster: Short SMA=140, Long SMA=176, Sharpe=0.6050, Trades=25
[INFO] Cluster 9 cluster: Short SMA=34, Long SMA=96, Sharpe=0.5618, Trades=36
[INFO] Cluster 10 cluster: Short SMA=52, Long SMA=174, Sharpe=0.2381, Trades=17
[INFO] Cluster 11 cluster: Short SMA=146, Long SMA=208, Sharpe=0.5413, Trades=17
[INFO] Cluster 12 cluster: Short SMA=238, Long SMA=240, Sharpe=0.0985, Trades=72
[INFO] Cluster 13 cluster: Short SMA=196, Long SMA=256, Sharpe=0.2605, Trades=14
[INFO] Cluster 14 cluster: Short SMA=196, Long SMA=214, Sharpe=0.2776, Trades=28
[INFO] Cluster 15 cluster: Short SMA=100, Long SMA=142, Sharpe=0.1748, Trades=27
[INFO] Cluster 16 cluster: Short SMA=156, Long SMA=160, Sharpe=0.4263, Trades=57
[INFO] Cluster 17 cluster: Short SMA=32, Long SMA=70, Sharpe=0.7257, Trades=44
[INFO] Cluster 18 cluster: Short SMA=74, Long SMA=252, Sharpe=0.4707, Trades=15
[INFO] Cluster 20 cluster: Short SMA=148, Long SMA=160, Sharpe=0.8068, Trades=41
[INFO] Cluster 21 cluster: Short SMA=140, Long SMA=236, Sharpe=0.3530, Trades=13
[INFO] Cluster 22 cluster: Short SMA=30, Long SMA=224, Sharpe=0.3755, Trades=21
[INFO] Cluster 23 cluster: Short SMA=84, Long SMA=102, Sharpe=0.2328, Trades=42
[INFO] Cluster 24 cluster: Short SMA=90, Long SMA=290, Sharpe=0.1622, Trades=13
[INFO] Cluster 25 cluster: Short SMA=68, Long SMA=280, Sharpe=0.3490, Trades=15
[INFO] Cluster 26 cluster: Short SMA=54, Long SMA=66, Sharpe=0.3968, Trades=62
[INFO] Cluster 27 cluster: Short SMA=110, Long SMA=128, Sharpe=0.2192, Trades=37
[INFO] Cluster 28 cluster: Short SMA=46, Long SMA=54, Sharpe=0.8229, Trades=78
[INFO] Cluster 29 cluster: Short SMA=16, Long SMA=286, Sharpe=0.4407, Trades=25
[INFO] Cluster 30 cluster: Short SMA=222, Long SMA=262, Sharpe=0.1311, Trades=16
[INFO] Cluster 31 cluster: Short SMA=40, Long SMA=112, Sharpe=0.3155, Trades=31
[INFO] Cluster 32 cluster: Short SMA=40, Long SMA=268, Sharpe=0.1969, Trades=21
[INFO] Cluster 33 cluster: Short SMA=86, Long SMA=196, Sharpe=0.3629, Trades=15
[INFO] Cluster 34 cluster: Short SMA=166, Long SMA=188, Sharpe=0.4487, Trades=29
[INFO] Cluster 35 cluster: Short SMA=16, Long SMA=182, Sharpe=0.4442, Trades=25
[INFO] Cluster 36 cluster: Short SMA=122, Long SMA=280, Sharpe=0.3453, Trades=13
[INFO] Cluster 37 cluster: Short SMA=22, Long SMA=66, Sharpe=0.5285, Trades=53
[INFO] Cluster 38 cluster: Short SMA=102, Long SMA=256, Sharpe=0.3461, Trades=13
[INFO] Cluster 39 cluster: Short SMA=176, Long SMA=248, Sharpe=0.1052, Trades=14
[INFO] Cluster 41 cluster: Short SMA=260, Long SMA=270, Sharpe=0.2458, Trades=34
[INFO] Cluster 42 cluster: Short SMA=72, Long SMA=136, Sharpe=0.0794, Trades=23
[INFO] Cluster 43 cluster: Short SMA=162, Long SMA=272, Sharpe=0.1558, Trades=12
[INFO] Cluster 44 cluster: Short SMA=112, Long SMA=114, Sharpe=0.2230, Trades=105
[INFO] Cluster 45 cluster: Short SMA=74, Long SMA=224, Sharpe=0.4859, Trades=13
[INFO] Cluster 46 cluster: Short SMA=228, Long SMA=272, Sharpe=0.0769, Trades=14
[INFO] Cluster 47 cluster: Short SMA=100, Long SMA=108, Sharpe=0.1153, Trades=52
[INFO] Cluster 48 cluster: Short SMA=52, Long SMA=158, Sharpe=0.0899, Trades=19
[INFO] Cluster 49 cluster: Short SMA=36, Long SMA=270, Sharpe=0.0299, Trades=23
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=50, Long SMA=56, Sharpe=1.0019, Trades=82
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=46, Long SMA=54, Sharpe=0.8229, Trades=78
[INFO] Top 2: Short SMA=148, Long SMA=160, Sharpe=0.8068, Trades=41
[INFO] Top 3: Short SMA=32, Long SMA=70, Sharpe=0.7257, Trades=44
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10543 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 50, Long SMA: 56
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(46/54) - Original Sharpe: 0.8229, Trades: 78
[INFO] Hierarchical cluster 2: SMA(148/160) - Original Sharpe: 0.8068, Trades: 41
[INFO] Hierarchical cluster 3: SMA(32/70) - Original Sharpe: 0.7257, Trades: 44
[INFO] Hierarchical cluster 4: SMA(38/44) - Original Sharpe: 0.6061, Trades: 101
[INFO] Hierarchical cluster 5: SMA(140/176) - Original Sharpe: 0.6050, Trades: 25
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (50/56)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (46/54) - Sharpe: 0.8229
[INFO] cluster 2: (148/160) - Sharpe: 0.8068
[INFO] cluster 3: (32/70) - Sharpe: 0.7257
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -2.493074           -2.766959
1    2021-11-16 2021-11-16            42    -3.189982           -2.147975
2    2022-01-16 2022-01-16            42     1.294092            0.344900
3    2022-03-16 2022-03-16            41     4.339011            4.339011
4    2022-05-16 2022-05-16            45     1.113246            1.113246
5    2022-07-16 2022-07-16            44    -3.870262           -2.860561
6    2022-09-16 2022-09-16            43    -0.767104            0.503117
7    2022-11-16 2022-11-16            42    -4.333365           -5.505828
8    2023-01-16 2023-01-16            43     2.406742            0.064034
9    2023-03-16 2023-03-16            40     0.982602            1.720658
10   2023-05-16 2023-05-16            44    -4.191287           -0.995549
11   2023-07-16 2023-07-16            45    -0.015977            0.637425
12   2023-09-16 2023-09-16            43     0.712175            1.129303
13   2023-11-16 2023-11-16            40    -3.685762           -3.089990
14   2024-01-16 2024-01-16            44    -0.038296           -0.826883
15   2024-03-16 2024-03-16            40     0.200895            0.695812
16   2024-05-16 2024-05-16            43     1.126451            1.178872
17   2024-07-16 2024-07-16            44    -4.492154           -0.020764
18   2024-09-16 2024-09-16            45    -1.267614           -2.099983
19   2024-11-16 2024-11-16            28    -1.014734           -5.386193
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -2.5 |             -2.8 |         -0.3 | False         
[INFO] 2021-11-16   |         -3.2 |             -2.1 |          1.1 | True          
[INFO] 2022-01-16   |          1.3 |              0.3 |         -1.0 | False         
[INFO] 2022-03-16   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -3.9 |             -2.9 |          1.0 | True          
[INFO] 2022-09-16   |         -0.8 |              0.5 |          1.3 | True          
[INFO] 2022-11-16   |         -4.3 |             -5.5 |         -1.2 | False         
[INFO] 2023-01-16   |          2.4 |              0.1 |         -2.3 | False         
[INFO] 2023-03-16   |          1.0 |              1.7 |          0.7 | True          
[INFO] 2023-05-16   |         -4.2 |             -1.0 |          3.2 | True          
[INFO] 2023-07-16   |         -0.0 |              0.6 |          0.6 | True          
[INFO] 2023-09-16   |          0.7 |              1.1 |          0.4 | True          
[INFO] 2023-11-16   |         -3.7 |             -3.1 |          0.6 | True          
[INFO] 2024-01-16   |         -0.0 |             -0.8 |         -0.8 | False         
[INFO] 2024-03-16   |          0.2 |              0.7 |          0.5 | True          
[INFO] 2024-05-16   |          1.1 |              1.2 |          0.1 | True          
[INFO] 2024-07-16   |         -4.5 |             -0.0 |          4.5 | True          
[INFO] 2024-09-16   |         -1.3 |             -2.1 |         -0.8 | False         
[INFO] 2024-11-16   |         -1.0 |             -5.4 |         -4.4 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 18 periods (61.11% win rate)
[INFO] Updating Excel file with Hierarchical results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Hierarchical win rate 61.1% in row 21
[INFO] Added best Sharpe parameters 50/56 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 50, Long SMA: 56
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(46/54) - Original Sharpe: 0.8229
[INFO] Added cluster 2 to portfolio: SMA(148/160) - Original Sharpe: 0.8068
[INFO] Added cluster 3 to portfolio: SMA(32/70) - Original Sharpe: 0.7257
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3441
[INFO] Hierarchical Best out-of-sample Sharpe: -0.8169
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBX
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FV in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 142.44s
[INFO] Best parameters: Short SMA = 72, Long SMA = 80
[INFO] Best Sharpe ratio: 0.949806, Trades: 55
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FV
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 19.39 contracts
[INFO] Maximum Position Size: 46 contracts
[INFO] Strategy Total P&L: $459,015.94
[INFO] Market Buy & Hold P&L: $-7,468.75
[INFO] Outperformance: $466,484.69
[INFO] Sharpe ratio (entire period, annualized): 0.704491
[INFO] Sharpe ratio (in-sample, annualized): 0.949806
[INFO] Sharpe ratio (out-of-sample, annualized): 0.150694
[INFO] Maximum Drawdown: $166,890.31
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 38
[INFO] Out-of-sample period trades: 17
[INFO] Total trades: 55
[INFO] In-sample P&L: $498,560.94
[INFO] Out-of-sample P&L: $35,012.81
[INFO] 
Best parameters from GA: Short SMA = 72, Long SMA = 80, Sharpe = 0.949806
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7879 to 0.9498
[INFO] 
Best parameters:
[INFO] Short SMA: 72
[INFO] Long SMA: 80
[INFO] Sharpe Ratio: 0.949806
[INFO] Number of Trades: 55
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7339 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7879 to 0.9498
[INFO] Trades range: 10.0 to 350.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1881 to 2.8942
[INFO] Scaled Long SMA range: -2.5863 to 1.9520
[INFO] Scaled Sharpe ratio range: -4.7689 to 3.0644
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 161 elements
[INFO] Kmeans Cluster 1: 131 elements
[INFO] Kmeans Cluster 2: 152 elements
[INFO] Kmeans Cluster 3: 245 elements
[INFO] Kmeans Cluster 4: 161 elements
[INFO] Kmeans Cluster 5: 71 elements
[INFO] Kmeans Cluster 6: 150 elements
[INFO] Kmeans Cluster 7: 182 elements
[INFO] Kmeans Cluster 8: 123 elements
[INFO] Kmeans Cluster 9: 194 elements
[INFO] Kmeans Cluster 10: 168 elements
[INFO] Kmeans Cluster 11: 101 elements
[INFO] Kmeans Cluster 12: 195 elements
[INFO] Kmeans Cluster 13: 91 elements
[INFO] Kmeans Cluster 14: 170 elements
[INFO] Kmeans Cluster 15: 49 elements
[INFO] Kmeans Cluster 16: 206 elements
[INFO] Kmeans Cluster 17: 123 elements
[INFO] Kmeans Cluster 18: 110 elements
[INFO] Kmeans Cluster 19: 116 elements
[INFO] Kmeans Cluster 20: 139 elements
[INFO] Kmeans Cluster 21: 162 elements
[INFO] Kmeans Cluster 22: 268 elements
[INFO] Kmeans Cluster 23: 204 elements
[INFO] Kmeans Cluster 24: 136 elements
[INFO] Kmeans Cluster 25: 158 elements
[INFO] Kmeans Cluster 26: 119 elements
[INFO] Kmeans Cluster 27: 104 elements
[INFO] Kmeans Cluster 28: 82 elements
[INFO] Kmeans Cluster 29: 183 elements
[INFO] Kmeans Cluster 30: 177 elements
[INFO] Kmeans Cluster 31: 152 elements
[INFO] Kmeans Cluster 32: 124 elements
[INFO] Kmeans Cluster 33: 69 elements
[INFO] Kmeans Cluster 34: 201 elements
[INFO] Kmeans Cluster 35: 179 elements
[INFO] Kmeans Cluster 36: 130 elements
[INFO] Kmeans Cluster 37: 145 elements
[INFO] Kmeans Cluster 38: 143 elements
[INFO] Kmeans Cluster 39: 122 elements
[INFO] Kmeans Cluster 40: 191 elements
[INFO] Kmeans Cluster 41: 112 elements
[INFO] Kmeans Cluster 42: 158 elements
[INFO] Kmeans Cluster 43: 99 elements
[INFO] Kmeans Cluster 44: 150 elements
[INFO] Kmeans Cluster 45: 165 elements
[INFO] Kmeans Cluster 46: 134 elements
[INFO] Kmeans Cluster 47: 163 elements
[INFO] Kmeans Cluster 48: 170 elements
[INFO] Kmeans Cluster 49: 101 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=125.25, Long SMA=181.11, Sharpe=0.4943
[INFO] Centroid 1: Short SMA=153.22, Long SMA=221.44, Sharpe=0.1044
[INFO] Centroid 2: Short SMA=19.13, Long SMA=96.63, Sharpe=0.2057
[INFO] Centroid 3: Short SMA=66.06, Long SMA=176.00, Sharpe=0.3524
[INFO] Centroid 4: Short SMA=28.37, Long SMA=231.43, Sharpe=0.4986
[INFO] Centroid 5: Short SMA=232.73, Long SMA=246.14, Sharpe=-0.2665
[INFO] Centroid 6: Short SMA=197.43, Long SMA=249.99, Sharpe=0.0280
[INFO] Centroid 7: Short SMA=41.75, Long SMA=100.44, Sharpe=0.4564
[INFO] Centroid 8: Short SMA=35.95, Long SMA=287.20, Sharpe=0.1530
[INFO] Centroid 9: Short SMA=100.87, Long SMA=159.11, Sharpe=0.1674
[INFO] Centroid 10: Short SMA=259.18, Long SMA=276.23, Sharpe=0.1250
[INFO] Centroid 11: Short SMA=16.67, Long SMA=43.94, Sharpe=-0.1839
[INFO] Centroid 12: Short SMA=30.18, Long SMA=161.17, Sharpe=0.5610
[INFO] Centroid 13: Short SMA=60.70, Long SMA=80.29, Sharpe=0.7259
[INFO] Centroid 14: Short SMA=23.02, Long SMA=278.26, Sharpe=0.2945
[INFO] Centroid 15: Short SMA=17.96, Long SMA=28.33, Sharpe=-0.4385
[INFO] Centroid 16: Short SMA=75.71, Long SMA=213.74, Sharpe=0.4785
[INFO] Centroid 17: Short SMA=131.19, Long SMA=151.82, Sharpe=0.3529
[INFO] Centroid 18: Short SMA=190.85, Long SMA=203.95, Sharpe=-0.0756
[INFO] Centroid 19: Short SMA=236.21, Long SMA=261.66, Sharpe=-0.0411
[INFO] Centroid 20: Short SMA=76.73, Long SMA=106.96, Sharpe=0.1559
[INFO] Centroid 21: Short SMA=224.12, Long SMA=244.80, Sharpe=-0.1338
[INFO] Centroid 22: Short SMA=28.80, Long SMA=142.59, Sharpe=0.4523
[INFO] Centroid 23: Short SMA=116.57, Long SMA=197.48, Sharpe=0.3942
[INFO] Centroid 24: Short SMA=44.24, Long SMA=230.54, Sharpe=0.3203
[INFO] Centroid 25: Short SMA=31.91, Long SMA=214.05, Sharpe=0.4223
[INFO] Centroid 26: Short SMA=33.90, Long SMA=55.80, Sharpe=0.1573
[INFO] Centroid 27: Short SMA=145.00, Long SMA=161.71, Sharpe=0.6132
[INFO] Centroid 28: Short SMA=99.32, Long SMA=115.56, Sharpe=-0.0144
[INFO] Centroid 29: Short SMA=141.19, Long SMA=198.10, Sharpe=0.3173
[INFO] Centroid 30: Short SMA=198.86, Long SMA=222.90, Sharpe=0.0559
[INFO] Centroid 31: Short SMA=56.54, Long SMA=126.20, Sharpe=0.3198
[INFO] Centroid 32: Short SMA=160.16, Long SMA=189.23, Sharpe=0.1926
[INFO] Centroid 33: Short SMA=74.64, Long SMA=91.71, Sharpe=0.3515
[INFO] Centroid 34: Short SMA=67.37, Long SMA=146.71, Sharpe=0.2055
[INFO] Centroid 35: Short SMA=40.33, Long SMA=187.08, Sharpe=0.4557
[INFO] Centroid 36: Short SMA=103.42, Long SMA=126.38, Sharpe=0.1127
[INFO] Centroid 37: Short SMA=90.44, Long SMA=172.50, Sharpe=0.2694
[INFO] Centroid 38: Short SMA=122.24, Long SMA=148.20, Sharpe=0.2336
[INFO] Centroid 39: Short SMA=37.51, Long SMA=63.90, Sharpe=0.3349
[INFO] Centroid 40: Short SMA=21.82, Long SMA=255.52, Sharpe=0.3887
[INFO] Centroid 41: Short SMA=22.05, Long SMA=58.48, Sharpe=-0.0200
[INFO] Centroid 42: Short SMA=174.97, Long SMA=223.41, Sharpe=0.0079
[INFO] Centroid 43: Short SMA=280.63, Long SMA=292.75, Sharpe=-0.0270
[INFO] Centroid 44: Short SMA=49.61, Long SMA=83.89, Sharpe=0.5636
[INFO] Centroid 45: Short SMA=83.75, Long SMA=123.96, Sharpe=0.2597
[INFO] Centroid 46: Short SMA=172.30, Long SMA=194.28, Sharpe=0.0312
[INFO] Centroid 47: Short SMA=76.55, Long SMA=203.19, Sharpe=0.5720
[INFO] Centroid 48: Short SMA=21.91, Long SMA=193.45, Sharpe=0.5586
[INFO] Centroid 49: Short SMA=19.33, Long SMA=120.22, Sharpe=0.3609
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=72, Long SMA=80, Sharpe=0.9498, Trades=55
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=60, Long SMA=80, Sharpe=0.7467, Trades=39
[INFO] Kmeans Top 2: Short SMA=146, Long SMA=162, Sharpe=0.6841, Trades=31
[INFO] Kmeans Top 3: Short SMA=48, Long SMA=84, Sharpe=0.6064, Trades=29
[INFO] Kmeans Top 4: Short SMA=32, Long SMA=162, Sharpe=0.5652, Trades=21
[INFO] Kmeans Top 5: Short SMA=22, Long SMA=194, Sharpe=0.5633, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (125, 181)
[INFO]   Nearest: (126.0, 182.0)
[INFO]   Rounded: (153, 221)
[INFO]   Nearest: (154.0, 222.0)
[INFO]   Rounded: (19, 97)
[INFO]   Nearest: (20.0, 96.0)
[INFO]   Rounded: (66, 176)
[INFO]   Rounded: (28, 231)
[INFO]   Nearest: (28.0, 232.0)
[INFO]   Rounded: (233, 246)
[INFO]   Nearest: (232.0, 246.0)
[INFO]   Rounded: (197, 250)
[INFO]   Nearest: (198.0, 250.0)
[INFO]   Rounded: (42, 100)
[INFO]   Rounded: (36, 287)
[INFO]   Nearest: (36.0, 288.0)
[INFO]   Rounded: (101, 159)
[INFO]   Nearest: (100.0, 160.0)
[INFO]   Rounded: (259, 276)
[INFO]   Nearest: (260.0, 276.0)
[INFO]   Rounded: (17, 44)
[INFO]   Nearest: (16.0, 44.0)
[INFO]   Rounded: (30, 161)
[INFO]   Nearest: (30.0, 162.0)
[INFO]   Rounded: (61, 80)
[INFO]   Nearest: (60.0, 80.0)
[INFO]   Rounded: (23, 278)
[INFO]   Nearest: (24.0, 278.0)
[INFO]   Rounded: (18, 28)
[INFO]   Rounded: (76, 214)
[INFO]   Rounded: (131, 152)
[INFO]   Nearest: (132.0, 152.0)
[INFO]   Rounded: (191, 204)
[INFO]   Nearest: (190.0, 204.0)
[INFO]   Rounded: (236, 262)
[INFO]   Rounded: (77, 107)
[INFO]   Nearest: (76.0, 106.0)
[INFO]   Rounded: (224, 245)
[INFO]   Nearest: (224.0, 244.0)
[INFO]   Rounded: (29, 143)
[INFO]   Nearest: (28.0, 142.0)
[INFO]   Rounded: (117, 197)
[INFO]   Nearest: (116.0, 198.0)
[INFO]   Rounded: (44, 231)
[INFO]   Nearest: (44.0, 230.0)
[INFO]   Rounded: (32, 214)
[INFO]   Rounded: (34, 56)
[INFO]   Rounded: (145, 162)
[INFO]   Nearest: (146.0, 162.0)
[INFO]   Rounded: (99, 116)
[INFO]   Nearest: (100.0, 116.0)
[INFO]   Rounded: (141, 198)
[INFO]   Nearest: (142.0, 198.0)
[INFO]   Rounded: (199, 223)
[INFO]   Nearest: (198.0, 222.0)
[INFO]   Rounded: (57, 126)
[INFO]   Nearest: (56.0, 126.0)
[INFO]   Rounded: (160, 189)
[INFO]   Nearest: (160.0, 190.0)
[INFO]   Rounded: (75, 92)
[INFO]   Nearest: (74.0, 92.0)
[INFO]   Rounded: (67, 147)
[INFO]   Nearest: (68.0, 146.0)
[INFO]   Rounded: (40, 187)
[INFO]   Nearest: (40.0, 188.0)
[INFO]   Rounded: (103, 126)
[INFO]   Nearest: (104.0, 126.0)
[INFO]   Rounded: (90, 172)
[INFO]   Rounded: (122, 148)
[INFO]   Rounded: (38, 64)
[INFO]   Rounded: (22, 256)
[INFO]   Rounded: (22, 58)
[INFO]   Rounded: (175, 223)
[INFO]   Nearest: (174.0, 224.0)
[INFO]   Rounded: (281, 293)
[INFO]   Nearest: (280.0, 292.0)
[INFO]   Rounded: (50, 84)
[INFO]   Rounded: (84, 124)
[INFO]   Rounded: (172, 194)
[INFO]   Rounded: (77, 203)
[INFO]   Nearest: (76.0, 204.0)
[INFO]   Rounded: (22, 193)
[INFO]   Nearest: (22.0, 194.0)
[INFO]   Rounded: (19, 120)
[INFO]   Nearest: (20.0, 120.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 72, Long SMA: 80
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(60/80) - Original Sharpe: 0.7467, Trades: 39
[INFO] Kmeans cluster 2: SMA(146/162) - Original Sharpe: 0.6841, Trades: 31
[INFO] Kmeans cluster 3: SMA(48/84) - Original Sharpe: 0.6064, Trades: 29
[INFO] Kmeans cluster 4: SMA(32/162) - Original Sharpe: 0.5652, Trades: 21
[INFO] Kmeans cluster 5: SMA(22/194) - Original Sharpe: 0.5633, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (72/80)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (60/80) - Sharpe: 0.7467
[INFO] cluster 2: (146/162) - Sharpe: 0.6841
[INFO] cluster 3: (48/84) - Sharpe: 0.6064
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.048416           -3.647492
1    2021-11-14 2021-11-14            43     1.455706            2.474631
2    2022-01-14 2022-01-14            41     2.700861            2.700861
3    2022-03-14 2022-03-14            44     3.784695            3.784695
4    2022-05-14 2022-05-14            43     0.729933            0.729933
5    2022-07-14 2022-07-14            44     1.065131            1.801532
6    2022-09-14 2022-09-14            43     0.232152            0.623823
7    2022-11-14 2022-11-14            43    -2.056108           -0.248133
8    2023-01-14 2023-01-14            41    -0.637807           -5.029577
9    2023-03-14 2023-03-14            44    -0.502398           -1.462117
10   2023-05-14 2023-05-14            44    -0.910839           -3.905686
11   2023-07-14 2023-07-14            44     2.935724            2.935724
12   2023-09-14 2023-09-14            43     1.603056            1.354237
13   2023-11-14 2023-11-14            42    -2.819972           -3.582105
14   2024-01-14 2024-01-14            43    -2.527000           -1.310016
15   2024-03-14 2024-03-14            42     2.399643            2.204668
16   2024-05-14 2024-05-14            44    -2.159756           -2.568228
17   2024-07-14 2024-07-14            45     4.444693            3.250868
18   2024-09-14 2024-09-14            43    -6.223105           -3.703912
19   2024-11-14 2024-11-14            33     0.476612            0.954542
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |             -3.6 |         -2.6 | False         
[INFO] 2021-11-14   |          1.5 |              2.5 |          1.0 | True          
[INFO] 2022-01-14   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |              1.8 |          0.7 | True          
[INFO] 2022-09-14   |          0.2 |              0.6 |          0.4 | True          
[INFO] 2022-11-14   |         -2.1 |             -0.2 |          1.9 | True          
[INFO] 2023-01-14   |         -0.6 |             -5.0 |         -4.4 | False         
[INFO] 2023-03-14   |         -0.5 |             -1.5 |         -1.0 | False         
[INFO] 2023-05-14   |         -0.9 |             -3.9 |         -3.0 | False         
[INFO] 2023-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.6 |              1.4 |         -0.2 | False         
[INFO] 2023-11-14   |         -2.8 |             -3.6 |         -0.8 | False         
[INFO] 2024-01-14   |         -2.5 |             -1.3 |          1.2 | True          
[INFO] 2024-03-14   |          2.4 |              2.2 |         -0.2 | False         
[INFO] 2024-05-14   |         -2.2 |             -2.6 |         -0.4 | False         
[INFO] 2024-07-14   |          4.4 |              3.3 |         -1.1 | False         
[INFO] 2024-09-14   |         -6.2 |             -3.7 |          2.5 | True          
[INFO] 2024-11-14   |          0.5 |              1.0 |          0.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14, 2022-03-14, 2022-05-14, 2023-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 7 of 16 periods (43.75% win rate)
[INFO] Updating Excel file with Kmeans results for FV...
[INFO] Excel file updated successfully. Added FV with Kmeans win rate 43.8% in row 22
[INFO] Added best Sharpe parameters 72/80 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 72, Long SMA: 80
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(60/80) - Original Sharpe: 0.7467
[INFO] Added cluster 2 to portfolio: SMA(146/162) - Original Sharpe: 0.6841
[INFO] Added cluster 3 to portfolio: SMA(48/84) - Original Sharpe: 0.6064
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FV_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0122
[INFO] Kmeans Best out-of-sample Sharpe: 0.1507
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FV...
[INFO] Excel file updated successfully. Added FV with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FV
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7879 to 0.9498
[INFO] 
Best parameters:
[INFO] Short SMA: 72
[INFO] Long SMA: 80
[INFO] Sharpe Ratio: 0.949806
[INFO] Number of Trades: 55
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7339 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7879 to 0.9498
[INFO] Trades range: 10.0 to 350.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1881 to 2.8942
[INFO] Scaled Long SMA range: -2.5863 to 1.9520
[INFO] Scaled Sharpe ratio range: -4.7689 to 3.0644
[INFO] Scaled Trades range: -0.7160 to 14.6498
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 7339 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6175
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 406 elements
[INFO] Cluster 1: 45 elements
[INFO] Cluster 2: 177 elements
[INFO] Cluster 3: 381 elements
[INFO] Cluster 4: 70 elements
[INFO] Cluster 5: 305 elements
[INFO] Cluster 6: 371 elements
[INFO] Cluster 7: 123 elements
[INFO] Cluster 8: 224 elements
[INFO] Cluster 9: 304 elements
[INFO] Cluster 10: 260 elements
[INFO] Cluster 11: 103 elements
[INFO] Cluster 12: 28 elements
[INFO] Cluster 13: 165 elements
[INFO] Cluster 14: 133 elements
[INFO] Cluster 15: 117 elements
[INFO] Cluster 16: 51 elements
[INFO] Cluster 17: 387 elements
[INFO] Cluster 18: 286 elements
[INFO] Cluster 19: 247 elements
[INFO] Cluster 20: 102 elements
[INFO] Cluster 21: 19 elements
[INFO] Cluster 22: 296 elements
[INFO] Cluster 23: 19 elements
[INFO] Cluster 24: 48 elements
[INFO] Cluster 25: 95 elements
[INFO] Cluster 26: 31 elements
[INFO] Cluster 27: 3 elements
[INFO] Cluster 28: 126 elements
[INFO] Cluster 29: 213 elements
[INFO] Cluster 30: 23 elements
[INFO] Cluster 31: 127 elements
[INFO] Cluster 32: 186 elements
[INFO] Cluster 33: 26 elements
[INFO] Cluster 34: 11 elements
[INFO] Cluster 35: 147 elements
[INFO] Cluster 36: 53 elements
[INFO] Cluster 37: 234 elements
[INFO] Cluster 38: 72 elements
[INFO] Cluster 39: 212 elements
[INFO] Cluster 40: 228 elements
[INFO] Cluster 41: 245 elements
[INFO] Cluster 42: 68 elements
[INFO] Cluster 43: 67 elements
[INFO] Cluster 44: 77 elements
[INFO] Cluster 45: 201 elements
[INFO] Cluster 46: 73 elements
[INFO] Cluster 47: 53 elements
[INFO] Cluster 48: 93 elements
[INFO] Cluster 49: 8 elements
[INFO] Using 45 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=132, Long SMA=196, Sharpe=0.3053, Trades=15
[INFO] Cluster 1 cluster: Short SMA=14, Long SMA=26, Sharpe=-0.3356, Trades=120
[INFO] Cluster 2 cluster: Short SMA=94, Long SMA=110, Sharpe=0.1348, Trades=43
[INFO] Cluster 3 cluster: Short SMA=100, Long SMA=164, Sharpe=0.1506, Trades=17
[INFO] Cluster 4 cluster: Short SMA=46, Long SMA=54, Sharpe=0.3929, Trades=72
[INFO] Cluster 5 cluster: Short SMA=22, Long SMA=142, Sharpe=0.4090, Trades=27
[INFO] Cluster 6 cluster: Short SMA=76, Long SMA=212, Sharpe=0.5701, Trades=12
[INFO] Cluster 7 cluster: Short SMA=130, Long SMA=150, Sharpe=0.2735, Trades=27
[INFO] Cluster 8 cluster: Short SMA=34, Long SMA=220, Sharpe=0.4279, Trades=16
[INFO] Cluster 9 cluster: Short SMA=28, Long SMA=174, Sharpe=0.5766, Trades=19
[INFO] Cluster 10 cluster: Short SMA=228, Long SMA=252, Sharpe=-0.1106, Trades=14
[INFO] Cluster 11 cluster: Short SMA=160, Long SMA=188, Sharpe=0.1761, Trades=21
[INFO] Cluster 12 cluster: Short SMA=150, Long SMA=154, Sharpe=0.6174, Trades=55
[INFO] Cluster 13 cluster: Short SMA=46, Long SMA=88, Sharpe=0.5532, Trades=29
[INFO] Cluster 14 cluster: Short SMA=28, Long SMA=64, Sharpe=0.1462, Trades=50
[INFO] Cluster 15 cluster: Short SMA=152, Long SMA=224, Sharpe=0.0829, Trades=11
[INFO] Cluster 16 cluster: Short SMA=276, Long SMA=280, Sharpe=0.1401, Trades=32
[INFO] Cluster 17 cluster: Short SMA=178, Long SMA=212, Sharpe=0.0209, Trades=17
[INFO] Cluster 18 cluster: Short SMA=64, Long SMA=172, Sharpe=0.3134, Trades=17
[INFO] Cluster 19 cluster: Short SMA=24, Long SMA=280, Sharpe=0.2915, Trades=10
[INFO] Cluster 20 cluster: Short SMA=42, Long SMA=74, Sharpe=0.3329, Trades=41
[INFO] Cluster 22 cluster: Short SMA=68, Long SMA=122, Sharpe=0.2638, Trades=27
[INFO] Cluster 24 cluster: Short SMA=208, Long SMA=212, Sharpe=-0.1528, Trades=52
[INFO] Cluster 25 cluster: Short SMA=16, Long SMA=58, Sharpe=-0.1540, Trades=60
[INFO] Cluster 26 cluster: Short SMA=66, Long SMA=72, Sharpe=0.7254, Trades=69
[INFO] Cluster 28 cluster: Short SMA=106, Long SMA=134, Sharpe=-0.0361, Trades=28
[INFO] Cluster 29 cluster: Short SMA=42, Long SMA=108, Sharpe=0.4888, Trades=27
[INFO] Cluster 30 cluster: Short SMA=64, Long SMA=66, Sharpe=0.6455, Trades=113
[INFO] Cluster 31 cluster: Short SMA=118, Long SMA=184, Sharpe=0.5223, Trades=15
[INFO] Cluster 32 cluster: Short SMA=28, Long SMA=222, Sharpe=0.5236, Trades=16
[INFO] Cluster 33 cluster: Short SMA=130, Long SMA=132, Sharpe=0.4630, Trades=86
[INFO] Cluster 35 cluster: Short SMA=258, Long SMA=278, Sharpe=0.1429, Trades=12
[INFO] Cluster 36 cluster: Short SMA=132, Long SMA=138, Sharpe=0.3394, Trades=46
[INFO] Cluster 37 cluster: Short SMA=48, Long SMA=190, Sharpe=0.4033, Trades=17
[INFO] Cluster 38 cluster: Short SMA=144, Long SMA=162, Sharpe=0.6899, Trades=29
[INFO] Cluster 39 cluster: Short SMA=28, Long SMA=250, Sharpe=0.4311, Trades=14
[INFO] Cluster 40 cluster: Short SMA=198, Long SMA=240, Sharpe=0.0571, Trades=12
[INFO] Cluster 41 cluster: Short SMA=74, Long SMA=146, Sharpe=0.1741, Trades=21
[INFO] Cluster 42 cluster: Short SMA=236, Long SMA=248, Sharpe=-0.2848, Trades=18
[INFO] Cluster 43 cluster: Short SMA=58, Long SMA=82, Sharpe=0.7453, Trades=37
[INFO] Cluster 44 cluster: Short SMA=34, Long SMA=290, Sharpe=0.0899, Trades=10
[INFO] Cluster 45 cluster: Short SMA=20, Long SMA=98, Sharpe=0.1733, Trades=39
[INFO] Cluster 46 cluster: Short SMA=278, Long SMA=294, Sharpe=-0.0379, Trades=15
[INFO] Cluster 47 cluster: Short SMA=16, Long SMA=38, Sharpe=-0.2307, Trades=86
[INFO] Cluster 48 cluster: Short SMA=188, Long SMA=196, Sharpe=0.0183, Trades=35
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=72, Long SMA=80, Sharpe=0.9498, Trades=55
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=58, Long SMA=82, Sharpe=0.7453, Trades=37
[INFO] Top 2: Short SMA=66, Long SMA=72, Sharpe=0.7254, Trades=69
[INFO] Top 3: Short SMA=144, Long SMA=162, Sharpe=0.6899, Trades=29
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 45 valid clusters with clusters
[INFO] Filtering to 7279 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 72, Long SMA: 80
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(58/82) - Original Sharpe: 0.7453, Trades: 37
[INFO] Hierarchical cluster 2: SMA(66/72) - Original Sharpe: 0.7254, Trades: 69
[INFO] Hierarchical cluster 3: SMA(144/162) - Original Sharpe: 0.6899, Trades: 29
[INFO] Hierarchical cluster 4: SMA(64/66) - Original Sharpe: 0.6455, Trades: 113
[INFO] Hierarchical cluster 5: SMA(150/154) - Original Sharpe: 0.6174, Trades: 55
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (72/80)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (58/82) - Sharpe: 0.7453
[INFO] cluster 2: (66/72) - Sharpe: 0.7254
[INFO] cluster 3: (144/162) - Sharpe: 0.6899
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.048416           -3.123523
1    2021-11-14 2021-11-14            43     1.455706            0.873526
2    2022-01-14 2022-01-14            41     2.700861            2.700861
3    2022-03-14 2022-03-14            44     3.784695            3.784695
4    2022-05-14 2022-05-14            43     0.729933            0.729933
5    2022-07-14 2022-07-14            44     1.065131            2.554426
6    2022-09-14 2022-09-14            43     0.232152           -1.790148
7    2022-11-14 2022-11-14            43    -2.056108           -0.381685
8    2023-01-14 2023-01-14            41    -0.637807           -5.201039
9    2023-03-14 2023-03-14            44    -0.502398           -0.653245
10   2023-05-14 2023-05-14            44    -0.910839           -3.750063
11   2023-07-14 2023-07-14            44     2.935724            2.935724
12   2023-09-14 2023-09-14            43     1.603056            1.417042
13   2023-11-14 2023-11-14            42    -2.819972           -3.790743
14   2024-01-14 2024-01-14            43    -2.527000           -2.527000
15   2024-03-14 2024-03-14            42     2.399643            1.909747
16   2024-05-14 2024-05-14            44    -2.159756           -3.386008
17   2024-07-14 2024-07-14            45     4.444693            3.506981
18   2024-09-14 2024-09-14            43    -6.223105           -6.232862
19   2024-11-14 2024-11-14            33     0.476612            0.954542
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |             -3.1 |         -2.1 | False         
[INFO] 2021-11-14   |          1.5 |              0.9 |         -0.6 | False         
[INFO] 2022-01-14   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |              2.6 |          1.5 | True          
[INFO] 2022-09-14   |          0.2 |             -1.8 |         -2.0 | False         
[INFO] 2022-11-14   |         -2.1 |             -0.4 |          1.7 | True          
[INFO] 2023-01-14   |         -0.6 |             -5.2 |         -4.6 | False         
[INFO] 2023-03-14   |         -0.5 |             -0.7 |         -0.2 | False         
[INFO] 2023-05-14   |         -0.9 |             -3.8 |         -2.9 | False         
[INFO] 2023-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.6 |              1.4 |         -0.2 | False         
[INFO] 2023-11-14   |         -2.8 |             -3.8 |         -1.0 | False         
[INFO] 2024-01-14   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |          2.4 |              1.9 |         -0.5 | False         
[INFO] 2024-05-14   |         -2.2 |             -3.4 |         -1.2 | False         
[INFO] 2024-07-14   |          4.4 |              3.5 |         -0.9 | False         
[INFO] 2024-09-14   |         -6.2 |             -6.2 |          0.0 | Excluded      
[INFO] 2024-11-14   |          0.5 |              1.0 |          0.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14, 2022-03-14, 2022-05-14, 2023-07-14, 2024-01-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 3 of 14 periods (21.43% win rate)
[INFO] Updating Excel file with Hierarchical results for FV...
[INFO] Excel file updated successfully. Added FV with Hierarchical win rate 21.4% in row 22
[INFO] Added best Sharpe parameters 72/80 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 72, Long SMA: 80
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(58/82) - Original Sharpe: 0.7453
[INFO] Added cluster 2 to portfolio: SMA(66/72) - Original Sharpe: 0.7254
[INFO] Added cluster 3 to portfolio: SMA(144/162) - Original Sharpe: 0.6899
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FV_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2439
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1507
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for FV...
[INFO] Excel file updated successfully. Added FV with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FV
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for GC in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 127.77s
[INFO] Best parameters: Short SMA = 34, Long SMA = 40
[INFO] Best Sharpe ratio: 0.654126, Trades: 106
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @GC
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.70 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $480,888.00
[INFO] Market Buy & Hold P&L: $96,090.00
[INFO] Outperformance: $384,798.00
[INFO] Sharpe ratio (entire period, annualized): 0.434125
[INFO] Sharpe ratio (in-sample, annualized): 0.654126
[INFO] Sharpe ratio (out-of-sample, annualized): -0.036014
[INFO] Maximum Drawdown: $135,992.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 76
[INFO] Out-of-sample period trades: 30
[INFO] Total trades: 106
[INFO] In-sample P&L: $375,178.00
[INFO] Out-of-sample P&L: $-9,644.00
[INFO] 
Best parameters from GA: Short SMA = 34, Long SMA = 40, Sharpe = 0.654126
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8556 to 0.6541
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 40
[INFO] Sharpe Ratio: 0.654126
[INFO] Number of Trades: 106
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8556 to 0.6541
[INFO] Trades range: 11.0 to 332.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.4157 to 3.6814
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 259 elements
[INFO] Kmeans Cluster 1: 185 elements
[INFO] Kmeans Cluster 2: 319 elements
[INFO] Kmeans Cluster 3: 196 elements
[INFO] Kmeans Cluster 4: 94 elements
[INFO] Kmeans Cluster 5: 231 elements
[INFO] Kmeans Cluster 6: 152 elements
[INFO] Kmeans Cluster 7: 327 elements
[INFO] Kmeans Cluster 8: 170 elements
[INFO] Kmeans Cluster 9: 153 elements
[INFO] Kmeans Cluster 10: 203 elements
[INFO] Kmeans Cluster 11: 204 elements
[INFO] Kmeans Cluster 12: 217 elements
[INFO] Kmeans Cluster 13: 69 elements
[INFO] Kmeans Cluster 14: 243 elements
[INFO] Kmeans Cluster 15: 273 elements
[INFO] Kmeans Cluster 16: 228 elements
[INFO] Kmeans Cluster 17: 370 elements
[INFO] Kmeans Cluster 18: 341 elements
[INFO] Kmeans Cluster 19: 173 elements
[INFO] Kmeans Cluster 20: 289 elements
[INFO] Kmeans Cluster 21: 266 elements
[INFO] Kmeans Cluster 22: 161 elements
[INFO] Kmeans Cluster 23: 269 elements
[INFO] Kmeans Cluster 24: 236 elements
[INFO] Kmeans Cluster 25: 149 elements
[INFO] Kmeans Cluster 26: 119 elements
[INFO] Kmeans Cluster 27: 221 elements
[INFO] Kmeans Cluster 28: 221 elements
[INFO] Kmeans Cluster 29: 99 elements
[INFO] Kmeans Cluster 30: 179 elements
[INFO] Kmeans Cluster 31: 174 elements
[INFO] Kmeans Cluster 32: 250 elements
[INFO] Kmeans Cluster 33: 238 elements
[INFO] Kmeans Cluster 34: 81 elements
[INFO] Kmeans Cluster 35: 223 elements
[INFO] Kmeans Cluster 36: 155 elements
[INFO] Kmeans Cluster 37: 332 elements
[INFO] Kmeans Cluster 38: 123 elements
[INFO] Kmeans Cluster 39: 247 elements
[INFO] Kmeans Cluster 40: 180 elements
[INFO] Kmeans Cluster 41: 172 elements
[INFO] Kmeans Cluster 42: 221 elements
[INFO] Kmeans Cluster 43: 281 elements
[INFO] Kmeans Cluster 44: 199 elements
[INFO] Kmeans Cluster 45: 356 elements
[INFO] Kmeans Cluster 46: 236 elements
[INFO] Kmeans Cluster 47: 241 elements
[INFO] Kmeans Cluster 48: 152 elements
[INFO] Kmeans Cluster 49: 108 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=121.22, Long SMA=250.44, Sharpe=-0.2080
[INFO] Centroid 1: Short SMA=59.05, Long SMA=83.42, Sharpe=-0.5114
[INFO] Centroid 2: Short SMA=44.56, Long SMA=191.68, Sharpe=0.0014
[INFO] Centroid 3: Short SMA=234.04, Long SMA=256.96, Sharpe=-0.0361
[INFO] Centroid 4: Short SMA=32.49, Long SMA=51.87, Sharpe=0.3927
[INFO] Centroid 5: Short SMA=107.62, Long SMA=140.10, Sharpe=0.1763
[INFO] Centroid 6: Short SMA=272.82, Long SMA=285.66, Sharpe=-0.4351
[INFO] Centroid 7: Short SMA=160.91, Long SMA=249.34, Sharpe=-0.2492
[INFO] Centroid 8: Short SMA=62.01, Long SMA=249.40, Sharpe=-0.2235
[INFO] Centroid 9: Short SMA=18.25, Long SMA=197.16, Sharpe=-0.3526
[INFO] Centroid 10: Short SMA=169.07, Long SMA=279.18, Sharpe=-0.1297
[INFO] Centroid 11: Short SMA=142.64, Long SMA=166.47, Sharpe=-0.1359
[INFO] Centroid 12: Short SMA=93.58, Long SMA=244.37, Sharpe=-0.0957
[INFO] Centroid 13: Short SMA=16.81, Long SMA=31.33, Sharpe=-0.1840
[INFO] Centroid 14: Short SMA=37.05, Long SMA=120.35, Sharpe=-0.5514
[INFO] Centroid 15: Short SMA=226.03, Long SMA=283.90, Sharpe=-0.1550
[INFO] Centroid 16: Short SMA=37.88, Long SMA=246.05, Sharpe=0.0086
[INFO] Centroid 17: Short SMA=85.79, Long SMA=207.54, Sharpe=-0.0432
[INFO] Centroid 18: Short SMA=94.95, Long SMA=288.06, Sharpe=-0.1390
[INFO] Centroid 19: Short SMA=84.61, Long SMA=120.34, Sharpe=0.0740
[INFO] Centroid 20: Short SMA=175.79, Long SMA=215.15, Sharpe=-0.1739
[INFO] Centroid 21: Short SMA=24.62, Long SMA=132.33, Sharpe=-0.3934
[INFO] Centroid 22: Short SMA=27.18, Long SMA=58.41, Sharpe=0.2388
[INFO] Centroid 23: Short SMA=30.99, Long SMA=278.73, Sharpe=-0.1212
[INFO] Centroid 24: Short SMA=56.58, Long SMA=279.92, Sharpe=-0.3123
[INFO] Centroid 25: Short SMA=108.31, Long SMA=130.60, Sharpe=0.3306
[INFO] Centroid 26: Short SMA=170.81, Long SMA=188.35, Sharpe=-0.4003
[INFO] Centroid 27: Short SMA=213.90, Long SMA=238.52, Sharpe=0.1854
[INFO] Centroid 28: Short SMA=28.46, Long SMA=162.40, Sharpe=-0.2138
[INFO] Centroid 29: Short SMA=75.58, Long SMA=105.07, Sharpe=-0.2898
[INFO] Centroid 30: Short SMA=191.82, Long SMA=285.49, Sharpe=-0.0194
[INFO] Centroid 31: Short SMA=21.56, Long SMA=220.60, Sharpe=-0.2130
[INFO] Centroid 32: Short SMA=69.14, Long SMA=172.63, Sharpe=0.1182
[INFO] Centroid 33: Short SMA=111.03, Long SMA=190.39, Sharpe=-0.1239
[INFO] Centroid 34: Short SMA=25.58, Long SMA=82.79, Sharpe=-0.0682
[INFO] Centroid 35: Short SMA=53.86, Long SMA=94.94, Sharpe=-0.6901
[INFO] Centroid 36: Short SMA=13.88, Long SMA=262.71, Sharpe=-0.3660
[INFO] Centroid 37: Short SMA=140.13, Long SMA=283.06, Sharpe=-0.2156
[INFO] Centroid 38: Short SMA=71.25, Long SMA=122.33, Sharpe=-0.0875
[INFO] Centroid 39: Short SMA=206.44, Long SMA=260.59, Sharpe=0.0928
[INFO] Centroid 40: Short SMA=124.70, Long SMA=159.78, Sharpe=0.0053
[INFO] Centroid 41: Short SMA=90.66, Long SMA=269.71, Sharpe=-0.0281
[INFO] Centroid 42: Short SMA=59.93, Long SMA=221.93, Sharpe=-0.1161
[INFO] Centroid 43: Short SMA=75.15, Long SMA=155.49, Sharpe=0.2248
[INFO] Centroid 44: Short SMA=256.16, Long SMA=286.22, Sharpe=-0.2918
[INFO] Centroid 45: Short SMA=130.74, Long SMA=219.94, Sharpe=-0.1478
[INFO] Centroid 46: Short SMA=147.18, Long SMA=187.25, Sharpe=-0.2616
[INFO] Centroid 47: Short SMA=184.77, Long SMA=223.34, Sharpe=-0.0422
[INFO] Centroid 48: Short SMA=21.83, Long SMA=60.22, Sharpe=0.0811
[INFO] Centroid 49: Short SMA=32.94, Long SMA=85.72, Sharpe=-0.2554
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=40, Sharpe=0.6541, Trades=106
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=108, Long SMA=128, Sharpe=0.4268, Trades=34
[INFO] Kmeans Top 2: Short SMA=34, Long SMA=52, Sharpe=0.4172, Trades=64
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=58, Sharpe=0.2495, Trades=50
[INFO] Kmeans Top 4: Short SMA=212, Long SMA=236, Sharpe=0.2452, Trades=23
[INFO] Kmeans Top 5: Short SMA=76, Long SMA=154, Sharpe=0.2278, Trades=17
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (121, 250)
[INFO]   Nearest: (122.0, 250.0)
[INFO]   Rounded: (59, 83)
[INFO]   Nearest: (60.0, 84.0)
[INFO]   Rounded: (45, 192)
[INFO]   Nearest: (44.0, 192.0)
[INFO]   Rounded: (234, 257)
[INFO]   Nearest: (234.0, 256.0)
[INFO]   Rounded: (32, 52)
[INFO]   Rounded: (108, 140)
[INFO]   Rounded: (273, 286)
[INFO]   Nearest: (272.0, 286.0)
[INFO]   Rounded: (161, 249)
[INFO]   Nearest: (160.0, 250.0)
[INFO]   Rounded: (62, 249)
[INFO]   Nearest: (62.0, 250.0)
[INFO]   Rounded: (18, 197)
[INFO]   Nearest: (18.0, 198.0)
[INFO]   Rounded: (169, 279)
[INFO]   Nearest: (170.0, 280.0)
[INFO]   Rounded: (143, 166)
[INFO]   Nearest: (142.0, 166.0)
[INFO]   Rounded: (94, 244)
[INFO]   Rounded: (17, 31)
[INFO]   Nearest: (16.0, 32.0)
[INFO]   Rounded: (37, 120)
[INFO]   Nearest: (38.0, 120.0)
[INFO]   Rounded: (226, 284)
[INFO]   Rounded: (38, 246)
[INFO]   Rounded: (86, 208)
[INFO]   Rounded: (95, 288)
[INFO]   Nearest: (94.0, 288.0)
[INFO]   Rounded: (85, 120)
[INFO]   Nearest: (84.0, 120.0)
[INFO]   Rounded: (176, 215)
[INFO]   Nearest: (176.0, 216.0)
[INFO]   Rounded: (25, 132)
[INFO]   Nearest: (24.0, 132.0)
[INFO]   Rounded: (27, 58)
[INFO]   Nearest: (28.0, 58.0)
[INFO]   Rounded: (31, 279)
[INFO]   Nearest: (30.0, 278.0)
[INFO]   Rounded: (57, 280)
[INFO]   Nearest: (56.0, 280.0)
[INFO]   Rounded: (108, 131)
[INFO]   Nearest: (108.0, 130.0)
[INFO]   Rounded: (171, 188)
[INFO]   Nearest: (170.0, 188.0)
[INFO]   Rounded: (214, 239)
[INFO]   Nearest: (214.0, 238.0)
[INFO]   Rounded: (28, 162)
[INFO]   Rounded: (76, 105)
[INFO]   Nearest: (76.0, 106.0)
[INFO]   Rounded: (192, 285)
[INFO]   Nearest: (192.0, 286.0)
[INFO]   Rounded: (22, 221)
[INFO]   Nearest: (22.0, 220.0)
[INFO]   Rounded: (69, 173)
[INFO]   Nearest: (70.0, 172.0)
[INFO]   Rounded: (111, 190)
[INFO]   Nearest: (112.0, 190.0)
[INFO]   Rounded: (26, 83)
[INFO]   Nearest: (26.0, 82.0)
[INFO]   Rounded: (54, 95)
[INFO]   Nearest: (54.0, 94.0)
[INFO]   Rounded: (14, 263)
[INFO]   Nearest: (14.0, 262.0)
[INFO]   Rounded: (140, 283)
[INFO]   Nearest: (140.0, 284.0)
[INFO]   Rounded: (71, 122)
[INFO]   Nearest: (72.0, 122.0)
[INFO]   Rounded: (206, 261)
[INFO]   Nearest: (206.0, 260.0)
[INFO]   Rounded: (125, 160)
[INFO]   Nearest: (124.0, 160.0)
[INFO]   Rounded: (91, 270)
[INFO]   Nearest: (90.0, 270.0)
[INFO]   Rounded: (60, 222)
[INFO]   Rounded: (75, 155)
[INFO]   Nearest: (76.0, 156.0)
[INFO]   Rounded: (256, 286)
[INFO]   Rounded: (131, 220)
[INFO]   Nearest: (130.0, 220.0)
[INFO]   Rounded: (147, 187)
[INFO]   Nearest: (148.0, 188.0)
[INFO]   Rounded: (185, 223)
[INFO]   Nearest: (184.0, 224.0)
[INFO]   Rounded: (22, 60)
[INFO]   Rounded: (33, 86)
[INFO]   Nearest: (32.0, 86.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 40
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(108/128) - Original Sharpe: 0.4268, Trades: 34
[INFO] Kmeans cluster 2: SMA(34/52) - Original Sharpe: 0.4172, Trades: 64
[INFO] Kmeans cluster 3: SMA(28/58) - Original Sharpe: 0.2495, Trades: 50
[INFO] Kmeans cluster 4: SMA(212/236) - Original Sharpe: 0.2452, Trades: 23
[INFO] Kmeans cluster 5: SMA(76/154) - Original Sharpe: 0.2278, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/40)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (108/128) - Sharpe: 0.4268
[INFO] cluster 2: (34/52) - Sharpe: 0.4172
[INFO] cluster 3: (28/58) - Sharpe: 0.2495
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.475309           -2.099007
1    2021-11-14 2021-11-14            43    -2.403082           -1.758674
2    2022-01-14 2022-01-14            41     3.901083            2.918755
3    2022-03-14 2022-03-14            44     0.151957           -1.945707
4    2022-05-14 2022-05-14            43    -1.226083            1.889570
5    2022-07-14 2022-07-14            44    -0.992081            1.876864
6    2022-09-14 2022-09-14            43    -2.140694           -1.538954
7    2022-11-14 2022-11-14            43     2.716556            4.280360
8    2023-01-14 2023-01-14            41    -3.937365           -4.510687
9    2023-03-14 2023-03-14            43    -1.001656           -1.001456
10   2023-05-14 2023-05-14            44    -1.986559           -1.404961
11   2023-07-14 2023-07-14            44     4.153690            3.988571
12   2023-09-14 2023-09-14            43    -0.209199           -0.287369
13   2023-11-14 2023-11-14            42     1.089419            1.266151
14   2024-01-14 2024-01-14            43    -4.104296           -2.621551
15   2024-03-14 2024-03-14            42     3.001304            3.001304
16   2024-05-14 2024-05-14            44    -0.938204           -1.036361
17   2024-07-14 2024-07-14            45     1.375742            2.943714
18   2024-09-14 2024-09-14            43    -0.392625           -0.392625
19   2024-11-14 2024-11-14            33     1.099525            1.512091
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.5 |             -2.1 |         -2.6 | False         
[INFO] 2021-11-14   |         -2.4 |             -1.8 |          0.6 | True          
[INFO] 2022-01-14   |          3.9 |              2.9 |         -1.0 | False         
[INFO] 2022-03-14   |          0.2 |             -1.9 |         -2.1 | False         
[INFO] 2022-05-14   |         -1.2 |              1.9 |          3.1 | True          
[INFO] 2022-07-14   |         -1.0 |              1.9 |          2.9 | True          
[INFO] 2022-09-14   |         -2.1 |             -1.5 |          0.6 | True          
[INFO] 2022-11-14   |          2.7 |              4.3 |          1.6 | True          
[INFO] 2023-01-14   |         -3.9 |             -4.5 |         -0.6 | False         
[INFO] 2023-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2023-05-14   |         -2.0 |             -1.4 |          0.6 | True          
[INFO] 2023-07-14   |          4.2 |              4.0 |         -0.2 | False         
[INFO] 2023-09-14   |         -0.2 |             -0.3 |         -0.1 | False         
[INFO] 2023-11-14   |          1.1 |              1.3 |          0.2 | True          
[INFO] 2024-01-14   |         -4.1 |             -2.6 |          1.5 | True          
[INFO] 2024-03-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -0.9 |             -1.0 |         -0.1 | False         
[INFO] 2024-07-14   |          1.4 |              2.9 |          1.5 | True          
[INFO] 2024-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |          1.1 |              1.5 |          0.4 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-03-14, 2024-03-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 10 of 17 periods (58.82% win rate)
[INFO] Updating Excel file with Kmeans results for GC...
[INFO] Excel file updated successfully. Added GC with Kmeans win rate 58.8% in row 23
[INFO] Added best Sharpe parameters 34/40 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 40
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(108/128) - Original Sharpe: 0.4268
[INFO] Added cluster 2 to portfolio: SMA(34/52) - Original Sharpe: 0.4172
[INFO] Added cluster 3 to portfolio: SMA(28/58) - Original Sharpe: 0.2495
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'GC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1697
[INFO] Kmeans Best out-of-sample Sharpe: -0.0360
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for GC...
[INFO] Excel file updated successfully. Added GC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\GC
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8556 to 0.6541
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 40
[INFO] Sharpe Ratio: 0.654126
[INFO] Number of Trades: 106
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8556 to 0.6541
[INFO] Trades range: 11.0 to 332.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.4157 to 3.6814
[INFO] Scaled Trades range: -0.7504 to 15.7636
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5600
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 473 elements
[INFO] Cluster 1: 427 elements
[INFO] Cluster 2: 672 elements
[INFO] Cluster 3: 323 elements
[INFO] Cluster 4: 566 elements
[INFO] Cluster 5: 184 elements
[INFO] Cluster 6: 199 elements
[INFO] Cluster 7: 379 elements
[INFO] Cluster 8: 67 elements
[INFO] Cluster 9: 506 elements
[INFO] Cluster 10: 197 elements
[INFO] Cluster 11: 73 elements
[INFO] Cluster 12: 453 elements
[INFO] Cluster 13: 243 elements
[INFO] Cluster 14: 298 elements
[INFO] Cluster 15: 198 elements
[INFO] Cluster 16: 344 elements
[INFO] Cluster 17: 62 elements
[INFO] Cluster 18: 168 elements
[INFO] Cluster 19: 288 elements
[INFO] Cluster 20: 53 elements
[INFO] Cluster 21: 500 elements
[INFO] Cluster 22: 23 elements
[INFO] Cluster 23: 112 elements
[INFO] Cluster 24: 95 elements
[INFO] Cluster 25: 359 elements
[INFO] Cluster 26: 197 elements
[INFO] Cluster 27: 245 elements
[INFO] Cluster 28: 155 elements
[INFO] Cluster 29: 139 elements
[INFO] Cluster 30: 6 elements
[INFO] Cluster 31: 35 elements
[INFO] Cluster 32: 29 elements
[INFO] Cluster 33: 127 elements
[INFO] Cluster 34: 135 elements
[INFO] Cluster 35: 25 elements
[INFO] Cluster 36: 118 elements
[INFO] Cluster 37: 124 elements
[INFO] Cluster 38: 169 elements
[INFO] Cluster 39: 9 elements
[INFO] Cluster 40: 156 elements
[INFO] Cluster 41: 42 elements
[INFO] Cluster 42: 53 elements
[INFO] Cluster 43: 156 elements
[INFO] Cluster 44: 143 elements
[INFO] Cluster 45: 248 elements
[INFO] Cluster 46: 194 elements
[INFO] Cluster 47: 304 elements
[INFO] Cluster 48: 277 elements
[INFO] Cluster 49: 237 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=44, Long SMA=204, Sharpe=0.0295, Trades=21
[INFO] Cluster 1 cluster: Short SMA=204, Long SMA=266, Sharpe=0.1520, Trades=15
[INFO] Cluster 2 cluster: Short SMA=80, Long SMA=214, Sharpe=-0.0614, Trades=15
[INFO] Cluster 3 cluster: Short SMA=48, Long SMA=246, Sharpe=-0.1345, Trades=15
[INFO] Cluster 4 cluster: Short SMA=136, Long SMA=266, Sharpe=-0.2257, Trades=13
[INFO] Cluster 5 cluster: Short SMA=24, Long SMA=68, Sharpe=0.1680, Trades=50
[INFO] Cluster 6 cluster: Short SMA=180, Long SMA=194, Sharpe=-0.3896, Trades=31
[INFO] Cluster 7 cluster: Short SMA=92, Long SMA=144, Sharpe=0.1872, Trades=21
[INFO] Cluster 8 cluster: Short SMA=38, Long SMA=44, Sharpe=0.2995, Trades=100
[INFO] Cluster 9 cluster: Short SMA=92, Long SMA=268, Sharpe=0.0259, Trades=13
[INFO] Cluster 10 cluster: Short SMA=32, Long SMA=160, Sharpe=-0.2559, Trades=25
[INFO] Cluster 11 cluster: Short SMA=106, Long SMA=114, Sharpe=0.2481, Trades=57
[INFO] Cluster 12 cluster: Short SMA=162, Long SMA=242, Sharpe=-0.2879, Trades=17
[INFO] Cluster 13 cluster: Short SMA=18, Long SMA=204, Sharpe=-0.3731, Trades=33
[INFO] Cluster 14 cluster: Short SMA=184, Long SMA=226, Sharpe=-0.0811, Trades=21
[INFO] Cluster 15 cluster: Short SMA=220, Long SMA=236, Sharpe=0.0441, Trades=27
[INFO] Cluster 16 cluster: Short SMA=50, Long SMA=104, Sharpe=-0.5342, Trades=31
[INFO] Cluster 17 cluster: Short SMA=160, Long SMA=162, Sharpe=-0.1327, Trades=71
[INFO] Cluster 18 cluster: Short SMA=272, Long SMA=286, Sharpe=-0.3603, Trades=29
[INFO] Cluster 19 cluster: Short SMA=30, Long SMA=278, Sharpe=-0.0877, Trades=15
[INFO] Cluster 20 cluster: Short SMA=80, Long SMA=90, Sharpe=-0.3445, Trades=53
[INFO] Cluster 21 cluster: Short SMA=130, Long SMA=214, Sharpe=-0.0907, Trades=15
[INFO] Cluster 22 cluster: Short SMA=32, Long SMA=34, Sharpe=0.2971, Trades=177
[INFO] Cluster 23 cluster: Short SMA=70, Long SMA=116, Sharpe=-0.2100, Trades=27
[INFO] Cluster 24 cluster: Short SMA=66, Long SMA=78, Sharpe=-0.5371, Trades=55
[INFO] Cluster 25 cluster: Short SMA=30, Long SMA=126, Sharpe=-0.3576, Trades=33
[INFO] Cluster 26 cluster: Short SMA=250, Long SMA=290, Sharpe=-0.3529, Trades=17
[INFO] Cluster 27 cluster: Short SMA=220, Long SMA=286, Sharpe=-0.1232, Trades=15
[INFO] Cluster 28 cluster: Short SMA=112, Long SMA=164, Sharpe=0.0390, Trades=21
[INFO] Cluster 29 cluster: Short SMA=146, Long SMA=160, Sharpe=-0.1529, Trades=37
[INFO] Cluster 31 cluster: Short SMA=18, Long SMA=26, Sharpe=-0.4546, Trades=132
[INFO] Cluster 32 cluster: Short SMA=72, Long SMA=76, Sharpe=-0.5074, Trades=87
[INFO] Cluster 33 cluster: Short SMA=14, Long SMA=148, Sharpe=-0.3719, Trades=43
[INFO] Cluster 34 cluster: Short SMA=32, Long SMA=54, Sharpe=0.3263, Trades=60
[INFO] Cluster 35 cluster: Short SMA=274, Long SMA=276, Sharpe=-0.3491, Trades=65
[INFO] Cluster 36 cluster: Short SMA=236, Long SMA=250, Sharpe=-0.0654, Trades=27
[INFO] Cluster 37 cluster: Short SMA=14, Long SMA=266, Sharpe=-0.4273, Trades=39
[INFO] Cluster 38 cluster: Short SMA=108, Long SMA=128, Sharpe=0.4268, Trades=34
[INFO] Cluster 40 cluster: Short SMA=26, Long SMA=88, Sharpe=-0.2109, Trades=40
[INFO] Cluster 41 cluster: Short SMA=218, Long SMA=222, Sharpe=0.1883, Trades=49
[INFO] Cluster 42 cluster: Short SMA=18, Long SMA=38, Sharpe=-0.2148, Trades=88
[INFO] Cluster 43 cluster: Short SMA=142, Long SMA=188, Sharpe=-0.2286, Trades=21
[INFO] Cluster 44 cluster: Short SMA=74, Long SMA=128, Sharpe=-0.0177, Trades=27
[INFO] Cluster 45 cluster: Short SMA=120, Long SMA=178, Sharpe=-0.1804, Trades=17
[INFO] Cluster 46 cluster: Short SMA=174, Long SMA=282, Sharpe=-0.0889, Trades=13
[INFO] Cluster 47 cluster: Short SMA=66, Long SMA=168, Sharpe=0.0749, Trades=17
[INFO] Cluster 48 cluster: Short SMA=58, Long SMA=278, Sharpe=-0.3048, Trades=15
[INFO] Cluster 49 cluster: Short SMA=114, Long SMA=292, Sharpe=-0.1599, Trades=13
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=40, Sharpe=0.6541, Trades=106
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=108, Long SMA=128, Sharpe=0.4268, Trades=34
[INFO] Top 2: Short SMA=32, Long SMA=54, Sharpe=0.3263, Trades=60
[INFO] Top 3: Short SMA=38, Long SMA=44, Sharpe=0.2995, Trades=100
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10570 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 40
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(108/128) - Original Sharpe: 0.4268, Trades: 34
[INFO] Hierarchical cluster 2: SMA(32/54) - Original Sharpe: 0.3263, Trades: 60
[INFO] Hierarchical cluster 3: SMA(38/44) - Original Sharpe: 0.2995, Trades: 100
[INFO] Hierarchical cluster 4: SMA(32/34) - Original Sharpe: 0.2971, Trades: 177
[INFO] Hierarchical cluster 5: SMA(106/114) - Original Sharpe: 0.2481, Trades: 57
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/40)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (108/128) - Sharpe: 0.4268
[INFO] cluster 2: (32/54) - Sharpe: 0.3263
[INFO] cluster 3: (38/44) - Sharpe: 0.2995
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.475309           -2.300200
1    2021-11-14 2021-11-14            43    -2.403082           -2.818177
2    2022-01-14 2022-01-14            41     3.901083            3.098387
3    2022-03-14 2022-03-14            44     0.151957           -2.345438
4    2022-05-14 2022-05-14            43    -1.226083            1.889570
5    2022-07-14 2022-07-14            44    -0.992081            1.489532
6    2022-09-14 2022-09-14            43    -2.140694           -1.905055
7    2022-11-14 2022-11-14            43     2.716556            1.426252
8    2023-01-14 2023-01-14            41    -3.937365           -4.813109
9    2023-03-14 2023-03-14            43    -1.001656           -1.598902
10   2023-05-14 2023-05-14            44    -1.986559           -1.894546
11   2023-07-14 2023-07-14            44     4.153690            7.071727
12   2023-09-14 2023-09-14            43    -0.209199           -0.209199
13   2023-11-14 2023-11-14            42     1.089419           -0.354304
14   2024-01-14 2024-01-14            43    -4.104296           -4.886337
15   2024-03-14 2024-03-14            42     3.001304            3.001304
16   2024-05-14 2024-05-14            44    -0.938204           -0.203103
17   2024-07-14 2024-07-14            45     1.375742            3.050859
18   2024-09-14 2024-09-14            43    -0.392625           -0.392625
19   2024-11-14 2024-11-14            33     1.099525            2.669087
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.5 |             -2.3 |         -2.8 | False         
[INFO] 2021-11-14   |         -2.4 |             -2.8 |         -0.4 | False         
[INFO] 2022-01-14   |          3.9 |              3.1 |         -0.8 | False         
[INFO] 2022-03-14   |          0.2 |             -2.3 |         -2.5 | False         
[INFO] 2022-05-14   |         -1.2 |              1.9 |          3.1 | True          
[INFO] 2022-07-14   |         -1.0 |              1.5 |          2.5 | True          
[INFO] 2022-09-14   |         -2.1 |             -1.9 |          0.2 | True          
[INFO] 2022-11-14   |          2.7 |              1.4 |         -1.3 | False         
[INFO] 2023-01-14   |         -3.9 |             -4.8 |         -0.9 | False         
[INFO] 2023-03-14   |         -1.0 |             -1.6 |         -0.6 | False         
[INFO] 2023-05-14   |         -2.0 |             -1.9 |          0.1 | True          
[INFO] 2023-07-14   |          4.2 |              7.1 |          2.9 | True          
[INFO] 2023-09-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-11-14   |          1.1 |             -0.4 |         -1.5 | False         
[INFO] 2024-01-14   |         -4.1 |             -4.9 |         -0.8 | False         
[INFO] 2024-03-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -0.9 |             -0.2 |          0.7 | True          
[INFO] 2024-07-14   |          1.4 |              3.1 |          1.7 | True          
[INFO] 2024-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |          1.1 |              2.7 |          1.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-09-14, 2024-03-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 17 periods (47.06% win rate)
[INFO] Updating Excel file with Hierarchical results for GC...
[INFO] Excel file updated successfully. Added GC with Hierarchical win rate 47.1% in row 23
[INFO] Added best Sharpe parameters 34/40 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 40
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(108/128) - Original Sharpe: 0.4268
[INFO] Added cluster 2 to portfolio: SMA(32/54) - Original Sharpe: 0.3263
[INFO] Added cluster 3 to portfolio: SMA(38/44) - Original Sharpe: 0.2995
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'GC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0312
[INFO] Hierarchical Best out-of-sample Sharpe: -0.0360
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for GC...
[INFO] Excel file updated successfully. Added GC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\GC
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for HG in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 154.05s
[INFO] Best parameters: Short SMA = 202, Long SMA = 204
[INFO] Best Sharpe ratio: 0.957606, Trades: 77
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @HG
[INFO] Big Point Value (from data): 25000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.53 contracts
[INFO] Maximum Position Size: 9 contracts
[INFO] Strategy Total P&L: $250,534.50
[INFO] Market Buy & Hold P&L: $900.00
[INFO] Outperformance: $249,634.50
[INFO] Sharpe ratio (entire period, annualized): 0.254714
[INFO] Sharpe ratio (in-sample, annualized): 0.957606
[INFO] Sharpe ratio (out-of-sample, annualized): -1.312122
[INFO] Maximum Drawdown: $353,420.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 55
[INFO] Out-of-sample period trades: 22
[INFO] Total trades: 77
[INFO] In-sample P&L: $522,067.00
[INFO] Out-of-sample P&L: $-320,532.50
[INFO] 
Best parameters from GA: Short SMA = 202, Long SMA = 204, Sharpe = 0.957606
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 25000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7723 to 0.9576
[INFO] 
Best parameters:
[INFO] Short SMA: 202
[INFO] Long SMA: 204
[INFO] Sharpe Ratio: 0.957606
[INFO] Number of Trades: 77
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9787 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7723 to 0.9576
[INFO] Trades range: 10.0 to 363.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3319 to 2.7995
[INFO] Scaled Long SMA range: -2.7689 to 1.5355
[INFO] Scaled Sharpe ratio range: -2.9750 to 2.2590
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 76 elements
[INFO] Kmeans Cluster 1: 216 elements
[INFO] Kmeans Cluster 2: 72 elements
[INFO] Kmeans Cluster 3: 188 elements
[INFO] Kmeans Cluster 4: 247 elements
[INFO] Kmeans Cluster 5: 281 elements
[INFO] Kmeans Cluster 6: 201 elements
[INFO] Kmeans Cluster 7: 182 elements
[INFO] Kmeans Cluster 8: 84 elements
[INFO] Kmeans Cluster 9: 292 elements
[INFO] Kmeans Cluster 10: 205 elements
[INFO] Kmeans Cluster 11: 187 elements
[INFO] Kmeans Cluster 12: 335 elements
[INFO] Kmeans Cluster 13: 322 elements
[INFO] Kmeans Cluster 14: 183 elements
[INFO] Kmeans Cluster 15: 220 elements
[INFO] Kmeans Cluster 16: 176 elements
[INFO] Kmeans Cluster 17: 141 elements
[INFO] Kmeans Cluster 18: 210 elements
[INFO] Kmeans Cluster 19: 237 elements
[INFO] Kmeans Cluster 20: 238 elements
[INFO] Kmeans Cluster 21: 242 elements
[INFO] Kmeans Cluster 22: 157 elements
[INFO] Kmeans Cluster 23: 291 elements
[INFO] Kmeans Cluster 24: 322 elements
[INFO] Kmeans Cluster 25: 138 elements
[INFO] Kmeans Cluster 26: 249 elements
[INFO] Kmeans Cluster 27: 256 elements
[INFO] Kmeans Cluster 28: 148 elements
[INFO] Kmeans Cluster 29: 135 elements
[INFO] Kmeans Cluster 30: 111 elements
[INFO] Kmeans Cluster 31: 272 elements
[INFO] Kmeans Cluster 32: 58 elements
[INFO] Kmeans Cluster 33: 182 elements
[INFO] Kmeans Cluster 34: 183 elements
[INFO] Kmeans Cluster 35: 150 elements
[INFO] Kmeans Cluster 36: 198 elements
[INFO] Kmeans Cluster 37: 131 elements
[INFO] Kmeans Cluster 38: 290 elements
[INFO] Kmeans Cluster 39: 128 elements
[INFO] Kmeans Cluster 40: 74 elements
[INFO] Kmeans Cluster 41: 285 elements
[INFO] Kmeans Cluster 42: 207 elements
[INFO] Kmeans Cluster 43: 211 elements
[INFO] Kmeans Cluster 44: 163 elements
[INFO] Kmeans Cluster 45: 117 elements
[INFO] Kmeans Cluster 46: 166 elements
[INFO] Kmeans Cluster 47: 186 elements
[INFO] Kmeans Cluster 48: 159 elements
[INFO] Kmeans Cluster 49: 285 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=35.00, Long SMA=49.66, Sharpe=0.7007
[INFO] Centroid 1: Short SMA=54.55, Long SMA=229.04, Sharpe=0.2011
[INFO] Centroid 2: Short SMA=215.33, Long SMA=230.83, Sharpe=0.3865
[INFO] Centroid 3: Short SMA=79.05, Long SMA=127.12, Sharpe=-0.1869
[INFO] Centroid 4: Short SMA=60.41, Long SMA=173.30, Sharpe=-0.3187
[INFO] Centroid 5: Short SMA=92.30, Long SMA=262.72, Sharpe=0.7507
[INFO] Centroid 6: Short SMA=63.75, Long SMA=149.54, Sharpe=-0.5148
[INFO] Centroid 7: Short SMA=144.45, Long SMA=162.25, Sharpe=0.0168
[INFO] Centroid 8: Short SMA=281.57, Long SMA=294.93, Sharpe=0.3806
[INFO] Centroid 9: Short SMA=24.40, Long SMA=280.31, Sharpe=0.4259
[INFO] Centroid 10: Short SMA=28.95, Long SMA=128.12, Sharpe=0.1642
[INFO] Centroid 11: Short SMA=58.40, Long SMA=200.99, Sharpe=-0.0325
[INFO] Centroid 12: Short SMA=158.71, Long SMA=188.06, Sharpe=0.1730
[INFO] Centroid 13: Short SMA=156.24, Long SMA=235.78, Sharpe=0.5436
[INFO] Centroid 14: Short SMA=30.96, Long SMA=143.12, Sharpe=-0.0975
[INFO] Centroid 15: Short SMA=103.85, Long SMA=208.53, Sharpe=0.1812
[INFO] Centroid 16: Short SMA=61.59, Long SMA=86.87, Sharpe=-0.1333
[INFO] Centroid 17: Short SMA=29.60, Long SMA=54.68, Sharpe=0.4085
[INFO] Centroid 18: Short SMA=206.34, Long SMA=256.76, Sharpe=0.5436
[INFO] Centroid 19: Short SMA=121.45, Long SMA=150.15, Sharpe=-0.1302
[INFO] Centroid 20: Short SMA=78.50, Long SMA=242.33, Sharpe=0.5771
[INFO] Centroid 21: Short SMA=259.38, Long SMA=284.16, Sharpe=0.1913
[INFO] Centroid 22: Short SMA=28.75, Long SMA=166.33, Sharpe=0.0572
[INFO] Centroid 23: Short SMA=178.36, Long SMA=257.74, Sharpe=0.6830
[INFO] Centroid 24: Short SMA=121.08, Long SMA=245.76, Sharpe=0.5770
[INFO] Centroid 25: Short SMA=67.38, Long SMA=282.20, Sharpe=0.3682
[INFO] Centroid 26: Short SMA=101.90, Long SMA=120.88, Sharpe=0.0475
[INFO] Centroid 27: Short SMA=34.99, Long SMA=74.52, Sharpe=0.1640
[INFO] Centroid 28: Short SMA=234.15, Long SMA=248.84, Sharpe=0.7054
[INFO] Centroid 29: Short SMA=32.90, Long SMA=105.06, Sharpe=0.3961
[INFO] Centroid 30: Short SMA=14.92, Long SMA=229.37, Sharpe=0.1797
[INFO] Centroid 31: Short SMA=219.06, Long SMA=285.63, Sharpe=0.2958
[INFO] Centroid 32: Short SMA=18.59, Long SMA=32.00, Sharpe=-0.4183
[INFO] Centroid 33: Short SMA=96.61, Long SMA=220.39, Sharpe=0.3715
[INFO] Centroid 34: Short SMA=236.05, Long SMA=266.50, Sharpe=0.4618
[INFO] Centroid 35: Short SMA=17.07, Long SMA=183.87, Sharpe=-0.0776
[INFO] Centroid 36: Short SMA=31.64, Long SMA=223.61, Sharpe=0.4709
[INFO] Centroid 37: Short SMA=114.43, Long SMA=278.92, Sharpe=0.4708
[INFO] Centroid 38: Short SMA=194.21, Long SMA=219.99, Sharpe=0.6320
[INFO] Centroid 39: Short SMA=32.03, Long SMA=197.56, Sharpe=0.2533
[INFO] Centroid 40: Short SMA=16.54, Long SMA=39.11, Sharpe=-0.0673
[INFO] Centroid 41: Short SMA=67.10, Long SMA=104.67, Sharpe=-0.4446
[INFO] Centroid 42: Short SMA=50.85, Long SMA=281.91, Sharpe=0.2020
[INFO] Centroid 43: Short SMA=32.84, Long SMA=253.63, Sharpe=0.3397
[INFO] Centroid 44: Short SMA=83.09, Long SMA=184.39, Sharpe=-0.1731
[INFO] Centroid 45: Short SMA=110.94, Long SMA=168.67, Sharpe=-0.3466
[INFO] Centroid 46: Short SMA=90.65, Long SMA=154.41, Sharpe=-0.0261
[INFO] Centroid 47: Short SMA=165.14, Long SMA=209.32, Sharpe=0.3541
[INFO] Centroid 48: Short SMA=19.05, Long SMA=97.48, Sharpe=-0.0248
[INFO] Centroid 49: Short SMA=122.93, Long SMA=193.14, Sharpe=-0.0405
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=202, Long SMA=204, Sharpe=0.9576, Trades=77
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=92, Long SMA=262, Sharpe=0.8236, Trades=12
[INFO] Kmeans Top 2: Short SMA=34, Long SMA=50, Sharpe=0.8119, Trades=58
[INFO] Kmeans Top 3: Short SMA=232, Long SMA=246, Sharpe=0.7615, Trades=35
[INFO] Kmeans Top 4: Short SMA=194, Long SMA=220, Sharpe=0.7209, Trades=21
[INFO] Kmeans Top 5: Short SMA=178, Long SMA=258, Sharpe=0.6651, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (35, 50)
[INFO]   Nearest: (36.0, 50.0)
[INFO]   Rounded: (55, 229)
[INFO]   Nearest: (54.0, 230.0)
[INFO]   Rounded: (215, 231)
[INFO]   Nearest: (216.0, 230.0)
[INFO]   Rounded: (79, 127)
[INFO]   Nearest: (80.0, 128.0)
[INFO]   Rounded: (60, 173)
[INFO]   Nearest: (60.0, 174.0)
[INFO]   Rounded: (92, 263)
[INFO]   Nearest: (92.0, 262.0)
[INFO]   Rounded: (64, 150)
[INFO]   Rounded: (144, 162)
[INFO]   Rounded: (282, 295)
[INFO]   Nearest: (282.0, 294.0)
[INFO]   Rounded: (24, 280)
[INFO]   Rounded: (29, 128)
[INFO]   Nearest: (28.0, 128.0)
[INFO]   Rounded: (58, 201)
[INFO]   Nearest: (58.0, 200.0)
[INFO]   Rounded: (159, 188)
[INFO]   Nearest: (158.0, 188.0)
[INFO]   Rounded: (156, 236)
[INFO]   Rounded: (31, 143)
[INFO]   Nearest: (30.0, 144.0)
[INFO]   Rounded: (104, 209)
[INFO]   Nearest: (104.0, 208.0)
[INFO]   Rounded: (62, 87)
[INFO]   Nearest: (62.0, 86.0)
[INFO]   Rounded: (30, 55)
[INFO]   Nearest: (30.0, 54.0)
[INFO]   Rounded: (206, 257)
[INFO]   Nearest: (206.0, 256.0)
[INFO]   Rounded: (121, 150)
[INFO]   Nearest: (122.0, 150.0)
[INFO]   Rounded: (78, 242)
[INFO]   Rounded: (259, 284)
[INFO]   Nearest: (260.0, 284.0)
[INFO]   Rounded: (29, 166)
[INFO]   Nearest: (28.0, 166.0)
[INFO]   Rounded: (178, 258)
[INFO]   Rounded: (121, 246)
[INFO]   Nearest: (122.0, 246.0)
[INFO]   Rounded: (67, 282)
[INFO]   Nearest: (68.0, 282.0)
[INFO]   Rounded: (102, 121)
[INFO]   Nearest: (102.0, 120.0)
[INFO]   Rounded: (35, 75)
[INFO]   Nearest: (34.0, 74.0)
[INFO]   Rounded: (234, 249)
[INFO]   Nearest: (234.0, 248.0)
[INFO]   Rounded: (33, 105)
[INFO]   Nearest: (32.0, 106.0)
[INFO]   Rounded: (15, 229)
[INFO]   Nearest: (14.0, 230.0)
[INFO]   Rounded: (219, 286)
[INFO]   Nearest: (220.0, 286.0)
[INFO]   Rounded: (19, 32)
[INFO]   Nearest: (18.0, 32.0)
[INFO]   Rounded: (97, 220)
[INFO]   Nearest: (96.0, 220.0)
[INFO]   Rounded: (236, 267)
[INFO]   Nearest: (236.0, 266.0)
[INFO]   Rounded: (17, 184)
[INFO]   Nearest: (18.0, 184.0)
[INFO]   Rounded: (32, 224)
[INFO]   Rounded: (114, 279)
[INFO]   Nearest: (114.0, 278.0)
[INFO]   Rounded: (194, 220)
[INFO]   Rounded: (32, 198)
[INFO]   Rounded: (17, 39)
[INFO]   Nearest: (16.0, 40.0)
[INFO]   Rounded: (67, 105)
[INFO]   Nearest: (68.0, 104.0)
[INFO]   Rounded: (51, 282)
[INFO]   Nearest: (50.0, 282.0)
[INFO]   Rounded: (33, 254)
[INFO]   Nearest: (32.0, 254.0)
[INFO]   Rounded: (83, 184)
[INFO]   Nearest: (84.0, 184.0)
[INFO]   Rounded: (111, 169)
[INFO]   Nearest: (110.0, 168.0)
[INFO]   Rounded: (91, 154)
[INFO]   Nearest: (90.0, 154.0)
[INFO]   Rounded: (165, 209)
[INFO]   Nearest: (166.0, 210.0)
[INFO]   Rounded: (19, 97)
[INFO]   Nearest: (20.0, 98.0)
[INFO]   Rounded: (123, 193)
[INFO]   Nearest: (122.0, 194.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 202, Long SMA: 204
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(92/262) - Original Sharpe: 0.8236, Trades: 12
[INFO] Kmeans cluster 2: SMA(34/50) - Original Sharpe: 0.8119, Trades: 58
[INFO] Kmeans cluster 3: SMA(232/246) - Original Sharpe: 0.7615, Trades: 35
[INFO] Kmeans cluster 4: SMA(194/220) - Original Sharpe: 0.7209, Trades: 21
[INFO] Kmeans cluster 5: SMA(178/258) - Original Sharpe: 0.6651, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (202/204)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (92/262) - Sharpe: 0.8236
[INFO] cluster 2: (34/50) - Sharpe: 0.8119
[INFO] cluster 3: (232/246) - Sharpe: 0.7615
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.966360            0.117695
1    2021-11-14 2021-11-14            43     0.592419           -0.313086
2    2022-01-14 2022-01-14            41    -1.051138            0.972663
3    2022-03-14 2022-03-14            44    -3.278609           -0.322863
4    2022-05-14 2022-05-14            43    -4.117036            0.094696
5    2022-07-14 2022-07-14            44    -0.204524           -1.794699
6    2022-09-14 2022-09-14            43    -1.944732           -2.592570
7    2022-11-14 2022-11-14            43    -1.875063           -0.416868
8    2023-01-14 2023-01-14            41     1.193934            1.185891
9    2023-03-14 2023-03-14            43    -3.970882            2.711385
10   2023-05-14 2023-05-14            44     1.555819            3.355478
11   2023-07-14 2023-07-14            44    -2.334756           -1.986261
12   2023-09-14 2023-09-14            43    -2.853678            0.948764
13   2023-11-14 2023-11-14            42    -0.420702            1.202123
14   2024-01-14 2024-01-14            43     0.886191           -3.325021
15   2024-03-14 2024-03-14            42    -0.888819            4.259659
16   2024-05-14 2024-05-14            44    -3.242588           -1.180241
17   2024-07-14 2024-07-14            45    -2.418088           -2.418088
18   2024-09-14 2024-09-14            43    -0.682782           -1.759809
19   2024-11-14 2024-11-14            33    -1.722392            3.817042
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              0.1 |         -0.9 | False         
[INFO] 2021-11-14   |          0.6 |             -0.3 |         -0.9 | False         
[INFO] 2022-01-14   |         -1.1 |              1.0 |          2.1 | True          
[INFO] 2022-03-14   |         -3.3 |             -0.3 |          3.0 | True          
[INFO] 2022-05-14   |         -4.1 |              0.1 |          4.2 | True          
[INFO] 2022-07-14   |         -0.2 |             -1.8 |         -1.6 | False         
[INFO] 2022-09-14   |         -1.9 |             -2.6 |         -0.7 | False         
[INFO] 2022-11-14   |         -1.9 |             -0.4 |          1.5 | True          
[INFO] 2023-01-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -4.0 |              2.7 |          6.7 | True          
[INFO] 2023-05-14   |          1.6 |              3.4 |          1.8 | True          
[INFO] 2023-07-14   |         -2.3 |             -2.0 |          0.3 | True          
[INFO] 2023-09-14   |         -2.9 |              0.9 |          3.8 | True          
[INFO] 2023-11-14   |         -0.4 |              1.2 |          1.6 | True          
[INFO] 2024-01-14   |          0.9 |             -3.3 |         -4.2 | False         
[INFO] 2024-03-14   |         -0.9 |              4.3 |          5.2 | True          
[INFO] 2024-05-14   |         -3.2 |             -1.2 |          2.0 | True          
[INFO] 2024-07-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -0.7 |             -1.8 |         -1.1 | False         
[INFO] 2024-11-14   |         -1.7 |              3.8 |          5.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-01-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 12 of 18 periods (66.67% win rate)
[INFO] Updating Excel file with Kmeans results for HG...
[INFO] Excel file updated successfully. Added HG with Kmeans win rate 66.7% in row 24
[INFO] Added best Sharpe parameters 202/204 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 202, Long SMA: 204
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(92/262) - Original Sharpe: 0.8236
[INFO] Added cluster 2 to portfolio: SMA(34/50) - Original Sharpe: 0.8119
[INFO] Added cluster 3 to portfolio: SMA(232/246) - Original Sharpe: 0.7615
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HG_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.2777
[INFO] Kmeans Best out-of-sample Sharpe: -1.3121
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for HG...
[INFO] Excel file updated successfully. Added HG with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HG
[INFO] Big Point Value: 25000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7723 to 0.9576
[INFO] 
Best parameters:
[INFO] Short SMA: 202
[INFO] Long SMA: 204
[INFO] Sharpe Ratio: 0.957606
[INFO] Number of Trades: 77
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9787 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7723 to 0.9576
[INFO] Trades range: 10.0 to 363.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3319 to 2.7995
[INFO] Scaled Long SMA range: -2.7689 to 1.5355
[INFO] Scaled Sharpe ratio range: -2.9750 to 2.2590
[INFO] Scaled Trades range: -0.8737 to 15.7098
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9787 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4944
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 418 elements
[INFO] Cluster 1: 402 elements
[INFO] Cluster 2: 199 elements
[INFO] Cluster 3: 147 elements
[INFO] Cluster 4: 366 elements
[INFO] Cluster 5: 86 elements
[INFO] Cluster 6: 413 elements
[INFO] Cluster 7: 229 elements
[INFO] Cluster 8: 355 elements
[INFO] Cluster 9: 152 elements
[INFO] Cluster 10: 172 elements
[INFO] Cluster 11: 141 elements
[INFO] Cluster 12: 397 elements
[INFO] Cluster 13: 130 elements
[INFO] Cluster 14: 80 elements
[INFO] Cluster 15: 324 elements
[INFO] Cluster 16: 404 elements
[INFO] Cluster 17: 73 elements
[INFO] Cluster 18: 230 elements
[INFO] Cluster 19: 272 elements
[INFO] Cluster 20: 31 elements
[INFO] Cluster 21: 36 elements
[INFO] Cluster 22: 31 elements
[INFO] Cluster 23: 87 elements
[INFO] Cluster 24: 252 elements
[INFO] Cluster 25: 14 elements
[INFO] Cluster 26: 180 elements
[INFO] Cluster 27: 123 elements
[INFO] Cluster 28: 282 elements
[INFO] Cluster 29: 317 elements
[INFO] Cluster 30: 219 elements
[INFO] Cluster 31: 203 elements
[INFO] Cluster 32: 203 elements
[INFO] Cluster 33: 295 elements
[INFO] Cluster 34: 318 elements
[INFO] Cluster 35: 445 elements
[INFO] Cluster 36: 126 elements
[INFO] Cluster 37: 3 elements
[INFO] Cluster 38: 277 elements
[INFO] Cluster 39: 190 elements
[INFO] Cluster 40: 28 elements
[INFO] Cluster 41: 266 elements
[INFO] Cluster 42: 109 elements
[INFO] Cluster 43: 205 elements
[INFO] Cluster 44: 128 elements
[INFO] Cluster 45: 44 elements
[INFO] Cluster 46: 12 elements
[INFO] Cluster 47: 205 elements
[INFO] Cluster 48: 11 elements
[INFO] Cluster 49: 157 elements
[INFO] Using 46 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=92, Long SMA=216, Sharpe=0.2735, Trades=18
[INFO] Cluster 1 cluster: Short SMA=72, Long SMA=128, Sharpe=-0.3308, Trades=28
[INFO] Cluster 2 cluster: Short SMA=26, Long SMA=92, Sharpe=0.0486, Trades=46
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=56, Sharpe=0.5807, Trades=56
[INFO] Cluster 4 cluster: Short SMA=182, Long SMA=248, Sharpe=0.7270, Trades=15
[INFO] Cluster 5 cluster: Short SMA=224, Long SMA=228, Sharpe=0.4556, Trades=57
[INFO] Cluster 6 cluster: Short SMA=116, Long SMA=260, Sharpe=0.6526, Trades=10
[INFO] Cluster 7 cluster: Short SMA=220, Long SMA=236, Sharpe=0.5588, Trades=33
[INFO] Cluster 8 cluster: Short SMA=60, Long SMA=278, Sharpe=0.2600, Trades=14
[INFO] Cluster 9 cluster: Short SMA=274, Long SMA=288, Sharpe=0.2364, Trades=25
[INFO] Cluster 10 cluster: Short SMA=166, Long SMA=208, Sharpe=0.2265, Trades=22
[INFO] Cluster 11 cluster: Short SMA=108, Long SMA=120, Sharpe=0.0031, Trades=45
[INFO] Cluster 12 cluster: Short SMA=212, Long SMA=258, Sharpe=0.4925, Trades=17
[INFO] Cluster 13 cluster: Short SMA=70, Long SMA=96, Sharpe=-0.4096, Trades=41
[INFO] Cluster 14 cluster: Short SMA=22, Long SMA=40, Sharpe=-0.1644, Trades=89
[INFO] Cluster 15 cluster: Short SMA=118, Long SMA=190, Sharpe=-0.0423, Trades=21
[INFO] Cluster 16 cluster: Short SMA=26, Long SMA=278, Sharpe=0.4081, Trades=18
[INFO] Cluster 17 cluster: Short SMA=160, Long SMA=164, Sharpe=-0.1321, Trades=78
[INFO] Cluster 18 cluster: Short SMA=22, Long SMA=226, Sharpe=0.3623, Trades=26
[INFO] Cluster 19 cluster: Short SMA=30, Long SMA=80, Sharpe=0.2749, Trades=42
[INFO] Cluster 20 cluster: Short SMA=22, Long SMA=30, Sharpe=-0.6297, Trades=121
[INFO] Cluster 21 cluster: Short SMA=94, Long SMA=96, Sharpe=-0.1141, Trades=107
[INFO] Cluster 22 cluster: Short SMA=42, Long SMA=44, Sharpe=0.5555, Trades=160
[INFO] Cluster 23 cluster: Short SMA=48, Long SMA=60, Sharpe=0.1424, Trades=62
[INFO] Cluster 24 cluster: Short SMA=30, Long SMA=134, Sharpe=0.1998, Trades=29
[INFO] Cluster 26 cluster: Short SMA=58, Long SMA=200, Sharpe=-0.0124, Trades=20
[INFO] Cluster 27 cluster: Short SMA=168, Long SMA=184, Sharpe=0.1947, Trades=37
[INFO] Cluster 28 cluster: Short SMA=62, Long SMA=176, Sharpe=-0.3288, Trades=25
[INFO] Cluster 29 cluster: Short SMA=116, Long SMA=154, Sharpe=-0.0355, Trades=29
[INFO] Cluster 30 cluster: Short SMA=26, Long SMA=182, Sharpe=0.0824, Trades=33
[INFO] Cluster 31 cluster: Short SMA=78, Long SMA=242, Sharpe=0.6538, Trades=14
[INFO] Cluster 32 cluster: Short SMA=30, Long SMA=222, Sharpe=0.4704, Trades=24
[INFO] Cluster 33 cluster: Short SMA=62, Long SMA=138, Sharpe=-0.6059, Trades=27
[INFO] Cluster 34 cluster: Short SMA=222, Long SMA=282, Sharpe=0.4359, Trades=15
[INFO] Cluster 35 cluster: Short SMA=154, Long SMA=234, Sharpe=0.5322, Trades=16
[INFO] Cluster 36 cluster: Short SMA=32, Long SMA=106, Sharpe=0.5127, Trades=34
[INFO] Cluster 38 cluster: Short SMA=146, Long SMA=200, Sharpe=0.0235, Trades=20
[INFO] Cluster 39 cluster: Short SMA=14, Long SMA=156, Sharpe=-0.1318, Trades=43
[INFO] Cluster 40 cluster: Short SMA=280, Long SMA=282, Sharpe=0.2216, Trades=59
[INFO] Cluster 41 cluster: Short SMA=92, Long SMA=262, Sharpe=0.8236, Trades=12
[INFO] Cluster 42 cluster: Short SMA=152, Long SMA=166, Sharpe=-0.2394, Trades=48
[INFO] Cluster 43 cluster: Short SMA=52, Long SMA=232, Sharpe=0.1365, Trades=20
[INFO] Cluster 44 cluster: Short SMA=108, Long SMA=170, Sharpe=-0.4139, Trades=23
[INFO] Cluster 45 cluster: Short SMA=104, Long SMA=110, Sharpe=0.1902, Trades=70
[INFO] Cluster 47 cluster: Short SMA=94, Long SMA=148, Sharpe=-0.0055, Trades=23
[INFO] Cluster 49 cluster: Short SMA=254, Long SMA=288, Sharpe=0.1882, Trades=15
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=202, Long SMA=204, Sharpe=0.9576, Trades=77
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=92, Long SMA=262, Sharpe=0.8236, Trades=12
[INFO] Top 2: Short SMA=182, Long SMA=248, Sharpe=0.7270, Trades=15
[INFO] Top 3: Short SMA=78, Long SMA=242, Sharpe=0.6538, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 46 valid clusters with clusters
[INFO] Filtering to 9747 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 202, Long SMA: 204
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(92/262) - Original Sharpe: 0.8236, Trades: 12
[INFO] Hierarchical cluster 2: SMA(182/248) - Original Sharpe: 0.7270, Trades: 15
[INFO] Hierarchical cluster 3: SMA(78/242) - Original Sharpe: 0.6538, Trades: 14
[INFO] Hierarchical cluster 4: SMA(116/260) - Original Sharpe: 0.6526, Trades: 10
[INFO] Hierarchical cluster 5: SMA(34/56) - Original Sharpe: 0.5807, Trades: 56
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (202/204)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (92/262) - Sharpe: 0.8236
[INFO] cluster 2: (182/248) - Sharpe: 0.7270
[INFO] cluster 3: (78/242) - Sharpe: 0.6538
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.966360            0.966360
1    2021-11-14 2021-11-14            43     0.592419            0.592419
2    2022-01-14 2022-01-14            41    -1.051138            0.063782
3    2022-03-14 2022-03-14            44    -3.278609           -3.464352
4    2022-05-14 2022-05-14            43    -4.117036           -2.663939
5    2022-07-14 2022-07-14            44    -0.204524           -0.976006
6    2022-09-14 2022-09-14            43    -1.944732           -1.944732
7    2022-11-14 2022-11-14            43    -1.875063           -1.875063
8    2023-01-14 2023-01-14            41     1.193934            0.560851
9    2023-03-14 2023-03-14            43    -3.970882           -2.586256
10   2023-05-14 2023-05-14            44     1.555819            1.555819
11   2023-07-14 2023-07-14            44    -2.334756           -1.642700
12   2023-09-14 2023-09-14            43    -2.853678           -0.408483
13   2023-11-14 2023-11-14            42    -0.420702           -0.420702
14   2024-01-14 2024-01-14            43     0.886191           -2.896531
15   2024-03-14 2024-03-14            42    -0.888819            2.965624
16   2024-05-14 2024-05-14            44    -3.242588            0.187921
17   2024-07-14 2024-07-14            45    -2.418088           -2.418088
18   2024-09-14 2024-09-14            43    -0.682782           -0.682782
19   2024-11-14 2024-11-14            33    -1.722392            2.780768
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -1.1 |              0.1 |          1.2 | True          
[INFO] 2022-03-14   |         -3.3 |             -3.5 |         -0.2 | False         
[INFO] 2022-05-14   |         -4.1 |             -2.7 |          1.4 | True          
[INFO] 2022-07-14   |         -0.2 |             -1.0 |         -0.8 | False         
[INFO] 2022-09-14   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.2 |              0.6 |         -0.6 | False         
[INFO] 2023-03-14   |         -4.0 |             -2.6 |          1.4 | True          
[INFO] 2023-05-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -2.3 |             -1.6 |          0.7 | True          
[INFO] 2023-09-14   |         -2.9 |             -0.4 |          2.5 | True          
[INFO] 2023-11-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          0.9 |             -2.9 |         -3.8 | False         
[INFO] 2024-03-14   |         -0.9 |              3.0 |          3.9 | True          
[INFO] 2024-05-14   |         -3.2 |              0.2 |          3.4 | True          
[INFO] 2024-07-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.7 |              2.8 |          4.5 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-09-14, 2022-11-14, 2023-05-14, 2023-11-14, 2024-07-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 12 periods (66.67% win rate)
[INFO] Updating Excel file with Hierarchical results for HG...
[INFO] Excel file updated successfully. Added HG with Hierarchical win rate 66.7% in row 24
[INFO] Added best Sharpe parameters 202/204 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 202, Long SMA: 204
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(92/262) - Original Sharpe: 0.8236
[INFO] Added cluster 2 to portfolio: SMA(182/248) - Original Sharpe: 0.7270
[INFO] Added cluster 3 to portfolio: SMA(78/242) - Original Sharpe: 0.6538
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HG_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.7783
[INFO] Hierarchical Best out-of-sample Sharpe: -1.3121
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for HG...
[INFO] Excel file updated successfully. Added HG with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HG
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for HO in column D: 25.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 114.30s
[INFO] Best parameters: Short SMA = 22, Long SMA = 28
[INFO] Best Sharpe ratio: 0.889954, Trades: 121
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @HO
[INFO] Big Point Value (from data): 42000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.17 contracts
[INFO] Maximum Position Size: 5 contracts
[INFO] Strategy Total P&L: $583,218.00
[INFO] Market Buy & Hold P&L: $86,142.00
[INFO] Outperformance: $497,076.00
[INFO] Sharpe ratio (entire period, annualized): 0.710110
[INFO] Sharpe ratio (in-sample, annualized): 0.889954
[INFO] Sharpe ratio (out-of-sample, annualized): 0.345997
[INFO] Maximum Drawdown: $227,841.80
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 80
[INFO] Out-of-sample period trades: 41
[INFO] Total trades: 121
[INFO] In-sample P&L: $523,733.40
[INFO] Out-of-sample P&L: $99,514.60
[INFO] 
Best parameters from GA: Short SMA = 22, Long SMA = 28, Sharpe = 0.889954
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7969 to 0.8900
[INFO] 
Best parameters:
[INFO] Short SMA: 22
[INFO] Long SMA: 28
[INFO] Sharpe Ratio: 0.889954
[INFO] Number of Trades: 121
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10027 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7969 to 0.8900
[INFO] Trades range: 10.0 to 331.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3615 to 2.7312
[INFO] Scaled Long SMA range: -2.7206 to 1.4041
[INFO] Scaled Sharpe ratio range: -4.1113 to 3.2767
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 151 elements
[INFO] Kmeans Cluster 1: 175 elements
[INFO] Kmeans Cluster 2: 208 elements
[INFO] Kmeans Cluster 3: 178 elements
[INFO] Kmeans Cluster 4: 226 elements
[INFO] Kmeans Cluster 5: 191 elements
[INFO] Kmeans Cluster 6: 142 elements
[INFO] Kmeans Cluster 7: 143 elements
[INFO] Kmeans Cluster 8: 230 elements
[INFO] Kmeans Cluster 9: 190 elements
[INFO] Kmeans Cluster 10: 235 elements
[INFO] Kmeans Cluster 11: 156 elements
[INFO] Kmeans Cluster 12: 195 elements
[INFO] Kmeans Cluster 13: 191 elements
[INFO] Kmeans Cluster 14: 303 elements
[INFO] Kmeans Cluster 15: 150 elements
[INFO] Kmeans Cluster 16: 183 elements
[INFO] Kmeans Cluster 17: 292 elements
[INFO] Kmeans Cluster 18: 291 elements
[INFO] Kmeans Cluster 19: 198 elements
[INFO] Kmeans Cluster 20: 234 elements
[INFO] Kmeans Cluster 21: 316 elements
[INFO] Kmeans Cluster 22: 204 elements
[INFO] Kmeans Cluster 23: 196 elements
[INFO] Kmeans Cluster 24: 221 elements
[INFO] Kmeans Cluster 25: 201 elements
[INFO] Kmeans Cluster 26: 139 elements
[INFO] Kmeans Cluster 27: 233 elements
[INFO] Kmeans Cluster 28: 240 elements
[INFO] Kmeans Cluster 29: 246 elements
[INFO] Kmeans Cluster 30: 210 elements
[INFO] Kmeans Cluster 31: 163 elements
[INFO] Kmeans Cluster 32: 207 elements
[INFO] Kmeans Cluster 33: 149 elements
[INFO] Kmeans Cluster 34: 37 elements
[INFO] Kmeans Cluster 35: 203 elements
[INFO] Kmeans Cluster 36: 211 elements
[INFO] Kmeans Cluster 37: 182 elements
[INFO] Kmeans Cluster 38: 272 elements
[INFO] Kmeans Cluster 39: 115 elements
[INFO] Kmeans Cluster 40: 212 elements
[INFO] Kmeans Cluster 41: 303 elements
[INFO] Kmeans Cluster 42: 264 elements
[INFO] Kmeans Cluster 43: 187 elements
[INFO] Kmeans Cluster 44: 142 elements
[INFO] Kmeans Cluster 45: 131 elements
[INFO] Kmeans Cluster 46: 198 elements
[INFO] Kmeans Cluster 47: 166 elements
[INFO] Kmeans Cluster 48: 268 elements
[INFO] Kmeans Cluster 49: 149 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=143.96, Long SMA=293.06, Sharpe=-0.0645
[INFO] Centroid 1: Short SMA=142.56, Long SMA=178.01, Sharpe=0.4597
[INFO] Centroid 2: Short SMA=27.39, Long SMA=86.17, Sharpe=0.0651
[INFO] Centroid 3: Short SMA=68.95, Long SMA=212.57, Sharpe=0.2488
[INFO] Centroid 4: Short SMA=256.88, Long SMA=276.42, Sharpe=-0.3605
[INFO] Centroid 5: Short SMA=22.59, Long SMA=50.21, Sharpe=0.2946
[INFO] Centroid 6: Short SMA=194.38, Long SMA=235.52, Sharpe=0.0549
[INFO] Centroid 7: Short SMA=67.78, Long SMA=145.08, Sharpe=0.1067
[INFO] Centroid 8: Short SMA=218.42, Long SMA=285.37, Sharpe=-0.1242
[INFO] Centroid 9: Short SMA=127.60, Long SMA=272.98, Sharpe=0.1968
[INFO] Centroid 10: Short SMA=45.07, Long SMA=184.66, Sharpe=0.1965
[INFO] Centroid 11: Short SMA=80.63, Long SMA=170.96, Sharpe=-0.0497
[INFO] Centroid 12: Short SMA=171.62, Long SMA=209.90, Sharpe=0.3702
[INFO] Centroid 13: Short SMA=64.04, Long SMA=278.81, Sharpe=0.0807
[INFO] Centroid 14: Short SMA=24.55, Long SMA=230.64, Sharpe=0.2875
[INFO] Centroid 15: Short SMA=72.95, Long SMA=97.31, Sharpe=0.0691
[INFO] Centroid 16: Short SMA=124.08, Long SMA=152.18, Sharpe=0.2422
[INFO] Centroid 17: Short SMA=177.21, Long SMA=284.23, Sharpe=0.0253
[INFO] Centroid 18: Short SMA=74.37, Long SMA=190.29, Sharpe=0.1066
[INFO] Centroid 19: Short SMA=41.14, Long SMA=75.91, Sharpe=0.1940
[INFO] Centroid 20: Short SMA=44.81, Long SMA=229.92, Sharpe=0.4050
[INFO] Centroid 21: Short SMA=38.54, Long SMA=154.97, Sharpe=0.2848
[INFO] Centroid 22: Short SMA=154.80, Long SMA=199.64, Sharpe=0.2994
[INFO] Centroid 23: Short SMA=74.94, Long SMA=245.97, Sharpe=0.3187
[INFO] Centroid 24: Short SMA=98.48, Long SMA=122.62, Sharpe=-0.1043
[INFO] Centroid 25: Short SMA=113.22, Long SMA=207.31, Sharpe=0.4414
[INFO] Centroid 26: Short SMA=151.29, Long SMA=176.56, Sharpe=0.6211
[INFO] Centroid 27: Short SMA=19.61, Long SMA=185.18, Sharpe=0.3689
[INFO] Centroid 28: Short SMA=181.70, Long SMA=260.00, Sharpe=0.1598
[INFO] Centroid 29: Short SMA=191.59, Long SMA=212.46, Sharpe=0.2081
[INFO] Centroid 30: Short SMA=112.32, Long SMA=187.85, Sharpe=0.3329
[INFO] Centroid 31: Short SMA=115.79, Long SMA=288.01, Sharpe=0.0613
[INFO] Centroid 32: Short SMA=75.69, Long SMA=292.30, Sharpe=-0.0305
[INFO] Centroid 33: Short SMA=55.17, Long SMA=94.34, Sharpe=0.3256
[INFO] Centroid 34: Short SMA=25.35, Long SMA=38.22, Sharpe=0.6420
[INFO] Centroid 35: Short SMA=123.51, Long SMA=149.77, Sharpe=0.0817
[INFO] Centroid 36: Short SMA=64.29, Long SMA=125.55, Sharpe=-0.0373
[INFO] Centroid 37: Short SMA=140.59, Long SMA=228.96, Sharpe=0.2164
[INFO] Centroid 38: Short SMA=227.73, Long SMA=275.97, Sharpe=-0.2533
[INFO] Centroid 39: Short SMA=63.95, Long SMA=90.71, Sharpe=-0.1446
[INFO] Centroid 40: Short SMA=31.30, Long SMA=125.53, Sharpe=0.1461
[INFO] Centroid 41: Short SMA=28.80, Long SMA=268.15, Sharpe=0.3978
[INFO] Centroid 42: Short SMA=220.92, Long SMA=244.34, Sharpe=-0.1529
[INFO] Centroid 43: Short SMA=92.19, Long SMA=138.95, Sharpe=-0.2500
[INFO] Centroid 44: Short SMA=24.04, Long SMA=50.00, Sharpe=0.4281
[INFO] Centroid 45: Short SMA=17.08, Long SMA=124.41, Sharpe=-0.0243
[INFO] Centroid 46: Short SMA=78.48, Long SMA=264.04, Sharpe=0.1868
[INFO] Centroid 47: Short SMA=27.41, Long SMA=287.77, Sharpe=0.2278
[INFO] Centroid 48: Short SMA=160.93, Long SMA=245.60, Sharpe=0.3009
[INFO] Centroid 49: Short SMA=271.41, Long SMA=291.03, Sharpe=-0.5363
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=22, Long SMA=28, Sharpe=0.8900, Trades=121
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=152, Long SMA=176, Sharpe=0.5859, Trades=25
[INFO] Kmeans Top 2: Short SMA=24, Long SMA=40, Sharpe=0.5419, Trades=75
[INFO] Kmeans Top 3: Short SMA=22, Long SMA=50, Sharpe=0.5260, Trades=59
[INFO] Kmeans Top 4: Short SMA=140, Long SMA=178, Sharpe=0.4759, Trades=21
[INFO] Kmeans Top 5: Short SMA=46, Long SMA=230, Sharpe=0.4454, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (144, 293)
[INFO]   Nearest: (144.0, 294.0)
[INFO]   Rounded: (143, 178)
[INFO]   Nearest: (142.0, 178.0)
[INFO]   Rounded: (27, 86)
[INFO]   Nearest: (28.0, 86.0)
[INFO]   Rounded: (69, 213)
[INFO]   Nearest: (68.0, 212.0)
[INFO]   Rounded: (257, 276)
[INFO]   Nearest: (256.0, 276.0)
[INFO]   Rounded: (23, 50)
[INFO]   Nearest: (22.0, 50.0)
[INFO]   Rounded: (194, 236)
[INFO]   Rounded: (68, 145)
[INFO]   Nearest: (68.0, 146.0)
[INFO]   Rounded: (218, 285)
[INFO]   Nearest: (218.0, 286.0)
[INFO]   Rounded: (128, 273)
[INFO]   Nearest: (128.0, 272.0)
[INFO]   Rounded: (45, 185)
[INFO]   Nearest: (46.0, 184.0)
[INFO]   Rounded: (81, 171)
[INFO]   Nearest: (80.0, 170.0)
[INFO]   Rounded: (172, 210)
[INFO]   Rounded: (64, 279)
[INFO]   Nearest: (64.0, 278.0)
[INFO]   Rounded: (25, 231)
[INFO]   Nearest: (24.0, 230.0)
[INFO]   Rounded: (73, 97)
[INFO]   Nearest: (72.0, 98.0)
[INFO]   Rounded: (124, 152)
[INFO]   Rounded: (177, 284)
[INFO]   Nearest: (178.0, 284.0)
[INFO]   Rounded: (74, 190)
[INFO]   Rounded: (41, 76)
[INFO]   Nearest: (42.0, 76.0)
[INFO]   Rounded: (45, 230)
[INFO]   Nearest: (44.0, 230.0)
[INFO]   Rounded: (39, 155)
[INFO]   Nearest: (38.0, 154.0)
[INFO]   Rounded: (155, 200)
[INFO]   Nearest: (154.0, 200.0)
[INFO]   Rounded: (75, 246)
[INFO]   Nearest: (74.0, 246.0)
[INFO]   Rounded: (98, 123)
[INFO]   Nearest: (98.0, 122.0)
[INFO]   Rounded: (113, 207)
[INFO]   Nearest: (114.0, 208.0)
[INFO]   Rounded: (151, 177)
[INFO]   Nearest: (152.0, 176.0)
[INFO]   Rounded: (20, 185)
[INFO]   Nearest: (20.0, 186.0)
[INFO]   Rounded: (182, 260)
[INFO]   Rounded: (192, 212)
[INFO]   Rounded: (112, 188)
[INFO]   Rounded: (116, 288)
[INFO]   Rounded: (76, 292)
[INFO]   Rounded: (55, 94)
[INFO]   Nearest: (56.0, 94.0)
[INFO]   Rounded: (25, 38)
[INFO]   Nearest: (26.0, 38.0)
[INFO]   Rounded: (124, 150)
[INFO]   Rounded: (64, 126)
[INFO]   Rounded: (141, 229)
[INFO]   Nearest: (140.0, 228.0)
[INFO]   Rounded: (228, 276)
[INFO]   Rounded: (64, 91)
[INFO]   Nearest: (64.0, 90.0)
[INFO]   Rounded: (31, 126)
[INFO]   Nearest: (32.0, 126.0)
[INFO]   Rounded: (29, 268)
[INFO]   Nearest: (28.0, 268.0)
[INFO]   Rounded: (221, 244)
[INFO]   Nearest: (220.0, 244.0)
[INFO]   Rounded: (92, 139)
[INFO]   Nearest: (92.0, 138.0)
[INFO]   Rounded: (24, 50)
[INFO]   Rounded: (17, 124)
[INFO]   Nearest: (18.0, 124.0)
[INFO]   Rounded: (78, 264)
[INFO]   Rounded: (27, 288)
[INFO]   Nearest: (28.0, 288.0)
[INFO]   Rounded: (161, 246)
[INFO]   Nearest: (160.0, 246.0)
[INFO]   Rounded: (271, 291)
[INFO]   Nearest: (272.0, 292.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 22, Long SMA: 28
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(152/176) - Original Sharpe: 0.5859, Trades: 25
[INFO] Kmeans cluster 2: SMA(24/40) - Original Sharpe: 0.5419, Trades: 75
[INFO] Kmeans cluster 3: SMA(22/50) - Original Sharpe: 0.5260, Trades: 59
[INFO] Kmeans cluster 4: SMA(140/178) - Original Sharpe: 0.4759, Trades: 21
[INFO] Kmeans cluster 5: SMA(46/230) - Original Sharpe: 0.4454, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (22/28)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (152/176) - Sharpe: 0.5859
[INFO] cluster 2: (24/40) - Sharpe: 0.5419
[INFO] cluster 3: (22/50) - Sharpe: 0.5260
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     2.591859            2.281981
1    2021-11-14 2021-11-14            43     2.356142           -1.485220
2    2022-01-14 2022-01-14            41     3.996440            3.996440
3    2022-03-14 2022-03-14            44     1.386441            3.521776
4    2022-05-14 2022-05-14            43    -1.122388           -0.011332
5    2022-07-14 2022-07-14            44    -2.969387           -3.582864
6    2022-09-14 2022-09-14            43    -2.635788           -1.479767
7    2022-11-14 2022-11-14            43     0.035722           -3.821454
8    2023-01-14 2023-01-14            41     0.459261           -3.258464
9    2023-03-14 2023-03-14            43    -2.585156            2.585185
10   2023-05-14 2023-05-14            44     1.833453           -0.557806
11   2023-07-14 2023-07-14            44     5.432989            5.432989
12   2023-09-14 2023-09-14            43    -0.091949           -0.697090
13   2023-11-14 2023-11-14            42     0.208767            0.526956
14   2024-01-14 2024-01-14            43    -1.397108           -0.188941
15   2024-03-14 2024-03-14            42    -3.827908            3.958143
16   2024-05-14 2024-05-14            44    -2.752596           -2.231596
17   2024-07-14 2024-07-14            45     2.695689            1.428125
18   2024-09-14 2024-09-14            43    -2.556363           -0.819701
19   2024-11-14 2024-11-14            33    -4.535438           -2.757617
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          2.6 |              2.3 |         -0.3 | False         
[INFO] 2021-11-14   |          2.4 |             -1.5 |         -3.9 | False         
[INFO] 2022-01-14   |          4.0 |              4.0 |          0.0 | Excluded      
[INFO] 2022-03-14   |          1.4 |              3.5 |          2.1 | True          
[INFO] 2022-05-14   |         -1.1 |             -0.0 |          1.1 | True          
[INFO] 2022-07-14   |         -3.0 |             -3.6 |         -0.6 | False         
[INFO] 2022-09-14   |         -2.6 |             -1.5 |          1.1 | True          
[INFO] 2022-11-14   |          0.0 |             -3.8 |         -3.8 | False         
[INFO] 2023-01-14   |          0.5 |             -3.3 |         -3.8 | False         
[INFO] 2023-03-14   |         -2.6 |              2.6 |          5.2 | True          
[INFO] 2023-05-14   |          1.8 |             -0.6 |         -2.4 | False         
[INFO] 2023-07-14   |          5.4 |              5.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -0.1 |             -0.7 |         -0.6 | False         
[INFO] 2023-11-14   |          0.2 |              0.5 |          0.3 | True          
[INFO] 2024-01-14   |         -1.4 |             -0.2 |          1.2 | True          
[INFO] 2024-03-14   |         -3.8 |              4.0 |          7.8 | True          
[INFO] 2024-05-14   |         -2.8 |             -2.2 |          0.6 | True          
[INFO] 2024-07-14   |          2.7 |              1.4 |         -1.3 | False         
[INFO] 2024-09-14   |         -2.6 |             -0.8 |          1.8 | True          
[INFO] 2024-11-14   |         -4.5 |             -2.8 |          1.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14, 2023-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 10 of 18 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for HO...
[INFO] Excel file updated successfully. Added HO with Kmeans win rate 55.6% in row 25
[INFO] Added best Sharpe parameters 22/28 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 22, Long SMA: 28
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(152/176) - Original Sharpe: 0.5859
[INFO] Added cluster 2 to portfolio: SMA(24/40) - Original Sharpe: 0.5419
[INFO] Added cluster 3 to portfolio: SMA(22/50) - Original Sharpe: 0.5260
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HO_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.5903
[INFO] Kmeans Best out-of-sample Sharpe: 0.3460
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for HO...
[INFO] Excel file updated successfully. Added HO with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HO
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7969 to 0.8900
[INFO] 
Best parameters:
[INFO] Short SMA: 22
[INFO] Long SMA: 28
[INFO] Sharpe Ratio: 0.889954
[INFO] Number of Trades: 121
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10027 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7969 to 0.8900
[INFO] Trades range: 10.0 to 331.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3615 to 2.7312
[INFO] Scaled Long SMA range: -2.7206 to 1.4041
[INFO] Scaled Sharpe ratio range: -4.1113 to 3.2767
[INFO] Scaled Trades range: -0.7449 to 16.2358
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10027 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5757
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 302 elements
[INFO] Cluster 1: 143 elements
[INFO] Cluster 2: 410 elements
[INFO] Cluster 3: 68 elements
[INFO] Cluster 4: 289 elements
[INFO] Cluster 5: 307 elements
[INFO] Cluster 6: 347 elements
[INFO] Cluster 7: 541 elements
[INFO] Cluster 8: 267 elements
[INFO] Cluster 9: 61 elements
[INFO] Cluster 10: 99 elements
[INFO] Cluster 11: 327 elements
[INFO] Cluster 12: 225 elements
[INFO] Cluster 13: 430 elements
[INFO] Cluster 14: 380 elements
[INFO] Cluster 15: 24 elements
[INFO] Cluster 16: 259 elements
[INFO] Cluster 17: 173 elements
[INFO] Cluster 18: 366 elements
[INFO] Cluster 19: 261 elements
[INFO] Cluster 20: 310 elements
[INFO] Cluster 21: 20 elements
[INFO] Cluster 22: 117 elements
[INFO] Cluster 23: 215 elements
[INFO] Cluster 24: 327 elements
[INFO] Cluster 25: 131 elements
[INFO] Cluster 26: 8 elements
[INFO] Cluster 27: 265 elements
[INFO] Cluster 28: 50 elements
[INFO] Cluster 29: 225 elements
[INFO] Cluster 30: 48 elements
[INFO] Cluster 31: 270 elements
[INFO] Cluster 32: 192 elements
[INFO] Cluster 33: 168 elements
[INFO] Cluster 34: 133 elements
[INFO] Cluster 35: 310 elements
[INFO] Cluster 36: 245 elements
[INFO] Cluster 37: 231 elements
[INFO] Cluster 38: 207 elements
[INFO] Cluster 39: 90 elements
[INFO] Cluster 40: 277 elements
[INFO] Cluster 41: 69 elements
[INFO] Cluster 42: 44 elements
[INFO] Cluster 43: 32 elements
[INFO] Cluster 44: 254 elements
[INFO] Cluster 45: 158 elements
[INFO] Cluster 46: 92 elements
[INFO] Cluster 47: 109 elements
[INFO] Cluster 48: 149 elements
[INFO] Cluster 49: 2 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=40, Long SMA=130, Sharpe=0.1646, Trades=28
[INFO] Cluster 1 cluster: Short SMA=270, Long SMA=276, Sharpe=-0.6122, Trades=36
[INFO] Cluster 2 cluster: Short SMA=68, Long SMA=230, Sharpe=0.2279, Trades=12
[INFO] Cluster 3 cluster: Short SMA=126, Long SMA=132, Sharpe=0.0847, Trades=67
[INFO] Cluster 4 cluster: Short SMA=192, Long SMA=212, Sharpe=0.2537, Trades=22
[INFO] Cluster 5 cluster: Short SMA=94, Long SMA=142, Sharpe=-0.2625, Trades=25
[INFO] Cluster 6 cluster: Short SMA=64, Long SMA=122, Sharpe=-0.0503, Trades=26
[INFO] Cluster 7 cluster: Short SMA=152, Long SMA=234, Sharpe=0.1638, Trades=11
[INFO] Cluster 8 cluster: Short SMA=124, Long SMA=154, Sharpe=0.1572, Trades=27
[INFO] Cluster 9 cluster: Short SMA=28, Long SMA=34, Sharpe=0.1916, Trades=107
[INFO] Cluster 10 cluster: Short SMA=42, Long SMA=66, Sharpe=0.0341, Trades=54
[INFO] Cluster 11 cluster: Short SMA=188, Long SMA=252, Sharpe=0.1548, Trades=18
[INFO] Cluster 12 cluster: Short SMA=22, Long SMA=104, Sharpe=-0.1021, Trades=41
[INFO] Cluster 13 cluster: Short SMA=40, Long SMA=254, Sharpe=0.3902, Trades=14
[INFO] Cluster 14 cluster: Short SMA=112, Long SMA=200, Sharpe=0.4476, Trades=13
[INFO] Cluster 15 cluster: Short SMA=24, Long SMA=30, Sharpe=0.6863, Trades=115
[INFO] Cluster 16 cluster: Short SMA=78, Long SMA=292, Sharpe=0.0038, Trades=12
[INFO] Cluster 17 cluster: Short SMA=28, Long SMA=52, Sharpe=0.3268, Trades=59
[INFO] Cluster 18 cluster: Short SMA=172, Long SMA=286, Sharpe=-0.0069, Trades=10
[INFO] Cluster 19 cluster: Short SMA=236, Long SMA=278, Sharpe=-0.3071, Trades=18
[INFO] Cluster 20 cluster: Short SMA=68, Long SMA=270, Sharpe=0.0885, Trades=12
[INFO] Cluster 21 cluster: Short SMA=20, Long SMA=24, Sharpe=0.0682, Trades=159
[INFO] Cluster 22 cluster: Short SMA=30, Long SMA=68, Sharpe=0.3070, Trades=47
[INFO] Cluster 23 cluster: Short SMA=126, Long SMA=292, Sharpe=0.0035, Trades=10
[INFO] Cluster 24 cluster: Short SMA=78, Long SMA=188, Sharpe=0.0945, Trades=15
[INFO] Cluster 25 cluster: Short SMA=104, Long SMA=124, Sharpe=-0.0973, Trades=36
[INFO] Cluster 27 cluster: Short SMA=126, Long SMA=272, Sharpe=0.1420, Trades=10
[INFO] Cluster 28 cluster: Short SMA=164, Long SMA=168, Sharpe=0.5808, Trades=47
[INFO] Cluster 29 cluster: Short SMA=28, Long SMA=288, Sharpe=0.3549, Trades=16
[INFO] Cluster 30 cluster: Short SMA=98, Long SMA=102, Sharpe=-0.0429, Trades=77
[INFO] Cluster 31 cluster: Short SMA=46, Long SMA=88, Sharpe=0.1721, Trades=35
[INFO] Cluster 32 cluster: Short SMA=262, Long SMA=288, Sharpe=-0.4345, Trades=22
[INFO] Cluster 33 cluster: Short SMA=20, Long SMA=202, Sharpe=0.4632, Trades=15
[INFO] Cluster 34 cluster: Short SMA=152, Long SMA=178, Sharpe=0.6182, Trades=25
[INFO] Cluster 35 cluster: Short SMA=220, Long SMA=250, Sharpe=-0.1696, Trades=22
[INFO] Cluster 36 cluster: Short SMA=20, Long SMA=236, Sharpe=0.3021, Trades=19
[INFO] Cluster 37 cluster: Short SMA=44, Long SMA=190, Sharpe=0.1762, Trades=15
[INFO] Cluster 38 cluster: Short SMA=218, Long SMA=288, Sharpe=-0.1592, Trades=16
[INFO] Cluster 39 cluster: Short SMA=42, Long SMA=112, Sharpe=0.3756, Trades=30
[INFO] Cluster 40 cluster: Short SMA=44, Long SMA=158, Sharpe=0.2869, Trades=18
[INFO] Cluster 41 cluster: Short SMA=20, Long SMA=38, Sharpe=0.2497, Trades=79
[INFO] Cluster 42 cluster: Short SMA=228, Long SMA=232, Sharpe=-0.2407, Trades=42
[INFO] Cluster 43 cluster: Short SMA=190, Long SMA=192, Sharpe=0.1161, Trades=51
[INFO] Cluster 44 cluster: Short SMA=162, Long SMA=198, Sharpe=0.2944, Trades=19
[INFO] Cluster 45 cluster: Short SMA=130, Long SMA=176, Sharpe=0.5134, Trades=23
[INFO] Cluster 46 cluster: Short SMA=92, Long SMA=104, Sharpe=-0.1007, Trades=48
[INFO] Cluster 47 cluster: Short SMA=74, Long SMA=174, Sharpe=-0.1523, Trades=17
[INFO] Cluster 48 cluster: Short SMA=18, Long SMA=168, Sharpe=0.3844, Trades=25
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=22, Long SMA=28, Sharpe=0.8900, Trades=121
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=24, Long SMA=30, Sharpe=0.6863, Trades=115
[INFO] Top 2: Short SMA=152, Long SMA=178, Sharpe=0.6182, Trades=25
[INFO] Top 3: Short SMA=164, Long SMA=168, Sharpe=0.5808, Trades=47
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10017 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 22, Long SMA: 28
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(24/30) - Original Sharpe: 0.6863, Trades: 115
[INFO] Hierarchical cluster 2: SMA(152/178) - Original Sharpe: 0.6182, Trades: 25
[INFO] Hierarchical cluster 3: SMA(164/168) - Original Sharpe: 0.5808, Trades: 47
[INFO] Hierarchical cluster 4: SMA(130/176) - Original Sharpe: 0.5134, Trades: 23
[INFO] Hierarchical cluster 5: SMA(20/202) - Original Sharpe: 0.4632, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (22/28)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/30) - Sharpe: 0.6863
[INFO] cluster 2: (152/178) - Sharpe: 0.6182
[INFO] cluster 3: (164/168) - Sharpe: 0.5808
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     2.591859            2.591859
1    2021-11-14 2021-11-14            43     2.356142            1.339783
2    2022-01-14 2022-01-14            41     3.996440            3.996440
3    2022-03-14 2022-03-14            44     1.386441            2.682058
4    2022-05-14 2022-05-14            43    -1.122388            0.383530
5    2022-07-14 2022-07-14            44    -2.969387           -1.988646
6    2022-09-14 2022-09-14            43    -2.635788           -0.506471
7    2022-11-14 2022-11-14            43     0.035722           -2.353818
8    2023-01-14 2023-01-14            41     0.459261            3.243244
9    2023-03-14 2023-03-14            43    -2.585156           -1.421376
10   2023-05-14 2023-05-14            44     1.833453           -1.005170
11   2023-07-14 2023-07-14            44     5.432989           -4.516900
12   2023-09-14 2023-09-14            43    -0.091949           -0.484029
13   2023-11-14 2023-11-14            42     0.208767           -1.301032
14   2024-01-14 2024-01-14            43    -1.397108            0.657853
15   2024-03-14 2024-03-14            42    -3.827908            2.435903
16   2024-05-14 2024-05-14            44    -2.752596           -1.462517
17   2024-07-14 2024-07-14            45     2.695689            1.571657
18   2024-09-14 2024-09-14            43    -2.556363           -2.104434
19   2024-11-14 2024-11-14            33    -4.535438           -2.939545
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          2.4 |              1.3 |         -1.1 | False         
[INFO] 2022-01-14   |          4.0 |              4.0 |          0.0 | Excluded      
[INFO] 2022-03-14   |          1.4 |              2.7 |          1.3 | True          
[INFO] 2022-05-14   |         -1.1 |              0.4 |          1.5 | True          
[INFO] 2022-07-14   |         -3.0 |             -2.0 |          1.0 | True          
[INFO] 2022-09-14   |         -2.6 |             -0.5 |          2.1 | True          
[INFO] 2022-11-14   |          0.0 |             -2.4 |         -2.4 | False         
[INFO] 2023-01-14   |          0.5 |              3.2 |          2.7 | True          
[INFO] 2023-03-14   |         -2.6 |             -1.4 |          1.2 | True          
[INFO] 2023-05-14   |          1.8 |             -1.0 |         -2.8 | False         
[INFO] 2023-07-14   |          5.4 |             -4.5 |         -9.9 | False         
[INFO] 2023-09-14   |         -0.1 |             -0.5 |         -0.4 | False         
[INFO] 2023-11-14   |          0.2 |             -1.3 |         -1.5 | False         
[INFO] 2024-01-14   |         -1.4 |              0.7 |          2.1 | True          
[INFO] 2024-03-14   |         -3.8 |              2.4 |          6.2 | True          
[INFO] 2024-05-14   |         -2.8 |             -1.5 |          1.3 | True          
[INFO] 2024-07-14   |          2.7 |              1.6 |         -1.1 | False         
[INFO] 2024-09-14   |         -2.6 |             -2.1 |          0.5 | True          
[INFO] 2024-11-14   |         -4.5 |             -2.9 |          1.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 18 periods (61.11% win rate)
[INFO] Updating Excel file with Hierarchical results for HO...
[INFO] Excel file updated successfully. Added HO with Hierarchical win rate 61.1% in row 25
[INFO] Added best Sharpe parameters 22/28 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 22, Long SMA: 28
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/30) - Original Sharpe: 0.6863
[INFO] Added cluster 2 to portfolio: SMA(152/178) - Original Sharpe: 0.6182
[INFO] Added cluster 3 to portfolio: SMA(164/168) - Original Sharpe: 0.5808
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HO_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.6101
[INFO] Hierarchical Best out-of-sample Sharpe: 0.3460
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for HO...
[INFO] Excel file updated successfully. Added HO with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HO
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for JY in column D: 9.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 161.13s
[INFO] Best parameters: Short SMA = 58, Long SMA = 60
[INFO] Best Sharpe ratio: 0.628631, Trades: 140
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @JY
[INFO] Big Point Value (from data): 125000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.36 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $621,660.50
[INFO] Market Buy & Hold P&L: $-63,037.50
[INFO] Outperformance: $684,698.00
[INFO] Sharpe ratio (entire period, annualized): 0.689477
[INFO] Sharpe ratio (in-sample, annualized): 0.628631
[INFO] Sharpe ratio (out-of-sample, annualized): 0.827503
[INFO] Maximum Drawdown: $158,630.25
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 109
[INFO] Out-of-sample period trades: 31
[INFO] Total trades: 140
[INFO] In-sample P&L: $348,546.00
[INFO] Out-of-sample P&L: $201,967.50
[INFO] 
Best parameters from GA: Short SMA = 58, Long SMA = 60, Sharpe = 0.628631
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6534 to 0.6286
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 60
[INFO] Sharpe Ratio: 0.628631
[INFO] Number of Trades: 140
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10488 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6534 to 0.6286
[INFO] Trades range: 10.0 to 360.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3975 to 2.7853
[INFO] Scaled Long SMA range: -2.7975 to 1.4174
[INFO] Scaled Sharpe ratio range: -2.7947 to 4.8392
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 290 elements
[INFO] Kmeans Cluster 1: 250 elements
[INFO] Kmeans Cluster 2: 170 elements
[INFO] Kmeans Cluster 3: 254 elements
[INFO] Kmeans Cluster 4: 160 elements
[INFO] Kmeans Cluster 5: 188 elements
[INFO] Kmeans Cluster 6: 214 elements
[INFO] Kmeans Cluster 7: 172 elements
[INFO] Kmeans Cluster 8: 192 elements
[INFO] Kmeans Cluster 9: 354 elements
[INFO] Kmeans Cluster 10: 230 elements
[INFO] Kmeans Cluster 11: 257 elements
[INFO] Kmeans Cluster 12: 245 elements
[INFO] Kmeans Cluster 13: 207 elements
[INFO] Kmeans Cluster 14: 71 elements
[INFO] Kmeans Cluster 15: 317 elements
[INFO] Kmeans Cluster 16: 245 elements
[INFO] Kmeans Cluster 17: 137 elements
[INFO] Kmeans Cluster 18: 297 elements
[INFO] Kmeans Cluster 19: 172 elements
[INFO] Kmeans Cluster 20: 243 elements
[INFO] Kmeans Cluster 21: 285 elements
[INFO] Kmeans Cluster 22: 184 elements
[INFO] Kmeans Cluster 23: 299 elements
[INFO] Kmeans Cluster 24: 39 elements
[INFO] Kmeans Cluster 25: 93 elements
[INFO] Kmeans Cluster 26: 102 elements
[INFO] Kmeans Cluster 27: 208 elements
[INFO] Kmeans Cluster 28: 344 elements
[INFO] Kmeans Cluster 29: 271 elements
[INFO] Kmeans Cluster 30: 218 elements
[INFO] Kmeans Cluster 31: 232 elements
[INFO] Kmeans Cluster 32: 56 elements
[INFO] Kmeans Cluster 33: 160 elements
[INFO] Kmeans Cluster 34: 202 elements
[INFO] Kmeans Cluster 35: 159 elements
[INFO] Kmeans Cluster 36: 248 elements
[INFO] Kmeans Cluster 37: 233 elements
[INFO] Kmeans Cluster 38: 158 elements
[INFO] Kmeans Cluster 39: 339 elements
[INFO] Kmeans Cluster 40: 222 elements
[INFO] Kmeans Cluster 41: 177 elements
[INFO] Kmeans Cluster 42: 247 elements
[INFO] Kmeans Cluster 43: 198 elements
[INFO] Kmeans Cluster 44: 82 elements
[INFO] Kmeans Cluster 45: 282 elements
[INFO] Kmeans Cluster 46: 162 elements
[INFO] Kmeans Cluster 47: 232 elements
[INFO] Kmeans Cluster 48: 231 elements
[INFO] Kmeans Cluster 49: 160 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=103.63, Long SMA=275.20, Sharpe=-0.1662
[INFO] Centroid 1: Short SMA=110.21, Long SMA=143.74, Sharpe=-0.2020
[INFO] Centroid 2: Short SMA=266.46, Long SMA=289.96, Sharpe=-0.0797
[INFO] Centroid 3: Short SMA=56.86, Long SMA=226.89, Sharpe=-0.3173
[INFO] Centroid 4: Short SMA=33.70, Long SMA=57.51, Sharpe=-0.0324
[INFO] Centroid 5: Short SMA=224.99, Long SMA=282.85, Sharpe=-0.1889
[INFO] Centroid 6: Short SMA=26.11, Long SMA=170.61, Sharpe=-0.1135
[INFO] Centroid 7: Short SMA=151.95, Long SMA=180.57, Sharpe=-0.2648
[INFO] Centroid 8: Short SMA=129.27, Long SMA=200.35, Sharpe=-0.4895
[INFO] Centroid 9: Short SMA=24.41, Long SMA=276.56, Sharpe=-0.0212
[INFO] Centroid 10: Short SMA=28.17, Long SMA=80.59, Sharpe=0.2066
[INFO] Centroid 11: Short SMA=168.58, Long SMA=201.42, Sharpe=-0.3947
[INFO] Centroid 12: Short SMA=78.84, Long SMA=110.88, Sharpe=-0.3105
[INFO] Centroid 13: Short SMA=152.04, Long SMA=268.54, Sharpe=-0.3709
[INFO] Centroid 14: Short SMA=248.56, Long SMA=270.65, Sharpe=0.2900
[INFO] Centroid 15: Short SMA=181.53, Long SMA=280.45, Sharpe=-0.1496
[INFO] Centroid 16: Short SMA=109.63, Long SMA=252.47, Sharpe=-0.0761
[INFO] Centroid 17: Short SMA=135.52, Long SMA=148.80, Sharpe=0.0303
[INFO] Centroid 18: Short SMA=69.36, Long SMA=240.24, Sharpe=-0.2170
[INFO] Centroid 19: Short SMA=25.22, Long SMA=107.47, Sharpe=0.0503
[INFO] Centroid 20: Short SMA=41.10, Long SMA=108.23, Sharpe=-0.0863
[INFO] Centroid 21: Short SMA=57.61, Long SMA=181.46, Sharpe=-0.3544
[INFO] Centroid 22: Short SMA=27.24, Long SMA=233.32, Sharpe=-0.1079
[INFO] Centroid 23: Short SMA=137.38, Long SMA=285.99, Sharpe=-0.2648
[INFO] Centroid 24: Short SMA=19.59, Long SMA=29.85, Sharpe=-0.3864
[INFO] Centroid 25: Short SMA=20.54, Long SMA=39.59, Sharpe=-0.1824
[INFO] Centroid 26: Short SMA=81.88, Long SMA=102.57, Sharpe=-0.4525
[INFO] Centroid 27: Short SMA=200.44, Long SMA=227.33, Sharpe=-0.2987
[INFO] Centroid 28: Short SMA=119.58, Long SMA=234.08, Sharpe=-0.1854
[INFO] Centroid 29: Short SMA=211.89, Long SMA=238.09, Sharpe=-0.1641
[INFO] Centroid 30: Short SMA=85.51, Long SMA=139.24, Sharpe=-0.1106
[INFO] Centroid 31: Short SMA=71.80, Long SMA=270.85, Sharpe=-0.2841
[INFO] Centroid 32: Short SMA=44.54, Long SMA=60.96, Sharpe=0.3673
[INFO] Centroid 33: Short SMA=248.35, Long SMA=273.26, Sharpe=0.0877
[INFO] Centroid 34: Short SMA=66.04, Long SMA=201.25, Sharpe=-0.4748
[INFO] Centroid 35: Short SMA=14.88, Long SMA=219.23, Sharpe=0.0241
[INFO] Centroid 36: Short SMA=100.16, Long SMA=172.36, Sharpe=-0.2902
[INFO] Centroid 37: Short SMA=66.21, Long SMA=158.52, Sharpe=-0.2371
[INFO] Centroid 38: Short SMA=32.46, Long SMA=200.38, Sharpe=-0.2258
[INFO] Centroid 39: Short SMA=169.59, Long SMA=248.57, Sharpe=-0.2523
[INFO] Centroid 40: Short SMA=101.19, Long SMA=190.11, Sharpe=-0.3893
[INFO] Centroid 41: Short SMA=170.44, Long SMA=213.95, Sharpe=-0.5013
[INFO] Centroid 42: Short SMA=48.27, Long SMA=278.80, Sharpe=-0.1364
[INFO] Centroid 43: Short SMA=37.10, Long SMA=69.08, Sharpe=0.1028
[INFO] Centroid 44: Short SMA=257.71, Long SMA=288.24, Sharpe=-0.2874
[INFO] Centroid 45: Short SMA=216.80, Long SMA=268.50, Sharpe=-0.0582
[INFO] Centroid 46: Short SMA=138.70, Long SMA=161.22, Sharpe=-0.1051
[INFO] Centroid 47: Short SMA=24.09, Long SMA=147.71, Sharpe=-0.0305
[INFO] Centroid 48: Short SMA=61.01, Long SMA=118.34, Sharpe=-0.2067
[INFO] Centroid 49: Short SMA=132.41, Long SMA=207.60, Sharpe=-0.3478
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=60, Sharpe=0.6286, Trades=140
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=248, Long SMA=272, Sharpe=0.3586, Trades=20
[INFO] Kmeans Top 2: Short SMA=50, Long SMA=62, Sharpe=0.3010, Trades=60
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=80, Sharpe=0.2577, Trades=30
[INFO] Kmeans Top 4: Short SMA=250, Long SMA=270, Sharpe=0.1760, Trades=22
[INFO] Kmeans Top 5: Short SMA=34, Long SMA=68, Sharpe=0.1247, Trades=38
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (104, 275)
[INFO]   Nearest: (104.0, 276.0)
[INFO]   Rounded: (110, 144)
[INFO]   Rounded: (266, 290)
[INFO]   Rounded: (57, 227)
[INFO]   Nearest: (56.0, 226.0)
[INFO]   Rounded: (34, 58)
[INFO]   Rounded: (225, 283)
[INFO]   Nearest: (224.0, 282.0)
[INFO]   Rounded: (26, 171)
[INFO]   Nearest: (26.0, 170.0)
[INFO]   Rounded: (152, 181)
[INFO]   Nearest: (152.0, 180.0)
[INFO]   Rounded: (129, 200)
[INFO]   Nearest: (130.0, 200.0)
[INFO]   Rounded: (24, 277)
[INFO]   Nearest: (24.0, 276.0)
[INFO]   Rounded: (28, 81)
[INFO]   Nearest: (28.0, 80.0)
[INFO]   Rounded: (169, 201)
[INFO]   Nearest: (168.0, 202.0)
[INFO]   Rounded: (79, 111)
[INFO]   Nearest: (78.0, 110.0)
[INFO]   Rounded: (152, 269)
[INFO]   Nearest: (152.0, 268.0)
[INFO]   Rounded: (249, 271)
[INFO]   Nearest: (248.0, 270.0)
[INFO]   Rounded: (182, 280)
[INFO]   Rounded: (110, 252)
[INFO]   Rounded: (136, 149)
[INFO]   Nearest: (136.0, 148.0)
[INFO]   Rounded: (69, 240)
[INFO]   Nearest: (70.0, 240.0)
[INFO]   Rounded: (25, 107)
[INFO]   Nearest: (26.0, 108.0)
[INFO]   Rounded: (41, 108)
[INFO]   Nearest: (42.0, 108.0)
[INFO]   Rounded: (58, 181)
[INFO]   Nearest: (58.0, 182.0)
[INFO]   Rounded: (27, 233)
[INFO]   Nearest: (28.0, 234.0)
[INFO]   Rounded: (137, 286)
[INFO]   Nearest: (138.0, 286.0)
[INFO]   Rounded: (20, 30)
[INFO]   Rounded: (21, 40)
[INFO]   Nearest: (20.0, 40.0)
[INFO]   Rounded: (82, 103)
[INFO]   Nearest: (82.0, 102.0)
[INFO]   Rounded: (200, 227)
[INFO]   Nearest: (200.0, 228.0)
[INFO]   Rounded: (120, 234)
[INFO]   Rounded: (212, 238)
[INFO]   Rounded: (86, 139)
[INFO]   Nearest: (86.0, 140.0)
[INFO]   Rounded: (72, 271)
[INFO]   Nearest: (72.0, 270.0)
[INFO]   Rounded: (45, 61)
[INFO]   Nearest: (44.0, 60.0)
[INFO]   Rounded: (248, 273)
[INFO]   Nearest: (248.0, 274.0)
[INFO]   Rounded: (66, 201)
[INFO]   Nearest: (66.0, 202.0)
[INFO]   Rounded: (15, 219)
[INFO]   Nearest: (14.0, 220.0)
[INFO]   Rounded: (100, 172)
[INFO]   Rounded: (66, 159)
[INFO]   Nearest: (66.0, 158.0)
[INFO]   Rounded: (32, 200)
[INFO]   Rounded: (170, 249)
[INFO]   Nearest: (170.0, 248.0)
[INFO]   Rounded: (101, 190)
[INFO]   Nearest: (102.0, 190.0)
[INFO]   Rounded: (170, 214)
[INFO]   Rounded: (48, 279)
[INFO]   Nearest: (48.0, 278.0)
[INFO]   Rounded: (37, 69)
[INFO]   Nearest: (38.0, 70.0)
[INFO]   Rounded: (258, 288)
[INFO]   Rounded: (217, 268)
[INFO]   Nearest: (216.0, 268.0)
[INFO]   Rounded: (139, 161)
[INFO]   Nearest: (138.0, 162.0)
[INFO]   Rounded: (24, 148)
[INFO]   Rounded: (61, 118)
[INFO]   Nearest: (62.0, 118.0)
[INFO]   Rounded: (132, 208)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 60
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(248/272) - Original Sharpe: 0.3586, Trades: 20
[INFO] Kmeans cluster 2: SMA(50/62) - Original Sharpe: 0.3010, Trades: 60
[INFO] Kmeans cluster 3: SMA(28/80) - Original Sharpe: 0.2577, Trades: 30
[INFO] Kmeans cluster 4: SMA(250/270) - Original Sharpe: 0.1760, Trades: 22
[INFO] Kmeans cluster 5: SMA(34/68) - Original Sharpe: 0.1247, Trades: 38
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/60)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (248/272) - Sharpe: 0.3586
[INFO] cluster 2: (50/62) - Sharpe: 0.3010
[INFO] cluster 3: (28/80) - Sharpe: 0.2577
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.150748            2.490179
1    2021-11-14 2021-11-14            43     1.384297           -0.080849
2    2022-01-14 2022-01-14            41     3.292417            3.171053
3    2022-03-14 2022-03-14            44     6.956797            5.852003
4    2022-05-14 2022-05-14            43     3.536297            3.536297
5    2022-07-14 2022-07-14            44     1.924049            1.924049
6    2022-09-14 2022-09-14            43    -1.464758           -1.464758
7    2022-11-14 2022-11-14            43     3.567745            1.054412
8    2023-01-14 2023-01-14            41    -2.381255           -6.846762
9    2023-03-14 2023-03-14            44     2.565997            1.113088
10   2023-05-14 2023-05-14            44    -0.317342           -0.258766
11   2023-07-14 2023-07-14            44     5.203187            5.046193
12   2023-09-14 2023-09-14            43     3.227294            3.227294
13   2023-11-14 2023-11-14            42    -5.199080           -3.410850
14   2024-01-14 2024-01-14            43    -5.390091           -2.629223
15   2024-03-14 2024-03-14            42     4.374593            4.374593
16   2024-05-14 2024-05-14            44     1.567034            1.567034
17   2024-07-14 2024-07-14            45    -2.564883           -3.543387
18   2024-09-14 2024-09-14            43    -3.192759           -0.670171
19   2024-11-14 2024-11-14            33     1.332713            1.332713
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.2 |              2.5 |          4.7 | True          
[INFO] 2021-11-14   |          1.4 |             -0.1 |         -1.5 | False         
[INFO] 2022-01-14   |          3.3 |              3.2 |         -0.1 | False         
[INFO] 2022-03-14   |          7.0 |              5.9 |         -1.1 | False         
[INFO] 2022-05-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-11-14   |          3.6 |              1.1 |         -2.5 | False         
[INFO] 2023-01-14   |         -2.4 |             -6.8 |         -4.4 | False         
[INFO] 2023-03-14   |          2.6 |              1.1 |         -1.5 | False         
[INFO] 2023-05-14   |         -0.3 |             -0.3 |          0.0 | Excluded      
[INFO] 2023-07-14   |          5.2 |              5.0 |         -0.2 | False         
[INFO] 2023-09-14   |          3.2 |              3.2 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -5.2 |             -3.4 |          1.8 | True          
[INFO] 2024-01-14   |         -5.4 |             -2.6 |          2.8 | True          
[INFO] 2024-03-14   |          4.4 |              4.4 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.6 |             -3.5 |         -0.9 | False         
[INFO] 2024-09-14   |         -3.2 |             -0.7 |          2.5 | True          
[INFO] 2024-11-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2022-07-14, 2022-09-14, 2023-05-14, 2023-09-14, 2024-03-14, 2024-05-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 4 of 12 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for JY...
[INFO] Excel file updated successfully. Added JY with Kmeans win rate 33.3% in row 26
[INFO] Added best Sharpe parameters 58/60 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 60
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(248/272) - Original Sharpe: 0.3586
[INFO] Added cluster 2 to portfolio: SMA(50/62) - Original Sharpe: 0.3010
[INFO] Added cluster 3 to portfolio: SMA(28/80) - Original Sharpe: 0.2577
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'JY_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 1.0350
[INFO] Kmeans Best out-of-sample Sharpe: 0.8275
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for JY...
[INFO] Excel file updated successfully. Added JY with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\JY
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6534 to 0.6286
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 60
[INFO] Sharpe Ratio: 0.628631
[INFO] Number of Trades: 140
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10488 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6534 to 0.6286
[INFO] Trades range: 10.0 to 360.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3975 to 2.7853
[INFO] Scaled Long SMA range: -2.7975 to 1.4174
[INFO] Scaled Sharpe ratio range: -2.7947 to 4.8392
[INFO] Scaled Trades range: -0.7089 to 17.7531
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10488 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5236
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 88 elements
[INFO] Cluster 1: 73 elements
[INFO] Cluster 2: 327 elements
[INFO] Cluster 3: 488 elements
[INFO] Cluster 4: 297 elements
[INFO] Cluster 5: 317 elements
[INFO] Cluster 6: 22 elements
[INFO] Cluster 7: 361 elements
[INFO] Cluster 8: 292 elements
[INFO] Cluster 9: 289 elements
[INFO] Cluster 10: 145 elements
[INFO] Cluster 11: 553 elements
[INFO] Cluster 12: 65 elements
[INFO] Cluster 13: 215 elements
[INFO] Cluster 14: 383 elements
[INFO] Cluster 15: 357 elements
[INFO] Cluster 16: 115 elements
[INFO] Cluster 17: 41 elements
[INFO] Cluster 18: 370 elements
[INFO] Cluster 19: 234 elements
[INFO] Cluster 20: 255 elements
[INFO] Cluster 21: 362 elements
[INFO] Cluster 22: 263 elements
[INFO] Cluster 23: 376 elements
[INFO] Cluster 24: 241 elements
[INFO] Cluster 25: 78 elements
[INFO] Cluster 26: 86 elements
[INFO] Cluster 27: 38 elements
[INFO] Cluster 28: 268 elements
[INFO] Cluster 29: 404 elements
[INFO] Cluster 30: 3 elements
[INFO] Cluster 31: 282 elements
[INFO] Cluster 32: 261 elements
[INFO] Cluster 33: 34 elements
[INFO] Cluster 34: 316 elements
[INFO] Cluster 35: 103 elements
[INFO] Cluster 36: 181 elements
[INFO] Cluster 37: 426 elements
[INFO] Cluster 38: 170 elements
[INFO] Cluster 39: 232 elements
[INFO] Cluster 40: 40 elements
[INFO] Cluster 41: 18 elements
[INFO] Cluster 42: 98 elements
[INFO] Cluster 43: 298 elements
[INFO] Cluster 44: 19 elements
[INFO] Cluster 45: 104 elements
[INFO] Cluster 46: 199 elements
[INFO] Cluster 47: 189 elements
[INFO] Cluster 48: 15 elements
[INFO] Cluster 49: 97 elements
[INFO] Using 46 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=266, Long SMA=270, Sharpe=0.0649, Trades=52
[INFO] Cluster 1 cluster: Short SMA=26, Long SMA=40, Sharpe=-0.0436, Trades=89
[INFO] Cluster 2 cluster: Short SMA=20, Long SMA=240, Sharpe=0.0039, Trades=22
[INFO] Cluster 3 cluster: Short SMA=172, Long SMA=240, Sharpe=-0.2086, Trades=16
[INFO] Cluster 4 cluster: Short SMA=238, Long SMA=272, Sharpe=-0.0170, Trades=18
[INFO] Cluster 5 cluster: Short SMA=240, Long SMA=288, Sharpe=-0.1009, Trades=18
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=26, Sharpe=-0.0761, Trades=210
[INFO] Cluster 7 cluster: Short SMA=28, Long SMA=190, Sharpe=-0.1819, Trades=20
[INFO] Cluster 8 cluster: Short SMA=138, Long SMA=176, Sharpe=-0.1764, Trades=17
[INFO] Cluster 9 cluster: Short SMA=212, Long SMA=230, Sharpe=-0.1977, Trades=24
[INFO] Cluster 10 cluster: Short SMA=26, Long SMA=62, Sharpe=0.0489, Trades=50
[INFO] Cluster 11 cluster: Short SMA=192, Long SMA=274, Sharpe=-0.1203, Trades=14
[INFO] Cluster 12 cluster: Short SMA=110, Long SMA=114, Sharpe=-0.2890, Trades=77
[INFO] Cluster 13 cluster: Short SMA=138, Long SMA=156, Sharpe=-0.0007, Trades=23
[INFO] Cluster 14 cluster: Short SMA=148, Long SMA=282, Sharpe=-0.2792, Trades=12
[INFO] Cluster 15 cluster: Short SMA=102, Long SMA=192, Sharpe=-0.2914, Trades=15
[INFO] Cluster 16 cluster: Short SMA=246, Long SMA=272, Sharpe=0.1503, Trades=22
[INFO] Cluster 17 cluster: Short SMA=24, Long SMA=30, Sharpe=-0.5034, Trades=139
[INFO] Cluster 18 cluster: Short SMA=164, Long SMA=204, Sharpe=-0.3998, Trades=20
[INFO] Cluster 19 cluster: Short SMA=58, Long SMA=200, Sharpe=-0.3815, Trades=22
[INFO] Cluster 20 cluster: Short SMA=60, Long SMA=180, Sharpe=-0.2988, Trades=18
[INFO] Cluster 21 cluster: Short SMA=58, Long SMA=134, Sharpe=-0.2045, Trades=24
[INFO] Cluster 22 cluster: Short SMA=50, Long SMA=280, Sharpe=-0.1118, Trades=10
[INFO] Cluster 23 cluster: Short SMA=38, Long SMA=114, Sharpe=-0.0059, Trades=24
[INFO] Cluster 24 cluster: Short SMA=134, Long SMA=202, Sharpe=-0.4554, Trades=15
[INFO] Cluster 25 cluster: Short SMA=86, Long SMA=96, Sharpe=-0.3009, Trades=50
[INFO] Cluster 26 cluster: Short SMA=42, Long SMA=70, Sharpe=-0.1751, Trades=42
[INFO] Cluster 27 cluster: Short SMA=188, Long SMA=190, Sharpe=-0.4206, Trades=52
[INFO] Cluster 28 cluster: Short SMA=82, Long SMA=144, Sharpe=-0.1413, Trades=17
[INFO] Cluster 29 cluster: Short SMA=114, Long SMA=236, Sharpe=-0.1808, Trades=13
[INFO] Cluster 31 cluster: Short SMA=66, Long SMA=224, Sharpe=-0.3133, Trades=18
[INFO] Cluster 32 cluster: Short SMA=24, Long SMA=282, Sharpe=-0.0854, Trades=14
[INFO] Cluster 33 cluster: Short SMA=22, Long SMA=34, Sharpe=-0.4142, Trades=108
[INFO] Cluster 34 cluster: Short SMA=96, Long SMA=162, Sharpe=-0.2900, Trades=17
[INFO] Cluster 35 cluster: Short SMA=26, Long SMA=50, Sharpe=0.0858, Trades=70
[INFO] Cluster 36 cluster: Short SMA=96, Long SMA=120, Sharpe=-0.3070, Trades=32
[INFO] Cluster 37 cluster: Short SMA=106, Long SMA=274, Sharpe=-0.2020, Trades=12
[INFO] Cluster 38 cluster: Short SMA=34, Long SMA=94, Sharpe=0.0155, Trades=30
[INFO] Cluster 39 cluster: Short SMA=20, Long SMA=152, Sharpe=-0.1028, Trades=28
[INFO] Cluster 40 cluster: Short SMA=140, Long SMA=144, Sharpe=-0.1717, Trades=51
[INFO] Cluster 42 cluster: Short SMA=76, Long SMA=108, Sharpe=-0.3323, Trades=28
[INFO] Cluster 43 cluster: Short SMA=74, Long SMA=260, Sharpe=-0.2772, Trades=14
[INFO] Cluster 45 cluster: Short SMA=116, Long SMA=266, Sharpe=-0.0937, Trades=12
[INFO] Cluster 46 cluster: Short SMA=24, Long SMA=84, Sharpe=0.1771, Trades=34
[INFO] Cluster 47 cluster: Short SMA=54, Long SMA=240, Sharpe=-0.2214, Trades=16
[INFO] Cluster 49 cluster: Short SMA=148, Long SMA=250, Sharpe=-0.4712, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=60, Sharpe=0.6286, Trades=140
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=24, Long SMA=84, Sharpe=0.1771, Trades=34
[INFO] Top 2: Short SMA=246, Long SMA=272, Sharpe=0.1503, Trades=22
[INFO] Top 3: Short SMA=26, Long SMA=50, Sharpe=0.0858, Trades=70
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 46 valid clusters with clusters
[INFO] Filtering to 10433 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 60
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(24/84) - Original Sharpe: 0.1771, Trades: 34
[INFO] Hierarchical cluster 2: SMA(246/272) - Original Sharpe: 0.1503, Trades: 22
[INFO] Hierarchical cluster 3: SMA(26/50) - Original Sharpe: 0.0858, Trades: 70
[INFO] Hierarchical cluster 4: SMA(266/270) - Original Sharpe: 0.0649, Trades: 52
[INFO] Hierarchical cluster 5: SMA(26/62) - Original Sharpe: 0.0489, Trades: 50
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/60)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 60
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\JY
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for KC in column D: 32.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 109.94s
[INFO] Best parameters: Short SMA = 126, Long SMA = 144
[INFO] Best Sharpe ratio: 0.627789, Trades: 31
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @KC
[INFO] Big Point Value (from data): 375.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.46 contracts
[INFO] Maximum Position Size: 10 contracts
[INFO] Strategy Total P&L: $639,834.00
[INFO] Market Buy & Hold P&L: $47,625.00
[INFO] Outperformance: $592,209.00
[INFO] Sharpe ratio (entire period, annualized): 0.637021
[INFO] Sharpe ratio (in-sample, annualized): 0.627789
[INFO] Sharpe ratio (out-of-sample, annualized): 0.657694
[INFO] Maximum Drawdown: $199,510.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 23
[INFO] Out-of-sample period trades: 8
[INFO] Total trades: 31
[INFO] In-sample P&L: $366,396.50
[INFO] Out-of-sample P&L: $175,393.75
[INFO] 
Best parameters from GA: Short SMA = 126, Long SMA = 144, Sharpe = 0.627789
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 375.0
[INFO] Slippage: 32.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7635 to 0.6278
[INFO] 
Best parameters:
[INFO] Short SMA: 126
[INFO] Long SMA: 144
[INFO] Sharpe Ratio: 0.627789
[INFO] Number of Trades: 31
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9735 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7635 to 0.6278
[INFO] Trades range: 11.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3432 to 2.6986
[INFO] Scaled Long SMA range: -2.7329 to 1.5004
[INFO] Scaled Sharpe ratio range: -3.9207 to 2.9484
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 123 elements
[INFO] Kmeans Cluster 1: 254 elements
[INFO] Kmeans Cluster 2: 182 elements
[INFO] Kmeans Cluster 3: 269 elements
[INFO] Kmeans Cluster 4: 283 elements
[INFO] Kmeans Cluster 5: 84 elements
[INFO] Kmeans Cluster 6: 275 elements
[INFO] Kmeans Cluster 7: 116 elements
[INFO] Kmeans Cluster 8: 196 elements
[INFO] Kmeans Cluster 9: 181 elements
[INFO] Kmeans Cluster 10: 180 elements
[INFO] Kmeans Cluster 11: 216 elements
[INFO] Kmeans Cluster 12: 141 elements
[INFO] Kmeans Cluster 13: 80 elements
[INFO] Kmeans Cluster 14: 179 elements
[INFO] Kmeans Cluster 15: 327 elements
[INFO] Kmeans Cluster 16: 134 elements
[INFO] Kmeans Cluster 17: 199 elements
[INFO] Kmeans Cluster 18: 263 elements
[INFO] Kmeans Cluster 19: 270 elements
[INFO] Kmeans Cluster 20: 110 elements
[INFO] Kmeans Cluster 21: 233 elements
[INFO] Kmeans Cluster 22: 250 elements
[INFO] Kmeans Cluster 23: 140 elements
[INFO] Kmeans Cluster 24: 183 elements
[INFO] Kmeans Cluster 25: 203 elements
[INFO] Kmeans Cluster 26: 121 elements
[INFO] Kmeans Cluster 27: 158 elements
[INFO] Kmeans Cluster 28: 246 elements
[INFO] Kmeans Cluster 29: 223 elements
[INFO] Kmeans Cluster 30: 205 elements
[INFO] Kmeans Cluster 31: 171 elements
[INFO] Kmeans Cluster 32: 282 elements
[INFO] Kmeans Cluster 33: 241 elements
[INFO] Kmeans Cluster 34: 150 elements
[INFO] Kmeans Cluster 35: 179 elements
[INFO] Kmeans Cluster 36: 69 elements
[INFO] Kmeans Cluster 37: 57 elements
[INFO] Kmeans Cluster 38: 335 elements
[INFO] Kmeans Cluster 39: 243 elements
[INFO] Kmeans Cluster 40: 169 elements
[INFO] Kmeans Cluster 41: 180 elements
[INFO] Kmeans Cluster 42: 97 elements
[INFO] Kmeans Cluster 43: 242 elements
[INFO] Kmeans Cluster 44: 210 elements
[INFO] Kmeans Cluster 45: 257 elements
[INFO] Kmeans Cluster 46: 226 elements
[INFO] Kmeans Cluster 47: 291 elements
[INFO] Kmeans Cluster 48: 82 elements
[INFO] Kmeans Cluster 49: 230 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=151.50, Long SMA=284.83, Sharpe=-0.2153
[INFO] Centroid 1: Short SMA=36.94, Long SMA=71.99, Sharpe=0.0933
[INFO] Centroid 2: Short SMA=68.75, Long SMA=201.66, Sharpe=0.2105
[INFO] Centroid 3: Short SMA=249.18, Long SMA=282.02, Sharpe=-0.3393
[INFO] Centroid 4: Short SMA=161.48, Long SMA=218.22, Sharpe=0.0087
[INFO] Centroid 5: Short SMA=18.36, Long SMA=38.31, Sharpe=-0.3728
[INFO] Centroid 6: Short SMA=62.99, Long SMA=246.54, Sharpe=-0.0451
[INFO] Centroid 7: Short SMA=64.69, Long SMA=107.34, Sharpe=0.3607
[INFO] Centroid 8: Short SMA=176.44, Long SMA=250.38, Sharpe=0.0855
[INFO] Centroid 9: Short SMA=28.97, Long SMA=138.91, Sharpe=0.0585
[INFO] Centroid 10: Short SMA=46.78, Long SMA=281.61, Sharpe=-0.2158
[INFO] Centroid 11: Short SMA=113.06, Long SMA=149.84, Sharpe=0.2691
[INFO] Centroid 12: Short SMA=139.39, Long SMA=170.35, Sharpe=-0.0194
[INFO] Centroid 13: Short SMA=187.97, Long SMA=203.55, Sharpe=0.3482
[INFO] Centroid 14: Short SMA=33.55, Long SMA=68.09, Sharpe=-0.0510
[INFO] Centroid 15: Short SMA=39.19, Long SMA=166.98, Sharpe=0.2175
[INFO] Centroid 16: Short SMA=15.67, Long SMA=254.69, Sharpe=0.2199
[INFO] Centroid 17: Short SMA=186.57, Long SMA=280.85, Sharpe=-0.0946
[INFO] Centroid 18: Short SMA=185.77, Long SMA=217.07, Sharpe=0.1500
[INFO] Centroid 19: Short SMA=111.17, Long SMA=224.60, Sharpe=-0.0272
[INFO] Centroid 20: Short SMA=16.13, Long SMA=149.93, Sharpe=-0.0964
[INFO] Centroid 21: Short SMA=72.91, Long SMA=280.95, Sharpe=-0.1044
[INFO] Centroid 22: Short SMA=93.14, Long SMA=119.50, Sharpe=0.1841
[INFO] Centroid 23: Short SMA=226.60, Long SMA=247.90, Sharpe=-0.1176
[INFO] Centroid 24: Short SMA=27.69, Long SMA=205.18, Sharpe=0.1691
[INFO] Centroid 25: Short SMA=151.44, Long SMA=177.10, Sharpe=-0.1431
[INFO] Centroid 26: Short SMA=158.38, Long SMA=177.95, Sharpe=-0.2662
[INFO] Centroid 27: Short SMA=21.15, Long SMA=205.99, Sharpe=0.3429
[INFO] Centroid 28: Short SMA=94.32, Long SMA=167.94, Sharpe=0.1551
[INFO] Centroid 29: Short SMA=41.36, Long SMA=113.28, Sharpe=0.1677
[INFO] Centroid 30: Short SMA=248.77, Long SMA=281.36, Sharpe=-0.4540
[INFO] Centroid 31: Short SMA=119.24, Long SMA=153.70, Sharpe=0.4034
[INFO] Centroid 32: Short SMA=137.52, Long SMA=241.59, Sharpe=-0.0991
[INFO] Centroid 33: Short SMA=209.66, Long SMA=286.41, Sharpe=-0.2201
[INFO] Centroid 34: Short SMA=96.63, Long SMA=189.33, Sharpe=0.0203
[INFO] Centroid 35: Short SMA=28.19, Long SMA=259.01, Sharpe=0.0125
[INFO] Centroid 36: Short SMA=19.65, Long SMA=34.75, Sharpe=-0.5411
[INFO] Centroid 37: Short SMA=11.19, Long SMA=135.61, Sharpe=-0.3148
[INFO] Centroid 38: Short SMA=213.13, Long SMA=242.82, Sharpe=0.0550
[INFO] Centroid 39: Short SMA=42.15, Long SMA=215.25, Sharpe=0.0361
[INFO] Centroid 40: Short SMA=62.82, Long SMA=177.54, Sharpe=0.3568
[INFO] Centroid 41: Short SMA=79.83, Long SMA=99.29, Sharpe=0.0702
[INFO] Centroid 42: Short SMA=25.63, Long SMA=54.97, Sharpe=-0.2103
[INFO] Centroid 43: Short SMA=167.83, Long SMA=268.23, Sharpe=-0.0020
[INFO] Centroid 44: Short SMA=30.54, Long SMA=282.41, Sharpe=-0.1057
[INFO] Centroid 45: Short SMA=40.10, Long SMA=98.27, Sharpe=0.2583
[INFO] Centroid 46: Short SMA=81.08, Long SMA=221.15, Sharpe=0.0724
[INFO] Centroid 47: Short SMA=71.17, Long SMA=139.57, Sharpe=0.2961
[INFO] Centroid 48: Short SMA=282.66, Long SMA=292.34, Sharpe=-0.1055
[INFO] Centroid 49: Short SMA=129.30, Long SMA=199.93, Sharpe=0.0882
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=126, Long SMA=144, Sharpe=0.6278, Trades=31
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=120, Long SMA=154, Sharpe=0.4369, Trades=21
[INFO] Kmeans Top 2: Short SMA=22, Long SMA=206, Sharpe=0.4342, Trades=21
[INFO] Kmeans Top 3: Short SMA=188, Long SMA=204, Sharpe=0.3923, Trades=21
[INFO] Kmeans Top 4: Short SMA=64, Long SMA=178, Sharpe=0.3643, Trades=13
[INFO] Kmeans Top 5: Short SMA=66, Long SMA=106, Sharpe=0.3352, Trades=23
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (151, 285)
[INFO]   Nearest: (152.0, 284.0)
[INFO]   Rounded: (37, 72)
[INFO]   Nearest: (36.0, 72.0)
[INFO]   Rounded: (69, 202)
[INFO]   Nearest: (68.0, 202.0)
[INFO]   Rounded: (249, 282)
[INFO]   Nearest: (250.0, 282.0)
[INFO]   Rounded: (161, 218)
[INFO]   Nearest: (162.0, 218.0)
[INFO]   Rounded: (18, 38)
[INFO]   Rounded: (63, 247)
[INFO]   Nearest: (62.0, 246.0)
[INFO]   Rounded: (65, 107)
[INFO]   Nearest: (64.0, 108.0)
[INFO]   Rounded: (176, 250)
[INFO]   Rounded: (29, 139)
[INFO]   Nearest: (28.0, 138.0)
[INFO]   Rounded: (47, 282)
[INFO]   Nearest: (46.0, 282.0)
[INFO]   Rounded: (113, 150)
[INFO]   Nearest: (114.0, 150.0)
[INFO]   Rounded: (139, 170)
[INFO]   Nearest: (140.0, 170.0)
[INFO]   Rounded: (188, 204)
[INFO]   Rounded: (34, 68)
[INFO]   Rounded: (39, 167)
[INFO]   Nearest: (40.0, 166.0)
[INFO]   Rounded: (16, 255)
[INFO]   Nearest: (16.0, 254.0)
[INFO]   Rounded: (187, 281)
[INFO]   Nearest: (186.0, 280.0)
[INFO]   Rounded: (186, 217)
[INFO]   Nearest: (186.0, 218.0)
[INFO]   Rounded: (111, 225)
[INFO]   Nearest: (112.0, 224.0)
[INFO]   Rounded: (16, 150)
[INFO]   Rounded: (73, 281)
[INFO]   Nearest: (72.0, 280.0)
[INFO]   Rounded: (93, 120)
[INFO]   Nearest: (94.0, 120.0)
[INFO]   Rounded: (227, 248)
[INFO]   Nearest: (226.0, 248.0)
[INFO]   Rounded: (28, 205)
[INFO]   Nearest: (28.0, 206.0)
[INFO]   Rounded: (151, 177)
[INFO]   Nearest: (152.0, 178.0)
[INFO]   Rounded: (158, 178)
[INFO]   Rounded: (21, 206)
[INFO]   Nearest: (22.0, 206.0)
[INFO]   Rounded: (94, 168)
[INFO]   Rounded: (41, 113)
[INFO]   Nearest: (42.0, 114.0)
[INFO]   Rounded: (249, 281)
[INFO]   Nearest: (248.0, 282.0)
[INFO]   Rounded: (119, 154)
[INFO]   Nearest: (120.0, 154.0)
[INFO]   Rounded: (138, 242)
[INFO]   Rounded: (210, 286)
[INFO]   Rounded: (97, 189)
[INFO]   Nearest: (96.0, 190.0)
[INFO]   Rounded: (28, 259)
[INFO]   Nearest: (28.0, 260.0)
[INFO]   Rounded: (20, 35)
[INFO]   Nearest: (20.0, 34.0)
[INFO]   Rounded: (11, 136)
[INFO]   Nearest: (12.0, 136.0)
[INFO]   Rounded: (213, 243)
[INFO]   Nearest: (214.0, 242.0)
[INFO]   Rounded: (42, 215)
[INFO]   Nearest: (42.0, 216.0)
[INFO]   Rounded: (63, 178)
[INFO]   Nearest: (62.0, 178.0)
[INFO]   Rounded: (80, 99)
[INFO]   Nearest: (80.0, 100.0)
[INFO]   Rounded: (26, 55)
[INFO]   Nearest: (26.0, 54.0)
[INFO]   Rounded: (168, 268)
[INFO]   Rounded: (31, 282)
[INFO]   Nearest: (30.0, 282.0)
[INFO]   Rounded: (40, 98)
[INFO]   Rounded: (81, 221)
[INFO]   Nearest: (82.0, 222.0)
[INFO]   Rounded: (71, 140)
[INFO]   Nearest: (72.0, 140.0)
[INFO]   Rounded: (283, 292)
[INFO]   Nearest: (282.0, 292.0)
[INFO]   Rounded: (129, 200)
[INFO]   Nearest: (130.0, 200.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 126, Long SMA: 144
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(120/154) - Original Sharpe: 0.4369, Trades: 21
[INFO] Kmeans cluster 2: SMA(22/206) - Original Sharpe: 0.4342, Trades: 21
[INFO] Kmeans cluster 3: SMA(188/204) - Original Sharpe: 0.3923, Trades: 21
[INFO] Kmeans cluster 4: SMA(64/178) - Original Sharpe: 0.3643, Trades: 13
[INFO] Kmeans cluster 5: SMA(66/106) - Original Sharpe: 0.3352, Trades: 23
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (126/144)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (120/154) - Sharpe: 0.4369
[INFO] cluster 2: (22/206) - Sharpe: 0.4342
[INFO] cluster 3: (188/204) - Sharpe: 0.3923
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     1.943138            1.943138
1    2021-11-10 2021-11-10            41     2.726433            2.726433
2    2022-01-10 2022-01-10            41    -0.979722           -0.979722
3    2022-03-10 2022-03-10            42    -1.932434           -1.932434
4    2022-05-10 2022-05-10            41     2.781394            0.321463
5    2022-07-10 2022-07-10            44    -0.902683           -1.746938
6    2022-09-10 2022-09-10            43     4.781663            6.300823
7    2022-11-10 2022-11-10            40     0.520961            0.528681
8    2023-01-10 2023-01-10            41    -1.945501           -1.945501
9    2023-03-10 2023-03-10            42    -1.386296           -1.376533
10   2023-05-10 2023-05-10            40    -1.725343           -2.018118
11   2023-07-10 2023-07-10            44     0.054587            2.659566
12   2023-09-10 2023-09-10            44    -3.556132           -3.556132
13   2023-11-10 2023-11-10            40    -1.024655           -2.591876
14   2024-01-10 2024-01-10            41     1.405934            0.672127
15   2024-03-10 2024-03-10            43     1.924896            1.618583
16   2024-05-10 2024-05-10            40     2.925387            2.925387
17   2024-07-10 2024-07-10            43     0.254368            0.254368
18   2024-09-10 2024-09-10            44     0.943102            0.943102
19   2024-11-10 2024-11-10            35     5.162860            5.162860
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-01-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |          2.8 |              0.3 |         -2.5 | False         
[INFO] 2022-07-10   |         -0.9 |             -1.7 |         -0.8 | False         
[INFO] 2022-09-10   |          4.8 |              6.3 |          1.5 | True          
[INFO] 2022-11-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -1.7 |             -2.0 |         -0.3 | False         
[INFO] 2023-07-10   |          0.1 |              2.7 |          2.6 | True          
[INFO] 2023-09-10   |         -3.6 |             -3.6 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -1.0 |             -2.6 |         -1.6 | False         
[INFO] 2024-01-10   |          1.4 |              0.7 |         -0.7 | False         
[INFO] 2024-03-10   |          1.9 |              1.6 |         -0.3 | False         
[INFO] 2024-05-10   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-11-10   |          5.2 |              5.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2022-11-10, 2023-01-10, 2023-03-10, 2023-09-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Kmeans cluster wins (rounded comparison): 2 of 8 periods (25.00% win rate)
[INFO] Updating Excel file with Kmeans results for KC...
[INFO] Excel file updated successfully. Added KC with Kmeans win rate 25.0% in row 27
[INFO] Added best Sharpe parameters 126/144 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 126, Long SMA: 144
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(120/154) - Original Sharpe: 0.4369
[INFO] Added cluster 2 to portfolio: SMA(22/206) - Original Sharpe: 0.4342
[INFO] Added cluster 3 to portfolio: SMA(188/204) - Original Sharpe: 0.3923
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.8400
[INFO] Kmeans Best out-of-sample Sharpe: 0.6577
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for KC...
[INFO] Excel file updated successfully. Added KC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KC
[INFO] Big Point Value: 375.0
[INFO] Slippage: 32.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7635 to 0.6278
[INFO] 
Best parameters:
[INFO] Short SMA: 126
[INFO] Long SMA: 144
[INFO] Sharpe Ratio: 0.627789
[INFO] Number of Trades: 31
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9735 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7635 to 0.6278
[INFO] Trades range: 11.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3432 to 2.6986
[INFO] Scaled Long SMA range: -2.7329 to 1.5004
[INFO] Scaled Sharpe ratio range: -3.9207 to 2.9484
[INFO] Scaled Trades range: -0.5894 to 15.3908
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9735 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4846
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 63 elements
[INFO] Cluster 1: 272 elements
[INFO] Cluster 2: 103 elements
[INFO] Cluster 3: 64 elements
[INFO] Cluster 4: 190 elements
[INFO] Cluster 5: 459 elements
[INFO] Cluster 6: 426 elements
[INFO] Cluster 7: 302 elements
[INFO] Cluster 8: 488 elements
[INFO] Cluster 9: 204 elements
[INFO] Cluster 10: 235 elements
[INFO] Cluster 11: 453 elements
[INFO] Cluster 12: 301 elements
[INFO] Cluster 13: 284 elements
[INFO] Cluster 14: 104 elements
[INFO] Cluster 15: 338 elements
[INFO] Cluster 16: 90 elements
[INFO] Cluster 17: 6 elements
[INFO] Cluster 18: 279 elements
[INFO] Cluster 19: 31 elements
[INFO] Cluster 20: 256 elements
[INFO] Cluster 21: 300 elements
[INFO] Cluster 22: 222 elements
[INFO] Cluster 23: 192 elements
[INFO] Cluster 24: 369 elements
[INFO] Cluster 25: 237 elements
[INFO] Cluster 26: 316 elements
[INFO] Cluster 27: 184 elements
[INFO] Cluster 28: 42 elements
[INFO] Cluster 29: 95 elements
[INFO] Cluster 30: 79 elements
[INFO] Cluster 31: 196 elements
[INFO] Cluster 32: 220 elements
[INFO] Cluster 33: 184 elements
[INFO] Cluster 34: 16 elements
[INFO] Cluster 35: 294 elements
[INFO] Cluster 36: 217 elements
[INFO] Cluster 37: 67 elements
[INFO] Cluster 38: 13 elements
[INFO] Cluster 39: 53 elements
[INFO] Cluster 40: 136 elements
[INFO] Cluster 41: 131 elements
[INFO] Cluster 42: 65 elements
[INFO] Cluster 43: 211 elements
[INFO] Cluster 44: 161 elements
[INFO] Cluster 45: 89 elements
[INFO] Cluster 46: 247 elements
[INFO] Cluster 47: 276 elements
[INFO] Cluster 48: 13 elements
[INFO] Cluster 49: 162 elements
[INFO] Using 46 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=56, Long SMA=60, Sharpe=-0.0740, Trades=95
[INFO] Cluster 1 cluster: Short SMA=24, Long SMA=148, Sharpe=0.0005, Trades=29
[INFO] Cluster 2 cluster: Short SMA=10, Long SMA=106, Sharpe=-0.3132, Trades=45
[INFO] Cluster 3 cluster: Short SMA=130, Long SMA=134, Sharpe=0.3153, Trades=67
[INFO] Cluster 4 cluster: Short SMA=210, Long SMA=266, Sharpe=-0.0504, Trades=13
[INFO] Cluster 5 cluster: Short SMA=248, Long SMA=282, Sharpe=-0.3674, Trades=15
[INFO] Cluster 6 cluster: Short SMA=174, Long SMA=262, Sharpe=0.0203, Trades=11
[INFO] Cluster 7 cluster: Short SMA=180, Long SMA=214, Sharpe=0.2739, Trades=15
[INFO] Cluster 8 cluster: Short SMA=108, Long SMA=200, Sharpe=-0.0120, Trades=13
[INFO] Cluster 9 cluster: Short SMA=116, Long SMA=162, Sharpe=0.4040, Trades=17
[INFO] Cluster 10 cluster: Short SMA=30, Long SMA=68, Sharpe=-0.0429, Trades=39
[INFO] Cluster 11 cluster: Short SMA=38, Long SMA=174, Sharpe=0.3098, Trades=21
[INFO] Cluster 12 cluster: Short SMA=40, Long SMA=104, Sharpe=0.2755, Trades=25
[INFO] Cluster 13 cluster: Short SMA=36, Long SMA=114, Sharpe=0.1956, Trades=21
[INFO] Cluster 14 cluster: Short SMA=154, Long SMA=164, Sharpe=-0.0144, Trades=39
[INFO] Cluster 15 cluster: Short SMA=74, Long SMA=140, Sharpe=0.3199, Trades=21
[INFO] Cluster 16 cluster: Short SMA=224, Long SMA=230, Sharpe=0.2095, Trades=35
[INFO] Cluster 18 cluster: Short SMA=40, Long SMA=284, Sharpe=-0.1483, Trades=15
[INFO] Cluster 19 cluster: Short SMA=172, Long SMA=174, Sharpe=-0.4261, Trades=83
[INFO] Cluster 20 cluster: Short SMA=210, Long SMA=286, Sharpe=-0.1991, Trades=11
[INFO] Cluster 21 cluster: Short SMA=66, Long SMA=244, Sharpe=-0.0148, Trades=13
[INFO] Cluster 22 cluster: Short SMA=74, Long SMA=110, Sharpe=0.1714, Trades=25
[INFO] Cluster 23 cluster: Short SMA=20, Long SMA=216, Sharpe=0.3544, Trades=25
[INFO] Cluster 24 cluster: Short SMA=138, Long SMA=240, Sharpe=-0.0511, Trades=11
[INFO] Cluster 25 cluster: Short SMA=94, Long SMA=166, Sharpe=0.1278, Trades=17
[INFO] Cluster 26 cluster: Short SMA=42, Long SMA=224, Sharpe=0.0189, Trades=17
[INFO] Cluster 27 cluster: Short SMA=70, Long SMA=88, Sharpe=0.0833, Trades=39
[INFO] Cluster 28 cluster: Short SMA=22, Long SMA=30, Sharpe=-0.1131, Trades=118
[INFO] Cluster 29 cluster: Short SMA=60, Long SMA=70, Sharpe=0.0733, Trades=65
[INFO] Cluster 30 cluster: Short SMA=190, Long SMA=204, Sharpe=0.3813, Trades=25
[INFO] Cluster 31 cluster: Short SMA=26, Long SMA=268, Sharpe=-0.0791, Trades=17
[INFO] Cluster 32 cluster: Short SMA=64, Long SMA=182, Sharpe=0.4094, Trades=15
[INFO] Cluster 33 cluster: Short SMA=160, Long SMA=288, Sharpe=-0.0821, Trades=11
[INFO] Cluster 35 cluster: Short SMA=212, Long SMA=246, Sharpe=0.0963, Trades=17
[INFO] Cluster 36 cluster: Short SMA=152, Long SMA=182, Sharpe=-0.2164, Trades=21
[INFO] Cluster 37 cluster: Short SMA=22, Long SMA=48, Sharpe=-0.1598, Trades=70
[INFO] Cluster 39 cluster: Short SMA=126, Long SMA=136, Sharpe=0.4034, Trades=45
[INFO] Cluster 40 cluster: Short SMA=136, Long SMA=180, Sharpe=-0.0609, Trades=17
[INFO] Cluster 41 cluster: Short SMA=14, Long SMA=244, Sharpe=0.2315, Trades=21
[INFO] Cluster 42 cluster: Short SMA=20, Long SMA=36, Sharpe=-0.5110, Trades=92
[INFO] Cluster 43 cluster: Short SMA=160, Long SMA=226, Sharpe=0.0788, Trades=11
[INFO] Cluster 44 cluster: Short SMA=68, Long SMA=210, Sharpe=0.1674, Trades=15
[INFO] Cluster 45 cluster: Short SMA=282, Long SMA=292, Sharpe=-0.0739, Trades=23
[INFO] Cluster 46 cluster: Short SMA=106, Long SMA=228, Sharpe=-0.0243, Trades=11
[INFO] Cluster 47 cluster: Short SMA=66, Long SMA=280, Sharpe=-0.1237, Trades=11
[INFO] Cluster 49 cluster: Short SMA=102, Long SMA=134, Sharpe=0.1685, Trades=23
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=126, Long SMA=144, Sharpe=0.6278, Trades=31
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=64, Long SMA=182, Sharpe=0.4094, Trades=15
[INFO] Top 2: Short SMA=116, Long SMA=162, Sharpe=0.4040, Trades=17
[INFO] Top 3: Short SMA=126, Long SMA=136, Sharpe=0.4034, Trades=45
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 46 valid clusters with clusters
[INFO] Filtering to 9687 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 126, Long SMA: 144
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(64/182) - Original Sharpe: 0.4094, Trades: 15
[INFO] Hierarchical cluster 2: SMA(116/162) - Original Sharpe: 0.4040, Trades: 17
[INFO] Hierarchical cluster 3: SMA(126/136) - Original Sharpe: 0.4034, Trades: 45
[INFO] Hierarchical cluster 4: SMA(190/204) - Original Sharpe: 0.3813, Trades: 25
[INFO] Hierarchical cluster 5: SMA(20/216) - Original Sharpe: 0.3544, Trades: 25
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (126/144)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (64/182) - Sharpe: 0.4094
[INFO] cluster 2: (116/162) - Sharpe: 0.4040
[INFO] cluster 3: (126/136) - Sharpe: 0.4034
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     1.943138            1.943138
1    2021-11-10 2021-11-10            41     2.726433            2.726433
2    2022-01-10 2022-01-10            41    -0.979722           -0.979722
3    2022-03-10 2022-03-10            42    -1.932434           -1.932434
4    2022-05-10 2022-05-10            41     2.781394            1.483445
5    2022-07-10 2022-07-10            44    -0.902683           -1.258010
6    2022-09-10 2022-09-10            43     4.781663            6.310151
7    2022-11-10 2022-11-10            40     0.520961            0.143581
8    2023-01-10 2023-01-10            41    -1.945501           -1.945501
9    2023-03-10 2023-03-10            42    -1.386296           -1.386296
10   2023-05-10 2023-05-10            40    -1.725343           -1.621066
11   2023-07-10 2023-07-10            44     0.054587           -1.223471
12   2023-09-10 2023-09-10            44    -3.556132           -3.556132
13   2023-11-10 2023-11-10            40    -1.024655           -1.650040
14   2024-01-10 2024-01-10            41     1.405934            0.876946
15   2024-03-10 2024-03-10            43     1.924896            1.924896
16   2024-05-10 2024-05-10            40     2.925387            2.925387
17   2024-07-10 2024-07-10            43     0.254368            0.254368
18   2024-09-10 2024-09-10            44     0.943102            0.943102
19   2024-11-10 2024-11-10            35     5.162860            5.162860
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-01-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |          2.8 |              1.5 |         -1.3 | False         
[INFO] 2022-07-10   |         -0.9 |             -1.3 |         -0.4 | False         
[INFO] 2022-09-10   |          4.8 |              6.3 |          1.5 | True          
[INFO] 2022-11-10   |          0.5 |              0.1 |         -0.4 | False         
[INFO] 2023-01-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -1.7 |             -1.6 |          0.1 | True          
[INFO] 2023-07-10   |          0.1 |             -1.2 |         -1.3 | False         
[INFO] 2023-09-10   |         -3.6 |             -3.6 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -1.0 |             -1.7 |         -0.7 | False         
[INFO] 2024-01-10   |          1.4 |              0.9 |         -0.5 | False         
[INFO] 2024-03-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-11-10   |          5.2 |              5.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2023-01-10, 2023-03-10, 2023-09-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 8 periods (25.00% win rate)
[INFO] Updating Excel file with Hierarchical results for KC...
[INFO] Excel file updated successfully. Added KC with Hierarchical win rate 25.0% in row 27
[INFO] Added best Sharpe parameters 126/144 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 126, Long SMA: 144
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(64/182) - Original Sharpe: 0.4094
[INFO] Added cluster 2 to portfolio: SMA(116/162) - Original Sharpe: 0.4040
[INFO] Added cluster 3 to portfolio: SMA(126/136) - Original Sharpe: 0.4034
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.4862
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6577
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for KC...
[INFO] Excel file updated successfully. Added KC with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KC
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for KW in column D: 18.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 142.47s
[INFO] Best parameters: Short SMA = 218, Long SMA = 300
[INFO] Best Sharpe ratio: 0.653288, Trades: 4
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @KW
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.20 contracts
[INFO] Maximum Position Size: 19 contracts
[INFO] Strategy Total P&L: $596,198.00
[INFO] Market Buy & Hold P&L: $-29,750.00
[INFO] Outperformance: $625,948.00
[INFO] Sharpe ratio (entire period, annualized): 0.656604
[INFO] Sharpe ratio (in-sample, annualized): 0.653288
[INFO] Sharpe ratio (out-of-sample, annualized): 0.664140
[INFO] Maximum Drawdown: $122,145.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 3
[INFO] Out-of-sample period trades: 1
[INFO] Total trades: 4
[INFO] In-sample P&L: $336,968.50
[INFO] Out-of-sample P&L: $154,779.50
[INFO] 
Best parameters from GA: Short SMA = 218, Long SMA = 300, Sharpe = 0.653288
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8976 to 0.6533
[INFO] 
Best parameters:
[INFO] Short SMA: 218
[INFO] Long SMA: 300
[INFO] Sharpe Ratio: 0.653288
[INFO] Number of Trades: 4
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9044 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8976 to 0.5917
[INFO] Trades range: 10.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2918 to 2.7703
[INFO] Scaled Long SMA range: -2.6926 to 1.6018
[INFO] Scaled Sharpe ratio range: -3.4124 to 3.0154
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 213 elements
[INFO] Kmeans Cluster 1: 170 elements
[INFO] Kmeans Cluster 2: 106 elements
[INFO] Kmeans Cluster 3: 241 elements
[INFO] Kmeans Cluster 4: 209 elements
[INFO] Kmeans Cluster 5: 286 elements
[INFO] Kmeans Cluster 6: 195 elements
[INFO] Kmeans Cluster 7: 168 elements
[INFO] Kmeans Cluster 8: 96 elements
[INFO] Kmeans Cluster 9: 173 elements
[INFO] Kmeans Cluster 10: 210 elements
[INFO] Kmeans Cluster 11: 184 elements
[INFO] Kmeans Cluster 12: 191 elements
[INFO] Kmeans Cluster 13: 205 elements
[INFO] Kmeans Cluster 14: 168 elements
[INFO] Kmeans Cluster 15: 127 elements
[INFO] Kmeans Cluster 16: 239 elements
[INFO] Kmeans Cluster 17: 166 elements
[INFO] Kmeans Cluster 18: 195 elements
[INFO] Kmeans Cluster 19: 144 elements
[INFO] Kmeans Cluster 20: 205 elements
[INFO] Kmeans Cluster 21: 137 elements
[INFO] Kmeans Cluster 22: 130 elements
[INFO] Kmeans Cluster 23: 188 elements
[INFO] Kmeans Cluster 24: 87 elements
[INFO] Kmeans Cluster 25: 112 elements
[INFO] Kmeans Cluster 26: 138 elements
[INFO] Kmeans Cluster 27: 183 elements
[INFO] Kmeans Cluster 28: 113 elements
[INFO] Kmeans Cluster 29: 286 elements
[INFO] Kmeans Cluster 30: 267 elements
[INFO] Kmeans Cluster 31: 223 elements
[INFO] Kmeans Cluster 32: 43 elements
[INFO] Kmeans Cluster 33: 231 elements
[INFO] Kmeans Cluster 34: 158 elements
[INFO] Kmeans Cluster 35: 243 elements
[INFO] Kmeans Cluster 36: 249 elements
[INFO] Kmeans Cluster 37: 194 elements
[INFO] Kmeans Cluster 38: 175 elements
[INFO] Kmeans Cluster 39: 195 elements
[INFO] Kmeans Cluster 40: 192 elements
[INFO] Kmeans Cluster 41: 144 elements
[INFO] Kmeans Cluster 42: 139 elements
[INFO] Kmeans Cluster 43: 164 elements
[INFO] Kmeans Cluster 44: 196 elements
[INFO] Kmeans Cluster 45: 289 elements
[INFO] Kmeans Cluster 46: 187 elements
[INFO] Kmeans Cluster 47: 173 elements
[INFO] Kmeans Cluster 48: 188 elements
[INFO] Kmeans Cluster 49: 129 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=32.85, Long SMA=223.85, Sharpe=-0.2964
[INFO] Centroid 1: Short SMA=174.26, Long SMA=257.84, Sharpe=0.1494
[INFO] Centroid 2: Short SMA=86.25, Long SMA=105.25, Sharpe=-0.4067
[INFO] Centroid 3: Short SMA=87.32, Long SMA=134.77, Sharpe=-0.1160
[INFO] Centroid 4: Short SMA=121.13, Long SMA=157.50, Sharpe=0.1682
[INFO] Centroid 5: Short SMA=261.45, Long SMA=283.64, Sharpe=0.2499
[INFO] Centroid 6: Short SMA=120.71, Long SMA=186.63, Sharpe=0.0684
[INFO] Centroid 7: Short SMA=14.25, Long SMA=243.57, Sharpe=-0.0493
[INFO] Centroid 8: Short SMA=19.85, Long SMA=39.73, Sharpe=-0.0158
[INFO] Centroid 9: Short SMA=63.66, Long SMA=239.97, Sharpe=-0.0674
[INFO] Centroid 10: Short SMA=60.16, Long SMA=242.45, Sharpe=-0.1883
[INFO] Centroid 11: Short SMA=69.36, Long SMA=176.05, Sharpe=-0.1604
[INFO] Centroid 12: Short SMA=149.91, Long SMA=242.74, Sharpe=-0.0772
[INFO] Centroid 13: Short SMA=225.90, Long SMA=260.01, Sharpe=0.1409
[INFO] Centroid 14: Short SMA=36.79, Long SMA=68.34, Sharpe=-0.5120
[INFO] Centroid 15: Short SMA=32.87, Long SMA=188.72, Sharpe=-0.4034
[INFO] Centroid 16: Short SMA=188.49, Long SMA=225.63, Sharpe=0.2036
[INFO] Centroid 17: Short SMA=24.96, Long SMA=285.08, Sharpe=-0.2427
[INFO] Centroid 18: Short SMA=16.49, Long SMA=184.22, Sharpe=-0.0616
[INFO] Centroid 19: Short SMA=151.86, Long SMA=276.72, Sharpe=0.0233
[INFO] Centroid 20: Short SMA=38.33, Long SMA=69.23, Sharpe=-0.3167
[INFO] Centroid 21: Short SMA=235.33, Long SMA=253.66, Sharpe=-0.0165
[INFO] Centroid 22: Short SMA=211.78, Long SMA=234.75, Sharpe=0.3979
[INFO] Centroid 23: Short SMA=29.18, Long SMA=265.63, Sharpe=-0.3834
[INFO] Centroid 24: Short SMA=32.34, Long SMA=93.52, Sharpe=0.0250
[INFO] Centroid 25: Short SMA=129.64, Long SMA=229.23, Sharpe=-0.3395
[INFO] Centroid 26: Short SMA=16.25, Long SMA=136.19, Sharpe=-0.2032
[INFO] Centroid 27: Short SMA=33.34, Long SMA=147.36, Sharpe=-0.5122
[INFO] Centroid 28: Short SMA=77.29, Long SMA=284.78, Sharpe=-0.0099
[INFO] Centroid 29: Short SMA=160.01, Long SMA=199.63, Sharpe=-0.1156
[INFO] Centroid 30: Short SMA=60.31, Long SMA=209.55, Sharpe=-0.1580
[INFO] Centroid 31: Short SMA=184.47, Long SMA=209.13, Sharpe=0.0216
[INFO] Centroid 32: Short SMA=42.70, Long SMA=53.12, Sharpe=-0.7505
[INFO] Centroid 33: Short SMA=74.88, Long SMA=120.38, Sharpe=-0.2476
[INFO] Centroid 34: Short SMA=21.04, Long SMA=53.24, Sharpe=-0.1922
[INFO] Centroid 35: Short SMA=141.46, Long SMA=177.51, Sharpe=-0.0301
[INFO] Centroid 36: Short SMA=200.92, Long SMA=263.82, Sharpe=0.2962
[INFO] Centroid 37: Short SMA=135.88, Long SMA=232.26, Sharpe=-0.2040
[INFO] Centroid 38: Short SMA=33.04, Long SMA=107.78, Sharpe=-0.5949
[INFO] Centroid 39: Short SMA=42.59, Long SMA=104.72, Sharpe=-0.4221
[INFO] Centroid 40: Short SMA=92.57, Long SMA=187.24, Sharpe=-0.0746
[INFO] Centroid 41: Short SMA=68.94, Long SMA=91.08, Sharpe=-0.1321
[INFO] Centroid 42: Short SMA=253.09, Long SMA=286.50, Sharpe=0.4171
[INFO] Centroid 43: Short SMA=116.16, Long SMA=134.13, Sharpe=0.0411
[INFO] Centroid 44: Short SMA=43.63, Long SMA=142.78, Sharpe=-0.3742
[INFO] Centroid 45: Short SMA=53.32, Long SMA=277.40, Sharpe=-0.1357
[INFO] Centroid 46: Short SMA=49.68, Long SMA=176.94, Sharpe=-0.2815
[INFO] Centroid 47: Short SMA=88.32, Long SMA=158.81, Sharpe=0.0132
[INFO] Centroid 48: Short SMA=113.29, Long SMA=222.11, Sharpe=-0.0846
[INFO] Centroid 49: Short SMA=143.21, Long SMA=159.92, Sharpe=-0.1645
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=218, Long SMA=300, Sharpe=0.6533, Trades=4
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=212, Long SMA=234, Sharpe=0.4528, Trades=16
[INFO] Kmeans Top 2: Short SMA=244, Long SMA=284, Sharpe=0.3834, Trades=12
[INFO] Kmeans Top 3: Short SMA=200, Long SMA=262, Sharpe=0.2778, Trades=10
[INFO] Kmeans Top 4: Short SMA=262, Long SMA=284, Sharpe=0.2022, Trades=16
[INFO] Kmeans Top 5: Short SMA=188, Long SMA=226, Sharpe=0.1870, Trades=14
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (33, 224)
[INFO]   Nearest: (32.0, 224.0)
[INFO]   Rounded: (174, 258)
[INFO]   Rounded: (86, 105)
[INFO]   Nearest: (86.0, 106.0)
[INFO]   Rounded: (87, 135)
[INFO]   Nearest: (88.0, 134.0)
[INFO]   Rounded: (121, 158)
[INFO]   Nearest: (122.0, 158.0)
[INFO]   Rounded: (261, 284)
[INFO]   Nearest: (262.0, 284.0)
[INFO]   Rounded: (121, 187)
[INFO]   Nearest: (120.0, 186.0)
[INFO]   Rounded: (14, 244)
[INFO]   Rounded: (20, 40)
[INFO]   Rounded: (64, 240)
[INFO]   Rounded: (60, 242)
[INFO]   Rounded: (69, 176)
[INFO]   Nearest: (70.0, 176.0)
[INFO]   Rounded: (150, 243)
[INFO]   Nearest: (150.0, 242.0)
[INFO]   Rounded: (226, 260)
[INFO]   Rounded: (37, 68)
[INFO]   Nearest: (36.0, 68.0)
[INFO]   Rounded: (33, 189)
[INFO]   Nearest: (32.0, 188.0)
[INFO]   Rounded: (188, 226)
[INFO]   Rounded: (25, 285)
[INFO]   Nearest: (24.0, 286.0)
[INFO]   Rounded: (16, 184)
[INFO]   Rounded: (152, 277)
[INFO]   Nearest: (152.0, 276.0)
[INFO]   Rounded: (38, 69)
[INFO]   Nearest: (38.0, 70.0)
[INFO]   Rounded: (235, 254)
[INFO]   Nearest: (236.0, 254.0)
[INFO]   Rounded: (212, 235)
[INFO]   Nearest: (212.0, 234.0)
[INFO]   Rounded: (29, 266)
[INFO]   Nearest: (30.0, 266.0)
[INFO]   Rounded: (32, 94)
[INFO]   Rounded: (130, 229)
[INFO]   Nearest: (130.0, 230.0)
[INFO]   Rounded: (16, 136)
[INFO]   Rounded: (33, 147)
[INFO]   Nearest: (34.0, 148.0)
[INFO]   Rounded: (77, 285)
[INFO]   Nearest: (78.0, 284.0)
[INFO]   Rounded: (160, 200)
[INFO]   Rounded: (60, 210)
[INFO]   Rounded: (184, 209)
[INFO]   Nearest: (184.0, 210.0)
[INFO]   Rounded: (43, 53)
[INFO]   Nearest: (42.0, 54.0)
[INFO]   Rounded: (75, 120)
[INFO]   Nearest: (74.0, 120.0)
[INFO]   Rounded: (21, 53)
[INFO]   Nearest: (22.0, 54.0)
[INFO]   Rounded: (141, 178)
[INFO]   Nearest: (142.0, 178.0)
[INFO]   Rounded: (201, 264)
[INFO]   Nearest: (200.0, 264.0)
[INFO]   Rounded: (136, 232)
[INFO]   Rounded: (33, 108)
[INFO]   Nearest: (34.0, 108.0)
[INFO]   Rounded: (43, 105)
[INFO]   Nearest: (42.0, 104.0)
[INFO]   Rounded: (93, 187)
[INFO]   Nearest: (92.0, 188.0)
[INFO]   Rounded: (69, 91)
[INFO]   Nearest: (68.0, 92.0)
[INFO]   Rounded: (253, 287)
[INFO]   Nearest: (254.0, 286.0)
[INFO]   Rounded: (116, 134)
[INFO]   Rounded: (44, 143)
[INFO]   Nearest: (44.0, 142.0)
[INFO]   Rounded: (53, 277)
[INFO]   Nearest: (54.0, 278.0)
[INFO]   Rounded: (50, 177)
[INFO]   Nearest: (50.0, 176.0)
[INFO]   Rounded: (88, 159)
[INFO]   Nearest: (88.0, 158.0)
[INFO]   Rounded: (113, 222)
[INFO]   Nearest: (114.0, 222.0)
[INFO]   Rounded: (143, 160)
[INFO]   Nearest: (144.0, 160.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 218, Long SMA: 300
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(212/234) - Original Sharpe: 0.4528, Trades: 16
[INFO] Kmeans cluster 2: SMA(244/284) - Original Sharpe: 0.3834, Trades: 12
[INFO] Kmeans cluster 3: SMA(200/262) - Original Sharpe: 0.2778, Trades: 10
[INFO] Kmeans cluster 4: SMA(262/284) - Original Sharpe: 0.2022, Trades: 16
[INFO] Kmeans cluster 5: SMA(188/226) - Original Sharpe: 0.1870, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (218/300)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (212/234) - Sharpe: 0.4528
[INFO] cluster 2: (244/284) - Sharpe: 0.3834
[INFO] cluster 3: (200/262) - Sharpe: 0.2778
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     3.716844            3.716844
1    2021-11-10 2021-11-10            41    -0.412472           -0.412472
2    2022-01-10 2022-01-10            41     4.290205            4.290205
3    2022-03-10 2022-03-10            42     0.696473            0.696473
4    2022-05-10 2022-05-10            41    -1.906913           -1.906913
5    2022-07-10 2022-07-10            44     0.008064            0.008064
6    2022-09-10 2022-09-10            43     0.059045            0.059045
7    2022-11-10 2022-11-10            40    -2.768953           -2.768953
8    2023-01-10 2023-01-10            41     0.901765            3.839864
9    2023-03-10 2023-03-10            42    -2.058673           -1.337630
10   2023-05-10 2023-05-10            40     0.600971            1.336074
11   2023-07-10 2023-07-10            44     1.747552            2.099193
12   2023-09-10 2023-09-10            44     2.993555            2.993555
13   2023-11-10 2023-11-10            40     0.817504            0.817504
14   2024-01-10 2024-01-10            41     1.290468            1.290468
15   2024-03-10 2024-03-10            43    -2.221917           -2.221917
16   2024-05-10 2024-05-10            40     2.247863            2.247863
17   2024-07-10 2024-07-10            43     0.009942            0.009942
18   2024-09-10 2024-09-10            44     0.461751            0.461751
19   2024-11-10 2024-11-10            35     0.788268            0.788268
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2022-01-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-03-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-10   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-11-10   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2023-01-10   |          0.9 |              3.8 |          2.9 | True          
[INFO] 2023-03-10   |         -2.1 |             -1.3 |          0.8 | True          
[INFO] 2023-05-10   |          0.6 |              1.3 |          0.7 | True          
[INFO] 2023-07-10   |          1.7 |              2.1 |          0.4 | True          
[INFO] 2023-09-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2024-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2022-05-10, 2022-07-10, 2022-09-10, 2022-11-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 4
[INFO] Kmeans cluster wins (rounded comparison): 4 of 4 periods (100.00% win rate)
[INFO] Updating Excel file with Kmeans results for KW...
[INFO] Excel file updated successfully. Added KW with Kmeans win rate 100.0% in row 28
[INFO] Added best Sharpe parameters 218/300 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 218, Long SMA: 300
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(212/234) - Original Sharpe: 0.4528
[INFO] Added cluster 2 to portfolio: SMA(244/284) - Original Sharpe: 0.3834
[INFO] Added cluster 3 to portfolio: SMA(200/262) - Original Sharpe: 0.2778
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KW_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.7934
[INFO] Kmeans Best out-of-sample Sharpe: 0.6641
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for KW...
[INFO] Excel file updated successfully. Added KW with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KW
[INFO] Big Point Value: 50.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8976 to 0.6533
[INFO] 
Best parameters:
[INFO] Short SMA: 218
[INFO] Long SMA: 300
[INFO] Sharpe Ratio: 0.653288
[INFO] Number of Trades: 4
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9044 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8976 to 0.5917
[INFO] Trades range: 10.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2918 to 2.7703
[INFO] Scaled Long SMA range: -2.6926 to 1.6018
[INFO] Scaled Sharpe ratio range: -3.4124 to 3.0154
[INFO] Scaled Trades range: -0.6668 to 14.7729
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9044 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5618
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 185 elements
[INFO] Cluster 1: 233 elements
[INFO] Cluster 2: 178 elements
[INFO] Cluster 3: 282 elements
[INFO] Cluster 4: 242 elements
[INFO] Cluster 5: 135 elements
[INFO] Cluster 6: 324 elements
[INFO] Cluster 7: 10 elements
[INFO] Cluster 8: 292 elements
[INFO] Cluster 9: 139 elements
[INFO] Cluster 10: 55 elements
[INFO] Cluster 11: 355 elements
[INFO] Cluster 12: 104 elements
[INFO] Cluster 13: 345 elements
[INFO] Cluster 14: 365 elements
[INFO] Cluster 15: 53 elements
[INFO] Cluster 16: 189 elements
[INFO] Cluster 17: 340 elements
[INFO] Cluster 18: 206 elements
[INFO] Cluster 19: 91 elements
[INFO] Cluster 20: 205 elements
[INFO] Cluster 21: 390 elements
[INFO] Cluster 22: 227 elements
[INFO] Cluster 23: 313 elements
[INFO] Cluster 24: 259 elements
[INFO] Cluster 25: 44 elements
[INFO] Cluster 26: 149 elements
[INFO] Cluster 27: 27 elements
[INFO] Cluster 28: 260 elements
[INFO] Cluster 29: 182 elements
[INFO] Cluster 30: 273 elements
[INFO] Cluster 31: 296 elements
[INFO] Cluster 32: 17 elements
[INFO] Cluster 33: 197 elements
[INFO] Cluster 34: 229 elements
[INFO] Cluster 35: 193 elements
[INFO] Cluster 36: 63 elements
[INFO] Cluster 37: 153 elements
[INFO] Cluster 38: 239 elements
[INFO] Cluster 39: 83 elements
[INFO] Cluster 40: 256 elements
[INFO] Cluster 41: 11 elements
[INFO] Cluster 42: 149 elements
[INFO] Cluster 43: 26 elements
[INFO] Cluster 44: 91 elements
[INFO] Cluster 45: 38 elements
[INFO] Cluster 46: 169 elements
[INFO] Cluster 47: 43 elements
[INFO] Cluster 48: 170 elements
[INFO] Cluster 49: 169 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=124, Long SMA=146, Sharpe=0.0903, Trades=34
[INFO] Cluster 1 cluster: Short SMA=90, Long SMA=120, Sharpe=-0.2567, Trades=34
[INFO] Cluster 2 cluster: Short SMA=46, Long SMA=76, Sharpe=-0.2566, Trades=46
[INFO] Cluster 3 cluster: Short SMA=36, Long SMA=78, Sharpe=-0.6261, Trades=44
[INFO] Cluster 4 cluster: Short SMA=32, Long SMA=138, Sharpe=-0.6343, Trades=26
[INFO] Cluster 5 cluster: Short SMA=22, Long SMA=44, Sharpe=-0.0448, Trades=72
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=272, Sharpe=-0.2992, Trades=18
[INFO] Cluster 8 cluster: Short SMA=50, Long SMA=148, Sharpe=-0.3727, Trades=18
[INFO] Cluster 9 cluster: Short SMA=60, Long SMA=88, Sharpe=-0.1159, Trades=45
[INFO] Cluster 10 cluster: Short SMA=116, Long SMA=120, Sharpe=0.1182, Trades=70
[INFO] Cluster 11 cluster: Short SMA=132, Long SMA=182, Sharpe=-0.0674, Trades=16
[INFO] Cluster 12 cluster: Short SMA=168, Long SMA=176, Sharpe=0.0885, Trades=50
[INFO] Cluster 13 cluster: Short SMA=184, Long SMA=242, Sharpe=0.2118, Trades=12
[INFO] Cluster 14 cluster: Short SMA=54, Long SMA=272, Sharpe=-0.1494, Trades=12
[INFO] Cluster 15 cluster: Short SMA=40, Long SMA=44, Sharpe=-0.2732, Trades=106
[INFO] Cluster 16 cluster: Short SMA=64, Long SMA=114, Sharpe=-0.2737, Trades=29
[INFO] Cluster 17 cluster: Short SMA=36, Long SMA=196, Sharpe=-0.3578, Trades=16
[INFO] Cluster 18 cluster: Short SMA=82, Long SMA=140, Sharpe=-0.0927, Trades=21
[INFO] Cluster 19 cluster: Short SMA=202, Long SMA=212, Sharpe=-0.0155, Trades=30
[INFO] Cluster 20 cluster: Short SMA=154, Long SMA=268, Sharpe=0.0127, Trades=10
[INFO] Cluster 21 cluster: Short SMA=56, Long SMA=232, Sharpe=-0.1697, Trades=10
[INFO] Cluster 22 cluster: Short SMA=16, Long SMA=242, Sharpe=-0.0623, Trades=20
[INFO] Cluster 23 cluster: Short SMA=260, Long SMA=284, Sharpe=0.2159, Trades=16
[INFO] Cluster 24 cluster: Short SMA=132, Long SMA=232, Sharpe=-0.4300, Trades=10
[INFO] Cluster 25 cluster: Short SMA=46, Long SMA=64, Sharpe=-0.6048, Trades=58
[INFO] Cluster 26 cluster: Short SMA=14, Long SMA=140, Sharpe=-0.2458, Trades=32
[INFO] Cluster 27 cluster: Short SMA=16, Long SMA=24, Sharpe=-0.0912, Trades=145
[INFO] Cluster 28 cluster: Short SMA=106, Long SMA=160, Sharpe=0.0962, Trades=16
[INFO] Cluster 29 cluster: Short SMA=16, Long SMA=182, Sharpe=-0.0057, Trades=24
[INFO] Cluster 30 cluster: Short SMA=66, Long SMA=184, Sharpe=-0.1769, Trades=14
[INFO] Cluster 31 cluster: Short SMA=156, Long SMA=198, Sharpe=-0.1290, Trades=16
[INFO] Cluster 33 cluster: Short SMA=34, Long SMA=106, Sharpe=-0.5119, Trades=38
[INFO] Cluster 34 cluster: Short SMA=202, Long SMA=262, Sharpe=0.3202, Trades=10
[INFO] Cluster 35 cluster: Short SMA=184, Long SMA=210, Sharpe=0.1478, Trades=20
[INFO] Cluster 36 cluster: Short SMA=56, Long SMA=62, Sharpe=-0.6486, Trades=80
[INFO] Cluster 37 cluster: Short SMA=234, Long SMA=256, Sharpe=0.0744, Trades=14
[INFO] Cluster 38 cluster: Short SMA=92, Long SMA=178, Sharpe=-0.1176, Trades=12
[INFO] Cluster 39 cluster: Short SMA=242, Long SMA=286, Sharpe=0.4405, Trades=12
[INFO] Cluster 40 cluster: Short SMA=148, Long SMA=240, Sharpe=-0.1702, Trades=12
[INFO] Cluster 42 cluster: Short SMA=70, Long SMA=284, Sharpe=-0.0239, Trades=10
[INFO] Cluster 43 cluster: Short SMA=162, Long SMA=166, Sharpe=-0.2076, Trades=84
[INFO] Cluster 44 cluster: Short SMA=214, Long SMA=232, Sharpe=0.4075, Trades=20
[INFO] Cluster 45 cluster: Short SMA=268, Long SMA=272, Sharpe=0.3361, Trades=30
[INFO] Cluster 46 cluster: Short SMA=112, Long SMA=216, Sharpe=-0.1775, Trades=10
[INFO] Cluster 47 cluster: Short SMA=100, Long SMA=106, Sharpe=-0.2195, Trades=65
[INFO] Cluster 48 cluster: Short SMA=220, Long SMA=258, Sharpe=0.0869, Trades=12
[INFO] Cluster 49 cluster: Short SMA=70, Long SMA=212, Sharpe=-0.0917, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=218, Long SMA=300, Sharpe=0.6533, Trades=4
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=242, Long SMA=286, Sharpe=0.4405, Trades=12
[INFO] Top 2: Short SMA=214, Long SMA=232, Sharpe=0.4075, Trades=20
[INFO] Top 3: Short SMA=268, Long SMA=272, Sharpe=0.3361, Trades=30
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 9006 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 218, Long SMA: 300
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(242/286) - Original Sharpe: 0.4405, Trades: 12
[INFO] Hierarchical cluster 2: SMA(214/232) - Original Sharpe: 0.4075, Trades: 20
[INFO] Hierarchical cluster 3: SMA(268/272) - Original Sharpe: 0.3361, Trades: 30
[INFO] Hierarchical cluster 4: SMA(202/262) - Original Sharpe: 0.3202, Trades: 10
[INFO] Hierarchical cluster 5: SMA(260/284) - Original Sharpe: 0.2159, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (218/300)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (242/286) - Sharpe: 0.4405
[INFO] cluster 2: (214/232) - Sharpe: 0.4075
[INFO] cluster 3: (268/272) - Sharpe: 0.3361
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     3.716844            3.716844
1    2021-11-10 2021-11-10            41    -0.412472           -0.412472
2    2022-01-10 2022-01-10            41     4.290205            4.290205
3    2022-03-10 2022-03-10            42     0.696473            0.696473
4    2022-05-10 2022-05-10            41    -1.906913           -1.906913
5    2022-07-10 2022-07-10            44     0.008064            0.008064
6    2022-09-10 2022-09-10            43     0.059045            0.059045
7    2022-11-10 2022-11-10            40    -2.768953           -2.768953
8    2023-01-10 2023-01-10            41     0.901765            0.041333
9    2023-03-10 2023-03-10            42    -2.058673            0.167853
10   2023-05-10 2023-05-10            40     0.600971            1.566265
11   2023-07-10 2023-07-10            44     1.747552            1.308938
12   2023-09-10 2023-09-10            44     2.993555            2.775302
13   2023-11-10 2023-11-10            40     0.817504            0.817504
14   2024-01-10 2024-01-10            41     1.290468            1.290468
15   2024-03-10 2024-03-10            43    -2.221917           -2.221917
16   2024-05-10 2024-05-10            40     2.247863            2.247863
17   2024-07-10 2024-07-10            43     0.009942            0.009942
18   2024-09-10 2024-09-10            44     0.461751            0.461751
19   2024-11-10 2024-11-10            35     0.788268            0.788268
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2022-01-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-03-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-10   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-11-10   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2023-01-10   |          0.9 |              0.0 |         -0.9 | False         
[INFO] 2023-03-10   |         -2.1 |              0.2 |          2.3 | True          
[INFO] 2023-05-10   |          0.6 |              1.6 |          1.0 | True          
[INFO] 2023-07-10   |          1.7 |              1.3 |         -0.4 | False         
[INFO] 2023-09-10   |          3.0 |              2.8 |         -0.2 | False         
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2024-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2022-05-10, 2022-07-10, 2022-09-10, 2022-11-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 5
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 5 periods (40.00% win rate)
[INFO] Updating Excel file with Hierarchical results for KW...
[INFO] Excel file updated successfully. Added KW with Hierarchical win rate 40.0% in row 28
[INFO] Added best Sharpe parameters 218/300 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 218, Long SMA: 300
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(242/286) - Original Sharpe: 0.4405
[INFO] Added cluster 2 to portfolio: SMA(214/232) - Original Sharpe: 0.4075
[INFO] Added cluster 3 to portfolio: SMA(268/272) - Original Sharpe: 0.3361
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KW_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.7571
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6641
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for KW...
[INFO] Excel file updated successfully. Added KW with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KW
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LC in column D: 13.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 123.51s
[INFO] Best parameters: Short SMA = 132, Long SMA = 256
[INFO] Best Sharpe ratio: 0.667366, Trades: 14
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LC
[INFO] Big Point Value (from data): 400.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.44 contracts
[INFO] Maximum Position Size: 19 contracts
[INFO] Strategy Total P&L: $356,156.00
[INFO] Market Buy & Hold P&L: $19,030.00
[INFO] Outperformance: $337,126.00
[INFO] Sharpe ratio (entire period, annualized): 0.433210
[INFO] Sharpe ratio (in-sample, annualized): 0.667366
[INFO] Sharpe ratio (out-of-sample, annualized): -0.118494
[INFO] Maximum Drawdown: $172,019.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 9
[INFO] Out-of-sample period trades: 5
[INFO] Total trades: 14
[INFO] In-sample P&L: $373,813.00
[INFO] Out-of-sample P&L: $-28,163.00
[INFO] 
Best parameters from GA: Short SMA = 132, Long SMA = 256, Sharpe = 0.667366
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 400.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7424 to 0.6674
[INFO] 
Best parameters:
[INFO] Short SMA: 132
[INFO] Long SMA: 256
[INFO] Sharpe Ratio: 0.667366
[INFO] Number of Trades: 14
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7424 to 0.6674
[INFO] Trades range: 12.0 to 373.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6486 to 2.9007
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 256 elements
[INFO] Kmeans Cluster 1: 208 elements
[INFO] Kmeans Cluster 2: 242 elements
[INFO] Kmeans Cluster 3: 216 elements
[INFO] Kmeans Cluster 4: 91 elements
[INFO] Kmeans Cluster 5: 230 elements
[INFO] Kmeans Cluster 6: 194 elements
[INFO] Kmeans Cluster 7: 260 elements
[INFO] Kmeans Cluster 8: 212 elements
[INFO] Kmeans Cluster 9: 104 elements
[INFO] Kmeans Cluster 10: 243 elements
[INFO] Kmeans Cluster 11: 338 elements
[INFO] Kmeans Cluster 12: 221 elements
[INFO] Kmeans Cluster 13: 393 elements
[INFO] Kmeans Cluster 14: 242 elements
[INFO] Kmeans Cluster 15: 146 elements
[INFO] Kmeans Cluster 16: 269 elements
[INFO] Kmeans Cluster 17: 194 elements
[INFO] Kmeans Cluster 18: 385 elements
[INFO] Kmeans Cluster 19: 206 elements
[INFO] Kmeans Cluster 20: 214 elements
[INFO] Kmeans Cluster 21: 325 elements
[INFO] Kmeans Cluster 22: 281 elements
[INFO] Kmeans Cluster 23: 136 elements
[INFO] Kmeans Cluster 24: 187 elements
[INFO] Kmeans Cluster 25: 149 elements
[INFO] Kmeans Cluster 26: 30 elements
[INFO] Kmeans Cluster 27: 281 elements
[INFO] Kmeans Cluster 28: 253 elements
[INFO] Kmeans Cluster 29: 233 elements
[INFO] Kmeans Cluster 30: 216 elements
[INFO] Kmeans Cluster 31: 191 elements
[INFO] Kmeans Cluster 32: 188 elements
[INFO] Kmeans Cluster 33: 165 elements
[INFO] Kmeans Cluster 34: 430 elements
[INFO] Kmeans Cluster 35: 226 elements
[INFO] Kmeans Cluster 36: 184 elements
[INFO] Kmeans Cluster 37: 221 elements
[INFO] Kmeans Cluster 38: 236 elements
[INFO] Kmeans Cluster 39: 98 elements
[INFO] Kmeans Cluster 40: 171 elements
[INFO] Kmeans Cluster 41: 166 elements
[INFO] Kmeans Cluster 42: 189 elements
[INFO] Kmeans Cluster 43: 185 elements
[INFO] Kmeans Cluster 44: 141 elements
[INFO] Kmeans Cluster 45: 121 elements
[INFO] Kmeans Cluster 46: 313 elements
[INFO] Kmeans Cluster 47: 115 elements
[INFO] Kmeans Cluster 48: 265 elements
[INFO] Kmeans Cluster 49: 25 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=125.13, Long SMA=285.23, Sharpe=-0.0141
[INFO] Centroid 1: Short SMA=52.76, Long SMA=102.64, Sharpe=-0.0267
[INFO] Centroid 2: Short SMA=254.57, Long SMA=286.45, Sharpe=-0.5501
[INFO] Centroid 3: Short SMA=76.69, Long SMA=204.95, Sharpe=-0.0612
[INFO] Centroid 4: Short SMA=172.20, Long SMA=189.13, Sharpe=-0.1458
[INFO] Centroid 5: Short SMA=32.85, Long SMA=278.89, Sharpe=-0.1257
[INFO] Centroid 6: Short SMA=136.12, Long SMA=249.94, Sharpe=0.5372
[INFO] Centroid 7: Short SMA=34.92, Long SMA=62.46, Sharpe=0.2769
[INFO] Centroid 8: Short SMA=24.99, Long SMA=161.67, Sharpe=-0.1841
[INFO] Centroid 9: Short SMA=196.25, Long SMA=216.45, Sharpe=0.3338
[INFO] Centroid 10: Short SMA=89.64, Long SMA=124.95, Sharpe=-0.2450
[INFO] Centroid 11: Short SMA=81.31, Long SMA=285.87, Sharpe=-0.2352
[INFO] Centroid 12: Short SMA=181.08, Long SMA=268.32, Sharpe=-0.1840
[INFO] Centroid 13: Short SMA=68.70, Long SMA=248.66, Sharpe=-0.0443
[INFO] Centroid 14: Short SMA=138.51, Long SMA=202.94, Sharpe=0.2010
[INFO] Centroid 15: Short SMA=265.70, Long SMA=278.22, Sharpe=-0.3298
[INFO] Centroid 16: Short SMA=99.67, Long SMA=181.43, Sharpe=-0.2218
[INFO] Centroid 17: Short SMA=177.78, Long SMA=245.28, Sharpe=0.0255
[INFO] Centroid 18: Short SMA=24.73, Long SMA=203.81, Sharpe=-0.0422
[INFO] Centroid 19: Short SMA=111.27, Long SMA=249.92, Sharpe=0.2312
[INFO] Centroid 20: Short SMA=131.50, Long SMA=166.36, Sharpe=0.0473
[INFO] Centroid 21: Short SMA=55.52, Long SMA=170.00, Sharpe=-0.2819
[INFO] Centroid 22: Short SMA=96.21, Long SMA=154.78, Sharpe=-0.3625
[INFO] Centroid 23: Short SMA=22.28, Long SMA=41.59, Sharpe=0.0728
[INFO] Centroid 24: Short SMA=126.78, Long SMA=155.88, Sharpe=-0.1350
[INFO] Centroid 25: Short SMA=152.93, Long SMA=171.37, Sharpe=0.3328
[INFO] Centroid 26: Short SMA=13.60, Long SMA=24.00, Sharpe=-0.2806
[INFO] Centroid 27: Short SMA=190.09, Long SMA=220.81, Sharpe=0.1479
[INFO] Centroid 28: Short SMA=27.36, Long SMA=77.53, Sharpe=0.4153
[INFO] Centroid 29: Short SMA=56.22, Long SMA=132.67, Sharpe=-0.1690
[INFO] Centroid 30: Short SMA=83.68, Long SMA=112.25, Sharpe=-0.0946
[INFO] Centroid 31: Short SMA=36.02, Long SMA=287.91, Sharpe=-0.3181
[INFO] Centroid 32: Short SMA=155.54, Long SMA=292.78, Sharpe=-0.2263
[INFO] Centroid 33: Short SMA=21.01, Long SMA=137.81, Sharpe=-0.0559
[INFO] Centroid 34: Short SMA=30.89, Long SMA=247.57, Sharpe=0.0444
[INFO] Centroid 35: Short SMA=54.82, Long SMA=206.58, Sharpe=-0.2222
[INFO] Centroid 36: Short SMA=167.76, Long SMA=202.64, Sharpe=0.0205
[INFO] Centroid 37: Short SMA=140.20, Long SMA=235.21, Sharpe=0.3916
[INFO] Centroid 38: Short SMA=231.36, Long SMA=256.40, Sharpe=-0.4379
[INFO] Centroid 39: Short SMA=97.10, Long SMA=111.92, Sharpe=-0.4177
[INFO] Centroid 40: Short SMA=154.71, Long SMA=256.89, Sharpe=0.2455
[INFO] Centroid 41: Short SMA=56.04, Long SMA=82.34, Sharpe=0.1197
[INFO] Centroid 42: Short SMA=104.35, Long SMA=248.42, Sharpe=0.0955
[INFO] Centroid 43: Short SMA=195.99, Long SMA=279.78, Sharpe=-0.3838
[INFO] Centroid 44: Short SMA=20.50, Long SMA=108.11, Sharpe=0.1717
[INFO] Centroid 45: Short SMA=216.36, Long SMA=240.69, Sharpe=-0.1265
[INFO] Centroid 46: Short SMA=218.54, Long SMA=283.31, Sharpe=-0.5261
[INFO] Centroid 47: Short SMA=43.23, Long SMA=142.33, Sharpe=-0.3700
[INFO] Centroid 48: Short SMA=101.13, Long SMA=213.06, Sharpe=-0.1150
[INFO] Centroid 49: Short SMA=287.84, Long SMA=294.96, Sharpe=-0.0673
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=132, Long SMA=256, Sharpe=0.6674, Trades=14
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=136, Long SMA=252, Sharpe=0.6171, Trades=14
[INFO] Kmeans Top 2: Short SMA=154, Long SMA=172, Sharpe=0.5522, Trades=34
[INFO] Kmeans Top 3: Short SMA=26, Long SMA=80, Sharpe=0.5017, Trades=32
[INFO] Kmeans Top 4: Short SMA=142, Long SMA=234, Sharpe=0.4058, Trades=14
[INFO] Kmeans Top 5: Short SMA=198, Long SMA=218, Sharpe=0.3679, Trades=30
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (125, 285)
[INFO]   Nearest: (126.0, 286.0)
[INFO]   Rounded: (53, 103)
[INFO]   Nearest: (52.0, 102.0)
[INFO]   Rounded: (255, 286)
[INFO]   Nearest: (254.0, 286.0)
[INFO]   Rounded: (77, 205)
[INFO]   Nearest: (76.0, 204.0)
[INFO]   Rounded: (172, 189)
[INFO]   Nearest: (172.0, 190.0)
[INFO]   Rounded: (33, 279)
[INFO]   Nearest: (32.0, 278.0)
[INFO]   Rounded: (136, 250)
[INFO]   Rounded: (35, 62)
[INFO]   Nearest: (34.0, 62.0)
[INFO]   Rounded: (25, 162)
[INFO]   Nearest: (24.0, 162.0)
[INFO]   Rounded: (196, 216)
[INFO]   Rounded: (90, 125)
[INFO]   Nearest: (90.0, 124.0)
[INFO]   Rounded: (81, 286)
[INFO]   Nearest: (82.0, 286.0)
[INFO]   Rounded: (181, 268)
[INFO]   Nearest: (182.0, 268.0)
[INFO]   Rounded: (69, 249)
[INFO]   Nearest: (68.0, 248.0)
[INFO]   Rounded: (139, 203)
[INFO]   Nearest: (138.0, 202.0)
[INFO]   Rounded: (266, 278)
[INFO]   Rounded: (100, 181)
[INFO]   Nearest: (100.0, 182.0)
[INFO]   Rounded: (178, 245)
[INFO]   Nearest: (178.0, 246.0)
[INFO]   Rounded: (25, 204)
[INFO]   Nearest: (24.0, 204.0)
[INFO]   Rounded: (111, 250)
[INFO]   Nearest: (112.0, 250.0)
[INFO]   Rounded: (132, 166)
[INFO]   Rounded: (56, 170)
[INFO]   Rounded: (96, 155)
[INFO]   Nearest: (96.0, 154.0)
[INFO]   Rounded: (22, 42)
[INFO]   Rounded: (127, 156)
[INFO]   Nearest: (126.0, 156.0)
[INFO]   Rounded: (153, 171)
[INFO]   Nearest: (152.0, 172.0)
[INFO]   Rounded: (14, 24)
[INFO]   Rounded: (190, 221)
[INFO]   Nearest: (190.0, 220.0)
[INFO]   Rounded: (27, 78)
[INFO]   Nearest: (28.0, 78.0)
[INFO]   Rounded: (56, 133)
[INFO]   Nearest: (56.0, 132.0)
[INFO]   Rounded: (84, 112)
[INFO]   Rounded: (36, 288)
[INFO]   Rounded: (156, 293)
[INFO]   Nearest: (156.0, 292.0)
[INFO]   Rounded: (21, 138)
[INFO]   Nearest: (22.0, 138.0)
[INFO]   Rounded: (31, 248)
[INFO]   Nearest: (30.0, 248.0)
[INFO]   Rounded: (55, 207)
[INFO]   Nearest: (54.0, 206.0)
[INFO]   Rounded: (168, 203)
[INFO]   Nearest: (168.0, 202.0)
[INFO]   Rounded: (140, 235)
[INFO]   Nearest: (140.0, 236.0)
[INFO]   Rounded: (231, 256)
[INFO]   Nearest: (232.0, 256.0)
[INFO]   Rounded: (97, 112)
[INFO]   Nearest: (98.0, 112.0)
[INFO]   Rounded: (155, 257)
[INFO]   Nearest: (154.0, 256.0)
[INFO]   Rounded: (56, 82)
[INFO]   Rounded: (104, 248)
[INFO]   Rounded: (196, 280)
[INFO]   Rounded: (20, 108)
[INFO]   Rounded: (216, 241)
[INFO]   Nearest: (216.0, 240.0)
[INFO]   Rounded: (219, 283)
[INFO]   Nearest: (218.0, 284.0)
[INFO]   Rounded: (43, 142)
[INFO]   Nearest: (44.0, 142.0)
[INFO]   Rounded: (101, 213)
[INFO]   Nearest: (102.0, 214.0)
[INFO]   Rounded: (288, 295)
[INFO]   Nearest: (288.0, 294.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 132, Long SMA: 256
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(136/252) - Original Sharpe: 0.6171, Trades: 14
[INFO] Kmeans cluster 2: SMA(154/172) - Original Sharpe: 0.5522, Trades: 34
[INFO] Kmeans cluster 3: SMA(26/80) - Original Sharpe: 0.5017, Trades: 32
[INFO] Kmeans cluster 4: SMA(142/234) - Original Sharpe: 0.4058, Trades: 14
[INFO] Kmeans cluster 5: SMA(198/218) - Original Sharpe: 0.3679, Trades: 30
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (132/256)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (136/252) - Sharpe: 0.6171
[INFO] cluster 2: (154/172) - Sharpe: 0.5522
[INFO] cluster 3: (26/80) - Sharpe: 0.5017
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.063439           -1.402009
1    2021-11-10 2021-11-10            41    -1.314198           -2.791578
2    2022-01-10 2022-01-10            41    -5.643048           -3.230400
3    2022-03-10 2022-03-10            42    -0.325669           -0.417473
4    2022-05-10 2022-05-10            41     0.167451            0.167451
5    2022-07-10 2022-07-10            44    -0.540213            3.122310
6    2022-09-10 2022-09-10            43    -0.837964           -2.152975
7    2022-11-10 2022-11-10            40     0.541236            1.741396
8    2023-01-10 2023-01-10            41     1.733004            1.733004
9    2023-03-10 2023-03-10            42     1.762416            1.762416
10   2023-05-10 2023-05-10            40     4.337990            4.337990
11   2023-07-10 2023-07-10            44     1.358879            1.358879
12   2023-09-10 2023-09-10            44    -2.443328           -1.692257
13   2023-11-10 2023-11-10            40    -0.939135           -0.939135
14   2024-01-10 2024-01-10            41     4.199481            3.310826
15   2024-03-10 2024-03-10            43    -1.906869           -0.696747
16   2024-05-10 2024-05-10            40    -2.345527           -2.711415
17   2024-07-10 2024-07-10            43    -1.402768           -2.115200
18   2024-09-10 2024-09-10            44     1.583600            1.328281
19   2024-11-10 2024-11-10            35     2.423431            2.381075
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.1 |             -1.4 |         -0.3 | False         
[INFO] 2021-11-10   |         -1.3 |             -2.8 |         -1.5 | False         
[INFO] 2022-01-10   |         -5.6 |             -3.2 |          2.4 | True          
[INFO] 2022-03-10   |         -0.3 |             -0.4 |         -0.1 | False         
[INFO] 2022-05-10   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.5 |              3.1 |          3.6 | True          
[INFO] 2022-09-10   |         -0.8 |             -2.2 |         -1.4 | False         
[INFO] 2022-11-10   |          0.5 |              1.7 |          1.2 | True          
[INFO] 2023-01-10   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-10   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2023-05-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2023-07-10   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -2.4 |             -1.7 |          0.7 | True          
[INFO] 2023-11-10   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-01-10   |          4.2 |              3.3 |         -0.9 | False         
[INFO] 2024-03-10   |         -1.9 |             -0.7 |          1.2 | True          
[INFO] 2024-05-10   |         -2.3 |             -2.7 |         -0.4 | False         
[INFO] 2024-07-10   |         -1.4 |             -2.1 |         -0.7 | False         
[INFO] 2024-09-10   |          1.6 |              1.3 |         -0.3 | False         
[INFO] 2024-11-10   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-11-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 5 of 13 periods (38.46% win rate)
[INFO] Updating Excel file with Kmeans results for LC...
[INFO] Excel file updated successfully. Added LC with Kmeans win rate 38.5% in row 29
[INFO] Added best Sharpe parameters 132/256 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 132, Long SMA: 256
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(136/252) - Original Sharpe: 0.6171
[INFO] Added cluster 2 to portfolio: SMA(154/172) - Original Sharpe: 0.5522
[INFO] Added cluster 3 to portfolio: SMA(26/80) - Original Sharpe: 0.5017
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2538
[INFO] Kmeans Best out-of-sample Sharpe: -0.1185
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for LC...
[INFO] Excel file updated successfully. Added LC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LC
[INFO] Big Point Value: 400.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7424 to 0.6674
[INFO] 
Best parameters:
[INFO] Short SMA: 132
[INFO] Long SMA: 256
[INFO] Sharpe Ratio: 0.667366
[INFO] Number of Trades: 14
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7424 to 0.6674
[INFO] Trades range: 12.0 to 373.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6486 to 2.9007
[INFO] Scaled Trades range: -0.7810 to 17.3722
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6075
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 478 elements
[INFO] Cluster 1: 15 elements
[INFO] Cluster 2: 352 elements
[INFO] Cluster 3: 133 elements
[INFO] Cluster 4: 419 elements
[INFO] Cluster 5: 89 elements
[INFO] Cluster 6: 246 elements
[INFO] Cluster 7: 270 elements
[INFO] Cluster 8: 526 elements
[INFO] Cluster 9: 410 elements
[INFO] Cluster 10: 325 elements
[INFO] Cluster 11: 150 elements
[INFO] Cluster 12: 56 elements
[INFO] Cluster 13: 337 elements
[INFO] Cluster 14: 343 elements
[INFO] Cluster 15: 201 elements
[INFO] Cluster 16: 230 elements
[INFO] Cluster 17: 283 elements
[INFO] Cluster 18: 390 elements
[INFO] Cluster 19: 272 elements
[INFO] Cluster 20: 275 elements
[INFO] Cluster 21: 316 elements
[INFO] Cluster 22: 36 elements
[INFO] Cluster 23: 28 elements
[INFO] Cluster 24: 391 elements
[INFO] Cluster 25: 392 elements
[INFO] Cluster 26: 146 elements
[INFO] Cluster 27: 253 elements
[INFO] Cluster 28: 128 elements
[INFO] Cluster 29: 164 elements
[INFO] Cluster 30: 4 elements
[INFO] Cluster 31: 207 elements
[INFO] Cluster 32: 159 elements
[INFO] Cluster 33: 193 elements
[INFO] Cluster 34: 46 elements
[INFO] Cluster 35: 106 elements
[INFO] Cluster 36: 257 elements
[INFO] Cluster 37: 334 elements
[INFO] Cluster 38: 76 elements
[INFO] Cluster 39: 193 elements
[INFO] Cluster 40: 48 elements
[INFO] Cluster 41: 65 elements
[INFO] Cluster 42: 167 elements
[INFO] Cluster 43: 486 elements
[INFO] Cluster 44: 81 elements
[INFO] Cluster 45: 94 elements
[INFO] Cluster 46: 111 elements
[INFO] Cluster 47: 146 elements
[INFO] Cluster 48: 135 elements
[INFO] Cluster 49: 23 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=100, Long SMA=178, Sharpe=-0.2394, Trades=20
[INFO] Cluster 2 cluster: Short SMA=26, Long SMA=202, Sharpe=-0.0906, Trades=22
[INFO] Cluster 3 cluster: Short SMA=30, Long SMA=46, Sharpe=0.2510, Trades=75
[INFO] Cluster 4 cluster: Short SMA=26, Long SMA=156, Sharpe=-0.2245, Trades=30
[INFO] Cluster 5 cluster: Short SMA=262, Long SMA=266, Sharpe=-0.0947, Trades=63
[INFO] Cluster 6 cluster: Short SMA=188, Long SMA=224, Sharpe=0.2513, Trades=25
[INFO] Cluster 7 cluster: Short SMA=116, Long SMA=280, Sharpe=0.0504, Trades=15
[INFO] Cluster 8 cluster: Short SMA=72, Long SMA=128, Sharpe=-0.1420, Trades=26
[INFO] Cluster 9 cluster: Short SMA=138, Long SMA=246, Sharpe=0.5967, Trades=14
[INFO] Cluster 10 cluster: Short SMA=32, Long SMA=102, Sharpe=0.2584, Trades=32
[INFO] Cluster 11 cluster: Short SMA=204, Long SMA=244, Sharpe=-0.1458, Trades=25
[INFO] Cluster 12 cluster: Short SMA=176, Long SMA=178, Sharpe=-0.3760, Trades=100
[INFO] Cluster 13 cluster: Short SMA=46, Long SMA=248, Sharpe=-0.0302, Trades=18
[INFO] Cluster 14 cluster: Short SMA=54, Long SMA=158, Sharpe=-0.2851, Trades=20
[INFO] Cluster 15 cluster: Short SMA=40, Long SMA=286, Sharpe=-0.2680, Trades=25
[INFO] Cluster 16 cluster: Short SMA=166, Long SMA=258, Sharpe=0.1442, Trades=13
[INFO] Cluster 17 cluster: Short SMA=262, Long SMA=282, Sharpe=-0.3665, Trades=31
[INFO] Cluster 18 cluster: Short SMA=170, Long SMA=282, Sharpe=-0.2089, Trades=13
[INFO] Cluster 19 cluster: Short SMA=150, Long SMA=198, Sharpe=0.2100, Trades=24
[INFO] Cluster 20 cluster: Short SMA=28, Long SMA=60, Sharpe=0.1866, Trades=47
[INFO] Cluster 21 cluster: Short SMA=112, Long SMA=238, Sharpe=0.2581, Trades=16
[INFO] Cluster 22 cluster: Short SMA=84, Long SMA=86, Sharpe=-0.2862, Trades=114
[INFO] Cluster 23 cluster: Short SMA=42, Long SMA=44, Sharpe=-0.0135, Trades=166
[INFO] Cluster 24 cluster: Short SMA=226, Long SMA=284, Sharpe=-0.5561, Trades=17
[INFO] Cluster 25 cluster: Short SMA=78, Long SMA=286, Sharpe=-0.2798, Trades=15
[INFO] Cluster 26 cluster: Short SMA=158, Long SMA=254, Sharpe=0.2662, Trades=13
[INFO] Cluster 27 cluster: Short SMA=102, Long SMA=148, Sharpe=-0.3834, Trades=28
[INFO] Cluster 28 cluster: Short SMA=152, Long SMA=172, Sharpe=0.3737, Trades=34
[INFO] Cluster 29 cluster: Short SMA=26, Long SMA=82, Sharpe=0.5313, Trades=34
[INFO] Cluster 31 cluster: Short SMA=54, Long SMA=104, Sharpe=-0.0191, Trades=28
[INFO] Cluster 32 cluster: Short SMA=132, Long SMA=154, Sharpe=-0.1392, Trades=34
[INFO] Cluster 33 cluster: Short SMA=56, Long SMA=208, Sharpe=-0.2409, Trades=20
[INFO] Cluster 34 cluster: Short SMA=172, Long SMA=178, Sharpe=-0.1872, Trades=58
[INFO] Cluster 35 cluster: Short SMA=84, Long SMA=106, Sharpe=-0.2733, Trades=34
[INFO] Cluster 36 cluster: Short SMA=20, Long SMA=248, Sharpe=0.0777, Trades=30
[INFO] Cluster 37 cluster: Short SMA=94, Long SMA=208, Sharpe=-0.0932, Trades=16
[INFO] Cluster 38 cluster: Short SMA=230, Long SMA=240, Sharpe=-0.3174, Trades=43
[INFO] Cluster 39 cluster: Short SMA=198, Long SMA=282, Sharpe=-0.4368, Trades=13
[INFO] Cluster 40 cluster: Short SMA=186, Long SMA=190, Sharpe=0.2070, Trades=70
[INFO] Cluster 41 cluster: Short SMA=32, Long SMA=38, Sharpe=0.1894, Trades=106
[INFO] Cluster 42 cluster: Short SMA=30, Long SMA=280, Sharpe=-0.1780, Trades=25
[INFO] Cluster 43 cluster: Short SMA=78, Long SMA=238, Sharpe=0.0900, Trades=18
[INFO] Cluster 44 cluster: Short SMA=110, Long SMA=118, Sharpe=-0.2332, Trades=53
[INFO] Cluster 45 cluster: Short SMA=198, Long SMA=210, Sharpe=0.1678, Trades=41
[INFO] Cluster 46 cluster: Short SMA=168, Long SMA=196, Sharpe=-0.0055, Trades=30
[INFO] Cluster 47 cluster: Short SMA=222, Long SMA=256, Sharpe=-0.4175, Trades=25
[INFO] Cluster 48 cluster: Short SMA=138, Long SMA=202, Sharpe=0.2299, Trades=20
[INFO] Cluster 49 cluster: Short SMA=102, Long SMA=106, Sharpe=-0.3398, Trades=78
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=132, Long SMA=256, Sharpe=0.6674, Trades=14
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=138, Long SMA=246, Sharpe=0.5967, Trades=14
[INFO] Top 2: Short SMA=26, Long SMA=82, Sharpe=0.5313, Trades=34
[INFO] Top 3: Short SMA=152, Long SMA=172, Sharpe=0.3737, Trades=34
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10566 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 132, Long SMA: 256
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(138/246) - Original Sharpe: 0.5967, Trades: 14
[INFO] Hierarchical cluster 2: SMA(26/82) - Original Sharpe: 0.5313, Trades: 34
[INFO] Hierarchical cluster 3: SMA(152/172) - Original Sharpe: 0.3737, Trades: 34
[INFO] Hierarchical cluster 4: SMA(158/254) - Original Sharpe: 0.2662, Trades: 13
[INFO] Hierarchical cluster 5: SMA(32/102) - Original Sharpe: 0.2584, Trades: 32
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (132/256)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (138/246) - Sharpe: 0.5967
[INFO] cluster 2: (26/82) - Sharpe: 0.5313
[INFO] cluster 3: (152/172) - Sharpe: 0.3737
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.063439           -1.402009
1    2021-11-10 2021-11-10            41    -1.314198           -2.609414
2    2022-01-10 2022-01-10            41    -5.643048           -2.945744
3    2022-03-10 2022-03-10            42    -0.325669            0.959289
4    2022-05-10 2022-05-10            41     0.167451            0.167451
5    2022-07-10 2022-07-10            44    -0.540213            1.708677
6    2022-09-10 2022-09-10            43    -0.837964           -2.152975
7    2022-11-10 2022-11-10            40     0.541236            1.495133
8    2023-01-10 2023-01-10            41     1.733004            1.733004
9    2023-03-10 2023-03-10            42     1.762416            1.762416
10   2023-05-10 2023-05-10            40     4.337990            4.337990
11   2023-07-10 2023-07-10            44     1.358879            1.358879
12   2023-09-10 2023-09-10            44    -2.443328           -1.543865
13   2023-11-10 2023-11-10            40    -0.939135           -0.939135
14   2024-01-10 2024-01-10            41     4.199481            2.798215
15   2024-03-10 2024-03-10            43    -1.906869           -0.982986
16   2024-05-10 2024-05-10            40    -2.345527           -3.376726
17   2024-07-10 2024-07-10            43    -1.402768           -1.672777
18   2024-09-10 2024-09-10            44     1.583600           -0.453294
19   2024-11-10 2024-11-10            35     2.423431            2.423431
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.1 |             -1.4 |         -0.3 | False         
[INFO] 2021-11-10   |         -1.3 |             -2.6 |         -1.3 | False         
[INFO] 2022-01-10   |         -5.6 |             -2.9 |          2.7 | True          
[INFO] 2022-03-10   |         -0.3 |              1.0 |          1.3 | True          
[INFO] 2022-05-10   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.5 |              1.7 |          2.2 | True          
[INFO] 2022-09-10   |         -0.8 |             -2.2 |         -1.4 | False         
[INFO] 2022-11-10   |          0.5 |              1.5 |          1.0 | True          
[INFO] 2023-01-10   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-10   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2023-05-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2023-07-10   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -2.4 |             -1.5 |          0.9 | True          
[INFO] 2023-11-10   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-01-10   |          4.2 |              2.8 |         -1.4 | False         
[INFO] 2024-03-10   |         -1.9 |             -1.0 |          0.9 | True          
[INFO] 2024-05-10   |         -2.3 |             -3.4 |         -1.1 | False         
[INFO] 2024-07-10   |         -1.4 |             -1.7 |         -0.3 | False         
[INFO] 2024-09-10   |          1.6 |             -0.5 |         -2.1 | False         
[INFO] 2024-11-10   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-11-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 13 periods (46.15% win rate)
[INFO] Updating Excel file with Hierarchical results for LC...
[INFO] Excel file updated successfully. Added LC with Hierarchical win rate 46.2% in row 29
[INFO] Added best Sharpe parameters 132/256 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 132, Long SMA: 256
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(138/246) - Original Sharpe: 0.5967
[INFO] Added cluster 2 to portfolio: SMA(26/82) - Original Sharpe: 0.5313
[INFO] Added cluster 3 to portfolio: SMA(152/172) - Original Sharpe: 0.3737
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2122
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1185
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for LC...
[INFO] Excel file updated successfully. Added LC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LC
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LH in column D: 17.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 123.77s
[INFO] Best parameters: Short SMA = 22, Long SMA = 32
[INFO] Best Sharpe ratio: 1.140809, Trades: 90
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LH
[INFO] Big Point Value (from data): 400.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.56 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $871,258.00
[INFO] Market Buy & Hold P&L: $-13,970.00
[INFO] Outperformance: $885,228.00
[INFO] Sharpe ratio (entire period, annualized): 0.831820
[INFO] Sharpe ratio (in-sample, annualized): 1.140809
[INFO] Sharpe ratio (out-of-sample, annualized): 0.115284
[INFO] Maximum Drawdown: $109,300.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 60
[INFO] Out-of-sample period trades: 30
[INFO] Total trades: 90
[INFO] In-sample P&L: $656,660.00
[INFO] Out-of-sample P&L: $28,587.00
[INFO] 
Best parameters from GA: Short SMA = 22, Long SMA = 32, Sharpe = 1.140809
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 400.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8288 to 1.1408
[INFO] 
Best parameters:
[INFO] Short SMA: 22
[INFO] Long SMA: 32
[INFO] Sharpe Ratio: 1.140809
[INFO] Number of Trades: 90
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8288 to 1.1408
[INFO] Trades range: 14.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8198 to 3.1932
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 238 elements
[INFO] Kmeans Cluster 1: 250 elements
[INFO] Kmeans Cluster 2: 160 elements
[INFO] Kmeans Cluster 3: 282 elements
[INFO] Kmeans Cluster 4: 257 elements
[INFO] Kmeans Cluster 5: 166 elements
[INFO] Kmeans Cluster 6: 335 elements
[INFO] Kmeans Cluster 7: 244 elements
[INFO] Kmeans Cluster 8: 254 elements
[INFO] Kmeans Cluster 9: 238 elements
[INFO] Kmeans Cluster 10: 74 elements
[INFO] Kmeans Cluster 11: 144 elements
[INFO] Kmeans Cluster 12: 219 elements
[INFO] Kmeans Cluster 13: 295 elements
[INFO] Kmeans Cluster 14: 95 elements
[INFO] Kmeans Cluster 15: 334 elements
[INFO] Kmeans Cluster 16: 237 elements
[INFO] Kmeans Cluster 17: 105 elements
[INFO] Kmeans Cluster 18: 284 elements
[INFO] Kmeans Cluster 19: 318 elements
[INFO] Kmeans Cluster 20: 166 elements
[INFO] Kmeans Cluster 21: 282 elements
[INFO] Kmeans Cluster 22: 317 elements
[INFO] Kmeans Cluster 23: 187 elements
[INFO] Kmeans Cluster 24: 268 elements
[INFO] Kmeans Cluster 25: 113 elements
[INFO] Kmeans Cluster 26: 124 elements
[INFO] Kmeans Cluster 27: 226 elements
[INFO] Kmeans Cluster 28: 154 elements
[INFO] Kmeans Cluster 29: 178 elements
[INFO] Kmeans Cluster 30: 203 elements
[INFO] Kmeans Cluster 31: 216 elements
[INFO] Kmeans Cluster 32: 245 elements
[INFO] Kmeans Cluster 33: 133 elements
[INFO] Kmeans Cluster 34: 156 elements
[INFO] Kmeans Cluster 35: 155 elements
[INFO] Kmeans Cluster 36: 324 elements
[INFO] Kmeans Cluster 37: 220 elements
[INFO] Kmeans Cluster 38: 247 elements
[INFO] Kmeans Cluster 39: 100 elements
[INFO] Kmeans Cluster 40: 206 elements
[INFO] Kmeans Cluster 41: 229 elements
[INFO] Kmeans Cluster 42: 294 elements
[INFO] Kmeans Cluster 43: 189 elements
[INFO] Kmeans Cluster 44: 180 elements
[INFO] Kmeans Cluster 45: 165 elements
[INFO] Kmeans Cluster 46: 179 elements
[INFO] Kmeans Cluster 47: 142 elements
[INFO] Kmeans Cluster 48: 206 elements
[INFO] Kmeans Cluster 49: 252 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=102.03, Long SMA=285.94, Sharpe=0.3001
[INFO] Centroid 1: Short SMA=48.78, Long SMA=115.47, Sharpe=-0.2239
[INFO] Centroid 2: Short SMA=224.33, Long SMA=280.00, Sharpe=-0.3001
[INFO] Centroid 3: Short SMA=25.88, Long SMA=220.97, Sharpe=0.1414
[INFO] Centroid 4: Short SMA=139.18, Long SMA=163.63, Sharpe=0.5301
[INFO] Centroid 5: Short SMA=17.30, Long SMA=122.59, Sharpe=0.2746
[INFO] Centroid 6: Short SMA=173.52, Long SMA=242.57, Sharpe=0.0397
[INFO] Centroid 7: Short SMA=68.02, Long SMA=242.09, Sharpe=0.4365
[INFO] Centroid 8: Short SMA=167.55, Long SMA=193.54, Sharpe=0.4009
[INFO] Centroid 9: Short SMA=57.34, Long SMA=154.68, Sharpe=-0.3258
[INFO] Centroid 10: Short SMA=18.70, Long SMA=36.95, Sharpe=0.7976
[INFO] Centroid 11: Short SMA=28.72, Long SMA=287.56, Sharpe=-0.0749
[INFO] Centroid 12: Short SMA=127.03, Long SMA=229.78, Sharpe=0.4357
[INFO] Centroid 13: Short SMA=212.43, Long SMA=243.54, Sharpe=-0.2639
[INFO] Centroid 14: Short SMA=95.62, Long SMA=134.11, Sharpe=0.0351
[INFO] Centroid 15: Short SMA=58.67, Long SMA=272.63, Sharpe=0.3554
[INFO] Centroid 16: Short SMA=230.54, Long SMA=257.25, Sharpe=-0.1084
[INFO] Centroid 17: Short SMA=18.76, Long SMA=39.35, Sharpe=0.5056
[INFO] Centroid 18: Short SMA=80.87, Long SMA=199.25, Sharpe=0.1989
[INFO] Centroid 19: Short SMA=103.43, Long SMA=180.58, Sharpe=0.4547
[INFO] Centroid 20: Short SMA=51.93, Long SMA=78.34, Sharpe=-0.3084
[INFO] Centroid 21: Short SMA=47.06, Long SMA=175.30, Sharpe=-0.2106
[INFO] Centroid 22: Short SMA=161.57, Long SMA=278.20, Sharpe=-0.1280
[INFO] Centroid 23: Short SMA=259.51, Long SMA=280.42, Sharpe=-0.2677
[INFO] Centroid 24: Short SMA=128.78, Long SMA=202.12, Sharpe=0.6074
[INFO] Centroid 25: Short SMA=65.49, Long SMA=294.62, Sharpe=0.2278
[INFO] Centroid 26: Short SMA=17.87, Long SMA=66.66, Sharpe=0.3208
[INFO] Centroid 27: Short SMA=158.26, Long SMA=199.68, Sharpe=0.2405
[INFO] Centroid 28: Short SMA=26.18, Long SMA=72.97, Sharpe=0.1295
[INFO] Centroid 29: Short SMA=61.60, Long SMA=85.74, Sharpe=-0.5136
[INFO] Centroid 30: Short SMA=97.04, Long SMA=225.18, Sharpe=0.3511
[INFO] Centroid 31: Short SMA=133.71, Long SMA=249.80, Sharpe=0.2536
[INFO] Centroid 32: Short SMA=113.83, Long SMA=151.07, Sharpe=0.6092
[INFO] Centroid 33: Short SMA=13.56, Long SMA=161.74, Sharpe=0.4069
[INFO] Centroid 34: Short SMA=30.47, Long SMA=126.09, Sharpe=-0.0264
[INFO] Centroid 35: Short SMA=21.32, Long SMA=182.52, Sharpe=0.1652
[INFO] Centroid 36: Short SMA=88.36, Long SMA=113.26, Sharpe=-0.1849
[INFO] Centroid 37: Short SMA=184.68, Long SMA=281.63, Sharpe=-0.3142
[INFO] Centroid 38: Short SMA=190.10, Long SMA=215.13, Sharpe=0.2452
[INFO] Centroid 39: Short SMA=110.78, Long SMA=137.50, Sharpe=0.3960
[INFO] Centroid 40: Short SMA=72.68, Long SMA=133.14, Sharpe=-0.4313
[INFO] Centroid 41: Short SMA=54.34, Long SMA=224.11, Sharpe=0.2619
[INFO] Centroid 42: Short SMA=97.08, Long SMA=259.62, Sharpe=0.4435
[INFO] Centroid 43: Short SMA=208.41, Long SMA=291.63, Sharpe=-0.5361
[INFO] Centroid 44: Short SMA=26.22, Long SMA=249.91, Sharpe=-0.0004
[INFO] Centroid 45: Short SMA=47.82, Long SMA=188.56, Sharpe=-0.0453
[INFO] Centroid 46: Short SMA=21.68, Long SMA=275.69, Sharpe=0.1424
[INFO] Centroid 47: Short SMA=38.15, Long SMA=68.59, Sharpe=-0.0869
[INFO] Centroid 48: Short SMA=264.51, Long SMA=288.05, Sharpe=-0.5347
[INFO] Centroid 49: Short SMA=133.83, Long SMA=279.94, Sharpe=0.1053
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=22, Long SMA=32, Sharpe=1.1408, Trades=90
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=18, Long SMA=38, Sharpe=0.7061, Trades=70
[INFO] Kmeans Top 2: Short SMA=130, Long SMA=202, Sharpe=0.5799, Trades=20
[INFO] Kmeans Top 3: Short SMA=114, Long SMA=152, Sharpe=0.5665, Trades=26
[INFO] Kmeans Top 4: Short SMA=22, Long SMA=38, Sharpe=0.5641, Trades=76
[INFO] Kmeans Top 5: Short SMA=140, Long SMA=164, Sharpe=0.5479, Trades=26
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (102, 286)
[INFO]   Rounded: (49, 115)
[INFO]   Nearest: (48.0, 116.0)
[INFO]   Rounded: (224, 280)
[INFO]   Rounded: (26, 221)
[INFO]   Nearest: (26.0, 220.0)
[INFO]   Rounded: (139, 164)
[INFO]   Nearest: (140.0, 164.0)
[INFO]   Rounded: (17, 123)
[INFO]   Nearest: (18.0, 122.0)
[INFO]   Rounded: (174, 243)
[INFO]   Nearest: (174.0, 242.0)
[INFO]   Rounded: (68, 242)
[INFO]   Rounded: (168, 194)
[INFO]   Rounded: (57, 155)
[INFO]   Nearest: (58.0, 154.0)
[INFO]   Rounded: (19, 37)
[INFO]   Nearest: (18.0, 36.0)
[INFO]   Rounded: (29, 288)
[INFO]   Nearest: (28.0, 288.0)
[INFO]   Rounded: (127, 230)
[INFO]   Nearest: (128.0, 230.0)
[INFO]   Rounded: (212, 244)
[INFO]   Rounded: (96, 134)
[INFO]   Rounded: (59, 273)
[INFO]   Nearest: (58.0, 272.0)
[INFO]   Rounded: (231, 257)
[INFO]   Nearest: (230.0, 258.0)
[INFO]   Rounded: (19, 39)
[INFO]   Nearest: (18.0, 40.0)
[INFO]   Rounded: (81, 199)
[INFO]   Nearest: (80.0, 200.0)
[INFO]   Rounded: (103, 181)
[INFO]   Nearest: (104.0, 180.0)
[INFO]   Rounded: (52, 78)
[INFO]   Rounded: (47, 175)
[INFO]   Nearest: (48.0, 176.0)
[INFO]   Rounded: (162, 278)
[INFO]   Rounded: (260, 280)
[INFO]   Rounded: (129, 202)
[INFO]   Nearest: (128.0, 202.0)
[INFO]   Rounded: (65, 295)
[INFO]   Nearest: (66.0, 294.0)
[INFO]   Rounded: (18, 67)
[INFO]   Nearest: (18.0, 66.0)
[INFO]   Rounded: (158, 200)
[INFO]   Rounded: (26, 73)
[INFO]   Nearest: (26.0, 72.0)
[INFO]   Rounded: (62, 86)
[INFO]   Rounded: (97, 225)
[INFO]   Nearest: (98.0, 226.0)
[INFO]   Rounded: (134, 250)
[INFO]   Rounded: (114, 151)
[INFO]   Nearest: (114.0, 152.0)
[INFO]   Rounded: (14, 162)
[INFO]   Rounded: (30, 126)
[INFO]   Rounded: (21, 183)
[INFO]   Nearest: (22.0, 182.0)
[INFO]   Rounded: (88, 113)
[INFO]   Nearest: (88.0, 114.0)
[INFO]   Rounded: (185, 282)
[INFO]   Nearest: (184.0, 282.0)
[INFO]   Rounded: (190, 215)
[INFO]   Nearest: (190.0, 216.0)
[INFO]   Rounded: (111, 138)
[INFO]   Nearest: (110.0, 138.0)
[INFO]   Rounded: (73, 133)
[INFO]   Nearest: (72.0, 134.0)
[INFO]   Rounded: (54, 224)
[INFO]   Rounded: (97, 260)
[INFO]   Nearest: (98.0, 260.0)
[INFO]   Rounded: (208, 292)
[INFO]   Rounded: (26, 250)
[INFO]   Rounded: (48, 189)
[INFO]   Nearest: (48.0, 188.0)
[INFO]   Rounded: (22, 276)
[INFO]   Rounded: (38, 69)
[INFO]   Nearest: (38.0, 68.0)
[INFO]   Rounded: (265, 288)
[INFO]   Nearest: (264.0, 288.0)
[INFO]   Rounded: (134, 280)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 22, Long SMA: 32
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(18/38) - Original Sharpe: 0.7061, Trades: 70
[INFO] Kmeans cluster 2: SMA(130/202) - Original Sharpe: 0.5799, Trades: 20
[INFO] Kmeans cluster 3: SMA(114/152) - Original Sharpe: 0.5665, Trades: 26
[INFO] Kmeans cluster 4: SMA(22/38) - Original Sharpe: 0.5641, Trades: 76
[INFO] Kmeans cluster 5: SMA(140/164) - Original Sharpe: 0.5479, Trades: 26
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (22/32)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (18/38) - Sharpe: 0.7061
[INFO] cluster 2: (130/202) - Sharpe: 0.5799
[INFO] cluster 3: (114/152) - Sharpe: 0.5665
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.008190           -2.152170
1    2021-11-10 2021-11-10            41    -1.506080           -0.975563
2    2022-01-10 2022-01-10            41     3.633237           -4.449320
3    2022-03-10 2022-03-10            42     2.678211           -5.854470
4    2022-05-10 2022-05-10            41    -2.014869            0.685632
5    2022-07-10 2022-07-10            44    -0.459145            2.882595
6    2022-09-10 2022-09-10            43    -0.916318           -1.578005
7    2022-11-10 2022-11-10            40     1.019050           -4.273971
8    2023-01-10 2023-01-10            41     1.244469           -0.681980
9    2023-03-10 2023-03-10            42    -0.603135            1.714382
10   2023-05-10 2023-05-10            40    -0.113382           -1.490498
11   2023-07-10 2023-07-10            44    -1.828979            0.180886
12   2023-09-10 2023-09-10            44    -0.222549            1.327316
13   2023-11-10 2023-11-10            40    -2.248900           -2.189214
14   2024-01-10 2024-01-10            41     1.763493            2.449558
15   2024-03-10 2024-03-10            43    -2.111027           -3.233678
16   2024-05-10 2024-05-10            40     3.837640            1.620057
17   2024-07-10 2024-07-10            43    -1.589393            0.569197
18   2024-09-10 2024-09-10            44     3.096245           -3.352161
19   2024-11-10 2024-11-10            35     0.304872           -2.493493
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.0 |             -2.2 |         -1.2 | False         
[INFO] 2021-11-10   |         -1.5 |             -1.0 |          0.5 | True          
[INFO] 2022-01-10   |          3.6 |             -4.4 |         -8.0 | False         
[INFO] 2022-03-10   |          2.7 |             -5.9 |         -8.6 | False         
[INFO] 2022-05-10   |         -2.0 |              0.7 |          2.7 | True          
[INFO] 2022-07-10   |         -0.5 |              2.9 |          3.4 | True          
[INFO] 2022-09-10   |         -0.9 |             -1.6 |         -0.7 | False         
[INFO] 2022-11-10   |          1.0 |             -4.3 |         -5.3 | False         
[INFO] 2023-01-10   |          1.2 |             -0.7 |         -1.9 | False         
[INFO] 2023-03-10   |         -0.6 |              1.7 |          2.3 | True          
[INFO] 2023-05-10   |         -0.1 |             -1.5 |         -1.4 | False         
[INFO] 2023-07-10   |         -1.8 |              0.2 |          2.0 | True          
[INFO] 2023-09-10   |         -0.2 |              1.3 |          1.5 | True          
[INFO] 2023-11-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.8 |              2.4 |          0.6 | True          
[INFO] 2024-03-10   |         -2.1 |             -3.2 |         -1.1 | False         
[INFO] 2024-05-10   |          3.8 |              1.6 |         -2.2 | False         
[INFO] 2024-07-10   |         -1.6 |              0.6 |          2.2 | True          
[INFO] 2024-09-10   |          3.1 |             -3.4 |         -6.5 | False         
[INFO] 2024-11-10   |          0.3 |             -2.5 |         -2.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 8 of 19 periods (42.11% win rate)
[INFO] Updating Excel file with Kmeans results for LH...
[INFO] Excel file updated successfully. Added LH with Kmeans win rate 42.1% in row 30
[INFO] Added best Sharpe parameters 22/32 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 22, Long SMA: 32
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(18/38) - Original Sharpe: 0.7061
[INFO] Added cluster 2 to portfolio: SMA(130/202) - Original Sharpe: 0.5799
[INFO] Added cluster 3 to portfolio: SMA(114/152) - Original Sharpe: 0.5665
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LH_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.7839
[INFO] Kmeans Best out-of-sample Sharpe: 0.1153
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for LH...
[INFO] Excel file updated successfully. Added LH with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LH
[INFO] Big Point Value: 400.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8288 to 1.1408
[INFO] 
Best parameters:
[INFO] Short SMA: 22
[INFO] Long SMA: 32
[INFO] Sharpe Ratio: 1.140809
[INFO] Number of Trades: 90
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8288 to 1.1408
[INFO] Trades range: 14.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8198 to 3.1932
[INFO] Scaled Trades range: -0.8013 to 17.3999
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5787
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 411 elements
[INFO] Cluster 1: 557 elements
[INFO] Cluster 2: 129 elements
[INFO] Cluster 3: 33 elements
[INFO] Cluster 4: 533 elements
[INFO] Cluster 5: 415 elements
[INFO] Cluster 6: 144 elements
[INFO] Cluster 7: 301 elements
[INFO] Cluster 8: 234 elements
[INFO] Cluster 9: 392 elements
[INFO] Cluster 10: 403 elements
[INFO] Cluster 11: 271 elements
[INFO] Cluster 12: 110 elements
[INFO] Cluster 13: 433 elements
[INFO] Cluster 14: 596 elements
[INFO] Cluster 15: 128 elements
[INFO] Cluster 16: 394 elements
[INFO] Cluster 17: 199 elements
[INFO] Cluster 18: 384 elements
[INFO] Cluster 19: 37 elements
[INFO] Cluster 20: 12 elements
[INFO] Cluster 21: 145 elements
[INFO] Cluster 22: 216 elements
[INFO] Cluster 23: 100 elements
[INFO] Cluster 24: 40 elements
[INFO] Cluster 25: 51 elements
[INFO] Cluster 26: 369 elements
[INFO] Cluster 27: 319 elements
[INFO] Cluster 28: 218 elements
[INFO] Cluster 29: 39 elements
[INFO] Cluster 30: 181 elements
[INFO] Cluster 31: 100 elements
[INFO] Cluster 32: 199 elements
[INFO] Cluster 33: 51 elements
[INFO] Cluster 34: 164 elements
[INFO] Cluster 35: 258 elements
[INFO] Cluster 36: 288 elements
[INFO] Cluster 37: 83 elements
[INFO] Cluster 38: 246 elements
[INFO] Cluster 39: 3 elements
[INFO] Cluster 40: 26 elements
[INFO] Cluster 41: 204 elements
[INFO] Cluster 42: 87 elements
[INFO] Cluster 43: 174 elements
[INFO] Cluster 44: 156 elements
[INFO] Cluster 45: 211 elements
[INFO] Cluster 46: 13 elements
[INFO] Cluster 47: 193 elements
[INFO] Cluster 48: 91 elements
[INFO] Cluster 49: 244 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=174, Long SMA=244, Sharpe=0.0676, Trades=19
[INFO] Cluster 1 cluster: Short SMA=116, Long SMA=162, Sharpe=0.4778, Trades=24
[INFO] Cluster 2 cluster: Short SMA=16, Long SMA=46, Sharpe=0.7948, Trades=64
[INFO] Cluster 3 cluster: Short SMA=18, Long SMA=24, Sharpe=0.1604, Trades=150
[INFO] Cluster 4 cluster: Short SMA=218, Long SMA=264, Sharpe=-0.1810, Trades=21
[INFO] Cluster 5 cluster: Short SMA=82, Long SMA=204, Sharpe=0.1861, Trades=20
[INFO] Cluster 6 cluster: Short SMA=62, Long SMA=74, Sharpe=-0.4102, Trades=61
[INFO] Cluster 7 cluster: Short SMA=142, Long SMA=238, Sharpe=0.3088, Trades=19
[INFO] Cluster 8 cluster: Short SMA=232, Long SMA=244, Sharpe=-0.2685, Trades=42
[INFO] Cluster 9 cluster: Short SMA=72, Long SMA=114, Sharpe=-0.2497, Trades=34
[INFO] Cluster 10 cluster: Short SMA=128, Long SMA=280, Sharpe=0.1580, Trades=17
[INFO] Cluster 11 cluster: Short SMA=32, Long SMA=124, Sharpe=-0.1211, Trades=27
[INFO] Cluster 12 cluster: Short SMA=158, Long SMA=164, Sharpe=0.3673, Trades=55
[INFO] Cluster 13 cluster: Short SMA=60, Long SMA=282, Sharpe=0.4165, Trades=19
[INFO] Cluster 14 cluster: Short SMA=94, Long SMA=258, Sharpe=0.4798, Trades=16
[INFO] Cluster 15 cluster: Short SMA=92, Long SMA=104, Sharpe=-0.2289, Trades=48
[INFO] Cluster 16 cluster: Short SMA=168, Long SMA=200, Sharpe=0.4670, Trades=29
[INFO] Cluster 17 cluster: Short SMA=32, Long SMA=74, Sharpe=-0.1103, Trades=43
[INFO] Cluster 18 cluster: Short SMA=48, Long SMA=172, Sharpe=-0.2892, Trades=24
[INFO] Cluster 19 cluster: Short SMA=82, Long SMA=84, Sharpe=-0.4311, Trades=98
[INFO] Cluster 21 cluster: Short SMA=16, Long SMA=274, Sharpe=0.1374, Trades=29
[INFO] Cluster 22 cluster: Short SMA=212, Long SMA=292, Sharpe=-0.5088, Trades=17
[INFO] Cluster 23 cluster: Short SMA=268, Long SMA=278, Sharpe=-0.4336, Trades=43
[INFO] Cluster 24 cluster: Short SMA=258, Long SMA=260, Sharpe=-0.2531, Trades=84
[INFO] Cluster 25 cluster: Short SMA=170, Long SMA=172, Sharpe=0.4302, Trades=85
[INFO] Cluster 26 cluster: Short SMA=62, Long SMA=142, Sharpe=-0.4986, Trades=26
[INFO] Cluster 27 cluster: Short SMA=164, Long SMA=280, Sharpe=-0.0969, Trades=18
[INFO] Cluster 28 cluster: Short SMA=14, Long SMA=156, Sharpe=0.4319, Trades=35
[INFO] Cluster 29 cluster: Short SMA=20, Long SMA=32, Sharpe=1.0915, Trades=98
[INFO] Cluster 30 cluster: Short SMA=54, Long SMA=90, Sharpe=-0.4745, Trades=40
[INFO] Cluster 31 cluster: Short SMA=18, Long SMA=102, Sharpe=0.1564, Trades=35
[INFO] Cluster 32 cluster: Short SMA=20, Long SMA=200, Sharpe=0.2048, Trades=28
[INFO] Cluster 33 cluster: Short SMA=112, Long SMA=128, Sharpe=0.1590, Trades=36
[INFO] Cluster 34 cluster: Short SMA=258, Long SMA=288, Sharpe=-0.2389, Trades=23
[INFO] Cluster 35 cluster: Short SMA=126, Long SMA=226, Sharpe=0.4387, Trades=20
[INFO] Cluster 36 cluster: Short SMA=48, Long SMA=226, Sharpe=0.3114, Trades=18
[INFO] Cluster 37 cluster: Short SMA=196, Long SMA=206, Sharpe=0.3609, Trades=45
[INFO] Cluster 38 cluster: Short SMA=28, Long SMA=276, Sharpe=-0.0537, Trades=25
[INFO] Cluster 40 cluster: Short SMA=36, Long SMA=46, Sharpe=-0.0604, Trades=70
[INFO] Cluster 41 cluster: Short SMA=102, Long SMA=186, Sharpe=0.4307, Trades=18
[INFO] Cluster 42 cluster: Short SMA=134, Long SMA=148, Sharpe=0.5368, Trades=36
[INFO] Cluster 43 cluster: Short SMA=52, Long SMA=192, Sharpe=-0.1323, Trades=24
[INFO] Cluster 44 cluster: Short SMA=192, Long SMA=282, Sharpe=-0.3353, Trades=17
[INFO] Cluster 45 cluster: Short SMA=64, Long SMA=244, Sharpe=0.4901, Trades=18
[INFO] Cluster 47 cluster: Short SMA=26, Long SMA=230, Sharpe=0.0427, Trades=24
[INFO] Cluster 48 cluster: Short SMA=20, Long SMA=66, Sharpe=0.3237, Trades=47
[INFO] Cluster 49 cluster: Short SMA=126, Long SMA=208, Sharpe=0.6591, Trades=20
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=22, Long SMA=32, Sharpe=1.1408, Trades=90
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=20, Long SMA=32, Sharpe=1.0915, Trades=98
[INFO] Top 2: Short SMA=16, Long SMA=46, Sharpe=0.7948, Trades=64
[INFO] Top 3: Short SMA=126, Long SMA=208, Sharpe=0.6591, Trades=20
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10557 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 22, Long SMA: 32
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(20/32) - Original Sharpe: 1.0915, Trades: 98
[INFO] Hierarchical cluster 2: SMA(16/46) - Original Sharpe: 0.7948, Trades: 64
[INFO] Hierarchical cluster 3: SMA(126/208) - Original Sharpe: 0.6591, Trades: 20
[INFO] Hierarchical cluster 4: SMA(134/148) - Original Sharpe: 0.5368, Trades: 36
[INFO] Hierarchical cluster 5: SMA(64/244) - Original Sharpe: 0.4901, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (22/32)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (20/32) - Sharpe: 1.0915
[INFO] cluster 2: (16/46) - Sharpe: 0.7948
[INFO] cluster 3: (126/208) - Sharpe: 0.6591
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.008190           -6.212624
1    2021-11-10 2021-11-10            41    -1.506080           -2.676041
2    2022-01-10 2022-01-10            41     3.633237            0.737417
3    2022-03-10 2022-03-10            42     2.678211            1.382734
4    2022-05-10 2022-05-10            41    -2.014869           -2.537969
5    2022-07-10 2022-07-10            44    -0.459145            0.415410
6    2022-09-10 2022-09-10            43    -0.916318           -1.265164
7    2022-11-10 2022-11-10            40     1.019050           -0.624559
8    2023-01-10 2023-01-10            41     1.244469            1.233131
9    2023-03-10 2023-03-10            42    -0.603135            1.635219
10   2023-05-10 2023-05-10            40    -0.113382           -1.205020
11   2023-07-10 2023-07-10            44    -1.828979           -1.637963
12   2023-09-10 2023-09-10            44    -0.222549           -0.763164
13   2023-11-10 2023-11-10            40    -2.248900           -1.848550
14   2024-01-10 2024-01-10            41     1.763493            1.262823
15   2024-03-10 2024-03-10            43    -2.111027           -2.736356
16   2024-05-10 2024-05-10            40     3.837640            4.569220
17   2024-07-10 2024-07-10            43    -1.589393            1.011359
18   2024-09-10 2024-09-10            44     3.096245            3.096245
19   2024-11-10 2024-11-10            35     0.304872           -1.752560
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.0 |             -6.2 |         -5.2 | False         
[INFO] 2021-11-10   |         -1.5 |             -2.7 |         -1.2 | False         
[INFO] 2022-01-10   |          3.6 |              0.7 |         -2.9 | False         
[INFO] 2022-03-10   |          2.7 |              1.4 |         -1.3 | False         
[INFO] 2022-05-10   |         -2.0 |             -2.5 |         -0.5 | False         
[INFO] 2022-07-10   |         -0.5 |              0.4 |          0.9 | True          
[INFO] 2022-09-10   |         -0.9 |             -1.3 |         -0.4 | False         
[INFO] 2022-11-10   |          1.0 |             -0.6 |         -1.6 | False         
[INFO] 2023-01-10   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -0.6 |              1.6 |          2.2 | True          
[INFO] 2023-05-10   |         -0.1 |             -1.2 |         -1.1 | False         
[INFO] 2023-07-10   |         -1.8 |             -1.6 |          0.2 | True          
[INFO] 2023-09-10   |         -0.2 |             -0.8 |         -0.6 | False         
[INFO] 2023-11-10   |         -2.2 |             -1.8 |          0.4 | True          
[INFO] 2024-01-10   |          1.8 |              1.3 |         -0.5 | False         
[INFO] 2024-03-10   |         -2.1 |             -2.7 |         -0.6 | False         
[INFO] 2024-05-10   |          3.8 |              4.6 |          0.8 | True          
[INFO] 2024-07-10   |         -1.6 |              1.0 |          2.6 | True          
[INFO] 2024-09-10   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2024-11-10   |          0.3 |             -1.8 |         -2.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-01-10, 2024-09-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 18 periods (33.33% win rate)
[INFO] Updating Excel file with Hierarchical results for LH...
[INFO] Excel file updated successfully. Added LH with Hierarchical win rate 33.3% in row 30
[INFO] Added best Sharpe parameters 22/32 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 22, Long SMA: 32
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(20/32) - Original Sharpe: 1.0915
[INFO] Added cluster 2 to portfolio: SMA(16/46) - Original Sharpe: 0.7948
[INFO] Added cluster 3 to portfolio: SMA(126/208) - Original Sharpe: 0.6591
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LH_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.4287
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1153
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for LH...
[INFO] Excel file updated successfully. Added LH with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LH
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LJ in column D: 23.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 106.74s
[INFO] Best parameters: Short SMA = 172, Long SMA = 190
[INFO] Best Sharpe ratio: 0.861463, Trades: 28
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LJ=124XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.10 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $545,114.00
[INFO] Market Buy & Hold P&L: $-2,180.00
[INFO] Outperformance: $547,294.00
[INFO] Sharpe ratio (entire period, annualized): 0.754097
[INFO] Sharpe ratio (in-sample, annualized): 0.861463
[INFO] Sharpe ratio (out-of-sample, annualized): 0.523110
[INFO] Maximum Drawdown: $104,670.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 20
[INFO] Out-of-sample period trades: 8
[INFO] Total trades: 28
[INFO] In-sample P&L: $425,552.00
[INFO] Out-of-sample P&L: $119,562.00
[INFO] 
Best parameters from GA: Short SMA = 172, Long SMA = 190, Sharpe = 0.861463
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 23.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7953 to 0.8615
[INFO] 
Best parameters:
[INFO] Short SMA: 172
[INFO] Long SMA: 190
[INFO] Sharpe Ratio: 0.861463
[INFO] Number of Trades: 28
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8464 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7953 to 0.8615
[INFO] Trades range: 11.0 to 309.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2926 to 2.6050
[INFO] Scaled Long SMA range: -2.6485 to 1.7059
[INFO] Scaled Sharpe ratio range: -3.8027 to 2.9913
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 205 elements
[INFO] Kmeans Cluster 1: 176 elements
[INFO] Kmeans Cluster 2: 150 elements
[INFO] Kmeans Cluster 3: 238 elements
[INFO] Kmeans Cluster 4: 209 elements
[INFO] Kmeans Cluster 5: 136 elements
[INFO] Kmeans Cluster 6: 218 elements
[INFO] Kmeans Cluster 7: 174 elements
[INFO] Kmeans Cluster 8: 169 elements
[INFO] Kmeans Cluster 9: 183 elements
[INFO] Kmeans Cluster 10: 154 elements
[INFO] Kmeans Cluster 11: 282 elements
[INFO] Kmeans Cluster 12: 253 elements
[INFO] Kmeans Cluster 13: 100 elements
[INFO] Kmeans Cluster 14: 204 elements
[INFO] Kmeans Cluster 15: 177 elements
[INFO] Kmeans Cluster 16: 140 elements
[INFO] Kmeans Cluster 17: 123 elements
[INFO] Kmeans Cluster 18: 235 elements
[INFO] Kmeans Cluster 19: 124 elements
[INFO] Kmeans Cluster 20: 201 elements
[INFO] Kmeans Cluster 21: 119 elements
[INFO] Kmeans Cluster 22: 158 elements
[INFO] Kmeans Cluster 23: 176 elements
[INFO] Kmeans Cluster 24: 155 elements
[INFO] Kmeans Cluster 25: 156 elements
[INFO] Kmeans Cluster 26: 180 elements
[INFO] Kmeans Cluster 27: 117 elements
[INFO] Kmeans Cluster 28: 225 elements
[INFO] Kmeans Cluster 29: 135 elements
[INFO] Kmeans Cluster 30: 90 elements
[INFO] Kmeans Cluster 31: 150 elements
[INFO] Kmeans Cluster 32: 168 elements
[INFO] Kmeans Cluster 33: 177 elements
[INFO] Kmeans Cluster 34: 103 elements
[INFO] Kmeans Cluster 35: 145 elements
[INFO] Kmeans Cluster 36: 158 elements
[INFO] Kmeans Cluster 37: 196 elements
[INFO] Kmeans Cluster 38: 223 elements
[INFO] Kmeans Cluster 39: 88 elements
[INFO] Kmeans Cluster 40: 244 elements
[INFO] Kmeans Cluster 41: 153 elements
[INFO] Kmeans Cluster 42: 217 elements
[INFO] Kmeans Cluster 43: 122 elements
[INFO] Kmeans Cluster 44: 105 elements
[INFO] Kmeans Cluster 45: 141 elements
[INFO] Kmeans Cluster 46: 165 elements
[INFO] Kmeans Cluster 47: 92 elements
[INFO] Kmeans Cluster 48: 216 elements
[INFO] Kmeans Cluster 49: 239 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=31.55, Long SMA=116.29, Sharpe=-0.1942
[INFO] Centroid 1: Short SMA=134.12, Long SMA=236.82, Sharpe=0.3272
[INFO] Centroid 2: Short SMA=41.61, Long SMA=214.91, Sharpe=0.2410
[INFO] Centroid 3: Short SMA=268.34, Long SMA=288.87, Sharpe=0.1676
[INFO] Centroid 4: Short SMA=159.04, Long SMA=182.08, Sharpe=0.6083
[INFO] Centroid 5: Short SMA=204.38, Long SMA=227.32, Sharpe=-0.0847
[INFO] Centroid 6: Short SMA=24.84, Long SMA=134.45, Sharpe=-0.0904
[INFO] Centroid 7: Short SMA=224.69, Long SMA=266.18, Sharpe=0.0454
[INFO] Centroid 8: Short SMA=21.87, Long SMA=281.07, Sharpe=0.2211
[INFO] Centroid 9: Short SMA=54.78, Long SMA=86.75, Sharpe=-0.0854
[INFO] Centroid 10: Short SMA=95.75, Long SMA=156.74, Sharpe=0.1703
[INFO] Centroid 11: Short SMA=111.75, Long SMA=215.48, Sharpe=0.4461
[INFO] Centroid 12: Short SMA=24.80, Long SMA=247.63, Sharpe=0.1814
[INFO] Centroid 13: Short SMA=26.44, Long SMA=59.24, Sharpe=0.1976
[INFO] Centroid 14: Short SMA=205.05, Long SMA=238.23, Sharpe=-0.2223
[INFO] Centroid 15: Short SMA=105.59, Long SMA=128.50, Sharpe=0.0301
[INFO] Centroid 16: Short SMA=80.21, Long SMA=132.89, Sharpe=-0.2401
[INFO] Centroid 17: Short SMA=128.50, Long SMA=146.50, Sharpe=0.1783
[INFO] Centroid 18: Short SMA=221.02, Long SMA=288.49, Sharpe=0.1431
[INFO] Centroid 19: Short SMA=72.90, Long SMA=189.26, Sharpe=0.2219
[INFO] Centroid 20: Short SMA=18.58, Long SMA=210.65, Sharpe=0.0358
[INFO] Centroid 21: Short SMA=32.35, Long SMA=50.91, Sharpe=-0.1379
[INFO] Centroid 22: Short SMA=250.92, Long SMA=275.30, Sharpe=0.2998
[INFO] Centroid 23: Short SMA=19.49, Long SMA=169.15, Sharpe=-0.1446
[INFO] Centroid 24: Short SMA=118.23, Long SMA=160.93, Sharpe=0.3324
[INFO] Centroid 25: Short SMA=153.09, Long SMA=223.08, Sharpe=0.4236
[INFO] Centroid 26: Short SMA=69.82, Long SMA=93.18, Sharpe=-0.2079
[INFO] Centroid 27: Short SMA=183.23, Long SMA=207.98, Sharpe=0.3071
[INFO] Centroid 28: Short SMA=25.16, Long SMA=85.54, Sharpe=-0.0027
[INFO] Centroid 29: Short SMA=181.59, Long SMA=255.08, Sharpe=0.0299
[INFO] Centroid 30: Short SMA=166.07, Long SMA=181.49, Sharpe=0.7335
[INFO] Centroid 31: Short SMA=48.13, Long SMA=246.93, Sharpe=0.3216
[INFO] Centroid 32: Short SMA=42.13, Long SMA=160.76, Sharpe=-0.0296
[INFO] Centroid 33: Short SMA=41.47, Long SMA=195.64, Sharpe=0.1568
[INFO] Centroid 34: Short SMA=50.72, Long SMA=97.18, Sharpe=-0.3522
[INFO] Centroid 35: Short SMA=61.67, Long SMA=120.32, Sharpe=0.0213
[INFO] Centroid 36: Short SMA=96.48, Long SMA=118.66, Sharpe=-0.0954
[INFO] Centroid 37: Short SMA=102.44, Long SMA=190.57, Sharpe=0.5442
[INFO] Centroid 38: Short SMA=151.17, Long SMA=203.36, Sharpe=0.5204
[INFO] Centroid 39: Short SMA=21.64, Long SMA=38.57, Sharpe=-0.3372
[INFO] Centroid 40: Short SMA=65.52, Long SMA=149.15, Sharpe=-0.1105
[INFO] Centroid 41: Short SMA=196.41, Long SMA=266.07, Sharpe=-0.0595
[INFO] Centroid 42: Short SMA=59.07, Long SMA=180.88, Sharpe=0.0664
[INFO] Centroid 43: Short SMA=161.05, Long SMA=244.80, Sharpe=0.2569
[INFO] Centroid 44: Short SMA=186.19, Long SMA=219.50, Sharpe=0.1305
[INFO] Centroid 45: Short SMA=28.35, Long SMA=51.50, Sharpe=0.0362
[INFO] Centroid 46: Short SMA=231.25, Long SMA=254.80, Sharpe=0.2041
[INFO] Centroid 47: Short SMA=29.09, Long SMA=289.96, Sharpe=0.0717
[INFO] Centroid 48: Short SMA=77.94, Long SMA=212.53, Sharpe=0.3648
[INFO] Centroid 49: Short SMA=131.51, Long SMA=177.46, Sharpe=0.4575
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=172, Long SMA=190, Sharpe=0.8615, Trades=28
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=170, Long SMA=184, Sharpe=0.7272, Trades=30
[INFO] Kmeans Top 2: Short SMA=158, Long SMA=184, Sharpe=0.6551, Trades=24
[INFO] Kmeans Top 3: Short SMA=102, Long SMA=190, Sharpe=0.5562, Trades=15
[INFO] Kmeans Top 4: Short SMA=112, Long SMA=216, Sharpe=0.5031, Trades=13
[INFO] Kmeans Top 5: Short SMA=150, Long SMA=204, Sharpe=0.4799, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (32, 116)
[INFO]   Rounded: (134, 237)
[INFO]   Nearest: (134.0, 236.0)
[INFO]   Rounded: (42, 215)
[INFO]   Nearest: (42.0, 214.0)
[INFO]   Rounded: (268, 289)
[INFO]   Nearest: (268.0, 288.0)
[INFO]   Rounded: (159, 182)
[INFO]   Nearest: (160.0, 182.0)
[INFO]   Rounded: (204, 227)
[INFO]   Nearest: (204.0, 228.0)
[INFO]   Rounded: (25, 134)
[INFO]   Nearest: (24.0, 134.0)
[INFO]   Rounded: (225, 266)
[INFO]   Nearest: (224.0, 266.0)
[INFO]   Rounded: (22, 281)
[INFO]   Nearest: (22.0, 282.0)
[INFO]   Rounded: (55, 87)
[INFO]   Nearest: (54.0, 86.0)
[INFO]   Rounded: (96, 157)
[INFO]   Nearest: (96.0, 156.0)
[INFO]   Rounded: (112, 215)
[INFO]   Nearest: (112.0, 216.0)
[INFO]   Rounded: (25, 248)
[INFO]   Nearest: (24.0, 248.0)
[INFO]   Rounded: (26, 59)
[INFO]   Nearest: (26.0, 60.0)
[INFO]   Rounded: (205, 238)
[INFO]   Nearest: (206.0, 238.0)
[INFO]   Rounded: (106, 128)
[INFO]   Rounded: (80, 133)
[INFO]   Nearest: (80.0, 132.0)
[INFO]   Rounded: (129, 147)
[INFO]   Nearest: (128.0, 146.0)
[INFO]   Rounded: (221, 288)
[INFO]   Nearest: (222.0, 288.0)
[INFO]   Rounded: (73, 189)
[INFO]   Nearest: (72.0, 190.0)
[INFO]   Rounded: (19, 211)
[INFO]   Nearest: (18.0, 210.0)
[INFO]   Rounded: (32, 51)
[INFO]   Nearest: (32.0, 50.0)
[INFO]   Rounded: (251, 275)
[INFO]   Nearest: (250.0, 276.0)
[INFO]   Rounded: (19, 169)
[INFO]   Nearest: (20.0, 170.0)
[INFO]   Rounded: (118, 161)
[INFO]   Nearest: (118.0, 160.0)
[INFO]   Rounded: (153, 223)
[INFO]   Nearest: (154.0, 224.0)
[INFO]   Rounded: (70, 93)
[INFO]   Nearest: (70.0, 94.0)
[INFO]   Rounded: (183, 208)
[INFO]   Nearest: (184.0, 208.0)
[INFO]   Rounded: (25, 86)
[INFO]   Nearest: (26.0, 86.0)
[INFO]   Rounded: (182, 255)
[INFO]   Nearest: (182.0, 256.0)
[INFO]   Rounded: (166, 181)
[INFO]   Nearest: (166.0, 182.0)
[INFO]   Rounded: (48, 247)
[INFO]   Nearest: (48.0, 246.0)
[INFO]   Rounded: (42, 161)
[INFO]   Nearest: (42.0, 160.0)
[INFO]   Rounded: (41, 196)
[INFO]   Nearest: (42.0, 196.0)
[INFO]   Rounded: (51, 97)
[INFO]   Nearest: (50.0, 98.0)
[INFO]   Rounded: (62, 120)
[INFO]   Rounded: (96, 119)
[INFO]   Nearest: (96.0, 118.0)
[INFO]   Rounded: (102, 191)
[INFO]   Nearest: (102.0, 190.0)
[INFO]   Rounded: (151, 203)
[INFO]   Nearest: (152.0, 204.0)
[INFO]   Rounded: (22, 39)
[INFO]   Nearest: (22.0, 38.0)
[INFO]   Rounded: (66, 149)
[INFO]   Nearest: (66.0, 150.0)
[INFO]   Rounded: (196, 266)
[INFO]   Rounded: (59, 181)
[INFO]   Nearest: (60.0, 180.0)
[INFO]   Rounded: (161, 245)
[INFO]   Nearest: (162.0, 244.0)
[INFO]   Rounded: (186, 220)
[INFO]   Rounded: (28, 52)
[INFO]   Rounded: (231, 255)
[INFO]   Nearest: (232.0, 254.0)
[INFO]   Rounded: (29, 290)
[INFO]   Nearest: (30.0, 290.0)
[INFO]   Rounded: (78, 213)
[INFO]   Nearest: (78.0, 212.0)
[INFO]   Rounded: (132, 177)
[INFO]   Nearest: (132.0, 178.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 172, Long SMA: 190
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(170/184) - Original Sharpe: 0.7272, Trades: 30
[INFO] Kmeans cluster 2: SMA(158/184) - Original Sharpe: 0.6551, Trades: 24
[INFO] Kmeans cluster 3: SMA(102/190) - Original Sharpe: 0.5562, Trades: 15
[INFO] Kmeans cluster 4: SMA(112/216) - Original Sharpe: 0.5031, Trades: 13
[INFO] Kmeans cluster 5: SMA(150/204) - Original Sharpe: 0.4799, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2555
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (172/190)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (170/184) - Sharpe: 0.7272
[INFO] cluster 2: (158/184) - Sharpe: 0.6551
[INFO] cluster 3: (102/190) - Sharpe: 0.5562
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Out-of-sample period starts on: 2021-12-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-14 2021-12-14            41    -6.476923           -6.449643
1    2022-02-14 2022-02-14            43     1.142795            0.067536
2    2022-04-14 2022-04-14            38     3.803073            3.803073
3    2022-06-14 2022-06-14            44    -1.477996           -1.477996
4    2022-08-14 2022-08-14            42     5.820882            5.820882
5    2022-10-14 2022-10-14            43    -3.029340           -3.029340
6    2022-12-14 2022-12-14            41     0.007038            0.007038
7    2023-02-14 2023-02-14            41    -0.235977           -0.235977
8    2023-04-14 2023-04-14            40     2.608255           -1.348925
9    2023-06-14 2023-06-14            43     2.317082            2.197802
10   2023-08-14 2023-08-14            44    -0.537988           -0.537988
11   2023-10-14 2023-10-14            43    -2.449401           -2.449401
12   2023-12-14 2023-12-14            41     1.911555            1.359912
13   2024-02-14 2024-02-14            41     0.151095            0.510807
14   2024-04-14 2024-04-14            42     0.082220            0.082220
15   2024-06-14 2024-06-14            43     1.909439            0.316896
16   2024-08-14 2024-08-14            42     1.064357            2.031304
17   2024-10-14 2024-10-14            45     0.185180           -2.482443
18   2024-12-14 2024-12-14            10     6.740598            5.794844
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-14   |         -6.5 |             -6.4 |          0.1 | True          
[INFO] 2022-02-14   |          1.1 |              0.1 |         -1.0 | False         
[INFO] 2022-04-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-06-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-08-14   |          5.8 |              5.8 |          0.0 | Excluded      
[INFO] 2022-10-14   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-12-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-02-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-04-14   |          2.6 |             -1.3 |         -3.9 | False         
[INFO] 2023-06-14   |          2.3 |              2.2 |         -0.1 | False         
[INFO] 2023-08-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2023-10-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2023-12-14   |          1.9 |              1.4 |         -0.5 | False         
[INFO] 2024-02-14   |          0.2 |              0.5 |          0.3 | True          
[INFO] 2024-04-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-06-14   |          1.9 |              0.3 |         -1.6 | False         
[INFO] 2024-08-14   |          1.1 |              2.0 |          0.9 | True          
[INFO] 2024-10-14   |          0.2 |             -2.5 |         -2.7 | False         
[INFO] 2024-12-14   |          6.7 |              5.8 |         -0.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-14, 2022-06-14, 2022-08-14, 2022-10-14, 2022-12-14, 2023-02-14, 2023-08-14, 2023-10-14, 2024-04-14
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Kmeans cluster wins (rounded comparison): 3 of 10 periods (30.00% win rate)
[INFO] Updating Excel file with Kmeans results for LJ...
[INFO] Excel file updated successfully. Added LJ with Kmeans win rate 30.0% in row 31
[INFO] Added best Sharpe parameters 172/190 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 172, Long SMA: 190
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(170/184) - Original Sharpe: 0.7272
[INFO] Added cluster 2 to portfolio: SMA(158/184) - Original Sharpe: 0.6551
[INFO] Added cluster 3 to portfolio: SMA(102/190) - Original Sharpe: 0.5562
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LJ_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2332
[INFO] Kmeans Best out-of-sample Sharpe: 0.5231
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for LJ...
[INFO] Excel file updated successfully. Added LJ with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LJ
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 23.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7953 to 0.8615
[INFO] 
Best parameters:
[INFO] Short SMA: 172
[INFO] Long SMA: 190
[INFO] Sharpe Ratio: 0.861463
[INFO] Number of Trades: 28
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8464 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7953 to 0.8615
[INFO] Trades range: 11.0 to 309.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2926 to 2.6050
[INFO] Scaled Long SMA range: -2.6485 to 1.7059
[INFO] Scaled Sharpe ratio range: -3.8027 to 2.9913
[INFO] Scaled Trades range: -0.7273 to 14.6134
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8464 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5887
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 58 elements
[INFO] Cluster 1: 265 elements
[INFO] Cluster 2: 279 elements
[INFO] Cluster 3: 286 elements
[INFO] Cluster 4: 254 elements
[INFO] Cluster 5: 441 elements
[INFO] Cluster 6: 344 elements
[INFO] Cluster 7: 362 elements
[INFO] Cluster 8: 124 elements
[INFO] Cluster 9: 278 elements
[INFO] Cluster 10: 236 elements
[INFO] Cluster 11: 192 elements
[INFO] Cluster 12: 200 elements
[INFO] Cluster 13: 40 elements
[INFO] Cluster 14: 57 elements
[INFO] Cluster 15: 257 elements
[INFO] Cluster 16: 114 elements
[INFO] Cluster 17: 58 elements
[INFO] Cluster 18: 189 elements
[INFO] Cluster 19: 164 elements
[INFO] Cluster 20: 214 elements
[INFO] Cluster 21: 80 elements
[INFO] Cluster 22: 26 elements
[INFO] Cluster 23: 121 elements
[INFO] Cluster 24: 191 elements
[INFO] Cluster 25: 46 elements
[INFO] Cluster 26: 82 elements
[INFO] Cluster 27: 138 elements
[INFO] Cluster 28: 306 elements
[INFO] Cluster 29: 34 elements
[INFO] Cluster 30: 264 elements
[INFO] Cluster 31: 4 elements
[INFO] Cluster 32: 21 elements
[INFO] Cluster 33: 143 elements
[INFO] Cluster 34: 98 elements
[INFO] Cluster 35: 269 elements
[INFO] Cluster 36: 247 elements
[INFO] Cluster 37: 182 elements
[INFO] Cluster 38: 304 elements
[INFO] Cluster 39: 174 elements
[INFO] Cluster 40: 208 elements
[INFO] Cluster 41: 184 elements
[INFO] Cluster 42: 177 elements
[INFO] Cluster 43: 260 elements
[INFO] Cluster 44: 168 elements
[INFO] Cluster 45: 97 elements
[INFO] Cluster 46: 45 elements
[INFO] Cluster 47: 7 elements
[INFO] Cluster 48: 77 elements
[INFO] Cluster 49: 99 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=144, Long SMA=150, Sharpe=0.1312, Trades=46
[INFO] Cluster 1 cluster: Short SMA=72, Long SMA=98, Sharpe=-0.2203, Trades=33
[INFO] Cluster 2 cluster: Short SMA=136, Long SMA=178, Sharpe=0.4492, Trades=20
[INFO] Cluster 3 cluster: Short SMA=246, Long SMA=272, Sharpe=0.3847, Trades=17
[INFO] Cluster 4 cluster: Short SMA=26, Long SMA=284, Sharpe=0.1745, Trades=15
[INFO] Cluster 5 cluster: Short SMA=60, Long SMA=154, Sharpe=-0.1266, Trades=17
[INFO] Cluster 6 cluster: Short SMA=192, Long SMA=264, Sharpe=0.0465, Trades=13
[INFO] Cluster 7 cluster: Short SMA=54, Long SMA=204, Sharpe=0.1245, Trades=15
[INFO] Cluster 8 cluster: Short SMA=42, Long SMA=56, Sharpe=-0.3193, Trades=63
[INFO] Cluster 9 cluster: Short SMA=204, Long SMA=238, Sharpe=-0.3063, Trades=19
[INFO] Cluster 10 cluster: Short SMA=22, Long SMA=74, Sharpe=0.0949, Trades=43
[INFO] Cluster 11 cluster: Short SMA=116, Long SMA=160, Sharpe=0.3378, Trades=19
[INFO] Cluster 12 cluster: Short SMA=36, Long SMA=82, Sharpe=-0.1202, Trades=39
[INFO] Cluster 13 cluster: Short SMA=72, Long SMA=76, Sharpe=-0.2069, Trades=93
[INFO] Cluster 14 cluster: Short SMA=24, Long SMA=48, Sharpe=0.2546, Trades=65
[INFO] Cluster 15 cluster: Short SMA=150, Long SMA=204, Sharpe=0.4799, Trades=15
[INFO] Cluster 16 cluster: Short SMA=184, Long SMA=224, Sharpe=0.1094, Trades=17
[INFO] Cluster 17 cluster: Short SMA=26, Long SMA=38, Sharpe=0.0039, Trades=88
[INFO] Cluster 18 cluster: Short SMA=100, Long SMA=150, Sharpe=0.1761, Trades=19
[INFO] Cluster 19 cluster: Short SMA=106, Long SMA=130, Sharpe=-0.0603, Trades=27
[INFO] Cluster 20 cluster: Short SMA=20, Long SMA=210, Sharpe=0.1052, Trades=25
[INFO] Cluster 21 cluster: Short SMA=112, Long SMA=118, Sharpe=0.0632, Trades=57
[INFO] Cluster 22 cluster: Short SMA=36, Long SMA=38, Sharpe=-0.0131, Trades=160
[INFO] Cluster 23 cluster: Short SMA=166, Long SMA=188, Sharpe=0.6448, Trades=26
[INFO] Cluster 24 cluster: Short SMA=74, Long SMA=218, Sharpe=0.2854, Trades=11
[INFO] Cluster 25 cluster: Short SMA=216, Long SMA=220, Sharpe=-0.0815, Trades=43
[INFO] Cluster 26 cluster: Short SMA=268, Long SMA=272, Sharpe=0.0609, Trades=33
[INFO] Cluster 27 cluster: Short SMA=180, Long SMA=210, Sharpe=0.2813, Trades=17
[INFO] Cluster 28 cluster: Short SMA=28, Long SMA=136, Sharpe=-0.1015, Trades=25
[INFO] Cluster 29 cluster: Short SMA=34, Long SMA=38, Sharpe=0.0160, Trades=118
[INFO] Cluster 30 cluster: Short SMA=56, Long SMA=184, Sharpe=0.0661, Trades=15
[INFO] Cluster 32 cluster: Short SMA=168, Long SMA=170, Sharpe=0.7867, Trades=62
[INFO] Cluster 33 cluster: Short SMA=38, Long SMA=106, Sharpe=-0.3748, Trades=31
[INFO] Cluster 34 cluster: Short SMA=84, Long SMA=128, Sharpe=-0.2187, Trades=23
[INFO] Cluster 35 cluster: Short SMA=222, Long SMA=286, Sharpe=0.1151, Trades=13
[INFO] Cluster 36 cluster: Short SMA=20, Long SMA=248, Sharpe=0.2345, Trades=19
[INFO] Cluster 37 cluster: Short SMA=62, Long SMA=120, Sharpe=0.1078, Trades=21
[INFO] Cluster 38 cluster: Short SMA=108, Long SMA=214, Sharpe=0.3668, Trades=15
[INFO] Cluster 39 cluster: Short SMA=266, Long SMA=290, Sharpe=0.1704, Trades=18
[INFO] Cluster 40 cluster: Short SMA=104, Long SMA=190, Sharpe=0.5234, Trades=15
[INFO] Cluster 41 cluster: Short SMA=46, Long SMA=244, Sharpe=0.2619, Trades=11
[INFO] Cluster 42 cluster: Short SMA=146, Long SMA=226, Sharpe=0.4727, Trades=13
[INFO] Cluster 43 cluster: Short SMA=148, Long SMA=242, Sharpe=0.3311, Trades=11
[INFO] Cluster 44 cluster: Short SMA=18, Long SMA=172, Sharpe=-0.2092, Trades=25
[INFO] Cluster 45 cluster: Short SMA=232, Long SMA=260, Sharpe=0.0446, Trades=19
[INFO] Cluster 46 cluster: Short SMA=14, Long SMA=34, Sharpe=-0.3521, Trades=93
[INFO] Cluster 48 cluster: Short SMA=158, Long SMA=168, Sharpe=0.6407, Trades=35
[INFO] Cluster 49 cluster: Short SMA=20, Long SMA=112, Sharpe=-0.1517, Trades=39
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=172, Long SMA=190, Sharpe=0.8615, Trades=28
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=168, Long SMA=170, Sharpe=0.7867, Trades=62
[INFO] Top 2: Short SMA=166, Long SMA=188, Sharpe=0.6448, Trades=26
[INFO] Top 3: Short SMA=158, Long SMA=168, Sharpe=0.6407, Trades=35
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 8453 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 172, Long SMA: 190
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(168/170) - Original Sharpe: 0.7867, Trades: 62
[INFO] Hierarchical cluster 2: SMA(166/188) - Original Sharpe: 0.6448, Trades: 26
[INFO] Hierarchical cluster 3: SMA(158/168) - Original Sharpe: 0.6407, Trades: 35
[INFO] Hierarchical cluster 4: SMA(104/190) - Original Sharpe: 0.5234, Trades: 15
[INFO] Hierarchical cluster 5: SMA(150/204) - Original Sharpe: 0.4799, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2555
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (172/190)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (168/170) - Sharpe: 0.7867
[INFO] cluster 2: (166/188) - Sharpe: 0.6448
[INFO] cluster 3: (158/168) - Sharpe: 0.6407
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Out-of-sample period starts on: 2021-12-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-14 2021-12-14            41    -6.476923           -5.019313
1    2022-02-14 2022-02-14            43     1.142795            0.067536
2    2022-04-14 2022-04-14            38     3.803073            3.803073
3    2022-06-14 2022-06-14            44    -1.477996           -1.477996
4    2022-08-14 2022-08-14            42     5.820882            5.820882
5    2022-10-14 2022-10-14            43    -3.029340           -3.029340
6    2022-12-14 2022-12-14            41     0.007038            0.007038
7    2023-02-14 2023-02-14            41    -0.235977           -0.235977
8    2023-04-14 2023-04-14            40     2.608255            1.650851
9    2023-06-14 2023-06-14            43     2.317082            0.999296
10   2023-08-14 2023-08-14            44    -0.537988           -0.718025
11   2023-10-14 2023-10-14            43    -2.449401           -2.449401
12   2023-12-14 2023-12-14            41     1.911555            0.763879
13   2024-02-14 2024-02-14            41     0.151095           -0.026113
14   2024-04-14 2024-04-14            42     0.082220            0.082220
15   2024-06-14 2024-06-14            43     1.909439            1.879837
16   2024-08-14 2024-08-14            42     1.064357            2.204758
17   2024-10-14 2024-10-14            45     0.185180           -4.238036
18   2024-12-14 2024-12-14            10     6.740598           -9.052136
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-14   |         -6.5 |             -5.0 |          1.5 | True          
[INFO] 2022-02-14   |          1.1 |              0.1 |         -1.0 | False         
[INFO] 2022-04-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-06-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-08-14   |          5.8 |              5.8 |          0.0 | Excluded      
[INFO] 2022-10-14   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-12-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-02-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-04-14   |          2.6 |              1.7 |         -0.9 | False         
[INFO] 2023-06-14   |          2.3 |              1.0 |         -1.3 | False         
[INFO] 2023-08-14   |         -0.5 |             -0.7 |         -0.2 | False         
[INFO] 2023-10-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2023-12-14   |          1.9 |              0.8 |         -1.1 | False         
[INFO] 2024-02-14   |          0.2 |             -0.0 |         -0.2 | False         
[INFO] 2024-04-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-06-14   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2024-08-14   |          1.1 |              2.2 |          1.1 | True          
[INFO] 2024-10-14   |          0.2 |             -4.2 |         -4.4 | False         
[INFO] 2024-12-14   |          6.7 |             -9.1 |        -15.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-14, 2022-06-14, 2022-08-14, 2022-10-14, 2022-12-14, 2023-02-14, 2023-10-14, 2024-04-14, 2024-06-14
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 10 periods (20.00% win rate)
[INFO] Updating Excel file with Hierarchical results for LJ...
[INFO] Excel file updated successfully. Added LJ with Hierarchical win rate 20.0% in row 31
[INFO] Added best Sharpe parameters 172/190 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 172, Long SMA: 190
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(168/170) - Original Sharpe: 0.7867
[INFO] Added cluster 2 to portfolio: SMA(166/188) - Original Sharpe: 0.6448
[INFO] Added cluster 3 to portfolio: SMA(158/168) - Original Sharpe: 0.6407
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LJ_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1308
[INFO] Hierarchical Best out-of-sample Sharpe: 0.5231
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for LJ...
[INFO] Excel file updated successfully. Added LJ with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LJ
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LZ in column D: 15.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 112.93s
[INFO] Best parameters: Short SMA = 156, Long SMA = 158
[INFO] Best Sharpe ratio: 0.626081, Trades: 79
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LZ=104XC
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 7.62 contracts
[INFO] Maximum Position Size: 14 contracts
[INFO] Strategy Total P&L: $281,140.00
[INFO] Market Buy & Hold P&L: $28,760.00
[INFO] Outperformance: $252,380.00
[INFO] Sharpe ratio (entire period, annualized): 0.390068
[INFO] Sharpe ratio (in-sample, annualized): 0.626081
[INFO] Sharpe ratio (out-of-sample, annualized): -0.194681
[INFO] Maximum Drawdown: $178,945.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 50
[INFO] Out-of-sample period trades: 29
[INFO] Total trades: 79
[INFO] In-sample P&L: $321,435.00
[INFO] Out-of-sample P&L: $-40,295.00
[INFO] 
Best parameters from GA: Short SMA = 156, Long SMA = 158, Sharpe = 0.626081
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.3217 to 0.6261
[INFO] 
Best parameters:
[INFO] Short SMA: 156
[INFO] Long SMA: 158
[INFO] Sharpe Ratio: 0.626081
[INFO] Number of Trades: 79
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10332 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.3217 to 0.6261
[INFO] Trades range: 10.0 to 307.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3792 to 2.8477
[INFO] Scaled Long SMA range: -2.7903 to 1.4416
[INFO] Scaled Sharpe ratio range: -6.1933 to 4.3052
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 234 elements
[INFO] Kmeans Cluster 1: 251 elements
[INFO] Kmeans Cluster 2: 212 elements
[INFO] Kmeans Cluster 3: 204 elements
[INFO] Kmeans Cluster 4: 237 elements
[INFO] Kmeans Cluster 5: 227 elements
[INFO] Kmeans Cluster 6: 203 elements
[INFO] Kmeans Cluster 7: 237 elements
[INFO] Kmeans Cluster 8: 159 elements
[INFO] Kmeans Cluster 9: 228 elements
[INFO] Kmeans Cluster 10: 164 elements
[INFO] Kmeans Cluster 11: 137 elements
[INFO] Kmeans Cluster 12: 248 elements
[INFO] Kmeans Cluster 13: 248 elements
[INFO] Kmeans Cluster 14: 145 elements
[INFO] Kmeans Cluster 15: 251 elements
[INFO] Kmeans Cluster 16: 188 elements
[INFO] Kmeans Cluster 17: 192 elements
[INFO] Kmeans Cluster 18: 152 elements
[INFO] Kmeans Cluster 19: 167 elements
[INFO] Kmeans Cluster 20: 211 elements
[INFO] Kmeans Cluster 21: 252 elements
[INFO] Kmeans Cluster 22: 168 elements
[INFO] Kmeans Cluster 23: 123 elements
[INFO] Kmeans Cluster 24: 307 elements
[INFO] Kmeans Cluster 25: 14 elements
[INFO] Kmeans Cluster 26: 265 elements
[INFO] Kmeans Cluster 27: 194 elements
[INFO] Kmeans Cluster 28: 225 elements
[INFO] Kmeans Cluster 29: 209 elements
[INFO] Kmeans Cluster 30: 332 elements
[INFO] Kmeans Cluster 31: 220 elements
[INFO] Kmeans Cluster 32: 254 elements
[INFO] Kmeans Cluster 33: 227 elements
[INFO] Kmeans Cluster 34: 234 elements
[INFO] Kmeans Cluster 35: 191 elements
[INFO] Kmeans Cluster 36: 271 elements
[INFO] Kmeans Cluster 37: 167 elements
[INFO] Kmeans Cluster 38: 153 elements
[INFO] Kmeans Cluster 39: 226 elements
[INFO] Kmeans Cluster 40: 156 elements
[INFO] Kmeans Cluster 41: 160 elements
[INFO] Kmeans Cluster 42: 310 elements
[INFO] Kmeans Cluster 43: 141 elements
[INFO] Kmeans Cluster 44: 194 elements
[INFO] Kmeans Cluster 45: 267 elements
[INFO] Kmeans Cluster 46: 202 elements
[INFO] Kmeans Cluster 47: 137 elements
[INFO] Kmeans Cluster 48: 229 elements
[INFO] Kmeans Cluster 49: 209 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=69.31, Long SMA=151.52, Sharpe=-0.3879
[INFO] Centroid 1: Short SMA=178.67, Long SMA=199.86, Sharpe=0.0114
[INFO] Centroid 2: Short SMA=105.14, Long SMA=202.18, Sharpe=-0.0834
[INFO] Centroid 3: Short SMA=30.09, Long SMA=121.14, Sharpe=-0.1158
[INFO] Centroid 4: Short SMA=157.11, Long SMA=260.17, Sharpe=-0.2685
[INFO] Centroid 5: Short SMA=22.47, Long SMA=264.46, Sharpe=0.0739
[INFO] Centroid 6: Short SMA=45.48, Long SMA=97.33, Sharpe=-0.2542
[INFO] Centroid 7: Short SMA=56.06, Long SMA=283.04, Sharpe=-0.4178
[INFO] Centroid 8: Short SMA=233.76, Long SMA=250.15, Sharpe=-0.1718
[INFO] Centroid 9: Short SMA=25.62, Long SMA=128.39, Sharpe=0.0417
[INFO] Centroid 10: Short SMA=124.15, Long SMA=165.09, Sharpe=-0.1404
[INFO] Centroid 11: Short SMA=151.74, Long SMA=182.82, Sharpe=0.1671
[INFO] Centroid 12: Short SMA=58.15, Long SMA=259.89, Sharpe=-0.2982
[INFO] Centroid 13: Short SMA=102.97, Long SMA=273.47, Sharpe=-0.2291
[INFO] Centroid 14: Short SMA=21.38, Long SMA=53.10, Sharpe=-0.4687
[INFO] Centroid 15: Short SMA=185.08, Long SMA=265.96, Sharpe=-0.1187
[INFO] Centroid 16: Short SMA=25.43, Long SMA=53.91, Sharpe=-0.2850
[INFO] Centroid 17: Short SMA=35.34, Long SMA=66.50, Sharpe=-0.1328
[INFO] Centroid 18: Short SMA=102.79, Long SMA=139.33, Sharpe=-0.5796
[INFO] Centroid 19: Short SMA=272.19, Long SMA=290.40, Sharpe=-0.1828
[INFO] Centroid 20: Short SMA=25.35, Long SMA=278.85, Sharpe=-0.1068
[INFO] Centroid 21: Short SMA=71.38, Long SMA=101.06, Sharpe=-0.3848
[INFO] Centroid 22: Short SMA=26.95, Long SMA=146.75, Sharpe=0.2084
[INFO] Centroid 23: Short SMA=148.88, Long SMA=173.20, Sharpe=0.3922
[INFO] Centroid 24: Short SMA=21.82, Long SMA=188.94, Sharpe=0.1194
[INFO] Centroid 26: Short SMA=205.40, Long SMA=230.93, Sharpe=-0.0924
[INFO] Centroid 27: Short SMA=145.19, Long SMA=280.42, Sharpe=-0.3675
[INFO] Centroid 28: Short SMA=214.18, Long SMA=268.12, Sharpe=0.0093
[INFO] Centroid 29: Short SMA=156.90, Long SMA=205.89, Sharpe=-0.1246
[INFO] Centroid 30: Short SMA=64.11, Long SMA=215.28, Sharpe=-0.2597
[INFO] Centroid 31: Short SMA=85.75, Long SMA=278.61, Sharpe=-0.1205
[INFO] Centroid 32: Short SMA=129.38, Long SMA=247.89, Sharpe=-0.3136
[INFO] Centroid 33: Short SMA=63.37, Long SMA=168.44, Sharpe=-0.2691
[INFO] Centroid 34: Short SMA=25.07, Long SMA=221.37, Sharpe=0.0102
[INFO] Centroid 35: Short SMA=116.19, Long SMA=153.90, Sharpe=-0.3111
[INFO] Centroid 36: Short SMA=128.53, Long SMA=220.37, Sharpe=-0.2201
[INFO] Centroid 37: Short SMA=125.10, Long SMA=180.89, Sharpe=0.0334
[INFO] Centroid 38: Short SMA=94.71, Long SMA=216.78, Sharpe=0.0212
[INFO] Centroid 39: Short SMA=234.94, Long SMA=281.17, Sharpe=-0.1214
[INFO] Centroid 40: Short SMA=88.74, Long SMA=109.58, Sharpe=-0.2341
[INFO] Centroid 41: Short SMA=67.96, Long SMA=116.76, Sharpe=-0.5207
[INFO] Centroid 42: Short SMA=59.86, Long SMA=185.70, Sharpe=-0.1495
[INFO] Centroid 43: Short SMA=43.19, Long SMA=237.22, Sharpe=-0.1696
[INFO] Centroid 44: Short SMA=253.74, Long SMA=277.42, Sharpe=-0.2536
[INFO] Centroid 45: Short SMA=175.69, Long SMA=230.29, Sharpe=-0.2476
[INFO] Centroid 46: Short SMA=126.82, Long SMA=289.13, Sharpe=-0.2965
[INFO] Centroid 47: Short SMA=36.92, Long SMA=71.69, Sharpe=0.0146
[INFO] Centroid 48: Short SMA=89.44, Long SMA=242.71, Sharpe=-0.1445
[INFO] Centroid 49: Short SMA=102.72, Long SMA=136.35, Sharpe=-0.4569
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=156, Long SMA=158, Sharpe=0.6261, Trades=79
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=148, Long SMA=174, Sharpe=0.4225, Trades=23
[INFO] Kmeans Top 2: Short SMA=22, Long SMA=188, Sharpe=0.1842, Trades=17
[INFO] Kmeans Top 3: Short SMA=26, Long SMA=146, Sharpe=0.1780, Trades=25
[INFO] Kmeans Top 4: Short SMA=26, Long SMA=124, Sharpe=0.1335, Trades=27
[INFO] Kmeans Top 5: Short SMA=154, Long SMA=186, Sharpe=0.1270, Trades=19
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (69, 152)
[INFO]   Nearest: (70.0, 152.0)
[INFO]   Rounded: (179, 200)
[INFO]   Nearest: (178.0, 200.0)
[INFO]   Rounded: (105, 202)
[INFO]   Nearest: (106.0, 202.0)
[INFO]   Rounded: (30, 121)
[INFO]   Nearest: (30.0, 122.0)
[INFO]   Rounded: (157, 260)
[INFO]   Nearest: (158.0, 260.0)
[INFO]   Rounded: (22, 264)
[INFO]   Rounded: (45, 97)
[INFO]   Nearest: (46.0, 98.0)
[INFO]   Rounded: (56, 283)
[INFO]   Nearest: (56.0, 284.0)
[INFO]   Rounded: (234, 250)
[INFO]   Rounded: (26, 128)
[INFO]   Rounded: (124, 165)
[INFO]   Nearest: (124.0, 166.0)
[INFO]   Rounded: (152, 183)
[INFO]   Nearest: (152.0, 182.0)
[INFO]   Rounded: (58, 260)
[INFO]   Rounded: (103, 273)
[INFO]   Nearest: (102.0, 274.0)
[INFO]   Rounded: (21, 53)
[INFO]   Nearest: (22.0, 54.0)
[INFO]   Rounded: (185, 266)
[INFO]   Nearest: (186.0, 266.0)
[INFO]   Rounded: (25, 54)
[INFO]   Nearest: (26.0, 54.0)
[INFO]   Rounded: (35, 67)
[INFO]   Nearest: (36.0, 66.0)
[INFO]   Rounded: (103, 139)
[INFO]   Nearest: (102.0, 140.0)
[INFO]   Rounded: (272, 290)
[INFO]   Rounded: (25, 279)
[INFO]   Nearest: (26.0, 278.0)
[INFO]   Rounded: (71, 101)
[INFO]   Nearest: (72.0, 102.0)
[INFO]   Rounded: (27, 147)
[INFO]   Nearest: (26.0, 146.0)
[INFO]   Rounded: (149, 173)
[INFO]   Nearest: (148.0, 174.0)
[INFO]   Rounded: (22, 189)
[INFO]   Nearest: (22.0, 188.0)
[INFO]   Rounded: (205, 231)
[INFO]   Nearest: (206.0, 230.0)
[INFO]   Rounded: (145, 280)
[INFO]   Nearest: (146.0, 280.0)
[INFO]   Rounded: (214, 268)
[INFO]   Rounded: (157, 206)
[INFO]   Nearest: (156.0, 206.0)
[INFO]   Rounded: (64, 215)
[INFO]   Nearest: (64.0, 216.0)
[INFO]   Rounded: (86, 279)
[INFO]   Nearest: (86.0, 278.0)
[INFO]   Rounded: (129, 248)
[INFO]   Nearest: (130.0, 248.0)
[INFO]   Rounded: (63, 168)
[INFO]   Nearest: (64.0, 168.0)
[INFO]   Rounded: (25, 221)
[INFO]   Nearest: (26.0, 222.0)
[INFO]   Rounded: (116, 154)
[INFO]   Rounded: (129, 220)
[INFO]   Nearest: (128.0, 220.0)
[INFO]   Rounded: (125, 181)
[INFO]   Nearest: (126.0, 180.0)
[INFO]   Rounded: (95, 217)
[INFO]   Nearest: (94.0, 216.0)
[INFO]   Rounded: (235, 281)
[INFO]   Nearest: (234.0, 282.0)
[INFO]   Rounded: (89, 110)
[INFO]   Nearest: (88.0, 110.0)
[INFO]   Rounded: (68, 117)
[INFO]   Nearest: (68.0, 116.0)
[INFO]   Rounded: (60, 186)
[INFO]   Rounded: (43, 237)
[INFO]   Nearest: (44.0, 238.0)
[INFO]   Rounded: (254, 277)
[INFO]   Nearest: (254.0, 278.0)
[INFO]   Rounded: (176, 230)
[INFO]   Rounded: (127, 289)
[INFO]   Nearest: (126.0, 290.0)
[INFO]   Rounded: (37, 72)
[INFO]   Nearest: (36.0, 72.0)
[INFO]   Rounded: (89, 243)
[INFO]   Nearest: (90.0, 242.0)
[INFO]   Rounded: (103, 136)
[INFO]   Nearest: (102.0, 136.0)
[INFO] Successfully plotted 49 out of 49 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 156, Long SMA: 158
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(148/174) - Original Sharpe: 0.4225, Trades: 23
[INFO] Kmeans cluster 2: SMA(22/188) - Original Sharpe: 0.1842, Trades: 17
[INFO] Kmeans cluster 3: SMA(26/146) - Original Sharpe: 0.1780, Trades: 25
[INFO] Kmeans cluster 4: SMA(26/124) - Original Sharpe: 0.1335, Trades: 27
[INFO] Kmeans cluster 5: SMA(154/186) - Original Sharpe: 0.1270, Trades: 19
[INFO] Trimmed warm-up period. Evaluation data length: 2544
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (156/158)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (148/174) - Sharpe: 0.4225
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Out-of-sample period starts on: 2021-12-17
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-17 2021-12-17            41     2.102424            2.102424
1    2022-02-17 2022-02-17            41    -0.193263           -0.193263
2    2022-04-17 2022-04-17            40    -2.414653           -2.414653
3    2022-06-17 2022-06-17            43     3.471248            3.471248
4    2022-08-17 2022-08-17            41     5.752319            0.260738
5    2022-10-17 2022-10-17            45     0.507784            3.983255
6    2022-12-17 2022-12-17            41     1.439696           -1.059509
7    2023-02-17 2023-02-17            39    -5.196104           -1.698496
8    2023-04-17 2023-04-17            42    -1.914640           -1.914640
9    2023-06-17 2023-06-17            43    -1.864618           -1.864618
10   2023-08-17 2023-08-17            42    -3.026053           -0.337220
11   2023-10-17 2023-10-17            44     2.645057            0.447216
12   2023-12-17 2023-12-17            42     2.127559            3.104874
13   2024-02-17 2024-02-17            40    -5.080096           -3.423521
14   2024-04-17 2024-04-17            41    -1.461984            2.231963
15   2024-06-17 2024-06-17            45     0.717903            0.717903
16   2024-08-17 2024-08-17            42     0.001423            0.001423
17   2024-10-17 2024-10-17            43    -0.391047           -1.160801
18   2024-12-17 2024-12-17             9     7.439225            0.325660
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-17   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2022-02-17   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-04-17   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2022-06-17   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-08-17   |          5.8 |              0.3 |         -5.5 | False         
[INFO] 2022-10-17   |          0.5 |              4.0 |          3.5 | True          
[INFO] 2022-12-17   |          1.4 |             -1.1 |         -2.5 | False         
[INFO] 2023-02-17   |         -5.2 |             -1.7 |          3.5 | True          
[INFO] 2023-04-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-06-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-08-17   |         -3.0 |             -0.3 |          2.7 | True          
[INFO] 2023-10-17   |          2.6 |              0.4 |         -2.2 | False         
[INFO] 2023-12-17   |          2.1 |              3.1 |          1.0 | True          
[INFO] 2024-02-17   |         -5.1 |             -3.4 |          1.7 | True          
[INFO] 2024-04-17   |         -1.5 |              2.2 |          3.7 | True          
[INFO] 2024-06-17   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-08-17   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-10-17   |         -0.4 |             -1.2 |         -0.8 | False         
[INFO] 2024-12-17   |          7.4 |              0.3 |         -7.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-12-17, 2022-02-17, 2022-04-17, 2022-06-17, 2023-04-17, 2023-06-17, 2024-06-17, 2024-08-17
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Kmeans cluster wins (rounded comparison): 6 of 11 periods (54.55% win rate)
[INFO] Updating Excel file with Kmeans results for LZ...
[INFO] Excel file updated successfully. Added LZ with Kmeans win rate 54.5% in row 32
[INFO] Added best Sharpe parameters 156/158 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 156, Long SMA: 158
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(148/174) - Original Sharpe: 0.4225
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LZ_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0054
[INFO] Kmeans Best out-of-sample Sharpe: -0.1947
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for LZ...
[INFO] Excel file updated successfully. Added LZ with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LZ
[INFO] Big Point Value: 10.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.3217 to 0.6261
[INFO] 
Best parameters:
[INFO] Short SMA: 156
[INFO] Long SMA: 158
[INFO] Sharpe Ratio: 0.626081
[INFO] Number of Trades: 79
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10332 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.3217 to 0.6261
[INFO] Trades range: 10.0 to 307.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3792 to 2.8477
[INFO] Scaled Long SMA range: -2.7903 to 1.4416
[INFO] Scaled Sharpe ratio range: -6.1933 to 4.3052
[INFO] Scaled Trades range: -0.6646 to 14.0601
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10332 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5137
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 416 elements
[INFO] Cluster 1: 379 elements
[INFO] Cluster 2: 533 elements
[INFO] Cluster 3: 332 elements
[INFO] Cluster 4: 376 elements
[INFO] Cluster 5: 188 elements
[INFO] Cluster 6: 74 elements
[INFO] Cluster 7: 36 elements
[INFO] Cluster 8: 193 elements
[INFO] Cluster 9: 211 elements
[INFO] Cluster 10: 131 elements
[INFO] Cluster 11: 350 elements
[INFO] Cluster 12: 304 elements
[INFO] Cluster 13: 159 elements
[INFO] Cluster 14: 217 elements
[INFO] Cluster 15: 267 elements
[INFO] Cluster 16: 219 elements
[INFO] Cluster 17: 137 elements
[INFO] Cluster 18: 298 elements
[INFO] Cluster 19: 59 elements
[INFO] Cluster 20: 446 elements
[INFO] Cluster 21: 186 elements
[INFO] Cluster 22: 255 elements
[INFO] Cluster 23: 439 elements
[INFO] Cluster 24: 12 elements
[INFO] Cluster 25: 313 elements
[INFO] Cluster 26: 260 elements
[INFO] Cluster 27: 262 elements
[INFO] Cluster 28: 169 elements
[INFO] Cluster 29: 185 elements
[INFO] Cluster 30: 45 elements
[INFO] Cluster 31: 324 elements
[INFO] Cluster 32: 174 elements
[INFO] Cluster 33: 102 elements
[INFO] Cluster 34: 145 elements
[INFO] Cluster 35: 319 elements
[INFO] Cluster 36: 4 elements
[INFO] Cluster 37: 206 elements
[INFO] Cluster 38: 44 elements
[INFO] Cluster 39: 110 elements
[INFO] Cluster 40: 99 elements
[INFO] Cluster 41: 256 elements
[INFO] Cluster 42: 165 elements
[INFO] Cluster 43: 244 elements
[INFO] Cluster 44: 70 elements
[INFO] Cluster 45: 270 elements
[INFO] Cluster 46: 41 elements
[INFO] Cluster 47: 7 elements
[INFO] Cluster 48: 89 elements
[INFO] Cluster 49: 212 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=56, Long SMA=274, Sharpe=-0.3749, Trades=12
[INFO] Cluster 1 cluster: Short SMA=222, Long SMA=274, Sharpe=-0.0511, Trades=14
[INFO] Cluster 2 cluster: Short SMA=90, Long SMA=272, Sharpe=-0.1231, Trades=10
[INFO] Cluster 3 cluster: Short SMA=64, Long SMA=158, Sharpe=-0.3814, Trades=19
[INFO] Cluster 4 cluster: Short SMA=46, Long SMA=248, Sharpe=-0.1937, Trades=12
[INFO] Cluster 5 cluster: Short SMA=102, Long SMA=112, Sharpe=-0.3506, Trades=50
[INFO] Cluster 6 cluster: Short SMA=14, Long SMA=36, Sharpe=-0.7293, Trades=101
[INFO] Cluster 7 cluster: Short SMA=44, Long SMA=46, Sharpe=-0.3275, Trades=151
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=54, Sharpe=-0.2945, Trades=64
[INFO] Cluster 9 cluster: Short SMA=74, Long SMA=106, Sharpe=-0.3219, Trades=35
[INFO] Cluster 10 cluster: Short SMA=182, Long SMA=188, Sharpe=-0.0003, Trades=42
[INFO] Cluster 11 cluster: Short SMA=22, Long SMA=162, Sharpe=0.2259, Trades=21
[INFO] Cluster 12 cluster: Short SMA=26, Long SMA=98, Sharpe=-0.1875, Trades=41
[INFO] Cluster 13 cluster: Short SMA=238, Long SMA=250, Sharpe=-0.3057, Trades=24
[INFO] Cluster 14 cluster: Short SMA=182, Long SMA=204, Sharpe=-0.0475, Trades=22
[INFO] Cluster 15 cluster: Short SMA=98, Long SMA=218, Sharpe=-0.0968, Trades=10
[INFO] Cluster 16 cluster: Short SMA=102, Long SMA=138, Sharpe=-0.5862, Trades=33
[INFO] Cluster 17 cluster: Short SMA=66, Long SMA=98, Sharpe=-0.6476, Trades=33
[INFO] Cluster 18 cluster: Short SMA=76, Long SMA=140, Sharpe=-0.4493, Trades=21
[INFO] Cluster 19 cluster: Short SMA=94, Long SMA=98, Sharpe=-0.2549, Trades=79
[INFO] Cluster 20 cluster: Short SMA=146, Long SMA=252, Sharpe=-0.2957, Trades=10
[INFO] Cluster 21 cluster: Short SMA=22, Long SMA=274, Sharpe=0.1718, Trades=18
[INFO] Cluster 22 cluster: Short SMA=112, Long SMA=178, Sharpe=-0.0973, Trades=19
[INFO] Cluster 23 cluster: Short SMA=24, Long SMA=218, Sharpe=0.1132, Trades=18
[INFO] Cluster 25 cluster: Short SMA=118, Long SMA=276, Sharpe=-0.2431, Trades=10
[INFO] Cluster 26 cluster: Short SMA=180, Long SMA=270, Sharpe=-0.1210, Trades=10
[INFO] Cluster 27 cluster: Short SMA=150, Long SMA=212, Sharpe=-0.1383, Trades=12
[INFO] Cluster 28 cluster: Short SMA=46, Long SMA=132, Sharpe=-0.0399, Trades=23
[INFO] Cluster 29 cluster: Short SMA=24, Long SMA=126, Sharpe=0.0455, Trades=27
[INFO] Cluster 30 cluster: Short SMA=154, Long SMA=164, Sharpe=0.4730, Trades=41
[INFO] Cluster 31 cluster: Short SMA=68, Long SMA=186, Sharpe=-0.1400, Trades=15
[INFO] Cluster 32 cluster: Short SMA=116, Long SMA=154, Sharpe=-0.2906, Trades=29
[INFO] Cluster 33 cluster: Short SMA=24, Long SMA=64, Sharpe=-0.5103, Trades=64
[INFO] Cluster 34 cluster: Short SMA=276, Long SMA=284, Sharpe=-0.1849, Trades=26
[INFO] Cluster 35 cluster: Short SMA=62, Long SMA=214, Sharpe=-0.2523, Trades=14
[INFO] Cluster 37 cluster: Short SMA=176, Long SMA=230, Sharpe=-0.2859, Trades=16
[INFO] Cluster 38 cluster: Short SMA=44, Long SMA=50, Sharpe=-0.2590, Trades=93
[INFO] Cluster 39 cluster: Short SMA=38, Long SMA=78, Sharpe=0.0444, Trades=43
[INFO] Cluster 40 cluster: Short SMA=146, Long SMA=180, Sharpe=0.3501, Trades=19
[INFO] Cluster 41 cluster: Short SMA=128, Long SMA=222, Sharpe=-0.2250, Trades=10
[INFO] Cluster 42 cluster: Short SMA=138, Long SMA=190, Sharpe=0.0563, Trades=15
[INFO] Cluster 43 cluster: Short SMA=204, Long SMA=236, Sharpe=-0.1194, Trades=18
[INFO] Cluster 44 cluster: Short SMA=146, Long SMA=164, Sharpe=0.3105, Trades=37
[INFO] Cluster 45 cluster: Short SMA=248, Long SMA=284, Sharpe=-0.1697, Trades=14
[INFO] Cluster 46 cluster: Short SMA=176, Long SMA=178, Sharpe=-0.2414, Trades=66
[INFO] Cluster 48 cluster: Short SMA=12, Long SMA=274, Sharpe=-0.0774, Trades=30
[INFO] Cluster 49 cluster: Short SMA=146, Long SMA=284, Sharpe=-0.3462, Trades=10
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=156, Long SMA=158, Sharpe=0.6261, Trades=79
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=154, Long SMA=164, Sharpe=0.4730, Trades=41
[INFO] Top 2: Short SMA=146, Long SMA=180, Sharpe=0.3501, Trades=19
[INFO] Top 3: Short SMA=146, Long SMA=164, Sharpe=0.3105, Trades=37
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10309 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 156, Long SMA: 158
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(154/164) - Original Sharpe: 0.4730, Trades: 41
[INFO] Hierarchical cluster 2: SMA(146/180) - Original Sharpe: 0.3501, Trades: 19
[INFO] Hierarchical cluster 3: SMA(146/164) - Original Sharpe: 0.3105, Trades: 37
[INFO] Hierarchical cluster 4: SMA(22/162) - Original Sharpe: 0.2259, Trades: 21
[INFO] Hierarchical cluster 5: SMA(22/274) - Original Sharpe: 0.1718, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2544
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (156/158)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (154/164) - Sharpe: 0.4730
[INFO] cluster 2: (146/180) - Sharpe: 0.3501
[INFO] cluster 3: (146/164) - Sharpe: 0.3105
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Out-of-sample period starts on: 2021-12-17
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-17 2021-12-17            41     2.102424            2.102424
1    2022-02-17 2022-02-17            41    -0.193263           -0.193263
2    2022-04-17 2022-04-17            40    -2.414653           -2.414653
3    2022-06-17 2022-06-17            43     3.471248            3.471248
4    2022-08-17 2022-08-17            41     5.752319            1.539595
5    2022-10-17 2022-10-17            45     0.507784            2.141812
6    2022-12-17 2022-12-17            41     1.439696           -1.263648
7    2023-02-17 2023-02-17            39    -5.196104           -3.195836
8    2023-04-17 2023-04-17            42    -1.914640           -1.914640
9    2023-06-17 2023-06-17            43    -1.864618           -1.864618
10   2023-08-17 2023-08-17            42    -3.026053           -1.977975
11   2023-10-17 2023-10-17            44     2.645057            1.290004
12   2023-12-17 2023-12-17            42     2.127559            1.123648
13   2024-02-17 2024-02-17            40    -5.080096           -1.350880
14   2024-04-17 2024-04-17            41    -1.461984           -0.036654
15   2024-06-17 2024-06-17            45     0.717903            0.717903
16   2024-08-17 2024-08-17            42     0.001423            0.001423
17   2024-10-17 2024-10-17            43    -0.391047           -0.290333
18   2024-12-17 2024-12-17             9     7.439225            3.065770
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-17   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2022-02-17   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-04-17   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2022-06-17   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-08-17   |          5.8 |              1.5 |         -4.3 | False         
[INFO] 2022-10-17   |          0.5 |              2.1 |          1.6 | True          
[INFO] 2022-12-17   |          1.4 |             -1.3 |         -2.7 | False         
[INFO] 2023-02-17   |         -5.2 |             -3.2 |          2.0 | True          
[INFO] 2023-04-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-06-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-08-17   |         -3.0 |             -2.0 |          1.0 | True          
[INFO] 2023-10-17   |          2.6 |              1.3 |         -1.3 | False         
[INFO] 2023-12-17   |          2.1 |              1.1 |         -1.0 | False         
[INFO] 2024-02-17   |         -5.1 |             -1.4 |          3.7 | True          
[INFO] 2024-04-17   |         -1.5 |             -0.0 |          1.5 | True          
[INFO] 2024-06-17   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-08-17   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-10-17   |         -0.4 |             -0.3 |          0.1 | True          
[INFO] 2024-12-17   |          7.4 |              3.1 |         -4.3 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-12-17, 2022-02-17, 2022-04-17, 2022-06-17, 2023-04-17, 2023-06-17, 2024-06-17, 2024-08-17
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 11 periods (54.55% win rate)
[INFO] Updating Excel file with Hierarchical results for LZ...
[INFO] Excel file updated successfully. Added LZ with Hierarchical win rate 54.5% in row 32
[INFO] Added best Sharpe parameters 156/158 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 156, Long SMA: 158
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(154/164) - Original Sharpe: 0.4730
[INFO] Added cluster 2 to portfolio: SMA(146/180) - Original Sharpe: 0.3501
[INFO] Added cluster 3 to portfolio: SMA(146/164) - Original Sharpe: 0.3105
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LZ_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2386
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1947
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for LZ...
[INFO] Excel file updated successfully. Added LZ with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LZ
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for MME in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 155.72s
[INFO] Best parameters: Short SMA = 42, Long SMA = 46
[INFO] Best Sharpe ratio: 0.770410, Trades: 114
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @MME=103XC
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.01 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $461,080.00
[INFO] Market Buy & Hold P&L: $4,740.00
[INFO] Outperformance: $456,340.00
[INFO] Sharpe ratio (entire period, annualized): 0.635182
[INFO] Sharpe ratio (in-sample, annualized): 0.770410
[INFO] Sharpe ratio (out-of-sample, annualized): 0.299055
[INFO] Maximum Drawdown: $136,680.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 72
[INFO] Out-of-sample period trades: 42
[INFO] Total trades: 114
[INFO] In-sample P&L: $450,370.00
[INFO] Out-of-sample P&L: $70,150.00
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 46, Sharpe = 0.770410
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8268 to 0.7704
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.770410
[INFO] Number of Trades: 114
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8268 to 0.7704
[INFO] Trades range: 11.0 to 345.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.3786 to 3.2235
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 218 elements
[INFO] Kmeans Cluster 1: 161 elements
[INFO] Kmeans Cluster 2: 294 elements
[INFO] Kmeans Cluster 3: 192 elements
[INFO] Kmeans Cluster 4: 159 elements
[INFO] Kmeans Cluster 5: 168 elements
[INFO] Kmeans Cluster 6: 229 elements
[INFO] Kmeans Cluster 7: 233 elements
[INFO] Kmeans Cluster 8: 287 elements
[INFO] Kmeans Cluster 9: 215 elements
[INFO] Kmeans Cluster 10: 288 elements
[INFO] Kmeans Cluster 11: 330 elements
[INFO] Kmeans Cluster 12: 309 elements
[INFO] Kmeans Cluster 13: 208 elements
[INFO] Kmeans Cluster 14: 291 elements
[INFO] Kmeans Cluster 15: 266 elements
[INFO] Kmeans Cluster 16: 164 elements
[INFO] Kmeans Cluster 17: 145 elements
[INFO] Kmeans Cluster 18: 161 elements
[INFO] Kmeans Cluster 19: 338 elements
[INFO] Kmeans Cluster 20: 244 elements
[INFO] Kmeans Cluster 21: 130 elements
[INFO] Kmeans Cluster 22: 175 elements
[INFO] Kmeans Cluster 23: 241 elements
[INFO] Kmeans Cluster 24: 165 elements
[INFO] Kmeans Cluster 25: 111 elements
[INFO] Kmeans Cluster 26: 259 elements
[INFO] Kmeans Cluster 27: 278 elements
[INFO] Kmeans Cluster 28: 219 elements
[INFO] Kmeans Cluster 29: 244 elements
[INFO] Kmeans Cluster 30: 159 elements
[INFO] Kmeans Cluster 31: 234 elements
[INFO] Kmeans Cluster 32: 210 elements
[INFO] Kmeans Cluster 33: 244 elements
[INFO] Kmeans Cluster 34: 86 elements
[INFO] Kmeans Cluster 35: 298 elements
[INFO] Kmeans Cluster 36: 160 elements
[INFO] Kmeans Cluster 37: 138 elements
[INFO] Kmeans Cluster 38: 12 elements
[INFO] Kmeans Cluster 39: 170 elements
[INFO] Kmeans Cluster 40: 228 elements
[INFO] Kmeans Cluster 41: 248 elements
[INFO] Kmeans Cluster 42: 197 elements
[INFO] Kmeans Cluster 43: 186 elements
[INFO] Kmeans Cluster 44: 247 elements
[INFO] Kmeans Cluster 45: 310 elements
[INFO] Kmeans Cluster 46: 161 elements
[INFO] Kmeans Cluster 47: 240 elements
[INFO] Kmeans Cluster 48: 91 elements
[INFO] Kmeans Cluster 49: 244 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=49.99, Long SMA=232.60, Sharpe=0.1123
[INFO] Centroid 1: Short SMA=181.28, Long SMA=239.65, Sharpe=-0.1459
[INFO] Centroid 2: Short SMA=113.51, Long SMA=151.17, Sharpe=-0.4829
[INFO] Centroid 3: Short SMA=26.79, Long SMA=58.20, Sharpe=0.4641
[INFO] Centroid 4: Short SMA=20.57, Long SMA=143.17, Sharpe=0.1897
[INFO] Centroid 5: Short SMA=266.81, Long SMA=285.35, Sharpe=0.1153
[INFO] Centroid 6: Short SMA=109.34, Long SMA=264.52, Sharpe=0.1085
[INFO] Centroid 7: Short SMA=91.01, Long SMA=120.27, Sharpe=-0.1062
[INFO] Centroid 8: Short SMA=195.79, Long SMA=273.87, Sharpe=0.3030
[INFO] Centroid 9: Short SMA=82.00, Long SMA=225.82, Sharpe=-0.3904
[INFO] Centroid 10: Short SMA=141.06, Long SMA=231.01, Sharpe=0.0031
[INFO] Centroid 11: Short SMA=43.40, Long SMA=273.01, Sharpe=-0.0154
[INFO] Centroid 12: Short SMA=40.41, Long SMA=160.58, Sharpe=-0.1438
[INFO] Centroid 13: Short SMA=222.21, Long SMA=274.86, Sharpe=0.1684
[INFO] Centroid 14: Short SMA=149.13, Long SMA=198.76, Sharpe=-0.1750
[INFO] Centroid 15: Short SMA=36.41, Long SMA=77.41, Sharpe=0.2700
[INFO] Centroid 16: Short SMA=188.37, Long SMA=205.61, Sharpe=0.1438
[INFO] Centroid 17: Short SMA=21.43, Long SMA=177.85, Sharpe=0.0522
[INFO] Centroid 18: Short SMA=99.11, Long SMA=178.11, Sharpe=-0.6466
[INFO] Centroid 19: Short SMA=63.79, Long SMA=130.71, Sharpe=0.0566
[INFO] Centroid 20: Short SMA=18.41, Long SMA=270.54, Sharpe=0.1287
[INFO] Centroid 21: Short SMA=263.29, Long SMA=289.92, Sharpe=-0.0757
[INFO] Centroid 22: Short SMA=101.70, Long SMA=140.43, Sharpe=-0.2821
[INFO] Centroid 23: Short SMA=155.11, Long SMA=275.15, Sharpe=-0.0577
[INFO] Centroid 24: Short SMA=77.94, Long SMA=99.64, Sharpe=-0.2723
[INFO] Centroid 25: Short SMA=23.69, Long SMA=52.02, Sharpe=0.6075
[INFO] Centroid 26: Short SMA=65.99, Long SMA=167.61, Sharpe=-0.0354
[INFO] Centroid 27: Short SMA=126.58, Long SMA=284.67, Sharpe=0.0331
[INFO] Centroid 28: Short SMA=164.41, Long SMA=191.65, Sharpe=-0.0310
[INFO] Centroid 29: Short SMA=102.70, Long SMA=211.98, Sharpe=-0.2650
[INFO] Centroid 30: Short SMA=228.87, Long SMA=288.63, Sharpe=0.0366
[INFO] Centroid 31: Short SMA=134.32, Long SMA=246.42, Sharpe=0.1793
[INFO] Centroid 32: Short SMA=128.06, Long SMA=183.80, Sharpe=-0.3497
[INFO] Centroid 33: Short SMA=31.70, Long SMA=228.73, Sharpe=-0.0020
[INFO] Centroid 34: Short SMA=12.21, Long SMA=124.74, Sharpe=0.3943
[INFO] Centroid 35: Short SMA=33.93, Long SMA=104.44, Sharpe=0.1400
[INFO] Centroid 36: Short SMA=139.31, Long SMA=159.57, Sharpe=-0.2494
[INFO] Centroid 37: Short SMA=15.32, Long SMA=210.67, Sharpe=0.1748
[INFO] Centroid 39: Short SMA=61.02, Long SMA=85.82, Sharpe=-0.0452
[INFO] Centroid 40: Short SMA=56.94, Long SMA=285.55, Sharpe=-0.1389
[INFO] Centroid 41: Short SMA=176.48, Long SMA=277.85, Sharpe=0.0883
[INFO] Centroid 42: Short SMA=220.52, Long SMA=243.27, Sharpe=0.4892
[INFO] Centroid 43: Short SMA=241.41, Long SMA=260.60, Sharpe=0.3084
[INFO] Centroid 44: Short SMA=187.94, Long SMA=225.70, Sharpe=-0.0108
[INFO] Centroid 45: Short SMA=50.94, Long SMA=199.45, Sharpe=-0.0782
[INFO] Centroid 46: Short SMA=94.56, Long SMA=193.39, Sharpe=-0.4827
[INFO] Centroid 47: Short SMA=89.48, Long SMA=283.44, Sharpe=-0.0335
[INFO] Centroid 48: Short SMA=21.47, Long SMA=37.14, Sharpe=0.3540
[INFO] Centroid 49: Short SMA=81.17, Long SMA=250.53, Sharpe=-0.1991
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=46, Sharpe=0.7704, Trades=114
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=220, Long SMA=242, Sharpe=0.6326, Trades=25
[INFO] Kmeans Top 2: Short SMA=24, Long SMA=54, Sharpe=0.6116, Trades=52
[INFO] Kmeans Top 3: Short SMA=30, Long SMA=60, Sharpe=0.5087, Trades=44
[INFO] Kmeans Top 4: Short SMA=12, Long SMA=126, Sharpe=0.4636, Trades=35
[INFO] Kmeans Top 5: Short SMA=20, Long SMA=34, Sharpe=0.4133, Trades=85
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (50, 233)
[INFO]   Nearest: (50.0, 232.0)
[INFO]   Rounded: (181, 240)
[INFO]   Nearest: (182.0, 240.0)
[INFO]   Rounded: (114, 151)
[INFO]   Nearest: (114.0, 152.0)
[INFO]   Rounded: (27, 58)
[INFO]   Nearest: (26.0, 58.0)
[INFO]   Rounded: (21, 143)
[INFO]   Nearest: (20.0, 144.0)
[INFO]   Rounded: (267, 285)
[INFO]   Nearest: (266.0, 286.0)
[INFO]   Rounded: (109, 265)
[INFO]   Nearest: (110.0, 264.0)
[INFO]   Rounded: (91, 120)
[INFO]   Nearest: (92.0, 120.0)
[INFO]   Rounded: (196, 274)
[INFO]   Rounded: (82, 226)
[INFO]   Rounded: (141, 231)
[INFO]   Nearest: (142.0, 232.0)
[INFO]   Rounded: (43, 273)
[INFO]   Nearest: (44.0, 274.0)
[INFO]   Rounded: (40, 161)
[INFO]   Nearest: (40.0, 160.0)
[INFO]   Rounded: (222, 275)
[INFO]   Nearest: (222.0, 274.0)
[INFO]   Rounded: (149, 199)
[INFO]   Nearest: (150.0, 198.0)
[INFO]   Rounded: (36, 77)
[INFO]   Nearest: (36.0, 78.0)
[INFO]   Rounded: (188, 206)
[INFO]   Rounded: (21, 178)
[INFO]   Nearest: (22.0, 178.0)
[INFO]   Rounded: (99, 178)
[INFO]   Nearest: (100.0, 178.0)
[INFO]   Rounded: (64, 131)
[INFO]   Nearest: (64.0, 130.0)
[INFO]   Rounded: (18, 271)
[INFO]   Nearest: (18.0, 270.0)
[INFO]   Rounded: (263, 290)
[INFO]   Nearest: (264.0, 290.0)
[INFO]   Rounded: (102, 140)
[INFO]   Rounded: (155, 275)
[INFO]   Nearest: (156.0, 276.0)
[INFO]   Rounded: (78, 100)
[INFO]   Rounded: (24, 52)
[INFO]   Rounded: (66, 168)
[INFO]   Rounded: (127, 285)
[INFO]   Nearest: (126.0, 284.0)
[INFO]   Rounded: (164, 192)
[INFO]   Rounded: (103, 212)
[INFO]   Nearest: (102.0, 212.0)
[INFO]   Rounded: (229, 289)
[INFO]   Nearest: (228.0, 288.0)
[INFO]   Rounded: (134, 246)
[INFO]   Rounded: (128, 184)
[INFO]   Rounded: (32, 229)
[INFO]   Nearest: (32.0, 228.0)
[INFO]   Rounded: (12, 125)
[INFO]   Nearest: (12.0, 124.0)
[INFO]   Rounded: (34, 104)
[INFO]   Rounded: (139, 160)
[INFO]   Nearest: (140.0, 160.0)
[INFO]   Rounded: (15, 211)
[INFO]   Nearest: (16.0, 210.0)
[INFO]   Rounded: (61, 86)
[INFO]   Nearest: (62.0, 86.0)
[INFO]   Rounded: (57, 286)
[INFO]   Nearest: (56.0, 286.0)
[INFO]   Rounded: (176, 278)
[INFO]   Rounded: (221, 243)
[INFO]   Nearest: (220.0, 244.0)
[INFO]   Rounded: (241, 261)
[INFO]   Nearest: (242.0, 260.0)
[INFO]   Rounded: (188, 226)
[INFO]   Rounded: (51, 199)
[INFO]   Nearest: (50.0, 200.0)
[INFO]   Rounded: (95, 193)
[INFO]   Nearest: (94.0, 194.0)
[INFO]   Rounded: (89, 283)
[INFO]   Nearest: (90.0, 284.0)
[INFO]   Rounded: (21, 37)
[INFO]   Nearest: (22.0, 38.0)
[INFO]   Rounded: (81, 251)
[INFO]   Nearest: (82.0, 250.0)
[INFO] Successfully plotted 49 out of 49 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(220/242) - Original Sharpe: 0.6326, Trades: 25
[INFO] Kmeans cluster 2: SMA(24/54) - Original Sharpe: 0.6116, Trades: 52
[INFO] Kmeans cluster 3: SMA(30/60) - Original Sharpe: 0.5087, Trades: 44
[INFO] Kmeans cluster 4: SMA(12/126) - Original Sharpe: 0.4636, Trades: 35
[INFO] Kmeans cluster 5: SMA(20/34) - Original Sharpe: 0.4133, Trades: 85
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (220/242) - Sharpe: 0.6326
[INFO] cluster 2: (24/54) - Sharpe: 0.6116
[INFO] cluster 3: (30/60) - Sharpe: 0.5087
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.361742            0.530052
1    2021-11-14 2021-11-14            43    -1.602839           -3.359950
2    2022-01-14 2022-01-14            41     4.130644            3.814993
3    2022-03-14 2022-03-14            44     1.862130            1.111719
4    2022-05-14 2022-05-14            43    -1.126816            0.878780
5    2022-07-14 2022-07-14            44     1.988272           -0.682438
6    2022-09-14 2022-09-14            43    -0.246838            0.784738
7    2022-11-14 2022-11-14            43     3.722936            0.635913
8    2023-01-14 2023-01-14            41    -3.722520           -1.059948
9    2023-03-14 2023-03-14            44    -1.448805           -0.919243
10   2023-05-14 2023-05-14            44    -0.138874           -1.943279
11   2023-07-14 2023-07-14            44    -1.008814           -4.616755
12   2023-09-14 2023-09-14            43     1.221874            1.221874
13   2023-11-14 2023-11-14            42    -0.797839           -0.240019
14   2024-01-14 2024-01-14            43     0.255477            0.297916
15   2024-03-14 2024-03-14            42     0.482175           -1.550528
16   2024-05-14 2024-05-14            44     0.027624            3.719737
17   2024-07-14 2024-07-14            45     2.029233           -2.033968
18   2024-09-14 2024-09-14            43    -1.061167            0.002167
19   2024-11-14 2024-11-14            33     1.867323            0.954523
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |              0.5 |          0.9 | True          
[INFO] 2021-11-14   |         -1.6 |             -3.4 |         -1.8 | False         
[INFO] 2022-01-14   |          4.1 |              3.8 |         -0.3 | False         
[INFO] 2022-03-14   |          1.9 |              1.1 |         -0.8 | False         
[INFO] 2022-05-14   |         -1.1 |              0.9 |          2.0 | True          
[INFO] 2022-07-14   |          2.0 |             -0.7 |         -2.7 | False         
[INFO] 2022-09-14   |         -0.2 |              0.8 |          1.0 | True          
[INFO] 2022-11-14   |          3.7 |              0.6 |         -3.1 | False         
[INFO] 2023-01-14   |         -3.7 |             -1.1 |          2.6 | True          
[INFO] 2023-03-14   |         -1.4 |             -0.9 |          0.5 | True          
[INFO] 2023-05-14   |         -0.1 |             -1.9 |         -1.8 | False         
[INFO] 2023-07-14   |         -1.0 |             -4.6 |         -3.6 | False         
[INFO] 2023-09-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -0.8 |             -0.2 |          0.6 | True          
[INFO] 2024-01-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-03-14   |          0.5 |             -1.6 |         -2.1 | False         
[INFO] 2024-05-14   |          0.0 |              3.7 |          3.7 | True          
[INFO] 2024-07-14   |          2.0 |             -2.0 |         -4.0 | False         
[INFO] 2024-09-14   |         -1.1 |              0.0 |          1.1 | True          
[INFO] 2024-11-14   |          1.9 |              1.0 |         -0.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-09-14, 2024-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 8 of 18 periods (44.44% win rate)
[INFO] Updating Excel file with Kmeans results for MME...
[INFO] Excel file updated successfully. Added MME with Kmeans win rate 44.4% in row 33
[INFO] Added best Sharpe parameters 42/46 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 46
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(220/242) - Original Sharpe: 0.6326
[INFO] Added cluster 2 to portfolio: SMA(24/54) - Original Sharpe: 0.6116
[INFO] Added cluster 3 to portfolio: SMA(30/60) - Original Sharpe: 0.5087
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MME_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.2419
[INFO] Kmeans Best out-of-sample Sharpe: 0.2991
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for MME...
[INFO] Excel file updated successfully. Added MME with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MME
[INFO] Big Point Value: 50.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8268 to 0.7704
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.770410
[INFO] Number of Trades: 114
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8268 to 0.7704
[INFO] Trades range: 11.0 to 345.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.3786 to 3.2235
[INFO] Scaled Trades range: -0.7680 to 16.8676
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4956
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 594 elements
[INFO] Cluster 1: 406 elements
[INFO] Cluster 2: 224 elements
[INFO] Cluster 3: 143 elements
[INFO] Cluster 4: 355 elements
[INFO] Cluster 5: 451 elements
[INFO] Cluster 6: 266 elements
[INFO] Cluster 7: 339 elements
[INFO] Cluster 8: 67 elements
[INFO] Cluster 9: 242 elements
[INFO] Cluster 10: 163 elements
[INFO] Cluster 11: 6 elements
[INFO] Cluster 12: 181 elements
[INFO] Cluster 13: 296 elements
[INFO] Cluster 14: 405 elements
[INFO] Cluster 15: 315 elements
[INFO] Cluster 16: 234 elements
[INFO] Cluster 17: 405 elements
[INFO] Cluster 18: 612 elements
[INFO] Cluster 19: 181 elements
[INFO] Cluster 20: 252 elements
[INFO] Cluster 21: 106 elements
[INFO] Cluster 22: 260 elements
[INFO] Cluster 23: 50 elements
[INFO] Cluster 24: 10 elements
[INFO] Cluster 25: 246 elements
[INFO] Cluster 26: 61 elements
[INFO] Cluster 27: 199 elements
[INFO] Cluster 28: 248 elements
[INFO] Cluster 29: 275 elements
[INFO] Cluster 30: 522 elements
[INFO] Cluster 31: 64 elements
[INFO] Cluster 32: 262 elements
[INFO] Cluster 33: 180 elements
[INFO] Cluster 34: 161 elements
[INFO] Cluster 35: 35 elements
[INFO] Cluster 36: 49 elements
[INFO] Cluster 37: 177 elements
[INFO] Cluster 38: 174 elements
[INFO] Cluster 39: 138 elements
[INFO] Cluster 40: 287 elements
[INFO] Cluster 41: 188 elements
[INFO] Cluster 42: 30 elements
[INFO] Cluster 43: 61 elements
[INFO] Cluster 44: 206 elements
[INFO] Cluster 45: 10 elements
[INFO] Cluster 46: 115 elements
[INFO] Cluster 47: 60 elements
[INFO] Cluster 48: 151 elements
[INFO] Cluster 49: 123 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=112, Long SMA=278, Sharpe=-0.0371, Trades=15
[INFO] Cluster 1 cluster: Short SMA=88, Long SMA=242, Sharpe=-0.2621, Trades=17
[INFO] Cluster 2 cluster: Short SMA=246, Long SMA=272, Sharpe=0.2983, Trades=25
[INFO] Cluster 3 cluster: Short SMA=28, Long SMA=64, Sharpe=0.5256, Trades=46
[INFO] Cluster 4 cluster: Short SMA=182, Long SMA=274, Sharpe=0.1709, Trades=13
[INFO] Cluster 5 cluster: Short SMA=66, Long SMA=140, Sharpe=0.0360, Trades=20
[INFO] Cluster 6 cluster: Short SMA=222, Long SMA=244, Sharpe=0.5770, Trades=27
[INFO] Cluster 7 cluster: Short SMA=86, Long SMA=208, Sharpe=-0.5175, Trades=16
[INFO] Cluster 8 cluster: Short SMA=104, Long SMA=106, Sharpe=-0.1474, Trades=98
[INFO] Cluster 9 cluster: Short SMA=186, Long SMA=206, Sharpe=0.0833, Trades=29
[INFO] Cluster 10 cluster: Short SMA=22, Long SMA=48, Sharpe=0.4836, Trades=62
[INFO] Cluster 12 cluster: Short SMA=130, Long SMA=154, Sharpe=-0.5027, Trades=30
[INFO] Cluster 13 cluster: Short SMA=20, Long SMA=270, Sharpe=0.1307, Trades=23
[INFO] Cluster 14 cluster: Short SMA=34, Long SMA=98, Sharpe=0.1263, Trades=31
[INFO] Cluster 15 cluster: Short SMA=62, Long SMA=194, Sharpe=-0.0325, Trades=16
[INFO] Cluster 16 cluster: Short SMA=16, Long SMA=196, Sharpe=0.1423, Trades=29
[INFO] Cluster 17 cluster: Short SMA=40, Long SMA=162, Sharpe=-0.1691, Trades=23
[INFO] Cluster 18 cluster: Short SMA=56, Long SMA=278, Sharpe=0.0132, Trades=19
[INFO] Cluster 19 cluster: Short SMA=156, Long SMA=182, Sharpe=-0.0625, Trades=27
[INFO] Cluster 20 cluster: Short SMA=144, Long SMA=204, Sharpe=-0.1021, Trades=17
[INFO] Cluster 21 cluster: Short SMA=72, Long SMA=86, Sharpe=-0.1453, Trades=44
[INFO] Cluster 22 cluster: Short SMA=184, Long SMA=236, Sharpe=-0.0600, Trades=17
[INFO] Cluster 23 cluster: Short SMA=242, Long SMA=244, Sharpe=0.2317, Trades=77
[INFO] Cluster 25 cluster: Short SMA=30, Long SMA=218, Sharpe=0.0304, Trades=23
[INFO] Cluster 26 cluster: Short SMA=124, Long SMA=130, Sharpe=-0.2178, Trades=63
[INFO] Cluster 27 cluster: Short SMA=78, Long SMA=108, Sharpe=-0.1508, Trades=26
[INFO] Cluster 28 cluster: Short SMA=120, Long SMA=194, Sharpe=-0.2777, Trades=17
[INFO] Cluster 29 cluster: Short SMA=196, Long SMA=276, Sharpe=0.3961, Trades=13
[INFO] Cluster 30 cluster: Short SMA=146, Long SMA=232, Sharpe=-0.0922, Trades=17
[INFO] Cluster 31 cluster: Short SMA=26, Long SMA=34, Sharpe=0.3992, Trades=104
[INFO] Cluster 32 cluster: Short SMA=152, Long SMA=278, Sharpe=-0.1516, Trades=13
[INFO] Cluster 33 cluster: Short SMA=262, Long SMA=290, Sharpe=-0.0700, Trades=25
[INFO] Cluster 34 cluster: Short SMA=132, Long SMA=250, Sharpe=0.2468, Trades=13
[INFO] Cluster 35 cluster: Short SMA=32, Long SMA=36, Sharpe=0.5112, Trades=143
[INFO] Cluster 36 cluster: Short SMA=184, Long SMA=188, Sharpe=-0.0893, Trades=63
[INFO] Cluster 37 cluster: Short SMA=20, Long SMA=146, Sharpe=0.1206, Trades=25
[INFO] Cluster 38 cluster: Short SMA=18, Long SMA=92, Sharpe=0.2950, Trades=36
[INFO] Cluster 39 cluster: Short SMA=54, Long SMA=96, Sharpe=-0.1014, Trades=29
[INFO] Cluster 40 cluster: Short SMA=48, Long SMA=234, Sharpe=0.1727, Trades=19
[INFO] Cluster 41 cluster: Short SMA=98, Long SMA=178, Sharpe=-0.6266, Trades=20
[INFO] Cluster 42 cluster: Short SMA=270, Long SMA=274, Sharpe=-0.0231, Trades=51
[INFO] Cluster 43 cluster: Short SMA=154, Long SMA=162, Sharpe=-0.2834, Trades=52
[INFO] Cluster 44 cluster: Short SMA=230, Long SMA=288, Sharpe=0.0634, Trades=19
[INFO] Cluster 46 cluster: Short SMA=90, Long SMA=154, Sharpe=-0.2720, Trades=20
[INFO] Cluster 47 cluster: Short SMA=96, Long SMA=104, Sharpe=-0.3610, Trades=46
[INFO] Cluster 48 cluster: Short SMA=108, Long SMA=148, Sharpe=-0.5554, Trades=22
[INFO] Cluster 49 cluster: Short SMA=88, Long SMA=126, Sharpe=-0.0727, Trades=24
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=46, Sharpe=0.7704, Trades=114
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=222, Long SMA=244, Sharpe=0.5770, Trades=27
[INFO] Top 2: Short SMA=28, Long SMA=64, Sharpe=0.5256, Trades=46
[INFO] Top 3: Short SMA=32, Long SMA=36, Sharpe=0.5112, Trades=143
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10559 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(222/244) - Original Sharpe: 0.5770, Trades: 27
[INFO] Hierarchical cluster 2: SMA(28/64) - Original Sharpe: 0.5256, Trades: 46
[INFO] Hierarchical cluster 3: SMA(32/36) - Original Sharpe: 0.5112, Trades: 143
[INFO] Hierarchical cluster 4: SMA(22/48) - Original Sharpe: 0.4836, Trades: 62
[INFO] Hierarchical cluster 5: SMA(26/34) - Original Sharpe: 0.3992, Trades: 104
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (222/244) - Sharpe: 0.5770
[INFO] cluster 2: (28/64) - Sharpe: 0.5256
[INFO] cluster 3: (32/36) - Sharpe: 0.5112
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.361742            2.219880
1    2021-11-14 2021-11-14            43    -1.602839           -3.727358
2    2022-01-14 2022-01-14            41     4.130644            3.053304
3    2022-03-14 2022-03-14            44     1.862130            0.861822
4    2022-05-14 2022-05-14            43    -1.126816            0.541956
5    2022-07-14 2022-07-14            44     1.988272            0.254961
6    2022-09-14 2022-09-14            43    -0.246838            0.693882
7    2022-11-14 2022-11-14            43     3.722936           -0.137221
8    2023-01-14 2023-01-14            41    -3.722520           -2.261490
9    2023-03-14 2023-03-14            44    -1.448805           -1.294979
10   2023-05-14 2023-05-14            44    -0.138874           -2.478641
11   2023-07-14 2023-07-14            44    -1.008814           -1.283359
12   2023-09-14 2023-09-14            43     1.221874            2.353038
13   2023-11-14 2023-11-14            42    -0.797839           -0.275573
14   2024-01-14 2024-01-14            43     0.255477           -0.754409
15   2024-03-14 2024-03-14            42     0.482175           -1.660974
16   2024-05-14 2024-05-14            44     0.027624           -0.749641
17   2024-07-14 2024-07-14            45     2.029233           -2.446646
18   2024-09-14 2024-09-14            43    -1.061167            0.517191
19   2024-11-14 2024-11-14            33     1.867323            1.907227
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |              2.2 |          2.6 | True          
[INFO] 2021-11-14   |         -1.6 |             -3.7 |         -2.1 | False         
[INFO] 2022-01-14   |          4.1 |              3.1 |         -1.0 | False         
[INFO] 2022-03-14   |          1.9 |              0.9 |         -1.0 | False         
[INFO] 2022-05-14   |         -1.1 |              0.5 |          1.6 | True          
[INFO] 2022-07-14   |          2.0 |              0.3 |         -1.7 | False         
[INFO] 2022-09-14   |         -0.2 |              0.7 |          0.9 | True          
[INFO] 2022-11-14   |          3.7 |             -0.1 |         -3.8 | False         
[INFO] 2023-01-14   |         -3.7 |             -2.3 |          1.4 | True          
[INFO] 2023-03-14   |         -1.4 |             -1.3 |          0.1 | True          
[INFO] 2023-05-14   |         -0.1 |             -2.5 |         -2.4 | False         
[INFO] 2023-07-14   |         -1.0 |             -1.3 |         -0.3 | False         
[INFO] 2023-09-14   |          1.2 |              2.4 |          1.2 | True          
[INFO] 2023-11-14   |         -0.8 |             -0.3 |          0.5 | True          
[INFO] 2024-01-14   |          0.3 |             -0.8 |         -1.1 | False         
[INFO] 2024-03-14   |          0.5 |             -1.7 |         -2.2 | False         
[INFO] 2024-05-14   |          0.0 |             -0.7 |         -0.7 | False         
[INFO] 2024-07-14   |          2.0 |             -2.4 |         -4.4 | False         
[INFO] 2024-09-14   |         -1.1 |              0.5 |          1.6 | True          
[INFO] 2024-11-14   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 19 periods (42.11% win rate)
[INFO] Updating Excel file with Hierarchical results for MME...
[INFO] Excel file updated successfully. Added MME with Hierarchical win rate 42.1% in row 33
[INFO] Added best Sharpe parameters 42/46 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 46
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(222/244) - Original Sharpe: 0.5770
[INFO] Added cluster 2 to portfolio: SMA(28/64) - Original Sharpe: 0.5256
[INFO] Added cluster 3 to portfolio: SMA(32/36) - Original Sharpe: 0.5112
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MME_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3374
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2991
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for MME...
[INFO] Excel file updated successfully. Added MME with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MME
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for MP1 in column D: 8.5
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 118.20s
[INFO] Best parameters: Short SMA = 134, Long SMA = 138
[INFO] Best Sharpe ratio: 0.532081, Trades: 69
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @MP1
[INFO] Big Point Value (from data): 500000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 21.52 contracts
[INFO] Maximum Position Size: 40 contracts
[INFO] Strategy Total P&L: $332,152.00
[INFO] Market Buy & Hold P&L: $-645.00
[INFO] Outperformance: $332,797.00
[INFO] Sharpe ratio (entire period, annualized): 0.421251
[INFO] Sharpe ratio (in-sample, annualized): 0.532081
[INFO] Sharpe ratio (out-of-sample, annualized): 0.165051
[INFO] Maximum Drawdown: $177,843.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 52
[INFO] Out-of-sample period trades: 17
[INFO] Total trades: 69
[INFO] In-sample P&L: $272,899.50
[INFO] Out-of-sample P&L: $36,643.00
[INFO] 
Best parameters from GA: Short SMA = 134, Long SMA = 138, Sharpe = 0.532081
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 500000.0
[INFO] Slippage: 8.5
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8335 to 0.5321
[INFO] 
Best parameters:
[INFO] Short SMA: 134
[INFO] Long SMA: 138
[INFO] Sharpe Ratio: 0.532081
[INFO] Number of Trades: 69
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10439 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8335 to 0.5321
[INFO] Trades range: 10.0 to 324.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3869 to 2.7871
[INFO] Scaled Long SMA range: -2.7944 to 1.4240
[INFO] Scaled Sharpe ratio range: -3.2705 to 3.1456
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 280 elements
[INFO] Kmeans Cluster 1: 229 elements
[INFO] Kmeans Cluster 2: 206 elements
[INFO] Kmeans Cluster 3: 151 elements
[INFO] Kmeans Cluster 4: 180 elements
[INFO] Kmeans Cluster 5: 226 elements
[INFO] Kmeans Cluster 6: 129 elements
[INFO] Kmeans Cluster 7: 302 elements
[INFO] Kmeans Cluster 8: 212 elements
[INFO] Kmeans Cluster 9: 212 elements
[INFO] Kmeans Cluster 10: 179 elements
[INFO] Kmeans Cluster 11: 231 elements
[INFO] Kmeans Cluster 12: 225 elements
[INFO] Kmeans Cluster 13: 179 elements
[INFO] Kmeans Cluster 14: 162 elements
[INFO] Kmeans Cluster 15: 50 elements
[INFO] Kmeans Cluster 16: 179 elements
[INFO] Kmeans Cluster 17: 257 elements
[INFO] Kmeans Cluster 18: 209 elements
[INFO] Kmeans Cluster 19: 281 elements
[INFO] Kmeans Cluster 20: 137 elements
[INFO] Kmeans Cluster 21: 281 elements
[INFO] Kmeans Cluster 22: 248 elements
[INFO] Kmeans Cluster 23: 196 elements
[INFO] Kmeans Cluster 24: 127 elements
[INFO] Kmeans Cluster 25: 247 elements
[INFO] Kmeans Cluster 26: 300 elements
[INFO] Kmeans Cluster 27: 211 elements
[INFO] Kmeans Cluster 28: 265 elements
[INFO] Kmeans Cluster 29: 212 elements
[INFO] Kmeans Cluster 30: 215 elements
[INFO] Kmeans Cluster 31: 287 elements
[INFO] Kmeans Cluster 32: 211 elements
[INFO] Kmeans Cluster 33: 266 elements
[INFO] Kmeans Cluster 34: 262 elements
[INFO] Kmeans Cluster 35: 264 elements
[INFO] Kmeans Cluster 36: 255 elements
[INFO] Kmeans Cluster 37: 264 elements
[INFO] Kmeans Cluster 38: 154 elements
[INFO] Kmeans Cluster 39: 250 elements
[INFO] Kmeans Cluster 40: 205 elements
[INFO] Kmeans Cluster 41: 215 elements
[INFO] Kmeans Cluster 42: 50 elements
[INFO] Kmeans Cluster 43: 79 elements
[INFO] Kmeans Cluster 44: 295 elements
[INFO] Kmeans Cluster 45: 148 elements
[INFO] Kmeans Cluster 46: 100 elements
[INFO] Kmeans Cluster 47: 270 elements
[INFO] Kmeans Cluster 48: 144 elements
[INFO] Kmeans Cluster 49: 202 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=174.65, Long SMA=254.52, Sharpe=-0.4816
[INFO] Centroid 1: Short SMA=73.73, Long SMA=154.67, Sharpe=-0.1171
[INFO] Centroid 2: Short SMA=94.76, Long SMA=285.86, Sharpe=-0.0510
[INFO] Centroid 3: Short SMA=117.02, Long SMA=208.17, Sharpe=0.2688
[INFO] Centroid 4: Short SMA=31.42, Long SMA=193.24, Sharpe=-0.0658
[INFO] Centroid 5: Short SMA=214.71, Long SMA=281.36, Sharpe=-0.4708
[INFO] Centroid 6: Short SMA=22.25, Long SMA=52.82, Sharpe=0.2122
[INFO] Centroid 7: Short SMA=62.15, Long SMA=102.07, Sharpe=-0.3489
[INFO] Centroid 8: Short SMA=251.48, Long SMA=281.27, Sharpe=-0.1268
[INFO] Centroid 9: Short SMA=127.43, Long SMA=270.52, Sharpe=-0.2721
[INFO] Centroid 10: Short SMA=188.84, Long SMA=209.87, Sharpe=-0.2939
[INFO] Centroid 11: Short SMA=23.20, Long SMA=243.01, Sharpe=-0.0123
[INFO] Centroid 12: Short SMA=95.31, Long SMA=167.90, Sharpe=0.0698
[INFO] Centroid 13: Short SMA=150.31, Long SMA=181.21, Sharpe=0.2038
[INFO] Centroid 14: Short SMA=15.59, Long SMA=160.10, Sharpe=0.2041
[INFO] Centroid 15: Short SMA=285.32, Long SMA=295.56, Sharpe=0.3275
[INFO] Centroid 16: Short SMA=29.87, Long SMA=55.73, Sharpe=-0.1047
[INFO] Centroid 17: Short SMA=21.84, Long SMA=278.82, Sharpe=0.0746
[INFO] Centroid 18: Short SMA=146.72, Long SMA=172.93, Sharpe=0.0672
[INFO] Centroid 19: Short SMA=76.51, Long SMA=227.07, Sharpe=-0.2580
[INFO] Centroid 20: Short SMA=162.12, Long SMA=196.83, Sharpe=-0.1412
[INFO] Centroid 21: Short SMA=47.94, Long SMA=136.00, Sharpe=-0.1767
[INFO] Centroid 22: Short SMA=43.60, Long SMA=170.10, Sharpe=-0.2276
[INFO] Centroid 23: Short SMA=26.11, Long SMA=52.74, Sharpe=0.0336
[INFO] Centroid 24: Short SMA=18.90, Long SMA=122.82, Sharpe=0.0868
[INFO] Centroid 25: Short SMA=44.57, Long SMA=227.61, Sharpe=-0.1197
[INFO] Centroid 26: Short SMA=182.08, Long SMA=221.06, Sharpe=-0.4238
[INFO] Centroid 27: Short SMA=126.64, Long SMA=264.73, Sharpe=-0.1613
[INFO] Centroid 28: Short SMA=88.23, Long SMA=116.47, Sharpe=-0.1963
[INFO] Centroid 29: Short SMA=200.46, Long SMA=279.25, Sharpe=-0.3657
[INFO] Centroid 30: Short SMA=80.52, Long SMA=185.61, Sharpe=-0.0366
[INFO] Centroid 31: Short SMA=167.39, Long SMA=286.36, Sharpe=-0.4708
[INFO] Centroid 32: Short SMA=113.32, Long SMA=220.30, Sharpe=0.1262
[INFO] Centroid 33: Short SMA=46.27, Long SMA=85.30, Sharpe=-0.2371
[INFO] Centroid 34: Short SMA=86.07, Long SMA=255.66, Sharpe=-0.1701
[INFO] Centroid 35: Short SMA=54.93, Long SMA=261.64, Sharpe=-0.0503
[INFO] Centroid 36: Short SMA=215.55, Long SMA=245.64, Sharpe=-0.4293
[INFO] Centroid 37: Short SMA=150.81, Long SMA=234.61, Sharpe=-0.3168
[INFO] Centroid 38: Short SMA=125.51, Long SMA=183.83, Sharpe=0.3482
[INFO] Centroid 39: Short SMA=248.22, Long SMA=274.98, Sharpe=-0.2709
[INFO] Centroid 40: Short SMA=24.48, Long SMA=111.95, Sharpe=-0.0589
[INFO] Centroid 41: Short SMA=63.18, Long SMA=199.34, Sharpe=-0.1571
[INFO] Centroid 42: Short SMA=273.12, Long SMA=289.00, Sharpe=0.0999
[INFO] Centroid 43: Short SMA=83.22, Long SMA=95.37, Sharpe=-0.5072
[INFO] Centroid 44: Short SMA=55.56, Long SMA=288.13, Sharpe=-0.1030
[INFO] Centroid 45: Short SMA=17.54, Long SMA=205.11, Sharpe=0.0860
[INFO] Centroid 46: Short SMA=215.87, Long SMA=235.06, Sharpe=-0.5606
[INFO] Centroid 47: Short SMA=105.73, Long SMA=135.33, Sharpe=-0.0497
[INFO] Centroid 48: Short SMA=118.99, Long SMA=233.43, Sharpe=-0.0433
[INFO] Centroid 49: Short SMA=121.78, Long SMA=163.89, Sharpe=0.1827
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=134, Long SMA=138, Sharpe=0.5321, Trades=69
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=124, Long SMA=188, Sharpe=0.3594, Trades=14
[INFO] Kmeans Top 2: Short SMA=118, Long SMA=210, Sharpe=0.3272, Trades=14
[INFO] Kmeans Top 3: Short SMA=122, Long SMA=164, Sharpe=0.2490, Trades=24
[INFO] Kmeans Top 4: Short SMA=286, Long SMA=294, Sharpe=0.2213, Trades=48
[INFO] Kmeans Top 5: Short SMA=16, Long SMA=160, Sharpe=0.2104, Trades=21
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (175, 255)
[INFO]   Nearest: (174.0, 254.0)
[INFO]   Rounded: (74, 155)
[INFO]   Nearest: (74.0, 154.0)
[INFO]   Rounded: (95, 286)
[INFO]   Nearest: (94.0, 286.0)
[INFO]   Rounded: (117, 208)
[INFO]   Nearest: (118.0, 208.0)
[INFO]   Rounded: (31, 193)
[INFO]   Nearest: (32.0, 194.0)
[INFO]   Rounded: (215, 281)
[INFO]   Nearest: (214.0, 282.0)
[INFO]   Rounded: (22, 53)
[INFO]   Nearest: (22.0, 52.0)
[INFO]   Rounded: (62, 102)
[INFO]   Rounded: (251, 281)
[INFO]   Nearest: (252.0, 282.0)
[INFO]   Rounded: (127, 271)
[INFO]   Nearest: (128.0, 270.0)
[INFO]   Rounded: (189, 210)
[INFO]   Nearest: (188.0, 210.0)
[INFO]   Rounded: (23, 243)
[INFO]   Nearest: (24.0, 244.0)
[INFO]   Rounded: (95, 168)
[INFO]   Nearest: (96.0, 168.0)
[INFO]   Rounded: (150, 181)
[INFO]   Nearest: (150.0, 182.0)
[INFO]   Rounded: (16, 160)
[INFO]   Rounded: (285, 296)
[INFO]   Nearest: (286.0, 296.0)
[INFO]   Rounded: (30, 56)
[INFO]   Rounded: (22, 279)
[INFO]   Nearest: (22.0, 278.0)
[INFO]   Rounded: (147, 173)
[INFO]   Nearest: (146.0, 172.0)
[INFO]   Rounded: (77, 227)
[INFO]   Nearest: (76.0, 228.0)
[INFO]   Rounded: (162, 197)
[INFO]   Nearest: (162.0, 196.0)
[INFO]   Rounded: (48, 136)
[INFO]   Rounded: (44, 170)
[INFO]   Rounded: (26, 53)
[INFO]   Nearest: (26.0, 52.0)
[INFO]   Rounded: (19, 123)
[INFO]   Nearest: (18.0, 122.0)
[INFO]   Rounded: (45, 228)
[INFO]   Nearest: (44.0, 228.0)
[INFO]   Rounded: (182, 221)
[INFO]   Nearest: (182.0, 222.0)
[INFO]   Rounded: (127, 265)
[INFO]   Nearest: (126.0, 264.0)
[INFO]   Rounded: (88, 116)
[INFO]   Rounded: (200, 279)
[INFO]   Nearest: (200.0, 280.0)
[INFO]   Rounded: (81, 186)
[INFO]   Nearest: (80.0, 186.0)
[INFO]   Rounded: (167, 286)
[INFO]   Nearest: (168.0, 286.0)
[INFO]   Rounded: (113, 220)
[INFO]   Nearest: (114.0, 220.0)
[INFO]   Rounded: (46, 85)
[INFO]   Nearest: (46.0, 86.0)
[INFO]   Rounded: (86, 256)
[INFO]   Rounded: (55, 262)
[INFO]   Nearest: (54.0, 262.0)
[INFO]   Rounded: (216, 246)
[INFO]   Rounded: (151, 235)
[INFO]   Nearest: (150.0, 234.0)
[INFO]   Rounded: (126, 184)
[INFO]   Rounded: (248, 275)
[INFO]   Nearest: (248.0, 274.0)
[INFO]   Rounded: (24, 112)
[INFO]   Rounded: (63, 199)
[INFO]   Nearest: (64.0, 200.0)
[INFO]   Rounded: (273, 289)
[INFO]   Nearest: (274.0, 288.0)
[INFO]   Rounded: (83, 95)
[INFO]   Nearest: (84.0, 96.0)
[INFO]   Rounded: (56, 288)
[INFO]   Rounded: (18, 205)
[INFO]   Nearest: (18.0, 206.0)
[INFO]   Rounded: (216, 235)
[INFO]   Nearest: (216.0, 236.0)
[INFO]   Rounded: (106, 135)
[INFO]   Nearest: (106.0, 136.0)
[INFO]   Rounded: (119, 233)
[INFO]   Nearest: (118.0, 234.0)
[INFO]   Rounded: (122, 164)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 134, Long SMA: 138
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(124/188) - Original Sharpe: 0.3594, Trades: 14
[INFO] Kmeans cluster 2: SMA(118/210) - Original Sharpe: 0.3272, Trades: 14
[INFO] Kmeans cluster 3: SMA(122/164) - Original Sharpe: 0.2490, Trades: 24
[INFO] Kmeans cluster 4: SMA(286/294) - Original Sharpe: 0.2213, Trades: 48
[INFO] Kmeans cluster 5: SMA(16/160) - Original Sharpe: 0.2104, Trades: 21
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (134/138)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (124/188) - Sharpe: 0.3594
[INFO] cluster 2: (118/210) - Sharpe: 0.3272
[INFO] cluster 3: (122/164) - Sharpe: 0.2490
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.716042           -1.716042
1    2021-11-14 2021-11-14            43    -1.188262           -6.372945
2    2022-01-14 2022-01-14            41    -0.404804            1.052184
3    2022-03-14 2022-03-14            44    -3.078018           -3.362687
4    2022-05-14 2022-05-14            43    -1.026268           -1.026268
5    2022-07-14 2022-07-14            44     2.174461            2.174461
6    2022-09-14 2022-09-14            43     2.833979            2.833979
7    2022-11-14 2022-11-14            43     2.673356            2.849639
8    2023-01-14 2023-01-14            41     0.249214            0.249214
9    2023-03-14 2023-03-14            44     4.663682            4.663682
10   2023-05-14 2023-05-14            44     3.615384            3.615384
11   2023-07-14 2023-07-14            44    -0.398216           -0.398216
12   2023-09-14 2023-09-14            43    -1.304784           -1.304784
13   2023-11-14 2023-11-14            42     3.397164            3.397164
14   2024-01-14 2024-01-14            43    -3.986215            2.239665
15   2024-03-14 2024-03-14            42    -0.165280           -0.165280
16   2024-05-14 2024-05-14            44    -1.994953           -1.994953
17   2024-07-14 2024-07-14            45    -0.809966           -3.074719
18   2024-09-14 2024-09-14            43     2.955873            2.955873
19   2024-11-14 2024-11-14            33     0.878530            0.878530
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.2 |             -6.4 |         -5.2 | False         
[INFO] 2022-01-14   |         -0.4 |              1.1 |          1.5 | True          
[INFO] 2022-03-14   |         -3.1 |             -3.4 |         -0.3 | False         
[INFO] 2022-05-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.7 |              2.8 |          0.1 | True          
[INFO] 2023-01-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          4.7 |              4.7 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -4.0 |              2.2 |          6.2 | True          
[INFO] 2024-03-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.8 |             -3.1 |         -2.3 | False         
[INFO] 2024-09-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2024-11-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-03-14, 2024-05-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 6
[INFO] Kmeans cluster wins (rounded comparison): 3 of 6 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Kmeans win rate 50.0% in row 34
[INFO] Added best Sharpe parameters 134/138 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 134, Long SMA: 138
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(124/188) - Original Sharpe: 0.3594
[INFO] Added cluster 2 to portfolio: SMA(118/210) - Original Sharpe: 0.3272
[INFO] Added cluster 3 to portfolio: SMA(122/164) - Original Sharpe: 0.2490
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MP1_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3157
[INFO] Kmeans Best out-of-sample Sharpe: 0.1651
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MP1
[INFO] Big Point Value: 500000.0
[INFO] Slippage: 8.5
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8335 to 0.5321
[INFO] 
Best parameters:
[INFO] Short SMA: 134
[INFO] Long SMA: 138
[INFO] Sharpe Ratio: 0.532081
[INFO] Number of Trades: 69
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10439 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8335 to 0.5321
[INFO] Trades range: 10.0 to 324.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3869 to 2.7871
[INFO] Scaled Long SMA range: -2.7944 to 1.4240
[INFO] Scaled Sharpe ratio range: -3.2705 to 3.1456
[INFO] Scaled Trades range: -0.6512 to 13.7612
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10439 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5648
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 62 elements
[INFO] Cluster 1: 436 elements
[INFO] Cluster 2: 89 elements
[INFO] Cluster 3: 413 elements
[INFO] Cluster 4: 427 elements
[INFO] Cluster 5: 287 elements
[INFO] Cluster 6: 359 elements
[INFO] Cluster 7: 372 elements
[INFO] Cluster 8: 117 elements
[INFO] Cluster 9: 448 elements
[INFO] Cluster 10: 388 elements
[INFO] Cluster 11: 81 elements
[INFO] Cluster 12: 443 elements
[INFO] Cluster 13: 230 elements
[INFO] Cluster 14: 36 elements
[INFO] Cluster 15: 395 elements
[INFO] Cluster 16: 249 elements
[INFO] Cluster 17: 60 elements
[INFO] Cluster 18: 495 elements
[INFO] Cluster 19: 308 elements
[INFO] Cluster 20: 220 elements
[INFO] Cluster 21: 118 elements
[INFO] Cluster 22: 290 elements
[INFO] Cluster 23: 301 elements
[INFO] Cluster 24: 36 elements
[INFO] Cluster 25: 366 elements
[INFO] Cluster 26: 64 elements
[INFO] Cluster 27: 150 elements
[INFO] Cluster 28: 40 elements
[INFO] Cluster 29: 205 elements
[INFO] Cluster 30: 109 elements
[INFO] Cluster 31: 26 elements
[INFO] Cluster 32: 395 elements
[INFO] Cluster 33: 162 elements
[INFO] Cluster 34: 164 elements
[INFO] Cluster 35: 325 elements
[INFO] Cluster 36: 15 elements
[INFO] Cluster 37: 278 elements
[INFO] Cluster 38: 316 elements
[INFO] Cluster 39: 382 elements
[INFO] Cluster 40: 14 elements
[INFO] Cluster 41: 61 elements
[INFO] Cluster 42: 52 elements
[INFO] Cluster 43: 197 elements
[INFO] Cluster 44: 185 elements
[INFO] Cluster 45: 43 elements
[INFO] Cluster 46: 111 elements
[INFO] Cluster 47: 26 elements
[INFO] Cluster 48: 88 elements
[INFO] Cluster 49: 5 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=262, Long SMA=266, Sharpe=-0.1695, Trades=63
[INFO] Cluster 1 cluster: Short SMA=86, Long SMA=272, Sharpe=-0.1499, Trades=14
[INFO] Cluster 2 cluster: Short SMA=76, Long SMA=84, Sharpe=-0.1610, Trades=65
[INFO] Cluster 3 cluster: Short SMA=128, Long SMA=268, Sharpe=-0.1675, Trades=12
[INFO] Cluster 4 cluster: Short SMA=92, Long SMA=170, Sharpe=-0.0282, Trades=20
[INFO] Cluster 5 cluster: Short SMA=132, Long SMA=164, Sharpe=0.0928, Trades=30
[INFO] Cluster 6 cluster: Short SMA=50, Long SMA=88, Sharpe=-0.2277, Trades=31
[INFO] Cluster 7 cluster: Short SMA=252, Long SMA=282, Sharpe=-0.2094, Trades=18
[INFO] Cluster 8 cluster: Short SMA=30, Long SMA=48, Sharpe=0.1090, Trades=67
[INFO] Cluster 9 cluster: Short SMA=52, Long SMA=162, Sharpe=-0.1956, Trades=19
[INFO] Cluster 10 cluster: Short SMA=154, Long SMA=224, Sharpe=-0.2839, Trades=14
[INFO] Cluster 11 cluster: Short SMA=20, Long SMA=36, Sharpe=-0.0670, Trades=98
[INFO] Cluster 12 cluster: Short SMA=80, Long SMA=230, Sharpe=-0.2074, Trades=14
[INFO] Cluster 13 cluster: Short SMA=128, Long SMA=230, Sharpe=0.0421, Trades=12
[INFO] Cluster 14 cluster: Short SMA=28, Long SMA=34, Sharpe=0.2304, Trades=133
[INFO] Cluster 15 cluster: Short SMA=52, Long SMA=194, Sharpe=-0.0596, Trades=16
[INFO] Cluster 16 cluster: Short SMA=218, Long SMA=240, Sharpe=-0.5426, Trades=23
[INFO] Cluster 17 cluster: Short SMA=222, Long SMA=228, Sharpe=-0.4206, Trades=57
[INFO] Cluster 18 cluster: Short SMA=52, Long SMA=276, Sharpe=-0.0219, Trades=12
[INFO] Cluster 19 cluster: Short SMA=130, Long SMA=188, Sharpe=0.3046, Trades=18
[INFO] Cluster 20 cluster: Short SMA=16, Long SMA=168, Sharpe=0.1633, Trades=23
[INFO] Cluster 21 cluster: Short SMA=144, Long SMA=150, Sharpe=0.1853, Trades=58
[INFO] Cluster 22 cluster: Short SMA=170, Long SMA=270, Sharpe=-0.5718, Trades=10
[INFO] Cluster 23 cluster: Short SMA=58, Long SMA=106, Sharpe=-0.3253, Trades=27
[INFO] Cluster 24 cluster: Short SMA=156, Long SMA=158, Sharpe=0.1727, Trades=108
[INFO] Cluster 25 cluster: Short SMA=184, Long SMA=280, Sharpe=-0.3625, Trades=10
[INFO] Cluster 26 cluster: Short SMA=280, Long SMA=294, Sharpe=0.3256, Trades=36
[INFO] Cluster 27 cluster: Short SMA=36, Long SMA=138, Sharpe=-0.1726, Trades=23
[INFO] Cluster 28 cluster: Short SMA=80, Long SMA=82, Sharpe=-0.1646, Trades=104
[INFO] Cluster 29 cluster: Short SMA=20, Long SMA=92, Sharpe=-0.0617, Trades=35
[INFO] Cluster 30 cluster: Short SMA=20, Long SMA=62, Sharpe=0.1458, Trades=47
[INFO] Cluster 31 cluster: Short SMA=220, Long SMA=222, Sharpe=-0.3192, Trades=101
[INFO] Cluster 32 cluster: Short SMA=216, Long SMA=276, Sharpe=-0.4864, Trades=12
[INFO] Cluster 33 cluster: Short SMA=120, Long SMA=200, Sharpe=0.3609, Trades=14
[INFO] Cluster 34 cluster: Short SMA=20, Long SMA=212, Sharpe=-0.0288, Trades=22
[INFO] Cluster 35 cluster: Short SMA=178, Long SMA=232, Sharpe=-0.4548, Trades=18
[INFO] Cluster 37 cluster: Short SMA=40, Long SMA=232, Sharpe=-0.2079, Trades=14
[INFO] Cluster 38 cluster: Short SMA=98, Long SMA=136, Sharpe=-0.0613, Trades=28
[INFO] Cluster 39 cluster: Short SMA=22, Long SMA=268, Sharpe=0.0411, Trades=12
[INFO] Cluster 41 cluster: Short SMA=164, Long SMA=178, Sharpe=0.0198, Trades=44
[INFO] Cluster 42 cluster: Short SMA=116, Long SMA=124, Sharpe=-0.1825, Trades=50
[INFO] Cluster 43 cluster: Short SMA=62, Long SMA=128, Sharpe=-0.1781, Trades=26
[INFO] Cluster 44 cluster: Short SMA=112, Long SMA=226, Sharpe=0.1580, Trades=12
[INFO] Cluster 45 cluster: Short SMA=192, Long SMA=198, Sharpe=-0.3255, Trades=60
[INFO] Cluster 46 cluster: Short SMA=20, Long SMA=120, Sharpe=-0.0086, Trades=27
[INFO] Cluster 47 cluster: Short SMA=28, Long SMA=32, Sharpe=-0.0104, Trades=170
[INFO] Cluster 48 cluster: Short SMA=202, Long SMA=216, Sharpe=-0.4229, Trades=38
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=134, Long SMA=138, Sharpe=0.5321, Trades=69
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=120, Long SMA=200, Sharpe=0.3609, Trades=14
[INFO] Top 2: Short SMA=280, Long SMA=294, Sharpe=0.3256, Trades=36
[INFO] Top 3: Short SMA=130, Long SMA=188, Sharpe=0.3046, Trades=18
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10405 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 134, Long SMA: 138
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(120/200) - Original Sharpe: 0.3609, Trades: 14
[INFO] Hierarchical cluster 2: SMA(280/294) - Original Sharpe: 0.3256, Trades: 36
[INFO] Hierarchical cluster 3: SMA(130/188) - Original Sharpe: 0.3046, Trades: 18
[INFO] Hierarchical cluster 4: SMA(28/34) - Original Sharpe: 0.2304, Trades: 133
[INFO] Hierarchical cluster 5: SMA(144/150) - Original Sharpe: 0.1853, Trades: 58
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (134/138)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (120/200) - Sharpe: 0.3609
[INFO] cluster 2: (280/294) - Sharpe: 0.3256
[INFO] cluster 3: (130/188) - Sharpe: 0.3046
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.716042           -1.716042
1    2021-11-14 2021-11-14            43    -1.188262           -2.566552
2    2022-01-14 2022-01-14            41    -0.404804            1.652075
3    2022-03-14 2022-03-14            44    -3.078018           -1.466536
4    2022-05-14 2022-05-14            43    -1.026268           -1.026268
5    2022-07-14 2022-07-14            44     2.174461            2.174461
6    2022-09-14 2022-09-14            43     2.833979            2.833979
7    2022-11-14 2022-11-14            43     2.673356            2.849639
8    2023-01-14 2023-01-14            41     0.249214            0.249214
9    2023-03-14 2023-03-14            44     4.663682            4.663682
10   2023-05-14 2023-05-14            44     3.615384            3.615384
11   2023-07-14 2023-07-14            44    -0.398216           -0.398216
12   2023-09-14 2023-09-14            43    -1.304784           -1.304784
13   2023-11-14 2023-11-14            42     3.397164            3.397164
14   2024-01-14 2024-01-14            43    -3.986215            2.512948
15   2024-03-14 2024-03-14            42    -0.165280           -0.165280
16   2024-05-14 2024-05-14            44    -1.994953           -1.994953
17   2024-07-14 2024-07-14            45    -0.809966           -4.455653
18   2024-09-14 2024-09-14            43     2.955873            1.717531
19   2024-11-14 2024-11-14            33     0.878530            2.038273
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.2 |             -2.6 |         -1.4 | False         
[INFO] 2022-01-14   |         -0.4 |              1.7 |          2.1 | True          
[INFO] 2022-03-14   |         -3.1 |             -1.5 |          1.6 | True          
[INFO] 2022-05-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.7 |              2.8 |          0.1 | True          
[INFO] 2023-01-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          4.7 |              4.7 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -4.0 |              2.5 |          6.5 | True          
[INFO] 2024-03-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.8 |             -4.5 |         -3.7 | False         
[INFO] 2024-09-14   |          3.0 |              1.7 |         -1.3 | False         
[INFO] 2024-11-14   |          0.9 |              2.0 |          1.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-03-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 8 periods (62.50% win rate)
[INFO] Updating Excel file with Hierarchical results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Hierarchical win rate 62.5% in row 34
[INFO] Added best Sharpe parameters 134/138 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 134, Long SMA: 138
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(120/200) - Original Sharpe: 0.3609
[INFO] Added cluster 2 to portfolio: SMA(280/294) - Original Sharpe: 0.3256
[INFO] Added cluster 3 to portfolio: SMA(130/188) - Original Sharpe: 0.3046
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MP1_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3829
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1651
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MP1
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NE1 in column D: 9.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 64
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 133.68s
[INFO] Best parameters: Short SMA = 158, Long SMA = 288
[INFO] Best Sharpe ratio: 0.601145, Trades: 14
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NE1
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.80 contracts
[INFO] Maximum Position Size: 16 contracts
[INFO] Strategy Total P&L: $355,980.00
[INFO] Market Buy & Hold P&L: $-19,895.00
[INFO] Outperformance: $375,875.00
[INFO] Sharpe ratio (entire period, annualized): 0.489962
[INFO] Sharpe ratio (in-sample, annualized): 0.601145
[INFO] Sharpe ratio (out-of-sample, annualized): 0.226030
[INFO] Maximum Drawdown: $99,250.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 9
[INFO] Out-of-sample period trades: 5
[INFO] Total trades: 14
[INFO] In-sample P&L: $307,448.00
[INFO] Out-of-sample P&L: $48,722.00
[INFO] 
Best parameters from GA: Short SMA = 158, Long SMA = 288, Sharpe = 0.601145
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8463 to 0.6011
[INFO] 
Best parameters:
[INFO] Short SMA: 158
[INFO] Long SMA: 288
[INFO] Sharpe Ratio: 0.601145
[INFO] Number of Trades: 14
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8463 to 0.6011
[INFO] Trades range: 12.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8285 to 2.8656
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 238 elements
[INFO] Kmeans Cluster 1: 186 elements
[INFO] Kmeans Cluster 2: 241 elements
[INFO] Kmeans Cluster 3: 314 elements
[INFO] Kmeans Cluster 4: 207 elements
[INFO] Kmeans Cluster 5: 185 elements
[INFO] Kmeans Cluster 6: 210 elements
[INFO] Kmeans Cluster 7: 259 elements
[INFO] Kmeans Cluster 8: 222 elements
[INFO] Kmeans Cluster 9: 308 elements
[INFO] Kmeans Cluster 10: 175 elements
[INFO] Kmeans Cluster 11: 199 elements
[INFO] Kmeans Cluster 12: 252 elements
[INFO] Kmeans Cluster 13: 244 elements
[INFO] Kmeans Cluster 14: 169 elements
[INFO] Kmeans Cluster 15: 200 elements
[INFO] Kmeans Cluster 16: 137 elements
[INFO] Kmeans Cluster 17: 239 elements
[INFO] Kmeans Cluster 18: 259 elements
[INFO] Kmeans Cluster 19: 65 elements
[INFO] Kmeans Cluster 20: 182 elements
[INFO] Kmeans Cluster 21: 180 elements
[INFO] Kmeans Cluster 22: 303 elements
[INFO] Kmeans Cluster 23: 360 elements
[INFO] Kmeans Cluster 24: 225 elements
[INFO] Kmeans Cluster 25: 240 elements
[INFO] Kmeans Cluster 26: 225 elements
[INFO] Kmeans Cluster 27: 252 elements
[INFO] Kmeans Cluster 28: 170 elements
[INFO] Kmeans Cluster 29: 189 elements
[INFO] Kmeans Cluster 30: 208 elements
[INFO] Kmeans Cluster 31: 232 elements
[INFO] Kmeans Cluster 32: 215 elements
[INFO] Kmeans Cluster 33: 225 elements
[INFO] Kmeans Cluster 34: 98 elements
[INFO] Kmeans Cluster 35: 204 elements
[INFO] Kmeans Cluster 36: 213 elements
[INFO] Kmeans Cluster 37: 176 elements
[INFO] Kmeans Cluster 38: 234 elements
[INFO] Kmeans Cluster 39: 95 elements
[INFO] Kmeans Cluster 40: 241 elements
[INFO] Kmeans Cluster 41: 236 elements
[INFO] Kmeans Cluster 42: 173 elements
[INFO] Kmeans Cluster 43: 148 elements
[INFO] Kmeans Cluster 44: 251 elements
[INFO] Kmeans Cluster 45: 187 elements
[INFO] Kmeans Cluster 46: 203 elements
[INFO] Kmeans Cluster 47: 207 elements
[INFO] Kmeans Cluster 48: 200 elements
[INFO] Kmeans Cluster 49: 204 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=76.67, Long SMA=154.00, Sharpe=-0.5489
[INFO] Centroid 1: Short SMA=171.04, Long SMA=272.96, Sharpe=0.2184
[INFO] Centroid 2: Short SMA=89.35, Long SMA=240.47, Sharpe=-0.2093
[INFO] Centroid 3: Short SMA=27.84, Long SMA=113.69, Sharpe=-0.1336
[INFO] Centroid 4: Short SMA=181.60, Long SMA=266.77, Sharpe=0.0975
[INFO] Centroid 5: Short SMA=26.09, Long SMA=289.99, Sharpe=0.1651
[INFO] Centroid 6: Short SMA=56.47, Long SMA=220.31, Sharpe=-0.4541
[INFO] Centroid 7: Short SMA=137.11, Long SMA=171.85, Sharpe=-0.0326
[INFO] Centroid 8: Short SMA=244.59, Long SMA=276.46, Sharpe=0.3514
[INFO] Centroid 9: Short SMA=37.37, Long SMA=170.21, Sharpe=-0.4065
[INFO] Centroid 10: Short SMA=32.27, Long SMA=53.51, Sharpe=0.1521
[INFO] Centroid 11: Short SMA=171.32, Long SMA=213.09, Sharpe=-0.1266
[INFO] Centroid 12: Short SMA=64.79, Long SMA=130.38, Sharpe=-0.4209
[INFO] Centroid 13: Short SMA=127.48, Long SMA=286.96, Sharpe=0.2356
[INFO] Centroid 14: Short SMA=20.24, Long SMA=166.39, Sharpe=-0.2391
[INFO] Centroid 15: Short SMA=220.11, Long SMA=241.56, Sharpe=-0.2993
[INFO] Centroid 16: Short SMA=18.89, Long SMA=234.35, Sharpe=-0.0737
[INFO] Centroid 17: Short SMA=120.23, Long SMA=156.21, Sharpe=-0.2256
[INFO] Centroid 18: Short SMA=90.86, Long SMA=191.58, Sharpe=-0.4740
[INFO] Centroid 19: Short SMA=20.40, Long SMA=41.32, Sharpe=-0.2375
[INFO] Centroid 20: Short SMA=53.78, Long SMA=238.07, Sharpe=-0.3162
[INFO] Centroid 21: Short SMA=49.09, Long SMA=85.87, Sharpe=-0.2163
[INFO] Centroid 22: Short SMA=60.44, Long SMA=281.64, Sharpe=0.0547
[INFO] Centroid 23: Short SMA=139.64, Long SMA=227.28, Sharpe=0.0050
[INFO] Centroid 24: Short SMA=70.12, Long SMA=179.21, Sharpe=-0.6639
[INFO] Centroid 25: Short SMA=149.96, Long SMA=278.84, Sharpe=0.3461
[INFO] Centroid 26: Short SMA=242.78, Long SMA=281.72, Sharpe=0.1590
[INFO] Centroid 27: Short SMA=42.39, Long SMA=196.56, Sharpe=-0.5419
[INFO] Centroid 28: Short SMA=273.94, Long SMA=289.62, Sharpe=0.2811
[INFO] Centroid 29: Short SMA=198.78, Long SMA=220.83, Sharpe=-0.1825
[INFO] Centroid 30: Short SMA=214.26, Long SMA=264.14, Sharpe=-0.1516
[INFO] Centroid 31: Short SMA=95.57, Long SMA=286.28, Sharpe=0.0965
[INFO] Centroid 32: Short SMA=33.49, Long SMA=128.38, Sharpe=-0.2814
[INFO] Centroid 33: Short SMA=204.06, Long SMA=283.87, Sharpe=-0.0125
[INFO] Centroid 34: Short SMA=77.76, Long SMA=92.63, Sharpe=-0.5400
[INFO] Centroid 35: Short SMA=183.79, Long SMA=238.74, Sharpe=-0.0364
[INFO] Centroid 36: Short SMA=98.33, Long SMA=212.72, Sharpe=-0.3266
[INFO] Centroid 37: Short SMA=46.53, Long SMA=257.38, Sharpe=-0.1358
[INFO] Centroid 38: Short SMA=98.42, Long SMA=122.81, Sharpe=-0.2503
[INFO] Centroid 39: Short SMA=161.28, Long SMA=175.16, Sharpe=0.1830
[INFO] Centroid 40: Short SMA=96.42, Long SMA=261.97, Sharpe=-0.0450
[INFO] Centroid 41: Short SMA=131.28, Long SMA=247.80, Sharpe=0.1635
[INFO] Centroid 42: Short SMA=25.26, Long SMA=47.72, Sharpe=-0.0519
[INFO] Centroid 43: Short SMA=23.15, Long SMA=216.73, Sharpe=-0.2690
[INFO] Centroid 44: Short SMA=130.87, Long SMA=197.00, Sharpe=-0.1582
[INFO] Centroid 45: Short SMA=172.28, Long SMA=196.51, Sharpe=-0.0056
[INFO] Centroid 46: Short SMA=72.01, Long SMA=94.67, Sharpe=-0.3899
[INFO] Centroid 47: Short SMA=23.78, Long SMA=265.97, Sharpe=0.0097
[INFO] Centroid 48: Short SMA=25.60, Long SMA=81.13, Sharpe=0.0059
[INFO] Centroid 49: Short SMA=110.73, Long SMA=146.09, Sharpe=-0.3817
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=158, Long SMA=288, Sharpe=0.6011, Trades=14
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=244, Long SMA=276, Sharpe=0.3684, Trades=20
[INFO] Kmeans Top 2: Short SMA=274, Long SMA=290, Sharpe=0.3157, Trades=24
[INFO] Kmeans Top 3: Short SMA=150, Long SMA=280, Sharpe=0.3054, Trades=16
[INFO] Kmeans Top 4: Short SMA=126, Long SMA=288, Sharpe=0.2107, Trades=18
[INFO] Kmeans Top 5: Short SMA=244, Long SMA=288, Sharpe=0.2105, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (77, 154)
[INFO]   Nearest: (76.0, 154.0)
[INFO]   Rounded: (171, 273)
[INFO]   Nearest: (172.0, 272.0)
[INFO]   Rounded: (89, 240)
[INFO]   Nearest: (90.0, 240.0)
[INFO]   Rounded: (28, 114)
[INFO]   Rounded: (182, 267)
[INFO]   Nearest: (182.0, 266.0)
[INFO]   Rounded: (26, 290)
[INFO]   Rounded: (56, 220)
[INFO]   Rounded: (137, 172)
[INFO]   Nearest: (138.0, 172.0)
[INFO]   Rounded: (245, 276)
[INFO]   Nearest: (244.0, 276.0)
[INFO]   Rounded: (37, 170)
[INFO]   Nearest: (38.0, 170.0)
[INFO]   Rounded: (32, 54)
[INFO]   Rounded: (171, 213)
[INFO]   Nearest: (172.0, 214.0)
[INFO]   Rounded: (65, 130)
[INFO]   Nearest: (64.0, 130.0)
[INFO]   Rounded: (127, 287)
[INFO]   Nearest: (128.0, 286.0)
[INFO]   Rounded: (20, 166)
[INFO]   Rounded: (220, 242)
[INFO]   Rounded: (19, 234)
[INFO]   Nearest: (18.0, 234.0)
[INFO]   Rounded: (120, 156)
[INFO]   Rounded: (91, 192)
[INFO]   Nearest: (90.0, 192.0)
[INFO]   Rounded: (20, 41)
[INFO]   Nearest: (20.0, 42.0)
[INFO]   Rounded: (54, 238)
[INFO]   Rounded: (49, 86)
[INFO]   Nearest: (50.0, 86.0)
[INFO]   Rounded: (60, 282)
[INFO]   Rounded: (140, 227)
[INFO]   Nearest: (140.0, 228.0)
[INFO]   Rounded: (70, 179)
[INFO]   Nearest: (70.0, 180.0)
[INFO]   Rounded: (150, 279)
[INFO]   Nearest: (150.0, 278.0)
[INFO]   Rounded: (243, 282)
[INFO]   Nearest: (242.0, 282.0)
[INFO]   Rounded: (42, 197)
[INFO]   Nearest: (42.0, 196.0)
[INFO]   Rounded: (274, 290)
[INFO]   Rounded: (199, 221)
[INFO]   Nearest: (198.0, 220.0)
[INFO]   Rounded: (214, 264)
[INFO]   Rounded: (96, 286)
[INFO]   Rounded: (33, 128)
[INFO]   Nearest: (34.0, 128.0)
[INFO]   Rounded: (204, 284)
[INFO]   Rounded: (78, 93)
[INFO]   Nearest: (78.0, 92.0)
[INFO]   Rounded: (184, 239)
[INFO]   Nearest: (184.0, 238.0)
[INFO]   Rounded: (98, 213)
[INFO]   Nearest: (98.0, 212.0)
[INFO]   Rounded: (47, 257)
[INFO]   Nearest: (46.0, 258.0)
[INFO]   Rounded: (98, 123)
[INFO]   Nearest: (98.0, 122.0)
[INFO]   Rounded: (161, 175)
[INFO]   Nearest: (162.0, 176.0)
[INFO]   Rounded: (96, 262)
[INFO]   Rounded: (131, 248)
[INFO]   Nearest: (132.0, 248.0)
[INFO]   Rounded: (25, 48)
[INFO]   Nearest: (26.0, 48.0)
[INFO]   Rounded: (23, 217)
[INFO]   Nearest: (24.0, 216.0)
[INFO]   Rounded: (131, 197)
[INFO]   Nearest: (130.0, 198.0)
[INFO]   Rounded: (172, 197)
[INFO]   Nearest: (172.0, 196.0)
[INFO]   Rounded: (72, 95)
[INFO]   Nearest: (72.0, 94.0)
[INFO]   Rounded: (24, 266)
[INFO]   Rounded: (26, 81)
[INFO]   Nearest: (26.0, 82.0)
[INFO]   Rounded: (111, 146)
[INFO]   Nearest: (110.0, 146.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 158, Long SMA: 288
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 64
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(244/276) - Original Sharpe: 0.3684, Trades: 20
[INFO] Kmeans cluster 2: SMA(274/290) - Original Sharpe: 0.3157, Trades: 24
[INFO] Kmeans cluster 3: SMA(150/280) - Original Sharpe: 0.3054, Trades: 16
[INFO] Kmeans cluster 4: SMA(126/288) - Original Sharpe: 0.2107, Trades: 18
[INFO] Kmeans cluster 5: SMA(244/288) - Original Sharpe: 0.2105, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (158/288)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (244/276) - Sharpe: 0.3684
[INFO] cluster 2: (274/290) - Sharpe: 0.3157
[INFO] cluster 3: (150/280) - Sharpe: 0.3054
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.711854           -0.711854
1    2021-11-14 2021-11-14            43    -2.704530           -3.320136
2    2022-01-14 2022-01-14            41     0.749001            0.749001
3    2022-03-14 2022-03-14            44     3.657765            3.657765
4    2022-05-14 2022-05-14            43     1.252080            1.252080
5    2022-07-14 2022-07-14            44     0.795112            0.795112
6    2022-09-14 2022-09-14            43    -0.063770           -0.063770
7    2022-11-14 2022-11-14            43    -1.653258           -1.653258
8    2023-01-14 2023-01-14            41     1.658465            1.658465
9    2023-03-14 2023-03-14            44     0.152591            0.152591
10   2023-05-14 2023-05-14            44     4.106633           -2.087496
11   2023-07-14 2023-07-14            44    -5.609635            4.959210
12   2023-09-14 2023-09-14            43     2.029860            0.306997
13   2023-11-14 2023-11-14            42    -3.851886            0.405335
14   2024-01-14 2024-01-14            43     0.911910            0.911910
15   2024-03-14 2024-03-14            42     1.804454            1.804454
16   2024-05-14 2024-05-14            44    -3.279202           -2.301413
17   2024-07-14 2024-07-14            45     0.210954            1.246192
18   2024-09-14 2024-09-14            43    -0.935269           -2.631803
19   2024-11-14 2024-11-14            33     3.782667            3.652847
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -2.7 |             -3.3 |         -0.6 | False         
[INFO] 2022-01-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-05-14   |          4.1 |             -2.1 |         -6.2 | False         
[INFO] 2023-07-14   |         -5.6 |              5.0 |         10.6 | True          
[INFO] 2023-09-14   |          2.0 |              0.3 |         -1.7 | False         
[INFO] 2023-11-14   |         -3.9 |              0.4 |          4.3 | True          
[INFO] 2024-01-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -3.3 |             -2.3 |          1.0 | True          
[INFO] 2024-07-14   |          0.2 |              1.2 |          1.0 | True          
[INFO] 2024-09-14   |         -0.9 |             -2.6 |         -1.7 | False         
[INFO] 2024-11-14   |          3.8 |              3.7 |         -0.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-03-14, 2024-01-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 4 of 9 periods (44.44% win rate)
[INFO] Updating Excel file with Kmeans results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Kmeans win rate 44.4% in row 35
[INFO] Added best Sharpe parameters 158/288 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 158, Long SMA: 288
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(244/276) - Original Sharpe: 0.3684
[INFO] Added cluster 2 to portfolio: SMA(274/290) - Original Sharpe: 0.3157
[INFO] Added cluster 3 to portfolio: SMA(150/280) - Original Sharpe: 0.3054
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NE1_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3600
[INFO] Kmeans Best out-of-sample Sharpe: 0.2260
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NE1
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8463 to 0.6011
[INFO] 
Best parameters:
[INFO] Short SMA: 158
[INFO] Long SMA: 288
[INFO] Sharpe Ratio: 0.601145
[INFO] Number of Trades: 14
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8463 to 0.6011
[INFO] Trades range: 12.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8285 to 2.8656
[INFO] Scaled Trades range: -0.7866 to 14.7605
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5460
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 467 elements
[INFO] Cluster 1: 43 elements
[INFO] Cluster 2: 310 elements
[INFO] Cluster 3: 67 elements
[INFO] Cluster 4: 252 elements
[INFO] Cluster 5: 56 elements
[INFO] Cluster 6: 323 elements
[INFO] Cluster 7: 283 elements
[INFO] Cluster 8: 348 elements
[INFO] Cluster 9: 191 elements
[INFO] Cluster 10: 461 elements
[INFO] Cluster 11: 487 elements
[INFO] Cluster 12: 314 elements
[INFO] Cluster 13: 15 elements
[INFO] Cluster 14: 183 elements
[INFO] Cluster 15: 327 elements
[INFO] Cluster 16: 113 elements
[INFO] Cluster 17: 107 elements
[INFO] Cluster 18: 222 elements
[INFO] Cluster 19: 115 elements
[INFO] Cluster 20: 240 elements
[INFO] Cluster 21: 341 elements
[INFO] Cluster 22: 413 elements
[INFO] Cluster 23: 302 elements
[INFO] Cluster 24: 64 elements
[INFO] Cluster 25: 356 elements
[INFO] Cluster 26: 28 elements
[INFO] Cluster 27: 84 elements
[INFO] Cluster 28: 413 elements
[INFO] Cluster 29: 350 elements
[INFO] Cluster 30: 138 elements
[INFO] Cluster 31: 226 elements
[INFO] Cluster 32: 62 elements
[INFO] Cluster 33: 258 elements
[INFO] Cluster 34: 202 elements
[INFO] Cluster 35: 14 elements
[INFO] Cluster 36: 318 elements
[INFO] Cluster 37: 278 elements
[INFO] Cluster 38: 199 elements
[INFO] Cluster 39: 102 elements
[INFO] Cluster 40: 233 elements
[INFO] Cluster 41: 127 elements
[INFO] Cluster 42: 248 elements
[INFO] Cluster 43: 93 elements
[INFO] Cluster 44: 196 elements
[INFO] Cluster 45: 162 elements
[INFO] Cluster 46: 28 elements
[INFO] Cluster 47: 53 elements
[INFO] Cluster 48: 223 elements
[INFO] Cluster 49: 150 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=126, Long SMA=192, Sharpe=-0.1636, Trades=18
[INFO] Cluster 1 cluster: Short SMA=200, Long SMA=202, Sharpe=-0.0337, Trades=69
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=244, Sharpe=-0.0711, Trades=26
[INFO] Cluster 3 cluster: Short SMA=32, Long SMA=42, Sharpe=-0.2025, Trades=102
[INFO] Cluster 4 cluster: Short SMA=26, Long SMA=76, Sharpe=0.1000, Trades=48
[INFO] Cluster 5 cluster: Short SMA=110, Long SMA=114, Sharpe=-0.2692, Trades=83
[INFO] Cluster 6 cluster: Short SMA=204, Long SMA=264, Sharpe=-0.0757, Trades=18
[INFO] Cluster 7 cluster: Short SMA=172, Long SMA=262, Sharpe=0.1926, Trades=16
[INFO] Cluster 8 cluster: Short SMA=28, Long SMA=282, Sharpe=0.0269, Trades=28
[INFO] Cluster 9 cluster: Short SMA=248, Long SMA=288, Sharpe=0.1881, Trades=20
[INFO] Cluster 10 cluster: Short SMA=130, Long SMA=274, Sharpe=0.2175, Trades=20
[INFO] Cluster 11 cluster: Short SMA=148, Long SMA=228, Sharpe=0.0607, Trades=18
[INFO] Cluster 12 cluster: Short SMA=104, Long SMA=262, Sharpe=-0.0873, Trades=18
[INFO] Cluster 14 cluster: Short SMA=24, Long SMA=56, Sharpe=-0.0537, Trades=60
[INFO] Cluster 15 cluster: Short SMA=34, Long SMA=172, Sharpe=-0.3605, Trades=26
[INFO] Cluster 16 cluster: Short SMA=78, Long SMA=92, Sharpe=-0.3570, Trades=58
[INFO] Cluster 17 cluster: Short SMA=212, Long SMA=220, Sharpe=-0.2441, Trades=36
[INFO] Cluster 18 cluster: Short SMA=138, Long SMA=168, Sharpe=0.0148, Trades=22
[INFO] Cluster 19 cluster: Short SMA=266, Long SMA=274, Sharpe=0.2905, Trades=38
[INFO] Cluster 20 cluster: Short SMA=220, Long SMA=246, Sharpe=-0.1058, Trades=22
[INFO] Cluster 21 cluster: Short SMA=90, Long SMA=236, Sharpe=-0.2423, Trades=20
[INFO] Cluster 22 cluster: Short SMA=64, Long SMA=138, Sharpe=-0.4574, Trades=24
[INFO] Cluster 23 cluster: Short SMA=56, Long SMA=228, Sharpe=-0.3097, Trades=22
[INFO] Cluster 24 cluster: Short SMA=24, Long SMA=32, Sharpe=-0.1606, Trades=126
[INFO] Cluster 25 cluster: Short SMA=70, Long SMA=180, Sharpe=-0.6340, Trades=20
[INFO] Cluster 26 cluster: Short SMA=28, Long SMA=32, Sharpe=-0.2422, Trades=176
[INFO] Cluster 27 cluster: Short SMA=178, Long SMA=186, Sharpe=0.0666, Trades=37
[INFO] Cluster 28 cluster: Short SMA=76, Long SMA=286, Sharpe=0.0801, Trades=16
[INFO] Cluster 29 cluster: Short SMA=110, Long SMA=138, Sharpe=-0.1897, Trades=24
[INFO] Cluster 30 cluster: Short SMA=16, Long SMA=244, Sharpe=-0.0428, Trades=40
[INFO] Cluster 31 cluster: Short SMA=40, Long SMA=128, Sharpe=-0.2669, Trades=32
[INFO] Cluster 32 cluster: Short SMA=24, Long SMA=42, Sharpe=-0.0099, Trades=88
[INFO] Cluster 33 cluster: Short SMA=36, Long SMA=202, Sharpe=-0.5968, Trades=26
[INFO] Cluster 34 cluster: Short SMA=182, Long SMA=220, Sharpe=-0.1044, Trades=20
[INFO] Cluster 36 cluster: Short SMA=246, Long SMA=280, Sharpe=0.3562, Trades=20
[INFO] Cluster 37 cluster: Short SMA=28, Long SMA=112, Sharpe=-0.1281, Trades=36
[INFO] Cluster 38 cluster: Short SMA=154, Long SMA=282, Sharpe=0.3631, Trades=14
[INFO] Cluster 39 cluster: Short SMA=70, Long SMA=102, Sharpe=-0.3718, Trades=36
[INFO] Cluster 40 cluster: Short SMA=188, Long SMA=288, Sharpe=-0.0384, Trades=14
[INFO] Cluster 41 cluster: Short SMA=14, Long SMA=168, Sharpe=-0.2926, Trades=38
[INFO] Cluster 42 cluster: Short SMA=94, Long SMA=200, Sharpe=-0.3686, Trades=20
[INFO] Cluster 43 cluster: Short SMA=104, Long SMA=116, Sharpe=-0.1970, Trades=49
[INFO] Cluster 44 cluster: Short SMA=46, Long SMA=88, Sharpe=-0.3323, Trades=38
[INFO] Cluster 45 cluster: Short SMA=170, Long SMA=198, Sharpe=-0.0971, Trades=19
[INFO] Cluster 46 cluster: Short SMA=270, Long SMA=272, Sharpe=0.1828, Trades=66
[INFO] Cluster 47 cluster: Short SMA=166, Long SMA=176, Sharpe=0.2642, Trades=31
[INFO] Cluster 48 cluster: Short SMA=94, Long SMA=162, Sharpe=-0.4856, Trades=20
[INFO] Cluster 49 cluster: Short SMA=66, Long SMA=262, Sharpe=-0.0878, Trades=18
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=158, Long SMA=288, Sharpe=0.6011, Trades=14
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=154, Long SMA=282, Sharpe=0.3631, Trades=14
[INFO] Top 2: Short SMA=246, Long SMA=280, Sharpe=0.3562, Trades=20
[INFO] Top 3: Short SMA=266, Long SMA=274, Sharpe=0.2905, Trades=38
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10556 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 158, Long SMA: 288
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 64
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(154/282) - Original Sharpe: 0.3631, Trades: 14
[INFO] Hierarchical cluster 2: SMA(246/280) - Original Sharpe: 0.3562, Trades: 20
[INFO] Hierarchical cluster 3: SMA(266/274) - Original Sharpe: 0.2905, Trades: 38
[INFO] Hierarchical cluster 4: SMA(166/176) - Original Sharpe: 0.2642, Trades: 31
[INFO] Hierarchical cluster 5: SMA(130/274) - Original Sharpe: 0.2175, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (158/288)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (154/282) - Sharpe: 0.3631
[INFO] cluster 2: (246/280) - Sharpe: 0.3562
[INFO] cluster 3: (266/274) - Sharpe: 0.2905
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.711854           -0.711854
1    2021-11-14 2021-11-14            43    -2.704530           -3.462553
2    2022-01-14 2022-01-14            41     0.749001            0.749001
3    2022-03-14 2022-03-14            44     3.657765            3.657765
4    2022-05-14 2022-05-14            43     1.252080            1.252080
5    2022-07-14 2022-07-14            44     0.795112            0.795112
6    2022-09-14 2022-09-14            43    -0.063770           -0.063770
7    2022-11-14 2022-11-14            43    -1.653258           -1.653258
8    2023-01-14 2023-01-14            41     1.658465            1.658465
9    2023-03-14 2023-03-14            44     0.152591            0.152591
10   2023-05-14 2023-05-14            44     4.106633           -2.613112
11   2023-07-14 2023-07-14            44    -5.609635            6.092190
12   2023-09-14 2023-09-14            43     2.029860           -0.081770
13   2023-11-14 2023-11-14            42    -3.851886           -0.188831
14   2024-01-14 2024-01-14            43     0.911910            0.911910
15   2024-03-14 2024-03-14            42     1.804454            1.804454
16   2024-05-14 2024-05-14            44    -3.279202           -2.858681
17   2024-07-14 2024-07-14            45     0.210954            0.556488
18   2024-09-14 2024-09-14            43    -0.935269           -2.537509
19   2024-11-14 2024-11-14            33     3.782667            3.542820
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -2.7 |             -3.5 |         -0.8 | False         
[INFO] 2022-01-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-05-14   |          4.1 |             -2.6 |         -6.7 | False         
[INFO] 2023-07-14   |         -5.6 |              6.1 |         11.7 | True          
[INFO] 2023-09-14   |          2.0 |             -0.1 |         -2.1 | False         
[INFO] 2023-11-14   |         -3.9 |             -0.2 |          3.7 | True          
[INFO] 2024-01-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -3.3 |             -2.9 |          0.4 | True          
[INFO] 2024-07-14   |          0.2 |              0.6 |          0.4 | True          
[INFO] 2024-09-14   |         -0.9 |             -2.5 |         -1.6 | False         
[INFO] 2024-11-14   |          3.8 |              3.5 |         -0.3 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-03-14, 2024-01-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 9 periods (44.44% win rate)
[INFO] Updating Excel file with Hierarchical results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Hierarchical win rate 44.4% in row 35
[INFO] Added best Sharpe parameters 158/288 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 158, Long SMA: 288
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(154/282) - Original Sharpe: 0.3631
[INFO] Added cluster 2 to portfolio: SMA(246/280) - Original Sharpe: 0.3562
[INFO] Added cluster 3 to portfolio: SMA(266/274) - Original Sharpe: 0.2905
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NE1_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3074
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2260
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NE1
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NG in column D: 15.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 145.77s
[INFO] Best parameters: Short SMA = 38, Long SMA = 96
[INFO] Best Sharpe ratio: 0.840516, Trades: 34
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NG
[INFO] Big Point Value (from data): 10000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.73 contracts
[INFO] Maximum Position Size: 13 contracts
[INFO] Strategy Total P&L: $311,555.00
[INFO] Market Buy & Hold P&L: $-82,800.00
[INFO] Outperformance: $394,355.00
[INFO] Sharpe ratio (entire period, annualized): 0.431735
[INFO] Sharpe ratio (in-sample, annualized): 0.840516
[INFO] Sharpe ratio (out-of-sample, annualized): -0.397004
[INFO] Maximum Drawdown: $168,255.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 22
[INFO] Out-of-sample period trades: 12
[INFO] Total trades: 34
[INFO] In-sample P&L: $479,775.00
[INFO] Out-of-sample P&L: $-111,340.00
[INFO] 
Best parameters from GA: Short SMA = 38, Long SMA = 96, Sharpe = 0.840516
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 10000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5760 to 0.8405
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 96
[INFO] Sharpe Ratio: 0.840516
[INFO] Number of Trades: 34
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8481 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5760 to 0.8405
[INFO] Trades range: 10.0 to 351.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2490 to 2.7470
[INFO] Scaled Long SMA range: -2.6028 to 1.6263
[INFO] Scaled Sharpe ratio range: -2.8606 to 1.8769
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 256 elements
[INFO] Kmeans Cluster 1: 141 elements
[INFO] Kmeans Cluster 2: 189 elements
[INFO] Kmeans Cluster 3: 267 elements
[INFO] Kmeans Cluster 4: 130 elements
[INFO] Kmeans Cluster 5: 161 elements
[INFO] Kmeans Cluster 6: 121 elements
[INFO] Kmeans Cluster 7: 190 elements
[INFO] Kmeans Cluster 8: 142 elements
[INFO] Kmeans Cluster 9: 198 elements
[INFO] Kmeans Cluster 10: 275 elements
[INFO] Kmeans Cluster 11: 163 elements
[INFO] Kmeans Cluster 12: 187 elements
[INFO] Kmeans Cluster 13: 194 elements
[INFO] Kmeans Cluster 14: 68 elements
[INFO] Kmeans Cluster 15: 136 elements
[INFO] Kmeans Cluster 16: 240 elements
[INFO] Kmeans Cluster 17: 171 elements
[INFO] Kmeans Cluster 18: 215 elements
[INFO] Kmeans Cluster 19: 279 elements
[INFO] Kmeans Cluster 20: 148 elements
[INFO] Kmeans Cluster 21: 127 elements
[INFO] Kmeans Cluster 22: 124 elements
[INFO] Kmeans Cluster 23: 180 elements
[INFO] Kmeans Cluster 24: 208 elements
[INFO] Kmeans Cluster 25: 140 elements
[INFO] Kmeans Cluster 26: 195 elements
[INFO] Kmeans Cluster 27: 43 elements
[INFO] Kmeans Cluster 28: 75 elements
[INFO] Kmeans Cluster 29: 164 elements
[INFO] Kmeans Cluster 30: 188 elements
[INFO] Kmeans Cluster 31: 214 elements
[INFO] Kmeans Cluster 32: 173 elements
[INFO] Kmeans Cluster 33: 58 elements
[INFO] Kmeans Cluster 34: 145 elements
[INFO] Kmeans Cluster 35: 275 elements
[INFO] Kmeans Cluster 36: 132 elements
[INFO] Kmeans Cluster 37: 213 elements
[INFO] Kmeans Cluster 38: 90 elements
[INFO] Kmeans Cluster 39: 206 elements
[INFO] Kmeans Cluster 40: 83 elements
[INFO] Kmeans Cluster 41: 195 elements
[INFO] Kmeans Cluster 42: 119 elements
[INFO] Kmeans Cluster 43: 239 elements
[INFO] Kmeans Cluster 44: 196 elements
[INFO] Kmeans Cluster 45: 102 elements
[INFO] Kmeans Cluster 46: 271 elements
[INFO] Kmeans Cluster 47: 128 elements
[INFO] Kmeans Cluster 48: 74 elements
[INFO] Kmeans Cluster 49: 253 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=52.03, Long SMA=134.42, Sharpe=0.5774
[INFO] Centroid 1: Short SMA=213.18, Long SMA=244.27, Sharpe=-0.1756
[INFO] Centroid 2: Short SMA=29.48, Long SMA=269.80, Sharpe=0.4466
[INFO] Centroid 3: Short SMA=117.18, Long SMA=193.39, Sharpe=0.2968
[INFO] Centroid 4: Short SMA=19.43, Long SMA=41.91, Sharpe=-0.0506
[INFO] Centroid 5: Short SMA=170.00, Long SMA=190.52, Sharpe=-0.1316
[INFO] Centroid 6: Short SMA=26.40, Long SMA=224.50, Sharpe=0.4336
[INFO] Centroid 7: Short SMA=20.82, Long SMA=144.75, Sharpe=0.3001
[INFO] Centroid 8: Short SMA=42.44, Long SMA=106.14, Sharpe=0.6814
[INFO] Centroid 9: Short SMA=133.60, Long SMA=258.63, Sharpe=0.2201
[INFO] Centroid 10: Short SMA=105.48, Long SMA=134.36, Sharpe=0.4436
[INFO] Centroid 11: Short SMA=222.60, Long SMA=290.76, Sharpe=-0.4157
[INFO] Centroid 12: Short SMA=187.11, Long SMA=215.07, Sharpe=0.1555
[INFO] Centroid 13: Short SMA=66.08, Long SMA=101.90, Sharpe=0.4968
[INFO] Centroid 14: Short SMA=18.09, Long SMA=292.88, Sharpe=0.1372
[INFO] Centroid 15: Short SMA=142.66, Long SMA=181.24, Sharpe=0.1902
[INFO] Centroid 16: Short SMA=103.13, Long SMA=166.35, Sharpe=0.5508
[INFO] Centroid 17: Short SMA=243.74, Long SMA=266.64, Sharpe=-0.0835
[INFO] Centroid 18: Short SMA=68.49, Long SMA=228.78, Sharpe=0.4196
[INFO] Centroid 19: Short SMA=44.47, Long SMA=204.73, Sharpe=0.6583
[INFO] Centroid 20: Short SMA=41.39, Long SMA=74.43, Sharpe=0.3957
[INFO] Centroid 21: Short SMA=17.69, Long SMA=93.54, Sharpe=-0.0502
[INFO] Centroid 22: Short SMA=119.15, Long SMA=239.87, Sharpe=0.1015
[INFO] Centroid 23: Short SMA=159.90, Long SMA=283.84, Sharpe=0.0563
[INFO] Centroid 24: Short SMA=48.31, Long SMA=72.90, Sharpe=0.5732
[INFO] Centroid 25: Short SMA=14.89, Long SMA=240.39, Sharpe=0.2549
[INFO] Centroid 26: Short SMA=139.98, Long SMA=163.05, Sharpe=0.3916
[INFO] Centroid 27: Short SMA=96.84, Long SMA=291.49, Sharpe=0.2222
[INFO] Centroid 28: Short SMA=235.25, Long SMA=248.27, Sharpe=0.1697
[INFO] Centroid 29: Short SMA=36.50, Long SMA=290.28, Sharpe=0.3125
[INFO] Centroid 30: Short SMA=41.37, Long SMA=159.47, Sharpe=0.4777
[INFO] Centroid 31: Short SMA=158.85, Long SMA=200.96, Sharpe=0.0454
[INFO] Centroid 32: Short SMA=211.92, Long SMA=274.07, Sharpe=-0.2556
[INFO] Centroid 33: Short SMA=214.83, Long SMA=230.28, Sharpe=-0.3801
[INFO] Centroid 34: Short SMA=23.77, Long SMA=63.21, Sharpe=0.1282
[INFO] Centroid 35: Short SMA=75.05, Long SMA=162.28, Sharpe=0.6935
[INFO] Centroid 36: Short SMA=267.39, Long SMA=291.47, Sharpe=-0.3991
[INFO] Centroid 37: Short SMA=49.71, Long SMA=177.44, Sharpe=0.5946
[INFO] Centroid 38: Short SMA=82.44, Long SMA=93.51, Sharpe=0.2958
[INFO] Centroid 39: Short SMA=82.31, Long SMA=198.14, Sharpe=0.3760
[INFO] Centroid 40: Short SMA=212.05, Long SMA=233.33, Sharpe=-0.0096
[INFO] Centroid 41: Short SMA=16.84, Long SMA=190.13, Sharpe=0.2390
[INFO] Centroid 42: Short SMA=125.29, Long SMA=138.47, Sharpe=0.1994
[INFO] Centroid 43: Short SMA=81.56, Long SMA=117.49, Sharpe=0.6453
[INFO] Centroid 44: Short SMA=261.18, Long SMA=282.67, Sharpe=-0.2497
[INFO] Centroid 45: Short SMA=188.90, Long SMA=216.29, Sharpe=0.3009
[INFO] Centroid 46: Short SMA=45.99, Long SMA=249.56, Sharpe=0.6006
[INFO] Centroid 47: Short SMA=18.66, Long SMA=116.84, Sharpe=0.1760
[INFO] Centroid 48: Short SMA=19.05, Long SMA=33.62, Sharpe=-0.2415
[INFO] Centroid 49: Short SMA=98.10, Long SMA=221.22, Sharpe=0.3180
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=96, Sharpe=0.8405, Trades=34
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=42, Long SMA=106, Sharpe=0.7471, Trades=31
[INFO] Kmeans Top 2: Short SMA=76, Long SMA=162, Sharpe=0.6715, Trades=16
[INFO] Kmeans Top 3: Short SMA=44, Long SMA=204, Sharpe=0.6502, Trades=14
[INFO] Kmeans Top 4: Short SMA=82, Long SMA=118, Sharpe=0.6365, Trades=26
[INFO] Kmeans Top 5: Short SMA=46, Long SMA=248, Sharpe=0.6110, Trades=10
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (52, 134)
[INFO]   Rounded: (213, 244)
[INFO]   Nearest: (214.0, 244.0)
[INFO]   Rounded: (29, 270)
[INFO]   Nearest: (30.0, 270.0)
[INFO]   Rounded: (117, 193)
[INFO]   Nearest: (118.0, 194.0)
[INFO]   Rounded: (19, 42)
[INFO]   Nearest: (20.0, 42.0)
[INFO]   Rounded: (170, 191)
[INFO]   Nearest: (170.0, 190.0)
[INFO]   Rounded: (26, 224)
[INFO]   Rounded: (21, 145)
[INFO]   Nearest: (20.0, 144.0)
[INFO]   Rounded: (42, 106)
[INFO]   Rounded: (134, 259)
[INFO]   Nearest: (134.0, 258.0)
[INFO]   Rounded: (105, 134)
[INFO]   Nearest: (106.0, 134.0)
[INFO]   Rounded: (223, 291)
[INFO]   Nearest: (222.0, 290.0)
[INFO]   Rounded: (187, 215)
[INFO]   Nearest: (188.0, 216.0)
[INFO]   Rounded: (66, 102)
[INFO]   Rounded: (18, 293)
[INFO]   Nearest: (18.0, 292.0)
[INFO]   Rounded: (143, 181)
[INFO]   Nearest: (142.0, 182.0)
[INFO]   Rounded: (103, 166)
[INFO]   Nearest: (104.0, 166.0)
[INFO]   Rounded: (244, 267)
[INFO]   Nearest: (244.0, 266.0)
[INFO]   Rounded: (68, 229)
[INFO]   Nearest: (68.0, 228.0)
[INFO]   Rounded: (44, 205)
[INFO]   Nearest: (44.0, 204.0)
[INFO]   Rounded: (41, 74)
[INFO]   Nearest: (42.0, 74.0)
[INFO]   Rounded: (18, 94)
[INFO]   Rounded: (119, 240)
[INFO]   Nearest: (120.0, 240.0)
[INFO]   Rounded: (160, 284)
[INFO]   Rounded: (48, 73)
[INFO]   Nearest: (48.0, 72.0)
[INFO]   Rounded: (15, 240)
[INFO]   Nearest: (14.0, 240.0)
[INFO]   Rounded: (140, 163)
[INFO]   Nearest: (140.0, 164.0)
[INFO]   Rounded: (97, 291)
[INFO]   Nearest: (96.0, 292.0)
[INFO]   Rounded: (235, 248)
[INFO]   Nearest: (236.0, 248.0)
[INFO]   Rounded: (36, 290)
[INFO]   Rounded: (41, 159)
[INFO]   Nearest: (42.0, 160.0)
[INFO]   Rounded: (159, 201)
[INFO]   Nearest: (158.0, 200.0)
[INFO]   Rounded: (212, 274)
[INFO]   Rounded: (215, 230)
[INFO]   Nearest: (214.0, 230.0)
[INFO]   Rounded: (24, 63)
[INFO]   Nearest: (24.0, 64.0)
[INFO]   Rounded: (75, 162)
[INFO]   Nearest: (76.0, 162.0)
[INFO]   Rounded: (267, 291)
[INFO]   Nearest: (268.0, 292.0)
[INFO]   Rounded: (50, 177)
[INFO]   Nearest: (50.0, 178.0)
[INFO]   Rounded: (82, 94)
[INFO]   Rounded: (82, 198)
[INFO]   Rounded: (212, 233)
[INFO]   Nearest: (212.0, 234.0)
[INFO]   Rounded: (17, 190)
[INFO]   Nearest: (16.0, 190.0)
[INFO]   Rounded: (125, 138)
[INFO]   Nearest: (126.0, 138.0)
[INFO]   Rounded: (82, 117)
[INFO]   Nearest: (82.0, 118.0)
[INFO]   Rounded: (261, 283)
[INFO]   Nearest: (262.0, 282.0)
[INFO]   Rounded: (189, 216)
[INFO]   Nearest: (188.0, 216.0)
[INFO]   Rounded: (46, 250)
[INFO]   Rounded: (19, 117)
[INFO]   Nearest: (18.0, 116.0)
[INFO]   Rounded: (19, 34)
[INFO]   Nearest: (20.0, 34.0)
[INFO]   Rounded: (98, 221)
[INFO]   Nearest: (98.0, 222.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 96
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(42/106) - Original Sharpe: 0.7471, Trades: 31
[INFO] Kmeans cluster 2: SMA(76/162) - Original Sharpe: 0.6715, Trades: 16
[INFO] Kmeans cluster 3: SMA(44/204) - Original Sharpe: 0.6502, Trades: 14
[INFO] Kmeans cluster 4: SMA(82/118) - Original Sharpe: 0.6365, Trades: 26
[INFO] Kmeans cluster 5: SMA(46/248) - Original Sharpe: 0.6110, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/96)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (42/106) - Sharpe: 0.7471
[INFO] cluster 2: (76/162) - Sharpe: 0.6715
[INFO] cluster 3: (44/204) - Sharpe: 0.6502
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.445674           -0.445674
1    2021-11-14 2021-11-14            43    -2.014680           -1.721909
2    2022-01-14 2022-01-14            41    -2.486703           -1.665180
3    2022-03-14 2022-03-14            44     3.957702            1.904861
4    2022-05-14 2022-05-14            43    -0.023760           -0.023760
5    2022-07-14 2022-07-14            44    -1.042803           -0.210108
6    2022-09-14 2022-09-14            43    -2.178995           -4.123422
7    2022-11-14 2022-11-14            43     3.472189            3.472189
8    2023-01-14 2023-01-14            41     1.369071            1.369071
9    2023-03-14 2023-03-14            43     2.324517            2.324517
10   2023-05-14 2023-05-14            44    -0.121506           -0.121506
11   2023-07-14 2023-07-14            44    -0.937897           -0.256242
12   2023-09-14 2023-09-14            43    -3.674779           -1.610367
13   2023-11-14 2023-11-14            42    -5.314334           -3.488121
14   2024-01-14 2024-01-14            43     5.971629            5.971629
15   2024-03-14 2024-03-14            42    -1.552883           -1.552883
16   2024-05-14 2024-05-14            44    -1.549107           -1.589507
17   2024-07-14 2024-07-14            45    -1.110970           -0.427497
18   2024-09-14 2024-09-14            43     0.410531            0.410531
19   2024-11-14 2024-11-14            33    -3.830386           -2.575162
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -2.0 |             -1.7 |          0.3 | True          
[INFO] 2022-01-14   |         -2.5 |             -1.7 |          0.8 | True          
[INFO] 2022-03-14   |          4.0 |              1.9 |         -2.1 | False         
[INFO] 2022-05-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |             -0.2 |          0.8 | True          
[INFO] 2022-09-14   |         -2.2 |             -4.1 |         -1.9 | False         
[INFO] 2022-11-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.9 |             -0.3 |          0.6 | True          
[INFO] 2023-09-14   |         -3.7 |             -1.6 |          2.1 | True          
[INFO] 2023-11-14   |         -5.3 |             -3.5 |          1.8 | True          
[INFO] 2024-01-14   |          6.0 |              6.0 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -1.5 |             -1.6 |         -0.1 | False         
[INFO] 2024-07-14   |         -1.1 |             -0.4 |          0.7 | True          
[INFO] 2024-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -3.8 |             -2.6 |          1.2 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2022-11-14, 2023-01-14, 2023-03-14, 2023-05-14, 2024-01-14, 2024-03-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Kmeans cluster wins (rounded comparison): 8 of 11 periods (72.73% win rate)
[INFO] Updating Excel file with Kmeans results for NG...
[INFO] Excel file updated successfully. Added NG with Kmeans win rate 72.7% in row 36
[INFO] Added best Sharpe parameters 38/96 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 96
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(42/106) - Original Sharpe: 0.7471
[INFO] Added cluster 2 to portfolio: SMA(76/162) - Original Sharpe: 0.6715
[INFO] Added cluster 3 to portfolio: SMA(44/204) - Original Sharpe: 0.6502
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NG_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1484
[INFO] Kmeans Best out-of-sample Sharpe: -0.3970
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NG...
[INFO] Excel file updated successfully. Added NG with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NG
[INFO] Big Point Value: 10000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5760 to 0.8405
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 96
[INFO] Sharpe Ratio: 0.840516
[INFO] Number of Trades: 34
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8481 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5760 to 0.8405
[INFO] Trades range: 10.0 to 351.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2490 to 2.7470
[INFO] Scaled Long SMA range: -2.6028 to 1.6263
[INFO] Scaled Sharpe ratio range: -2.8606 to 1.8769
[INFO] Scaled Trades range: -0.6507 to 13.6551
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8481 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5908
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 258 elements
[INFO] Cluster 1: 295 elements
[INFO] Cluster 2: 308 elements
[INFO] Cluster 3: 452 elements
[INFO] Cluster 4: 370 elements
[INFO] Cluster 5: 10 elements
[INFO] Cluster 6: 313 elements
[INFO] Cluster 7: 65 elements
[INFO] Cluster 8: 263 elements
[INFO] Cluster 9: 58 elements
[INFO] Cluster 10: 195 elements
[INFO] Cluster 11: 267 elements
[INFO] Cluster 12: 349 elements
[INFO] Cluster 13: 294 elements
[INFO] Cluster 14: 147 elements
[INFO] Cluster 15: 61 elements
[INFO] Cluster 16: 225 elements
[INFO] Cluster 17: 231 elements
[INFO] Cluster 18: 196 elements
[INFO] Cluster 19: 120 elements
[INFO] Cluster 20: 116 elements
[INFO] Cluster 21: 16 elements
[INFO] Cluster 22: 106 elements
[INFO] Cluster 23: 276 elements
[INFO] Cluster 24: 124 elements
[INFO] Cluster 25: 302 elements
[INFO] Cluster 26: 36 elements
[INFO] Cluster 27: 160 elements
[INFO] Cluster 28: 155 elements
[INFO] Cluster 29: 176 elements
[INFO] Cluster 30: 154 elements
[INFO] Cluster 31: 62 elements
[INFO] Cluster 32: 123 elements
[INFO] Cluster 33: 77 elements
[INFO] Cluster 34: 150 elements
[INFO] Cluster 35: 33 elements
[INFO] Cluster 36: 262 elements
[INFO] Cluster 37: 227 elements
[INFO] Cluster 38: 144 elements
[INFO] Cluster 39: 203 elements
[INFO] Cluster 40: 220 elements
[INFO] Cluster 41: 65 elements
[INFO] Cluster 42: 225 elements
[INFO] Cluster 43: 131 elements
[INFO] Cluster 44: 195 elements
[INFO] Cluster 45: 69 elements
[INFO] Cluster 46: 70 elements
[INFO] Cluster 47: 85 elements
[INFO] Cluster 48: 9 elements
[INFO] Cluster 49: 33 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=190, Long SMA=218, Sharpe=0.2471, Trades=12
[INFO] Cluster 1 cluster: Short SMA=224, Long SMA=252, Sharpe=-0.1365, Trades=15
[INFO] Cluster 2 cluster: Short SMA=22, Long SMA=254, Sharpe=0.4397, Trades=17
[INFO] Cluster 3 cluster: Short SMA=110, Long SMA=194, Sharpe=0.3625, Trades=12
[INFO] Cluster 4 cluster: Short SMA=126, Long SMA=254, Sharpe=0.2080, Trades=10
[INFO] Cluster 6 cluster: Short SMA=262, Long SMA=288, Sharpe=-0.4239, Trades=14
[INFO] Cluster 7 cluster: Short SMA=20, Long SMA=30, Sharpe=-0.2355, Trades=124
[INFO] Cluster 8 cluster: Short SMA=20, Long SMA=158, Sharpe=0.2497, Trades=29
[INFO] Cluster 9 cluster: Short SMA=180, Long SMA=184, Sharpe=-0.3609, Trades=48
[INFO] Cluster 10 cluster: Short SMA=34, Long SMA=84, Sharpe=0.4163, Trades=42
[INFO] Cluster 11 cluster: Short SMA=98, Long SMA=172, Sharpe=0.6215, Trades=14
[INFO] Cluster 12 cluster: Short SMA=46, Long SMA=170, Sharpe=0.5767, Trades=21
[INFO] Cluster 13 cluster: Short SMA=44, Long SMA=208, Sharpe=0.7493, Trades=14
[INFO] Cluster 14 cluster: Short SMA=144, Long SMA=180, Sharpe=0.1691, Trades=16
[INFO] Cluster 15 cluster: Short SMA=58, Long SMA=64, Sharpe=0.5052, Trades=85
[INFO] Cluster 16 cluster: Short SMA=74, Long SMA=106, Sharpe=0.4397, Trades=36
[INFO] Cluster 17 cluster: Short SMA=104, Long SMA=138, Sharpe=0.4873, Trades=26
[INFO] Cluster 18 cluster: Short SMA=18, Long SMA=210, Sharpe=0.2980, Trades=23
[INFO] Cluster 19 cluster: Short SMA=20, Long SMA=42, Sharpe=-0.0946, Trades=82
[INFO] Cluster 20 cluster: Short SMA=16, Long SMA=68, Sharpe=0.0125, Trades=60
[INFO] Cluster 22 cluster: Short SMA=122, Long SMA=130, Sharpe=0.4823, Trades=56
[INFO] Cluster 23 cluster: Short SMA=44, Long SMA=254, Sharpe=0.6114, Trades=10
[INFO] Cluster 24 cluster: Short SMA=18, Long SMA=94, Sharpe=0.0059, Trades=52
[INFO] Cluster 25 cluster: Short SMA=68, Long SMA=226, Sharpe=0.3727, Trades=12
[INFO] Cluster 26 cluster: Short SMA=70, Long SMA=72, Sharpe=0.4925, Trades=132
[INFO] Cluster 27 cluster: Short SMA=40, Long SMA=292, Sharpe=0.3298, Trades=12
[INFO] Cluster 28 cluster: Short SMA=134, Long SMA=164, Sharpe=0.4617, Trades=18
[INFO] Cluster 29 cluster: Short SMA=160, Long SMA=284, Sharpe=0.1137, Trades=10
[INFO] Cluster 30 cluster: Short SMA=44, Long SMA=82, Sharpe=0.5643, Trades=39
[INFO] Cluster 31 cluster: Short SMA=260, Long SMA=264, Sharpe=-0.0852, Trades=33
[INFO] Cluster 32 cluster: Short SMA=16, Long SMA=124, Sharpe=0.0803, Trades=44
[INFO] Cluster 33 cluster: Short SMA=236, Long SMA=248, Sharpe=0.3461, Trades=25
[INFO] Cluster 34 cluster: Short SMA=166, Long SMA=192, Sharpe=-0.0887, Trades=16
[INFO] Cluster 35 cluster: Short SMA=132, Long SMA=134, Sharpe=0.1703, Trades=108
[INFO] Cluster 36 cluster: Short SMA=74, Long SMA=132, Sharpe=0.6321, Trades=23
[INFO] Cluster 37 cluster: Short SMA=74, Long SMA=164, Sharpe=0.5918, Trades=18
[INFO] Cluster 38 cluster: Short SMA=222, Long SMA=290, Sharpe=-0.4451, Trades=10
[INFO] Cluster 39 cluster: Short SMA=158, Long SMA=208, Sharpe=0.0484, Trades=10
[INFO] Cluster 40 cluster: Short SMA=216, Long SMA=272, Sharpe=-0.3105, Trades=10
[INFO] Cluster 41 cluster: Short SMA=214, Long SMA=230, Sharpe=-0.4203, Trades=19
[INFO] Cluster 42 cluster: Short SMA=98, Long SMA=222, Sharpe=0.3392, Trades=12
[INFO] Cluster 43 cluster: Short SMA=42, Long SMA=108, Sharpe=0.7129, Trades=31
[INFO] Cluster 44 cluster: Short SMA=50, Long SMA=130, Sharpe=0.5197, Trades=25
[INFO] Cluster 45 cluster: Short SMA=148, Long SMA=160, Sharpe=0.4499, Trades=34
[INFO] Cluster 46 cluster: Short SMA=18, Long SMA=292, Sharpe=0.0897, Trades=16
[INFO] Cluster 47 cluster: Short SMA=50, Long SMA=66, Sharpe=0.4968, Trades=61
[INFO] Cluster 49 cluster: Short SMA=90, Long SMA=98, Sharpe=0.7000, Trades=67
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=96, Sharpe=0.8405, Trades=34
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=44, Long SMA=208, Sharpe=0.7493, Trades=14
[INFO] Top 2: Short SMA=42, Long SMA=108, Sharpe=0.7129, Trades=31
[INFO] Top 3: Short SMA=90, Long SMA=98, Sharpe=0.7000, Trades=67
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 8446 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 96
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(44/208) - Original Sharpe: 0.7493, Trades: 14
[INFO] Hierarchical cluster 2: SMA(42/108) - Original Sharpe: 0.7129, Trades: 31
[INFO] Hierarchical cluster 3: SMA(90/98) - Original Sharpe: 0.7000, Trades: 67
[INFO] Hierarchical cluster 4: SMA(74/132) - Original Sharpe: 0.6321, Trades: 23
[INFO] Hierarchical cluster 5: SMA(98/172) - Original Sharpe: 0.6215, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/96)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (44/208) - Sharpe: 0.7493
[INFO] cluster 2: (42/108) - Sharpe: 0.7129
[INFO] cluster 3: (90/98) - Sharpe: 0.7000
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.445674           -0.445674
1    2021-11-14 2021-11-14            43    -2.014680           -0.597213
2    2022-01-14 2022-01-14            41    -2.486703           -2.112319
3    2022-03-14 2022-03-14            44     3.957702            2.445021
4    2022-05-14 2022-05-14            43    -0.023760           -0.023760
5    2022-07-14 2022-07-14            44    -1.042803            0.422861
6    2022-09-14 2022-09-14            43    -2.178995           -3.295520
7    2022-11-14 2022-11-14            43     3.472189            4.246928
8    2023-01-14 2023-01-14            41     1.369071            1.369071
9    2023-03-14 2023-03-14            43     2.324517            2.324517
10   2023-05-14 2023-05-14            44    -0.121506           -0.121506
11   2023-07-14 2023-07-14            44    -0.937897           -1.074236
12   2023-09-14 2023-09-14            43    -3.674779            0.159552
13   2023-11-14 2023-11-14            42    -5.314334           -2.385422
14   2024-01-14 2024-01-14            43     5.971629            5.971629
15   2024-03-14 2024-03-14            42    -1.552883           -1.552883
16   2024-05-14 2024-05-14            44    -1.549107           -2.928021
17   2024-07-14 2024-07-14            45    -1.110970            0.274758
18   2024-09-14 2024-09-14            43     0.410531            0.410531
19   2024-11-14 2024-11-14            33    -3.830386           -2.165135
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -2.0 |             -0.6 |          1.4 | True          
[INFO] 2022-01-14   |         -2.5 |             -2.1 |          0.4 | True          
[INFO] 2022-03-14   |          4.0 |              2.4 |         -1.6 | False         
[INFO] 2022-05-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |              0.4 |          1.4 | True          
[INFO] 2022-09-14   |         -2.2 |             -3.3 |         -1.1 | False         
[INFO] 2022-11-14   |          3.5 |              4.2 |          0.7 | True          
[INFO] 2023-01-14   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.9 |             -1.1 |         -0.2 | False         
[INFO] 2023-09-14   |         -3.7 |              0.2 |          3.9 | True          
[INFO] 2023-11-14   |         -5.3 |             -2.4 |          2.9 | True          
[INFO] 2024-01-14   |          6.0 |              6.0 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -1.5 |             -2.9 |         -1.4 | False         
[INFO] 2024-07-14   |         -1.1 |              0.3 |          1.4 | True          
[INFO] 2024-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -3.8 |             -2.2 |          1.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2023-01-14, 2023-03-14, 2023-05-14, 2024-01-14, 2024-03-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 12 periods (66.67% win rate)
[INFO] Updating Excel file with Hierarchical results for NG...
[INFO] Excel file updated successfully. Added NG with Hierarchical win rate 66.7% in row 36
[INFO] Added best Sharpe parameters 38/96 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 96
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(44/208) - Original Sharpe: 0.7493
[INFO] Added cluster 2 to portfolio: SMA(42/108) - Original Sharpe: 0.7129
[INFO] Added cluster 3 to portfolio: SMA(90/98) - Original Sharpe: 0.7000
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NG_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0975
[INFO] Hierarchical Best out-of-sample Sharpe: -0.3970
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NG...
[INFO] Excel file updated successfully. Added NG with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NG
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NK in column D: 35.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 119.28s
[INFO] Best parameters: Short SMA = 20, Long SMA = 22
[INFO] Best Sharpe ratio: 0.860889, Trades: 251
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NK
[INFO] Big Point Value (from data): 5.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.91 contracts
[INFO] Maximum Position Size: 8 contracts
[INFO] Strategy Total P&L: $555,050.00
[INFO] Market Buy & Hold P&L: $123,500.00
[INFO] Outperformance: $431,550.00
[INFO] Sharpe ratio (entire period, annualized): 0.567140
[INFO] Sharpe ratio (in-sample, annualized): 0.860889
[INFO] Sharpe ratio (out-of-sample, annualized): -0.084305
[INFO] Maximum Drawdown: $146,255.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 175
[INFO] Out-of-sample period trades: 76
[INFO] Total trades: 251
[INFO] In-sample P&L: $540,320.00
[INFO] Out-of-sample P&L: $-23,830.00
[INFO] 
Best parameters from GA: Short SMA = 20, Long SMA = 22, Sharpe = 0.860889
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 5.0
[INFO] Slippage: 35.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6475 to 0.8609
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 22
[INFO] Sharpe Ratio: 0.860889
[INFO] Number of Trades: 251
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10417 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6475 to 0.8609
[INFO] Trades range: 10.0 to 343.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3841 to 2.7941
[INFO] Scaled Long SMA range: -2.7959 to 1.4302
[INFO] Scaled Sharpe ratio range: -3.3641 to 4.1025
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 241 elements
[INFO] Kmeans Cluster 1: 171 elements
[INFO] Kmeans Cluster 2: 304 elements
[INFO] Kmeans Cluster 3: 301 elements
[INFO] Kmeans Cluster 4: 263 elements
[INFO] Kmeans Cluster 5: 304 elements
[INFO] Kmeans Cluster 6: 148 elements
[INFO] Kmeans Cluster 7: 124 elements
[INFO] Kmeans Cluster 8: 144 elements
[INFO] Kmeans Cluster 9: 224 elements
[INFO] Kmeans Cluster 10: 371 elements
[INFO] Kmeans Cluster 11: 298 elements
[INFO] Kmeans Cluster 12: 179 elements
[INFO] Kmeans Cluster 13: 217 elements
[INFO] Kmeans Cluster 14: 254 elements
[INFO] Kmeans Cluster 15: 295 elements
[INFO] Kmeans Cluster 16: 212 elements
[INFO] Kmeans Cluster 17: 103 elements
[INFO] Kmeans Cluster 18: 196 elements
[INFO] Kmeans Cluster 19: 335 elements
[INFO] Kmeans Cluster 20: 189 elements
[INFO] Kmeans Cluster 21: 155 elements
[INFO] Kmeans Cluster 22: 213 elements
[INFO] Kmeans Cluster 23: 39 elements
[INFO] Kmeans Cluster 24: 81 elements
[INFO] Kmeans Cluster 25: 192 elements
[INFO] Kmeans Cluster 26: 166 elements
[INFO] Kmeans Cluster 27: 150 elements
[INFO] Kmeans Cluster 28: 235 elements
[INFO] Kmeans Cluster 29: 165 elements
[INFO] Kmeans Cluster 30: 128 elements
[INFO] Kmeans Cluster 31: 249 elements
[INFO] Kmeans Cluster 32: 226 elements
[INFO] Kmeans Cluster 33: 242 elements
[INFO] Kmeans Cluster 34: 219 elements
[INFO] Kmeans Cluster 35: 198 elements
[INFO] Kmeans Cluster 36: 107 elements
[INFO] Kmeans Cluster 37: 320 elements
[INFO] Kmeans Cluster 38: 265 elements
[INFO] Kmeans Cluster 39: 124 elements
[INFO] Kmeans Cluster 40: 251 elements
[INFO] Kmeans Cluster 41: 199 elements
[INFO] Kmeans Cluster 42: 265 elements
[INFO] Kmeans Cluster 43: 149 elements
[INFO] Kmeans Cluster 44: 314 elements
[INFO] Kmeans Cluster 45: 210 elements
[INFO] Kmeans Cluster 46: 10 elements
[INFO] Kmeans Cluster 47: 250 elements
[INFO] Kmeans Cluster 48: 210 elements
[INFO] Kmeans Cluster 49: 212 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=35.75, Long SMA=207.16, Sharpe=-0.0250
[INFO] Centroid 1: Short SMA=262.99, Long SMA=288.42, Sharpe=-0.1365
[INFO] Centroid 2: Short SMA=86.20, Long SMA=177.39, Sharpe=-0.0577
[INFO] Centroid 3: Short SMA=101.70, Long SMA=279.55, Sharpe=0.1543
[INFO] Centroid 4: Short SMA=30.02, Long SMA=57.55, Sharpe=-0.0391
[INFO] Centroid 5: Short SMA=64.67, Long SMA=239.51, Sharpe=0.2731
[INFO] Centroid 6: Short SMA=158.14, Long SMA=200.32, Sharpe=0.4688
[INFO] Centroid 7: Short SMA=72.85, Long SMA=94.60, Sharpe=-0.4727
[INFO] Centroid 8: Short SMA=193.86, Long SMA=245.36, Sharpe=0.1817
[INFO] Centroid 9: Short SMA=47.89, Long SMA=126.74, Sharpe=0.0746
[INFO] Centroid 10: Short SMA=42.00, Long SMA=163.02, Sharpe=-0.0904
[INFO] Centroid 11: Short SMA=76.96, Long SMA=274.99, Sharpe=0.2195
[INFO] Centroid 12: Short SMA=36.26, Long SMA=106.00, Sharpe=-0.1874
[INFO] Centroid 13: Short SMA=117.97, Long SMA=206.65, Sharpe=0.2390
[INFO] Centroid 14: Short SMA=136.07, Long SMA=165.68, Sharpe=0.0880
[INFO] Centroid 15: Short SMA=48.86, Long SMA=284.05, Sharpe=0.1016
[INFO] Centroid 16: Short SMA=191.52, Long SMA=225.77, Sharpe=0.0614
[INFO] Centroid 17: Short SMA=227.28, Long SMA=250.02, Sharpe=-0.3514
[INFO] Centroid 18: Short SMA=108.97, Long SMA=187.36, Sharpe=0.0346
[INFO] Centroid 19: Short SMA=168.10, Long SMA=258.60, Sharpe=-0.0137
[INFO] Centroid 20: Short SMA=236.03, Long SMA=273.72, Sharpe=-0.0469
[INFO] Centroid 21: Short SMA=267.33, Long SMA=283.07, Sharpe=-0.2847
[INFO] Centroid 22: Short SMA=219.99, Long SMA=259.08, Sharpe=-0.1956
[INFO] Centroid 23: Short SMA=106.05, Long SMA=115.23, Sharpe=0.2047
[INFO] Centroid 24: Short SMA=22.20, Long SMA=38.30, Sharpe=0.1449
[INFO] Centroid 25: Short SMA=56.25, Long SMA=83.34, Sharpe=-0.3017
[INFO] Centroid 26: Short SMA=19.18, Long SMA=176.19, Sharpe=-0.2148
[INFO] Centroid 27: Short SMA=17.63, Long SMA=102.97, Sharpe=-0.3585
[INFO] Centroid 28: Short SMA=75.80, Long SMA=219.98, Sharpe=0.1585
[INFO] Centroid 29: Short SMA=178.93, Long SMA=213.92, Sharpe=0.2008
[INFO] Centroid 30: Short SMA=231.20, Long SMA=288.73, Sharpe=0.0751
[INFO] Centroid 31: Short SMA=34.28, Long SMA=132.13, Sharpe=-0.0373
[INFO] Centroid 32: Short SMA=129.98, Long SMA=250.88, Sharpe=0.2144
[INFO] Centroid 33: Short SMA=136.70, Long SMA=225.52, Sharpe=0.3532
[INFO] Centroid 34: Short SMA=86.22, Long SMA=122.81, Sharpe=-0.0186
[INFO] Centroid 35: Short SMA=25.72, Long SMA=212.96, Sharpe=-0.1428
[INFO] Centroid 36: Short SMA=17.40, Long SMA=288.09, Sharpe=0.3252
[INFO] Centroid 37: Short SMA=114.24, Long SMA=152.78, Sharpe=-0.0912
[INFO] Centroid 38: Short SMA=139.25, Long SMA=276.04, Sharpe=0.1272
[INFO] Centroid 39: Short SMA=159.55, Long SMA=199.21, Sharpe=0.6095
[INFO] Centroid 40: Short SMA=34.54, Long SMA=67.01, Sharpe=-0.1757
[INFO] Centroid 41: Short SMA=161.78, Long SMA=179.42, Sharpe=0.3192
[INFO] Centroid 42: Short SMA=90.07, Long SMA=130.90, Sharpe=-0.1577
[INFO] Centroid 43: Short SMA=205.45, Long SMA=233.01, Sharpe=-0.0489
[INFO] Centroid 44: Short SMA=190.10, Long SMA=284.98, Sharpe=-0.1069
[INFO] Centroid 45: Short SMA=103.20, Long SMA=238.27, Sharpe=0.3192
[INFO] Centroid 47: Short SMA=65.53, Long SMA=187.10, Sharpe=0.0479
[INFO] Centroid 48: Short SMA=34.37, Long SMA=255.74, Sharpe=0.0196
[INFO] Centroid 49: Short SMA=21.75, Long SMA=256.18, Sharpe=0.1720
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=22, Sharpe=0.8609, Trades=251
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=160, Long SMA=200, Sharpe=0.6472, Trades=21
[INFO] Kmeans Top 2: Short SMA=154, Long SMA=204, Sharpe=0.5131, Trades=19
[INFO] Kmeans Top 3: Short SMA=104, Long SMA=238, Sharpe=0.3888, Trades=15
[INFO] Kmeans Top 4: Short SMA=18, Long SMA=288, Sharpe=0.3683, Trades=21
[INFO] Kmeans Top 5: Short SMA=136, Long SMA=226, Sharpe=0.3594, Trades=17
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 47, 48, 49}
[INFO]   Rounded: (36, 207)
[INFO]   Nearest: (36.0, 208.0)
[INFO]   Rounded: (263, 288)
[INFO]   Nearest: (262.0, 288.0)
[INFO]   Rounded: (86, 177)
[INFO]   Nearest: (86.0, 178.0)
[INFO]   Rounded: (102, 280)
[INFO]   Rounded: (30, 58)
[INFO]   Rounded: (65, 240)
[INFO]   Nearest: (64.0, 240.0)
[INFO]   Rounded: (158, 200)
[INFO]   Rounded: (73, 95)
[INFO]   Nearest: (72.0, 94.0)
[INFO]   Rounded: (194, 245)
[INFO]   Nearest: (194.0, 246.0)
[INFO]   Rounded: (48, 127)
[INFO]   Nearest: (48.0, 126.0)
[INFO]   Rounded: (42, 163)
[INFO]   Nearest: (42.0, 164.0)
[INFO]   Rounded: (77, 275)
[INFO]   Nearest: (76.0, 274.0)
[INFO]   Rounded: (36, 106)
[INFO]   Rounded: (118, 207)
[INFO]   Nearest: (118.0, 206.0)
[INFO]   Rounded: (136, 166)
[INFO]   Rounded: (49, 284)
[INFO]   Nearest: (48.0, 284.0)
[INFO]   Rounded: (192, 226)
[INFO]   Rounded: (227, 250)
[INFO]   Nearest: (228.0, 250.0)
[INFO]   Rounded: (109, 187)
[INFO]   Nearest: (108.0, 188.0)
[INFO]   Rounded: (168, 259)
[INFO]   Nearest: (168.0, 258.0)
[INFO]   Rounded: (236, 274)
[INFO]   Rounded: (267, 283)
[INFO]   Nearest: (268.0, 284.0)
[INFO]   Rounded: (220, 259)
[INFO]   Nearest: (220.0, 260.0)
[INFO]   Rounded: (106, 115)
[INFO]   Nearest: (106.0, 116.0)
[INFO]   Rounded: (22, 38)
[INFO]   Rounded: (56, 83)
[INFO]   Nearest: (56.0, 84.0)
[INFO]   Rounded: (19, 176)
[INFO]   Nearest: (20.0, 176.0)
[INFO]   Rounded: (18, 103)
[INFO]   Nearest: (18.0, 102.0)
[INFO]   Rounded: (76, 220)
[INFO]   Rounded: (179, 214)
[INFO]   Nearest: (178.0, 214.0)
[INFO]   Rounded: (231, 289)
[INFO]   Nearest: (232.0, 288.0)
[INFO]   Rounded: (34, 132)
[INFO]   Rounded: (130, 251)
[INFO]   Nearest: (130.0, 250.0)
[INFO]   Rounded: (137, 226)
[INFO]   Nearest: (136.0, 226.0)
[INFO]   Rounded: (86, 123)
[INFO]   Nearest: (86.0, 122.0)
[INFO]   Rounded: (26, 213)
[INFO]   Nearest: (26.0, 212.0)
[INFO]   Rounded: (17, 288)
[INFO]   Nearest: (18.0, 288.0)
[INFO]   Rounded: (114, 153)
[INFO]   Nearest: (114.0, 152.0)
[INFO]   Rounded: (139, 276)
[INFO]   Nearest: (140.0, 276.0)
[INFO]   Rounded: (160, 199)
[INFO]   Nearest: (160.0, 200.0)
[INFO]   Rounded: (35, 67)
[INFO]   Nearest: (34.0, 68.0)
[INFO]   Rounded: (162, 179)
[INFO]   Nearest: (162.0, 180.0)
[INFO]   Rounded: (90, 131)
[INFO]   Nearest: (90.0, 130.0)
[INFO]   Rounded: (205, 233)
[INFO]   Nearest: (206.0, 234.0)
[INFO]   Rounded: (190, 285)
[INFO]   Nearest: (190.0, 284.0)
[INFO]   Rounded: (103, 238)
[INFO]   Nearest: (104.0, 238.0)
[INFO]   Rounded: (66, 187)
[INFO]   Nearest: (66.0, 188.0)
[INFO]   Rounded: (34, 256)
[INFO]   Rounded: (22, 256)
[INFO] Successfully plotted 49 out of 49 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 22
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(160/200) - Original Sharpe: 0.6472, Trades: 21
[INFO] Kmeans cluster 2: SMA(154/204) - Original Sharpe: 0.5131, Trades: 19
[INFO] Kmeans cluster 3: SMA(104/238) - Original Sharpe: 0.3888, Trades: 15
[INFO] Kmeans cluster 4: SMA(18/288) - Original Sharpe: 0.3683, Trades: 21
[INFO] Kmeans cluster 5: SMA(136/226) - Original Sharpe: 0.3594, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/22)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (160/200) - Sharpe: 0.6472
[INFO] cluster 2: (154/204) - Sharpe: 0.5131
[INFO] cluster 3: (104/238) - Sharpe: 0.3888
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -3.504421           -2.699907
1    2021-11-14 2021-11-14            43    -3.098247            1.180101
2    2022-01-14 2022-01-14            41     1.372559            2.569015
3    2022-03-14 2022-03-14            44    -1.165984            0.373634
4    2022-05-14 2022-05-14            43    -1.900497            0.242755
5    2022-07-14 2022-07-14            44     2.319224           -1.151355
6    2022-09-14 2022-09-14            43     2.556621            3.809735
7    2022-11-14 2022-11-14            43    -0.052453           -3.439611
8    2023-01-14 2023-01-14            41    -4.424461            2.464212
9    2023-03-14 2023-03-14            44     3.997800            0.155096
10   2023-05-14 2023-05-14            44     3.172571            2.798609
11   2023-07-14 2023-07-14            44     0.164211            0.071497
12   2023-09-14 2023-09-14            43    -0.266138            0.098898
13   2023-11-14 2023-11-14            42     0.656100            3.424369
14   2024-01-14 2024-01-14            43     2.638804            2.638804
15   2024-03-14 2024-03-14            42    -0.568643           -0.255646
16   2024-05-14 2024-05-14            44    -0.714126            2.633261
17   2024-07-14 2024-07-14            45    -1.907394           -2.110069
18   2024-09-14 2024-09-14            43    -1.733867            2.430614
19   2024-11-14 2024-11-14            33     2.409760           -0.802212
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -3.5 |             -2.7 |          0.8 | True          
[INFO] 2021-11-14   |         -3.1 |              1.2 |          4.3 | True          
[INFO] 2022-01-14   |          1.4 |              2.6 |          1.2 | True          
[INFO] 2022-03-14   |         -1.2 |              0.4 |          1.6 | True          
[INFO] 2022-05-14   |         -1.9 |              0.2 |          2.1 | True          
[INFO] 2022-07-14   |          2.3 |             -1.2 |         -3.5 | False         
[INFO] 2022-09-14   |          2.6 |              3.8 |          1.2 | True          
[INFO] 2022-11-14   |         -0.1 |             -3.4 |         -3.3 | False         
[INFO] 2023-01-14   |         -4.4 |              2.5 |          6.9 | True          
[INFO] 2023-03-14   |          4.0 |              0.2 |         -3.8 | False         
[INFO] 2023-05-14   |          3.2 |              2.8 |         -0.4 | False         
[INFO] 2023-07-14   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2023-09-14   |         -0.3 |              0.1 |          0.4 | True          
[INFO] 2023-11-14   |          0.7 |              3.4 |          2.7 | True          
[INFO] 2024-01-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.6 |             -0.3 |          0.3 | True          
[INFO] 2024-05-14   |         -0.7 |              2.6 |          3.3 | True          
[INFO] 2024-07-14   |         -1.9 |             -2.1 |         -0.2 | False         
[INFO] 2024-09-14   |         -1.7 |              2.4 |          4.1 | True          
[INFO] 2024-11-14   |          2.4 |             -0.8 |         -3.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 12 of 19 periods (63.16% win rate)
[INFO] Updating Excel file with Kmeans results for NK...
[INFO] Excel file updated successfully. Added NK with Kmeans win rate 63.2% in row 37
[INFO] Added best Sharpe parameters 20/22 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 22
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(160/200) - Original Sharpe: 0.6472
[INFO] Added cluster 2 to portfolio: SMA(154/204) - Original Sharpe: 0.5131
[INFO] Added cluster 3 to portfolio: SMA(104/238) - Original Sharpe: 0.3888
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NK_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.7083
[INFO] Kmeans Best out-of-sample Sharpe: -0.0843
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NK...
[INFO] Excel file updated successfully. Added NK with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NK
[INFO] Big Point Value: 5.0
[INFO] Slippage: 35.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6475 to 0.8609
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 22
[INFO] Sharpe Ratio: 0.860889
[INFO] Number of Trades: 251
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10417 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6475 to 0.8609
[INFO] Trades range: 10.0 to 343.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3841 to 2.7941
[INFO] Scaled Long SMA range: -2.7959 to 1.4302
[INFO] Scaled Sharpe ratio range: -3.3641 to 4.1025
[INFO] Scaled Trades range: -0.7787 to 13.9661
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10417 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5252
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 375 elements
[INFO] Cluster 1: 39 elements
[INFO] Cluster 2: 272 elements
[INFO] Cluster 3: 408 elements
[INFO] Cluster 4: 497 elements
[INFO] Cluster 5: 515 elements
[INFO] Cluster 6: 203 elements
[INFO] Cluster 7: 410 elements
[INFO] Cluster 8: 230 elements
[INFO] Cluster 9: 175 elements
[INFO] Cluster 10: 563 elements
[INFO] Cluster 11: 416 elements
[INFO] Cluster 12: 293 elements
[INFO] Cluster 13: 115 elements
[INFO] Cluster 14: 362 elements
[INFO] Cluster 15: 24 elements
[INFO] Cluster 16: 195 elements
[INFO] Cluster 17: 298 elements
[INFO] Cluster 18: 120 elements
[INFO] Cluster 19: 17 elements
[INFO] Cluster 20: 299 elements
[INFO] Cluster 21: 279 elements
[INFO] Cluster 22: 105 elements
[INFO] Cluster 23: 124 elements
[INFO] Cluster 24: 156 elements
[INFO] Cluster 25: 256 elements
[INFO] Cluster 26: 246 elements
[INFO] Cluster 27: 33 elements
[INFO] Cluster 28: 511 elements
[INFO] Cluster 29: 201 elements
[INFO] Cluster 30: 195 elements
[INFO] Cluster 31: 75 elements
[INFO] Cluster 32: 53 elements
[INFO] Cluster 33: 181 elements
[INFO] Cluster 34: 329 elements
[INFO] Cluster 35: 27 elements
[INFO] Cluster 36: 163 elements
[INFO] Cluster 37: 253 elements
[INFO] Cluster 38: 321 elements
[INFO] Cluster 39: 154 elements
[INFO] Cluster 40: 5 elements
[INFO] Cluster 41: 270 elements
[INFO] Cluster 42: 182 elements
[INFO] Cluster 43: 57 elements
[INFO] Cluster 44: 40 elements
[INFO] Cluster 45: 197 elements
[INFO] Cluster 46: 39 elements
[INFO] Cluster 47: 32 elements
[INFO] Cluster 48: 79 elements
[INFO] Cluster 49: 28 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=20, Long SMA=172, Sharpe=-0.2627, Trades=36
[INFO] Cluster 1 cluster: Short SMA=22, Long SMA=28, Sharpe=-0.0432, Trades=150
[INFO] Cluster 2 cluster: Short SMA=58, Long SMA=96, Sharpe=-0.5076, Trades=44
[INFO] Cluster 3 cluster: Short SMA=48, Long SMA=130, Sharpe=-0.0690, Trades=26
[INFO] Cluster 4 cluster: Short SMA=128, Long SMA=266, Sharpe=0.1849, Trades=12
[INFO] Cluster 5 cluster: Short SMA=170, Long SMA=254, Sharpe=-0.0101, Trades=14
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=218, Sharpe=-0.2018, Trades=28
[INFO] Cluster 7 cluster: Short SMA=102, Long SMA=168, Sharpe=-0.0572, Trades=19
[INFO] Cluster 8 cluster: Short SMA=200, Long SMA=220, Sharpe=0.0528, Trades=23
[INFO] Cluster 9 cluster: Short SMA=160, Long SMA=204, Sharpe=0.5506, Trades=19
[INFO] Cluster 10 cluster: Short SMA=62, Long SMA=192, Sharpe=0.0678, Trades=20
[INFO] Cluster 11 cluster: Short SMA=126, Long SMA=232, Sharpe=0.2675, Trades=15
[INFO] Cluster 12 cluster: Short SMA=40, Long SMA=86, Sharpe=-0.2618, Trades=44
[INFO] Cluster 13 cluster: Short SMA=24, Long SMA=46, Sharpe=-0.0243, Trades=78
[INFO] Cluster 14 cluster: Short SMA=190, Long SMA=284, Sharpe=-0.1203, Trades=15
[INFO] Cluster 15 cluster: Short SMA=74, Long SMA=76, Sharpe=-0.4688, Trades=144
[INFO] Cluster 16 cluster: Short SMA=42, Long SMA=106, Sharpe=0.0276, Trades=36
[INFO] Cluster 17 cluster: Short SMA=128, Long SMA=180, Sharpe=0.0283, Trades=23
[INFO] Cluster 18 cluster: Short SMA=254, Long SMA=260, Sharpe=-0.1763, Trades=42
[INFO] Cluster 20 cluster: Short SMA=68, Long SMA=244, Sharpe=0.2308, Trades=12
[INFO] Cluster 21 cluster: Short SMA=20, Long SMA=264, Sharpe=0.2446, Trades=22
[INFO] Cluster 22 cluster: Short SMA=170, Long SMA=178, Sharpe=0.3492, Trades=48
[INFO] Cluster 23 cluster: Short SMA=126, Long SMA=142, Sharpe=0.0521, Trades=45
[INFO] Cluster 24 cluster: Short SMA=154, Long SMA=180, Sharpe=0.2104, Trades=29
[INFO] Cluster 25 cluster: Short SMA=180, Long SMA=224, Sharpe=0.1478, Trades=17
[INFO] Cluster 26 cluster: Short SMA=108, Long SMA=130, Sharpe=-0.1908, Trades=41
[INFO] Cluster 27 cluster: Short SMA=186, Long SMA=188, Sharpe=0.4529, Trades=89
[INFO] Cluster 28 cluster: Short SMA=86, Long SMA=278, Sharpe=0.1857, Trades=13
[INFO] Cluster 29 cluster: Short SMA=214, Long SMA=264, Sharpe=-0.2533, Trades=14
[INFO] Cluster 30 cluster: Short SMA=232, Long SMA=286, Sharpe=0.0997, Trades=13
[INFO] Cluster 31 cluster: Short SMA=44, Long SMA=58, Sharpe=-0.3386, Trades=67
[INFO] Cluster 32 cluster: Short SMA=22, Long SMA=36, Sharpe=-0.0038, Trades=104
[INFO] Cluster 33 cluster: Short SMA=250, Long SMA=280, Sharpe=-0.1648, Trades=19
[INFO] Cluster 34 cluster: Short SMA=50, Long SMA=160, Sharpe=-0.1597, Trades=20
[INFO] Cluster 35 cluster: Short SMA=126, Long SMA=128, Sharpe=-0.1278, Trades=119
[INFO] Cluster 36 cluster: Short SMA=26, Long SMA=64, Sharpe=0.1103, Trades=60
[INFO] Cluster 37 cluster: Short SMA=76, Long SMA=220, Sharpe=0.0850, Trades=18
[INFO] Cluster 38 cluster: Short SMA=48, Long SMA=282, Sharpe=0.0976, Trades=17
[INFO] Cluster 39 cluster: Short SMA=266, Long SMA=284, Sharpe=-0.3492, Trades=23
[INFO] Cluster 41 cluster: Short SMA=116, Long SMA=210, Sharpe=0.2544, Trades=17
[INFO] Cluster 42 cluster: Short SMA=82, Long SMA=136, Sharpe=-0.1311, Trades=24
[INFO] Cluster 43 cluster: Short SMA=16, Long SMA=292, Sharpe=0.3897, Trades=21
[INFO] Cluster 44 cluster: Short SMA=122, Long SMA=128, Sharpe=-0.0894, Trades=73
[INFO] Cluster 45 cluster: Short SMA=34, Long SMA=248, Sharpe=0.0269, Trades=18
[INFO] Cluster 46 cluster: Short SMA=32, Long SMA=42, Sharpe=-0.2041, Trades=107
[INFO] Cluster 47 cluster: Short SMA=264, Long SMA=268, Sharpe=-0.4519, Trades=51
[INFO] Cluster 48 cluster: Short SMA=226, Long SMA=252, Sharpe=-0.3654, Trades=20
[INFO] Cluster 49 cluster: Short SMA=82, Long SMA=88, Sharpe=-0.3371, Trades=76
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=22, Sharpe=0.8609, Trades=251
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=160, Long SMA=204, Sharpe=0.5506, Trades=19
[INFO] Top 2: Short SMA=186, Long SMA=188, Sharpe=0.4529, Trades=89
[INFO] Top 3: Short SMA=16, Long SMA=292, Sharpe=0.3897, Trades=21
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10395 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 22
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(160/204) - Original Sharpe: 0.5506, Trades: 19
[INFO] Hierarchical cluster 2: SMA(186/188) - Original Sharpe: 0.4529, Trades: 89
[INFO] Hierarchical cluster 3: SMA(16/292) - Original Sharpe: 0.3897, Trades: 21
[INFO] Hierarchical cluster 4: SMA(170/178) - Original Sharpe: 0.3492, Trades: 48
[INFO] Hierarchical cluster 5: SMA(126/232) - Original Sharpe: 0.2675, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/22)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (160/204) - Sharpe: 0.5506
[INFO] cluster 2: (186/188) - Sharpe: 0.4529
[INFO] cluster 3: (16/292) - Sharpe: 0.3897
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -3.504421           -1.934701
1    2021-11-14 2021-11-14            43    -3.098247            0.342835
2    2022-01-14 2022-01-14            41     1.372559            3.810394
3    2022-03-14 2022-03-14            44    -1.165984           -5.113138
4    2022-05-14 2022-05-14            43    -1.900497            0.601996
5    2022-07-14 2022-07-14            44     2.319224           -2.997022
6    2022-09-14 2022-09-14            43     2.556621            0.565802
7    2022-11-14 2022-11-14            43    -0.052453           -2.689306
8    2023-01-14 2023-01-14            41    -4.424461            0.136376
9    2023-03-14 2023-03-14            44     3.997800            0.016651
10   2023-05-14 2023-05-14            44     3.172571            1.345870
11   2023-07-14 2023-07-14            44     0.164211            0.071497
12   2023-09-14 2023-09-14            43    -0.266138            0.098898
13   2023-11-14 2023-11-14            42     0.656100            3.424369
14   2024-01-14 2024-01-14            43     2.638804            2.638804
15   2024-03-14 2024-03-14            42    -0.568643           -0.255646
16   2024-05-14 2024-05-14            44    -0.714126            2.633261
17   2024-07-14 2024-07-14            45    -1.907394           -2.110069
18   2024-09-14 2024-09-14            43    -1.733867            2.042672
19   2024-11-14 2024-11-14            33     2.409760            3.221314
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -3.5 |             -1.9 |          1.6 | True          
[INFO] 2021-11-14   |         -3.1 |              0.3 |          3.4 | True          
[INFO] 2022-01-14   |          1.4 |              3.8 |          2.4 | True          
[INFO] 2022-03-14   |         -1.2 |             -5.1 |         -3.9 | False         
[INFO] 2022-05-14   |         -1.9 |              0.6 |          2.5 | True          
[INFO] 2022-07-14   |          2.3 |             -3.0 |         -5.3 | False         
[INFO] 2022-09-14   |          2.6 |              0.6 |         -2.0 | False         
[INFO] 2022-11-14   |         -0.1 |             -2.7 |         -2.6 | False         
[INFO] 2023-01-14   |         -4.4 |              0.1 |          4.5 | True          
[INFO] 2023-03-14   |          4.0 |              0.0 |         -4.0 | False         
[INFO] 2023-05-14   |          3.2 |              1.3 |         -1.9 | False         
[INFO] 2023-07-14   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2023-09-14   |         -0.3 |              0.1 |          0.4 | True          
[INFO] 2023-11-14   |          0.7 |              3.4 |          2.7 | True          
[INFO] 2024-01-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.6 |             -0.3 |          0.3 | True          
[INFO] 2024-05-14   |         -0.7 |              2.6 |          3.3 | True          
[INFO] 2024-07-14   |         -1.9 |             -2.1 |         -0.2 | False         
[INFO] 2024-09-14   |         -1.7 |              2.0 |          3.7 | True          
[INFO] 2024-11-14   |          2.4 |              3.2 |          0.8 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 19 periods (57.89% win rate)
[INFO] Updating Excel file with Hierarchical results for NK...
[INFO] Excel file updated successfully. Added NK with Hierarchical win rate 57.9% in row 37
[INFO] Added best Sharpe parameters 20/22 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 22
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(160/204) - Original Sharpe: 0.5506
[INFO] Added cluster 2 to portfolio: SMA(186/188) - Original Sharpe: 0.4529
[INFO] Added cluster 3 to portfolio: SMA(16/292) - Original Sharpe: 0.3897
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NK_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3793
[INFO] Hierarchical Best out-of-sample Sharpe: -0.0843
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NK...
[INFO] Excel file updated successfully. Added NK with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NK
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NQ in column D: 11.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 152.51s
[INFO] Best parameters: Short SMA = 210, Long SMA = 234
[INFO] Best Sharpe ratio: 1.114521, Trades: 10
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NQ
[INFO] Big Point Value (from data): 20.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.56 contracts
[INFO] Maximum Position Size: 11 contracts
[INFO] Strategy Total P&L: $690,104.00
[INFO] Market Buy & Hold P&L: $312,105.00
[INFO] Outperformance: $377,999.00
[INFO] Sharpe ratio (entire period, annualized): 0.738582
[INFO] Sharpe ratio (in-sample, annualized): 1.114521
[INFO] Sharpe ratio (out-of-sample, annualized): 0.029416
[INFO] Maximum Drawdown: $205,067.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 6
[INFO] Out-of-sample period trades: 4
[INFO] Total trades: 10
[INFO] In-sample P&L: $742,024.00
[INFO] Out-of-sample P&L: $10,238.00
[INFO] 
Best parameters from GA: Short SMA = 210, Long SMA = 234, Sharpe = 1.114521
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 20.0
[INFO] Slippage: 11.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.2377 to 1.1145
[INFO] 
Best parameters:
[INFO] Short SMA: 210
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.114521
[INFO] Number of Trades: 10
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 6490 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.2377 to 1.1145
[INFO] Trades range: 10.0 to 305.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0679 to 2.6754
[INFO] Scaled Long SMA range: -2.3404 to 1.7698
[INFO] Scaled Sharpe ratio range: -4.0912 to 2.6527
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 203 elements
[INFO] Kmeans Cluster 1: 120 elements
[INFO] Kmeans Cluster 2: 142 elements
[INFO] Kmeans Cluster 3: 131 elements
[INFO] Kmeans Cluster 4: 119 elements
[INFO] Kmeans Cluster 5: 133 elements
[INFO] Kmeans Cluster 6: 62 elements
[INFO] Kmeans Cluster 7: 153 elements
[INFO] Kmeans Cluster 8: 168 elements
[INFO] Kmeans Cluster 9: 146 elements
[INFO] Kmeans Cluster 10: 138 elements
[INFO] Kmeans Cluster 11: 139 elements
[INFO] Kmeans Cluster 12: 114 elements
[INFO] Kmeans Cluster 13: 103 elements
[INFO] Kmeans Cluster 14: 86 elements
[INFO] Kmeans Cluster 15: 187 elements
[INFO] Kmeans Cluster 16: 211 elements
[INFO] Kmeans Cluster 17: 123 elements
[INFO] Kmeans Cluster 18: 55 elements
[INFO] Kmeans Cluster 19: 162 elements
[INFO] Kmeans Cluster 20: 126 elements
[INFO] Kmeans Cluster 21: 156 elements
[INFO] Kmeans Cluster 22: 45 elements
[INFO] Kmeans Cluster 23: 61 elements
[INFO] Kmeans Cluster 24: 154 elements
[INFO] Kmeans Cluster 25: 177 elements
[INFO] Kmeans Cluster 26: 231 elements
[INFO] Kmeans Cluster 27: 105 elements
[INFO] Kmeans Cluster 28: 153 elements
[INFO] Kmeans Cluster 29: 163 elements
[INFO] Kmeans Cluster 30: 34 elements
[INFO] Kmeans Cluster 31: 156 elements
[INFO] Kmeans Cluster 32: 85 elements
[INFO] Kmeans Cluster 33: 167 elements
[INFO] Kmeans Cluster 34: 122 elements
[INFO] Kmeans Cluster 35: 75 elements
[INFO] Kmeans Cluster 36: 108 elements
[INFO] Kmeans Cluster 37: 167 elements
[INFO] Kmeans Cluster 38: 189 elements
[INFO] Kmeans Cluster 39: 80 elements
[INFO] Kmeans Cluster 40: 108 elements
[INFO] Kmeans Cluster 41: 75 elements
[INFO] Kmeans Cluster 42: 142 elements
[INFO] Kmeans Cluster 43: 139 elements
[INFO] Kmeans Cluster 44: 148 elements
[INFO] Kmeans Cluster 45: 61 elements
[INFO] Kmeans Cluster 46: 126 elements
[INFO] Kmeans Cluster 47: 118 elements
[INFO] Kmeans Cluster 48: 189 elements
[INFO] Kmeans Cluster 49: 135 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=182.79, Long SMA=201.67, Sharpe=0.6830
[INFO] Centroid 1: Short SMA=28.86, Long SMA=85.07, Sharpe=0.3124
[INFO] Centroid 2: Short SMA=22.63, Long SMA=258.63, Sharpe=0.5519
[INFO] Centroid 3: Short SMA=35.83, Long SMA=176.00, Sharpe=0.6163
[INFO] Centroid 4: Short SMA=105.82, Long SMA=132.67, Sharpe=0.7277
[INFO] Centroid 5: Short SMA=253.79, Long SMA=288.93, Sharpe=0.7973
[INFO] Centroid 6: Short SMA=24.81, Long SMA=49.13, Sharpe=-0.0479
[INFO] Centroid 7: Short SMA=83.56, Long SMA=123.93, Sharpe=0.5045
[INFO] Centroid 8: Short SMA=226.38, Long SMA=248.80, Sharpe=0.8939
[INFO] Centroid 9: Short SMA=38.19, Long SMA=280.71, Sharpe=0.6908
[INFO] Centroid 10: Short SMA=275.91, Long SMA=289.48, Sharpe=0.6518
[INFO] Centroid 11: Short SMA=35.80, Long SMA=72.06, Sharpe=0.2139
[INFO] Centroid 12: Short SMA=55.84, Long SMA=105.54, Sharpe=0.5111
[INFO] Centroid 13: Short SMA=129.36, Long SMA=143.84, Sharpe=0.5609
[INFO] Centroid 14: Short SMA=100.37, Long SMA=188.70, Sharpe=0.7567
[INFO] Centroid 15: Short SMA=23.47, Long SMA=157.83, Sharpe=0.5616
[INFO] Centroid 16: Short SMA=42.86, Long SMA=204.64, Sharpe=0.5959
[INFO] Centroid 17: Short SMA=19.71, Long SMA=218.98, Sharpe=0.5351
[INFO] Centroid 18: Short SMA=111.85, Long SMA=245.89, Sharpe=0.7631
[INFO] Centroid 19: Short SMA=42.00, Long SMA=141.49, Sharpe=0.6547
[INFO] Centroid 20: Short SMA=199.33, Long SMA=220.43, Sharpe=0.8441
[INFO] Centroid 21: Short SMA=30.44, Long SMA=281.33, Sharpe=0.6070
[INFO] Centroid 22: Short SMA=26.93, Long SMA=36.98, Sharpe=0.4511
[INFO] Centroid 23: Short SMA=96.23, Long SMA=113.87, Sharpe=0.4160
[INFO] Centroid 24: Short SMA=83.42, Long SMA=179.17, Sharpe=0.6047
[INFO] Centroid 25: Short SMA=26.55, Long SMA=238.08, Sharpe=0.5988
[INFO] Centroid 26: Short SMA=72.34, Long SMA=149.98, Sharpe=0.5343
[INFO] Centroid 27: Short SMA=30.29, Long SMA=98.58, Sharpe=0.4282
[INFO] Centroid 28: Short SMA=212.41, Long SMA=236.17, Sharpe=0.9890
[INFO] Centroid 29: Short SMA=251.26, Long SMA=268.99, Sharpe=0.7418
[INFO] Centroid 30: Short SMA=191.00, Long SMA=277.24, Sharpe=0.9489
[INFO] Centroid 31: Short SMA=57.77, Long SMA=122.06, Sharpe=0.5884
[INFO] Centroid 32: Short SMA=148.89, Long SMA=165.29, Sharpe=0.7549
[INFO] Centroid 33: Short SMA=107.66, Long SMA=157.68, Sharpe=0.7968
[INFO] Centroid 34: Short SMA=61.18, Long SMA=87.79, Sharpe=0.3810
[INFO] Centroid 35: Short SMA=27.01, Long SMA=40.05, Sharpe=0.2994
[INFO] Centroid 36: Short SMA=75.65, Long SMA=92.04, Sharpe=0.2869
[INFO] Centroid 37: Short SMA=135.88, Long SMA=163.96, Sharpe=0.6578
[INFO] Centroid 38: Short SMA=227.87, Long SMA=273.60, Sharpe=0.8592
[INFO] Centroid 39: Short SMA=20.27, Long SMA=42.97, Sharpe=0.1451
[INFO] Centroid 40: Short SMA=163.46, Long SMA=182.87, Sharpe=0.5785
[INFO] Centroid 41: Short SMA=69.25, Long SMA=79.55, Sharpe=0.1507
[INFO] Centroid 42: Short SMA=48.69, Long SMA=230.79, Sharpe=0.6419
[INFO] Centroid 43: Short SMA=24.85, Long SMA=63.70, Sharpe=0.0669
[INFO] Centroid 44: Short SMA=19.70, Long SMA=187.99, Sharpe=0.5032
[INFO] Centroid 45: Short SMA=13.51, Long SMA=286.66, Sharpe=0.4724
[INFO] Centroid 46: Short SMA=19.83, Long SMA=130.62, Sharpe=0.5876
[INFO] Centroid 47: Short SMA=103.19, Long SMA=129.63, Sharpe=0.6271
[INFO] Centroid 48: Short SMA=58.18, Long SMA=176.34, Sharpe=0.5132
[INFO] Centroid 49: Short SMA=26.22, Long SMA=114.01, Sharpe=0.5098
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=210, Long SMA=234, Sharpe=1.1145, Trades=10
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=184, Long SMA=278, Sharpe=0.9907, Trades=11
[INFO] Kmeans Top 2: Short SMA=212, Long SMA=236, Sharpe=0.9823, Trades=10
[INFO] Kmeans Top 3: Short SMA=228, Long SMA=248, Sharpe=0.9218, Trades=10
[INFO] Kmeans Top 4: Short SMA=228, Long SMA=274, Sharpe=0.9156, Trades=11
[INFO] Kmeans Top 5: Short SMA=200, Long SMA=220, Sharpe=0.8263, Trades=10
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (183, 202)
[INFO]   Nearest: (182.0, 202.0)
[INFO]   Rounded: (29, 85)
[INFO]   Nearest: (28.0, 86.0)
[INFO]   Rounded: (23, 259)
[INFO]   Nearest: (22.0, 258.0)
[INFO]   Rounded: (36, 176)
[INFO]   Rounded: (106, 133)
[INFO]   Nearest: (106.0, 132.0)
[INFO]   Rounded: (254, 289)
[INFO]   Nearest: (254.0, 288.0)
[INFO]   Rounded: (25, 49)
[INFO]   Nearest: (24.0, 50.0)
[INFO]   Rounded: (84, 124)
[INFO]   Rounded: (226, 249)
[INFO]   Nearest: (226.0, 248.0)
[INFO]   Rounded: (38, 281)
[INFO]   Nearest: (38.0, 280.0)
[INFO]   Rounded: (276, 289)
[INFO]   Nearest: (276.0, 290.0)
[INFO]   Rounded: (36, 72)
[INFO]   Rounded: (56, 106)
[INFO]   Rounded: (129, 144)
[INFO]   Nearest: (130.0, 144.0)
[INFO]   Rounded: (100, 189)
[INFO]   Nearest: (100.0, 188.0)
[INFO]   Rounded: (23, 158)
[INFO]   Nearest: (24.0, 158.0)
[INFO]   Rounded: (43, 205)
[INFO]   Nearest: (42.0, 204.0)
[INFO]   Rounded: (20, 219)
[INFO]   Nearest: (20.0, 218.0)
[INFO]   Rounded: (112, 246)
[INFO]   Rounded: (42, 141)
[INFO]   Nearest: (42.0, 142.0)
[INFO]   Rounded: (199, 220)
[INFO]   Nearest: (200.0, 220.0)
[INFO]   Rounded: (30, 281)
[INFO]   Nearest: (30.0, 282.0)
[INFO]   Rounded: (27, 37)
[INFO]   Nearest: (26.0, 36.0)
[INFO]   Rounded: (96, 114)
[INFO]   Rounded: (83, 179)
[INFO]   Nearest: (84.0, 180.0)
[INFO]   Rounded: (27, 238)
[INFO]   Nearest: (26.0, 238.0)
[INFO]   Rounded: (72, 150)
[INFO]   Rounded: (30, 99)
[INFO]   Nearest: (30.0, 98.0)
[INFO]   Rounded: (212, 236)
[INFO]   Rounded: (251, 269)
[INFO]   Nearest: (252.0, 268.0)
[INFO]   Rounded: (191, 277)
[INFO]   Nearest: (190.0, 278.0)
[INFO]   Rounded: (58, 122)
[INFO]   Rounded: (149, 165)
[INFO]   Nearest: (148.0, 166.0)
[INFO]   Rounded: (108, 158)
[INFO]   Rounded: (61, 88)
[INFO]   Nearest: (62.0, 88.0)
[INFO]   Rounded: (27, 40)
[INFO]   Nearest: (28.0, 40.0)
[INFO]   Rounded: (76, 92)
[INFO]   Rounded: (136, 164)
[INFO]   Rounded: (228, 274)
[INFO]   Rounded: (20, 43)
[INFO]   Nearest: (20.0, 42.0)
[INFO]   Rounded: (163, 183)
[INFO]   Nearest: (164.0, 182.0)
[INFO]   Rounded: (69, 80)
[INFO]   Nearest: (70.0, 80.0)
[INFO]   Rounded: (49, 231)
[INFO]   Nearest: (48.0, 230.0)
[INFO]   Rounded: (25, 64)
[INFO]   Nearest: (24.0, 64.0)
[INFO]   Rounded: (20, 188)
[INFO]   Rounded: (14, 287)
[INFO]   Nearest: (14.0, 286.0)
[INFO]   Rounded: (20, 131)
[INFO]   Nearest: (20.0, 130.0)
[INFO]   Rounded: (103, 130)
[INFO]   Nearest: (104.0, 130.0)
[INFO]   Rounded: (58, 176)
[INFO]   Rounded: (26, 114)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 210, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(184/278) - Original Sharpe: 0.9907, Trades: 11
[INFO] Kmeans cluster 2: SMA(212/236) - Original Sharpe: 0.9823, Trades: 10
[INFO] Kmeans cluster 3: SMA(228/248) - Original Sharpe: 0.9218, Trades: 10
[INFO] Kmeans cluster 4: SMA(228/274) - Original Sharpe: 0.9156, Trades: 11
[INFO] Kmeans cluster 5: SMA(200/220) - Original Sharpe: 0.8263, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (210/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (184/278) - Sharpe: 0.9907
[INFO] cluster 2: (212/236) - Sharpe: 0.9823
[INFO] cluster 3: (228/248) - Sharpe: 0.9218
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     1.806484            1.806484
1    2021-11-14 2021-11-14            43    -0.977041           -0.977041
2    2022-01-14 2022-01-14            41    -2.947949           -2.947949
3    2022-03-14 2022-03-14            44    -1.115967           -1.115967
4    2022-05-14 2022-05-14            43     1.940963            0.909634
5    2022-07-14 2022-07-14            44     0.287301            0.287301
6    2022-09-14 2022-09-14            43     0.419792            0.419792
7    2022-11-14 2022-11-14            43     0.548831            0.548831
8    2023-01-14 2023-01-14            41    -0.831080           -0.831080
9    2023-03-14 2023-03-14            44    -1.028325           -3.708892
10   2023-05-14 2023-05-14            44    -3.465831           -0.611198
11   2023-07-14 2023-07-14            44    -0.679801           -0.796538
12   2023-09-14 2023-09-14            43    -0.029656           -0.029656
13   2023-11-14 2023-11-14            42     3.419744            3.419744
14   2024-01-14 2024-01-14            43     2.462763            2.462763
15   2024-03-14 2024-03-14            42    -1.004018           -1.004018
16   2024-05-14 2024-05-14            44     4.245445            4.245445
17   2024-07-14 2024-07-14            45    -2.152848           -2.152848
18   2024-09-14 2024-09-14            43     2.552179            2.552179
19   2024-11-14 2024-11-14            33    -1.170159           -1.170159
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.9 |             -2.9 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.9 |              0.9 |         -1.0 | False         
[INFO] 2022-07-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -1.0 |             -3.7 |         -2.7 | False         
[INFO] 2023-05-14   |         -3.5 |             -0.6 |          2.9 | True          
[INFO] 2023-07-14   |         -0.7 |             -0.8 |         -0.1 | False         
[INFO] 2023-09-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 4
[INFO] Kmeans cluster wins (rounded comparison): 1 of 4 periods (25.00% win rate)
[INFO] Updating Excel file with Kmeans results for NQ...
[INFO] Excel file updated successfully. Added NQ with Kmeans win rate 25.0% in row 38
[INFO] Added best Sharpe parameters 210/234 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 210, Long SMA: 234
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(184/278) - Original Sharpe: 0.9907
[INFO] Added cluster 2 to portfolio: SMA(212/236) - Original Sharpe: 0.9823
[INFO] Added cluster 3 to portfolio: SMA(228/248) - Original Sharpe: 0.9218
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NQ_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0369
[INFO] Kmeans Best out-of-sample Sharpe: 0.0294
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NQ...
[INFO] Excel file updated successfully. Added NQ with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NQ
[INFO] Big Point Value: 20.0
[INFO] Slippage: 11.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.2377 to 1.1145
[INFO] 
Best parameters:
[INFO] Short SMA: 210
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.114521
[INFO] Number of Trades: 10
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 6490 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.2377 to 1.1145
[INFO] Trades range: 10.0 to 305.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0679 to 2.6754
[INFO] Scaled Long SMA range: -2.3404 to 1.7698
[INFO] Scaled Sharpe ratio range: -4.0912 to 2.6527
[INFO] Scaled Trades range: -0.5631 to 13.6657
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 6490 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.7509
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 41 elements
[INFO] Cluster 1: 111 elements
[INFO] Cluster 2: 392 elements
[INFO] Cluster 3: 305 elements
[INFO] Cluster 4: 176 elements
[INFO] Cluster 5: 237 elements
[INFO] Cluster 6: 269 elements
[INFO] Cluster 7: 111 elements
[INFO] Cluster 8: 66 elements
[INFO] Cluster 9: 10 elements
[INFO] Cluster 10: 71 elements
[INFO] Cluster 11: 23 elements
[INFO] Cluster 12: 234 elements
[INFO] Cluster 13: 49 elements
[INFO] Cluster 14: 200 elements
[INFO] Cluster 15: 300 elements
[INFO] Cluster 16: 73 elements
[INFO] Cluster 17: 30 elements
[INFO] Cluster 18: 243 elements
[INFO] Cluster 19: 96 elements
[INFO] Cluster 20: 170 elements
[INFO] Cluster 21: 240 elements
[INFO] Cluster 22: 87 elements
[INFO] Cluster 23: 126 elements
[INFO] Cluster 24: 259 elements
[INFO] Cluster 25: 92 elements
[INFO] Cluster 26: 124 elements
[INFO] Cluster 27: 4 elements
[INFO] Cluster 28: 50 elements
[INFO] Cluster 29: 232 elements
[INFO] Cluster 30: 187 elements
[INFO] Cluster 31: 224 elements
[INFO] Cluster 32: 187 elements
[INFO] Cluster 33: 106 elements
[INFO] Cluster 34: 168 elements
[INFO] Cluster 35: 107 elements
[INFO] Cluster 36: 139 elements
[INFO] Cluster 37: 32 elements
[INFO] Cluster 38: 32 elements
[INFO] Cluster 39: 34 elements
[INFO] Cluster 40: 81 elements
[INFO] Cluster 41: 55 elements
[INFO] Cluster 42: 20 elements
[INFO] Cluster 43: 105 elements
[INFO] Cluster 44: 110 elements
[INFO] Cluster 45: 172 elements
[INFO] Cluster 46: 162 elements
[INFO] Cluster 47: 63 elements
[INFO] Cluster 48: 66 elements
[INFO] Cluster 49: 19 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=24, Long SMA=32, Sharpe=0.3245, Trades=96
[INFO] Cluster 1 cluster: Short SMA=136, Long SMA=148, Sharpe=0.5980, Trades=26
[INFO] Cluster 2 cluster: Short SMA=24, Long SMA=240, Sharpe=0.5709, Trades=12
[INFO] Cluster 3 cluster: Short SMA=36, Long SMA=280, Sharpe=0.6048, Trades=11
[INFO] Cluster 4 cluster: Short SMA=104, Long SMA=132, Sharpe=0.6193, Trades=20
[INFO] Cluster 5 cluster: Short SMA=60, Long SMA=90, Sharpe=0.3426, Trades=30
[INFO] Cluster 6 cluster: Short SMA=104, Long SMA=164, Sharpe=0.7264, Trades=12
[INFO] Cluster 7 cluster: Short SMA=228, Long SMA=236, Sharpe=0.8887, Trades=20
[INFO] Cluster 8 cluster: Short SMA=106, Long SMA=118, Sharpe=0.6443, Trades=30
[INFO] Cluster 10 cluster: Short SMA=108, Long SMA=234, Sharpe=0.8133, Trades=10
[INFO] Cluster 11 cluster: Short SMA=34, Long SMA=36, Sharpe=0.0838, Trades=134
[INFO] Cluster 12 cluster: Short SMA=60, Long SMA=174, Sharpe=0.5253, Trades=10
[INFO] Cluster 13 cluster: Short SMA=120, Long SMA=126, Sharpe=0.6601, Trades=41
[INFO] Cluster 14 cluster: Short SMA=210, Long SMA=242, Sharpe=1.0053, Trades=10
[INFO] Cluster 15 cluster: Short SMA=24, Long SMA=158, Sharpe=0.5499, Trades=12
[INFO] Cluster 16 cluster: Short SMA=160, Long SMA=168, Sharpe=0.7100, Trades=22
[INFO] Cluster 17 cluster: Short SMA=116, Long SMA=118, Sharpe=0.4186, Trades=66
[INFO] Cluster 18 cluster: Short SMA=36, Long SMA=108, Sharpe=0.4683, Trades=20
[INFO] Cluster 19 cluster: Short SMA=200, Long SMA=222, Sharpe=0.8696, Trades=10
[INFO] Cluster 20 cluster: Short SMA=78, Long SMA=120, Sharpe=0.4869, Trades=16
[INFO] Cluster 21 cluster: Short SMA=40, Long SMA=202, Sharpe=0.5941, Trades=10
[INFO] Cluster 22 cluster: Short SMA=18, Long SMA=44, Sharpe=0.1873, Trades=66
[INFO] Cluster 23 cluster: Short SMA=32, Long SMA=60, Sharpe=0.1280, Trades=50
[INFO] Cluster 24 cluster: Short SMA=228, Long SMA=270, Sharpe=0.8855, Trades=11
[INFO] Cluster 25 cluster: Short SMA=14, Long SMA=284, Sharpe=0.3848, Trades=21
[INFO] Cluster 26 cluster: Short SMA=18, Long SMA=194, Sharpe=0.4855, Trades=14
[INFO] Cluster 28 cluster: Short SMA=34, Long SMA=54, Sharpe=0.2833, Trades=56
[INFO] Cluster 29 cluster: Short SMA=44, Long SMA=148, Sharpe=0.6478, Trades=12
[INFO] Cluster 30 cluster: Short SMA=136, Long SMA=166, Sharpe=0.7517, Trades=12
[INFO] Cluster 31 cluster: Short SMA=252, Long SMA=284, Sharpe=0.7770, Trades=11
[INFO] Cluster 32 cluster: Short SMA=182, Long SMA=204, Sharpe=0.6891, Trades=10
[INFO] Cluster 33 cluster: Short SMA=278, Long SMA=290, Sharpe=0.6614, Trades=21
[INFO] Cluster 34 cluster: Short SMA=84, Long SMA=174, Sharpe=0.6200, Trades=10
[INFO] Cluster 35 cluster: Short SMA=22, Long SMA=90, Sharpe=0.2576, Trades=38
[INFO] Cluster 36 cluster: Short SMA=22, Long SMA=122, Sharpe=0.5736, Trades=24
[INFO] Cluster 37 cluster: Short SMA=268, Long SMA=270, Sharpe=0.7938, Trades=43
[INFO] Cluster 38 cluster: Short SMA=30, Long SMA=38, Sharpe=0.0154, Trades=84
[INFO] Cluster 39 cluster: Short SMA=32, Long SMA=44, Sharpe=0.4018, Trades=68
[INFO] Cluster 40 cluster: Short SMA=162, Long SMA=184, Sharpe=0.5887, Trades=10
[INFO] Cluster 41 cluster: Short SMA=82, Long SMA=90, Sharpe=0.2420, Trades=52
[INFO] Cluster 42 cluster: Short SMA=24, Long SMA=28, Sharpe=0.3773, Trades=130
[INFO] Cluster 43 cluster: Short SMA=38, Long SMA=74, Sharpe=0.2794, Trades=40
[INFO] Cluster 44 cluster: Short SMA=62, Long SMA=122, Sharpe=0.5880, Trades=16
[INFO] Cluster 45 cluster: Short SMA=72, Long SMA=146, Sharpe=0.4788, Trades=12
[INFO] Cluster 46 cluster: Short SMA=48, Long SMA=224, Sharpe=0.6016, Trades=10
[INFO] Cluster 47 cluster: Short SMA=258, Long SMA=266, Sharpe=0.7872, Trades=24
[INFO] Cluster 48 cluster: Short SMA=24, Long SMA=66, Sharpe=-0.0718, Trades=46
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=210, Long SMA=234, Sharpe=1.1145, Trades=10
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=210, Long SMA=242, Sharpe=1.0053, Trades=10
[INFO] Top 2: Short SMA=228, Long SMA=236, Sharpe=0.8887, Trades=20
[INFO] Top 3: Short SMA=228, Long SMA=270, Sharpe=0.8855, Trades=11
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 6457 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 210, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(210/242) - Original Sharpe: 1.0053, Trades: 10
[INFO] Hierarchical cluster 2: SMA(228/236) - Original Sharpe: 0.8887, Trades: 20
[INFO] Hierarchical cluster 3: SMA(228/270) - Original Sharpe: 0.8855, Trades: 11
[INFO] Hierarchical cluster 4: SMA(200/222) - Original Sharpe: 0.8696, Trades: 10
[INFO] Hierarchical cluster 5: SMA(108/234) - Original Sharpe: 0.8133, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (210/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (210/242) - Sharpe: 1.0053
[INFO] cluster 2: (228/236) - Sharpe: 0.8887
[INFO] cluster 3: (228/270) - Sharpe: 0.8855
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     1.806484            1.806484
1    2021-11-14 2021-11-14            43    -0.977041           -0.977041
2    2022-01-14 2022-01-14            41    -2.947949           -2.947949
3    2022-03-14 2022-03-14            44    -1.115967           -1.115967
4    2022-05-14 2022-05-14            43     1.940963            1.197127
5    2022-07-14 2022-07-14            44     0.287301            0.287301
6    2022-09-14 2022-09-14            43     0.419792            0.419792
7    2022-11-14 2022-11-14            43     0.548831            0.548831
8    2023-01-14 2023-01-14            41    -0.831080           -0.831080
9    2023-03-14 2023-03-14            44    -1.028325           -2.536456
10   2023-05-14 2023-05-14            44    -3.465831            0.305935
11   2023-07-14 2023-07-14            44    -0.679801            0.248236
12   2023-09-14 2023-09-14            43    -0.029656           -0.029656
13   2023-11-14 2023-11-14            42     3.419744            3.419744
14   2024-01-14 2024-01-14            43     2.462763            2.462763
15   2024-03-14 2024-03-14            42    -1.004018           -1.004018
16   2024-05-14 2024-05-14            44     4.245445            4.245445
17   2024-07-14 2024-07-14            45    -2.152848           -2.152848
18   2024-09-14 2024-09-14            43     2.552179            2.552179
19   2024-11-14 2024-11-14            33    -1.170159           -1.170159
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.9 |             -2.9 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.9 |              1.2 |         -0.7 | False         
[INFO] 2022-07-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -1.0 |             -2.5 |         -1.5 | False         
[INFO] 2023-05-14   |         -3.5 |              0.3 |          3.8 | True          
[INFO] 2023-07-14   |         -0.7 |              0.2 |          0.9 | True          
[INFO] 2023-09-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 4
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 4 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for NQ...
[INFO] Excel file updated successfully. Added NQ with Hierarchical win rate 50.0% in row 38
[INFO] Added best Sharpe parameters 210/234 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 210, Long SMA: 234
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(210/242) - Original Sharpe: 1.0053
[INFO] Added cluster 2 to portfolio: SMA(228/236) - Original Sharpe: 0.8887
[INFO] Added cluster 3 to portfolio: SMA(228/270) - Original Sharpe: 0.8855
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NQ_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1594
[INFO] Hierarchical Best out-of-sample Sharpe: 0.0294
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NQ...
[INFO] Excel file updated successfully. Added NQ with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NQ
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for PA in column D: 80.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 116.95s
[INFO] Best parameters: Short SMA = 112, Long SMA = 174
[INFO] Best Sharpe ratio: 0.926948, Trades: 16
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @PA=13INC
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 2.59 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $712,220.00
[INFO] Market Buy & Hold P&L: $9,530.00
[INFO] Outperformance: $702,690.00
[INFO] Sharpe ratio (entire period, annualized): 0.716294
[INFO] Sharpe ratio (in-sample, annualized): 0.926948
[INFO] Sharpe ratio (out-of-sample, annualized): 0.281614
[INFO] Maximum Drawdown: $241,380.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 10
[INFO] Out-of-sample period trades: 6
[INFO] Total trades: 16
[INFO] In-sample P&L: $597,115.00
[INFO] Out-of-sample P&L: $87,290.00
[INFO] 
Best parameters from GA: Short SMA = 112, Long SMA = 174, Sharpe = 0.926948
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 80.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5147 to 0.9269
[INFO] 
Best parameters:
[INFO] Short SMA: 112
[INFO] Long SMA: 174
[INFO] Sharpe Ratio: 0.926948
[INFO] Number of Trades: 16
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8657 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5147 to 0.9269
[INFO] Trades range: 10.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2463 to 2.7391
[INFO] Scaled Long SMA range: -2.6546 to 1.6587
[INFO] Scaled Sharpe ratio range: -4.6266 to 2.1322
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 119 elements
[INFO] Kmeans Cluster 1: 225 elements
[INFO] Kmeans Cluster 2: 166 elements
[INFO] Kmeans Cluster 3: 274 elements
[INFO] Kmeans Cluster 4: 195 elements
[INFO] Kmeans Cluster 5: 214 elements
[INFO] Kmeans Cluster 6: 151 elements
[INFO] Kmeans Cluster 7: 84 elements
[INFO] Kmeans Cluster 8: 195 elements
[INFO] Kmeans Cluster 9: 166 elements
[INFO] Kmeans Cluster 10: 130 elements
[INFO] Kmeans Cluster 11: 248 elements
[INFO] Kmeans Cluster 12: 135 elements
[INFO] Kmeans Cluster 13: 214 elements
[INFO] Kmeans Cluster 14: 150 elements
[INFO] Kmeans Cluster 15: 222 elements
[INFO] Kmeans Cluster 16: 246 elements
[INFO] Kmeans Cluster 17: 180 elements
[INFO] Kmeans Cluster 18: 188 elements
[INFO] Kmeans Cluster 19: 216 elements
[INFO] Kmeans Cluster 20: 63 elements
[INFO] Kmeans Cluster 21: 84 elements
[INFO] Kmeans Cluster 22: 307 elements
[INFO] Kmeans Cluster 23: 206 elements
[INFO] Kmeans Cluster 24: 99 elements
[INFO] Kmeans Cluster 25: 160 elements
[INFO] Kmeans Cluster 26: 198 elements
[INFO] Kmeans Cluster 27: 148 elements
[INFO] Kmeans Cluster 28: 221 elements
[INFO] Kmeans Cluster 29: 214 elements
[INFO] Kmeans Cluster 30: 190 elements
[INFO] Kmeans Cluster 31: 85 elements
[INFO] Kmeans Cluster 32: 145 elements
[INFO] Kmeans Cluster 33: 105 elements
[INFO] Kmeans Cluster 34: 161 elements
[INFO] Kmeans Cluster 35: 352 elements
[INFO] Kmeans Cluster 36: 151 elements
[INFO] Kmeans Cluster 37: 82 elements
[INFO] Kmeans Cluster 38: 101 elements
[INFO] Kmeans Cluster 39: 189 elements
[INFO] Kmeans Cluster 40: 99 elements
[INFO] Kmeans Cluster 41: 259 elements
[INFO] Kmeans Cluster 42: 116 elements
[INFO] Kmeans Cluster 43: 255 elements
[INFO] Kmeans Cluster 44: 197 elements
[INFO] Kmeans Cluster 45: 108 elements
[INFO] Kmeans Cluster 46: 170 elements
[INFO] Kmeans Cluster 47: 212 elements
[INFO] Kmeans Cluster 48: 136 elements
[INFO] Kmeans Cluster 49: 126 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=21.16, Long SMA=113.83, Sharpe=0.1200
[INFO] Centroid 1: Short SMA=61.22, Long SMA=252.47, Sharpe=0.5736
[INFO] Centroid 2: Short SMA=137.90, Long SMA=213.33, Sharpe=0.3964
[INFO] Centroid 3: Short SMA=86.33, Long SMA=199.28, Sharpe=0.6793
[INFO] Centroid 4: Short SMA=72.19, Long SMA=108.89, Sharpe=0.4060
[INFO] Centroid 5: Short SMA=236.78, Long SMA=263.12, Sharpe=0.4966
[INFO] Centroid 6: Short SMA=254.40, Long SMA=286.56, Sharpe=0.2257
[INFO] Centroid 7: Short SMA=13.07, Long SMA=85.38, Sharpe=-0.1851
[INFO] Centroid 8: Short SMA=146.30, Long SMA=183.39, Sharpe=0.5183
[INFO] Centroid 9: Short SMA=206.25, Long SMA=233.29, Sharpe=0.4706
[INFO] Centroid 10: Short SMA=21.08, Long SMA=166.26, Sharpe=0.5012
[INFO] Centroid 11: Short SMA=78.25, Long SMA=159.72, Sharpe=0.5942
[INFO] Centroid 12: Short SMA=23.63, Long SMA=281.47, Sharpe=0.6054
[INFO] Centroid 13: Short SMA=47.47, Long SMA=77.62, Sharpe=0.1958
[INFO] Centroid 14: Short SMA=145.56, Long SMA=160.12, Sharpe=0.3480
[INFO] Centroid 15: Short SMA=104.32, Long SMA=174.92, Sharpe=0.7883
[INFO] Centroid 16: Short SMA=22.21, Long SMA=261.02, Sharpe=0.6866
[INFO] Centroid 17: Short SMA=62.53, Long SMA=203.40, Sharpe=0.5442
[INFO] Centroid 18: Short SMA=55.50, Long SMA=147.87, Sharpe=0.7319
[INFO] Centroid 19: Short SMA=184.69, Long SMA=204.71, Sharpe=0.3140
[INFO] Centroid 20: Short SMA=10.73, Long SMA=183.71, Sharpe=0.2185
[INFO] Centroid 21: Short SMA=15.55, Long SMA=34.00, Sharpe=-0.2957
[INFO] Centroid 22: Short SMA=102.86, Long SMA=137.49, Sharpe=0.6930
[INFO] Centroid 23: Short SMA=120.16, Long SMA=215.55, Sharpe=0.5170
[INFO] Centroid 24: Short SMA=195.82, Long SMA=225.11, Sharpe=0.5823
[INFO] Centroid 25: Short SMA=224.77, Long SMA=243.23, Sharpe=0.3828
[INFO] Centroid 26: Short SMA=35.48, Long SMA=151.89, Sharpe=0.6238
[INFO] Centroid 27: Short SMA=60.90, Long SMA=101.14, Sharpe=0.2871
[INFO] Centroid 28: Short SMA=196.30, Long SMA=256.99, Sharpe=0.4099
[INFO] Centroid 29: Short SMA=47.07, Long SMA=178.41, Sharpe=0.7484
[INFO] Centroid 30: Short SMA=162.15, Long SMA=192.98, Sharpe=0.4483
[INFO] Centroid 31: Short SMA=15.58, Long SMA=211.27, Sharpe=0.4234
[INFO] Centroid 32: Short SMA=32.44, Long SMA=234.15, Sharpe=0.7553
[INFO] Centroid 33: Short SMA=26.91, Long SMA=94.02, Sharpe=-0.0211
[INFO] Centroid 34: Short SMA=225.32, Long SMA=282.31, Sharpe=0.3957
[INFO] Centroid 35: Short SMA=52.65, Long SMA=285.40, Sharpe=0.4850
[INFO] Centroid 36: Short SMA=125.23, Long SMA=143.44, Sharpe=0.5485
[INFO] Centroid 37: Short SMA=21.41, Long SMA=130.07, Sharpe=0.3296
[INFO] Centroid 38: Short SMA=257.68, Long SMA=284.75, Sharpe=0.3164
[INFO] Centroid 39: Short SMA=87.01, Long SMA=113.13, Sharpe=0.5222
[INFO] Centroid 40: Short SMA=20.81, Long SMA=43.86, Sharpe=-0.0871
[INFO] Centroid 41: Short SMA=164.12, Long SMA=230.46, Sharpe=0.4910
[INFO] Centroid 42: Short SMA=40.71, Long SMA=61.17, Sharpe=0.3421
[INFO] Centroid 43: Short SMA=30.64, Long SMA=208.33, Sharpe=0.5963
[INFO] Centroid 44: Short SMA=44.23, Long SMA=120.17, Sharpe=0.5227
[INFO] Centroid 45: Short SMA=279.13, Long SMA=290.69, Sharpe=0.1830
[INFO] Centroid 46: Short SMA=35.75, Long SMA=63.24, Sharpe=0.0906
[INFO] Centroid 47: Short SMA=60.26, Long SMA=228.94, Sharpe=0.6565
[INFO] Centroid 48: Short SMA=123.28, Long SMA=182.15, Sharpe=0.6347
[INFO] Centroid 49: Short SMA=131.11, Long SMA=249.87, Sharpe=0.4118
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=112, Long SMA=174, Sharpe=0.9269, Trades=16
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=104, Long SMA=176, Sharpe=0.8646, Trades=14
[INFO] Kmeans Top 2: Short SMA=34, Long SMA=234, Sharpe=0.8457, Trades=16
[INFO] Kmeans Top 3: Short SMA=48, Long SMA=178, Sharpe=0.8336, Trades=12
[INFO] Kmeans Top 4: Short SMA=56, Long SMA=148, Sharpe=0.8154, Trades=14
[INFO] Kmeans Top 5: Short SMA=34, Long SMA=154, Sharpe=0.6959, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (21, 114)
[INFO]   Nearest: (22.0, 114.0)
[INFO]   Rounded: (61, 252)
[INFO]   Nearest: (62.0, 252.0)
[INFO]   Rounded: (138, 213)
[INFO]   Nearest: (138.0, 214.0)
[INFO]   Rounded: (86, 199)
[INFO]   Nearest: (86.0, 200.0)
[INFO]   Rounded: (72, 109)
[INFO]   Nearest: (72.0, 108.0)
[INFO]   Rounded: (237, 263)
[INFO]   Nearest: (236.0, 264.0)
[INFO]   Rounded: (254, 287)
[INFO]   Nearest: (254.0, 286.0)
[INFO]   Rounded: (13, 85)
[INFO]   Nearest: (14.0, 86.0)
[INFO]   Rounded: (146, 183)
[INFO]   Nearest: (146.0, 184.0)
[INFO]   Rounded: (206, 233)
[INFO]   Nearest: (206.0, 234.0)
[INFO]   Rounded: (21, 166)
[INFO]   Nearest: (22.0, 166.0)
[INFO]   Rounded: (78, 160)
[INFO]   Rounded: (24, 281)
[INFO]   Nearest: (24.0, 282.0)
[INFO]   Rounded: (47, 78)
[INFO]   Nearest: (48.0, 78.0)
[INFO]   Rounded: (146, 160)
[INFO]   Rounded: (104, 175)
[INFO]   Nearest: (104.0, 174.0)
[INFO]   Rounded: (22, 261)
[INFO]   Nearest: (22.0, 262.0)
[INFO]   Rounded: (63, 203)
[INFO]   Nearest: (62.0, 204.0)
[INFO]   Rounded: (56, 148)
[INFO]   Rounded: (185, 205)
[INFO]   Nearest: (184.0, 204.0)
[INFO]   Rounded: (11, 184)
[INFO]   Nearest: (10.0, 184.0)
[INFO]   Rounded: (16, 34)
[INFO]   Rounded: (103, 137)
[INFO]   Nearest: (102.0, 138.0)
[INFO]   Rounded: (120, 216)
[INFO]   Rounded: (196, 225)
[INFO]   Nearest: (196.0, 226.0)
[INFO]   Rounded: (225, 243)
[INFO]   Nearest: (224.0, 244.0)
[INFO]   Rounded: (35, 152)
[INFO]   Nearest: (36.0, 152.0)
[INFO]   Rounded: (61, 101)
[INFO]   Nearest: (60.0, 102.0)
[INFO]   Rounded: (196, 257)
[INFO]   Nearest: (196.0, 256.0)
[INFO]   Rounded: (47, 178)
[INFO]   Nearest: (48.0, 178.0)
[INFO]   Rounded: (162, 193)
[INFO]   Nearest: (162.0, 192.0)
[INFO]   Rounded: (16, 211)
[INFO]   Nearest: (16.0, 212.0)
[INFO]   Rounded: (32, 234)
[INFO]   Rounded: (27, 94)
[INFO]   Nearest: (26.0, 94.0)
[INFO]   Rounded: (225, 282)
[INFO]   Nearest: (226.0, 282.0)
[INFO]   Rounded: (53, 285)
[INFO]   Nearest: (52.0, 286.0)
[INFO]   Rounded: (125, 143)
[INFO]   Nearest: (126.0, 144.0)
[INFO]   Rounded: (21, 130)
[INFO]   Nearest: (22.0, 130.0)
[INFO]   Rounded: (258, 285)
[INFO]   Nearest: (258.0, 284.0)
[INFO]   Rounded: (87, 113)
[INFO]   Nearest: (88.0, 114.0)
[INFO]   Rounded: (21, 44)
[INFO]   Nearest: (20.0, 44.0)
[INFO]   Rounded: (164, 230)
[INFO]   Rounded: (41, 61)
[INFO]   Nearest: (40.0, 62.0)
[INFO]   Rounded: (31, 208)
[INFO]   Nearest: (30.0, 208.0)
[INFO]   Rounded: (44, 120)
[INFO]   Rounded: (279, 291)
[INFO]   Nearest: (280.0, 290.0)
[INFO]   Rounded: (36, 63)
[INFO]   Nearest: (36.0, 64.0)
[INFO]   Rounded: (60, 229)
[INFO]   Nearest: (60.0, 228.0)
[INFO]   Rounded: (123, 182)
[INFO]   Nearest: (124.0, 182.0)
[INFO]   Rounded: (131, 250)
[INFO]   Nearest: (132.0, 250.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 112, Long SMA: 174
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(104/176) - Original Sharpe: 0.8646, Trades: 14
[INFO] Kmeans cluster 2: SMA(34/234) - Original Sharpe: 0.8457, Trades: 16
[INFO] Kmeans cluster 3: SMA(48/178) - Original Sharpe: 0.8336, Trades: 12
[INFO] Kmeans cluster 4: SMA(56/148) - Original Sharpe: 0.8154, Trades: 14
[INFO] Kmeans cluster 5: SMA(34/154) - Original Sharpe: 0.6959, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (112/174)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (104/176) - Sharpe: 0.8646
[INFO] cluster 2: (34/234) - Sharpe: 0.8457
[INFO] cluster 3: (48/178) - Sharpe: 0.8336
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.848635           -1.266577
1    2021-11-14 2021-11-14            43     1.505824            1.505824
2    2022-01-14 2022-01-14            41    -4.150479           -6.638249
3    2022-03-14 2022-03-14            44    -0.356482           -3.531464
4    2022-05-14 2022-05-14            43     0.314844           -0.269513
5    2022-07-14 2022-07-14            44     2.699252           -1.368918
6    2022-09-14 2022-09-14            43     0.350844           -1.276693
7    2022-11-14 2022-11-14            43     3.719452            1.732588
8    2023-01-14 2023-01-14            41     2.654910            3.406412
9    2023-03-14 2023-03-14            43    -1.548584           -1.548584
10   2023-05-14 2023-05-14            44     3.059517            3.059517
11   2023-07-14 2023-07-14            44     0.609800            0.609800
12   2023-09-14 2023-09-14            43     4.868598            4.868598
13   2023-11-14 2023-11-14            42     0.159231            0.159231
14   2024-01-14 2024-01-14            43    -1.143094           -1.143094
15   2024-03-14 2024-03-14            42     1.807282            1.807282
16   2024-05-14 2024-05-14            44     0.086225            0.086225
17   2024-07-14 2024-07-14            45    -1.430493           -1.430493
18   2024-09-14 2024-09-14            43     1.688514           -0.360513
19   2024-11-14 2024-11-14            33    -3.034107           -3.406660
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.8 |             -1.3 |          1.5 | True          
[INFO] 2021-11-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -4.2 |             -6.6 |         -2.4 | False         
[INFO] 2022-03-14   |         -0.4 |             -3.5 |         -3.1 | False         
[INFO] 2022-05-14   |          0.3 |             -0.3 |         -0.6 | False         
[INFO] 2022-07-14   |          2.7 |             -1.4 |         -4.1 | False         
[INFO] 2022-09-14   |          0.4 |             -1.3 |         -1.7 | False         
[INFO] 2022-11-14   |          3.7 |              1.7 |         -2.0 | False         
[INFO] 2023-01-14   |          2.7 |              3.4 |          0.7 | True          
[INFO] 2023-03-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          4.9 |              4.9 |          0.0 | Excluded      
[INFO] 2023-11-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          1.7 |             -0.4 |         -2.1 | False         
[INFO] 2024-11-14   |         -3.0 |             -3.4 |         -0.4 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Kmeans cluster wins (rounded comparison): 2 of 10 periods (20.00% win rate)
[INFO] Updating Excel file with Kmeans results for PA...
[INFO] Excel file updated successfully. Added PA with Kmeans win rate 20.0% in row 39
[INFO] Added best Sharpe parameters 112/174 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 112, Long SMA: 174
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(104/176) - Original Sharpe: 0.8646
[INFO] Added cluster 2 to portfolio: SMA(34/234) - Original Sharpe: 0.8457
[INFO] Added cluster 3 to portfolio: SMA(48/178) - Original Sharpe: 0.8336
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'PA_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.4338
[INFO] Kmeans Best out-of-sample Sharpe: 0.2816
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for PA...
[INFO] Excel file updated successfully. Added PA with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PA
[INFO] Big Point Value: 100.0
[INFO] Slippage: 80.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5147 to 0.9269
[INFO] 
Best parameters:
[INFO] Short SMA: 112
[INFO] Long SMA: 174
[INFO] Sharpe Ratio: 0.926948
[INFO] Number of Trades: 16
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8657 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5147 to 0.9269
[INFO] Trades range: 10.0 to 338.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2463 to 2.7391
[INFO] Scaled Long SMA range: -2.6546 to 1.6587
[INFO] Scaled Sharpe ratio range: -4.6266 to 2.1322
[INFO] Scaled Trades range: -0.6520 to 13.4916
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8657 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5757
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 13 elements
[INFO] Cluster 1: 226 elements
[INFO] Cluster 2: 371 elements
[INFO] Cluster 3: 461 elements
[INFO] Cluster 4: 271 elements
[INFO] Cluster 5: 394 elements
[INFO] Cluster 6: 340 elements
[INFO] Cluster 7: 36 elements
[INFO] Cluster 8: 71 elements
[INFO] Cluster 9: 359 elements
[INFO] Cluster 10: 159 elements
[INFO] Cluster 11: 184 elements
[INFO] Cluster 12: 135 elements
[INFO] Cluster 13: 243 elements
[INFO] Cluster 14: 387 elements
[INFO] Cluster 15: 334 elements
[INFO] Cluster 16: 75 elements
[INFO] Cluster 17: 432 elements
[INFO] Cluster 18: 216 elements
[INFO] Cluster 19: 167 elements
[INFO] Cluster 20: 67 elements
[INFO] Cluster 21: 262 elements
[INFO] Cluster 22: 85 elements
[INFO] Cluster 23: 241 elements
[INFO] Cluster 24: 200 elements
[INFO] Cluster 25: 349 elements
[INFO] Cluster 26: 40 elements
[INFO] Cluster 27: 74 elements
[INFO] Cluster 28: 214 elements
[INFO] Cluster 29: 18 elements
[INFO] Cluster 30: 273 elements
[INFO] Cluster 31: 146 elements
[INFO] Cluster 32: 24 elements
[INFO] Cluster 33: 121 elements
[INFO] Cluster 34: 91 elements
[INFO] Cluster 35: 179 elements
[INFO] Cluster 36: 28 elements
[INFO] Cluster 37: 194 elements
[INFO] Cluster 38: 147 elements
[INFO] Cluster 39: 230 elements
[INFO] Cluster 40: 59 elements
[INFO] Cluster 41: 34 elements
[INFO] Cluster 42: 85 elements
[INFO] Cluster 43: 164 elements
[INFO] Cluster 44: 95 elements
[INFO] Cluster 45: 48 elements
[INFO] Cluster 46: 46 elements
[INFO] Cluster 47: 93 elements
[INFO] Cluster 48: 20 elements
[INFO] Cluster 49: 156 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 1 cluster: Short SMA=22, Long SMA=200, Sharpe=0.5665, Trades=20
[INFO] Cluster 2 cluster: Short SMA=26, Long SMA=242, Sharpe=0.6478, Trades=18
[INFO] Cluster 3 cluster: Short SMA=52, Long SMA=164, Sharpe=0.8329, Trades=14
[INFO] Cluster 4 cluster: Short SMA=132, Long SMA=228, Sharpe=0.3622, Trades=12
[INFO] Cluster 5 cluster: Short SMA=58, Long SMA=246, Sharpe=0.5595, Trades=11
[INFO] Cluster 6 cluster: Short SMA=154, Long SMA=182, Sharpe=0.4860, Trades=21
[INFO] Cluster 7 cluster: Short SMA=24, Long SMA=30, Sharpe=-0.2123, Trades=136
[INFO] Cluster 8 cluster: Short SMA=52, Long SMA=58, Sharpe=0.4209, Trades=91
[INFO] Cluster 9 cluster: Short SMA=228, Long SMA=274, Sharpe=0.4606, Trades=12
[INFO] Cluster 10 cluster: Short SMA=14, Long SMA=74, Sharpe=-0.1913, Trades=54
[INFO] Cluster 11 cluster: Short SMA=46, Long SMA=98, Sharpe=0.3282, Trades=35
[INFO] Cluster 12 cluster: Short SMA=106, Long SMA=124, Sharpe=0.6784, Trades=37
[INFO] Cluster 13 cluster: Short SMA=126, Long SMA=176, Sharpe=0.5200, Trades=16
[INFO] Cluster 14 cluster: Short SMA=84, Long SMA=198, Sharpe=0.7637, Trades=13
[INFO] Cluster 15 cluster: Short SMA=162, Long SMA=228, Sharpe=0.4092, Trades=10
[INFO] Cluster 16 cluster: Short SMA=30, Long SMA=52, Sharpe=0.1167, Trades=64
[INFO] Cluster 17 cluster: Short SMA=208, Long SMA=248, Sharpe=0.5116, Trades=13
[INFO] Cluster 18 cluster: Short SMA=256, Long SMA=288, Sharpe=0.1753, Trades=16
[INFO] Cluster 19 cluster: Short SMA=48, Long SMA=66, Sharpe=0.3383, Trades=55
[INFO] Cluster 20 cluster: Short SMA=16, Long SMA=38, Sharpe=-0.4073, Trades=94
[INFO] Cluster 21 cluster: Short SMA=32, Long SMA=90, Sharpe=0.0572, Trades=38
[INFO] Cluster 22 cluster: Short SMA=140, Long SMA=150, Sharpe=0.4752, Trades=51
[INFO] Cluster 23 cluster: Short SMA=46, Long SMA=122, Sharpe=0.6266, Trades=25
[INFO] Cluster 24 cluster: Short SMA=106, Long SMA=176, Sharpe=0.8639, Trades=14
[INFO] Cluster 25 cluster: Short SMA=54, Long SMA=286, Sharpe=0.5264, Trades=11
[INFO] Cluster 26 cluster: Short SMA=220, Long SMA=222, Sharpe=0.3329, Trades=56
[INFO] Cluster 27 cluster: Short SMA=10, Long SMA=178, Sharpe=0.2539, Trades=36
[INFO] Cluster 28 cluster: Short SMA=74, Long SMA=114, Sharpe=0.3427, Trades=29
[INFO] Cluster 30 cluster: Short SMA=102, Long SMA=144, Sharpe=0.7465, Trades=22
[INFO] Cluster 31 cluster: Short SMA=184, Long SMA=210, Sharpe=0.3522, Trades=16
[INFO] Cluster 32 cluster: Short SMA=60, Long SMA=62, Sharpe=0.3320, Trades=149
[INFO] Cluster 33 cluster: Short SMA=278, Long SMA=290, Sharpe=0.1694, Trades=26
[INFO] Cluster 34 cluster: Short SMA=236, Long SMA=242, Sharpe=0.4595, Trades=34
[INFO] Cluster 35 cluster: Short SMA=18, Long SMA=282, Sharpe=0.5515, Trades=18
[INFO] Cluster 36 cluster: Short SMA=120, Long SMA=122, Sharpe=0.4426, Trades=108
[INFO] Cluster 37 cluster: Short SMA=60, Long SMA=208, Sharpe=0.4662, Trades=15
[INFO] Cluster 38 cluster: Short SMA=80, Long SMA=156, Sharpe=0.5587, Trades=15
[INFO] Cluster 39 cluster: Short SMA=120, Long SMA=210, Sharpe=0.4580, Trades=13
[INFO] Cluster 40 cluster: Short SMA=142, Long SMA=148, Sharpe=0.2880, Trades=61
[INFO] Cluster 41 cluster: Short SMA=102, Long SMA=106, Sharpe=0.7068, Trades=71
[INFO] Cluster 42 cluster: Short SMA=26, Long SMA=96, Sharpe=-0.0888, Trades=38
[INFO] Cluster 43 cluster: Short SMA=28, Long SMA=154, Sharpe=0.6050, Trades=20
[INFO] Cluster 44 cluster: Short SMA=78, Long SMA=100, Sharpe=0.4269, Trades=41
[INFO] Cluster 45 cluster: Short SMA=186, Long SMA=194, Sharpe=0.2193, Trades=38
[INFO] Cluster 46 cluster: Short SMA=18, Long SMA=144, Sharpe=0.3793, Trades=34
[INFO] Cluster 47 cluster: Short SMA=196, Long SMA=226, Sharpe=0.5980, Trades=14
[INFO] Cluster 48 cluster: Short SMA=280, Long SMA=282, Sharpe=0.1625, Trades=54
[INFO] Cluster 49 cluster: Short SMA=38, Long SMA=196, Sharpe=0.6188, Trades=14
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=112, Long SMA=174, Sharpe=0.9269, Trades=16
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=106, Long SMA=176, Sharpe=0.8639, Trades=14
[INFO] Top 2: Short SMA=52, Long SMA=164, Sharpe=0.8329, Trades=14
[INFO] Top 3: Short SMA=84, Long SMA=198, Sharpe=0.7637, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 8626 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 112, Long SMA: 174
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(106/176) - Original Sharpe: 0.8639, Trades: 14
[INFO] Hierarchical cluster 2: SMA(52/164) - Original Sharpe: 0.8329, Trades: 14
[INFO] Hierarchical cluster 3: SMA(84/198) - Original Sharpe: 0.7637, Trades: 13
[INFO] Hierarchical cluster 4: SMA(102/144) - Original Sharpe: 0.7465, Trades: 22
[INFO] Hierarchical cluster 5: SMA(102/106) - Original Sharpe: 0.7068, Trades: 71
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (112/174)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (106/176) - Sharpe: 0.8639
[INFO] cluster 2: (52/164) - Sharpe: 0.8329
[INFO] cluster 3: (84/198) - Sharpe: 0.7637
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.848635           -1.971409
1    2021-11-14 2021-11-14            43     1.505824            1.505824
2    2022-01-14 2022-01-14            41    -4.150479           -5.734840
3    2022-03-14 2022-03-14            44    -0.356482           -1.923233
4    2022-05-14 2022-05-14            43     0.314844            0.098190
5    2022-07-14 2022-07-14            44     2.699252           -0.322790
6    2022-09-14 2022-09-14            43     0.350844            0.350844
7    2022-11-14 2022-11-14            43     3.719452            2.324357
8    2023-01-14 2023-01-14            41     2.654910            3.406412
9    2023-03-14 2023-03-14            43    -1.548584           -1.548584
10   2023-05-14 2023-05-14            44     3.059517            3.059517
11   2023-07-14 2023-07-14            44     0.609800            0.609800
12   2023-09-14 2023-09-14            43     4.868598            4.868598
13   2023-11-14 2023-11-14            42     0.159231            0.159231
14   2024-01-14 2024-01-14            43    -1.143094           -1.143094
15   2024-03-14 2024-03-14            42     1.807282            1.807282
16   2024-05-14 2024-05-14            44     0.086225            0.086225
17   2024-07-14 2024-07-14            45    -1.430493           -1.430493
18   2024-09-14 2024-09-14            43     1.688514           -0.929645
19   2024-11-14 2024-11-14            33    -3.034107           -3.027354
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.8 |             -2.0 |          0.8 | True          
[INFO] 2021-11-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -4.2 |             -5.7 |         -1.5 | False         
[INFO] 2022-03-14   |         -0.4 |             -1.9 |         -1.5 | False         
[INFO] 2022-05-14   |          0.3 |              0.1 |         -0.2 | False         
[INFO] 2022-07-14   |          2.7 |             -0.3 |         -3.0 | False         
[INFO] 2022-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |          3.7 |              2.3 |         -1.4 | False         
[INFO] 2023-01-14   |          2.7 |              3.4 |          0.7 | True          
[INFO] 2023-03-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          4.9 |              4.9 |          0.0 | Excluded      
[INFO] 2023-11-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          1.7 |             -0.9 |         -2.6 | False         
[INFO] 2024-11-14   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-09-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 8 periods (25.00% win rate)
[INFO] Updating Excel file with Hierarchical results for PA...
[INFO] Excel file updated successfully. Added PA with Hierarchical win rate 25.0% in row 39
[INFO] Added best Sharpe parameters 112/174 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 112, Long SMA: 174
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(106/176) - Original Sharpe: 0.8639
[INFO] Added cluster 2 to portfolio: SMA(52/164) - Original Sharpe: 0.8329
[INFO] Added cluster 3 to portfolio: SMA(84/198) - Original Sharpe: 0.7637
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'PA_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1063
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2816
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for PA...
[INFO] Excel file updated successfully. Added PA with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PA
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for PL in column D: 20.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 176.57s
[INFO] Best parameters: Short SMA = 122, Long SMA = 126
[INFO] Best Sharpe ratio: 0.489096, Trades: 97
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @PL
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 6.07 contracts
[INFO] Maximum Position Size: 11 contracts
[INFO] Strategy Total P&L: $256,175.00
[INFO] Market Buy & Hold P&L: $-30,695.00
[INFO] Outperformance: $286,870.00
[INFO] Sharpe ratio (entire period, annualized): 0.308659
[INFO] Sharpe ratio (in-sample, annualized): 0.489096
[INFO] Sharpe ratio (out-of-sample, annualized): -0.104550
[INFO] Maximum Drawdown: $174,145.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 55
[INFO] Out-of-sample period trades: 42
[INFO] Total trades: 97
[INFO] In-sample P&L: $254,115.00
[INFO] Out-of-sample P&L: $-23,720.00
[INFO] 
Best parameters from GA: Short SMA = 122, Long SMA = 126, Sharpe = 0.489096
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 20.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9850 to 0.4891
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 126
[INFO] Sharpe Ratio: 0.489096
[INFO] Number of Trades: 97
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9850 to 0.4891
[INFO] Trades range: 11.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.2033 to 3.3492
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 251 elements
[INFO] Kmeans Cluster 1: 305 elements
[INFO] Kmeans Cluster 2: 136 elements
[INFO] Kmeans Cluster 3: 225 elements
[INFO] Kmeans Cluster 4: 262 elements
[INFO] Kmeans Cluster 5: 148 elements
[INFO] Kmeans Cluster 6: 212 elements
[INFO] Kmeans Cluster 7: 213 elements
[INFO] Kmeans Cluster 8: 220 elements
[INFO] Kmeans Cluster 9: 287 elements
[INFO] Kmeans Cluster 10: 257 elements
[INFO] Kmeans Cluster 11: 217 elements
[INFO] Kmeans Cluster 12: 184 elements
[INFO] Kmeans Cluster 13: 357 elements
[INFO] Kmeans Cluster 14: 112 elements
[INFO] Kmeans Cluster 15: 356 elements
[INFO] Kmeans Cluster 16: 233 elements
[INFO] Kmeans Cluster 17: 170 elements
[INFO] Kmeans Cluster 18: 296 elements
[INFO] Kmeans Cluster 19: 217 elements
[INFO] Kmeans Cluster 20: 174 elements
[INFO] Kmeans Cluster 21: 280 elements
[INFO] Kmeans Cluster 22: 246 elements
[INFO] Kmeans Cluster 23: 249 elements
[INFO] Kmeans Cluster 24: 263 elements
[INFO] Kmeans Cluster 25: 198 elements
[INFO] Kmeans Cluster 26: 145 elements
[INFO] Kmeans Cluster 27: 77 elements
[INFO] Kmeans Cluster 28: 179 elements
[INFO] Kmeans Cluster 29: 271 elements
[INFO] Kmeans Cluster 30: 246 elements
[INFO] Kmeans Cluster 31: 305 elements
[INFO] Kmeans Cluster 32: 160 elements
[INFO] Kmeans Cluster 33: 161 elements
[INFO] Kmeans Cluster 34: 191 elements
[INFO] Kmeans Cluster 35: 222 elements
[INFO] Kmeans Cluster 36: 198 elements
[INFO] Kmeans Cluster 37: 192 elements
[INFO] Kmeans Cluster 38: 260 elements
[INFO] Kmeans Cluster 39: 134 elements
[INFO] Kmeans Cluster 40: 117 elements
[INFO] Kmeans Cluster 41: 143 elements
[INFO] Kmeans Cluster 42: 301 elements
[INFO] Kmeans Cluster 43: 264 elements
[INFO] Kmeans Cluster 44: 162 elements
[INFO] Kmeans Cluster 45: 138 elements
[INFO] Kmeans Cluster 46: 288 elements
[INFO] Kmeans Cluster 47: 74 elements
[INFO] Kmeans Cluster 48: 163 elements
[INFO] Kmeans Cluster 49: 126 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=84.25, Long SMA=175.45, Sharpe=-0.4215
[INFO] Centroid 1: Short SMA=127.76, Long SMA=220.58, Sharpe=-0.1355
[INFO] Centroid 2: Short SMA=20.74, Long SMA=112.54, Sharpe=0.1050
[INFO] Centroid 3: Short SMA=44.92, Long SMA=241.21, Sharpe=-0.3985
[INFO] Centroid 4: Short SMA=179.39, Long SMA=217.08, Sharpe=-0.6588
[INFO] Centroid 5: Short SMA=257.42, Long SMA=283.30, Sharpe=-0.0490
[INFO] Centroid 6: Short SMA=24.26, Long SMA=142.08, Sharpe=-0.1201
[INFO] Centroid 7: Short SMA=128.03, Long SMA=158.44, Sharpe=0.0770
[INFO] Centroid 8: Short SMA=224.55, Long SMA=251.46, Sharpe=-0.2855
[INFO] Centroid 9: Short SMA=64.25, Long SMA=116.77, Sharpe=-0.4828
[INFO] Centroid 10: Short SMA=120.06, Long SMA=255.71, Sharpe=0.0037
[INFO] Centroid 11: Short SMA=104.20, Long SMA=207.39, Sharpe=-0.2604
[INFO] Centroid 12: Short SMA=40.76, Long SMA=87.14, Sharpe=-0.2333
[INFO] Centroid 13: Short SMA=129.69, Long SMA=178.08, Sharpe=-0.0801
[INFO] Centroid 14: Short SMA=14.88, Long SMA=268.05, Sharpe=-0.3199
[INFO] Centroid 15: Short SMA=175.70, Long SMA=282.20, Sharpe=-0.3818
[INFO] Centroid 16: Short SMA=60.59, Long SMA=106.27, Sharpe=-0.6460
[INFO] Centroid 17: Short SMA=29.38, Long SMA=279.86, Sharpe=-0.6150
[INFO] Centroid 18: Short SMA=76.55, Long SMA=223.47, Sharpe=-0.4339
[INFO] Centroid 19: Short SMA=19.14, Long SMA=177.45, Sharpe=0.0237
[INFO] Centroid 20: Short SMA=26.87, Long SMA=53.21, Sharpe=-0.0097
[INFO] Centroid 21: Short SMA=64.62, Long SMA=285.95, Sharpe=-0.3814
[INFO] Centroid 22: Short SMA=51.67, Long SMA=157.15, Sharpe=-0.2914
[INFO] Centroid 23: Short SMA=179.03, Long SMA=245.94, Sharpe=-0.5303
[INFO] Centroid 24: Short SMA=71.94, Long SMA=257.35, Sharpe=-0.5017
[INFO] Centroid 25: Short SMA=153.20, Long SMA=241.25, Sharpe=-0.3379
[INFO] Centroid 26: Short SMA=123.82, Long SMA=140.39, Sharpe=0.2565
[INFO] Centroid 27: Short SMA=279.77, Long SMA=292.73, Sharpe=-0.2769
[INFO] Centroid 28: Short SMA=254.60, Long SMA=283.03, Sharpe=0.1130
[INFO] Centroid 29: Short SMA=46.17, Long SMA=182.34, Sharpe=-0.1534
[INFO] Centroid 30: Short SMA=216.57, Long SMA=285.93, Sharpe=-0.0306
[INFO] Centroid 31: Short SMA=218.73, Long SMA=256.50, Sharpe=-0.1510
[INFO] Centroid 32: Short SMA=164.89, Long SMA=199.22, Sharpe=-0.4817
[INFO] Centroid 33: Short SMA=24.30, Long SMA=92.56, Sharpe=-0.0562
[INFO] Centroid 34: Short SMA=80.49, Long SMA=202.70, Sharpe=-0.5783
[INFO] Centroid 35: Short SMA=35.15, Long SMA=272.42, Sharpe=-0.4921
[INFO] Centroid 36: Short SMA=95.98, Long SMA=264.28, Sharpe=-0.1897
[INFO] Centroid 37: Short SMA=89.08, Long SMA=136.55, Sharpe=-0.1812
[INFO] Centroid 38: Short SMA=113.18, Long SMA=284.51, Sharpe=-0.0590
[INFO] Centroid 39: Short SMA=178.58, Long SMA=202.10, Sharpe=-0.8404
[INFO] Centroid 40: Short SMA=103.74, Long SMA=131.32, Sharpe=-0.0170
[INFO] Centroid 41: Short SMA=149.11, Long SMA=188.03, Sharpe=-0.2437
[INFO] Centroid 42: Short SMA=36.24, Long SMA=212.39, Sharpe=-0.2876
[INFO] Centroid 43: Short SMA=82.67, Long SMA=124.15, Sharpe=-0.3353
[INFO] Centroid 44: Short SMA=44.89, Long SMA=71.73, Sharpe=-0.3622
[INFO] Centroid 45: Short SMA=23.28, Long SMA=46.16, Sharpe=-0.1629
[INFO] Centroid 46: Short SMA=143.81, Long SMA=277.86, Sharpe=-0.2237
[INFO] Centroid 47: Short SMA=27.57, Long SMA=45.03, Sharpe=0.1378
[INFO] Centroid 48: Short SMA=210.61, Long SMA=237.88, Sharpe=-0.4215
[INFO] Centroid 49: Short SMA=15.48, Long SMA=224.22, Sharpe=-0.1274
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=126, Sharpe=0.4891, Trades=97
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=122, Long SMA=140, Sharpe=0.2286, Trades=49
[INFO] Kmeans Top 2: Short SMA=20, Long SMA=114, Sharpe=0.2089, Trades=38
[INFO] Kmeans Top 3: Short SMA=256, Long SMA=284, Sharpe=0.1327, Trades=28
[INFO] Kmeans Top 4: Short SMA=18, Long SMA=176, Sharpe=0.1222, Trades=28
[INFO] Kmeans Top 5: Short SMA=26, Long SMA=46, Sharpe=0.0968, Trades=72
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (84, 175)
[INFO]   Nearest: (84.0, 176.0)
[INFO]   Rounded: (128, 221)
[INFO]   Nearest: (128.0, 220.0)
[INFO]   Rounded: (21, 113)
[INFO]   Nearest: (20.0, 112.0)
[INFO]   Rounded: (45, 241)
[INFO]   Nearest: (44.0, 242.0)
[INFO]   Rounded: (179, 217)
[INFO]   Nearest: (180.0, 218.0)
[INFO]   Rounded: (257, 283)
[INFO]   Nearest: (258.0, 284.0)
[INFO]   Rounded: (24, 142)
[INFO]   Rounded: (128, 158)
[INFO]   Rounded: (225, 251)
[INFO]   Nearest: (224.0, 252.0)
[INFO]   Rounded: (64, 117)
[INFO]   Nearest: (64.0, 116.0)
[INFO]   Rounded: (120, 256)
[INFO]   Rounded: (104, 207)
[INFO]   Nearest: (104.0, 208.0)
[INFO]   Rounded: (41, 87)
[INFO]   Nearest: (40.0, 88.0)
[INFO]   Rounded: (130, 178)
[INFO]   Rounded: (15, 268)
[INFO]   Nearest: (14.0, 268.0)
[INFO]   Rounded: (176, 282)
[INFO]   Rounded: (61, 106)
[INFO]   Nearest: (60.0, 106.0)
[INFO]   Rounded: (29, 280)
[INFO]   Nearest: (30.0, 280.0)
[INFO]   Rounded: (77, 223)
[INFO]   Nearest: (76.0, 224.0)
[INFO]   Rounded: (19, 177)
[INFO]   Nearest: (20.0, 178.0)
[INFO]   Rounded: (27, 53)
[INFO]   Nearest: (26.0, 54.0)
[INFO]   Rounded: (65, 286)
[INFO]   Nearest: (64.0, 286.0)
[INFO]   Rounded: (52, 157)
[INFO]   Nearest: (52.0, 158.0)
[INFO]   Rounded: (179, 246)
[INFO]   Nearest: (180.0, 246.0)
[INFO]   Rounded: (72, 257)
[INFO]   Nearest: (72.0, 258.0)
[INFO]   Rounded: (153, 241)
[INFO]   Nearest: (154.0, 242.0)
[INFO]   Rounded: (124, 140)
[INFO]   Rounded: (280, 293)
[INFO]   Nearest: (280.0, 292.0)
[INFO]   Rounded: (255, 283)
[INFO]   Nearest: (254.0, 284.0)
[INFO]   Rounded: (46, 182)
[INFO]   Rounded: (217, 286)
[INFO]   Nearest: (216.0, 286.0)
[INFO]   Rounded: (219, 257)
[INFO]   Nearest: (218.0, 256.0)
[INFO]   Rounded: (165, 199)
[INFO]   Nearest: (164.0, 200.0)
[INFO]   Rounded: (24, 93)
[INFO]   Nearest: (24.0, 92.0)
[INFO]   Rounded: (80, 203)
[INFO]   Nearest: (80.0, 202.0)
[INFO]   Rounded: (35, 272)
[INFO]   Nearest: (36.0, 272.0)
[INFO]   Rounded: (96, 264)
[INFO]   Rounded: (89, 137)
[INFO]   Nearest: (90.0, 136.0)
[INFO]   Rounded: (113, 285)
[INFO]   Nearest: (114.0, 284.0)
[INFO]   Rounded: (179, 202)
[INFO]   Nearest: (178.0, 202.0)
[INFO]   Rounded: (104, 131)
[INFO]   Nearest: (104.0, 132.0)
[INFO]   Rounded: (149, 188)
[INFO]   Nearest: (150.0, 188.0)
[INFO]   Rounded: (36, 212)
[INFO]   Rounded: (83, 124)
[INFO]   Nearest: (82.0, 124.0)
[INFO]   Rounded: (45, 72)
[INFO]   Nearest: (44.0, 72.0)
[INFO]   Rounded: (23, 46)
[INFO]   Nearest: (24.0, 46.0)
[INFO]   Rounded: (144, 278)
[INFO]   Rounded: (28, 45)
[INFO]   Nearest: (28.0, 46.0)
[INFO]   Rounded: (211, 238)
[INFO]   Nearest: (210.0, 238.0)
[INFO]   Rounded: (15, 224)
[INFO]   Nearest: (16.0, 224.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 126
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] File size: 288521 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(122/140) - Original Sharpe: 0.2286, Trades: 49
[INFO] Kmeans cluster 2: SMA(20/114) - Original Sharpe: 0.2089, Trades: 38
[INFO] Kmeans cluster 3: SMA(256/284) - Original Sharpe: 0.1327, Trades: 28
[INFO] Kmeans cluster 4: SMA(18/176) - Original Sharpe: 0.1222, Trades: 28
[INFO] Kmeans cluster 5: SMA(26/46) - Original Sharpe: 0.0968, Trades: 72
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/126)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (122/140) - Sharpe: 0.2286
[INFO] cluster 2: (20/114) - Sharpe: 0.2089
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] File size: 288521 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.390225           -1.936513
1    2021-11-14 2021-11-14            43     2.404429           -1.284561
2    2022-01-14 2022-01-14            41     1.324381           -0.302751
3    2022-03-14 2022-03-14            44    -0.555883           -1.003702
4    2022-05-14 2022-05-14            43    -0.825815           -1.661737
5    2022-07-14 2022-07-14            44    -0.988424           -1.284684
6    2022-09-14 2022-09-14            43    -3.137421           -1.421497
7    2022-11-14 2022-11-14            43     0.541975            1.596617
8    2023-01-14 2023-01-14            41    -0.915581           -3.901921
9    2023-03-14 2023-03-14            43     0.468407           -0.983402
10   2023-05-14 2023-05-14            44    -0.475481           -2.765804
11   2023-07-14 2023-07-14            44    -0.395339            3.855833
12   2023-09-14 2023-09-14            43     0.952901            2.094884
13   2023-11-14 2023-11-14            42    -0.229236           -3.379086
14   2024-01-14 2024-01-14            43    -2.215671           -0.727375
15   2024-03-14 2024-03-14            42     1.536450            0.984876
16   2024-05-14 2024-05-14            44     0.589741           -0.991275
17   2024-07-14 2024-07-14            45    -0.019681           -2.443039
18   2024-09-14 2024-09-14            43     2.214737           -1.070588
19   2024-11-14 2024-11-14            33     1.167163            3.030917
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.4 |             -1.9 |          0.5 | True          
[INFO] 2021-11-14   |          2.4 |             -1.3 |         -3.7 | False         
[INFO] 2022-01-14   |          1.3 |             -0.3 |         -1.6 | False         
[INFO] 2022-03-14   |         -0.6 |             -1.0 |         -0.4 | False         
[INFO] 2022-05-14   |         -0.8 |             -1.7 |         -0.9 | False         
[INFO] 2022-07-14   |         -1.0 |             -1.3 |         -0.3 | False         
[INFO] 2022-09-14   |         -3.1 |             -1.4 |          1.7 | True          
[INFO] 2022-11-14   |          0.5 |              1.6 |          1.1 | True          
[INFO] 2023-01-14   |         -0.9 |             -3.9 |         -3.0 | False         
[INFO] 2023-03-14   |          0.5 |             -1.0 |         -1.5 | False         
[INFO] 2023-05-14   |         -0.5 |             -2.8 |         -2.3 | False         
[INFO] 2023-07-14   |         -0.4 |              3.9 |          4.3 | True          
[INFO] 2023-09-14   |          1.0 |              2.1 |          1.1 | True          
[INFO] 2023-11-14   |         -0.2 |             -3.4 |         -3.2 | False         
[INFO] 2024-01-14   |         -2.2 |             -0.7 |          1.5 | True          
[INFO] 2024-03-14   |          1.5 |              1.0 |         -0.5 | False         
[INFO] 2024-05-14   |          0.6 |             -1.0 |         -1.6 | False         
[INFO] 2024-07-14   |         -0.0 |             -2.4 |         -2.4 | False         
[INFO] 2024-09-14   |          2.2 |             -1.1 |         -3.3 | False         
[INFO] 2024-11-14   |          1.2 |              3.0 |          1.8 | True          
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 7 of 20 periods (35.00% win rate)
[INFO] Updating Excel file with Kmeans results for PL...
[INFO] Excel file updated successfully. Added PL with Kmeans win rate 35.0% in row 40
[INFO] Added best Sharpe parameters 122/126 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 126
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(122/140) - Original Sharpe: 0.2286
[INFO] Added cluster 2 to portfolio: SMA(20/114) - Original Sharpe: 0.2089
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'PL_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.6503
[INFO] Kmeans Best out-of-sample Sharpe: -0.1046
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for PL...
[INFO] Excel file updated successfully. Added PL with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PL
[INFO] Big Point Value: 50.0
[INFO] Slippage: 20.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9850 to 0.4891
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 126
[INFO] Sharpe Ratio: 0.489096
[INFO] Number of Trades: 97
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9850 to 0.4891
[INFO] Trades range: 11.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.2033 to 3.3492
[INFO] Scaled Trades range: -0.9147 to 14.1485
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5795
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 312 elements
[INFO] Cluster 1: 171 elements
[INFO] Cluster 2: 616 elements
[INFO] Cluster 3: 385 elements
[INFO] Cluster 4: 479 elements
[INFO] Cluster 5: 244 elements
[INFO] Cluster 6: 33 elements
[INFO] Cluster 7: 359 elements
[INFO] Cluster 8: 274 elements
[INFO] Cluster 9: 238 elements
[INFO] Cluster 10: 150 elements
[INFO] Cluster 11: 54 elements
[INFO] Cluster 12: 148 elements
[INFO] Cluster 13: 64 elements
[INFO] Cluster 14: 378 elements
[INFO] Cluster 15: 73 elements
[INFO] Cluster 16: 71 elements
[INFO] Cluster 17: 33 elements
[INFO] Cluster 18: 406 elements
[INFO] Cluster 19: 281 elements
[INFO] Cluster 20: 260 elements
[INFO] Cluster 21: 247 elements
[INFO] Cluster 22: 157 elements
[INFO] Cluster 23: 441 elements
[INFO] Cluster 24: 135 elements
[INFO] Cluster 25: 426 elements
[INFO] Cluster 26: 273 elements
[INFO] Cluster 27: 299 elements
[INFO] Cluster 28: 356 elements
[INFO] Cluster 29: 228 elements
[INFO] Cluster 30: 126 elements
[INFO] Cluster 31: 6 elements
[INFO] Cluster 32: 37 elements
[INFO] Cluster 33: 217 elements
[INFO] Cluster 34: 182 elements
[INFO] Cluster 35: 215 elements
[INFO] Cluster 36: 123 elements
[INFO] Cluster 37: 192 elements
[INFO] Cluster 38: 42 elements
[INFO] Cluster 39: 195 elements
[INFO] Cluster 40: 259 elements
[INFO] Cluster 41: 34 elements
[INFO] Cluster 42: 262 elements
[INFO] Cluster 43: 153 elements
[INFO] Cluster 44: 184 elements
[INFO] Cluster 45: 40 elements
[INFO] Cluster 46: 143 elements
[INFO] Cluster 47: 89 elements
[INFO] Cluster 48: 274 elements
[INFO] Cluster 49: 221 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=26, Long SMA=80, Sharpe=-0.2037, Trades=44
[INFO] Cluster 1 cluster: Short SMA=164, Long SMA=194, Sharpe=-0.6285, Trades=39
[INFO] Cluster 2 cluster: Short SMA=172, Long SMA=274, Sharpe=-0.5194, Trades=13
[INFO] Cluster 3 cluster: Short SMA=76, Long SMA=216, Sharpe=-0.6215, Trades=22
[INFO] Cluster 4 cluster: Short SMA=126, Long SMA=206, Sharpe=-0.1477, Trades=20
[INFO] Cluster 5 cluster: Short SMA=18, Long SMA=190, Sharpe=0.0540, Trades=34
[INFO] Cluster 6 cluster: Short SMA=30, Long SMA=32, Sharpe=-0.0852, Trades=186
[INFO] Cluster 7 cluster: Short SMA=34, Long SMA=192, Sharpe=-0.2864, Trades=24
[INFO] Cluster 8 cluster: Short SMA=56, Long SMA=112, Sharpe=-0.7207, Trades=34
[INFO] Cluster 9 cluster: Short SMA=84, Long SMA=134, Sharpe=-0.2490, Trades=30
[INFO] Cluster 10 cluster: Short SMA=180, Long SMA=200, Sharpe=-0.8905, Trades=43
[INFO] Cluster 11 cluster: Short SMA=80, Long SMA=86, Sharpe=-0.5097, Trades=87
[INFO] Cluster 12 cluster: Short SMA=272, Long SMA=284, Sharpe=0.0523, Trades=45
[INFO] Cluster 13 cluster: Short SMA=106, Long SMA=114, Sharpe=-0.1456, Trades=68
[INFO] Cluster 14 cluster: Short SMA=40, Long SMA=224, Sharpe=-0.2958, Trades=24
[INFO] Cluster 15 cluster: Short SMA=26, Long SMA=34, Sharpe=-0.0893, Trades=102
[INFO] Cluster 16 cluster: Short SMA=236, Long SMA=240, Sharpe=-0.2128, Trades=83
[INFO] Cluster 17 cluster: Short SMA=134, Long SMA=136, Sharpe=0.0653, Trades=129
[INFO] Cluster 18 cluster: Short SMA=60, Long SMA=266, Sharpe=-0.5358, Trades=20
[INFO] Cluster 19 cluster: Short SMA=122, Long SMA=204, Sharpe=-0.0996, Trades=20
[INFO] Cluster 20 cluster: Short SMA=218, Long SMA=248, Sharpe=-0.3160, Trades=31
[INFO] Cluster 21 cluster: Short SMA=132, Long SMA=166, Sharpe=0.0122, Trades=36
[INFO] Cluster 22 cluster: Short SMA=26, Long SMA=44, Sharpe=-0.1448, Trades=78
[INFO] Cluster 23 cluster: Short SMA=74, Long SMA=128, Sharpe=-0.4180, Trades=33
[INFO] Cluster 24 cluster: Short SMA=120, Long SMA=134, Sharpe=0.1051, Trades=53
[INFO] Cluster 25 cluster: Short SMA=116, Long SMA=268, Sharpe=-0.0501, Trades=16
[INFO] Cluster 26 cluster: Short SMA=68, Long SMA=288, Sharpe=-0.3671, Trades=18
[INFO] Cluster 27 cluster: Short SMA=78, Long SMA=184, Sharpe=-0.4580, Trades=20
[INFO] Cluster 28 cluster: Short SMA=182, Long SMA=234, Sharpe=-0.6989, Trades=23
[INFO] Cluster 29 cluster: Short SMA=20, Long SMA=142, Sharpe=-0.1463, Trades=36
[INFO] Cluster 30 cluster: Short SMA=256, Long SMA=286, Sharpe=0.1131, Trades=28
[INFO] Cluster 32 cluster: Short SMA=196, Long SMA=198, Sharpe=-0.7240, Trades=113
[INFO] Cluster 33 cluster: Short SMA=98, Long SMA=260, Sharpe=-0.0758, Trades=14
[INFO] Cluster 34 cluster: Short SMA=40, Long SMA=74, Sharpe=-0.2633, Trades=48
[INFO] Cluster 35 cluster: Short SMA=90, Long SMA=228, Sharpe=-0.4460, Trades=18
[INFO] Cluster 36 cluster: Short SMA=20, Long SMA=112, Sharpe=0.1920, Trades=40
[INFO] Cluster 37 cluster: Short SMA=18, Long SMA=264, Sharpe=-0.3988, Trades=30
[INFO] Cluster 38 cluster: Short SMA=256, Long SMA=258, Sharpe=-0.1841, Trades=110
[INFO] Cluster 39 cluster: Short SMA=28, Long SMA=280, Sharpe=-0.6239, Trades=26
[INFO] Cluster 40 cluster: Short SMA=222, Long SMA=286, Sharpe=0.0187, Trades=15
[INFO] Cluster 41 cluster: Short SMA=36, Long SMA=40, Sharpe=-0.0476, Trades=132
[INFO] Cluster 42 cluster: Short SMA=52, Long SMA=164, Sharpe=-0.2323, Trades=24
[INFO] Cluster 43 cluster: Short SMA=224, Long SMA=240, Sharpe=-0.1494, Trades=45
[INFO] Cluster 44 cluster: Short SMA=130, Long SMA=162, Sharpe=0.0573, Trades=36
[INFO] Cluster 45 cluster: Short SMA=128, Long SMA=134, Sharpe=0.0496, Trades=89
[INFO] Cluster 46 cluster: Short SMA=158, Long SMA=234, Sharpe=-0.4870, Trades=17
[INFO] Cluster 47 cluster: Short SMA=70, Long SMA=84, Sharpe=-0.5669, Trades=55
[INFO] Cluster 48 cluster: Short SMA=138, Long SMA=284, Sharpe=-0.2238, Trades=12
[INFO] Cluster 49 cluster: Short SMA=212, Long SMA=274, Sharpe=-0.1171, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=126, Sharpe=0.4891, Trades=97
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=20, Long SMA=112, Sharpe=0.1920, Trades=40
[INFO] Top 2: Short SMA=256, Long SMA=286, Sharpe=0.1131, Trades=28
[INFO] Top 3: Short SMA=120, Long SMA=134, Sharpe=0.1051, Trades=53
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10579 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 126
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] File size: 288521 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(20/112) - Original Sharpe: 0.1920, Trades: 40
[INFO] Hierarchical cluster 2: SMA(256/286) - Original Sharpe: 0.1131, Trades: 28
[INFO] Hierarchical cluster 3: SMA(120/134) - Original Sharpe: 0.1051, Trades: 53
[INFO] Hierarchical cluster 4: SMA(134/136) - Original Sharpe: 0.0653, Trades: 129
[INFO] Hierarchical cluster 5: SMA(130/162) - Original Sharpe: 0.0573, Trades: 36
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/126)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 126
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PL
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for RB in column D: 22.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 117.19s
[INFO] Best parameters: Short SMA = 42, Long SMA = 50
[INFO] Best Sharpe ratio: 0.800794, Trades: 96
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @RB
[INFO] Big Point Value (from data): 42000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.08 contracts
[INFO] Maximum Position Size: 5 contracts
[INFO] Strategy Total P&L: $291,724.40
[INFO] Market Buy & Hold P&L: $61,933.20
[INFO] Outperformance: $229,791.20
[INFO] Sharpe ratio (entire period, annualized): 0.421463
[INFO] Sharpe ratio (in-sample, annualized): 0.800794
[INFO] Sharpe ratio (out-of-sample, annualized): -0.404535
[INFO] Maximum Drawdown: $177,916.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 68
[INFO] Out-of-sample period trades: 28
[INFO] Total trades: 96
[INFO] In-sample P&L: $477,036.20
[INFO] Out-of-sample P&L: $-110,507.20
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 50, Sharpe = 0.800794
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.0498 to 0.8008
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.800794
[INFO] Number of Trades: 96
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.0498 to 0.8008
[INFO] Trades range: 10.0 to 319.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8627 to 2.8926
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 207 elements
[INFO] Kmeans Cluster 1: 222 elements
[INFO] Kmeans Cluster 2: 236 elements
[INFO] Kmeans Cluster 3: 214 elements
[INFO] Kmeans Cluster 4: 220 elements
[INFO] Kmeans Cluster 5: 180 elements
[INFO] Kmeans Cluster 6: 138 elements
[INFO] Kmeans Cluster 7: 204 elements
[INFO] Kmeans Cluster 8: 205 elements
[INFO] Kmeans Cluster 9: 113 elements
[INFO] Kmeans Cluster 10: 241 elements
[INFO] Kmeans Cluster 11: 402 elements
[INFO] Kmeans Cluster 12: 244 elements
[INFO] Kmeans Cluster 13: 302 elements
[INFO] Kmeans Cluster 14: 213 elements
[INFO] Kmeans Cluster 15: 290 elements
[INFO] Kmeans Cluster 16: 214 elements
[INFO] Kmeans Cluster 17: 240 elements
[INFO] Kmeans Cluster 18: 166 elements
[INFO] Kmeans Cluster 19: 257 elements
[INFO] Kmeans Cluster 20: 58 elements
[INFO] Kmeans Cluster 21: 260 elements
[INFO] Kmeans Cluster 22: 228 elements
[INFO] Kmeans Cluster 23: 269 elements
[INFO] Kmeans Cluster 24: 249 elements
[INFO] Kmeans Cluster 25: 304 elements
[INFO] Kmeans Cluster 26: 168 elements
[INFO] Kmeans Cluster 27: 176 elements
[INFO] Kmeans Cluster 28: 223 elements
[INFO] Kmeans Cluster 29: 274 elements
[INFO] Kmeans Cluster 30: 140 elements
[INFO] Kmeans Cluster 31: 99 elements
[INFO] Kmeans Cluster 32: 238 elements
[INFO] Kmeans Cluster 33: 181 elements
[INFO] Kmeans Cluster 34: 113 elements
[INFO] Kmeans Cluster 35: 173 elements
[INFO] Kmeans Cluster 36: 275 elements
[INFO] Kmeans Cluster 37: 143 elements
[INFO] Kmeans Cluster 38: 215 elements
[INFO] Kmeans Cluster 39: 195 elements
[INFO] Kmeans Cluster 40: 177 elements
[INFO] Kmeans Cluster 41: 185 elements
[INFO] Kmeans Cluster 42: 405 elements
[INFO] Kmeans Cluster 43: 265 elements
[INFO] Kmeans Cluster 44: 129 elements
[INFO] Kmeans Cluster 45: 230 elements
[INFO] Kmeans Cluster 46: 206 elements
[INFO] Kmeans Cluster 47: 212 elements
[INFO] Kmeans Cluster 48: 167 elements
[INFO] Kmeans Cluster 49: 120 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=37.08, Long SMA=241.98, Sharpe=0.1734
[INFO] Centroid 1: Short SMA=143.59, Long SMA=254.37, Sharpe=-0.1489
[INFO] Centroid 2: Short SMA=85.20, Long SMA=153.71, Sharpe=-0.4145
[INFO] Centroid 3: Short SMA=66.78, Long SMA=85.80, Sharpe=0.3256
[INFO] Centroid 4: Short SMA=127.07, Long SMA=289.55, Sharpe=-0.7092
[INFO] Centroid 5: Short SMA=54.67, Long SMA=209.02, Sharpe=-0.1474
[INFO] Centroid 6: Short SMA=179.86, Long SMA=199.49, Sharpe=-0.2404
[INFO] Centroid 7: Short SMA=253.35, Long SMA=278.90, Sharpe=-0.7420
[INFO] Centroid 8: Short SMA=29.08, Long SMA=137.80, Sharpe=0.2317
[INFO] Centroid 9: Short SMA=13.77, Long SMA=275.65, Sharpe=-0.0907
[INFO] Centroid 10: Short SMA=158.71, Long SMA=222.29, Sharpe=0.1382
[INFO] Centroid 11: Short SMA=71.24, Long SMA=247.24, Sharpe=-0.0020
[INFO] Centroid 12: Short SMA=68.69, Long SMA=106.24, Sharpe=0.1254
[INFO] Centroid 13: Short SMA=219.89, Long SMA=246.45, Sharpe=-0.2010
[INFO] Centroid 14: Short SMA=108.77, Long SMA=252.35, Sharpe=-0.2459
[INFO] Centroid 15: Short SMA=101.72, Long SMA=129.23, Sharpe=-0.1852
[INFO] Centroid 16: Short SMA=196.64, Long SMA=219.11, Sharpe=0.0427
[INFO] Centroid 17: Short SMA=29.50, Long SMA=63.86, Sharpe=0.4181
[INFO] Centroid 18: Short SMA=37.41, Long SMA=278.53, Sharpe=0.0533
[INFO] Centroid 19: Short SMA=168.41, Long SMA=286.72, Sharpe=-0.4734
[INFO] Centroid 20: Short SMA=22.55, Long SMA=36.34, Sharpe=-0.0670
[INFO] Centroid 21: Short SMA=102.22, Long SMA=181.94, Sharpe=-0.3013
[INFO] Centroid 22: Short SMA=50.09, Long SMA=161.56, Sharpe=-0.1349
[INFO] Centroid 23: Short SMA=25.04, Long SMA=193.06, Sharpe=-0.0568
[INFO] Centroid 24: Short SMA=24.12, Long SMA=227.12, Sharpe=0.0153
[INFO] Centroid 25: Short SMA=24.33, Long SMA=112.20, Sharpe=0.4077
[INFO] Centroid 26: Short SMA=23.33, Long SMA=166.37, Sharpe=0.0937
[INFO] Centroid 27: Short SMA=204.37, Long SMA=289.10, Sharpe=-0.6719
[INFO] Centroid 28: Short SMA=114.36, Long SMA=275.48, Sharpe=-0.4523
[INFO] Centroid 29: Short SMA=193.11, Long SMA=247.56, Sharpe=-0.0869
[INFO] Centroid 30: Short SMA=276.16, Long SMA=292.13, Sharpe=-0.4825
[INFO] Centroid 31: Short SMA=139.90, Long SMA=189.01, Sharpe=-0.1825
[INFO] Centroid 32: Short SMA=72.89, Long SMA=202.28, Sharpe=-0.3564
[INFO] Centroid 33: Short SMA=133.34, Long SMA=163.52, Sharpe=-0.5701
[INFO] Centroid 34: Short SMA=99.61, Long SMA=120.67, Sharpe=-0.4186
[INFO] Centroid 35: Short SMA=30.42, Long SMA=278.64, Sharpe=0.1993
[INFO] Centroid 36: Short SMA=37.61, Long SMA=79.61, Sharpe=0.5815
[INFO] Centroid 37: Short SMA=18.50, Long SMA=40.73, Sharpe=0.2063
[INFO] Centroid 38: Short SMA=157.49, Long SMA=192.13, Sharpe=0.0026
[INFO] Centroid 39: Short SMA=175.67, Long SMA=271.68, Sharpe=-0.2849
[INFO] Centroid 40: Short SMA=67.74, Long SMA=175.60, Sharpe=-0.3082
[INFO] Centroid 41: Short SMA=58.55, Long SMA=134.79, Sharpe=0.0155
[INFO] Centroid 42: Short SMA=72.12, Long SMA=283.81, Sharpe=-0.1549
[INFO] Centroid 43: Short SMA=98.26, Long SMA=223.83, Sharpe=-0.1630
[INFO] Centroid 44: Short SMA=227.46, Long SMA=265.94, Sharpe=-0.4602
[INFO] Centroid 45: Short SMA=148.12, Long SMA=238.77, Sharpe=0.0062
[INFO] Centroid 46: Short SMA=238.17, Long SMA=285.64, Sharpe=-0.9010
[INFO] Centroid 47: Short SMA=119.71, Long SMA=201.16, Sharpe=-0.4197
[INFO] Centroid 48: Short SMA=123.87, Long SMA=156.16, Sharpe=-0.3693
[INFO] Centroid 49: Short SMA=158.03, Long SMA=175.83, Sharpe=0.2060
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=50, Sharpe=0.8008, Trades=96
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=40, Long SMA=80, Sharpe=0.6395, Trades=36
[INFO] Kmeans Top 2: Short SMA=24, Long SMA=112, Sharpe=0.3832, Trades=33
[INFO] Kmeans Top 3: Short SMA=66, Long SMA=86, Sharpe=0.3705, Trades=41
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=64, Sharpe=0.3505, Trades=50
[INFO] Kmeans Top 5: Short SMA=158, Long SMA=176, Sharpe=0.3111, Trades=31
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (37, 242)
[INFO]   Nearest: (38.0, 242.0)
[INFO]   Rounded: (144, 254)
[INFO]   Rounded: (85, 154)
[INFO]   Nearest: (86.0, 154.0)
[INFO]   Rounded: (67, 86)
[INFO]   Nearest: (66.0, 86.0)
[INFO]   Rounded: (127, 290)
[INFO]   Nearest: (128.0, 290.0)
[INFO]   Rounded: (55, 209)
[INFO]   Nearest: (54.0, 210.0)
[INFO]   Rounded: (180, 199)
[INFO]   Nearest: (180.0, 200.0)
[INFO]   Rounded: (253, 279)
[INFO]   Nearest: (254.0, 278.0)
[INFO]   Rounded: (29, 138)
[INFO]   Nearest: (30.0, 138.0)
[INFO]   Rounded: (14, 276)
[INFO]   Rounded: (159, 222)
[INFO]   Nearest: (158.0, 222.0)
[INFO]   Rounded: (71, 247)
[INFO]   Nearest: (72.0, 248.0)
[INFO]   Rounded: (69, 106)
[INFO]   Nearest: (68.0, 106.0)
[INFO]   Rounded: (220, 246)
[INFO]   Rounded: (109, 252)
[INFO]   Nearest: (108.0, 252.0)
[INFO]   Rounded: (102, 129)
[INFO]   Nearest: (102.0, 130.0)
[INFO]   Rounded: (197, 219)
[INFO]   Nearest: (196.0, 220.0)
[INFO]   Rounded: (29, 64)
[INFO]   Nearest: (30.0, 64.0)
[INFO]   Rounded: (37, 279)
[INFO]   Nearest: (38.0, 278.0)
[INFO]   Rounded: (168, 287)
[INFO]   Nearest: (168.0, 286.0)
[INFO]   Rounded: (23, 36)
[INFO]   Nearest: (22.0, 36.0)
[INFO]   Rounded: (102, 182)
[INFO]   Rounded: (50, 162)
[INFO]   Rounded: (25, 193)
[INFO]   Nearest: (26.0, 194.0)
[INFO]   Rounded: (24, 227)
[INFO]   Nearest: (24.0, 228.0)
[INFO]   Rounded: (24, 112)
[INFO]   Rounded: (23, 166)
[INFO]   Nearest: (24.0, 166.0)
[INFO]   Rounded: (204, 289)
[INFO]   Nearest: (204.0, 290.0)
[INFO]   Rounded: (114, 275)
[INFO]   Nearest: (114.0, 276.0)
[INFO]   Rounded: (193, 248)
[INFO]   Nearest: (194.0, 248.0)
[INFO]   Rounded: (276, 292)
[INFO]   Rounded: (140, 189)
[INFO]   Nearest: (140.0, 190.0)
[INFO]   Rounded: (73, 202)
[INFO]   Nearest: (72.0, 202.0)
[INFO]   Rounded: (133, 164)
[INFO]   Nearest: (134.0, 164.0)
[INFO]   Rounded: (100, 121)
[INFO]   Nearest: (100.0, 120.0)
[INFO]   Rounded: (30, 279)
[INFO]   Nearest: (30.0, 278.0)
[INFO]   Rounded: (38, 80)
[INFO]   Rounded: (19, 41)
[INFO]   Nearest: (18.0, 40.0)
[INFO]   Rounded: (157, 192)
[INFO]   Nearest: (158.0, 192.0)
[INFO]   Rounded: (176, 272)
[INFO]   Rounded: (68, 176)
[INFO]   Rounded: (59, 135)
[INFO]   Nearest: (58.0, 134.0)
[INFO]   Rounded: (72, 284)
[INFO]   Rounded: (98, 224)
[INFO]   Rounded: (227, 266)
[INFO]   Nearest: (228.0, 266.0)
[INFO]   Rounded: (148, 239)
[INFO]   Nearest: (148.0, 238.0)
[INFO]   Rounded: (238, 286)
[INFO]   Rounded: (120, 201)
[INFO]   Nearest: (120.0, 202.0)
[INFO]   Rounded: (124, 156)
[INFO]   Rounded: (158, 176)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(40/80) - Original Sharpe: 0.6395, Trades: 36
[INFO] Kmeans cluster 2: SMA(24/112) - Original Sharpe: 0.3832, Trades: 33
[INFO] Kmeans cluster 3: SMA(66/86) - Original Sharpe: 0.3705, Trades: 41
[INFO] Kmeans cluster 4: SMA(30/64) - Original Sharpe: 0.3505, Trades: 50
[INFO] Kmeans cluster 5: SMA(158/176) - Original Sharpe: 0.3111, Trades: 31
[INFO] Trimmed warm-up period. Evaluation data length: 2838
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (40/80) - Sharpe: 0.6395
[INFO] cluster 2: (24/112) - Sharpe: 0.3832
[INFO] cluster 3: (66/86) - Sharpe: 0.3705
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.735456            2.522680
1    2021-11-14 2021-11-14            43    -2.165624           -0.363623
2    2022-01-14 2022-01-14            41     1.793648            2.821158
3    2022-03-14 2022-03-14            44    -0.267645            2.625333
4    2022-05-14 2022-05-14            43    -1.664283           -1.664283
5    2022-07-14 2022-07-14            44     2.545316            0.911051
6    2022-09-14 2022-09-14            43    -1.824873           -3.931237
7    2022-11-14 2022-11-14            43    -2.147754           -2.012427
8    2023-01-14 2023-01-14            41     0.173521           -1.267785
9    2023-03-14 2023-03-14            43    -5.761990           -1.701275
10   2023-05-14 2023-05-14            44     1.051850            2.006079
11   2023-07-14 2023-07-14            44     2.639646            1.122283
12   2023-09-14 2023-09-14            43     0.320827           -2.332686
13   2023-11-14 2023-11-14            42     0.697919            0.891761
14   2024-01-14 2024-01-14            43     0.380540           -0.658062
15   2024-03-14 2024-03-14            42    -1.088742           -1.088742
16   2024-05-14 2024-05-14            44    -0.468733           -3.120971
17   2024-07-14 2024-07-14            45     0.730155            2.436724
18   2024-09-14 2024-09-14            43    -2.244826           -0.687232
19   2024-11-14 2024-11-14            33     0.455012           -2.522952
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |              2.5 |          4.2 | True          
[INFO] 2021-11-14   |         -2.2 |             -0.4 |          1.8 | True          
[INFO] 2022-01-14   |          1.8 |              2.8 |          1.0 | True          
[INFO] 2022-03-14   |         -0.3 |              2.6 |          2.9 | True          
[INFO] 2022-05-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.5 |              0.9 |         -1.6 | False         
[INFO] 2022-09-14   |         -1.8 |             -3.9 |         -2.1 | False         
[INFO] 2022-11-14   |         -2.1 |             -2.0 |          0.1 | True          
[INFO] 2023-01-14   |          0.2 |             -1.3 |         -1.5 | False         
[INFO] 2023-03-14   |         -5.8 |             -1.7 |          4.1 | True          
[INFO] 2023-05-14   |          1.1 |              2.0 |          0.9 | True          
[INFO] 2023-07-14   |          2.6 |              1.1 |         -1.5 | False         
[INFO] 2023-09-14   |          0.3 |             -2.3 |         -2.6 | False         
[INFO] 2023-11-14   |          0.7 |              0.9 |          0.2 | True          
[INFO] 2024-01-14   |          0.4 |             -0.7 |         -1.1 | False         
[INFO] 2024-03-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -0.5 |             -3.1 |         -2.6 | False         
[INFO] 2024-07-14   |          0.7 |              2.4 |          1.7 | True          
[INFO] 2024-09-14   |         -2.2 |             -0.7 |          1.5 | True          
[INFO] 2024-11-14   |          0.5 |             -2.5 |         -3.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 10 of 18 periods (55.56% win rate)
[INFO] Updating Excel file with Kmeans results for RB...
[INFO] Excel file updated successfully. Added RB with Kmeans win rate 55.6% in row 41
[INFO] Added best Sharpe parameters 42/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(40/80) - Original Sharpe: 0.6395
[INFO] Added cluster 2 to portfolio: SMA(24/112) - Original Sharpe: 0.3832
[INFO] Added cluster 3 to portfolio: SMA(66/86) - Original Sharpe: 0.3705
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RB_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0861
[INFO] Kmeans Best out-of-sample Sharpe: -0.4045
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for RB...
[INFO] Excel file updated successfully. Added RB with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RB
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.0498 to 0.8008
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.800794
[INFO] Number of Trades: 96
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.0498 to 0.8008
[INFO] Trades range: 10.0 to 319.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.8627 to 2.8926
[INFO] Scaled Trades range: -0.8928 to 15.4926
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6084
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 472 elements
[INFO] Cluster 1: 245 elements
[INFO] Cluster 2: 322 elements
[INFO] Cluster 3: 412 elements
[INFO] Cluster 4: 52 elements
[INFO] Cluster 5: 155 elements
[INFO] Cluster 6: 197 elements
[INFO] Cluster 7: 344 elements
[INFO] Cluster 8: 400 elements
[INFO] Cluster 9: 377 elements
[INFO] Cluster 10: 123 elements
[INFO] Cluster 11: 282 elements
[INFO] Cluster 12: 256 elements
[INFO] Cluster 13: 255 elements
[INFO] Cluster 14: 146 elements
[INFO] Cluster 15: 532 elements
[INFO] Cluster 16: 344 elements
[INFO] Cluster 17: 93 elements
[INFO] Cluster 18: 228 elements
[INFO] Cluster 19: 446 elements
[INFO] Cluster 20: 270 elements
[INFO] Cluster 21: 7 elements
[INFO] Cluster 22: 425 elements
[INFO] Cluster 23: 124 elements
[INFO] Cluster 24: 187 elements
[INFO] Cluster 25: 28 elements
[INFO] Cluster 26: 397 elements
[INFO] Cluster 27: 165 elements
[INFO] Cluster 28: 109 elements
[INFO] Cluster 29: 320 elements
[INFO] Cluster 30: 178 elements
[INFO] Cluster 31: 219 elements
[INFO] Cluster 32: 295 elements
[INFO] Cluster 33: 44 elements
[INFO] Cluster 34: 272 elements
[INFO] Cluster 35: 71 elements
[INFO] Cluster 36: 191 elements
[INFO] Cluster 37: 29 elements
[INFO] Cluster 38: 203 elements
[INFO] Cluster 39: 84 elements
[INFO] Cluster 40: 163 elements
[INFO] Cluster 41: 152 elements
[INFO] Cluster 42: 30 elements
[INFO] Cluster 43: 17 elements
[INFO] Cluster 44: 286 elements
[INFO] Cluster 45: 145 elements
[INFO] Cluster 46: 169 elements
[INFO] Cluster 47: 34 elements
[INFO] Cluster 48: 126 elements
[INFO] Cluster 49: 164 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=178, Long SMA=246, Sharpe=-0.0665, Trades=20
[INFO] Cluster 1 cluster: Short SMA=202, Long SMA=284, Sharpe=-0.6629, Trades=18
[INFO] Cluster 2 cluster: Short SMA=218, Long SMA=250, Sharpe=-0.2792, Trades=22
[INFO] Cluster 3 cluster: Short SMA=126, Long SMA=250, Sharpe=-0.2085, Trades=18
[INFO] Cluster 4 cluster: Short SMA=128, Long SMA=130, Sharpe=-0.1576, Trades=85
[INFO] Cluster 5 cluster: Short SMA=116, Long SMA=128, Sharpe=-0.1055, Trades=38
[INFO] Cluster 6 cluster: Short SMA=132, Long SMA=158, Sharpe=-0.4824, Trades=29
[INFO] Cluster 7 cluster: Short SMA=170, Long SMA=280, Sharpe=-0.2724, Trades=14
[INFO] Cluster 8 cluster: Short SMA=238, Long SMA=286, Sharpe=-0.9548, Trades=19
[INFO] Cluster 9 cluster: Short SMA=50, Long SMA=172, Sharpe=-0.1267, Trades=22
[INFO] Cluster 10 cluster: Short SMA=20, Long SMA=42, Sharpe=0.0084, Trades=80
[INFO] Cluster 11 cluster: Short SMA=26, Long SMA=220, Sharpe=-0.1399, Trades=27
[INFO] Cluster 12 cluster: Short SMA=126, Long SMA=288, Sharpe=-0.7376, Trades=14
[INFO] Cluster 13 cluster: Short SMA=42, Long SMA=90, Sharpe=0.6355, Trades=35
[INFO] Cluster 14 cluster: Short SMA=68, Long SMA=84, Sharpe=0.3465, Trades=47
[INFO] Cluster 15 cluster: Short SMA=78, Long SMA=192, Sharpe=-0.3043, Trades=20
[INFO] Cluster 16 cluster: Short SMA=36, Long SMA=274, Sharpe=0.1229, Trades=14
[INFO] Cluster 17 cluster: Short SMA=176, Long SMA=182, Sharpe=0.0287, Trades=51
[INFO] Cluster 18 cluster: Short SMA=96, Long SMA=130, Sharpe=-0.2624, Trades=26
[INFO] Cluster 19 cluster: Short SMA=72, Long SMA=282, Sharpe=-0.1361, Trades=12
[INFO] Cluster 20 cluster: Short SMA=176, Long SMA=222, Sharpe=0.1002, Trades=20
[INFO] Cluster 22 cluster: Short SMA=94, Long SMA=160, Sharpe=-0.4204, Trades=20
[INFO] Cluster 23 cluster: Short SMA=274, Long SMA=294, Sharpe=-0.5406, Trades=25
[INFO] Cluster 24 cluster: Short SMA=170, Long SMA=200, Sharpe=-0.3019, Trades=25
[INFO] Cluster 25 cluster: Short SMA=272, Long SMA=274, Sharpe=-0.7232, Trades=71
[INFO] Cluster 26 cluster: Short SMA=70, Long SMA=248, Sharpe=0.0687, Trades=14
[INFO] Cluster 27 cluster: Short SMA=16, Long SMA=276, Sharpe=0.0465, Trades=28
[INFO] Cluster 28 cluster: Short SMA=34, Long SMA=52, Sharpe=0.3856, Trades=68
[INFO] Cluster 29 cluster: Short SMA=92, Long SMA=224, Sharpe=-0.3119, Trades=22
[INFO] Cluster 30 cluster: Short SMA=24, Long SMA=150, Sharpe=0.2931, Trades=27
[INFO] Cluster 31 cluster: Short SMA=114, Long SMA=274, Sharpe=-0.5213, Trades=14
[INFO] Cluster 32 cluster: Short SMA=64, Long SMA=110, Sharpe=0.0960, Trades=27
[INFO] Cluster 33 cluster: Short SMA=32, Long SMA=38, Sharpe=-0.0730, Trades=122
[INFO] Cluster 34 cluster: Short SMA=120, Long SMA=198, Sharpe=-0.6046, Trades=21
[INFO] Cluster 35 cluster: Short SMA=226, Long SMA=230, Sharpe=-0.2189, Trades=50
[INFO] Cluster 36 cluster: Short SMA=28, Long SMA=122, Sharpe=0.2883, Trades=27
[INFO] Cluster 37 cluster: Short SMA=24, Long SMA=28, Sharpe=0.4863, Trades=147
[INFO] Cluster 38 cluster: Short SMA=22, Long SMA=72, Sharpe=0.5452, Trades=50
[INFO] Cluster 39 cluster: Short SMA=260, Long SMA=270, Sharpe=-0.9132, Trades=37
[INFO] Cluster 40 cluster: Short SMA=158, Long SMA=182, Sharpe=0.2142, Trades=27
[INFO] Cluster 41 cluster: Short SMA=14, Long SMA=192, Sharpe=-0.0487, Trades=37
[INFO] Cluster 42 cluster: Short SMA=192, Long SMA=194, Sharpe=-0.1167, Trades=80
[INFO] Cluster 44 cluster: Short SMA=142, Long SMA=216, Sharpe=0.0599, Trades=19
[INFO] Cluster 45 cluster: Short SMA=38, Long SMA=236, Sharpe=0.2968, Trades=20
[INFO] Cluster 46 cluster: Short SMA=58, Long SMA=134, Sharpe=0.0234, Trades=22
[INFO] Cluster 47 cluster: Short SMA=60, Long SMA=64, Sharpe=0.5439, Trades=105
[INFO] Cluster 48 cluster: Short SMA=20, Long SMA=100, Sharpe=0.4060, Trades=42
[INFO] Cluster 49 cluster: Short SMA=28, Long SMA=178, Sharpe=-0.0252, Trades=29
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=50, Sharpe=0.8008, Trades=96
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=42, Long SMA=90, Sharpe=0.6355, Trades=35
[INFO] Top 2: Short SMA=22, Long SMA=72, Sharpe=0.5452, Trades=50
[INFO] Top 3: Short SMA=60, Long SMA=64, Sharpe=0.5439, Trades=105
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10561 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(42/90) - Original Sharpe: 0.6355, Trades: 35
[INFO] Hierarchical cluster 2: SMA(22/72) - Original Sharpe: 0.5452, Trades: 50
[INFO] Hierarchical cluster 3: SMA(60/64) - Original Sharpe: 0.5439, Trades: 105
[INFO] Hierarchical cluster 4: SMA(24/28) - Original Sharpe: 0.4863, Trades: 147
[INFO] Hierarchical cluster 5: SMA(20/100) - Original Sharpe: 0.4060, Trades: 42
[INFO] Trimmed warm-up period. Evaluation data length: 2838
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (42/90) - Sharpe: 0.6355
[INFO] cluster 2: (22/72) - Sharpe: 0.5452
[INFO] cluster 3: (60/64) - Sharpe: 0.5439
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.735456            2.522680
1    2021-11-14 2021-11-14            43    -2.165624           -1.220792
2    2022-01-14 2022-01-14            41     1.793648            1.714653
3    2022-03-14 2022-03-14            44    -0.267645            2.625333
4    2022-05-14 2022-05-14            43    -1.664283           -2.296185
5    2022-07-14 2022-07-14            44     2.545316            1.105075
6    2022-09-14 2022-09-14            43    -1.824873           -2.625909
7    2022-11-14 2022-11-14            43    -2.147754           -1.334633
8    2023-01-14 2023-01-14            41     0.173521            0.096931
9    2023-03-14 2023-03-14            43    -5.761990           -2.060383
10   2023-05-14 2023-05-14            44     1.051850           -2.666823
11   2023-07-14 2023-07-14            44     2.639646            2.844248
12   2023-09-14 2023-09-14            43     0.320827           -3.276833
13   2023-11-14 2023-11-14            42     0.697919            0.712261
14   2024-01-14 2024-01-14            43     0.380540            0.055574
15   2024-03-14 2024-03-14            42    -1.088742           -1.088742
16   2024-05-14 2024-05-14            44    -0.468733           -1.660786
17   2024-07-14 2024-07-14            45     0.730155            1.727778
18   2024-09-14 2024-09-14            43    -2.244826           -1.274846
19   2024-11-14 2024-11-14            33     0.455012           -0.963783
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |              2.5 |          4.2 | True          
[INFO] 2021-11-14   |         -2.2 |             -1.2 |          1.0 | True          
[INFO] 2022-01-14   |          1.8 |              1.7 |         -0.1 | False         
[INFO] 2022-03-14   |         -0.3 |              2.6 |          2.9 | True          
[INFO] 2022-05-14   |         -1.7 |             -2.3 |         -0.6 | False         
[INFO] 2022-07-14   |          2.5 |              1.1 |         -1.4 | False         
[INFO] 2022-09-14   |         -1.8 |             -2.6 |         -0.8 | False         
[INFO] 2022-11-14   |         -2.1 |             -1.3 |          0.8 | True          
[INFO] 2023-01-14   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2023-03-14   |         -5.8 |             -2.1 |          3.7 | True          
[INFO] 2023-05-14   |          1.1 |             -2.7 |         -3.8 | False         
[INFO] 2023-07-14   |          2.6 |              2.8 |          0.2 | True          
[INFO] 2023-09-14   |          0.3 |             -3.3 |         -3.6 | False         
[INFO] 2023-11-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-01-14   |          0.4 |              0.1 |         -0.3 | False         
[INFO] 2024-03-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -0.5 |             -1.7 |         -1.2 | False         
[INFO] 2024-07-14   |          0.7 |              1.7 |          1.0 | True          
[INFO] 2024-09-14   |         -2.2 |             -1.3 |          0.9 | True          
[INFO] 2024-11-14   |          0.5 |             -1.0 |         -1.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-11-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 18 periods (44.44% win rate)
[INFO] Updating Excel file with Hierarchical results for RB...
[INFO] Excel file updated successfully. Added RB with Hierarchical win rate 44.4% in row 41
[INFO] Added best Sharpe parameters 42/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(42/90) - Original Sharpe: 0.6355
[INFO] Added cluster 2 to portfolio: SMA(22/72) - Original Sharpe: 0.5452
[INFO] Added cluster 3 to portfolio: SMA(60/64) - Original Sharpe: 0.5439
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RB_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1782
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4045
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for RB...
[INFO] Excel file updated successfully. Added RB with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RB
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for RTY in column D: 12.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 157.81s
[INFO] Best parameters: Short SMA = 122, Long SMA = 142
[INFO] Best Sharpe ratio: 0.356940, Trades: 40
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @RTY
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.21 contracts
[INFO] Maximum Position Size: 11 contracts
[INFO] Strategy Total P&L: $181,223.00
[INFO] Market Buy & Hold P&L: $47,790.00
[INFO] Outperformance: $133,433.00
[INFO] Sharpe ratio (entire period, annualized): 0.190911
[INFO] Sharpe ratio (in-sample, annualized): 0.356940
[INFO] Sharpe ratio (out-of-sample, annualized): -0.184654
[INFO] Maximum Drawdown: $212,021.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 18
[INFO] Out-of-sample period trades: 22
[INFO] Total trades: 40
[INFO] In-sample P&L: $206,561.00
[INFO] Out-of-sample P&L: $-47,237.00
[INFO] 
Best parameters from GA: Short SMA = 122, Long SMA = 142, Sharpe = 0.356940
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 50.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.0509 to 0.3569
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 142
[INFO] Sharpe Ratio: 0.356940
[INFO] Number of Trades: 40
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10582 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.0509 to 0.3569
[INFO] Trades range: 10.0 to 329.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3995 to 2.7991
[INFO] Scaled Long SMA range: -2.7993 to 1.4002
[INFO] Scaled Sharpe ratio range: -4.4788 to 3.0252
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 139 elements
[INFO] Kmeans Cluster 1: 194 elements
[INFO] Kmeans Cluster 2: 272 elements
[INFO] Kmeans Cluster 3: 225 elements
[INFO] Kmeans Cluster 4: 238 elements
[INFO] Kmeans Cluster 5: 198 elements
[INFO] Kmeans Cluster 6: 278 elements
[INFO] Kmeans Cluster 7: 92 elements
[INFO] Kmeans Cluster 8: 111 elements
[INFO] Kmeans Cluster 9: 229 elements
[INFO] Kmeans Cluster 10: 255 elements
[INFO] Kmeans Cluster 11: 114 elements
[INFO] Kmeans Cluster 12: 222 elements
[INFO] Kmeans Cluster 13: 174 elements
[INFO] Kmeans Cluster 14: 210 elements
[INFO] Kmeans Cluster 15: 182 elements
[INFO] Kmeans Cluster 16: 207 elements
[INFO] Kmeans Cluster 17: 332 elements
[INFO] Kmeans Cluster 18: 363 elements
[INFO] Kmeans Cluster 19: 249 elements
[INFO] Kmeans Cluster 20: 104 elements
[INFO] Kmeans Cluster 21: 245 elements
[INFO] Kmeans Cluster 22: 182 elements
[INFO] Kmeans Cluster 23: 162 elements
[INFO] Kmeans Cluster 24: 302 elements
[INFO] Kmeans Cluster 25: 195 elements
[INFO] Kmeans Cluster 26: 290 elements
[INFO] Kmeans Cluster 27: 223 elements
[INFO] Kmeans Cluster 28: 312 elements
[INFO] Kmeans Cluster 29: 255 elements
[INFO] Kmeans Cluster 30: 71 elements
[INFO] Kmeans Cluster 31: 102 elements
[INFO] Kmeans Cluster 32: 283 elements
[INFO] Kmeans Cluster 33: 195 elements
[INFO] Kmeans Cluster 34: 238 elements
[INFO] Kmeans Cluster 35: 282 elements
[INFO] Kmeans Cluster 36: 368 elements
[INFO] Kmeans Cluster 37: 278 elements
[INFO] Kmeans Cluster 38: 60 elements
[INFO] Kmeans Cluster 39: 151 elements
[INFO] Kmeans Cluster 40: 98 elements
[INFO] Kmeans Cluster 41: 239 elements
[INFO] Kmeans Cluster 42: 267 elements
[INFO] Kmeans Cluster 43: 221 elements
[INFO] Kmeans Cluster 44: 43 elements
[INFO] Kmeans Cluster 45: 199 elements
[INFO] Kmeans Cluster 46: 235 elements
[INFO] Kmeans Cluster 47: 160 elements
[INFO] Kmeans Cluster 48: 216 elements
[INFO] Kmeans Cluster 49: 322 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=94.37, Long SMA=116.65, Sharpe=-0.2793
[INFO] Centroid 1: Short SMA=202.96, Long SMA=281.52, Sharpe=-0.3652
[INFO] Centroid 2: Short SMA=109.46, Long SMA=275.98, Sharpe=-0.1648
[INFO] Centroid 3: Short SMA=25.91, Long SMA=148.75, Sharpe=-0.1047
[INFO] Centroid 4: Short SMA=187.26, Long SMA=223.68, Sharpe=-0.1527
[INFO] Centroid 5: Short SMA=186.89, Long SMA=208.65, Sharpe=-0.2728
[INFO] Centroid 6: Short SMA=35.42, Long SMA=284.12, Sharpe=-0.0383
[INFO] Centroid 7: Short SMA=18.78, Long SMA=35.91, Sharpe=-0.4193
[INFO] Centroid 8: Short SMA=253.28, Long SMA=274.85, Sharpe=-0.8686
[INFO] Centroid 9: Short SMA=147.92, Long SMA=226.00, Sharpe=-0.3013
[INFO] Centroid 10: Short SMA=116.35, Long SMA=160.29, Sharpe=-0.0161
[INFO] Centroid 11: Short SMA=31.14, Long SMA=186.68, Sharpe=-0.3283
[INFO] Centroid 12: Short SMA=43.20, Long SMA=167.56, Sharpe=-0.2015
[INFO] Centroid 13: Short SMA=32.37, Long SMA=60.36, Sharpe=-0.1182
[INFO] Centroid 14: Short SMA=222.13, Long SMA=273.69, Sharpe=-0.4803
[INFO] Centroid 15: Short SMA=88.27, Long SMA=255.70, Sharpe=0.0200
[INFO] Centroid 16: Short SMA=47.79, Long SMA=188.83, Sharpe=-0.0981
[INFO] Centroid 17: Short SMA=66.78, Long SMA=230.38, Sharpe=-0.2735
[INFO] Centroid 18: Short SMA=189.56, Long SMA=257.55, Sharpe=-0.2725
[INFO] Centroid 19: Short SMA=128.27, Long SMA=212.61, Sharpe=-0.3948
[INFO] Centroid 20: Short SMA=214.00, Long SMA=234.62, Sharpe=-0.0088
[INFO] Centroid 21: Short SMA=35.40, Long SMA=140.58, Sharpe=0.0193
[INFO] Centroid 22: Short SMA=90.40, Long SMA=234.04, Sharpe=-0.1306
[INFO] Centroid 23: Short SMA=117.93, Long SMA=143.01, Sharpe=0.1418
[INFO] Centroid 24: Short SMA=97.70, Long SMA=192.54, Sharpe=-0.1560
[INFO] Centroid 25: Short SMA=21.23, Long SMA=101.10, Sharpe=-0.2370
[INFO] Centroid 26: Short SMA=131.70, Long SMA=275.37, Sharpe=-0.0965
[INFO] Centroid 27: Short SMA=244.10, Long SMA=280.62, Sharpe=-0.6253
[INFO] Centroid 28: Short SMA=165.62, Long SMA=286.08, Sharpe=-0.2225
[INFO] Centroid 29: Short SMA=80.49, Long SMA=287.76, Sharpe=-0.0164
[INFO] Centroid 30: Short SMA=213.72, Long SMA=229.35, Sharpe=0.1860
[INFO] Centroid 31: Short SMA=14.51, Long SMA=279.90, Sharpe=0.1214
[INFO] Centroid 32: Short SMA=48.98, Long SMA=265.82, Sharpe=-0.1494
[INFO] Centroid 33: Short SMA=150.63, Long SMA=175.19, Sharpe=-0.4920
[INFO] Centroid 34: Short SMA=25.79, Long SMA=239.92, Sharpe=-0.0700
[INFO] Centroid 35: Short SMA=77.29, Long SMA=175.04, Sharpe=-0.2896
[INFO] Centroid 36: Short SMA=55.04, Long SMA=117.26, Sharpe=-0.0601
[INFO] Centroid 37: Short SMA=36.91, Long SMA=219.02, Sharpe=-0.1797
[INFO] Centroid 38: Short SMA=282.20, Long SMA=292.50, Sharpe=-0.4103
[INFO] Centroid 39: Short SMA=138.29, Long SMA=170.07, Sharpe=-0.2472
[INFO] Centroid 40: Short SMA=13.55, Long SMA=203.27, Sharpe=0.0344
[INFO] Centroid 41: Short SMA=162.17, Long SMA=197.56, Sharpe=-0.3895
[INFO] Centroid 42: Short SMA=68.34, Long SMA=93.81, Sharpe=-0.1860
[INFO] Centroid 43: Short SMA=28.55, Long SMA=59.03, Sharpe=-0.2527
[INFO] Centroid 44: Short SMA=34.37, Long SMA=47.72, Sharpe=0.0396
[INFO] Centroid 45: Short SMA=111.01, Long SMA=226.99, Sharpe=-0.2630
[INFO] Centroid 46: Short SMA=149.99, Long SMA=253.34, Sharpe=-0.1834
[INFO] Centroid 47: Short SMA=41.63, Long SMA=82.90, Sharpe=-0.3691
[INFO] Centroid 48: Short SMA=251.76, Long SMA=277.92, Sharpe=-0.7378
[INFO] Centroid 49: Short SMA=89.48, Long SMA=135.12, Sharpe=-0.1526
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=142, Sharpe=0.3569, Trades=40
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=118, Long SMA=144, Sharpe=0.2381, Trades=34
[INFO] Kmeans Top 2: Short SMA=214, Long SMA=230, Sharpe=0.2300, Trades=32
[INFO] Kmeans Top 3: Short SMA=14, Long SMA=282, Sharpe=0.0938, Trades=21
[INFO] Kmeans Top 4: Short SMA=12, Long SMA=200, Sharpe=0.0905, Trades=34
[INFO] Kmeans Top 5: Short SMA=80, Long SMA=288, Sharpe=0.0628, Trades=11
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (94, 117)
[INFO]   Nearest: (94.0, 116.0)
[INFO]   Rounded: (203, 282)
[INFO]   Nearest: (202.0, 282.0)
[INFO]   Rounded: (109, 276)
[INFO]   Nearest: (110.0, 276.0)
[INFO]   Rounded: (26, 149)
[INFO]   Nearest: (26.0, 148.0)
[INFO]   Rounded: (187, 224)
[INFO]   Nearest: (188.0, 224.0)
[INFO]   Rounded: (187, 209)
[INFO]   Nearest: (186.0, 208.0)
[INFO]   Rounded: (35, 284)
[INFO]   Nearest: (36.0, 284.0)
[INFO]   Rounded: (19, 36)
[INFO]   Nearest: (18.0, 36.0)
[INFO]   Rounded: (253, 275)
[INFO]   Nearest: (254.0, 274.0)
[INFO]   Rounded: (148, 226)
[INFO]   Rounded: (116, 160)
[INFO]   Rounded: (31, 187)
[INFO]   Nearest: (32.0, 186.0)
[INFO]   Rounded: (43, 168)
[INFO]   Nearest: (44.0, 168.0)
[INFO]   Rounded: (32, 60)
[INFO]   Rounded: (222, 274)
[INFO]   Rounded: (88, 256)
[INFO]   Rounded: (48, 189)
[INFO]   Nearest: (48.0, 188.0)
[INFO]   Rounded: (67, 230)
[INFO]   Nearest: (66.0, 230.0)
[INFO]   Rounded: (190, 258)
[INFO]   Rounded: (128, 213)
[INFO]   Nearest: (128.0, 212.0)
[INFO]   Rounded: (214, 235)
[INFO]   Nearest: (214.0, 234.0)
[INFO]   Rounded: (35, 141)
[INFO]   Nearest: (36.0, 140.0)
[INFO]   Rounded: (90, 234)
[INFO]   Rounded: (118, 143)
[INFO]   Nearest: (118.0, 144.0)
[INFO]   Rounded: (98, 193)
[INFO]   Nearest: (98.0, 192.0)
[INFO]   Rounded: (21, 101)
[INFO]   Nearest: (22.0, 102.0)
[INFO]   Rounded: (132, 275)
[INFO]   Nearest: (132.0, 276.0)
[INFO]   Rounded: (244, 281)
[INFO]   Nearest: (244.0, 280.0)
[INFO]   Rounded: (166, 286)
[INFO]   Rounded: (80, 288)
[INFO]   Rounded: (214, 229)
[INFO]   Nearest: (214.0, 230.0)
[INFO]   Rounded: (15, 280)
[INFO]   Nearest: (14.0, 280.0)
[INFO]   Rounded: (49, 266)
[INFO]   Nearest: (48.0, 266.0)
[INFO]   Rounded: (151, 175)
[INFO]   Nearest: (150.0, 176.0)
[INFO]   Rounded: (26, 240)
[INFO]   Rounded: (77, 175)
[INFO]   Nearest: (78.0, 176.0)
[INFO]   Rounded: (55, 117)
[INFO]   Nearest: (56.0, 118.0)
[INFO]   Rounded: (37, 219)
[INFO]   Nearest: (36.0, 220.0)
[INFO]   Rounded: (282, 292)
[INFO]   Rounded: (138, 170)
[INFO]   Rounded: (14, 203)
[INFO]   Nearest: (14.0, 204.0)
[INFO]   Rounded: (162, 198)
[INFO]   Rounded: (68, 94)
[INFO]   Rounded: (29, 59)
[INFO]   Nearest: (28.0, 60.0)
[INFO]   Rounded: (34, 48)
[INFO]   Rounded: (111, 227)
[INFO]   Nearest: (112.0, 226.0)
[INFO]   Rounded: (150, 253)
[INFO]   Nearest: (150.0, 254.0)
[INFO]   Rounded: (42, 83)
[INFO]   Nearest: (42.0, 82.0)
[INFO]   Rounded: (252, 278)
[INFO]   Rounded: (89, 135)
[INFO]   Nearest: (90.0, 136.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 142
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(118/144) - Original Sharpe: 0.2381, Trades: 34
[INFO] Kmeans cluster 2: SMA(214/230) - Original Sharpe: 0.2300, Trades: 32
[INFO] Kmeans cluster 3: SMA(14/282) - Original Sharpe: 0.0938, Trades: 21
[INFO] Kmeans cluster 4: SMA(12/200) - Original Sharpe: 0.0905, Trades: 34
[INFO] Kmeans cluster 5: SMA(80/288) - Original Sharpe: 0.0628, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/142)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (118/144) - Sharpe: 0.2381
[INFO] cluster 2: (214/230) - Sharpe: 0.2300
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.951309            2.283118
1    2021-11-14 2021-11-14            43    -3.779143           -4.553094
2    2022-01-14 2022-01-14            41    -1.606093            1.562631
3    2022-03-14 2022-03-14            44     2.272090            2.272090
4    2022-05-14 2022-05-14            43     1.217919            1.217919
5    2022-07-14 2022-07-14            44    -0.981609           -0.981609
6    2022-09-14 2022-09-14            43    -0.503510           -0.503510
7    2022-11-14 2022-11-14            43     2.546707           -0.250385
8    2023-01-14 2023-01-14            41     2.799352            2.536047
9    2023-03-14 2023-03-14            44    -0.771622            0.141899
10   2023-05-14 2023-05-14            44    -1.092872           -3.568542
11   2023-07-14 2023-07-14            44     2.002487           -1.993986
12   2023-09-14 2023-09-14            43    -2.691940            0.048279
13   2023-11-14 2023-11-14            42     1.074911           -0.503616
14   2024-01-14 2024-01-14            43    -1.539506           -0.387889
15   2024-03-14 2024-03-14            42    -0.907679           -0.907679
16   2024-05-14 2024-05-14            44     1.119288            3.640728
17   2024-07-14 2024-07-14            45    -0.484134           -0.260295
18   2024-09-14 2024-09-14            43     1.944401            1.846313
19   2024-11-14 2024-11-14            33    -2.760739           -2.760739
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |              2.3 |          3.3 | True          
[INFO] 2021-11-14   |         -3.8 |             -4.6 |         -0.8 | False         
[INFO] 2022-01-14   |         -1.6 |              1.6 |          3.2 | True          
[INFO] 2022-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.5 |             -0.3 |         -2.8 | False         
[INFO] 2023-01-14   |          2.8 |              2.5 |         -0.3 | False         
[INFO] 2023-03-14   |         -0.8 |              0.1 |          0.9 | True          
[INFO] 2023-05-14   |         -1.1 |             -3.6 |         -2.5 | False         
[INFO] 2023-07-14   |          2.0 |             -2.0 |         -4.0 | False         
[INFO] 2023-09-14   |         -2.7 |              0.0 |          2.7 | True          
[INFO] 2023-11-14   |          1.1 |             -0.5 |         -1.6 | False         
[INFO] 2024-01-14   |         -1.5 |             -0.4 |          1.1 | True          
[INFO] 2024-03-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.1 |              3.6 |          2.5 | True          
[INFO] 2024-07-14   |         -0.5 |             -0.3 |          0.2 | True          
[INFO] 2024-09-14   |          1.9 |              1.8 |         -0.1 | False         
[INFO] 2024-11-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2024-03-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 7 of 14 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for RTY...
[INFO] Excel file updated successfully. Added RTY with Kmeans win rate 50.0% in row 42
[INFO] Added best Sharpe parameters 122/142 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 142
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(118/144) - Original Sharpe: 0.2381
[INFO] Added cluster 2 to portfolio: SMA(214/230) - Original Sharpe: 0.2300
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RTY_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0493
[INFO] Kmeans Best out-of-sample Sharpe: -0.1847
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for RTY...
[INFO] Excel file updated successfully. Added RTY with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RTY
[INFO] Big Point Value: 50.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.0509 to 0.3569
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 142
[INFO] Sharpe Ratio: 0.356940
[INFO] Number of Trades: 40
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10582 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.0509 to 0.3569
[INFO] Trades range: 10.0 to 329.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3995 to 2.7991
[INFO] Scaled Long SMA range: -2.7993 to 1.4002
[INFO] Scaled Sharpe ratio range: -4.4788 to 3.0252
[INFO] Scaled Trades range: -0.8038 to 13.2173
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10582 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5539
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 338 elements
[INFO] Cluster 1: 418 elements
[INFO] Cluster 2: 397 elements
[INFO] Cluster 3: 421 elements
[INFO] Cluster 4: 199 elements
[INFO] Cluster 5: 211 elements
[INFO] Cluster 6: 699 elements
[INFO] Cluster 7: 568 elements
[INFO] Cluster 8: 127 elements
[INFO] Cluster 9: 216 elements
[INFO] Cluster 10: 442 elements
[INFO] Cluster 11: 31 elements
[INFO] Cluster 12: 451 elements
[INFO] Cluster 13: 389 elements
[INFO] Cluster 14: 127 elements
[INFO] Cluster 15: 33 elements
[INFO] Cluster 16: 439 elements
[INFO] Cluster 17: 213 elements
[INFO] Cluster 18: 275 elements
[INFO] Cluster 19: 271 elements
[INFO] Cluster 20: 126 elements
[INFO] Cluster 21: 394 elements
[INFO] Cluster 22: 457 elements
[INFO] Cluster 23: 52 elements
[INFO] Cluster 24: 93 elements
[INFO] Cluster 25: 166 elements
[INFO] Cluster 26: 216 elements
[INFO] Cluster 27: 330 elements
[INFO] Cluster 28: 34 elements
[INFO] Cluster 29: 71 elements
[INFO] Cluster 30: 10 elements
[INFO] Cluster 31: 320 elements
[INFO] Cluster 32: 41 elements
[INFO] Cluster 33: 236 elements
[INFO] Cluster 34: 73 elements
[INFO] Cluster 35: 27 elements
[INFO] Cluster 36: 154 elements
[INFO] Cluster 37: 125 elements
[INFO] Cluster 38: 245 elements
[INFO] Cluster 39: 226 elements
[INFO] Cluster 40: 79 elements
[INFO] Cluster 41: 40 elements
[INFO] Cluster 42: 188 elements
[INFO] Cluster 43: 58 elements
[INFO] Cluster 44: 67 elements
[INFO] Cluster 45: 160 elements
[INFO] Cluster 46: 80 elements
[INFO] Cluster 47: 82 elements
[INFO] Cluster 48: 27 elements
[INFO] Cluster 49: 140 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=208, Long SMA=282, Sharpe=-0.4817, Trades=15
[INFO] Cluster 1 cluster: Short SMA=62, Long SMA=172, Sharpe=-0.2240, Trades=20
[INFO] Cluster 2 cluster: Short SMA=140, Long SMA=192, Sharpe=-0.4521, Trades=22
[INFO] Cluster 3 cluster: Short SMA=42, Long SMA=196, Sharpe=-0.1438, Trades=18
[INFO] Cluster 4 cluster: Short SMA=94, Long SMA=114, Sharpe=-0.1495, Trades=48
[INFO] Cluster 5 cluster: Short SMA=44, Long SMA=86, Sharpe=-0.1944, Trades=40
[INFO] Cluster 6 cluster: Short SMA=124, Long SMA=276, Sharpe=-0.0743, Trades=13
[INFO] Cluster 7 cluster: Short SMA=42, Long SMA=256, Sharpe=-0.1085, Trades=14
[INFO] Cluster 8 cluster: Short SMA=210, Long SMA=236, Sharpe=0.1619, Trades=28
[INFO] Cluster 9 cluster: Short SMA=116, Long SMA=158, Sharpe=0.0949, Trades=28
[INFO] Cluster 10 cluster: Short SMA=64, Long SMA=226, Sharpe=-0.2911, Trades=16
[INFO] Cluster 11 cluster: Short SMA=268, Long SMA=270, Sharpe=-0.7124, Trades=95
[INFO] Cluster 12 cluster: Short SMA=58, Long SMA=128, Sharpe=-0.0565, Trades=24
[INFO] Cluster 13 cluster: Short SMA=98, Long SMA=194, Sharpe=-0.1363, Trades=22
[INFO] Cluster 14 cluster: Short SMA=24, Long SMA=42, Sharpe=-0.3091, Trades=93
[INFO] Cluster 15 cluster: Short SMA=36, Long SMA=38, Sharpe=-0.1345, Trades=191
[INFO] Cluster 16 cluster: Short SMA=190, Long SMA=256, Sharpe=-0.2732, Trades=18
[INFO] Cluster 17 cluster: Short SMA=252, Long SMA=282, Sharpe=-0.8849, Trades=23
[INFO] Cluster 18 cluster: Short SMA=168, Long SMA=284, Sharpe=-0.2524, Trades=15
[INFO] Cluster 19 cluster: Short SMA=28, Long SMA=84, Sharpe=-0.2894, Trades=54
[INFO] Cluster 20 cluster: Short SMA=130, Long SMA=174, Sharpe=-0.2370, Trades=26
[INFO] Cluster 21 cluster: Short SMA=80, Long SMA=276, Sharpe=0.0043, Trades=15
[INFO] Cluster 22 cluster: Short SMA=142, Long SMA=222, Sharpe=-0.2796, Trades=18
[INFO] Cluster 23 cluster: Short SMA=40, Long SMA=48, Sharpe=0.0250, Trades=108
[INFO] Cluster 24 cluster: Short SMA=280, Long SMA=290, Sharpe=-0.4140, Trades=41
[INFO] Cluster 25 cluster: Short SMA=26, Long SMA=160, Sharpe=-0.1425, Trades=34
[INFO] Cluster 26 cluster: Short SMA=54, Long SMA=74, Sharpe=-0.1190, Trades=60
[INFO] Cluster 27 cluster: Short SMA=86, Long SMA=142, Sharpe=-0.1829, Trades=24
[INFO] Cluster 28 cluster: Short SMA=102, Long SMA=104, Sharpe=-0.1538, Trades=128
[INFO] Cluster 29 cluster: Short SMA=126, Long SMA=136, Sharpe=0.2687, Trades=60
[INFO] Cluster 31 cluster: Short SMA=174, Long SMA=232, Sharpe=-0.1135, Trades=18
[INFO] Cluster 32 cluster: Short SMA=26, Long SMA=32, Sharpe=-0.4201, Trades=126
[INFO] Cluster 33 cluster: Short SMA=240, Long SMA=284, Sharpe=-0.7191, Trades=21
[INFO] Cluster 34 cluster: Short SMA=260, Long SMA=268, Sharpe=-0.6594, Trades=49
[INFO] Cluster 35 cluster: Short SMA=162, Long SMA=164, Sharpe=-0.3650, Trades=104
[INFO] Cluster 36 cluster: Short SMA=176, Long SMA=198, Sharpe=-0.2798, Trades=28
[INFO] Cluster 37 cluster: Short SMA=14, Long SMA=230, Sharpe=-0.0582, Trades=24
[INFO] Cluster 38 cluster: Short SMA=30, Long SMA=286, Sharpe=-0.0601, Trades=15
[INFO] Cluster 39 cluster: Short SMA=22, Long SMA=146, Sharpe=-0.0107, Trades=34
[INFO] Cluster 40 cluster: Short SMA=188, Long SMA=194, Sharpe=-0.1538, Trades=58
[INFO] Cluster 41 cluster: Short SMA=160, Long SMA=166, Sharpe=-0.4306, Trades=62
[INFO] Cluster 42 cluster: Short SMA=112, Long SMA=242, Sharpe=-0.3111, Trades=14
[INFO] Cluster 43 cluster: Short SMA=214, Long SMA=228, Sharpe=0.2116, Trades=36
[INFO] Cluster 44 cluster: Short SMA=12, Long SMA=278, Sharpe=0.1307, Trades=21
[INFO] Cluster 45 cluster: Short SMA=90, Long SMA=232, Sharpe=-0.1111, Trades=16
[INFO] Cluster 46 cluster: Short SMA=32, Long SMA=52, Sharpe=-0.0500, Trades=74
[INFO] Cluster 47 cluster: Short SMA=100, Long SMA=126, Sharpe=-0.0995, Trades=40
[INFO] Cluster 48 cluster: Short SMA=216, Long SMA=218, Sharpe=0.1038, Trades=94
[INFO] Cluster 49 cluster: Short SMA=28, Long SMA=116, Sharpe=-0.0628, Trades=42
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=142, Sharpe=0.3569, Trades=40
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=126, Long SMA=136, Sharpe=0.2687, Trades=60
[INFO] Top 2: Short SMA=214, Long SMA=228, Sharpe=0.2116, Trades=36
[INFO] Top 3: Short SMA=210, Long SMA=236, Sharpe=0.1619, Trades=28
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10572 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 142
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(126/136) - Original Sharpe: 0.2687, Trades: 60
[INFO] Hierarchical cluster 2: SMA(214/228) - Original Sharpe: 0.2116, Trades: 36
[INFO] Hierarchical cluster 3: SMA(210/236) - Original Sharpe: 0.1619, Trades: 28
[INFO] Hierarchical cluster 4: SMA(12/278) - Original Sharpe: 0.1307, Trades: 21
[INFO] Hierarchical cluster 5: SMA(216/218) - Original Sharpe: 0.1038, Trades: 94
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/142)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (126/136) - Sharpe: 0.2687
[INFO] cluster 2: (214/228) - Sharpe: 0.2116
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.951309            2.773103
1    2021-11-14 2021-11-14            43    -3.779143           -4.667560
2    2022-01-14 2022-01-14            41    -1.606093            1.303927
3    2022-03-14 2022-03-14            44     2.272090            2.197609
4    2022-05-14 2022-05-14            43     1.217919            1.217919
5    2022-07-14 2022-07-14            44    -0.981609           -0.981609
6    2022-09-14 2022-09-14            43    -0.503510            0.858116
7    2022-11-14 2022-11-14            43     2.546707            1.685441
8    2023-01-14 2023-01-14            41     2.799352            2.681676
9    2023-03-14 2023-03-14            44    -0.771622           -0.515786
10   2023-05-14 2023-05-14            44    -1.092872           -3.993825
11   2023-07-14 2023-07-14            44     2.002487           -0.917702
12   2023-09-14 2023-09-14            43    -2.691940           -0.712246
13   2023-11-14 2023-11-14            42     1.074911           -1.060133
14   2024-01-14 2024-01-14            43    -1.539506            1.939479
15   2024-03-14 2024-03-14            42    -0.907679           -0.907679
16   2024-05-14 2024-05-14            44     1.119288            4.249095
17   2024-07-14 2024-07-14            45    -0.484134            0.875267
18   2024-09-14 2024-09-14            43     1.944401            2.436455
19   2024-11-14 2024-11-14            33    -2.760739           -2.760739
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |              2.8 |          3.8 | True          
[INFO] 2021-11-14   |         -3.8 |             -4.7 |         -0.9 | False         
[INFO] 2022-01-14   |         -1.6 |              1.3 |          2.9 | True          
[INFO] 2022-03-14   |          2.3 |              2.2 |         -0.1 | False         
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.5 |              0.9 |          1.4 | True          
[INFO] 2022-11-14   |          2.5 |              1.7 |         -0.8 | False         
[INFO] 2023-01-14   |          2.8 |              2.7 |         -0.1 | False         
[INFO] 2023-03-14   |         -0.8 |             -0.5 |          0.3 | True          
[INFO] 2023-05-14   |         -1.1 |             -4.0 |         -2.9 | False         
[INFO] 2023-07-14   |          2.0 |             -0.9 |         -2.9 | False         
[INFO] 2023-09-14   |         -2.7 |             -0.7 |          2.0 | True          
[INFO] 2023-11-14   |          1.1 |             -1.1 |         -2.2 | False         
[INFO] 2024-01-14   |         -1.5 |              1.9 |          3.4 | True          
[INFO] 2024-03-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.1 |              4.2 |          3.1 | True          
[INFO] 2024-07-14   |         -0.5 |              0.9 |          1.4 | True          
[INFO] 2024-09-14   |          1.9 |              2.4 |          0.5 | True          
[INFO] 2024-11-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2022-07-14, 2024-03-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 9 of 16 periods (56.25% win rate)
[INFO] Updating Excel file with Hierarchical results for RTY...
[INFO] Excel file updated successfully. Added RTY with Hierarchical win rate 56.2% in row 42
[INFO] Added best Sharpe parameters 122/142 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 142
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(126/136) - Original Sharpe: 0.2687
[INFO] Added cluster 2 to portfolio: SMA(214/228) - Original Sharpe: 0.2116
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RTY_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2671
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1847
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for RTY...
[INFO] Excel file updated successfully. Added RTY with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RTY
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for S in column D: 15.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 116.69s
[INFO] Best parameters: Short SMA = 180, Long SMA = 184
[INFO] Best Sharpe ratio: 0.926274, Trades: 64
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SB
[INFO] Big Point Value (from data): 1120.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 14.27 contracts
[INFO] Maximum Position Size: 30 contracts
[INFO] Strategy Total P&L: $739,428.00
[INFO] Market Buy & Hold P&L: $-3,248.00
[INFO] Outperformance: $742,676.00
[INFO] Sharpe ratio (entire period, annualized): 0.939613
[INFO] Sharpe ratio (in-sample, annualized): 0.926274
[INFO] Sharpe ratio (out-of-sample, annualized): 0.970879
[INFO] Maximum Drawdown: $93,066.80
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 37
[INFO] Out-of-sample period trades: 27
[INFO] Total trades: 64
[INFO] In-sample P&L: $473,072.00
[INFO] Out-of-sample P&L: $208,676.00
[INFO] 
Best parameters from GA: Short SMA = 180, Long SMA = 184, Sharpe = 0.926274
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5070 to 0.9263
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.926274
[INFO] Number of Trades: 64
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10118 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5070 to 0.9263
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3602 to 2.7902
[INFO] Scaled Long SMA range: -2.7801 to 1.4751
[INFO] Scaled Sharpe ratio range: -5.3285 to 3.8001
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 184 elements
[INFO] Kmeans Cluster 1: 195 elements
[INFO] Kmeans Cluster 2: 121 elements
[INFO] Kmeans Cluster 3: 252 elements
[INFO] Kmeans Cluster 4: 262 elements
[INFO] Kmeans Cluster 5: 180 elements
[INFO] Kmeans Cluster 6: 262 elements
[INFO] Kmeans Cluster 7: 191 elements
[INFO] Kmeans Cluster 8: 243 elements
[INFO] Kmeans Cluster 9: 220 elements
[INFO] Kmeans Cluster 10: 291 elements
[INFO] Kmeans Cluster 11: 195 elements
[INFO] Kmeans Cluster 12: 72 elements
[INFO] Kmeans Cluster 13: 183 elements
[INFO] Kmeans Cluster 14: 243 elements
[INFO] Kmeans Cluster 15: 207 elements
[INFO] Kmeans Cluster 16: 112 elements
[INFO] Kmeans Cluster 17: 223 elements
[INFO] Kmeans Cluster 18: 281 elements
[INFO] Kmeans Cluster 19: 186 elements
[INFO] Kmeans Cluster 20: 232 elements
[INFO] Kmeans Cluster 21: 228 elements
[INFO] Kmeans Cluster 22: 218 elements
[INFO] Kmeans Cluster 23: 58 elements
[INFO] Kmeans Cluster 24: 199 elements
[INFO] Kmeans Cluster 25: 157 elements
[INFO] Kmeans Cluster 26: 245 elements
[INFO] Kmeans Cluster 27: 172 elements
[INFO] Kmeans Cluster 28: 363 elements
[INFO] Kmeans Cluster 29: 156 elements
[INFO] Kmeans Cluster 30: 93 elements
[INFO] Kmeans Cluster 31: 259 elements
[INFO] Kmeans Cluster 32: 274 elements
[INFO] Kmeans Cluster 33: 197 elements
[INFO] Kmeans Cluster 34: 227 elements
[INFO] Kmeans Cluster 35: 76 elements
[INFO] Kmeans Cluster 36: 272 elements
[INFO] Kmeans Cluster 37: 94 elements
[INFO] Kmeans Cluster 38: 202 elements
[INFO] Kmeans Cluster 39: 225 elements
[INFO] Kmeans Cluster 40: 56 elements
[INFO] Kmeans Cluster 41: 245 elements
[INFO] Kmeans Cluster 42: 238 elements
[INFO] Kmeans Cluster 43: 239 elements
[INFO] Kmeans Cluster 44: 268 elements
[INFO] Kmeans Cluster 45: 222 elements
[INFO] Kmeans Cluster 46: 216 elements
[INFO] Kmeans Cluster 47: 163 elements
[INFO] Kmeans Cluster 48: 242 elements
[INFO] Kmeans Cluster 49: 179 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=68.14, Long SMA=227.11, Sharpe=0.3924
[INFO] Centroid 1: Short SMA=192.67, Long SMA=273.93, Sharpe=0.2251
[INFO] Centroid 2: Short SMA=122.28, Long SMA=141.40, Sharpe=-0.0346
[INFO] Centroid 3: Short SMA=78.33, Long SMA=138.45, Sharpe=0.3454
[INFO] Centroid 4: Short SMA=66.37, Long SMA=249.98, Sharpe=0.2902
[INFO] Centroid 5: Short SMA=146.87, Long SMA=234.38, Sharpe=0.5320
[INFO] Centroid 6: Short SMA=28.83, Long SMA=71.55, Sharpe=0.2527
[INFO] Centroid 7: Short SMA=143.28, Long SMA=247.11, Sharpe=0.4455
[INFO] Centroid 8: Short SMA=208.13, Long SMA=239.95, Sharpe=0.4228
[INFO] Centroid 9: Short SMA=44.26, Long SMA=183.08, Sharpe=0.5808
[INFO] Centroid 10: Short SMA=94.63, Long SMA=153.33, Sharpe=0.2380
[INFO] Centroid 11: Short SMA=37.86, Long SMA=226.74, Sharpe=0.5059
[INFO] Centroid 12: Short SMA=21.67, Long SMA=42.11, Sharpe=-0.1841
[INFO] Centroid 13: Short SMA=163.34, Long SMA=204.33, Sharpe=0.4713
[INFO] Centroid 14: Short SMA=260.24, Long SMA=290.73, Sharpe=0.3013
[INFO] Centroid 15: Short SMA=102.36, Long SMA=249.95, Sharpe=0.1914
[INFO] Centroid 16: Short SMA=30.18, Long SMA=44.04, Sharpe=0.0155
[INFO] Centroid 17: Short SMA=75.96, Long SMA=111.85, Sharpe=0.2517
[INFO] Centroid 18: Short SMA=119.09, Long SMA=199.73, Sharpe=0.3645
[INFO] Centroid 19: Short SMA=23.01, Long SMA=194.19, Sharpe=0.3649
[INFO] Centroid 20: Short SMA=38.17, Long SMA=102.18, Sharpe=0.4893
[INFO] Centroid 21: Short SMA=127.46, Long SMA=160.96, Sharpe=0.0945
[INFO] Centroid 22: Short SMA=42.21, Long SMA=281.50, Sharpe=0.3187
[INFO] Centroid 23: Short SMA=202.90, Long SMA=215.52, Sharpe=0.1399
[INFO] Centroid 24: Short SMA=31.64, Long SMA=71.18, Sharpe=0.3827
[INFO] Centroid 25: Short SMA=106.41, Long SMA=275.67, Sharpe=0.2761
[INFO] Centroid 26: Short SMA=134.17, Long SMA=172.18, Sharpe=0.2220
[INFO] Centroid 27: Short SMA=166.00, Long SMA=198.10, Sharpe=0.6912
[INFO] Centroid 28: Short SMA=244.12, Long SMA=275.32, Sharpe=0.2045
[INFO] Centroid 29: Short SMA=48.22, Long SMA=69.04, Sharpe=0.1354
[INFO] Centroid 30: Short SMA=241.91, Long SMA=250.65, Sharpe=0.0450
[INFO] Centroid 31: Short SMA=75.83, Long SMA=205.16, Sharpe=0.4697
[INFO] Centroid 32: Short SMA=40.74, Long SMA=156.02, Sharpe=0.4759
[INFO] Centroid 33: Short SMA=15.29, Long SMA=229.41, Sharpe=0.2496
[INFO] Centroid 34: Short SMA=163.95, Long SMA=202.86, Sharpe=0.6030
[INFO] Centroid 35: Short SMA=47.18, Long SMA=185.00, Sharpe=0.7020
[INFO] Centroid 36: Short SMA=177.17, Long SMA=256.88, Sharpe=0.3421
[INFO] Centroid 37: Short SMA=79.77, Long SMA=97.96, Sharpe=0.5034
[INFO] Centroid 38: Short SMA=201.00, Long SMA=226.79, Sharpe=0.3046
[INFO] Centroid 39: Short SMA=34.48, Long SMA=256.32, Sharpe=0.3903
[INFO] Centroid 40: Short SMA=14.29, Long SMA=138.43, Sharpe=0.1240
[INFO] Centroid 41: Short SMA=132.84, Long SMA=278.20, Sharpe=0.4008
[INFO] Centroid 42: Short SMA=32.98, Long SMA=286.17, Sharpe=0.4722
[INFO] Centroid 43: Short SMA=78.50, Long SMA=182.62, Sharpe=0.3825
[INFO] Centroid 44: Short SMA=109.93, Long SMA=226.61, Sharpe=0.3000
[INFO] Centroid 45: Short SMA=210.61, Long SMA=283.35, Sharpe=0.1222
[INFO] Centroid 46: Short SMA=80.52, Long SMA=277.40, Sharpe=0.1968
[INFO] Centroid 47: Short SMA=20.64, Long SMA=144.13, Sharpe=0.2431
[INFO] Centroid 48: Short SMA=39.17, Long SMA=122.31, Sharpe=0.3744
[INFO] Centroid 49: Short SMA=92.92, Long SMA=123.16, Sharpe=0.1425
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9263, Trades=64
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=166, Long SMA=200, Sharpe=0.7515, Trades=16
[INFO] Kmeans Top 2: Short SMA=48, Long SMA=184, Sharpe=0.6866, Trades=13
[INFO] Kmeans Top 3: Short SMA=44, Long SMA=184, Sharpe=0.6381, Trades=13
[INFO] Kmeans Top 4: Short SMA=162, Long SMA=198, Sharpe=0.6363, Trades=14
[INFO] Kmeans Top 5: Short SMA=36, Long SMA=228, Sharpe=0.5674, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (68, 227)
[INFO]   Nearest: (68.0, 228.0)
[INFO]   Rounded: (193, 274)
[INFO]   Nearest: (192.0, 274.0)
[INFO]   Rounded: (122, 141)
[INFO]   Nearest: (122.0, 142.0)
[INFO]   Rounded: (78, 138)
[INFO]   Rounded: (66, 250)
[INFO]   Rounded: (147, 234)
[INFO]   Nearest: (146.0, 234.0)
[INFO]   Rounded: (29, 72)
[INFO]   Nearest: (28.0, 72.0)
[INFO]   Rounded: (143, 247)
[INFO]   Nearest: (144.0, 248.0)
[INFO]   Rounded: (208, 240)
[INFO]   Rounded: (44, 183)
[INFO]   Nearest: (44.0, 184.0)
[INFO]   Rounded: (95, 153)
[INFO]   Nearest: (94.0, 154.0)
[INFO]   Rounded: (38, 227)
[INFO]   Nearest: (38.0, 226.0)
[INFO]   Rounded: (22, 42)
[INFO]   Rounded: (163, 204)
[INFO]   Nearest: (164.0, 204.0)
[INFO]   Rounded: (260, 291)
[INFO]   Nearest: (260.0, 290.0)
[INFO]   Rounded: (102, 250)
[INFO]   Rounded: (30, 44)
[INFO]   Rounded: (76, 112)
[INFO]   Rounded: (119, 200)
[INFO]   Nearest: (120.0, 200.0)
[INFO]   Rounded: (23, 194)
[INFO]   Nearest: (24.0, 194.0)
[INFO]   Rounded: (38, 102)
[INFO]   Rounded: (127, 161)
[INFO]   Nearest: (128.0, 160.0)
[INFO]   Rounded: (42, 281)
[INFO]   Nearest: (42.0, 282.0)
[INFO]   Rounded: (203, 216)
[INFO]   Nearest: (202.0, 216.0)
[INFO]   Rounded: (32, 71)
[INFO]   Nearest: (32.0, 72.0)
[INFO]   Rounded: (106, 276)
[INFO]   Rounded: (134, 172)
[INFO]   Rounded: (166, 198)
[INFO]   Rounded: (244, 275)
[INFO]   Nearest: (244.0, 276.0)
[INFO]   Rounded: (48, 69)
[INFO]   Nearest: (48.0, 70.0)
[INFO]   Rounded: (242, 251)
[INFO]   Nearest: (242.0, 250.0)
[INFO]   Rounded: (76, 205)
[INFO]   Nearest: (76.0, 206.0)
[INFO]   Rounded: (41, 156)
[INFO]   Nearest: (40.0, 156.0)
[INFO]   Rounded: (15, 229)
[INFO]   Nearest: (16.0, 230.0)
[INFO]   Rounded: (164, 203)
[INFO]   Nearest: (164.0, 202.0)
[INFO]   Rounded: (47, 185)
[INFO]   Nearest: (48.0, 184.0)
[INFO]   Rounded: (177, 257)
[INFO]   Nearest: (178.0, 256.0)
[INFO]   Rounded: (80, 98)
[INFO]   Rounded: (201, 227)
[INFO]   Nearest: (202.0, 226.0)
[INFO]   Rounded: (34, 256)
[INFO]   Rounded: (14, 138)
[INFO]   Rounded: (133, 278)
[INFO]   Nearest: (132.0, 278.0)
[INFO]   Rounded: (33, 286)
[INFO]   Nearest: (32.0, 286.0)
[INFO]   Rounded: (78, 183)
[INFO]   Nearest: (78.0, 182.0)
[INFO]   Rounded: (110, 227)
[INFO]   Nearest: (110.0, 226.0)
[INFO]   Rounded: (211, 283)
[INFO]   Nearest: (210.0, 284.0)
[INFO]   Rounded: (81, 277)
[INFO]   Nearest: (80.0, 278.0)
[INFO]   Rounded: (21, 144)
[INFO]   Nearest: (20.0, 144.0)
[INFO]   Rounded: (39, 122)
[INFO]   Nearest: (40.0, 122.0)
[INFO]   Rounded: (93, 123)
[INFO]   Nearest: (92.0, 124.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(166/200) - Original Sharpe: 0.7515, Trades: 16
[INFO] Kmeans cluster 2: SMA(48/184) - Original Sharpe: 0.6866, Trades: 13
[INFO] Kmeans cluster 3: SMA(44/184) - Original Sharpe: 0.6381, Trades: 13
[INFO] Kmeans cluster 4: SMA(162/198) - Original Sharpe: 0.6363, Trades: 14
[INFO] Kmeans cluster 5: SMA(36/228) - Original Sharpe: 0.5674, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (166/200) - Sharpe: 0.7515
[INFO] cluster 2: (48/184) - Sharpe: 0.6866
[INFO] cluster 3: (44/184) - Sharpe: 0.6381
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.457400
2    2022-01-10 2022-01-10            41     2.600539            0.894578
3    2022-03-10 2022-03-10            42     0.191454           -3.737118
4    2022-05-10 2022-05-10            41    -0.735414            0.735414
5    2022-07-10 2022-07-10            44     4.954980           -1.724072
6    2022-09-10 2022-09-10            43     2.825703           -2.825703
7    2022-11-10 2022-11-10            40     1.572256           -3.404264
8    2023-01-10 2023-01-10            41     3.123023            3.293052
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.978898
12   2023-09-10 2023-09-10            44     1.003709            1.003709
13   2023-11-10 2023-11-10            40    -4.602392           -5.140753
14   2024-01-10 2024-01-10            41     1.471174            1.318075
15   2024-03-10 2024-03-10            43    -0.286079            0.926934
16   2024-05-10 2024-05-10            40    -2.453105           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.736674
18   2024-09-10 2024-09-10            44     3.195301           -4.027235
19   2024-11-10 2024-11-10            35     3.533315           -3.533315
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |              0.9 |         -1.7 | False         
[INFO] 2022-03-10   |          0.2 |             -3.7 |         -3.9 | False         
[INFO] 2022-05-10   |         -0.7 |              0.7 |          1.4 | True          
[INFO] 2022-07-10   |          5.0 |             -1.7 |         -6.7 | False         
[INFO] 2022-09-10   |          2.8 |             -2.8 |         -5.6 | False         
[INFO] 2022-11-10   |          1.6 |             -3.4 |         -5.0 | False         
[INFO] 2023-01-10   |          3.1 |              3.3 |          0.2 | True          
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-10   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -4.6 |             -5.1 |         -0.5 | False         
[INFO] 2024-01-10   |          1.5 |              1.3 |         -0.2 | False         
[INFO] 2024-03-10   |         -0.3 |              0.9 |          1.2 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -4.0 |         -7.2 | False         
[INFO] 2024-11-10   |          3.5 |             -3.5 |         -7.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 4 of 13 periods (30.77% win rate)
[INFO] Updating Excel file with Kmeans results for S...
[INFO] Excel file updated successfully. Added S with Kmeans win rate 30.8% in row 43
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(166/200) - Original Sharpe: 0.7515
[INFO] Added cluster 2 to portfolio: SMA(48/184) - Original Sharpe: 0.6866
[INFO] Added cluster 3 to portfolio: SMA(44/184) - Original Sharpe: 0.6381
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'S_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3515
[INFO] Kmeans Best out-of-sample Sharpe: 0.9709
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for S...
[INFO] Excel file updated successfully. Added S with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\S
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5070 to 0.9263
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.926274
[INFO] Number of Trades: 64
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10118 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5070 to 0.9263
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3602 to 2.7902
[INFO] Scaled Long SMA range: -2.7801 to 1.4751
[INFO] Scaled Sharpe ratio range: -5.3285 to 3.8001
[INFO] Scaled Trades range: -0.6229 to 16.0045
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10118 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4517
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 525 elements
[INFO] Cluster 1: 48 elements
[INFO] Cluster 2: 349 elements
[INFO] Cluster 3: 374 elements
[INFO] Cluster 4: 492 elements
[INFO] Cluster 5: 467 elements
[INFO] Cluster 6: 355 elements
[INFO] Cluster 7: 301 elements
[INFO] Cluster 8: 271 elements
[INFO] Cluster 9: 66 elements
[INFO] Cluster 10: 337 elements
[INFO] Cluster 11: 267 elements
[INFO] Cluster 12: 147 elements
[INFO] Cluster 13: 309 elements
[INFO] Cluster 14: 259 elements
[INFO] Cluster 15: 324 elements
[INFO] Cluster 16: 251 elements
[INFO] Cluster 17: 118 elements
[INFO] Cluster 18: 84 elements
[INFO] Cluster 19: 366 elements
[INFO] Cluster 20: 57 elements
[INFO] Cluster 21: 233 elements
[INFO] Cluster 22: 505 elements
[INFO] Cluster 23: 163 elements
[INFO] Cluster 24: 211 elements
[INFO] Cluster 25: 77 elements
[INFO] Cluster 26: 88 elements
[INFO] Cluster 27: 43 elements
[INFO] Cluster 28: 125 elements
[INFO] Cluster 29: 235 elements
[INFO] Cluster 30: 79 elements
[INFO] Cluster 31: 66 elements
[INFO] Cluster 32: 224 elements
[INFO] Cluster 33: 269 elements
[INFO] Cluster 34: 276 elements
[INFO] Cluster 35: 45 elements
[INFO] Cluster 36: 118 elements
[INFO] Cluster 37: 143 elements
[INFO] Cluster 38: 136 elements
[INFO] Cluster 39: 277 elements
[INFO] Cluster 40: 13 elements
[INFO] Cluster 41: 18 elements
[INFO] Cluster 42: 3 elements
[INFO] Cluster 43: 138 elements
[INFO] Cluster 44: 297 elements
[INFO] Cluster 45: 209 elements
[INFO] Cluster 46: 230 elements
[INFO] Cluster 47: 27 elements
[INFO] Cluster 48: 76 elements
[INFO] Cluster 49: 27 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=186, Long SMA=250, Sharpe=0.2936, Trades=10
[INFO] Cluster 1 cluster: Short SMA=28, Long SMA=32, Sharpe=-0.0045, Trades=140
[INFO] Cluster 2 cluster: Short SMA=44, Long SMA=94, Sharpe=0.5105, Trades=26
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=268, Sharpe=0.3323, Trades=18
[INFO] Cluster 4 cluster: Short SMA=108, Long SMA=210, Sharpe=0.2624, Trades=13
[INFO] Cluster 5 cluster: Short SMA=72, Long SMA=196, Sharpe=0.4252, Trades=14
[INFO] Cluster 6 cluster: Short SMA=76, Long SMA=130, Sharpe=0.2757, Trades=24
[INFO] Cluster 7 cluster: Short SMA=206, Long SMA=274, Sharpe=0.2027, Trades=10
[INFO] Cluster 8 cluster: Short SMA=16, Long SMA=222, Sharpe=0.1902, Trades=26
[INFO] Cluster 9 cluster: Short SMA=176, Long SMA=182, Sharpe=0.7296, Trades=49
[INFO] Cluster 10 cluster: Short SMA=142, Long SMA=234, Sharpe=0.5013, Trades=12
[INFO] Cluster 11 cluster: Short SMA=264, Long SMA=288, Sharpe=0.2482, Trades=12
[INFO] Cluster 12 cluster: Short SMA=116, Long SMA=130, Sharpe=0.2942, Trades=32
[INFO] Cluster 13 cluster: Short SMA=126, Long SMA=174, Sharpe=0.2550, Trades=19
[INFO] Cluster 14 cluster: Short SMA=32, Long SMA=72, Sharpe=0.3697, Trades=40
[INFO] Cluster 15 cluster: Short SMA=128, Long SMA=276, Sharpe=0.4893, Trades=14
[INFO] Cluster 16 cluster: Short SMA=200, Long SMA=236, Sharpe=0.4727, Trades=12
[INFO] Cluster 17 cluster: Short SMA=244, Long SMA=254, Sharpe=0.1249, Trades=24
[INFO] Cluster 18 cluster: Short SMA=26, Long SMA=52, Sharpe=0.2389, Trades=60
[INFO] Cluster 19 cluster: Short SMA=220, Long SMA=282, Sharpe=0.1204, Trades=10
[INFO] Cluster 20 cluster: Short SMA=102, Long SMA=104, Sharpe=0.3028, Trades=90
[INFO] Cluster 21 cluster: Short SMA=122, Long SMA=158, Sharpe=0.0952, Trades=18
[INFO] Cluster 22 cluster: Short SMA=96, Long SMA=268, Sharpe=0.2692, Trades=13
[INFO] Cluster 23 cluster: Short SMA=14, Long SMA=148, Sharpe=0.2394, Trades=32
[INFO] Cluster 24 cluster: Short SMA=40, Long SMA=134, Sharpe=0.4244, Trades=19
[INFO] Cluster 25 cluster: Short SMA=196, Long SMA=204, Sharpe=0.2884, Trades=40
[INFO] Cluster 26 cluster: Short SMA=30, Long SMA=54, Sharpe=0.4075, Trades=58
[INFO] Cluster 27 cluster: Short SMA=30, Long SMA=38, Sharpe=0.2313, Trades=100
[INFO] Cluster 28 cluster: Short SMA=168, Long SMA=190, Sharpe=0.6195, Trades=22
[INFO] Cluster 29 cluster: Short SMA=36, Long SMA=120, Sharpe=0.3139, Trades=21
[INFO] Cluster 30 cluster: Short SMA=132, Long SMA=140, Sharpe=0.0391, Trades=48
[INFO] Cluster 31 cluster: Short SMA=14, Long SMA=42, Sharpe=-0.2525, Trades=82
[INFO] Cluster 32 cluster: Short SMA=54, Long SMA=208, Sharpe=0.5139, Trades=13
[INFO] Cluster 33 cluster: Short SMA=72, Long SMA=238, Sharpe=0.3442, Trades=13
[INFO] Cluster 34 cluster: Short SMA=28, Long SMA=276, Sharpe=0.4571, Trades=16
[INFO] Cluster 35 cluster: Short SMA=212, Long SMA=216, Sharpe=0.1147, Trades=52
[INFO] Cluster 36 cluster: Short SMA=90, Long SMA=116, Sharpe=0.0344, Trades=30
[INFO] Cluster 37 cluster: Short SMA=46, Long SMA=184, Sharpe=0.6988, Trades=13
[INFO] Cluster 38 cluster: Short SMA=28, Long SMA=198, Sharpe=0.3428, Trades=19
[INFO] Cluster 39 cluster: Short SMA=76, Long SMA=140, Sharpe=0.2883, Trades=20
[INFO] Cluster 43 cluster: Short SMA=160, Long SMA=206, Sharpe=0.6884, Trades=14
[INFO] Cluster 44 cluster: Short SMA=64, Long SMA=262, Sharpe=0.2398, Trades=15
[INFO] Cluster 45 cluster: Short SMA=40, Long SMA=166, Sharpe=0.4420, Trades=15
[INFO] Cluster 46 cluster: Short SMA=156, Long SMA=222, Sharpe=0.6021, Trades=12
[INFO] Cluster 47 cluster: Short SMA=16, Long SMA=30, Sharpe=-0.0556, Trades=100
[INFO] Cluster 48 cluster: Short SMA=58, Long SMA=70, Sharpe=-0.0447, Trades=50
[INFO] Cluster 49 cluster: Short SMA=280, Long SMA=282, Sharpe=0.3182, Trades=42
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9263, Trades=64
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=176, Long SMA=182, Sharpe=0.7296, Trades=49
[INFO] Top 2: Short SMA=46, Long SMA=184, Sharpe=0.6988, Trades=13
[INFO] Top 3: Short SMA=160, Long SMA=206, Sharpe=0.6884, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10084 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(176/182) - Original Sharpe: 0.7296, Trades: 49
[INFO] Hierarchical cluster 2: SMA(46/184) - Original Sharpe: 0.6988, Trades: 13
[INFO] Hierarchical cluster 3: SMA(160/206) - Original Sharpe: 0.6884, Trades: 14
[INFO] Hierarchical cluster 4: SMA(168/190) - Original Sharpe: 0.6195, Trades: 22
[INFO] Hierarchical cluster 5: SMA(156/222) - Original Sharpe: 0.6021, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (176/182) - Sharpe: 0.7296
[INFO] cluster 2: (46/184) - Sharpe: 0.6988
[INFO] cluster 3: (160/206) - Sharpe: 0.6884
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.457400
2    2022-01-10 2022-01-10            41     2.600539            3.589524
3    2022-03-10 2022-03-10            42     0.191454           -1.283318
4    2022-05-10 2022-05-10            41    -0.735414            2.726310
5    2022-07-10 2022-07-10            44     4.954980           -0.331299
6    2022-09-10 2022-09-10            43     2.825703            2.825703
7    2022-11-10 2022-11-10            40     1.572256            0.384571
8    2023-01-10 2023-01-10            41     3.123023            2.334728
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.978898
12   2023-09-10 2023-09-10            44     1.003709            1.003709
13   2023-11-10 2023-11-10            40    -4.602392           -4.718006
14   2024-01-10 2024-01-10            41     1.471174            1.470234
15   2024-03-10 2024-03-10            43    -0.286079            2.103984
16   2024-05-10 2024-05-10            40    -2.453105           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.732101
18   2024-09-10 2024-09-10            44     3.195301           -2.491589
19   2024-11-10 2024-11-10            35     3.533315            4.167585
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |              3.6 |          1.0 | True          
[INFO] 2022-03-10   |          0.2 |             -1.3 |         -1.5 | False         
[INFO] 2022-05-10   |         -0.7 |              2.7 |          3.4 | True          
[INFO] 2022-07-10   |          5.0 |             -0.3 |         -5.3 | False         
[INFO] 2022-09-10   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-10   |          1.6 |              0.4 |         -1.2 | False         
[INFO] 2023-01-10   |          3.1 |              2.3 |         -0.8 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-10   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -4.6 |             -4.7 |         -0.1 | False         
[INFO] 2024-01-10   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -0.3 |              2.1 |          2.4 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -2.5 |         -5.7 | False         
[INFO] 2024-11-10   |          3.5 |              4.2 |          0.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-09-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2024-01-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 11 periods (45.45% win rate)
[INFO] Updating Excel file with Hierarchical results for S...
[INFO] Excel file updated successfully. Added S with Hierarchical win rate 45.5% in row 43
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(176/182) - Original Sharpe: 0.7296
[INFO] Added cluster 2 to portfolio: SMA(46/184) - Original Sharpe: 0.6988
[INFO] Added cluster 3 to portfolio: SMA(160/206) - Original Sharpe: 0.6884
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'S_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3556
[INFO] Hierarchical Best out-of-sample Sharpe: 0.9709
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for S...
[INFO] Excel file updated successfully. Added S with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\S
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SB in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 130.43s
[INFO] Best parameters: Short SMA = 180, Long SMA = 184
[INFO] Best Sharpe ratio: 0.927384, Trades: 64
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SB
[INFO] Big Point Value (from data): 1120.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 14.27 contracts
[INFO] Maximum Position Size: 30 contracts
[INFO] Strategy Total P&L: $740,320.00
[INFO] Market Buy & Hold P&L: $-3,248.00
[INFO] Outperformance: $743,568.00
[INFO] Sharpe ratio (entire period, annualized): 0.940831
[INFO] Sharpe ratio (in-sample, annualized): 0.927384
[INFO] Sharpe ratio (out-of-sample, annualized): 0.972353
[INFO] Maximum Drawdown: $93,032.80
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 37
[INFO] Out-of-sample period trades: 27
[INFO] Total trades: 64
[INFO] In-sample P&L: $473,648.00
[INFO] Out-of-sample P&L: $208,992.00
[INFO] 
Best parameters from GA: Short SMA = 180, Long SMA = 184, Sharpe = 0.927384
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5052 to 0.9274
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.927384
[INFO] Number of Trades: 64
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10118 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5052 to 0.9274
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3602 to 2.7902
[INFO] Scaled Long SMA range: -2.7801 to 1.4751
[INFO] Scaled Sharpe ratio range: -5.3247 to 3.8078
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 310 elements
[INFO] Kmeans Cluster 1: 217 elements
[INFO] Kmeans Cluster 2: 177 elements
[INFO] Kmeans Cluster 3: 260 elements
[INFO] Kmeans Cluster 4: 239 elements
[INFO] Kmeans Cluster 5: 184 elements
[INFO] Kmeans Cluster 6: 234 elements
[INFO] Kmeans Cluster 7: 207 elements
[INFO] Kmeans Cluster 8: 228 elements
[INFO] Kmeans Cluster 9: 287 elements
[INFO] Kmeans Cluster 10: 151 elements
[INFO] Kmeans Cluster 11: 111 elements
[INFO] Kmeans Cluster 12: 281 elements
[INFO] Kmeans Cluster 13: 192 elements
[INFO] Kmeans Cluster 14: 186 elements
[INFO] Kmeans Cluster 15: 84 elements
[INFO] Kmeans Cluster 16: 121 elements
[INFO] Kmeans Cluster 17: 184 elements
[INFO] Kmeans Cluster 18: 245 elements
[INFO] Kmeans Cluster 19: 278 elements
[INFO] Kmeans Cluster 20: 245 elements
[INFO] Kmeans Cluster 21: 199 elements
[INFO] Kmeans Cluster 22: 305 elements
[INFO] Kmeans Cluster 23: 162 elements
[INFO] Kmeans Cluster 24: 281 elements
[INFO] Kmeans Cluster 25: 286 elements
[INFO] Kmeans Cluster 26: 72 elements
[INFO] Kmeans Cluster 27: 214 elements
[INFO] Kmeans Cluster 28: 173 elements
[INFO] Kmeans Cluster 29: 187 elements
[INFO] Kmeans Cluster 30: 199 elements
[INFO] Kmeans Cluster 31: 158 elements
[INFO] Kmeans Cluster 32: 196 elements
[INFO] Kmeans Cluster 33: 306 elements
[INFO] Kmeans Cluster 34: 178 elements
[INFO] Kmeans Cluster 35: 156 elements
[INFO] Kmeans Cluster 36: 282 elements
[INFO] Kmeans Cluster 37: 77 elements
[INFO] Kmeans Cluster 38: 52 elements
[INFO] Kmeans Cluster 39: 227 elements
[INFO] Kmeans Cluster 40: 251 elements
[INFO] Kmeans Cluster 41: 219 elements
[INFO] Kmeans Cluster 42: 260 elements
[INFO] Kmeans Cluster 43: 130 elements
[INFO] Kmeans Cluster 44: 159 elements
[INFO] Kmeans Cluster 45: 267 elements
[INFO] Kmeans Cluster 46: 241 elements
[INFO] Kmeans Cluster 47: 161 elements
[INFO] Kmeans Cluster 48: 137 elements
[INFO] Kmeans Cluster 49: 162 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=73.86, Long SMA=207.36, Sharpe=0.4611
[INFO] Centroid 1: Short SMA=89.50, Long SMA=122.45, Sharpe=0.1584
[INFO] Centroid 2: Short SMA=190.25, Long SMA=275.93, Sharpe=0.2212
[INFO] Centroid 3: Short SMA=32.86, Long SMA=275.47, Sharpe=0.3560
[INFO] Centroid 4: Short SMA=129.93, Long SMA=169.41, Sharpe=0.1966
[INFO] Centroid 5: Short SMA=165.84, Long SMA=197.17, Sharpe=0.6881
[INFO] Centroid 6: Short SMA=111.62, Long SMA=206.63, Sharpe=0.3862
[INFO] Centroid 7: Short SMA=102.68, Long SMA=249.81, Sharpe=0.1949
[INFO] Centroid 8: Short SMA=43.68, Long SMA=133.20, Sharpe=0.3338
[INFO] Centroid 9: Short SMA=176.45, Long SMA=255.78, Sharpe=0.3456
[INFO] Centroid 10: Short SMA=269.67, Long SMA=288.42, Sharpe=0.2320
[INFO] Centroid 11: Short SMA=121.69, Long SMA=139.14, Sharpe=-0.0384
[INFO] Centroid 12: Short SMA=38.90, Long SMA=154.98, Sharpe=0.4748
[INFO] Centroid 13: Short SMA=30.44, Long SMA=81.49, Sharpe=0.2951
[INFO] Centroid 14: Short SMA=208.62, Long SMA=285.85, Sharpe=0.1160
[INFO] Centroid 15: Short SMA=47.24, Long SMA=185.74, Sharpe=0.6961
[INFO] Centroid 16: Short SMA=29.34, Long SMA=46.69, Sharpe=0.0208
[INFO] Centroid 17: Short SMA=22.68, Long SMA=194.11, Sharpe=0.3634
[INFO] Centroid 18: Short SMA=85.32, Long SMA=116.96, Sharpe=0.2802
[INFO] Centroid 19: Short SMA=107.68, Long SMA=227.65, Sharpe=0.3022
[INFO] Centroid 20: Short SMA=33.18, Long SMA=284.00, Sharpe=0.4729
[INFO] Centroid 21: Short SMA=48.23, Long SMA=99.75, Sharpe=0.5211
[INFO] Centroid 22: Short SMA=132.92, Long SMA=273.71, Sharpe=0.4072
[INFO] Centroid 23: Short SMA=28.89, Long SMA=64.36, Sharpe=0.2171
[INFO] Centroid 24: Short SMA=207.81, Long SMA=238.98, Sharpe=0.4140
[INFO] Centroid 25: Short SMA=78.69, Long SMA=173.80, Sharpe=0.3765
[INFO] Centroid 26: Short SMA=21.67, Long SMA=42.11, Sharpe=-0.1820
[INFO] Centroid 27: Short SMA=127.07, Long SMA=159.33, Sharpe=0.0825
[INFO] Centroid 28: Short SMA=16.72, Long SMA=144.56, Sharpe=0.2019
[INFO] Centroid 29: Short SMA=81.38, Long SMA=277.98, Sharpe=0.1863
[INFO] Centroid 30: Short SMA=15.30, Long SMA=230.18, Sharpe=0.2502
[INFO] Centroid 31: Short SMA=131.65, Long SMA=186.75, Sharpe=0.3135
[INFO] Centroid 32: Short SMA=37.40, Long SMA=226.97, Sharpe=0.5046
[INFO] Centroid 33: Short SMA=64.18, Long SMA=260.34, Sharpe=0.2796
[INFO] Centroid 34: Short SMA=230.02, Long SMA=270.67, Sharpe=0.2602
[INFO] Centroid 35: Short SMA=195.79, Long SMA=219.85, Sharpe=0.2832
[INFO] Centroid 36: Short SMA=147.59, Long SMA=237.49, Sharpe=0.4962
[INFO] Centroid 37: Short SMA=247.66, Long SMA=256.83, Sharpe=0.0568
[INFO] Centroid 38: Short SMA=204.31, Long SMA=213.42, Sharpe=0.0742
[INFO] Centroid 39: Short SMA=236.83, Long SMA=271.35, Sharpe=0.1778
[INFO] Centroid 40: Short SMA=53.76, Long SMA=239.38, Sharpe=0.3784
[INFO] Centroid 41: Short SMA=44.57, Long SMA=182.74, Sharpe=0.5773
[INFO] Centroid 42: Short SMA=55.62, Long SMA=111.53, Sharpe=0.4223
[INFO] Centroid 43: Short SMA=53.03, Long SMA=72.42, Sharpe=0.1319
[INFO] Centroid 44: Short SMA=163.32, Long SMA=200.05, Sharpe=0.4734
[INFO] Centroid 45: Short SMA=90.74, Long SMA=154.64, Sharpe=0.2454
[INFO] Centroid 46: Short SMA=162.88, Long SMA=207.79, Sharpe=0.5995
[INFO] Centroid 47: Short SMA=30.42, Long SMA=68.90, Sharpe=0.3990
[INFO] Centroid 48: Short SMA=259.34, Long SMA=291.58, Sharpe=0.3318
[INFO] Centroid 49: Short SMA=106.22, Long SMA=275.72, Sharpe=0.2749
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9274, Trades=64
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=46, Long SMA=186, Sharpe=0.7288, Trades=13
[INFO] Kmeans Top 2: Short SMA=166, Long SMA=198, Sharpe=0.6611, Trades=16
[INFO] Kmeans Top 3: Short SMA=162, Long SMA=210, Sharpe=0.6397, Trades=14
[INFO] Kmeans Top 4: Short SMA=42, Long SMA=182, Sharpe=0.5831, Trades=13
[INFO] Kmeans Top 5: Short SMA=148, Long SMA=236, Sharpe=0.5690, Trades=14
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (74, 207)
[INFO]   Nearest: (74.0, 208.0)
[INFO]   Rounded: (90, 122)
[INFO]   Rounded: (190, 276)
[INFO]   Rounded: (33, 275)
[INFO]   Nearest: (32.0, 276.0)
[INFO]   Rounded: (130, 169)
[INFO]   Nearest: (130.0, 170.0)
[INFO]   Rounded: (166, 197)
[INFO]   Nearest: (166.0, 198.0)
[INFO]   Rounded: (112, 207)
[INFO]   Nearest: (112.0, 206.0)
[INFO]   Rounded: (103, 250)
[INFO]   Nearest: (102.0, 250.0)
[INFO]   Rounded: (44, 133)
[INFO]   Nearest: (44.0, 134.0)
[INFO]   Rounded: (176, 256)
[INFO]   Rounded: (270, 288)
[INFO]   Rounded: (122, 139)
[INFO]   Nearest: (122.0, 140.0)
[INFO]   Rounded: (39, 155)
[INFO]   Nearest: (38.0, 154.0)
[INFO]   Rounded: (30, 81)
[INFO]   Nearest: (30.0, 82.0)
[INFO]   Rounded: (209, 286)
[INFO]   Nearest: (208.0, 286.0)
[INFO]   Rounded: (47, 186)
[INFO]   Nearest: (48.0, 186.0)
[INFO]   Rounded: (29, 47)
[INFO]   Nearest: (30.0, 46.0)
[INFO]   Rounded: (23, 194)
[INFO]   Nearest: (22.0, 194.0)
[INFO]   Rounded: (85, 117)
[INFO]   Nearest: (86.0, 116.0)
[INFO]   Rounded: (108, 228)
[INFO]   Rounded: (33, 284)
[INFO]   Nearest: (34.0, 284.0)
[INFO]   Rounded: (48, 100)
[INFO]   Rounded: (133, 274)
[INFO]   Nearest: (132.0, 274.0)
[INFO]   Rounded: (29, 64)
[INFO]   Nearest: (28.0, 64.0)
[INFO]   Rounded: (208, 239)
[INFO]   Nearest: (208.0, 238.0)
[INFO]   Rounded: (79, 174)
[INFO]   Nearest: (78.0, 174.0)
[INFO]   Rounded: (22, 42)
[INFO]   Rounded: (127, 159)
[INFO]   Nearest: (128.0, 160.0)
[INFO]   Rounded: (17, 145)
[INFO]   Nearest: (16.0, 144.0)
[INFO]   Rounded: (81, 278)
[INFO]   Nearest: (82.0, 278.0)
[INFO]   Rounded: (15, 230)
[INFO]   Nearest: (16.0, 230.0)
[INFO]   Rounded: (132, 187)
[INFO]   Nearest: (132.0, 186.0)
[INFO]   Rounded: (37, 227)
[INFO]   Nearest: (38.0, 226.0)
[INFO]   Rounded: (64, 260)
[INFO]   Rounded: (230, 271)
[INFO]   Nearest: (230.0, 270.0)
[INFO]   Rounded: (196, 220)
[INFO]   Rounded: (148, 237)
[INFO]   Nearest: (148.0, 238.0)
[INFO]   Rounded: (248, 257)
[INFO]   Nearest: (248.0, 256.0)
[INFO]   Rounded: (204, 213)
[INFO]   Nearest: (204.0, 214.0)
[INFO]   Rounded: (237, 271)
[INFO]   Nearest: (236.0, 272.0)
[INFO]   Rounded: (54, 239)
[INFO]   Nearest: (54.0, 240.0)
[INFO]   Rounded: (45, 183)
[INFO]   Nearest: (44.0, 182.0)
[INFO]   Rounded: (56, 112)
[INFO]   Rounded: (53, 72)
[INFO]   Nearest: (54.0, 72.0)
[INFO]   Rounded: (163, 200)
[INFO]   Nearest: (164.0, 200.0)
[INFO]   Rounded: (91, 155)
[INFO]   Nearest: (90.0, 154.0)
[INFO]   Rounded: (163, 208)
[INFO]   Nearest: (162.0, 208.0)
[INFO]   Rounded: (30, 69)
[INFO]   Nearest: (30.0, 68.0)
[INFO]   Rounded: (259, 292)
[INFO]   Nearest: (260.0, 292.0)
[INFO]   Rounded: (106, 276)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(46/186) - Original Sharpe: 0.7288, Trades: 13
[INFO] Kmeans cluster 2: SMA(166/198) - Original Sharpe: 0.6611, Trades: 16
[INFO] Kmeans cluster 3: SMA(162/210) - Original Sharpe: 0.6397, Trades: 14
[INFO] Kmeans cluster 4: SMA(42/182) - Original Sharpe: 0.5831, Trades: 13
[INFO] Kmeans cluster 5: SMA(148/236) - Original Sharpe: 0.5690, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (46/186) - Sharpe: 0.7288
[INFO] cluster 2: (166/198) - Sharpe: 0.6611
[INFO] cluster 3: (162/210) - Sharpe: 0.6397
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.457400
2    2022-01-10 2022-01-10            41     2.600539            3.589819
3    2022-03-10 2022-03-10            42     0.192786           -1.095916
4    2022-05-10 2022-05-10            41    -0.735414           -0.735414
5    2022-07-10 2022-07-10            44     4.961128           -0.058301
6    2022-09-10 2022-09-10            43     2.825703            2.825703
7    2022-11-10 2022-11-10            40     1.576583           -0.733974
8    2023-01-10 2023-01-10            41     3.128890            0.983827
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.978898
12   2023-09-10 2023-09-10            44     1.003709            1.003709
13   2023-11-10 2023-11-10            40    -4.602392           -5.059174
14   2024-01-10 2024-01-10            41     1.473702            3.267181
15   2024-03-10 2024-03-10            43    -0.280949           -1.929022
16   2024-05-10 2024-05-10            40    -2.452361           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.736674
18   2024-09-10 2024-09-10            44     3.198404           -3.205418
19   2024-11-10 2024-11-10            35     3.533315            3.533315
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |              3.6 |          1.0 | True          
[INFO] 2022-03-10   |          0.2 |             -1.1 |         -1.3 | False         
[INFO] 2022-05-10   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2022-07-10   |          5.0 |             -0.1 |         -5.1 | False         
[INFO] 2022-09-10   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-10   |          1.6 |             -0.7 |         -2.3 | False         
[INFO] 2023-01-10   |          3.1 |              1.0 |         -2.1 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-10   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -4.6 |             -5.1 |         -0.5 | False         
[INFO] 2024-01-10   |          1.5 |              3.3 |          1.8 | True          
[INFO] 2024-03-10   |         -0.3 |             -1.9 |         -1.6 | False         
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -3.2 |         -6.4 | False         
[INFO] 2024-11-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-05-10, 2022-09-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2024-07-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Kmeans cluster wins (rounded comparison): 3 of 10 periods (30.00% win rate)
[INFO] Updating Excel file with Kmeans results for SB...
[INFO] Excel file updated successfully. Added SB with Kmeans win rate 30.0% in row 44
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(46/186) - Original Sharpe: 0.7288
[INFO] Added cluster 2 to portfolio: SMA(166/198) - Original Sharpe: 0.6611
[INFO] Added cluster 3 to portfolio: SMA(162/210) - Original Sharpe: 0.6397
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SB_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0402
[INFO] Kmeans Best out-of-sample Sharpe: 0.9724
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for SB...
[INFO] Excel file updated successfully. Added SB with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SB
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5052 to 0.9274
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.927384
[INFO] Number of Trades: 64
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10118 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5052 to 0.9274
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3602 to 2.7902
[INFO] Scaled Long SMA range: -2.7801 to 1.4751
[INFO] Scaled Sharpe ratio range: -5.3247 to 3.8078
[INFO] Scaled Trades range: -0.6229 to 16.0045
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10118 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4517
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 145 elements
[INFO] Cluster 1: 525 elements
[INFO] Cluster 2: 391 elements
[INFO] Cluster 3: 48 elements
[INFO] Cluster 4: 66 elements
[INFO] Cluster 5: 414 elements
[INFO] Cluster 6: 271 elements
[INFO] Cluster 7: 175 elements
[INFO] Cluster 8: 467 elements
[INFO] Cluster 9: 301 elements
[INFO] Cluster 10: 355 elements
[INFO] Cluster 11: 77 elements
[INFO] Cluster 12: 88 elements
[INFO] Cluster 13: 276 elements
[INFO] Cluster 14: 147 elements
[INFO] Cluster 15: 251 elements
[INFO] Cluster 16: 337 elements
[INFO] Cluster 17: 507 elements
[INFO] Cluster 18: 224 elements
[INFO] Cluster 19: 57 elements
[INFO] Cluster 20: 125 elements
[INFO] Cluster 21: 309 elements
[INFO] Cluster 22: 267 elements
[INFO] Cluster 23: 163 elements
[INFO] Cluster 24: 43 elements
[INFO] Cluster 25: 84 elements
[INFO] Cluster 26: 259 elements
[INFO] Cluster 27: 236 elements
[INFO] Cluster 28: 13 elements
[INFO] Cluster 29: 307 elements
[INFO] Cluster 30: 66 elements
[INFO] Cluster 31: 324 elements
[INFO] Cluster 32: 91 elements
[INFO] Cluster 33: 235 elements
[INFO] Cluster 34: 143 elements
[INFO] Cluster 35: 45 elements
[INFO] Cluster 36: 295 elements
[INFO] Cluster 37: 103 elements
[INFO] Cluster 38: 136 elements
[INFO] Cluster 39: 277 elements
[INFO] Cluster 40: 366 elements
[INFO] Cluster 41: 18 elements
[INFO] Cluster 42: 3 elements
[INFO] Cluster 43: 297 elements
[INFO] Cluster 44: 138 elements
[INFO] Cluster 45: 203 elements
[INFO] Cluster 46: 230 elements
[INFO] Cluster 47: 27 elements
[INFO] Cluster 48: 76 elements
[INFO] Cluster 49: 117 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=248, Long SMA=258, Sharpe=-0.0389, Trades=23
[INFO] Cluster 1 cluster: Short SMA=186, Long SMA=250, Sharpe=0.2938, Trades=10
[INFO] Cluster 2 cluster: Short SMA=38, Long SMA=118, Sharpe=0.4278, Trades=21
[INFO] Cluster 3 cluster: Short SMA=28, Long SMA=32, Sharpe=-0.0016, Trades=140
[INFO] Cluster 4 cluster: Short SMA=176, Long SMA=182, Sharpe=0.7303, Trades=49
[INFO] Cluster 5 cluster: Short SMA=38, Long SMA=252, Sharpe=0.4071, Trades=14
[INFO] Cluster 6 cluster: Short SMA=16, Long SMA=222, Sharpe=0.1907, Trades=26
[INFO] Cluster 7 cluster: Short SMA=54, Long SMA=88, Sharpe=0.4530, Trades=34
[INFO] Cluster 8 cluster: Short SMA=72, Long SMA=196, Sharpe=0.4254, Trades=14
[INFO] Cluster 9 cluster: Short SMA=206, Long SMA=274, Sharpe=0.2029, Trades=10
[INFO] Cluster 10 cluster: Short SMA=76, Long SMA=130, Sharpe=0.2763, Trades=24
[INFO] Cluster 11 cluster: Short SMA=196, Long SMA=204, Sharpe=0.2891, Trades=40
[INFO] Cluster 12 cluster: Short SMA=30, Long SMA=54, Sharpe=0.4088, Trades=58
[INFO] Cluster 13 cluster: Short SMA=28, Long SMA=276, Sharpe=0.4574, Trades=16
[INFO] Cluster 14 cluster: Short SMA=116, Long SMA=130, Sharpe=0.2949, Trades=32
[INFO] Cluster 15 cluster: Short SMA=200, Long SMA=236, Sharpe=0.4729, Trades=12
[INFO] Cluster 16 cluster: Short SMA=142, Long SMA=234, Sharpe=0.5015, Trades=12
[INFO] Cluster 17 cluster: Short SMA=96, Long SMA=268, Sharpe=0.2695, Trades=13
[INFO] Cluster 18 cluster: Short SMA=54, Long SMA=208, Sharpe=0.5141, Trades=13
[INFO] Cluster 19 cluster: Short SMA=102, Long SMA=104, Sharpe=0.3049, Trades=90
[INFO] Cluster 20 cluster: Short SMA=168, Long SMA=190, Sharpe=0.6199, Trades=22
[INFO] Cluster 21 cluster: Short SMA=126, Long SMA=174, Sharpe=0.2554, Trades=19
[INFO] Cluster 22 cluster: Short SMA=264, Long SMA=288, Sharpe=0.2485, Trades=12
[INFO] Cluster 23 cluster: Short SMA=14, Long SMA=148, Sharpe=0.2402, Trades=32
[INFO] Cluster 24 cluster: Short SMA=30, Long SMA=38, Sharpe=0.2332, Trades=100
[INFO] Cluster 25 cluster: Short SMA=26, Long SMA=52, Sharpe=0.2402, Trades=60
[INFO] Cluster 26 cluster: Short SMA=32, Long SMA=72, Sharpe=0.3705, Trades=40
[INFO] Cluster 27 cluster: Short SMA=122, Long SMA=158, Sharpe=0.0956, Trades=18
[INFO] Cluster 29 cluster: Short SMA=104, Long SMA=228, Sharpe=0.3052, Trades=13
[INFO] Cluster 30 cluster: Short SMA=14, Long SMA=42, Sharpe=-0.2509, Trades=82
[INFO] Cluster 31 cluster: Short SMA=128, Long SMA=276, Sharpe=0.4896, Trades=14
[INFO] Cluster 32 cluster: Short SMA=128, Long SMA=138, Sharpe=-0.2254, Trades=45
[INFO] Cluster 33 cluster: Short SMA=36, Long SMA=120, Sharpe=0.3144, Trades=21
[INFO] Cluster 34 cluster: Short SMA=46, Long SMA=184, Sharpe=0.6990, Trades=13
[INFO] Cluster 35 cluster: Short SMA=212, Long SMA=216, Sharpe=0.1159, Trades=52
[INFO] Cluster 36 cluster: Short SMA=64, Long SMA=262, Sharpe=0.2400, Trades=15
[INFO] Cluster 37 cluster: Short SMA=86, Long SMA=114, Sharpe=0.0817, Trades=30
[INFO] Cluster 38 cluster: Short SMA=28, Long SMA=198, Sharpe=0.3432, Trades=19
[INFO] Cluster 39 cluster: Short SMA=76, Long SMA=140, Sharpe=0.2888, Trades=20
[INFO] Cluster 40 cluster: Short SMA=220, Long SMA=282, Sharpe=0.1206, Trades=10
[INFO] Cluster 43 cluster: Short SMA=104, Long SMA=196, Sharpe=0.3596, Trades=13
[INFO] Cluster 44 cluster: Short SMA=160, Long SMA=206, Sharpe=0.6886, Trades=14
[INFO] Cluster 45 cluster: Short SMA=40, Long SMA=166, Sharpe=0.4423, Trades=15
[INFO] Cluster 46 cluster: Short SMA=156, Long SMA=222, Sharpe=0.6024, Trades=12
[INFO] Cluster 47 cluster: Short SMA=16, Long SMA=30, Sharpe=-0.0535, Trades=100
[INFO] Cluster 48 cluster: Short SMA=58, Long SMA=70, Sharpe=-0.0436, Trades=50
[INFO] Cluster 49 cluster: Short SMA=50, Long SMA=292, Sharpe=0.3697, Trades=10
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9274, Trades=64
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=176, Long SMA=182, Sharpe=0.7303, Trades=49
[INFO] Top 2: Short SMA=46, Long SMA=184, Sharpe=0.6990, Trades=13
[INFO] Top 3: Short SMA=160, Long SMA=206, Sharpe=0.6886, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10084 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(176/182) - Original Sharpe: 0.7303, Trades: 49
[INFO] Hierarchical cluster 2: SMA(46/184) - Original Sharpe: 0.6990, Trades: 13
[INFO] Hierarchical cluster 3: SMA(160/206) - Original Sharpe: 0.6886, Trades: 14
[INFO] Hierarchical cluster 4: SMA(168/190) - Original Sharpe: 0.6199, Trades: 22
[INFO] Hierarchical cluster 5: SMA(156/222) - Original Sharpe: 0.6024, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (176/182) - Sharpe: 0.7303
[INFO] cluster 2: (46/184) - Sharpe: 0.6990
[INFO] cluster 3: (160/206) - Sharpe: 0.6886
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.457400
2    2022-01-10 2022-01-10            41     2.600539            3.589819
3    2022-03-10 2022-03-10            42     0.192786           -1.281426
4    2022-05-10 2022-05-10            41    -0.735414            2.728050
5    2022-07-10 2022-07-10            44     4.961128           -0.327129
6    2022-09-10 2022-09-10            43     2.825703            2.825703
7    2022-11-10 2022-11-10            40     1.576583            0.391502
8    2023-01-10 2023-01-10            41     3.128890            2.336813
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.978898
12   2023-09-10 2023-09-10            44     1.003709            1.003709
13   2023-11-10 2023-11-10            40    -4.602392           -4.717555
14   2024-01-10 2024-01-10            41     1.473702            1.471297
15   2024-03-10 2024-03-10            43    -0.280949            2.109730
16   2024-05-10 2024-05-10            40    -2.452361           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.732406
18   2024-09-10 2024-09-10            44     3.198404           -2.490902
19   2024-11-10 2024-11-10            35     3.533315            4.168880
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |              3.6 |          1.0 | True          
[INFO] 2022-03-10   |          0.2 |             -1.3 |         -1.5 | False         
[INFO] 2022-05-10   |         -0.7 |              2.7 |          3.4 | True          
[INFO] 2022-07-10   |          5.0 |             -0.3 |         -5.3 | False         
[INFO] 2022-09-10   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-10   |          1.6 |              0.4 |         -1.2 | False         
[INFO] 2023-01-10   |          3.1 |              2.3 |         -0.8 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-10   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -4.6 |             -4.7 |         -0.1 | False         
[INFO] 2024-01-10   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -0.3 |              2.1 |          2.4 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -2.5 |         -5.7 | False         
[INFO] 2024-11-10   |          3.5 |              4.2 |          0.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-09-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2024-01-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 11 periods (45.45% win rate)
[INFO] Updating Excel file with Hierarchical results for SB...
[INFO] Excel file updated successfully. Added SB with Hierarchical win rate 45.5% in row 44
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(176/182) - Original Sharpe: 0.7303
[INFO] Added cluster 2 to portfolio: SMA(46/184) - Original Sharpe: 0.6990
[INFO] Added cluster 3 to portfolio: SMA(160/206) - Original Sharpe: 0.6886
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SB_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3564
[INFO] Hierarchical Best out-of-sample Sharpe: 0.9724
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for SB...
[INFO] Excel file updated successfully. Added SB with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SB
[INFO] Loading SF data from local files...
[INFO] Found data file: A_OHLCV_@SF_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SF in column D: 13.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 139.42s
[INFO] Best parameters: Short SMA = 192, Long SMA = 194
[INFO] Best Sharpe ratio: 0.202683, Trades: 104
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SF
[INFO] Big Point Value (from data): 125000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 7.05 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $344,481.50
[INFO] Market Buy & Hold P&L: $-34,818.75
[INFO] Outperformance: $379,300.25
[INFO] Sharpe ratio (entire period, annualized): 0.354150
[INFO] Sharpe ratio (in-sample, annualized): 0.202683
[INFO] Sharpe ratio (out-of-sample, annualized): 0.811300
[INFO] Maximum Drawdown: $171,886.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 79
[INFO] Out-of-sample period trades: 25
[INFO] Total trades: 104
[INFO] In-sample P&L: $140,603.50
[INFO] Out-of-sample P&L: $189,643.50
[INFO] 
Best parameters from GA: Short SMA = 192, Long SMA = 194, Sharpe = 0.202683
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] 
Best parameters:
[INFO] Short SMA: 192
[INFO] Long SMA: 194
[INFO] Sharpe Ratio: 0.202683
[INFO] Number of Trades: 104
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.3580 to 3.2380
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 240 elements
[INFO] Kmeans Cluster 1: 287 elements
[INFO] Kmeans Cluster 2: 260 elements
[INFO] Kmeans Cluster 3: 286 elements
[INFO] Kmeans Cluster 4: 243 elements
[INFO] Kmeans Cluster 5: 186 elements
[INFO] Kmeans Cluster 6: 185 elements
[INFO] Kmeans Cluster 7: 219 elements
[INFO] Kmeans Cluster 8: 296 elements
[INFO] Kmeans Cluster 9: 174 elements
[INFO] Kmeans Cluster 10: 280 elements
[INFO] Kmeans Cluster 11: 110 elements
[INFO] Kmeans Cluster 12: 236 elements
[INFO] Kmeans Cluster 13: 312 elements
[INFO] Kmeans Cluster 14: 179 elements
[INFO] Kmeans Cluster 15: 192 elements
[INFO] Kmeans Cluster 16: 317 elements
[INFO] Kmeans Cluster 17: 322 elements
[INFO] Kmeans Cluster 18: 111 elements
[INFO] Kmeans Cluster 19: 215 elements
[INFO] Kmeans Cluster 20: 58 elements
[INFO] Kmeans Cluster 21: 156 elements
[INFO] Kmeans Cluster 22: 336 elements
[INFO] Kmeans Cluster 23: 145 elements
[INFO] Kmeans Cluster 24: 157 elements
[INFO] Kmeans Cluster 25: 134 elements
[INFO] Kmeans Cluster 26: 305 elements
[INFO] Kmeans Cluster 27: 200 elements
[INFO] Kmeans Cluster 28: 130 elements
[INFO] Kmeans Cluster 29: 236 elements
[INFO] Kmeans Cluster 30: 155 elements
[INFO] Kmeans Cluster 31: 131 elements
[INFO] Kmeans Cluster 32: 186 elements
[INFO] Kmeans Cluster 33: 170 elements
[INFO] Kmeans Cluster 34: 173 elements
[INFO] Kmeans Cluster 35: 157 elements
[INFO] Kmeans Cluster 36: 184 elements
[INFO] Kmeans Cluster 37: 214 elements
[INFO] Kmeans Cluster 38: 146 elements
[INFO] Kmeans Cluster 39: 194 elements
[INFO] Kmeans Cluster 40: 234 elements
[INFO] Kmeans Cluster 41: 410 elements
[INFO] Kmeans Cluster 42: 235 elements
[INFO] Kmeans Cluster 43: 206 elements
[INFO] Kmeans Cluster 44: 267 elements
[INFO] Kmeans Cluster 45: 127 elements
[INFO] Kmeans Cluster 46: 237 elements
[INFO] Kmeans Cluster 47: 210 elements
[INFO] Kmeans Cluster 48: 128 elements
[INFO] Kmeans Cluster 49: 314 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=62.37, Long SMA=143.57, Sharpe=-0.3349
[INFO] Centroid 1: Short SMA=147.61, Long SMA=254.67, Sharpe=-0.1604
[INFO] Centroid 2: Short SMA=119.78, Long SMA=165.44, Sharpe=-0.0533
[INFO] Centroid 3: Short SMA=59.86, Long SMA=187.78, Sharpe=-0.3275
[INFO] Centroid 4: Short SMA=83.35, Long SMA=110.64, Sharpe=-0.2763
[INFO] Centroid 5: Short SMA=224.13, Long SMA=261.16, Sharpe=-0.4740
[INFO] Centroid 6: Short SMA=21.18, Long SMA=148.32, Sharpe=-0.5508
[INFO] Centroid 7: Short SMA=131.40, Long SMA=234.74, Sharpe=-0.0470
[INFO] Centroid 8: Short SMA=98.10, Long SMA=280.81, Sharpe=-0.2368
[INFO] Centroid 9: Short SMA=253.74, Long SMA=278.87, Sharpe=-0.3591
[INFO] Centroid 10: Short SMA=89.56, Long SMA=196.67, Sharpe=-0.2322
[INFO] Centroid 11: Short SMA=48.62, Long SMA=83.05, Sharpe=-0.5540
[INFO] Centroid 12: Short SMA=36.06, Long SMA=256.85, Sharpe=-0.4278
[INFO] Centroid 13: Short SMA=201.46, Long SMA=243.33, Sharpe=-0.3222
[INFO] Centroid 14: Short SMA=26.25, Long SMA=205.44, Sharpe=-0.5005
[INFO] Centroid 15: Short SMA=24.19, Long SMA=95.67, Sharpe=-0.3670
[INFO] Centroid 16: Short SMA=66.61, Long SMA=158.23, Sharpe=-0.2535
[INFO] Centroid 17: Short SMA=120.99, Long SMA=202.94, Sharpe=-0.1414
[INFO] Centroid 18: Short SMA=260.85, Long SMA=291.03, Sharpe=-0.1578
[INFO] Centroid 19: Short SMA=115.50, Long SMA=148.85, Sharpe=-0.1657
[INFO] Centroid 20: Short SMA=38.17, Long SMA=57.45, Sharpe=-0.0628
[INFO] Centroid 21: Short SMA=67.31, Long SMA=283.26, Sharpe=-0.1524
[INFO] Centroid 22: Short SMA=131.83, Long SMA=283.11, Sharpe=-0.1106
[INFO] Centroid 23: Short SMA=166.03, Long SMA=271.92, Sharpe=-0.3601
[INFO] Centroid 24: Short SMA=41.57, Long SMA=288.19, Sharpe=-0.2683
[INFO] Centroid 25: Short SMA=18.81, Long SMA=45.70, Sharpe=-0.4594
[INFO] Centroid 26: Short SMA=164.83, Long SMA=207.89, Sharpe=-0.0766
[INFO] Centroid 27: Short SMA=80.33, Long SMA=269.20, Sharpe=-0.3506
[INFO] Centroid 28: Short SMA=38.15, Long SMA=67.14, Sharpe=-0.1854
[INFO] Centroid 29: Short SMA=47.31, Long SMA=215.75, Sharpe=-0.4083
[INFO] Centroid 30: Short SMA=207.73, Long SMA=288.26, Sharpe=-0.4016
[INFO] Centroid 31: Short SMA=26.93, Long SMA=209.33, Sharpe=-0.6299
[INFO] Centroid 32: Short SMA=146.91, Long SMA=166.74, Sharpe=-0.3541
[INFO] Centroid 33: Short SMA=66.09, Long SMA=86.76, Sharpe=-0.4105
[INFO] Centroid 34: Short SMA=34.30, Long SMA=84.30, Sharpe=-0.2827
[INFO] Centroid 35: Short SMA=179.13, Long SMA=204.51, Sharpe=0.0367
[INFO] Centroid 36: Short SMA=146.63, Long SMA=180.31, Sharpe=-0.2392
[INFO] Centroid 37: Short SMA=192.11, Long SMA=223.79, Sharpe=-0.1785
[INFO] Centroid 38: Short SMA=98.52, Long SMA=130.60, Sharpe=-0.0116
[INFO] Centroid 39: Short SMA=28.22, Long SMA=171.32, Sharpe=-0.4464
[INFO] Centroid 40: Short SMA=31.24, Long SMA=123.09, Sharpe=-0.4638
[INFO] Centroid 41: Short SMA=176.22, Long SMA=272.74, Sharpe=-0.2319
[INFO] Centroid 42: Short SMA=26.49, Long SMA=280.82, Sharpe=-0.3421
[INFO] Centroid 43: Short SMA=79.82, Long SMA=120.62, Sharpe=-0.1647
[INFO] Centroid 44: Short SMA=251.84, Long SMA=282.46, Sharpe=-0.2700
[INFO] Centroid 45: Short SMA=20.68, Long SMA=43.65, Sharpe=-0.3109
[INFO] Centroid 46: Short SMA=89.49, Long SMA=231.67, Sharpe=-0.1858
[INFO] Centroid 47: Short SMA=27.82, Long SMA=241.54, Sharpe=-0.5277
[INFO] Centroid 48: Short SMA=225.27, Long SMA=254.09, Sharpe=-0.5894
[INFO] Centroid 49: Short SMA=85.16, Long SMA=237.99, Sharpe=-0.2859
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=192, Long SMA=194, Sharpe=0.2027, Trades=104
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=180, Long SMA=204, Sharpe=0.0644, Trades=34
[INFO] Kmeans Top 2: Short SMA=164, Long SMA=208, Sharpe=-0.0175, Trades=22
[INFO] Kmeans Top 3: Short SMA=98, Long SMA=130, Sharpe=-0.0238, Trades=30
[INFO] Kmeans Top 4: Short SMA=38, Long SMA=56, Sharpe=-0.0613, Trades=69
[INFO] Kmeans Top 5: Short SMA=66, Long SMA=284, Sharpe=-0.0729, Trades=16
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (62, 144)
[INFO]   Rounded: (148, 255)
[INFO]   Nearest: (148.0, 254.0)
[INFO]   Rounded: (120, 165)
[INFO]   Nearest: (120.0, 166.0)
[INFO]   Rounded: (60, 188)
[INFO]   Rounded: (83, 111)
[INFO]   Nearest: (84.0, 110.0)
[INFO]   Rounded: (224, 261)
[INFO]   Nearest: (224.0, 262.0)
[INFO]   Rounded: (21, 148)
[INFO]   Nearest: (22.0, 148.0)
[INFO]   Rounded: (131, 235)
[INFO]   Nearest: (132.0, 234.0)
[INFO]   Rounded: (98, 281)
[INFO]   Nearest: (98.0, 280.0)
[INFO]   Rounded: (254, 279)
[INFO]   Nearest: (254.0, 278.0)
[INFO]   Rounded: (90, 197)
[INFO]   Nearest: (90.0, 196.0)
[INFO]   Rounded: (49, 83)
[INFO]   Nearest: (48.0, 84.0)
[INFO]   Rounded: (36, 257)
[INFO]   Nearest: (36.0, 256.0)
[INFO]   Rounded: (201, 243)
[INFO]   Nearest: (202.0, 244.0)
[INFO]   Rounded: (26, 205)
[INFO]   Nearest: (26.0, 206.0)
[INFO]   Rounded: (24, 96)
[INFO]   Rounded: (67, 158)
[INFO]   Nearest: (66.0, 158.0)
[INFO]   Rounded: (121, 203)
[INFO]   Nearest: (120.0, 202.0)
[INFO]   Rounded: (261, 291)
[INFO]   Nearest: (260.0, 292.0)
[INFO]   Rounded: (116, 149)
[INFO]   Nearest: (116.0, 148.0)
[INFO]   Rounded: (38, 57)
[INFO]   Nearest: (38.0, 58.0)
[INFO]   Rounded: (67, 283)
[INFO]   Nearest: (68.0, 284.0)
[INFO]   Rounded: (132, 283)
[INFO]   Nearest: (132.0, 284.0)
[INFO]   Rounded: (166, 272)
[INFO]   Rounded: (42, 288)
[INFO]   Rounded: (19, 46)
[INFO]   Nearest: (18.0, 46.0)
[INFO]   Rounded: (165, 208)
[INFO]   Nearest: (164.0, 208.0)
[INFO]   Rounded: (80, 269)
[INFO]   Nearest: (80.0, 270.0)
[INFO]   Rounded: (38, 67)
[INFO]   Nearest: (38.0, 68.0)
[INFO]   Rounded: (47, 216)
[INFO]   Nearest: (48.0, 216.0)
[INFO]   Rounded: (208, 288)
[INFO]   Rounded: (27, 209)
[INFO]   Nearest: (26.0, 210.0)
[INFO]   Rounded: (147, 167)
[INFO]   Nearest: (146.0, 166.0)
[INFO]   Rounded: (66, 87)
[INFO]   Nearest: (66.0, 86.0)
[INFO]   Rounded: (34, 84)
[INFO]   Rounded: (179, 205)
[INFO]   Nearest: (180.0, 204.0)
[INFO]   Rounded: (147, 180)
[INFO]   Nearest: (146.0, 180.0)
[INFO]   Rounded: (192, 224)
[INFO]   Rounded: (99, 131)
[INFO]   Nearest: (98.0, 130.0)
[INFO]   Rounded: (28, 171)
[INFO]   Nearest: (28.0, 172.0)
[INFO]   Rounded: (31, 123)
[INFO]   Nearest: (32.0, 124.0)
[INFO]   Rounded: (176, 273)
[INFO]   Nearest: (176.0, 272.0)
[INFO]   Rounded: (26, 281)
[INFO]   Nearest: (26.0, 280.0)
[INFO]   Rounded: (80, 121)
[INFO]   Nearest: (80.0, 120.0)
[INFO]   Rounded: (252, 282)
[INFO]   Rounded: (21, 44)
[INFO]   Nearest: (20.0, 44.0)
[INFO]   Rounded: (89, 232)
[INFO]   Nearest: (90.0, 232.0)
[INFO]   Rounded: (28, 242)
[INFO]   Rounded: (225, 254)
[INFO]   Nearest: (226.0, 254.0)
[INFO]   Rounded: (85, 238)
[INFO]   Nearest: (86.0, 238.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 192, Long SMA: 194
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SF data from local files...
[INFO] Found data file: A_OHLCV_@SF_minutes_1440_1703-1557.dat
[INFO] File size: 296586 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(180/204) - Original Sharpe: 0.0644, Trades: 34
[INFO] Kmeans cluster 2: SMA(164/208) - Original Sharpe: -0.0175, Trades: 22
[INFO] Kmeans cluster 3: SMA(98/130) - Original Sharpe: -0.0238, Trades: 30
[INFO] Kmeans cluster 4: SMA(38/56) - Original Sharpe: -0.0613, Trades: 69
[INFO] Kmeans cluster 5: SMA(66/284) - Original Sharpe: -0.0729, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (192/194)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 192, Long SMA: 194
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] Error: No Kmeans cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SF
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] 
Best parameters:
[INFO] Short SMA: 192
[INFO] Long SMA: 194
[INFO] Sharpe Ratio: 0.202683
[INFO] Number of Trades: 104
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] Trades range: 10.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.3580 to 3.2380
[INFO] Scaled Trades range: -0.9245 to 13.5719
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5212
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 304 elements
[INFO] Cluster 1: 211 elements
[INFO] Cluster 2: 340 elements
[INFO] Cluster 3: 161 elements
[INFO] Cluster 4: 368 elements
[INFO] Cluster 5: 71 elements
[INFO] Cluster 6: 434 elements
[INFO] Cluster 7: 28 elements
[INFO] Cluster 8: 240 elements
[INFO] Cluster 9: 73 elements
[INFO] Cluster 10: 379 elements
[INFO] Cluster 11: 109 elements
[INFO] Cluster 12: 549 elements
[INFO] Cluster 13: 112 elements
[INFO] Cluster 14: 323 elements
[INFO] Cluster 15: 165 elements
[INFO] Cluster 16: 260 elements
[INFO] Cluster 17: 191 elements
[INFO] Cluster 18: 82 elements
[INFO] Cluster 19: 45 elements
[INFO] Cluster 20: 410 elements
[INFO] Cluster 21: 218 elements
[INFO] Cluster 22: 60 elements
[INFO] Cluster 23: 178 elements
[INFO] Cluster 24: 468 elements
[INFO] Cluster 25: 144 elements
[INFO] Cluster 26: 300 elements
[INFO] Cluster 27: 289 elements
[INFO] Cluster 28: 245 elements
[INFO] Cluster 29: 242 elements
[INFO] Cluster 30: 256 elements
[INFO] Cluster 31: 324 elements
[INFO] Cluster 32: 390 elements
[INFO] Cluster 33: 381 elements
[INFO] Cluster 34: 33 elements
[INFO] Cluster 35: 186 elements
[INFO] Cluster 36: 245 elements
[INFO] Cluster 37: 4 elements
[INFO] Cluster 38: 78 elements
[INFO] Cluster 39: 37 elements
[INFO] Cluster 40: 102 elements
[INFO] Cluster 41: 129 elements
[INFO] Cluster 42: 187 elements
[INFO] Cluster 43: 104 elements
[INFO] Cluster 44: 164 elements
[INFO] Cluster 45: 374 elements
[INFO] Cluster 46: 248 elements
[INFO] Cluster 47: 138 elements
[INFO] Cluster 48: 152 elements
[INFO] Cluster 49: 54 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=68, Long SMA=100, Sharpe=-0.2385, Trades=39
[INFO] Cluster 1 cluster: Short SMA=224, Long SMA=252, Sharpe=-0.6497, Trades=26
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=192, Sharpe=-0.3876, Trades=29
[INFO] Cluster 3 cluster: Short SMA=100, Long SMA=130, Sharpe=0.0584, Trades=32
[INFO] Cluster 4 cluster: Short SMA=30, Long SMA=284, Sharpe=-0.2852, Trades=30
[INFO] Cluster 5 cluster: Short SMA=152, Long SMA=156, Sharpe=-0.1714, Trades=78
[INFO] Cluster 6 cluster: Short SMA=146, Long SMA=224, Sharpe=-0.1003, Trades=18
[INFO] Cluster 7 cluster: Short SMA=30, Long SMA=32, Sharpe=-0.5467, Trades=201
[INFO] Cluster 8 cluster: Short SMA=150, Long SMA=172, Sharpe=-0.2989, Trades=30
[INFO] Cluster 9 cluster: Short SMA=44, Long SMA=50, Sharpe=-0.3100, Trades=108
[INFO] Cluster 10 cluster: Short SMA=38, Long SMA=116, Sharpe=-0.4953, Trades=35
[INFO] Cluster 11 cluster: Short SMA=24, Long SMA=40, Sharpe=-0.4860, Trades=91
[INFO] Cluster 12 cluster: Short SMA=176, Long SMA=272, Sharpe=-0.2369, Trades=14
[INFO] Cluster 13 cluster: Short SMA=38, Long SMA=64, Sharpe=-0.1155, Trades=59
[INFO] Cluster 14 cluster: Short SMA=116, Long SMA=200, Sharpe=-0.1724, Trades=20
[INFO] Cluster 15 cluster: Short SMA=268, Long SMA=280, Sharpe=-0.3190, Trades=38
[INFO] Cluster 16 cluster: Short SMA=210, Long SMA=286, Sharpe=-0.4030, Trades=16
[INFO] Cluster 17 cluster: Short SMA=50, Long SMA=74, Sharpe=-0.4008, Trades=61
[INFO] Cluster 18 cluster: Short SMA=190, Long SMA=196, Sharpe=0.1824, Trades=60
[INFO] Cluster 19 cluster: Short SMA=252, Long SMA=254, Sharpe=-0.2306, Trades=84
[INFO] Cluster 20 cluster: Short SMA=132, Long SMA=280, Sharpe=-0.1564, Trades=10
[INFO] Cluster 21 cluster: Short SMA=160, Long SMA=244, Sharpe=-0.2106, Trades=13
[INFO] Cluster 22 cluster: Short SMA=236, Long SMA=242, Sharpe=-0.5591, Trades=56
[INFO] Cluster 23 cluster: Short SMA=22, Long SMA=192, Sharpe=-0.6219, Trades=39
[INFO] Cluster 24 cluster: Short SMA=82, Long SMA=254, Sharpe=-0.3090, Trades=17
[INFO] Cluster 25 cluster: Short SMA=204, Long SMA=226, Sharpe=-0.2441, Trades=27
[INFO] Cluster 26 cluster: Short SMA=98, Long SMA=228, Sharpe=-0.2277, Trades=18
[INFO] Cluster 27 cluster: Short SMA=44, Long SMA=256, Sharpe=-0.4767, Trades=25
[INFO] Cluster 28 cluster: Short SMA=62, Long SMA=196, Sharpe=-0.3366, Trades=21
[INFO] Cluster 29 cluster: Short SMA=244, Long SMA=290, Sharpe=-0.1631, Trades=18
[INFO] Cluster 30 cluster: Short SMA=100, Long SMA=284, Sharpe=-0.2670, Trades=16
[INFO] Cluster 31 cluster: Short SMA=26, Long SMA=234, Sharpe=-0.5118, Trades=31
[INFO] Cluster 32 cluster: Short SMA=56, Long SMA=154, Sharpe=-0.3364, Trades=23
[INFO] Cluster 33 cluster: Short SMA=118, Long SMA=164, Sharpe=-0.0917, Trades=28
[INFO] Cluster 34 cluster: Short SMA=66, Long SMA=68, Sharpe=-0.5792, Trades=153
[INFO] Cluster 35 cluster: Short SMA=24, Long SMA=86, Sharpe=-0.3322, Trades=51
[INFO] Cluster 36 cluster: Short SMA=190, Long SMA=248, Sharpe=-0.3413, Trades=19
[INFO] Cluster 38 cluster: Short SMA=180, Long SMA=202, Sharpe=0.0662, Trades=32
[INFO] Cluster 39 cluster: Short SMA=150, Long SMA=154, Sharpe=-0.3646, Trades=74
[INFO] Cluster 40 cluster: Short SMA=26, Long SMA=66, Sharpe=-0.3255, Trades=67
[INFO] Cluster 41 cluster: Short SMA=80, Long SMA=124, Sharpe=-0.1500, Trades=31
[INFO] Cluster 42 cluster: Short SMA=26, Long SMA=150, Sharpe=-0.5173, Trades=33
[INFO] Cluster 43 cluster: Short SMA=252, Long SMA=274, Sharpe=-0.3841, Trades=30
[INFO] Cluster 44 cluster: Short SMA=68, Long SMA=284, Sharpe=-0.1279, Trades=16
[INFO] Cluster 45 cluster: Short SMA=76, Long SMA=156, Sharpe=-0.2439, Trades=23
[INFO] Cluster 46 cluster: Short SMA=88, Long SMA=204, Sharpe=-0.2924, Trades=20
[INFO] Cluster 47 cluster: Short SMA=136, Long SMA=182, Sharpe=-0.2842, Trades=26
[INFO] Cluster 48 cluster: Short SMA=176, Long SMA=214, Sharpe=-0.0670, Trades=26
[INFO] Cluster 49 cluster: Short SMA=82, Long SMA=90, Sharpe=-0.3567, Trades=79
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=192, Long SMA=194, Sharpe=0.2027, Trades=104
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=190, Long SMA=196, Sharpe=0.1824, Trades=60
[INFO] Top 2: Short SMA=180, Long SMA=202, Sharpe=0.0662, Trades=32
[INFO] Top 3: Short SMA=100, Long SMA=130, Sharpe=0.0584, Trades=32
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10581 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 192, Long SMA: 194
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SF data from local files...
[INFO] Found data file: A_OHLCV_@SF_minutes_1440_1703-1557.dat
[INFO] File size: 296586 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(190/196) - Original Sharpe: 0.1824, Trades: 60
[INFO] Hierarchical cluster 2: SMA(180/202) - Original Sharpe: 0.0662, Trades: 32
[INFO] Hierarchical cluster 3: SMA(100/130) - Original Sharpe: 0.0584, Trades: 32
[INFO] Hierarchical cluster 4: SMA(176/214) - Original Sharpe: -0.0670, Trades: 26
[INFO] Hierarchical cluster 5: SMA(118/164) - Original Sharpe: -0.0917, Trades: 28
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (192/194)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 192, Long SMA: 194
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SF
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SI in column D: 27.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 118.78s
[INFO] Best parameters: Short SMA = 48, Long SMA = 50
[INFO] Best Sharpe ratio: 0.669797, Trades: 154
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SI
[INFO] Big Point Value (from data): 5000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.38 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $414,360.00
[INFO] Market Buy & Hold P&L: $17,375.00
[INFO] Outperformance: $396,985.00
[INFO] Sharpe ratio (entire period, annualized): 0.321215
[INFO] Sharpe ratio (in-sample, annualized): 0.669797
[INFO] Sharpe ratio (out-of-sample, annualized): -0.408321
[INFO] Maximum Drawdown: $246,379.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 112
[INFO] Out-of-sample period trades: 42
[INFO] Total trades: 154
[INFO] In-sample P&L: $407,662.00
[INFO] Out-of-sample P&L: $-118,498.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.669797
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 5000.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9380 to 0.6698
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.669797
[INFO] Number of Trades: 154
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8660 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9380 to 0.6698
[INFO] Trades range: 11.0 to 337.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2464 to 2.7541
[INFO] Scaled Long SMA range: -2.6696 to 1.6829
[INFO] Scaled Sharpe ratio range: -3.7133 to 3.4043
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 184 elements
[INFO] Kmeans Cluster 1: 237 elements
[INFO] Kmeans Cluster 2: 213 elements
[INFO] Kmeans Cluster 3: 224 elements
[INFO] Kmeans Cluster 4: 236 elements
[INFO] Kmeans Cluster 5: 139 elements
[INFO] Kmeans Cluster 6: 156 elements
[INFO] Kmeans Cluster 7: 151 elements
[INFO] Kmeans Cluster 8: 245 elements
[INFO] Kmeans Cluster 9: 227 elements
[INFO] Kmeans Cluster 10: 146 elements
[INFO] Kmeans Cluster 11: 226 elements
[INFO] Kmeans Cluster 12: 148 elements
[INFO] Kmeans Cluster 13: 207 elements
[INFO] Kmeans Cluster 14: 140 elements
[INFO] Kmeans Cluster 15: 260 elements
[INFO] Kmeans Cluster 16: 191 elements
[INFO] Kmeans Cluster 17: 276 elements
[INFO] Kmeans Cluster 18: 188 elements
[INFO] Kmeans Cluster 19: 126 elements
[INFO] Kmeans Cluster 20: 187 elements
[INFO] Kmeans Cluster 21: 86 elements
[INFO] Kmeans Cluster 22: 111 elements
[INFO] Kmeans Cluster 23: 81 elements
[INFO] Kmeans Cluster 24: 176 elements
[INFO] Kmeans Cluster 25: 118 elements
[INFO] Kmeans Cluster 26: 130 elements
[INFO] Kmeans Cluster 27: 214 elements
[INFO] Kmeans Cluster 28: 312 elements
[INFO] Kmeans Cluster 29: 68 elements
[INFO] Kmeans Cluster 30: 189 elements
[INFO] Kmeans Cluster 31: 117 elements
[INFO] Kmeans Cluster 32: 145 elements
[INFO] Kmeans Cluster 33: 102 elements
[INFO] Kmeans Cluster 34: 220 elements
[INFO] Kmeans Cluster 35: 238 elements
[INFO] Kmeans Cluster 36: 195 elements
[INFO] Kmeans Cluster 37: 213 elements
[INFO] Kmeans Cluster 38: 140 elements
[INFO] Kmeans Cluster 39: 178 elements
[INFO] Kmeans Cluster 40: 68 elements
[INFO] Kmeans Cluster 41: 81 elements
[INFO] Kmeans Cluster 42: 214 elements
[INFO] Kmeans Cluster 43: 216 elements
[INFO] Kmeans Cluster 44: 168 elements
[INFO] Kmeans Cluster 45: 166 elements
[INFO] Kmeans Cluster 46: 155 elements
[INFO] Kmeans Cluster 47: 26 elements
[INFO] Kmeans Cluster 48: 211 elements
[INFO] Kmeans Cluster 49: 215 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=169.35, Long SMA=202.75, Sharpe=-0.2392
[INFO] Centroid 1: Short SMA=23.16, Long SMA=181.15, Sharpe=-0.0772
[INFO] Centroid 2: Short SMA=218.96, Long SMA=247.10, Sharpe=0.1229
[INFO] Centroid 3: Short SMA=64.50, Long SMA=108.40, Sharpe=-0.3769
[INFO] Centroid 4: Short SMA=44.53, Long SMA=280.47, Sharpe=0.1508
[INFO] Centroid 5: Short SMA=100.91, Long SMA=205.74, Sharpe=-0.2870
[INFO] Centroid 6: Short SMA=28.31, Long SMA=51.62, Sharpe=0.1324
[INFO] Centroid 7: Short SMA=263.72, Long SMA=282.58, Sharpe=-0.1960
[INFO] Centroid 8: Short SMA=74.66, Long SMA=166.33, Sharpe=-0.1143
[INFO] Centroid 9: Short SMA=124.66, Long SMA=224.08, Sharpe=0.0384
[INFO] Centroid 10: Short SMA=18.18, Long SMA=256.42, Sharpe=-0.0233
[INFO] Centroid 11: Short SMA=115.27, Long SMA=151.24, Sharpe=-0.1683
[INFO] Centroid 12: Short SMA=25.54, Long SMA=86.38, Sharpe=-0.2620
[INFO] Centroid 13: Short SMA=128.34, Long SMA=162.59, Sharpe=-0.3440
[INFO] Centroid 14: Short SMA=39.94, Long SMA=148.16, Sharpe=0.2495
[INFO] Centroid 15: Short SMA=26.99, Long SMA=210.75, Sharpe=0.0562
[INFO] Centroid 16: Short SMA=183.04, Long SMA=236.04, Sharpe=0.1733
[INFO] Centroid 17: Short SMA=83.22, Long SMA=214.70, Sharpe=-0.1655
[INFO] Centroid 18: Short SMA=85.88, Long SMA=119.84, Sharpe=-0.1151
[INFO] Centroid 19: Short SMA=51.67, Long SMA=76.46, Sharpe=-0.6028
[INFO] Centroid 20: Short SMA=45.57, Long SMA=136.40, Sharpe=-0.2124
[INFO] Centroid 21: Short SMA=107.19, Long SMA=184.42, Sharpe=-0.6411
[INFO] Centroid 22: Short SMA=205.35, Long SMA=266.29, Sharpe=-0.0534
[INFO] Centroid 23: Short SMA=148.99, Long SMA=177.11, Sharpe=-0.0135
[INFO] Centroid 24: Short SMA=159.10, Long SMA=225.52, Sharpe=-0.0819
[INFO] Centroid 25: Short SMA=195.05, Long SMA=210.31, Sharpe=0.0107
[INFO] Centroid 26: Short SMA=234.31, Long SMA=260.71, Sharpe=0.2797
[INFO] Centroid 27: Short SMA=91.45, Long SMA=247.89, Sharpe=-0.1333
[INFO] Centroid 28: Short SMA=44.59, Long SMA=236.29, Sharpe=0.1290
[INFO] Centroid 29: Short SMA=14.85, Long SMA=122.91, Sharpe=-0.5488
[INFO] Centroid 30: Short SMA=29.51, Long SMA=290.07, Sharpe=0.0207
[INFO] Centroid 31: Short SMA=274.80, Long SMA=292.84, Sharpe=-0.3075
[INFO] Centroid 32: Short SMA=228.04, Long SMA=278.91, Sharpe=0.1145
[INFO] Centroid 33: Short SMA=170.61, Long SMA=191.59, Sharpe=-0.3907
[INFO] Centroid 34: Short SMA=142.35, Long SMA=192.45, Sharpe=-0.1526
[INFO] Centroid 35: Short SMA=57.22, Long SMA=203.72, Sharpe=-0.0278
[INFO] Centroid 36: Short SMA=41.39, Long SMA=253.70, Sharpe=0.2629
[INFO] Centroid 37: Short SMA=52.18, Long SMA=86.93, Sharpe=-0.4726
[INFO] Centroid 38: Short SMA=89.25, Long SMA=105.85, Sharpe=-0.2636
[INFO] Centroid 39: Short SMA=36.35, Long SMA=155.19, Sharpe=0.0406
[INFO] Centroid 40: Short SMA=156.68, Long SMA=169.88, Sharpe=-0.5621
[INFO] Centroid 41: Short SMA=16.30, Long SMA=33.46, Sharpe=-0.2725
[INFO] Centroid 42: Short SMA=23.90, Long SMA=118.01, Sharpe=-0.3772
[INFO] Centroid 43: Short SMA=198.82, Long SMA=235.74, Sharpe=0.2767
[INFO] Centroid 44: Short SMA=23.81, Long SMA=58.19, Sharpe=-0.0389
[INFO] Centroid 45: Short SMA=245.33, Long SMA=280.57, Sharpe=-0.0190
[INFO] Centroid 46: Short SMA=111.19, Long SMA=183.91, Sharpe=-0.4426
[INFO] Centroid 47: Short SMA=39.92, Long SMA=53.62, Sharpe=0.3669
[INFO] Centroid 48: Short SMA=65.36, Long SMA=164.56, Sharpe=-0.3062
[INFO] Centroid 49: Short SMA=100.28, Long SMA=133.00, Sharpe=-0.0048
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.6698, Trades=154
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=42, Long SMA=56, Sharpe=0.3491, Trades=72
[INFO] Kmeans Top 2: Short SMA=234, Long SMA=260, Sharpe=0.3309, Trades=19
[INFO] Kmeans Top 3: Short SMA=198, Long SMA=236, Sharpe=0.3294, Trades=19
[INFO] Kmeans Top 4: Short SMA=40, Long SMA=148, Sharpe=0.3269, Trades=31
[INFO] Kmeans Top 5: Short SMA=42, Long SMA=256, Sharpe=0.3203, Trades=11
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (169, 203)
[INFO]   Nearest: (170.0, 202.0)
[INFO]   Rounded: (23, 181)
[INFO]   Nearest: (24.0, 182.0)
[INFO]   Rounded: (219, 247)
[INFO]   Nearest: (218.0, 248.0)
[INFO]   Rounded: (64, 108)
[INFO]   Rounded: (45, 280)
[INFO]   Nearest: (44.0, 280.0)
[INFO]   Rounded: (101, 206)
[INFO]   Nearest: (100.0, 206.0)
[INFO]   Rounded: (28, 52)
[INFO]   Rounded: (264, 283)
[INFO]   Nearest: (264.0, 282.0)
[INFO]   Rounded: (75, 166)
[INFO]   Nearest: (74.0, 166.0)
[INFO]   Rounded: (125, 224)
[INFO]   Nearest: (124.0, 224.0)
[INFO]   Rounded: (18, 256)
[INFO]   Rounded: (115, 151)
[INFO]   Nearest: (116.0, 152.0)
[INFO]   Rounded: (26, 86)
[INFO]   Rounded: (128, 163)
[INFO]   Nearest: (128.0, 162.0)
[INFO]   Rounded: (40, 148)
[INFO]   Rounded: (27, 211)
[INFO]   Nearest: (26.0, 210.0)
[INFO]   Rounded: (183, 236)
[INFO]   Nearest: (184.0, 236.0)
[INFO]   Rounded: (83, 215)
[INFO]   Nearest: (84.0, 214.0)
[INFO]   Rounded: (86, 120)
[INFO]   Rounded: (52, 76)
[INFO]   Rounded: (46, 136)
[INFO]   Rounded: (107, 184)
[INFO]   Nearest: (108.0, 184.0)
[INFO]   Rounded: (205, 266)
[INFO]   Nearest: (206.0, 266.0)
[INFO]   Rounded: (149, 177)
[INFO]   Nearest: (148.0, 178.0)
[INFO]   Rounded: (159, 226)
[INFO]   Nearest: (160.0, 226.0)
[INFO]   Rounded: (195, 210)
[INFO]   Nearest: (196.0, 210.0)
[INFO]   Rounded: (234, 261)
[INFO]   Nearest: (234.0, 260.0)
[INFO]   Rounded: (91, 248)
[INFO]   Nearest: (92.0, 248.0)
[INFO]   Rounded: (45, 236)
[INFO]   Nearest: (44.0, 236.0)
[INFO]   Rounded: (15, 123)
[INFO]   Nearest: (14.0, 122.0)
[INFO]   Rounded: (30, 290)
[INFO]   Rounded: (275, 293)
[INFO]   Nearest: (274.0, 292.0)
[INFO]   Rounded: (228, 279)
[INFO]   Nearest: (228.0, 278.0)
[INFO]   Rounded: (171, 192)
[INFO]   Nearest: (170.0, 192.0)
[INFO]   Rounded: (142, 192)
[INFO]   Rounded: (57, 204)
[INFO]   Nearest: (58.0, 204.0)
[INFO]   Rounded: (41, 254)
[INFO]   Nearest: (42.0, 254.0)
[INFO]   Rounded: (52, 87)
[INFO]   Nearest: (52.0, 86.0)
[INFO]   Rounded: (89, 106)
[INFO]   Nearest: (90.0, 106.0)
[INFO]   Rounded: (36, 155)
[INFO]   Nearest: (36.0, 156.0)
[INFO]   Rounded: (157, 170)
[INFO]   Nearest: (156.0, 170.0)
[INFO]   Rounded: (16, 33)
[INFO]   Nearest: (16.0, 34.0)
[INFO]   Rounded: (24, 118)
[INFO]   Rounded: (199, 236)
[INFO]   Nearest: (198.0, 236.0)
[INFO]   Rounded: (24, 58)
[INFO]   Rounded: (245, 281)
[INFO]   Nearest: (246.0, 280.0)
[INFO]   Rounded: (111, 184)
[INFO]   Nearest: (112.0, 184.0)
[INFO]   Rounded: (40, 54)
[INFO]   Rounded: (65, 165)
[INFO]   Nearest: (66.0, 164.0)
[INFO]   Rounded: (100, 133)
[INFO]   Nearest: (100.0, 132.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(42/56) - Original Sharpe: 0.3491, Trades: 72
[INFO] Kmeans cluster 2: SMA(234/260) - Original Sharpe: 0.3309, Trades: 19
[INFO] Kmeans cluster 3: SMA(198/236) - Original Sharpe: 0.3294, Trades: 19
[INFO] Kmeans cluster 4: SMA(40/148) - Original Sharpe: 0.3269, Trades: 31
[INFO] Kmeans cluster 5: SMA(42/256) - Original Sharpe: 0.3203, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (42/56) - Sharpe: 0.3491
[INFO] cluster 2: (234/260) - Sharpe: 0.3309
[INFO] cluster 3: (198/236) - Sharpe: 0.3294
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.846146           -1.559096
1    2021-11-14 2021-11-14            43     1.283193           -1.861239
2    2022-01-14 2022-01-14            41     2.565750           -1.340423
3    2022-03-14 2022-03-14            44    -3.404503            4.052849
4    2022-05-14 2022-05-14            43     2.893818            2.893818
5    2022-07-14 2022-07-14            44     0.011366            0.011366
6    2022-09-14 2022-09-14            43     3.966370           -1.149677
7    2022-11-14 2022-11-14            43     1.499239           -1.955034
8    2023-01-14 2023-01-14            41    -2.431921            0.412470
9    2023-03-14 2023-03-14            43    -5.362105           -5.034710
10   2023-05-14 2023-05-14            44    -0.525137            1.350528
11   2023-07-14 2023-07-14            44    -4.645863           -4.218181
12   2023-09-14 2023-09-14            43     1.669521           -0.323426
13   2023-11-14 2023-11-14            42    -3.736541           -6.449847
14   2024-01-14 2024-01-14            43    -2.734966           -1.679148
15   2024-03-14 2024-03-14            42     2.485153           -1.853745
16   2024-05-14 2024-05-14            44     1.052155           -0.370829
17   2024-07-14 2024-07-14            45    -2.506040           -1.798674
18   2024-09-14 2024-09-14            43    -1.009444           -0.628379
19   2024-11-14 2024-11-14            33     1.294467           -0.456971
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.8 |             -1.6 |          0.2 | True          
[INFO] 2021-11-14   |          1.3 |             -1.9 |         -3.2 | False         
[INFO] 2022-01-14   |          2.6 |             -1.3 |         -3.9 | False         
[INFO] 2022-03-14   |         -3.4 |              4.1 |          7.5 | True          
[INFO] 2022-05-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |          4.0 |             -1.1 |         -5.1 | False         
[INFO] 2022-11-14   |          1.5 |             -2.0 |         -3.5 | False         
[INFO] 2023-01-14   |         -2.4 |              0.4 |          2.8 | True          
[INFO] 2023-03-14   |         -5.4 |             -5.0 |          0.4 | True          
[INFO] 2023-05-14   |         -0.5 |              1.4 |          1.9 | True          
[INFO] 2023-07-14   |         -4.6 |             -4.2 |          0.4 | True          
[INFO] 2023-09-14   |          1.7 |             -0.3 |         -2.0 | False         
[INFO] 2023-11-14   |         -3.7 |             -6.4 |         -2.7 | False         
[INFO] 2024-01-14   |         -2.7 |             -1.7 |          1.0 | True          
[INFO] 2024-03-14   |          2.5 |             -1.9 |         -4.4 | False         
[INFO] 2024-05-14   |          1.1 |             -0.4 |         -1.5 | False         
[INFO] 2024-07-14   |         -2.5 |             -1.8 |          0.7 | True          
[INFO] 2024-09-14   |         -1.0 |             -0.6 |          0.4 | True          
[INFO] 2024-11-14   |          1.3 |             -0.5 |         -1.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2022-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 9 of 18 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for SI...
[INFO] Excel file updated successfully. Added SI with Kmeans win rate 50.0% in row 45
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(42/56) - Original Sharpe: 0.3491
[INFO] Added cluster 2 to portfolio: SMA(234/260) - Original Sharpe: 0.3309
[INFO] Added cluster 3 to portfolio: SMA(198/236) - Original Sharpe: 0.3294
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SI_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.8766
[INFO] Kmeans Best out-of-sample Sharpe: -0.4083
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for SI...
[INFO] Excel file updated successfully. Added SI with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SI
[INFO] Big Point Value: 5000.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9380 to 0.6698
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.669797
[INFO] Number of Trades: 154
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8660 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9380 to 0.6698
[INFO] Trades range: 11.0 to 337.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2464 to 2.7541
[INFO] Scaled Long SMA range: -2.6696 to 1.6829
[INFO] Scaled Sharpe ratio range: -3.7133 to 3.4043
[INFO] Scaled Trades range: -0.9008 to 12.8274
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8660 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6294
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 402 elements
[INFO] Cluster 1: 327 elements
[INFO] Cluster 2: 420 elements
[INFO] Cluster 3: 331 elements
[INFO] Cluster 4: 321 elements
[INFO] Cluster 5: 376 elements
[INFO] Cluster 6: 243 elements
[INFO] Cluster 7: 119 elements
[INFO] Cluster 8: 239 elements
[INFO] Cluster 9: 337 elements
[INFO] Cluster 10: 76 elements
[INFO] Cluster 11: 31 elements
[INFO] Cluster 12: 152 elements
[INFO] Cluster 13: 188 elements
[INFO] Cluster 14: 211 elements
[INFO] Cluster 15: 76 elements
[INFO] Cluster 16: 252 elements
[INFO] Cluster 17: 30 elements
[INFO] Cluster 18: 351 elements
[INFO] Cluster 19: 246 elements
[INFO] Cluster 20: 177 elements
[INFO] Cluster 21: 288 elements
[INFO] Cluster 22: 347 elements
[INFO] Cluster 23: 39 elements
[INFO] Cluster 24: 82 elements
[INFO] Cluster 25: 35 elements
[INFO] Cluster 26: 110 elements
[INFO] Cluster 27: 301 elements
[INFO] Cluster 28: 190 elements
[INFO] Cluster 29: 77 elements
[INFO] Cluster 30: 5 elements
[INFO] Cluster 31: 267 elements
[INFO] Cluster 32: 114 elements
[INFO] Cluster 33: 107 elements
[INFO] Cluster 34: 49 elements
[INFO] Cluster 35: 21 elements
[INFO] Cluster 36: 78 elements
[INFO] Cluster 37: 130 elements
[INFO] Cluster 38: 191 elements
[INFO] Cluster 39: 108 elements
[INFO] Cluster 40: 222 elements
[INFO] Cluster 41: 39 elements
[INFO] Cluster 42: 122 elements
[INFO] Cluster 43: 220 elements
[INFO] Cluster 44: 201 elements
[INFO] Cluster 45: 20 elements
[INFO] Cluster 46: 36 elements
[INFO] Cluster 47: 105 elements
[INFO] Cluster 48: 145 elements
[INFO] Cluster 49: 106 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=72, Long SMA=174, Sharpe=-0.1124, Trades=19
[INFO] Cluster 1 cluster: Short SMA=126, Long SMA=222, Sharpe=0.1184, Trades=11
[INFO] Cluster 2 cluster: Short SMA=218, Long SMA=262, Sharpe=0.1051, Trades=19
[INFO] Cluster 3 cluster: Short SMA=36, Long SMA=114, Sharpe=-0.3942, Trades=42
[INFO] Cluster 4 cluster: Short SMA=100, Long SMA=144, Sharpe=-0.0810, Trades=32
[INFO] Cluster 5 cluster: Short SMA=134, Long SMA=174, Sharpe=-0.5098, Trades=31
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=172, Sharpe=-0.0427, Trades=34
[INFO] Cluster 7 cluster: Short SMA=92, Long SMA=100, Sharpe=-0.1934, Trades=67
[INFO] Cluster 8 cluster: Short SMA=68, Long SMA=172, Sharpe=-0.3369, Trades=19
[INFO] Cluster 9 cluster: Short SMA=190, Long SMA=236, Sharpe=0.2728, Trades=19
[INFO] Cluster 10 cluster: Short SMA=228, Long SMA=232, Sharpe=0.0863, Trades=49
[INFO] Cluster 11 cluster: Short SMA=22, Long SMA=28, Sharpe=-0.3516, Trades=148
[INFO] Cluster 12 cluster: Short SMA=170, Long SMA=228, Sharpe=-0.0167, Trades=19
[INFO] Cluster 13 cluster: Short SMA=24, Long SMA=60, Sharpe=0.1711, Trades=58
[INFO] Cluster 14 cluster: Short SMA=238, Long SMA=276, Sharpe=-0.0126, Trades=17
[INFO] Cluster 15 cluster: Short SMA=118, Long SMA=126, Sharpe=0.0282, Trades=61
[INFO] Cluster 16 cluster: Short SMA=266, Long SMA=288, Sharpe=-0.2702, Trades=17
[INFO] Cluster 17 cluster: Short SMA=112, Long SMA=114, Sharpe=-0.3473, Trades=120
[INFO] Cluster 18 cluster: Short SMA=82, Long SMA=232, Sharpe=-0.1861, Trades=13
[INFO] Cluster 19 cluster: Short SMA=38, Long SMA=252, Sharpe=0.3019, Trades=17
[INFO] Cluster 20 cluster: Short SMA=40, Long SMA=148, Sharpe=0.3269, Trades=31
[INFO] Cluster 21 cluster: Short SMA=52, Long SMA=96, Sharpe=-0.4638, Trades=47
[INFO] Cluster 22 cluster: Short SMA=24, Long SMA=276, Sharpe=0.0784, Trades=23
[INFO] Cluster 23 cluster: Short SMA=180, Long SMA=182, Sharpe=-0.3418, Trades=105
[INFO] Cluster 24 cluster: Short SMA=68, Long SMA=76, Sharpe=-0.6505, Trades=73
[INFO] Cluster 25 cluster: Short SMA=36, Long SMA=40, Sharpe=-0.1049, Trades=134
[INFO] Cluster 26 cluster: Short SMA=170, Long SMA=182, Sharpe=-0.3833, Trades=53
[INFO] Cluster 27 cluster: Short SMA=42, Long SMA=204, Sharpe=0.0749, Trades=19
[INFO] Cluster 28 cluster: Short SMA=16, Long SMA=224, Sharpe=-0.0291, Trades=33
[INFO] Cluster 29 cluster: Short SMA=24, Long SMA=40, Sharpe=-0.0098, Trades=80
[INFO] Cluster 31 cluster: Short SMA=96, Long SMA=208, Sharpe=-0.1891, Trades=13
[INFO] Cluster 32 cluster: Short SMA=22, Long SMA=80, Sharpe=-0.1906, Trades=54
[INFO] Cluster 33 cluster: Short SMA=14, Long SMA=124, Sharpe=-0.5745, Trades=66
[INFO] Cluster 34 cluster: Short SMA=164, Long SMA=176, Sharpe=-0.6324, Trades=55
[INFO] Cluster 35 cluster: Short SMA=16, Long SMA=20, Sharpe=-0.1691, Trades=203
[INFO] Cluster 36 cluster: Short SMA=192, Long SMA=200, Sharpe=0.0774, Trades=51
[INFO] Cluster 37 cluster: Short SMA=106, Long SMA=186, Sharpe=-0.7948, Trades=19
[INFO] Cluster 38 cluster: Short SMA=164, Long SMA=210, Sharpe=-0.2925, Trades=23
[INFO] Cluster 39 cluster: Short SMA=234, Long SMA=260, Sharpe=0.3309, Trades=19
[INFO] Cluster 40 cluster: Short SMA=52, Long SMA=278, Sharpe=0.2104, Trades=13
[INFO] Cluster 41 cluster: Short SMA=40, Long SMA=52, Sharpe=0.3034, Trades=76
[INFO] Cluster 42 cluster: Short SMA=66, Long SMA=136, Sharpe=-0.1849, Trades=29
[INFO] Cluster 43 cluster: Short SMA=50, Long SMA=232, Sharpe=0.1589, Trades=17
[INFO] Cluster 44 cluster: Short SMA=98, Long SMA=128, Sharpe=-0.1404, Trades=38
[INFO] Cluster 45 cluster: Short SMA=278, Long SMA=280, Sharpe=-0.2265, Trades=57
[INFO] Cluster 46 cluster: Short SMA=14, Long SMA=36, Sharpe=-0.4249, Trades=96
[INFO] Cluster 47 cluster: Short SMA=46, Long SMA=82, Sharpe=-0.6745, Trades=48
[INFO] Cluster 48 cluster: Short SMA=146, Long SMA=192, Sharpe=-0.1586, Trades=29
[INFO] Cluster 49 cluster: Short SMA=40, Long SMA=128, Sharpe=-0.0321, Trades=40
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.6698, Trades=154
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=234, Long SMA=260, Sharpe=0.3309, Trades=19
[INFO] Top 2: Short SMA=40, Long SMA=148, Sharpe=0.3269, Trades=31
[INFO] Top 3: Short SMA=40, Long SMA=52, Sharpe=0.3034, Trades=76
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 8655 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(234/260) - Original Sharpe: 0.3309, Trades: 19
[INFO] Hierarchical cluster 2: SMA(40/148) - Original Sharpe: 0.3269, Trades: 31
[INFO] Hierarchical cluster 3: SMA(40/52) - Original Sharpe: 0.3034, Trades: 76
[INFO] Hierarchical cluster 4: SMA(38/252) - Original Sharpe: 0.3019, Trades: 17
[INFO] Hierarchical cluster 5: SMA(190/236) - Original Sharpe: 0.2728, Trades: 19
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (234/260) - Sharpe: 0.3309
[INFO] cluster 2: (40/148) - Sharpe: 0.3269
[INFO] cluster 3: (40/52) - Sharpe: 0.3034
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.846146           -1.499253
1    2021-11-14 2021-11-14            43     1.283193           -2.944700
2    2022-01-14 2022-01-14            41     2.565750            0.056918
3    2022-03-14 2022-03-14            44    -3.404503           -1.157682
4    2022-05-14 2022-05-14            43     2.893818            3.555903
5    2022-07-14 2022-07-14            44     0.011366           -0.283268
6    2022-09-14 2022-09-14            43     3.966370           -1.577335
7    2022-11-14 2022-11-14            43     1.499239            3.478177
8    2023-01-14 2023-01-14            41    -2.431921           -2.431921
9    2023-03-14 2023-03-14            43    -5.362105           -5.362105
10   2023-05-14 2023-05-14            44    -0.525137           -2.832263
11   2023-07-14 2023-07-14            44    -4.645863           -4.361701
12   2023-09-14 2023-09-14            43     1.669521            0.419633
13   2023-11-14 2023-11-14            42    -3.736541           -3.935676
14   2024-01-14 2024-01-14            43    -2.734966           -2.628153
15   2024-03-14 2024-03-14            42     2.485153            2.684074
16   2024-05-14 2024-05-14            44     1.052155            0.294202
17   2024-07-14 2024-07-14            45    -2.506040           -1.648631
18   2024-09-14 2024-09-14            43    -1.009444           -0.863697
19   2024-11-14 2024-11-14            33     1.294467           -0.857797
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.8 |             -1.5 |          0.3 | True          
[INFO] 2021-11-14   |          1.3 |             -2.9 |         -4.2 | False         
[INFO] 2022-01-14   |          2.6 |              0.1 |         -2.5 | False         
[INFO] 2022-03-14   |         -3.4 |             -1.2 |          2.2 | True          
[INFO] 2022-05-14   |          2.9 |              3.6 |          0.7 | True          
[INFO] 2022-07-14   |          0.0 |             -0.3 |         -0.3 | False         
[INFO] 2022-09-14   |          4.0 |             -1.6 |         -5.6 | False         
[INFO] 2022-11-14   |          1.5 |              3.5 |          2.0 | True          
[INFO] 2023-01-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -5.4 |             -5.4 |          0.0 | Excluded      
[INFO] 2023-05-14   |         -0.5 |             -2.8 |         -2.3 | False         
[INFO] 2023-07-14   |         -4.6 |             -4.4 |          0.2 | True          
[INFO] 2023-09-14   |          1.7 |              0.4 |         -1.3 | False         
[INFO] 2023-11-14   |         -3.7 |             -3.9 |         -0.2 | False         
[INFO] 2024-01-14   |         -2.7 |             -2.6 |          0.1 | True          
[INFO] 2024-03-14   |          2.5 |              2.7 |          0.2 | True          
[INFO] 2024-05-14   |          1.1 |              0.3 |         -0.8 | False         
[INFO] 2024-07-14   |         -2.5 |             -1.6 |          0.9 | True          
[INFO] 2024-09-14   |         -1.0 |             -0.9 |          0.1 | True          
[INFO] 2024-11-14   |          1.3 |             -0.9 |         -2.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-01-14, 2023-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 9 of 18 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for SI...
[INFO] Excel file updated successfully. Added SI with Hierarchical win rate 50.0% in row 45
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(234/260) - Original Sharpe: 0.3309
[INFO] Added cluster 2 to portfolio: SMA(40/148) - Original Sharpe: 0.3269
[INFO] Added cluster 3 to portfolio: SMA(40/52) - Original Sharpe: 0.3034
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SI_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.8256
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4083
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for SI...
[INFO] Excel file updated successfully. Added SI with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SI
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SM in column D: 14.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 152.11s
[INFO] Best parameters: Short SMA = 70, Long SMA = 74
[INFO] Best Sharpe ratio: 0.679896, Trades: 87
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SM
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.37 contracts
[INFO] Maximum Position Size: 19 contracts
[INFO] Strategy Total P&L: $214,754.00
[INFO] Market Buy & Hold P&L: $10,810.00
[INFO] Outperformance: $203,944.00
[INFO] Sharpe ratio (entire period, annualized): 0.196631
[INFO] Sharpe ratio (in-sample, annualized): 0.679896
[INFO] Sharpe ratio (out-of-sample, annualized): -0.899276
[INFO] Maximum Drawdown: $250,628.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 63
[INFO] Out-of-sample period trades: 24
[INFO] Total trades: 87
[INFO] In-sample P&L: $356,944.00
[INFO] Out-of-sample P&L: $-208,076.00
[INFO] 
Best parameters from GA: Short SMA = 70, Long SMA = 74, Sharpe = 0.679896
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.3858 to 0.6799
[INFO] 
Best parameters:
[INFO] Short SMA: 70
[INFO] Long SMA: 74
[INFO] Sharpe Ratio: 0.679896
[INFO] Number of Trades: 87
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.3858 to 0.6799
[INFO] Trades range: 12.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.2107 to 3.4208
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 316 elements
[INFO] Kmeans Cluster 1: 248 elements
[INFO] Kmeans Cluster 2: 230 elements
[INFO] Kmeans Cluster 3: 168 elements
[INFO] Kmeans Cluster 4: 153 elements
[INFO] Kmeans Cluster 5: 269 elements
[INFO] Kmeans Cluster 6: 234 elements
[INFO] Kmeans Cluster 7: 268 elements
[INFO] Kmeans Cluster 8: 154 elements
[INFO] Kmeans Cluster 9: 196 elements
[INFO] Kmeans Cluster 10: 190 elements
[INFO] Kmeans Cluster 11: 247 elements
[INFO] Kmeans Cluster 12: 148 elements
[INFO] Kmeans Cluster 13: 139 elements
[INFO] Kmeans Cluster 14: 191 elements
[INFO] Kmeans Cluster 15: 204 elements
[INFO] Kmeans Cluster 16: 237 elements
[INFO] Kmeans Cluster 17: 292 elements
[INFO] Kmeans Cluster 18: 145 elements
[INFO] Kmeans Cluster 19: 230 elements
[INFO] Kmeans Cluster 20: 268 elements
[INFO] Kmeans Cluster 21: 161 elements
[INFO] Kmeans Cluster 22: 253 elements
[INFO] Kmeans Cluster 23: 284 elements
[INFO] Kmeans Cluster 24: 164 elements
[INFO] Kmeans Cluster 25: 188 elements
[INFO] Kmeans Cluster 26: 179 elements
[INFO] Kmeans Cluster 27: 291 elements
[INFO] Kmeans Cluster 28: 198 elements
[INFO] Kmeans Cluster 29: 152 elements
[INFO] Kmeans Cluster 30: 277 elements
[INFO] Kmeans Cluster 31: 312 elements
[INFO] Kmeans Cluster 32: 202 elements
[INFO] Kmeans Cluster 33: 142 elements
[INFO] Kmeans Cluster 34: 172 elements
[INFO] Kmeans Cluster 35: 172 elements
[INFO] Kmeans Cluster 36: 198 elements
[INFO] Kmeans Cluster 37: 186 elements
[INFO] Kmeans Cluster 38: 135 elements
[INFO] Kmeans Cluster 39: 164 elements
[INFO] Kmeans Cluster 40: 283 elements
[INFO] Kmeans Cluster 41: 265 elements
[INFO] Kmeans Cluster 42: 265 elements
[INFO] Kmeans Cluster 43: 248 elements
[INFO] Kmeans Cluster 44: 338 elements
[INFO] Kmeans Cluster 45: 200 elements
[INFO] Kmeans Cluster 46: 222 elements
[INFO] Kmeans Cluster 47: 92 elements
[INFO] Kmeans Cluster 48: 153 elements
[INFO] Kmeans Cluster 49: 162 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=89.15, Long SMA=150.69, Sharpe=-0.4728
[INFO] Centroid 1: Short SMA=197.43, Long SMA=254.32, Sharpe=-0.3490
[INFO] Centroid 2: Short SMA=22.55, Long SMA=57.66, Sharpe=0.1467
[INFO] Centroid 3: Short SMA=64.80, Long SMA=259.55, Sharpe=-0.4664
[INFO] Centroid 4: Short SMA=174.59, Long SMA=287.11, Sharpe=-0.5166
[INFO] Centroid 5: Short SMA=26.43, Long SMA=233.23, Sharpe=-0.2558
[INFO] Centroid 6: Short SMA=21.59, Long SMA=182.96, Sharpe=-0.2034
[INFO] Centroid 7: Short SMA=120.72, Long SMA=194.58, Sharpe=-0.6671
[INFO] Centroid 8: Short SMA=259.45, Long SMA=284.57, Sharpe=-0.8402
[INFO] Centroid 9: Short SMA=74.45, Long SMA=106.04, Sharpe=-0.0793
[INFO] Centroid 10: Short SMA=125.67, Long SMA=267.85, Sharpe=-0.5017
[INFO] Centroid 11: Short SMA=165.17, Long SMA=203.00, Sharpe=-0.1571
[INFO] Centroid 12: Short SMA=80.04, Long SMA=293.65, Sharpe=-1.0640
[INFO] Centroid 13: Short SMA=131.41, Long SMA=150.63, Sharpe=-1.1374
[INFO] Centroid 14: Short SMA=28.32, Long SMA=287.15, Sharpe=-0.5842
[INFO] Centroid 15: Short SMA=215.82, Long SMA=276.95, Sharpe=-0.5209
[INFO] Centroid 16: Short SMA=52.78, Long SMA=90.47, Sharpe=0.1766
[INFO] Centroid 17: Short SMA=73.05, Long SMA=207.71, Sharpe=-0.2612
[INFO] Centroid 18: Short SMA=271.50, Long SMA=294.77, Sharpe=-1.0897
[INFO] Centroid 19: Short SMA=94.81, Long SMA=258.65, Sharpe=-0.6360
[INFO] Centroid 20: Short SMA=88.58, Long SMA=120.59, Sharpe=-0.3038
[INFO] Centroid 21: Short SMA=35.57, Long SMA=54.97, Sharpe=-0.1036
[INFO] Centroid 22: Short SMA=27.03, Long SMA=101.30, Sharpe=0.0441
[INFO] Centroid 23: Short SMA=163.94, Long SMA=257.10, Sharpe=-0.2219
[INFO] Centroid 24: Short SMA=55.55, Long SMA=287.40, Sharpe=-0.7962
[INFO] Centroid 25: Short SMA=21.59, Long SMA=140.67, Sharpe=-0.3341
[INFO] Centroid 26: Short SMA=223.93, Long SMA=239.09, Sharpe=-0.1130
[INFO] Centroid 27: Short SMA=52.41, Long SMA=162.34, Sharpe=-0.2733
[INFO] Centroid 28: Short SMA=122.55, Long SMA=231.89, Sharpe=-0.5017
[INFO] Centroid 29: Short SMA=149.99, Long SMA=179.25, Sharpe=-0.4890
[INFO] Centroid 30: Short SMA=125.08, Long SMA=166.61, Sharpe=-0.9001
[INFO] Centroid 31: Short SMA=37.57, Long SMA=202.95, Sharpe=-0.3440
[INFO] Centroid 32: Short SMA=151.27, Long SMA=276.04, Sharpe=-0.3375
[INFO] Centroid 33: Short SMA=235.93, Long SMA=259.48, Sharpe=-0.2936
[INFO] Centroid 34: Short SMA=95.80, Long SMA=282.99, Sharpe=-0.8700
[INFO] Centroid 35: Short SMA=56.50, Long SMA=81.16, Sharpe=0.3416
[INFO] Centroid 36: Short SMA=164.40, Long SMA=200.44, Sharpe=0.0076
[INFO] Centroid 37: Short SMA=201.78, Long SMA=292.58, Sharpe=-0.6719
[INFO] Centroid 38: Short SMA=197.78, Long SMA=217.17, Sharpe=-0.4416
[INFO] Centroid 39: Short SMA=112.85, Long SMA=140.13, Sharpe=-0.6753
[INFO] Centroid 40: Short SMA=102.43, Long SMA=224.98, Sharpe=-0.6012
[INFO] Centroid 41: Short SMA=58.40, Long SMA=240.49, Sharpe=-0.3393
[INFO] Centroid 42: Short SMA=26.40, Long SMA=262.97, Sharpe=-0.3726
[INFO] Centroid 43: Short SMA=79.28, Long SMA=184.22, Sharpe=-0.4278
[INFO] Centroid 44: Short SMA=37.21, Long SMA=133.05, Sharpe=-0.1401
[INFO] Centroid 45: Short SMA=188.43, Long SMA=225.60, Sharpe=-0.2928
[INFO] Centroid 46: Short SMA=147.20, Long SMA=230.98, Sharpe=-0.3128
[INFO] Centroid 47: Short SMA=15.09, Long SMA=37.04, Sharpe=0.3658
[INFO] Centroid 48: Short SMA=245.71, Long SMA=275.84, Sharpe=-0.5577
[INFO] Centroid 49: Short SMA=125.30, Long SMA=290.07, Sharpe=-0.7168
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=70, Long SMA=74, Sharpe=0.6799, Trades=87
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=58, Long SMA=82, Sharpe=0.3020, Trades=35
[INFO] Kmeans Top 2: Short SMA=16, Long SMA=34, Sharpe=0.2589, Trades=82
[INFO] Kmeans Top 3: Short SMA=52, Long SMA=94, Sharpe=0.2189, Trades=33
[INFO] Kmeans Top 4: Short SMA=22, Long SMA=58, Sharpe=0.1150, Trades=55
[INFO] Kmeans Top 5: Short SMA=74, Long SMA=106, Sharpe=0.0146, Trades=27
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (89, 151)
[INFO]   Nearest: (90.0, 150.0)
[INFO]   Rounded: (197, 254)
[INFO]   Nearest: (198.0, 254.0)
[INFO]   Rounded: (23, 58)
[INFO]   Nearest: (22.0, 58.0)
[INFO]   Rounded: (65, 260)
[INFO]   Nearest: (64.0, 260.0)
[INFO]   Rounded: (175, 287)
[INFO]   Nearest: (174.0, 288.0)
[INFO]   Rounded: (26, 233)
[INFO]   Nearest: (26.0, 234.0)
[INFO]   Rounded: (22, 183)
[INFO]   Nearest: (22.0, 182.0)
[INFO]   Rounded: (121, 195)
[INFO]   Nearest: (120.0, 194.0)
[INFO]   Rounded: (259, 285)
[INFO]   Nearest: (260.0, 284.0)
[INFO]   Rounded: (74, 106)
[INFO]   Rounded: (126, 268)
[INFO]   Rounded: (165, 203)
[INFO]   Nearest: (166.0, 202.0)
[INFO]   Rounded: (80, 294)
[INFO]   Rounded: (131, 151)
[INFO]   Nearest: (132.0, 150.0)
[INFO]   Rounded: (28, 287)
[INFO]   Nearest: (28.0, 288.0)
[INFO]   Rounded: (216, 277)
[INFO]   Nearest: (216.0, 276.0)
[INFO]   Rounded: (53, 90)
[INFO]   Nearest: (52.0, 90.0)
[INFO]   Rounded: (73, 208)
[INFO]   Nearest: (74.0, 208.0)
[INFO]   Rounded: (272, 295)
[INFO]   Nearest: (272.0, 294.0)
[INFO]   Rounded: (95, 259)
[INFO]   Nearest: (94.0, 258.0)
[INFO]   Rounded: (89, 121)
[INFO]   Nearest: (88.0, 120.0)
[INFO]   Rounded: (36, 55)
[INFO]   Nearest: (36.0, 54.0)
[INFO]   Rounded: (27, 101)
[INFO]   Nearest: (28.0, 102.0)
[INFO]   Rounded: (164, 257)
[INFO]   Nearest: (164.0, 258.0)
[INFO]   Rounded: (56, 287)
[INFO]   Nearest: (56.0, 288.0)
[INFO]   Rounded: (22, 141)
[INFO]   Nearest: (22.0, 140.0)
[INFO]   Rounded: (224, 239)
[INFO]   Nearest: (224.0, 240.0)
[INFO]   Rounded: (52, 162)
[INFO]   Rounded: (123, 232)
[INFO]   Nearest: (122.0, 232.0)
[INFO]   Rounded: (150, 179)
[INFO]   Nearest: (150.0, 180.0)
[INFO]   Rounded: (125, 167)
[INFO]   Nearest: (126.0, 166.0)
[INFO]   Rounded: (38, 203)
[INFO]   Nearest: (38.0, 202.0)
[INFO]   Rounded: (151, 276)
[INFO]   Nearest: (152.0, 276.0)
[INFO]   Rounded: (236, 259)
[INFO]   Nearest: (236.0, 260.0)
[INFO]   Rounded: (96, 283)
[INFO]   Nearest: (96.0, 282.0)
[INFO]   Rounded: (57, 81)
[INFO]   Nearest: (56.0, 82.0)
[INFO]   Rounded: (164, 200)
[INFO]   Rounded: (202, 293)
[INFO]   Nearest: (202.0, 292.0)
[INFO]   Rounded: (198, 217)
[INFO]   Nearest: (198.0, 218.0)
[INFO]   Rounded: (113, 140)
[INFO]   Nearest: (112.0, 140.0)
[INFO]   Rounded: (102, 225)
[INFO]   Nearest: (102.0, 224.0)
[INFO]   Rounded: (58, 240)
[INFO]   Rounded: (26, 263)
[INFO]   Nearest: (26.0, 262.0)
[INFO]   Rounded: (79, 184)
[INFO]   Nearest: (80.0, 184.0)
[INFO]   Rounded: (37, 133)
[INFO]   Nearest: (38.0, 134.0)
[INFO]   Rounded: (188, 226)
[INFO]   Rounded: (147, 231)
[INFO]   Nearest: (148.0, 230.0)
[INFO]   Rounded: (15, 37)
[INFO]   Nearest: (16.0, 38.0)
[INFO]   Rounded: (246, 276)
[INFO]   Rounded: (125, 290)
[INFO]   Nearest: (126.0, 290.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 70, Long SMA: 74
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(58/82) - Original Sharpe: 0.3020, Trades: 35
[INFO] Kmeans cluster 2: SMA(16/34) - Original Sharpe: 0.2589, Trades: 82
[INFO] Kmeans cluster 3: SMA(52/94) - Original Sharpe: 0.2189, Trades: 33
[INFO] Kmeans cluster 4: SMA(22/58) - Original Sharpe: 0.1150, Trades: 55
[INFO] Kmeans cluster 5: SMA(74/106) - Original Sharpe: 0.0146, Trades: 27
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (70/74)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (58/82) - Sharpe: 0.3020
[INFO] cluster 2: (16/34) - Sharpe: 0.2589
[INFO] cluster 3: (52/94) - Sharpe: 0.2189
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.297409            0.298548
1    2021-11-10 2021-11-10            41     0.579196            2.974072
2    2022-01-10 2022-01-10            41     2.725389            2.725389
3    2022-03-10 2022-03-10            42    -4.090683           -2.235583
4    2022-05-10 2022-05-10            41    -3.216020           -2.458845
5    2022-07-10 2022-07-10            44    -0.228249            0.534104
6    2022-09-10 2022-09-10            43     0.723663           -1.008980
7    2022-11-10 2022-11-10            40    -1.624676           -0.323150
8    2023-01-10 2023-01-10            41     1.963421            1.963421
9    2023-03-10 2023-03-10            42    -4.781168           -4.319224
10   2023-05-10 2023-05-10            40     1.697903            0.045088
11   2023-07-10 2023-07-10            44    -0.986722           -3.834289
12   2023-09-10 2023-09-10            44    -0.465397           -5.360916
13   2023-11-10 2023-11-10            40    -3.397712           -1.927991
14   2024-01-10 2024-01-10            41     0.698756            1.058824
15   2024-03-10 2024-03-10            43    -2.269644           -2.373258
16   2024-05-10 2024-05-10            40    -2.839898           -1.348971
17   2024-07-10 2024-07-10            43    -2.557415           -0.501310
18   2024-09-10 2024-09-10            44    -1.365575            3.605638
19   2024-11-10 2024-11-10            35    -0.851426           -2.152479
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.3 |              0.3 |          0.6 | True          
[INFO] 2021-11-10   |          0.6 |              3.0 |          2.4 | True          
[INFO] 2022-01-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -4.1 |             -2.2 |          1.9 | True          
[INFO] 2022-05-10   |         -3.2 |             -2.5 |          0.7 | True          
[INFO] 2022-07-10   |         -0.2 |              0.5 |          0.7 | True          
[INFO] 2022-09-10   |          0.7 |             -1.0 |         -1.7 | False         
[INFO] 2022-11-10   |         -1.6 |             -0.3 |          1.3 | True          
[INFO] 2023-01-10   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -4.8 |             -4.3 |          0.5 | True          
[INFO] 2023-05-10   |          1.7 |              0.0 |         -1.7 | False         
[INFO] 2023-07-10   |         -1.0 |             -3.8 |         -2.8 | False         
[INFO] 2023-09-10   |         -0.5 |             -5.4 |         -4.9 | False         
[INFO] 2023-11-10   |         -3.4 |             -1.9 |          1.5 | True          
[INFO] 2024-01-10   |          0.7 |              1.1 |          0.4 | True          
[INFO] 2024-03-10   |         -2.3 |             -2.4 |         -0.1 | False         
[INFO] 2024-05-10   |         -2.8 |             -1.3 |          1.5 | True          
[INFO] 2024-07-10   |         -2.6 |             -0.5 |          2.1 | True          
[INFO] 2024-09-10   |         -1.4 |              3.6 |          5.0 | True          
[INFO] 2024-11-10   |         -0.9 |             -2.2 |         -1.3 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-10, 2023-01-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 12 of 18 periods (66.67% win rate)
[INFO] Updating Excel file with Kmeans results for SM...
[INFO] Excel file updated successfully. Added SM with Kmeans win rate 66.7% in row 46
[INFO] Added best Sharpe parameters 70/74 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 70, Long SMA: 74
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(58/82) - Original Sharpe: 0.3020
[INFO] Added cluster 2 to portfolio: SMA(16/34) - Original Sharpe: 0.2589
[INFO] Added cluster 3 to portfolio: SMA(52/94) - Original Sharpe: 0.2189
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SM_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.5716
[INFO] Kmeans Best out-of-sample Sharpe: -0.8993
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for SM...
[INFO] Excel file updated successfully. Added SM with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SM
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -1.3858 to 0.6799
[INFO] 
Best parameters:
[INFO] Short SMA: 70
[INFO] Long SMA: 74
[INFO] Sharpe Ratio: 0.679896
[INFO] Number of Trades: 87
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -1.3858 to 0.6799
[INFO] Trades range: 12.0 to 352.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -3.2107 to 3.4208
[INFO] Scaled Trades range: -0.7741 to 18.1739
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6539
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 317 elements
[INFO] Cluster 1: 89 elements
[INFO] Cluster 2: 411 elements
[INFO] Cluster 3: 626 elements
[INFO] Cluster 4: 52 elements
[INFO] Cluster 5: 23 elements
[INFO] Cluster 6: 8 elements
[INFO] Cluster 7: 238 elements
[INFO] Cluster 8: 416 elements
[INFO] Cluster 9: 277 elements
[INFO] Cluster 10: 142 elements
[INFO] Cluster 11: 500 elements
[INFO] Cluster 12: 118 elements
[INFO] Cluster 13: 158 elements
[INFO] Cluster 14: 337 elements
[INFO] Cluster 15: 223 elements
[INFO] Cluster 16: 264 elements
[INFO] Cluster 17: 128 elements
[INFO] Cluster 18: 141 elements
[INFO] Cluster 19: 186 elements
[INFO] Cluster 20: 405 elements
[INFO] Cluster 21: 268 elements
[INFO] Cluster 22: 70 elements
[INFO] Cluster 23: 343 elements
[INFO] Cluster 24: 156 elements
[INFO] Cluster 25: 220 elements
[INFO] Cluster 26: 417 elements
[INFO] Cluster 27: 217 elements
[INFO] Cluster 28: 28 elements
[INFO] Cluster 29: 134 elements
[INFO] Cluster 30: 216 elements
[INFO] Cluster 31: 151 elements
[INFO] Cluster 32: 318 elements
[INFO] Cluster 33: 228 elements
[INFO] Cluster 34: 311 elements
[INFO] Cluster 35: 206 elements
[INFO] Cluster 36: 214 elements
[INFO] Cluster 37: 305 elements
[INFO] Cluster 38: 25 elements
[INFO] Cluster 39: 42 elements
[INFO] Cluster 40: 133 elements
[INFO] Cluster 41: 115 elements
[INFO] Cluster 42: 239 elements
[INFO] Cluster 43: 82 elements
[INFO] Cluster 44: 203 elements
[INFO] Cluster 45: 291 elements
[INFO] Cluster 46: 34 elements
[INFO] Cluster 47: 139 elements
[INFO] Cluster 48: 300 elements
[INFO] Cluster 49: 121 elements
[INFO] Using 49 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=88, Long SMA=288, Sharpe=-0.9847, Trades=18
[INFO] Cluster 1 cluster: Short SMA=30, Long SMA=38, Sharpe=-0.1145, Trades=91
[INFO] Cluster 2 cluster: Short SMA=194, Long SMA=288, Sharpe=-0.6163, Trades=14
[INFO] Cluster 3 cluster: Short SMA=106, Long SMA=230, Sharpe=-0.6006, Trades=15
[INFO] Cluster 4 cluster: Short SMA=58, Long SMA=60, Sharpe=0.1305, Trades=123
[INFO] Cluster 5 cluster: Short SMA=18, Long SMA=22, Sharpe=0.3862, Trades=174
[INFO] Cluster 7 cluster: Short SMA=232, Long SMA=276, Sharpe=-0.4580, Trades=18
[INFO] Cluster 8 cluster: Short SMA=24, Long SMA=240, Sharpe=-0.2928, Trades=25
[INFO] Cluster 9 cluster: Short SMA=54, Long SMA=92, Sharpe=0.2839, Trades=33
[INFO] Cluster 10 cluster: Short SMA=194, Long SMA=202, Sharpe=-0.3285, Trades=43
[INFO] Cluster 11 cluster: Short SMA=54, Long SMA=252, Sharpe=-0.3003, Trades=17
[INFO] Cluster 12 cluster: Short SMA=276, Long SMA=286, Sharpe=-0.7979, Trades=34
[INFO] Cluster 13 cluster: Short SMA=150, Long SMA=176, Sharpe=-0.4528, Trades=27
[INFO] Cluster 14 cluster: Short SMA=52, Long SMA=160, Sharpe=-0.2707, Trades=19
[INFO] Cluster 15 cluster: Short SMA=22, Long SMA=72, Sharpe=0.1556, Trades=49
[INFO] Cluster 16 cluster: Short SMA=92, Long SMA=128, Sharpe=-0.3757, Trades=25
[INFO] Cluster 17 cluster: Short SMA=130, Long SMA=150, Sharpe=-1.2389, Trades=31
[INFO] Cluster 18 cluster: Short SMA=248, Long SMA=286, Sharpe=-0.6771, Trades=20
[INFO] Cluster 19 cluster: Short SMA=20, Long SMA=288, Sharpe=-0.5997, Trades=30
[INFO] Cluster 20 cluster: Short SMA=166, Long SMA=246, Sharpe=-0.1913, Trades=15
[INFO] Cluster 21 cluster: Short SMA=112, Long SMA=280, Sharpe=-0.7975, Trades=14
[INFO] Cluster 22 cluster: Short SMA=94, Long SMA=102, Sharpe=-0.1703, Trades=45
[INFO] Cluster 23 cluster: Short SMA=144, Long SMA=266, Sharpe=-0.3486, Trades=16
[INFO] Cluster 24 cluster: Short SMA=20, Long SMA=124, Sharpe=-0.2770, Trades=33
[INFO] Cluster 25 cluster: Short SMA=190, Long SMA=218, Sharpe=-0.3573, Trades=28
[INFO] Cluster 26 cluster: Short SMA=50, Long SMA=196, Sharpe=-0.3802, Trades=17
[INFO] Cluster 27 cluster: Short SMA=64, Long SMA=114, Sharpe=-0.1420, Trades=27
[INFO] Cluster 28 cluster: Short SMA=140, Long SMA=142, Sharpe=-1.2270, Trades=83
[INFO] Cluster 29 cluster: Short SMA=28, Long SMA=48, Sharpe=-0.0114, Trades=63
[INFO] Cluster 30 cluster: Short SMA=56, Long SMA=284, Sharpe=-0.7728, Trades=18
[INFO] Cluster 31 cluster: Short SMA=30, Long SMA=68, Sharpe=-0.0380, Trades=45
[INFO] Cluster 32 cluster: Short SMA=122, Long SMA=168, Sharpe=-1.0215, Trades=23
[INFO] Cluster 33 cluster: Short SMA=228, Long SMA=252, Sharpe=-0.1478, Trades=23
[INFO] Cluster 34 cluster: Short SMA=196, Long SMA=254, Sharpe=-0.3159, Trades=17
[INFO] Cluster 35 cluster: Short SMA=18, Long SMA=186, Sharpe=-0.1439, Trades=31
[INFO] Cluster 36 cluster: Short SMA=116, Long SMA=196, Sharpe=-0.6534, Trades=21
[INFO] Cluster 37 cluster: Short SMA=84, Long SMA=162, Sharpe=-0.5062, Trades=21
[INFO] Cluster 38 cluster: Short SMA=264, Long SMA=266, Sharpe=-0.6418, Trades=66
[INFO] Cluster 39 cluster: Short SMA=208, Long SMA=210, Sharpe=-0.3453, Trades=84
[INFO] Cluster 40 cluster: Short SMA=148, Long SMA=202, Sharpe=-0.1779, Trades=23
[INFO] Cluster 41 cluster: Short SMA=114, Long SMA=136, Sharpe=-0.6931, Trades=27
[INFO] Cluster 42 cluster: Short SMA=166, Long SMA=204, Sharpe=0.0236, Trades=27
[INFO] Cluster 43 cluster: Short SMA=262, Long SMA=296, Sharpe=-1.1275, Trades=18
[INFO] Cluster 44 cluster: Short SMA=122, Long SMA=262, Sharpe=-0.4833, Trades=14
[INFO] Cluster 45 cluster: Short SMA=42, Long SMA=140, Sharpe=-0.1363, Trades=23
[INFO] Cluster 46 cluster: Short SMA=182, Long SMA=186, Sharpe=-0.3289, Trades=62
[INFO] Cluster 47 cluster: Short SMA=26, Long SMA=94, Sharpe=0.0173, Trades=37
[INFO] Cluster 48 cluster: Short SMA=76, Long SMA=208, Sharpe=-0.2999, Trades=15
[INFO] Cluster 49 cluster: Short SMA=20, Long SMA=150, Sharpe=-0.4061, Trades=31
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=70, Long SMA=74, Sharpe=0.6799, Trades=87
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=18, Long SMA=22, Sharpe=0.3862, Trades=174
[INFO] Top 2: Short SMA=54, Long SMA=92, Sharpe=0.2839, Trades=33
[INFO] Top 3: Short SMA=22, Long SMA=72, Sharpe=0.1556, Trades=49
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 49 valid clusters with clusters
[INFO] Filtering to 10577 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 70, Long SMA: 74
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(18/22) - Original Sharpe: 0.3862, Trades: 174
[INFO] Hierarchical cluster 2: SMA(54/92) - Original Sharpe: 0.2839, Trades: 33
[INFO] Hierarchical cluster 3: SMA(22/72) - Original Sharpe: 0.1556, Trades: 49
[INFO] Hierarchical cluster 4: SMA(58/60) - Original Sharpe: 0.1305, Trades: 123
[INFO] Hierarchical cluster 5: SMA(166/204) - Original Sharpe: 0.0236, Trades: 27
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (70/74)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (18/22) - Sharpe: 0.3862
[INFO] cluster 2: (54/92) - Sharpe: 0.2839
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.297409            0.161417
1    2021-11-10 2021-11-10            41     0.579196            2.703706
2    2022-01-10 2022-01-10            41     2.725389           -0.610872
3    2022-03-10 2022-03-10            42    -4.090683           -0.993479
4    2022-05-10 2022-05-10            41    -3.216020           -2.893520
5    2022-07-10 2022-07-10            44    -0.228249           -0.277284
6    2022-09-10 2022-09-10            43     0.723663            0.411627
7    2022-11-10 2022-11-10            40    -1.624676           -1.471062
8    2023-01-10 2023-01-10            41     1.963421            1.963421
9    2023-03-10 2023-03-10            42    -4.781168           -5.766633
10   2023-05-10 2023-05-10            40     1.697903            0.181415
11   2023-07-10 2023-07-10            44    -0.986722           -3.229754
12   2023-09-10 2023-09-10            44    -0.465397           -1.512927
13   2023-11-10 2023-11-10            40    -3.397712           -1.439697
14   2024-01-10 2024-01-10            41     0.698756            1.442986
15   2024-03-10 2024-03-10            43    -2.269644           -2.400578
16   2024-05-10 2024-05-10            40    -2.839898           -2.952396
17   2024-07-10 2024-07-10            43    -2.557415           -3.558109
18   2024-09-10 2024-09-10            44    -1.365575            4.459353
19   2024-11-10 2024-11-10            35    -0.851426           -1.804521
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.3 |              0.2 |          0.5 | True          
[INFO] 2021-11-10   |          0.6 |              2.7 |          2.1 | True          
[INFO] 2022-01-10   |          2.7 |             -0.6 |         -3.3 | False         
[INFO] 2022-03-10   |         -4.1 |             -1.0 |          3.1 | True          
[INFO] 2022-05-10   |         -3.2 |             -2.9 |          0.3 | True          
[INFO] 2022-07-10   |         -0.2 |             -0.3 |         -0.1 | False         
[INFO] 2022-09-10   |          0.7 |              0.4 |         -0.3 | False         
[INFO] 2022-11-10   |         -1.6 |             -1.5 |          0.1 | True          
[INFO] 2023-01-10   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -4.8 |             -5.8 |         -1.0 | False         
[INFO] 2023-05-10   |          1.7 |              0.2 |         -1.5 | False         
[INFO] 2023-07-10   |         -1.0 |             -3.2 |         -2.2 | False         
[INFO] 2023-09-10   |         -0.5 |             -1.5 |         -1.0 | False         
[INFO] 2023-11-10   |         -3.4 |             -1.4 |          2.0 | True          
[INFO] 2024-01-10   |          0.7 |              1.4 |          0.7 | True          
[INFO] 2024-03-10   |         -2.3 |             -2.4 |         -0.1 | False         
[INFO] 2024-05-10   |         -2.8 |             -3.0 |         -0.2 | False         
[INFO] 2024-07-10   |         -2.6 |             -3.6 |         -1.0 | False         
[INFO] 2024-09-10   |         -1.4 |              4.5 |          5.9 | True          
[INFO] 2024-11-10   |         -0.9 |             -1.8 |         -0.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-01-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 19 periods (42.11% win rate)
[INFO] Updating Excel file with Hierarchical results for SM...
[INFO] Excel file updated successfully. Added SM with Hierarchical win rate 42.1% in row 46
[INFO] Added best Sharpe parameters 70/74 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 70, Long SMA: 74
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(18/22) - Original Sharpe: 0.3862
[INFO] Added cluster 2 to portfolio: SMA(54/92) - Original Sharpe: 0.2839
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SM_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.7466
[INFO] Hierarchical Best out-of-sample Sharpe: -0.8993
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for SM...
[INFO] Excel file updated successfully. Added SM with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SM
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for TEN in column D: 18.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 128.11s
[INFO] Best parameters: Short SMA = 58, Long SMA = 76
[INFO] Best Sharpe ratio: 1.262627, Trades: 37
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @TEN=117XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.08 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $411,204.62
[INFO] Market Buy & Hold P&L: $-18,312.50
[INFO] Outperformance: $429,517.12
[INFO] Sharpe ratio (entire period, annualized): 0.642709
[INFO] Sharpe ratio (in-sample, annualized): 1.262627
[INFO] Sharpe ratio (out-of-sample, annualized): -0.813918
[INFO] Maximum Drawdown: $216,784.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 23
[INFO] Out-of-sample period trades: 14
[INFO] Total trades: 37
[INFO] In-sample P&L: $566,161.25
[INFO] Out-of-sample P&L: $-154,956.62
[INFO] 
Best parameters from GA: Short SMA = 58, Long SMA = 76, Sharpe = 1.262627
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5303 to 1.2626
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 76
[INFO] Sharpe Ratio: 1.262627
[INFO] Number of Trades: 37
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9144 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5303 to 1.2626
[INFO] Trades range: 10.0 to 263.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3303 to 2.6446
[INFO] Scaled Long SMA range: -2.7069 to 1.6060
[INFO] Scaled Sharpe ratio range: -2.5233 to 3.4723
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 178 elements
[INFO] Kmeans Cluster 1: 267 elements
[INFO] Kmeans Cluster 2: 60 elements
[INFO] Kmeans Cluster 3: 170 elements
[INFO] Kmeans Cluster 4: 241 elements
[INFO] Kmeans Cluster 5: 143 elements
[INFO] Kmeans Cluster 6: 205 elements
[INFO] Kmeans Cluster 7: 204 elements
[INFO] Kmeans Cluster 8: 189 elements
[INFO] Kmeans Cluster 9: 210 elements
[INFO] Kmeans Cluster 10: 165 elements
[INFO] Kmeans Cluster 11: 362 elements
[INFO] Kmeans Cluster 12: 97 elements
[INFO] Kmeans Cluster 13: 170 elements
[INFO] Kmeans Cluster 14: 163 elements
[INFO] Kmeans Cluster 15: 286 elements
[INFO] Kmeans Cluster 16: 179 elements
[INFO] Kmeans Cluster 17: 288 elements
[INFO] Kmeans Cluster 18: 186 elements
[INFO] Kmeans Cluster 19: 152 elements
[INFO] Kmeans Cluster 20: 210 elements
[INFO] Kmeans Cluster 21: 159 elements
[INFO] Kmeans Cluster 22: 174 elements
[INFO] Kmeans Cluster 23: 177 elements
[INFO] Kmeans Cluster 24: 51 elements
[INFO] Kmeans Cluster 25: 230 elements
[INFO] Kmeans Cluster 26: 143 elements
[INFO] Kmeans Cluster 27: 123 elements
[INFO] Kmeans Cluster 28: 180 elements
[INFO] Kmeans Cluster 29: 137 elements
[INFO] Kmeans Cluster 30: 298 elements
[INFO] Kmeans Cluster 31: 191 elements
[INFO] Kmeans Cluster 32: 109 elements
[INFO] Kmeans Cluster 33: 69 elements
[INFO] Kmeans Cluster 34: 63 elements
[INFO] Kmeans Cluster 35: 142 elements
[INFO] Kmeans Cluster 36: 97 elements
[INFO] Kmeans Cluster 37: 147 elements
[INFO] Kmeans Cluster 38: 210 elements
[INFO] Kmeans Cluster 39: 156 elements
[INFO] Kmeans Cluster 40: 204 elements
[INFO] Kmeans Cluster 41: 158 elements
[INFO] Kmeans Cluster 42: 266 elements
[INFO] Kmeans Cluster 43: 211 elements
[INFO] Kmeans Cluster 44: 266 elements
[INFO] Kmeans Cluster 45: 240 elements
[INFO] Kmeans Cluster 46: 245 elements
[INFO] Kmeans Cluster 47: 136 elements
[INFO] Kmeans Cluster 48: 237 elements
[INFO] Kmeans Cluster 49: 200 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=267.12, Long SMA=288.56, Sharpe=-0.0307
[INFO] Centroid 1: Short SMA=24.82, Long SMA=162.40, Sharpe=0.3349
[INFO] Centroid 2: Short SMA=23.33, Long SMA=39.03, Sharpe=0.5115
[INFO] Centroid 3: Short SMA=117.19, Long SMA=151.41, Sharpe=-0.1005
[INFO] Centroid 4: Short SMA=159.26, Long SMA=239.65, Sharpe=0.1122
[INFO] Centroid 5: Short SMA=76.66, Long SMA=224.41, Sharpe=0.5323
[INFO] Centroid 6: Short SMA=24.44, Long SMA=95.87, Sharpe=0.7548
[INFO] Centroid 7: Short SMA=19.82, Long SMA=245.05, Sharpe=0.4443
[INFO] Centroid 8: Short SMA=148.96, Long SMA=174.65, Sharpe=0.3231
[INFO] Centroid 9: Short SMA=216.99, Long SMA=239.08, Sharpe=0.0346
[INFO] Centroid 10: Short SMA=233.75, Long SMA=260.66, Sharpe=-0.0604
[INFO] Centroid 11: Short SMA=128.41, Long SMA=234.18, Sharpe=0.2871
[INFO] Centroid 12: Short SMA=72.49, Long SMA=101.65, Sharpe=0.4133
[INFO] Centroid 13: Short SMA=65.64, Long SMA=160.72, Sharpe=-0.0129
[INFO] Centroid 14: Short SMA=85.64, Long SMA=127.60, Sharpe=-0.0876
[INFO] Centroid 15: Short SMA=26.41, Long SMA=128.19, Sharpe=0.4786
[INFO] Centroid 16: Short SMA=19.93, Long SMA=284.97, Sharpe=0.4264
[INFO] Centroid 17: Short SMA=186.38, Long SMA=273.52, Sharpe=-0.1048
[INFO] Centroid 18: Short SMA=18.59, Long SMA=199.72, Sharpe=0.5425
[INFO] Centroid 19: Short SMA=191.34, Long SMA=205.87, Sharpe=-0.1926
[INFO] Centroid 20: Short SMA=158.57, Long SMA=263.51, Sharpe=-0.0542
[INFO] Centroid 21: Short SMA=32.18, Long SMA=54.01, Sharpe=0.7804
[INFO] Centroid 22: Short SMA=38.25, Long SMA=205.03, Sharpe=0.3301
[INFO] Centroid 23: Short SMA=94.61, Long SMA=181.30, Sharpe=0.1581
[INFO] Centroid 24: Short SMA=14.39, Long SMA=25.02, Sharpe=0.1678
[INFO] Centroid 25: Short SMA=38.26, Long SMA=269.62, Sharpe=0.2760
[INFO] Centroid 26: Short SMA=63.83, Long SMA=93.20, Sharpe=0.6062
[INFO] Centroid 27: Short SMA=72.81, Long SMA=116.86, Sharpe=0.1032
[INFO] Centroid 28: Short SMA=127.66, Long SMA=170.53, Sharpe=0.1160
[INFO] Centroid 29: Short SMA=264.64, Long SMA=281.66, Sharpe=0.1020
[INFO] Centroid 30: Short SMA=62.19, Long SMA=194.15, Sharpe=0.2716
[INFO] Centroid 31: Short SMA=173.86, Long SMA=202.17, Sharpe=-0.0129
[INFO] Centroid 32: Short SMA=93.49, Long SMA=117.34, Sharpe=-0.2208
[INFO] Centroid 33: Short SMA=238.26, Long SMA=256.61, Sharpe=-0.2336
[INFO] Centroid 34: Short SMA=50.00, Long SMA=70.70, Sharpe=1.0839
[INFO] Centroid 35: Short SMA=45.52, Long SMA=168.82, Sharpe=0.1688
[INFO] Centroid 36: Short SMA=132.29, Long SMA=145.55, Sharpe=-0.3068
[INFO] Centroid 37: Short SMA=61.40, Long SMA=265.62, Sharpe=0.3491
[INFO] Centroid 38: Short SMA=83.48, Long SMA=152.75, Sharpe=-0.2045
[INFO] Centroid 39: Short SMA=234.78, Long SMA=289.69, Sharpe=-0.1728
[INFO] Centroid 40: Short SMA=39.65, Long SMA=231.89, Sharpe=0.4439
[INFO] Centroid 41: Short SMA=49.84, Long SMA=126.87, Sharpe=0.2993
[INFO] Centroid 42: Short SMA=191.34, Long SMA=234.48, Sharpe=-0.0317
[INFO] Centroid 43: Short SMA=49.07, Long SMA=84.28, Sharpe=0.8507
[INFO] Centroid 44: Short SMA=117.12, Long SMA=202.83, Sharpe=0.1829
[INFO] Centroid 45: Short SMA=211.90, Long SMA=281.15, Sharpe=-0.0059
[INFO] Centroid 46: Short SMA=150.62, Long SMA=197.36, Sharpe=0.1991
[INFO] Centroid 47: Short SMA=110.53, Long SMA=130.49, Sharpe=0.0559
[INFO] Centroid 48: Short SMA=91.95, Long SMA=215.64, Sharpe=0.3350
[INFO] Centroid 49: Short SMA=24.79, Long SMA=62.68, Sharpe=0.9288
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=76, Sharpe=1.2626, Trades=37
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=56, Long SMA=76, Sharpe=1.1496, Trades=33
[INFO] Kmeans Top 2: Short SMA=26, Long SMA=62, Sharpe=0.8969, Trades=35
[INFO] Kmeans Top 3: Short SMA=24, Long SMA=96, Sharpe=0.8385, Trades=27
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=54, Sharpe=0.8270, Trades=43
[INFO] Kmeans Top 5: Short SMA=48, Long SMA=84, Sharpe=0.7914, Trades=27
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (267, 289)
[INFO]   Nearest: (268.0, 288.0)
[INFO]   Rounded: (25, 162)
[INFO]   Nearest: (24.0, 162.0)
[INFO]   Rounded: (23, 39)
[INFO]   Nearest: (24.0, 40.0)
[INFO]   Rounded: (117, 151)
[INFO]   Nearest: (118.0, 152.0)
[INFO]   Rounded: (159, 240)
[INFO]   Nearest: (160.0, 240.0)
[INFO]   Rounded: (77, 224)
[INFO]   Nearest: (76.0, 224.0)
[INFO]   Rounded: (24, 96)
[INFO]   Rounded: (20, 245)
[INFO]   Nearest: (20.0, 246.0)
[INFO]   Rounded: (149, 175)
[INFO]   Nearest: (148.0, 174.0)
[INFO]   Rounded: (217, 239)
[INFO]   Nearest: (216.0, 240.0)
[INFO]   Rounded: (234, 261)
[INFO]   Nearest: (234.0, 260.0)
[INFO]   Rounded: (128, 234)
[INFO]   Rounded: (72, 102)
[INFO]   Rounded: (66, 161)
[INFO]   Nearest: (66.0, 160.0)
[INFO]   Rounded: (86, 128)
[INFO]   Rounded: (26, 128)
[INFO]   Rounded: (20, 285)
[INFO]   Nearest: (20.0, 284.0)
[INFO]   Rounded: (186, 274)
[INFO]   Rounded: (19, 200)
[INFO]   Nearest: (18.0, 200.0)
[INFO]   Rounded: (191, 206)
[INFO]   Nearest: (192.0, 206.0)
[INFO]   Rounded: (159, 264)
[INFO]   Nearest: (158.0, 264.0)
[INFO]   Rounded: (32, 54)
[INFO]   Rounded: (38, 205)
[INFO]   Nearest: (38.0, 206.0)
[INFO]   Rounded: (95, 181)
[INFO]   Nearest: (94.0, 182.0)
[INFO]   Rounded: (14, 25)
[INFO]   Nearest: (14.0, 26.0)
[INFO]   Rounded: (38, 270)
[INFO]   Rounded: (64, 93)
[INFO]   Nearest: (64.0, 94.0)
[INFO]   Rounded: (73, 117)
[INFO]   Nearest: (72.0, 116.0)
[INFO]   Rounded: (128, 171)
[INFO]   Nearest: (128.0, 170.0)
[INFO]   Rounded: (265, 282)
[INFO]   Nearest: (264.0, 282.0)
[INFO]   Rounded: (62, 194)
[INFO]   Rounded: (174, 202)
[INFO]   Rounded: (93, 117)
[INFO]   Nearest: (94.0, 118.0)
[INFO]   Rounded: (238, 257)
[INFO]   Nearest: (238.0, 256.0)
[INFO]   Rounded: (50, 71)
[INFO]   Nearest: (50.0, 70.0)
[INFO]   Rounded: (46, 169)
[INFO]   Nearest: (46.0, 168.0)
[INFO]   Rounded: (132, 146)
[INFO]   Rounded: (61, 266)
[INFO]   Nearest: (62.0, 266.0)
[INFO]   Rounded: (83, 153)
[INFO]   Nearest: (84.0, 152.0)
[INFO]   Rounded: (235, 290)
[INFO]   Nearest: (234.0, 290.0)
[INFO]   Rounded: (40, 232)
[INFO]   Rounded: (50, 127)
[INFO]   Nearest: (50.0, 126.0)
[INFO]   Rounded: (191, 234)
[INFO]   Nearest: (192.0, 234.0)
[INFO]   Rounded: (49, 84)
[INFO]   Nearest: (50.0, 84.0)
[INFO]   Rounded: (117, 203)
[INFO]   Nearest: (118.0, 202.0)
[INFO]   Rounded: (212, 281)
[INFO]   Nearest: (212.0, 282.0)
[INFO]   Rounded: (151, 197)
[INFO]   Nearest: (150.0, 198.0)
[INFO]   Rounded: (111, 130)
[INFO]   Nearest: (110.0, 130.0)
[INFO]   Rounded: (92, 216)
[INFO]   Rounded: (25, 63)
[INFO]   Nearest: (24.0, 62.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 76
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(56/76) - Original Sharpe: 1.1496, Trades: 33
[INFO] Kmeans cluster 2: SMA(26/62) - Original Sharpe: 0.8969, Trades: 35
[INFO] Kmeans cluster 3: SMA(24/96) - Original Sharpe: 0.8385, Trades: 27
[INFO] Kmeans cluster 4: SMA(36/54) - Original Sharpe: 0.8270, Trades: 43
[INFO] Kmeans cluster 5: SMA(48/84) - Original Sharpe: 0.7914, Trades: 27
[INFO] Trimmed warm-up period. Evaluation data length: 2318
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/76)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (56/76) - Sharpe: 1.1496
[INFO] cluster 2: (26/62) - Sharpe: 0.8969
[INFO] cluster 3: (24/96) - Sharpe: 0.8385
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Out-of-sample period starts on: 2022-04-25
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2022-04-25 2022-04-25            45     0.869705            0.869705
1    2022-06-25 2022-06-25            43    -0.666869           -3.354135
2    2022-08-25 2022-08-25            43    -1.133345            2.982622
3    2022-10-25 2022-10-25            44    -2.239033           -3.605180
4    2022-12-25 2022-12-25            43    -3.070652           -1.437859
5    2023-02-25 2023-02-25            41    -3.791965           -3.791792
6    2023-04-25 2023-04-25            44    -2.516428           -1.508887
7    2023-06-25 2023-06-25            44     2.949798            2.949798
8    2023-08-25 2023-08-25            43     3.401253            3.401253
9    2023-10-25 2023-10-25            43    -4.105859           -2.338790
10   2023-12-25 2023-12-25            43    -3.479188           -2.304075
11   2024-02-25 2024-02-25            42     2.392603            4.101376
12   2024-04-25 2024-04-25            43    -2.501372           -1.886393
13   2024-06-25 2024-06-25            44     2.619489            3.677095
14   2024-08-25 2024-08-25            44    -3.660489           -3.172702
15   2024-10-25 2024-10-25            43     0.789016            1.866036
16   2024-12-25 2024-12-25             4    -0.779051           -0.779051
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2022-04-25   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2022-06-25   |         -0.7 |             -3.4 |         -2.7 | False         
[INFO] 2022-08-25   |         -1.1 |              3.0 |          4.1 | True          
[INFO] 2022-10-25   |         -2.2 |             -3.6 |         -1.4 | False         
[INFO] 2022-12-25   |         -3.1 |             -1.4 |          1.7 | True          
[INFO] 2023-02-25   |         -3.8 |             -3.8 |          0.0 | Excluded      
[INFO] 2023-04-25   |         -2.5 |             -1.5 |          1.0 | True          
[INFO] 2023-06-25   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-08-25   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-10-25   |         -4.1 |             -2.3 |          1.8 | True          
[INFO] 2023-12-25   |         -3.5 |             -2.3 |          1.2 | True          
[INFO] 2024-02-25   |          2.4 |              4.1 |          1.7 | True          
[INFO] 2024-04-25   |         -2.5 |             -1.9 |          0.6 | True          
[INFO] 2024-06-25   |          2.6 |              3.7 |          1.1 | True          
[INFO] 2024-08-25   |         -3.7 |             -3.2 |          0.5 | True          
[INFO] 2024-10-25   |          0.8 |              1.9 |          1.1 | True          
[INFO] 2024-12-25   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-25, 2023-02-25, 2023-06-25, 2023-08-25, 2024-12-25
[INFO] 
Total periods before exclusion: 17
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 10 of 12 periods (83.33% win rate)
[INFO] Updating Excel file with Kmeans results for TEN...
[INFO] Excel file updated successfully. Added TEN with Kmeans win rate 83.3% in row 47
[INFO] Added best Sharpe parameters 58/76 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 76
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(56/76) - Original Sharpe: 1.1496
[INFO] Added cluster 2 to portfolio: SMA(26/62) - Original Sharpe: 0.8969
[INFO] Added cluster 3 to portfolio: SMA(24/96) - Original Sharpe: 0.8385
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TEN_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1270
[INFO] Kmeans Best out-of-sample Sharpe: -0.8139
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for TEN...
[INFO] Excel file updated successfully. Added TEN with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TEN
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5303 to 1.2626
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 76
[INFO] Sharpe Ratio: 1.262627
[INFO] Number of Trades: 37
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9144 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5303 to 1.2626
[INFO] Trades range: 10.0 to 263.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3303 to 2.6446
[INFO] Scaled Long SMA range: -2.7069 to 1.6060
[INFO] Scaled Sharpe ratio range: -2.5233 to 3.4723
[INFO] Scaled Trades range: -0.7128 to 16.0622
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9144 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6785
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 230 elements
[INFO] Cluster 1: 36 elements
[INFO] Cluster 2: 308 elements
[INFO] Cluster 3: 246 elements
[INFO] Cluster 4: 421 elements
[INFO] Cluster 5: 263 elements
[INFO] Cluster 6: 425 elements
[INFO] Cluster 7: 479 elements
[INFO] Cluster 8: 135 elements
[INFO] Cluster 9: 187 elements
[INFO] Cluster 10: 227 elements
[INFO] Cluster 11: 43 elements
[INFO] Cluster 12: 40 elements
[INFO] Cluster 13: 281 elements
[INFO] Cluster 14: 74 elements
[INFO] Cluster 15: 60 elements
[INFO] Cluster 16: 63 elements
[INFO] Cluster 17: 201 elements
[INFO] Cluster 18: 273 elements
[INFO] Cluster 19: 157 elements
[INFO] Cluster 20: 185 elements
[INFO] Cluster 21: 72 elements
[INFO] Cluster 22: 14 elements
[INFO] Cluster 23: 203 elements
[INFO] Cluster 24: 169 elements
[INFO] Cluster 25: 374 elements
[INFO] Cluster 26: 390 elements
[INFO] Cluster 27: 221 elements
[INFO] Cluster 28: 180 elements
[INFO] Cluster 29: 275 elements
[INFO] Cluster 30: 363 elements
[INFO] Cluster 31: 259 elements
[INFO] Cluster 32: 255 elements
[INFO] Cluster 33: 237 elements
[INFO] Cluster 34: 217 elements
[INFO] Cluster 35: 210 elements
[INFO] Cluster 36: 51 elements
[INFO] Cluster 37: 47 elements
[INFO] Cluster 38: 62 elements
[INFO] Cluster 39: 217 elements
[INFO] Cluster 40: 116 elements
[INFO] Cluster 41: 197 elements
[INFO] Cluster 42: 8 elements
[INFO] Cluster 43: 248 elements
[INFO] Cluster 44: 31 elements
[INFO] Cluster 45: 101 elements
[INFO] Cluster 46: 103 elements
[INFO] Cluster 47: 33 elements
[INFO] Cluster 48: 153 elements
[INFO] Cluster 49: 4 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=104, Long SMA=126, Sharpe=-0.0961, Trades=26
[INFO] Cluster 1 cluster: Short SMA=16, Long SMA=26, Sharpe=-0.0308, Trades=107
[INFO] Cluster 2 cluster: Short SMA=26, Long SMA=130, Sharpe=0.4459, Trades=23
[INFO] Cluster 3 cluster: Short SMA=18, Long SMA=198, Sharpe=0.5236, Trades=23
[INFO] Cluster 4 cluster: Short SMA=126, Long SMA=234, Sharpe=0.2314, Trades=12
[INFO] Cluster 5 cluster: Short SMA=240, Long SMA=280, Sharpe=-0.1538, Trades=13
[INFO] Cluster 6 cluster: Short SMA=138, Long SMA=198, Sharpe=0.2172, Trades=14
[INFO] Cluster 7 cluster: Short SMA=84, Long SMA=150, Sharpe=-0.1540, Trades=21
[INFO] Cluster 8 cluster: Short SMA=108, Long SMA=122, Sharpe=0.2158, Trades=32
[INFO] Cluster 9 cluster: Short SMA=44, Long SMA=74, Sharpe=0.8656, Trades=33
[INFO] Cluster 10 cluster: Short SMA=58, Long SMA=160, Sharpe=0.1619, Trades=19
[INFO] Cluster 11 cluster: Short SMA=130, Long SMA=132, Sharpe=-0.0789, Trades=72
[INFO] Cluster 12 cluster: Short SMA=46, Long SMA=48, Sharpe=0.6569, Trades=103
[INFO] Cluster 13 cluster: Short SMA=266, Long SMA=284, Sharpe=0.1623, Trades=17
[INFO] Cluster 14 cluster: Short SMA=32, Long SMA=46, Sharpe=0.9446, Trades=59
[INFO] Cluster 15 cluster: Short SMA=192, Long SMA=196, Sharpe=0.0704, Trades=38
[INFO] Cluster 16 cluster: Short SMA=48, Long SMA=56, Sharpe=0.7163, Trades=59
[INFO] Cluster 17 cluster: Short SMA=34, Long SMA=104, Sharpe=0.7299, Trades=23
[INFO] Cluster 18 cluster: Short SMA=216, Long SMA=256, Sharpe=-0.0114, Trades=13
[INFO] Cluster 19 cluster: Short SMA=148, Long SMA=174, Sharpe=0.3044, Trades=22
[INFO] Cluster 20 cluster: Short SMA=24, Long SMA=58, Sharpe=0.8879, Trades=37
[INFO] Cluster 21 cluster: Short SMA=76, Long SMA=92, Sharpe=0.5221, Trades=35
[INFO] Cluster 23 cluster: Short SMA=180, Long SMA=206, Sharpe=-0.1658, Trades=16
[INFO] Cluster 24 cluster: Short SMA=214, Long SMA=288, Sharpe=0.0368, Trades=11
[INFO] Cluster 25 cluster: Short SMA=46, Long SMA=270, Sharpe=0.3043, Trades=11
[INFO] Cluster 26 cluster: Short SMA=62, Long SMA=192, Sharpe=0.2816, Trades=15
[INFO] Cluster 27 cluster: Short SMA=160, Long SMA=238, Sharpe=0.0647, Trades=14
[INFO] Cluster 28 cluster: Short SMA=78, Long SMA=222, Sharpe=0.5302, Trades=15
[INFO] Cluster 29 cluster: Short SMA=190, Long SMA=274, Sharpe=-0.0661, Trades=11
[INFO] Cluster 30 cluster: Short SMA=32, Long SMA=238, Sharpe=0.3904, Trades=11
[INFO] Cluster 31 cluster: Short SMA=160, Long SMA=264, Sharpe=-0.1436, Trades=12
[INFO] Cluster 32 cluster: Short SMA=98, Long SMA=204, Sharpe=0.2240, Trades=14
[INFO] Cluster 33 cluster: Short SMA=26, Long SMA=160, Sharpe=0.3510, Trades=21
[INFO] Cluster 34 cluster: Short SMA=38, Long SMA=88, Sharpe=0.7439, Trades=27
[INFO] Cluster 35 cluster: Short SMA=18, Long SMA=280, Sharpe=0.4274, Trades=13
[INFO] Cluster 36 cluster: Short SMA=156, Long SMA=164, Sharpe=0.4545, Trades=36
[INFO] Cluster 37 cluster: Short SMA=138, Long SMA=144, Sharpe=-0.3464, Trades=40
[INFO] Cluster 38 cluster: Short SMA=240, Long SMA=244, Sharpe=-0.2077, Trades=27
[INFO] Cluster 39 cluster: Short SMA=108, Long SMA=178, Sharpe=0.1208, Trades=14
[INFO] Cluster 40 cluster: Short SMA=110, Long SMA=144, Sharpe=-0.0110, Trades=24
[INFO] Cluster 41 cluster: Short SMA=56, Long SMA=122, Sharpe=0.2357, Trades=21
[INFO] Cluster 43 cluster: Short SMA=190, Long SMA=236, Sharpe=-0.0313, Trades=13
[INFO] Cluster 44 cluster: Short SMA=16, Long SMA=36, Sharpe=0.4967, Trades=77
[INFO] Cluster 45 cluster: Short SMA=168, Long SMA=202, Sharpe=0.0656, Trades=14
[INFO] Cluster 46 cluster: Short SMA=216, Long SMA=230, Sharpe=0.0436, Trades=20
[INFO] Cluster 47 cluster: Short SMA=58, Long SMA=76, Sharpe=1.2626, Trades=37
[INFO] Cluster 48 cluster: Short SMA=38, Long SMA=204, Sharpe=0.2445, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=76, Sharpe=1.2626, Trades=37
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=58, Long SMA=76, Sharpe=1.2626, Trades=37
[INFO] Top 2: Short SMA=32, Long SMA=46, Sharpe=0.9446, Trades=59
[INFO] Top 3: Short SMA=24, Long SMA=58, Sharpe=0.8879, Trades=37
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 9118 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 76
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(58/76) - Original Sharpe: 1.2626, Trades: 37
[INFO] Hierarchical cluster 2: SMA(32/46) - Original Sharpe: 0.9446, Trades: 59
[INFO] Hierarchical cluster 3: SMA(24/58) - Original Sharpe: 0.8879, Trades: 37
[INFO] Hierarchical cluster 4: SMA(44/74) - Original Sharpe: 0.8656, Trades: 33
[INFO] Hierarchical cluster 5: SMA(38/88) - Original Sharpe: 0.7439, Trades: 27
[INFO] Trimmed warm-up period. Evaluation data length: 2318
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/76)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (58/76) - Sharpe: 1.2626
[INFO] cluster 2: (32/46) - Sharpe: 0.9446
[INFO] cluster 3: (24/58) - Sharpe: 0.8879
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Out-of-sample period starts on: 2022-04-25
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2022-04-25 2022-04-25            45     0.869705            0.869705
1    2022-06-25 2022-06-25            43    -0.666869           -3.511422
2    2022-08-25 2022-08-25            43    -1.133345            2.580894
3    2022-10-25 2022-10-25            44    -2.239033           -4.238186
4    2022-12-25 2022-12-25            43    -3.070652           -1.425237
5    2023-02-25 2023-02-25            41    -3.791965           -4.091036
6    2023-04-25 2023-04-25            44    -2.516428           -3.781111
7    2023-06-25 2023-06-25            44     2.949798            2.949798
8    2023-08-25 2023-08-25            43     3.401253            3.401253
9    2023-10-25 2023-10-25            43    -4.105859           -2.141573
10   2023-12-25 2023-12-25            43    -3.479188           -2.989934
11   2024-02-25 2024-02-25            42     2.392603            2.982375
12   2024-04-25 2024-04-25            43    -2.501372           -2.606682
13   2024-06-25 2024-06-25            44     2.619489            2.919669
14   2024-08-25 2024-08-25            44    -3.660489           -2.112777
15   2024-10-25 2024-10-25            43     0.789016            2.729776
16   2024-12-25 2024-12-25             4    -0.779051           -0.779051
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2022-04-25   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2022-06-25   |         -0.7 |             -3.5 |         -2.8 | False         
[INFO] 2022-08-25   |         -1.1 |              2.6 |          3.7 | True          
[INFO] 2022-10-25   |         -2.2 |             -4.2 |         -2.0 | False         
[INFO] 2022-12-25   |         -3.1 |             -1.4 |          1.7 | True          
[INFO] 2023-02-25   |         -3.8 |             -4.1 |         -0.3 | False         
[INFO] 2023-04-25   |         -2.5 |             -3.8 |         -1.3 | False         
[INFO] 2023-06-25   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-08-25   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-10-25   |         -4.1 |             -2.1 |          2.0 | True          
[INFO] 2023-12-25   |         -3.5 |             -3.0 |          0.5 | True          
[INFO] 2024-02-25   |          2.4 |              3.0 |          0.6 | True          
[INFO] 2024-04-25   |         -2.5 |             -2.6 |         -0.1 | False         
[INFO] 2024-06-25   |          2.6 |              2.9 |          0.3 | True          
[INFO] 2024-08-25   |         -3.7 |             -2.1 |          1.6 | True          
[INFO] 2024-10-25   |          0.8 |              2.7 |          1.9 | True          
[INFO] 2024-12-25   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-25, 2023-06-25, 2023-08-25, 2024-12-25
[INFO] 
Total periods before exclusion: 17
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 13 periods (61.54% win rate)
[INFO] Updating Excel file with Hierarchical results for TEN...
[INFO] Excel file updated successfully. Added TEN with Hierarchical win rate 61.5% in row 47
[INFO] Added best Sharpe parameters 58/76 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 76
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(58/76) - Original Sharpe: 1.2626
[INFO] Added cluster 2 to portfolio: SMA(32/46) - Original Sharpe: 0.9446
[INFO] Added cluster 3 to portfolio: SMA(24/58) - Original Sharpe: 0.8879
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TEN_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3178
[INFO] Hierarchical Best out-of-sample Sharpe: -0.8139
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for TEN...
[INFO] Excel file updated successfully. Added TEN with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TEN
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for TY in column D: 18.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 172.16s
[INFO] Best parameters: Short SMA = 56, Long SMA = 82
[INFO] Best Sharpe ratio: 1.031512, Trades: 33
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @TY
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 11.36 contracts
[INFO] Maximum Position Size: 20 contracts
[INFO] Strategy Total P&L: $283,342.50
[INFO] Market Buy & Hold P&L: $-4,734.38
[INFO] Outperformance: $288,076.88
[INFO] Sharpe ratio (entire period, annualized): 0.579425
[INFO] Sharpe ratio (in-sample, annualized): 1.031512
[INFO] Sharpe ratio (out-of-sample, annualized): -0.443143
[INFO] Maximum Drawdown: $211,316.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 22
[INFO] Out-of-sample period trades: 11
[INFO] Total trades: 33
[INFO] In-sample P&L: $541,716.12
[INFO] Out-of-sample P&L: $-102,735.12
[INFO] 
Best parameters from GA: Short SMA = 56, Long SMA = 82, Sharpe = 1.031512
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] 
Best parameters:
[INFO] Short SMA: 56
[INFO] Long SMA: 82
[INFO] Sharpe Ratio: 1.031512
[INFO] Number of Trades: 33
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8851 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] Trades range: 10.0 to 328.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2970 to 2.7663
[INFO] Scaled Long SMA range: -2.7173 to 1.6949
[INFO] Scaled Sharpe ratio range: -2.9375 to 3.3040
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 213 elements
[INFO] Kmeans Cluster 1: 271 elements
[INFO] Kmeans Cluster 2: 244 elements
[INFO] Kmeans Cluster 3: 198 elements
[INFO] Kmeans Cluster 4: 176 elements
[INFO] Kmeans Cluster 5: 249 elements
[INFO] Kmeans Cluster 6: 113 elements
[INFO] Kmeans Cluster 7: 117 elements
[INFO] Kmeans Cluster 8: 211 elements
[INFO] Kmeans Cluster 9: 94 elements
[INFO] Kmeans Cluster 10: 222 elements
[INFO] Kmeans Cluster 11: 209 elements
[INFO] Kmeans Cluster 12: 169 elements
[INFO] Kmeans Cluster 13: 188 elements
[INFO] Kmeans Cluster 14: 124 elements
[INFO] Kmeans Cluster 15: 182 elements
[INFO] Kmeans Cluster 16: 259 elements
[INFO] Kmeans Cluster 17: 64 elements
[INFO] Kmeans Cluster 18: 194 elements
[INFO] Kmeans Cluster 19: 273 elements
[INFO] Kmeans Cluster 20: 159 elements
[INFO] Kmeans Cluster 21: 279 elements
[INFO] Kmeans Cluster 22: 175 elements
[INFO] Kmeans Cluster 23: 219 elements
[INFO] Kmeans Cluster 24: 108 elements
[INFO] Kmeans Cluster 25: 232 elements
[INFO] Kmeans Cluster 26: 122 elements
[INFO] Kmeans Cluster 27: 194 elements
[INFO] Kmeans Cluster 28: 137 elements
[INFO] Kmeans Cluster 29: 163 elements
[INFO] Kmeans Cluster 30: 178 elements
[INFO] Kmeans Cluster 31: 112 elements
[INFO] Kmeans Cluster 32: 173 elements
[INFO] Kmeans Cluster 33: 140 elements
[INFO] Kmeans Cluster 34: 128 elements
[INFO] Kmeans Cluster 35: 236 elements
[INFO] Kmeans Cluster 36: 145 elements
[INFO] Kmeans Cluster 37: 173 elements
[INFO] Kmeans Cluster 38: 210 elements
[INFO] Kmeans Cluster 39: 168 elements
[INFO] Kmeans Cluster 40: 187 elements
[INFO] Kmeans Cluster 41: 128 elements
[INFO] Kmeans Cluster 42: 170 elements
[INFO] Kmeans Cluster 43: 176 elements
[INFO] Kmeans Cluster 44: 143 elements
[INFO] Kmeans Cluster 45: 93 elements
[INFO] Kmeans Cluster 46: 193 elements
[INFO] Kmeans Cluster 47: 198 elements
[INFO] Kmeans Cluster 48: 131 elements
[INFO] Kmeans Cluster 49: 211 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=97.69, Long SMA=122.31, Sharpe=0.0707
[INFO] Centroid 1: Short SMA=187.17, Long SMA=268.51, Sharpe=-0.2112
[INFO] Centroid 2: Short SMA=35.66, Long SMA=186.95, Sharpe=0.3908
[INFO] Centroid 3: Short SMA=22.77, Long SMA=102.43, Sharpe=0.5708
[INFO] Centroid 4: Short SMA=100.59, Long SMA=219.11, Sharpe=0.2931
[INFO] Centroid 5: Short SMA=47.50, Long SMA=256.09, Sharpe=0.3643
[INFO] Centroid 6: Short SMA=158.99, Long SMA=186.50, Sharpe=0.2438
[INFO] Centroid 7: Short SMA=28.72, Long SMA=52.34, Sharpe=0.3513
[INFO] Centroid 8: Short SMA=260.58, Long SMA=279.78, Sharpe=-0.0326
[INFO] Centroid 9: Short SMA=141.14, Long SMA=166.45, Sharpe=0.4121
[INFO] Centroid 10: Short SMA=188.66, Long SMA=231.17, Sharpe=-0.1936
[INFO] Centroid 11: Short SMA=108.49, Long SMA=189.23, Sharpe=0.3610
[INFO] Centroid 12: Short SMA=63.54, Long SMA=94.72, Sharpe=0.4341
[INFO] Centroid 13: Short SMA=48.72, Long SMA=220.21, Sharpe=0.3072
[INFO] Centroid 14: Short SMA=49.15, Long SMA=77.34, Sharpe=0.7755
[INFO] Centroid 15: Short SMA=45.58, Long SMA=127.75, Sharpe=0.3153
[INFO] Centroid 16: Short SMA=213.92, Long SMA=236.12, Sharpe=-0.0351
[INFO] Centroid 17: Short SMA=17.44, Long SMA=27.59, Sharpe=-0.0925
[INFO] Centroid 18: Short SMA=24.74, Long SMA=282.45, Sharpe=0.2867
[INFO] Centroid 19: Short SMA=163.05, Long SMA=251.19, Sharpe=-0.1012
[INFO] Centroid 20: Short SMA=226.79, Long SMA=263.07, Sharpe=-0.1478
[INFO] Centroid 21: Short SMA=74.48, Long SMA=203.66, Sharpe=0.3752
[INFO] Centroid 22: Short SMA=74.64, Long SMA=159.36, Sharpe=0.0596
[INFO] Centroid 23: Short SMA=28.50, Long SMA=156.45, Sharpe=0.3989
[INFO] Centroid 24: Short SMA=240.63, Long SMA=256.65, Sharpe=-0.3547
[INFO] Centroid 25: Short SMA=171.27, Long SMA=201.94, Sharpe=0.0722
[INFO] Centroid 26: Short SMA=134.36, Long SMA=195.48, Sharpe=0.4168
[INFO] Centroid 27: Short SMA=25.48, Long SMA=221.57, Sharpe=0.4404
[INFO] Centroid 28: Short SMA=127.71, Long SMA=231.55, Sharpe=0.2076
[INFO] Centroid 29: Short SMA=115.48, Long SMA=152.04, Sharpe=0.0894
[INFO] Centroid 30: Short SMA=20.40, Long SMA=250.24, Sharpe=0.2495
[INFO] Centroid 31: Short SMA=23.68, Long SMA=44.59, Sharpe=0.1495
[INFO] Centroid 32: Short SMA=68.28, Long SMA=120.58, Sharpe=0.1565
[INFO] Centroid 33: Short SMA=87.33, Long SMA=177.91, Sharpe=0.1989
[INFO] Centroid 34: Short SMA=82.63, Long SMA=102.16, Sharpe=0.2634
[INFO] Centroid 35: Short SMA=70.32, Long SMA=238.57, Sharpe=0.4127
[INFO] Centroid 36: Short SMA=28.48, Long SMA=67.52, Sharpe=0.5171
[INFO] Centroid 37: Short SMA=141.16, Long SMA=169.61, Sharpe=0.5356
[INFO] Centroid 38: Short SMA=83.45, Long SMA=144.40, Sharpe=-0.0405
[INFO] Centroid 39: Short SMA=217.14, Long SMA=277.17, Sharpe=-0.0265
[INFO] Centroid 40: Short SMA=119.86, Long SMA=145.80, Sharpe=0.2276
[INFO] Centroid 41: Short SMA=34.34, Long SMA=285.86, Sharpe=0.1610
[INFO] Centroid 42: Short SMA=181.15, Long SMA=205.05, Sharpe=-0.0567
[INFO] Centroid 43: Short SMA=53.30, Long SMA=169.54, Sharpe=0.2304
[INFO] Centroid 44: Short SMA=144.85, Long SMA=240.31, Sharpe=0.0733
[INFO] Centroid 45: Short SMA=277.98, Long SMA=292.58, Sharpe=-0.1622
[INFO] Centroid 46: Short SMA=131.51, Long SMA=213.95, Sharpe=0.3285
[INFO] Centroid 47: Short SMA=21.44, Long SMA=133.00, Sharpe=0.5017
[INFO] Centroid 48: Short SMA=19.45, Long SMA=196.27, Sharpe=0.5520
[INFO] Centroid 49: Short SMA=39.99, Long SMA=79.81, Sharpe=0.6394
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=56, Long SMA=82, Sharpe=1.0315, Trades=33
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=54, Long SMA=78, Sharpe=0.8046, Trades=35
[INFO] Kmeans Top 2: Short SMA=40, Long SMA=78, Sharpe=0.6794, Trades=32
[INFO] Kmeans Top 3: Short SMA=140, Long SMA=170, Sharpe=0.6020, Trades=25
[INFO] Kmeans Top 4: Short SMA=22, Long SMA=132, Sharpe=0.5670, Trades=26
[INFO] Kmeans Top 5: Short SMA=20, Long SMA=198, Sharpe=0.5626, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (98, 122)
[INFO]   Rounded: (187, 269)
[INFO]   Nearest: (188.0, 268.0)
[INFO]   Rounded: (36, 187)
[INFO]   Nearest: (36.0, 186.0)
[INFO]   Rounded: (23, 102)
[INFO]   Nearest: (22.0, 102.0)
[INFO]   Rounded: (101, 219)
[INFO]   Nearest: (100.0, 220.0)
[INFO]   Rounded: (48, 256)
[INFO]   Rounded: (159, 186)
[INFO]   Nearest: (158.0, 186.0)
[INFO]   Rounded: (29, 52)
[INFO]   Nearest: (28.0, 52.0)
[INFO]   Rounded: (261, 280)
[INFO]   Nearest: (260.0, 280.0)
[INFO]   Rounded: (141, 166)
[INFO]   Nearest: (142.0, 166.0)
[INFO]   Rounded: (189, 231)
[INFO]   Nearest: (188.0, 232.0)
[INFO]   Rounded: (108, 189)
[INFO]   Nearest: (108.0, 190.0)
[INFO]   Rounded: (64, 95)
[INFO]   Nearest: (64.0, 94.0)
[INFO]   Rounded: (49, 220)
[INFO]   Nearest: (48.0, 220.0)
[INFO]   Rounded: (49, 77)
[INFO]   Nearest: (50.0, 78.0)
[INFO]   Rounded: (46, 128)
[INFO]   Rounded: (214, 236)
[INFO]   Rounded: (17, 28)
[INFO]   Nearest: (18.0, 28.0)
[INFO]   Rounded: (25, 282)
[INFO]   Nearest: (24.0, 282.0)
[INFO]   Rounded: (163, 251)
[INFO]   Nearest: (164.0, 252.0)
[INFO]   Rounded: (227, 263)
[INFO]   Nearest: (226.0, 264.0)
[INFO]   Rounded: (74, 204)
[INFO]   Rounded: (75, 159)
[INFO]   Nearest: (74.0, 160.0)
[INFO]   Rounded: (29, 156)
[INFO]   Nearest: (28.0, 156.0)
[INFO]   Rounded: (241, 257)
[INFO]   Nearest: (240.0, 256.0)
[INFO]   Rounded: (171, 202)
[INFO]   Nearest: (172.0, 202.0)
[INFO]   Rounded: (134, 195)
[INFO]   Nearest: (134.0, 196.0)
[INFO]   Rounded: (25, 222)
[INFO]   Nearest: (26.0, 222.0)
[INFO]   Rounded: (128, 232)
[INFO]   Rounded: (115, 152)
[INFO]   Nearest: (116.0, 152.0)
[INFO]   Rounded: (20, 250)
[INFO]   Rounded: (24, 45)
[INFO]   Nearest: (24.0, 44.0)
[INFO]   Rounded: (68, 121)
[INFO]   Nearest: (68.0, 120.0)
[INFO]   Rounded: (87, 178)
[INFO]   Nearest: (88.0, 178.0)
[INFO]   Rounded: (83, 102)
[INFO]   Nearest: (82.0, 102.0)
[INFO]   Rounded: (70, 239)
[INFO]   Nearest: (70.0, 238.0)
[INFO]   Rounded: (28, 68)
[INFO]   Rounded: (141, 170)
[INFO]   Nearest: (142.0, 170.0)
[INFO]   Rounded: (83, 144)
[INFO]   Nearest: (84.0, 144.0)
[INFO]   Rounded: (217, 277)
[INFO]   Nearest: (218.0, 278.0)
[INFO]   Rounded: (120, 146)
[INFO]   Rounded: (34, 286)
[INFO]   Rounded: (181, 205)
[INFO]   Nearest: (182.0, 206.0)
[INFO]   Rounded: (53, 170)
[INFO]   Nearest: (54.0, 170.0)
[INFO]   Rounded: (145, 240)
[INFO]   Nearest: (144.0, 240.0)
[INFO]   Rounded: (278, 293)
[INFO]   Nearest: (278.0, 292.0)
[INFO]   Rounded: (132, 214)
[INFO]   Rounded: (21, 133)
[INFO]   Nearest: (22.0, 132.0)
[INFO]   Rounded: (19, 196)
[INFO]   Nearest: (20.0, 196.0)
[INFO]   Rounded: (40, 80)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 56, Long SMA: 82
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(54/78) - Original Sharpe: 0.8046, Trades: 35
[INFO] Kmeans cluster 2: SMA(40/78) - Original Sharpe: 0.6794, Trades: 32
[INFO] Kmeans cluster 3: SMA(140/170) - Original Sharpe: 0.6020, Trades: 25
[INFO] Kmeans cluster 4: SMA(22/132) - Original Sharpe: 0.5670, Trades: 26
[INFO] Kmeans cluster 5: SMA(20/198) - Original Sharpe: 0.5626, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (56/82)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (54/78) - Sharpe: 0.8046
[INFO] cluster 2: (40/78) - Sharpe: 0.6794
[INFO] cluster 3: (140/170) - Sharpe: 0.6020
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.704271           -2.639131
1    2021-11-14 2021-11-14            43     0.838842            0.838842
2    2022-01-14 2022-01-14            41     1.984191            1.765231
3    2022-03-14 2022-03-14            44     4.120920            4.120920
4    2022-05-14 2022-05-14            43     0.411261            0.411261
5    2022-07-14 2022-07-14            44     0.308673           -0.657666
6    2022-09-14 2022-09-14            43    -1.526198            0.186104
7    2022-11-14 2022-11-14            43    -1.104580           -0.318002
8    2023-01-14 2023-01-14            41    -5.413014           -5.575101
9    2023-03-14 2023-03-14            44    -1.314612           -0.818166
10   2023-05-14 2023-05-14            44    -1.913035           -2.989483
11   2023-07-14 2023-07-14            44     3.093754            3.093754
12   2023-09-14 2023-09-14            43     2.065825            2.065825
13   2023-11-14 2023-11-14            42    -3.774049           -4.194351
14   2024-01-14 2024-01-14            43    -1.733531           -2.050822
15   2024-03-14 2024-03-14            42     0.586636            2.773075
16   2024-05-14 2024-05-14            44    -1.885239           -1.292725
17   2024-07-14 2024-07-14            45     3.577993            3.577993
18   2024-09-14 2024-09-14            43    -4.939107           -6.330947
19   2024-11-14 2024-11-14            33     1.144905            1.144905
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.7 |             -2.6 |          0.1 | True          
[INFO] 2021-11-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-01-14   |          2.0 |              1.8 |         -0.2 | False         
[INFO] 2022-03-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.3 |             -0.7 |         -1.0 | False         
[INFO] 2022-09-14   |         -1.5 |              0.2 |          1.7 | True          
[INFO] 2022-11-14   |         -1.1 |             -0.3 |          0.8 | True          
[INFO] 2023-01-14   |         -5.4 |             -5.6 |         -0.2 | False         
[INFO] 2023-03-14   |         -1.3 |             -0.8 |          0.5 | True          
[INFO] 2023-05-14   |         -1.9 |             -3.0 |         -1.1 | False         
[INFO] 2023-07-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.8 |             -4.2 |         -0.4 | False         
[INFO] 2024-01-14   |         -1.7 |             -2.1 |         -0.4 | False         
[INFO] 2024-03-14   |          0.6 |              2.8 |          2.2 | True          
[INFO] 2024-05-14   |         -1.9 |             -1.3 |          0.6 | True          
[INFO] 2024-07-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -4.9 |             -6.3 |         -1.4 | False         
[INFO] 2024-11-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14, 2024-07-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 6 of 13 periods (46.15% win rate)
[INFO] Updating Excel file with Kmeans results for TY...
[INFO] Excel file updated successfully. Added TY with Kmeans win rate 46.2% in row 48
[INFO] Added best Sharpe parameters 56/82 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 56, Long SMA: 82
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(54/78) - Original Sharpe: 0.8046
[INFO] Added cluster 2 to portfolio: SMA(40/78) - Original Sharpe: 0.6794
[INFO] Added cluster 3 to portfolio: SMA(140/170) - Original Sharpe: 0.6020
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TY_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1537
[INFO] Kmeans Best out-of-sample Sharpe: -0.4431
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for TY...
[INFO] Excel file updated successfully. Added TY with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TY
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] 
Best parameters:
[INFO] Short SMA: 56
[INFO] Long SMA: 82
[INFO] Sharpe Ratio: 1.031512
[INFO] Number of Trades: 33
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 8851 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] Trades range: 10.0 to 328.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2970 to 2.7663
[INFO] Scaled Long SMA range: -2.7173 to 1.6949
[INFO] Scaled Sharpe ratio range: -2.9375 to 3.3040
[INFO] Scaled Trades range: -0.7511 to 15.9532
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 8851 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5979
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 197 elements
[INFO] Cluster 1: 465 elements
[INFO] Cluster 2: 273 elements
[INFO] Cluster 3: 23 elements
[INFO] Cluster 4: 113 elements
[INFO] Cluster 5: 254 elements
[INFO] Cluster 6: 406 elements
[INFO] Cluster 7: 38 elements
[INFO] Cluster 8: 326 elements
[INFO] Cluster 9: 320 elements
[INFO] Cluster 10: 28 elements
[INFO] Cluster 11: 55 elements
[INFO] Cluster 12: 328 elements
[INFO] Cluster 13: 62 elements
[INFO] Cluster 14: 223 elements
[INFO] Cluster 15: 308 elements
[INFO] Cluster 16: 427 elements
[INFO] Cluster 17: 317 elements
[INFO] Cluster 18: 35 elements
[INFO] Cluster 19: 201 elements
[INFO] Cluster 20: 31 elements
[INFO] Cluster 21: 162 elements
[INFO] Cluster 22: 379 elements
[INFO] Cluster 23: 185 elements
[INFO] Cluster 24: 230 elements
[INFO] Cluster 25: 124 elements
[INFO] Cluster 26: 224 elements
[INFO] Cluster 27: 254 elements
[INFO] Cluster 28: 162 elements
[INFO] Cluster 29: 41 elements
[INFO] Cluster 30: 75 elements
[INFO] Cluster 31: 52 elements
[INFO] Cluster 32: 160 elements
[INFO] Cluster 33: 205 elements
[INFO] Cluster 34: 193 elements
[INFO] Cluster 35: 373 elements
[INFO] Cluster 36: 189 elements
[INFO] Cluster 37: 24 elements
[INFO] Cluster 38: 190 elements
[INFO] Cluster 39: 101 elements
[INFO] Cluster 40: 72 elements
[INFO] Cluster 41: 163 elements
[INFO] Cluster 42: 16 elements
[INFO] Cluster 43: 217 elements
[INFO] Cluster 44: 121 elements
[INFO] Cluster 45: 81 elements
[INFO] Cluster 46: 148 elements
[INFO] Cluster 47: 4 elements
[INFO] Cluster 48: 110 elements
[INFO] Cluster 49: 166 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=190, Long SMA=202, Sharpe=-0.0442, Trades=29
[INFO] Cluster 1 cluster: Short SMA=54, Long SMA=254, Sharpe=0.3957, Trades=10
[INFO] Cluster 2 cluster: Short SMA=264, Long SMA=282, Sharpe=-0.0488, Trades=18
[INFO] Cluster 3 cluster: Short SMA=16, Long SMA=20, Sharpe=0.0002, Trades=194
[INFO] Cluster 4 cluster: Short SMA=34, Long SMA=62, Sharpe=0.7541, Trades=48
[INFO] Cluster 5 cluster: Short SMA=26, Long SMA=212, Sharpe=0.3879, Trades=20
[INFO] Cluster 6 cluster: Short SMA=196, Long SMA=268, Sharpe=-0.2418, Trades=12
[INFO] Cluster 7 cluster: Short SMA=138, Long SMA=140, Sharpe=0.2017, Trades=83
[INFO] Cluster 8 cluster: Short SMA=112, Long SMA=222, Sharpe=0.2856, Trades=15
[INFO] Cluster 9 cluster: Short SMA=66, Long SMA=174, Sharpe=0.1379, Trades=19
[INFO] Cluster 10 cluster: Short SMA=72, Long SMA=76, Sharpe=0.5345, Trades=73
[INFO] Cluster 11 cluster: Short SMA=18, Long SMA=36, Sharpe=0.0231, Trades=82
[INFO] Cluster 12 cluster: Short SMA=52, Long SMA=214, Sharpe=0.2560, Trades=18
[INFO] Cluster 13 cluster: Short SMA=44, Long SMA=50, Sharpe=0.3776, Trades=88
[INFO] Cluster 14 cluster: Short SMA=16, Long SMA=254, Sharpe=0.1875, Trades=22
[INFO] Cluster 15 cluster: Short SMA=38, Long SMA=178, Sharpe=0.4506, Trades=20
[INFO] Cluster 16 cluster: Short SMA=128, Long SMA=198, Sharpe=0.3281, Trades=15
[INFO] Cluster 17 cluster: Short SMA=84, Long SMA=208, Sharpe=0.3975, Trades=15
[INFO] Cluster 18 cluster: Short SMA=18, Long SMA=26, Sharpe=-0.0762, Trades=124
[INFO] Cluster 19 cluster: Short SMA=46, Long SMA=128, Sharpe=0.3194, Trades=25
[INFO] Cluster 20 cluster: Short SMA=268, Long SMA=270, Sharpe=0.0120, Trades=42
[INFO] Cluster 21 cluster: Short SMA=16, Long SMA=88, Sharpe=0.5757, Trades=38
[INFO] Cluster 22 cluster: Short SMA=80, Long SMA=144, Sharpe=-0.0377, Trades=23
[INFO] Cluster 23 cluster: Short SMA=18, Long SMA=172, Sharpe=0.3840, Trades=26
[INFO] Cluster 24 cluster: Short SMA=30, Long SMA=288, Sharpe=0.2216, Trades=12
[INFO] Cluster 25 cluster: Short SMA=22, Long SMA=52, Sharpe=0.1949, Trades=54
[INFO] Cluster 26 cluster: Short SMA=22, Long SMA=130, Sharpe=0.6045, Trades=26
[INFO] Cluster 27 cluster: Short SMA=212, Long SMA=238, Sharpe=-0.0277, Trades=16
[INFO] Cluster 28 cluster: Short SMA=92, Long SMA=114, Sharpe=0.2257, Trades=33
[INFO] Cluster 29 cluster: Short SMA=166, Long SMA=174, Sharpe=0.1823, Trades=35
[INFO] Cluster 30 cluster: Short SMA=80, Long SMA=92, Sharpe=0.3014, Trades=45
[INFO] Cluster 31 cluster: Short SMA=118, Long SMA=124, Sharpe=0.0776, Trades=54
[INFO] Cluster 32 cluster: Short SMA=66, Long SMA=122, Sharpe=0.1280, Trades=25
[INFO] Cluster 33 cluster: Short SMA=40, Long SMA=80, Sharpe=0.7834, Trades=33
[INFO] Cluster 34 cluster: Short SMA=144, Long SMA=238, Sharpe=0.1305, Trades=13
[INFO] Cluster 35 cluster: Short SMA=166, Long SMA=248, Sharpe=-0.1803, Trades=13
[INFO] Cluster 36 cluster: Short SMA=228, Long SMA=276, Sharpe=0.0138, Trades=12
[INFO] Cluster 37 cluster: Short SMA=196, Long SMA=198, Sharpe=-0.0033, Trades=68
[INFO] Cluster 38 cluster: Short SMA=168, Long SMA=202, Sharpe=0.1099, Trades=19
[INFO] Cluster 39 cluster: Short SMA=240, Long SMA=258, Sharpe=-0.3996, Trades=20
[INFO] Cluster 40 cluster: Short SMA=148, Long SMA=160, Sharpe=0.6097, Trades=33
[INFO] Cluster 41 cluster: Short SMA=116, Long SMA=146, Sharpe=0.2522, Trades=27
[INFO] Cluster 43 cluster: Short SMA=136, Long SMA=178, Sharpe=0.5118, Trades=19
[INFO] Cluster 44 cluster: Short SMA=186, Long SMA=230, Sharpe=-0.2483, Trades=17
[INFO] Cluster 45 cluster: Short SMA=110, Long SMA=128, Sharpe=-0.0170, Trades=36
[INFO] Cluster 46 cluster: Short SMA=104, Long SMA=162, Sharpe=0.0754, Trades=19
[INFO] Cluster 48 cluster: Short SMA=56, Long SMA=100, Sharpe=0.4819, Trades=29
[INFO] Cluster 49 cluster: Short SMA=40, Long SMA=92, Sharpe=0.5052, Trades=27
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=56, Long SMA=82, Sharpe=1.0315, Trades=33
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=40, Long SMA=80, Sharpe=0.7834, Trades=33
[INFO] Top 2: Short SMA=34, Long SMA=62, Sharpe=0.7541, Trades=48
[INFO] Top 3: Short SMA=148, Long SMA=160, Sharpe=0.6097, Trades=33
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 8831 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 56, Long SMA: 82
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(40/80) - Original Sharpe: 0.7834, Trades: 33
[INFO] Hierarchical cluster 2: SMA(34/62) - Original Sharpe: 0.7541, Trades: 48
[INFO] Hierarchical cluster 3: SMA(148/160) - Original Sharpe: 0.6097, Trades: 33
[INFO] Hierarchical cluster 4: SMA(22/130) - Original Sharpe: 0.6045, Trades: 26
[INFO] Hierarchical cluster 5: SMA(16/88) - Original Sharpe: 0.5757, Trades: 38
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (56/82)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (40/80) - Sharpe: 0.7834
[INFO] cluster 2: (34/62) - Sharpe: 0.7541
[INFO] cluster 3: (148/160) - Sharpe: 0.6097
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.704271           -1.545410
1    2021-11-14 2021-11-14            43     0.838842           -2.150376
2    2022-01-14 2022-01-14            41     1.984191            0.793367
3    2022-03-14 2022-03-14            44     4.120920            4.120920
4    2022-05-14 2022-05-14            43     0.411261            0.411261
5    2022-07-14 2022-07-14            44     0.308673           -2.818461
6    2022-09-14 2022-09-14            43    -1.526198            1.234189
7    2022-11-14 2022-11-14            43    -1.104580           -1.035674
8    2023-01-14 2023-01-14            41    -5.413014           -4.922401
9    2023-03-14 2023-03-14            44    -1.314612           -0.216955
10   2023-05-14 2023-05-14            44    -1.913035           -2.681257
11   2023-07-14 2023-07-14            44     3.093754            2.924176
12   2023-09-14 2023-09-14            43     2.065825            1.822853
13   2023-11-14 2023-11-14            42    -3.774049           -4.025181
14   2024-01-14 2024-01-14            43    -1.733531           -1.818473
15   2024-03-14 2024-03-14            42     0.586636            2.947021
16   2024-05-14 2024-05-14            44    -1.885239           -0.076741
17   2024-07-14 2024-07-14            45     3.577993            3.577993
18   2024-09-14 2024-09-14            43    -4.939107           -5.521874
19   2024-11-14 2024-11-14            33     1.144905            1.144905
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.7 |             -1.5 |          1.2 | True          
[INFO] 2021-11-14   |          0.8 |             -2.2 |         -3.0 | False         
[INFO] 2022-01-14   |          2.0 |              0.8 |         -1.2 | False         
[INFO] 2022-03-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.3 |             -2.8 |         -3.1 | False         
[INFO] 2022-09-14   |         -1.5 |              1.2 |          2.7 | True          
[INFO] 2022-11-14   |         -1.1 |             -1.0 |          0.1 | True          
[INFO] 2023-01-14   |         -5.4 |             -4.9 |          0.5 | True          
[INFO] 2023-03-14   |         -1.3 |             -0.2 |          1.1 | True          
[INFO] 2023-05-14   |         -1.9 |             -2.7 |         -0.8 | False         
[INFO] 2023-07-14   |          3.1 |              2.9 |         -0.2 | False         
[INFO] 2023-09-14   |          2.1 |              1.8 |         -0.3 | False         
[INFO] 2023-11-14   |         -3.8 |             -4.0 |         -0.2 | False         
[INFO] 2024-01-14   |         -1.7 |             -1.8 |         -0.1 | False         
[INFO] 2024-03-14   |          0.6 |              2.9 |          2.3 | True          
[INFO] 2024-05-14   |         -1.9 |             -0.1 |          1.8 | True          
[INFO] 2024-07-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -4.9 |             -5.5 |         -0.6 | False         
[INFO] 2024-11-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2024-07-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 16 periods (43.75% win rate)
[INFO] Updating Excel file with Hierarchical results for TY...
[INFO] Excel file updated successfully. Added TY with Hierarchical win rate 43.8% in row 48
[INFO] Added best Sharpe parameters 56/82 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 56, Long SMA: 82
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(40/80) - Original Sharpe: 0.7834
[INFO] Added cluster 2 to portfolio: SMA(34/62) - Original Sharpe: 0.7541
[INFO] Added cluster 3 to portfolio: SMA(148/160) - Original Sharpe: 0.6097
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TY_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0591
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4431
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for TY...
[INFO] Excel file updated successfully. Added TY with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TY
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for TU in column D: 10.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 115.42s
[INFO] Best parameters: Short SMA = 274, Long SMA = 284
[INFO] Best Sharpe ratio: 0.774149, Trades: 18
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @TU
[INFO] Big Point Value (from data): 2000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 36.04 contracts
[INFO] Maximum Position Size: 152 contracts
[INFO] Strategy Total P&L: $685,372.50
[INFO] Market Buy & Hold P&L: $-12,695.31
[INFO] Outperformance: $698,067.81
[INFO] Sharpe ratio (entire period, annualized): 0.880451
[INFO] Sharpe ratio (in-sample, annualized): 0.774149
[INFO] Sharpe ratio (out-of-sample, annualized): 1.105817
[INFO] Maximum Drawdown: $100,651.25
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 16
[INFO] Out-of-sample period trades: 2
[INFO] Total trades: 18
[INFO] In-sample P&L: $401,453.44
[INFO] Out-of-sample P&L: $274,450.31
[INFO] 
Best parameters from GA: Short SMA = 274, Long SMA = 284, Sharpe = 0.774149
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 2000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9208 to 0.7741
[INFO] 
Best parameters:
[INFO] Short SMA: 274
[INFO] Long SMA: 284
[INFO] Sharpe Ratio: 0.774149
[INFO] Number of Trades: 18
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7800 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9208 to 0.7741
[INFO] Trades range: 10.0 to 366.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2341 to 2.7587
[INFO] Scaled Long SMA range: -2.5984 to 1.8280
[INFO] Scaled Sharpe ratio range: -5.1407 to 2.7922
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 80 elements
[INFO] Kmeans Cluster 1: 177 elements
[INFO] Kmeans Cluster 2: 132 elements
[INFO] Kmeans Cluster 3: 252 elements
[INFO] Kmeans Cluster 4: 112 elements
[INFO] Kmeans Cluster 5: 127 elements
[INFO] Kmeans Cluster 6: 173 elements
[INFO] Kmeans Cluster 7: 172 elements
[INFO] Kmeans Cluster 8: 297 elements
[INFO] Kmeans Cluster 9: 207 elements
[INFO] Kmeans Cluster 10: 138 elements
[INFO] Kmeans Cluster 11: 145 elements
[INFO] Kmeans Cluster 12: 332 elements
[INFO] Kmeans Cluster 13: 218 elements
[INFO] Kmeans Cluster 14: 238 elements
[INFO] Kmeans Cluster 15: 201 elements
[INFO] Kmeans Cluster 16: 141 elements
[INFO] Kmeans Cluster 17: 60 elements
[INFO] Kmeans Cluster 18: 237 elements
[INFO] Kmeans Cluster 19: 110 elements
[INFO] Kmeans Cluster 20: 111 elements
[INFO] Kmeans Cluster 21: 128 elements
[INFO] Kmeans Cluster 22: 164 elements
[INFO] Kmeans Cluster 23: 63 elements
[INFO] Kmeans Cluster 24: 201 elements
[INFO] Kmeans Cluster 25: 231 elements
[INFO] Kmeans Cluster 26: 135 elements
[INFO] Kmeans Cluster 27: 101 elements
[INFO] Kmeans Cluster 28: 140 elements
[INFO] Kmeans Cluster 29: 82 elements
[INFO] Kmeans Cluster 30: 258 elements
[INFO] Kmeans Cluster 31: 53 elements
[INFO] Kmeans Cluster 32: 42 elements
[INFO] Kmeans Cluster 33: 124 elements
[INFO] Kmeans Cluster 34: 167 elements
[INFO] Kmeans Cluster 35: 204 elements
[INFO] Kmeans Cluster 36: 154 elements
[INFO] Kmeans Cluster 37: 124 elements
[INFO] Kmeans Cluster 38: 181 elements
[INFO] Kmeans Cluster 39: 157 elements
[INFO] Kmeans Cluster 40: 46 elements
[INFO] Kmeans Cluster 41: 189 elements
[INFO] Kmeans Cluster 42: 92 elements
[INFO] Kmeans Cluster 43: 174 elements
[INFO] Kmeans Cluster 44: 164 elements
[INFO] Kmeans Cluster 45: 94 elements
[INFO] Kmeans Cluster 46: 110 elements
[INFO] Kmeans Cluster 47: 233 elements
[INFO] Kmeans Cluster 48: 264 elements
[INFO] Kmeans Cluster 49: 65 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=171.65, Long SMA=191.60, Sharpe=-0.0021
[INFO] Centroid 1: Short SMA=83.75, Long SMA=208.98, Sharpe=0.2524
[INFO] Centroid 2: Short SMA=70.09, Long SMA=105.64, Sharpe=0.0915
[INFO] Centroid 3: Short SMA=204.58, Long SMA=240.25, Sharpe=0.3977
[INFO] Centroid 4: Short SMA=20.71, Long SMA=41.21, Sharpe=-0.4935
[INFO] Centroid 5: Short SMA=55.48, Long SMA=84.61, Sharpe=0.3322
[INFO] Centroid 6: Short SMA=48.37, Long SMA=279.66, Sharpe=0.4052
[INFO] Centroid 7: Short SMA=117.71, Long SMA=188.85, Sharpe=0.0931
[INFO] Centroid 8: Short SMA=130.90, Long SMA=221.24, Sharpe=0.2952
[INFO] Centroid 9: Short SMA=219.21, Long SMA=266.60, Sharpe=0.2978
[INFO] Centroid 10: Short SMA=94.28, Long SMA=175.19, Sharpe=0.1774
[INFO] Centroid 11: Short SMA=29.93, Long SMA=62.36, Sharpe=-0.2089
[INFO] Centroid 12: Short SMA=63.48, Long SMA=173.05, Sharpe=0.0487
[INFO] Centroid 13: Short SMA=26.24, Long SMA=149.21, Sharpe=0.2522
[INFO] Centroid 14: Short SMA=168.11, Long SMA=212.13, Sharpe=0.1968
[INFO] Centroid 15: Short SMA=52.28, Long SMA=111.75, Sharpe=0.2275
[INFO] Centroid 16: Short SMA=46.35, Long SMA=220.63, Sharpe=0.3598
[INFO] Centroid 17: Short SMA=273.23, Long SMA=284.50, Sharpe=0.6113
[INFO] Centroid 18: Short SMA=254.48, Long SMA=279.65, Sharpe=0.3955
[INFO] Centroid 19: Short SMA=210.67, Long SMA=228.09, Sharpe=0.5132
[INFO] Centroid 20: Short SMA=22.20, Long SMA=291.35, Sharpe=0.2140
[INFO] Centroid 21: Short SMA=238.08, Long SMA=255.67, Sharpe=0.1975
[INFO] Centroid 22: Short SMA=149.24, Long SMA=184.89, Sharpe=0.3323
[INFO] Centroid 23: Short SMA=68.51, Long SMA=88.35, Sharpe=0.5484
[INFO] Centroid 24: Short SMA=188.90, Long SMA=215.67, Sharpe=0.2964
[INFO] Centroid 25: Short SMA=113.06, Long SMA=143.27, Sharpe=0.0987
[INFO] Centroid 26: Short SMA=120.33, Long SMA=152.04, Sharpe=-0.0418
[INFO] Centroid 27: Short SMA=88.28, Long SMA=224.91, Sharpe=0.5043
[INFO] Centroid 28: Short SMA=22.84, Long SMA=59.16, Sharpe=-0.3502
[INFO] Centroid 29: Short SMA=16.90, Long SMA=122.59, Sharpe=0.1004
[INFO] Centroid 30: Short SMA=26.19, Long SMA=177.78, Sharpe=0.1579
[INFO] Centroid 31: Short SMA=152.79, Long SMA=167.47, Sharpe=0.5006
[INFO] Centroid 32: Short SMA=17.05, Long SMA=30.19, Sharpe=-0.7117
[INFO] Centroid 33: Short SMA=85.73, Long SMA=106.34, Sharpe=-0.1014
[INFO] Centroid 34: Short SMA=26.98, Long SMA=84.38, Sharpe=-0.0501
[INFO] Centroid 35: Short SMA=63.77, Long SMA=197.50, Sharpe=0.1103
[INFO] Centroid 36: Short SMA=37.36, Long SMA=81.35, Sharpe=0.1042
[INFO] Centroid 37: Short SMA=32.61, Long SMA=124.03, Sharpe=0.3799
[INFO] Centroid 38: Short SMA=22.46, Long SMA=271.92, Sharpe=0.3091
[INFO] Centroid 39: Short SMA=116.23, Long SMA=191.71, Sharpe=-0.0102
[INFO] Centroid 40: Short SMA=171.22, Long SMA=183.09, Sharpe=-0.2508
[INFO] Centroid 41: Short SMA=19.80, Long SMA=238.19, Sharpe=0.3644
[INFO] Centroid 42: Short SMA=109.02, Long SMA=124.50, Sharpe=0.2995
[INFO] Centroid 43: Short SMA=84.36, Long SMA=141.08, Sharpe=0.0028
[INFO] Centroid 44: Short SMA=137.70, Long SMA=169.23, Sharpe=0.1846
[INFO] Centroid 45: Short SMA=269.96, Long SMA=294.13, Sharpe=0.2528
[INFO] Centroid 46: Short SMA=150.27, Long SMA=236.05, Sharpe=0.1239
[INFO] Centroid 47: Short SMA=28.60, Long SMA=207.37, Sharpe=0.2573
[INFO] Centroid 48: Short SMA=57.26, Long SMA=140.06, Sharpe=0.1245
[INFO] Centroid 49: Short SMA=88.65, Long SMA=102.46, Sharpe=-0.2696
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=18
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=18
[INFO] Kmeans Top 2: Short SMA=64, Long SMA=82, Sharpe=0.5637, Trades=37
[INFO] Kmeans Top 3: Short SMA=212, Long SMA=228, Sharpe=0.5250, Trades=23
[INFO] Kmeans Top 4: Short SMA=90, Long SMA=224, Sharpe=0.5208, Trades=10
[INFO] Kmeans Top 5: Short SMA=154, Long SMA=166, Sharpe=0.4860, Trades=36
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (172, 192)
[INFO]   Rounded: (84, 209)
[INFO]   Nearest: (84.0, 208.0)
[INFO]   Rounded: (70, 106)
[INFO]   Rounded: (205, 240)
[INFO]   Nearest: (204.0, 240.0)
[INFO]   Rounded: (21, 41)
[INFO]   Nearest: (20.0, 42.0)
[INFO]   Rounded: (55, 85)
[INFO]   Nearest: (56.0, 84.0)
[INFO]   Rounded: (48, 280)
[INFO]   Rounded: (118, 189)
[INFO]   Nearest: (118.0, 188.0)
[INFO]   Rounded: (131, 221)
[INFO]   Nearest: (130.0, 222.0)
[INFO]   Rounded: (219, 267)
[INFO]   Nearest: (220.0, 266.0)
[INFO]   Rounded: (94, 175)
[INFO]   Nearest: (94.0, 176.0)
[INFO]   Rounded: (30, 62)
[INFO]   Rounded: (63, 173)
[INFO]   Nearest: (64.0, 174.0)
[INFO]   Rounded: (26, 149)
[INFO]   Nearest: (26.0, 150.0)
[INFO]   Rounded: (168, 212)
[INFO]   Rounded: (52, 112)
[INFO]   Rounded: (46, 221)
[INFO]   Nearest: (46.0, 220.0)
[INFO]   Rounded: (273, 284)
[INFO]   Nearest: (274.0, 284.0)
[INFO]   Rounded: (254, 280)
[INFO]   Rounded: (211, 228)
[INFO]   Nearest: (210.0, 228.0)
[INFO]   Rounded: (22, 291)
[INFO]   Nearest: (22.0, 292.0)
[INFO]   Rounded: (238, 256)
[INFO]   Rounded: (149, 185)
[INFO]   Nearest: (150.0, 184.0)
[INFO]   Rounded: (69, 88)
[INFO]   Nearest: (68.0, 88.0)
[INFO]   Rounded: (189, 216)
[INFO]   Nearest: (188.0, 216.0)
[INFO]   Rounded: (113, 143)
[INFO]   Nearest: (114.0, 144.0)
[INFO]   Rounded: (120, 152)
[INFO]   Rounded: (88, 225)
[INFO]   Nearest: (88.0, 224.0)
[INFO]   Rounded: (23, 59)
[INFO]   Nearest: (22.0, 60.0)
[INFO]   Rounded: (17, 123)
[INFO]   Nearest: (16.0, 122.0)
[INFO]   Rounded: (26, 178)
[INFO]   Rounded: (153, 167)
[INFO]   Nearest: (152.0, 168.0)
[INFO]   Rounded: (17, 30)
[INFO]   Nearest: (18.0, 30.0)
[INFO]   Rounded: (86, 106)
[INFO]   Rounded: (27, 84)
[INFO]   Nearest: (26.0, 84.0)
[INFO]   Rounded: (64, 198)
[INFO]   Rounded: (37, 81)
[INFO]   Nearest: (38.0, 82.0)
[INFO]   Rounded: (33, 124)
[INFO]   Nearest: (32.0, 124.0)
[INFO]   Rounded: (22, 272)
[INFO]   Rounded: (116, 192)
[INFO]   Rounded: (171, 183)
[INFO]   Nearest: (172.0, 184.0)
[INFO]   Rounded: (20, 238)
[INFO]   Rounded: (109, 124)
[INFO]   Nearest: (110.0, 124.0)
[INFO]   Rounded: (84, 141)
[INFO]   Nearest: (84.0, 142.0)
[INFO]   Rounded: (138, 169)
[INFO]   Nearest: (138.0, 170.0)
[INFO]   Rounded: (270, 294)
[INFO]   Rounded: (150, 236)
[INFO]   Rounded: (29, 207)
[INFO]   Nearest: (28.0, 208.0)
[INFO]   Rounded: (57, 140)
[INFO]   Nearest: (58.0, 140.0)
[INFO]   Rounded: (89, 102)
[INFO]   Nearest: (88.0, 102.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 274, Long SMA: 284
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(274/284) - Original Sharpe: 0.7741, Trades: 18
[INFO] Kmeans cluster 2: SMA(64/82) - Original Sharpe: 0.5637, Trades: 37
[INFO] Kmeans cluster 3: SMA(212/228) - Original Sharpe: 0.5250, Trades: 23
[INFO] Kmeans cluster 4: SMA(90/224) - Original Sharpe: 0.5208, Trades: 10
[INFO] Kmeans cluster 5: SMA(154/166) - Original Sharpe: 0.4860, Trades: 36
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (274/284)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (274/284) - Sharpe: 0.7741
[INFO] cluster 2: (64/82) - Sharpe: 0.5637
[INFO] cluster 3: (212/228) - Sharpe: 0.5250
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     5.346901            2.041010
1    2021-11-14 2021-11-14            43     1.829328            1.829328
2    2022-01-14 2022-01-14            41     4.222575            4.222575
3    2022-03-14 2022-03-14            44     3.242182            3.242182
4    2022-05-14 2022-05-14            43     1.473801            1.473801
5    2022-07-14 2022-07-14            44     2.919931            2.919931
6    2022-09-14 2022-09-14            43     2.385425            2.385425
7    2022-11-14 2022-11-14            43    -0.436907           -0.436907
8    2023-01-14 2023-01-14            41    -0.202608           -2.015105
9    2023-03-14 2023-03-14            44     0.324596            0.324596
10   2023-05-14 2023-05-14            44     3.890567            2.021830
11   2023-07-14 2023-07-14            44     3.021284            3.021284
12   2023-09-14 2023-09-14            43     1.135707            1.135707
13   2023-11-14 2023-11-14            42    -3.433823           -3.393658
14   2024-01-14 2024-01-14            43     3.467114            3.467114
15   2024-03-14 2024-03-14            42     2.327772            2.517183
16   2024-05-14 2024-05-14            44    -2.234806           -2.234806
17   2024-07-14 2024-07-14            45    -3.677302            4.078903
18   2024-09-14 2024-09-14            43     0.511850           -1.140253
19   2024-11-14 2024-11-14            33    -2.294343           -1.352254
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          5.3 |              2.0 |         -3.3 | False         
[INFO] 2021-11-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2022-01-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.2 |              3.2 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.2 |             -2.0 |         -1.8 | False         
[INFO] 2023-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.9 |              2.0 |         -1.9 | False         
[INFO] 2023-07-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.4 |             -3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |          2.3 |              2.5 |          0.2 | True          
[INFO] 2024-05-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -3.7 |              4.1 |          7.8 | True          
[INFO] 2024-09-14   |          0.5 |             -1.1 |         -1.6 | False         
[INFO] 2024-11-14   |         -2.3 |             -1.4 |          0.9 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-03-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 7
[INFO] Kmeans cluster wins (rounded comparison): 3 of 7 periods (42.86% win rate)
[INFO] Updating Excel file with Kmeans results for TU...
[INFO] Excel file updated successfully. Added TU with Kmeans win rate 42.9% in row 49
[INFO] Added best Sharpe parameters 274/284 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 274, Long SMA: 284
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(274/284) - Original Sharpe: 0.7741
[INFO] Added cluster 2 to portfolio: SMA(64/82) - Original Sharpe: 0.5637
[INFO] Added cluster 3 to portfolio: SMA(212/228) - Original Sharpe: 0.5250
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TU_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.9970
[INFO] Kmeans Best out-of-sample Sharpe: 1.1058
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for TU...
[INFO] Excel file updated successfully. Added TU with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TU
[INFO] Big Point Value: 2000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.9208 to 0.7741
[INFO] 
Best parameters:
[INFO] Short SMA: 274
[INFO] Long SMA: 284
[INFO] Sharpe Ratio: 0.774149
[INFO] Number of Trades: 18
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 7800 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.9208 to 0.7741
[INFO] Trades range: 10.0 to 366.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2341 to 2.7587
[INFO] Scaled Long SMA range: -2.5984 to 1.8280
[INFO] Scaled Sharpe ratio range: -5.1407 to 2.7922
[INFO] Scaled Trades range: -0.6610 to 14.6335
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 7800 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6561
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 117 elements
[INFO] Cluster 1: 71 elements
[INFO] Cluster 2: 86 elements
[INFO] Cluster 3: 378 elements
[INFO] Cluster 4: 320 elements
[INFO] Cluster 5: 137 elements
[INFO] Cluster 6: 161 elements
[INFO] Cluster 7: 40 elements
[INFO] Cluster 8: 306 elements
[INFO] Cluster 9: 218 elements
[INFO] Cluster 10: 149 elements
[INFO] Cluster 11: 66 elements
[INFO] Cluster 12: 178 elements
[INFO] Cluster 13: 282 elements
[INFO] Cluster 14: 471 elements
[INFO] Cluster 15: 276 elements
[INFO] Cluster 16: 269 elements
[INFO] Cluster 17: 20 elements
[INFO] Cluster 18: 279 elements
[INFO] Cluster 19: 56 elements
[INFO] Cluster 20: 87 elements
[INFO] Cluster 21: 163 elements
[INFO] Cluster 22: 272 elements
[INFO] Cluster 23: 197 elements
[INFO] Cluster 24: 48 elements
[INFO] Cluster 25: 160 elements
[INFO] Cluster 26: 126 elements
[INFO] Cluster 27: 82 elements
[INFO] Cluster 28: 390 elements
[INFO] Cluster 29: 16 elements
[INFO] Cluster 30: 160 elements
[INFO] Cluster 31: 111 elements
[INFO] Cluster 32: 4 elements
[INFO] Cluster 33: 176 elements
[INFO] Cluster 34: 107 elements
[INFO] Cluster 35: 130 elements
[INFO] Cluster 36: 16 elements
[INFO] Cluster 37: 347 elements
[INFO] Cluster 38: 241 elements
[INFO] Cluster 39: 199 elements
[INFO] Cluster 40: 119 elements
[INFO] Cluster 41: 264 elements
[INFO] Cluster 42: 34 elements
[INFO] Cluster 43: 82 elements
[INFO] Cluster 44: 140 elements
[INFO] Cluster 45: 40 elements
[INFO] Cluster 46: 27 elements
[INFO] Cluster 47: 33 elements
[INFO] Cluster 48: 136 elements
[INFO] Cluster 49: 13 elements
[INFO] Using 46 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=182, Long SMA=190, Sharpe=0.2467, Trades=44
[INFO] Cluster 1 cluster: Short SMA=56, Long SMA=62, Sharpe=0.0102, Trades=79
[INFO] Cluster 2 cluster: Short SMA=64, Long SMA=80, Sharpe=0.4016, Trades=45
[INFO] Cluster 3 cluster: Short SMA=98, Long SMA=146, Sharpe=0.0609, Trades=20
[INFO] Cluster 4 cluster: Short SMA=204, Long SMA=238, Sharpe=0.3352, Trades=15
[INFO] Cluster 5 cluster: Short SMA=88, Long SMA=106, Sharpe=-0.2822, Trades=35
[INFO] Cluster 6 cluster: Short SMA=16, Long SMA=60, Sharpe=-0.3494, Trades=62
[INFO] Cluster 7 cluster: Short SMA=104, Long SMA=106, Sharpe=0.0933, Trades=121
[INFO] Cluster 8 cluster: Short SMA=42, Long SMA=114, Sharpe=0.3773, Trades=23
[INFO] Cluster 9 cluster: Short SMA=42, Long SMA=86, Sharpe=0.0945, Trades=35
[INFO] Cluster 10 cluster: Short SMA=240, Long SMA=256, Sharpe=0.2022, Trades=19
[INFO] Cluster 11 cluster: Short SMA=18, Long SMA=32, Sharpe=-0.6461, Trades=98
[INFO] Cluster 12 cluster: Short SMA=22, Long SMA=88, Sharpe=-0.0889, Trades=41
[INFO] Cluster 13 cluster: Short SMA=30, Long SMA=232, Sharpe=0.3421, Trades=13
[INFO] Cluster 14 cluster: Short SMA=138, Long SMA=216, Sharpe=0.2523, Trades=12
[INFO] Cluster 15 cluster: Short SMA=22, Long SMA=280, Sharpe=0.2396, Trades=12
[INFO] Cluster 16 cluster: Short SMA=124, Long SMA=194, Sharpe=0.0263, Trades=14
[INFO] Cluster 17 cluster: Short SMA=22, Long SMA=26, Sharpe=-0.7707, Trades=158
[INFO] Cluster 18 cluster: Short SMA=224, Long SMA=266, Sharpe=0.2985, Trades=13
[INFO] Cluster 19 cluster: Short SMA=170, Long SMA=184, Sharpe=-0.1086, Trades=33
[INFO] Cluster 20 cluster: Short SMA=112, Long SMA=126, Sharpe=0.3611, Trades=36
[INFO] Cluster 21 cluster: Short SMA=16, Long SMA=184, Sharpe=0.1547, Trades=27
[INFO] Cluster 22 cluster: Short SMA=92, Long SMA=176, Sharpe=0.2799, Trades=14
[INFO] Cluster 23 cluster: Short SMA=26, Long SMA=160, Sharpe=0.3206, Trades=21
[INFO] Cluster 24 cluster: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=18
[INFO] Cluster 25 cluster: Short SMA=162, Long SMA=226, Sharpe=0.1586, Trades=12
[INFO] Cluster 26 cluster: Short SMA=260, Long SMA=294, Sharpe=0.3575, Trades=12
[INFO] Cluster 27 cluster: Short SMA=150, Long SMA=168, Sharpe=0.4001, Trades=28
[INFO] Cluster 28 cluster: Short SMA=56, Long SMA=178, Sharpe=0.0308, Trades=17
[INFO] Cluster 30 cluster: Short SMA=134, Long SMA=172, Sharpe=0.1686, Trades=18
[INFO] Cluster 31 cluster: Short SMA=82, Long SMA=214, Sharpe=0.3537, Trades=12
[INFO] Cluster 33 cluster: Short SMA=48, Long SMA=280, Sharpe=0.3968, Trades=10
[INFO] Cluster 34 cluster: Short SMA=30, Long SMA=60, Sharpe=-0.2320, Trades=53
[INFO] Cluster 35 cluster: Short SMA=130, Long SMA=146, Sharpe=0.0772, Trades=34
[INFO] Cluster 37 cluster: Short SMA=56, Long SMA=140, Sharpe=0.0951, Trades=17
[INFO] Cluster 38 cluster: Short SMA=26, Long SMA=210, Sharpe=0.2580, Trades=19
[INFO] Cluster 39 cluster: Short SMA=182, Long SMA=212, Sharpe=0.3327, Trades=16
[INFO] Cluster 40 cluster: Short SMA=20, Long SMA=124, Sharpe=0.2642, Trades=33
[INFO] Cluster 41 cluster: Short SMA=80, Long SMA=204, Sharpe=0.1425, Trades=12
[INFO] Cluster 42 cluster: Short SMA=32, Long SMA=38, Sharpe=-0.4500, Trades=116
[INFO] Cluster 43 cluster: Short SMA=88, Long SMA=226, Sharpe=0.5412, Trades=10
[INFO] Cluster 44 cluster: Short SMA=260, Long SMA=282, Sharpe=0.4584, Trades=14
[INFO] Cluster 45 cluster: Short SMA=212, Long SMA=220, Sharpe=0.4220, Trades=39
[INFO] Cluster 46 cluster: Short SMA=118, Long SMA=124, Sharpe=0.3883, Trades=64
[INFO] Cluster 47 cluster: Short SMA=202, Long SMA=204, Sharpe=0.3739, Trades=75
[INFO] Cluster 48 cluster: Short SMA=64, Long SMA=108, Sharpe=0.1584, Trades=27
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=18
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=18
[INFO] Top 2: Short SMA=88, Long SMA=226, Sharpe=0.5412, Trades=10
[INFO] Top 3: Short SMA=260, Long SMA=282, Sharpe=0.4584, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 46 valid clusters with clusters
[INFO] Filtering to 7751 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 274, Long SMA: 284
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(274/284) - Original Sharpe: 0.7741, Trades: 18
[INFO] Hierarchical cluster 2: SMA(88/226) - Original Sharpe: 0.5412, Trades: 10
[INFO] Hierarchical cluster 3: SMA(260/282) - Original Sharpe: 0.4584, Trades: 14
[INFO] Hierarchical cluster 4: SMA(212/220) - Original Sharpe: 0.4220, Trades: 39
[INFO] Hierarchical cluster 5: SMA(64/80) - Original Sharpe: 0.4016, Trades: 45
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (274/284)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (274/284) - Sharpe: 0.7741
[INFO] cluster 2: (88/226) - Sharpe: 0.5412
[INFO] cluster 3: (260/282) - Sharpe: 0.4584
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     5.346901            5.346901
1    2021-11-14 2021-11-14            43     1.829328            1.829328
2    2022-01-14 2022-01-14            41     4.222575            4.222575
3    2022-03-14 2022-03-14            44     3.242182            3.242182
4    2022-05-14 2022-05-14            43     1.473801            1.473801
5    2022-07-14 2022-07-14            44     2.919931            2.919931
6    2022-09-14 2022-09-14            43     2.385425            2.385425
7    2022-11-14 2022-11-14            43    -0.436907           -0.436907
8    2023-01-14 2023-01-14            41    -0.202608           -0.202608
9    2023-03-14 2023-03-14            44     0.324596            0.324596
10   2023-05-14 2023-05-14            44     3.890567            3.890567
11   2023-07-14 2023-07-14            44     3.021284            3.021284
12   2023-09-14 2023-09-14            43     1.135707            1.135707
13   2023-11-14 2023-11-14            42    -3.433823           -3.433823
14   2024-01-14 2024-01-14            43     3.467114            3.467114
15   2024-03-14 2024-03-14            42     2.327772            1.525188
16   2024-05-14 2024-05-14            44    -2.234806           -2.234806
17   2024-07-14 2024-07-14            45    -3.677302           -3.677302
18   2024-09-14 2024-09-14            43     0.511850           -4.780599
19   2024-11-14 2024-11-14            33    -2.294343            0.268884
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          5.3 |              5.3 |          0.0 | Excluded      
[INFO] 2021-11-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2022-01-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.2 |              3.2 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2023-07-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.4 |             -3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |          2.3 |              1.5 |         -0.8 | False         
[INFO] 2024-05-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -3.7 |             -3.7 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.5 |             -4.8 |         -5.3 | False         
[INFO] 2024-11-14   |         -2.3 |              0.3 |          2.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 3
[INFO] Hierarchical cluster wins (rounded comparison): 1 of 3 periods (33.33% win rate)
[INFO] Updating Excel file with Hierarchical results for TU...
[INFO] Excel file updated successfully. Added TU with Hierarchical win rate 33.3% in row 49
[INFO] Added best Sharpe parameters 274/284 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 274, Long SMA: 284
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(274/284) - Original Sharpe: 0.7741
[INFO] Added cluster 2 to portfolio: SMA(88/226) - Original Sharpe: 0.5412
[INFO] Added cluster 3 to portfolio: SMA(260/282) - Original Sharpe: 0.4584
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TU_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.9735
[INFO] Hierarchical Best out-of-sample Sharpe: 1.1058
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for TU...
[INFO] Excel file updated successfully. Added TU with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TU
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for UB in column D: 34.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 176.11s
[INFO] Best parameters: Short SMA = 62, Long SMA = 80
[INFO] Best Sharpe ratio: 0.952489, Trades: 45
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @UB=117XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.63 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $499,619.00
[INFO] Market Buy & Hold P&L: $-15,562.50
[INFO] Outperformance: $515,181.50
[INFO] Sharpe ratio (entire period, annualized): 0.694675
[INFO] Sharpe ratio (in-sample, annualized): 0.952489
[INFO] Sharpe ratio (out-of-sample, annualized): 0.089749
[INFO] Maximum Drawdown: $135,012.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 30
[INFO] Out-of-sample period trades: 15
[INFO] Total trades: 45
[INFO] In-sample P&L: $564,104.75
[INFO] Out-of-sample P&L: $22,641.00
[INFO] 
Best parameters from GA: Short SMA = 62, Long SMA = 80, Sharpe = 0.952489
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5904 to 0.9525
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 80
[INFO] Sharpe Ratio: 0.952489
[INFO] Number of Trades: 45
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5904 to 0.9525
[INFO] Trades range: 11.0 to 334.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6592 to 3.0565
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 206 elements
[INFO] Kmeans Cluster 1: 337 elements
[INFO] Kmeans Cluster 2: 195 elements
[INFO] Kmeans Cluster 3: 200 elements
[INFO] Kmeans Cluster 4: 351 elements
[INFO] Kmeans Cluster 5: 195 elements
[INFO] Kmeans Cluster 6: 234 elements
[INFO] Kmeans Cluster 7: 195 elements
[INFO] Kmeans Cluster 8: 267 elements
[INFO] Kmeans Cluster 9: 293 elements
[INFO] Kmeans Cluster 10: 284 elements
[INFO] Kmeans Cluster 11: 258 elements
[INFO] Kmeans Cluster 12: 83 elements
[INFO] Kmeans Cluster 13: 93 elements
[INFO] Kmeans Cluster 14: 234 elements
[INFO] Kmeans Cluster 15: 279 elements
[INFO] Kmeans Cluster 16: 266 elements
[INFO] Kmeans Cluster 17: 180 elements
[INFO] Kmeans Cluster 18: 257 elements
[INFO] Kmeans Cluster 19: 210 elements
[INFO] Kmeans Cluster 20: 336 elements
[INFO] Kmeans Cluster 21: 222 elements
[INFO] Kmeans Cluster 22: 233 elements
[INFO] Kmeans Cluster 23: 198 elements
[INFO] Kmeans Cluster 24: 291 elements
[INFO] Kmeans Cluster 25: 142 elements
[INFO] Kmeans Cluster 26: 229 elements
[INFO] Kmeans Cluster 27: 203 elements
[INFO] Kmeans Cluster 28: 205 elements
[INFO] Kmeans Cluster 29: 300 elements
[INFO] Kmeans Cluster 30: 243 elements
[INFO] Kmeans Cluster 31: 183 elements
[INFO] Kmeans Cluster 32: 228 elements
[INFO] Kmeans Cluster 33: 209 elements
[INFO] Kmeans Cluster 34: 253 elements
[INFO] Kmeans Cluster 35: 164 elements
[INFO] Kmeans Cluster 36: 59 elements
[INFO] Kmeans Cluster 37: 169 elements
[INFO] Kmeans Cluster 38: 155 elements
[INFO] Kmeans Cluster 39: 274 elements
[INFO] Kmeans Cluster 40: 129 elements
[INFO] Kmeans Cluster 41: 268 elements
[INFO] Kmeans Cluster 42: 259 elements
[INFO] Kmeans Cluster 43: 193 elements
[INFO] Kmeans Cluster 44: 157 elements
[INFO] Kmeans Cluster 45: 38 elements
[INFO] Kmeans Cluster 46: 145 elements
[INFO] Kmeans Cluster 47: 175 elements
[INFO] Kmeans Cluster 48: 155 elements
[INFO] Kmeans Cluster 49: 153 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=111.26, Long SMA=134.51, Sharpe=0.1285
[INFO] Centroid 1: Short SMA=65.98, Long SMA=216.59, Sharpe=0.2624
[INFO] Centroid 2: Short SMA=264.61, Long SMA=286.49, Sharpe=-0.2199
[INFO] Centroid 3: Short SMA=60.79, Long SMA=92.09, Sharpe=0.6253
[INFO] Centroid 4: Short SMA=127.61, Long SMA=280.99, Sharpe=-0.0644
[INFO] Centroid 5: Short SMA=25.27, Long SMA=129.41, Sharpe=0.5279
[INFO] Centroid 6: Short SMA=191.59, Long SMA=268.07, Sharpe=-0.2774
[INFO] Centroid 7: Short SMA=76.56, Long SMA=128.59, Sharpe=0.1620
[INFO] Centroid 8: Short SMA=64.79, Long SMA=284.58, Sharpe=-0.1119
[INFO] Centroid 9: Short SMA=29.19, Long SMA=225.92, Sharpe=0.3379
[INFO] Centroid 10: Short SMA=194.97, Long SMA=217.92, Sharpe=-0.0250
[INFO] Centroid 11: Short SMA=91.70, Long SMA=190.00, Sharpe=0.2591
[INFO] Centroid 12: Short SMA=76.38, Long SMA=96.21, Sharpe=0.4518
[INFO] Centroid 13: Short SMA=19.31, Long SMA=34.26, Sharpe=0.2294
[INFO] Centroid 14: Short SMA=130.91, Long SMA=240.43, Sharpe=0.0929
[INFO] Centroid 15: Short SMA=103.70, Long SMA=222.30, Sharpe=0.1613
[INFO] Centroid 16: Short SMA=133.58, Long SMA=205.88, Sharpe=0.2558
[INFO] Centroid 17: Short SMA=28.18, Long SMA=145.07, Sharpe=0.4028
[INFO] Centroid 18: Short SMA=227.98, Long SMA=256.43, Sharpe=-0.3249
[INFO] Centroid 19: Short SMA=125.41, Long SMA=152.97, Sharpe=-0.0837
[INFO] Centroid 20: Short SMA=30.26, Long SMA=282.29, Sharpe=0.0086
[INFO] Centroid 21: Short SMA=93.69, Long SMA=286.19, Sharpe=-0.0182
[INFO] Centroid 22: Short SMA=30.86, Long SMA=178.31, Sharpe=0.3117
[INFO] Centroid 23: Short SMA=80.93, Long SMA=152.09, Sharpe=0.0018
[INFO] Centroid 24: Short SMA=166.13, Long SMA=284.21, Sharpe=-0.1642
[INFO] Centroid 25: Short SMA=39.11, Long SMA=105.55, Sharpe=0.4885
[INFO] Centroid 26: Short SMA=227.29, Long SMA=288.47, Sharpe=-0.2698
[INFO] Centroid 27: Short SMA=21.31, Long SMA=94.98, Sharpe=0.6403
[INFO] Centroid 28: Short SMA=146.99, Long SMA=182.72, Sharpe=0.3506
[INFO] Centroid 29: Short SMA=31.96, Long SMA=255.13, Sharpe=0.2062
[INFO] Centroid 30: Short SMA=69.13, Long SMA=247.01, Sharpe=0.1486
[INFO] Centroid 31: Short SMA=53.36, Long SMA=78.48, Sharpe=0.7547
[INFO] Centroid 32: Short SMA=168.45, Long SMA=203.00, Sharpe=0.1067
[INFO] Centroid 33: Short SMA=113.05, Long SMA=175.42, Sharpe=0.1058
[INFO] Centroid 34: Short SMA=153.96, Long SMA=249.94, Sharpe=-0.0522
[INFO] Centroid 35: Short SMA=35.05, Long SMA=165.46, Sharpe=0.4978
[INFO] Centroid 36: Short SMA=281.36, Long SMA=295.12, Sharpe=-0.3851
[INFO] Centroid 37: Short SMA=60.05, Long SMA=125.82, Sharpe=0.3222
[INFO] Centroid 38: Short SMA=97.74, Long SMA=118.12, Sharpe=-0.0019
[INFO] Centroid 39: Short SMA=66.29, Long SMA=178.50, Sharpe=0.0999
[INFO] Centroid 40: Short SMA=196.03, Long SMA=290.53, Sharpe=-0.3918
[INFO] Centroid 41: Short SMA=179.10, Long SMA=237.17, Sharpe=-0.1414
[INFO] Centroid 42: Short SMA=100.25, Long SMA=257.41, Sharpe=0.0160
[INFO] Centroid 43: Short SMA=24.90, Long SMA=200.11, Sharpe=0.4519
[INFO] Centroid 44: Short SMA=154.38, Long SMA=172.31, Sharpe=0.2032
[INFO] Centroid 45: Short SMA=19.68, Long SMA=30.47, Sharpe=-0.0241
[INFO] Centroid 46: Short SMA=214.40, Long SMA=236.70, Sharpe=-0.1706
[INFO] Centroid 47: Short SMA=31.89, Long SMA=61.94, Sharpe=0.6125
[INFO] Centroid 48: Short SMA=246.86, Long SMA=272.09, Sharpe=-0.1335
[INFO] Centroid 49: Short SMA=25.95, Long SMA=56.76, Sharpe=0.4727
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=80, Sharpe=0.9525, Trades=45
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=50, Long SMA=78, Sharpe=0.7238, Trades=44
[INFO] Kmeans Top 2: Short SMA=62, Long SMA=94, Sharpe=0.6693, Trades=35
[INFO] Kmeans Top 3: Short SMA=20, Long SMA=96, Sharpe=0.6420, Trades=38
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=62, Sharpe=0.5579, Trades=44
[INFO] Kmeans Top 5: Short SMA=78, Long SMA=92, Sharpe=0.5426, Trades=43
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (111, 135)
[INFO]   Nearest: (112.0, 134.0)
[INFO]   Rounded: (66, 217)
[INFO]   Nearest: (66.0, 216.0)
[INFO]   Rounded: (265, 286)
[INFO]   Nearest: (264.0, 286.0)
[INFO]   Rounded: (61, 92)
[INFO]   Nearest: (60.0, 92.0)
[INFO]   Rounded: (128, 281)
[INFO]   Nearest: (128.0, 280.0)
[INFO]   Rounded: (25, 129)
[INFO]   Nearest: (26.0, 130.0)
[INFO]   Rounded: (192, 268)
[INFO]   Rounded: (77, 129)
[INFO]   Nearest: (76.0, 128.0)
[INFO]   Rounded: (65, 285)
[INFO]   Nearest: (64.0, 284.0)
[INFO]   Rounded: (29, 226)
[INFO]   Nearest: (30.0, 226.0)
[INFO]   Rounded: (195, 218)
[INFO]   Nearest: (194.0, 218.0)
[INFO]   Rounded: (92, 190)
[INFO]   Rounded: (76, 96)
[INFO]   Rounded: (19, 34)
[INFO]   Nearest: (20.0, 34.0)
[INFO]   Rounded: (131, 240)
[INFO]   Nearest: (130.0, 240.0)
[INFO]   Rounded: (104, 222)
[INFO]   Rounded: (134, 206)
[INFO]   Rounded: (28, 145)
[INFO]   Nearest: (28.0, 146.0)
[INFO]   Rounded: (228, 256)
[INFO]   Rounded: (125, 153)
[INFO]   Nearest: (126.0, 152.0)
[INFO]   Rounded: (30, 282)
[INFO]   Rounded: (94, 286)
[INFO]   Rounded: (31, 178)
[INFO]   Nearest: (30.0, 178.0)
[INFO]   Rounded: (81, 152)
[INFO]   Nearest: (80.0, 152.0)
[INFO]   Rounded: (166, 284)
[INFO]   Rounded: (39, 106)
[INFO]   Nearest: (40.0, 106.0)
[INFO]   Rounded: (227, 288)
[INFO]   Nearest: (228.0, 288.0)
[INFO]   Rounded: (21, 95)
[INFO]   Nearest: (22.0, 94.0)
[INFO]   Rounded: (147, 183)
[INFO]   Nearest: (146.0, 182.0)
[INFO]   Rounded: (32, 255)
[INFO]   Nearest: (32.0, 256.0)
[INFO]   Rounded: (69, 247)
[INFO]   Nearest: (70.0, 248.0)
[INFO]   Rounded: (53, 78)
[INFO]   Nearest: (54.0, 78.0)
[INFO]   Rounded: (168, 203)
[INFO]   Nearest: (168.0, 202.0)
[INFO]   Rounded: (113, 175)
[INFO]   Nearest: (114.0, 176.0)
[INFO]   Rounded: (154, 250)
[INFO]   Rounded: (35, 165)
[INFO]   Nearest: (36.0, 166.0)
[INFO]   Rounded: (281, 295)
[INFO]   Nearest: (282.0, 296.0)
[INFO]   Rounded: (60, 126)
[INFO]   Rounded: (98, 118)
[INFO]   Rounded: (66, 178)
[INFO]   Rounded: (196, 291)
[INFO]   Nearest: (196.0, 290.0)
[INFO]   Rounded: (179, 237)
[INFO]   Nearest: (180.0, 238.0)
[INFO]   Rounded: (100, 257)
[INFO]   Nearest: (100.0, 258.0)
[INFO]   Rounded: (25, 200)
[INFO]   Nearest: (24.0, 200.0)
[INFO]   Rounded: (154, 172)
[INFO]   Rounded: (20, 30)
[INFO]   Rounded: (214, 237)
[INFO]   Nearest: (214.0, 236.0)
[INFO]   Rounded: (32, 62)
[INFO]   Rounded: (247, 272)
[INFO]   Nearest: (246.0, 272.0)
[INFO]   Rounded: (26, 57)
[INFO]   Nearest: (26.0, 56.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 80
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(50/78) - Original Sharpe: 0.7238, Trades: 44
[INFO] Kmeans cluster 2: SMA(62/94) - Original Sharpe: 0.6693, Trades: 35
[INFO] Kmeans cluster 3: SMA(20/96) - Original Sharpe: 0.6420, Trades: 38
[INFO] Kmeans cluster 4: SMA(30/62) - Original Sharpe: 0.5579, Trades: 44
[INFO] Kmeans cluster 5: SMA(78/92) - Original Sharpe: 0.5426, Trades: 43
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/80)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (50/78) - Sharpe: 0.7238
[INFO] cluster 2: (62/94) - Sharpe: 0.6693
[INFO] cluster 3: (20/96) - Sharpe: 0.6420
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.086204           -1.791232
1    2021-11-14 2021-11-14            43     0.984700           -2.368679
2    2022-01-14 2022-01-14            41    -0.851035            0.255714
3    2022-03-14 2022-03-14            44     4.626773            4.626773
4    2022-05-14 2022-05-14            43     0.064197            0.064197
5    2022-07-14 2022-07-14            44     2.151092            0.385750
6    2022-09-14 2022-09-14            43     0.507963            2.682470
7    2022-11-14 2022-11-14            43    -2.397546           -2.489992
8    2023-01-14 2023-01-14            41    -0.385884           -3.601012
9    2023-03-14 2023-03-14            44    -1.291343            1.744482
10   2023-05-14 2023-05-14            44     1.653847            1.062567
11   2023-07-14 2023-07-14            44     3.431170            3.431170
12   2023-09-14 2023-09-14            43     2.602377            2.602377
13   2023-11-14 2023-11-14            42    -4.883992           -4.631575
14   2024-01-14 2024-01-14            43    -1.084920           -0.656635
15   2024-03-14 2024-03-14            42     0.609020            1.868345
16   2024-05-14 2024-05-14            44    -1.255123           -0.856588
17   2024-07-14 2024-07-14            45     2.338417            3.186333
18   2024-09-14 2024-09-14            43    -3.629115           -4.242216
19   2024-11-14 2024-11-14            33     1.699993            1.876114
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |             -1.8 |          0.3 | True          
[INFO] 2021-11-14   |          1.0 |             -2.4 |         -3.4 | False         
[INFO] 2022-01-14   |         -0.9 |              0.3 |          1.2 | True          
[INFO] 2022-03-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.2 |              0.4 |         -1.8 | False         
[INFO] 2022-09-14   |          0.5 |              2.7 |          2.2 | True          
[INFO] 2022-11-14   |         -2.4 |             -2.5 |         -0.1 | False         
[INFO] 2023-01-14   |         -0.4 |             -3.6 |         -3.2 | False         
[INFO] 2023-03-14   |         -1.3 |              1.7 |          3.0 | True          
[INFO] 2023-05-14   |          1.7 |              1.1 |         -0.6 | False         
[INFO] 2023-07-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -4.9 |             -4.6 |          0.3 | True          
[INFO] 2024-01-14   |         -1.1 |             -0.7 |          0.4 | True          
[INFO] 2024-03-14   |          0.6 |              1.9 |          1.3 | True          
[INFO] 2024-05-14   |         -1.3 |             -0.9 |          0.4 | True          
[INFO] 2024-07-14   |          2.3 |              3.2 |          0.9 | True          
[INFO] 2024-09-14   |         -3.6 |             -4.2 |         -0.6 | False         
[INFO] 2024-11-14   |          1.7 |              1.9 |          0.2 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 10 of 16 periods (62.50% win rate)
[INFO] Updating Excel file with Kmeans results for UB...
[INFO] Excel file updated successfully. Added UB with Kmeans win rate 62.5% in row 50
[INFO] Added best Sharpe parameters 62/80 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 80
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(50/78) - Original Sharpe: 0.7238
[INFO] Added cluster 2 to portfolio: SMA(62/94) - Original Sharpe: 0.6693
[INFO] Added cluster 3 to portfolio: SMA(20/96) - Original Sharpe: 0.6420
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'UB_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3224
[INFO] Kmeans Best out-of-sample Sharpe: 0.0897
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for UB...
[INFO] Excel file updated successfully. Added UB with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\UB
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5904 to 0.9525
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 80
[INFO] Sharpe Ratio: 0.952489
[INFO] Number of Trades: 45
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5904 to 0.9525
[INFO] Trades range: 11.0 to 334.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.6592 to 3.0565
[INFO] Scaled Trades range: -0.6464 to 16.5656
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6383
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 415 elements
[INFO] Cluster 1: 396 elements
[INFO] Cluster 2: 399 elements
[INFO] Cluster 3: 293 elements
[INFO] Cluster 4: 412 elements
[INFO] Cluster 5: 137 elements
[INFO] Cluster 6: 116 elements
[INFO] Cluster 7: 41 elements
[INFO] Cluster 8: 261 elements
[INFO] Cluster 9: 143 elements
[INFO] Cluster 10: 405 elements
[INFO] Cluster 11: 249 elements
[INFO] Cluster 12: 428 elements
[INFO] Cluster 13: 488 elements
[INFO] Cluster 14: 246 elements
[INFO] Cluster 15: 282 elements
[INFO] Cluster 16: 34 elements
[INFO] Cluster 17: 289 elements
[INFO] Cluster 18: 73 elements
[INFO] Cluster 19: 214 elements
[INFO] Cluster 20: 321 elements
[INFO] Cluster 21: 503 elements
[INFO] Cluster 22: 320 elements
[INFO] Cluster 23: 218 elements
[INFO] Cluster 24: 334 elements
[INFO] Cluster 25: 6 elements
[INFO] Cluster 26: 223 elements
[INFO] Cluster 27: 326 elements
[INFO] Cluster 28: 334 elements
[INFO] Cluster 29: 154 elements
[INFO] Cluster 30: 45 elements
[INFO] Cluster 31: 19 elements
[INFO] Cluster 32: 26 elements
[INFO] Cluster 33: 172 elements
[INFO] Cluster 34: 79 elements
[INFO] Cluster 35: 45 elements
[INFO] Cluster 36: 146 elements
[INFO] Cluster 37: 283 elements
[INFO] Cluster 38: 261 elements
[INFO] Cluster 39: 134 elements
[INFO] Cluster 40: 46 elements
[INFO] Cluster 41: 101 elements
[INFO] Cluster 42: 122 elements
[INFO] Cluster 43: 75 elements
[INFO] Cluster 44: 163 elements
[INFO] Cluster 45: 111 elements
[INFO] Cluster 46: 155 elements
[INFO] Cluster 47: 207 elements
[INFO] Cluster 48: 145 elements
[INFO] Cluster 49: 190 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=54, Long SMA=90, Sharpe=0.6221, Trades=35
[INFO] Cluster 1 cluster: Short SMA=218, Long SMA=254, Sharpe=-0.3344, Trades=18
[INFO] Cluster 2 cluster: Short SMA=172, Long SMA=282, Sharpe=-0.1116, Trades=12
[INFO] Cluster 3 cluster: Short SMA=260, Long SMA=284, Sharpe=-0.1608, Trades=18
[INFO] Cluster 4 cluster: Short SMA=138, Long SMA=202, Sharpe=0.2826, Trades=15
[INFO] Cluster 5 cluster: Short SMA=260, Long SMA=264, Sharpe=-0.1723, Trades=36
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=52, Sharpe=0.5684, Trades=62
[INFO] Cluster 7 cluster: Short SMA=180, Long SMA=182, Sharpe=-0.0280, Trades=71
[INFO] Cluster 8 cluster: Short SMA=110, Long SMA=126, Sharpe=0.1162, Trades=35
[INFO] Cluster 9 cluster: Short SMA=154, Long SMA=172, Sharpe=0.3050, Trades=27
[INFO] Cluster 10 cluster: Short SMA=52, Long SMA=212, Sharpe=0.3250, Trades=14
[INFO] Cluster 11 cluster: Short SMA=28, Long SMA=112, Sharpe=0.6101, Trades=30
[INFO] Cluster 12 cluster: Short SMA=130, Long SMA=280, Sharpe=0.0035, Trades=11
[INFO] Cluster 13 cluster: Short SMA=100, Long SMA=194, Sharpe=0.3128, Trades=17
[INFO] Cluster 14 cluster: Short SMA=164, Long SMA=206, Sharpe=0.1354, Trades=17
[INFO] Cluster 15 cluster: Short SMA=24, Long SMA=190, Sharpe=0.4235, Trades=26
[INFO] Cluster 16 cluster: Short SMA=20, Long SMA=26, Sharpe=0.0816, Trades=146
[INFO] Cluster 17 cluster: Short SMA=36, Long SMA=148, Sharpe=0.5243, Trades=22
[INFO] Cluster 18 cluster: Short SMA=16, Long SMA=36, Sharpe=0.2355, Trades=94
[INFO] Cluster 19 cluster: Short SMA=22, Long SMA=74, Sharpe=0.5976, Trades=42
[INFO] Cluster 20 cluster: Short SMA=84, Long SMA=134, Sharpe=0.1365, Trades=22
[INFO] Cluster 21 cluster: Short SMA=78, Long SMA=238, Sharpe=0.1713, Trades=12
[INFO] Cluster 22 cluster: Short SMA=222, Long SMA=286, Sharpe=-0.1850, Trades=12
[INFO] Cluster 23 cluster: Short SMA=104, Long SMA=256, Sharpe=0.0049, Trades=11
[INFO] Cluster 24 cluster: Short SMA=192, Long SMA=222, Sharpe=-0.1266, Trades=18
[INFO] Cluster 26 cluster: Short SMA=58, Long SMA=290, Sharpe=-0.1202, Trades=14
[INFO] Cluster 27 cluster: Short SMA=68, Long SMA=176, Sharpe=0.0401, Trades=18
[INFO] Cluster 28 cluster: Short SMA=86, Long SMA=280, Sharpe=0.0288, Trades=12
[INFO] Cluster 29 cluster: Short SMA=124, Long SMA=156, Sharpe=-0.0575, Trades=23
[INFO] Cluster 30 cluster: Short SMA=86, Long SMA=96, Sharpe=0.1599, Trades=51
[INFO] Cluster 32 cluster: Short SMA=66, Long SMA=68, Sharpe=0.4564, Trades=122
[INFO] Cluster 33 cluster: Short SMA=54, Long SMA=120, Sharpe=0.3819, Trades=28
[INFO] Cluster 34 cluster: Short SMA=204, Long SMA=210, Sharpe=-0.0148, Trades=38
[INFO] Cluster 35 cluster: Short SMA=60, Long SMA=64, Sharpe=0.7061, Trades=88
[INFO] Cluster 36 cluster: Short SMA=18, Long SMA=260, Sharpe=0.1615, Trades=20
[INFO] Cluster 37 cluster: Short SMA=30, Long SMA=280, Sharpe=-0.0805, Trades=18
[INFO] Cluster 38 cluster: Short SMA=174, Long SMA=246, Sharpe=-0.1769, Trades=15
[INFO] Cluster 39 cluster: Short SMA=16, Long SMA=156, Sharpe=0.2735, Trades=32
[INFO] Cluster 40 cluster: Short SMA=114, Long SMA=118, Sharpe=-0.1891, Trades=63
[INFO] Cluster 41 cluster: Short SMA=48, Long SMA=64, Sharpe=0.6688, Trades=50
[INFO] Cluster 42 cluster: Short SMA=52, Long SMA=156, Sharpe=0.3992, Trades=20
[INFO] Cluster 43 cluster: Short SMA=194, Long SMA=296, Sharpe=-0.4664, Trades=14
[INFO] Cluster 44 cluster: Short SMA=20, Long SMA=226, Sharpe=0.3372, Trades=20
[INFO] Cluster 45 cluster: Short SMA=80, Long SMA=150, Sharpe=-0.0201, Trades=22
[INFO] Cluster 46 cluster: Short SMA=114, Long SMA=168, Sharpe=-0.0091, Trades=19
[INFO] Cluster 47 cluster: Short SMA=130, Long SMA=240, Sharpe=0.1815, Trades=15
[INFO] Cluster 48 cluster: Short SMA=150, Long SMA=244, Sharpe=-0.0066, Trades=13
[INFO] Cluster 49 cluster: Short SMA=44, Long SMA=252, Sharpe=0.2472, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=80, Sharpe=0.9525, Trades=45
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=60, Long SMA=64, Sharpe=0.7061, Trades=88
[INFO] Top 2: Short SMA=48, Long SMA=64, Sharpe=0.6688, Trades=50
[INFO] Top 3: Short SMA=54, Long SMA=90, Sharpe=0.6221, Trades=35
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10560 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 80
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(60/64) - Original Sharpe: 0.7061, Trades: 88
[INFO] Hierarchical cluster 2: SMA(48/64) - Original Sharpe: 0.6688, Trades: 50
[INFO] Hierarchical cluster 3: SMA(54/90) - Original Sharpe: 0.6221, Trades: 35
[INFO] Hierarchical cluster 4: SMA(28/112) - Original Sharpe: 0.6101, Trades: 30
[INFO] Hierarchical cluster 5: SMA(22/74) - Original Sharpe: 0.5976, Trades: 42
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/80)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (60/64) - Sharpe: 0.7061
[INFO] cluster 2: (48/64) - Sharpe: 0.6688
[INFO] cluster 3: (54/90) - Sharpe: 0.6221
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.086204           -2.074869
1    2021-11-14 2021-11-14            43     0.984700           -2.290956
2    2022-01-14 2022-01-14            41    -0.851035           -0.009415
3    2022-03-14 2022-03-14            44     4.626773            4.626773
4    2022-05-14 2022-05-14            43     0.064197            0.064197
5    2022-07-14 2022-07-14            44     2.151092            0.712755
6    2022-09-14 2022-09-14            43     0.507963            2.290963
7    2022-11-14 2022-11-14            43    -2.397546           -0.748217
8    2023-01-14 2023-01-14            41    -0.385884           -3.585391
9    2023-03-14 2023-03-14            44    -1.291343            0.800706
10   2023-05-14 2023-05-14            44     1.653847            0.048075
11   2023-07-14 2023-07-14            44     3.431170            3.431170
12   2023-09-14 2023-09-14            43     2.602377            2.602377
13   2023-11-14 2023-11-14            42    -4.883992           -6.150152
14   2024-01-14 2024-01-14            43    -1.084920           -1.296782
15   2024-03-14 2024-03-14            42     0.609020            1.791878
16   2024-05-14 2024-05-14            44    -1.255123           -0.844297
17   2024-07-14 2024-07-14            45     2.338417            2.976320
18   2024-09-14 2024-09-14            43    -3.629115           -3.427246
19   2024-11-14 2024-11-14            33     1.699993            1.699993
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |             -2.1 |          0.0 | Excluded      
[INFO] 2021-11-14   |          1.0 |             -2.3 |         -3.3 | False         
[INFO] 2022-01-14   |         -0.9 |             -0.0 |          0.9 | True          
[INFO] 2022-03-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.2 |              0.7 |         -1.5 | False         
[INFO] 2022-09-14   |          0.5 |              2.3 |          1.8 | True          
[INFO] 2022-11-14   |         -2.4 |             -0.7 |          1.7 | True          
[INFO] 2023-01-14   |         -0.4 |             -3.6 |         -3.2 | False         
[INFO] 2023-03-14   |         -1.3 |              0.8 |          2.1 | True          
[INFO] 2023-05-14   |          1.7 |              0.0 |         -1.7 | False         
[INFO] 2023-07-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -4.9 |             -6.2 |         -1.3 | False         
[INFO] 2024-01-14   |         -1.1 |             -1.3 |         -0.2 | False         
[INFO] 2024-03-14   |          0.6 |              1.8 |          1.2 | True          
[INFO] 2024-05-14   |         -1.3 |             -0.8 |          0.5 | True          
[INFO] 2024-07-14   |          2.3 |              3.0 |          0.7 | True          
[INFO] 2024-09-14   |         -3.6 |             -3.4 |          0.2 | True          
[INFO] 2024-11-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 14 periods (57.14% win rate)
[INFO] Updating Excel file with Hierarchical results for UB...
[INFO] Excel file updated successfully. Added UB with Hierarchical win rate 57.1% in row 50
[INFO] Added best Sharpe parameters 62/80 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 80
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(60/64) - Original Sharpe: 0.7061
[INFO] Added cluster 2 to portfolio: SMA(48/64) - Original Sharpe: 0.6688
[INFO] Added cluster 3 to portfolio: SMA(54/90) - Original Sharpe: 0.6221
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'UB_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1318
[INFO] Hierarchical Best out-of-sample Sharpe: 0.0897
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for UB...
[INFO] Excel file updated successfully. Added UB with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\UB
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for ULS in column D: 27.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 2
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 111.46s
[INFO] Best parameters: Short SMA = 166, Long SMA = 168
[INFO] Best Sharpe ratio: 1.113971, Trades: 62
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @ULS=116XC
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.30 contracts
[INFO] Maximum Position Size: 8 contracts
[INFO] Strategy Total P&L: $545,860.00
[INFO] Market Buy & Hold P&L: $27,400.00
[INFO] Outperformance: $518,460.00
[INFO] Sharpe ratio (entire period, annualized): 0.653386
[INFO] Sharpe ratio (in-sample, annualized): 1.113971
[INFO] Sharpe ratio (out-of-sample, annualized): -0.211071
[INFO] Maximum Drawdown: $292,053.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 31
[INFO] Out-of-sample period trades: 31
[INFO] Total trades: 62
[INFO] In-sample P&L: $606,384.00
[INFO] Out-of-sample P&L: $-60,524.00
[INFO] 
Best parameters from GA: Short SMA = 166, Long SMA = 168, Sharpe = 1.113971
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 100.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3504 to 1.1140
[INFO] 
Best parameters:
[INFO] Short SMA: 166
[INFO] Long SMA: 168
[INFO] Sharpe Ratio: 1.113971
[INFO] Number of Trades: 62
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9538 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3504 to 1.1140
[INFO] Trades range: 10.0 to 302.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3195 to 2.7315
[INFO] Scaled Long SMA range: -2.7051 to 1.5032
[INFO] Scaled Sharpe ratio range: -3.2164 to 2.3607
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 213 elements
[INFO] Kmeans Cluster 1: 180 elements
[INFO] Kmeans Cluster 2: 130 elements
[INFO] Kmeans Cluster 3: 163 elements
[INFO] Kmeans Cluster 4: 91 elements
[INFO] Kmeans Cluster 5: 252 elements
[INFO] Kmeans Cluster 6: 287 elements
[INFO] Kmeans Cluster 7: 112 elements
[INFO] Kmeans Cluster 8: 186 elements
[INFO] Kmeans Cluster 9: 150 elements
[INFO] Kmeans Cluster 10: 124 elements
[INFO] Kmeans Cluster 11: 210 elements
[INFO] Kmeans Cluster 12: 263 elements
[INFO] Kmeans Cluster 13: 134 elements
[INFO] Kmeans Cluster 14: 208 elements
[INFO] Kmeans Cluster 15: 144 elements
[INFO] Kmeans Cluster 16: 112 elements
[INFO] Kmeans Cluster 17: 223 elements
[INFO] Kmeans Cluster 18: 198 elements
[INFO] Kmeans Cluster 19: 201 elements
[INFO] Kmeans Cluster 20: 218 elements
[INFO] Kmeans Cluster 21: 244 elements
[INFO] Kmeans Cluster 22: 154 elements
[INFO] Kmeans Cluster 23: 184 elements
[INFO] Kmeans Cluster 24: 85 elements
[INFO] Kmeans Cluster 25: 183 elements
[INFO] Kmeans Cluster 26: 216 elements
[INFO] Kmeans Cluster 27: 209 elements
[INFO] Kmeans Cluster 28: 91 elements
[INFO] Kmeans Cluster 29: 185 elements
[INFO] Kmeans Cluster 30: 250 elements
[INFO] Kmeans Cluster 31: 106 elements
[INFO] Kmeans Cluster 32: 269 elements
[INFO] Kmeans Cluster 33: 194 elements
[INFO] Kmeans Cluster 34: 267 elements
[INFO] Kmeans Cluster 35: 259 elements
[INFO] Kmeans Cluster 36: 221 elements
[INFO] Kmeans Cluster 37: 238 elements
[INFO] Kmeans Cluster 38: 134 elements
[INFO] Kmeans Cluster 39: 178 elements
[INFO] Kmeans Cluster 40: 298 elements
[INFO] Kmeans Cluster 41: 157 elements
[INFO] Kmeans Cluster 42: 133 elements
[INFO] Kmeans Cluster 43: 250 elements
[INFO] Kmeans Cluster 44: 190 elements
[INFO] Kmeans Cluster 45: 173 elements
[INFO] Kmeans Cluster 46: 197 elements
[INFO] Kmeans Cluster 47: 143 elements
[INFO] Kmeans Cluster 48: 229 elements
[INFO] Kmeans Cluster 49: 302 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=151.86, Long SMA=176.41, Sharpe=0.9072
[INFO] Centroid 1: Short SMA=45.23, Long SMA=250.99, Sharpe=0.3529
[INFO] Centroid 2: Short SMA=59.69, Long SMA=75.58, Sharpe=0.1600
[INFO] Centroid 3: Short SMA=95.21, Long SMA=281.21, Sharpe=0.4339
[INFO] Centroid 4: Short SMA=157.16, Long SMA=270.18, Sharpe=0.6552
[INFO] Centroid 5: Short SMA=72.97, Long SMA=143.72, Sharpe=0.0672
[INFO] Centroid 6: Short SMA=30.49, Long SMA=96.09, Sharpe=0.3776
[INFO] Centroid 7: Short SMA=278.91, Long SMA=293.43, Sharpe=0.1710
[INFO] Centroid 8: Short SMA=105.59, Long SMA=189.20, Sharpe=0.6297
[INFO] Centroid 9: Short SMA=41.76, Long SMA=118.24, Sharpe=0.5045
[INFO] Centroid 10: Short SMA=28.47, Long SMA=50.55, Sharpe=0.5221
[INFO] Centroid 11: Short SMA=66.50, Long SMA=257.90, Sharpe=0.5584
[INFO] Centroid 12: Short SMA=195.98, Long SMA=224.53, Sharpe=0.7738
[INFO] Centroid 13: Short SMA=129.93, Long SMA=233.07, Sharpe=0.6891
[INFO] Centroid 14: Short SMA=65.14, Long SMA=186.16, Sharpe=0.3016
[INFO] Centroid 15: Short SMA=259.72, Long SMA=284.36, Sharpe=0.4261
[INFO] Centroid 16: Short SMA=83.64, Long SMA=109.68, Sharpe=-0.1440
[INFO] Centroid 17: Short SMA=21.96, Long SMA=276.59, Sharpe=0.5519
[INFO] Centroid 18: Short SMA=81.99, Long SMA=291.28, Sharpe=0.2951
[INFO] Centroid 19: Short SMA=26.24, Long SMA=204.00, Sharpe=0.4827
[INFO] Centroid 20: Short SMA=239.20, Long SMA=267.46, Sharpe=0.5887
[INFO] Centroid 21: Short SMA=64.49, Long SMA=158.75, Sharpe=0.2085
[INFO] Centroid 22: Short SMA=172.88, Long SMA=186.95, Sharpe=0.7183
[INFO] Centroid 23: Short SMA=121.11, Long SMA=151.14, Sharpe=0.0964
[INFO] Centroid 24: Short SMA=15.32, Long SMA=36.35, Sharpe=0.8554
[INFO] Centroid 25: Short SMA=211.92, Long SMA=274.04, Sharpe=0.7041
[INFO] Centroid 26: Short SMA=221.00, Long SMA=239.15, Sharpe=0.6396
[INFO] Centroid 27: Short SMA=41.06, Long SMA=72.15, Sharpe=0.3045
[INFO] Centroid 28: Short SMA=113.96, Long SMA=168.40, Sharpe=0.3823
[INFO] Centroid 29: Short SMA=17.89, Long SMA=125.30, Sharpe=0.2395
[INFO] Centroid 30: Short SMA=44.90, Long SMA=286.58, Sharpe=0.4425
[INFO] Centroid 31: Short SMA=82.13, Long SMA=241.40, Sharpe=0.6966
[INFO] Centroid 32: Short SMA=183.55, Long SMA=277.48, Sharpe=0.7805
[INFO] Centroid 33: Short SMA=190.36, Long SMA=251.30, Sharpe=0.8948
[INFO] Centroid 34: Short SMA=168.15, Long SMA=212.82, Sharpe=0.9249
[INFO] Centroid 35: Short SMA=137.16, Long SMA=196.16, Sharpe=0.7727
[INFO] Centroid 36: Short SMA=24.14, Long SMA=244.88, Sharpe=0.4079
[INFO] Centroid 37: Short SMA=65.83, Long SMA=104.55, Sharpe=0.3051
[INFO] Centroid 38: Short SMA=19.88, Long SMA=49.60, Sharpe=0.6942
[INFO] Centroid 39: Short SMA=28.67, Long SMA=173.47, Sharpe=0.5451
[INFO] Centroid 40: Short SMA=56.75, Long SMA=213.53, Sharpe=0.4060
[INFO] Centroid 41: Short SMA=23.99, Long SMA=211.16, Sharpe=0.3382
[INFO] Centroid 42: Short SMA=116.50, Long SMA=143.07, Sharpe=0.2217
[INFO] Centroid 43: Short SMA=29.83, Long SMA=155.37, Sharpe=0.4130
[INFO] Centroid 44: Short SMA=91.85, Long SMA=119.54, Sharpe=0.0410
[INFO] Centroid 45: Short SMA=111.73, Long SMA=143.21, Sharpe=-0.0769
[INFO] Centroid 46: Short SMA=236.45, Long SMA=284.44, Sharpe=0.7484
[INFO] Centroid 47: Short SMA=86.80, Long SMA=193.22, Sharpe=0.4977
[INFO] Centroid 48: Short SMA=114.10, Long SMA=212.36, Sharpe=0.8089
[INFO] Centroid 49: Short SMA=154.99, Long SMA=242.64, Sharpe=0.7949
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=166, Long SMA=168, Sharpe=1.1140, Trades=62
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=168, Long SMA=212, Sharpe=0.9784, Trades=16
[INFO] Kmeans Top 2: Short SMA=190, Long SMA=252, Sharpe=0.9588, Trades=12
[INFO] Kmeans Top 3: Short SMA=196, Long SMA=224, Sharpe=0.8312, Trades=18
[INFO] Kmeans Top 4: Short SMA=152, Long SMA=176, Sharpe=0.8297, Trades=24
[INFO] Kmeans Top 5: Short SMA=136, Long SMA=196, Sharpe=0.8292, Trades=16
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (152, 176)
[INFO]   Rounded: (45, 251)
[INFO]   Nearest: (46.0, 250.0)
[INFO]   Rounded: (60, 76)
[INFO]   Rounded: (95, 281)
[INFO]   Nearest: (96.0, 282.0)
[INFO]   Rounded: (157, 270)
[INFO]   Nearest: (158.0, 270.0)
[INFO]   Rounded: (73, 144)
[INFO]   Nearest: (72.0, 144.0)
[INFO]   Rounded: (30, 96)
[INFO]   Rounded: (279, 293)
[INFO]   Nearest: (278.0, 294.0)
[INFO]   Rounded: (106, 189)
[INFO]   Nearest: (106.0, 190.0)
[INFO]   Rounded: (42, 118)
[INFO]   Rounded: (28, 51)
[INFO]   Nearest: (28.0, 50.0)
[INFO]   Rounded: (66, 258)
[INFO]   Rounded: (196, 225)
[INFO]   Nearest: (196.0, 224.0)
[INFO]   Rounded: (130, 233)
[INFO]   Nearest: (130.0, 234.0)
[INFO]   Rounded: (65, 186)
[INFO]   Nearest: (66.0, 186.0)
[INFO]   Rounded: (260, 284)
[INFO]   Rounded: (84, 110)
[INFO]   Rounded: (22, 277)
[INFO]   Nearest: (22.0, 276.0)
[INFO]   Rounded: (82, 291)
[INFO]   Nearest: (82.0, 292.0)
[INFO]   Rounded: (26, 204)
[INFO]   Rounded: (239, 267)
[INFO]   Nearest: (240.0, 268.0)
[INFO]   Rounded: (64, 159)
[INFO]   Nearest: (64.0, 158.0)
[INFO]   Rounded: (173, 187)
[INFO]   Nearest: (172.0, 186.0)
[INFO]   Rounded: (121, 151)
[INFO]   Nearest: (122.0, 152.0)
[INFO]   Rounded: (15, 36)
[INFO]   Nearest: (16.0, 36.0)
[INFO]   Rounded: (212, 274)
[INFO]   Rounded: (221, 239)
[INFO]   Nearest: (220.0, 240.0)
[INFO]   Rounded: (41, 72)
[INFO]   Nearest: (42.0, 72.0)
[INFO]   Rounded: (114, 168)
[INFO]   Rounded: (18, 125)
[INFO]   Nearest: (18.0, 126.0)
[INFO]   Rounded: (45, 287)
[INFO]   Nearest: (44.0, 286.0)
[INFO]   Rounded: (82, 241)
[INFO]   Nearest: (82.0, 242.0)
[INFO]   Rounded: (184, 277)
[INFO]   Nearest: (184.0, 278.0)
[INFO]   Rounded: (190, 251)
[INFO]   Nearest: (190.0, 252.0)
[INFO]   Rounded: (168, 213)
[INFO]   Nearest: (168.0, 212.0)
[INFO]   Rounded: (137, 196)
[INFO]   Nearest: (138.0, 196.0)
[INFO]   Rounded: (24, 245)
[INFO]   Nearest: (24.0, 244.0)
[INFO]   Rounded: (66, 105)
[INFO]   Nearest: (66.0, 104.0)
[INFO]   Rounded: (20, 50)
[INFO]   Rounded: (29, 173)
[INFO]   Nearest: (28.0, 174.0)
[INFO]   Rounded: (57, 214)
[INFO]   Nearest: (56.0, 214.0)
[INFO]   Rounded: (24, 211)
[INFO]   Nearest: (24.0, 212.0)
[INFO]   Rounded: (116, 143)
[INFO]   Nearest: (116.0, 144.0)
[INFO]   Rounded: (30, 155)
[INFO]   Nearest: (30.0, 156.0)
[INFO]   Rounded: (92, 120)
[INFO]   Rounded: (112, 143)
[INFO]   Nearest: (112.0, 144.0)
[INFO]   Rounded: (236, 284)
[INFO]   Rounded: (87, 193)
[INFO]   Nearest: (86.0, 194.0)
[INFO]   Rounded: (114, 212)
[INFO]   Rounded: (155, 243)
[INFO]   Nearest: (154.0, 242.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 166, Long SMA: 168
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 2
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(168/212) - Original Sharpe: 0.9784, Trades: 16
[INFO] Kmeans cluster 2: SMA(190/252) - Original Sharpe: 0.9588, Trades: 12
[INFO] Kmeans cluster 3: SMA(196/224) - Original Sharpe: 0.8312, Trades: 18
[INFO] Kmeans cluster 4: SMA(152/176) - Original Sharpe: 0.8297, Trades: 24
[INFO] Kmeans cluster 5: SMA(136/196) - Original Sharpe: 0.8292, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2681
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (166/168)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (168/212) - Sharpe: 0.9784
[INFO] cluster 2: (190/252) - Sharpe: 0.9588
[INFO] cluster 3: (196/224) - Sharpe: 0.8312
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Out-of-sample period starts on: 2021-11-19
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-11-19 2021-11-19            43     1.280342            1.280342
1    2022-01-19 2022-01-19            43     2.581626            2.581626
2    2022-03-19 2022-03-19            42     0.329627            0.329627
3    2022-05-19 2022-05-19            43     1.402034            1.402034
4    2022-07-19 2022-07-19            44    -1.324002           -1.324002
5    2022-09-19 2022-09-19            45     1.312950            1.385705
6    2022-11-19 2022-11-19            41    -0.638271           -0.060679
7    2023-01-19 2023-01-19            42     3.607885           -1.833581
8    2023-03-19 2023-03-19            43     3.055470            1.663446
9    2023-05-19 2023-05-19            43    -2.250970           -2.086250
10   2023-07-19 2023-07-19            44    -5.185486           -4.566868
11   2023-09-19 2023-09-19            44    -2.773541            1.978101
12   2023-11-19 2023-11-19            42     0.667456            0.390523
13   2024-01-19 2024-01-19            42     2.912396            2.912396
14   2024-03-19 2024-03-19            43    -2.656666           -2.876984
15   2024-05-19 2024-05-19            44    -6.949862            1.670118
16   2024-07-19 2024-07-19            44    -3.716464            1.421673
17   2024-09-19 2024-09-19            43    -1.541732            0.779200
18   2024-11-19 2024-11-19            30    -1.144354           -1.144354
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-11-19   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-01-19   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2022-03-19   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-05-19   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-07-19   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2022-09-19   |          1.3 |              1.4 |          0.1 | True          
[INFO] 2022-11-19   |         -0.6 |             -0.1 |          0.5 | True          
[INFO] 2023-01-19   |          3.6 |             -1.8 |         -5.4 | False         
[INFO] 2023-03-19   |          3.1 |              1.7 |         -1.4 | False         
[INFO] 2023-05-19   |         -2.3 |             -2.1 |          0.2 | True          
[INFO] 2023-07-19   |         -5.2 |             -4.6 |          0.6 | True          
[INFO] 2023-09-19   |         -2.8 |              2.0 |          4.8 | True          
[INFO] 2023-11-19   |          0.7 |              0.4 |         -0.3 | False         
[INFO] 2024-01-19   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-03-19   |         -2.7 |             -2.9 |         -0.2 | False         
[INFO] 2024-05-19   |         -6.9 |              1.7 |          8.6 | True          
[INFO] 2024-07-19   |         -3.7 |              1.4 |          5.1 | True          
[INFO] 2024-09-19   |         -1.5 |              0.8 |          2.3 | True          
[INFO] 2024-11-19   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-19, 2022-01-19, 2022-03-19, 2022-05-19, 2022-07-19, 2024-01-19, 2024-11-19
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 8 of 12 periods (66.67% win rate)
[INFO] Updating Excel file with Kmeans results for ULS...
[INFO] Excel file updated successfully. Added ULS with Kmeans win rate 66.7% in row 51
[INFO] Added best Sharpe parameters 166/168 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 166, Long SMA: 168
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(168/212) - Original Sharpe: 0.9784
[INFO] Added cluster 2 to portfolio: SMA(190/252) - Original Sharpe: 0.9588
[INFO] Added cluster 3 to portfolio: SMA(196/224) - Original Sharpe: 0.8312
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ULS_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3859
[INFO] Kmeans Best out-of-sample Sharpe: -0.2111
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for ULS...
[INFO] Excel file updated successfully. Added ULS with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ULS
[INFO] Big Point Value: 100.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.3504 to 1.1140
[INFO] 
Best parameters:
[INFO] Short SMA: 166
[INFO] Long SMA: 168
[INFO] Sharpe Ratio: 1.113971
[INFO] Number of Trades: 62
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 9538 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.3504 to 1.1140
[INFO] Trades range: 10.0 to 302.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3195 to 2.7315
[INFO] Scaled Long SMA range: -2.7051 to 1.5032
[INFO] Scaled Sharpe ratio range: -3.2164 to 2.3607
[INFO] Scaled Trades range: -0.7285 to 15.7469
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 9538 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5728
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 318 elements
[INFO] Cluster 1: 249 elements
[INFO] Cluster 2: 343 elements
[INFO] Cluster 3: 211 elements
[INFO] Cluster 4: 498 elements
[INFO] Cluster 5: 415 elements
[INFO] Cluster 6: 241 elements
[INFO] Cluster 7: 387 elements
[INFO] Cluster 8: 53 elements
[INFO] Cluster 9: 306 elements
[INFO] Cluster 10: 202 elements
[INFO] Cluster 11: 232 elements
[INFO] Cluster 12: 42 elements
[INFO] Cluster 13: 241 elements
[INFO] Cluster 14: 138 elements
[INFO] Cluster 15: 321 elements
[INFO] Cluster 16: 23 elements
[INFO] Cluster 17: 50 elements
[INFO] Cluster 18: 269 elements
[INFO] Cluster 19: 77 elements
[INFO] Cluster 20: 280 elements
[INFO] Cluster 21: 304 elements
[INFO] Cluster 22: 309 elements
[INFO] Cluster 23: 9 elements
[INFO] Cluster 24: 56 elements
[INFO] Cluster 25: 148 elements
[INFO] Cluster 26: 36 elements
[INFO] Cluster 27: 343 elements
[INFO] Cluster 28: 101 elements
[INFO] Cluster 29: 98 elements
[INFO] Cluster 30: 224 elements
[INFO] Cluster 31: 185 elements
[INFO] Cluster 32: 108 elements
[INFO] Cluster 33: 302 elements
[INFO] Cluster 34: 152 elements
[INFO] Cluster 35: 105 elements
[INFO] Cluster 36: 285 elements
[INFO] Cluster 37: 189 elements
[INFO] Cluster 38: 217 elements
[INFO] Cluster 39: 262 elements
[INFO] Cluster 40: 95 elements
[INFO] Cluster 41: 199 elements
[INFO] Cluster 42: 14 elements
[INFO] Cluster 43: 192 elements
[INFO] Cluster 44: 27 elements
[INFO] Cluster 45: 28 elements
[INFO] Cluster 46: 361 elements
[INFO] Cluster 47: 100 elements
[INFO] Cluster 48: 44 elements
[INFO] Cluster 49: 149 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=74, Long SMA=268, Sharpe=0.5809, Trades=10
[INFO] Cluster 1 cluster: Short SMA=228, Long SMA=246, Sharpe=0.6497, Trades=24
[INFO] Cluster 2 cluster: Short SMA=34, Long SMA=84, Sharpe=0.2920, Trades=37
[INFO] Cluster 3 cluster: Short SMA=42, Long SMA=106, Sharpe=0.4826, Trades=26
[INFO] Cluster 4 cluster: Short SMA=202, Long SMA=278, Sharpe=0.7414, Trades=12
[INFO] Cluster 5 cluster: Short SMA=48, Long SMA=122, Sharpe=0.3982, Trades=22
[INFO] Cluster 6 cluster: Short SMA=90, Long SMA=120, Sharpe=0.0496, Trades=28
[INFO] Cluster 7 cluster: Short SMA=82, Long SMA=142, Sharpe=0.0739, Trades=22
[INFO] Cluster 8 cluster: Short SMA=274, Long SMA=282, Sharpe=0.2847, Trades=31
[INFO] Cluster 9 cluster: Short SMA=164, Long SMA=216, Sharpe=0.9442, Trades=16
[INFO] Cluster 10 cluster: Short SMA=24, Long SMA=268, Sharpe=0.4929, Trades=20
[INFO] Cluster 11 cluster: Short SMA=118, Long SMA=136, Sharpe=0.0518, Trades=38
[INFO] Cluster 12 cluster: Short SMA=22, Long SMA=28, Sharpe=0.8414, Trades=108
[INFO] Cluster 13 cluster: Short SMA=178, Long SMA=192, Sharpe=0.7727, Trades=26
[INFO] Cluster 14 cluster: Short SMA=116, Long SMA=166, Sharpe=0.2042, Trades=22
[INFO] Cluster 15 cluster: Short SMA=26, Long SMA=168, Sharpe=0.5328, Trades=20
[INFO] Cluster 16 cluster: Short SMA=30, Long SMA=32, Sharpe=0.5434, Trades=147
[INFO] Cluster 17 cluster: Short SMA=98, Long SMA=100, Sharpe=0.1218, Trades=96
[INFO] Cluster 18 cluster: Short SMA=52, Long SMA=220, Sharpe=0.4284, Trades=12
[INFO] Cluster 19 cluster: Short SMA=30, Long SMA=58, Sharpe=0.5378, Trades=51
[INFO] Cluster 20 cluster: Short SMA=92, Long SMA=192, Sharpe=0.6031, Trades=14
[INFO] Cluster 21 cluster: Short SMA=120, Long SMA=214, Sharpe=0.8114, Trades=12
[INFO] Cluster 22 cluster: Short SMA=132, Long SMA=194, Sharpe=0.8027, Trades=18
[INFO] Cluster 24 cluster: Short SMA=26, Long SMA=42, Sharpe=0.6581, Trades=69
[INFO] Cluster 25 cluster: Short SMA=254, Long SMA=286, Sharpe=0.5131, Trades=13
[INFO] Cluster 26 cluster: Short SMA=178, Long SMA=180, Sharpe=0.7296, Trades=60
[INFO] Cluster 27 cluster: Short SMA=22, Long SMA=228, Sharpe=0.3914, Trades=22
[INFO] Cluster 28 cluster: Short SMA=18, Long SMA=56, Sharpe=0.7115, Trades=53
[INFO] Cluster 29 cluster: Short SMA=152, Long SMA=264, Sharpe=0.6421, Trades=10
[INFO] Cluster 30 cluster: Short SMA=196, Long SMA=228, Sharpe=0.8475, Trades=18
[INFO] Cluster 31 cluster: Short SMA=148, Long SMA=178, Sharpe=0.9442, Trades=20
[INFO] Cluster 32 cluster: Short SMA=64, Long SMA=74, Sharpe=0.1179, Trades=59
[INFO] Cluster 33 cluster: Short SMA=68, Long SMA=164, Sharpe=0.1958, Trades=18
[INFO] Cluster 34 cluster: Short SMA=80, Long SMA=246, Sharpe=0.7275, Trades=10
[INFO] Cluster 35 cluster: Short SMA=14, Long SMA=134, Sharpe=0.1421, Trades=36
[INFO] Cluster 36 cluster: Short SMA=80, Long SMA=290, Sharpe=0.2271, Trades=12
[INFO] Cluster 37 cluster: Short SMA=190, Long SMA=252, Sharpe=0.9588, Trades=12
[INFO] Cluster 38 cluster: Short SMA=38, Long SMA=196, Sharpe=0.4953, Trades=14
[INFO] Cluster 39 cluster: Short SMA=38, Long SMA=288, Sharpe=0.4570, Trades=12
[INFO] Cluster 40 cluster: Short SMA=276, Long SMA=294, Sharpe=0.1517, Trades=17
[INFO] Cluster 41 cluster: Short SMA=242, Long SMA=276, Sharpe=0.6812, Trades=15
[INFO] Cluster 43 cluster: Short SMA=62, Long SMA=186, Sharpe=0.2968, Trades=14
[INFO] Cluster 44 cluster: Short SMA=126, Long SMA=130, Sharpe=0.3121, Trades=64
[INFO] Cluster 45 cluster: Short SMA=244, Long SMA=246, Sharpe=0.5135, Trades=60
[INFO] Cluster 46 cluster: Short SMA=158, Long SMA=250, Sharpe=0.7837, Trades=12
[INFO] Cluster 47 cluster: Short SMA=52, Long SMA=72, Sharpe=0.3587, Trades=48
[INFO] Cluster 48 cluster: Short SMA=16, Long SMA=34, Sharpe=0.7668, Trades=81
[INFO] Cluster 49 cluster: Short SMA=44, Long SMA=252, Sharpe=0.3863, Trades=16
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=166, Long SMA=168, Sharpe=1.1140, Trades=62
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=190, Long SMA=252, Sharpe=0.9588, Trades=12
[INFO] Top 2: Short SMA=148, Long SMA=178, Sharpe=0.9442, Trades=20
[INFO] Top 3: Short SMA=164, Long SMA=216, Sharpe=0.9442, Trades=16
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 9515 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 166, Long SMA: 168
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 2
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(190/252) - Original Sharpe: 0.9588, Trades: 12
[INFO] Hierarchical cluster 2: SMA(148/178) - Original Sharpe: 0.9442, Trades: 20
[INFO] Hierarchical cluster 3: SMA(164/216) - Original Sharpe: 0.9442, Trades: 16
[INFO] Hierarchical cluster 4: SMA(196/228) - Original Sharpe: 0.8475, Trades: 18
[INFO] Hierarchical cluster 5: SMA(22/28) - Original Sharpe: 0.8414, Trades: 108
[INFO] Trimmed warm-up period. Evaluation data length: 2681
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (166/168)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (190/252) - Sharpe: 0.9588
[INFO] cluster 2: (148/178) - Sharpe: 0.9442
[INFO] cluster 3: (164/216) - Sharpe: 0.9442
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Out-of-sample period starts on: 2021-11-19
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-11-19 2021-11-19            43     1.280342            1.280342
1    2022-01-19 2022-01-19            43     2.581626            2.581626
2    2022-03-19 2022-03-19            42     0.329627            0.329627
3    2022-05-19 2022-05-19            43     1.402034            1.402034
4    2022-07-19 2022-07-19            44    -1.324002           -1.324002
5    2022-09-19 2022-09-19            45     1.312950            1.385705
6    2022-11-19 2022-11-19            41    -0.638271           -0.566612
7    2023-01-19 2023-01-19            42     3.607885           -2.420138
8    2023-03-19 2023-03-19            43     3.055470            1.709660
9    2023-05-19 2023-05-19            43    -2.250970           -2.086250
10   2023-07-19 2023-07-19            44    -5.185486           -4.566868
11   2023-09-19 2023-09-19            44    -2.773541           -0.116589
12   2023-11-19 2023-11-19            42     0.667456            0.667456
13   2024-01-19 2024-01-19            42     2.912396            2.912396
14   2024-03-19 2024-03-19            43    -2.656666           -1.832001
15   2024-05-19 2024-05-19            44    -6.949862            1.139049
16   2024-07-19 2024-07-19            44    -3.716464           -3.437992
17   2024-09-19 2024-09-19            43    -1.541732            0.117452
18   2024-11-19 2024-11-19            30    -1.144354           -1.144354
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-11-19   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-01-19   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2022-03-19   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-05-19   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-07-19   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2022-09-19   |          1.3 |              1.4 |          0.1 | True          
[INFO] 2022-11-19   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2023-01-19   |          3.6 |             -2.4 |         -6.0 | False         
[INFO] 2023-03-19   |          3.1 |              1.7 |         -1.4 | False         
[INFO] 2023-05-19   |         -2.3 |             -2.1 |          0.2 | True          
[INFO] 2023-07-19   |         -5.2 |             -4.6 |          0.6 | True          
[INFO] 2023-09-19   |         -2.8 |             -0.1 |          2.7 | True          
[INFO] 2023-11-19   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-01-19   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-03-19   |         -2.7 |             -1.8 |          0.9 | True          
[INFO] 2024-05-19   |         -6.9 |              1.1 |          8.0 | True          
[INFO] 2024-07-19   |         -3.7 |             -3.4 |          0.3 | True          
[INFO] 2024-09-19   |         -1.5 |              0.1 |          1.6 | True          
[INFO] 2024-11-19   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-19, 2022-01-19, 2022-03-19, 2022-05-19, 2022-07-19, 2022-11-19, 2023-11-19, 2024-01-19, 2024-11-19
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 10 periods (80.00% win rate)
[INFO] Updating Excel file with Hierarchical results for ULS...
[INFO] Excel file updated successfully. Added ULS with Hierarchical win rate 80.0% in row 51
[INFO] Added best Sharpe parameters 166/168 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 166, Long SMA: 168
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(190/252) - Original Sharpe: 0.9588
[INFO] Added cluster 2 to portfolio: SMA(148/178) - Original Sharpe: 0.9442
[INFO] Added cluster 3 to portfolio: SMA(164/216) - Original Sharpe: 0.9442
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ULS_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2511
[INFO] Hierarchical Best out-of-sample Sharpe: -0.2111
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for ULS...
[INFO] Excel file updated successfully. Added ULS with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ULS
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for US in column D: 34.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 138.32s
[INFO] Best parameters: Short SMA = 62, Long SMA = 94
[INFO] Best Sharpe ratio: 1.040882, Trades: 39
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @US
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.13 contracts
[INFO] Maximum Position Size: 9 contracts
[INFO] Strategy Total P&L: $514,847.25
[INFO] Market Buy & Hold P&L: $2,093.75
[INFO] Outperformance: $512,753.50
[INFO] Sharpe ratio (entire period, annualized): 0.785212
[INFO] Sharpe ratio (in-sample, annualized): 1.040882
[INFO] Sharpe ratio (out-of-sample, annualized): 0.193643
[INFO] Maximum Drawdown: $114,216.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 26
[INFO] Out-of-sample period trades: 13
[INFO] Total trades: 39
[INFO] In-sample P&L: $581,161.00
[INFO] Out-of-sample P&L: $46,701.75
[INFO] 
Best parameters from GA: Short SMA = 62, Long SMA = 94, Sharpe = 1.040882
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4882 to 1.0409
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 94
[INFO] Sharpe Ratio: 1.040882
[INFO] Number of Trades: 39
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4882 to 1.0409
[INFO] Trades range: 11.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.5262 to 3.2566
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 194 elements
[INFO] Kmeans Cluster 1: 301 elements
[INFO] Kmeans Cluster 2: 173 elements
[INFO] Kmeans Cluster 3: 185 elements
[INFO] Kmeans Cluster 4: 313 elements
[INFO] Kmeans Cluster 5: 119 elements
[INFO] Kmeans Cluster 6: 249 elements
[INFO] Kmeans Cluster 7: 183 elements
[INFO] Kmeans Cluster 8: 222 elements
[INFO] Kmeans Cluster 9: 228 elements
[INFO] Kmeans Cluster 10: 279 elements
[INFO] Kmeans Cluster 11: 294 elements
[INFO] Kmeans Cluster 12: 314 elements
[INFO] Kmeans Cluster 13: 266 elements
[INFO] Kmeans Cluster 14: 249 elements
[INFO] Kmeans Cluster 15: 65 elements
[INFO] Kmeans Cluster 16: 127 elements
[INFO] Kmeans Cluster 17: 152 elements
[INFO] Kmeans Cluster 18: 212 elements
[INFO] Kmeans Cluster 19: 272 elements
[INFO] Kmeans Cluster 20: 245 elements
[INFO] Kmeans Cluster 21: 294 elements
[INFO] Kmeans Cluster 22: 142 elements
[INFO] Kmeans Cluster 23: 199 elements
[INFO] Kmeans Cluster 24: 97 elements
[INFO] Kmeans Cluster 25: 116 elements
[INFO] Kmeans Cluster 26: 196 elements
[INFO] Kmeans Cluster 27: 150 elements
[INFO] Kmeans Cluster 28: 152 elements
[INFO] Kmeans Cluster 29: 243 elements
[INFO] Kmeans Cluster 30: 343 elements
[INFO] Kmeans Cluster 31: 174 elements
[INFO] Kmeans Cluster 32: 232 elements
[INFO] Kmeans Cluster 33: 218 elements
[INFO] Kmeans Cluster 34: 122 elements
[INFO] Kmeans Cluster 35: 199 elements
[INFO] Kmeans Cluster 36: 182 elements
[INFO] Kmeans Cluster 37: 180 elements
[INFO] Kmeans Cluster 38: 169 elements
[INFO] Kmeans Cluster 39: 311 elements
[INFO] Kmeans Cluster 40: 227 elements
[INFO] Kmeans Cluster 41: 210 elements
[INFO] Kmeans Cluster 42: 289 elements
[INFO] Kmeans Cluster 43: 228 elements
[INFO] Kmeans Cluster 44: 308 elements
[INFO] Kmeans Cluster 45: 74 elements
[INFO] Kmeans Cluster 46: 278 elements
[INFO] Kmeans Cluster 47: 139 elements
[INFO] Kmeans Cluster 48: 197 elements
[INFO] Kmeans Cluster 49: 274 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=86.57, Long SMA=151.91, Sharpe=0.0005
[INFO] Centroid 1: Short SMA=175.36, Long SMA=244.18, Sharpe=0.0041
[INFO] Centroid 2: Short SMA=19.08, Long SMA=204.50, Sharpe=0.4902
[INFO] Centroid 3: Short SMA=68.10, Long SMA=94.10, Sharpe=0.6139
[INFO] Centroid 4: Short SMA=65.68, Long SMA=284.38, Sharpe=-0.0145
[INFO] Centroid 5: Short SMA=239.65, Long SMA=260.20, Sharpe=-0.3190
[INFO] Centroid 6: Short SMA=87.72, Long SMA=224.88, Sharpe=0.2361
[INFO] Centroid 7: Short SMA=146.15, Long SMA=193.02, Sharpe=0.2813
[INFO] Centroid 8: Short SMA=27.23, Long SMA=66.52, Sharpe=0.5349
[INFO] Centroid 9: Short SMA=97.18, Long SMA=126.25, Sharpe=0.1298
[INFO] Centroid 10: Short SMA=116.28, Long SMA=246.19, Sharpe=0.1052
[INFO] Centroid 11: Short SMA=164.78, Long SMA=283.39, Sharpe=-0.1206
[INFO] Centroid 12: Short SMA=59.22, Long SMA=201.89, Sharpe=0.2892
[INFO] Centroid 13: Short SMA=205.53, Long SMA=287.25, Sharpe=-0.2528
[INFO] Centroid 14: Short SMA=24.31, Long SMA=255.33, Sharpe=0.2127
[INFO] Centroid 15: Short SMA=19.63, Long SMA=31.17, Sharpe=0.1575
[INFO] Centroid 16: Short SMA=72.96, Long SMA=116.39, Sharpe=0.3274
[INFO] Centroid 17: Short SMA=37.41, Long SMA=181.51, Sharpe=0.4333
[INFO] Centroid 18: Short SMA=127.51, Long SMA=152.13, Sharpe=-0.0080
[INFO] Centroid 19: Short SMA=136.71, Long SMA=281.13, Sharpe=-0.0344
[INFO] Centroid 20: Short SMA=53.38, Long SMA=82.60, Sharpe=0.8213
[INFO] Centroid 21: Short SMA=51.07, Long SMA=132.52, Sharpe=0.4508
[INFO] Centroid 22: Short SMA=27.76, Long SMA=60.47, Sharpe=0.6699
[INFO] Centroid 23: Short SMA=175.59, Long SMA=209.43, Sharpe=0.1167
[INFO] Centroid 24: Short SMA=24.27, Long SMA=38.60, Sharpe=0.3801
[INFO] Centroid 25: Short SMA=157.59, Long SMA=172.78, Sharpe=0.4470
[INFO] Centroid 26: Short SMA=262.05, Long SMA=280.83, Sharpe=-0.1213
[INFO] Centroid 27: Short SMA=90.12, Long SMA=196.69, Sharpe=0.3821
[INFO] Centroid 28: Short SMA=111.62, Long SMA=150.05, Sharpe=-0.1440
[INFO] Centroid 29: Short SMA=69.80, Long SMA=169.82, Sharpe=0.1574
[INFO] Centroid 30: Short SMA=206.02, Long SMA=230.41, Sharpe=0.0386
[INFO] Centroid 31: Short SMA=226.51, Long SMA=255.23, Sharpe=-0.1718
[INFO] Centroid 32: Short SMA=148.29, Long SMA=241.22, Sharpe=0.1020
[INFO] Centroid 33: Short SMA=240.91, Long SMA=288.24, Sharpe=-0.2622
[INFO] Centroid 34: Short SMA=96.66, Long SMA=115.20, Sharpe=-0.0344
[INFO] Centroid 35: Short SMA=31.45, Long SMA=166.28, Sharpe=0.5445
[INFO] Centroid 36: Short SMA=172.84, Long SMA=192.02, Sharpe=0.2339
[INFO] Centroid 37: Short SMA=193.97, Long SMA=266.66, Sharpe=-0.0836
[INFO] Centroid 38: Short SMA=126.70, Long SMA=177.43, Sharpe=0.1636
[INFO] Centroid 39: Short SMA=30.03, Long SMA=283.83, Sharpe=0.1039
[INFO] Centroid 40: Short SMA=27.12, Long SMA=101.61, Sharpe=0.6952
[INFO] Centroid 41: Short SMA=23.11, Long SMA=124.63, Sharpe=0.5520
[INFO] Centroid 42: Short SMA=33.95, Long SMA=227.70, Sharpe=0.3324
[INFO] Centroid 43: Short SMA=58.67, Long SMA=244.79, Sharpe=0.1826
[INFO] Centroid 44: Short SMA=127.94, Long SMA=215.73, Sharpe=0.2000
[INFO] Centroid 45: Short SMA=281.84, Long SMA=292.14, Sharpe=-0.3504
[INFO] Centroid 46: Short SMA=88.05, Long SMA=259.57, Sharpe=0.0212
[INFO] Centroid 47: Short SMA=20.65, Long SMA=160.78, Sharpe=0.3851
[INFO] Centroid 48: Short SMA=104.93, Long SMA=184.88, Sharpe=0.2629
[INFO] Centroid 49: Short SMA=105.53, Long SMA=284.42, Sharpe=0.0724
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=94, Sharpe=1.0409, Trades=39
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=54, Long SMA=84, Sharpe=0.9339, Trades=37
[INFO] Kmeans Top 2: Short SMA=28, Long SMA=102, Sharpe=0.7501, Trades=30
[INFO] Kmeans Top 3: Short SMA=70, Long SMA=96, Sharpe=0.7260, Trades=37
[INFO] Kmeans Top 4: Short SMA=28, Long SMA=60, Sharpe=0.6359, Trades=42
[INFO] Kmeans Top 5: Short SMA=24, Long SMA=126, Sharpe=0.5589, Trades=26
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (87, 152)
[INFO]   Nearest: (86.0, 152.0)
[INFO]   Rounded: (175, 244)
[INFO]   Nearest: (176.0, 244.0)
[INFO]   Rounded: (19, 204)
[INFO]   Nearest: (20.0, 204.0)
[INFO]   Rounded: (68, 94)
[INFO]   Rounded: (66, 284)
[INFO]   Rounded: (240, 260)
[INFO]   Rounded: (88, 225)
[INFO]   Nearest: (88.0, 224.0)
[INFO]   Rounded: (146, 193)
[INFO]   Nearest: (146.0, 194.0)
[INFO]   Rounded: (27, 67)
[INFO]   Nearest: (28.0, 66.0)
[INFO]   Rounded: (97, 126)
[INFO]   Nearest: (98.0, 126.0)
[INFO]   Rounded: (116, 246)
[INFO]   Rounded: (165, 283)
[INFO]   Nearest: (164.0, 284.0)
[INFO]   Rounded: (59, 202)
[INFO]   Nearest: (60.0, 202.0)
[INFO]   Rounded: (206, 287)
[INFO]   Nearest: (206.0, 288.0)
[INFO]   Rounded: (24, 255)
[INFO]   Nearest: (24.0, 256.0)
[INFO]   Rounded: (20, 31)
[INFO]   Nearest: (20.0, 32.0)
[INFO]   Rounded: (73, 116)
[INFO]   Nearest: (72.0, 116.0)
[INFO]   Rounded: (37, 182)
[INFO]   Nearest: (38.0, 182.0)
[INFO]   Rounded: (128, 152)
[INFO]   Rounded: (137, 281)
[INFO]   Nearest: (136.0, 282.0)
[INFO]   Rounded: (53, 83)
[INFO]   Nearest: (54.0, 82.0)
[INFO]   Rounded: (51, 133)
[INFO]   Nearest: (52.0, 132.0)
[INFO]   Rounded: (28, 60)
[INFO]   Rounded: (176, 209)
[INFO]   Nearest: (176.0, 210.0)
[INFO]   Rounded: (24, 39)
[INFO]   Nearest: (24.0, 38.0)
[INFO]   Rounded: (158, 173)
[INFO]   Nearest: (158.0, 172.0)
[INFO]   Rounded: (262, 281)
[INFO]   Nearest: (262.0, 280.0)
[INFO]   Rounded: (90, 197)
[INFO]   Nearest: (90.0, 196.0)
[INFO]   Rounded: (112, 150)
[INFO]   Rounded: (70, 170)
[INFO]   Rounded: (206, 230)
[INFO]   Rounded: (227, 255)
[INFO]   Nearest: (226.0, 256.0)
[INFO]   Rounded: (148, 241)
[INFO]   Nearest: (148.0, 242.0)
[INFO]   Rounded: (241, 288)
[INFO]   Nearest: (240.0, 288.0)
[INFO]   Rounded: (97, 115)
[INFO]   Nearest: (96.0, 116.0)
[INFO]   Rounded: (31, 166)
[INFO]   Nearest: (32.0, 166.0)
[INFO]   Rounded: (173, 192)
[INFO]   Nearest: (172.0, 192.0)
[INFO]   Rounded: (194, 267)
[INFO]   Nearest: (194.0, 266.0)
[INFO]   Rounded: (127, 177)
[INFO]   Nearest: (126.0, 178.0)
[INFO]   Rounded: (30, 284)
[INFO]   Rounded: (27, 102)
[INFO]   Nearest: (28.0, 102.0)
[INFO]   Rounded: (23, 125)
[INFO]   Nearest: (24.0, 124.0)
[INFO]   Rounded: (34, 228)
[INFO]   Rounded: (59, 245)
[INFO]   Nearest: (58.0, 244.0)
[INFO]   Rounded: (128, 216)
[INFO]   Rounded: (282, 292)
[INFO]   Rounded: (88, 260)
[INFO]   Rounded: (21, 161)
[INFO]   Nearest: (20.0, 160.0)
[INFO]   Rounded: (105, 185)
[INFO]   Nearest: (104.0, 184.0)
[INFO]   Rounded: (106, 284)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 94
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(54/84) - Original Sharpe: 0.9339, Trades: 37
[INFO] Kmeans cluster 2: SMA(28/102) - Original Sharpe: 0.7501, Trades: 30
[INFO] Kmeans cluster 3: SMA(70/96) - Original Sharpe: 0.7260, Trades: 37
[INFO] Kmeans cluster 4: SMA(28/60) - Original Sharpe: 0.6359, Trades: 42
[INFO] Kmeans cluster 5: SMA(24/126) - Original Sharpe: 0.5589, Trades: 26
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/94)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (54/84) - Sharpe: 0.9339
[INFO] cluster 2: (28/102) - Sharpe: 0.7501
[INFO] cluster 3: (70/96) - Sharpe: 0.7260
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.475522           -2.795696
1    2021-11-14 2021-11-14            43     1.219983           -1.556062
2    2022-01-14 2022-01-14            41    -0.358176           -0.851627
3    2022-03-14 2022-03-14            44     4.804528            4.804528
4    2022-05-14 2022-05-14            43    -0.181247           -0.181247
5    2022-07-14 2022-07-14            44     1.120787           -1.476666
6    2022-09-14 2022-09-14            43    -1.028981            0.593090
7    2022-11-14 2022-11-14            43    -2.298651           -1.013477
8    2023-01-14 2023-01-14            41    -0.223635           -4.168108
9    2023-03-14 2023-03-14            44     0.355798           -1.751839
10   2023-05-14 2023-05-14            44     1.277535           -3.338831
11   2023-07-14 2023-07-14            44     3.299199            3.299199
12   2023-09-14 2023-09-14            43     2.565820            2.565820
13   2023-11-14 2023-11-14            42    -2.979453           -5.609764
14   2024-01-14 2024-01-14            43    -1.306968           -0.721499
15   2024-03-14 2024-03-14            42     0.596356            0.480074
16   2024-05-14 2024-05-14            44    -1.478112           -1.435208
17   2024-07-14 2024-07-14            45     3.789391            3.549624
18   2024-09-14 2024-09-14            43    -5.219166           -5.382032
19   2024-11-14 2024-11-14            33     2.330861            2.029593
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.5 |             -2.8 |         -1.3 | False         
[INFO] 2021-11-14   |          1.2 |             -1.6 |         -2.8 | False         
[INFO] 2022-01-14   |         -0.4 |             -0.9 |         -0.5 | False         
[INFO] 2022-03-14   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |             -1.5 |         -2.6 | False         
[INFO] 2022-09-14   |         -1.0 |              0.6 |          1.6 | True          
[INFO] 2022-11-14   |         -2.3 |             -1.0 |          1.3 | True          
[INFO] 2023-01-14   |         -0.2 |             -4.2 |         -4.0 | False         
[INFO] 2023-03-14   |          0.4 |             -1.8 |         -2.2 | False         
[INFO] 2023-05-14   |          1.3 |             -3.3 |         -4.6 | False         
[INFO] 2023-07-14   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.0 |             -5.6 |         -2.6 | False         
[INFO] 2024-01-14   |         -1.3 |             -0.7 |          0.6 | True          
[INFO] 2024-03-14   |          0.6 |              0.5 |         -0.1 | False         
[INFO] 2024-05-14   |         -1.5 |             -1.4 |          0.1 | True          
[INFO] 2024-07-14   |          3.8 |              3.5 |         -0.3 | False         
[INFO] 2024-09-14   |         -5.2 |             -5.4 |         -0.2 | False         
[INFO] 2024-11-14   |          2.3 |              2.0 |         -0.3 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 4 of 16 periods (25.00% win rate)
[INFO] Updating Excel file with Kmeans results for US...
[INFO] Excel file updated successfully. Added US with Kmeans win rate 25.0% in row 52
[INFO] Added best Sharpe parameters 62/94 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 94
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(54/84) - Original Sharpe: 0.9339
[INFO] Added cluster 2 to portfolio: SMA(28/102) - Original Sharpe: 0.7501
[INFO] Added cluster 3 to portfolio: SMA(70/96) - Original Sharpe: 0.7260
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'US_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3400
[INFO] Kmeans Best out-of-sample Sharpe: 0.1936
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for US...
[INFO] Excel file updated successfully. Added US with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\US
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.4882 to 1.0409
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 94
[INFO] Sharpe Ratio: 1.040882
[INFO] Number of Trades: 39
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.4882 to 1.0409
[INFO] Trades range: 11.0 to 330.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -2.5262 to 3.2566
[INFO] Scaled Trades range: -0.6643 to 16.8688
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6209
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 325 elements
[INFO] Cluster 1: 446 elements
[INFO] Cluster 2: 358 elements
[INFO] Cluster 3: 159 elements
[INFO] Cluster 4: 321 elements
[INFO] Cluster 5: 298 elements
[INFO] Cluster 6: 33 elements
[INFO] Cluster 7: 427 elements
[INFO] Cluster 8: 336 elements
[INFO] Cluster 9: 302 elements
[INFO] Cluster 10: 497 elements
[INFO] Cluster 11: 327 elements
[INFO] Cluster 12: 459 elements
[INFO] Cluster 13: 389 elements
[INFO] Cluster 14: 311 elements
[INFO] Cluster 15: 52 elements
[INFO] Cluster 16: 130 elements
[INFO] Cluster 17: 356 elements
[INFO] Cluster 18: 194 elements
[INFO] Cluster 19: 510 elements
[INFO] Cluster 20: 97 elements
[INFO] Cluster 21: 7 elements
[INFO] Cluster 22: 270 elements
[INFO] Cluster 23: 152 elements
[INFO] Cluster 24: 242 elements
[INFO] Cluster 25: 205 elements
[INFO] Cluster 26: 54 elements
[INFO] Cluster 27: 388 elements
[INFO] Cluster 28: 56 elements
[INFO] Cluster 29: 97 elements
[INFO] Cluster 30: 38 elements
[INFO] Cluster 31: 279 elements
[INFO] Cluster 32: 162 elements
[INFO] Cluster 33: 211 elements
[INFO] Cluster 34: 58 elements
[INFO] Cluster 35: 205 elements
[INFO] Cluster 36: 188 elements
[INFO] Cluster 37: 157 elements
[INFO] Cluster 38: 21 elements
[INFO] Cluster 39: 259 elements
[INFO] Cluster 40: 6 elements
[INFO] Cluster 41: 180 elements
[INFO] Cluster 42: 213 elements
[INFO] Cluster 43: 29 elements
[INFO] Cluster 44: 47 elements
[INFO] Cluster 45: 191 elements
[INFO] Cluster 46: 213 elements
[INFO] Cluster 47: 134 elements
[INFO] Cluster 48: 55 elements
[INFO] Cluster 49: 141 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=66, Long SMA=176, Sharpe=0.2698, Trades=18
[INFO] Cluster 1 cluster: Short SMA=148, Long SMA=286, Sharpe=-0.0257, Trades=11
[INFO] Cluster 2 cluster: Short SMA=118, Long SMA=178, Sharpe=0.2548, Trades=17
[INFO] Cluster 3 cluster: Short SMA=50, Long SMA=64, Sharpe=0.7811, Trades=50
[INFO] Cluster 4 cluster: Short SMA=96, Long SMA=154, Sharpe=-0.1684, Trades=21
[INFO] Cluster 5 cluster: Short SMA=208, Long SMA=228, Sharpe=0.0203, Trades=20
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=30, Sharpe=-0.0312, Trades=155
[INFO] Cluster 7 cluster: Short SMA=178, Long SMA=246, Sharpe=0.0285, Trades=15
[INFO] Cluster 8 cluster: Short SMA=238, Long SMA=272, Sharpe=-0.3654, Trades=16
[INFO] Cluster 9 cluster: Short SMA=100, Long SMA=128, Sharpe=0.1113, Trades=32
[INFO] Cluster 10 cluster: Short SMA=86, Long SMA=268, Sharpe=0.0694, Trades=14
[INFO] Cluster 11 cluster: Short SMA=22, Long SMA=108, Sharpe=0.6658, Trades=34
[INFO] Cluster 12 cluster: Short SMA=128, Long SMA=248, Sharpe=0.1480, Trades=11
[INFO] Cluster 13 cluster: Short SMA=108, Long SMA=218, Sharpe=0.1458, Trades=15
[INFO] Cluster 14 cluster: Short SMA=38, Long SMA=168, Sharpe=0.4320, Trades=20
[INFO] Cluster 15 cluster: Short SMA=130, Long SMA=134, Sharpe=0.0551, Trades=59
[INFO] Cluster 16 cluster: Short SMA=128, Long SMA=142, Sharpe=-0.0112, Trades=35
[INFO] Cluster 17 cluster: Short SMA=206, Long SMA=286, Sharpe=-0.2600, Trades=12
[INFO] Cluster 18 cluster: Short SMA=50, Long SMA=96, Sharpe=0.7294, Trades=33
[INFO] Cluster 19 cluster: Short SMA=60, Long SMA=218, Sharpe=0.2872, Trades=16
[INFO] Cluster 20 cluster: Short SMA=38, Long SMA=50, Sharpe=0.4097, Trades=64
[INFO] Cluster 22 cluster: Short SMA=24, Long SMA=258, Sharpe=0.1885, Trades=18
[INFO] Cluster 23 cluster: Short SMA=70, Long SMA=124, Sharpe=0.2673, Trades=25
[INFO] Cluster 24 cluster: Short SMA=200, Long SMA=264, Sharpe=-0.0891, Trades=14
[INFO] Cluster 25 cluster: Short SMA=26, Long SMA=226, Sharpe=0.2835, Trades=22
[INFO] Cluster 26 cluster: Short SMA=256, Long SMA=260, Sharpe=-0.0173, Trades=34
[INFO] Cluster 27 cluster: Short SMA=48, Long SMA=130, Sharpe=0.4321, Trades=25
[INFO] Cluster 28 cluster: Short SMA=18, Long SMA=30, Sharpe=0.2196, Trades=104
[INFO] Cluster 29 cluster: Short SMA=154, Long SMA=174, Sharpe=0.4533, Trades=27
[INFO] Cluster 30 cluster: Short SMA=64, Long SMA=66, Sharpe=0.5895, Trades=108
[INFO] Cluster 31 cluster: Short SMA=32, Long SMA=284, Sharpe=0.1537, Trades=16
[INFO] Cluster 32 cluster: Short SMA=94, Long SMA=194, Sharpe=0.3683, Trades=15
[INFO] Cluster 33 cluster: Short SMA=262, Long SMA=280, Sharpe=-0.1489, Trades=20
[INFO] Cluster 34 cluster: Short SMA=188, Long SMA=192, Sharpe=0.0895, Trades=53
[INFO] Cluster 35 cluster: Short SMA=170, Long SMA=192, Sharpe=0.2807, Trades=23
[INFO] Cluster 36 cluster: Short SMA=26, Long SMA=70, Sharpe=0.5185, Trades=42
[INFO] Cluster 37 cluster: Short SMA=18, Long SMA=160, Sharpe=0.3640, Trades=30
[INFO] Cluster 38 cluster: Short SMA=118, Long SMA=120, Sharpe=0.0825, Trades=95
[INFO] Cluster 39 cluster: Short SMA=146, Long SMA=204, Sharpe=0.2828, Trades=17
[INFO] Cluster 41 cluster: Short SMA=58, Long SMA=248, Sharpe=0.1623, Trades=14
[INFO] Cluster 42 cluster: Short SMA=162, Long SMA=226, Sharpe=0.0426, Trades=15
[INFO] Cluster 43 cluster: Short SMA=164, Long SMA=168, Sharpe=0.4630, Trades=59
[INFO] Cluster 44 cluster: Short SMA=24, Long SMA=40, Sharpe=0.3060, Trades=80
[INFO] Cluster 45 cluster: Short SMA=20, Long SMA=196, Sharpe=0.4552, Trades=24
[INFO] Cluster 46 cluster: Short SMA=64, Long SMA=290, Sharpe=0.0545, Trades=12
[INFO] Cluster 47 cluster: Short SMA=112, Long SMA=282, Sharpe=0.1875, Trades=11
[INFO] Cluster 48 cluster: Short SMA=282, Long SMA=292, Sharpe=-0.3440, Trades=23
[INFO] Cluster 49 cluster: Short SMA=52, Long SMA=78, Sharpe=0.7402, Trades=41
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=94, Sharpe=1.0409, Trades=39
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=50, Long SMA=64, Sharpe=0.7811, Trades=50
[INFO] Top 2: Short SMA=52, Long SMA=78, Sharpe=0.7402, Trades=41
[INFO] Top 3: Short SMA=50, Long SMA=96, Sharpe=0.7294, Trades=33
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10572 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 94
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(50/64) - Original Sharpe: 0.7811, Trades: 50
[INFO] Hierarchical cluster 2: SMA(52/78) - Original Sharpe: 0.7402, Trades: 41
[INFO] Hierarchical cluster 3: SMA(50/96) - Original Sharpe: 0.7294, Trades: 33
[INFO] Hierarchical cluster 4: SMA(22/108) - Original Sharpe: 0.6658, Trades: 34
[INFO] Hierarchical cluster 5: SMA(64/66) - Original Sharpe: 0.5895, Trades: 108
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/94)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (50/64) - Sharpe: 0.7811
[INFO] cluster 2: (52/78) - Sharpe: 0.7402
[INFO] cluster 3: (50/96) - Sharpe: 0.7294
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.475522           -2.712830
1    2021-11-14 2021-11-14            43     1.219983           -2.291798
2    2022-01-14 2022-01-14            41    -0.358176            0.394480
3    2022-03-14 2022-03-14            44     4.804528            4.804528
4    2022-05-14 2022-05-14            43    -0.181247           -0.181247
5    2022-07-14 2022-07-14            44     1.120787           -2.550575
6    2022-09-14 2022-09-14            43    -1.028981           -0.263340
7    2022-11-14 2022-11-14            43    -2.298651           -1.083985
8    2023-01-14 2023-01-14            41    -0.223635           -4.870428
9    2023-03-14 2023-03-14            44     0.355798           -1.477944
10   2023-05-14 2023-05-14            44     1.277535           -1.119596
11   2023-07-14 2023-07-14            44     3.299199            3.299199
12   2023-09-14 2023-09-14            43     2.565820            2.565820
13   2023-11-14 2023-11-14            42    -2.979453           -5.385308
14   2024-01-14 2024-01-14            43    -1.306968           -1.499704
15   2024-03-14 2024-03-14            42     0.596356            1.980382
16   2024-05-14 2024-05-14            44    -1.478112           -0.506821
17   2024-07-14 2024-07-14            45     3.789391            3.131795
18   2024-09-14 2024-09-14            43    -5.219166           -6.108205
19   2024-11-14 2024-11-14            33     2.330861            1.824419
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.5 |             -2.7 |         -1.2 | False         
[INFO] 2021-11-14   |          1.2 |             -2.3 |         -3.5 | False         
[INFO] 2022-01-14   |         -0.4 |              0.4 |          0.8 | True          
[INFO] 2022-03-14   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |             -2.6 |         -3.7 | False         
[INFO] 2022-09-14   |         -1.0 |             -0.3 |          0.7 | True          
[INFO] 2022-11-14   |         -2.3 |             -1.1 |          1.2 | True          
[INFO] 2023-01-14   |         -0.2 |             -4.9 |         -4.7 | False         
[INFO] 2023-03-14   |          0.4 |             -1.5 |         -1.9 | False         
[INFO] 2023-05-14   |          1.3 |             -1.1 |         -2.4 | False         
[INFO] 2023-07-14   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.0 |             -5.4 |         -2.4 | False         
[INFO] 2024-01-14   |         -1.3 |             -1.5 |         -0.2 | False         
[INFO] 2024-03-14   |          0.6 |              2.0 |          1.4 | True          
[INFO] 2024-05-14   |         -1.5 |             -0.5 |          1.0 | True          
[INFO] 2024-07-14   |          3.8 |              3.1 |         -0.7 | False         
[INFO] 2024-09-14   |         -5.2 |             -6.1 |         -0.9 | False         
[INFO] 2024-11-14   |          2.3 |              1.8 |         -0.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 16 periods (31.25% win rate)
[INFO] Updating Excel file with Hierarchical results for US...
[INFO] Excel file updated successfully. Added US with Hierarchical win rate 31.2% in row 52
[INFO] Added best Sharpe parameters 62/94 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 94
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(50/64) - Original Sharpe: 0.7811
[INFO] Added cluster 2 to portfolio: SMA(52/78) - Original Sharpe: 0.7402
[INFO] Added cluster 3 to portfolio: SMA(50/96) - Original Sharpe: 0.7294
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'US_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3812
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1936
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for US...
[INFO] Excel file updated successfully. Added US with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\US
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for VX in column D: 52.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 132.92s
[INFO] Best parameters: Short SMA = 20, Long SMA = 26
[INFO] Best Sharpe ratio: 0.498120, Trades: 112
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @VX
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 6.89 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $374,312.00
[INFO] Market Buy & Hold P&L: $-118,870.00
[INFO] Outperformance: $493,182.00
[INFO] Sharpe ratio (entire period, annualized): 0.348523
[INFO] Sharpe ratio (in-sample, annualized): 0.498120
[INFO] Sharpe ratio (out-of-sample, annualized): -0.080129
[INFO] Maximum Drawdown: $275,228.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 77
[INFO] Out-of-sample period trades: 35
[INFO] Total trades: 112
[INFO] In-sample P&L: $452,028.00
[INFO] Out-of-sample P&L: $-25,006.00
[INFO] 
Best parameters from GA: Short SMA = 20, Long SMA = 26, Sharpe = 0.498120
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 52.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6289 to 0.4981
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 0.498120
[INFO] Number of Trades: 112
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10372 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6289 to 0.4981
[INFO] Trades range: 10.0 to 319.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3877 to 2.8531
[INFO] Scaled Long SMA range: -2.7953 to 1.4389
[INFO] Scaled Sharpe ratio range: -2.2865 to 4.5954
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 174 elements
[INFO] Kmeans Cluster 1: 319 elements
[INFO] Kmeans Cluster 2: 205 elements
[INFO] Kmeans Cluster 3: 177 elements
[INFO] Kmeans Cluster 4: 327 elements
[INFO] Kmeans Cluster 5: 337 elements
[INFO] Kmeans Cluster 6: 166 elements
[INFO] Kmeans Cluster 7: 175 elements
[INFO] Kmeans Cluster 8: 282 elements
[INFO] Kmeans Cluster 9: 173 elements
[INFO] Kmeans Cluster 10: 247 elements
[INFO] Kmeans Cluster 11: 239 elements
[INFO] Kmeans Cluster 12: 164 elements
[INFO] Kmeans Cluster 13: 201 elements
[INFO] Kmeans Cluster 14: 255 elements
[INFO] Kmeans Cluster 15: 311 elements
[INFO] Kmeans Cluster 16: 269 elements
[INFO] Kmeans Cluster 17: 150 elements
[INFO] Kmeans Cluster 18: 225 elements
[INFO] Kmeans Cluster 19: 209 elements
[INFO] Kmeans Cluster 20: 95 elements
[INFO] Kmeans Cluster 21: 35 elements
[INFO] Kmeans Cluster 22: 166 elements
[INFO] Kmeans Cluster 23: 216 elements
[INFO] Kmeans Cluster 24: 244 elements
[INFO] Kmeans Cluster 25: 321 elements
[INFO] Kmeans Cluster 26: 73 elements
[INFO] Kmeans Cluster 27: 230 elements
[INFO] Kmeans Cluster 28: 258 elements
[INFO] Kmeans Cluster 29: 300 elements
[INFO] Kmeans Cluster 30: 142 elements
[INFO] Kmeans Cluster 31: 194 elements
[INFO] Kmeans Cluster 32: 300 elements
[INFO] Kmeans Cluster 33: 231 elements
[INFO] Kmeans Cluster 34: 205 elements
[INFO] Kmeans Cluster 35: 219 elements
[INFO] Kmeans Cluster 36: 194 elements
[INFO] Kmeans Cluster 37: 181 elements
[INFO] Kmeans Cluster 38: 207 elements
[INFO] Kmeans Cluster 39: 172 elements
[INFO] Kmeans Cluster 40: 183 elements
[INFO] Kmeans Cluster 41: 103 elements
[INFO] Kmeans Cluster 42: 284 elements
[INFO] Kmeans Cluster 43: 184 elements
[INFO] Kmeans Cluster 44: 252 elements
[INFO] Kmeans Cluster 45: 169 elements
[INFO] Kmeans Cluster 46: 140 elements
[INFO] Kmeans Cluster 47: 173 elements
[INFO] Kmeans Cluster 48: 199 elements
[INFO] Kmeans Cluster 49: 97 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=51.11, Long SMA=83.64, Sharpe=-0.1425
[INFO] Centroid 1: Short SMA=110.28, Long SMA=226.21, Sharpe=-0.4075
[INFO] Centroid 2: Short SMA=233.05, Long SMA=268.27, Sharpe=-0.0298
[INFO] Centroid 3: Short SMA=35.47, Long SMA=204.83, Sharpe=-0.2791
[INFO] Centroid 4: Short SMA=66.62, Long SMA=144.94, Sharpe=-0.3172
[INFO] Centroid 5: Short SMA=74.46, Long SMA=274.87, Sharpe=-0.4533
[INFO] Centroid 6: Short SMA=22.70, Long SMA=46.17, Sharpe=-0.0416
[INFO] Centroid 7: Short SMA=109.59, Long SMA=135.10, Sharpe=-0.1646
[INFO] Centroid 8: Short SMA=86.24, Long SMA=177.76, Sharpe=-0.3366
[INFO] Centroid 9: Short SMA=265.27, Long SMA=286.97, Sharpe=-0.2924
[INFO] Centroid 10: Short SMA=146.89, Long SMA=222.38, Sharpe=-0.3064
[INFO] Centroid 11: Short SMA=45.58, Long SMA=237.89, Sharpe=-0.3678
[INFO] Centroid 12: Short SMA=24.34, Long SMA=148.44, Sharpe=-0.1089
[INFO] Centroid 13: Short SMA=118.65, Long SMA=200.73, Sharpe=-0.4586
[INFO] Centroid 14: Short SMA=185.49, Long SMA=265.38, Sharpe=-0.0338
[INFO] Centroid 15: Short SMA=147.56, Long SMA=258.40, Sharpe=-0.3522
[INFO] Centroid 16: Short SMA=156.48, Long SMA=182.23, Sharpe=-0.4528
[INFO] Centroid 17: Short SMA=235.15, Long SMA=249.25, Sharpe=0.1465
[INFO] Centroid 18: Short SMA=188.96, Long SMA=277.36, Sharpe=0.0474
[INFO] Centroid 19: Short SMA=18.33, Long SMA=228.93, Sharpe=-0.1690
[INFO] Centroid 20: Short SMA=164.53, Long SMA=273.14, Sharpe=-0.1850
[INFO] Centroid 21: Short SMA=24.23, Long SMA=38.63, Sharpe=0.3031
[INFO] Centroid 22: Short SMA=25.90, Long SMA=61.25, Sharpe=0.1049
[INFO] Centroid 23: Short SMA=51.75, Long SMA=170.78, Sharpe=-0.2794
[INFO] Centroid 24: Short SMA=206.52, Long SMA=238.61, Sharpe=-0.0725
[INFO] Centroid 25: Short SMA=112.28, Long SMA=258.36, Sharpe=-0.4534
[INFO] Centroid 26: Short SMA=16.79, Long SMA=56.90, Sharpe=-0.2080
[INFO] Centroid 27: Short SMA=68.77, Long SMA=106.43, Sharpe=-0.2917
[INFO] Centroid 28: Short SMA=51.83, Long SMA=287.16, Sharpe=-0.3750
[INFO] Centroid 29: Short SMA=65.68, Long SMA=204.99, Sharpe=-0.4116
[INFO] Centroid 30: Short SMA=264.85, Long SMA=284.76, Sharpe=-0.1871
[INFO] Centroid 31: Short SMA=50.03, Long SMA=74.09, Sharpe=-0.0414
[INFO] Centroid 32: Short SMA=75.02, Long SMA=236.43, Sharpe=-0.4837
[INFO] Centroid 33: Short SMA=115.96, Long SMA=284.01, Sharpe=-0.3535
[INFO] Centroid 34: Short SMA=137.54, Long SMA=157.84, Sharpe=-0.3266
[INFO] Centroid 35: Short SMA=177.36, Long SMA=201.81, Sharpe=-0.3630
[INFO] Centroid 36: Short SMA=37.97, Long SMA=130.31, Sharpe=-0.1923
[INFO] Centroid 37: Short SMA=25.73, Long SMA=112.83, Sharpe=-0.0818
[INFO] Centroid 38: Short SMA=91.72, Long SMA=122.83, Sharpe=-0.2405
[INFO] Centroid 39: Short SMA=168.10, Long SMA=224.93, Sharpe=-0.4103
[INFO] Centroid 40: Short SMA=17.65, Long SMA=278.42, Sharpe=-0.1513
[INFO] Centroid 41: Short SMA=77.84, Long SMA=102.23, Sharpe=-0.4128
[INFO] Centroid 42: Short SMA=24.20, Long SMA=180.73, Sharpe=-0.1873
[INFO] Centroid 43: Short SMA=115.84, Long SMA=188.37, Sharpe=-0.3880
[INFO] Centroid 44: Short SMA=114.85, Long SMA=153.87, Sharpe=-0.2454
[INFO] Centroid 45: Short SMA=196.60, Long SMA=224.09, Sharpe=-0.1899
[INFO] Centroid 46: Short SMA=20.73, Long SMA=99.46, Sharpe=0.0340
[INFO] Centroid 47: Short SMA=215.46, Long SMA=284.88, Sharpe=-0.0853
[INFO] Centroid 48: Short SMA=31.85, Long SMA=265.70, Sharpe=-0.2788
[INFO] Centroid 49: Short SMA=112.76, Long SMA=294.47, Sharpe=-0.2541
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=26, Sharpe=0.4981, Trades=112
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=20, Long SMA=36, Sharpe=0.3766, Trades=72
[INFO] Kmeans Top 2: Short SMA=234, Long SMA=250, Sharpe=0.1637, Trades=16
[INFO] Kmeans Top 3: Short SMA=26, Long SMA=62, Sharpe=0.0312, Trades=42
[INFO] Kmeans Top 4: Short SMA=188, Long SMA=278, Sharpe=0.0210, Trades=10
[INFO] Kmeans Top 5: Short SMA=22, Long SMA=98, Sharpe=0.0191, Trades=26
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (51, 84)
[INFO]   Nearest: (52.0, 84.0)
[INFO]   Rounded: (110, 226)
[INFO]   Rounded: (233, 268)
[INFO]   Nearest: (234.0, 268.0)
[INFO]   Rounded: (35, 205)
[INFO]   Nearest: (36.0, 204.0)
[INFO]   Rounded: (67, 145)
[INFO]   Nearest: (66.0, 144.0)
[INFO]   Rounded: (74, 275)
[INFO]   Nearest: (74.0, 274.0)
[INFO]   Rounded: (23, 46)
[INFO]   Nearest: (22.0, 46.0)
[INFO]   Rounded: (110, 135)
[INFO]   Nearest: (110.0, 136.0)
[INFO]   Rounded: (86, 178)
[INFO]   Rounded: (265, 287)
[INFO]   Nearest: (266.0, 286.0)
[INFO]   Rounded: (147, 222)
[INFO]   Nearest: (146.0, 222.0)
[INFO]   Rounded: (46, 238)
[INFO]   Rounded: (24, 148)
[INFO]   Rounded: (119, 201)
[INFO]   Nearest: (118.0, 200.0)
[INFO]   Rounded: (185, 265)
[INFO]   Nearest: (186.0, 266.0)
[INFO]   Rounded: (148, 258)
[INFO]   Rounded: (156, 182)
[INFO]   Rounded: (235, 249)
[INFO]   Nearest: (236.0, 250.0)
[INFO]   Rounded: (189, 277)
[INFO]   Nearest: (188.0, 278.0)
[INFO]   Rounded: (18, 229)
[INFO]   Nearest: (18.0, 228.0)
[INFO]   Rounded: (165, 273)
[INFO]   Nearest: (164.0, 274.0)
[INFO]   Rounded: (24, 39)
[INFO]   Nearest: (24.0, 38.0)
[INFO]   Rounded: (26, 61)
[INFO]   Nearest: (26.0, 62.0)
[INFO]   Rounded: (52, 171)
[INFO]   Nearest: (52.0, 170.0)
[INFO]   Rounded: (207, 239)
[INFO]   Nearest: (206.0, 238.0)
[INFO]   Rounded: (112, 258)
[INFO]   Rounded: (17, 57)
[INFO]   Nearest: (16.0, 56.0)
[INFO]   Rounded: (69, 106)
[INFO]   Nearest: (68.0, 106.0)
[INFO]   Rounded: (52, 287)
[INFO]   Nearest: (52.0, 288.0)
[INFO]   Rounded: (66, 205)
[INFO]   Nearest: (66.0, 204.0)
[INFO]   Rounded: (265, 285)
[INFO]   Nearest: (264.0, 284.0)
[INFO]   Rounded: (50, 74)
[INFO]   Rounded: (75, 236)
[INFO]   Nearest: (76.0, 236.0)
[INFO]   Rounded: (116, 284)
[INFO]   Rounded: (138, 158)
[INFO]   Rounded: (177, 202)
[INFO]   Nearest: (178.0, 202.0)
[INFO]   Rounded: (38, 130)
[INFO]   Rounded: (26, 113)
[INFO]   Nearest: (26.0, 112.0)
[INFO]   Rounded: (92, 123)
[INFO]   Nearest: (92.0, 122.0)
[INFO]   Rounded: (168, 225)
[INFO]   Nearest: (168.0, 224.0)
[INFO]   Rounded: (18, 278)
[INFO]   Rounded: (78, 102)
[INFO]   Rounded: (24, 181)
[INFO]   Nearest: (24.0, 180.0)
[INFO]   Rounded: (116, 188)
[INFO]   Rounded: (115, 154)
[INFO]   Nearest: (114.0, 154.0)
[INFO]   Rounded: (197, 224)
[INFO]   Nearest: (196.0, 224.0)
[INFO]   Rounded: (21, 99)
[INFO]   Nearest: (20.0, 100.0)
[INFO]   Rounded: (215, 285)
[INFO]   Nearest: (216.0, 284.0)
[INFO]   Rounded: (32, 266)
[INFO]   Rounded: (113, 294)
[INFO]   Nearest: (112.0, 294.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] File size: 186438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(20/36) - Original Sharpe: 0.3766, Trades: 72
[INFO] Kmeans cluster 2: SMA(234/250) - Original Sharpe: 0.1637, Trades: 16
[INFO] Kmeans cluster 3: SMA(26/62) - Original Sharpe: 0.0312, Trades: 42
[INFO] Kmeans cluster 4: SMA(188/278) - Original Sharpe: 0.0210, Trades: 10
[INFO] Kmeans cluster 5: SMA(22/98) - Original Sharpe: 0.0191, Trades: 26
[INFO] Trimmed warm-up period. Evaluation data length: 2811
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (20/36) - Sharpe: 0.3766
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] File size: 186438 bytes
[INFO] Out-of-sample period starts on: 2021-09-21
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-21 2021-09-21            44    -0.805050           -1.056289
1    2021-11-21 2021-11-21            43    -3.658865           -4.006352
2    2022-01-21 2022-01-21            41    -3.169670            0.043769
3    2022-03-21 2022-03-21            44    -2.653829           -1.223660
4    2022-05-21 2022-05-21            43    -0.674806           -1.095412
5    2022-07-21 2022-07-21            44     2.031682            0.558101
6    2022-09-21 2022-09-21            43     1.062687            0.383555
7    2022-11-21 2022-11-21            43     3.891653            3.891653
8    2023-01-21 2023-01-21            41     2.035036           -0.649153
9    2023-03-21 2023-03-21            43    -0.328875           -0.832180
10   2023-05-21 2023-05-21            44     4.995280            4.995280
11   2023-07-21 2023-07-21            42    -2.139299           -1.573226
12   2023-09-21 2023-09-21            43    -2.742992           -0.620259
13   2023-11-21 2023-11-21            42     2.723792            2.723792
14   2024-01-21 2024-01-21            43     2.153976            2.153976
15   2024-03-21 2024-03-21            42    -3.174471           -4.425604
16   2024-05-21 2024-05-21            43    -0.220985           -0.220985
17   2024-07-21 2024-07-21            45     1.033071            0.773490
18   2024-09-21 2024-09-21            43     0.907216           -1.199798
19   2024-11-21 2024-11-21            28    -0.090414           -0.071379
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-21   |         -0.8 |             -1.1 |         -0.3 | False         
[INFO] 2021-11-21   |         -3.7 |             -4.0 |         -0.3 | False         
[INFO] 2022-01-21   |         -3.2 |              0.0 |          3.2 | True          
[INFO] 2022-03-21   |         -2.7 |             -1.2 |          1.5 | True          
[INFO] 2022-05-21   |         -0.7 |             -1.1 |         -0.4 | False         
[INFO] 2022-07-21   |          2.0 |              0.6 |         -1.4 | False         
[INFO] 2022-09-21   |          1.1 |              0.4 |         -0.7 | False         
[INFO] 2022-11-21   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2023-01-21   |          2.0 |             -0.6 |         -2.6 | False         
[INFO] 2023-03-21   |         -0.3 |             -0.8 |         -0.5 | False         
[INFO] 2023-05-21   |          5.0 |              5.0 |          0.0 | Excluded      
[INFO] 2023-07-21   |         -2.1 |             -1.6 |          0.5 | True          
[INFO] 2023-09-21   |         -2.7 |             -0.6 |          2.1 | True          
[INFO] 2023-11-21   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2024-01-21   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-03-21   |         -3.2 |             -4.4 |         -1.2 | False         
[INFO] 2024-05-21   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2024-07-21   |          1.0 |              0.8 |         -0.2 | False         
[INFO] 2024-09-21   |          0.9 |             -1.2 |         -2.1 | False         
[INFO] 2024-11-21   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-11-21, 2023-05-21, 2023-11-21, 2024-01-21, 2024-05-21, 2024-11-21
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 4 of 14 periods (28.57% win rate)
[INFO] Updating Excel file with Kmeans results for VX...
[INFO] Excel file updated successfully. Added VX with Kmeans win rate 28.6% in row 53
[INFO] Added best Sharpe parameters 20/26 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 26
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(20/36) - Original Sharpe: 0.3766
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'VX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1823
[INFO] Kmeans Best out-of-sample Sharpe: -0.0801
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for VX...
[INFO] Excel file updated successfully. Added VX with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\VX
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 52.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.6289 to 0.4981
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 0.498120
[INFO] Number of Trades: 112
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10372 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.6289 to 0.4981
[INFO] Trades range: 10.0 to 319.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3877 to 2.8531
[INFO] Scaled Long SMA range: -2.7953 to 1.4389
[INFO] Scaled Sharpe ratio range: -2.2865 to 4.5954
[INFO] Scaled Trades range: -0.5516 to 19.0730
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10372 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5367
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 313 elements
[INFO] Cluster 1: 287 elements
[INFO] Cluster 2: 322 elements
[INFO] Cluster 3: 359 elements
[INFO] Cluster 4: 244 elements
[INFO] Cluster 5: 362 elements
[INFO] Cluster 6: 170 elements
[INFO] Cluster 7: 152 elements
[INFO] Cluster 8: 358 elements
[INFO] Cluster 9: 242 elements
[INFO] Cluster 10: 280 elements
[INFO] Cluster 11: 263 elements
[INFO] Cluster 12: 243 elements
[INFO] Cluster 13: 369 elements
[INFO] Cluster 14: 403 elements
[INFO] Cluster 15: 406 elements
[INFO] Cluster 16: 144 elements
[INFO] Cluster 17: 40 elements
[INFO] Cluster 18: 422 elements
[INFO] Cluster 19: 380 elements
[INFO] Cluster 20: 34 elements
[INFO] Cluster 21: 437 elements
[INFO] Cluster 22: 200 elements
[INFO] Cluster 23: 85 elements
[INFO] Cluster 24: 11 elements
[INFO] Cluster 25: 82 elements
[INFO] Cluster 26: 155 elements
[INFO] Cluster 27: 133 elements
[INFO] Cluster 28: 267 elements
[INFO] Cluster 29: 6 elements
[INFO] Cluster 30: 271 elements
[INFO] Cluster 31: 84 elements
[INFO] Cluster 32: 61 elements
[INFO] Cluster 33: 280 elements
[INFO] Cluster 34: 216 elements
[INFO] Cluster 35: 49 elements
[INFO] Cluster 36: 279 elements
[INFO] Cluster 37: 24 elements
[INFO] Cluster 38: 113 elements
[INFO] Cluster 39: 326 elements
[INFO] Cluster 40: 24 elements
[INFO] Cluster 41: 123 elements
[INFO] Cluster 42: 31 elements
[INFO] Cluster 43: 224 elements
[INFO] Cluster 44: 261 elements
[INFO] Cluster 45: 172 elements
[INFO] Cluster 46: 2 elements
[INFO] Cluster 47: 255 elements
[INFO] Cluster 48: 236 elements
[INFO] Cluster 49: 172 elements
[INFO] Using 47 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=264, Long SMA=286, Sharpe=-0.2594, Trades=12
[INFO] Cluster 1 cluster: Short SMA=52, Long SMA=106, Sharpe=-0.2545, Trades=24
[INFO] Cluster 2 cluster: Short SMA=18, Long SMA=224, Sharpe=-0.1808, Trades=20
[INFO] Cluster 3 cluster: Short SMA=30, Long SMA=154, Sharpe=-0.1240, Trades=22
[INFO] Cluster 4 cluster: Short SMA=200, Long SMA=224, Sharpe=-0.2473, Trades=12
[INFO] Cluster 5 cluster: Short SMA=142, Long SMA=184, Sharpe=-0.4671, Trades=14
[INFO] Cluster 6 cluster: Short SMA=234, Long SMA=250, Sharpe=0.1637, Trades=16
[INFO] Cluster 7 cluster: Short SMA=166, Long SMA=280, Sharpe=-0.0962, Trades=10
[INFO] Cluster 8 cluster: Short SMA=224, Long SMA=276, Sharpe=-0.0858, Trades=10
[INFO] Cluster 9 cluster: Short SMA=22, Long SMA=280, Sharpe=-0.0972, Trades=12
[INFO] Cluster 10 cluster: Short SMA=110, Long SMA=152, Sharpe=-0.2702, Trades=15
[INFO] Cluster 11 cluster: Short SMA=116, Long SMA=290, Sharpe=-0.3470, Trades=10
[INFO] Cluster 12 cluster: Short SMA=46, Long SMA=72, Sharpe=-0.1613, Trades=38
[INFO] Cluster 13 cluster: Short SMA=150, Long SMA=256, Sharpe=-0.3929, Trades=10
[INFO] Cluster 14 cluster: Short SMA=172, Long SMA=206, Sharpe=-0.3733, Trades=12
[INFO] Cluster 15 cluster: Short SMA=88, Long SMA=182, Sharpe=-0.3380, Trades=15
[INFO] Cluster 16 cluster: Short SMA=98, Long SMA=116, Sharpe=-0.2209, Trades=30
[INFO] Cluster 17 cluster: Short SMA=114, Long SMA=116, Sharpe=-0.2530, Trades=61
[INFO] Cluster 18 cluster: Short SMA=108, Long SMA=260, Sharpe=-0.4614, Trades=10
[INFO] Cluster 19 cluster: Short SMA=60, Long SMA=150, Sharpe=-0.3522, Trades=19
[INFO] Cluster 20 cluster: Short SMA=16, Long SMA=28, Sharpe=0.0080, Trades=99
[INFO] Cluster 21 cluster: Short SMA=110, Long SMA=222, Sharpe=-0.4028, Trades=10
[INFO] Cluster 22 cluster: Short SMA=52, Long SMA=238, Sharpe=-0.3532, Trades=10
[INFO] Cluster 23 cluster: Short SMA=32, Long SMA=48, Sharpe=0.0838, Trades=54
[INFO] Cluster 25 cluster: Short SMA=26, Long SMA=40, Sharpe=-0.0153, Trades=68
[INFO] Cluster 26 cluster: Short SMA=78, Long SMA=102, Sharpe=-0.4326, Trades=30
[INFO] Cluster 27 cluster: Short SMA=130, Long SMA=144, Sharpe=-0.3127, Trades=25
[INFO] Cluster 28 cluster: Short SMA=42, Long SMA=192, Sharpe=-0.3176, Trades=18
[INFO] Cluster 30 cluster: Short SMA=188, Long SMA=278, Sharpe=0.0210, Trades=10
[INFO] Cluster 31 cluster: Short SMA=26, Long SMA=64, Sharpe=0.0387, Trades=44
[INFO] Cluster 32 cluster: Short SMA=162, Long SMA=164, Sharpe=-0.3585, Trades=41
[INFO] Cluster 33 cluster: Short SMA=60, Long SMA=208, Sharpe=-0.3795, Trades=16
[INFO] Cluster 34 cluster: Short SMA=30, Long SMA=106, Sharpe=-0.0417, Trades=24
[INFO] Cluster 35 cluster: Short SMA=12, Long SMA=70, Sharpe=-0.1765, Trades=54
[INFO] Cluster 36 cluster: Short SMA=52, Long SMA=288, Sharpe=-0.3902, Trades=10
[INFO] Cluster 37 cluster: Short SMA=38, Long SMA=40, Sharpe=-0.0130, Trades=126
[INFO] Cluster 38 cluster: Short SMA=16, Long SMA=98, Sharpe=0.0635, Trades=30
[INFO] Cluster 39 cluster: Short SMA=198, Long SMA=250, Sharpe=-0.0232, Trades=10
[INFO] Cluster 40 cluster: Short SMA=16, Long SMA=40, Sharpe=0.1997, Trades=72
[INFO] Cluster 41 cluster: Short SMA=14, Long SMA=156, Sharpe=-0.1001, Trades=32
[INFO] Cluster 42 cluster: Short SMA=24, Long SMA=32, Sharpe=-0.1437, Trades=92
[INFO] Cluster 43 cluster: Short SMA=144, Long SMA=222, Sharpe=-0.2769, Trades=10
[INFO] Cluster 44 cluster: Short SMA=74, Long SMA=276, Sharpe=-0.4641, Trades=10
[INFO] Cluster 45 cluster: Short SMA=128, Long SMA=172, Sharpe=-0.2895, Trades=17
[INFO] Cluster 47 cluster: Short SMA=74, Long SMA=240, Sharpe=-0.5050, Trades=10
[INFO] Cluster 48 cluster: Short SMA=84, Long SMA=138, Sharpe=-0.3194, Trades=15
[INFO] Cluster 49 cluster: Short SMA=40, Long SMA=254, Sharpe=-0.3300, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=26, Sharpe=0.4981, Trades=112
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=16, Long SMA=40, Sharpe=0.1997, Trades=72
[INFO] Top 2: Short SMA=234, Long SMA=250, Sharpe=0.1637, Trades=16
[INFO] Top 3: Short SMA=32, Long SMA=48, Sharpe=0.0838, Trades=54
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 47 valid clusters with clusters
[INFO] Filtering to 10353 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] File size: 186438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(16/40) - Original Sharpe: 0.1997, Trades: 72
[INFO] Hierarchical cluster 2: SMA(234/250) - Original Sharpe: 0.1637, Trades: 16
[INFO] Hierarchical cluster 3: SMA(32/48) - Original Sharpe: 0.0838, Trades: 54
[INFO] Hierarchical cluster 4: SMA(16/98) - Original Sharpe: 0.0635, Trades: 30
[INFO] Hierarchical cluster 5: SMA(26/64) - Original Sharpe: 0.0387, Trades: 44
[INFO] Trimmed warm-up period. Evaluation data length: 2811
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 26
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\VX
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for W in column D: 15.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 126.64s
[INFO] Best parameters: Short SMA = 48, Long SMA = 50
[INFO] Best Sharpe ratio: 0.887053, Trades: 170
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @WBS=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.86 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $387,570.00
[INFO] Market Buy & Hold P&L: $-29,470.00
[INFO] Outperformance: $417,040.00
[INFO] Sharpe ratio (entire period, annualized): 0.439905
[INFO] Sharpe ratio (in-sample, annualized): 0.887053
[INFO] Sharpe ratio (out-of-sample, annualized): -0.550168
[INFO] Maximum Drawdown: $231,315.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 108
[INFO] Out-of-sample period trades: 62
[INFO] Total trades: 170
[INFO] In-sample P&L: $528,290.00
[INFO] Out-of-sample P&L: $-147,780.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.887053
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7249 to 0.8871
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.887053
[INFO] Number of Trades: 170
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7249 to 0.8871
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.3475 to 3.5609
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 93 elements
[INFO] Kmeans Cluster 1: 251 elements
[INFO] Kmeans Cluster 2: 223 elements
[INFO] Kmeans Cluster 3: 242 elements
[INFO] Kmeans Cluster 4: 224 elements
[INFO] Kmeans Cluster 5: 234 elements
[INFO] Kmeans Cluster 6: 197 elements
[INFO] Kmeans Cluster 7: 108 elements
[INFO] Kmeans Cluster 8: 173 elements
[INFO] Kmeans Cluster 9: 261 elements
[INFO] Kmeans Cluster 10: 253 elements
[INFO] Kmeans Cluster 11: 169 elements
[INFO] Kmeans Cluster 12: 204 elements
[INFO] Kmeans Cluster 13: 290 elements
[INFO] Kmeans Cluster 14: 265 elements
[INFO] Kmeans Cluster 15: 333 elements
[INFO] Kmeans Cluster 16: 361 elements
[INFO] Kmeans Cluster 17: 121 elements
[INFO] Kmeans Cluster 18: 234 elements
[INFO] Kmeans Cluster 19: 209 elements
[INFO] Kmeans Cluster 20: 113 elements
[INFO] Kmeans Cluster 21: 327 elements
[INFO] Kmeans Cluster 22: 193 elements
[INFO] Kmeans Cluster 23: 200 elements
[INFO] Kmeans Cluster 24: 145 elements
[INFO] Kmeans Cluster 25: 238 elements
[INFO] Kmeans Cluster 26: 62 elements
[INFO] Kmeans Cluster 27: 306 elements
[INFO] Kmeans Cluster 28: 111 elements
[INFO] Kmeans Cluster 29: 225 elements
[INFO] Kmeans Cluster 30: 232 elements
[INFO] Kmeans Cluster 31: 289 elements
[INFO] Kmeans Cluster 32: 205 elements
[INFO] Kmeans Cluster 33: 274 elements
[INFO] Kmeans Cluster 34: 326 elements
[INFO] Kmeans Cluster 35: 218 elements
[INFO] Kmeans Cluster 36: 236 elements
[INFO] Kmeans Cluster 37: 141 elements
[INFO] Kmeans Cluster 38: 185 elements
[INFO] Kmeans Cluster 39: 191 elements
[INFO] Kmeans Cluster 40: 206 elements
[INFO] Kmeans Cluster 41: 180 elements
[INFO] Kmeans Cluster 42: 265 elements
[INFO] Kmeans Cluster 43: 96 elements
[INFO] Kmeans Cluster 44: 234 elements
[INFO] Kmeans Cluster 45: 113 elements
[INFO] Kmeans Cluster 46: 264 elements
[INFO] Kmeans Cluster 47: 219 elements
[INFO] Kmeans Cluster 48: 188 elements
[INFO] Kmeans Cluster 49: 158 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=30.92, Long SMA=50.15, Sharpe=0.7056
[INFO] Centroid 1: Short SMA=121.20, Long SMA=230.08, Sharpe=0.2023
[INFO] Centroid 2: Short SMA=85.95, Long SMA=167.62, Sharpe=-0.1364
[INFO] Centroid 3: Short SMA=235.60, Long SMA=266.99, Sharpe=0.0475
[INFO] Centroid 4: Short SMA=56.37, Long SMA=90.32, Sharpe=0.2626
[INFO] Centroid 5: Short SMA=62.99, Long SMA=187.23, Sharpe=0.1751
[INFO] Centroid 6: Short SMA=117.16, Long SMA=273.92, Sharpe=0.1592
[INFO] Centroid 7: Short SMA=92.31, Long SMA=122.39, Sharpe=-0.4789
[INFO] Centroid 8: Short SMA=185.29, Long SMA=263.60, Sharpe=0.3535
[INFO] Centroid 9: Short SMA=25.53, Long SMA=158.75, Sharpe=0.1252
[INFO] Centroid 10: Short SMA=32.95, Long SMA=275.26, Sharpe=0.4316
[INFO] Centroid 11: Short SMA=125.07, Long SMA=150.21, Sharpe=-0.0354
[INFO] Centroid 12: Short SMA=266.20, Long SMA=291.98, Sharpe=-0.2527
[INFO] Centroid 13: Short SMA=155.46, Long SMA=208.77, Sharpe=0.2874
[INFO] Centroid 14: Short SMA=31.48, Long SMA=250.63, Sharpe=0.2803
[INFO] Centroid 15: Short SMA=144.68, Long SMA=257.39, Sharpe=0.0547
[INFO] Centroid 16: Short SMA=221.33, Long SMA=252.93, Sharpe=0.1686
[INFO] Centroid 17: Short SMA=91.36, Long SMA=121.26, Sharpe=-0.2174
[INFO] Centroid 18: Short SMA=36.73, Long SMA=76.93, Sharpe=0.4217
[INFO] Centroid 19: Short SMA=143.61, Long SMA=288.73, Sharpe=-0.0795
[INFO] Centroid 20: Short SMA=127.21, Long SMA=157.61, Sharpe=-0.2049
[INFO] Centroid 21: Short SMA=72.70, Long SMA=224.36, Sharpe=0.2856
[INFO] Centroid 22: Short SMA=38.88, Long SMA=185.82, Sharpe=0.3157
[INFO] Centroid 23: Short SMA=116.59, Long SMA=181.48, Sharpe=0.1986
[INFO] Centroid 24: Short SMA=123.24, Long SMA=141.16, Sharpe=0.1154
[INFO] Centroid 25: Short SMA=55.89, Long SMA=145.08, Sharpe=0.0396
[INFO] Centroid 26: Short SMA=201.65, Long SMA=212.06, Sharpe=0.4952
[INFO] Centroid 27: Short SMA=74.63, Long SMA=269.21, Sharpe=0.1851
[INFO] Centroid 28: Short SMA=74.74, Long SMA=111.80, Sharpe=-0.0676
[INFO] Centroid 29: Short SMA=180.81, Long SMA=274.12, Sharpe=0.2082
[INFO] Centroid 30: Short SMA=244.91, Long SMA=284.72, Sharpe=-0.1032
[INFO] Centroid 31: Short SMA=30.93, Long SMA=133.59, Sharpe=0.2421
[INFO] Centroid 32: Short SMA=153.89, Long SMA=177.25, Sharpe=0.4030
[INFO] Centroid 33: Short SMA=173.34, Long SMA=235.93, Sharpe=0.1692
[INFO] Centroid 34: Short SMA=25.82, Long SMA=208.41, Sharpe=0.2070
[INFO] Centroid 35: Short SMA=94.91, Long SMA=289.31, Sharpe=0.0416
[INFO] Centroid 36: Short SMA=102.09, Long SMA=255.49, Sharpe=0.2736
[INFO] Centroid 37: Short SMA=66.94, Long SMA=94.92, Sharpe=0.1317
[INFO] Centroid 38: Short SMA=81.57, Long SMA=191.44, Sharpe=0.0333
[INFO] Centroid 39: Short SMA=24.75, Long SMA=55.64, Sharpe=0.5345
[INFO] Centroid 40: Short SMA=90.52, Long SMA=138.34, Sharpe=-0.3298
[INFO] Centroid 41: Short SMA=188.80, Long SMA=291.98, Sharpe=0.0282
[INFO] Centroid 42: Short SMA=37.74, Long SMA=284.66, Sharpe=0.3202
[INFO] Centroid 43: Short SMA=182.37, Long SMA=198.02, Sharpe=-0.0476
[INFO] Centroid 44: Short SMA=110.51, Long SMA=205.11, Sharpe=0.3463
[INFO] Centroid 45: Short SMA=20.90, Long SMA=38.58, Sharpe=0.3289
[INFO] Centroid 46: Short SMA=28.12, Long SMA=103.52, Sharpe=0.3498
[INFO] Centroid 47: Short SMA=44.30, Long SMA=233.76, Sharpe=0.0935
[INFO] Centroid 48: Short SMA=196.81, Long SMA=226.60, Sharpe=0.2655
[INFO] Centroid 49: Short SMA=153.09, Long SMA=201.20, Sharpe=0.1706
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8871, Trades=170
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=36, Long SMA=52, Sharpe=0.7474, Trades=64
[INFO] Kmeans Top 2: Short SMA=24, Long SMA=56, Sharpe=0.4742, Trades=59
[INFO] Kmeans Top 3: Short SMA=186, Long SMA=264, Sharpe=0.4715, Trades=16
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=76, Sharpe=0.4275, Trades=38
[INFO] Kmeans Top 5: Short SMA=38, Long SMA=186, Sharpe=0.4157, Trades=22
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (31, 50)
[INFO]   Nearest: (30.0, 50.0)
[INFO]   Rounded: (121, 230)
[INFO]   Nearest: (122.0, 230.0)
[INFO]   Rounded: (86, 168)
[INFO]   Rounded: (236, 267)
[INFO]   Nearest: (236.0, 266.0)
[INFO]   Rounded: (56, 90)
[INFO]   Rounded: (63, 187)
[INFO]   Nearest: (62.0, 188.0)
[INFO]   Rounded: (117, 274)
[INFO]   Nearest: (118.0, 274.0)
[INFO]   Rounded: (92, 122)
[INFO]   Rounded: (185, 264)
[INFO]   Nearest: (186.0, 264.0)
[INFO]   Rounded: (26, 159)
[INFO]   Nearest: (26.0, 158.0)
[INFO]   Rounded: (33, 275)
[INFO]   Nearest: (32.0, 276.0)
[INFO]   Rounded: (125, 150)
[INFO]   Nearest: (126.0, 150.0)
[INFO]   Rounded: (266, 292)
[INFO]   Rounded: (155, 209)
[INFO]   Nearest: (156.0, 208.0)
[INFO]   Rounded: (31, 251)
[INFO]   Nearest: (32.0, 250.0)
[INFO]   Rounded: (145, 257)
[INFO]   Nearest: (144.0, 258.0)
[INFO]   Rounded: (221, 253)
[INFO]   Nearest: (222.0, 252.0)
[INFO]   Rounded: (91, 121)
[INFO]   Nearest: (92.0, 122.0)
[INFO]   Rounded: (37, 77)
[INFO]   Nearest: (36.0, 76.0)
[INFO]   Rounded: (144, 289)
[INFO]   Nearest: (144.0, 288.0)
[INFO]   Rounded: (127, 158)
[INFO]   Nearest: (128.0, 158.0)
[INFO]   Rounded: (73, 224)
[INFO]   Nearest: (72.0, 224.0)
[INFO]   Rounded: (39, 186)
[INFO]   Nearest: (38.0, 186.0)
[INFO]   Rounded: (117, 181)
[INFO]   Nearest: (116.0, 182.0)
[INFO]   Rounded: (123, 141)
[INFO]   Nearest: (124.0, 142.0)
[INFO]   Rounded: (56, 145)
[INFO]   Nearest: (56.0, 146.0)
[INFO]   Rounded: (202, 212)
[INFO]   Rounded: (75, 269)
[INFO]   Nearest: (74.0, 270.0)
[INFO]   Rounded: (75, 112)
[INFO]   Nearest: (74.0, 112.0)
[INFO]   Rounded: (181, 274)
[INFO]   Nearest: (180.0, 274.0)
[INFO]   Rounded: (245, 285)
[INFO]   Nearest: (244.0, 284.0)
[INFO]   Rounded: (31, 134)
[INFO]   Nearest: (30.0, 134.0)
[INFO]   Rounded: (154, 177)
[INFO]   Nearest: (154.0, 178.0)
[INFO]   Rounded: (173, 236)
[INFO]   Nearest: (174.0, 236.0)
[INFO]   Rounded: (26, 208)
[INFO]   Rounded: (95, 289)
[INFO]   Nearest: (94.0, 290.0)
[INFO]   Rounded: (102, 255)
[INFO]   Nearest: (102.0, 256.0)
[INFO]   Rounded: (67, 95)
[INFO]   Nearest: (66.0, 94.0)
[INFO]   Rounded: (82, 191)
[INFO]   Nearest: (82.0, 192.0)
[INFO]   Rounded: (25, 56)
[INFO]   Nearest: (24.0, 56.0)
[INFO]   Rounded: (91, 138)
[INFO]   Nearest: (90.0, 138.0)
[INFO]   Rounded: (189, 292)
[INFO]   Nearest: (188.0, 292.0)
[INFO]   Rounded: (38, 285)
[INFO]   Nearest: (38.0, 284.0)
[INFO]   Rounded: (182, 198)
[INFO]   Rounded: (111, 205)
[INFO]   Nearest: (110.0, 206.0)
[INFO]   Rounded: (21, 39)
[INFO]   Nearest: (20.0, 38.0)
[INFO]   Rounded: (28, 104)
[INFO]   Rounded: (44, 234)
[INFO]   Rounded: (197, 227)
[INFO]   Nearest: (196.0, 226.0)
[INFO]   Rounded: (153, 201)
[INFO]   Nearest: (154.0, 202.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(36/52) - Original Sharpe: 0.7474, Trades: 64
[INFO] Kmeans cluster 2: SMA(24/56) - Original Sharpe: 0.4742, Trades: 59
[INFO] Kmeans cluster 3: SMA(186/264) - Original Sharpe: 0.4715, Trades: 16
[INFO] Kmeans cluster 4: SMA(36/76) - Original Sharpe: 0.4275, Trades: 38
[INFO] Kmeans cluster 5: SMA(38/186) - Original Sharpe: 0.4157, Trades: 22
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (36/52) - Sharpe: 0.7474
[INFO] cluster 2: (24/56) - Sharpe: 0.4742
[INFO] cluster 3: (186/264) - Sharpe: 0.4715
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.967409            1.921594
1    2021-11-14 2021-11-14            44    -3.438860           -3.191889
2    2022-01-14 2022-01-14            41     1.436141            2.952102
3    2022-03-14 2022-03-14            44    -2.274052            0.026981
4    2022-05-14 2022-05-14            43    -2.489614           -1.242437
5    2022-07-14 2022-07-14            44     1.425601            1.637139
6    2022-09-14 2022-09-14            43     0.424917            0.675576
7    2022-11-14 2022-11-14            43    -1.042455           -3.875748
8    2023-01-14 2023-01-14            41     3.089660            1.162559
9    2023-03-14 2023-03-14            43    -2.849337           -0.712422
10   2023-05-14 2023-05-14            44    -0.357970           -2.465543
11   2023-07-14 2023-07-14            44     5.884227            4.792430
12   2023-09-14 2023-09-14            43    -1.305448           -1.370936
13   2023-11-14 2023-11-14            42     1.296328            2.777300
14   2024-01-14 2024-01-14            43    -0.582105            2.662396
15   2024-03-14 2024-03-14            42     0.280722            0.280722
16   2024-05-14 2024-05-14            44    -5.328325           -2.230316
17   2024-07-14 2024-07-14            45     0.233819            0.825915
18   2024-09-14 2024-09-14            43    -1.778911           -0.738841
19   2024-11-14 2024-11-14            33    -0.446965           -1.155271
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              1.9 |          3.9 | True          
[INFO] 2021-11-14   |         -3.4 |             -3.2 |          0.2 | True          
[INFO] 2022-01-14   |          1.4 |              3.0 |          1.6 | True          
[INFO] 2022-03-14   |         -2.3 |              0.0 |          2.3 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.2 |          1.3 | True          
[INFO] 2022-07-14   |          1.4 |              1.6 |          0.2 | True          
[INFO] 2022-09-14   |          0.4 |              0.7 |          0.3 | True          
[INFO] 2022-11-14   |         -1.0 |             -3.9 |         -2.9 | False         
[INFO] 2023-01-14   |          3.1 |              1.2 |         -1.9 | False         
[INFO] 2023-03-14   |         -2.8 |             -0.7 |          2.1 | True          
[INFO] 2023-05-14   |         -0.4 |             -2.5 |         -2.1 | False         
[INFO] 2023-07-14   |          5.9 |              4.8 |         -1.1 | False         
[INFO] 2023-09-14   |         -1.3 |             -1.4 |         -0.1 | False         
[INFO] 2023-11-14   |          1.3 |              2.8 |          1.5 | True          
[INFO] 2024-01-14   |         -0.6 |              2.7 |          3.3 | True          
[INFO] 2024-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -2.2 |          3.1 | True          
[INFO] 2024-07-14   |          0.2 |              0.8 |          0.6 | True          
[INFO] 2024-09-14   |         -1.8 |             -0.7 |          1.1 | True          
[INFO] 2024-11-14   |         -0.4 |             -1.2 |         -0.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 13 of 19 periods (68.42% win rate)
[INFO] Updating Excel file with Kmeans results for W...
[INFO] Excel file updated successfully. Added W with Kmeans win rate 68.4% in row 54
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(36/52) - Original Sharpe: 0.7474
[INFO] Added cluster 2 to portfolio: SMA(24/56) - Original Sharpe: 0.4742
[INFO] Added cluster 3 to portfolio: SMA(186/264) - Original Sharpe: 0.4715
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'W_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0798
[INFO] Kmeans Best out-of-sample Sharpe: -0.5502
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for W...
[INFO] Excel file updated successfully. Added W with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\W
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7249 to 0.8871
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.887053
[INFO] Number of Trades: 170
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7249 to 0.8871
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.3475 to 3.5609
[INFO] Scaled Trades range: -0.7942 to 16.0301
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5985
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 167 elements
[INFO] Cluster 1: 89 elements
[INFO] Cluster 2: 42 elements
[INFO] Cluster 3: 591 elements
[INFO] Cluster 4: 285 elements
[INFO] Cluster 5: 215 elements
[INFO] Cluster 6: 105 elements
[INFO] Cluster 7: 561 elements
[INFO] Cluster 8: 521 elements
[INFO] Cluster 9: 395 elements
[INFO] Cluster 10: 435 elements
[INFO] Cluster 11: 74 elements
[INFO] Cluster 12: 99 elements
[INFO] Cluster 13: 296 elements
[INFO] Cluster 14: 43 elements
[INFO] Cluster 15: 246 elements
[INFO] Cluster 16: 431 elements
[INFO] Cluster 17: 392 elements
[INFO] Cluster 18: 188 elements
[INFO] Cluster 19: 289 elements
[INFO] Cluster 20: 335 elements
[INFO] Cluster 21: 305 elements
[INFO] Cluster 22: 111 elements
[INFO] Cluster 23: 240 elements
[INFO] Cluster 24: 130 elements
[INFO] Cluster 25: 7 elements
[INFO] Cluster 26: 161 elements
[INFO] Cluster 27: 187 elements
[INFO] Cluster 28: 518 elements
[INFO] Cluster 29: 194 elements
[INFO] Cluster 30: 197 elements
[INFO] Cluster 31: 157 elements
[INFO] Cluster 32: 42 elements
[INFO] Cluster 33: 12 elements
[INFO] Cluster 34: 65 elements
[INFO] Cluster 35: 61 elements
[INFO] Cluster 36: 72 elements
[INFO] Cluster 37: 135 elements
[INFO] Cluster 38: 125 elements
[INFO] Cluster 39: 115 elements
[INFO] Cluster 40: 178 elements
[INFO] Cluster 41: 229 elements
[INFO] Cluster 42: 301 elements
[INFO] Cluster 43: 222 elements
[INFO] Cluster 44: 20 elements
[INFO] Cluster 45: 278 elements
[INFO] Cluster 46: 95 elements
[INFO] Cluster 47: 194 elements
[INFO] Cluster 48: 293 elements
[INFO] Cluster 49: 142 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=70, Long SMA=88, Sharpe=0.2531, Trades=47
[INFO] Cluster 1 cluster: Short SMA=198, Long SMA=204, Sharpe=0.4514, Trades=45
[INFO] Cluster 2 cluster: Short SMA=28, Long SMA=32, Sharpe=0.3654, Trades=132
[INFO] Cluster 3 cluster: Short SMA=90, Long SMA=266, Sharpe=0.1555, Trades=15
[INFO] Cluster 4 cluster: Short SMA=88, Long SMA=136, Sharpe=-0.3660, Trades=22
[INFO] Cluster 5 cluster: Short SMA=32, Long SMA=62, Sharpe=0.4990, Trades=56
[INFO] Cluster 6 cluster: Short SMA=148, Long SMA=154, Sharpe=-0.0178, Trades=58
[INFO] Cluster 7 cluster: Short SMA=182, Long SMA=256, Sharpe=0.2540, Trades=17
[INFO] Cluster 8 cluster: Short SMA=36, Long SMA=280, Sharpe=0.3306, Trades=16
[INFO] Cluster 9 cluster: Short SMA=132, Long SMA=224, Sharpe=0.2314, Trades=19
[INFO] Cluster 10 cluster: Short SMA=138, Long SMA=262, Sharpe=-0.0165, Trades=17
[INFO] Cluster 11 cluster: Short SMA=278, Long SMA=282, Sharpe=-0.2191, Trades=49
[INFO] Cluster 12 cluster: Short SMA=240, Long SMA=246, Sharpe=0.1933, Trades=42
[INFO] Cluster 13 cluster: Short SMA=30, Long SMA=106, Sharpe=0.3052, Trades=32
[INFO] Cluster 14 cluster: Short SMA=102, Long SMA=106, Sharpe=-0.3177, Trades=76
[INFO] Cluster 15 cluster: Short SMA=194, Long SMA=292, Sharpe=0.0495, Trades=15
[INFO] Cluster 16 cluster: Short SMA=226, Long SMA=260, Sharpe=0.1323, Trades=20
[INFO] Cluster 17 cluster: Short SMA=158, Long SMA=214, Sharpe=0.3615, Trades=17
[INFO] Cluster 18 cluster: Short SMA=124, Long SMA=156, Sharpe=-0.0645, Trades=29
[INFO] Cluster 19 cluster: Short SMA=36, Long SMA=226, Sharpe=0.1312, Trades=20
[INFO] Cluster 20 cluster: Short SMA=48, Long SMA=176, Sharpe=0.1779, Trades=20
[INFO] Cluster 21 cluster: Short SMA=62, Long SMA=136, Sharpe=0.0368, Trades=22
[INFO] Cluster 22 cluster: Short SMA=124, Long SMA=140, Sharpe=0.1168, Trades=37
[INFO] Cluster 23 cluster: Short SMA=22, Long SMA=86, Sharpe=0.4070, Trades=39
[INFO] Cluster 24 cluster: Short SMA=20, Long SMA=38, Sharpe=0.4185, Trades=78
[INFO] Cluster 26 cluster: Short SMA=236, Long SMA=286, Sharpe=-0.0726, Trades=19
[INFO] Cluster 27 cluster: Short SMA=112, Long SMA=202, Sharpe=0.3418, Trades=19
[INFO] Cluster 28 cluster: Short SMA=58, Long SMA=220, Sharpe=0.2035, Trades=18
[INFO] Cluster 29 cluster: Short SMA=154, Long SMA=178, Sharpe=0.3073, Trades=25
[INFO] Cluster 30 cluster: Short SMA=90, Long SMA=292, Sharpe=-0.0155, Trades=16
[INFO] Cluster 31 cluster: Short SMA=14, Long SMA=196, Sharpe=0.2707, Trades=34
[INFO] Cluster 32 cluster: Short SMA=64, Long SMA=66, Sharpe=0.3812, Trades=127
[INFO] Cluster 34 cluster: Short SMA=182, Long SMA=202, Sharpe=-0.0786, Trades=25
[INFO] Cluster 35 cluster: Short SMA=38, Long SMA=52, Sharpe=0.6611, Trades=70
[INFO] Cluster 36 cluster: Short SMA=96, Long SMA=110, Sharpe=-0.2382, Trades=40
[INFO] Cluster 37 cluster: Short SMA=146, Long SMA=292, Sharpe=-0.0538, Trades=14
[INFO] Cluster 38 cluster: Short SMA=86, Long SMA=196, Sharpe=-0.0587, Trades=19
[INFO] Cluster 39 cluster: Short SMA=186, Long SMA=266, Sharpe=0.3846, Trades=16
[INFO] Cluster 40 cluster: Short SMA=22, Long SMA=250, Sharpe=0.1943, Trades=24
[INFO] Cluster 41 cluster: Short SMA=116, Long SMA=180, Sharpe=0.1281, Trades=19
[INFO] Cluster 42 cluster: Short SMA=86, Long SMA=160, Sharpe=-0.0821, Trades=21
[INFO] Cluster 43 cluster: Short SMA=24, Long SMA=152, Sharpe=0.0782, Trades=28
[INFO] Cluster 44 cluster: Short SMA=138, Long SMA=140, Sharpe=0.1136, Trades=87
[INFO] Cluster 45 cluster: Short SMA=94, Long SMA=234, Sharpe=0.2197, Trades=13
[INFO] Cluster 46 cluster: Short SMA=38, Long SMA=180, Sharpe=0.3800, Trades=22
[INFO] Cluster 47 cluster: Short SMA=264, Long SMA=292, Sharpe=-0.2126, Trades=23
[INFO] Cluster 48 cluster: Short SMA=46, Long SMA=120, Sharpe=0.2232, Trades=22
[INFO] Cluster 49 cluster: Short SMA=196, Long SMA=222, Sharpe=0.2998, Trades=25
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8871, Trades=170
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=52, Sharpe=0.6611, Trades=70
[INFO] Top 2: Short SMA=32, Long SMA=62, Sharpe=0.4990, Trades=56
[INFO] Top 3: Short SMA=198, Long SMA=204, Sharpe=0.4514, Trades=45
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10566 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/52) - Original Sharpe: 0.6611, Trades: 70
[INFO] Hierarchical cluster 2: SMA(32/62) - Original Sharpe: 0.4990, Trades: 56
[INFO] Hierarchical cluster 3: SMA(198/204) - Original Sharpe: 0.4514, Trades: 45
[INFO] Hierarchical cluster 4: SMA(20/38) - Original Sharpe: 0.4185, Trades: 78
[INFO] Hierarchical cluster 5: SMA(22/86) - Original Sharpe: 0.4070, Trades: 39
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/52) - Sharpe: 0.6611
[INFO] cluster 2: (32/62) - Sharpe: 0.4990
[INFO] cluster 3: (198/204) - Sharpe: 0.4514
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.967409            0.939467
1    2021-11-14 2021-11-14            44    -3.438860           -2.440223
2    2022-01-14 2022-01-14            41     1.436141            2.920840
3    2022-03-14 2022-03-14            44    -2.274052            0.026981
4    2022-05-14 2022-05-14            43    -2.489614           -1.288618
5    2022-07-14 2022-07-14            44     1.425601            1.404730
6    2022-09-14 2022-09-14            43     0.424917            1.489596
7    2022-11-14 2022-11-14            43    -1.042455           -4.560456
8    2023-01-14 2023-01-14            41     3.089660            2.787021
9    2023-03-14 2023-03-14            43    -2.849337            0.559362
10   2023-05-14 2023-05-14            44    -0.357970           -1.761277
11   2023-07-14 2023-07-14            44     5.884227            1.361783
12   2023-09-14 2023-09-14            43    -1.305448           -0.571550
13   2023-11-14 2023-11-14            42     1.296328            2.469072
14   2024-01-14 2024-01-14            43    -0.582105           -0.032573
15   2024-03-14 2024-03-14            42     0.280722            0.280722
16   2024-05-14 2024-05-14            44    -5.328325           -1.465193
17   2024-07-14 2024-07-14            45     0.233819           -0.836219
18   2024-09-14 2024-09-14            43    -1.778911           -3.070610
19   2024-11-14 2024-11-14            33    -0.446965           -1.631488
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              0.9 |          2.9 | True          
[INFO] 2021-11-14   |         -3.4 |             -2.4 |          1.0 | True          
[INFO] 2022-01-14   |          1.4 |              2.9 |          1.5 | True          
[INFO] 2022-03-14   |         -2.3 |              0.0 |          2.3 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.3 |          1.2 | True          
[INFO] 2022-07-14   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.4 |              1.5 |          1.1 | True          
[INFO] 2022-11-14   |         -1.0 |             -4.6 |         -3.6 | False         
[INFO] 2023-01-14   |          3.1 |              2.8 |         -0.3 | False         
[INFO] 2023-03-14   |         -2.8 |              0.6 |          3.4 | True          
[INFO] 2023-05-14   |         -0.4 |             -1.8 |         -1.4 | False         
[INFO] 2023-07-14   |          5.9 |              1.4 |         -4.5 | False         
[INFO] 2023-09-14   |         -1.3 |             -0.6 |          0.7 | True          
[INFO] 2023-11-14   |          1.3 |              2.5 |          1.2 | True          
[INFO] 2024-01-14   |         -0.6 |             -0.0 |          0.6 | True          
[INFO] 2024-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -1.5 |          3.8 | True          
[INFO] 2024-07-14   |          0.2 |             -0.8 |         -1.0 | False         
[INFO] 2024-09-14   |         -1.8 |             -3.1 |         -1.3 | False         
[INFO] 2024-11-14   |         -0.4 |             -1.6 |         -1.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 18 periods (61.11% win rate)
[INFO] Updating Excel file with Hierarchical results for W...
[INFO] Excel file updated successfully. Added W with Hierarchical win rate 61.1% in row 54
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/52) - Original Sharpe: 0.6611
[INFO] Added cluster 2 to portfolio: SMA(32/62) - Original Sharpe: 0.4990
[INFO] Added cluster 3 to portfolio: SMA(198/204) - Original Sharpe: 0.4514
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'W_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1479
[INFO] Hierarchical Best out-of-sample Sharpe: -0.5502
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for W...
[INFO] Excel file updated successfully. Added W with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\W
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for WBS in column D: 17.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] Starting brute-force optimization with SMAStrategy.optimize()...
[INFO] Optimization completed in 151.80s
[INFO] Best parameters: Short SMA = 48, Long SMA = 50
[INFO] Best Sharpe ratio: 0.885528, Trades: 170
[INFO] Saved optimization results to optimized_strategies.pkl
[INFO] Visualization completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @WBS=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.86 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $386,182.00
[INFO] Market Buy & Hold P&L: $-29,470.00
[INFO] Outperformance: $415,652.00
[INFO] Sharpe ratio (entire period, annualized): 0.438437
[INFO] Sharpe ratio (in-sample, annualized): 0.885528
[INFO] Sharpe ratio (out-of-sample, annualized): -0.551536
[INFO] Maximum Drawdown: $231,617.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 108
[INFO] Out-of-sample period trades: 62
[INFO] Total trades: 170
[INFO] In-sample P&L: $527,382.00
[INFO] Out-of-sample P&L: $-148,144.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.885528
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 10585
[INFO] Cache hits (repeated combinations): 0
[INFO] Total checks: 10585
[INFO] Cache hit rate: 0.00%
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7259 to 0.8855
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.885528
[INFO] Number of Trades: 170
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7259 to 0.8855
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.3515 to 3.5551
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] Performing Kmeans clustering with k=50...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 153 elements
[INFO] Kmeans Cluster 1: 227 elements
[INFO] Kmeans Cluster 2: 247 elements
[INFO] Kmeans Cluster 3: 338 elements
[INFO] Kmeans Cluster 4: 101 elements
[INFO] Kmeans Cluster 5: 130 elements
[INFO] Kmeans Cluster 6: 271 elements
[INFO] Kmeans Cluster 7: 215 elements
[INFO] Kmeans Cluster 8: 163 elements
[INFO] Kmeans Cluster 9: 210 elements
[INFO] Kmeans Cluster 10: 208 elements
[INFO] Kmeans Cluster 11: 205 elements
[INFO] Kmeans Cluster 12: 101 elements
[INFO] Kmeans Cluster 13: 124 elements
[INFO] Kmeans Cluster 14: 215 elements
[INFO] Kmeans Cluster 15: 333 elements
[INFO] Kmeans Cluster 16: 194 elements
[INFO] Kmeans Cluster 17: 234 elements
[INFO] Kmeans Cluster 18: 190 elements
[INFO] Kmeans Cluster 19: 184 elements
[INFO] Kmeans Cluster 20: 323 elements
[INFO] Kmeans Cluster 21: 201 elements
[INFO] Kmeans Cluster 22: 75 elements
[INFO] Kmeans Cluster 23: 276 elements
[INFO] Kmeans Cluster 24: 191 elements
[INFO] Kmeans Cluster 25: 141 elements
[INFO] Kmeans Cluster 26: 168 elements
[INFO] Kmeans Cluster 27: 247 elements
[INFO] Kmeans Cluster 28: 262 elements
[INFO] Kmeans Cluster 29: 316 elements
[INFO] Kmeans Cluster 30: 206 elements
[INFO] Kmeans Cluster 31: 208 elements
[INFO] Kmeans Cluster 32: 248 elements
[INFO] Kmeans Cluster 33: 234 elements
[INFO] Kmeans Cluster 34: 179 elements
[INFO] Kmeans Cluster 35: 252 elements
[INFO] Kmeans Cluster 36: 249 elements
[INFO] Kmeans Cluster 37: 194 elements
[INFO] Kmeans Cluster 38: 99 elements
[INFO] Kmeans Cluster 39: 309 elements
[INFO] Kmeans Cluster 40: 254 elements
[INFO] Kmeans Cluster 41: 239 elements
[INFO] Kmeans Cluster 42: 317 elements
[INFO] Kmeans Cluster 43: 178 elements
[INFO] Kmeans Cluster 44: 215 elements
[INFO] Kmeans Cluster 45: 287 elements
[INFO] Kmeans Cluster 46: 195 elements
[INFO] Kmeans Cluster 47: 213 elements
[INFO] Kmeans Cluster 48: 95 elements
[INFO] Kmeans Cluster 49: 171 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=92.48, Long SMA=123.15, Sharpe=-0.4506
[INFO] Centroid 1: Short SMA=50.85, Long SMA=151.17, Sharpe=0.0455
[INFO] Centroid 2: Short SMA=101.89, Long SMA=254.62, Sharpe=0.2726
[INFO] Centroid 3: Short SMA=162.11, Long SMA=209.82, Sharpe=0.2786
[INFO] Centroid 4: Short SMA=20.71, Long SMA=37.43, Sharpe=0.3199
[INFO] Centroid 5: Short SMA=215.20, Long SMA=293.22, Sharpe=-0.0740
[INFO] Centroid 6: Short SMA=33.16, Long SMA=253.07, Sharpe=0.2930
[INFO] Centroid 7: Short SMA=85.54, Long SMA=168.32, Sharpe=-0.1291
[INFO] Centroid 8: Short SMA=186.81, Long SMA=289.59, Sharpe=0.0602
[INFO] Centroid 9: Short SMA=152.94, Long SMA=177.52, Sharpe=0.3926
[INFO] Centroid 10: Short SMA=96.42, Long SMA=290.20, Sharpe=0.0342
[INFO] Centroid 11: Short SMA=38.06, Long SMA=186.91, Sharpe=0.3108
[INFO] Centroid 12: Short SMA=30.51, Long SMA=50.44, Sharpe=0.6978
[INFO] Centroid 13: Short SMA=89.16, Long SMA=114.74, Sharpe=-0.1950
[INFO] Centroid 14: Short SMA=258.57, Long SMA=287.25, Sharpe=-0.1688
[INFO] Centroid 15: Short SMA=144.62, Long SMA=257.06, Sharpe=0.0513
[INFO] Centroid 16: Short SMA=67.24, Long SMA=93.10, Sharpe=0.1802
[INFO] Centroid 17: Short SMA=62.87, Long SMA=187.62, Sharpe=0.1761
[INFO] Centroid 18: Short SMA=45.53, Long SMA=234.01, Sharpe=0.0819
[INFO] Centroid 19: Short SMA=123.91, Long SMA=142.67, Sharpe=0.0933
[INFO] Centroid 20: Short SMA=225.00, Long SMA=255.77, Sharpe=0.1323
[INFO] Centroid 21: Short SMA=25.17, Long SMA=56.16, Sharpe=0.5245
[INFO] Centroid 22: Short SMA=197.95, Long SMA=208.59, Sharpe=0.4892
[INFO] Centroid 23: Short SMA=174.64, Long SMA=229.27, Sharpe=0.1648
[INFO] Centroid 24: Short SMA=126.88, Long SMA=152.44, Sharpe=-0.0915
[INFO] Centroid 25: Short SMA=69.38, Long SMA=113.96, Sharpe=-0.0180
[INFO] Centroid 26: Short SMA=21.86, Long SMA=101.00, Sharpe=0.4019
[INFO] Centroid 27: Short SMA=209.91, Long SMA=240.95, Sharpe=0.2370
[INFO] Centroid 28: Short SMA=123.85, Long SMA=184.66, Sharpe=0.1869
[INFO] Centroid 29: Short SMA=73.65, Long SMA=223.79, Sharpe=0.2873
[INFO] Centroid 30: Short SMA=116.38, Long SMA=274.04, Sharpe=0.1568
[INFO] Centroid 31: Short SMA=28.84, Long SMA=133.05, Sharpe=0.2838
[INFO] Centroid 32: Short SMA=96.28, Long SMA=146.60, Sharpe=-0.2913
[INFO] Centroid 33: Short SMA=178.36, Long SMA=270.93, Sharpe=0.2093
[INFO] Centroid 34: Short SMA=82.40, Long SMA=191.18, Sharpe=0.0346
[INFO] Centroid 35: Short SMA=33.26, Long SMA=275.40, Sharpe=0.4317
[INFO] Centroid 36: Short SMA=112.12, Long SMA=203.90, Sharpe=0.3422
[INFO] Centroid 37: Short SMA=143.76, Long SMA=289.54, Sharpe=-0.0785
[INFO] Centroid 38: Short SMA=271.39, Long SMA=294.00, Sharpe=-0.3045
[INFO] Centroid 39: Short SMA=28.31, Long SMA=218.29, Sharpe=0.2076
[INFO] Centroid 40: Short SMA=43.78, Long SMA=91.47, Sharpe=0.2968
[INFO] Centroid 41: Short SMA=37.32, Long SMA=287.05, Sharpe=0.3177
[INFO] Centroid 42: Short SMA=74.78, Long SMA=269.07, Sharpe=0.1820
[INFO] Centroid 43: Short SMA=41.37, Long SMA=72.55, Sharpe=0.4076
[INFO] Centroid 44: Short SMA=33.03, Long SMA=134.55, Sharpe=0.1684
[INFO] Centroid 45: Short SMA=125.51, Long SMA=229.21, Sharpe=0.1989
[INFO] Centroid 46: Short SMA=242.34, Long SMA=270.11, Sharpe=0.0100
[INFO] Centroid 47: Short SMA=22.45, Long SMA=174.98, Sharpe=0.1482
[INFO] Centroid 48: Short SMA=182.27, Long SMA=197.98, Sharpe=-0.0493
[INFO] Centroid 49: Short SMA=185.23, Long SMA=263.34, Sharpe=0.3541
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8855, Trades=170
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=36, Long SMA=52, Sharpe=0.7468, Trades=64
[INFO] Kmeans Top 2: Short SMA=200, Long SMA=212, Sharpe=0.4895, Trades=31
[INFO] Kmeans Top 3: Short SMA=24, Long SMA=56, Sharpe=0.4737, Trades=59
[INFO] Kmeans Top 4: Short SMA=186, Long SMA=264, Sharpe=0.4713, Trades=16
[INFO] Kmeans Top 5: Short SMA=20, Long SMA=100, Sharpe=0.4174, Trades=36
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49}
[INFO]   Rounded: (92, 123)
[INFO]   Nearest: (92.0, 124.0)
[INFO]   Rounded: (51, 151)
[INFO]   Nearest: (50.0, 152.0)
[INFO]   Rounded: (102, 255)
[INFO]   Nearest: (102.0, 254.0)
[INFO]   Rounded: (162, 210)
[INFO]   Rounded: (21, 37)
[INFO]   Nearest: (20.0, 38.0)
[INFO]   Rounded: (215, 293)
[INFO]   Nearest: (216.0, 294.0)
[INFO]   Rounded: (33, 253)
[INFO]   Nearest: (34.0, 254.0)
[INFO]   Rounded: (86, 168)
[INFO]   Rounded: (187, 290)
[INFO]   Nearest: (186.0, 290.0)
[INFO]   Rounded: (153, 178)
[INFO]   Nearest: (152.0, 178.0)
[INFO]   Rounded: (96, 290)
[INFO]   Rounded: (38, 187)
[INFO]   Nearest: (38.0, 186.0)
[INFO]   Rounded: (31, 50)
[INFO]   Nearest: (30.0, 50.0)
[INFO]   Rounded: (89, 115)
[INFO]   Nearest: (90.0, 114.0)
[INFO]   Rounded: (259, 287)
[INFO]   Nearest: (258.0, 288.0)
[INFO]   Rounded: (145, 257)
[INFO]   Nearest: (144.0, 258.0)
[INFO]   Rounded: (67, 93)
[INFO]   Nearest: (68.0, 94.0)
[INFO]   Rounded: (63, 188)
[INFO]   Nearest: (62.0, 188.0)
[INFO]   Rounded: (46, 234)
[INFO]   Rounded: (124, 143)
[INFO]   Nearest: (124.0, 142.0)
[INFO]   Rounded: (225, 256)
[INFO]   Nearest: (224.0, 256.0)
[INFO]   Rounded: (25, 56)
[INFO]   Nearest: (26.0, 56.0)
[INFO]   Rounded: (198, 209)
[INFO]   Nearest: (198.0, 208.0)
[INFO]   Rounded: (175, 229)
[INFO]   Nearest: (174.0, 230.0)
[INFO]   Rounded: (127, 152)
[INFO]   Nearest: (126.0, 152.0)
[INFO]   Rounded: (69, 114)
[INFO]   Nearest: (70.0, 114.0)
[INFO]   Rounded: (22, 101)
[INFO]   Nearest: (22.0, 100.0)
[INFO]   Rounded: (210, 241)
[INFO]   Nearest: (210.0, 240.0)
[INFO]   Rounded: (124, 185)
[INFO]   Nearest: (124.0, 184.0)
[INFO]   Rounded: (74, 224)
[INFO]   Rounded: (116, 274)
[INFO]   Rounded: (29, 133)
[INFO]   Nearest: (28.0, 134.0)
[INFO]   Rounded: (96, 147)
[INFO]   Nearest: (96.0, 146.0)
[INFO]   Rounded: (178, 271)
[INFO]   Nearest: (178.0, 270.0)
[INFO]   Rounded: (82, 191)
[INFO]   Nearest: (82.0, 192.0)
[INFO]   Rounded: (33, 275)
[INFO]   Nearest: (34.0, 276.0)
[INFO]   Rounded: (112, 204)
[INFO]   Rounded: (144, 290)
[INFO]   Rounded: (271, 294)
[INFO]   Nearest: (272.0, 294.0)
[INFO]   Rounded: (28, 218)
[INFO]   Rounded: (44, 91)
[INFO]   Nearest: (44.0, 92.0)
[INFO]   Rounded: (37, 287)
[INFO]   Nearest: (38.0, 288.0)
[INFO]   Rounded: (75, 269)
[INFO]   Nearest: (74.0, 270.0)
[INFO]   Rounded: (41, 73)
[INFO]   Nearest: (42.0, 72.0)
[INFO]   Rounded: (33, 135)
[INFO]   Nearest: (34.0, 134.0)
[INFO]   Rounded: (126, 229)
[INFO]   Nearest: (126.0, 230.0)
[INFO]   Rounded: (242, 270)
[INFO]   Rounded: (22, 175)
[INFO]   Nearest: (22.0, 174.0)
[INFO]   Rounded: (182, 198)
[INFO]   Rounded: (185, 263)
[INFO]   Nearest: (186.0, 264.0)
[INFO] Successfully plotted 50 out of 50 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(36/52) - Original Sharpe: 0.7468, Trades: 64
[INFO] Kmeans cluster 2: SMA(200/212) - Original Sharpe: 0.4895, Trades: 31
[INFO] Kmeans cluster 3: SMA(24/56) - Original Sharpe: 0.4737, Trades: 59
[INFO] Kmeans cluster 4: SMA(186/264) - Original Sharpe: 0.4713, Trades: 16
[INFO] Kmeans cluster 5: SMA(20/100) - Original Sharpe: 0.4174, Trades: 36
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (36/52) - Sharpe: 0.7468
[INFO] cluster 2: (200/212) - Sharpe: 0.4895
[INFO] cluster 3: (24/56) - Sharpe: 0.4737
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.969108            1.921092
1    2021-11-14 2021-11-14            44    -3.439143           -3.192071
2    2022-01-14 2022-01-14            41     1.435275            2.951889
3    2022-03-14 2022-03-14            44    -2.274282            0.026893
4    2022-05-14 2022-05-14            43    -2.490349           -1.242601
5    2022-07-14 2022-07-14            44     1.424645            1.636790
6    2022-09-14 2022-09-14            43     0.423005            0.674981
7    2022-11-14 2022-11-14            43    -1.044126           -3.501068
8    2023-01-14 2023-01-14            41     3.087546            1.648521
9    2023-03-14 2023-03-14            43    -2.851713           -0.712745
10   2023-05-14 2023-05-14            44    -0.359960           -2.465965
11   2023-07-14 2023-07-14            44     5.881769            4.791655
12   2023-09-14 2023-09-14            43    -1.305448           -1.655906
13   2023-11-14 2023-11-14            42     1.295824            2.161762
14   2024-01-14 2024-01-14            43    -0.582717            2.508098
15   2024-03-14 2024-03-14            42     0.280722            0.280722
16   2024-05-14 2024-05-14            44    -5.331792           -3.044827
17   2024-07-14 2024-07-14            45     0.232453           -0.804025
18   2024-09-14 2024-09-14            43    -1.780293           -0.336566
19   2024-11-14 2024-11-14            33    -0.454091           -2.892900
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              1.9 |          3.9 | True          
[INFO] 2021-11-14   |         -3.4 |             -3.2 |          0.2 | True          
[INFO] 2022-01-14   |          1.4 |              3.0 |          1.6 | True          
[INFO] 2022-03-14   |         -2.3 |              0.0 |          2.3 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.2 |          1.3 | True          
[INFO] 2022-07-14   |          1.4 |              1.6 |          0.2 | True          
[INFO] 2022-09-14   |          0.4 |              0.7 |          0.3 | True          
[INFO] 2022-11-14   |         -1.0 |             -3.5 |         -2.5 | False         
[INFO] 2023-01-14   |          3.1 |              1.6 |         -1.5 | False         
[INFO] 2023-03-14   |         -2.9 |             -0.7 |          2.2 | True          
[INFO] 2023-05-14   |         -0.4 |             -2.5 |         -2.1 | False         
[INFO] 2023-07-14   |          5.9 |              4.8 |         -1.1 | False         
[INFO] 2023-09-14   |         -1.3 |             -1.7 |         -0.4 | False         
[INFO] 2023-11-14   |          1.3 |              2.2 |          0.9 | True          
[INFO] 2024-01-14   |         -0.6 |              2.5 |          3.1 | True          
[INFO] 2024-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -3.0 |          2.3 | True          
[INFO] 2024-07-14   |          0.2 |             -0.8 |         -1.0 | False         
[INFO] 2024-09-14   |         -1.8 |             -0.3 |          1.5 | True          
[INFO] 2024-11-14   |         -0.5 |             -2.9 |         -2.4 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 12 of 19 periods (63.16% win rate)
[INFO] Updating Excel file with Kmeans results for WBS...
[INFO] Excel file updated successfully. Added WBS with Kmeans win rate 63.2% in row 55
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(36/52) - Original Sharpe: 0.7468
[INFO] Added cluster 2 to portfolio: SMA(200/212) - Original Sharpe: 0.4895
[INFO] Added cluster 3 to portfolio: SMA(24/56) - Original Sharpe: 0.4737
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'WBS_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1315
[INFO] Kmeans Best out-of-sample Sharpe: -0.5515
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for WBS...
[INFO] Excel file updated successfully. Added WBS with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\WBS
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 10585 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7259 to 0.8855
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.885528
[INFO] Number of Trades: 170
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 10585 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7259 to 0.8855
[INFO] Trades range: 11.0 to 321.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3997 to 2.7994
[INFO] Scaled Long SMA range: -2.7994 to 1.3997
[INFO] Scaled Sharpe ratio range: -4.3515 to 3.5551
[INFO] Scaled Trades range: -0.7942 to 16.0301
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 10585 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5985
[INFO] Performing hierarchical clustering with 50 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 131 elements
[INFO] Cluster 1: 561 elements
[INFO] Cluster 2: 285 elements
[INFO] Cluster 3: 329 elements
[INFO] Cluster 4: 521 elements
[INFO] Cluster 5: 42 elements
[INFO] Cluster 6: 358 elements
[INFO] Cluster 7: 188 elements
[INFO] Cluster 8: 43 elements
[INFO] Cluster 9: 246 elements
[INFO] Cluster 10: 302 elements
[INFO] Cluster 11: 145 elements
[INFO] Cluster 12: 594 elements
[INFO] Cluster 13: 296 elements
[INFO] Cluster 14: 105 elements
[INFO] Cluster 15: 42 elements
[INFO] Cluster 16: 518 elements
[INFO] Cluster 17: 161 elements
[INFO] Cluster 18: 74 elements
[INFO] Cluster 19: 71 elements
[INFO] Cluster 20: 301 elements
[INFO] Cluster 21: 431 elements
[INFO] Cluster 22: 142 elements
[INFO] Cluster 23: 305 elements
[INFO] Cluster 24: 100 elements
[INFO] Cluster 25: 99 elements
[INFO] Cluster 26: 335 elements
[INFO] Cluster 27: 289 elements
[INFO] Cluster 28: 435 elements
[INFO] Cluster 29: 111 elements
[INFO] Cluster 30: 157 elements
[INFO] Cluster 31: 197 elements
[INFO] Cluster 32: 7 elements
[INFO] Cluster 33: 12 elements
[INFO] Cluster 34: 441 elements
[INFO] Cluster 35: 65 elements
[INFO] Cluster 36: 72 elements
[INFO] Cluster 37: 135 elements
[INFO] Cluster 38: 125 elements
[INFO] Cluster 39: 178 elements
[INFO] Cluster 40: 128 elements
[INFO] Cluster 41: 224 elements
[INFO] Cluster 42: 222 elements
[INFO] Cluster 43: 115 elements
[INFO] Cluster 44: 20 elements
[INFO] Cluster 45: 278 elements
[INFO] Cluster 46: 95 elements
[INFO] Cluster 47: 194 elements
[INFO] Cluster 48: 293 elements
[INFO] Cluster 49: 67 elements
[INFO] Using 48 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=176, Long SMA=184, Sharpe=0.3371, Trades=47
[INFO] Cluster 1 cluster: Short SMA=182, Long SMA=256, Sharpe=0.2538, Trades=17
[INFO] Cluster 2 cluster: Short SMA=88, Long SMA=136, Sharpe=-0.3663, Trades=22
[INFO] Cluster 3 cluster: Short SMA=128, Long SMA=190, Sharpe=0.3310, Trades=19
[INFO] Cluster 4 cluster: Short SMA=36, Long SMA=280, Sharpe=0.3304, Trades=16
[INFO] Cluster 5 cluster: Short SMA=28, Long SMA=32, Sharpe=0.3642, Trades=132
[INFO] Cluster 6 cluster: Short SMA=120, Long SMA=244, Sharpe=0.2648, Trades=17
[INFO] Cluster 7 cluster: Short SMA=124, Long SMA=156, Sharpe=-0.0648, Trades=29
[INFO] Cluster 8 cluster: Short SMA=102, Long SMA=106, Sharpe=-0.3184, Trades=76
[INFO] Cluster 9 cluster: Short SMA=194, Long SMA=292, Sharpe=0.0494, Trades=15
[INFO] Cluster 10 cluster: Short SMA=24, Long SMA=82, Sharpe=0.4209, Trades=42
[INFO] Cluster 11 cluster: Short SMA=24, Long SMA=42, Sharpe=0.3820, Trades=74
[INFO] Cluster 12 cluster: Short SMA=154, Long SMA=214, Sharpe=0.2467, Trades=17
[INFO] Cluster 13 cluster: Short SMA=30, Long SMA=106, Sharpe=0.3049, Trades=32
[INFO] Cluster 14 cluster: Short SMA=148, Long SMA=154, Sharpe=-0.0183, Trades=58
[INFO] Cluster 15 cluster: Short SMA=64, Long SMA=66, Sharpe=0.3801, Trades=127
[INFO] Cluster 16 cluster: Short SMA=58, Long SMA=220, Sharpe=0.2033, Trades=18
[INFO] Cluster 17 cluster: Short SMA=236, Long SMA=286, Sharpe=-0.0728, Trades=19
[INFO] Cluster 18 cluster: Short SMA=278, Long SMA=282, Sharpe=-0.2195, Trades=49
[INFO] Cluster 19 cluster: Short SMA=36, Long SMA=50, Sharpe=0.7976, Trades=72
[INFO] Cluster 20 cluster: Short SMA=86, Long SMA=160, Sharpe=-0.0824, Trades=21
[INFO] Cluster 21 cluster: Short SMA=226, Long SMA=260, Sharpe=0.1321, Trades=20
[INFO] Cluster 22 cluster: Short SMA=196, Long SMA=222, Sharpe=0.2995, Trades=25
[INFO] Cluster 23 cluster: Short SMA=62, Long SMA=136, Sharpe=0.0365, Trades=22
[INFO] Cluster 24 cluster: Short SMA=70, Long SMA=92, Sharpe=0.1722, Trades=43
[INFO] Cluster 25 cluster: Short SMA=240, Long SMA=246, Sharpe=0.1929, Trades=42
[INFO] Cluster 26 cluster: Short SMA=48, Long SMA=176, Sharpe=0.1777, Trades=20
[INFO] Cluster 27 cluster: Short SMA=36, Long SMA=226, Sharpe=0.1310, Trades=20
[INFO] Cluster 28 cluster: Short SMA=138, Long SMA=262, Sharpe=-0.0167, Trades=17
[INFO] Cluster 29 cluster: Short SMA=124, Long SMA=140, Sharpe=0.1164, Trades=37
[INFO] Cluster 30 cluster: Short SMA=14, Long SMA=196, Sharpe=0.2704, Trades=34
[INFO] Cluster 31 cluster: Short SMA=90, Long SMA=292, Sharpe=-0.0157, Trades=16
[INFO] Cluster 34 cluster: Short SMA=80, Long SMA=264, Sharpe=0.2194, Trades=17
[INFO] Cluster 35 cluster: Short SMA=182, Long SMA=202, Sharpe=-0.0788, Trades=25
[INFO] Cluster 36 cluster: Short SMA=96, Long SMA=110, Sharpe=-0.2386, Trades=40
[INFO] Cluster 37 cluster: Short SMA=146, Long SMA=292, Sharpe=-0.0540, Trades=14
[INFO] Cluster 38 cluster: Short SMA=86, Long SMA=196, Sharpe=-0.0589, Trades=19
[INFO] Cluster 39 cluster: Short SMA=22, Long SMA=250, Sharpe=0.1941, Trades=24
[INFO] Cluster 40 cluster: Short SMA=26, Long SMA=58, Sharpe=0.5397, Trades=58
[INFO] Cluster 41 cluster: Short SMA=116, Long SMA=180, Sharpe=0.1278, Trades=19
[INFO] Cluster 42 cluster: Short SMA=24, Long SMA=152, Sharpe=0.0779, Trades=28
[INFO] Cluster 43 cluster: Short SMA=186, Long SMA=266, Sharpe=0.3844, Trades=16
[INFO] Cluster 44 cluster: Short SMA=138, Long SMA=140, Sharpe=0.1129, Trades=87
[INFO] Cluster 45 cluster: Short SMA=94, Long SMA=234, Sharpe=0.2195, Trades=13
[INFO] Cluster 46 cluster: Short SMA=38, Long SMA=180, Sharpe=0.3797, Trades=22
[INFO] Cluster 47 cluster: Short SMA=264, Long SMA=292, Sharpe=-0.2128, Trades=23
[INFO] Cluster 48 cluster: Short SMA=46, Long SMA=120, Sharpe=0.2229, Trades=22
[INFO] Cluster 49 cluster: Short SMA=74, Long SMA=84, Sharpe=0.2665, Trades=57
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8855, Trades=170
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=36, Long SMA=50, Sharpe=0.7976, Trades=72
[INFO] Top 2: Short SMA=26, Long SMA=58, Sharpe=0.5397, Trades=58
[INFO] Top 3: Short SMA=24, Long SMA=82, Sharpe=0.4209, Trades=42
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 48 valid clusters with clusters
[INFO] Filtering to 10566 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(36/50) - Original Sharpe: 0.7976, Trades: 72
[INFO] Hierarchical cluster 2: SMA(26/58) - Original Sharpe: 0.5397, Trades: 58
[INFO] Hierarchical cluster 3: SMA(24/82) - Original Sharpe: 0.4209, Trades: 42
[INFO] Hierarchical cluster 4: SMA(186/266) - Original Sharpe: 0.3844, Trades: 16
[INFO] Hierarchical cluster 5: SMA(24/42) - Original Sharpe: 0.3820, Trades: 74
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (36/50) - Sharpe: 0.7976
[INFO] cluster 2: (26/58) - Sharpe: 0.5397
[INFO] cluster 3: (24/82) - Sharpe: 0.4209
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.969108            0.091224
1    2021-11-14 2021-11-14            44    -3.439143           -3.607556
2    2022-01-14 2022-01-14            41     1.435275            2.631849
3    2022-03-14 2022-03-14            44    -2.274282           -0.241525
4    2022-05-14 2022-05-14            43    -2.490349           -1.622520
5    2022-07-14 2022-07-14            44     1.424645            2.265683
6    2022-09-14 2022-09-14            43     0.423005           -0.559552
7    2022-11-14 2022-11-14            43    -1.044126           -2.522884
8    2023-01-14 2023-01-14            41     3.087546            1.047232
9    2023-03-14 2023-03-14            43    -2.851713           -1.752452
10   2023-05-14 2023-05-14            44    -0.359960           -1.741991
11   2023-07-14 2023-07-14            44     5.881769            3.955995
12   2023-09-14 2023-09-14            43    -1.305448           -1.861232
13   2023-11-14 2023-11-14            42     1.295824            0.619975
14   2024-01-14 2024-01-14            43    -0.582717            1.002612
15   2024-03-14 2024-03-14            42     0.280722            0.280722
16   2024-05-14 2024-05-14            44    -5.331792           -2.320956
17   2024-07-14 2024-07-14            45     0.232453            0.375567
18   2024-09-14 2024-09-14            43    -1.780293           -0.755620
19   2024-11-14 2024-11-14            33    -0.454091           -2.244215
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              0.1 |          2.1 | True          
[INFO] 2021-11-14   |         -3.4 |             -3.6 |         -0.2 | False         
[INFO] 2022-01-14   |          1.4 |              2.6 |          1.2 | True          
[INFO] 2022-03-14   |         -2.3 |             -0.2 |          2.1 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.6 |          0.9 | True          
[INFO] 2022-07-14   |          1.4 |              2.3 |          0.9 | True          
[INFO] 2022-09-14   |          0.4 |             -0.6 |         -1.0 | False         
[INFO] 2022-11-14   |         -1.0 |             -2.5 |         -1.5 | False         
[INFO] 2023-01-14   |          3.1 |              1.0 |         -2.1 | False         
[INFO] 2023-03-14   |         -2.9 |             -1.8 |          1.1 | True          
[INFO] 2023-05-14   |         -0.4 |             -1.7 |         -1.3 | False         
[INFO] 2023-07-14   |          5.9 |              4.0 |         -1.9 | False         
[INFO] 2023-09-14   |         -1.3 |             -1.9 |         -0.6 | False         
[INFO] 2023-11-14   |          1.3 |              0.6 |         -0.7 | False         
[INFO] 2024-01-14   |         -0.6 |              1.0 |          1.6 | True          
[INFO] 2024-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -2.3 |          3.0 | True          
[INFO] 2024-07-14   |          0.2 |              0.4 |          0.2 | True          
[INFO] 2024-09-14   |         -1.8 |             -0.8 |          1.0 | True          
[INFO] 2024-11-14   |         -0.5 |             -2.2 |         -1.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 19 periods (52.63% win rate)
[INFO] Updating Excel file with Hierarchical results for WBS...
[INFO] Excel file updated successfully. Added WBS with Hierarchical win rate 52.6% in row 55
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(36/50) - Original Sharpe: 0.7976
[INFO] Added cluster 2 to portfolio: SMA(26/58) - Original Sharpe: 0.5397
[INFO] Added cluster 3 to portfolio: SMA(24/82) - Original Sharpe: 0.4209
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'WBS_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2822
[INFO] Hierarchical Best out-of-sample Sharpe: -0.5515
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for WBS...
[INFO] Excel file updated successfully. Added WBS with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\WBS
