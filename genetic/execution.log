[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for AD in column D: 8.0
[INFO] Using slippage from Excel column D: 8.0
[INFO] 
Symbol: @AD
[INFO] Description: Australian Dollar Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.000000000000001
[INFO] Big point value: 100000.0
[INFO] Data shape: (6168, 6)
[INFO] Date range: 2001-05-14 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-14 15:57:00  0.1839  0.1839  0.1797  0.1832   375.0
1 2001-05-15 15:57:00  0.1826  0.1852  0.1796  0.1851   309.0
2 2001-05-16 15:57:00  0.1854  0.1876  0.1827  0.1874   376.0
3 2001-05-17 15:57:00  0.1881  0.1929  0.1877  0.1917   715.0
4 2001-05-18 15:57:00  0.1916  0.1937  0.1882  0.1931   331.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 27.03 seconds (0.45 minutes)
[INFO] Best parameters found: Short SMA = 106, Long SMA = 160
[INFO] Best fitness (Sharpe ratio): 0.627696
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 106, Long SMA = 160, Sharpe = 0.627696
[INFO] Top 2: Short SMA = 98, Long SMA = 174, Sharpe = 0.623336
[INFO] Top 3: Short SMA = 102, Long SMA = 160, Sharpe = 0.617233
[INFO] Top 4: Short SMA = 104, Long SMA = 158, Sharpe = 0.613865
[INFO] Top 5: Short SMA = 106, Long SMA = 156, Sharpe = 0.613627
[INFO] Hall of Fame size: 2449
[INFO] Number of elements in all_results: 1799
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 650 had penalty fitness
[INFO] Total filtered from Hall of Fame: 650
[INFO] Hall of Fame -> all_results: 2449 -> 1799
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1799 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @AD
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.51 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $374,025.00
[INFO] Market Buy & Hold P&L: $-24,520.00
[INFO] Outperformance: $398,545.00
[INFO] Sharpe ratio (entire period, annualized): 0.382500
[INFO] Sharpe ratio (in-sample, annualized): 0.256692
[INFO] Sharpe ratio (out-of-sample, annualized): 0.674794
[INFO] Maximum Drawdown: $164,805.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $130,205.00
[INFO] Out-of-sample P&L: $147,260.00
[INFO] 
Best parameters from GA: Short SMA = 106, Long SMA = 160, Sharpe = 0.627696
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2449
[INFO] Cache hits (repeated combinations): 6143
[INFO] Total checks: 8592
[INFO] Cache hit rate: 71.50%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1799 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.5543 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 14
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1799 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.5543 to 0.6277
[INFO] Trades range: 10.0 to 186.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3657 to 2.5879
[INFO] Scaled Long SMA range: -2.9553 to 2.0914
[INFO] Scaled Sharpe ratio range: -2.9730 to 2.0253
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 100 elements
[INFO] Kmeans Cluster 1: 115 elements
[INFO] Kmeans Cluster 2: 119 elements
[INFO] Kmeans Cluster 3: 95 elements
[INFO] Kmeans Cluster 4: 166 elements
[INFO] Kmeans Cluster 5: 75 elements
[INFO] Kmeans Cluster 6: 61 elements
[INFO] Kmeans Cluster 7: 91 elements
[INFO] Kmeans Cluster 8: 46 elements
[INFO] Kmeans Cluster 9: 93 elements
[INFO] Kmeans Cluster 10: 104 elements
[INFO] Kmeans Cluster 11: 140 elements
[INFO] Kmeans Cluster 12: 95 elements
[INFO] Kmeans Cluster 13: 71 elements
[INFO] Kmeans Cluster 14: 191 elements
[INFO] Kmeans Cluster 15: 95 elements
[INFO] Kmeans Cluster 16: 142 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=86.28, Long SMA=189.42, Sharpe=0.3134
[INFO] Centroid 1: Short SMA=44.17, Long SMA=160.30, Sharpe=0.1039
[INFO] Centroid 2: Short SMA=219.46, Long SMA=247.41, Sharpe=-0.0209
[INFO] Centroid 3: Short SMA=30.80, Long SMA=267.37, Sharpe=0.0808
[INFO] Centroid 4: Short SMA=139.00, Long SMA=181.28, Sharpe=0.2822
[INFO] Centroid 5: Short SMA=27.71, Long SMA=60.85, Sharpe=0.1374
[INFO] Centroid 6: Short SMA=75.64, Long SMA=99.87, Sharpe=-0.3541
[INFO] Centroid 7: Short SMA=15.45, Long SMA=180.70, Sharpe=0.2902
[INFO] Centroid 8: Short SMA=189.30, Long SMA=211.74, Sharpe=-0.2002
[INFO] Centroid 9: Short SMA=43.35, Long SMA=171.46, Sharpe=-0.1017
[INFO] Centroid 10: Short SMA=104.29, Long SMA=144.44, Sharpe=0.3033
[INFO] Centroid 11: Short SMA=270.04, Long SMA=285.24, Sharpe=-0.0778
[INFO] Centroid 12: Short SMA=51.47, Long SMA=224.38, Sharpe=-0.0139
[INFO] Centroid 13: Short SMA=158.06, Long SMA=201.10, Sharpe=0.0909
[INFO] Centroid 14: Short SMA=99.29, Long SMA=167.07, Sharpe=0.4995
[INFO] Centroid 15: Short SMA=76.42, Long SMA=121.83, Sharpe=-0.0840
[INFO] Centroid 16: Short SMA=136.00, Long SMA=164.21, Sharpe=0.4413
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=14
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=100, Long SMA=166, Sharpe=0.6029, Trades=12
[INFO] Kmeans Top 2: Short SMA=138, Long SMA=164, Sharpe=0.5070, Trades=16
[INFO] Kmeans Top 3: Short SMA=102, Long SMA=144, Sharpe=0.3692, Trades=19
[INFO] Kmeans Top 4: Short SMA=86, Long SMA=188, Sharpe=0.3167, Trades=10
[INFO] Kmeans Top 5: Short SMA=14, Long SMA=178, Sharpe=0.2858, Trades=18
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (86, 189)
[INFO]   Nearest: (86.0, 190.0)
[INFO]   Rounded: (44, 160)
[INFO]   Rounded: (219, 247)
[INFO]   Nearest: (220.0, 248.0)
[INFO]   Rounded: (31, 267)
[INFO]   Nearest: (30.0, 268.0)
[INFO]   Rounded: (139, 181)
[INFO]   Nearest: (140.0, 182.0)
[INFO]   Rounded: (28, 61)
[INFO]   Nearest: (28.0, 60.0)
[INFO]   Rounded: (76, 100)
[INFO]   Rounded: (15, 181)
[INFO]   Nearest: (16.0, 180.0)
[INFO]   Rounded: (189, 212)
[INFO]   Nearest: (190.0, 212.0)
[INFO]   Rounded: (43, 171)
[INFO]   Nearest: (44.0, 172.0)
[INFO]   Rounded: (104, 144)
[INFO]   Rounded: (270, 285)
[INFO]   Nearest: (270.0, 286.0)
[INFO]   Rounded: (51, 224)
[INFO]   Nearest: (52.0, 224.0)
[INFO]   Rounded: (158, 201)
[INFO]   Nearest: (158.0, 202.0)
[INFO]   Rounded: (99, 167)
[INFO]   Nearest: (100.0, 168.0)
[INFO]   Rounded: (76, 122)
[INFO]   Rounded: (136, 164)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(100/166) - Original Sharpe: 0.6029, Trades: 12
[INFO] Kmeans cluster 2: SMA(138/164) - Original Sharpe: 0.5070, Trades: 16
[INFO] Kmeans cluster 3: SMA(102/144) - Original Sharpe: 0.3692, Trades: 19
[INFO] Kmeans cluster 4: SMA(86/188) - Original Sharpe: 0.3167, Trades: 10
[INFO] Kmeans cluster 5: SMA(14/178) - Original Sharpe: 0.2858, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (100/166) - Sharpe: 0.6029
[INFO] cluster 2: (138/164) - Sharpe: 0.5070
[INFO] cluster 3: (102/144) - Sharpe: 0.3692
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            0.551202
1    2021-11-14 2021-11-14            43     0.620829            0.620829
2    2022-01-14 2022-01-14            41     0.058063            0.058063
3    2022-03-14 2022-03-14            44     1.979608            1.979608
4    2022-05-14 2022-05-14            43    -1.220633           -2.292817
5    2022-07-14 2022-07-14            44     0.448047            0.403557
6    2022-09-14 2022-09-14            43     0.790083            0.790083
7    2022-11-14 2022-11-14            43    -1.736792           -1.736792
8    2023-01-14 2023-01-14            41     2.493082            2.458579
9    2023-03-14 2023-03-14            44    -0.132668           -0.967044
10   2023-05-14 2023-05-14            44     0.580825           -2.270132
11   2023-07-14 2023-07-14            44     4.541233            4.541233
12   2023-09-14 2023-09-14            43     0.691612            0.691612
13   2023-11-14 2023-11-14            42    -2.563801           -2.563801
14   2024-01-14 2024-01-14            43     4.073536            3.035601
15   2024-03-14 2024-03-14            42    -0.424007           -0.014811
16   2024-05-14 2024-05-14            44    -1.116674           -2.276461
17   2024-07-14 2024-07-14            45     3.495207            1.170378
18   2024-09-14 2024-09-14            43    -2.003748           -2.003748
19   2024-11-14 2024-11-14            33     3.170976            3.586260
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -1.2 |             -2.3 |         -1.1 | False         
[INFO] 2022-07-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -0.1 |             -1.0 |         -0.9 | False         
[INFO] 2023-05-14   |          0.6 |             -2.3 |         -2.9 | False         
[INFO] 2023-07-14   |          4.5 |              4.5 |          0.0 | Excluded      
[INFO] 2023-09-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2024-01-14   |          4.1 |              3.0 |         -1.1 | False         
[INFO] 2024-03-14   |         -0.4 |             -0.0 |          0.4 | True          
[INFO] 2024-05-14   |         -1.1 |             -2.3 |         -1.2 | False         
[INFO] 2024-07-14   |          3.5 |              1.2 |         -2.3 | False         
[INFO] 2024-09-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-11-14   |          3.2 |              3.6 |          0.4 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Kmeans cluster wins (rounded comparison): 2 of 8 periods (25.00% win rate)
[INFO] Updating Excel file with Kmeans results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans win rate 25.0% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(100/166) - Original Sharpe: 0.6029
[INFO] Added cluster 2 to portfolio: SMA(138/164) - Original Sharpe: 0.5070
[INFO] Added cluster 3 to portfolio: SMA(102/144) - Original Sharpe: 0.3692
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2655
[INFO] Kmeans Best out-of-sample Sharpe: 0.6449
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1799 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.5543 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 14
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1799 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.5543 to 0.6277
[INFO] Trades range: 10.0 to 186.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3657 to 2.5879
[INFO] Scaled Long SMA range: -2.9553 to 2.0914
[INFO] Scaled Sharpe ratio range: -2.9730 to 2.0253
[INFO] Scaled Trades range: -0.6748 to 14.8572
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1799 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6290
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 161 elements
[INFO] Cluster 1: 206 elements
[INFO] Cluster 2: 208 elements
[INFO] Cluster 3: 155 elements
[INFO] Cluster 4: 362 elements
[INFO] Cluster 5: 65 elements
[INFO] Cluster 6: 133 elements
[INFO] Cluster 7: 59 elements
[INFO] Cluster 8: 13 elements
[INFO] Cluster 9: 43 elements
[INFO] Cluster 10: 34 elements
[INFO] Cluster 11: 138 elements
[INFO] Cluster 12: 111 elements
[INFO] Cluster 13: 1 elements
[INFO] Cluster 14: 110 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=28, Long SMA=188, Sharpe=0.1167, Trades=14
[INFO] Cluster 1 cluster: Short SMA=138, Long SMA=190, Sharpe=0.3020, Trades=12
[INFO] Cluster 2 cluster: Short SMA=42, Long SMA=166, Sharpe=-0.1907, Trades=14
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=256, Sharpe=-0.1094, Trades=12
[INFO] Cluster 4 cluster: Short SMA=102, Long SMA=168, Sharpe=0.4730, Trades=12
[INFO] Cluster 5 cluster: Short SMA=28, Long SMA=56, Sharpe=0.0188, Trades=44
[INFO] Cluster 6 cluster: Short SMA=208, Long SMA=236, Sharpe=-0.0220, Trades=13
[INFO] Cluster 7 cluster: Short SMA=88, Long SMA=100, Sharpe=-0.2965, Trades=35
[INFO] Cluster 9 cluster: Short SMA=240, Long SMA=244, Sharpe=0.0672, Trades=33
[INFO] Cluster 10 cluster: Short SMA=150, Long SMA=154, Sharpe=0.4153, Trades=38
[INFO] Cluster 11 cluster: Short SMA=266, Long SMA=284, Sharpe=-0.0245, Trades=15
[INFO] Cluster 12 cluster: Short SMA=84, Long SMA=128, Sharpe=0.0477, Trades=19
[INFO] Cluster 14 cluster: Short SMA=132, Long SMA=154, Sharpe=0.2187, Trades=18
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=14
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=102, Long SMA=168, Sharpe=0.4730, Trades=12
[INFO] Top 2: Short SMA=150, Long SMA=154, Sharpe=0.4153, Trades=38
[INFO] Top 3: Short SMA=138, Long SMA=190, Sharpe=0.3020, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 1785 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(102/168) - Original Sharpe: 0.4730, Trades: 12
[INFO] Hierarchical cluster 2: SMA(150/154) - Original Sharpe: 0.4153, Trades: 38
[INFO] Hierarchical cluster 3: SMA(138/190) - Original Sharpe: 0.3020, Trades: 12
[INFO] Hierarchical cluster 4: SMA(132/154) - Original Sharpe: 0.2187, Trades: 18
[INFO] Hierarchical cluster 5: SMA(28/188) - Original Sharpe: 0.1167, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (102/168) - Sharpe: 0.4730
[INFO] cluster 2: (150/154) - Sharpe: 0.4153
[INFO] cluster 3: (138/190) - Sharpe: 0.3020
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            0.551202
1    2021-11-14 2021-11-14            43     0.620829            0.620829
2    2022-01-14 2022-01-14            41     0.058063            0.058063
3    2022-03-14 2022-03-14            44     1.979608            1.491246
4    2022-05-14 2022-05-14            43    -1.220633            0.783922
5    2022-07-14 2022-07-14            44     0.448047            0.722602
6    2022-09-14 2022-09-14            43     0.790083            0.790083
7    2022-11-14 2022-11-14            43    -1.736792           -1.736792
8    2023-01-14 2023-01-14            41     2.493082            2.493082
9    2023-03-14 2023-03-14            44    -0.132668           -0.292013
10   2023-05-14 2023-05-14            44     0.580825            1.148770
11   2023-07-14 2023-07-14            44     4.541233            2.808763
12   2023-09-14 2023-09-14            43     0.691612            0.691612
13   2023-11-14 2023-11-14            42    -2.563801           -3.100356
14   2024-01-14 2024-01-14            43     4.073536            1.681490
15   2024-03-14 2024-03-14            42    -0.424007            0.619271
16   2024-05-14 2024-05-14            44    -1.116674            0.726240
17   2024-07-14 2024-07-14            45     3.495207           -0.064369
18   2024-09-14 2024-09-14            43    -2.003748           -2.391713
19   2024-11-14 2024-11-14            33     3.170976           -0.956787
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          2.0 |              1.5 |         -0.5 | False         
[INFO] 2022-05-14   |         -1.2 |              0.8 |          2.0 | True          
[INFO] 2022-07-14   |          0.4 |              0.7 |          0.3 | True          
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -0.1 |             -0.3 |         -0.2 | False         
[INFO] 2023-05-14   |          0.6 |              1.1 |          0.5 | True          
[INFO] 2023-07-14   |          4.5 |              2.8 |         -1.7 | False         
[INFO] 2023-09-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -2.6 |             -3.1 |         -0.5 | False         
[INFO] 2024-01-14   |          4.1 |              1.7 |         -2.4 | False         
[INFO] 2024-03-14   |         -0.4 |              0.6 |          1.0 | True          
[INFO] 2024-05-14   |         -1.1 |              0.7 |          1.8 | True          
[INFO] 2024-07-14   |          3.5 |             -0.1 |         -3.6 | False         
[INFO] 2024-09-14   |         -2.0 |             -2.4 |         -0.4 | False         
[INFO] 2024-11-14   |          3.2 |             -1.0 |         -4.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 13 periods (38.46% win rate)
[INFO] Updating Excel file with Hierarchical results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical win rate 38.5% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(102/168) - Original Sharpe: 0.4730
[INFO] Added cluster 2 to portfolio: SMA(150/154) - Original Sharpe: 0.4153
[INFO] Added cluster 3 to portfolio: SMA(138/190) - Original Sharpe: 0.3020
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3075
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6449
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BO in column D: 10.0
[INFO] Using slippage from Excel column D: 10.0
[INFO] 
Symbol: @BO
[INFO] Description: Soybean Oil Continuous Contract [May25]
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 6.0
[INFO] Big point value: 600.0
[INFO] Data shape: (5846, 6)
[INFO] Date range: 2001-05-14 13:13:00 to 2025-04-07 13:13:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2001-05-14 13:13:00  22.96  22.96  22.96  22.96    10.0
1 2001-05-15 13:13:00  23.01  23.01  23.00  23.00    23.0
2 2001-05-16 13:13:00  22.91  22.91  22.91  22.91     5.0
3 2001-05-17 13:13:00  22.85  22.85  22.85  22.85     2.0
4 2001-05-18 13:13:00  23.06  23.15  23.06  23.15     7.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 25.47 seconds (0.42 minutes)
[INFO] Best parameters found: Short SMA = 48, Long SMA = 54
[INFO] Best fitness (Sharpe ratio): 1.148397
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 48, Long SMA = 54, Sharpe = 1.148397
[INFO] Top 2: Short SMA = 48, Long SMA = 66, Sharpe = 1.130687
[INFO] Top 3: Short SMA = 50, Long SMA = 54, Sharpe = 1.129939
[INFO] Top 4: Short SMA = 48, Long SMA = 56, Sharpe = 1.122568
[INFO] Top 5: Short SMA = 48, Long SMA = 64, Sharpe = 1.101316
[INFO] Hall of Fame size: 2318
[INFO] Number of elements in all_results: 1671
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 647 had penalty fitness
[INFO] Total filtered from Hall of Fame: 647
[INFO] Hall of Fame -> all_results: 2318 -> 1671
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1671 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BO
[INFO] Big Point Value (from data): 600.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 13.60 contracts
[INFO] Maximum Position Size: 31 contracts
[INFO] Strategy Total P&L: $122,808.00
[INFO] Market Buy & Hold P&L: $8,556.00
[INFO] Outperformance: $114,252.00
[INFO] Sharpe ratio (entire period, annualized): 0.013899
[INFO] Sharpe ratio (in-sample, annualized): -0.076783
[INFO] Sharpe ratio (out-of-sample, annualized): 0.213814
[INFO] Maximum Drawdown: $348,888.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-37,320.00
[INFO] Out-of-sample P&L: $47,142.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 54, Sharpe = 1.148397
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2318
[INFO] Cache hits (repeated combinations): 6379
[INFO] Total checks: 8697
[INFO] Cache hit rate: 73.35%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1671 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 20 to 300
[INFO] Sharpe ratio range: -0.4907 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 63
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1671 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 20.0 to 300.0
[INFO] Sharpe ratio range: -0.4907 to 1.1484
[INFO] Trades range: 11.0 to 168.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9945 to 2.1141
[INFO] Scaled Long SMA range: -2.0891 to 1.4323
[INFO] Scaled Sharpe ratio range: -2.3533 to 3.0251
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 20
[INFO] Using 20 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=20...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 125 elements
[INFO] Kmeans Cluster 1: 61 elements
[INFO] Kmeans Cluster 2: 43 elements
[INFO] Kmeans Cluster 3: 51 elements
[INFO] Kmeans Cluster 4: 59 elements
[INFO] Kmeans Cluster 5: 125 elements
[INFO] Kmeans Cluster 6: 143 elements
[INFO] Kmeans Cluster 7: 83 elements
[INFO] Kmeans Cluster 8: 103 elements
[INFO] Kmeans Cluster 9: 117 elements
[INFO] Kmeans Cluster 10: 103 elements
[INFO] Kmeans Cluster 11: 111 elements
[INFO] Kmeans Cluster 12: 68 elements
[INFO] Kmeans Cluster 13: 71 elements
[INFO] Kmeans Cluster 14: 58 elements
[INFO] Kmeans Cluster 15: 81 elements
[INFO] Kmeans Cluster 16: 49 elements
[INFO] Kmeans Cluster 17: 16 elements
[INFO] Kmeans Cluster 18: 85 elements
[INFO] Kmeans Cluster 19: 119 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=53.87, Long SMA=206.78, Sharpe=-0.1186
[INFO] Centroid 1: Short SMA=196.56, Long SMA=217.93, Sharpe=0.1643
[INFO] Centroid 2: Short SMA=50.37, Long SMA=85.35, Sharpe=0.2621
[INFO] Centroid 3: Short SMA=45.37, Long SMA=62.94, Sharpe=0.9442
[INFO] Centroid 4: Short SMA=278.90, Long SMA=295.43, Sharpe=-0.1868
[INFO] Centroid 5: Short SMA=36.51, Long SMA=237.02, Sharpe=0.1596
[INFO] Centroid 6: Short SMA=245.86, Long SMA=273.71, Sharpe=0.3423
[INFO] Centroid 7: Short SMA=74.87, Long SMA=116.10, Sharpe=-0.0358
[INFO] Centroid 8: Short SMA=28.58, Long SMA=106.72, Sharpe=0.4499
[INFO] Centroid 9: Short SMA=20.55, Long SMA=269.68, Sharpe=0.3057
[INFO] Centroid 10: Short SMA=31.96, Long SMA=182.62, Sharpe=0.0548
[INFO] Centroid 11: Short SMA=255.20, Long SMA=283.11, Sharpe=0.1109
[INFO] Centroid 12: Short SMA=27.88, Long SMA=58.21, Sharpe=0.5636
[INFO] Centroid 13: Short SMA=121.21, Long SMA=162.03, Sharpe=-0.1307
[INFO] Centroid 14: Short SMA=144.28, Long SMA=192.41, Sharpe=0.0091
[INFO] Centroid 15: Short SMA=233.41, Long SMA=255.28, Sharpe=0.5682
[INFO] Centroid 16: Short SMA=65.88, Long SMA=174.33, Sharpe=-0.3223
[INFO] Centroid 18: Short SMA=34.38, Long SMA=143.76, Sharpe=0.2498
[INFO] Centroid 19: Short SMA=32.67, Long SMA=65.14, Sharpe=0.7454
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=54, Sharpe=1.1484, Trades=63
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=46, Long SMA=62, Sharpe=0.9485, Trades=39
[INFO] Kmeans Top 2: Short SMA=234, Long SMA=250, Sharpe=0.7420, Trades=19
[INFO] Kmeans Top 3: Short SMA=32, Long SMA=64, Sharpe=0.7292, Trades=24
[INFO] Kmeans Top 4: Short SMA=26, Long SMA=54, Sharpe=0.6297, Trades=30
[INFO] Kmeans Top 5: Short SMA=30, Long SMA=106, Sharpe=0.4133, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 18, 19}
[INFO]   Rounded: (54, 207)
[INFO]   Nearest: (54.0, 206.0)
[INFO]   Rounded: (197, 218)
[INFO]   Nearest: (196.0, 218.0)
[INFO]   Rounded: (50, 85)
[INFO]   Nearest: (50.0, 86.0)
[INFO]   Rounded: (45, 63)
[INFO]   Nearest: (46.0, 62.0)
[INFO]   Rounded: (279, 295)
[INFO]   Nearest: (278.0, 296.0)
[INFO]   Rounded: (37, 237)
[INFO]   Nearest: (36.0, 238.0)
[INFO]   Rounded: (246, 274)
[INFO]   Rounded: (75, 116)
[INFO]   Nearest: (74.0, 116.0)
[INFO]   Rounded: (29, 107)
[INFO]   Nearest: (28.0, 106.0)
[INFO]   Rounded: (21, 270)
[INFO]   Nearest: (20.0, 270.0)
[INFO]   Rounded: (32, 183)
[INFO]   Nearest: (32.0, 182.0)
[INFO]   Rounded: (255, 283)
[INFO]   Nearest: (256.0, 284.0)
[INFO]   Rounded: (28, 58)
[INFO]   Rounded: (121, 162)
[INFO]   Nearest: (122.0, 162.0)
[INFO]   Rounded: (144, 192)
[INFO]   Rounded: (233, 255)
[INFO]   Nearest: (234.0, 256.0)
[INFO]   Rounded: (66, 174)
[INFO]   Rounded: (34, 144)
[INFO]   Rounded: (33, 65)
[INFO]   Nearest: (32.0, 66.0)
[INFO] Successfully plotted 19 out of 19 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 54
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(46/62) - Original Sharpe: 0.9485, Trades: 39
[INFO] Kmeans cluster 2: SMA(234/250) - Original Sharpe: 0.7420, Trades: 19
[INFO] Kmeans cluster 3: SMA(32/64) - Original Sharpe: 0.7292, Trades: 24
[INFO] Kmeans cluster 4: SMA(26/54) - Original Sharpe: 0.6297, Trades: 30
[INFO] Kmeans cluster 5: SMA(30/106) - Original Sharpe: 0.4133, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/54)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (46/62) - Sharpe: 0.9485
[INFO] cluster 2: (234/250) - Sharpe: 0.7420
[INFO] cluster 3: (32/64) - Sharpe: 0.7292
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -3.408887           -3.100510
1    2021-11-10 2021-11-10            41    -4.249630           -2.670534
2    2022-01-10 2022-01-10            41     1.218137            2.166758
3    2022-03-10 2022-03-10            42     2.126254            2.442535
4    2022-05-10 2022-05-10            41    -5.000926           -4.489848
5    2022-07-10 2022-07-10            44    -0.790260           -0.019992
6    2022-09-10 2022-09-10            43     1.268514            3.602145
7    2022-11-10 2022-11-10            40    -2.869549           -1.881657
8    2023-01-10 2023-01-10            41     1.869806            2.198292
9    2023-03-10 2023-03-10            42     1.878823            1.736344
10   2023-05-10 2023-05-10            40    -1.601658           -2.041194
11   2023-07-10 2023-07-10            44     0.545769            1.118295
12   2023-09-10 2023-09-10            44     0.229410            1.064243
13   2023-11-10 2023-11-10            40     0.831968            0.831968
14   2024-01-10 2024-01-10            41     1.354455            2.139975
15   2024-03-10 2024-03-10            43    -1.598528           -3.397769
16   2024-05-10 2024-05-10            40     1.637085            0.320277
17   2024-07-10 2024-07-10            43    -1.484568           -0.601320
18   2024-09-10 2024-09-10            44     1.814989           -0.540454
19   2024-11-10 2024-11-10            35    -2.317816           -5.214923
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -3.4 |             -3.1 |          0.3 | True          
[INFO] 2021-11-10   |         -4.2 |             -2.7 |          1.5 | True          
[INFO] 2022-01-10   |          1.2 |              2.2 |          1.0 | True          
[INFO] 2022-03-10   |          2.1 |              2.4 |          0.3 | True          
[INFO] 2022-05-10   |         -5.0 |             -4.5 |          0.5 | True          
[INFO] 2022-07-10   |         -0.8 |             -0.0 |          0.8 | True          
[INFO] 2022-09-10   |          1.3 |              3.6 |          2.3 | True          
[INFO] 2022-11-10   |         -2.9 |             -1.9 |          1.0 | True          
[INFO] 2023-01-10   |          1.9 |              2.2 |          0.3 | True          
[INFO] 2023-03-10   |          1.9 |              1.7 |         -0.2 | False         
[INFO] 2023-05-10   |         -1.6 |             -2.0 |         -0.4 | False         
[INFO] 2023-07-10   |          0.5 |              1.1 |          0.6 | True          
[INFO] 2023-09-10   |          0.2 |              1.1 |          0.9 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.4 |              2.1 |          0.7 | True          
[INFO] 2024-03-10   |         -1.6 |             -3.4 |         -1.8 | False         
[INFO] 2024-05-10   |          1.6 |              0.3 |         -1.3 | False         
[INFO] 2024-07-10   |         -1.5 |             -0.6 |          0.9 | True          
[INFO] 2024-09-10   |          1.8 |             -0.5 |         -2.3 | False         
[INFO] 2024-11-10   |         -2.3 |             -5.2 |         -2.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 13 of 19 periods (68.42% win rate)
[INFO] Updating Excel file with Kmeans results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans win rate 68.4% in row 4
[INFO] Added best Sharpe parameters 48/54 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 54
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(46/62) - Original Sharpe: 0.9485
[INFO] Added cluster 2 to portfolio: SMA(234/250) - Original Sharpe: 0.7420
[INFO] Added cluster 3 to portfolio: SMA(32/64) - Original Sharpe: 0.7292
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BO_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0190
[INFO] Kmeans Best out-of-sample Sharpe: -0.4398
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BO
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1671 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 20 to 300
[INFO] Sharpe ratio range: -0.4907 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 63
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1671 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 20.0 to 300.0
[INFO] Sharpe ratio range: -0.4907 to 1.1484
[INFO] Trades range: 11.0 to 168.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9945 to 2.1141
[INFO] Scaled Long SMA range: -2.0891 to 1.4323
[INFO] Scaled Sharpe ratio range: -2.3533 to 3.0251
[INFO] Scaled Trades range: -0.7692 to 10.8451
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1671 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6625
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 18
[INFO] Using 18 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 18 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 254 elements
[INFO] Cluster 1: 187 elements
[INFO] Cluster 2: 33 elements
[INFO] Cluster 3: 54 elements
[INFO] Cluster 4: 130 elements
[INFO] Cluster 5: 43 elements
[INFO] Cluster 6: 21 elements
[INFO] Cluster 7: 19 elements
[INFO] Cluster 8: 122 elements
[INFO] Cluster 9: 110 elements
[INFO] Cluster 10: 123 elements
[INFO] Cluster 11: 31 elements
[INFO] Cluster 12: 139 elements
[INFO] Cluster 13: 2 elements
[INFO] Cluster 14: 92 elements
[INFO] Cluster 15: 140 elements
[INFO] Cluster 16: 40 elements
[INFO] Cluster 17: 131 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=28, Long SMA=248, Sharpe=0.2647, Trades=15
[INFO] Cluster 1 cluster: Short SMA=258, Long SMA=284, Sharpe=0.2937, Trades=17
[INFO] Cluster 2 cluster: Short SMA=102, Long SMA=108, Sharpe=-0.1272, Trades=37
[INFO] Cluster 3 cluster: Short SMA=238, Long SMA=242, Sharpe=0.6394, Trades=43
[INFO] Cluster 4 cluster: Short SMA=148, Long SMA=196, Sharpe=0.0653, Trades=11
[INFO] Cluster 5 cluster: Short SMA=286, Long SMA=294, Sharpe=-0.4068, Trades=29
[INFO] Cluster 6 cluster: Short SMA=22, Long SMA=40, Sharpe=0.0963, Trades=54
[INFO] Cluster 8 cluster: Short SMA=234, Long SMA=270, Sharpe=0.3562, Trades=13
[INFO] Cluster 9 cluster: Short SMA=32, Long SMA=100, Sharpe=0.5158, Trades=20
[INFO] Cluster 10 cluster: Short SMA=48, Long SMA=158, Sharpe=0.0265, Trades=15
[INFO] Cluster 11 cluster: Short SMA=44, Long SMA=52, Sharpe=0.7789, Trades=55
[INFO] Cluster 12 cluster: Short SMA=34, Long SMA=64, Sharpe=0.7807, Trades=26
[INFO] Cluster 14 cluster: Short SMA=102, Long SMA=156, Sharpe=-0.0833, Trades=17
[INFO] Cluster 15 cluster: Short SMA=38, Long SMA=138, Sharpe=0.2607, Trades=15
[INFO] Cluster 16 cluster: Short SMA=22, Long SMA=50, Sharpe=0.6365, Trades=38
[INFO] Cluster 17 cluster: Short SMA=50, Long SMA=206, Sharpe=-0.1833, Trades=15
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=54, Sharpe=1.1484, Trades=63
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=34, Long SMA=64, Sharpe=0.7807, Trades=26
[INFO] Top 2: Short SMA=44, Long SMA=52, Sharpe=0.7789, Trades=55
[INFO] Top 3: Short SMA=238, Long SMA=242, Sharpe=0.6394, Trades=43
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 1650 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 54
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(34/64) - Original Sharpe: 0.7807, Trades: 26
[INFO] Hierarchical cluster 2: SMA(44/52) - Original Sharpe: 0.7789, Trades: 55
[INFO] Hierarchical cluster 3: SMA(238/242) - Original Sharpe: 0.6394, Trades: 43
[INFO] Hierarchical cluster 4: SMA(22/50) - Original Sharpe: 0.6365, Trades: 38
[INFO] Hierarchical cluster 5: SMA(32/100) - Original Sharpe: 0.5158, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/54)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/64) - Sharpe: 0.7807
[INFO] cluster 2: (44/52) - Sharpe: 0.7789
[INFO] cluster 3: (238/242) - Sharpe: 0.6394
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -3.408887           -2.767082
1    2021-11-10 2021-11-10            41    -4.249630           -2.856660
2    2022-01-10 2022-01-10            41     1.218137            1.875978
3    2022-03-10 2022-03-10            42     2.126254            2.656914
4    2022-05-10 2022-05-10            41    -5.000926           -3.769739
5    2022-07-10 2022-07-10            44    -0.790260           -0.024129
6    2022-09-10 2022-09-10            43     1.268514            2.470050
7    2022-11-10 2022-11-10            40    -2.869549           -2.126029
8    2023-01-10 2023-01-10            41     1.869806            1.635813
9    2023-03-10 2023-03-10            42     1.878823            1.515088
10   2023-05-10 2023-05-10            40    -1.601658           -2.108776
11   2023-07-10 2023-07-10            44     0.545769            1.266508
12   2023-09-10 2023-09-10            44     0.229410            2.389284
13   2023-11-10 2023-11-10            40     0.831968            0.831968
14   2024-01-10 2024-01-10            41     1.354455            1.628179
15   2024-03-10 2024-03-10            43    -1.598528           -4.287248
16   2024-05-10 2024-05-10            40     1.637085           -1.684666
17   2024-07-10 2024-07-10            43    -1.484568            0.603529
18   2024-09-10 2024-09-10            44     1.814989           -1.105884
19   2024-11-10 2024-11-10            35    -2.317816           -4.596442
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -3.4 |             -2.8 |          0.6 | True          
[INFO] 2021-11-10   |         -4.2 |             -2.9 |          1.3 | True          
[INFO] 2022-01-10   |          1.2 |              1.9 |          0.7 | True          
[INFO] 2022-03-10   |          2.1 |              2.7 |          0.6 | True          
[INFO] 2022-05-10   |         -5.0 |             -3.8 |          1.2 | True          
[INFO] 2022-07-10   |         -0.8 |             -0.0 |          0.8 | True          
[INFO] 2022-09-10   |          1.3 |              2.5 |          1.2 | True          
[INFO] 2022-11-10   |         -2.9 |             -2.1 |          0.8 | True          
[INFO] 2023-01-10   |          1.9 |              1.6 |         -0.3 | False         
[INFO] 2023-03-10   |          1.9 |              1.5 |         -0.4 | False         
[INFO] 2023-05-10   |         -1.6 |             -2.1 |         -0.5 | False         
[INFO] 2023-07-10   |          0.5 |              1.3 |          0.8 | True          
[INFO] 2023-09-10   |          0.2 |              2.4 |          2.2 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.4 |              1.6 |          0.2 | True          
[INFO] 2024-03-10   |         -1.6 |             -4.3 |         -2.7 | False         
[INFO] 2024-05-10   |          1.6 |             -1.7 |         -3.3 | False         
[INFO] 2024-07-10   |         -1.5 |              0.6 |          2.1 | True          
[INFO] 2024-09-10   |          1.8 |             -1.1 |         -2.9 | False         
[INFO] 2024-11-10   |         -2.3 |             -4.6 |         -2.3 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 12 of 19 periods (63.16% win rate)
[INFO] Updating Excel file with Hierarchical results for BO...
[INFO] Excel file updated successfully. Added BO with Hierarchical win rate 63.2% in row 4
[INFO] Added best Sharpe parameters 48/54 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 54
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/64) - Original Sharpe: 0.7807
[INFO] Added cluster 2 to portfolio: SMA(44/52) - Original Sharpe: 0.7789
[INFO] Added cluster 3 to portfolio: SMA(238/242) - Original Sharpe: 0.6394
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BO_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2238
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4398
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for BO...
[INFO] Excel file updated successfully. Added BO with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BO
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BP in column D: 8.0
[INFO] Using slippage from Excel column D: 8.0
[INFO] 
Symbol: @BP
[INFO] Description: British Pound Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 6.25
[INFO] Big point value: 62500.0
[INFO] Data shape: (6172, 6)
[INFO] Date range: 2001-05-14 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-14 15:57:00  1.2614  1.2638  1.2590  1.2636   688.0
1 2001-05-15 15:57:00  1.2618  1.2682  1.2600  1.2680  1481.0
2 2001-05-16 15:57:00  1.2672  1.2750  1.2642  1.2712  3327.0
3 2001-05-17 15:57:00  1.2744  1.2764  1.2704  1.2764  1313.0
4 2001-05-18 15:57:00  1.2762  1.2830  1.2698  1.2828  2100.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 38.23 seconds (0.64 minutes)
[INFO] Best parameters found: Short SMA = 42, Long SMA = 58
[INFO] Best fitness (Sharpe ratio): 0.774978
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 42, Long SMA = 58, Sharpe = 0.774978
[INFO] Top 2: Short SMA = 38, Long SMA = 60, Sharpe = 0.717867
[INFO] Top 3: Short SMA = 16, Long SMA = 114, Sharpe = 0.690853
[INFO] Top 4: Short SMA = 36, Long SMA = 62, Sharpe = 0.679847
[INFO] Top 5: Short SMA = 26, Long SMA = 76, Sharpe = 0.671828
[INFO] Hall of Fame size: 2450
[INFO] Number of elements in all_results: 1761
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 689 had penalty fitness
[INFO] Total filtered from Hall of Fame: 689
[INFO] Hall of Fame -> all_results: 2450 -> 1761
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1761 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BP
[INFO] Big Point Value (from data): 62500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.80 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $293,600.00
[INFO] Market Buy & Hold P&L: $-29,593.75
[INFO] Outperformance: $323,193.75
[INFO] Sharpe ratio (entire period, annualized): 0.440300
[INFO] Sharpe ratio (in-sample, annualized): 0.407668
[INFO] Sharpe ratio (out-of-sample, annualized): 0.520211
[INFO] Maximum Drawdown: $139,881.25
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $223,256.25
[INFO] Out-of-sample P&L: $116,487.50
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 58, Sharpe = 0.774978
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2450
[INFO] Cache hits (repeated combinations): 6208
[INFO] Total checks: 8658
[INFO] Cache hit rate: 71.70%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 62500.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1761 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.5321 to 0.7750
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 58
[INFO] Sharpe Ratio: 0.774978
[INFO] Number of Trades: 39
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1761 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.5321 to 0.7750
[INFO] Trades range: 10.0 to 242.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.8850 to 2.8740
[INFO] Scaled Long SMA range: -2.0962 to 1.9674
[INFO] Scaled Sharpe ratio range: -3.0776 to 2.9035
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 81 elements
[INFO] Kmeans Cluster 1: 143 elements
[INFO] Kmeans Cluster 2: 199 elements
[INFO] Kmeans Cluster 3: 116 elements
[INFO] Kmeans Cluster 4: 102 elements
[INFO] Kmeans Cluster 5: 169 elements
[INFO] Kmeans Cluster 6: 147 elements
[INFO] Kmeans Cluster 7: 133 elements
[INFO] Kmeans Cluster 8: 53 elements
[INFO] Kmeans Cluster 9: 102 elements
[INFO] Kmeans Cluster 10: 51 elements
[INFO] Kmeans Cluster 11: 87 elements
[INFO] Kmeans Cluster 12: 184 elements
[INFO] Kmeans Cluster 13: 71 elements
[INFO] Kmeans Cluster 14: 123 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=202.89, Long SMA=218.94, Sharpe=0.1791
[INFO] Centroid 1: Short SMA=35.94, Long SMA=75.97, Sharpe=0.3933
[INFO] Centroid 2: Short SMA=52.74, Long SMA=214.65, Sharpe=0.0234
[INFO] Centroid 3: Short SMA=73.12, Long SMA=112.28, Sharpe=0.1672
[INFO] Centroid 4: Short SMA=270.82, Long SMA=284.82, Sharpe=-0.0377
[INFO] Centroid 5: Short SMA=22.76, Long SMA=241.01, Sharpe=0.2094
[INFO] Centroid 6: Short SMA=68.69, Long SMA=123.01, Sharpe=-0.0366
[INFO] Centroid 7: Short SMA=30.05, Long SMA=172.99, Sharpe=0.1465
[INFO] Centroid 8: Short SMA=66.15, Long SMA=97.74, Sharpe=-0.2333
[INFO] Centroid 9: Short SMA=20.35, Long SMA=49.35, Sharpe=0.1036
[INFO] Centroid 10: Short SMA=145.45, Long SMA=171.61, Sharpe=-0.2025
[INFO] Centroid 11: Short SMA=21.59, Long SMA=137.36, Sharpe=0.3389
[INFO] Centroid 12: Short SMA=26.51, Long SMA=96.11, Sharpe=0.5430
[INFO] Centroid 13: Short SMA=249.44, Long SMA=267.41, Sharpe=-0.1662
[INFO] Centroid 14: Short SMA=109.22, Long SMA=176.16, Sharpe=0.0114
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=58, Sharpe=0.7750, Trades=39
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=24, Long SMA=100, Sharpe=0.5612, Trades=17
[INFO] Kmeans Top 2: Short SMA=36, Long SMA=76, Sharpe=0.4568, Trades=29
[INFO] Kmeans Top 3: Short SMA=20, Long SMA=136, Sharpe=0.3881, Trades=13
[INFO] Kmeans Top 4: Short SMA=32, Long SMA=172, Sharpe=0.2010, Trades=13
[INFO] Kmeans Top 5: Short SMA=22, Long SMA=238, Sharpe=0.1056, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (203, 219)
[INFO]   Nearest: (202.0, 218.0)
[INFO]   Rounded: (36, 76)
[INFO]   Rounded: (53, 215)
[INFO]   Nearest: (52.0, 214.0)
[INFO]   Rounded: (73, 112)
[INFO]   Nearest: (74.0, 112.0)
[INFO]   Rounded: (271, 285)
[INFO]   Nearest: (270.0, 284.0)
[INFO]   Rounded: (23, 241)
[INFO]   Nearest: (22.0, 242.0)
[INFO]   Rounded: (69, 123)
[INFO]   Nearest: (68.0, 124.0)
[INFO]   Rounded: (30, 173)
[INFO]   Nearest: (30.0, 172.0)
[INFO]   Rounded: (66, 98)
[INFO]   Rounded: (20, 49)
[INFO]   Nearest: (20.0, 50.0)
[INFO]   Rounded: (145, 172)
[INFO]   Nearest: (146.0, 172.0)
[INFO]   Rounded: (22, 137)
[INFO]   Nearest: (22.0, 138.0)
[INFO]   Rounded: (27, 96)
[INFO]   Nearest: (26.0, 96.0)
[INFO]   Rounded: (249, 267)
[INFO]   Nearest: (250.0, 268.0)
[INFO]   Rounded: (109, 176)
[INFO]   Nearest: (110.0, 176.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 58
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(24/100) - Original Sharpe: 0.5612, Trades: 17
[INFO] Kmeans cluster 2: SMA(36/76) - Original Sharpe: 0.4568, Trades: 29
[INFO] Kmeans cluster 3: SMA(20/136) - Original Sharpe: 0.3881, Trades: 13
[INFO] Kmeans cluster 4: SMA(32/172) - Original Sharpe: 0.2010, Trades: 13
[INFO] Kmeans cluster 5: SMA(22/238) - Original Sharpe: 0.1056, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/58)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/100) - Sharpe: 0.5612
[INFO] cluster 2: (36/76) - Sharpe: 0.4568
[INFO] cluster 3: (20/136) - Sharpe: 0.3881
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.987883            2.470739
1    2021-11-14 2021-11-14            43    -2.596797           -2.596797
2    2022-01-14 2022-01-14            41    -0.015731            0.624405
3    2022-03-14 2022-03-14            44     3.605243            3.630872
4    2022-05-14 2022-05-14            43     1.166814            1.166814
5    2022-07-14 2022-07-14            44     2.275295            2.275295
6    2022-09-14 2022-09-14            43     0.019017            0.019017
7    2022-11-14 2022-11-14            43    -0.093903           -0.806569
8    2023-01-14 2023-01-14            41     1.898865           -1.512001
9    2023-03-14 2023-03-14            44    -0.658221           -0.833429
10   2023-05-14 2023-05-14            44     4.055520            4.055520
11   2023-07-14 2023-07-14            44    -5.179654           -5.074293
12   2023-09-14 2023-09-14            43     1.327473            0.903637
13   2023-11-14 2023-11-14            42    -1.340773           -0.527585
14   2024-01-14 2024-01-14            43    -2.266886           -0.091221
15   2024-03-14 2024-03-14            42     2.522025           -3.575690
16   2024-05-14 2024-05-14            44    -0.336600           -0.082816
17   2024-07-14 2024-07-14            45     0.798888            0.798888
18   2024-09-14 2024-09-14            43     0.601562           -1.307698
19   2024-11-14 2024-11-14            33     1.741863            1.491099
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              2.5 |          1.5 | True          
[INFO] 2021-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -0.0 |              0.6 |          0.6 | True          
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.1 |             -0.8 |         -0.7 | False         
[INFO] 2023-01-14   |          1.9 |             -1.5 |         -3.4 | False         
[INFO] 2023-03-14   |         -0.7 |             -0.8 |         -0.1 | False         
[INFO] 2023-05-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -5.2 |             -5.1 |          0.1 | True          
[INFO] 2023-09-14   |          1.3 |              0.9 |         -0.4 | False         
[INFO] 2023-11-14   |         -1.3 |             -0.5 |          0.8 | True          
[INFO] 2024-01-14   |         -2.3 |             -0.1 |          2.2 | True          
[INFO] 2024-03-14   |          2.5 |             -3.6 |         -6.1 | False         
[INFO] 2024-05-14   |         -0.3 |             -0.1 |          0.2 | True          
[INFO] 2024-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.6 |             -1.3 |         -1.9 | False         
[INFO] 2024-11-14   |          1.7 |              1.5 |         -0.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 6 of 13 periods (46.15% win rate)
[INFO] Updating Excel file with Kmeans results for BP...
[INFO] Excel file updated successfully. Added BP with Kmeans win rate 46.2% in row 5
[INFO] Added best Sharpe parameters 42/58 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 58
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/100) - Original Sharpe: 0.5612
[INFO] Added cluster 2 to portfolio: SMA(36/76) - Original Sharpe: 0.4568
[INFO] Added cluster 3 to portfolio: SMA(20/136) - Original Sharpe: 0.3881
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BP_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2802
[INFO] Kmeans Best out-of-sample Sharpe: 0.5729
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for BP...
[INFO] Excel file updated successfully. Added BP with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BP
[INFO] Big Point Value: 62500.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1761 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.5321 to 0.7750
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 58
[INFO] Sharpe Ratio: 0.774978
[INFO] Number of Trades: 39
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1761 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.5321 to 0.7750
[INFO] Trades range: 10.0 to 242.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.8850 to 2.8740
[INFO] Scaled Long SMA range: -2.0962 to 1.9674
[INFO] Scaled Sharpe ratio range: -3.0776 to 2.9035
[INFO] Scaled Trades range: -0.6308 to 14.7709
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1761 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6266
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 129 elements
[INFO] Cluster 1: 184 elements
[INFO] Cluster 2: 153 elements
[INFO] Cluster 3: 170 elements
[INFO] Cluster 4: 294 elements
[INFO] Cluster 5: 44 elements
[INFO] Cluster 6: 96 elements
[INFO] Cluster 7: 140 elements
[INFO] Cluster 8: 80 elements
[INFO] Cluster 9: 16 elements
[INFO] Cluster 10: 238 elements
[INFO] Cluster 11: 2 elements
[INFO] Cluster 12: 73 elements
[INFO] Cluster 13: 142 elements
[INFO] Using 12 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=36, Long SMA=66, Sharpe=0.4870, Trades=30
[INFO] Cluster 1 cluster: Short SMA=66, Long SMA=116, Sharpe=-0.2499, Trades=13
[INFO] Cluster 2 cluster: Short SMA=126, Long SMA=170, Sharpe=-0.0660, Trades=10
[INFO] Cluster 3 cluster: Short SMA=268, Long SMA=282, Sharpe=-0.1746, Trades=15
[INFO] Cluster 4 cluster: Short SMA=26, Long SMA=226, Sharpe=-0.0003, Trades=12
[INFO] Cluster 5 cluster: Short SMA=28, Long SMA=44, Sharpe=-0.0661, Trades=53
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=58, Sharpe=0.1090, Trades=39
[INFO] Cluster 7 cluster: Short SMA=26, Long SMA=126, Sharpe=0.3174, Trades=13
[INFO] Cluster 8 cluster: Short SMA=206, Long SMA=220, Sharpe=0.0237, Trades=14
[INFO] Cluster 10 cluster: Short SMA=58, Long SMA=196, Sharpe=0.0016, Trades=11
[INFO] Cluster 12 cluster: Short SMA=56, Long SMA=108, Sharpe=0.0758, Trades=13
[INFO] Cluster 13 cluster: Short SMA=22, Long SMA=102, Sharpe=0.5188, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=58, Sharpe=0.7750, Trades=39
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=22, Long SMA=102, Sharpe=0.5188, Trades=17
[INFO] Top 2: Short SMA=36, Long SMA=66, Sharpe=0.4870, Trades=30
[INFO] Top 3: Short SMA=26, Long SMA=126, Sharpe=0.3174, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 12 valid clusters with clusters
[INFO] Filtering to 1743 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 58
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(22/102) - Original Sharpe: 0.5188, Trades: 17
[INFO] Hierarchical cluster 2: SMA(36/66) - Original Sharpe: 0.4870, Trades: 30
[INFO] Hierarchical cluster 3: SMA(26/126) - Original Sharpe: 0.3174, Trades: 13
[INFO] Hierarchical cluster 4: SMA(26/58) - Original Sharpe: 0.1090, Trades: 39
[INFO] Hierarchical cluster 5: SMA(56/108) - Original Sharpe: 0.0758, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/58)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (22/102) - Sharpe: 0.5188
[INFO] cluster 2: (36/66) - Sharpe: 0.4870
[INFO] cluster 3: (26/126) - Sharpe: 0.3174
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.987883            2.470739
1    2021-11-14 2021-11-14            43    -2.596797           -2.596797
2    2022-01-14 2022-01-14            41    -0.015731            2.657312
3    2022-03-14 2022-03-14            44     3.605243            3.605243
4    2022-05-14 2022-05-14            43     1.166814            1.166814
5    2022-07-14 2022-07-14            44     2.275295            2.275295
6    2022-09-14 2022-09-14            43     0.019017            0.019017
7    2022-11-14 2022-11-14            43    -0.093903           -0.364579
8    2023-01-14 2023-01-14            41     1.898865           -0.887742
9    2023-03-14 2023-03-14            44    -0.658221           -0.667218
10   2023-05-14 2023-05-14            44     4.055520            4.055520
11   2023-07-14 2023-07-14            44    -5.179654           -4.566425
12   2023-09-14 2023-09-14            43     1.327473            0.903637
13   2023-11-14 2023-11-14            42    -1.340773           -2.323421
14   2024-01-14 2024-01-14            43    -2.266886           -0.228408
15   2024-03-14 2024-03-14            42     2.522025           -3.754745
16   2024-05-14 2024-05-14            44    -0.336600            0.393737
17   2024-07-14 2024-07-14            45     0.798888            0.798888
18   2024-09-14 2024-09-14            43     0.601562           -0.713558
19   2024-11-14 2024-11-14            33     1.741863            1.183272
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              2.5 |          1.5 | True          
[INFO] 2021-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -0.0 |              2.7 |          2.7 | True          
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.1 |             -0.4 |         -0.3 | False         
[INFO] 2023-01-14   |          1.9 |             -0.9 |         -2.8 | False         
[INFO] 2023-03-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2023-05-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -5.2 |             -4.6 |          0.6 | True          
[INFO] 2023-09-14   |          1.3 |              0.9 |         -0.4 | False         
[INFO] 2023-11-14   |         -1.3 |             -2.3 |         -1.0 | False         
[INFO] 2024-01-14   |         -2.3 |             -0.2 |          2.1 | True          
[INFO] 2024-03-14   |          2.5 |             -3.8 |         -6.3 | False         
[INFO] 2024-05-14   |         -0.3 |              0.4 |          0.7 | True          
[INFO] 2024-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.6 |             -0.7 |         -1.3 | False         
[INFO] 2024-11-14   |          1.7 |              1.2 |         -0.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-03-14, 2023-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 12 periods (41.67% win rate)
[INFO] Updating Excel file with Hierarchical results for BP...
[INFO] Excel file updated successfully. Added BP with Hierarchical win rate 41.7% in row 5
[INFO] Added best Sharpe parameters 42/58 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 58
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(22/102) - Original Sharpe: 0.5188
[INFO] Added cluster 2 to portfolio: SMA(36/66) - Original Sharpe: 0.4870
[INFO] Added cluster 3 to portfolio: SMA(26/126) - Original Sharpe: 0.3174
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BP_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3308
[INFO] Hierarchical Best out-of-sample Sharpe: 0.5729
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for BP...
[INFO] Excel file updated successfully. Added BP with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BP
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BRN in column D: 12.0
[INFO] Using slippage from Excel column D: 12.0
[INFO] 
Symbol: @BRN=107XC
[INFO] Description: Brent Crude Oil Custom Continuous Contract
[INFO] Exchange: ICE
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 1000.0
[INFO] Data shape: (4305, 6)
[INFO] Date range: 2008-08-04 16:50:00 to 2025-04-07 16:50:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high    low   close   volume
0 2008-08-04 16:50:00  105.59  105.90  99.40  100.91  51914.0
1 2008-08-05 16:50:00   99.15  100.57  97.60   97.82  41121.0
2 2008-08-06 16:50:00   97.69   99.21  96.05   97.19  19682.0
3 2008-08-07 16:50:00   97.61   99.74  96.38   97.97  20263.0
4 2008-08-08 16:50:00   97.69   98.23  93.43   93.43  23829.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 28.61 seconds (0.48 minutes)
[INFO] Best parameters found: Short SMA = 10, Long SMA = 26
[INFO] Best fitness (Sharpe ratio): 1.115955
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 10, Long SMA = 26, Sharpe = 1.115955
[INFO] Top 2: Short SMA = 14, Long SMA = 26, Sharpe = 1.040637
[INFO] Top 3: Short SMA = 10, Long SMA = 24, Sharpe = 1.013595
[INFO] Top 4: Short SMA = 12, Long SMA = 22, Sharpe = 1.010803
[INFO] Top 5: Short SMA = 16, Long SMA = 26, Sharpe = 1.010220
[INFO] Hall of Fame size: 2389
[INFO] Number of elements in all_results: 2132
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 257 had penalty fitness
[INFO] Total filtered from Hall of Fame: 257
[INFO] Hall of Fame -> all_results: 2389 -> 2132
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2132 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3107, Evaluation data length: 2840
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BRN=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.82 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $59,570.00
[INFO] Market Buy & Hold P&L: $-13,990.00
[INFO] Outperformance: $73,560.00
[INFO] Sharpe ratio (entire period, annualized): 0.088554
[INFO] Sharpe ratio (in-sample, annualized): 0.295203
[INFO] Sharpe ratio (out-of-sample, annualized): -0.368880
[INFO] Maximum Drawdown: $328,550.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $174,590.00
[INFO] Out-of-sample P&L: $-98,540.00
[INFO] 
Best parameters from GA: Short SMA = 10, Long SMA = 26, Sharpe = 1.115955
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2389
[INFO] Cache hits (repeated combinations): 6252
[INFO] Total checks: 8641
[INFO] Cache hit rate: 72.35%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2132 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8070 to 1.1160
[INFO] 
Best parameters:
[INFO] Short SMA: 10
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 1.115955
[INFO] Number of Trades: 66
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2132 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8070 to 1.1160
[INFO] Trades range: 10.0 to 222.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1523 to 2.1716
[INFO] Scaled Long SMA range: -2.5534 to 1.3353
[INFO] Scaled Sharpe ratio range: -4.3511 to 3.3233
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 12
[INFO] Using 12 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=12...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 164 elements
[INFO] Kmeans Cluster 1: 271 elements
[INFO] Kmeans Cluster 2: 146 elements
[INFO] Kmeans Cluster 3: 111 elements
[INFO] Kmeans Cluster 4: 134 elements
[INFO] Kmeans Cluster 5: 165 elements
[INFO] Kmeans Cluster 6: 167 elements
[INFO] Kmeans Cluster 7: 115 elements
[INFO] Kmeans Cluster 8: 240 elements
[INFO] Kmeans Cluster 9: 230 elements
[INFO] Kmeans Cluster 10: 261 elements
[INFO] Kmeans Cluster 11: 128 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=200.38, Long SMA=246.09, Sharpe=0.3529
[INFO] Centroid 1: Short SMA=26.55, Long SMA=204.21, Sharpe=0.3733
[INFO] Centroid 2: Short SMA=24.32, Long SMA=46.51, Sharpe=0.6957
[INFO] Centroid 3: Short SMA=151.77, Long SMA=198.43, Sharpe=0.1930
[INFO] Centroid 4: Short SMA=257.16, Long SMA=287.09, Sharpe=-0.0269
[INFO] Centroid 5: Short SMA=28.64, Long SMA=78.23, Sharpe=0.4405
[INFO] Centroid 6: Short SMA=87.25, Long SMA=208.69, Sharpe=-0.0147
[INFO] Centroid 7: Short SMA=95.79, Long SMA=138.07, Sharpe=-0.2687
[INFO] Centroid 8: Short SMA=29.13, Long SMA=266.37, Sharpe=0.3725
[INFO] Centroid 9: Short SMA=181.06, Long SMA=212.45, Sharpe=0.5463
[INFO] Centroid 10: Short SMA=216.28, Long SMA=276.61, Sharpe=0.1703
[INFO] Centroid 11: Short SMA=30.31, Long SMA=133.94, Sharpe=0.2079
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=10, Long SMA=26, Sharpe=1.1160, Trades=66
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=182, Long SMA=214, Sharpe=0.5974, Trades=14
[INFO] Kmeans Top 2: Short SMA=26, Long SMA=46, Sharpe=0.5494, Trades=49
[INFO] Kmeans Top 3: Short SMA=32, Long SMA=84, Sharpe=0.5195, Trades=27
[INFO] Kmeans Top 4: Short SMA=26, Long SMA=266, Sharpe=0.4705, Trades=12
[INFO] Kmeans Top 5: Short SMA=26, Long SMA=210, Sharpe=0.3790, Trades=14
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11}
[INFO]   Rounded: (200, 246)
[INFO]   Rounded: (27, 204)
[INFO]   Nearest: (26.0, 204.0)
[INFO]   Rounded: (24, 47)
[INFO]   Nearest: (24.0, 46.0)
[INFO]   Rounded: (152, 198)
[INFO]   Rounded: (257, 287)
[INFO]   Nearest: (258.0, 288.0)
[INFO]   Rounded: (29, 78)
[INFO]   Nearest: (28.0, 78.0)
[INFO]   Rounded: (87, 209)
[INFO]   Nearest: (88.0, 208.0)
[INFO]   Rounded: (96, 138)
[INFO]   Rounded: (29, 266)
[INFO]   Nearest: (30.0, 266.0)
[INFO]   Rounded: (181, 212)
[INFO]   Nearest: (182.0, 212.0)
[INFO]   Rounded: (216, 277)
[INFO]   Nearest: (216.0, 276.0)
[INFO]   Rounded: (30, 134)
[INFO] Successfully plotted 12 out of 12 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 10, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(182/214) - Original Sharpe: 0.5974, Trades: 14
[INFO] Kmeans cluster 2: SMA(26/46) - Original Sharpe: 0.5494, Trades: 49
[INFO] Kmeans cluster 3: SMA(32/84) - Original Sharpe: 0.5195, Trades: 27
[INFO] Kmeans cluster 4: SMA(26/266) - Original Sharpe: 0.4705, Trades: 12
[INFO] Kmeans cluster 5: SMA(26/210) - Original Sharpe: 0.3790, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (10/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (182/214) - Sharpe: 0.5974
[INFO] cluster 2: (26/46) - Sharpe: 0.5494
[INFO] cluster 3: (32/84) - Sharpe: 0.5195
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     4.800806            1.927524
1    2021-11-14 2021-11-14            44     2.049644           -3.292411
2    2022-01-14 2022-01-14            41     3.528418            3.290890
3    2022-03-14 2022-03-14            44     0.138982           -0.143350
4    2022-05-14 2022-05-14            43     1.388289           -0.718144
5    2022-07-14 2022-07-14            44    -3.155014            1.549405
6    2022-09-14 2022-09-14            43    -0.180219            0.211465
7    2022-11-14 2022-11-14            43    -1.334805           -3.001429
8    2023-01-14 2023-01-14            41    -0.581478            1.797610
9    2023-03-14 2023-03-14            43    -0.524319            0.350377
10   2023-05-14 2023-05-14            44    -1.200228           -1.707234
11   2023-07-14 2023-07-14            44     0.362193            1.210281
12   2023-09-14 2023-09-14            43    -2.369631           -1.463814
13   2023-11-14 2023-11-14            42     1.581330            0.747007
14   2024-01-14 2024-01-14            43     1.622963            0.687434
15   2024-03-14 2024-03-14            42     4.138827            0.424545
16   2024-05-14 2024-05-14            44    -0.527309           -4.461610
17   2024-07-14 2024-07-14            45     1.437611            1.114702
18   2024-09-14 2024-09-14            43    -0.271801           -0.632335
19   2024-11-14 2024-11-14            33     1.096941           -3.480074
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          4.8 |              1.9 |         -2.9 | False         
[INFO] 2021-11-14   |          2.0 |             -3.3 |         -5.3 | False         
[INFO] 2022-01-14   |          3.5 |              3.3 |         -0.2 | False         
[INFO] 2022-03-14   |          0.1 |             -0.1 |         -0.2 | False         
[INFO] 2022-05-14   |          1.4 |             -0.7 |         -2.1 | False         
[INFO] 2022-07-14   |         -3.2 |              1.5 |          4.7 | True          
[INFO] 2022-09-14   |         -0.2 |              0.2 |          0.4 | True          
[INFO] 2022-11-14   |         -1.3 |             -3.0 |         -1.7 | False         
[INFO] 2023-01-14   |         -0.6 |              1.8 |          2.4 | True          
[INFO] 2023-03-14   |         -0.5 |              0.4 |          0.9 | True          
[INFO] 2023-05-14   |         -1.2 |             -1.7 |         -0.5 | False         
[INFO] 2023-07-14   |          0.4 |              1.2 |          0.8 | True          
[INFO] 2023-09-14   |         -2.4 |             -1.5 |          0.9 | True          
[INFO] 2023-11-14   |          1.6 |              0.7 |         -0.9 | False         
[INFO] 2024-01-14   |          1.6 |              0.7 |         -0.9 | False         
[INFO] 2024-03-14   |          4.1 |              0.4 |         -3.7 | False         
[INFO] 2024-05-14   |         -0.5 |             -4.5 |         -4.0 | False         
[INFO] 2024-07-14   |          1.4 |              1.1 |         -0.3 | False         
[INFO] 2024-09-14   |         -0.3 |             -0.6 |         -0.3 | False         
[INFO] 2024-11-14   |          1.1 |             -3.5 |         -4.6 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 6 of 20 periods (30.00% win rate)
[INFO] Updating Excel file with Kmeans results for BRN...
[INFO] Excel file updated successfully. Added BRN with Kmeans win rate 30.0% in row 6
[INFO] Added best Sharpe parameters 10/26 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 10, Long SMA: 26
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(182/214) - Original Sharpe: 0.5974
[INFO] Added cluster 2 to portfolio: SMA(26/46) - Original Sharpe: 0.5494
[INFO] Added cluster 3 to portfolio: SMA(32/84) - Original Sharpe: 0.5195
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BRN_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1746
[INFO] Kmeans Best out-of-sample Sharpe: 0.6187
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for BRN...
[INFO] Excel file updated successfully. Added BRN with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BRN
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2132 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8070 to 1.1160
[INFO] 
Best parameters:
[INFO] Short SMA: 10
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 1.115955
[INFO] Number of Trades: 66
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2132 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8070 to 1.1160
[INFO] Trades range: 10.0 to 222.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1523 to 2.1716
[INFO] Scaled Long SMA range: -2.5534 to 1.3353
[INFO] Scaled Sharpe ratio range: -4.3511 to 3.3233
[INFO] Scaled Trades range: -0.7109 to 13.3382
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2132 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6611
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 290 elements
[INFO] Cluster 1: 344 elements
[INFO] Cluster 2: 149 elements
[INFO] Cluster 3: 23 elements
[INFO] Cluster 4: 127 elements
[INFO] Cluster 5: 339 elements
[INFO] Cluster 6: 7 elements
[INFO] Cluster 7: 198 elements
[INFO] Cluster 8: 141 elements
[INFO] Cluster 9: 127 elements
[INFO] Cluster 10: 185 elements
[INFO] Cluster 11: 76 elements
[INFO] Cluster 12: 92 elements
[INFO] Cluster 13: 34 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=184, Long SMA=226, Sharpe=0.4652, Trades=14
[INFO] Cluster 1 cluster: Short SMA=208, Long SMA=272, Sharpe=0.2212, Trades=13
[INFO] Cluster 2 cluster: Short SMA=96, Long SMA=144, Sharpe=-0.0596, Trades=16
[INFO] Cluster 3 cluster: Short SMA=32, Long SMA=36, Sharpe=0.1658, Trades=79
[INFO] Cluster 4 cluster: Short SMA=274, Long SMA=288, Sharpe=0.2205, Trades=19
[INFO] Cluster 5 cluster: Short SMA=26, Long SMA=210, Sharpe=0.3790, Trades=14
[INFO] Cluster 7 cluster: Short SMA=92, Long SMA=214, Sharpe=-0.1262, Trades=10
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=92, Sharpe=0.3790, Trades=27
[INFO] Cluster 9 cluster: Short SMA=26, Long SMA=48, Sharpe=0.4872, Trades=43
[INFO] Cluster 10 cluster: Short SMA=28, Long SMA=274, Sharpe=0.5739, Trades=13
[INFO] Cluster 11 cluster: Short SMA=20, Long SMA=134, Sharpe=0.1504, Trades=26
[INFO] Cluster 12 cluster: Short SMA=176, Long SMA=192, Sharpe=0.2467, Trades=22
[INFO] Cluster 13 cluster: Short SMA=14, Long SMA=32, Sharpe=0.7781, Trades=56
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=10, Long SMA=26, Sharpe=1.1160, Trades=66
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=14, Long SMA=32, Sharpe=0.7781, Trades=56
[INFO] Top 2: Short SMA=28, Long SMA=274, Sharpe=0.5739, Trades=13
[INFO] Top 3: Short SMA=26, Long SMA=48, Sharpe=0.4872, Trades=43
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 2125 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 10, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(14/32) - Original Sharpe: 0.7781, Trades: 56
[INFO] Hierarchical cluster 2: SMA(28/274) - Original Sharpe: 0.5739, Trades: 13
[INFO] Hierarchical cluster 3: SMA(26/48) - Original Sharpe: 0.4872, Trades: 43
[INFO] Hierarchical cluster 4: SMA(184/226) - Original Sharpe: 0.4652, Trades: 14
[INFO] Hierarchical cluster 5: SMA(26/210) - Original Sharpe: 0.3790, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (10/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (14/32) - Sharpe: 0.7781
[INFO] cluster 2: (28/274) - Sharpe: 0.5739
[INFO] cluster 3: (26/48) - Sharpe: 0.4872
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     4.800806            3.035654
1    2021-11-14 2021-11-14            44     2.049644           -2.276892
2    2022-01-14 2022-01-14            41     3.528418            3.528418
3    2022-03-14 2022-03-14            44     0.138982           -0.382395
4    2022-05-14 2022-05-14            43     1.388289           -0.285036
5    2022-07-14 2022-07-14            44    -3.155014            0.126332
6    2022-09-14 2022-09-14            43    -0.180219            0.336997
7    2022-11-14 2022-11-14            43    -1.334805           -3.000978
8    2023-01-14 2023-01-14            41    -0.581478            1.000158
9    2023-03-14 2023-03-14            43    -0.524319           -1.893804
10   2023-05-14 2023-05-14            44    -1.200228           -1.836571
11   2023-07-14 2023-07-14            44     0.362193            5.513327
12   2023-09-14 2023-09-14            43    -2.369631           -1.567864
13   2023-11-14 2023-11-14            42     1.581330            0.199639
14   2024-01-14 2024-01-14            43     1.622963            0.291204
15   2024-03-14 2024-03-14            42     4.138827            0.495613
16   2024-05-14 2024-05-14            44    -0.527309           -2.023833
17   2024-07-14 2024-07-14            45     1.437611           -0.253610
18   2024-09-14 2024-09-14            43    -0.271801           -2.744379
19   2024-11-14 2024-11-14            33     1.096941           -0.999665
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          4.8 |              3.0 |         -1.8 | False         
[INFO] 2021-11-14   |          2.0 |             -2.3 |         -4.3 | False         
[INFO] 2022-01-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-03-14   |          0.1 |             -0.4 |         -0.5 | False         
[INFO] 2022-05-14   |          1.4 |             -0.3 |         -1.7 | False         
[INFO] 2022-07-14   |         -3.2 |              0.1 |          3.3 | True          
[INFO] 2022-09-14   |         -0.2 |              0.3 |          0.5 | True          
[INFO] 2022-11-14   |         -1.3 |             -3.0 |         -1.7 | False         
[INFO] 2023-01-14   |         -0.6 |              1.0 |          1.6 | True          
[INFO] 2023-03-14   |         -0.5 |             -1.9 |         -1.4 | False         
[INFO] 2023-05-14   |         -1.2 |             -1.8 |         -0.6 | False         
[INFO] 2023-07-14   |          0.4 |              5.5 |          5.1 | True          
[INFO] 2023-09-14   |         -2.4 |             -1.6 |          0.8 | True          
[INFO] 2023-11-14   |          1.6 |              0.2 |         -1.4 | False         
[INFO] 2024-01-14   |          1.6 |              0.3 |         -1.3 | False         
[INFO] 2024-03-14   |          4.1 |              0.5 |         -3.6 | False         
[INFO] 2024-05-14   |         -0.5 |             -2.0 |         -1.5 | False         
[INFO] 2024-07-14   |          1.4 |             -0.3 |         -1.7 | False         
[INFO] 2024-09-14   |         -0.3 |             -2.7 |         -2.4 | False         
[INFO] 2024-11-14   |          1.1 |             -1.0 |         -2.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 19 periods (26.32% win rate)
[INFO] Updating Excel file with Hierarchical results for BRN...
[INFO] Excel file updated successfully. Added BRN with Hierarchical win rate 26.3% in row 6
[INFO] Added best Sharpe parameters 10/26 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 10, Long SMA: 26
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(14/32) - Original Sharpe: 0.7781
[INFO] Added cluster 2 to portfolio: SMA(28/274) - Original Sharpe: 0.5739
[INFO] Added cluster 3 to portfolio: SMA(26/48) - Original Sharpe: 0.4872
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BRN_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1049
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6187
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for BRN...
[INFO] Excel file updated successfully. Added BRN with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BRN
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for C in column D: 14.0
[INFO] Using slippage from Excel column D: 14.0
[INFO] 
Symbol: @CC
[INFO] Description: Cocoa Continuous Contract [May25]
[INFO] Exchange: ICEUS
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 10.0
[INFO] Data shape: (6334, 6)
[INFO] Date range: 2000-01-03 13:25:00 to 2025-04-07 13:25:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2000-01-03 13:25:00 -788.0 -783.0 -809.0 -801.0   188.0
1 2000-01-04 13:25:00 -801.0 -788.0 -806.0 -794.0   203.0
2 2000-01-05 13:25:00 -787.0 -779.0 -801.0 -796.0   301.0
3 2000-01-06 13:25:00 -799.0 -790.0 -805.0 -792.0   222.0
4 2000-01-07 13:25:00 -780.0 -779.0 -793.0 -779.0   225.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 20.34 seconds (0.34 minutes)
[INFO] Best parameters found: Short SMA = 118, Long SMA = 134
[INFO] Best fitness (Sharpe ratio): 0.630269
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 118, Long SMA = 134, Sharpe = 0.630269
[INFO] Top 2: Short SMA = 116, Long SMA = 136, Sharpe = 0.550668
[INFO] Top 3: Short SMA = 120, Long SMA = 132, Sharpe = 0.544761
[INFO] Top 4: Short SMA = 118, Long SMA = 132, Sharpe = 0.496520
[INFO] Top 5: Short SMA = 122, Long SMA = 128, Sharpe = 0.488040
[INFO] Hall of Fame size: 2203
[INFO] Number of elements in all_results: 1753
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 450 had penalty fitness
[INFO] Total filtered from Hall of Fame: 450
[INFO] Hall of Fame -> all_results: 2203 -> 1753
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1753 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CC
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 10.33 contracts
[INFO] Maximum Position Size: 18 contracts
[INFO] Strategy Total P&L: $-566,350.00
[INFO] Market Buy & Hold P&L: $114,720.00
[INFO] Outperformance: $-681,070.00
[INFO] Sharpe ratio (entire period, annualized): -0.628907
[INFO] Sharpe ratio (in-sample, annualized): -0.074012
[INFO] Sharpe ratio (out-of-sample, annualized): -1.696277
[INFO] Maximum Drawdown: $604,560.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-38,270.00
[INFO] Out-of-sample P&L: $-460,580.00
[INFO] 
Best parameters from GA: Short SMA = 118, Long SMA = 134, Sharpe = 0.630269
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2203
[INFO] Cache hits (repeated combinations): 6435
[INFO] Total checks: 8638
[INFO] Cache hit rate: 74.50%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 10.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1753 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -1.6553 to 0.6303
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.630269
[INFO] Number of Trades: 39
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1753 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -1.6553 to 0.6303
[INFO] Trades range: 10.0 to 156.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5499 to 1.9233
[INFO] Scaled Long SMA range: -2.9120 to 1.2493
[INFO] Scaled Sharpe ratio range: -5.3566 to 2.8197
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 18
[INFO] Using 18 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=18...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 61 elements
[INFO] Kmeans Cluster 1: 127 elements
[INFO] Kmeans Cluster 2: 102 elements
[INFO] Kmeans Cluster 3: 116 elements
[INFO] Kmeans Cluster 4: 74 elements
[INFO] Kmeans Cluster 5: 72 elements
[INFO] Kmeans Cluster 6: 158 elements
[INFO] Kmeans Cluster 7: 53 elements
[INFO] Kmeans Cluster 8: 22 elements
[INFO] Kmeans Cluster 9: 25 elements
[INFO] Kmeans Cluster 10: 309 elements
[INFO] Kmeans Cluster 11: 104 elements
[INFO] Kmeans Cluster 12: 166 elements
[INFO] Kmeans Cluster 13: 111 elements
[INFO] Kmeans Cluster 14: 88 elements
[INFO] Kmeans Cluster 15: 29 elements
[INFO] Kmeans Cluster 16: 65 elements
[INFO] Kmeans Cluster 17: 71 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=229.48, Long SMA=245.97, Sharpe=-0.2165
[INFO] Centroid 1: Short SMA=50.11, Long SMA=137.81, Sharpe=-0.3415
[INFO] Centroid 2: Short SMA=107.69, Long SMA=280.90, Sharpe=-0.1804
[INFO] Centroid 3: Short SMA=118.63, Long SMA=140.19, Sharpe=0.2779
[INFO] Centroid 4: Short SMA=76.91, Long SMA=207.36, Sharpe=-0.1398
[INFO] Centroid 5: Short SMA=46.97, Long SMA=120.72, Sharpe=-0.5569
[INFO] Centroid 6: Short SMA=227.22, Long SMA=257.22, Sharpe=0.0605
[INFO] Centroid 7: Short SMA=25.13, Long SMA=283.25, Sharpe=-0.6115
[INFO] Centroid 8: Short SMA=18.55, Long SMA=56.36, Sharpe=-1.3073
[INFO] Centroid 9: Short SMA=56.00, Long SMA=74.32, Sharpe=-0.1672
[INFO] Centroid 10: Short SMA=260.76, Long SMA=287.70, Sharpe=0.0286
[INFO] Centroid 11: Short SMA=98.75, Long SMA=147.73, Sharpe=-0.0214
[INFO] Centroid 12: Short SMA=133.00, Long SMA=184.90, Sharpe=-0.2807
[INFO] Centroid 13: Short SMA=179.48, Long SMA=219.24, Sharpe=-0.0484
[INFO] Centroid 14: Short SMA=73.25, Long SMA=283.61, Sharpe=-0.3483
[INFO] Centroid 15: Short SMA=28.48, Long SMA=91.86, Sharpe=-0.8291
[INFO] Centroid 16: Short SMA=30.28, Long SMA=210.18, Sharpe=-0.4426
[INFO] Centroid 17: Short SMA=106.51, Long SMA=263.94, Sharpe=0.0195
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6303, Trades=39
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=120, Long SMA=140, Sharpe=0.1853, Trades=29
[INFO] Kmeans Top 2: Short SMA=262, Long SMA=288, Sharpe=0.0731, Trades=17
[INFO] Kmeans Top 3: Short SMA=52, Long SMA=66, Sharpe=-0.0421, Trades=54
[INFO] Kmeans Top 4: Short SMA=184, Long SMA=218, Sharpe=-0.0550, Trades=16
[INFO] Kmeans Top 5: Short SMA=228, Long SMA=258, Sharpe=-0.0615, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17}
[INFO]   Rounded: (229, 246)
[INFO]   Nearest: (230.0, 246.0)
[INFO]   Rounded: (50, 138)
[INFO]   Rounded: (108, 281)
[INFO]   Nearest: (108.0, 280.0)
[INFO]   Rounded: (119, 140)
[INFO]   Nearest: (118.0, 140.0)
[INFO]   Rounded: (77, 207)
[INFO]   Nearest: (76.0, 208.0)
[INFO]   Rounded: (47, 121)
[INFO]   Nearest: (46.0, 120.0)
[INFO]   Rounded: (227, 257)
[INFO]   Nearest: (228.0, 258.0)
[INFO]   Rounded: (25, 283)
[INFO]   Nearest: (26.0, 284.0)
[INFO]   Rounded: (19, 56)
[INFO]   Nearest: (18.0, 56.0)
[INFO]   Rounded: (56, 74)
[INFO]   Rounded: (261, 288)
[INFO]   Nearest: (260.0, 288.0)
[INFO]   Rounded: (99, 148)
[INFO]   Nearest: (98.0, 148.0)
[INFO]   Rounded: (133, 185)
[INFO]   Nearest: (132.0, 184.0)
[INFO]   Rounded: (179, 219)
[INFO]   Nearest: (180.0, 220.0)
[INFO]   Rounded: (73, 284)
[INFO]   Nearest: (74.0, 284.0)
[INFO]   Rounded: (28, 92)
[INFO]   Rounded: (30, 210)
[INFO]   Rounded: (107, 264)
[INFO]   Nearest: (106.0, 264.0)
[INFO] Successfully plotted 18 out of 18 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(120/140) - Original Sharpe: 0.1853, Trades: 29
[INFO] Kmeans cluster 2: SMA(262/288) - Original Sharpe: 0.0731, Trades: 17
[INFO] Kmeans cluster 3: SMA(52/66) - Original Sharpe: -0.0421, Trades: 54
[INFO] Kmeans cluster 4: SMA(184/218) - Original Sharpe: -0.0550, Trades: 16
[INFO] Kmeans cluster 5: SMA(228/258) - Original Sharpe: -0.0615, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] Error: No Kmeans cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\C
[INFO] Big Point Value: 10.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1753 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -1.6553 to 0.6303
[INFO] 
Best parameters:
[INFO] Short SMA: 118
[INFO] Long SMA: 134
[INFO] Sharpe Ratio: 0.630269
[INFO] Number of Trades: 39
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1753 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -1.6553 to 0.6303
[INFO] Trades range: 10.0 to 156.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5499 to 1.9233
[INFO] Scaled Long SMA range: -2.9120 to 1.2493
[INFO] Scaled Sharpe ratio range: -5.3566 to 2.8197
[INFO] Scaled Trades range: -0.7913 to 10.2340
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1753 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5136
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 363 elements
[INFO] Cluster 1: 173 elements
[INFO] Cluster 2: 212 elements
[INFO] Cluster 3: 111 elements
[INFO] Cluster 4: 14 elements
[INFO] Cluster 5: 34 elements
[INFO] Cluster 6: 233 elements
[INFO] Cluster 7: 113 elements
[INFO] Cluster 8: 52 elements
[INFO] Cluster 9: 166 elements
[INFO] Cluster 10: 37 elements
[INFO] Cluster 11: 45 elements
[INFO] Cluster 12: 32 elements
[INFO] Cluster 13: 71 elements
[INFO] Cluster 14: 97 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=254, Long SMA=284, Sharpe=0.0877, Trades=15
[INFO] Cluster 1 cluster: Short SMA=102, Long SMA=142, Sharpe=0.0876, Trades=21
[INFO] Cluster 2 cluster: Short SMA=126, Long SMA=190, Sharpe=-0.2162, Trades=13
[INFO] Cluster 3 cluster: Short SMA=26, Long SMA=244, Sharpe=-0.4287, Trades=16
[INFO] Cluster 5 cluster: Short SMA=18, Long SMA=56, Sharpe=-1.5142, Trades=54
[INFO] Cluster 6 cluster: Short SMA=102, Long SMA=266, Sharpe=-0.2682, Trades=10
[INFO] Cluster 7 cluster: Short SMA=234, Long SMA=248, Sharpe=0.0996, Trades=21
[INFO] Cluster 8 cluster: Short SMA=258, Long SMA=262, Sharpe=-0.1921, Trades=40
[INFO] Cluster 9 cluster: Short SMA=46, Long SMA=136, Sharpe=-0.4232, Trades=19
[INFO] Cluster 10 cluster: Short SMA=90, Long SMA=102, Sharpe=-0.4043, Trades=45
[INFO] Cluster 11 cluster: Short SMA=122, Long SMA=132, Sharpe=0.3570, Trades=47
[INFO] Cluster 12 cluster: Short SMA=14, Long SMA=136, Sharpe=-0.8110, Trades=32
[INFO] Cluster 13 cluster: Short SMA=66, Long SMA=290, Sharpe=-0.3450, Trades=10
[INFO] Cluster 14 cluster: Short SMA=182, Long SMA=232, Sharpe=0.0125, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=118, Long SMA=134, Sharpe=0.6303, Trades=39
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=122, Long SMA=132, Sharpe=0.3570, Trades=47
[INFO] Top 2: Short SMA=234, Long SMA=248, Sharpe=0.0996, Trades=21
[INFO] Top 3: Short SMA=254, Long SMA=284, Sharpe=0.0877, Trades=15
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 1739 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 118, Long SMA: 134
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(122/132) - Original Sharpe: 0.3570, Trades: 47
[INFO] Hierarchical cluster 2: SMA(234/248) - Original Sharpe: 0.0996, Trades: 21
[INFO] Hierarchical cluster 3: SMA(254/284) - Original Sharpe: 0.0877, Trades: 15
[INFO] Hierarchical cluster 4: SMA(102/142) - Original Sharpe: 0.0876, Trades: 21
[INFO] Hierarchical cluster 5: SMA(182/232) - Original Sharpe: 0.0125, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (118/134)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (122/132) - Sharpe: 0.3570
[INFO] Loading C data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     0.387066           -1.426600
1    2021-11-10 2021-11-10            41    -1.369000           -0.172778
2    2022-01-10 2022-01-10            41     1.348855            3.186316
3    2022-03-10 2022-03-10            42     3.066197            2.512542
4    2022-05-10 2022-05-10            41     0.256065            1.860229
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40     0.313270            0.868912
8    2023-01-10 2023-01-10            41     0.018666            0.018666
9    2023-03-10 2023-03-10            42     3.526516            3.526516
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -1.369719           -1.369719
19   2024-11-10 2024-11-10            35     2.120478            0.195065
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          0.4 |             -1.4 |         -1.8 | False         
[INFO] 2021-11-10   |         -1.4 |             -0.2 |          1.2 | True          
[INFO] 2022-01-10   |          1.3 |              3.2 |          1.9 | True          
[INFO] 2022-03-10   |          3.1 |              2.5 |         -0.6 | False         
[INFO] 2022-05-10   |          0.3 |              1.9 |          1.6 | True          
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |          0.3 |              0.9 |          0.6 | True          
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2024-11-10   |          2.1 |              0.2 |         -1.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-10, 2022-09-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 7
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 7 periods (57.14% win rate)
[INFO] Updating Excel file with Hierarchical results for C...
[INFO] Excel file updated successfully. Added C with Hierarchical win rate 57.1% in row 7
[INFO] Added best Sharpe parameters 118/134 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 118, Long SMA: 134
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(122/132) - Original Sharpe: 0.3570
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'C_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 1.5767
[INFO] Hierarchical Best out-of-sample Sharpe: 1.6186
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for C...
[INFO] Excel file updated successfully. Added C with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\C
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CC in column D: 40.0
[INFO] Using slippage from Excel column D: 40.0
[INFO] 
Symbol: @CC
[INFO] Description: Cocoa Continuous Contract [May25]
[INFO] Exchange: ICEUS
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 10.0
[INFO] Data shape: (6334, 6)
[INFO] Date range: 2000-01-03 13:25:00 to 2025-04-07 13:25:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2000-01-03 13:25:00 -788.0 -783.0 -809.0 -801.0   188.0
1 2000-01-04 13:25:00 -801.0 -788.0 -806.0 -794.0   203.0
2 2000-01-05 13:25:00 -787.0 -779.0 -801.0 -796.0   301.0
3 2000-01-06 13:25:00 -799.0 -790.0 -805.0 -792.0   222.0
4 2000-01-07 13:25:00 -780.0 -779.0 -793.0 -779.0   225.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 22.68 seconds (0.38 minutes)
[INFO] Best parameters found: Short SMA = 116, Long SMA = 136
[INFO] Best fitness (Sharpe ratio): 0.530913
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 116, Long SMA = 136, Sharpe = 0.530913
[INFO] Top 2: Short SMA = 116, Long SMA = 138, Sharpe = 0.474927
[INFO] Top 3: Short SMA = 118, Long SMA = 136, Sharpe = 0.429249
[INFO] Top 4: Short SMA = 116, Long SMA = 140, Sharpe = 0.417254
[INFO] Top 5: Short SMA = 120, Long SMA = 144, Sharpe = 0.412909
[INFO] Hall of Fame size: 2202
[INFO] Number of elements in all_results: 1732
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 470 had penalty fitness
[INFO] Total filtered from Hall of Fame: 470
[INFO] Hall of Fame -> all_results: 2202 -> 1732
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1732 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CC
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 10.33 contracts
[INFO] Maximum Position Size: 18 contracts
[INFO] Strategy Total P&L: $-566,350.00
[INFO] Market Buy & Hold P&L: $114,720.00
[INFO] Outperformance: $-681,070.00
[INFO] Sharpe ratio (entire period, annualized): -0.628907
[INFO] Sharpe ratio (in-sample, annualized): -0.074012
[INFO] Sharpe ratio (out-of-sample, annualized): -1.696277
[INFO] Maximum Drawdown: $604,560.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-38,270.00
[INFO] Out-of-sample P&L: $-460,580.00
[INFO] 
Best parameters from GA: Short SMA = 116, Long SMA = 136, Sharpe = 0.530913
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2202
[INFO] Cache hits (repeated combinations): 6452
[INFO] Total checks: 8654
[INFO] Cache hit rate: 74.56%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 10.0
[INFO] Slippage: 40.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1732 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -1.6001 to 0.5309
[INFO] 
Best parameters:
[INFO] Short SMA: 116
[INFO] Long SMA: 136
[INFO] Sharpe Ratio: 0.530913
[INFO] Number of Trades: 35
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1732 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -1.6001 to 0.5309
[INFO] Trades range: 10.0 to 111.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5475 to 1.9143
[INFO] Scaled Long SMA range: -2.9807 to 1.2143
[INFO] Scaled Sharpe ratio range: -5.1334 to 2.5223
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 112 elements
[INFO] Kmeans Cluster 1: 127 elements
[INFO] Kmeans Cluster 2: 161 elements
[INFO] Kmeans Cluster 3: 109 elements
[INFO] Kmeans Cluster 4: 50 elements
[INFO] Kmeans Cluster 5: 163 elements
[INFO] Kmeans Cluster 6: 62 elements
[INFO] Kmeans Cluster 7: 23 elements
[INFO] Kmeans Cluster 8: 101 elements
[INFO] Kmeans Cluster 9: 52 elements
[INFO] Kmeans Cluster 10: 107 elements
[INFO] Kmeans Cluster 11: 49 elements
[INFO] Kmeans Cluster 12: 308 elements
[INFO] Kmeans Cluster 13: 62 elements
[INFO] Kmeans Cluster 14: 166 elements
[INFO] Kmeans Cluster 15: 80 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=179.25, Long SMA=218.80, Sharpe=-0.0553
[INFO] Centroid 1: Short SMA=44.58, Long SMA=148.74, Sharpe=-0.3931
[INFO] Centroid 2: Short SMA=227.68, Long SMA=258.62, Sharpe=0.0481
[INFO] Centroid 3: Short SMA=117.47, Long SMA=141.78, Sharpe=0.2395
[INFO] Centroid 4: Short SMA=30.52, Long SMA=106.08, Sharpe=-0.7544
[INFO] Centroid 5: Short SMA=89.25, Long SMA=284.36, Sharpe=-0.2991
[INFO] Centroid 6: Short SMA=65.74, Long SMA=95.45, Sharpe=-0.3570
[INFO] Centroid 7: Short SMA=18.61, Long SMA=53.39, Sharpe=-1.3219
[INFO] Centroid 8: Short SMA=95.84, Long SMA=146.99, Sharpe=-0.0433
[INFO] Centroid 9: Short SMA=27.50, Long SMA=225.35, Sharpe=-0.4667
[INFO] Centroid 10: Short SMA=106.64, Long SMA=268.65, Sharpe=-0.0259
[INFO] Centroid 11: Short SMA=237.47, Long SMA=252.61, Sharpe=-0.2460
[INFO] Centroid 12: Short SMA=261.02, Long SMA=287.71, Sharpe=0.0239
[INFO] Centroid 13: Short SMA=27.42, Long SMA=282.65, Sharpe=-0.6078
[INFO] Centroid 14: Short SMA=134.76, Long SMA=184.17, Sharpe=-0.2967
[INFO] Centroid 15: Short SMA=73.75, Long SMA=206.72, Sharpe=-0.1516
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=116, Long SMA=136, Sharpe=0.5309, Trades=35
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=118, Long SMA=142, Sharpe=0.2316, Trades=27
[INFO] Kmeans Top 2: Short SMA=262, Long SMA=288, Sharpe=0.0639, Trades=17
[INFO] Kmeans Top 3: Short SMA=184, Long SMA=218, Sharpe=-0.0637, Trades=16
[INFO] Kmeans Top 4: Short SMA=228, Long SMA=258, Sharpe=-0.0689, Trades=13
[INFO] Kmeans Top 5: Short SMA=70, Long SMA=208, Sharpe=-0.0856, Trades=11
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (179, 219)
[INFO]   Nearest: (180.0, 218.0)
[INFO]   Rounded: (45, 149)
[INFO]   Nearest: (44.0, 148.0)
[INFO]   Rounded: (228, 259)
[INFO]   Nearest: (228.0, 258.0)
[INFO]   Rounded: (117, 142)
[INFO]   Nearest: (118.0, 142.0)
[INFO]   Rounded: (31, 106)
[INFO]   Nearest: (30.0, 106.0)
[INFO]   Rounded: (89, 284)
[INFO]   Nearest: (90.0, 284.0)
[INFO]   Rounded: (66, 95)
[INFO]   Nearest: (66.0, 96.0)
[INFO]   Rounded: (19, 53)
[INFO]   Nearest: (18.0, 54.0)
[INFO]   Rounded: (96, 147)
[INFO]   Nearest: (96.0, 146.0)
[INFO]   Rounded: (27, 225)
[INFO]   Nearest: (28.0, 226.0)
[INFO]   Rounded: (107, 269)
[INFO]   Nearest: (106.0, 268.0)
[INFO]   Rounded: (237, 253)
[INFO]   Nearest: (238.0, 252.0)
[INFO]   Rounded: (261, 288)
[INFO]   Nearest: (262.0, 288.0)
[INFO]   Rounded: (27, 283)
[INFO]   Nearest: (28.0, 282.0)
[INFO]   Rounded: (135, 184)
[INFO]   Nearest: (134.0, 184.0)
[INFO]   Rounded: (74, 207)
[INFO]   Nearest: (74.0, 206.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 116, Long SMA: 136
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(118/142) - Original Sharpe: 0.2316, Trades: 27
[INFO] Kmeans cluster 2: SMA(262/288) - Original Sharpe: 0.0639, Trades: 17
[INFO] Kmeans cluster 3: SMA(184/218) - Original Sharpe: -0.0637, Trades: 16
[INFO] Kmeans cluster 4: SMA(228/258) - Original Sharpe: -0.0689, Trades: 13
[INFO] Kmeans cluster 5: SMA(70/208) - Original Sharpe: -0.0856, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (116/136)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (118/142) - Sharpe: 0.2316
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.309456            1.034140
1    2021-11-10 2021-11-10            41    -1.394418            1.008760
2    2022-01-10 2022-01-10            41     1.819612            2.035924
3    2022-03-10 2022-03-10            42     3.066197            3.066197
4    2022-05-10 2022-05-10            41    -0.483265            1.743357
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40    -0.338943            0.932188
8    2023-01-10 2023-01-10            41     0.018666            0.018666
9    2023-03-10 2023-03-10            42     3.526516            3.526516
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -0.990746           -1.741166
19   2024-11-10 2024-11-10            35     4.371729            4.371729
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.3 |              1.0 |          1.3 | True          
[INFO] 2021-11-10   |         -1.4 |              1.0 |          2.4 | True          
[INFO] 2022-01-10   |          1.8 |              2.0 |          0.2 | True          
[INFO] 2022-03-10   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -0.5 |              1.7 |          2.2 | True          
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |         -0.3 |              0.9 |          1.2 | True          
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.0 |             -1.7 |         -0.7 | False         
[INFO] 2024-11-10   |          4.4 |              4.4 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-10, 2022-07-10, 2022-09-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 6
[INFO] Kmeans cluster wins (rounded comparison): 5 of 6 periods (83.33% win rate)
[INFO] Updating Excel file with Kmeans results for CC...
[INFO] Excel file updated successfully. Added CC with Kmeans win rate 83.3% in row 8
[INFO] Added best Sharpe parameters 116/136 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 116, Long SMA: 136
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(118/142) - Original Sharpe: 0.2316
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 2.0089
[INFO] Kmeans Best out-of-sample Sharpe: 1.7296
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for CC...
[INFO] Excel file updated successfully. Added CC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CC
[INFO] Big Point Value: 10.0
[INFO] Slippage: 40.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1732 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -1.6001 to 0.5309
[INFO] 
Best parameters:
[INFO] Short SMA: 116
[INFO] Long SMA: 136
[INFO] Sharpe Ratio: 0.530913
[INFO] Number of Trades: 35
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1732 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -1.6001 to 0.5309
[INFO] Trades range: 10.0 to 111.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5475 to 1.9143
[INFO] Scaled Long SMA range: -2.9807 to 1.2143
[INFO] Scaled Sharpe ratio range: -5.1334 to 2.5223
[INFO] Scaled Trades range: -0.7891 to 7.1925
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1732 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5636
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 19
[INFO] Using 19 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 19 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 71 elements
[INFO] Cluster 1: 47 elements
[INFO] Cluster 2: 67 elements
[INFO] Cluster 3: 34 elements
[INFO] Cluster 4: 10 elements
[INFO] Cluster 5: 110 elements
[INFO] Cluster 6: 194 elements
[INFO] Cluster 7: 166 elements
[INFO] Cluster 8: 91 elements
[INFO] Cluster 9: 37 elements
[INFO] Cluster 10: 54 elements
[INFO] Cluster 11: 82 elements
[INFO] Cluster 12: 228 elements
[INFO] Cluster 13: 91 elements
[INFO] Cluster 14: 119 elements
[INFO] Cluster 15: 91 elements
[INFO] Cluster 16: 68 elements
[INFO] Cluster 17: 35 elements
[INFO] Cluster 18: 137 elements
[INFO] Using 18 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=184, Long SMA=196, Sharpe=-0.1738, Trades=29
[INFO] Cluster 1 cluster: Short SMA=92, Long SMA=104, Sharpe=-0.3804, Trades=47
[INFO] Cluster 2 cluster: Short SMA=46, Long SMA=118, Sharpe=-0.3801, Trades=23
[INFO] Cluster 3 cluster: Short SMA=20, Long SMA=48, Sharpe=-1.6001, Trades=61
[INFO] Cluster 5 cluster: Short SMA=94, Long SMA=152, Sharpe=-0.0408, Trades=17
[INFO] Cluster 6 cluster: Short SMA=92, Long SMA=284, Sharpe=-0.2326, Trades=10
[INFO] Cluster 7 cluster: Short SMA=270, Long SMA=288, Sharpe=-0.0627, Trades=17
[INFO] Cluster 8 cluster: Short SMA=24, Long SMA=272, Sharpe=-0.5858, Trades=17
[INFO] Cluster 9 cluster: Short SMA=270, Long SMA=272, Sharpe=0.0167, Trades=43
[INFO] Cluster 10 cluster: Short SMA=116, Long SMA=142, Sharpe=0.3791, Trades=25
[INFO] Cluster 11 cluster: Short SMA=64, Long SMA=202, Sharpe=-0.1534, Trades=13
[INFO] Cluster 12 cluster: Short SMA=236, Long SMA=280, Sharpe=-0.0465, Trades=12
[INFO] Cluster 13 cluster: Short SMA=118, Long SMA=270, Sharpe=-0.0790, Trades=10
[INFO] Cluster 14 cluster: Short SMA=44, Long SMA=144, Sharpe=-0.2805, Trades=17
[INFO] Cluster 15 cluster: Short SMA=180, Long SMA=226, Sharpe=0.1294, Trades=14
[INFO] Cluster 16 cluster: Short SMA=228, Long SMA=242, Sharpe=0.0048, Trades=22
[INFO] Cluster 17 cluster: Short SMA=128, Long SMA=136, Sharpe=0.2143, Trades=45
[INFO] Cluster 18 cluster: Short SMA=128, Long SMA=188, Sharpe=-0.2722, Trades=13
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=116, Long SMA=136, Sharpe=0.5309, Trades=35
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=116, Long SMA=142, Sharpe=0.3791, Trades=25
[INFO] Top 2: Short SMA=128, Long SMA=136, Sharpe=0.2143, Trades=45
[INFO] Top 3: Short SMA=180, Long SMA=226, Sharpe=0.1294, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 18 valid clusters with clusters
[INFO] Filtering to 1722 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 116, Long SMA: 136
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(116/142) - Original Sharpe: 0.3791, Trades: 25
[INFO] Hierarchical cluster 2: SMA(128/136) - Original Sharpe: 0.2143, Trades: 45
[INFO] Hierarchical cluster 3: SMA(180/226) - Original Sharpe: 0.1294, Trades: 14
[INFO] Hierarchical cluster 4: SMA(270/272) - Original Sharpe: 0.0167, Trades: 43
[INFO] Hierarchical cluster 5: SMA(228/242) - Original Sharpe: 0.0048, Trades: 22
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (116/136)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (116/142) - Sharpe: 0.3791
[INFO] cluster 2: (128/136) - Sharpe: 0.2143
[INFO] Loading CC data from local files...
[INFO] Found data file: A_OHLCV_@CC_minutes_1440_0450-1325.dat
[INFO] File size: 304166 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.309456           -0.517637
1    2021-11-10 2021-11-10            41    -1.394418            2.316009
2    2022-01-10 2022-01-10            41     1.819612            1.590611
3    2022-03-10 2022-03-10            42     3.066197            3.066197
4    2022-05-10 2022-05-10            41    -0.483265           -0.228034
5    2022-07-10 2022-07-10            44    -0.056982           -0.056982
6    2022-09-10 2022-09-10            43    -2.001238           -2.001238
7    2022-11-10 2022-11-10            40    -0.338943           -0.016401
8    2023-01-10 2023-01-10            41     0.018666            0.018666
9    2023-03-10 2023-03-10            42     3.526516            3.526516
10   2023-05-10 2023-05-10            40     3.523275            3.523275
11   2023-07-10 2023-07-10            44     2.641624            2.641624
12   2023-09-10 2023-09-10            44     2.086602            2.086602
13   2023-11-10 2023-11-10            40     1.143754            1.143754
14   2024-01-10 2024-01-10            41     7.678302            7.678302
15   2024-03-10 2024-03-10            43     3.486175            3.486175
16   2024-05-10 2024-05-10            40     0.314588            0.314588
17   2024-07-10 2024-07-10            43     1.107642            1.107642
18   2024-09-10 2024-09-10            44    -0.990746           -0.966916
19   2024-11-10 2024-11-10            35     4.371729            4.253724
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.3 |             -0.5 |         -0.2 | False         
[INFO] 2021-11-10   |         -1.4 |              2.3 |          3.7 | True          
[INFO] 2022-01-10   |          1.8 |              1.6 |         -0.2 | False         
[INFO] 2022-03-10   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -0.5 |             -0.2 |          0.3 | True          
[INFO] 2022-07-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-09-10   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2022-11-10   |         -0.3 |             -0.0 |          0.3 | True          
[INFO] 2023-01-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-05-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2023-07-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-01-10   |          7.7 |              7.7 |          0.0 | Excluded      
[INFO] 2024-03-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-05-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2024-11-10   |          4.4 |              4.3 |         -0.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-10, 2022-07-10, 2022-09-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 6
[INFO] Hierarchical cluster wins (rounded comparison): 3 of 6 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for CC...
[INFO] Excel file updated successfully. Added CC with Hierarchical win rate 50.0% in row 8
[INFO] Added best Sharpe parameters 116/136 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 116, Long SMA: 136
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(116/142) - Original Sharpe: 0.3791
[INFO] Added cluster 2 to portfolio: SMA(128/136) - Original Sharpe: 0.2143
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 1.9111
[INFO] Hierarchical Best out-of-sample Sharpe: 1.7296
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for CC...
[INFO] Excel file updated successfully. Added CC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CC
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CD in column D: 7.0
[INFO] Using slippage from Excel column D: 7.0
[INFO] 
Symbol: @CD
[INFO] Description: Canadian Dollar Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.000000000000001
[INFO] Big point value: 100000.0
[INFO] Data shape: (6170, 6)
[INFO] Date range: 2001-05-14 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-14 15:57:00  0.6300  0.6303  0.6281  0.6291  1861.0
1 2001-05-15 15:57:00  0.6287  0.6316  0.6275  0.6314  1684.0
2 2001-05-16 15:57:00  0.6316  0.6356  0.6308  0.6344  2667.0
3 2001-05-17 15:57:00  0.6345  0.6367  0.6343  0.6359   949.0
4 2001-05-18 15:57:00  0.6358  0.6385  0.6347  0.6371  1388.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 21.99 seconds (0.37 minutes)
[INFO] Best parameters found: Short SMA = 38, Long SMA = 44
[INFO] Best fitness (Sharpe ratio): 0.791094
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 38, Long SMA = 44, Sharpe = 0.791094
[INFO] Top 2: Short SMA = 16, Long SMA = 22, Sharpe = 0.729774
[INFO] Top 3: Short SMA = 18, Long SMA = 52, Sharpe = 0.723576
[INFO] Top 4: Short SMA = 20, Long SMA = 46, Sharpe = 0.705945
[INFO] Top 5: Short SMA = 36, Long SMA = 46, Sharpe = 0.697169
[INFO] Hall of Fame size: 2243
[INFO] Number of elements in all_results: 1646
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 597 had penalty fitness
[INFO] Total filtered from Hall of Fame: 597
[INFO] Hall of Fame -> all_results: 2243 -> 1646
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1646 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CD
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 12.56 contracts
[INFO] Maximum Position Size: 24 contracts
[INFO] Strategy Total P&L: $411,830.00
[INFO] Market Buy & Hold P&L: $-25,775.00
[INFO] Outperformance: $437,605.00
[INFO] Sharpe ratio (entire period, annualized): 0.478801
[INFO] Sharpe ratio (in-sample, annualized): 0.341515
[INFO] Sharpe ratio (out-of-sample, annualized): 0.809584
[INFO] Maximum Drawdown: $160,470.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $176,525.00
[INFO] Out-of-sample P&L: $173,695.00
[INFO] 
Best parameters from GA: Short SMA = 38, Long SMA = 44, Sharpe = 0.791094
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2243
[INFO] Cache hits (repeated combinations): 6414
[INFO] Total checks: 8657
[INFO] Cache hit rate: 74.09%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 7.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1646 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.6711 to 0.7911
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 44
[INFO] Sharpe Ratio: 0.791094
[INFO] Number of Trades: 67
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1646 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.6711 to 0.7911
[INFO] Trades range: 10.0 to 235.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.8822 to 2.1786
[INFO] Scaled Long SMA range: -2.0653 to 1.4039
[INFO] Scaled Sharpe ratio range: -3.0799 to 2.9375
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 93 elements
[INFO] Kmeans Cluster 1: 162 elements
[INFO] Kmeans Cluster 2: 80 elements
[INFO] Kmeans Cluster 3: 97 elements
[INFO] Kmeans Cluster 4: 95 elements
[INFO] Kmeans Cluster 5: 109 elements
[INFO] Kmeans Cluster 6: 119 elements
[INFO] Kmeans Cluster 7: 149 elements
[INFO] Kmeans Cluster 8: 58 elements
[INFO] Kmeans Cluster 9: 131 elements
[INFO] Kmeans Cluster 10: 117 elements
[INFO] Kmeans Cluster 11: 76 elements
[INFO] Kmeans Cluster 12: 119 elements
[INFO] Kmeans Cluster 13: 56 elements
[INFO] Kmeans Cluster 14: 101 elements
[INFO] Kmeans Cluster 15: 84 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=258.73, Long SMA=278.32, Sharpe=0.2701
[INFO] Centroid 1: Short SMA=23.49, Long SMA=160.98, Sharpe=0.2012
[INFO] Centroid 2: Short SMA=43.15, Long SMA=187.53, Sharpe=-0.0622
[INFO] Centroid 3: Short SMA=211.57, Long SMA=238.54, Sharpe=-0.3978
[INFO] Centroid 4: Short SMA=153.33, Long SMA=181.16, Sharpe=0.2125
[INFO] Centroid 5: Short SMA=24.02, Long SMA=45.82, Sharpe=0.5720
[INFO] Centroid 6: Short SMA=22.61, Long SMA=282.82, Sharpe=-0.0496
[INFO] Centroid 7: Short SMA=268.91, Long SMA=286.83, Sharpe=0.0068
[INFO] Centroid 8: Short SMA=80.69, Long SMA=117.93, Sharpe=-0.3433
[INFO] Centroid 9: Short SMA=24.31, Long SMA=213.51, Sharpe=0.1107
[INFO] Centroid 10: Short SMA=27.30, Long SMA=99.08, Sharpe=0.1038
[INFO] Centroid 11: Short SMA=194.42, Long SMA=232.16, Sharpe=-0.2178
[INFO] Centroid 12: Short SMA=22.53, Long SMA=51.35, Sharpe=0.3670
[INFO] Centroid 13: Short SMA=123.43, Long SMA=162.18, Sharpe=-0.0061
[INFO] Centroid 14: Short SMA=25.07, Long SMA=263.52, Sharpe=0.0758
[INFO] Centroid 15: Short SMA=39.84, Long SMA=104.54, Sharpe=-0.0695
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=44, Sharpe=0.7911, Trades=67
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=24, Long SMA=46, Sharpe=0.5423, Trades=36
[INFO] Kmeans Top 2: Short SMA=22, Long SMA=54, Sharpe=0.4281, Trades=34
[INFO] Kmeans Top 3: Short SMA=258, Long SMA=278, Sharpe=0.3219, Trades=15
[INFO] Kmeans Top 4: Short SMA=24, Long SMA=98, Sharpe=0.1844, Trades=26
[INFO] Kmeans Top 5: Short SMA=154, Long SMA=180, Sharpe=0.1519, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (259, 278)
[INFO]   Nearest: (258.0, 278.0)
[INFO]   Rounded: (23, 161)
[INFO]   Nearest: (24.0, 160.0)
[INFO]   Rounded: (43, 188)
[INFO]   Nearest: (44.0, 188.0)
[INFO]   Rounded: (212, 239)
[INFO]   Nearest: (212.0, 238.0)
[INFO]   Rounded: (153, 181)
[INFO]   Nearest: (154.0, 182.0)
[INFO]   Rounded: (24, 46)
[INFO]   Rounded: (23, 283)
[INFO]   Nearest: (22.0, 282.0)
[INFO]   Rounded: (269, 287)
[INFO]   Nearest: (268.0, 286.0)
[INFO]   Rounded: (81, 118)
[INFO]   Nearest: (80.0, 118.0)
[INFO]   Rounded: (24, 214)
[INFO]   Rounded: (27, 99)
[INFO]   Nearest: (28.0, 100.0)
[INFO]   Rounded: (194, 232)
[INFO]   Rounded: (23, 51)
[INFO]   Nearest: (22.0, 52.0)
[INFO]   Rounded: (123, 162)
[INFO]   Nearest: (124.0, 162.0)
[INFO]   Rounded: (25, 264)
[INFO]   Nearest: (26.0, 264.0)
[INFO]   Rounded: (40, 105)
[INFO]   Nearest: (40.0, 104.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 44
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(24/46) - Original Sharpe: 0.5423, Trades: 36
[INFO] Kmeans cluster 2: SMA(22/54) - Original Sharpe: 0.4281, Trades: 34
[INFO] Kmeans cluster 3: SMA(258/278) - Original Sharpe: 0.3219, Trades: 15
[INFO] Kmeans cluster 4: SMA(24/98) - Original Sharpe: 0.1844, Trades: 26
[INFO] Kmeans cluster 5: SMA(154/180) - Original Sharpe: 0.1519, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/44)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/46) - Sharpe: 0.5423
[INFO] cluster 2: (22/54) - Sharpe: 0.4281
[INFO] cluster 3: (258/278) - Sharpe: 0.3219
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -4.559447           -3.366935
1    2021-11-14 2021-11-14            43    -2.832319           -3.463395
2    2022-01-14 2022-01-14            41    -0.950707           -2.963267
3    2022-03-14 2022-03-14            44    -3.892117           -2.516267
4    2022-05-14 2022-05-14            43     0.644192            0.889409
5    2022-07-14 2022-07-14            44    -4.160323           -1.294274
6    2022-09-14 2022-09-14            43     1.032024            0.987674
7    2022-11-14 2022-11-14            43    -0.748377           -1.014457
8    2023-01-14 2023-01-14            41    -4.124943            0.424201
9    2023-03-14 2023-03-14            44     0.052422           -3.773470
10   2023-05-14 2023-05-14            44    -2.505249           -0.740829
11   2023-07-14 2023-07-14            44    -2.114246           -0.169890
12   2023-09-14 2023-09-14            43     1.988935            1.281609
13   2023-11-14 2023-11-14            42    -3.835381           -1.595965
14   2024-01-14 2024-01-14            43    -1.838269           -1.457784
15   2024-03-14 2024-03-14            42     1.898357           -0.221249
16   2024-05-14 2024-05-14            44     1.248914           -0.904708
17   2024-07-14 2024-07-14            45     0.220219           -4.186549
18   2024-09-14 2024-09-14            43     0.081170            1.719854
19   2024-11-14 2024-11-14            33     3.870625            3.959554
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -4.6 |             -3.4 |          1.2 | True          
[INFO] 2021-11-14   |         -2.8 |             -3.5 |         -0.7 | False         
[INFO] 2022-01-14   |         -1.0 |             -3.0 |         -2.0 | False         
[INFO] 2022-03-14   |         -3.9 |             -2.5 |          1.4 | True          
[INFO] 2022-05-14   |          0.6 |              0.9 |          0.3 | True          
[INFO] 2022-07-14   |         -4.2 |             -1.3 |          2.9 | True          
[INFO] 2022-09-14   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.7 |             -1.0 |         -0.3 | False         
[INFO] 2023-01-14   |         -4.1 |              0.4 |          4.5 | True          
[INFO] 2023-03-14   |          0.1 |             -3.8 |         -3.9 | False         
[INFO] 2023-05-14   |         -2.5 |             -0.7 |          1.8 | True          
[INFO] 2023-07-14   |         -2.1 |             -0.2 |          1.9 | True          
[INFO] 2023-09-14   |          2.0 |              1.3 |         -0.7 | False         
[INFO] 2023-11-14   |         -3.8 |             -1.6 |          2.2 | True          
[INFO] 2024-01-14   |         -1.8 |             -1.5 |          0.3 | True          
[INFO] 2024-03-14   |          1.9 |             -0.2 |         -2.1 | False         
[INFO] 2024-05-14   |          1.2 |             -0.9 |         -2.1 | False         
[INFO] 2024-07-14   |          0.2 |             -4.2 |         -4.4 | False         
[INFO] 2024-09-14   |          0.1 |              1.7 |          1.6 | True          
[INFO] 2024-11-14   |          3.9 |              4.0 |          0.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 11 of 19 periods (57.89% win rate)
[INFO] Updating Excel file with Kmeans results for CD...
[INFO] Excel file updated successfully. Added CD with Kmeans win rate 57.9% in row 9
[INFO] Added best Sharpe parameters 38/44 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 44
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/46) - Original Sharpe: 0.5423
[INFO] Added cluster 2 to portfolio: SMA(22/54) - Original Sharpe: 0.4281
[INFO] Added cluster 3 to portfolio: SMA(258/278) - Original Sharpe: 0.3219
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.9045
[INFO] Kmeans Best out-of-sample Sharpe: -0.9993
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for CD...
[INFO] Excel file updated successfully. Added CD with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CD
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 7.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1646 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.6711 to 0.7911
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 44
[INFO] Sharpe Ratio: 0.791094
[INFO] Number of Trades: 67
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1646 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.6711 to 0.7911
[INFO] Trades range: 10.0 to 235.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.8822 to 2.1786
[INFO] Scaled Long SMA range: -2.0653 to 1.4039
[INFO] Scaled Sharpe ratio range: -3.0799 to 2.9375
[INFO] Scaled Trades range: -0.7610 to 11.5287
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1646 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.7097
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 142 elements
[INFO] Cluster 1: 51 elements
[INFO] Cluster 2: 90 elements
[INFO] Cluster 3: 158 elements
[INFO] Cluster 4: 202 elements
[INFO] Cluster 5: 150 elements
[INFO] Cluster 6: 165 elements
[INFO] Cluster 7: 42 elements
[INFO] Cluster 8: 7 elements
[INFO] Cluster 9: 183 elements
[INFO] Cluster 10: 136 elements
[INFO] Cluster 11: 94 elements
[INFO] Cluster 12: 81 elements
[INFO] Cluster 13: 129 elements
[INFO] Cluster 14: 16 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=272, Long SMA=290, Sharpe=-0.0291, Trades=13
[INFO] Cluster 1 cluster: Short SMA=20, Long SMA=28, Sharpe=0.2096, Trades=78
[INFO] Cluster 2 cluster: Short SMA=76, Long SMA=120, Sharpe=-0.1369, Trades=22
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=190, Sharpe=0.1426, Trades=14
[INFO] Cluster 4 cluster: Short SMA=24, Long SMA=108, Sharpe=-0.0456, Trades=26
[INFO] Cluster 5 cluster: Short SMA=22, Long SMA=52, Sharpe=0.3588, Trades=36
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=242, Sharpe=0.0383, Trades=16
[INFO] Cluster 7 cluster: Short SMA=146, Long SMA=160, Sharpe=0.1518, Trades=25
[INFO] Cluster 9 cluster: Short SMA=204, Long SMA=238, Sharpe=-0.4418, Trades=11
[INFO] Cluster 10 cluster: Short SMA=24, Long SMA=166, Sharpe=0.3033, Trades=18
[INFO] Cluster 11 cluster: Short SMA=258, Long SMA=278, Sharpe=0.3219, Trades=15
[INFO] Cluster 12 cluster: Short SMA=154, Long SMA=186, Sharpe=0.2106, Trades=11
[INFO] Cluster 13 cluster: Short SMA=20, Long SMA=282, Sharpe=-0.0838, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=44, Sharpe=0.7911, Trades=67
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=22, Long SMA=52, Sharpe=0.3588, Trades=36
[INFO] Top 2: Short SMA=258, Long SMA=278, Sharpe=0.3219, Trades=15
[INFO] Top 3: Short SMA=24, Long SMA=166, Sharpe=0.3033, Trades=18
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 1623 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 44
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(22/52) - Original Sharpe: 0.3588, Trades: 36
[INFO] Hierarchical cluster 2: SMA(258/278) - Original Sharpe: 0.3219, Trades: 15
[INFO] Hierarchical cluster 3: SMA(24/166) - Original Sharpe: 0.3033, Trades: 18
[INFO] Hierarchical cluster 4: SMA(154/186) - Original Sharpe: 0.2106, Trades: 11
[INFO] Hierarchical cluster 5: SMA(20/28) - Original Sharpe: 0.2096, Trades: 78
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/44)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (22/52) - Sharpe: 0.3588
[INFO] cluster 2: (258/278) - Sharpe: 0.3219
[INFO] cluster 3: (24/166) - Sharpe: 0.3033
[INFO] Loading CD data from local files...
[INFO] Found data file: A_OHLCV_@CD_minutes_1440_1703-1557.dat
[INFO] File size: 296302 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -4.559447           -3.646625
1    2021-11-14 2021-11-14            43    -2.832319           -3.208016
2    2022-01-14 2022-01-14            41    -0.950707           -2.277164
3    2022-03-14 2022-03-14            44    -3.892117           -1.961191
4    2022-05-14 2022-05-14            43     0.644192            0.844942
5    2022-07-14 2022-07-14            44    -4.160323            0.396257
6    2022-09-14 2022-09-14            43     1.032024            0.987674
7    2022-11-14 2022-11-14            43    -0.748377           -0.297675
8    2023-01-14 2023-01-14            41    -4.124943            2.052035
9    2023-03-14 2023-03-14            44     0.052422           -2.306706
10   2023-05-14 2023-05-14            44    -2.505249           -0.476484
11   2023-07-14 2023-07-14            44    -2.114246           -1.575508
12   2023-09-14 2023-09-14            43     1.988935            1.281609
13   2023-11-14 2023-11-14            42    -3.835381           -4.712953
14   2024-01-14 2024-01-14            43    -1.838269           -2.686724
15   2024-03-14 2024-03-14            42     1.898357           -0.221249
16   2024-05-14 2024-05-14            44     1.248914           -0.012073
17   2024-07-14 2024-07-14            45     0.220219           -2.325962
18   2024-09-14 2024-09-14            43     0.081170            0.928735
19   2024-11-14 2024-11-14            33     3.870625            3.959554
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -4.6 |             -3.6 |          1.0 | True          
[INFO] 2021-11-14   |         -2.8 |             -3.2 |         -0.4 | False         
[INFO] 2022-01-14   |         -1.0 |             -2.3 |         -1.3 | False         
[INFO] 2022-03-14   |         -3.9 |             -2.0 |          1.9 | True          
[INFO] 2022-05-14   |          0.6 |              0.8 |          0.2 | True          
[INFO] 2022-07-14   |         -4.2 |              0.4 |          4.6 | True          
[INFO] 2022-09-14   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.7 |             -0.3 |          0.4 | True          
[INFO] 2023-01-14   |         -4.1 |              2.1 |          6.2 | True          
[INFO] 2023-03-14   |          0.1 |             -2.3 |         -2.4 | False         
[INFO] 2023-05-14   |         -2.5 |             -0.5 |          2.0 | True          
[INFO] 2023-07-14   |         -2.1 |             -1.6 |          0.5 | True          
[INFO] 2023-09-14   |          2.0 |              1.3 |         -0.7 | False         
[INFO] 2023-11-14   |         -3.8 |             -4.7 |         -0.9 | False         
[INFO] 2024-01-14   |         -1.8 |             -2.7 |         -0.9 | False         
[INFO] 2024-03-14   |          1.9 |             -0.2 |         -2.1 | False         
[INFO] 2024-05-14   |          1.2 |             -0.0 |         -1.2 | False         
[INFO] 2024-07-14   |          0.2 |             -2.3 |         -2.5 | False         
[INFO] 2024-09-14   |          0.1 |              0.9 |          0.8 | True          
[INFO] 2024-11-14   |          3.9 |              4.0 |          0.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 19 periods (52.63% win rate)
[INFO] Updating Excel file with Hierarchical results for CD...
[INFO] Excel file updated successfully. Added CD with Hierarchical win rate 52.6% in row 9
[INFO] Added best Sharpe parameters 38/44 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 44
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(22/52) - Original Sharpe: 0.3588
[INFO] Added cluster 2 to portfolio: SMA(258/278) - Original Sharpe: 0.3219
[INFO] Added cluster 3 to portfolio: SMA(24/166) - Original Sharpe: 0.3033
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CD_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.5331
[INFO] Hierarchical Best out-of-sample Sharpe: -0.9993
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for CD...
[INFO] Excel file updated successfully. Added CD with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CD
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CL in column D: 14.0
[INFO] Using slippage from Excel column D: 14.0
[INFO] 
Symbol: @CL
[INFO] Description: Crude Oil Continuous Contract [May25]
[INFO] Exchange: NYMEX
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 1000.0
[INFO] Data shape: (6119, 6)
[INFO] Date range: 2001-05-14 16:55:00 to 2025-04-07 16:55:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close    volume
0 2001-05-14 16:55:00  86.00  86.11  85.38  86.11   30340.0
1 2001-05-15 16:55:00  86.00  86.40  85.90  86.28  158030.0
2 2001-05-16 16:55:00  86.48  86.58  85.70  86.19   63875.0
3 2001-05-17 16:55:00  86.05  86.34  85.74  86.22   30100.0
4 2001-05-18 16:55:00  86.45  87.30  86.36  87.18   32979.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 23.62 seconds (0.39 minutes)
[INFO] Best parameters found: Short SMA = 48, Long SMA = 50
[INFO] Best fitness (Sharpe ratio): 0.878812
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 48, Long SMA = 50, Sharpe = 0.878812
[INFO] Top 2: Short SMA = 42, Long SMA = 48, Sharpe = 0.840649
[INFO] Top 3: Short SMA = 38, Long SMA = 40, Sharpe = 0.803304
[INFO] Top 4: Short SMA = 38, Long SMA = 60, Sharpe = 0.769722
[INFO] Top 5: Short SMA = 38, Long SMA = 62, Sharpe = 0.766730
[INFO] Hall of Fame size: 2371
[INFO] Number of elements in all_results: 2163
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 208 had penalty fitness
[INFO] Total filtered from Hall of Fame: 208
[INFO] Hall of Fame -> all_results: 2371 -> 2163
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2163 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3106, Evaluation data length: 2839
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CL
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.78 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $101,130.00
[INFO] Market Buy & Hold P&L: $-27,500.00
[INFO] Outperformance: $128,630.00
[INFO] Sharpe ratio (entire period, annualized): 0.113513
[INFO] Sharpe ratio (in-sample, annualized): 0.328434
[INFO] Sharpe ratio (out-of-sample, annualized): -0.359695
[INFO] Maximum Drawdown: $322,940.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $192,010.00
[INFO] Out-of-sample P&L: $-95,480.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.878812
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2371
[INFO] Cache hits (repeated combinations): 6269
[INFO] Total checks: 8640
[INFO] Cache hit rate: 72.56%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2163 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5572 to 0.8788
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.878812
[INFO] Number of Trades: 108
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2163 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5572 to 0.8788
[INFO] Trades range: 10.0 to 224.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1304 to 2.4020
[INFO] Scaled Long SMA range: -2.3899 to 1.3973
[INFO] Scaled Sharpe ratio range: -3.5994 to 3.2730
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 98 elements
[INFO] Kmeans Cluster 1: 129 elements
[INFO] Kmeans Cluster 2: 254 elements
[INFO] Kmeans Cluster 3: 169 elements
[INFO] Kmeans Cluster 4: 143 elements
[INFO] Kmeans Cluster 5: 153 elements
[INFO] Kmeans Cluster 6: 63 elements
[INFO] Kmeans Cluster 7: 66 elements
[INFO] Kmeans Cluster 8: 167 elements
[INFO] Kmeans Cluster 9: 105 elements
[INFO] Kmeans Cluster 10: 170 elements
[INFO] Kmeans Cluster 11: 213 elements
[INFO] Kmeans Cluster 12: 97 elements
[INFO] Kmeans Cluster 13: 124 elements
[INFO] Kmeans Cluster 14: 212 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=267.86, Long SMA=292.59, Sharpe=-0.2471
[INFO] Centroid 1: Short SMA=34.19, Long SMA=166.76, Sharpe=0.1209
[INFO] Centroid 2: Short SMA=194.50, Long SMA=250.99, Sharpe=0.1563
[INFO] Centroid 3: Short SMA=27.56, Long SMA=56.83, Sharpe=0.4071
[INFO] Centroid 4: Short SMA=25.43, Long SMA=269.27, Sharpe=0.3650
[INFO] Centroid 5: Short SMA=230.22, Long SMA=275.26, Sharpe=-0.0298
[INFO] Centroid 6: Short SMA=99.17, Long SMA=152.41, Sharpe=-0.0109
[INFO] Centroid 7: Short SMA=99.30, Long SMA=135.85, Sharpe=-0.2496
[INFO] Centroid 8: Short SMA=37.08, Long SMA=195.90, Sharpe=0.2994
[INFO] Centroid 9: Short SMA=167.07, Long SMA=203.54, Sharpe=0.3885
[INFO] Centroid 10: Short SMA=131.98, Long SMA=201.46, Sharpe=0.2248
[INFO] Centroid 11: Short SMA=40.74, Long SMA=234.36, Sharpe=0.1947
[INFO] Centroid 12: Short SMA=30.91, Long SMA=52.93, Sharpe=0.6267
[INFO] Centroid 13: Short SMA=149.24, Long SMA=250.84, Sharpe=0.0137
[INFO] Centroid 14: Short SMA=38.71, Long SMA=102.90, Sharpe=0.2754
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8788, Trades=108
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=34, Long SMA=52, Sharpe=0.6435, Trades=44
[INFO] Kmeans Top 2: Short SMA=26, Long SMA=56, Sharpe=0.4582, Trades=38
[INFO] Kmeans Top 3: Short SMA=38, Long SMA=196, Sharpe=0.4138, Trades=13
[INFO] Kmeans Top 4: Short SMA=24, Long SMA=270, Sharpe=0.3776, Trades=13
[INFO] Kmeans Top 5: Short SMA=38, Long SMA=104, Sharpe=0.3380, Trades=17
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (268, 293)
[INFO]   Nearest: (268.0, 292.0)
[INFO]   Rounded: (34, 167)
[INFO]   Nearest: (34.0, 166.0)
[INFO]   Rounded: (194, 251)
[INFO]   Nearest: (194.0, 250.0)
[INFO]   Rounded: (28, 57)
[INFO]   Nearest: (28.0, 56.0)
[INFO]   Rounded: (25, 269)
[INFO]   Nearest: (26.0, 270.0)
[INFO]   Rounded: (230, 275)
[INFO]   Nearest: (230.0, 276.0)
[INFO]   Rounded: (99, 152)
[INFO]   Nearest: (100.0, 152.0)
[INFO]   Rounded: (99, 136)
[INFO]   Nearest: (100.0, 136.0)
[INFO]   Rounded: (37, 196)
[INFO]   Nearest: (38.0, 196.0)
[INFO]   Rounded: (167, 204)
[INFO]   Nearest: (168.0, 204.0)
[INFO]   Rounded: (132, 201)
[INFO]   Nearest: (132.0, 202.0)
[INFO]   Rounded: (41, 234)
[INFO]   Nearest: (40.0, 234.0)
[INFO]   Rounded: (31, 53)
[INFO]   Nearest: (30.0, 52.0)
[INFO]   Rounded: (149, 251)
[INFO]   Nearest: (150.0, 250.0)
[INFO]   Rounded: (39, 103)
[INFO]   Nearest: (38.0, 102.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(34/52) - Original Sharpe: 0.6435, Trades: 44
[INFO] Kmeans cluster 2: SMA(26/56) - Original Sharpe: 0.4582, Trades: 38
[INFO] Kmeans cluster 3: SMA(38/196) - Original Sharpe: 0.4138, Trades: 13
[INFO] Kmeans cluster 4: SMA(24/270) - Original Sharpe: 0.3776, Trades: 13
[INFO] Kmeans cluster 5: SMA(38/104) - Original Sharpe: 0.3380, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/52) - Sharpe: 0.6435
[INFO] cluster 2: (26/56) - Sharpe: 0.4582
[INFO] cluster 3: (38/196) - Sharpe: 0.4138
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.084997            1.329635
1    2021-11-14 2021-11-14            43    -3.371493           -3.073685
2    2022-01-14 2022-01-14            41     0.999580            2.932759
3    2022-03-14 2022-03-14            44    -2.172742            0.096755
4    2022-05-14 2022-05-14            43    -2.742027           -1.260121
5    2022-07-14 2022-07-14            44     1.611941            1.988818
6    2022-09-14 2022-09-14            43    -0.389136           -0.486427
7    2022-11-14 2022-11-14            43    -1.067985           -2.191537
8    2023-01-14 2023-01-14            41     3.157482            1.139681
9    2023-03-14 2023-03-14            43    -3.021412            0.208390
10   2023-05-14 2023-05-14            44    -0.333860           -1.764252
11   2023-07-14 2023-07-14            44     5.741367            4.558201
12   2023-09-14 2023-09-14            43    -1.017661           -1.357886
13   2023-11-14 2023-11-14            42     1.520442            0.817348
14   2024-01-14 2024-01-14            43    -0.905207            0.765650
15   2024-03-14 2024-03-14            42     0.235563           -0.207064
16   2024-05-14 2024-05-14            44    -5.318006           -2.696594
17   2024-07-14 2024-07-14            45    -0.143393           -1.306011
18   2024-09-14 2024-09-14            43    -1.755618           -0.494678
19   2024-11-14 2024-11-14            33    -0.116449           -2.319007
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |              1.3 |          3.4 | True          
[INFO] 2021-11-14   |         -3.4 |             -3.1 |          0.3 | True          
[INFO] 2022-01-14   |          1.0 |              2.9 |          1.9 | True          
[INFO] 2022-03-14   |         -2.2 |              0.1 |          2.3 | True          
[INFO] 2022-05-14   |         -2.7 |             -1.3 |          1.4 | True          
[INFO] 2022-07-14   |          1.6 |              2.0 |          0.4 | True          
[INFO] 2022-09-14   |         -0.4 |             -0.5 |         -0.1 | False         
[INFO] 2022-11-14   |         -1.1 |             -2.2 |         -1.1 | False         
[INFO] 2023-01-14   |          3.2 |              1.1 |         -2.1 | False         
[INFO] 2023-03-14   |         -3.0 |              0.2 |          3.2 | True          
[INFO] 2023-05-14   |         -0.3 |             -1.8 |         -1.5 | False         
[INFO] 2023-07-14   |          5.7 |              4.6 |         -1.1 | False         
[INFO] 2023-09-14   |         -1.0 |             -1.4 |         -0.4 | False         
[INFO] 2023-11-14   |          1.5 |              0.8 |         -0.7 | False         
[INFO] 2024-01-14   |         -0.9 |              0.8 |          1.7 | True          
[INFO] 2024-03-14   |          0.2 |             -0.2 |         -0.4 | False         
[INFO] 2024-05-14   |         -5.3 |             -2.7 |          2.6 | True          
[INFO] 2024-07-14   |         -0.1 |             -1.3 |         -1.2 | False         
[INFO] 2024-09-14   |         -1.8 |             -0.5 |          1.3 | True          
[INFO] 2024-11-14   |         -0.1 |             -2.3 |         -2.2 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 10 of 20 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for CL...
[INFO] Excel file updated successfully. Added CL with Kmeans win rate 50.0% in row 10
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/52) - Original Sharpe: 0.6435
[INFO] Added cluster 2 to portfolio: SMA(26/56) - Original Sharpe: 0.4582
[INFO] Added cluster 3 to portfolio: SMA(38/196) - Original Sharpe: 0.4138
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CL_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1513
[INFO] Kmeans Best out-of-sample Sharpe: -0.6531
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for CL...
[INFO] Excel file updated successfully. Added CL with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CL
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2163 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5572 to 0.8788
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.878812
[INFO] Number of Trades: 108
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2163 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5572 to 0.8788
[INFO] Trades range: 10.0 to 224.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1304 to 2.4020
[INFO] Scaled Long SMA range: -2.3899 to 1.3973
[INFO] Scaled Sharpe ratio range: -3.5994 to 3.2730
[INFO] Scaled Trades range: -0.7254 to 13.2078
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2163 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5898
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 129 elements
[INFO] Cluster 1: 284 elements
[INFO] Cluster 2: 247 elements
[INFO] Cluster 3: 31 elements
[INFO] Cluster 4: 208 elements
[INFO] Cluster 5: 144 elements
[INFO] Cluster 6: 109 elements
[INFO] Cluster 7: 196 elements
[INFO] Cluster 8: 41 elements
[INFO] Cluster 9: 76 elements
[INFO] Cluster 10: 203 elements
[INFO] Cluster 11: 79 elements
[INFO] Cluster 12: 204 elements
[INFO] Cluster 13: 3 elements
[INFO] Cluster 14: 102 elements
[INFO] Cluster 15: 107 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=106, Long SMA=136, Sharpe=0.0217, Trades=19
[INFO] Cluster 1 cluster: Short SMA=188, Long SMA=242, Sharpe=0.1873, Trades=12
[INFO] Cluster 2 cluster: Short SMA=52, Long SMA=196, Sharpe=0.2633, Trades=11
[INFO] Cluster 3 cluster: Short SMA=36, Long SMA=40, Sharpe=0.7639, Trades=79
[INFO] Cluster 4 cluster: Short SMA=24, Long SMA=216, Sharpe=0.1937, Trades=17
[INFO] Cluster 5 cluster: Short SMA=30, Long SMA=58, Sharpe=0.5220, Trades=38
[INFO] Cluster 6 cluster: Short SMA=44, Long SMA=148, Sharpe=0.2310, Trades=15
[INFO] Cluster 7 cluster: Short SMA=32, Long SMA=264, Sharpe=0.3551, Trades=13
[INFO] Cluster 8 cluster: Short SMA=266, Long SMA=270, Sharpe=0.0390, Trades=37
[INFO] Cluster 9 cluster: Short SMA=170, Long SMA=186, Sharpe=0.2877, Trades=20
[INFO] Cluster 10 cluster: Short SMA=210, Long SMA=266, Sharpe=0.0543, Trades=12
[INFO] Cluster 11 cluster: Short SMA=26, Long SMA=44, Sharpe=0.4265, Trades=51
[INFO] Cluster 12 cluster: Short SMA=34, Long SMA=98, Sharpe=0.2348, Trades=22
[INFO] Cluster 14 cluster: Short SMA=134, Long SMA=256, Sharpe=0.0220, Trades=12
[INFO] Cluster 15 cluster: Short SMA=266, Long SMA=290, Sharpe=-0.2689, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8788, Trades=108
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=36, Long SMA=40, Sharpe=0.7639, Trades=79
[INFO] Top 2: Short SMA=30, Long SMA=58, Sharpe=0.5220, Trades=38
[INFO] Top 3: Short SMA=26, Long SMA=44, Sharpe=0.4265, Trades=51
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 2160 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(36/40) - Original Sharpe: 0.7639, Trades: 79
[INFO] Hierarchical cluster 2: SMA(30/58) - Original Sharpe: 0.5220, Trades: 38
[INFO] Hierarchical cluster 3: SMA(26/44) - Original Sharpe: 0.4265, Trades: 51
[INFO] Hierarchical cluster 4: SMA(32/264) - Original Sharpe: 0.3551, Trades: 13
[INFO] Hierarchical cluster 5: SMA(170/186) - Original Sharpe: 0.2877, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (36/40) - Sharpe: 0.7639
[INFO] cluster 2: (30/58) - Sharpe: 0.5220
[INFO] cluster 3: (26/44) - Sharpe: 0.4265
[INFO] Loading CL data from local files...
[INFO] Found data file: A_OHLCV_@CL_minutes_1440_1802-1655.dat
[INFO] File size: 293850 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.084997            0.743401
1    2021-11-14 2021-11-14            43    -3.371493           -4.349560
2    2022-01-14 2022-01-14            41     0.999580            2.724770
3    2022-03-14 2022-03-14            44    -2.172742           -1.746188
4    2022-05-14 2022-05-14            43    -2.742027           -1.915147
5    2022-07-14 2022-07-14            44     1.611941            2.096166
6    2022-09-14 2022-09-14            43    -0.389136           -0.149721
7    2022-11-14 2022-11-14            43    -1.067985           -4.047617
8    2023-01-14 2023-01-14            41     3.157482            3.150047
9    2023-03-14 2023-03-14            43    -3.021412           -1.557566
10   2023-05-14 2023-05-14            44    -0.333860           -0.133239
11   2023-07-14 2023-07-14            44     5.741367            4.486952
12   2023-09-14 2023-09-14            43    -1.017661           -1.079521
13   2023-11-14 2023-11-14            42     1.520442            1.520442
14   2024-01-14 2024-01-14            43    -0.905207           -0.285526
15   2024-03-14 2024-03-14            42     0.235563            0.235563
16   2024-05-14 2024-05-14            44    -5.318006           -1.843896
17   2024-07-14 2024-07-14            45    -0.143393           -0.272157
18   2024-09-14 2024-09-14            43    -1.755618           -1.096818
19   2024-11-14 2024-11-14            33    -0.116449           -1.062637
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.1 |              0.7 |          2.8 | True          
[INFO] 2021-11-14   |         -3.4 |             -4.3 |         -0.9 | False         
[INFO] 2022-01-14   |          1.0 |              2.7 |          1.7 | True          
[INFO] 2022-03-14   |         -2.2 |             -1.7 |          0.5 | True          
[INFO] 2022-05-14   |         -2.7 |             -1.9 |          0.8 | True          
[INFO] 2022-07-14   |          1.6 |              2.1 |          0.5 | True          
[INFO] 2022-09-14   |         -0.4 |             -0.1 |          0.3 | True          
[INFO] 2022-11-14   |         -1.1 |             -4.0 |         -2.9 | False         
[INFO] 2023-01-14   |          3.2 |              3.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -3.0 |             -1.6 |          1.4 | True          
[INFO] 2023-05-14   |         -0.3 |             -0.1 |          0.2 | True          
[INFO] 2023-07-14   |          5.7 |              4.5 |         -1.2 | False         
[INFO] 2023-09-14   |         -1.0 |             -1.1 |         -0.1 | False         
[INFO] 2023-11-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -0.9 |             -0.3 |          0.6 | True          
[INFO] 2024-03-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -1.8 |          3.5 | True          
[INFO] 2024-07-14   |         -0.1 |             -0.3 |         -0.2 | False         
[INFO] 2024-09-14   |         -1.8 |             -1.1 |          0.7 | True          
[INFO] 2024-11-14   |         -0.1 |             -1.1 |         -1.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-01-14, 2023-11-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 17 periods (64.71% win rate)
[INFO] Updating Excel file with Hierarchical results for CL...
[INFO] Excel file updated successfully. Added CL with Hierarchical win rate 64.7% in row 10
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(36/40) - Original Sharpe: 0.7639
[INFO] Added cluster 2 to portfolio: SMA(30/58) - Original Sharpe: 0.5220
[INFO] Added cluster 3 to portfolio: SMA(26/44) - Original Sharpe: 0.4265
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CL_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2192
[INFO] Hierarchical Best out-of-sample Sharpe: -0.6531
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for CL...
[INFO] Excel file updated successfully. Added CL with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CL
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for CT in column D: 16.0
[INFO] Using slippage from Excel column D: 16.0
[INFO] 
Symbol: @CT
[INFO] Description: Cotton No. 2 Continuous Contract [May25]
[INFO] Exchange: ICEUS
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.0
[INFO] Big point value: 500.0
[INFO] Data shape: (6116, 6)
[INFO] Date range: 2000-11-13 14:17:00 to 2025-04-07 14:17:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2000-11-13 14:17:00  83.26  83.71  83.08  83.31   211.0
1 2000-11-14 14:17:00  83.21  83.36  82.76  82.87   152.0
2 2000-11-15 14:17:00  82.63  82.76  82.41  82.61   167.0
3 2000-11-16 14:17:00  82.49  83.03  82.44  82.94   289.0
4 2000-11-17 14:17:00  82.94  83.04  82.39  82.87   266.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 27.16 seconds (0.45 minutes)
[INFO] Best parameters found: Short SMA = 34, Long SMA = 46
[INFO] Best fitness (Sharpe ratio): 0.962456
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 34, Long SMA = 46, Sharpe = 0.962456
[INFO] Top 2: Short SMA = 32, Long SMA = 46, Sharpe = 0.878673
[INFO] Top 3: Short SMA = 38, Long SMA = 44, Sharpe = 0.838327
[INFO] Top 4: Short SMA = 40, Long SMA = 44, Sharpe = 0.812204
[INFO] Top 5: Short SMA = 36, Long SMA = 40, Sharpe = 0.804601
[INFO] Hall of Fame size: 2279
[INFO] Number of elements in all_results: 1882
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 397 had penalty fitness
[INFO] Total filtered from Hall of Fame: 397
[INFO] Hall of Fame -> all_results: 2279 -> 1882
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1882 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @CT
[INFO] Big Point Value (from data): 500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.39 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $-113,885.00
[INFO] Market Buy & Hold P&L: $-135.00
[INFO] Outperformance: $-113,750.00
[INFO] Sharpe ratio (entire period, annualized): -0.159910
[INFO] Sharpe ratio (in-sample, annualized): -0.100210
[INFO] Sharpe ratio (out-of-sample, annualized): -0.291924
[INFO] Maximum Drawdown: $359,350.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-52,245.00
[INFO] Out-of-sample P&L: $-68,860.00
[INFO] 
Best parameters from GA: Short SMA = 34, Long SMA = 46, Sharpe = 0.962456
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2279
[INFO] Cache hits (repeated combinations): 6382
[INFO] Total checks: 8661
[INFO] Cache hit rate: 73.69%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 500.0
[INFO] Slippage: 16.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1882 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.6589 to 0.9625
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.962456
[INFO] Number of Trades: 60
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1882 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.6589 to 0.9625
[INFO] Trades range: 11.0 to 230.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9824 to 2.4224
[INFO] Scaled Long SMA range: -2.2213 to 1.6256
[INFO] Scaled Sharpe ratio range: -2.6098 to 3.0312
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 144 elements
[INFO] Kmeans Cluster 1: 129 elements
[INFO] Kmeans Cluster 2: 141 elements
[INFO] Kmeans Cluster 3: 115 elements
[INFO] Kmeans Cluster 4: 109 elements
[INFO] Kmeans Cluster 5: 100 elements
[INFO] Kmeans Cluster 6: 108 elements
[INFO] Kmeans Cluster 7: 79 elements
[INFO] Kmeans Cluster 8: 62 elements
[INFO] Kmeans Cluster 9: 108 elements
[INFO] Kmeans Cluster 10: 67 elements
[INFO] Kmeans Cluster 11: 99 elements
[INFO] Kmeans Cluster 12: 48 elements
[INFO] Kmeans Cluster 13: 151 elements
[INFO] Kmeans Cluster 14: 191 elements
[INFO] Kmeans Cluster 15: 69 elements
[INFO] Kmeans Cluster 16: 162 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=29.67, Long SMA=183.03, Sharpe=0.2774
[INFO] Centroid 1: Short SMA=198.51, Long SMA=240.14, Sharpe=-0.1184
[INFO] Centroid 2: Short SMA=27.84, Long SMA=139.52, Sharpe=0.3896
[INFO] Centroid 3: Short SMA=89.81, Long SMA=199.57, Sharpe=-0.2826
[INFO] Centroid 4: Short SMA=169.80, Long SMA=200.02, Sharpe=0.0946
[INFO] Centroid 5: Short SMA=31.28, Long SMA=53.02, Sharpe=0.5594
[INFO] Centroid 6: Short SMA=276.59, Long SMA=290.48, Sharpe=0.0027
[INFO] Centroid 7: Short SMA=84.10, Long SMA=137.49, Sharpe=-0.0984
[INFO] Centroid 8: Short SMA=28.52, Long SMA=53.97, Sharpe=0.0459
[INFO] Centroid 9: Short SMA=119.20, Long SMA=152.93, Sharpe=-0.4088
[INFO] Centroid 10: Short SMA=32.69, Long SMA=144.33, Sharpe=0.5695
[INFO] Centroid 11: Short SMA=31.11, Long SMA=60.89, Sharpe=0.3017
[INFO] Centroid 12: Short SMA=23.33, Long SMA=279.75, Sharpe=0.3367
[INFO] Centroid 13: Short SMA=238.36, Long SMA=275.66, Sharpe=-0.2918
[INFO] Centroid 14: Short SMA=29.86, Long SMA=240.75, Sharpe=0.1847
[INFO] Centroid 15: Short SMA=52.70, Long SMA=205.48, Sharpe=-0.0759
[INFO] Centroid 16: Short SMA=40.47, Long SMA=105.43, Sharpe=0.2278
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=46, Sharpe=0.9625, Trades=60
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=30, Long SMA=52, Sharpe=0.7164, Trades=40
[INFO] Kmeans Top 2: Short SMA=34, Long SMA=144, Sharpe=0.6381, Trades=13
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=140, Sharpe=0.4447, Trades=15
[INFO] Kmeans Top 4: Short SMA=32, Long SMA=182, Sharpe=0.3068, Trades=11
[INFO] Kmeans Top 5: Short SMA=30, Long SMA=62, Sharpe=0.2844, Trades=30
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (30, 183)
[INFO]   Nearest: (30.0, 184.0)
[INFO]   Rounded: (199, 240)
[INFO]   Nearest: (198.0, 240.0)
[INFO]   Rounded: (28, 140)
[INFO]   Rounded: (90, 200)
[INFO]   Rounded: (170, 200)
[INFO]   Rounded: (31, 53)
[INFO]   Nearest: (32.0, 54.0)
[INFO]   Rounded: (277, 290)
[INFO]   Nearest: (276.0, 290.0)
[INFO]   Rounded: (84, 137)
[INFO]   Nearest: (84.0, 138.0)
[INFO]   Rounded: (29, 54)
[INFO]   Nearest: (28.0, 54.0)
[INFO]   Rounded: (119, 153)
[INFO]   Nearest: (120.0, 152.0)
[INFO]   Rounded: (33, 144)
[INFO]   Nearest: (32.0, 144.0)
[INFO]   Rounded: (31, 61)
[INFO]   Nearest: (32.0, 60.0)
[INFO]   Rounded: (23, 280)
[INFO]   Nearest: (24.0, 280.0)
[INFO]   Rounded: (238, 276)
[INFO]   Rounded: (30, 241)
[INFO]   Nearest: (30.0, 240.0)
[INFO]   Rounded: (53, 205)
[INFO]   Nearest: (52.0, 206.0)
[INFO]   Rounded: (40, 105)
[INFO]   Nearest: (40.0, 106.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(30/52) - Original Sharpe: 0.7164, Trades: 40
[INFO] Kmeans cluster 2: SMA(34/144) - Original Sharpe: 0.6381, Trades: 13
[INFO] Kmeans cluster 3: SMA(28/140) - Original Sharpe: 0.4447, Trades: 15
[INFO] Kmeans cluster 4: SMA(32/182) - Original Sharpe: 0.3068, Trades: 11
[INFO] Kmeans cluster 5: SMA(30/62) - Original Sharpe: 0.2844, Trades: 30
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (30/52) - Sharpe: 0.7164
[INFO] cluster 2: (34/144) - Sharpe: 0.6381
[INFO] cluster 3: (28/140) - Sharpe: 0.4447
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     4.813792            4.813792
1    2021-11-10 2021-11-10            41    -1.040578           -0.281485
2    2022-01-10 2022-01-10            41    -1.414548           -0.051102
3    2022-03-10 2022-03-10            42     3.891271            3.891271
4    2022-05-10 2022-05-10            41    -1.433874           -2.809696
5    2022-07-10 2022-07-10            44    -4.366290           -4.910135
6    2022-09-10 2022-09-10            43    -3.101727            0.484625
7    2022-11-10 2022-11-10            40     2.171378            0.485366
8    2023-01-10 2023-01-10            41     0.013687            0.328531
9    2023-03-10 2023-03-10            42    -1.173054            0.034927
10   2023-05-10 2023-05-10            40     0.876456           -2.558801
11   2023-07-10 2023-07-10            44    -0.240108           -1.773093
12   2023-09-10 2023-09-10            44     1.293828           -2.076790
13   2023-11-10 2023-11-10            40    -0.460322           -0.367062
14   2024-01-10 2024-01-10            41     3.165454           -0.869511
15   2024-03-10 2024-03-10            43    -1.060941           -4.819058
16   2024-05-10 2024-05-10            40     2.090657            2.090657
17   2024-07-10 2024-07-10            43     1.137725            1.137725
18   2024-09-10 2024-09-10            44    -3.483824           -2.747416
19   2024-11-10 2024-11-10            35     0.406321            2.606033
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -1.0 |             -0.3 |          0.7 | True          
[INFO] 2022-01-10   |         -1.4 |             -0.1 |          1.3 | True          
[INFO] 2022-03-10   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.4 |             -2.8 |         -1.4 | False         
[INFO] 2022-07-10   |         -4.4 |             -4.9 |         -0.5 | False         
[INFO] 2022-09-10   |         -3.1 |              0.5 |          3.6 | True          
[INFO] 2022-11-10   |          2.2 |              0.5 |         -1.7 | False         
[INFO] 2023-01-10   |          0.0 |              0.3 |          0.3 | True          
[INFO] 2023-03-10   |         -1.2 |              0.0 |          1.2 | True          
[INFO] 2023-05-10   |          0.9 |             -2.6 |         -3.5 | False         
[INFO] 2023-07-10   |         -0.2 |             -1.8 |         -1.6 | False         
[INFO] 2023-09-10   |          1.3 |             -2.1 |         -3.4 | False         
[INFO] 2023-11-10   |         -0.5 |             -0.4 |          0.1 | True          
[INFO] 2024-01-10   |          3.2 |             -0.9 |         -4.1 | False         
[INFO] 2024-03-10   |         -1.1 |             -4.8 |         -3.7 | False         
[INFO] 2024-05-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -3.5 |             -2.7 |          0.8 | True          
[INFO] 2024-11-10   |          0.4 |              2.6 |          2.2 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2022-03-10, 2024-05-10, 2024-07-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 8 of 16 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for CT...
[INFO] Excel file updated successfully. Added CT with Kmeans win rate 50.0% in row 11
[INFO] Added best Sharpe parameters 34/46 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 46
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(30/52) - Original Sharpe: 0.7164
[INFO] Added cluster 2 to portfolio: SMA(34/144) - Original Sharpe: 0.6381
[INFO] Added cluster 3 to portfolio: SMA(28/140) - Original Sharpe: 0.4447
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CT_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0076
[INFO] Kmeans Best out-of-sample Sharpe: 0.2334
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for CT...
[INFO] Excel file updated successfully. Added CT with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CT
[INFO] Big Point Value: 500.0
[INFO] Slippage: 16.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1882 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.6589 to 0.9625
[INFO] 
Best parameters:
[INFO] Short SMA: 34
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.962456
[INFO] Number of Trades: 60
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1882 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.6589 to 0.9625
[INFO] Trades range: 11.0 to 230.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9824 to 2.4224
[INFO] Scaled Long SMA range: -2.2213 to 1.6256
[INFO] Scaled Sharpe ratio range: -2.6098 to 3.0312
[INFO] Scaled Trades range: -0.6609 to 13.0065
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1882 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6451
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 18
[INFO] Using 18 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 18 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 115 elements
[INFO] Cluster 1: 240 elements
[INFO] Cluster 2: 190 elements
[INFO] Cluster 3: 212 elements
[INFO] Cluster 4: 67 elements
[INFO] Cluster 5: 96 elements
[INFO] Cluster 6: 151 elements
[INFO] Cluster 7: 178 elements
[INFO] Cluster 8: 26 elements
[INFO] Cluster 9: 2 elements
[INFO] Cluster 10: 177 elements
[INFO] Cluster 11: 37 elements
[INFO] Cluster 12: 34 elements
[INFO] Cluster 13: 179 elements
[INFO] Cluster 14: 40 elements
[INFO] Cluster 15: 56 elements
[INFO] Cluster 16: 73 elements
[INFO] Cluster 17: 9 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=122, Long SMA=152, Sharpe=-0.1705, Trades=14
[INFO] Cluster 1 cluster: Short SMA=30, Long SMA=146, Sharpe=0.6639, Trades=13
[INFO] Cluster 2 cluster: Short SMA=74, Long SMA=196, Sharpe=-0.2574, Trades=11
[INFO] Cluster 3 cluster: Short SMA=38, Long SMA=98, Sharpe=0.3776, Trades=23
[INFO] Cluster 4 cluster: Short SMA=36, Long SMA=52, Sharpe=0.5470, Trades=47
[INFO] Cluster 5 cluster: Short SMA=276, Long SMA=290, Sharpe=0.1645, Trades=27
[INFO] Cluster 6 cluster: Short SMA=174, Long SMA=212, Sharpe=-0.0389, Trades=13
[INFO] Cluster 7 cluster: Short SMA=228, Long SMA=270, Sharpe=-0.2521, Trades=15
[INFO] Cluster 8 cluster: Short SMA=38, Long SMA=44, Sharpe=0.8383, Trades=72
[INFO] Cluster 10 cluster: Short SMA=30, Long SMA=256, Sharpe=0.1995, Trades=13
[INFO] Cluster 11 cluster: Short SMA=268, Long SMA=272, Sharpe=-0.0931, Trades=45
[INFO] Cluster 12 cluster: Short SMA=24, Long SMA=38, Sharpe=0.2662, Trades=64
[INFO] Cluster 13 cluster: Short SMA=30, Long SMA=200, Sharpe=0.3317, Trades=11
[INFO] Cluster 14 cluster: Short SMA=206, Long SMA=212, Sharpe=-0.0124, Trades=35
[INFO] Cluster 15 cluster: Short SMA=72, Long SMA=140, Sharpe=0.0113, Trades=15
[INFO] Cluster 16 cluster: Short SMA=26, Long SMA=60, Sharpe=0.3071, Trades=32
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=34, Long SMA=46, Sharpe=0.9625, Trades=60
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=44, Sharpe=0.8383, Trades=72
[INFO] Top 2: Short SMA=30, Long SMA=146, Sharpe=0.6639, Trades=13
[INFO] Top 3: Short SMA=36, Long SMA=52, Sharpe=0.5470, Trades=47
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 1871 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 34, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/44) - Original Sharpe: 0.8383, Trades: 72
[INFO] Hierarchical cluster 2: SMA(30/146) - Original Sharpe: 0.6639, Trades: 13
[INFO] Hierarchical cluster 3: SMA(36/52) - Original Sharpe: 0.5470, Trades: 47
[INFO] Hierarchical cluster 4: SMA(38/98) - Original Sharpe: 0.3776, Trades: 23
[INFO] Hierarchical cluster 5: SMA(30/200) - Original Sharpe: 0.3317, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (34/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/44) - Sharpe: 0.8383
[INFO] cluster 2: (30/146) - Sharpe: 0.6639
[INFO] cluster 3: (36/52) - Sharpe: 0.5470
[INFO] Loading CT data from local files...
[INFO] Found data file: A_OHLCV_@CT_minutes_1440_2102-1417.dat
[INFO] File size: 293709 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     4.813792            4.813792
1    2021-11-10 2021-11-10            41    -1.040578           -0.970687
2    2022-01-10 2022-01-10            41    -1.414548           -1.253777
3    2022-03-10 2022-03-10            42     3.891271            3.757813
4    2022-05-10 2022-05-10            41    -1.433874           -3.584690
5    2022-07-10 2022-07-10            44    -4.366290           -4.867902
6    2022-09-10 2022-09-10            43    -3.101727           -2.428904
7    2022-11-10 2022-11-10            40     2.171378            0.649768
8    2023-01-10 2023-01-10            41     0.013687           -4.087769
9    2023-03-10 2023-03-10            42    -1.173054           -0.908954
10   2023-05-10 2023-05-10            40     0.876456            1.907496
11   2023-07-10 2023-07-10            44    -0.240108           -0.576709
12   2023-09-10 2023-09-10            44     1.293828           -0.156707
13   2023-11-10 2023-11-10            40    -0.460322           -0.632355
14   2024-01-10 2024-01-10            41     3.165454            0.891781
15   2024-03-10 2024-03-10            43    -1.060941           -3.588276
16   2024-05-10 2024-05-10            40     2.090657            2.090657
17   2024-07-10 2024-07-10            43     1.137725            1.137725
18   2024-09-10 2024-09-10            44    -3.483824           -3.507521
19   2024-11-10 2024-11-10            35     0.406321            0.495284
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-01-10   |         -1.4 |             -1.3 |          0.1 | True          
[INFO] 2022-03-10   |          3.9 |              3.8 |         -0.1 | False         
[INFO] 2022-05-10   |         -1.4 |             -3.6 |         -2.2 | False         
[INFO] 2022-07-10   |         -4.4 |             -4.9 |         -0.5 | False         
[INFO] 2022-09-10   |         -3.1 |             -2.4 |          0.7 | True          
[INFO] 2022-11-10   |          2.2 |              0.6 |         -1.6 | False         
[INFO] 2023-01-10   |          0.0 |             -4.1 |         -4.1 | False         
[INFO] 2023-03-10   |         -1.2 |             -0.9 |          0.3 | True          
[INFO] 2023-05-10   |          0.9 |              1.9 |          1.0 | True          
[INFO] 2023-07-10   |         -0.2 |             -0.6 |         -0.4 | False         
[INFO] 2023-09-10   |          1.3 |             -0.2 |         -1.5 | False         
[INFO] 2023-11-10   |         -0.5 |             -0.6 |         -0.1 | False         
[INFO] 2024-01-10   |          3.2 |              0.9 |         -2.3 | False         
[INFO] 2024-03-10   |         -1.1 |             -3.6 |         -2.5 | False         
[INFO] 2024-05-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2024-07-10   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2024-09-10   |         -3.5 |             -3.5 |          0.0 | Excluded      
[INFO] 2024-11-10   |          0.4 |              0.5 |          0.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2024-05-10, 2024-07-10, 2024-09-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 15 periods (33.33% win rate)
[INFO] Updating Excel file with Hierarchical results for CT...
[INFO] Excel file updated successfully. Added CT with Hierarchical win rate 33.3% in row 11
[INFO] Added best Sharpe parameters 34/46 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 34, Long SMA: 46
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/44) - Original Sharpe: 0.8383
[INFO] Added cluster 2 to portfolio: SMA(30/146) - Original Sharpe: 0.6639
[INFO] Added cluster 3 to portfolio: SMA(36/52) - Original Sharpe: 0.5470
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'CT_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1951
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2334
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for CT...
[INFO] Excel file updated successfully. Added CT with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\CT
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for DX in column D: 9.0
[INFO] Using slippage from Excel column D: 9.0
[INFO] 
Symbol: @DX
[INFO] Description: U.S. Dollar Index Continuous Contract [Jun25]
[INFO] Exchange: ICEUS
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.0
[INFO] Big point value: 1000.0
[INFO] Data shape: (5562, 6)
[INFO] Date range: 2003-06-18 16:45:00 to 2025-04-07 16:45:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close    volume
0 2003-06-18 16:45:00  94.055  94.245  93.855  94.015     534.0
1 2003-06-19 16:45:00  94.155  94.705  93.785  94.045  107948.0
2 2003-06-20 16:45:00  94.005  95.385  93.805  94.905   32050.0
3 2003-06-23 16:45:00  94.915  95.295  94.705  94.875     417.0
4 2003-06-24 16:45:00  94.925  95.445  94.745  95.245   22016.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 31.08 seconds (0.52 minutes)
[INFO] Best parameters found: Short SMA = 38, Long SMA = 46
[INFO] Best fitness (Sharpe ratio): 0.858167
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 38, Long SMA = 46, Sharpe = 0.858167
[INFO] Top 2: Short SMA = 32, Long SMA = 52, Sharpe = 0.853045
[INFO] Top 3: Short SMA = 36, Long SMA = 46, Sharpe = 0.844766
[INFO] Top 4: Short SMA = 38, Long SMA = 42, Sharpe = 0.828909
[INFO] Top 5: Short SMA = 34, Long SMA = 48, Sharpe = 0.822268
[INFO] Hall of Fame size: 2641
[INFO] Number of elements in all_results: 1664
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 977 had penalty fitness
[INFO] Total filtered from Hall of Fame: 977
[INFO] Hall of Fame -> all_results: 2641 -> 1664
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1664 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3077, Evaluation data length: 2816
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @DX
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 11.44 contracts
[INFO] Maximum Position Size: 27 contracts
[INFO] Strategy Total P&L: $-472,532.00
[INFO] Market Buy & Hold P&L: $34,961.00
[INFO] Outperformance: $-507,493.00
[INFO] Sharpe ratio (entire period, annualized): -0.606761
[INFO] Sharpe ratio (in-sample, annualized): -0.441250
[INFO] Sharpe ratio (out-of-sample, annualized): -0.989669
[INFO] Maximum Drawdown: $481,837.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-233,854.00
[INFO] Out-of-sample P&L: $-226,663.00
[INFO] 
Best parameters from GA: Short SMA = 38, Long SMA = 46, Sharpe = 0.858167
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2641
[INFO] Cache hits (repeated combinations): 6004
[INFO] Total checks: 8645
[INFO] Cache hit rate: 69.45%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1664 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.5734 to 0.8582
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.858167
[INFO] Number of Trades: 58
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1664 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.5734 to 0.8582
[INFO] Trades range: 10.0 to 230.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0598 to 2.1838
[INFO] Scaled Long SMA range: -1.9671 to 1.7150
[INFO] Scaled Sharpe ratio range: -2.3080 to 2.2268
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 137 elements
[INFO] Kmeans Cluster 1: 131 elements
[INFO] Kmeans Cluster 2: 189 elements
[INFO] Kmeans Cluster 3: 38 elements
[INFO] Kmeans Cluster 4: 138 elements
[INFO] Kmeans Cluster 5: 95 elements
[INFO] Kmeans Cluster 6: 87 elements
[INFO] Kmeans Cluster 7: 80 elements
[INFO] Kmeans Cluster 8: 152 elements
[INFO] Kmeans Cluster 9: 73 elements
[INFO] Kmeans Cluster 10: 104 elements
[INFO] Kmeans Cluster 11: 48 elements
[INFO] Kmeans Cluster 12: 99 elements
[INFO] Kmeans Cluster 13: 152 elements
[INFO] Kmeans Cluster 14: 58 elements
[INFO] Kmeans Cluster 15: 83 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=90.95, Long SMA=119.71, Sharpe=0.5323
[INFO] Centroid 1: Short SMA=233.89, Long SMA=266.81, Sharpe=-0.2611
[INFO] Centroid 2: Short SMA=28.34, Long SMA=123.14, Sharpe=0.3110
[INFO] Centroid 3: Short SMA=13.68, Long SMA=274.42, Sharpe=0.4407
[INFO] Centroid 4: Short SMA=45.36, Long SMA=103.50, Sharpe=0.1413
[INFO] Centroid 5: Short SMA=198.53, Long SMA=265.96, Sharpe=-0.4008
[INFO] Centroid 6: Short SMA=25.61, Long SMA=195.52, Sharpe=0.3769
[INFO] Centroid 7: Short SMA=181.83, Long SMA=206.42, Sharpe=-0.2319
[INFO] Centroid 8: Short SMA=268.71, Long SMA=288.95, Sharpe=-0.1786
[INFO] Centroid 9: Short SMA=90.66, Long SMA=133.51, Sharpe=0.2711
[INFO] Centroid 10: Short SMA=33.06, Long SMA=53.60, Sharpe=0.6126
[INFO] Centroid 11: Short SMA=207.46, Long SMA=231.04, Sharpe=-0.0117
[INFO] Centroid 12: Short SMA=126.71, Long SMA=168.48, Sharpe=-0.0565
[INFO] Centroid 13: Short SMA=34.50, Long SMA=158.78, Sharpe=0.4454
[INFO] Centroid 14: Short SMA=15.03, Long SMA=49.31, Sharpe=0.0697
[INFO] Centroid 15: Short SMA=34.40, Long SMA=66.05, Sharpe=0.3178
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=46, Sharpe=0.8582, Trades=58
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=32, Long SMA=54, Sharpe=0.7377, Trades=36
[INFO] Kmeans Top 2: Short SMA=12, Long SMA=284, Sharpe=0.4716, Trades=11
[INFO] Kmeans Top 3: Short SMA=34, Long SMA=158, Sharpe=0.4445, Trades=15
[INFO] Kmeans Top 4: Short SMA=92, Long SMA=118, Sharpe=0.4435, Trades=19
[INFO] Kmeans Top 5: Short SMA=26, Long SMA=192, Sharpe=0.4380, Trades=11
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (91, 120)
[INFO]   Nearest: (90.0, 120.0)
[INFO]   Rounded: (234, 267)
[INFO]   Nearest: (234.0, 266.0)
[INFO]   Rounded: (28, 123)
[INFO]   Nearest: (28.0, 124.0)
[INFO]   Rounded: (14, 274)
[INFO]   Rounded: (45, 104)
[INFO]   Nearest: (46.0, 104.0)
[INFO]   Rounded: (199, 266)
[INFO]   Nearest: (198.0, 266.0)
[INFO]   Rounded: (26, 196)
[INFO]   Rounded: (182, 206)
[INFO]   Rounded: (269, 289)
[INFO]   Nearest: (268.0, 288.0)
[INFO]   Rounded: (91, 134)
[INFO]   Nearest: (90.0, 134.0)
[INFO]   Rounded: (33, 54)
[INFO]   Nearest: (34.0, 54.0)
[INFO]   Rounded: (207, 231)
[INFO]   Nearest: (208.0, 232.0)
[INFO]   Rounded: (127, 168)
[INFO]   Nearest: (126.0, 168.0)
[INFO]   Rounded: (35, 159)
[INFO]   Nearest: (34.0, 158.0)
[INFO]   Rounded: (15, 49)
[INFO]   Nearest: (16.0, 50.0)
[INFO]   Rounded: (34, 66)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(32/54) - Original Sharpe: 0.7377, Trades: 36
[INFO] Kmeans cluster 2: SMA(12/284) - Original Sharpe: 0.4716, Trades: 11
[INFO] Kmeans cluster 3: SMA(34/158) - Original Sharpe: 0.4445, Trades: 15
[INFO] Kmeans cluster 4: SMA(92/118) - Original Sharpe: 0.4435, Trades: 19
[INFO] Kmeans cluster 5: SMA(26/192) - Original Sharpe: 0.4380, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2816
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (32/54) - Sharpe: 0.7377
[INFO] cluster 2: (12/284) - Sharpe: 0.4716
[INFO] cluster 3: (34/158) - Sharpe: 0.4445
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Out-of-sample period starts on: 2021-09-24
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-24 2021-09-24            43     3.830825            3.830825
1    2021-11-24 2021-11-24            42    -0.750030           -0.975845
2    2022-01-24 2022-01-24            43    -1.158438            2.908511
3    2022-03-24 2022-03-24            42     2.899845            2.899845
4    2022-05-24 2022-05-24            44    -0.772793            3.060061
5    2022-07-24 2022-07-24            45     4.284626            3.795241
6    2022-09-24 2022-09-24            43    -1.964998           -2.488069
7    2022-11-24 2022-11-24            41     2.719154            1.119446
8    2023-01-24 2023-01-24            43    -4.933460           -4.366982
9    2023-03-24 2023-03-24            43    -4.230774           -2.841267
10   2023-05-24 2023-05-24            43    -5.713874           -4.853250
11   2023-07-24 2023-07-24            45    -1.713757           -2.355442
12   2023-09-24 2023-09-24            44    -0.948650           -1.107919
13   2023-11-24 2023-11-24            41    -0.015249           -5.257444
14   2024-01-24 2024-01-24            43    -1.669992            0.654678
15   2024-03-24 2024-03-24            43    -3.457983            0.348376
16   2024-05-24 2024-05-24            43    -0.337335           -0.526494
17   2024-07-24 2024-07-24            44     0.689877           -0.502778
18   2024-09-24 2024-09-24            44     0.685285           -1.643920
19   2024-11-24 2024-11-24            26     1.390507            1.390507
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-24   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2021-11-24   |         -0.8 |             -1.0 |         -0.2 | False         
[INFO] 2022-01-24   |         -1.2 |              2.9 |          4.1 | True          
[INFO] 2022-03-24   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-05-24   |         -0.8 |              3.1 |          3.9 | True          
[INFO] 2022-07-24   |          4.3 |              3.8 |         -0.5 | False         
[INFO] 2022-09-24   |         -2.0 |             -2.5 |         -0.5 | False         
[INFO] 2022-11-24   |          2.7 |              1.1 |         -1.6 | False         
[INFO] 2023-01-24   |         -4.9 |             -4.4 |          0.5 | True          
[INFO] 2023-03-24   |         -4.2 |             -2.8 |          1.4 | True          
[INFO] 2023-05-24   |         -5.7 |             -4.9 |          0.8 | True          
[INFO] 2023-07-24   |         -1.7 |             -2.4 |         -0.7 | False         
[INFO] 2023-09-24   |         -0.9 |             -1.1 |         -0.2 | False         
[INFO] 2023-11-24   |         -0.0 |             -5.3 |         -5.3 | False         
[INFO] 2024-01-24   |         -1.7 |              0.7 |          2.4 | True          
[INFO] 2024-03-24   |         -3.5 |              0.3 |          3.8 | True          
[INFO] 2024-05-24   |         -0.3 |             -0.5 |         -0.2 | False         
[INFO] 2024-07-24   |          0.7 |             -0.5 |         -1.2 | False         
[INFO] 2024-09-24   |          0.7 |             -1.6 |         -2.3 | False         
[INFO] 2024-11-24   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-24, 2022-03-24, 2024-11-24
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 7 of 17 periods (41.18% win rate)
[INFO] Updating Excel file with Kmeans results for DX...
[INFO] Excel file updated successfully. Added DX with Kmeans win rate 41.2% in row 12
[INFO] Added best Sharpe parameters 38/46 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 46
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(32/54) - Original Sharpe: 0.7377
[INFO] Added cluster 2 to portfolio: SMA(12/284) - Original Sharpe: 0.4716
[INFO] Added cluster 3 to portfolio: SMA(34/158) - Original Sharpe: 0.4445
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'DX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0218
[INFO] Kmeans Best out-of-sample Sharpe: -0.4997
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for DX...
[INFO] Excel file updated successfully. Added DX with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\DX
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1664 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.5734 to 0.8582
[INFO] 
Best parameters:
[INFO] Short SMA: 38
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.858167
[INFO] Number of Trades: 58
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1664 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.5734 to 0.8582
[INFO] Trades range: 10.0 to 230.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0598 to 2.1838
[INFO] Scaled Long SMA range: -1.9671 to 1.7150
[INFO] Scaled Sharpe ratio range: -2.3080 to 2.2268
[INFO] Scaled Trades range: -0.7749 to 12.0665
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1664 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6769
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 95 elements
[INFO] Cluster 1: 282 elements
[INFO] Cluster 2: 302 elements
[INFO] Cluster 3: 110 elements
[INFO] Cluster 4: 101 elements
[INFO] Cluster 5: 165 elements
[INFO] Cluster 6: 4 elements
[INFO] Cluster 7: 16 elements
[INFO] Cluster 8: 60 elements
[INFO] Cluster 9: 53 elements
[INFO] Cluster 10: 155 elements
[INFO] Cluster 11: 74 elements
[INFO] Cluster 12: 186 elements
[INFO] Cluster 13: 43 elements
[INFO] Cluster 14: 18 elements
[INFO] Using 12 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=18, Long SMA=56, Sharpe=0.2066, Trades=43
[INFO] Cluster 1 cluster: Short SMA=36, Long SMA=108, Sharpe=0.2813, Trades=21
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=158, Sharpe=0.4001, Trades=15
[INFO] Cluster 3 cluster: Short SMA=30, Long SMA=54, Sharpe=0.6860, Trades=38
[INFO] Cluster 4 cluster: Short SMA=180, Long SMA=212, Sharpe=-0.1177, Trades=13
[INFO] Cluster 5 cluster: Short SMA=90, Long SMA=124, Sharpe=0.4762, Trades=19
[INFO] Cluster 8 cluster: Short SMA=256, Long SMA=264, Sharpe=-0.0877, Trades=28
[INFO] Cluster 9 cluster: Short SMA=14, Long SMA=260, Sharpe=0.5253, Trades=11
[INFO] Cluster 10 cluster: Short SMA=206, Long SMA=264, Sharpe=-0.3294, Trades=14
[INFO] Cluster 11 cluster: Short SMA=118, Long SMA=154, Sharpe=-0.0171, Trades=14
[INFO] Cluster 12 cluster: Short SMA=260, Long SMA=286, Sharpe=-0.1735, Trades=14
[INFO] Cluster 13 cluster: Short SMA=196, Long SMA=200, Sharpe=-0.2688, Trades=29
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=38, Long SMA=46, Sharpe=0.8582, Trades=58
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=30, Long SMA=54, Sharpe=0.6860, Trades=38
[INFO] Top 2: Short SMA=14, Long SMA=260, Sharpe=0.5253, Trades=11
[INFO] Top 3: Short SMA=90, Long SMA=124, Sharpe=0.4762, Trades=19
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 12 valid clusters with clusters
[INFO] Filtering to 1626 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 38, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(30/54) - Original Sharpe: 0.6860, Trades: 38
[INFO] Hierarchical cluster 2: SMA(14/260) - Original Sharpe: 0.5253, Trades: 11
[INFO] Hierarchical cluster 3: SMA(90/124) - Original Sharpe: 0.4762, Trades: 19
[INFO] Hierarchical cluster 4: SMA(32/158) - Original Sharpe: 0.4001, Trades: 15
[INFO] Hierarchical cluster 5: SMA(36/108) - Original Sharpe: 0.2813, Trades: 21
[INFO] Trimmed warm-up period. Evaluation data length: 2816
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (38/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (30/54) - Sharpe: 0.6860
[INFO] cluster 2: (14/260) - Sharpe: 0.5253
[INFO] cluster 3: (90/124) - Sharpe: 0.4762
[INFO] Loading DX data from local files...
[INFO] Found data file: A_OHLCV_@DX_minutes_1440_2005-1645.dat
[INFO] File size: 267122 bytes
[INFO] Out-of-sample period starts on: 2021-09-24
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-24 2021-09-24            43     3.830825            3.830825
1    2021-11-24 2021-11-24            42    -0.750030           -0.975845
2    2022-01-24 2022-01-24            43    -1.158438            3.035867
3    2022-03-24 2022-03-24            42     2.899845            2.899845
4    2022-05-24 2022-05-24            44    -0.772793            3.060061
5    2022-07-24 2022-07-24            45     4.284626            3.795241
6    2022-09-24 2022-09-24            43    -1.964998           -2.583871
7    2022-11-24 2022-11-24            41     2.719154           -2.556838
8    2023-01-24 2023-01-24            43    -4.933460           -2.386185
9    2023-03-24 2023-03-24            43    -4.230774           -2.402738
10   2023-05-24 2023-05-24            43    -5.713874           -2.762726
11   2023-07-24 2023-07-24            45    -1.713757           -3.012213
12   2023-09-24 2023-09-24            44    -0.948650           -1.107919
13   2023-11-24 2023-11-24            41    -0.015249           -5.099373
14   2024-01-24 2024-01-24            43    -1.669992            2.261739
15   2024-03-24 2024-03-24            43    -3.457983            0.137288
16   2024-05-24 2024-05-24            43    -0.337335           -1.502833
17   2024-07-24 2024-07-24            44     0.689877           -0.348721
18   2024-09-24 2024-09-24            44     0.685285           -2.277549
19   2024-11-24 2024-11-24            26     1.390507            2.808070
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-24   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2021-11-24   |         -0.8 |             -1.0 |         -0.2 | False         
[INFO] 2022-01-24   |         -1.2 |              3.0 |          4.2 | True          
[INFO] 2022-03-24   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-05-24   |         -0.8 |              3.1 |          3.9 | True          
[INFO] 2022-07-24   |          4.3 |              3.8 |         -0.5 | False         
[INFO] 2022-09-24   |         -2.0 |             -2.6 |         -0.6 | False         
[INFO] 2022-11-24   |          2.7 |             -2.6 |         -5.3 | False         
[INFO] 2023-01-24   |         -4.9 |             -2.4 |          2.5 | True          
[INFO] 2023-03-24   |         -4.2 |             -2.4 |          1.8 | True          
[INFO] 2023-05-24   |         -5.7 |             -2.8 |          2.9 | True          
[INFO] 2023-07-24   |         -1.7 |             -3.0 |         -1.3 | False         
[INFO] 2023-09-24   |         -0.9 |             -1.1 |         -0.2 | False         
[INFO] 2023-11-24   |         -0.0 |             -5.1 |         -5.1 | False         
[INFO] 2024-01-24   |         -1.7 |              2.3 |          4.0 | True          
[INFO] 2024-03-24   |         -3.5 |              0.1 |          3.6 | True          
[INFO] 2024-05-24   |         -0.3 |             -1.5 |         -1.2 | False         
[INFO] 2024-07-24   |          0.7 |             -0.3 |         -1.0 | False         
[INFO] 2024-09-24   |          0.7 |             -2.3 |         -3.0 | False         
[INFO] 2024-11-24   |          1.4 |              2.8 |          1.4 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-24, 2022-03-24
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 18 periods (44.44% win rate)
[INFO] Updating Excel file with Hierarchical results for DX...
[INFO] Excel file updated successfully. Added DX with Hierarchical win rate 44.4% in row 12
[INFO] Added best Sharpe parameters 38/46 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 38, Long SMA: 46
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(30/54) - Original Sharpe: 0.6860
[INFO] Added cluster 2 to portfolio: SMA(14/260) - Original Sharpe: 0.5253
[INFO] Added cluster 3 to portfolio: SMA(90/124) - Original Sharpe: 0.4762
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'DX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0959
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4997
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for DX...
[INFO] Excel file updated successfully. Added DX with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\DX
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for EC in column D: 9.0
[INFO] Using slippage from Excel column D: 9.0
[INFO] 
Symbol: @EC
[INFO] Description: Euro FX Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 6.250000000000001
[INFO] Big point value: 125000.0
[INFO] Data shape: (6169, 6)
[INFO] Date range: 2001-05-14 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-14 15:57:00  1.0813  1.0823  1.0785  1.0802  1752.0
1 2001-05-15 15:57:00  1.0805  1.0859  1.0796  1.0847  4527.0
2 2001-05-16 15:57:00  1.0841  1.0927  1.0808  1.0893  5604.0
3 2001-05-17 15:57:00  1.0891  1.0941  1.0852  1.0888  4219.0
4 2001-05-18 15:57:00  1.0887  1.0889  1.0815  1.0866  3560.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 28.30 seconds (0.47 minutes)
[INFO] Best parameters found: Short SMA = 100, Long SMA = 108
[INFO] Best fitness (Sharpe ratio): 1.060302
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 100, Long SMA = 108, Sharpe = 1.060302
[INFO] Top 2: Short SMA = 100, Long SMA = 112, Sharpe = 1.053853
[INFO] Top 3: Short SMA = 100, Long SMA = 102, Sharpe = 1.047766
[INFO] Top 4: Short SMA = 100, Long SMA = 110, Sharpe = 1.039081
[INFO] Top 5: Short SMA = 98, Long SMA = 112, Sharpe = 1.034832
[INFO] Hall of Fame size: 2415
[INFO] Number of elements in all_results: 1568
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 847 had penalty fitness
[INFO] Total filtered from Hall of Fame: 847
[INFO] Hall of Fame -> all_results: 2415 -> 1568
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1568 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @EC
[INFO] Big Point Value (from data): 125000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 6.80 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $435,525.00
[INFO] Market Buy & Hold P&L: $-67,087.50
[INFO] Outperformance: $502,612.50
[INFO] Sharpe ratio (entire period, annualized): 0.605783
[INFO] Sharpe ratio (in-sample, annualized): 0.484480
[INFO] Sharpe ratio (out-of-sample, annualized): 0.887553
[INFO] Maximum Drawdown: $158,806.25
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $259,231.25
[INFO] Out-of-sample P&L: $204,293.75
[INFO] 
Best parameters from GA: Short SMA = 100, Long SMA = 108, Sharpe = 1.060302
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2415
[INFO] Cache hits (repeated combinations): 6195
[INFO] Total checks: 8610
[INFO] Cache hit rate: 71.95%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1568 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.5464 to 1.0603
[INFO] 
Best parameters:
[INFO] Short SMA: 100
[INFO] Long SMA: 108
[INFO] Sharpe Ratio: 1.060302
[INFO] Number of Trades: 29
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1568 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.5464 to 1.0603
[INFO] Trades range: 10.0 to 214.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0050 to 2.4674
[INFO] Scaled Long SMA range: -2.1128 to 1.6047
[INFO] Scaled Sharpe ratio range: -2.6289 to 2.5204
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 156 elements
[INFO] Kmeans Cluster 1: 157 elements
[INFO] Kmeans Cluster 2: 63 elements
[INFO] Kmeans Cluster 3: 159 elements
[INFO] Kmeans Cluster 4: 158 elements
[INFO] Kmeans Cluster 5: 147 elements
[INFO] Kmeans Cluster 6: 59 elements
[INFO] Kmeans Cluster 7: 69 elements
[INFO] Kmeans Cluster 8: 106 elements
[INFO] Kmeans Cluster 9: 28 elements
[INFO] Kmeans Cluster 10: 63 elements
[INFO] Kmeans Cluster 11: 193 elements
[INFO] Kmeans Cluster 12: 107 elements
[INFO] Kmeans Cluster 13: 36 elements
[INFO] Kmeans Cluster 14: 67 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=38.68, Long SMA=200.15, Sharpe=0.3487
[INFO] Centroid 1: Short SMA=267.59, Long SMA=286.39, Sharpe=-0.1481
[INFO] Centroid 2: Short SMA=27.84, Long SMA=55.24, Sharpe=0.2873
[INFO] Centroid 3: Short SMA=31.60, Long SMA=146.33, Sharpe=0.4840
[INFO] Centroid 4: Short SMA=28.49, Long SMA=273.97, Sharpe=0.4579
[INFO] Centroid 5: Short SMA=211.44, Long SMA=251.81, Sharpe=-0.3004
[INFO] Centroid 6: Short SMA=34.24, Long SMA=56.75, Sharpe=0.5979
[INFO] Centroid 7: Short SMA=171.80, Long SMA=191.83, Sharpe=-0.0844
[INFO] Centroid 8: Short SMA=88.28, Long SMA=121.96, Sharpe=0.4732
[INFO] Centroid 9: Short SMA=100.00, Long SMA=110.50, Sharpe=0.9088
[INFO] Centroid 10: Short SMA=126.51, Long SMA=188.00, Sharpe=0.1290
[INFO] Centroid 11: Short SMA=41.45, Long SMA=110.87, Sharpe=0.3841
[INFO] Centroid 12: Short SMA=92.02, Long SMA=119.57, Sharpe=0.6823
[INFO] Centroid 13: Short SMA=59.28, Long SMA=282.00, Sharpe=0.2309
[INFO] Centroid 14: Short SMA=29.67, Long SMA=91.67, Sharpe=0.0953
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=100, Long SMA=108, Sharpe=1.0603, Trades=29
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=100, Long SMA=110, Sharpe=1.0391, Trades=27
[INFO] Kmeans Top 2: Short SMA=92, Long SMA=120, Sharpe=0.7675, Trades=17
[INFO] Kmeans Top 3: Short SMA=34, Long SMA=54, Sharpe=0.7159, Trades=37
[INFO] Kmeans Top 4: Short SMA=80, Long SMA=118, Sharpe=0.5658, Trades=19
[INFO] Kmeans Top 5: Short SMA=30, Long SMA=144, Sharpe=0.4920, Trades=11
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (39, 200)
[INFO]   Nearest: (38.0, 200.0)
[INFO]   Rounded: (268, 286)
[INFO]   Rounded: (28, 55)
[INFO]   Nearest: (28.0, 56.0)
[INFO]   Rounded: (32, 146)
[INFO]   Rounded: (28, 274)
[INFO]   Rounded: (211, 252)
[INFO]   Nearest: (210.0, 252.0)
[INFO]   Rounded: (34, 57)
[INFO]   Nearest: (34.0, 56.0)
[INFO]   Rounded: (172, 192)
[INFO]   Rounded: (88, 122)
[INFO]   Rounded: (100, 110)
[INFO]   Rounded: (127, 188)
[INFO]   Nearest: (126.0, 188.0)
[INFO]   Rounded: (41, 111)
[INFO]   Nearest: (42.0, 110.0)
[INFO]   Rounded: (92, 120)
[INFO]   Rounded: (59, 282)
[INFO]   Nearest: (60.0, 282.0)
[INFO]   Rounded: (30, 92)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 100, Long SMA: 108
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(100/110) - Original Sharpe: 1.0391, Trades: 27
[INFO] Kmeans cluster 2: SMA(92/120) - Original Sharpe: 0.7675, Trades: 17
[INFO] Kmeans cluster 3: SMA(34/54) - Original Sharpe: 0.7159, Trades: 37
[INFO] Kmeans cluster 4: SMA(80/118) - Original Sharpe: 0.5658, Trades: 19
[INFO] Kmeans cluster 5: SMA(30/144) - Original Sharpe: 0.4920, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (100/108)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (100/110) - Sharpe: 1.0391
[INFO] cluster 2: (92/120) - Sharpe: 0.7675
[INFO] cluster 3: (34/54) - Sharpe: 0.7159
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     3.487734            3.487734
1    2021-11-14 2021-11-14            43     0.321475            0.321475
2    2022-01-14 2022-01-14            41     3.270794            3.931049
3    2022-03-14 2022-03-14            44     3.649515            3.649515
4    2022-05-14 2022-05-14            43     1.818210            1.554214
5    2022-07-14 2022-07-14            44     0.788062            0.788062
6    2022-09-14 2022-09-14            43    -1.170570           -1.170570
7    2022-11-14 2022-11-14            43    -2.475074           -2.716699
8    2023-01-14 2023-01-14            41    -0.989824           -1.812533
9    2023-03-14 2023-03-14            44     0.488570           -1.237820
10   2023-05-14 2023-05-14            44    -0.740245           -0.921599
11   2023-07-14 2023-07-14            44    -3.130408           -2.674425
12   2023-09-14 2023-09-14            43     2.281930            0.988696
13   2023-11-14 2023-11-14            42    -1.565980           -2.389151
14   2024-01-14 2024-01-14            43     3.926067            5.597514
15   2024-03-14 2024-03-14            42    -4.614749           -3.781512
16   2024-05-14 2024-05-14            44    -0.699152           -2.094149
17   2024-07-14 2024-07-14            45    -1.184714           -1.691775
18   2024-09-14 2024-09-14            43    -3.897937           -4.099668
19   2024-11-14 2024-11-14            33     0.919641            1.884721
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-01-14   |          3.3 |              3.9 |          0.6 | True          
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.8 |              1.6 |         -0.2 | False         
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -2.5 |             -2.7 |         -0.2 | False         
[INFO] 2023-01-14   |         -1.0 |             -1.8 |         -0.8 | False         
[INFO] 2023-03-14   |          0.5 |             -1.2 |         -1.7 | False         
[INFO] 2023-05-14   |         -0.7 |             -0.9 |         -0.2 | False         
[INFO] 2023-07-14   |         -3.1 |             -2.7 |          0.4 | True          
[INFO] 2023-09-14   |          2.3 |              1.0 |         -1.3 | False         
[INFO] 2023-11-14   |         -1.6 |             -2.4 |         -0.8 | False         
[INFO] 2024-01-14   |          3.9 |              5.6 |          1.7 | True          
[INFO] 2024-03-14   |         -4.6 |             -3.8 |          0.8 | True          
[INFO] 2024-05-14   |         -0.7 |             -2.1 |         -1.4 | False         
[INFO] 2024-07-14   |         -1.2 |             -1.7 |         -0.5 | False         
[INFO] 2024-09-14   |         -3.9 |             -4.1 |         -0.2 | False         
[INFO] 2024-11-14   |          0.9 |              1.9 |          1.0 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-03-14, 2022-07-14, 2022-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Kmeans cluster wins (rounded comparison): 5 of 15 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for EC...
[INFO] Excel file updated successfully. Added EC with Kmeans win rate 33.3% in row 13
[INFO] Added best Sharpe parameters 100/108 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 100, Long SMA: 108
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(100/110) - Original Sharpe: 1.0391
[INFO] Added cluster 2 to portfolio: SMA(92/120) - Original Sharpe: 0.7675
[INFO] Added cluster 3 to portfolio: SMA(34/54) - Original Sharpe: 0.7159
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'EC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0860
[INFO] Kmeans Best out-of-sample Sharpe: -0.0312
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for EC...
[INFO] Excel file updated successfully. Added EC with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EC
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1568 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.5464 to 1.0603
[INFO] 
Best parameters:
[INFO] Short SMA: 100
[INFO] Long SMA: 108
[INFO] Sharpe Ratio: 1.060302
[INFO] Number of Trades: 29
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1568 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.5464 to 1.0603
[INFO] Trades range: 10.0 to 214.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0050 to 2.4674
[INFO] Scaled Long SMA range: -2.1128 to 1.6047
[INFO] Scaled Sharpe ratio range: -2.6289 to 2.5204
[INFO] Scaled Trades range: -0.7042 to 14.3997
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1568 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6618
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 98 elements
[INFO] Cluster 1: 144 elements
[INFO] Cluster 2: 174 elements
[INFO] Cluster 3: 37 elements
[INFO] Cluster 4: 132 elements
[INFO] Cluster 5: 2 elements
[INFO] Cluster 6: 194 elements
[INFO] Cluster 7: 166 elements
[INFO] Cluster 8: 59 elements
[INFO] Cluster 9: 56 elements
[INFO] Cluster 10: 134 elements
[INFO] Cluster 11: 123 elements
[INFO] Cluster 12: 31 elements
[INFO] Cluster 13: 7 elements
[INFO] Cluster 14: 45 elements
[INFO] Cluster 15: 166 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=146, Long SMA=180, Sharpe=-0.1265, Trades=13
[INFO] Cluster 1 cluster: Short SMA=206, Long SMA=244, Sharpe=-0.1968, Trades=13
[INFO] Cluster 2 cluster: Short SMA=92, Long SMA=124, Sharpe=0.7075, Trades=17
[INFO] Cluster 3 cluster: Short SMA=36, Long SMA=44, Sharpe=0.7649, Trades=61
[INFO] Cluster 4 cluster: Short SMA=38, Long SMA=100, Sharpe=0.3558, Trades=19
[INFO] Cluster 6 cluster: Short SMA=34, Long SMA=280, Sharpe=0.4080, Trades=10
[INFO] Cluster 7 cluster: Short SMA=30, Long SMA=154, Sharpe=0.5407, Trades=11
[INFO] Cluster 8 cluster: Short SMA=258, Long SMA=264, Sharpe=-0.0418, Trades=32
[INFO] Cluster 9 cluster: Short SMA=24, Long SMA=66, Sharpe=0.3098, Trades=43
[INFO] Cluster 10 cluster: Short SMA=264, Long SMA=288, Sharpe=-0.1950, Trades=13
[INFO] Cluster 11 cluster: Short SMA=36, Long SMA=208, Sharpe=0.3805, Trades=13
[INFO] Cluster 12 cluster: Short SMA=102, Long SMA=110, Sharpe=0.9101, Trades=29
[INFO] Cluster 14 cluster: Short SMA=32, Long SMA=54, Sharpe=0.6813, Trades=37
[INFO] Cluster 15 cluster: Short SMA=44, Long SMA=114, Sharpe=0.4160, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=100, Long SMA=108, Sharpe=1.0603, Trades=29
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=102, Long SMA=110, Sharpe=0.9101, Trades=29
[INFO] Top 2: Short SMA=36, Long SMA=44, Sharpe=0.7649, Trades=61
[INFO] Top 3: Short SMA=92, Long SMA=124, Sharpe=0.7075, Trades=17
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 1559 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 100, Long SMA: 108
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(102/110) - Original Sharpe: 0.9101, Trades: 29
[INFO] Hierarchical cluster 2: SMA(36/44) - Original Sharpe: 0.7649, Trades: 61
[INFO] Hierarchical cluster 3: SMA(92/124) - Original Sharpe: 0.7075, Trades: 17
[INFO] Hierarchical cluster 4: SMA(32/54) - Original Sharpe: 0.6813, Trades: 37
[INFO] Hierarchical cluster 5: SMA(30/154) - Original Sharpe: 0.5407, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (100/108)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (102/110) - Sharpe: 0.9101
[INFO] cluster 2: (36/44) - Sharpe: 0.7649
[INFO] cluster 3: (92/124) - Sharpe: 0.7075
[INFO] Loading EC data from local files...
[INFO] Found data file: A_OHLCV_@EC_minutes_1440_1703-1557.dat
[INFO] File size: 296246 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     3.487734            3.487734
1    2021-11-14 2021-11-14            43     0.321475            0.321475
2    2022-01-14 2022-01-14            41     3.270794            1.802961
3    2022-03-14 2022-03-14            44     3.649515            3.649515
4    2022-05-14 2022-05-14            43     1.818210            0.020109
5    2022-07-14 2022-07-14            44     0.788062            1.115486
6    2022-09-14 2022-09-14            43    -1.170570           -1.170570
7    2022-11-14 2022-11-14            43    -2.475074           -2.117051
8    2023-01-14 2023-01-14            41    -0.989824           -1.933170
9    2023-03-14 2023-03-14            44     0.488570           -0.304567
10   2023-05-14 2023-05-14            44    -0.740245           -0.475776
11   2023-07-14 2023-07-14            44    -3.130408           -3.561544
12   2023-09-14 2023-09-14            43     2.281930            1.580502
13   2023-11-14 2023-11-14            42    -1.565980           -2.455427
14   2024-01-14 2024-01-14            43     3.926067            4.194029
15   2024-03-14 2024-03-14            42    -4.614749           -3.839667
16   2024-05-14 2024-05-14            44    -0.699152           -1.993341
17   2024-07-14 2024-07-14            45    -1.184714           -1.242269
18   2024-09-14 2024-09-14            43    -3.897937           -3.736941
19   2024-11-14 2024-11-14            33     0.919641            2.745861
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-01-14   |          3.3 |              1.8 |         -1.5 | False         
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.8 |              0.0 |         -1.8 | False         
[INFO] 2022-07-14   |          0.8 |              1.1 |          0.3 | True          
[INFO] 2022-09-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -2.5 |             -2.1 |          0.4 | True          
[INFO] 2023-01-14   |         -1.0 |             -1.9 |         -0.9 | False         
[INFO] 2023-03-14   |          0.5 |             -0.3 |         -0.8 | False         
[INFO] 2023-05-14   |         -0.7 |             -0.5 |          0.2 | True          
[INFO] 2023-07-14   |         -3.1 |             -3.6 |         -0.5 | False         
[INFO] 2023-09-14   |          2.3 |              1.6 |         -0.7 | False         
[INFO] 2023-11-14   |         -1.6 |             -2.5 |         -0.9 | False         
[INFO] 2024-01-14   |          3.9 |              4.2 |          0.3 | True          
[INFO] 2024-03-14   |         -4.6 |             -3.8 |          0.8 | True          
[INFO] 2024-05-14   |         -0.7 |             -2.0 |         -1.3 | False         
[INFO] 2024-07-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -3.9 |             -3.7 |          0.2 | True          
[INFO] 2024-11-14   |          0.9 |              2.7 |          1.8 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-03-14, 2022-09-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 15 periods (46.67% win rate)
[INFO] Updating Excel file with Hierarchical results for EC...
[INFO] Excel file updated successfully. Added EC with Hierarchical win rate 46.7% in row 13
[INFO] Added best Sharpe parameters 100/108 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 100, Long SMA: 108
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(102/110) - Original Sharpe: 0.9101
[INFO] Added cluster 2 to portfolio: SMA(36/44) - Original Sharpe: 0.7649
[INFO] Added cluster 3 to portfolio: SMA(92/124) - Original Sharpe: 0.7075
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'EC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1683
[INFO] Hierarchical Best out-of-sample Sharpe: -0.0312
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for EC...
[INFO] Excel file updated successfully. Added EC with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EC
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for EMD in column D: 55.0
[INFO] Using slippage from Excel column D: 55.0
[INFO] 
Symbol: @EMD
[INFO] Description: E-Mini S&P MidCap 400 Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 100.0
[INFO] Data shape: (5981, 6)
[INFO] Date range: 2002-01-28 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2002-01-28 15:57:00  769.65  769.65  764.85  767.75   119.0
1 2002-01-29 15:57:00  768.25  768.25  755.95  758.15    93.0
2 2002-01-30 15:57:00  756.25  764.05  751.35  764.05   368.0
3 2002-01-31 15:57:00  763.25  766.25  762.75  765.25   201.0
4 2002-02-01 15:57:00  765.55  765.55  762.15  763.75    48.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 26.73 seconds (0.45 minutes)
[INFO] Best parameters found: Short SMA = 216, Long SMA = 222
[INFO] Best fitness (Sharpe ratio): 0.453823
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 216, Long SMA = 222, Sharpe = 0.453823
[INFO] Top 2: Short SMA = 216, Long SMA = 224, Sharpe = 0.448619
[INFO] Top 3: Short SMA = 218, Long SMA = 224, Sharpe = 0.411160
[INFO] Top 4: Short SMA = 218, Long SMA = 222, Sharpe = 0.372581
[INFO] Top 5: Short SMA = 220, Long SMA = 226, Sharpe = 0.326306
[INFO] Hall of Fame size: 2481
[INFO] Number of elements in all_results: 1438
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 1043 had penalty fitness
[INFO] Total filtered from Hall of Fame: 1043
[INFO] Hall of Fame -> all_results: 2481 -> 1438
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1438 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @EMD
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 2.80 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $-314,790.00
[INFO] Market Buy & Hold P&L: $161,780.00
[INFO] Outperformance: $-476,570.00
[INFO] Sharpe ratio (entire period, annualized): -0.220423
[INFO] Sharpe ratio (in-sample, annualized): -0.328268
[INFO] Sharpe ratio (out-of-sample, annualized): 0.009216
[INFO] Maximum Drawdown: $336,220.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-218,910.00
[INFO] Out-of-sample P&L: $2,880.00
[INFO] 
Best parameters from GA: Short SMA = 216, Long SMA = 222, Sharpe = 0.453823
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2481
[INFO] Cache hits (repeated combinations): 6142
[INFO] Total checks: 8623
[INFO] Cache hit rate: 71.23%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 100.0
[INFO] Slippage: 55.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1438 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] 
Best parameters:
[INFO] Short SMA: 216
[INFO] Long SMA: 222
[INFO] Sharpe Ratio: 0.453823
[INFO] Number of Trades: 20
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1438 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] Trades range: 10.0 to 155.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9556 to 2.2698
[INFO] Scaled Long SMA range: -2.2344 to 1.6506
[INFO] Scaled Sharpe ratio range: -3.5593 to 2.6854
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 77 elements
[INFO] Kmeans Cluster 1: 68 elements
[INFO] Kmeans Cluster 2: 96 elements
[INFO] Kmeans Cluster 3: 74 elements
[INFO] Kmeans Cluster 4: 97 elements
[INFO] Kmeans Cluster 5: 82 elements
[INFO] Kmeans Cluster 6: 41 elements
[INFO] Kmeans Cluster 7: 154 elements
[INFO] Kmeans Cluster 8: 80 elements
[INFO] Kmeans Cluster 9: 74 elements
[INFO] Kmeans Cluster 10: 71 elements
[INFO] Kmeans Cluster 11: 118 elements
[INFO] Kmeans Cluster 12: 126 elements
[INFO] Kmeans Cluster 13: 86 elements
[INFO] Kmeans Cluster 14: 23 elements
[INFO] Kmeans Cluster 15: 123 elements
[INFO] Kmeans Cluster 16: 48 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=110.49, Long SMA=144.94, Sharpe=-0.0269
[INFO] Centroid 1: Short SMA=232.74, Long SMA=255.97, Sharpe=-0.4530
[INFO] Centroid 2: Short SMA=30.44, Long SMA=285.02, Sharpe=-0.0904
[INFO] Centroid 3: Short SMA=211.27, Long SMA=226.89, Sharpe=0.0679
[INFO] Centroid 4: Short SMA=23.03, Long SMA=57.69, Sharpe=0.0713
[INFO] Centroid 5: Short SMA=86.39, Long SMA=138.39, Sharpe=-0.1907
[INFO] Centroid 6: Short SMA=262.88, Long SMA=278.63, Sharpe=-0.6808
[INFO] Centroid 7: Short SMA=25.57, Long SMA=142.19, Sharpe=0.1260
[INFO] Centroid 8: Short SMA=152.50, Long SMA=172.32, Sharpe=-0.2281
[INFO] Centroid 9: Short SMA=279.65, Long SMA=293.24, Sharpe=-0.4700
[INFO] Centroid 10: Short SMA=13.86, Long SMA=235.61, Sharpe=0.0916
[INFO] Centroid 11: Short SMA=26.08, Long SMA=223.10, Sharpe=-0.1430
[INFO] Centroid 12: Short SMA=34.03, Long SMA=162.94, Sharpe=-0.0149
[INFO] Centroid 13: Short SMA=198.37, Long SMA=222.30, Sharpe=-0.1420
[INFO] Centroid 14: Short SMA=215.04, Long SMA=221.83, Sharpe=0.2846
[INFO] Centroid 15: Short SMA=36.24, Long SMA=91.74, Sharpe=-0.0990
[INFO] Centroid 16: Short SMA=51.04, Long SMA=83.29, Sharpe=-0.2952
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=216, Long SMA=222, Sharpe=0.4538, Trades=20
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=216, Long SMA=224, Sharpe=0.4486, Trades=20
[INFO] Kmeans Top 2: Short SMA=26, Long SMA=140, Sharpe=0.2032, Trades=16
[INFO] Kmeans Top 3: Short SMA=214, Long SMA=230, Sharpe=0.1704, Trades=12
[INFO] Kmeans Top 4: Short SMA=14, Long SMA=230, Sharpe=0.0981, Trades=14
[INFO] Kmeans Top 5: Short SMA=22, Long SMA=56, Sharpe=0.0361, Trades=32
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (110, 145)
[INFO]   Nearest: (110.0, 144.0)
[INFO]   Rounded: (233, 256)
[INFO]   Nearest: (232.0, 256.0)
[INFO]   Rounded: (30, 285)
[INFO]   Nearest: (30.0, 286.0)
[INFO]   Rounded: (211, 227)
[INFO]   Nearest: (212.0, 226.0)
[INFO]   Rounded: (23, 58)
[INFO]   Nearest: (24.0, 58.0)
[INFO]   Rounded: (86, 138)
[INFO]   Rounded: (263, 279)
[INFO]   Nearest: (262.0, 278.0)
[INFO]   Rounded: (26, 142)
[INFO]   Rounded: (152, 172)
[INFO]   Rounded: (280, 293)
[INFO]   Nearest: (280.0, 294.0)
[INFO]   Rounded: (14, 236)
[INFO]   Rounded: (26, 223)
[INFO]   Nearest: (26.0, 224.0)
[INFO]   Rounded: (34, 163)
[INFO]   Nearest: (34.0, 162.0)
[INFO]   Rounded: (198, 222)
[INFO]   Rounded: (215, 222)
[INFO]   Nearest: (216.0, 222.0)
[INFO]   Rounded: (36, 92)
[INFO]   Rounded: (51, 83)
[INFO]   Nearest: (52.0, 84.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 216, Long SMA: 222
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] File size: 287237 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(216/224) - Original Sharpe: 0.4486, Trades: 20
[INFO] Kmeans cluster 2: SMA(26/140) - Original Sharpe: 0.2032, Trades: 16
[INFO] Kmeans cluster 3: SMA(214/230) - Original Sharpe: 0.1704, Trades: 12
[INFO] Kmeans cluster 4: SMA(14/230) - Original Sharpe: 0.0981, Trades: 14
[INFO] Kmeans cluster 5: SMA(22/56) - Original Sharpe: 0.0361, Trades: 32
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (216/222)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (216/224) - Sharpe: 0.4486
[INFO] cluster 2: (26/140) - Sharpe: 0.2032
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] File size: 287237 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     2.819527            1.472030
1    2021-11-14 2021-11-14            43    -1.145321           -1.145321
2    2022-01-14 2022-01-14            41    -2.030834           -2.710500
3    2022-03-14 2022-03-14            44    -1.744332           -3.113411
4    2022-05-14 2022-05-14            43     3.502737            3.157939
5    2022-07-14 2022-07-14            44    -1.329484           -3.329962
6    2022-09-14 2022-09-14            43     0.741490            0.015468
7    2022-11-14 2022-11-14            43    -0.351982            1.085212
8    2023-01-14 2023-01-14            41     2.520987            0.000000
9    2023-03-14 2023-03-14            44    -1.655688            0.380974
10   2023-05-14 2023-05-14            44    -1.226126           -0.358238
11   2023-07-14 2023-07-14            44    -2.793162           -2.793162
12   2023-09-14 2023-09-14            43    -1.709353           -0.836260
13   2023-11-14 2023-11-14            42    -3.498659           -4.719545
14   2024-01-14 2024-01-14            43     3.360693            3.354800
15   2024-03-14 2024-03-14            42     0.057655            0.057655
16   2024-05-14 2024-05-14            44     3.250284            1.683423
17   2024-07-14 2024-07-14            45    -0.486251           -0.486251
18   2024-09-14 2024-09-14            43     2.886146            2.886146
19   2024-11-14 2024-11-14            33    -2.653916           -2.653916
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          2.8 |              1.5 |         -1.3 | False         
[INFO] 2021-11-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.0 |             -2.7 |         -0.7 | False         
[INFO] 2022-03-14   |         -1.7 |             -3.1 |         -1.4 | False         
[INFO] 2022-05-14   |          3.5 |              3.2 |         -0.3 | False         
[INFO] 2022-07-14   |         -1.3 |             -3.3 |         -2.0 | False         
[INFO] 2022-09-14   |          0.7 |              0.0 |         -0.7 | False         
[INFO] 2022-11-14   |         -0.4 |              1.1 |          1.5 | True          
[INFO] 2023-01-14   |          2.5 |              0.0 |         -2.5 | False         
[INFO] 2023-03-14   |         -1.7 |              0.4 |          2.1 | True          
[INFO] 2023-05-14   |         -1.2 |             -0.4 |          0.8 | True          
[INFO] 2023-07-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.7 |             -0.8 |          0.9 | True          
[INFO] 2023-11-14   |         -3.5 |             -4.7 |         -1.2 | False         
[INFO] 2024-01-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-03-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-05-14   |          3.3 |              1.7 |         -1.6 | False         
[INFO] 2024-07-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -2.7 |             -2.7 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2023-07-14, 2024-01-14, 2024-03-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 4 of 13 periods (30.77% win rate)
[INFO] Updating Excel file with Kmeans results for EMD...
[INFO] Excel file updated successfully. Added EMD with Kmeans win rate 30.8% in row 14
[INFO] Added best Sharpe parameters 216/222 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 216, Long SMA: 222
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(216/224) - Original Sharpe: 0.4486
[INFO] Added cluster 2 to portfolio: SMA(26/140) - Original Sharpe: 0.2032
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'EMD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.4035
[INFO] Kmeans Best out-of-sample Sharpe: -0.1673
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for EMD...
[INFO] Excel file updated successfully. Added EMD with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EMD
[INFO] Big Point Value: 100.0
[INFO] Slippage: 55.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1438 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] 
Best parameters:
[INFO] Short SMA: 216
[INFO] Long SMA: 222
[INFO] Sharpe Ratio: 0.453823
[INFO] Number of Trades: 20
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1438 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.8457 to 0.4538
[INFO] Trades range: 10.0 to 155.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9556 to 2.2698
[INFO] Scaled Long SMA range: -2.2344 to 1.6506
[INFO] Scaled Sharpe ratio range: -3.5593 to 2.6854
[INFO] Scaled Trades range: -0.7120 to 9.7837
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1438 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.7281
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 112 elements
[INFO] Cluster 1: 72 elements
[INFO] Cluster 2: 124 elements
[INFO] Cluster 3: 129 elements
[INFO] Cluster 4: 27 elements
[INFO] Cluster 5: 138 elements
[INFO] Cluster 6: 32 elements
[INFO] Cluster 7: 137 elements
[INFO] Cluster 8: 116 elements
[INFO] Cluster 9: 7 elements
[INFO] Cluster 10: 125 elements
[INFO] Cluster 11: 147 elements
[INFO] Cluster 12: 127 elements
[INFO] Cluster 13: 49 elements
[INFO] Cluster 14: 43 elements
[INFO] Cluster 15: 17 elements
[INFO] Cluster 16: 36 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=20, Long SMA=62, Sharpe=0.0619, Trades=34
[INFO] Cluster 1 cluster: Short SMA=216, Long SMA=228, Sharpe=0.1247, Trades=16
[INFO] Cluster 2 cluster: Short SMA=102, Long SMA=150, Sharpe=-0.1607, Trades=12
[INFO] Cluster 3 cluster: Short SMA=58, Long SMA=154, Sharpe=-0.0921, Trades=10
[INFO] Cluster 4 cluster: Short SMA=192, Long SMA=196, Sharpe=-0.2468, Trades=34
[INFO] Cluster 5 cluster: Short SMA=24, Long SMA=278, Sharpe=-0.1511, Trades=13
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=36, Sharpe=-0.0142, Trades=70
[INFO] Cluster 7 cluster: Short SMA=36, Long SMA=116, Sharpe=-0.1369, Trades=24
[INFO] Cluster 8 cluster: Short SMA=194, Long SMA=220, Sharpe=-0.2037, Trades=14
[INFO] Cluster 10 cluster: Short SMA=26, Long SMA=214, Sharpe=-0.1796, Trades=12
[INFO] Cluster 11 cluster: Short SMA=24, Long SMA=148, Sharpe=0.1719, Trades=18
[INFO] Cluster 12 cluster: Short SMA=254, Long SMA=268, Sharpe=-0.5425, Trades=13
[INFO] Cluster 13 cluster: Short SMA=54, Long SMA=104, Sharpe=-0.1864, Trades=23
[INFO] Cluster 14 cluster: Short SMA=12, Long SMA=230, Sharpe=0.1192, Trades=14
[INFO] Cluster 16 cluster: Short SMA=264, Long SMA=276, Sharpe=-0.7713, Trades=13
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=216, Long SMA=222, Sharpe=0.4538, Trades=20
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=24, Long SMA=148, Sharpe=0.1719, Trades=18
[INFO] Top 2: Short SMA=216, Long SMA=228, Sharpe=0.1247, Trades=16
[INFO] Top 3: Short SMA=12, Long SMA=230, Sharpe=0.1192, Trades=14
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 1414 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 216, Long SMA: 222
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading EMD data from local files...
[INFO] Found data file: A_OHLCV_@EMD_minutes_1440_1703-1557.dat
[INFO] File size: 287237 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(24/148) - Original Sharpe: 0.1719, Trades: 18
[INFO] Hierarchical cluster 2: SMA(216/228) - Original Sharpe: 0.1247, Trades: 16
[INFO] Hierarchical cluster 3: SMA(12/230) - Original Sharpe: 0.1192, Trades: 14
[INFO] Hierarchical cluster 4: SMA(20/62) - Original Sharpe: 0.0619, Trades: 34
[INFO] Hierarchical cluster 5: SMA(26/36) - Original Sharpe: -0.0142, Trades: 70
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (216/222)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 216, Long SMA: 222
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\EMD
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for ES in column D: 13.0
[INFO] Using slippage from Excel column D: 13.0
[INFO] 
Symbol: @ES
[INFO] Description: E-mini S&P 500 Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 12.5
[INFO] Big point value: 50.0
[INFO] Data shape: (6513, 6)
[INFO] Date range: 2000-01-03 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime     open     high      low    close   volume
0 2000-01-03 15:57:00  1992.25  2006.75  1963.00  1977.50  20662.0
1 2000-01-04 15:57:00  1975.50  1976.50  1920.25  1922.25  22703.0
2 2000-01-05 15:57:00  1918.50  1938.00  1895.75  1923.75  26420.0
3 2000-01-06 15:57:00  1910.25  1937.00  1906.50  1915.50  23206.0
4 2000-01-07 15:57:00  1915.00  1972.25  1912.75  1970.50  22214.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 22.47 seconds (0.37 minutes)
[INFO] Best parameters found: Short SMA = 194, Long SMA = 220
[INFO] Best fitness (Sharpe ratio): 0.870926
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 194, Long SMA = 220, Sharpe = 0.870926
[INFO] Top 2: Short SMA = 198, Long SMA = 218, Sharpe = 0.863160
[INFO] Top 3: Short SMA = 188, Long SMA = 190, Sharpe = 0.855926
[INFO] Top 4: Short SMA = 196, Long SMA = 220, Sharpe = 0.845203
[INFO] Top 5: Short SMA = 200, Long SMA = 216, Sharpe = 0.841354
[INFO] Hall of Fame size: 2088
[INFO] Number of elements in all_results: 760
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 1328 had penalty fitness
[INFO] Total filtered from Hall of Fame: 1328
[INFO] Hall of Fame -> all_results: 2088 -> 760
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 760 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @ES
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.31 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $-683,987.50
[INFO] Market Buy & Hold P&L: $187,962.50
[INFO] Outperformance: $-871,950.00
[INFO] Sharpe ratio (entire period, annualized): -0.603235
[INFO] Sharpe ratio (in-sample, annualized): -0.715966
[INFO] Sharpe ratio (out-of-sample, annualized): -0.362709
[INFO] Maximum Drawdown: $637,487.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-457,125.00
[INFO] Out-of-sample P&L: $-108,012.50
[INFO] 
Best parameters from GA: Short SMA = 194, Long SMA = 220, Sharpe = 0.870926
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2088
[INFO] Cache hits (repeated combinations): 6548
[INFO] Total checks: 8636
[INFO] Cache hit rate: 75.82%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 50.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 760 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.1997 to 0.8709
[INFO] 
Best parameters:
[INFO] Short SMA: 194
[INFO] Long SMA: 220
[INFO] Sharpe Ratio: 0.870926
[INFO] Number of Trades: 12
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 760 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.1997 to 0.8709
[INFO] Trades range: 10.0 to 172.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.7068 to 1.6737
[INFO] Scaled Long SMA range: -2.5853 to 1.5815
[INFO] Scaled Sharpe ratio range: -3.3282 to 2.3119
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 57 elements
[INFO] Kmeans Cluster 1: 56 elements
[INFO] Kmeans Cluster 2: 22 elements
[INFO] Kmeans Cluster 3: 23 elements
[INFO] Kmeans Cluster 4: 33 elements
[INFO] Kmeans Cluster 5: 65 elements
[INFO] Kmeans Cluster 6: 66 elements
[INFO] Kmeans Cluster 7: 26 elements
[INFO] Kmeans Cluster 8: 53 elements
[INFO] Kmeans Cluster 9: 35 elements
[INFO] Kmeans Cluster 10: 37 elements
[INFO] Kmeans Cluster 11: 73 elements
[INFO] Kmeans Cluster 12: 85 elements
[INFO] Kmeans Cluster 13: 18 elements
[INFO] Kmeans Cluster 14: 62 elements
[INFO] Kmeans Cluster 15: 49 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=108.95, Long SMA=148.56, Sharpe=0.2295
[INFO] Centroid 1: Short SMA=217.36, Long SMA=236.25, Sharpe=0.5649
[INFO] Centroid 2: Short SMA=31.73, Long SMA=56.91, Sharpe=-0.0323
[INFO] Centroid 3: Short SMA=11.74, Long SMA=273.74, Sharpe=0.5210
[INFO] Centroid 4: Short SMA=81.64, Long SMA=118.85, Sharpe=0.3152
[INFO] Centroid 5: Short SMA=194.62, Long SMA=215.69, Sharpe=0.7579
[INFO] Centroid 6: Short SMA=280.18, Long SMA=289.64, Sharpe=0.5319
[INFO] Centroid 7: Short SMA=256.31, Long SMA=267.46, Sharpe=0.2761
[INFO] Centroid 8: Short SMA=189.96, Long SMA=205.25, Sharpe=0.4956
[INFO] Centroid 9: Short SMA=27.94, Long SMA=65.20, Sharpe=0.2893
[INFO] Centroid 10: Short SMA=30.97, Long SMA=149.46, Sharpe=0.3265
[INFO] Centroid 11: Short SMA=147.89, Long SMA=174.16, Sharpe=0.3419
[INFO] Centroid 12: Short SMA=195.62, Long SMA=213.84, Sharpe=0.6344
[INFO] Centroid 14: Short SMA=247.23, Long SMA=264.39, Sharpe=0.4109
[INFO] Centroid 15: Short SMA=57.63, Long SMA=113.80, Sharpe=0.1764
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=194, Long SMA=220, Sharpe=0.8709, Trades=12
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=196, Long SMA=218, Sharpe=0.7812, Trades=12
[INFO] Kmeans Top 2: Short SMA=196, Long SMA=214, Sharpe=0.6660, Trades=12
[INFO] Kmeans Top 3: Short SMA=12, Long SMA=288, Sharpe=0.6154, Trades=13
[INFO] Kmeans Top 4: Short SMA=218, Long SMA=236, Sharpe=0.5502, Trades=20
[INFO] Kmeans Top 5: Short SMA=192, Long SMA=206, Sharpe=0.5402, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 15}
[INFO]   Rounded: (109, 149)
[INFO]   Nearest: (108.0, 148.0)
[INFO]   Rounded: (217, 236)
[INFO]   Nearest: (218.0, 236.0)
[INFO]   Rounded: (32, 57)
[INFO]   Nearest: (32.0, 56.0)
[INFO]   Rounded: (12, 274)
[INFO]   Rounded: (82, 119)
[INFO]   Nearest: (82.0, 118.0)
[INFO]   Rounded: (195, 216)
[INFO]   Nearest: (194.0, 216.0)
[INFO]   Rounded: (280, 290)
[INFO]   Rounded: (256, 267)
[INFO]   Nearest: (256.0, 268.0)
[INFO]   Rounded: (190, 205)
[INFO]   Nearest: (190.0, 206.0)
[INFO]   Rounded: (28, 65)
[INFO]   Nearest: (28.0, 66.0)
[INFO]   Rounded: (31, 149)
[INFO]   Nearest: (30.0, 150.0)
[INFO]   Rounded: (148, 174)
[INFO]   Rounded: (196, 214)
[INFO]   Rounded: (247, 264)
[INFO]   Nearest: (248.0, 264.0)
[INFO]   Rounded: (58, 114)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 194, Long SMA: 220
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(196/218) - Original Sharpe: 0.7812, Trades: 12
[INFO] Kmeans cluster 2: SMA(196/214) - Original Sharpe: 0.6660, Trades: 12
[INFO] Kmeans cluster 3: SMA(12/288) - Original Sharpe: 0.6154, Trades: 13
[INFO] Kmeans cluster 4: SMA(218/236) - Original Sharpe: 0.5502, Trades: 20
[INFO] Kmeans cluster 5: SMA(192/206) - Original Sharpe: 0.5402, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (194/220)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (196/218) - Sharpe: 0.7812
[INFO] cluster 2: (196/214) - Sharpe: 0.6660
[INFO] cluster 3: (12/288) - Sharpe: 0.6154
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.911391            0.911391
1    2021-11-14 2021-11-14            43    -0.628261           -0.628261
2    2022-01-14 2022-01-14            41    -2.812439           -3.084124
3    2022-03-14 2022-03-14            44    -0.960414           -2.439773
4    2022-05-14 2022-05-14            43     2.767958            2.705475
5    2022-07-14 2022-07-14            44    -0.911692           -0.603589
6    2022-09-14 2022-09-14            43    -0.232210           -0.232210
7    2022-11-14 2022-11-14            43     0.093646            0.093646
8    2023-01-14 2023-01-14            41     1.619125            0.623350
9    2023-03-14 2023-03-14            44    -1.971657           -1.261401
10   2023-05-14 2023-05-14            44    -1.476352            1.690896
11   2023-07-14 2023-07-14            44    -0.689668           -0.689668
12   2023-09-14 2023-09-14            43    -1.587437           -1.837181
13   2023-11-14 2023-11-14            42     3.878695            3.878695
14   2024-01-14 2024-01-14            43     3.930264            3.930264
15   2024-03-14 2024-03-14            42    -0.498348           -0.498348
16   2024-05-14 2024-05-14            44     4.604239            4.604239
17   2024-07-14 2024-07-14            45    -0.424050           -0.424050
18   2024-09-14 2024-09-14            43     2.451837            2.451837
19   2024-11-14 2024-11-14            33    -1.823399           -1.823399
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.8 |             -3.1 |         -0.3 | False         
[INFO] 2022-03-14   |         -1.0 |             -2.4 |         -1.4 | False         
[INFO] 2022-05-14   |          2.8 |              2.7 |         -0.1 | False         
[INFO] 2022-07-14   |         -0.9 |             -0.6 |          0.3 | True          
[INFO] 2022-09-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.6 |              0.6 |         -1.0 | False         
[INFO] 2023-03-14   |         -2.0 |             -1.3 |          0.7 | True          
[INFO] 2023-05-14   |         -1.5 |              1.7 |          3.2 | True          
[INFO] 2023-07-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.6 |             -1.8 |         -0.2 | False         
[INFO] 2023-11-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-09-14, 2022-11-14, 2023-07-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Kmeans cluster wins (rounded comparison): 3 of 8 periods (37.50% win rate)
[INFO] Updating Excel file with Kmeans results for ES...
[INFO] Excel file updated successfully. Added ES with Kmeans win rate 37.5% in row 15
[INFO] Added best Sharpe parameters 194/220 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 194, Long SMA: 220
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(196/218) - Original Sharpe: 0.7812
[INFO] Added cluster 2 to portfolio: SMA(196/214) - Original Sharpe: 0.6660
[INFO] Added cluster 3 to portfolio: SMA(12/288) - Original Sharpe: 0.6154
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ES_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2187
[INFO] Kmeans Best out-of-sample Sharpe: 0.1969
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for ES...
[INFO] Excel file updated successfully. Added ES with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ES
[INFO] Big Point Value: 50.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 760 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.1997 to 0.8709
[INFO] 
Best parameters:
[INFO] Short SMA: 194
[INFO] Long SMA: 220
[INFO] Sharpe Ratio: 0.870926
[INFO] Number of Trades: 12
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 760 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.1997 to 0.8709
[INFO] Trades range: 10.0 to 172.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.7068 to 1.6737
[INFO] Scaled Long SMA range: -2.5853 to 1.5815
[INFO] Scaled Sharpe ratio range: -3.3282 to 2.3119
[INFO] Scaled Trades range: -0.6119 to 11.6841
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 760
[INFO] Cophenetic correlation: 0.6073
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 22
[INFO] Using 22 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 22 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 58 elements
[INFO] Cluster 1: 71 elements
[INFO] Cluster 2: 33 elements
[INFO] Cluster 3: 84 elements
[INFO] Cluster 4: 26 elements
[INFO] Cluster 5: 19 elements
[INFO] Cluster 6: 2 elements
[INFO] Cluster 7: 10 elements
[INFO] Cluster 8: 13 elements
[INFO] Cluster 9: 49 elements
[INFO] Cluster 10: 11 elements
[INFO] Cluster 11: 24 elements
[INFO] Cluster 12: 19 elements
[INFO] Cluster 13: 33 elements
[INFO] Cluster 14: 3 elements
[INFO] Cluster 15: 52 elements
[INFO] Cluster 16: 47 elements
[INFO] Cluster 17: 56 elements
[INFO] Cluster 18: 51 elements
[INFO] Cluster 19: 23 elements
[INFO] Cluster 20: 56 elements
[INFO] Cluster 21: 20 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=188, Long SMA=210, Sharpe=0.4772, Trades=14
[INFO] Cluster 1 cluster: Short SMA=46, Long SMA=140, Sharpe=0.1069, Trades=10
[INFO] Cluster 2 cluster: Short SMA=204, Long SMA=212, Sharpe=0.6481, Trades=24
[INFO] Cluster 3 cluster: Short SMA=200, Long SMA=224, Sharpe=0.6730, Trades=12
[INFO] Cluster 4 cluster: Short SMA=230, Long SMA=234, Sharpe=0.4673, Trades=32
[INFO] Cluster 9 cluster: Short SMA=60, Long SMA=104, Sharpe=0.2034, Trades=14
[INFO] Cluster 11 cluster: Short SMA=12, Long SMA=286, Sharpe=0.6116, Trades=13
[INFO] Cluster 13 cluster: Short SMA=266, Long SMA=274, Sharpe=0.2221, Trades=21
[INFO] Cluster 15 cluster: Short SMA=118, Long SMA=154, Sharpe=0.2510, Trades=10
[INFO] Cluster 16 cluster: Short SMA=282, Long SMA=292, Sharpe=0.5679, Trades=15
[INFO] Cluster 17 cluster: Short SMA=150, Long SMA=176, Sharpe=0.2695, Trades=10
[INFO] Cluster 18 cluster: Short SMA=236, Long SMA=260, Sharpe=0.4372, Trades=10
[INFO] Cluster 19 cluster: Short SMA=284, Long SMA=286, Sharpe=0.5233, Trades=29
[INFO] Cluster 20 cluster: Short SMA=196, Long SMA=218, Sharpe=0.7812, Trades=12
[INFO] Cluster 21 cluster: Short SMA=20, Long SMA=80, Sharpe=0.3736, Trades=24
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=194, Long SMA=220, Sharpe=0.8709, Trades=12
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=196, Long SMA=218, Sharpe=0.7812, Trades=12
[INFO] Top 2: Short SMA=200, Long SMA=224, Sharpe=0.6730, Trades=12
[INFO] Top 3: Short SMA=204, Long SMA=212, Sharpe=0.6481, Trades=24
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 683 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 194, Long SMA: 220
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(196/218) - Original Sharpe: 0.7812, Trades: 12
[INFO] Hierarchical cluster 2: SMA(200/224) - Original Sharpe: 0.6730, Trades: 12
[INFO] Hierarchical cluster 3: SMA(204/212) - Original Sharpe: 0.6481, Trades: 24
[INFO] Hierarchical cluster 4: SMA(12/286) - Original Sharpe: 0.6116, Trades: 13
[INFO] Hierarchical cluster 5: SMA(282/292) - Original Sharpe: 0.5679, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (194/220)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (196/218) - Sharpe: 0.7812
[INFO] cluster 2: (200/224) - Sharpe: 0.6730
[INFO] cluster 3: (204/212) - Sharpe: 0.6481
[INFO] Loading ES data from local files...
[INFO] Found data file: A_OHLCV_@ES_minutes_1440_1703-1557.dat
[INFO] File size: 312765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.911391            0.911391
1    2021-11-14 2021-11-14            43    -0.628261           -0.628261
2    2022-01-14 2022-01-14            41    -2.812439           -2.812439
3    2022-03-14 2022-03-14            44    -0.960414           -0.960414
4    2022-05-14 2022-05-14            43     2.767958            0.406664
5    2022-07-14 2022-07-14            44    -0.911692           -0.164054
6    2022-09-14 2022-09-14            43    -0.232210           -0.232210
7    2022-11-14 2022-11-14            43     0.093646            0.093646
8    2023-01-14 2023-01-14            41     1.619125            1.619125
9    2023-03-14 2023-03-14            44    -1.971657           -2.158404
10   2023-05-14 2023-05-14            44    -1.476352           -2.904270
11   2023-07-14 2023-07-14            44    -0.689668           -0.689668
12   2023-09-14 2023-09-14            43    -1.587437           -1.587437
13   2023-11-14 2023-11-14            42     3.878695            3.878695
14   2024-01-14 2024-01-14            43     3.930264            3.930264
15   2024-03-14 2024-03-14            42    -0.498348           -0.498348
16   2024-05-14 2024-05-14            44     4.604239            4.604239
17   2024-07-14 2024-07-14            45    -0.424050           -0.424050
18   2024-09-14 2024-09-14            43     2.451837            2.451837
19   2024-11-14 2024-11-14            33    -1.823399           -1.823399
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-05-14   |          2.8 |              0.4 |         -2.4 | False         
[INFO] 2022-07-14   |         -0.9 |             -0.2 |          0.7 | True          
[INFO] 2022-09-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -2.0 |             -2.2 |         -0.2 | False         
[INFO] 2023-05-14   |         -1.5 |             -2.9 |         -1.4 | False         
[INFO] 2023-07-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 4
[INFO] Hierarchical cluster wins (rounded comparison): 1 of 4 periods (25.00% win rate)
[INFO] Updating Excel file with Hierarchical results for ES...
[INFO] Excel file updated successfully. Added ES with Hierarchical win rate 25.0% in row 15
[INFO] Added best Sharpe parameters 194/220 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 194, Long SMA: 220
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(196/218) - Original Sharpe: 0.7812
[INFO] Added cluster 2 to portfolio: SMA(200/224) - Original Sharpe: 0.6730
[INFO] Added cluster 3 to portfolio: SMA(204/212) - Original Sharpe: 0.6481
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ES_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0383
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1969
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for ES...
[INFO] Excel file updated successfully. Added ES with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ES
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FC in column D: 25.0
[INFO] Using slippage from Excel column D: 25.0
[INFO] 
Symbol: @FC
[INFO] Description: Feeder Cattle Continuous Contract [May25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 12.5
[INFO] Big point value: 500.0
[INFO] Data shape: (4628, 6)
[INFO] Date range: 2006-05-01 13:02:00 to 2025-04-07 13:02:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime     open     high      low    close  volume
0 2006-05-01 13:02:00  260.700  260.700  260.700  260.700     1.0
1 2006-05-02 13:02:00  262.425  262.425  262.425  262.425     1.0
2 2006-05-15 13:02:00  265.625  265.625  265.375  265.375     2.0
3 2006-05-16 13:02:00  265.375  265.375  265.375  265.375     1.0
4 2006-05-18 13:02:00  265.450  265.450  265.450  265.450     1.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 28.25 seconds (0.47 minutes)
[INFO] Best parameters found: Short SMA = 212, Long SMA = 214
[INFO] Best fitness (Sharpe ratio): 0.759717
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 212, Long SMA = 214, Sharpe = 0.759717
[INFO] Top 2: Short SMA = 200, Long SMA = 220, Sharpe = 0.673430
[INFO] Top 3: Short SMA = 212, Long SMA = 216, Sharpe = 0.657358
[INFO] Top 4: Short SMA = 210, Long SMA = 212, Sharpe = 0.654920
[INFO] Top 5: Short SMA = 202, Long SMA = 216, Sharpe = 0.652445
[INFO] Hall of Fame size: 2433
[INFO] Number of elements in all_results: 2231
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 202 had penalty fitness
[INFO] Total filtered from Hall of Fame: 202
[INFO] Hall of Fame -> all_results: 2433 -> 2231
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2231 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FC
[INFO] Big Point Value (from data): 500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.42 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $-42,050.00
[INFO] Market Buy & Hold P&L: $4,212.50
[INFO] Outperformance: $-46,262.50
[INFO] Sharpe ratio (entire period, annualized): -0.014040
[INFO] Sharpe ratio (in-sample, annualized): 0.079303
[INFO] Sharpe ratio (out-of-sample, annualized): -0.228258
[INFO] Maximum Drawdown: $231,425.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $45,787.50
[INFO] Out-of-sample P&L: $-57,425.00
[INFO] 
Best parameters from GA: Short SMA = 212, Long SMA = 214, Sharpe = 0.759717
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2433
[INFO] Cache hits (repeated combinations): 6208
[INFO] Total checks: 8641
[INFO] Cache hit rate: 71.84%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 500.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2231 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.3597 to 0.7597
[INFO] 
Best parameters:
[INFO] Short SMA: 212
[INFO] Long SMA: 214
[INFO] Sharpe Ratio: 0.759717
[INFO] Number of Trades: 56
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2231 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.3597 to 0.7597
[INFO] Trades range: 10.0 to 165.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5148 to 2.2276
[INFO] Scaled Long SMA range: -3.0842 to 1.3840
[INFO] Scaled Sharpe ratio range: -2.9929 to 3.7441
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 14
[INFO] Using 14 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=14...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 165 elements
[INFO] Kmeans Cluster 1: 144 elements
[INFO] Kmeans Cluster 2: 185 elements
[INFO] Kmeans Cluster 3: 159 elements
[INFO] Kmeans Cluster 4: 133 elements
[INFO] Kmeans Cluster 5: 140 elements
[INFO] Kmeans Cluster 6: 70 elements
[INFO] Kmeans Cluster 7: 217 elements
[INFO] Kmeans Cluster 8: 323 elements
[INFO] Kmeans Cluster 9: 129 elements
[INFO] Kmeans Cluster 10: 171 elements
[INFO] Kmeans Cluster 11: 181 elements
[INFO] Kmeans Cluster 12: 185 elements
[INFO] Kmeans Cluster 13: 29 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=189.07, Long SMA=243.47, Sharpe=0.2687
[INFO] Centroid 1: Short SMA=66.68, Long SMA=259.51, Sharpe=0.0795
[INFO] Centroid 2: Short SMA=255.42, Long SMA=281.42, Sharpe=-0.0281
[INFO] Centroid 3: Short SMA=167.04, Long SMA=210.78, Sharpe=0.0637
[INFO] Centroid 4: Short SMA=53.95, Long SMA=104.66, Sharpe=0.2284
[INFO] Centroid 5: Short SMA=48.87, Long SMA=96.84, Sharpe=0.4145
[INFO] Centroid 6: Short SMA=198.94, Long SMA=218.89, Sharpe=0.4991
[INFO] Centroid 7: Short SMA=44.93, Long SMA=207.56, Sharpe=-0.0193
[INFO] Centroid 8: Short SMA=209.24, Long SMA=270.80, Sharpe=0.1440
[INFO] Centroid 9: Short SMA=59.94, Long SMA=279.01, Sharpe=-0.1066
[INFO] Centroid 10: Short SMA=67.03, Long SMA=217.49, Sharpe=0.2473
[INFO] Centroid 11: Short SMA=85.85, Long SMA=154.87, Sharpe=0.0394
[INFO] Centroid 12: Short SMA=146.86, Long SMA=195.14, Sharpe=0.2636
[INFO] Centroid 13: Short SMA=20.34, Long SMA=50.07, Sharpe=-0.1309
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=212, Long SMA=214, Sharpe=0.7597, Trades=56
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=206, Long SMA=218, Sharpe=0.5250, Trades=23
[INFO] Kmeans Top 2: Short SMA=48, Long SMA=102, Sharpe=0.4034, Trades=20
[INFO] Kmeans Top 3: Short SMA=200, Long SMA=238, Sharpe=0.2568, Trades=15
[INFO] Kmeans Top 4: Short SMA=144, Long SMA=204, Sharpe=0.2542, Trades=15
[INFO] Kmeans Top 5: Short SMA=72, Long SMA=216, Sharpe=0.2515, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}
[INFO]   Rounded: (189, 243)
[INFO]   Nearest: (190.0, 244.0)
[INFO]   Rounded: (67, 260)
[INFO]   Nearest: (66.0, 260.0)
[INFO]   Rounded: (255, 281)
[INFO]   Nearest: (256.0, 282.0)
[INFO]   Rounded: (167, 211)
[INFO]   Nearest: (168.0, 210.0)
[INFO]   Rounded: (54, 105)
[INFO]   Nearest: (54.0, 104.0)
[INFO]   Rounded: (49, 97)
[INFO]   Nearest: (48.0, 96.0)
[INFO]   Rounded: (199, 219)
[INFO]   Nearest: (198.0, 218.0)
[INFO]   Rounded: (45, 208)
[INFO]   Nearest: (44.0, 208.0)
[INFO]   Rounded: (209, 271)
[INFO]   Nearest: (210.0, 270.0)
[INFO]   Rounded: (60, 279)
[INFO]   Nearest: (60.0, 280.0)
[INFO]   Rounded: (67, 217)
[INFO]   Nearest: (68.0, 218.0)
[INFO]   Rounded: (86, 155)
[INFO]   Nearest: (86.0, 154.0)
[INFO]   Rounded: (147, 195)
[INFO]   Nearest: (146.0, 196.0)
[INFO]   Rounded: (20, 50)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 212, Long SMA: 214
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(206/218) - Original Sharpe: 0.5250, Trades: 23
[INFO] Kmeans cluster 2: SMA(48/102) - Original Sharpe: 0.4034, Trades: 20
[INFO] Kmeans cluster 3: SMA(200/238) - Original Sharpe: 0.2568, Trades: 15
[INFO] Kmeans cluster 4: SMA(144/204) - Original Sharpe: 0.2542, Trades: 15
[INFO] Kmeans cluster 5: SMA(72/216) - Original Sharpe: 0.2515, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (212/214)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (206/218) - Sharpe: 0.5250
[INFO] cluster 2: (48/102) - Sharpe: 0.4034
[INFO] cluster 3: (200/238) - Sharpe: 0.2568
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.243014            0.292851
1    2021-11-10 2021-11-10            41    -1.727839           -1.895281
2    2022-01-10 2022-01-10            41    -1.491477           -1.599616
3    2022-03-10 2022-03-10            42    -2.601234            0.042891
4    2022-05-10 2022-05-10            41     0.452239            0.452239
5    2022-07-10 2022-07-10            44    -0.869854           -1.941722
6    2022-09-10 2022-09-10            43     2.218651            1.825473
7    2022-11-10 2022-11-10            40    -1.000002           -0.987037
8    2023-01-10 2023-01-10            41    -0.351051            4.019152
9    2023-03-10 2023-03-10            42     1.488556            0.686008
10   2023-05-10 2023-05-10            40    -0.521278            4.044053
11   2023-07-10 2023-07-10            44     2.056252            2.056252
12   2023-09-10 2023-09-10            44    -4.792962           -3.979653
13   2023-11-10 2023-11-10            40    -0.611143           -0.611143
14   2024-01-10 2024-01-10            41     4.588013            1.153310
15   2024-03-10 2024-03-10            43    -2.405032           -2.364664
16   2024-05-10 2024-05-10            40    -0.870401           -0.330357
17   2024-07-10 2024-07-10            43     2.708529            1.397271
18   2024-09-10 2024-09-10            44     0.264177           -2.579145
19   2024-11-10 2024-11-10            35     3.696891            4.950661
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.2 |              0.3 |          0.5 | True          
[INFO] 2021-11-10   |         -1.7 |             -1.9 |         -0.2 | False         
[INFO] 2022-01-10   |         -1.5 |             -1.6 |         -0.1 | False         
[INFO] 2022-03-10   |         -2.6 |              0.0 |          2.6 | True          
[INFO] 2022-05-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.9 |             -1.9 |         -1.0 | False         
[INFO] 2022-09-10   |          2.2 |              1.8 |         -0.4 | False         
[INFO] 2022-11-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2023-01-10   |         -0.4 |              4.0 |          4.4 | True          
[INFO] 2023-03-10   |          1.5 |              0.7 |         -0.8 | False         
[INFO] 2023-05-10   |         -0.5 |              4.0 |          4.5 | True          
[INFO] 2023-07-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -4.8 |             -4.0 |          0.8 | True          
[INFO] 2023-11-10   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2024-01-10   |          4.6 |              1.2 |         -3.4 | False         
[INFO] 2024-03-10   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2024-05-10   |         -0.9 |             -0.3 |          0.6 | True          
[INFO] 2024-07-10   |          2.7 |              1.4 |         -1.3 | False         
[INFO] 2024-09-10   |          0.3 |             -2.6 |         -2.9 | False         
[INFO] 2024-11-10   |          3.7 |              5.0 |          1.3 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-10, 2022-11-10, 2023-07-10, 2023-11-10, 2024-03-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Kmeans cluster wins (rounded comparison): 7 of 15 periods (46.67% win rate)
[INFO] Updating Excel file with Kmeans results for FC...
[INFO] Excel file updated successfully. Added FC with Kmeans win rate 46.7% in row 16
[INFO] Added best Sharpe parameters 212/214 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 212, Long SMA: 214
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(206/218) - Original Sharpe: 0.5250
[INFO] Added cluster 2 to portfolio: SMA(48/102) - Original Sharpe: 0.4034
[INFO] Added cluster 3 to portfolio: SMA(200/238) - Original Sharpe: 0.2568
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1224
[INFO] Kmeans Best out-of-sample Sharpe: -0.2095
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FC...
[INFO] Excel file updated successfully. Added FC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FC
[INFO] Big Point Value: 500.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2231 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.3597 to 0.7597
[INFO] 
Best parameters:
[INFO] Short SMA: 212
[INFO] Long SMA: 214
[INFO] Sharpe Ratio: 0.759717
[INFO] Number of Trades: 56
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2231 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.3597 to 0.7597
[INFO] Trades range: 10.0 to 165.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5148 to 2.2276
[INFO] Scaled Long SMA range: -3.0842 to 1.3840
[INFO] Scaled Sharpe ratio range: -2.9929 to 3.7441
[INFO] Scaled Trades range: -0.6780 to 12.7925
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2231 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6148
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 216 elements
[INFO] Cluster 1: 183 elements
[INFO] Cluster 2: 185 elements
[INFO] Cluster 3: 211 elements
[INFO] Cluster 4: 234 elements
[INFO] Cluster 5: 67 elements
[INFO] Cluster 6: 51 elements
[INFO] Cluster 7: 193 elements
[INFO] Cluster 8: 25 elements
[INFO] Cluster 9: 258 elements
[INFO] Cluster 10: 61 elements
[INFO] Cluster 11: 189 elements
[INFO] Cluster 12: 5 elements
[INFO] Cluster 13: 22 elements
[INFO] Cluster 14: 181 elements
[INFO] Cluster 15: 118 elements
[INFO] Cluster 16: 32 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=70, Long SMA=274, Sharpe=0.0484, Trades=10
[INFO] Cluster 1 cluster: Short SMA=52, Long SMA=108, Sharpe=0.4813, Trades=18
[INFO] Cluster 2 cluster: Short SMA=158, Long SMA=214, Sharpe=0.1057, Trades=15
[INFO] Cluster 3 cluster: Short SMA=66, Long SMA=222, Sharpe=0.2363, Trades=11
[INFO] Cluster 4 cluster: Short SMA=78, Long SMA=160, Sharpe=0.1498, Trades=13
[INFO] Cluster 5 cluster: Short SMA=46, Long SMA=74, Sharpe=0.2761, Trades=36
[INFO] Cluster 6 cluster: Short SMA=168, Long SMA=172, Sharpe=-0.0232, Trades=43
[INFO] Cluster 7 cluster: Short SMA=202, Long SMA=234, Sharpe=0.2397, Trades=17
[INFO] Cluster 8 cluster: Short SMA=18, Long SMA=56, Sharpe=-0.1735, Trades=46
[INFO] Cluster 9 cluster: Short SMA=202, Long SMA=274, Sharpe=0.1863, Trades=10
[INFO] Cluster 10 cluster: Short SMA=206, Long SMA=218, Sharpe=0.5250, Trades=23
[INFO] Cluster 11 cluster: Short SMA=254, Long SMA=282, Sharpe=-0.0221, Trades=14
[INFO] Cluster 13 cluster: Short SMA=54, Long SMA=62, Sharpe=0.3312, Trades=67
[INFO] Cluster 14 cluster: Short SMA=42, Long SMA=218, Sharpe=0.0442, Trades=14
[INFO] Cluster 15 cluster: Short SMA=142, Long SMA=218, Sharpe=0.3912, Trades=13
[INFO] Cluster 16 cluster: Short SMA=278, Long SMA=282, Sharpe=-0.0378, Trades=32
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=212, Long SMA=214, Sharpe=0.7597, Trades=56
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=206, Long SMA=218, Sharpe=0.5250, Trades=23
[INFO] Top 2: Short SMA=52, Long SMA=108, Sharpe=0.4813, Trades=18
[INFO] Top 3: Short SMA=142, Long SMA=218, Sharpe=0.3912, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 2226 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 212, Long SMA: 214
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(206/218) - Original Sharpe: 0.5250, Trades: 23
[INFO] Hierarchical cluster 2: SMA(52/108) - Original Sharpe: 0.4813, Trades: 18
[INFO] Hierarchical cluster 3: SMA(142/218) - Original Sharpe: 0.3912, Trades: 13
[INFO] Hierarchical cluster 4: SMA(54/62) - Original Sharpe: 0.3312, Trades: 67
[INFO] Hierarchical cluster 5: SMA(46/74) - Original Sharpe: 0.2761, Trades: 36
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (212/214)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (206/218) - Sharpe: 0.5250
[INFO] cluster 2: (52/108) - Sharpe: 0.4813
[INFO] cluster 3: (142/218) - Sharpe: 0.3912
[INFO] Loading FC data from local files...
[INFO] Found data file: A_OHLCV_@FC_minutes_1440_0840-1302.dat
[INFO] File size: 222284 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.243014            1.078725
1    2021-11-10 2021-11-10            41    -1.727839           -1.830261
2    2022-01-10 2022-01-10            41    -1.491477           -3.284167
3    2022-03-10 2022-03-10            42    -2.601234            0.173552
4    2022-05-10 2022-05-10            41     0.452239            0.452239
5    2022-07-10 2022-07-10            44    -0.869854           -2.017993
6    2022-09-10 2022-09-10            43     2.218651            1.690203
7    2022-11-10 2022-11-10            40    -1.000002           -1.170182
8    2023-01-10 2023-01-10            41    -0.351051            4.519745
9    2023-03-10 2023-03-10            42     1.488556           -0.942385
10   2023-05-10 2023-05-10            40    -0.521278            4.044053
11   2023-07-10 2023-07-10            44     2.056252            2.056252
12   2023-09-10 2023-09-10            44    -4.792962           -4.553229
13   2023-11-10 2023-11-10            40    -0.611143           -0.611143
14   2024-01-10 2024-01-10            41     4.588013            3.980686
15   2024-03-10 2024-03-10            43    -2.405032            0.260712
16   2024-05-10 2024-05-10            40    -0.870401            0.571272
17   2024-07-10 2024-07-10            43     2.708529            2.088661
18   2024-09-10 2024-09-10            44     0.264177            2.306216
19   2024-11-10 2024-11-10            35     3.696891           -2.730645
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.2 |              1.1 |          1.3 | True          
[INFO] 2021-11-10   |         -1.7 |             -1.8 |         -0.1 | False         
[INFO] 2022-01-10   |         -1.5 |             -3.3 |         -1.8 | False         
[INFO] 2022-03-10   |         -2.6 |              0.2 |          2.8 | True          
[INFO] 2022-05-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2022-07-10   |         -0.9 |             -2.0 |         -1.1 | False         
[INFO] 2022-09-10   |          2.2 |              1.7 |         -0.5 | False         
[INFO] 2022-11-10   |         -1.0 |             -1.2 |         -0.2 | False         
[INFO] 2023-01-10   |         -0.4 |              4.5 |          4.9 | True          
[INFO] 2023-03-10   |          1.5 |             -0.9 |         -2.4 | False         
[INFO] 2023-05-10   |         -0.5 |              4.0 |          4.5 | True          
[INFO] 2023-07-10   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -4.8 |             -4.6 |          0.2 | True          
[INFO] 2023-11-10   |         -0.6 |             -0.6 |          0.0 | Excluded      
[INFO] 2024-01-10   |          4.6 |              4.0 |         -0.6 | False         
[INFO] 2024-03-10   |         -2.4 |              0.3 |          2.7 | True          
[INFO] 2024-05-10   |         -0.9 |              0.6 |          1.5 | True          
[INFO] 2024-07-10   |          2.7 |              2.1 |         -0.6 | False         
[INFO] 2024-09-10   |          0.3 |              2.3 |          2.0 | True          
[INFO] 2024-11-10   |          3.7 |             -2.7 |         -6.4 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-10, 2023-07-10, 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 17 periods (47.06% win rate)
[INFO] Updating Excel file with Hierarchical results for FC...
[INFO] Excel file updated successfully. Added FC with Hierarchical win rate 47.1% in row 16
[INFO] Added best Sharpe parameters 212/214 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 212, Long SMA: 214
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(206/218) - Original Sharpe: 0.5250
[INFO] Added cluster 2 to portfolio: SMA(52/108) - Original Sharpe: 0.4813
[INFO] Added cluster 3 to portfolio: SMA(142/218) - Original Sharpe: 0.3912
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0235
[INFO] Hierarchical Best out-of-sample Sharpe: -0.2095
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FC...
[INFO] Excel file updated successfully. Added FC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FC
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FDAX in column D: 27.0
[INFO] Using slippage from Excel column D: 27.0
[INFO] 
Symbol: @FDAX
[INFO] Description: DAX  Futures Continuous Contract DE0008469594
[INFO] Exchange: EUREX
[INFO] Interval: minutes 1440
[INFO] Tick size: 25.0
[INFO] Big point value: 25.0
[INFO] Data shape: (6402, 6)
[INFO] Date range: 2000-01-03 21:57:00 to 2025-04-07 21:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close   volume
0 2000-01-03 21:57:00  9511.0  9533.0  9090.0  9128.0  58706.0
1 2000-01-04 21:57:00  9123.0  9123.0  8879.0  8953.0  72075.0
2 2000-01-05 21:57:00  8790.0  8945.0  8786.0  8855.0  68894.0
3 2000-01-06 21:57:00  8847.0  8900.0  8761.0  8829.0  58470.0
4 2000-01-07 21:57:00  8883.0  9158.0  8872.0  9153.0  68727.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 28.24 seconds (0.47 minutes)
[INFO] Best parameters found: Short SMA = 182, Long SMA = 226
[INFO] Best fitness (Sharpe ratio): 0.538182
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 182, Long SMA = 226, Sharpe = 0.538182
[INFO] Top 2: Short SMA = 180, Long SMA = 228, Sharpe = 0.535683
[INFO] Top 3: Short SMA = 186, Long SMA = 224, Sharpe = 0.531246
[INFO] Top 4: Short SMA = 186, Long SMA = 220, Sharpe = 0.525424
[INFO] Top 5: Short SMA = 186, Long SMA = 226, Sharpe = 0.518854
[INFO] Hall of Fame size: 2300
[INFO] Number of elements in all_results: 1403
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 897 had penalty fitness
[INFO] Total filtered from Hall of Fame: 897
[INFO] Hall of Fame -> all_results: 2300 -> 1403
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1403 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3053, Evaluation data length: 2794
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FDAX
[INFO] Big Point Value (from data): 25.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 1.84 contracts
[INFO] Maximum Position Size: 3 contracts
[INFO] Strategy Total P&L: $-452,625.00
[INFO] Market Buy & Hold P&L: $221,350.00
[INFO] Outperformance: $-673,975.00
[INFO] Sharpe ratio (entire period, annualized): -0.330752
[INFO] Sharpe ratio (in-sample, annualized): -0.360632
[INFO] Sharpe ratio (out-of-sample, annualized): -0.262143
[INFO] Maximum Drawdown: $446,550.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-267,800.00
[INFO] Out-of-sample P&L: $-84,975.00
[INFO] 
Best parameters from GA: Short SMA = 182, Long SMA = 226, Sharpe = 0.538182
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2300
[INFO] Cache hits (repeated combinations): 6266
[INFO] Total checks: 8566
[INFO] Cache hit rate: 73.15%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 25.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1403 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.7139 to 0.5382
[INFO] 
Best parameters:
[INFO] Short SMA: 182
[INFO] Long SMA: 226
[INFO] Sharpe Ratio: 0.538182
[INFO] Number of Trades: 12
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1403 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.7139 to 0.5382
[INFO] Trades range: 10.0 to 209.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5014 to 1.8673
[INFO] Scaled Long SMA range: -3.1299 to 1.4691
[INFO] Scaled Sharpe ratio range: -2.6873 to 2.4101
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 14
[INFO] Using 14 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=14...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 53 elements
[INFO] Kmeans Cluster 1: 112 elements
[INFO] Kmeans Cluster 2: 134 elements
[INFO] Kmeans Cluster 3: 139 elements
[INFO] Kmeans Cluster 4: 130 elements
[INFO] Kmeans Cluster 5: 118 elements
[INFO] Kmeans Cluster 6: 75 elements
[INFO] Kmeans Cluster 7: 79 elements
[INFO] Kmeans Cluster 8: 141 elements
[INFO] Kmeans Cluster 9: 104 elements
[INFO] Kmeans Cluster 10: 79 elements
[INFO] Kmeans Cluster 11: 142 elements
[INFO] Kmeans Cluster 12: 29 elements
[INFO] Kmeans Cluster 13: 68 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=25.32, Long SMA=58.23, Sharpe=0.0275
[INFO] Centroid 1: Short SMA=222.23, Long SMA=247.32, Sharpe=0.0277
[INFO] Centroid 2: Short SMA=59.37, Long SMA=149.85, Sharpe=-0.1897
[INFO] Centroid 3: Short SMA=194.49, Long SMA=220.53, Sharpe=0.2379
[INFO] Centroid 4: Short SMA=140.34, Long SMA=171.91, Sharpe=-0.1207
[INFO] Centroid 5: Short SMA=271.54, Long SMA=288.88, Sharpe=-0.4184
[INFO] Centroid 6: Short SMA=32.00, Long SMA=267.39, Sharpe=-0.2991
[INFO] Centroid 7: Short SMA=47.59, Long SMA=91.65, Sharpe=-0.3232
[INFO] Centroid 8: Short SMA=32.81, Long SMA=218.18, Sharpe=-0.1408
[INFO] Centroid 9: Short SMA=240.35, Long SMA=268.58, Sharpe=-0.1213
[INFO] Centroid 10: Short SMA=70.13, Long SMA=268.41, Sharpe=-0.1002
[INFO] Centroid 11: Short SMA=189.21, Long SMA=221.57, Sharpe=0.4194
[INFO] Centroid 12: Short SMA=96.34, Long SMA=126.41, Sharpe=0.0802
[INFO] Centroid 13: Short SMA=170.82, Long SMA=196.21, Sharpe=0.0594
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=182, Long SMA=226, Sharpe=0.5382, Trades=12
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=190, Long SMA=222, Sharpe=0.5179, Trades=14
[INFO] Kmeans Top 2: Short SMA=200, Long SMA=220, Sharpe=0.3250, Trades=16
[INFO] Kmeans Top 3: Short SMA=92, Long SMA=126, Sharpe=0.2272, Trades=16
[INFO] Kmeans Top 4: Short SMA=20, Long SMA=58, Sharpe=0.0546, Trades=38
[INFO] Kmeans Top 5: Short SMA=174, Long SMA=200, Sharpe=0.0455, Trades=16
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}
[INFO]   Rounded: (25, 58)
[INFO]   Nearest: (26.0, 58.0)
[INFO]   Rounded: (222, 247)
[INFO]   Nearest: (222.0, 248.0)
[INFO]   Rounded: (59, 150)
[INFO]   Nearest: (60.0, 150.0)
[INFO]   Rounded: (194, 221)
[INFO]   Nearest: (194.0, 220.0)
[INFO]   Rounded: (140, 172)
[INFO]   Rounded: (272, 289)
[INFO]   Nearest: (272.0, 288.0)
[INFO]   Rounded: (32, 267)
[INFO]   Nearest: (32.0, 268.0)
[INFO]   Rounded: (48, 92)
[INFO]   Rounded: (33, 218)
[INFO]   Nearest: (32.0, 218.0)
[INFO]   Rounded: (240, 269)
[INFO]   Nearest: (240.0, 268.0)
[INFO]   Rounded: (70, 268)
[INFO]   Rounded: (189, 222)
[INFO]   Nearest: (190.0, 222.0)
[INFO]   Rounded: (96, 126)
[INFO]   Rounded: (171, 196)
[INFO]   Nearest: (170.0, 196.0)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 182, Long SMA: 226
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(190/222) - Original Sharpe: 0.5179, Trades: 14
[INFO] Kmeans cluster 2: SMA(200/220) - Original Sharpe: 0.3250, Trades: 16
[INFO] Kmeans cluster 3: SMA(92/126) - Original Sharpe: 0.2272, Trades: 16
[INFO] Kmeans cluster 4: SMA(20/58) - Original Sharpe: 0.0546, Trades: 38
[INFO] Kmeans cluster 5: SMA(174/200) - Original Sharpe: 0.0455, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2794
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (182/226)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (190/222) - Sharpe: 0.5179
[INFO] cluster 2: (200/220) - Sharpe: 0.3250
[INFO] cluster 3: (92/126) - Sharpe: 0.2272
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Out-of-sample period starts on: 2021-09-20
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-20 2021-09-20            45     1.874942            1.874942
1    2021-11-20 2021-11-20            41    -1.542081           -1.319286
2    2022-01-20 2022-01-20            42    -2.229876           -2.752924
3    2022-03-20 2022-03-20            42     1.098556            0.913688
4    2022-05-20 2022-05-20            43     0.980542            0.980542
5    2022-07-20 2022-07-20            44     1.402100            1.402100
6    2022-09-20 2022-09-20            44    -3.031215           -3.031215
7    2022-11-20 2022-11-20            43    -1.359366           -0.491546
8    2023-01-20 2023-01-20            41    -0.115191            0.409352
9    2023-03-20 2023-03-20            42     4.502487            2.526144
10   2023-05-20 2023-05-20            43    -0.783470           -0.783470
11   2023-07-20 2023-07-20            44    -1.705868           -1.705868
12   2023-09-20 2023-09-20            43     0.424324           -0.513190
13   2023-11-20 2023-11-20            42     2.238515            2.238515
14   2024-01-20 2024-01-20            42    -2.695955           -1.690728
15   2024-03-20 2024-03-20            40     0.078493            0.796702
16   2024-05-20 2024-05-20            45    -1.796289           -1.796289
17   2024-07-20 2024-07-20            44     0.668910            0.179934
18   2024-09-20 2024-09-20            43     0.376154            0.442979
19   2024-11-20 2024-11-20            26     2.631388            2.631388
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-20   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-20   |         -1.5 |             -1.3 |          0.2 | True          
[INFO] 2022-01-20   |         -2.2 |             -2.8 |         -0.6 | False         
[INFO] 2022-03-20   |          1.1 |              0.9 |         -0.2 | False         
[INFO] 2022-05-20   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-07-20   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-09-20   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-11-20   |         -1.4 |             -0.5 |          0.9 | True          
[INFO] 2023-01-20   |         -0.1 |              0.4 |          0.5 | True          
[INFO] 2023-03-20   |          4.5 |              2.5 |         -2.0 | False         
[INFO] 2023-05-20   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-07-20   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-09-20   |          0.4 |             -0.5 |         -0.9 | False         
[INFO] 2023-11-20   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-01-20   |         -2.7 |             -1.7 |          1.0 | True          
[INFO] 2024-03-20   |          0.1 |              0.8 |          0.7 | True          
[INFO] 2024-05-20   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 2024-07-20   |          0.7 |              0.2 |         -0.5 | False         
[INFO] 2024-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-20   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-20, 2022-05-20, 2022-07-20, 2022-09-20, 2023-05-20, 2023-07-20, 2023-11-20, 2024-05-20, 2024-09-20, 2024-11-20
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Kmeans cluster wins (rounded comparison): 5 of 10 periods (50.00% win rate)
[INFO] Updating Excel file with Kmeans results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Kmeans win rate 50.0% in row 17
[INFO] Added best Sharpe parameters 182/226 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 182, Long SMA: 226
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(190/222) - Original Sharpe: 0.5179
[INFO] Added cluster 2 to portfolio: SMA(200/220) - Original Sharpe: 0.3250
[INFO] Added cluster 3 to portfolio: SMA(92/126) - Original Sharpe: 0.2272
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FDAX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1993
[INFO] Kmeans Best out-of-sample Sharpe: -0.1626
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FDAX
[INFO] Big Point Value: 25.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1403 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.7139 to 0.5382
[INFO] 
Best parameters:
[INFO] Short SMA: 182
[INFO] Long SMA: 226
[INFO] Sharpe Ratio: 0.538182
[INFO] Number of Trades: 12
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1403 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.7139 to 0.5382
[INFO] Trades range: 10.0 to 209.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5014 to 1.8673
[INFO] Scaled Long SMA range: -3.1299 to 1.4691
[INFO] Scaled Sharpe ratio range: -2.6873 to 2.4101
[INFO] Scaled Trades range: -0.7169 to 14.9344
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1403 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5944
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 20
[INFO] Using 20 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 20 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 125 elements
[INFO] Cluster 1: 132 elements
[INFO] Cluster 2: 24 elements
[INFO] Cluster 3: 120 elements
[INFO] Cluster 4: 7 elements
[INFO] Cluster 5: 71 elements
[INFO] Cluster 6: 137 elements
[INFO] Cluster 7: 109 elements
[INFO] Cluster 8: 72 elements
[INFO] Cluster 9: 2 elements
[INFO] Cluster 10: 69 elements
[INFO] Cluster 11: 44 elements
[INFO] Cluster 12: 44 elements
[INFO] Cluster 13: 35 elements
[INFO] Cluster 14: 98 elements
[INFO] Cluster 15: 14 elements
[INFO] Cluster 16: 57 elements
[INFO] Cluster 17: 133 elements
[INFO] Cluster 18: 100 elements
[INFO] Cluster 19: 10 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=228, Long SMA=250, Sharpe=-0.0380, Trades=18
[INFO] Cluster 1 cluster: Short SMA=64, Long SMA=152, Sharpe=-0.0150, Trades=14
[INFO] Cluster 2 cluster: Short SMA=202, Long SMA=204, Sharpe=0.2540, Trades=46
[INFO] Cluster 3 cluster: Short SMA=144, Long SMA=186, Sharpe=-0.0476, Trades=12
[INFO] Cluster 5 cluster: Short SMA=190, Long SMA=202, Sharpe=0.2653, Trades=24
[INFO] Cluster 6 cluster: Short SMA=34, Long SMA=220, Sharpe=-0.2168, Trades=12
[INFO] Cluster 7 cluster: Short SMA=274, Long SMA=288, Sharpe=-0.3486, Trades=19
[INFO] Cluster 8 cluster: Short SMA=240, Long SMA=278, Sharpe=-0.0531, Trades=13
[INFO] Cluster 10 cluster: Short SMA=54, Long SMA=104, Sharpe=-0.2571, Trades=22
[INFO] Cluster 11 cluster: Short SMA=154, Long SMA=160, Sharpe=-0.0156, Trades=34
[INFO] Cluster 12 cluster: Short SMA=26, Long SMA=46, Sharpe=0.0759, Trades=40
[INFO] Cluster 13 cluster: Short SMA=88, Long SMA=118, Sharpe=0.0897, Trades=16
[INFO] Cluster 14 cluster: Short SMA=68, Long SMA=266, Sharpe=-0.1649, Trades=11
[INFO] Cluster 16 cluster: Short SMA=24, Long SMA=272, Sharpe=-0.3338, Trades=17
[INFO] Cluster 17 cluster: Short SMA=188, Long SMA=222, Sharpe=0.4928, Trades=14
[INFO] Cluster 18 cluster: Short SMA=198, Long SMA=228, Sharpe=0.3553, Trades=14
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=182, Long SMA=226, Sharpe=0.5382, Trades=12
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=188, Long SMA=222, Sharpe=0.4928, Trades=14
[INFO] Top 2: Short SMA=198, Long SMA=228, Sharpe=0.3553, Trades=14
[INFO] Top 3: Short SMA=190, Long SMA=202, Sharpe=0.2653, Trades=24
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 1370 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 182, Long SMA: 226
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(188/222) - Original Sharpe: 0.4928, Trades: 14
[INFO] Hierarchical cluster 2: SMA(198/228) - Original Sharpe: 0.3553, Trades: 14
[INFO] Hierarchical cluster 3: SMA(190/202) - Original Sharpe: 0.2653, Trades: 24
[INFO] Hierarchical cluster 4: SMA(202/204) - Original Sharpe: 0.2540, Trades: 46
[INFO] Hierarchical cluster 5: SMA(88/118) - Original Sharpe: 0.0897, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2794
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (182/226)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (188/222) - Sharpe: 0.4928
[INFO] cluster 2: (198/228) - Sharpe: 0.3553
[INFO] cluster 3: (190/202) - Sharpe: 0.2653
[INFO] Loading FDAX data from local files...
[INFO] Found data file: A_OHLCV_@FDAX_minutes_1440_0112-2157.dat
[INFO] File size: 307438 bytes
[INFO] Out-of-sample period starts on: 2021-09-20
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-20 2021-09-20            45     1.874942            1.874942
1    2021-11-20 2021-11-20            41    -1.542081           -1.542081
2    2022-01-20 2022-01-20            42    -2.229876           -3.922987
3    2022-03-20 2022-03-20            42     1.098556            0.991740
4    2022-05-20 2022-05-20            43     0.980542            0.980542
5    2022-07-20 2022-07-20            44     1.402100            1.402100
6    2022-09-20 2022-09-20            44    -3.031215           -3.031215
7    2022-11-20 2022-11-20            43    -1.359366           -1.359366
8    2023-01-20 2023-01-20            41    -0.115191           -0.242266
9    2023-03-20 2023-03-20            42     4.502487            3.667341
10   2023-05-20 2023-05-20            43    -0.783470           -0.783470
11   2023-07-20 2023-07-20            44    -1.705868           -1.705868
12   2023-09-20 2023-09-20            43     0.424324            0.062045
13   2023-11-20 2023-11-20            42     2.238515            2.647459
14   2024-01-20 2024-01-20            42    -2.695955           -3.965683
15   2024-03-20 2024-03-20            40     0.078493           -0.336624
16   2024-05-20 2024-05-20            45    -1.796289           -1.796289
17   2024-07-20 2024-07-20            44     0.668910            0.668910
18   2024-09-20 2024-09-20            43     0.376154            0.376154
19   2024-11-20 2024-11-20            26     2.631388            2.631388
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-20   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-20   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-01-20   |         -2.2 |             -3.9 |         -1.7 | False         
[INFO] 2022-03-20   |          1.1 |              1.0 |         -0.1 | False         
[INFO] 2022-05-20   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2022-07-20   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-09-20   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-11-20   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2023-01-20   |         -0.1 |             -0.2 |         -0.1 | False         
[INFO] 2023-03-20   |          4.5 |              3.7 |         -0.8 | False         
[INFO] 2023-05-20   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-07-20   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-09-20   |          0.4 |              0.1 |         -0.3 | False         
[INFO] 2023-11-20   |          2.2 |              2.6 |          0.4 | True          
[INFO] 2024-01-20   |         -2.7 |             -4.0 |         -1.3 | False         
[INFO] 2024-03-20   |          0.1 |             -0.3 |         -0.4 | False         
[INFO] 2024-05-20   |         -1.8 |             -1.8 |          0.0 | Excluded      
[INFO] 2024-07-20   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-20   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-20   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-20, 2021-11-20, 2022-05-20, 2022-07-20, 2022-09-20, 2022-11-20, 2023-05-20, 2023-07-20, 2024-05-20, 2024-07-20, 2024-09-20, 2024-11-20
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Hierarchical cluster wins (rounded comparison): 1 of 8 periods (12.50% win rate)
[INFO] Updating Excel file with Hierarchical results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Hierarchical win rate 12.5% in row 17
[INFO] Added best Sharpe parameters 182/226 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 182, Long SMA: 226
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(188/222) - Original Sharpe: 0.4928
[INFO] Added cluster 2 to portfolio: SMA(198/228) - Original Sharpe: 0.3553
[INFO] Added cluster 3 to portfolio: SMA(190/202) - Original Sharpe: 0.2653
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FDAX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3352
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1626
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for FDAX...
[INFO] Excel file updated successfully. Added FDAX with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FDAX
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FESX in column D: 12.0
[INFO] Using slippage from Excel column D: 12.0
[INFO] 
Symbol: @FESX
[INFO] Description: EURO STOXX 50 Index Continuous Contract DE0009652388
[INFO] Exchange: EUREX
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 10.0
[INFO] Data shape: (6366, 6)
[INFO] Date range: 2000-03-01 21:57:00 to 2025-04-07 21:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close   volume
0 2000-03-01 21:57:00  3765.0  3778.0  3697.0  3770.0  48689.0
1 2000-03-02 21:57:00  3798.0  3950.0  3752.0  3945.0  32143.0
2 2000-03-03 21:57:00  3935.0  4015.0  3901.0  3985.0  42398.0
3 2000-03-06 21:57:00  3998.0  4008.0  3958.0  3996.0  31415.0
4 2000-03-07 21:57:00  3987.0  4045.0  3913.0  3946.0  36643.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 26.98 seconds (0.45 minutes)
[INFO] Best parameters found: Short SMA = 106, Long SMA = 108
[INFO] Best fitness (Sharpe ratio): 0.401709
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 106, Long SMA = 108, Sharpe = 0.401709
[INFO] Top 2: Short SMA = 102, Long SMA = 108, Sharpe = 0.347673
[INFO] Top 3: Short SMA = 186, Long SMA = 200, Sharpe = 0.342022
[INFO] Top 4: Short SMA = 124, Long SMA = 214, Sharpe = 0.331732
[INFO] Top 5: Short SMA = 124, Long SMA = 220, Sharpe = 0.330326
[INFO] Hall of Fame size: 2591
[INFO] Number of elements in all_results: 2063
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 528 had penalty fitness
[INFO] Total filtered from Hall of Fame: 528
[INFO] Hall of Fame -> all_results: 2591 -> 2063
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2063 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3061, Evaluation data length: 2802
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FESX
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 12.10 contracts
[INFO] Maximum Position Size: 27 contracts
[INFO] Strategy Total P&L: $-273,980.00
[INFO] Market Buy & Hold P&L: $27,270.00
[INFO] Outperformance: $-301,250.00
[INFO] Sharpe ratio (entire period, annualized): -0.272407
[INFO] Sharpe ratio (in-sample, annualized): -0.282825
[INFO] Sharpe ratio (out-of-sample, annualized): -0.247473
[INFO] Maximum Drawdown: $292,670.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-156,160.00
[INFO] Out-of-sample P&L: $-57,360.00
[INFO] 
Best parameters from GA: Short SMA = 106, Long SMA = 108, Sharpe = 0.401709
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2591
[INFO] Cache hits (repeated combinations): 6006
[INFO] Total checks: 8597
[INFO] Cache hit rate: 69.86%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 10.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2063 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.6861 to 0.4017
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 108
[INFO] Sharpe Ratio: 0.401709
[INFO] Number of Trades: 56
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2063 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.6861 to 0.4017
[INFO] Trades range: 10.0 to 155.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.6591 to 2.2417
[INFO] Scaled Long SMA range: -3.4256 to 1.6647
[INFO] Scaled Sharpe ratio range: -4.0500 to 2.7932
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 91 elements
[INFO] Kmeans Cluster 1: 154 elements
[INFO] Kmeans Cluster 2: 126 elements
[INFO] Kmeans Cluster 3: 62 elements
[INFO] Kmeans Cluster 4: 186 elements
[INFO] Kmeans Cluster 5: 53 elements
[INFO] Kmeans Cluster 6: 210 elements
[INFO] Kmeans Cluster 7: 151 elements
[INFO] Kmeans Cluster 8: 93 elements
[INFO] Kmeans Cluster 9: 101 elements
[INFO] Kmeans Cluster 10: 248 elements
[INFO] Kmeans Cluster 11: 99 elements
[INFO] Kmeans Cluster 12: 94 elements
[INFO] Kmeans Cluster 13: 115 elements
[INFO] Kmeans Cluster 14: 77 elements
[INFO] Kmeans Cluster 15: 118 elements
[INFO] Kmeans Cluster 16: 85 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=31.63, Long SMA=237.01, Sharpe=-0.2558
[INFO] Centroid 1: Short SMA=209.25, Long SMA=246.44, Sharpe=-0.0043
[INFO] Centroid 2: Short SMA=43.51, Long SMA=197.63, Sharpe=-0.0375
[INFO] Centroid 3: Short SMA=280.10, Long SMA=293.48, Sharpe=-0.4019
[INFO] Centroid 4: Short SMA=134.96, Long SMA=178.86, Sharpe=0.0390
[INFO] Centroid 5: Short SMA=49.09, Long SMA=107.89, Sharpe=-0.3861
[INFO] Centroid 6: Short SMA=134.91, Long SMA=225.89, Sharpe=0.0234
[INFO] Centroid 7: Short SMA=95.38, Long SMA=216.80, Sharpe=-0.1102
[INFO] Centroid 8: Short SMA=130.37, Long SMA=213.59, Sharpe=0.2294
[INFO] Centroid 9: Short SMA=52.53, Long SMA=271.90, Sharpe=-0.0914
[INFO] Centroid 10: Short SMA=191.78, Long SMA=216.96, Sharpe=0.1347
[INFO] Centroid 11: Short SMA=68.22, Long SMA=183.94, Sharpe=-0.2329
[INFO] Centroid 12: Short SMA=247.21, Long SMA=272.70, Sharpe=0.0499
[INFO] Centroid 13: Short SMA=245.01, Long SMA=279.18, Sharpe=-0.1342
[INFO] Centroid 14: Short SMA=76.62, Long SMA=105.58, Sharpe=0.0933
[INFO] Centroid 15: Short SMA=108.56, Long SMA=144.81, Sharpe=-0.1137
[INFO] Centroid 16: Short SMA=36.71, Long SMA=85.53, Sharpe=-0.1657
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=108, Sharpe=0.4017, Trades=56
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=126, Long SMA=214, Sharpe=0.2800, Trades=10
[INFO] Kmeans Top 2: Short SMA=192, Long SMA=218, Sharpe=0.1162, Trades=14
[INFO] Kmeans Top 3: Short SMA=132, Long SMA=178, Sharpe=0.1156, Trades=12
[INFO] Kmeans Top 4: Short SMA=248, Long SMA=272, Sharpe=0.0283, Trades=13
[INFO] Kmeans Top 5: Short SMA=132, Long SMA=224, Sharpe=0.0161, Trades=10
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (32, 237)
[INFO]   Nearest: (32.0, 238.0)
[INFO]   Rounded: (209, 246)
[INFO]   Nearest: (210.0, 246.0)
[INFO]   Rounded: (44, 198)
[INFO]   Rounded: (280, 293)
[INFO]   Nearest: (280.0, 294.0)
[INFO]   Rounded: (135, 179)
[INFO]   Nearest: (134.0, 178.0)
[INFO]   Rounded: (49, 108)
[INFO]   Nearest: (50.0, 108.0)
[INFO]   Rounded: (135, 226)
[INFO]   Nearest: (134.0, 226.0)
[INFO]   Rounded: (95, 217)
[INFO]   Nearest: (96.0, 216.0)
[INFO]   Rounded: (130, 214)
[INFO]   Rounded: (53, 272)
[INFO]   Nearest: (52.0, 272.0)
[INFO]   Rounded: (192, 217)
[INFO]   Nearest: (192.0, 216.0)
[INFO]   Rounded: (68, 184)
[INFO]   Rounded: (247, 273)
[INFO]   Nearest: (248.0, 272.0)
[INFO]   Rounded: (245, 279)
[INFO]   Nearest: (246.0, 280.0)
[INFO]   Rounded: (77, 106)
[INFO]   Nearest: (76.0, 106.0)
[INFO]   Rounded: (109, 145)
[INFO]   Nearest: (108.0, 144.0)
[INFO]   Rounded: (37, 86)
[INFO]   Nearest: (36.0, 86.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 108
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(126/214) - Original Sharpe: 0.2800, Trades: 10
[INFO] Kmeans cluster 2: SMA(192/218) - Original Sharpe: 0.1162, Trades: 14
[INFO] Kmeans cluster 3: SMA(132/178) - Original Sharpe: 0.1156, Trades: 12
[INFO] Kmeans cluster 4: SMA(248/272) - Original Sharpe: 0.0283, Trades: 13
[INFO] Kmeans cluster 5: SMA(132/224) - Original Sharpe: 0.0161, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/108)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (126/214) - Sharpe: 0.2800
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.819258            1.819258
1    2021-11-16 2021-11-16            42    -0.990182           -1.393676
2    2022-01-16 2022-01-16            42    -3.234063           -3.234063
3    2022-03-16 2022-03-16            41     1.259415           -0.756687
4    2022-05-16 2022-05-16            45     1.642319            1.642319
5    2022-07-16 2022-07-16            44     0.816637           -0.103327
6    2022-09-16 2022-09-16            43    -1.315674           -2.305190
7    2022-11-16 2022-11-16            42    -4.141997            4.967547
8    2023-01-16 2023-01-16            43    -0.549165           -0.875610
9    2023-03-16 2023-03-16            40     2.960185            2.960185
10   2023-05-16 2023-05-16            44     0.373260            0.373260
11   2023-07-16 2023-07-16            45    -1.929853           -1.162382
12   2023-09-16 2023-09-16            43    -1.339093            0.025666
13   2023-11-16 2023-11-16            40    -1.599206            2.865517
14   2024-01-16 2024-01-16            44     7.610619           -2.716205
15   2024-03-16 2024-03-16            40     1.356364            1.356364
16   2024-05-16 2024-05-16            43    -1.239630           -1.239630
17   2024-07-16 2024-07-16            44    -2.440824           -1.421227
18   2024-09-16 2024-09-16            45     0.297766           -0.309976
19   2024-11-16 2024-11-16            28    -0.195314           -1.870682
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-16   |         -1.0 |             -1.4 |         -0.4 | False         
[INFO] 2022-01-16   |         -3.2 |             -3.2 |          0.0 | Excluded      
[INFO] 2022-03-16   |          1.3 |             -0.8 |         -2.1 | False         
[INFO] 2022-05-16   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2022-07-16   |          0.8 |             -0.1 |         -0.9 | False         
[INFO] 2022-09-16   |         -1.3 |             -2.3 |         -1.0 | False         
[INFO] 2022-11-16   |         -4.1 |              5.0 |          9.1 | True          
[INFO] 2023-01-16   |         -0.5 |             -0.9 |         -0.4 | False         
[INFO] 2023-03-16   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-05-16   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2023-07-16   |         -1.9 |             -1.2 |          0.7 | True          
[INFO] 2023-09-16   |         -1.3 |              0.0 |          1.3 | True          
[INFO] 2023-11-16   |         -1.6 |              2.9 |          4.5 | True          
[INFO] 2024-01-16   |          7.6 |             -2.7 |        -10.3 | False         
[INFO] 2024-03-16   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2024-05-16   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 2024-07-16   |         -2.4 |             -1.4 |          1.0 | True          
[INFO] 2024-09-16   |          0.3 |             -0.3 |         -0.6 | False         
[INFO] 2024-11-16   |         -0.2 |             -1.9 |         -1.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-01-16, 2022-05-16, 2023-03-16, 2023-05-16, 2024-03-16, 2024-05-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 5 of 13 periods (38.46% win rate)
[INFO] Updating Excel file with Kmeans results for FESX...
[INFO] Excel file updated successfully. Added FESX with Kmeans win rate 38.5% in row 18
[INFO] Added best Sharpe parameters 106/108 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 108
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(126/214) - Original Sharpe: 0.2800
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FESX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1915
[INFO] Kmeans Best out-of-sample Sharpe: -0.1475
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for FESX...
[INFO] Excel file updated successfully. Added FESX with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FESX
[INFO] Big Point Value: 10.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2063 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.6861 to 0.4017
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 108
[INFO] Sharpe Ratio: 0.401709
[INFO] Number of Trades: 56
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2063 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.6861 to 0.4017
[INFO] Trades range: 10.0 to 155.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.6591 to 2.2417
[INFO] Scaled Long SMA range: -3.4256 to 1.6647
[INFO] Scaled Sharpe ratio range: -4.0500 to 2.7932
[INFO] Scaled Trades range: -0.5676 to 14.8620
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2063 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5656
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 331 elements
[INFO] Cluster 1: 301 elements
[INFO] Cluster 2: 56 elements
[INFO] Cluster 3: 259 elements
[INFO] Cluster 4: 186 elements
[INFO] Cluster 5: 98 elements
[INFO] Cluster 6: 84 elements
[INFO] Cluster 7: 61 elements
[INFO] Cluster 8: 4 elements
[INFO] Cluster 9: 113 elements
[INFO] Cluster 10: 165 elements
[INFO] Cluster 11: 129 elements
[INFO] Cluster 12: 18 elements
[INFO] Cluster 13: 57 elements
[INFO] Cluster 14: 201 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=230, Long SMA=262, Sharpe=-0.1093, Trades=13
[INFO] Cluster 1 cluster: Short SMA=70, Long SMA=202, Sharpe=-0.1252, Trades=12
[INFO] Cluster 2 cluster: Short SMA=42, Long SMA=56, Sharpe=-0.2029, Trades=46
[INFO] Cluster 3 cluster: Short SMA=190, Long SMA=214, Sharpe=0.0216, Trades=14
[INFO] Cluster 4 cluster: Short SMA=124, Long SMA=226, Sharpe=0.1652, Trades=10
[INFO] Cluster 5 cluster: Short SMA=276, Long SMA=290, Sharpe=-0.2835, Trades=15
[INFO] Cluster 6 cluster: Short SMA=64, Long SMA=108, Sharpe=-0.1930, Trades=20
[INFO] Cluster 7 cluster: Short SMA=36, Long SMA=116, Sharpe=-0.3922, Trades=22
[INFO] Cluster 9 cluster: Short SMA=48, Long SMA=268, Sharpe=-0.0535, Trades=15
[INFO] Cluster 10 cluster: Short SMA=126, Long SMA=168, Sharpe=0.0585, Trades=12
[INFO] Cluster 11 cluster: Short SMA=32, Long SMA=216, Sharpe=-0.2804, Trades=12
[INFO] Cluster 13 cluster: Short SMA=88, Long SMA=118, Sharpe=0.0779, Trades=22
[INFO] Cluster 14 cluster: Short SMA=136, Long SMA=212, Sharpe=0.0347, Trades=10
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=108, Sharpe=0.4017, Trades=56
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=124, Long SMA=226, Sharpe=0.1652, Trades=10
[INFO] Top 2: Short SMA=88, Long SMA=118, Sharpe=0.0779, Trades=22
[INFO] Top 3: Short SMA=126, Long SMA=168, Sharpe=0.0585, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 2041 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 108
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FESX data from local files...
[INFO] Found data file: A_OHLCV_@FESX_minutes_1440_0112-2157.dat
[INFO] File size: 305717 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(124/226) - Original Sharpe: 0.1652, Trades: 10
[INFO] Hierarchical cluster 2: SMA(88/118) - Original Sharpe: 0.0779, Trades: 22
[INFO] Hierarchical cluster 3: SMA(126/168) - Original Sharpe: 0.0585, Trades: 12
[INFO] Hierarchical cluster 4: SMA(136/212) - Original Sharpe: 0.0347, Trades: 10
[INFO] Hierarchical cluster 5: SMA(190/214) - Original Sharpe: 0.0216, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/108)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 108
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FESX
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FGBL in column D: 12.0
[INFO] Using slippage from Excel column D: 12.0
[INFO] 
Symbol: @FGBL
[INFO] Description: Euro Bund Continuous Contract [Jun25]
[INFO] Exchange: EUREX
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 1000.0
[INFO] Data shape: (6411, 6)
[INFO] Date range: 2000-01-03 21:57:00 to 2025-04-07 21:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close    volume
0 2000-01-03 21:57:00  57.35  57.55  56.66  56.85  360763.0
1 2000-01-04 21:57:00  56.55  56.89  56.02  56.74  711527.0
2 2000-01-05 21:57:00  56.85  57.04  56.30  56.38  794925.0
3 2000-01-06 21:57:00  56.55  56.65  56.14  56.31  558223.0
4 2000-01-07 21:57:00  56.54  57.25  56.36  57.13  691444.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 23.58 seconds (0.39 minutes)
[INFO] Best parameters found: Short SMA = 36, Long SMA = 62
[INFO] Best fitness (Sharpe ratio): 1.001266
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 36, Long SMA = 62, Sharpe = 1.001266
[INFO] Top 2: Short SMA = 252, Long SMA = 258, Sharpe = 0.966037
[INFO] Top 3: Short SMA = 242, Long SMA = 270, Sharpe = 0.950937
[INFO] Top 4: Short SMA = 38, Long SMA = 62, Sharpe = 0.947092
[INFO] Top 5: Short SMA = 42, Long SMA = 62, Sharpe = 0.939200
[INFO] Hall of Fame size: 2388
[INFO] Number of elements in all_results: 1950
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 438 had penalty fitness
[INFO] Total filtered from Hall of Fame: 438
[INFO] Hall of Fame -> all_results: 2388 -> 1950
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1950 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3061, Evaluation data length: 2802
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FGBL
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.50 contracts
[INFO] Maximum Position Size: 13 contracts
[INFO] Strategy Total P&L: $-361,010.00
[INFO] Market Buy & Hold P&L: $23,030.00
[INFO] Outperformance: $-384,040.00
[INFO] Sharpe ratio (entire period, annualized): -0.474514
[INFO] Sharpe ratio (in-sample, annualized): -1.015103
[INFO] Sharpe ratio (out-of-sample, annualized): 0.787895
[INFO] Maximum Drawdown: $582,850.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-539,950.00
[INFO] Out-of-sample P&L: $179,200.00
[INFO] 
Best parameters from GA: Short SMA = 36, Long SMA = 62, Sharpe = 1.001266
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2388
[INFO] Cache hits (repeated combinations): 6235
[INFO] Total checks: 8623
[INFO] Cache hit rate: 72.31%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1950 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.1351 to 1.0013
[INFO] 
Best parameters:
[INFO] Short SMA: 36
[INFO] Long SMA: 62
[INFO] Sharpe Ratio: 1.001266
[INFO] Number of Trades: 28
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1950 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.1351 to 1.0013
[INFO] Trades range: 10.0 to 203.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3723 to 1.8659
[INFO] Scaled Long SMA range: -2.6990 to 1.2862
[INFO] Scaled Sharpe ratio range: -3.1160 to 3.0274
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 167 elements
[INFO] Kmeans Cluster 1: 68 elements
[INFO] Kmeans Cluster 2: 152 elements
[INFO] Kmeans Cluster 3: 158 elements
[INFO] Kmeans Cluster 4: 101 elements
[INFO] Kmeans Cluster 5: 65 elements
[INFO] Kmeans Cluster 6: 212 elements
[INFO] Kmeans Cluster 7: 155 elements
[INFO] Kmeans Cluster 8: 179 elements
[INFO] Kmeans Cluster 9: 76 elements
[INFO] Kmeans Cluster 10: 91 elements
[INFO] Kmeans Cluster 11: 123 elements
[INFO] Kmeans Cluster 12: 119 elements
[INFO] Kmeans Cluster 13: 233 elements
[INFO] Kmeans Cluster 14: 51 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=256.17, Long SMA=288.75, Sharpe=0.4675
[INFO] Centroid 1: Short SMA=32.29, Long SMA=58.74, Sharpe=0.4285
[INFO] Centroid 2: Short SMA=37.42, Long SMA=246.37, Sharpe=0.2919
[INFO] Centroid 3: Short SMA=120.00, Long SMA=182.81, Sharpe=0.4292
[INFO] Centroid 4: Short SMA=231.35, Long SMA=264.08, Sharpe=0.7305
[INFO] Centroid 5: Short SMA=39.45, Long SMA=59.29, Sharpe=0.8005
[INFO] Centroid 6: Short SMA=191.11, Long SMA=229.17, Sharpe=0.4271
[INFO] Centroid 7: Short SMA=33.65, Long SMA=204.40, Sharpe=0.1113
[INFO] Centroid 8: Short SMA=53.72, Long SMA=143.09, Sharpe=0.3027
[INFO] Centroid 9: Short SMA=71.45, Long SMA=266.84, Sharpe=0.4883
[INFO] Centroid 10: Short SMA=261.23, Long SMA=279.23, Sharpe=0.3426
[INFO] Centroid 11: Short SMA=144.18, Long SMA=210.18, Sharpe=0.6288
[INFO] Centroid 12: Short SMA=30.20, Long SMA=88.17, Sharpe=0.6210
[INFO] Centroid 13: Short SMA=222.36, Long SMA=268.15, Sharpe=0.5564
[INFO] Centroid 14: Short SMA=83.41, Long SMA=108.71, Sharpe=0.0820
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=36, Long SMA=62, Sharpe=1.0013, Trades=28
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=238, Long SMA=266, Sharpe=0.8454, Trades=16
[INFO] Kmeans Top 2: Short SMA=142, Long SMA=214, Sharpe=0.7775, Trades=10
[INFO] Kmeans Top 3: Short SMA=42, Long SMA=58, Sharpe=0.7032, Trades=36
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=94, Sharpe=0.6701, Trades=16
[INFO] Kmeans Top 5: Short SMA=220, Long SMA=268, Sharpe=0.5159, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (256, 289)
[INFO]   Nearest: (256.0, 288.0)
[INFO]   Rounded: (32, 59)
[INFO]   Nearest: (32.0, 58.0)
[INFO]   Rounded: (37, 246)
[INFO]   Nearest: (38.0, 246.0)
[INFO]   Rounded: (120, 183)
[INFO]   Nearest: (120.0, 182.0)
[INFO]   Rounded: (231, 264)
[INFO]   Nearest: (232.0, 264.0)
[INFO]   Rounded: (39, 59)
[INFO]   Nearest: (40.0, 60.0)
[INFO]   Rounded: (191, 229)
[INFO]   Nearest: (192.0, 230.0)
[INFO]   Rounded: (34, 204)
[INFO]   Rounded: (54, 143)
[INFO]   Nearest: (54.0, 144.0)
[INFO]   Rounded: (71, 267)
[INFO]   Nearest: (72.0, 266.0)
[INFO]   Rounded: (261, 279)
[INFO]   Nearest: (262.0, 280.0)
[INFO]   Rounded: (144, 210)
[INFO]   Rounded: (30, 88)
[INFO]   Rounded: (222, 268)
[INFO]   Rounded: (83, 109)
[INFO]   Nearest: (84.0, 108.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 36, Long SMA: 62
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(238/266) - Original Sharpe: 0.8454, Trades: 16
[INFO] Kmeans cluster 2: SMA(142/214) - Original Sharpe: 0.7775, Trades: 10
[INFO] Kmeans cluster 3: SMA(42/58) - Original Sharpe: 0.7032, Trades: 36
[INFO] Kmeans cluster 4: SMA(30/94) - Original Sharpe: 0.6701, Trades: 16
[INFO] Kmeans cluster 5: SMA(220/268) - Original Sharpe: 0.5159, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (36/62)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (238/266) - Sharpe: 0.8454
[INFO] cluster 2: (142/214) - Sharpe: 0.7775
[INFO] cluster 3: (42/58) - Sharpe: 0.7032
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -1.923691           -0.023956
1    2021-11-16 2021-11-16            42    -5.059052           -4.333347
2    2022-01-16 2022-01-16            42     2.440556            1.363957
3    2022-03-16 2022-03-16            41     3.634012            3.634012
4    2022-05-16 2022-05-16            45     1.252348            1.252348
5    2022-07-16 2022-07-16            44    -7.003364            0.610248
6    2022-09-16 2022-09-16            43     0.563233            0.425569
7    2022-11-16 2022-11-16            42    -3.204331           -0.961904
8    2023-01-16 2023-01-16            43     0.674222            2.306420
9    2023-03-16 2023-03-16            40     2.331121            0.854847
10   2023-05-16 2023-05-16            44     0.759333            0.423370
11   2023-07-16 2023-07-16            45     1.110941            1.110941
12   2023-09-16 2023-09-16            43    -0.006381           -0.006381
13   2023-11-16 2023-11-16            40     1.543347           -3.719542
14   2024-01-16 2024-01-16            44    -1.381398            0.138244
15   2024-03-16 2024-03-16            40     0.255891           -0.486085
16   2024-05-16 2024-05-16            43     0.307612            0.307612
17   2024-07-16 2024-07-16            44     2.232450            2.470250
18   2024-09-16 2024-09-16            45    -2.889253           -3.203980
19   2024-11-16 2024-11-16            28     0.360194           -1.531024
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -1.9 |             -0.0 |          1.9 | True          
[INFO] 2021-11-16   |         -5.1 |             -4.3 |          0.8 | True          
[INFO] 2022-01-16   |          2.4 |              1.4 |         -1.0 | False         
[INFO] 2022-03-16   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -7.0 |              0.6 |          7.6 | True          
[INFO] 2022-09-16   |          0.6 |              0.4 |         -0.2 | False         
[INFO] 2022-11-16   |         -3.2 |             -1.0 |          2.2 | True          
[INFO] 2023-01-16   |          0.7 |              2.3 |          1.6 | True          
[INFO] 2023-03-16   |          2.3 |              0.9 |         -1.4 | False         
[INFO] 2023-05-16   |          0.8 |              0.4 |         -0.4 | False         
[INFO] 2023-07-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-16   |          1.5 |             -3.7 |         -5.2 | False         
[INFO] 2024-01-16   |         -1.4 |              0.1 |          1.5 | True          
[INFO] 2024-03-16   |          0.3 |             -0.5 |         -0.8 | False         
[INFO] 2024-05-16   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-07-16   |          2.2 |              2.5 |          0.3 | True          
[INFO] 2024-09-16   |         -2.9 |             -3.2 |         -0.3 | False         
[INFO] 2024-11-16   |          0.4 |             -1.5 |         -1.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16, 2023-07-16, 2023-09-16, 2024-05-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Kmeans cluster wins (rounded comparison): 7 of 15 periods (46.67% win rate)
[INFO] Updating Excel file with Kmeans results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Kmeans win rate 46.7% in row 19
[INFO] Added best Sharpe parameters 36/62 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 36, Long SMA: 62
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(238/266) - Original Sharpe: 0.8454
[INFO] Added cluster 2 to portfolio: SMA(142/214) - Original Sharpe: 0.7775
[INFO] Added cluster 3 to portfolio: SMA(42/58) - Original Sharpe: 0.7032
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBL_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.4197
[INFO] Kmeans Best out-of-sample Sharpe: -0.1013
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBL
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1950 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.1351 to 1.0013
[INFO] 
Best parameters:
[INFO] Short SMA: 36
[INFO] Long SMA: 62
[INFO] Sharpe Ratio: 1.001266
[INFO] Number of Trades: 28
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1950 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.1351 to 1.0013
[INFO] Trades range: 10.0 to 203.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3723 to 1.8659
[INFO] Scaled Long SMA range: -2.6990 to 1.2862
[INFO] Scaled Sharpe ratio range: -3.1160 to 3.0274
[INFO] Scaled Trades range: -0.6762 to 14.1922
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1950 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5707
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 19
[INFO] Using 19 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 19 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 91 elements
[INFO] Cluster 1: 112 elements
[INFO] Cluster 2: 86 elements
[INFO] Cluster 3: 160 elements
[INFO] Cluster 4: 94 elements
[INFO] Cluster 5: 4 elements
[INFO] Cluster 6: 138 elements
[INFO] Cluster 7: 114 elements
[INFO] Cluster 8: 162 elements
[INFO] Cluster 9: 56 elements
[INFO] Cluster 10: 56 elements
[INFO] Cluster 11: 248 elements
[INFO] Cluster 12: 21 elements
[INFO] Cluster 13: 128 elements
[INFO] Cluster 14: 81 elements
[INFO] Cluster 15: 134 elements
[INFO] Cluster 16: 98 elements
[INFO] Cluster 17: 159 elements
[INFO] Cluster 18: 8 elements
[INFO] Using 17 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=96, Long SMA=132, Sharpe=0.0028, Trades=19
[INFO] Cluster 1 cluster: Short SMA=204, Long SMA=218, Sharpe=0.4713, Trades=21
[INFO] Cluster 2 cluster: Short SMA=238, Long SMA=242, Sharpe=0.5432, Trades=39
[INFO] Cluster 3 cluster: Short SMA=44, Long SMA=144, Sharpe=0.2440, Trades=12
[INFO] Cluster 4 cluster: Short SMA=72, Long SMA=260, Sharpe=0.4122, Trades=11
[INFO] Cluster 6 cluster: Short SMA=222, Long SMA=260, Sharpe=0.6461, Trades=12
[INFO] Cluster 7 cluster: Short SMA=274, Long SMA=288, Sharpe=0.3704, Trades=20
[INFO] Cluster 8 cluster: Short SMA=186, Long SMA=236, Sharpe=0.3912, Trades=13
[INFO] Cluster 9 cluster: Short SMA=18, Long SMA=56, Sharpe=0.4665, Trades=40
[INFO] Cluster 10 cluster: Short SMA=42, Long SMA=56, Sharpe=0.7353, Trades=40
[INFO] Cluster 11 cluster: Short SMA=232, Long SMA=284, Sharpe=0.3783, Trades=12
[INFO] Cluster 12 cluster: Short SMA=46, Long SMA=50, Sharpe=0.7466, Trades=74
[INFO] Cluster 13 cluster: Short SMA=116, Long SMA=190, Sharpe=0.3290, Trades=10
[INFO] Cluster 14 cluster: Short SMA=136, Long SMA=220, Sharpe=0.7779, Trades=10
[INFO] Cluster 15 cluster: Short SMA=36, Long SMA=250, Sharpe=0.2582, Trades=14
[INFO] Cluster 16 cluster: Short SMA=32, Long SMA=94, Sharpe=0.6751, Trades=16
[INFO] Cluster 17 cluster: Short SMA=36, Long SMA=202, Sharpe=0.0511, Trades=15
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=36, Long SMA=62, Sharpe=1.0013, Trades=28
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=136, Long SMA=220, Sharpe=0.7779, Trades=10
[INFO] Top 2: Short SMA=46, Long SMA=50, Sharpe=0.7466, Trades=74
[INFO] Top 3: Short SMA=42, Long SMA=56, Sharpe=0.7353, Trades=40
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 17 valid clusters with clusters
[INFO] Filtering to 1938 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 36, Long SMA: 62
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(136/220) - Original Sharpe: 0.7779, Trades: 10
[INFO] Hierarchical cluster 2: SMA(46/50) - Original Sharpe: 0.7466, Trades: 74
[INFO] Hierarchical cluster 3: SMA(42/56) - Original Sharpe: 0.7353, Trades: 40
[INFO] Hierarchical cluster 4: SMA(32/94) - Original Sharpe: 0.6751, Trades: 16
[INFO] Hierarchical cluster 5: SMA(222/260) - Original Sharpe: 0.6461, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (36/62)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (136/220) - Sharpe: 0.7779
[INFO] cluster 2: (46/50) - Sharpe: 0.7466
[INFO] cluster 3: (42/56) - Sharpe: 0.7353
[INFO] Loading FGBL data from local files...
[INFO] Found data file: A_OHLCV_@FGBL_minutes_1440_0112-2157.dat
[INFO] File size: 307862 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -1.923691           -0.891934
1    2021-11-16 2021-11-16            42    -5.059052           -5.146707
2    2022-01-16 2022-01-16            42     2.440556            1.765627
3    2022-03-16 2022-03-16            41     3.634012            3.634012
4    2022-05-16 2022-05-16            45     1.252348            1.252348
5    2022-07-16 2022-07-16            44    -7.003364           -4.054526
6    2022-09-16 2022-09-16            43     0.563233            0.485647
7    2022-11-16 2022-11-16            42    -3.204331           -3.919083
8    2023-01-16 2023-01-16            43     0.674222            2.408977
9    2023-03-16 2023-03-16            40     2.331121            0.770953
10   2023-05-16 2023-05-16            44     0.759333           -1.211847
11   2023-07-16 2023-07-16            45     1.110941            0.395105
12   2023-09-16 2023-09-16            43    -0.006381           -0.105894
13   2023-11-16 2023-11-16            40     1.543347           -1.935278
14   2024-01-16 2024-01-16            44    -1.381398            0.030550
15   2024-03-16 2024-03-16            40     0.255891           -1.513222
16   2024-05-16 2024-05-16            43     0.307612            1.188917
17   2024-07-16 2024-07-16            44     2.232450            4.767826
18   2024-09-16 2024-09-16            45    -2.889253           -1.200029
19   2024-11-16 2024-11-16            28     0.360194           -1.992828
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -1.9 |             -0.9 |          1.0 | True          
[INFO] 2021-11-16   |         -5.1 |             -5.1 |          0.0 | Excluded      
[INFO] 2022-01-16   |          2.4 |              1.8 |         -0.6 | False         
[INFO] 2022-03-16   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -7.0 |             -4.1 |          2.9 | True          
[INFO] 2022-09-16   |          0.6 |              0.5 |         -0.1 | False         
[INFO] 2022-11-16   |         -3.2 |             -3.9 |         -0.7 | False         
[INFO] 2023-01-16   |          0.7 |              2.4 |          1.7 | True          
[INFO] 2023-03-16   |          2.3 |              0.8 |         -1.5 | False         
[INFO] 2023-05-16   |          0.8 |             -1.2 |         -2.0 | False         
[INFO] 2023-07-16   |          1.1 |              0.4 |         -0.7 | False         
[INFO] 2023-09-16   |         -0.0 |             -0.1 |         -0.1 | False         
[INFO] 2023-11-16   |          1.5 |             -1.9 |         -3.4 | False         
[INFO] 2024-01-16   |         -1.4 |              0.0 |          1.4 | True          
[INFO] 2024-03-16   |          0.3 |             -1.5 |         -1.8 | False         
[INFO] 2024-05-16   |          0.3 |              1.2 |          0.9 | True          
[INFO] 2024-07-16   |          2.2 |              4.8 |          2.6 | True          
[INFO] 2024-09-16   |         -2.9 |             -1.2 |          1.7 | True          
[INFO] 2024-11-16   |          0.4 |             -2.0 |         -2.4 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-16, 2022-03-16, 2022-05-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 17 periods (41.18% win rate)
[INFO] Updating Excel file with Hierarchical results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Hierarchical win rate 41.2% in row 19
[INFO] Added best Sharpe parameters 36/62 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 36, Long SMA: 62
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(136/220) - Original Sharpe: 0.7779
[INFO] Added cluster 2 to portfolio: SMA(46/50) - Original Sharpe: 0.7466
[INFO] Added cluster 3 to portfolio: SMA(42/56) - Original Sharpe: 0.7353
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBL_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0060
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1013
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FGBL...
[INFO] Excel file updated successfully. Added FGBL with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBL
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FGBM in column D: 12.0
[INFO] Using slippage from Excel column D: 12.0
[INFO] 
Symbol: @FGBM
[INFO] Description: Euro Bobl Continuous Contract [Jun25]
[INFO] Exchange: EUREX
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 1000.0
[INFO] Data shape: (6154, 6)
[INFO] Date range: 2000-01-03 21:57:00 to 2025-04-07 21:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close    volume
0 2000-01-03 21:57:00  81.525  81.745  81.375  81.495  207258.0
1 2000-01-04 21:57:00  81.335  81.585  81.065  81.515  294488.0
2 2000-01-05 21:57:00  81.555  81.725  81.345  81.485  349705.0
3 2000-01-06 21:57:00  81.565  81.645  81.365  81.485  251094.0
4 2000-01-07 21:57:00  81.595  82.075  81.475  81.965  267226.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 23.33 seconds (0.39 minutes)
[INFO] Best parameters found: Short SMA = 222, Long SMA = 234
[INFO] Best fitness (Sharpe ratio): 1.126980
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 222, Long SMA = 234, Sharpe = 1.126980
[INFO] Top 2: Short SMA = 206, Long SMA = 228, Sharpe = 1.086338
[INFO] Top 3: Short SMA = 222, Long SMA = 236, Sharpe = 1.080970
[INFO] Top 4: Short SMA = 208, Long SMA = 228, Sharpe = 1.062350
[INFO] Top 5: Short SMA = 224, Long SMA = 226, Sharpe = 1.052312
[INFO] Hall of Fame size: 2064
[INFO] Number of elements in all_results: 1440
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 624 had penalty fitness
[INFO] Total filtered from Hall of Fame: 624
[INFO] Hall of Fame -> all_results: 2064 -> 1440
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1440 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3061, Evaluation data length: 2802
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FGBM
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 22.84 contracts
[INFO] Maximum Position Size: 41 contracts
[INFO] Strategy Total P&L: $-313,930.00
[INFO] Market Buy & Hold P&L: $3,260.00
[INFO] Outperformance: $-317,190.00
[INFO] Sharpe ratio (entire period, annualized): -0.417955
[INFO] Sharpe ratio (in-sample, annualized): -0.954035
[INFO] Sharpe ratio (out-of-sample, annualized): 0.797084
[INFO] Maximum Drawdown: $536,620.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-493,440.00
[INFO] Out-of-sample P&L: $181,650.00
[INFO] 
Best parameters from GA: Short SMA = 222, Long SMA = 234, Sharpe = 1.126980
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2064
[INFO] Cache hits (repeated combinations): 6601
[INFO] Total checks: 8665
[INFO] Cache hit rate: 76.18%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1440 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] 
Best parameters:
[INFO] Short SMA: 222
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.126980
[INFO] Number of Trades: 21
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1440 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] Trades range: 10.0 to 154.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.7082 to 1.7582
[INFO] Scaled Long SMA range: -3.4448 to 1.4161
[INFO] Scaled Sharpe ratio range: -4.3203 to 2.6517
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 105 elements
[INFO] Kmeans Cluster 1: 80 elements
[INFO] Kmeans Cluster 2: 111 elements
[INFO] Kmeans Cluster 3: 91 elements
[INFO] Kmeans Cluster 4: 129 elements
[INFO] Kmeans Cluster 5: 135 elements
[INFO] Kmeans Cluster 6: 171 elements
[INFO] Kmeans Cluster 7: 163 elements
[INFO] Kmeans Cluster 8: 75 elements
[INFO] Kmeans Cluster 9: 60 elements
[INFO] Kmeans Cluster 10: 23 elements
[INFO] Kmeans Cluster 11: 67 elements
[INFO] Kmeans Cluster 12: 59 elements
[INFO] Kmeans Cluster 13: 80 elements
[INFO] Kmeans Cluster 14: 91 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=174.59, Long SMA=212.48, Sharpe=0.5790
[INFO] Centroid 1: Short SMA=78.17, Long SMA=121.35, Sharpe=0.0921
[INFO] Centroid 2: Short SMA=39.23, Long SMA=233.08, Sharpe=0.4484
[INFO] Centroid 3: Short SMA=259.25, Long SMA=282.73, Sharpe=0.3547
[INFO] Centroid 4: Short SMA=208.17, Long SMA=229.98, Sharpe=0.9257
[INFO] Centroid 5: Short SMA=143.33, Long SMA=183.76, Sharpe=0.4197
[INFO] Centroid 6: Short SMA=209.23, Long SMA=261.67, Sharpe=0.6899
[INFO] Centroid 7: Short SMA=199.73, Long SMA=234.26, Sharpe=0.7746
[INFO] Centroid 8: Short SMA=279.89, Long SMA=293.15, Sharpe=0.5432
[INFO] Centroid 9: Short SMA=35.53, Long SMA=83.70, Sharpe=0.4434
[INFO] Centroid 10: Short SMA=26.26, Long SMA=45.39, Sharpe=0.2126
[INFO] Centroid 11: Short SMA=233.16, Long SMA=260.39, Sharpe=0.5087
[INFO] Centroid 12: Short SMA=49.90, Long SMA=274.17, Sharpe=0.3290
[INFO] Centroid 13: Short SMA=41.12, Long SMA=217.43, Sharpe=0.2972
[INFO] Centroid 14: Short SMA=67.25, Long SMA=167.89, Sharpe=0.2844
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=222, Long SMA=234, Sharpe=1.1270, Trades=21
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=208, Long SMA=230, Sharpe=1.0017, Trades=21
[INFO] Kmeans Top 2: Short SMA=200, Long SMA=238, Sharpe=0.7747, Trades=15
[INFO] Kmeans Top 3: Short SMA=210, Long SMA=264, Sharpe=0.6992, Trades=12
[INFO] Kmeans Top 4: Short SMA=280, Long SMA=294, Sharpe=0.6027, Trades=18
[INFO] Kmeans Top 5: Short SMA=180, Long SMA=214, Sharpe=0.5486, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (175, 212)
[INFO]   Nearest: (174.0, 212.0)
[INFO]   Rounded: (78, 121)
[INFO]   Nearest: (78.0, 122.0)
[INFO]   Rounded: (39, 233)
[INFO]   Nearest: (40.0, 234.0)
[INFO]   Rounded: (259, 283)
[INFO]   Nearest: (260.0, 282.0)
[INFO]   Rounded: (208, 230)
[INFO]   Rounded: (143, 184)
[INFO]   Nearest: (144.0, 184.0)
[INFO]   Rounded: (209, 262)
[INFO]   Nearest: (210.0, 262.0)
[INFO]   Rounded: (200, 234)
[INFO]   Rounded: (280, 293)
[INFO]   Nearest: (280.0, 294.0)
[INFO]   Rounded: (36, 84)
[INFO]   Rounded: (26, 45)
[INFO]   Nearest: (26.0, 46.0)
[INFO]   Rounded: (233, 260)
[INFO]   Nearest: (234.0, 260.0)
[INFO]   Rounded: (50, 274)
[INFO]   Rounded: (41, 217)
[INFO]   Nearest: (42.0, 218.0)
[INFO]   Rounded: (67, 168)
[INFO]   Nearest: (68.0, 168.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 222, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(208/230) - Original Sharpe: 1.0017, Trades: 21
[INFO] Kmeans cluster 2: SMA(200/238) - Original Sharpe: 0.7747, Trades: 15
[INFO] Kmeans cluster 3: SMA(210/264) - Original Sharpe: 0.6992, Trades: 12
[INFO] Kmeans cluster 4: SMA(280/294) - Original Sharpe: 0.6027, Trades: 18
[INFO] Kmeans cluster 5: SMA(180/214) - Original Sharpe: 0.5486, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (222/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (208/230) - Sharpe: 1.0017
[INFO] cluster 2: (200/238) - Sharpe: 0.7747
[INFO] cluster 3: (210/264) - Sharpe: 0.6992
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.487748            1.487748
1    2021-11-16 2021-11-16            42     1.336541            0.549202
2    2022-01-16 2022-01-16            42     0.385142            1.438249
3    2022-03-16 2022-03-16            41     2.717615            2.453804
4    2022-05-16 2022-05-16            45     1.180567            1.180567
5    2022-07-16 2022-07-16            44     3.343289            3.343289
6    2022-09-16 2022-09-16            43     1.239321            1.239321
7    2022-11-16 2022-11-16            42     0.648774            0.648774
8    2023-01-16 2023-01-16            43     0.128552            0.128552
9    2023-03-16 2023-03-16            40    -0.229572           -0.229572
10   2023-05-16 2023-05-16            44     2.110030            2.110030
11   2023-07-16 2023-07-16            45     0.849981            0.849981
12   2023-09-16 2023-09-16            43    -0.445153           -0.445153
13   2023-11-16 2023-11-16            40    -3.244508           -4.596200
14   2024-01-16 2024-01-16            44     3.758682            2.476811
15   2024-03-16 2024-03-16            40     0.479300            0.639507
16   2024-05-16 2024-05-16            43    -0.511733           -1.314450
17   2024-07-16 2024-07-16            44    -0.791530            3.492066
18   2024-09-16 2024-09-16            45     0.783900            2.289973
19   2024-11-16 2024-11-16            28    -0.078821           -0.078821
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2021-11-16   |          1.3 |              0.5 |         -0.8 | False         
[INFO] 2022-01-16   |          0.4 |              1.4 |          1.0 | True          
[INFO] 2022-03-16   |          2.7 |              2.5 |         -0.2 | False         
[INFO] 2022-05-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-16   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2022-09-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-11-16   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-01-16   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-03-16   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-05-16   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-07-16   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-11-16   |         -3.2 |             -4.6 |         -1.4 | False         
[INFO] 2024-01-16   |          3.8 |              2.5 |         -1.3 | False         
[INFO] 2024-03-16   |          0.5 |              0.6 |          0.1 | True          
[INFO] 2024-05-16   |         -0.5 |             -1.3 |         -0.8 | False         
[INFO] 2024-07-16   |         -0.8 |              3.5 |          4.3 | True          
[INFO] 2024-09-16   |          0.8 |              2.3 |          1.5 | True          
[INFO] 2024-11-16   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-05-16, 2022-07-16, 2022-09-16, 2022-11-16, 2023-01-16, 2023-03-16, 2023-05-16, 2023-07-16, 2023-09-16, 2024-11-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 4 of 9 periods (44.44% win rate)
[INFO] Updating Excel file with Kmeans results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Kmeans win rate 44.4% in row 20
[INFO] Added best Sharpe parameters 222/234 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 222, Long SMA: 234
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(208/230) - Original Sharpe: 1.0017
[INFO] Added cluster 2 to portfolio: SMA(200/238) - Original Sharpe: 0.7747
[INFO] Added cluster 3 to portfolio: SMA(210/264) - Original Sharpe: 0.6992
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBM_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.9191
[INFO] Kmeans Best out-of-sample Sharpe: 0.7178
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBM
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1440 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] 
Best parameters:
[INFO] Short SMA: 222
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.126980
[INFO] Number of Trades: 21
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1440 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.4745 to 1.1270
[INFO] Trades range: 10.0 to 154.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.7082 to 1.7582
[INFO] Scaled Long SMA range: -3.4448 to 1.4161
[INFO] Scaled Sharpe ratio range: -4.3203 to 2.6517
[INFO] Scaled Trades range: -0.7598 to 12.4306
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1440 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5562
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 6 elements
[INFO] Cluster 1: 79 elements
[INFO] Cluster 2: 232 elements
[INFO] Cluster 3: 48 elements
[INFO] Cluster 4: 137 elements
[INFO] Cluster 5: 293 elements
[INFO] Cluster 6: 151 elements
[INFO] Cluster 7: 152 elements
[INFO] Cluster 8: 21 elements
[INFO] Cluster 9: 43 elements
[INFO] Cluster 10: 27 elements
[INFO] Cluster 11: 42 elements
[INFO] Cluster 12: 62 elements
[INFO] Cluster 13: 45 elements
[INFO] Cluster 14: 102 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 1 cluster: Short SMA=172, Long SMA=194, Sharpe=0.6191, Trades=20
[INFO] Cluster 2 cluster: Short SMA=40, Long SMA=236, Sharpe=0.3040, Trades=12
[INFO] Cluster 3 cluster: Short SMA=38, Long SMA=56, Sharpe=0.4502, Trades=40
[INFO] Cluster 4 cluster: Short SMA=70, Long SMA=172, Sharpe=0.2895, Trades=10
[INFO] Cluster 5 cluster: Short SMA=200, Long SMA=252, Sharpe=0.8205, Trades=11
[INFO] Cluster 6 cluster: Short SMA=260, Long SMA=274, Sharpe=0.3821, Trades=21
[INFO] Cluster 7 cluster: Short SMA=208, Long SMA=230, Sharpe=1.0017, Trades=21
[INFO] Cluster 8 cluster: Short SMA=210, Long SMA=212, Sharpe=0.5300, Trades=55
[INFO] Cluster 9 cluster: Short SMA=78, Long SMA=106, Sharpe=0.0617, Trades=22
[INFO] Cluster 10 cluster: Short SMA=278, Long SMA=282, Sharpe=0.4820, Trades=35
[INFO] Cluster 11 cluster: Short SMA=26, Long SMA=108, Sharpe=0.5509, Trades=20
[INFO] Cluster 12 cluster: Short SMA=248, Long SMA=280, Sharpe=0.2096, Trades=13
[INFO] Cluster 13 cluster: Short SMA=208, Long SMA=214, Sharpe=0.6598, Trades=33
[INFO] Cluster 14 cluster: Short SMA=132, Long SMA=196, Sharpe=0.3911, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=222, Long SMA=234, Sharpe=1.1270, Trades=21
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=208, Long SMA=230, Sharpe=1.0017, Trades=21
[INFO] Top 2: Short SMA=200, Long SMA=252, Sharpe=0.8205, Trades=11
[INFO] Top 3: Short SMA=208, Long SMA=214, Sharpe=0.6598, Trades=33
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 1434 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 222, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(208/230) - Original Sharpe: 1.0017, Trades: 21
[INFO] Hierarchical cluster 2: SMA(200/252) - Original Sharpe: 0.8205, Trades: 11
[INFO] Hierarchical cluster 3: SMA(208/214) - Original Sharpe: 0.6598, Trades: 33
[INFO] Hierarchical cluster 4: SMA(172/194) - Original Sharpe: 0.6191, Trades: 20
[INFO] Hierarchical cluster 5: SMA(26/108) - Original Sharpe: 0.5509, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (222/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (208/230) - Sharpe: 1.0017
[INFO] cluster 2: (200/252) - Sharpe: 0.8205
[INFO] cluster 3: (208/214) - Sharpe: 0.6598
[INFO] Loading FGBM data from local files...
[INFO] Found data file: A_OHLCV_@FGBM_minutes_1440_0112-2157.dat
[INFO] File size: 295526 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43     1.487748            1.487748
1    2021-11-16 2021-11-16            42     1.336541           -1.821389
2    2022-01-16 2022-01-16            42     0.385142            0.944235
3    2022-03-16 2022-03-16            41     2.717615            2.285747
4    2022-05-16 2022-05-16            45     1.180567            1.180567
5    2022-07-16 2022-07-16            44     3.343289            3.343289
6    2022-09-16 2022-09-16            43     1.239321            1.239321
7    2022-11-16 2022-11-16            42     0.648774            0.648774
8    2023-01-16 2023-01-16            43     0.128552            0.128552
9    2023-03-16 2023-03-16            40    -0.229572           -0.229572
10   2023-05-16 2023-05-16            44     2.110030            2.110030
11   2023-07-16 2023-07-16            45     0.849981            0.849981
12   2023-09-16 2023-09-16            43    -0.445153           -0.155961
13   2023-11-16 2023-11-16            40    -3.244508           -5.831502
14   2024-01-16 2024-01-16            44     3.758682            2.476811
15   2024-03-16 2024-03-16            40     0.479300            0.586284
16   2024-05-16 2024-05-16            43    -0.511733            1.559795
17   2024-07-16 2024-07-16            44    -0.791530            3.771965
18   2024-09-16 2024-09-16            45     0.783900            2.779438
19   2024-11-16 2024-11-16            28    -0.078821           -0.580987
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2021-11-16   |          1.3 |             -1.8 |         -3.1 | False         
[INFO] 2022-01-16   |          0.4 |              0.9 |          0.5 | True          
[INFO] 2022-03-16   |          2.7 |              2.3 |         -0.4 | False         
[INFO] 2022-05-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-16   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2022-09-16   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-11-16   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-01-16   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2023-03-16   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-05-16   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-07-16   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2023-09-16   |         -0.4 |             -0.2 |          0.2 | True          
[INFO] 2023-11-16   |         -3.2 |             -5.8 |         -2.6 | False         
[INFO] 2024-01-16   |          3.8 |              2.5 |         -1.3 | False         
[INFO] 2024-03-16   |          0.5 |              0.6 |          0.1 | True          
[INFO] 2024-05-16   |         -0.5 |              1.6 |          2.1 | True          
[INFO] 2024-07-16   |         -0.8 |              3.8 |          4.6 | True          
[INFO] 2024-09-16   |          0.8 |              2.8 |          2.0 | True          
[INFO] 2024-11-16   |         -0.1 |             -0.6 |         -0.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-16, 2022-05-16, 2022-07-16, 2022-09-16, 2022-11-16, 2023-01-16, 2023-03-16, 2023-05-16, 2023-07-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 11 periods (54.55% win rate)
[INFO] Updating Excel file with Hierarchical results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Hierarchical win rate 54.5% in row 20
[INFO] Added best Sharpe parameters 222/234 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 222, Long SMA: 234
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(208/230) - Original Sharpe: 1.0017
[INFO] Added cluster 2 to portfolio: SMA(200/252) - Original Sharpe: 0.8205
[INFO] Added cluster 3 to portfolio: SMA(208/214) - Original Sharpe: 0.6598
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBM_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.9345
[INFO] Hierarchical Best out-of-sample Sharpe: 0.7178
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FGBM...
[INFO] Excel file updated successfully. Added FGBM with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBM
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FGBX in column D: 22.0
[INFO] Using slippage from Excel column D: 22.0
[INFO] 
Symbol: @FGBX=105XC
[INFO] Description: Euro Buxl Custom Continuous Contract
[INFO] Exchange: EUREX
[INFO] Interval: minutes 1440
[INFO] Tick size: 20.0
[INFO] Big point value: 1000.0
[INFO] Data shape: (4970, 6)
[INFO] Date range: 2002-02-19 21:57:00 to 2025-04-07 21:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close   volume
0 2002-02-19 21:57:00  79.50  79.50  79.50  79.50   6334.0
1 2002-02-26 21:57:00  78.39  78.39  78.39  78.39   6334.0
2 2005-09-09 21:57:00  77.74  78.14  77.40  78.06  11179.0
3 2005-09-12 21:57:00  77.98  78.02  76.48  76.54   8447.0
4 2005-09-13 21:57:00  76.70  77.04  76.06  77.00   9189.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 29.60 seconds (0.49 minutes)
[INFO] Best parameters found: Short SMA = 50, Long SMA = 56
[INFO] Best fitness (Sharpe ratio): 1.001858
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 50, Long SMA = 56, Sharpe = 1.001858
[INFO] Top 2: Short SMA = 42, Long SMA = 44, Sharpe = 0.910930
[INFO] Top 3: Short SMA = 46, Long SMA = 52, Sharpe = 0.897922
[INFO] Top 4: Short SMA = 40, Long SMA = 50, Sharpe = 0.859690
[INFO] Top 5: Short SMA = 42, Long SMA = 48, Sharpe = 0.853711
[INFO] Hall of Fame size: 2654
[INFO] Number of elements in all_results: 2181
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 473 had penalty fitness
[INFO] Total filtered from Hall of Fame: 473
[INFO] Hall of Fame -> all_results: 2654 -> 2181
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2181 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3061, Evaluation data length: 2802
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FGBX=105XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.64 contracts
[INFO] Maximum Position Size: 8 contracts
[INFO] Strategy Total P&L: $-326,420.00
[INFO] Market Buy & Hold P&L: $24,200.00
[INFO] Outperformance: $-350,620.00
[INFO] Sharpe ratio (entire period, annualized): -0.434848
[INFO] Sharpe ratio (in-sample, annualized): -0.913057
[INFO] Sharpe ratio (out-of-sample, annualized): 0.670749
[INFO] Maximum Drawdown: $581,760.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-533,860.00
[INFO] Out-of-sample P&L: $169,440.00
[INFO] 
Best parameters from GA: Short SMA = 50, Long SMA = 56, Sharpe = 1.001858
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2654
[INFO] Cache hits (repeated combinations): 5953
[INFO] Total checks: 8607
[INFO] Cache hit rate: 69.16%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2181 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.1578 to 1.0019
[INFO] 
Best parameters:
[INFO] Short SMA: 50
[INFO] Long SMA: 56
[INFO] Sharpe Ratio: 1.001858
[INFO] Number of Trades: 56
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2181 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.1578 to 1.0019
[INFO] Trades range: 10.0 to 199.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3726 to 2.3948
[INFO] Scaled Long SMA range: -2.7604 to 1.6787
[INFO] Scaled Sharpe ratio range: -3.0847 to 3.7606
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 14
[INFO] Using 14 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=14...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 302 elements
[INFO] Kmeans Cluster 1: 153 elements
[INFO] Kmeans Cluster 2: 148 elements
[INFO] Kmeans Cluster 3: 226 elements
[INFO] Kmeans Cluster 4: 163 elements
[INFO] Kmeans Cluster 5: 148 elements
[INFO] Kmeans Cluster 6: 89 elements
[INFO] Kmeans Cluster 7: 56 elements
[INFO] Kmeans Cluster 8: 109 elements
[INFO] Kmeans Cluster 9: 191 elements
[INFO] Kmeans Cluster 10: 165 elements
[INFO] Kmeans Cluster 11: 176 elements
[INFO] Kmeans Cluster 12: 176 elements
[INFO] Kmeans Cluster 13: 79 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=145.19, Long SMA=201.96, Sharpe=0.4922
[INFO] Centroid 1: Short SMA=76.98, Long SMA=133.18, Sharpe=0.1762
[INFO] Centroid 2: Short SMA=196.85, Long SMA=253.54, Sharpe=0.1767
[INFO] Centroid 3: Short SMA=41.41, Long SMA=171.00, Sharpe=0.2560
[INFO] Centroid 4: Short SMA=252.25, Long SMA=284.39, Sharpe=0.2746
[INFO] Centroid 5: Short SMA=36.16, Long SMA=79.58, Sharpe=0.4046
[INFO] Centroid 6: Short SMA=254.00, Long SMA=278.72, Sharpe=0.0362
[INFO] Centroid 7: Short SMA=45.89, Long SMA=273.21, Sharpe=0.2172
[INFO] Centroid 8: Short SMA=36.24, Long SMA=61.71, Sharpe=0.6891
[INFO] Centroid 9: Short SMA=141.08, Long SMA=171.15, Sharpe=0.6065
[INFO] Centroid 10: Short SMA=168.63, Long SMA=225.78, Sharpe=0.3299
[INFO] Centroid 11: Short SMA=106.48, Long SMA=166.45, Sharpe=0.3905
[INFO] Centroid 12: Short SMA=28.52, Long SMA=200.53, Sharpe=0.4020
[INFO] Centroid 13: Short SMA=30.66, Long SMA=270.58, Sharpe=0.3922
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=50, Long SMA=56, Sharpe=1.0019, Trades=56
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=36, Long SMA=56, Sharpe=0.7092, Trades=38
[INFO] Kmeans Top 2: Short SMA=142, Long SMA=172, Sharpe=0.5867, Trades=18
[INFO] Kmeans Top 3: Short SMA=34, Long SMA=80, Sharpe=0.5479, Trades=22
[INFO] Kmeans Top 4: Short SMA=146, Long SMA=204, Sharpe=0.5082, Trades=12
[INFO] Kmeans Top 5: Short SMA=30, Long SMA=204, Sharpe=0.3897, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}
[INFO]   Rounded: (145, 202)
[INFO]   Nearest: (146.0, 202.0)
[INFO]   Rounded: (77, 133)
[INFO]   Nearest: (76.0, 134.0)
[INFO]   Rounded: (197, 254)
[INFO]   Nearest: (196.0, 254.0)
[INFO]   Rounded: (41, 171)
[INFO]   Nearest: (42.0, 170.0)
[INFO]   Rounded: (252, 284)
[INFO]   Rounded: (36, 80)
[INFO]   Rounded: (254, 279)
[INFO]   Nearest: (254.0, 278.0)
[INFO]   Rounded: (46, 273)
[INFO]   Nearest: (46.0, 274.0)
[INFO]   Rounded: (36, 62)
[INFO]   Rounded: (141, 171)
[INFO]   Nearest: (142.0, 172.0)
[INFO]   Rounded: (169, 226)
[INFO]   Nearest: (168.0, 226.0)
[INFO]   Rounded: (106, 166)
[INFO]   Rounded: (29, 201)
[INFO]   Nearest: (28.0, 200.0)
[INFO]   Rounded: (31, 271)
[INFO]   Nearest: (30.0, 270.0)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 50, Long SMA: 56
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(36/56) - Original Sharpe: 0.7092, Trades: 38
[INFO] Kmeans cluster 2: SMA(142/172) - Original Sharpe: 0.5867, Trades: 18
[INFO] Kmeans cluster 3: SMA(34/80) - Original Sharpe: 0.5479, Trades: 22
[INFO] Kmeans cluster 4: SMA(146/204) - Original Sharpe: 0.5082, Trades: 12
[INFO] Kmeans cluster 5: SMA(30/204) - Original Sharpe: 0.3897, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (50/56)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (36/56) - Sharpe: 0.7092
[INFO] cluster 2: (142/172) - Sharpe: 0.5867
[INFO] cluster 3: (34/80) - Sharpe: 0.5479
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -2.493074           -2.392940
1    2021-11-16 2021-11-16            42    -3.189982           -3.052490
2    2022-01-16 2022-01-16            42     1.294092            0.419337
3    2022-03-16 2022-03-16            41     4.339011            4.339011
4    2022-05-16 2022-05-16            45     1.113246            1.113246
5    2022-07-16 2022-07-16            44    -3.870262           -2.860561
6    2022-09-16 2022-09-16            43    -0.767104            0.830544
7    2022-11-16 2022-11-16            42    -4.333365           -5.213083
8    2023-01-16 2023-01-16            43     2.406742           -0.806688
9    2023-03-16 2023-03-16            40     0.982602            2.735515
10   2023-05-16 2023-05-16            44    -4.191287            0.171143
11   2023-07-16 2023-07-16            45    -0.015977            0.781763
12   2023-09-16 2023-09-16            43     0.712175            0.712175
13   2023-11-16 2023-11-16            40    -3.685762           -3.975275
14   2024-01-16 2024-01-16            44    -0.038296           -0.424992
15   2024-03-16 2024-03-16            40     0.200895           -0.144274
16   2024-05-16 2024-05-16            43     1.126451            0.824204
17   2024-07-16 2024-07-16            44    -4.492154           -0.102843
18   2024-09-16 2024-09-16            45    -1.267614           -1.160051
19   2024-11-16 2024-11-16            28    -1.014734           -6.729779
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -2.5 |             -2.4 |          0.1 | True          
[INFO] 2021-11-16   |         -3.2 |             -3.1 |          0.1 | True          
[INFO] 2022-01-16   |          1.3 |              0.4 |         -0.9 | False         
[INFO] 2022-03-16   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -3.9 |             -2.9 |          1.0 | True          
[INFO] 2022-09-16   |         -0.8 |              0.8 |          1.6 | True          
[INFO] 2022-11-16   |         -4.3 |             -5.2 |         -0.9 | False         
[INFO] 2023-01-16   |          2.4 |             -0.8 |         -3.2 | False         
[INFO] 2023-03-16   |          1.0 |              2.7 |          1.7 | True          
[INFO] 2023-05-16   |         -4.2 |              0.2 |          4.4 | True          
[INFO] 2023-07-16   |         -0.0 |              0.8 |          0.8 | True          
[INFO] 2023-09-16   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-16   |         -3.7 |             -4.0 |         -0.3 | False         
[INFO] 2024-01-16   |         -0.0 |             -0.4 |         -0.4 | False         
[INFO] 2024-03-16   |          0.2 |             -0.1 |         -0.3 | False         
[INFO] 2024-05-16   |          1.1 |              0.8 |         -0.3 | False         
[INFO] 2024-07-16   |         -4.5 |             -0.1 |          4.4 | True          
[INFO] 2024-09-16   |         -1.3 |             -1.2 |          0.1 | True          
[INFO] 2024-11-16   |         -1.0 |             -6.7 |         -5.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16, 2023-09-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 9 of 17 periods (52.94% win rate)
[INFO] Updating Excel file with Kmeans results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Kmeans win rate 52.9% in row 21
[INFO] Added best Sharpe parameters 50/56 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 50, Long SMA: 56
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(36/56) - Original Sharpe: 0.7092
[INFO] Added cluster 2 to portfolio: SMA(142/172) - Original Sharpe: 0.5867
[INFO] Added cluster 3 to portfolio: SMA(34/80) - Original Sharpe: 0.5479
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBX_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3802
[INFO] Kmeans Best out-of-sample Sharpe: -0.8169
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBX
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2181 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.1578 to 1.0019
[INFO] 
Best parameters:
[INFO] Short SMA: 50
[INFO] Long SMA: 56
[INFO] Sharpe Ratio: 1.001858
[INFO] Number of Trades: 56
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2181 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.1578 to 1.0019
[INFO] Trades range: 10.0 to 199.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3726 to 2.3948
[INFO] Scaled Long SMA range: -2.7604 to 1.6787
[INFO] Scaled Sharpe ratio range: -3.0847 to 3.7606
[INFO] Scaled Trades range: -0.7206 to 14.2911
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2181 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5574
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 311 elements
[INFO] Cluster 1: 158 elements
[INFO] Cluster 2: 8 elements
[INFO] Cluster 3: 206 elements
[INFO] Cluster 4: 290 elements
[INFO] Cluster 5: 34 elements
[INFO] Cluster 6: 93 elements
[INFO] Cluster 7: 104 elements
[INFO] Cluster 8: 241 elements
[INFO] Cluster 9: 210 elements
[INFO] Cluster 10: 28 elements
[INFO] Cluster 11: 145 elements
[INFO] Cluster 12: 111 elements
[INFO] Cluster 13: 242 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=42, Long SMA=202, Sharpe=0.3556, Trades=13
[INFO] Cluster 1 cluster: Short SMA=32, Long SMA=70, Sharpe=0.7257, Trades=28
[INFO] Cluster 3 cluster: Short SMA=70, Long SMA=126, Sharpe=0.2155, Trades=17
[INFO] Cluster 4 cluster: Short SMA=146, Long SMA=168, Sharpe=0.5624, Trades=20
[INFO] Cluster 5 cluster: Short SMA=28, Long SMA=42, Sharpe=0.4721, Trades=54
[INFO] Cluster 6 cluster: Short SMA=274, Long SMA=282, Sharpe=0.1791, Trades=28
[INFO] Cluster 7 cluster: Short SMA=32, Long SMA=282, Sharpe=0.2681, Trades=11
[INFO] Cluster 8 cluster: Short SMA=142, Long SMA=206, Sharpe=0.5388, Trades=10
[INFO] Cluster 9 cluster: Short SMA=170, Long SMA=232, Sharpe=0.3463, Trades=12
[INFO] Cluster 10 cluster: Short SMA=46, Long SMA=54, Sharpe=0.8229, Trades=52
[INFO] Cluster 11 cluster: Short SMA=210, Long SMA=266, Sharpe=0.1953, Trades=10
[INFO] Cluster 12 cluster: Short SMA=258, Long SMA=288, Sharpe=0.1808, Trades=16
[INFO] Cluster 13 cluster: Short SMA=52, Long SMA=168, Sharpe=0.1300, Trades=15
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=50, Long SMA=56, Sharpe=1.0019, Trades=56
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=46, Long SMA=54, Sharpe=0.8229, Trades=52
[INFO] Top 2: Short SMA=32, Long SMA=70, Sharpe=0.7257, Trades=28
[INFO] Top 3: Short SMA=146, Long SMA=168, Sharpe=0.5624, Trades=20
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 2173 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 50, Long SMA: 56
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 259
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(46/54) - Original Sharpe: 0.8229, Trades: 52
[INFO] Hierarchical cluster 2: SMA(32/70) - Original Sharpe: 0.7257, Trades: 28
[INFO] Hierarchical cluster 3: SMA(146/168) - Original Sharpe: 0.5624, Trades: 20
[INFO] Hierarchical cluster 4: SMA(142/206) - Original Sharpe: 0.5388, Trades: 10
[INFO] Hierarchical cluster 5: SMA(28/42) - Original Sharpe: 0.4721, Trades: 54
[INFO] Trimmed warm-up period. Evaluation data length: 2802
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (50/56)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (46/54) - Sharpe: 0.8229
[INFO] cluster 2: (32/70) - Sharpe: 0.7257
[INFO] cluster 3: (146/168) - Sharpe: 0.5624
[INFO] Loading FGBX data from local files...
[INFO] Found data file: A_OHLCV_@FGBX=105XC_minutes_1440_0112-2157.dat
[INFO] File size: 238699 bytes
[INFO] Out-of-sample period starts on: 2021-09-16
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-16 2021-09-16            43    -2.493074           -0.740330
1    2021-11-16 2021-11-16            42    -3.189982           -2.147975
2    2022-01-16 2022-01-16            42     1.294092            0.601981
3    2022-03-16 2022-03-16            41     4.339011            4.339011
4    2022-05-16 2022-05-16            45     1.113246            1.113246
5    2022-07-16 2022-07-16            44    -3.870262           -2.860561
6    2022-09-16 2022-09-16            43    -0.767104            0.503117
7    2022-11-16 2022-11-16            42    -4.333365           -5.505828
8    2023-01-16 2023-01-16            43     2.406742            1.141866
9    2023-03-16 2023-03-16            40     0.982602            1.720658
10   2023-05-16 2023-05-16            44    -4.191287           -0.937323
11   2023-07-16 2023-07-16            45    -0.015977            0.637425
12   2023-09-16 2023-09-16            43     0.712175            0.712175
13   2023-11-16 2023-11-16            40    -3.685762           -3.089990
14   2024-01-16 2024-01-16            44    -0.038296           -0.826883
15   2024-03-16 2024-03-16            40     0.200895            0.058466
16   2024-05-16 2024-05-16            43     1.126451            1.299994
17   2024-07-16 2024-07-16            44    -4.492154            0.831111
18   2024-09-16 2024-09-16            45    -1.267614           -2.099983
19   2024-11-16 2024-11-16            28    -1.014734           -6.077344
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-16   |         -2.5 |             -0.7 |          1.8 | True          
[INFO] 2021-11-16   |         -3.2 |             -2.1 |          1.1 | True          
[INFO] 2022-01-16   |          1.3 |              0.6 |         -0.7 | False         
[INFO] 2022-03-16   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-05-16   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2022-07-16   |         -3.9 |             -2.9 |          1.0 | True          
[INFO] 2022-09-16   |         -0.8 |              0.5 |          1.3 | True          
[INFO] 2022-11-16   |         -4.3 |             -5.5 |         -1.2 | False         
[INFO] 2023-01-16   |          2.4 |              1.1 |         -1.3 | False         
[INFO] 2023-03-16   |          1.0 |              1.7 |          0.7 | True          
[INFO] 2023-05-16   |         -4.2 |             -0.9 |          3.3 | True          
[INFO] 2023-07-16   |         -0.0 |              0.6 |          0.6 | True          
[INFO] 2023-09-16   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-16   |         -3.7 |             -3.1 |          0.6 | True          
[INFO] 2024-01-16   |         -0.0 |             -0.8 |         -0.8 | False         
[INFO] 2024-03-16   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2024-05-16   |          1.1 |              1.3 |          0.2 | True          
[INFO] 2024-07-16   |         -4.5 |              0.8 |          5.3 | True          
[INFO] 2024-09-16   |         -1.3 |             -2.1 |         -0.8 | False         
[INFO] 2024-11-16   |         -1.0 |             -6.1 |         -5.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-16, 2022-05-16, 2023-09-16
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 17 periods (58.82% win rate)
[INFO] Updating Excel file with Hierarchical results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Hierarchical win rate 58.8% in row 21
[INFO] Added best Sharpe parameters 50/56 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 50, Long SMA: 56
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(46/54) - Original Sharpe: 0.8229
[INFO] Added cluster 2 to portfolio: SMA(32/70) - Original Sharpe: 0.7257
[INFO] Added cluster 3 to portfolio: SMA(146/168) - Original Sharpe: 0.5624
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FGBX_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2348
[INFO] Hierarchical Best out-of-sample Sharpe: -0.8169
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FGBX...
[INFO] Excel file updated successfully. Added FGBX with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FGBX
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for FV in column D: 10.0
[INFO] Using slippage from Excel column D: 10.0
[INFO] 
Symbol: @FV
[INFO] Description: 5 Yr U.S.Treasury Notes Continuous Contract [Jun25]
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 7.8125
[INFO] Big point value: 1000.0
[INFO] Data shape: (6118, 6)
[INFO] Date range: 2001-05-14 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime       open       high        low      close    volume
0 2001-05-14 15:57:00  62.875000  62.984375  62.718750  62.906250  121532.0
1 2001-05-15 15:57:00  62.890625  63.046875  62.578125  62.750000  100930.0
2 2001-05-16 15:57:00  62.781250  63.000000  62.656250  62.843750   80195.0
3 2001-05-17 15:57:00  62.921875  62.937500  62.390625  62.796875   85312.0
4 2001-05-18 15:57:00  62.796875  62.921875  62.500000  62.671875   60211.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 25.26 seconds (0.42 minutes)
[INFO] Best parameters found: Short SMA = 154, Long SMA = 158
[INFO] Best fitness (Sharpe ratio): 0.863673
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 154, Long SMA = 158, Sharpe = 0.863673
[INFO] Top 2: Short SMA = 74, Long SMA = 78, Sharpe = 0.840408
[INFO] Top 3: Short SMA = 54, Long SMA = 78, Sharpe = 0.820782
[INFO] Top 4: Short SMA = 56, Long SMA = 78, Sharpe = 0.800912
[INFO] Top 5: Short SMA = 70, Long SMA = 82, Sharpe = 0.798712
[INFO] Hall of Fame size: 2506
[INFO] Number of elements in all_results: 1401
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 1105 had penalty fitness
[INFO] Total filtered from Hall of Fame: 1105
[INFO] Hall of Fame -> all_results: 2506 -> 1401
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1401 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3108, Evaluation data length: 2841
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @FV
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 19.39 contracts
[INFO] Maximum Position Size: 46 contracts
[INFO] Strategy Total P&L: $135,601.56
[INFO] Market Buy & Hold P&L: $-7,468.75
[INFO] Outperformance: $143,070.31
[INFO] Sharpe ratio (entire period, annualized): 0.119889
[INFO] Sharpe ratio (in-sample, annualized): -0.358922
[INFO] Sharpe ratio (out-of-sample, annualized): 1.206514
[INFO] Maximum Drawdown: $284,921.88
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-188,648.44
[INFO] Out-of-sample P&L: $279,523.44
[INFO] 
Best parameters from GA: Short SMA = 154, Long SMA = 158, Sharpe = 0.863673
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2506
[INFO] Cache hits (repeated combinations): 6162
[INFO] Total checks: 8668
[INFO] Cache hit rate: 71.09%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1401 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.4741 to 0.8637
[INFO] 
Best parameters:
[INFO] Short SMA: 154
[INFO] Long SMA: 158
[INFO] Sharpe Ratio: 0.863673
[INFO] Number of Trades: 40
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1401 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.4741 to 0.8637
[INFO] Trades range: 10.0 to 219.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0312 to 2.6716
[INFO] Scaled Long SMA range: -2.3915 to 2.2561
[INFO] Scaled Sharpe ratio range: -3.3333 to 2.3688
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 107 elements
[INFO] Kmeans Cluster 1: 48 elements
[INFO] Kmeans Cluster 2: 61 elements
[INFO] Kmeans Cluster 3: 103 elements
[INFO] Kmeans Cluster 4: 80 elements
[INFO] Kmeans Cluster 5: 79 elements
[INFO] Kmeans Cluster 6: 109 elements
[INFO] Kmeans Cluster 7: 110 elements
[INFO] Kmeans Cluster 8: 141 elements
[INFO] Kmeans Cluster 9: 69 elements
[INFO] Kmeans Cluster 10: 116 elements
[INFO] Kmeans Cluster 11: 40 elements
[INFO] Kmeans Cluster 12: 50 elements
[INFO] Kmeans Cluster 13: 71 elements
[INFO] Kmeans Cluster 14: 108 elements
[INFO] Kmeans Cluster 15: 73 elements
[INFO] Kmeans Cluster 16: 36 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=61.40, Long SMA=162.13, Sharpe=0.2828
[INFO] Centroid 1: Short SMA=232.00, Long SMA=246.17, Sharpe=-0.1814
[INFO] Centroid 2: Short SMA=87.64, Long SMA=119.64, Sharpe=0.1119
[INFO] Centroid 3: Short SMA=43.15, Long SMA=91.83, Sharpe=0.4646
[INFO] Centroid 4: Short SMA=24.85, Long SMA=81.37, Sharpe=0.2108
[INFO] Centroid 5: Short SMA=144.51, Long SMA=163.75, Sharpe=0.5995
[INFO] Centroid 6: Short SMA=276.37, Long SMA=286.79, Sharpe=0.0091
[INFO] Centroid 7: Short SMA=110.45, Long SMA=156.31, Sharpe=0.1935
[INFO] Centroid 8: Short SMA=30.92, Long SMA=166.99, Sharpe=0.5614
[INFO] Centroid 9: Short SMA=187.42, Long SMA=206.35, Sharpe=0.0112
[INFO] Centroid 10: Short SMA=29.55, Long SMA=147.81, Sharpe=0.4432
[INFO] Centroid 11: Short SMA=19.95, Long SMA=47.35, Sharpe=-0.1438
[INFO] Centroid 12: Short SMA=56.44, Long SMA=80.16, Sharpe=0.6919
[INFO] Centroid 13: Short SMA=137.27, Long SMA=166.99, Sharpe=0.3500
[INFO] Centroid 14: Short SMA=29.39, Long SMA=212.46, Sharpe=0.4752
[INFO] Centroid 15: Short SMA=68.71, Long SMA=114.55, Sharpe=0.2803
[INFO] Centroid 16: Short SMA=25.78, Long SMA=259.50, Sharpe=0.3282
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=154, Long SMA=158, Sharpe=0.8637, Trades=40
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=58, Long SMA=78, Sharpe=0.6969, Trades=32
[INFO] Kmeans Top 2: Short SMA=144, Long SMA=164, Sharpe=0.6193, Trades=18
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=214, Sharpe=0.5052, Trades=10
[INFO] Kmeans Top 4: Short SMA=34, Long SMA=168, Sharpe=0.4773, Trades=14
[INFO] Kmeans Top 5: Short SMA=42, Long SMA=94, Sharpe=0.4368, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (61, 162)
[INFO]   Nearest: (62.0, 162.0)
[INFO]   Rounded: (232, 246)
[INFO]   Rounded: (88, 120)
[INFO]   Rounded: (43, 92)
[INFO]   Nearest: (44.0, 92.0)
[INFO]   Rounded: (25, 81)
[INFO]   Nearest: (24.0, 82.0)
[INFO]   Rounded: (145, 164)
[INFO]   Nearest: (144.0, 164.0)
[INFO]   Rounded: (276, 287)
[INFO]   Nearest: (276.0, 286.0)
[INFO]   Rounded: (110, 156)
[INFO]   Rounded: (31, 167)
[INFO]   Nearest: (30.0, 166.0)
[INFO]   Rounded: (187, 206)
[INFO]   Nearest: (188.0, 206.0)
[INFO]   Rounded: (30, 148)
[INFO]   Rounded: (20, 47)
[INFO]   Nearest: (20.0, 48.0)
[INFO]   Rounded: (56, 80)
[INFO]   Rounded: (137, 167)
[INFO]   Nearest: (138.0, 166.0)
[INFO]   Rounded: (29, 212)
[INFO]   Nearest: (30.0, 212.0)
[INFO]   Rounded: (69, 115)
[INFO]   Nearest: (68.0, 114.0)
[INFO]   Rounded: (26, 260)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 154, Long SMA: 158
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(58/78) - Original Sharpe: 0.6969, Trades: 32
[INFO] Kmeans cluster 2: SMA(144/164) - Original Sharpe: 0.6193, Trades: 18
[INFO] Kmeans cluster 3: SMA(28/214) - Original Sharpe: 0.5052, Trades: 10
[INFO] Kmeans cluster 4: SMA(34/168) - Original Sharpe: 0.4773, Trades: 14
[INFO] Kmeans cluster 5: SMA(42/94) - Original Sharpe: 0.4368, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (154/158)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (58/78) - Sharpe: 0.6969
[INFO] cluster 2: (144/164) - Sharpe: 0.6193
[INFO] cluster 3: (28/214) - Sharpe: 0.5052
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.389829            1.990741
1    2021-11-14 2021-11-14            43    -0.480225            2.474631
2    2022-01-14 2022-01-14            41     2.700861            2.700861
3    2022-03-14 2022-03-14            44     3.784695            3.784695
4    2022-05-14 2022-05-14            43     0.729933            0.729933
5    2022-07-14 2022-07-14            44     2.947519            2.260747
6    2022-09-14 2022-09-14            43     1.560563           -0.167807
7    2022-11-14 2022-11-14            43    -1.320914           -1.100452
8    2023-01-14 2023-01-14            41     0.637807           -2.068487
9    2023-03-14 2023-03-14            44    -0.643401           -1.300395
10   2023-05-14 2023-05-14            44    -7.211297           -3.851462
11   2023-07-14 2023-07-14            44     2.935724            2.935724
12   2023-09-14 2023-09-14            43     2.041527            0.883522
13   2023-11-14 2023-11-14            42    -3.712562           -3.874531
14   2024-01-14 2024-01-14            43     2.527000           -2.590857
15   2024-03-14 2024-03-14            42     1.898290            2.549927
16   2024-05-14 2024-05-14            44     0.628479           -3.392632
17   2024-07-14 2024-07-14            45    -3.597183            0.197276
18   2024-09-14 2024-09-14            43    -4.478642           -4.550274
19   2024-11-14 2024-11-14            33    -0.954542            0.954542
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |              2.0 |          2.4 | True          
[INFO] 2021-11-14   |         -0.5 |              2.5 |          3.0 | True          
[INFO] 2022-01-14   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.9 |              2.3 |         -0.6 | False         
[INFO] 2022-09-14   |          1.6 |             -0.2 |         -1.8 | False         
[INFO] 2022-11-14   |         -1.3 |             -1.1 |          0.2 | True          
[INFO] 2023-01-14   |          0.6 |             -2.1 |         -2.7 | False         
[INFO] 2023-03-14   |         -0.6 |             -1.3 |         -0.7 | False         
[INFO] 2023-05-14   |         -7.2 |             -3.9 |          3.3 | True          
[INFO] 2023-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.0 |              0.9 |         -1.1 | False         
[INFO] 2023-11-14   |         -3.7 |             -3.9 |         -0.2 | False         
[INFO] 2024-01-14   |          2.5 |             -2.6 |         -5.1 | False         
[INFO] 2024-03-14   |          1.9 |              2.5 |          0.6 | True          
[INFO] 2024-05-14   |          0.6 |             -3.4 |         -4.0 | False         
[INFO] 2024-07-14   |         -3.6 |              0.2 |          3.8 | True          
[INFO] 2024-09-14   |         -4.5 |             -4.6 |         -0.1 | False         
[INFO] 2024-11-14   |         -1.0 |              1.0 |          2.0 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14, 2022-03-14, 2022-05-14, 2023-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Kmeans cluster wins (rounded comparison): 7 of 16 periods (43.75% win rate)
[INFO] Updating Excel file with Kmeans results for FV...
[INFO] Excel file updated successfully. Added FV with Kmeans win rate 43.8% in row 22
[INFO] Added best Sharpe parameters 154/158 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 154, Long SMA: 158
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(58/78) - Original Sharpe: 0.6969
[INFO] Added cluster 2 to portfolio: SMA(144/164) - Original Sharpe: 0.6193
[INFO] Added cluster 3 to portfolio: SMA(28/214) - Original Sharpe: 0.5052
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FV_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0744
[INFO] Kmeans Best out-of-sample Sharpe: 0.0334
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for FV...
[INFO] Excel file updated successfully. Added FV with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FV
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1401 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.4741 to 0.8637
[INFO] 
Best parameters:
[INFO] Short SMA: 154
[INFO] Long SMA: 158
[INFO] Sharpe Ratio: 0.863673
[INFO] Number of Trades: 40
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1401 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.4741 to 0.8637
[INFO] Trades range: 10.0 to 219.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0312 to 2.6716
[INFO] Scaled Long SMA range: -2.3915 to 2.2561
[INFO] Scaled Sharpe ratio range: -3.3333 to 2.3688
[INFO] Scaled Trades range: -0.6598 to 13.6564
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1401 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.7435
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 105 elements
[INFO] Cluster 1: 85 elements
[INFO] Cluster 2: 141 elements
[INFO] Cluster 3: 177 elements
[INFO] Cluster 4: 13 elements
[INFO] Cluster 5: 49 elements
[INFO] Cluster 6: 167 elements
[INFO] Cluster 7: 8 elements
[INFO] Cluster 8: 244 elements
[INFO] Cluster 9: 121 elements
[INFO] Cluster 10: 1 elements
[INFO] Cluster 11: 53 elements
[INFO] Cluster 12: 40 elements
[INFO] Cluster 13: 44 elements
[INFO] Cluster 14: 81 elements
[INFO] Cluster 15: 62 elements
[INFO] Cluster 16: 10 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=280, Long SMA=290, Sharpe=-0.0450, Trades=14
[INFO] Cluster 1 cluster: Short SMA=190, Long SMA=204, Sharpe=0.0159, Trades=14
[INFO] Cluster 2 cluster: Short SMA=28, Long SMA=220, Sharpe=0.5430, Trades=10
[INFO] Cluster 3 cluster: Short SMA=64, Long SMA=152, Sharpe=0.2978, Trades=12
[INFO] Cluster 5 cluster: Short SMA=26, Long SMA=56, Sharpe=-0.0051, Trades=45
[INFO] Cluster 6 cluster: Short SMA=114, Long SMA=160, Sharpe=0.1491, Trades=11
[INFO] Cluster 8 cluster: Short SMA=30, Long SMA=160, Sharpe=0.4780, Trades=14
[INFO] Cluster 9 cluster: Short SMA=42, Long SMA=94, Sharpe=0.4368, Trades=20
[INFO] Cluster 11 cluster: Short SMA=104, Long SMA=116, Sharpe=0.1141, Trades=36
[INFO] Cluster 12 cluster: Short SMA=60, Long SMA=80, Sharpe=0.7467, Trades=28
[INFO] Cluster 13 cluster: Short SMA=232, Long SMA=248, Sharpe=-0.1499, Trades=14
[INFO] Cluster 14 cluster: Short SMA=144, Long SMA=162, Sharpe=0.6899, Trades=20
[INFO] Cluster 15 cluster: Short SMA=24, Long SMA=96, Sharpe=0.2446, Trades=24
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=154, Long SMA=158, Sharpe=0.8637, Trades=40
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=60, Long SMA=80, Sharpe=0.7467, Trades=28
[INFO] Top 2: Short SMA=144, Long SMA=162, Sharpe=0.6899, Trades=20
[INFO] Top 3: Short SMA=28, Long SMA=220, Sharpe=0.5430, Trades=10
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 1369 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 154, Long SMA: 158
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(60/80) - Original Sharpe: 0.7467, Trades: 28
[INFO] Hierarchical cluster 2: SMA(144/162) - Original Sharpe: 0.6899, Trades: 20
[INFO] Hierarchical cluster 3: SMA(28/220) - Original Sharpe: 0.5430, Trades: 10
[INFO] Hierarchical cluster 4: SMA(30/160) - Original Sharpe: 0.4780, Trades: 14
[INFO] Hierarchical cluster 5: SMA(42/94) - Original Sharpe: 0.4368, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (154/158)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (60/80) - Sharpe: 0.7467
[INFO] cluster 2: (144/162) - Sharpe: 0.6899
[INFO] cluster 3: (28/220) - Sharpe: 0.5430
[INFO] Loading FV data from local files...
[INFO] Found data file: A_OHLCV_@FV_minutes_1440_1703-1557.dat
[INFO] File size: 293815 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.389829           -0.080354
1    2021-11-14 2021-11-14            43    -0.480225            0.873526
2    2022-01-14 2022-01-14            41     2.700861            2.700861
3    2022-03-14 2022-03-14            44     3.784695            3.784695
4    2022-05-14 2022-05-14            43     0.729933            0.729933
5    2022-07-14 2022-07-14            44     2.947519            2.552700
6    2022-09-14 2022-09-14            43     1.560563            0.623823
7    2022-11-14 2022-11-14            43    -1.320914           -1.012364
8    2023-01-14 2023-01-14            41     0.637807           -1.848776
9    2023-03-14 2023-03-14            44    -0.643401           -1.034560
10   2023-05-14 2023-05-14            44    -7.211297           -4.552759
11   2023-07-14 2023-07-14            44     2.935724            2.935724
12   2023-09-14 2023-09-14            43     2.041527            1.417042
13   2023-11-14 2023-11-14            42    -3.712562           -3.907630
14   2024-01-14 2024-01-14            43     2.527000            1.077992
15   2024-03-14 2024-03-14            42     1.898290            2.314645
16   2024-05-14 2024-05-14            44     0.628479           -3.386008
17   2024-07-14 2024-07-14            45    -3.597183           -0.113264
18   2024-09-14 2024-09-14            43    -4.478642           -4.682420
19   2024-11-14 2024-11-14            33    -0.954542            0.954542
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |             -0.1 |          0.3 | True          
[INFO] 2021-11-14   |         -0.5 |              0.9 |          1.4 | True          
[INFO] 2022-01-14   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.9 |              2.6 |         -0.3 | False         
[INFO] 2022-09-14   |          1.6 |              0.6 |         -1.0 | False         
[INFO] 2022-11-14   |         -1.3 |             -1.0 |          0.3 | True          
[INFO] 2023-01-14   |          0.6 |             -1.8 |         -2.4 | False         
[INFO] 2023-03-14   |         -0.6 |             -1.0 |         -0.4 | False         
[INFO] 2023-05-14   |         -7.2 |             -4.6 |          2.6 | True          
[INFO] 2023-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.0 |              1.4 |         -0.6 | False         
[INFO] 2023-11-14   |         -3.7 |             -3.9 |         -0.2 | False         
[INFO] 2024-01-14   |          2.5 |              1.1 |         -1.4 | False         
[INFO] 2024-03-14   |          1.9 |              2.3 |          0.4 | True          
[INFO] 2024-05-14   |          0.6 |             -3.4 |         -4.0 | False         
[INFO] 2024-07-14   |         -3.6 |             -0.1 |          3.5 | True          
[INFO] 2024-09-14   |         -4.5 |             -4.7 |         -0.2 | False         
[INFO] 2024-11-14   |         -1.0 |              1.0 |          2.0 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14, 2022-03-14, 2022-05-14, 2023-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 16 periods (43.75% win rate)
[INFO] Updating Excel file with Hierarchical results for FV...
[INFO] Excel file updated successfully. Added FV with Hierarchical win rate 43.8% in row 22
[INFO] Added best Sharpe parameters 154/158 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 154, Long SMA: 158
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(60/80) - Original Sharpe: 0.7467
[INFO] Added cluster 2 to portfolio: SMA(144/162) - Original Sharpe: 0.6899
[INFO] Added cluster 3 to portfolio: SMA(28/220) - Original Sharpe: 0.5430
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'FV_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1375
[INFO] Hierarchical Best out-of-sample Sharpe: 0.0334
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for FV...
[INFO] Excel file updated successfully. Added FV with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\FV
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for GC in column D: 14.0
[INFO] Using slippage from Excel column D: 14.0
[INFO] 
Symbol: @GC
[INFO] Description: Gold Continuous Contract [Jun25]
[INFO] Exchange: COMEX
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 100.0
[INFO] Data shape: (5784, 6)
[INFO] Date range: 2002-09-23 16:55:00 to 2025-04-07 16:55:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2002-09-23 16:55:00  1047.5  1048.7  1046.1  1047.8   164.0
1 2002-09-24 16:55:00  1047.6  1052.1  1047.3  1051.7  1343.0
2 2002-09-25 16:55:00  1051.6  1051.9  1047.1  1047.6  2309.0
3 2002-09-26 16:55:00  1047.4  1048.7  1044.9  1045.0  1446.0
4 2002-09-27 16:55:00  1045.5  1046.1  1044.3  1045.1   697.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 29.66 seconds (0.49 minutes)
[INFO] Best parameters found: Short SMA = 42, Long SMA = 56
[INFO] Best fitness (Sharpe ratio): 0.480665
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 42, Long SMA = 56, Sharpe = 0.480665
[INFO] Top 2: Short SMA = 34, Long SMA = 46, Sharpe = 0.460853
[INFO] Top 3: Short SMA = 26, Long SMA = 52, Sharpe = 0.455200
[INFO] Top 4: Short SMA = 108, Long SMA = 124, Sharpe = 0.449289
[INFO] Top 5: Short SMA = 108, Long SMA = 116, Sharpe = 0.444147
[INFO] Hall of Fame size: 2729
[INFO] Number of elements in all_results: 2067
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 662 had penalty fitness
[INFO] Total filtered from Hall of Fame: 662
[INFO] Hall of Fame -> all_results: 2729 -> 2067
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2067 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3106, Evaluation data length: 2839
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @GC
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.70 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $-157,980.00
[INFO] Market Buy & Hold P&L: $96,090.00
[INFO] Outperformance: $-254,070.00
[INFO] Sharpe ratio (entire period, annualized): -0.369581
[INFO] Sharpe ratio (in-sample, annualized): -0.268853
[INFO] Sharpe ratio (out-of-sample, annualized): -0.586370
[INFO] Maximum Drawdown: $425,840.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-154,310.00
[INFO] Out-of-sample P&L: $-156,900.00
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 56, Sharpe = 0.480665
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2729
[INFO] Cache hits (repeated combinations): 5952
[INFO] Total checks: 8681
[INFO] Cache hit rate: 68.56%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2067 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.8118 to 0.4807
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 56
[INFO] Sharpe Ratio: 0.480665
[INFO] Number of Trades: 40
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2067 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.8118 to 0.4807
[INFO] Trades range: 10.0 to 169.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1848 to 2.3657
[INFO] Scaled Long SMA range: -2.3933 to 1.6319
[INFO] Scaled Sharpe ratio range: -2.9451 to 2.3270
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 124 elements
[INFO] Kmeans Cluster 1: 158 elements
[INFO] Kmeans Cluster 2: 131 elements
[INFO] Kmeans Cluster 3: 116 elements
[INFO] Kmeans Cluster 4: 164 elements
[INFO] Kmeans Cluster 5: 116 elements
[INFO] Kmeans Cluster 6: 85 elements
[INFO] Kmeans Cluster 7: 97 elements
[INFO] Kmeans Cluster 8: 130 elements
[INFO] Kmeans Cluster 9: 153 elements
[INFO] Kmeans Cluster 10: 117 elements
[INFO] Kmeans Cluster 11: 133 elements
[INFO] Kmeans Cluster 12: 219 elements
[INFO] Kmeans Cluster 13: 247 elements
[INFO] Kmeans Cluster 14: 77 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=140.82, Long SMA=181.00, Sharpe=-0.1980
[INFO] Centroid 1: Short SMA=50.14, Long SMA=191.74, Sharpe=0.0150
[INFO] Centroid 2: Short SMA=268.47, Long SMA=287.79, Sharpe=-0.3782
[INFO] Centroid 3: Short SMA=48.55, Long SMA=105.90, Sharpe=-0.5745
[INFO] Centroid 4: Short SMA=217.71, Long SMA=242.52, Sharpe=0.1390
[INFO] Centroid 5: Short SMA=35.59, Long SMA=252.79, Sharpe=-0.2905
[INFO] Centroid 6: Short SMA=54.61, Long SMA=87.60, Sharpe=-0.2020
[INFO] Centroid 7: Short SMA=27.34, Long SMA=132.19, Sharpe=-0.4232
[INFO] Centroid 8: Short SMA=29.06, Long SMA=55.12, Sharpe=0.2502
[INFO] Centroid 9: Short SMA=233.90, Long SMA=270.88, Sharpe=-0.1206
[INFO] Centroid 10: Short SMA=27.69, Long SMA=170.21, Sharpe=-0.2378
[INFO] Centroid 11: Short SMA=103.01, Long SMA=143.76, Sharpe=0.0366
[INFO] Centroid 12: Short SMA=59.11, Long SMA=248.79, Sharpe=-0.0832
[INFO] Centroid 13: Short SMA=90.86, Long SMA=145.30, Sharpe=0.2310
[INFO] Centroid 14: Short SMA=183.77, Long SMA=220.49, Sharpe=-0.1026
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=56, Sharpe=0.4807, Trades=40
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=28, Long SMA=54, Sharpe=0.2374, Trades=38
[INFO] Kmeans Top 2: Short SMA=216, Long SMA=242, Sharpe=0.1965, Trades=12
[INFO] Kmeans Top 3: Short SMA=94, Long SMA=144, Sharpe=0.1520, Trades=15
[INFO] Kmeans Top 4: Short SMA=108, Long SMA=156, Sharpe=0.1223, Trades=15
[INFO] Kmeans Top 5: Short SMA=50, Long SMA=192, Sharpe=-0.0204, Trades=14
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (141, 181)
[INFO]   Nearest: (140.0, 180.0)
[INFO]   Rounded: (50, 192)
[INFO]   Rounded: (268, 288)
[INFO]   Rounded: (49, 106)
[INFO]   Nearest: (48.0, 106.0)
[INFO]   Rounded: (218, 243)
[INFO]   Nearest: (218.0, 242.0)
[INFO]   Rounded: (36, 253)
[INFO]   Nearest: (36.0, 252.0)
[INFO]   Rounded: (55, 88)
[INFO]   Nearest: (54.0, 88.0)
[INFO]   Rounded: (27, 132)
[INFO]   Nearest: (28.0, 132.0)
[INFO]   Rounded: (29, 55)
[INFO]   Nearest: (30.0, 56.0)
[INFO]   Rounded: (234, 271)
[INFO]   Nearest: (234.0, 270.0)
[INFO]   Rounded: (28, 170)
[INFO]   Rounded: (103, 144)
[INFO]   Nearest: (104.0, 144.0)
[INFO]   Rounded: (59, 249)
[INFO]   Nearest: (60.0, 248.0)
[INFO]   Rounded: (91, 145)
[INFO]   Nearest: (90.0, 146.0)
[INFO]   Rounded: (184, 220)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 56
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(28/54) - Original Sharpe: 0.2374, Trades: 38
[INFO] Kmeans cluster 2: SMA(216/242) - Original Sharpe: 0.1965, Trades: 12
[INFO] Kmeans cluster 3: SMA(94/144) - Original Sharpe: 0.1520, Trades: 15
[INFO] Kmeans cluster 4: SMA(108/156) - Original Sharpe: 0.1223, Trades: 15
[INFO] Kmeans cluster 5: SMA(50/192) - Original Sharpe: -0.0204, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/56)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (28/54) - Sharpe: 0.2374
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.311916           -0.138193
1    2021-11-14 2021-11-14            43    -1.570968           -2.266419
2    2022-01-14 2022-01-14            41     4.756412            2.629506
3    2022-03-14 2022-03-14            44    -0.631215           -1.560349
4    2022-05-14 2022-05-14            43     1.889570            1.889570
5    2022-07-14 2022-07-14            44     1.058980            1.058980
6    2022-09-14 2022-09-14            43    -2.917599           -1.107448
7    2022-11-14 2022-11-14            43     3.958430            4.682347
8    2023-01-14 2023-01-14            41    -0.473647           -3.060198
9    2023-03-14 2023-03-14            43    -2.441244           -1.154436
10   2023-05-14 2023-05-14            44    -0.907558           -0.956523
11   2023-07-14 2023-07-14            44     0.852070            2.544504
12   2023-09-14 2023-09-14            43    -0.209199           -0.431078
13   2023-11-14 2023-11-14            42    -0.016601            1.861312
14   2024-01-14 2024-01-14            43    -5.969033           -4.412585
15   2024-03-14 2024-03-14            42     3.879904            3.001304
16   2024-05-14 2024-05-14            44    -0.180640           -1.301877
17   2024-07-14 2024-07-14            45     5.211523            2.376033
18   2024-09-14 2024-09-14            43    -0.392625           -0.392625
19   2024-11-14 2024-11-14            33    -0.726438            1.449572
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.3 |             -0.1 |          0.2 | True          
[INFO] 2021-11-14   |         -1.6 |             -2.3 |         -0.7 | False         
[INFO] 2022-01-14   |          4.8 |              2.6 |         -2.2 | False         
[INFO] 2022-03-14   |         -0.6 |             -1.6 |         -1.0 | False         
[INFO] 2022-05-14   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -2.9 |             -1.1 |          1.8 | True          
[INFO] 2022-11-14   |          4.0 |              4.7 |          0.7 | True          
[INFO] 2023-01-14   |         -0.5 |             -3.1 |         -2.6 | False         
[INFO] 2023-03-14   |         -2.4 |             -1.2 |          1.2 | True          
[INFO] 2023-05-14   |         -0.9 |             -1.0 |         -0.1 | False         
[INFO] 2023-07-14   |          0.9 |              2.5 |          1.6 | True          
[INFO] 2023-09-14   |         -0.2 |             -0.4 |         -0.2 | False         
[INFO] 2023-11-14   |         -0.0 |              1.9 |          1.9 | True          
[INFO] 2024-01-14   |         -6.0 |             -4.4 |          1.6 | True          
[INFO] 2024-03-14   |          3.9 |              3.0 |         -0.9 | False         
[INFO] 2024-05-14   |         -0.2 |             -1.3 |         -1.1 | False         
[INFO] 2024-07-14   |          5.2 |              2.4 |         -2.8 | False         
[INFO] 2024-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -0.7 |              1.4 |          2.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2022-07-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 8 of 17 periods (47.06% win rate)
[INFO] Updating Excel file with Kmeans results for GC...
[INFO] Excel file updated successfully. Added GC with Kmeans win rate 47.1% in row 23
[INFO] Added best Sharpe parameters 42/56 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 56
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(28/54) - Original Sharpe: 0.2374
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'GC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2531
[INFO] Kmeans Best out-of-sample Sharpe: 0.2888
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for GC...
[INFO] Excel file updated successfully. Added GC with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\GC
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2067 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.8118 to 0.4807
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 56
[INFO] Sharpe Ratio: 0.480665
[INFO] Number of Trades: 40
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2067 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.8118 to 0.4807
[INFO] Trades range: 10.0 to 169.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1848 to 2.3657
[INFO] Scaled Long SMA range: -2.3933 to 1.6319
[INFO] Scaled Sharpe ratio range: -2.9451 to 2.3270
[INFO] Scaled Trades range: -0.7263 to 10.7306
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2067 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6120
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 212 elements
[INFO] Cluster 1: 36 elements
[INFO] Cluster 2: 213 elements
[INFO] Cluster 3: 133 elements
[INFO] Cluster 4: 9 elements
[INFO] Cluster 5: 119 elements
[INFO] Cluster 6: 228 elements
[INFO] Cluster 7: 124 elements
[INFO] Cluster 8: 89 elements
[INFO] Cluster 9: 217 elements
[INFO] Cluster 10: 80 elements
[INFO] Cluster 11: 28 elements
[INFO] Cluster 12: 204 elements
[INFO] Cluster 13: 92 elements
[INFO] Cluster 14: 249 elements
[INFO] Cluster 15: 34 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=148, Long SMA=186, Sharpe=-0.3040, Trades=14
[INFO] Cluster 1 cluster: Short SMA=138, Long SMA=142, Sharpe=-0.1616, Trades=47
[INFO] Cluster 2 cluster: Short SMA=216, Long SMA=244, Sharpe=0.0953, Trades=12
[INFO] Cluster 3 cluster: Short SMA=38, Long SMA=154, Sharpe=-0.1213, Trades=18
[INFO] Cluster 5 cluster: Short SMA=28, Long SMA=56, Sharpe=0.2674, Trades=38
[INFO] Cluster 6 cluster: Short SMA=48, Long SMA=210, Sharpe=0.0623, Trades=12
[INFO] Cluster 7 cluster: Short SMA=264, Long SMA=288, Sharpe=-0.2851, Trades=12
[INFO] Cluster 8 cluster: Short SMA=100, Long SMA=118, Sharpe=0.2301, Trades=25
[INFO] Cluster 9 cluster: Short SMA=36, Long SMA=126, Sharpe=-0.5829, Trades=24
[INFO] Cluster 10 cluster: Short SMA=18, Long SMA=224, Sharpe=-0.4232, Trades=22
[INFO] Cluster 11 cluster: Short SMA=40, Long SMA=46, Sharpe=0.1701, Trades=78
[INFO] Cluster 12 cluster: Short SMA=60, Long SMA=256, Sharpe=-0.3078, Trades=10
[INFO] Cluster 13 cluster: Short SMA=234, Long SMA=276, Sharpe=-0.1137, Trades=12
[INFO] Cluster 14 cluster: Short SMA=90, Long SMA=152, Sharpe=0.2091, Trades=13
[INFO] Cluster 15 cluster: Short SMA=282, Long SMA=286, Sharpe=-0.4744, Trades=32
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=56, Sharpe=0.4807, Trades=40
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=28, Long SMA=56, Sharpe=0.2674, Trades=38
[INFO] Top 2: Short SMA=100, Long SMA=118, Sharpe=0.2301, Trades=25
[INFO] Top 3: Short SMA=90, Long SMA=152, Sharpe=0.2091, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 2058 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 56
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(28/56) - Original Sharpe: 0.2674, Trades: 38
[INFO] Hierarchical cluster 2: SMA(100/118) - Original Sharpe: 0.2301, Trades: 25
[INFO] Hierarchical cluster 3: SMA(90/152) - Original Sharpe: 0.2091, Trades: 13
[INFO] Hierarchical cluster 4: SMA(40/46) - Original Sharpe: 0.1701, Trades: 78
[INFO] Hierarchical cluster 5: SMA(216/244) - Original Sharpe: 0.0953, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/56)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (28/56) - Sharpe: 0.2674
[INFO] cluster 2: (100/118) - Sharpe: 0.2301
[INFO] cluster 3: (90/152) - Sharpe: 0.2091
[INFO] Loading GC data from local files...
[INFO] Found data file: A_OHLCV_@GC_minutes_1440_1802-1655.dat
[INFO] File size: 277765 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.311916           -3.514033
1    2021-11-14 2021-11-14            43    -1.570968            0.760214
2    2022-01-14 2022-01-14            41     4.756412            4.812677
3    2022-03-14 2022-03-14            44    -0.631215           -3.767093
4    2022-05-14 2022-05-14            43     1.889570           -1.889570
5    2022-07-14 2022-07-14            44     1.058980           -0.098518
6    2022-09-14 2022-09-14            43    -2.917599           -1.107448
7    2022-11-14 2022-11-14            43     3.958430           -1.375448
8    2023-01-14 2023-01-14            41    -0.473647           -2.123541
9    2023-03-14 2023-03-14            43    -2.441244            1.078559
10   2023-05-14 2023-05-14            44    -0.907558           -2.181441
11   2023-07-14 2023-07-14            44     0.852070            0.147668
12   2023-09-14 2023-09-14            43    -0.209199           -0.287369
13   2023-11-14 2023-11-14            42    -0.016601            0.053749
14   2024-01-14 2024-01-14            43    -5.969033            0.621553
15   2024-03-14 2024-03-14            42     3.879904            3.001304
16   2024-05-14 2024-05-14            44    -0.180640            0.026226
17   2024-07-14 2024-07-14            45     5.211523            2.511796
18   2024-09-14 2024-09-14            43    -0.392625           -0.392625
19   2024-11-14 2024-11-14            33    -0.726438            1.168862
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.3 |             -3.5 |         -3.2 | False         
[INFO] 2021-11-14   |         -1.6 |              0.8 |          2.4 | True          
[INFO] 2022-01-14   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -0.6 |             -3.8 |         -3.2 | False         
[INFO] 2022-05-14   |          1.9 |             -1.9 |         -3.8 | False         
[INFO] 2022-07-14   |          1.1 |             -0.1 |         -1.2 | False         
[INFO] 2022-09-14   |         -2.9 |             -1.1 |          1.8 | True          
[INFO] 2022-11-14   |          4.0 |             -1.4 |         -5.4 | False         
[INFO] 2023-01-14   |         -0.5 |             -2.1 |         -1.6 | False         
[INFO] 2023-03-14   |         -2.4 |              1.1 |          3.5 | True          
[INFO] 2023-05-14   |         -0.9 |             -2.2 |         -1.3 | False         
[INFO] 2023-07-14   |          0.9 |              0.1 |         -0.8 | False         
[INFO] 2023-09-14   |         -0.2 |             -0.3 |         -0.1 | False         
[INFO] 2023-11-14   |         -0.0 |              0.1 |          0.1 | True          
[INFO] 2024-01-14   |         -6.0 |              0.6 |          6.6 | True          
[INFO] 2024-03-14   |          3.9 |              3.0 |         -0.9 | False         
[INFO] 2024-05-14   |         -0.2 |              0.0 |          0.2 | True          
[INFO] 2024-07-14   |          5.2 |              2.5 |         -2.7 | False         
[INFO] 2024-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -0.7 |              1.2 |          1.9 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 18 periods (38.89% win rate)
[INFO] Updating Excel file with Hierarchical results for GC...
[INFO] Excel file updated successfully. Added GC with Hierarchical win rate 38.9% in row 23
[INFO] Added best Sharpe parameters 42/56 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 56
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(28/56) - Original Sharpe: 0.2674
[INFO] Added cluster 2 to portfolio: SMA(100/118) - Original Sharpe: 0.2301
[INFO] Added cluster 3 to portfolio: SMA(90/152) - Original Sharpe: 0.2091
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'GC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0728
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2888
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for GC...
[INFO] Excel file updated successfully. Added GC with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\GC
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for HG in column D: 14.0
[INFO] Using slippage from Excel column D: 14.0
[INFO] 
Symbol: @HG
[INFO] Description: Copper Continuous Contract [May25]
[INFO] Exchange: COMEX
[INFO] Interval: minutes 1440
[INFO] Tick size: 12.5
[INFO] Big point value: 25000.0
[INFO] Data shape: (6082, 6)
[INFO] Date range: 2001-05-14 16:55:00 to 2025-04-07 16:55:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-14 16:55:00  1.5330  1.5340  1.5330  1.5330    13.0
1 2001-05-15 16:55:00  1.5335  1.5345  1.5300  1.5335    17.0
2 2001-05-16 16:55:00  1.5330  1.5435  1.5275  1.5365    71.0
3 2001-05-17 16:55:00  1.5390  1.5460  1.5380  1.5455    64.0
4 2001-05-18 16:55:00  1.5455  1.5505  1.5455  1.5505    63.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 26.87 seconds (0.45 minutes)
[INFO] Best parameters found: Short SMA = 228, Long SMA = 242
[INFO] Best fitness (Sharpe ratio): 0.874628
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 228, Long SMA = 242, Sharpe = 0.874628
[INFO] Top 2: Short SMA = 34, Long SMA = 46, Sharpe = 0.865167
[INFO] Top 3: Short SMA = 252, Long SMA = 254, Sharpe = 0.861404
[INFO] Top 4: Short SMA = 234, Long SMA = 242, Sharpe = 0.861075
[INFO] Top 5: Short SMA = 232, Long SMA = 244, Sharpe = 0.860552
[INFO] Hall of Fame size: 2218
[INFO] Number of elements in all_results: 1439
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 779 had penalty fitness
[INFO] Total filtered from Hall of Fame: 779
[INFO] Hall of Fame -> all_results: 2218 -> 1439
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1439 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3106, Evaluation data length: 2839
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @HG
[INFO] Big Point Value (from data): 25000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.53 contracts
[INFO] Maximum Position Size: 9 contracts
[INFO] Strategy Total P&L: $6,587.50
[INFO] Market Buy & Hold P&L: $900.00
[INFO] Outperformance: $5,687.50
[INFO] Sharpe ratio (entire period, annualized): -0.053594
[INFO] Sharpe ratio (in-sample, annualized): -0.097262
[INFO] Sharpe ratio (out-of-sample, annualized): 0.043703
[INFO] Maximum Drawdown: $323,425.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-53,125.00
[INFO] Out-of-sample P&L: $10,712.50
[INFO] 
Best parameters from GA: Short SMA = 228, Long SMA = 242, Sharpe = 0.874628
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2218
[INFO] Cache hits (repeated combinations): 6426
[INFO] Total checks: 8644
[INFO] Cache hit rate: 74.34%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 25000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1439 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.6183 to 0.8746
[INFO] 
Best parameters:
[INFO] Short SMA: 228
[INFO] Long SMA: 242
[INFO] Sharpe Ratio: 0.874628
[INFO] Number of Trades: 23
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1439 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.6183 to 0.8746
[INFO] Trades range: 10.0 to 212.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3933 to 1.9004
[INFO] Scaled Long SMA range: -3.0524 to 1.4686
[INFO] Scaled Sharpe ratio range: -3.1838 to 1.9566
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 145 elements
[INFO] Kmeans Cluster 1: 150 elements
[INFO] Kmeans Cluster 2: 73 elements
[INFO] Kmeans Cluster 3: 76 elements
[INFO] Kmeans Cluster 4: 140 elements
[INFO] Kmeans Cluster 5: 39 elements
[INFO] Kmeans Cluster 6: 48 elements
[INFO] Kmeans Cluster 7: 120 elements
[INFO] Kmeans Cluster 8: 71 elements
[INFO] Kmeans Cluster 9: 77 elements
[INFO] Kmeans Cluster 10: 167 elements
[INFO] Kmeans Cluster 11: 34 elements
[INFO] Kmeans Cluster 12: 49 elements
[INFO] Kmeans Cluster 13: 64 elements
[INFO] Kmeans Cluster 14: 33 elements
[INFO] Kmeans Cluster 15: 65 elements
[INFO] Kmeans Cluster 16: 88 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=33.97, Long SMA=244.59, Sharpe=0.4703
[INFO] Centroid 1: Short SMA=259.63, Long SMA=282.81, Sharpe=0.2983
[INFO] Centroid 2: Short SMA=32.00, Long SMA=172.63, Sharpe=0.0221
[INFO] Centroid 3: Short SMA=156.66, Long SMA=187.18, Sharpe=0.1502
[INFO] Centroid 4: Short SMA=229.41, Long SMA=260.26, Sharpe=0.4935
[INFO] Centroid 5: Short SMA=23.23, Long SMA=58.87, Sharpe=0.0393
[INFO] Centroid 6: Short SMA=33.88, Long SMA=90.29, Sharpe=0.3225
[INFO] Centroid 7: Short SMA=35.88, Long SMA=233.12, Sharpe=0.2451
[INFO] Centroid 8: Short SMA=183.32, Long SMA=217.72, Sharpe=0.4018
[INFO] Centroid 9: Short SMA=121.92, Long SMA=171.12, Sharpe=-0.0634
[INFO] Centroid 10: Short SMA=190.59, Long SMA=226.95, Sharpe=0.6251
[INFO] Centroid 11: Short SMA=57.00, Long SMA=89.71, Sharpe=-0.3737
[INFO] Centroid 12: Short SMA=73.59, Long SMA=172.98, Sharpe=-0.3221
[INFO] Centroid 13: Short SMA=99.72, Long SMA=214.19, Sharpe=0.2605
[INFO] Centroid 14: Short SMA=34.00, Long SMA=49.09, Sharpe=0.6684
[INFO] Centroid 15: Short SMA=77.69, Long SMA=123.35, Sharpe=-0.0533
[INFO] Centroid 16: Short SMA=230.77, Long SMA=247.52, Sharpe=0.7342
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=228, Long SMA=242, Sharpe=0.8746, Trades=23
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=34, Long SMA=48, Sharpe=0.8435, Trades=40
[INFO] Kmeans Top 2: Short SMA=232, Long SMA=246, Sharpe=0.7615, Trades=23
[INFO] Kmeans Top 3: Short SMA=190, Long SMA=228, Sharpe=0.7072, Trades=11
[INFO] Kmeans Top 4: Short SMA=180, Long SMA=212, Sharpe=0.4906, Trades=13
[INFO] Kmeans Top 5: Short SMA=32, Long SMA=246, Sharpe=0.4445, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (34, 245)
[INFO]   Nearest: (34.0, 244.0)
[INFO]   Rounded: (260, 283)
[INFO]   Nearest: (260.0, 282.0)
[INFO]   Rounded: (32, 173)
[INFO]   Nearest: (32.0, 172.0)
[INFO]   Rounded: (157, 187)
[INFO]   Nearest: (156.0, 188.0)
[INFO]   Rounded: (229, 260)
[INFO]   Nearest: (230.0, 260.0)
[INFO]   Rounded: (23, 59)
[INFO]   Nearest: (24.0, 60.0)
[INFO]   Rounded: (34, 90)
[INFO]   Rounded: (36, 233)
[INFO]   Nearest: (36.0, 234.0)
[INFO]   Rounded: (183, 218)
[INFO]   Nearest: (184.0, 218.0)
[INFO]   Rounded: (122, 171)
[INFO]   Nearest: (122.0, 172.0)
[INFO]   Rounded: (191, 227)
[INFO]   Nearest: (190.0, 226.0)
[INFO]   Rounded: (57, 90)
[INFO]   Nearest: (56.0, 90.0)
[INFO]   Rounded: (74, 173)
[INFO]   Nearest: (74.0, 172.0)
[INFO]   Rounded: (100, 214)
[INFO]   Rounded: (34, 49)
[INFO]   Nearest: (34.0, 50.0)
[INFO]   Rounded: (78, 123)
[INFO]   Nearest: (78.0, 124.0)
[INFO]   Rounded: (231, 248)
[INFO]   Nearest: (230.0, 248.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 228, Long SMA: 242
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(34/48) - Original Sharpe: 0.8435, Trades: 40
[INFO] Kmeans cluster 2: SMA(232/246) - Original Sharpe: 0.7615, Trades: 23
[INFO] Kmeans cluster 3: SMA(190/228) - Original Sharpe: 0.7072, Trades: 11
[INFO] Kmeans cluster 4: SMA(180/212) - Original Sharpe: 0.4906, Trades: 13
[INFO] Kmeans cluster 5: SMA(32/246) - Original Sharpe: 0.4445, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (228/242)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/48) - Sharpe: 0.8435
[INFO] cluster 2: (232/246) - Sharpe: 0.7615
[INFO] cluster 3: (190/228) - Sharpe: 0.7072
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.966360            0.793755
1    2021-11-14 2021-11-14            43     0.592419           -0.313086
2    2022-01-14 2022-01-14            41     0.720927            0.549354
3    2022-03-14 2022-03-14            44     4.945672           -0.355357
4    2022-05-14 2022-05-14            43     1.926226           -0.220024
5    2022-07-14 2022-07-14            44     0.764664           -2.757562
6    2022-09-14 2022-09-14            43    -1.944732           -2.466202
7    2022-11-14 2022-11-14            43    -1.875063           -0.416868
8    2023-01-14 2023-01-14            41     1.193934            0.665456
9    2023-03-14 2023-03-14            43     2.711385            0.959011
10   2023-05-14 2023-05-14            44     3.505624            3.355478
11   2023-07-14 2023-07-14            44    -1.699708           -1.759995
12   2023-09-14 2023-09-14            43    -0.948764           -2.787519
13   2023-11-14 2023-11-14            42     0.923707            2.316559
14   2024-01-14 2024-01-14            43    -2.896531           -2.905201
15   2024-03-14 2024-03-14            42    -0.975847            1.324422
16   2024-05-14 2024-05-14            44    -3.087043           -1.180241
17   2024-07-14 2024-07-14            45    -2.418088           -2.418088
18   2024-09-14 2024-09-14            43    -0.682782           -1.089168
19   2024-11-14 2024-11-14            33    -1.722392           -1.895397
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              0.8 |         -0.2 | False         
[INFO] 2021-11-14   |          0.6 |             -0.3 |         -0.9 | False         
[INFO] 2022-01-14   |          0.7 |              0.5 |         -0.2 | False         
[INFO] 2022-03-14   |          4.9 |             -0.4 |         -5.3 | False         
[INFO] 2022-05-14   |          1.9 |             -0.2 |         -2.1 | False         
[INFO] 2022-07-14   |          0.8 |             -2.8 |         -3.6 | False         
[INFO] 2022-09-14   |         -1.9 |             -2.5 |         -0.6 | False         
[INFO] 2022-11-14   |         -1.9 |             -0.4 |          1.5 | True          
[INFO] 2023-01-14   |          1.2 |              0.7 |         -0.5 | False         
[INFO] 2023-03-14   |          2.7 |              1.0 |         -1.7 | False         
[INFO] 2023-05-14   |          3.5 |              3.4 |         -0.1 | False         
[INFO] 2023-07-14   |         -1.7 |             -1.8 |         -0.1 | False         
[INFO] 2023-09-14   |         -0.9 |             -2.8 |         -1.9 | False         
[INFO] 2023-11-14   |          0.9 |              2.3 |          1.4 | True          
[INFO] 2024-01-14   |         -2.9 |             -2.9 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.0 |              1.3 |          2.3 | True          
[INFO] 2024-05-14   |         -3.1 |             -1.2 |          1.9 | True          
[INFO] 2024-07-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -0.7 |             -1.1 |         -0.4 | False         
[INFO] 2024-11-14   |         -1.7 |             -1.9 |         -0.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-01-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Kmeans cluster wins (rounded comparison): 4 of 18 periods (22.22% win rate)
[INFO] Updating Excel file with Kmeans results for HG...
[INFO] Excel file updated successfully. Added HG with Kmeans win rate 22.2% in row 24
[INFO] Added best Sharpe parameters 228/242 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 228, Long SMA: 242
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/48) - Original Sharpe: 0.8435
[INFO] Added cluster 2 to portfolio: SMA(232/246) - Original Sharpe: 0.7615
[INFO] Added cluster 3 to portfolio: SMA(190/228) - Original Sharpe: 0.7072
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HG_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.5945
[INFO] Kmeans Best out-of-sample Sharpe: -0.0728
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for HG...
[INFO] Excel file updated successfully. Added HG with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HG
[INFO] Big Point Value: 25000.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1439 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.6183 to 0.8746
[INFO] 
Best parameters:
[INFO] Short SMA: 228
[INFO] Long SMA: 242
[INFO] Sharpe Ratio: 0.874628
[INFO] Number of Trades: 23
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1439 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.6183 to 0.8746
[INFO] Trades range: 10.0 to 212.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3933 to 1.9004
[INFO] Scaled Long SMA range: -3.0524 to 1.4686
[INFO] Scaled Sharpe ratio range: -3.1838 to 1.9566
[INFO] Scaled Trades range: -0.7116 to 12.9465
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1439 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5635
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 13
[INFO] Using 13 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 13 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 82 elements
[INFO] Cluster 1: 157 elements
[INFO] Cluster 2: 256 elements
[INFO] Cluster 3: 179 elements
[INFO] Cluster 4: 53 elements
[INFO] Cluster 5: 21 elements
[INFO] Cluster 6: 273 elements
[INFO] Cluster 7: 96 elements
[INFO] Cluster 8: 40 elements
[INFO] Cluster 9: 6 elements
[INFO] Cluster 10: 161 elements
[INFO] Cluster 11: 73 elements
[INFO] Cluster 12: 42 elements
[INFO] Using 12 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=40, Long SMA=102, Sharpe=0.3253, Trades=24
[INFO] Cluster 1 cluster: Short SMA=228, Long SMA=240, Sharpe=0.7670, Trades=23
[INFO] Cluster 2 cluster: Short SMA=242, Long SMA=272, Sharpe=0.4766, Trades=13
[INFO] Cluster 3 cluster: Short SMA=80, Long SMA=166, Sharpe=-0.2187, Trades=20
[INFO] Cluster 4 cluster: Short SMA=30, Long SMA=50, Sharpe=0.7611, Trades=40
[INFO] Cluster 5 cluster: Short SMA=20, Long SMA=36, Sharpe=-0.1703, Trades=69
[INFO] Cluster 6 cluster: Short SMA=36, Long SMA=240, Sharpe=0.5310, Trades=13
[INFO] Cluster 7 cluster: Short SMA=126, Long SMA=212, Sharpe=0.0230, Trades=11
[INFO] Cluster 8 cluster: Short SMA=166, Long SMA=172, Sharpe=-0.0047, Trades=41
[INFO] Cluster 10 cluster: Short SMA=188, Long SMA=234, Sharpe=0.6274, Trades=11
[INFO] Cluster 11 cluster: Short SMA=70, Long SMA=144, Sharpe=-0.6183, Trades=20
[INFO] Cluster 12 cluster: Short SMA=182, Long SMA=202, Sharpe=0.3885, Trades=21
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=228, Long SMA=242, Sharpe=0.8746, Trades=23
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=228, Long SMA=240, Sharpe=0.7670, Trades=23
[INFO] Top 2: Short SMA=30, Long SMA=50, Sharpe=0.7611, Trades=40
[INFO] Top 3: Short SMA=188, Long SMA=234, Sharpe=0.6274, Trades=11
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 12 valid clusters with clusters
[INFO] Filtering to 1433 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 228, Long SMA: 242
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(228/240) - Original Sharpe: 0.7670, Trades: 23
[INFO] Hierarchical cluster 2: SMA(30/50) - Original Sharpe: 0.7611, Trades: 40
[INFO] Hierarchical cluster 3: SMA(188/234) - Original Sharpe: 0.6274, Trades: 11
[INFO] Hierarchical cluster 4: SMA(36/240) - Original Sharpe: 0.5310, Trades: 13
[INFO] Hierarchical cluster 5: SMA(242/272) - Original Sharpe: 0.4766, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (228/242)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (228/240) - Sharpe: 0.7670
[INFO] cluster 2: (30/50) - Sharpe: 0.7611
[INFO] cluster 3: (188/234) - Sharpe: 0.6274
[INFO] Loading HG data from local files...
[INFO] Found data file: A_OHLCV_@HG_minutes_1440_1802-1655.dat
[INFO] File size: 292071 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.966360           -0.642279
1    2021-11-14 2021-11-14            43     0.592419           -0.659988
2    2022-01-14 2022-01-14            41     0.720927            0.256183
3    2022-03-14 2022-03-14            44     4.945672           -1.327146
4    2022-05-14 2022-05-14            43     1.926226            2.100057
5    2022-07-14 2022-07-14            44     0.764664           -0.706994
6    2022-09-14 2022-09-14            43    -1.944732           -1.831448
7    2022-11-14 2022-11-14            43    -1.875063           -1.875063
8    2023-01-14 2023-01-14            41     1.193934            0.665456
9    2023-03-14 2023-03-14            43     2.711385            2.315455
10   2023-05-14 2023-05-14            44     3.505624            4.384787
11   2023-07-14 2023-07-14            44    -1.699708           -1.710774
12   2023-09-14 2023-09-14            43    -0.948764           -2.787519
13   2023-11-14 2023-11-14            42     0.923707           -0.433149
14   2024-01-14 2024-01-14            43    -2.896531           -2.823368
15   2024-03-14 2024-03-14            42    -0.975847            0.820390
16   2024-05-14 2024-05-14            44    -3.087043           -2.146352
17   2024-07-14 2024-07-14            45    -2.418088           -2.418088
18   2024-09-14 2024-09-14            43    -0.682782           -1.089168
19   2024-11-14 2024-11-14            33    -1.722392           -1.513783
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |             -0.6 |         -1.6 | False         
[INFO] 2021-11-14   |          0.6 |             -0.7 |         -1.3 | False         
[INFO] 2022-01-14   |          0.7 |              0.3 |         -0.4 | False         
[INFO] 2022-03-14   |          4.9 |             -1.3 |         -6.2 | False         
[INFO] 2022-05-14   |          1.9 |              2.1 |          0.2 | True          
[INFO] 2022-07-14   |          0.8 |             -0.7 |         -1.5 | False         
[INFO] 2022-09-14   |         -1.9 |             -1.8 |          0.1 | True          
[INFO] 2022-11-14   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.2 |              0.7 |         -0.5 | False         
[INFO] 2023-03-14   |          2.7 |              2.3 |         -0.4 | False         
[INFO] 2023-05-14   |          3.5 |              4.4 |          0.9 | True          
[INFO] 2023-07-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -0.9 |             -2.8 |         -1.9 | False         
[INFO] 2023-11-14   |          0.9 |             -0.4 |         -1.3 | False         
[INFO] 2024-01-14   |         -2.9 |             -2.8 |          0.1 | True          
[INFO] 2024-03-14   |         -1.0 |              0.8 |          1.8 | True          
[INFO] 2024-05-14   |         -3.1 |             -2.1 |          1.0 | True          
[INFO] 2024-07-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -0.7 |             -1.1 |         -0.4 | False         
[INFO] 2024-11-14   |         -1.7 |             -1.5 |          0.2 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-11-14, 2023-07-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 17 periods (41.18% win rate)
[INFO] Updating Excel file with Hierarchical results for HG...
[INFO] Excel file updated successfully. Added HG with Hierarchical win rate 41.2% in row 24
[INFO] Added best Sharpe parameters 228/242 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 228, Long SMA: 242
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(228/240) - Original Sharpe: 0.7670
[INFO] Added cluster 2 to portfolio: SMA(30/50) - Original Sharpe: 0.7611
[INFO] Added cluster 3 to portfolio: SMA(188/234) - Original Sharpe: 0.6274
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HG_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.5877
[INFO] Hierarchical Best out-of-sample Sharpe: -0.0728
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for HG...
[INFO] Excel file updated successfully. Added HG with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HG
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for HO in column D: 25.0
[INFO] Using slippage from Excel column D: 25.0
[INFO] 
Symbol: @HO
[INFO] Description: Heating Oil Continuous Contract [May25]
[INFO] Exchange: NYMEX
[INFO] Interval: minutes 1440
[INFO] Tick size: 4.2
[INFO] Big point value: 42000.0
[INFO] Data shape: (6003, 6)
[INFO] Date range: 2001-05-14 16:55:00 to 2025-04-07 16:55:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-14 16:55:00 -0.9376 -0.9376 -0.9511 -0.9511    12.0
1 2001-05-15 16:55:00 -0.9511 -0.9336 -0.9531 -0.9361    64.0
2 2001-05-16 16:55:00 -0.9391 -0.9290 -0.9411 -0.9316    91.0
3 2001-05-17 16:55:00 -0.9321 -0.9201 -0.9356 -0.9211    29.0
4 2001-05-18 16:55:00 -0.9206 -0.9141 -0.9206 -0.9156    27.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 29.03 seconds (0.48 minutes)
[INFO] Best parameters found: Short SMA = 46, Long SMA = 50
[INFO] Best fitness (Sharpe ratio): 0.799913
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 46, Long SMA = 50, Sharpe = 0.799913
[INFO] Top 2: Short SMA = 144, Long SMA = 180, Sharpe = 0.757448
[INFO] Top 3: Short SMA = 146, Long SMA = 180, Sharpe = 0.744183
[INFO] Top 4: Short SMA = 142, Long SMA = 180, Sharpe = 0.738782
[INFO] Top 5: Short SMA = 144, Long SMA = 178, Sharpe = 0.735744
[INFO] Hall of Fame size: 2562
[INFO] Number of elements in all_results: 1929
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 633 had penalty fitness
[INFO] Total filtered from Hall of Fame: 633
[INFO] Hall of Fame -> all_results: 2562 -> 1929
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1929 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3106, Evaluation data length: 2839
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @HO
[INFO] Big Point Value (from data): 42000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.17 contracts
[INFO] Maximum Position Size: 5 contracts
[INFO] Strategy Total P&L: $-72,815.40
[INFO] Market Buy & Hold P&L: $86,142.00
[INFO] Outperformance: $-158,957.40
[INFO] Sharpe ratio (entire period, annualized): -0.090438
[INFO] Sharpe ratio (in-sample, annualized): 0.187418
[INFO] Sharpe ratio (out-of-sample, annualized): -0.660727
[INFO] Maximum Drawdown: $463,633.80
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $110,451.60
[INFO] Out-of-sample P&L: $-189,898.80
[INFO] 
Best parameters from GA: Short SMA = 46, Long SMA = 50, Sharpe = 0.799913
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2562
[INFO] Cache hits (repeated combinations): 6113
[INFO] Total checks: 8675
[INFO] Cache hit rate: 70.47%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1929 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7969 to 0.7999
[INFO] 
Best parameters:
[INFO] Short SMA: 46
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.799913
[INFO] Number of Trades: 55
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1929 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7969 to 0.7999
[INFO] Trades range: 10.0 to 238.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3036 to 2.4244
[INFO] Scaled Long SMA range: -3.0032 to 1.8639
[INFO] Scaled Sharpe ratio range: -3.7505 to 2.2612
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 82 elements
[INFO] Kmeans Cluster 1: 189 elements
[INFO] Kmeans Cluster 2: 103 elements
[INFO] Kmeans Cluster 3: 84 elements
[INFO] Kmeans Cluster 4: 174 elements
[INFO] Kmeans Cluster 5: 75 elements
[INFO] Kmeans Cluster 6: 256 elements
[INFO] Kmeans Cluster 7: 150 elements
[INFO] Kmeans Cluster 8: 122 elements
[INFO] Kmeans Cluster 9: 73 elements
[INFO] Kmeans Cluster 10: 43 elements
[INFO] Kmeans Cluster 11: 147 elements
[INFO] Kmeans Cluster 12: 77 elements
[INFO] Kmeans Cluster 13: 109 elements
[INFO] Kmeans Cluster 14: 97 elements
[INFO] Kmeans Cluster 15: 148 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=33.71, Long SMA=58.02, Sharpe=0.2995
[INFO] Centroid 1: Short SMA=30.31, Long SMA=168.34, Sharpe=0.3069
[INFO] Centroid 2: Short SMA=220.89, Long SMA=256.04, Sharpe=-0.1365
[INFO] Centroid 3: Short SMA=250.71, Long SMA=274.98, Sharpe=-0.3073
[INFO] Centroid 4: Short SMA=116.63, Long SMA=185.33, Sharpe=0.3716
[INFO] Centroid 5: Short SMA=89.84, Long SMA=129.25, Sharpe=-0.1570
[INFO] Centroid 6: Short SMA=157.56, Long SMA=207.33, Sharpe=0.3201
[INFO] Centroid 7: Short SMA=27.76, Long SMA=209.39, Sharpe=0.3206
[INFO] Centroid 8: Short SMA=29.26, Long SMA=267.02, Sharpe=0.2946
[INFO] Centroid 9: Short SMA=275.84, Long SMA=291.64, Sharpe=-0.5242
[INFO] Centroid 10: Short SMA=21.95, Long SMA=43.53, Sharpe=0.5122
[INFO] Centroid 11: Short SMA=148.69, Long SMA=177.32, Sharpe=0.5793
[INFO] Centroid 12: Short SMA=128.60, Long SMA=152.81, Sharpe=0.1718
[INFO] Centroid 13: Short SMA=38.59, Long SMA=108.37, Sharpe=0.0775
[INFO] Centroid 14: Short SMA=193.26, Long SMA=221.30, Sharpe=0.1809
[INFO] Centroid 15: Short SMA=69.97, Long SMA=179.62, Sharpe=0.0995
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=46, Long SMA=50, Sharpe=0.7999, Trades=55
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=150, Long SMA=176, Sharpe=0.6603, Trades=18
[INFO] Kmeans Top 2: Short SMA=20, Long SMA=44, Sharpe=0.5731, Trades=43
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=208, Sharpe=0.3992, Trades=10
[INFO] Kmeans Top 4: Short SMA=30, Long SMA=268, Sharpe=0.3421, Trades=11
[INFO] Kmeans Top 5: Short SMA=28, Long SMA=170, Sharpe=0.3130, Trades=14
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (34, 58)
[INFO]   Rounded: (30, 168)
[INFO]   Rounded: (221, 256)
[INFO]   Nearest: (220.0, 256.0)
[INFO]   Rounded: (251, 275)
[INFO]   Nearest: (250.0, 274.0)
[INFO]   Rounded: (117, 185)
[INFO]   Nearest: (116.0, 186.0)
[INFO]   Rounded: (90, 129)
[INFO]   Nearest: (90.0, 130.0)
[INFO]   Rounded: (158, 207)
[INFO]   Nearest: (158.0, 208.0)
[INFO]   Rounded: (28, 209)
[INFO]   Nearest: (28.0, 210.0)
[INFO]   Rounded: (29, 267)
[INFO]   Nearest: (30.0, 268.0)
[INFO]   Rounded: (276, 292)
[INFO]   Rounded: (22, 44)
[INFO]   Rounded: (149, 177)
[INFO]   Nearest: (148.0, 178.0)
[INFO]   Rounded: (129, 153)
[INFO]   Nearest: (128.0, 152.0)
[INFO]   Rounded: (39, 108)
[INFO]   Nearest: (38.0, 108.0)
[INFO]   Rounded: (193, 221)
[INFO]   Nearest: (194.0, 222.0)
[INFO]   Rounded: (70, 180)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 46, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(150/176) - Original Sharpe: 0.6603, Trades: 18
[INFO] Kmeans cluster 2: SMA(20/44) - Original Sharpe: 0.5731, Trades: 43
[INFO] Kmeans cluster 3: SMA(28/208) - Original Sharpe: 0.3992, Trades: 10
[INFO] Kmeans cluster 4: SMA(30/268) - Original Sharpe: 0.3421, Trades: 11
[INFO] Kmeans cluster 5: SMA(28/170) - Original Sharpe: 0.3130, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (46/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (150/176) - Sharpe: 0.6603
[INFO] cluster 2: (20/44) - Sharpe: 0.5731
[INFO] cluster 3: (28/208) - Sharpe: 0.3992
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.338293            2.313891
1    2021-11-14 2021-11-14            43    -2.932001            0.855941
2    2022-01-14 2022-01-14            41     3.359815            3.996440
3    2022-03-14 2022-03-14            44     3.521776            3.521776
4    2022-05-14 2022-05-14            43    -0.548195           -0.011332
5    2022-07-14 2022-07-14            44    -3.419946           -1.407716
6    2022-09-14 2022-09-14            43    -0.635309           -0.259239
7    2022-11-14 2022-11-14            43    -1.695378           -1.977581
8    2023-01-14 2023-01-14            41     1.311223           -1.289859
9    2023-03-14 2023-03-14            43    -0.853162            0.476521
10   2023-05-14 2023-05-14            44     0.412855           -2.500054
11   2023-07-14 2023-07-14            44     5.432989           -0.613865
12   2023-09-14 2023-09-14            43    -2.287125           -1.622641
13   2023-11-14 2023-11-14            42     1.668535           -0.526956
14   2024-01-14 2024-01-14            43    -3.987872           -0.178633
15   2024-03-14 2024-03-14            42     4.621206            1.383287
16   2024-05-14 2024-05-14            44    -0.482861           -1.218088
17   2024-07-14 2024-07-14            45     0.326923            3.157482
18   2024-09-14 2024-09-14            43    -0.685424           -1.000700
19   2024-11-14 2024-11-14            33    -0.942950           -1.891342
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.3 |              2.3 |          2.6 | True          
[INFO] 2021-11-14   |         -2.9 |              0.9 |          3.8 | True          
[INFO] 2022-01-14   |          3.4 |              4.0 |          0.6 | True          
[INFO] 2022-03-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -0.5 |             -0.0 |          0.5 | True          
[INFO] 2022-07-14   |         -3.4 |             -1.4 |          2.0 | True          
[INFO] 2022-09-14   |         -0.6 |             -0.3 |          0.3 | True          
[INFO] 2022-11-14   |         -1.7 |             -2.0 |         -0.3 | False         
[INFO] 2023-01-14   |          1.3 |             -1.3 |         -2.6 | False         
[INFO] 2023-03-14   |         -0.9 |              0.5 |          1.4 | True          
[INFO] 2023-05-14   |          0.4 |             -2.5 |         -2.9 | False         
[INFO] 2023-07-14   |          5.4 |             -0.6 |         -6.0 | False         
[INFO] 2023-09-14   |         -2.3 |             -1.6 |          0.7 | True          
[INFO] 2023-11-14   |          1.7 |             -0.5 |         -2.2 | False         
[INFO] 2024-01-14   |         -4.0 |             -0.2 |          3.8 | True          
[INFO] 2024-03-14   |          4.6 |              1.4 |         -3.2 | False         
[INFO] 2024-05-14   |         -0.5 |             -1.2 |         -0.7 | False         
[INFO] 2024-07-14   |          0.3 |              3.2 |          2.9 | True          
[INFO] 2024-09-14   |         -0.7 |             -1.0 |         -0.3 | False         
[INFO] 2024-11-14   |         -0.9 |             -1.9 |         -1.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 10 of 19 periods (52.63% win rate)
[INFO] Updating Excel file with Kmeans results for HO...
[INFO] Excel file updated successfully. Added HO with Kmeans win rate 52.6% in row 25
[INFO] Added best Sharpe parameters 46/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 46, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(150/176) - Original Sharpe: 0.6603
[INFO] Added cluster 2 to portfolio: SMA(20/44) - Original Sharpe: 0.5731
[INFO] Added cluster 3 to portfolio: SMA(28/208) - Original Sharpe: 0.3992
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HO_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.6229
[INFO] Kmeans Best out-of-sample Sharpe: 0.3242
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for HO...
[INFO] Excel file updated successfully. Added HO with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HO
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 25.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1929 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.7969 to 0.7999
[INFO] 
Best parameters:
[INFO] Short SMA: 46
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.799913
[INFO] Number of Trades: 55
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1929 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.7969 to 0.7999
[INFO] Trades range: 10.0 to 238.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3036 to 2.4244
[INFO] Scaled Long SMA range: -3.0032 to 1.8639
[INFO] Scaled Sharpe ratio range: -3.7505 to 2.2612
[INFO] Scaled Trades range: -0.7230 to 18.6239
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1929 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.7553
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 214 elements
[INFO] Cluster 1: 108 elements
[INFO] Cluster 2: 170 elements
[INFO] Cluster 3: 286 elements
[INFO] Cluster 4: 61 elements
[INFO] Cluster 5: 154 elements
[INFO] Cluster 6: 67 elements
[INFO] Cluster 7: 134 elements
[INFO] Cluster 8: 17 elements
[INFO] Cluster 9: 193 elements
[INFO] Cluster 10: 146 elements
[INFO] Cluster 11: 1 elements
[INFO] Cluster 12: 42 elements
[INFO] Cluster 13: 13 elements
[INFO] Cluster 14: 88 elements
[INFO] Cluster 15: 195 elements
[INFO] Cluster 16: 40 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=24, Long SMA=244, Sharpe=0.3203, Trades=14
[INFO] Cluster 1 cluster: Short SMA=274, Long SMA=288, Sharpe=-0.3054, Trades=19
[INFO] Cluster 2 cluster: Short SMA=188, Long SMA=214, Sharpe=0.2756, Trades=15
[INFO] Cluster 3 cluster: Short SMA=32, Long SMA=176, Sharpe=0.2623, Trades=12
[INFO] Cluster 4 cluster: Short SMA=140, Long SMA=152, Sharpe=0.1204, Trades=24
[INFO] Cluster 5 cluster: Short SMA=78, Long SMA=180, Sharpe=0.2862, Trades=12
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=44, Sharpe=0.4227, Trades=45
[INFO] Cluster 7 cluster: Short SMA=50, Long SMA=106, Sharpe=0.1768, Trades=21
[INFO] Cluster 9 cluster: Short SMA=126, Long SMA=180, Sharpe=0.4829, Trades=14
[INFO] Cluster 10 cluster: Short SMA=224, Long SMA=262, Sharpe=-0.1247, Trades=15
[INFO] Cluster 12 cluster: Short SMA=90, Long SMA=148, Sharpe=-0.3211, Trades=18
[INFO] Cluster 14 cluster: Short SMA=154, Long SMA=176, Sharpe=0.5553, Trades=18
[INFO] Cluster 15 cluster: Short SMA=150, Long SMA=210, Sharpe=0.1912, Trades=12
[INFO] Cluster 16 cluster: Short SMA=32, Long SMA=62, Sharpe=0.2068, Trades=35
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=46, Long SMA=50, Sharpe=0.7999, Trades=55
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=154, Long SMA=176, Sharpe=0.5553, Trades=18
[INFO] Top 2: Short SMA=126, Long SMA=180, Sharpe=0.4829, Trades=14
[INFO] Top 3: Short SMA=24, Long SMA=44, Sharpe=0.4227, Trades=45
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 1898 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 46, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(154/176) - Original Sharpe: 0.5553, Trades: 18
[INFO] Hierarchical cluster 2: SMA(126/180) - Original Sharpe: 0.4829, Trades: 14
[INFO] Hierarchical cluster 3: SMA(24/44) - Original Sharpe: 0.4227, Trades: 45
[INFO] Hierarchical cluster 4: SMA(24/244) - Original Sharpe: 0.3203, Trades: 14
[INFO] Hierarchical cluster 5: SMA(78/180) - Original Sharpe: 0.2862, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (46/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (154/176) - Sharpe: 0.5553
[INFO] cluster 2: (126/180) - Sharpe: 0.4829
[INFO] cluster 3: (24/44) - Sharpe: 0.4227
[INFO] Loading HO data from local files...
[INFO] Found data file: A_OHLCV_@HO_minutes_1440_1802-1655.dat
[INFO] File size: 288284 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.338293            2.613218
1    2021-11-14 2021-11-14            43    -2.932001            0.715892
2    2022-01-14 2022-01-14            41     3.359815            3.996440
3    2022-03-14 2022-03-14            44     3.521776            3.521776
4    2022-05-14 2022-05-14            43    -0.548195           -0.011332
5    2022-07-14 2022-07-14            44    -3.419946           -0.332111
6    2022-09-14 2022-09-14            43    -0.635309            0.952403
7    2022-11-14 2022-11-14            43    -1.695378           -2.706052
8    2023-01-14 2023-01-14            41     1.311223           -3.944592
9    2023-03-14 2023-03-14            43    -0.853162           -1.363069
10   2023-05-14 2023-05-14            44     0.412855           -2.320227
11   2023-07-14 2023-07-14            44     5.432989           -5.432989
12   2023-09-14 2023-09-14            43    -2.287125           -1.280099
13   2023-11-14 2023-11-14            42     1.668535           -0.526956
14   2024-01-14 2024-01-14            43    -3.987872           -0.210601
15   2024-03-14 2024-03-14            42     4.621206            3.910223
16   2024-05-14 2024-05-14            44    -0.482861           -1.824293
17   2024-07-14 2024-07-14            45     0.326923            2.931873
18   2024-09-14 2024-09-14            43    -0.685424           -0.878634
19   2024-11-14 2024-11-14            33    -0.942950           -1.482590
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.3 |              2.6 |          2.9 | True          
[INFO] 2021-11-14   |         -2.9 |              0.7 |          3.6 | True          
[INFO] 2022-01-14   |          3.4 |              4.0 |          0.6 | True          
[INFO] 2022-03-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -0.5 |             -0.0 |          0.5 | True          
[INFO] 2022-07-14   |         -3.4 |             -0.3 |          3.1 | True          
[INFO] 2022-09-14   |         -0.6 |              1.0 |          1.6 | True          
[INFO] 2022-11-14   |         -1.7 |             -2.7 |         -1.0 | False         
[INFO] 2023-01-14   |          1.3 |             -3.9 |         -5.2 | False         
[INFO] 2023-03-14   |         -0.9 |             -1.4 |         -0.5 | False         
[INFO] 2023-05-14   |          0.4 |             -2.3 |         -2.7 | False         
[INFO] 2023-07-14   |          5.4 |             -5.4 |        -10.8 | False         
[INFO] 2023-09-14   |         -2.3 |             -1.3 |          1.0 | True          
[INFO] 2023-11-14   |          1.7 |             -0.5 |         -2.2 | False         
[INFO] 2024-01-14   |         -4.0 |             -0.2 |          3.8 | True          
[INFO] 2024-03-14   |          4.6 |              3.9 |         -0.7 | False         
[INFO] 2024-05-14   |         -0.5 |             -1.8 |         -1.3 | False         
[INFO] 2024-07-14   |          0.3 |              2.9 |          2.6 | True          
[INFO] 2024-09-14   |         -0.7 |             -0.9 |         -0.2 | False         
[INFO] 2024-11-14   |         -0.9 |             -1.5 |         -0.6 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 9 of 19 periods (47.37% win rate)
[INFO] Updating Excel file with Hierarchical results for HO...
[INFO] Excel file updated successfully. Added HO with Hierarchical win rate 47.4% in row 25
[INFO] Added best Sharpe parameters 46/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 46, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(154/176) - Original Sharpe: 0.5553
[INFO] Added cluster 2 to portfolio: SMA(126/180) - Original Sharpe: 0.4829
[INFO] Added cluster 3 to portfolio: SMA(24/44) - Original Sharpe: 0.4227
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'HO_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.5852
[INFO] Hierarchical Best out-of-sample Sharpe: 0.3242
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for HO...
[INFO] Excel file updated successfully. Added HO with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\HO
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for JY in column D: 9.0
[INFO] Using slippage from Excel column D: 9.0
[INFO] 
Symbol: @JY
[INFO] Description: Japanese Yen Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 6.250000000000001
[INFO] Big point value: 125000.0
[INFO] Data shape: (6176, 6)
[INFO] Date range: 2001-05-02 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime     open     high      low    close  volume
0 2001-05-02 15:57:00  1.23665  1.24135  1.23365  1.24065     0.0
1 2001-05-03 15:57:00  1.24085  1.24125  1.23995  1.24055    81.0
2 2001-05-07 15:57:00  1.23845  1.24365  1.23805  1.24275   243.0
3 2001-05-08 15:57:00  1.24285  1.24465  1.23615  1.24195   200.0
4 2001-05-09 15:57:00  1.24125  1.24145  1.23395  1.23515  3551.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 26.51 seconds (0.44 minutes)
[INFO] Best parameters found: Short SMA = 58, Long SMA = 60
[INFO] Best fitness (Sharpe ratio): 0.628631
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 58, Long SMA = 60, Sharpe = 0.628631
[INFO] Top 2: Short SMA = 254, Long SMA = 256, Sharpe = 0.549317
[INFO] Top 3: Short SMA = 60, Long SMA = 70, Sharpe = 0.527629
[INFO] Top 4: Short SMA = 56, Long SMA = 60, Sharpe = 0.503827
[INFO] Top 5: Short SMA = 54, Long SMA = 60, Sharpe = 0.497586
[INFO] Hall of Fame size: 2240
[INFO] Number of elements in all_results: 2033
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 207 had penalty fitness
[INFO] Total filtered from Hall of Fame: 207
[INFO] Hall of Fame -> all_results: 2240 -> 2033
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2033 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @JY
[INFO] Big Point Value (from data): 125000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.36 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $574,262.50
[INFO] Market Buy & Hold P&L: $-63,037.50
[INFO] Outperformance: $637,300.00
[INFO] Sharpe ratio (entire period, annualized): 0.599780
[INFO] Sharpe ratio (in-sample, annualized): 0.196706
[INFO] Sharpe ratio (out-of-sample, annualized): 1.520326
[INFO] Maximum Drawdown: $172,775.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $109,150.00
[INFO] Out-of-sample P&L: $369,887.50
[INFO] 
Best parameters from GA: Short SMA = 58, Long SMA = 60, Sharpe = 0.628631
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2240
[INFO] Cache hits (repeated combinations): 6387
[INFO] Total checks: 8627
[INFO] Cache hit rate: 74.04%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2033 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.6192 to 0.6286
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 60
[INFO] Sharpe Ratio: 0.628631
[INFO] Number of Trades: 109
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2033 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.6192 to 0.6286
[INFO] Trades range: 10.0 to 186.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.4906 to 1.8251
[INFO] Scaled Long SMA range: -2.8423 to 1.0870
[INFO] Scaled Sharpe ratio range: -2.6883 to 4.2173
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 18
[INFO] Using 18 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=18...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 145 elements
[INFO] Kmeans Cluster 1: 172 elements
[INFO] Kmeans Cluster 2: 121 elements
[INFO] Kmeans Cluster 3: 105 elements
[INFO] Kmeans Cluster 4: 97 elements
[INFO] Kmeans Cluster 5: 97 elements
[INFO] Kmeans Cluster 6: 71 elements
[INFO] Kmeans Cluster 7: 113 elements
[INFO] Kmeans Cluster 8: 241 elements
[INFO] Kmeans Cluster 9: 112 elements
[INFO] Kmeans Cluster 10: 140 elements
[INFO] Kmeans Cluster 11: 67 elements
[INFO] Kmeans Cluster 12: 45 elements
[INFO] Kmeans Cluster 13: 133 elements
[INFO] Kmeans Cluster 14: 142 elements
[INFO] Kmeans Cluster 15: 92 elements
[INFO] Kmeans Cluster 16: 109 elements
[INFO] Kmeans Cluster 17: 31 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=19.66, Long SMA=266.97, Sharpe=-0.0349
[INFO] Centroid 1: Short SMA=259.71, Long SMA=287.09, Sharpe=-0.0813
[INFO] Centroid 2: Short SMA=72.76, Long SMA=136.84, Sharpe=-0.2072
[INFO] Centroid 3: Short SMA=174.00, Long SMA=215.60, Sharpe=-0.2586
[INFO] Centroid 4: Short SMA=33.55, Long SMA=69.03, Sharpe=-0.0262
[INFO] Centroid 5: Short SMA=35.22, Long SMA=72.87, Sharpe=0.2168
[INFO] Centroid 6: Short SMA=249.24, Long SMA=269.46, Sharpe=0.2765
[INFO] Centroid 7: Short SMA=71.81, Long SMA=192.57, Sharpe=-0.3548
[INFO] Centroid 8: Short SMA=202.07, Long SMA=268.62, Sharpe=-0.1385
[INFO] Centroid 9: Short SMA=111.45, Long SMA=257.98, Sharpe=-0.1282
[INFO] Centroid 10: Short SMA=150.67, Long SMA=272.13, Sharpe=-0.3002
[INFO] Centroid 11: Short SMA=29.43, Long SMA=143.25, Sharpe=-0.0439
[INFO] Centroid 12: Short SMA=134.76, Long SMA=156.18, Sharpe=-0.0708
[INFO] Centroid 13: Short SMA=58.03, Long SMA=240.41, Sharpe=-0.2147
[INFO] Centroid 14: Short SMA=245.63, Long SMA=271.77, Sharpe=0.0638
[INFO] Centroid 15: Short SMA=155.83, Long SMA=209.54, Sharpe=-0.4635
[INFO] Centroid 16: Short SMA=248.68, Long SMA=280.22, Sharpe=-0.2632
[INFO] Centroid 17: Short SMA=68.45, Long SMA=92.45, Sharpe=-0.3651
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=60, Sharpe=0.6286, Trades=109
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=34, Long SMA=72, Sharpe=0.2029, Trades=30
[INFO] Kmeans Top 2: Short SMA=250, Long SMA=270, Sharpe=0.1760, Trades=20
[INFO] Kmeans Top 3: Short SMA=248, Long SMA=270, Sharpe=0.1061, Trades=20
[INFO] Kmeans Top 4: Short SMA=32, Long SMA=62, Sharpe=0.0276, Trades=35
[INFO] Kmeans Top 5: Short SMA=28, Long SMA=150, Sharpe=-0.0276, Trades=22
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17}
[INFO]   Rounded: (20, 267)
[INFO]   Nearest: (20.0, 266.0)
[INFO]   Rounded: (260, 287)
[INFO]   Nearest: (260.0, 288.0)
[INFO]   Rounded: (73, 137)
[INFO]   Nearest: (72.0, 136.0)
[INFO]   Rounded: (174, 216)
[INFO]   Rounded: (34, 69)
[INFO]   Nearest: (34.0, 70.0)
[INFO]   Rounded: (35, 73)
[INFO]   Nearest: (36.0, 72.0)
[INFO]   Rounded: (249, 269)
[INFO]   Nearest: (250.0, 270.0)
[INFO]   Rounded: (72, 193)
[INFO]   Nearest: (72.0, 192.0)
[INFO]   Rounded: (202, 269)
[INFO]   Nearest: (202.0, 268.0)
[INFO]   Rounded: (111, 258)
[INFO]   Nearest: (112.0, 258.0)
[INFO]   Rounded: (151, 272)
[INFO]   Nearest: (150.0, 272.0)
[INFO]   Rounded: (29, 143)
[INFO]   Nearest: (30.0, 144.0)
[INFO]   Rounded: (135, 156)
[INFO]   Nearest: (134.0, 156.0)
[INFO]   Rounded: (58, 240)
[INFO]   Rounded: (246, 272)
[INFO]   Rounded: (156, 210)
[INFO]   Rounded: (249, 280)
[INFO]   Nearest: (248.0, 280.0)
[INFO]   Rounded: (68, 92)
[INFO] Successfully plotted 18 out of 18 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 60
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(34/72) - Original Sharpe: 0.2029, Trades: 30
[INFO] Kmeans cluster 2: SMA(250/270) - Original Sharpe: 0.1760, Trades: 20
[INFO] Kmeans cluster 3: SMA(248/270) - Original Sharpe: 0.1061, Trades: 20
[INFO] Kmeans cluster 4: SMA(32/62) - Original Sharpe: 0.0276, Trades: 35
[INFO] Kmeans cluster 5: SMA(28/150) - Original Sharpe: -0.0276, Trades: 22
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/60)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/72) - Sharpe: 0.2029
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.150748            1.689600
1    2021-11-14 2021-11-14            43     1.384297           -0.080849
2    2022-01-14 2022-01-14            41     3.292417            3.110260
3    2022-03-14 2022-03-14            44     6.956797            5.852003
4    2022-05-14 2022-05-14            43     3.536297            3.536297
5    2022-07-14 2022-07-14            44     1.924049            1.924049
6    2022-09-14 2022-09-14            43    -1.464758           -1.464758
7    2022-11-14 2022-11-14            43     3.567745            1.895375
8    2023-01-14 2023-01-14            41    -2.381255           -6.846762
9    2023-03-14 2023-03-14            44     2.565997            1.544248
10   2023-05-14 2023-05-14            44    -0.317342            1.331984
11   2023-07-14 2023-07-14            44     5.203187            5.203187
12   2023-09-14 2023-09-14            43     3.227294            3.227294
13   2023-11-14 2023-11-14            42    -5.199080           -3.614330
14   2024-01-14 2024-01-14            43    -5.390091           -3.407033
15   2024-03-14 2024-03-14            42     4.374593            4.374593
16   2024-05-14 2024-05-14            44     1.567034            1.567034
17   2024-07-14 2024-07-14            45    -2.564883           -2.388807
18   2024-09-14 2024-09-14            43    -3.192759           -3.199864
19   2024-11-14 2024-11-14            33     1.332713            1.332713
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.2 |              1.7 |          3.9 | True          
[INFO] 2021-11-14   |          1.4 |             -0.1 |         -1.5 | False         
[INFO] 2022-01-14   |          3.3 |              3.1 |         -0.2 | False         
[INFO] 2022-03-14   |          7.0 |              5.9 |         -1.1 | False         
[INFO] 2022-05-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-11-14   |          3.6 |              1.9 |         -1.7 | False         
[INFO] 2023-01-14   |         -2.4 |             -6.8 |         -4.4 | False         
[INFO] 2023-03-14   |          2.6 |              1.5 |         -1.1 | False         
[INFO] 2023-05-14   |         -0.3 |              1.3 |          1.6 | True          
[INFO] 2023-07-14   |          5.2 |              5.2 |          0.0 | Excluded      
[INFO] 2023-09-14   |          3.2 |              3.2 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -5.2 |             -3.6 |          1.6 | True          
[INFO] 2024-01-14   |         -5.4 |             -3.4 |          2.0 | True          
[INFO] 2024-03-14   |          4.4 |              4.4 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.6 |             -2.4 |          0.2 | True          
[INFO] 2024-09-14   |         -3.2 |             -3.2 |          0.0 | Excluded      
[INFO] 2024-11-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2022-07-14, 2022-09-14, 2023-07-14, 2023-09-14, 2024-03-14, 2024-05-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Kmeans cluster wins (rounded comparison): 5 of 11 periods (45.45% win rate)
[INFO] Updating Excel file with Kmeans results for JY...
[INFO] Excel file updated successfully. Added JY with Kmeans win rate 45.5% in row 26
[INFO] Added best Sharpe parameters 58/60 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 60
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/72) - Original Sharpe: 0.2029
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'JY_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.8515
[INFO] Kmeans Best out-of-sample Sharpe: 0.8275
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for JY...
[INFO] Excel file updated successfully. Added JY with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\JY
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2033 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.6192 to 0.6286
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 60
[INFO] Sharpe Ratio: 0.628631
[INFO] Number of Trades: 109
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2033 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.6192 to 0.6286
[INFO] Trades range: 10.0 to 186.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.4906 to 1.8251
[INFO] Scaled Long SMA range: -2.8423 to 1.0870
[INFO] Scaled Sharpe ratio range: -2.6883 to 4.2173
[INFO] Scaled Trades range: -0.7419 to 11.8463
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2033 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5746
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 18
[INFO] Using 18 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 18 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 272 elements
[INFO] Cluster 1: 22 elements
[INFO] Cluster 2: 316 elements
[INFO] Cluster 3: 77 elements
[INFO] Cluster 4: 104 elements
[INFO] Cluster 5: 7 elements
[INFO] Cluster 6: 121 elements
[INFO] Cluster 7: 70 elements
[INFO] Cluster 8: 86 elements
[INFO] Cluster 9: 127 elements
[INFO] Cluster 10: 138 elements
[INFO] Cluster 11: 39 elements
[INFO] Cluster 12: 217 elements
[INFO] Cluster 13: 24 elements
[INFO] Cluster 14: 61 elements
[INFO] Cluster 15: 86 elements
[INFO] Cluster 16: 114 elements
[INFO] Cluster 17: 152 elements
[INFO] Using 17 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=80, Long SMA=250, Sharpe=-0.3309, Trades=10
[INFO] Cluster 1 cluster: Short SMA=264, Long SMA=266, Sharpe=-0.0908, Trades=61
[INFO] Cluster 2 cluster: Short SMA=200, Long SMA=266, Sharpe=-0.1580, Trades=14
[INFO] Cluster 3 cluster: Short SMA=60, Long SMA=114, Sharpe=-0.2361, Trades=20
[INFO] Cluster 4 cluster: Short SMA=30, Long SMA=116, Sharpe=-0.0699, Trades=20
[INFO] Cluster 6 cluster: Short SMA=122, Long SMA=160, Sharpe=-0.2117, Trades=16
[INFO] Cluster 7 cluster: Short SMA=30, Long SMA=70, Sharpe=0.1014, Trades=35
[INFO] Cluster 8 cluster: Short SMA=270, Long SMA=278, Sharpe=0.0768, Trades=32
[INFO] Cluster 9 cluster: Short SMA=72, Long SMA=188, Sharpe=-0.2379, Trades=14
[INFO] Cluster 10 cluster: Short SMA=18, Long SMA=268, Sharpe=-0.0612, Trades=16
[INFO] Cluster 11 cluster: Short SMA=240, Long SMA=244, Sharpe=-0.2957, Trades=46
[INFO] Cluster 12 cluster: Short SMA=232, Long SMA=280, Sharpe=-0.0936, Trades=16
[INFO] Cluster 13 cluster: Short SMA=24, Long SMA=36, Sharpe=-0.3088, Trades=78
[INFO] Cluster 14 cluster: Short SMA=32, Long SMA=54, Sharpe=-0.1702, Trades=45
[INFO] Cluster 15 cluster: Short SMA=162, Long SMA=212, Sharpe=-0.5045, Trades=18
[INFO] Cluster 16 cluster: Short SMA=246, Long SMA=272, Sharpe=0.1503, Trades=20
[INFO] Cluster 17 cluster: Short SMA=148, Long SMA=266, Sharpe=-0.2825, Trades=10
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=60, Sharpe=0.6286, Trades=109
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=246, Long SMA=272, Sharpe=0.1503, Trades=20
[INFO] Top 2: Short SMA=30, Long SMA=70, Sharpe=0.1014, Trades=35
[INFO] Top 3: Short SMA=270, Long SMA=278, Sharpe=0.0768, Trades=32
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 17 valid clusters with clusters
[INFO] Filtering to 2026 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 60
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading JY data from local files...
[INFO] Found data file: A_OHLCV_@JY_minutes_1440_1703-1557.dat
[INFO] File size: 296587 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(246/272) - Original Sharpe: 0.1503, Trades: 20
[INFO] Hierarchical cluster 2: SMA(30/70) - Original Sharpe: 0.1014, Trades: 35
[INFO] Hierarchical cluster 3: SMA(270/278) - Original Sharpe: 0.0768, Trades: 32
[INFO] Hierarchical cluster 4: SMA(18/268) - Original Sharpe: -0.0612, Trades: 16
[INFO] Hierarchical cluster 5: SMA(30/116) - Original Sharpe: -0.0699, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/60)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 60
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\JY
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for KC in column D: 32.0
[INFO] Using slippage from Excel column D: 32.0
[INFO] 
Symbol: @KC
[INFO] Description: Coffee C Continuous Contract [May25]
[INFO] Exchange: ICEUS
[INFO] Interval: minutes 1440
[INFO] Tick size: 18.75
[INFO] Big point value: 375.0
[INFO] Data shape: (6056, 6)
[INFO] Date range: 2001-02-12 13:25:00 to 2025-04-07 13:25:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-02-12 13:25:00  311.34  311.84  311.09  311.74     0.0
1 2001-02-13 13:25:00  311.59  313.04  311.59  312.34     0.0
2 2001-02-14 13:25:00  312.59  312.59  311.34  311.84     0.0
3 2001-02-15 13:25:00  312.34  312.34  311.34  311.34     0.0
4 2001-02-16 13:25:00  310.54  310.64  308.74  309.04     0.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 32.20 seconds (0.54 minutes)
[INFO] Best parameters found: Short SMA = 126, Long SMA = 144
[INFO] Best fitness (Sharpe ratio): 0.627789
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 126, Long SMA = 144, Sharpe = 0.627789
[INFO] Top 2: Short SMA = 126, Long SMA = 142, Sharpe = 0.581604
[INFO] Top 3: Short SMA = 126, Long SMA = 146, Sharpe = 0.561435
[INFO] Top 4: Short SMA = 126, Long SMA = 150, Sharpe = 0.539341
[INFO] Top 5: Short SMA = 128, Long SMA = 144, Sharpe = 0.527444
[INFO] Hall of Fame size: 2488
[INFO] Number of elements in all_results: 1672
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 816 had penalty fitness
[INFO] Total filtered from Hall of Fame: 816
[INFO] Hall of Fame -> all_results: 2488 -> 1672
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1672 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @KC
[INFO] Big Point Value (from data): 375.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.46 contracts
[INFO] Maximum Position Size: 10 contracts
[INFO] Strategy Total P&L: $-144,825.00
[INFO] Market Buy & Hold P&L: $47,625.00
[INFO] Outperformance: $-192,450.00
[INFO] Sharpe ratio (entire period, annualized): -0.285346
[INFO] Sharpe ratio (in-sample, annualized): -0.044230
[INFO] Sharpe ratio (out-of-sample, annualized): -0.814159
[INFO] Maximum Drawdown: $399,750.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-25,837.50
[INFO] Out-of-sample P&L: $-217,031.25
[INFO] 
Best parameters from GA: Short SMA = 126, Long SMA = 144, Sharpe = 0.627789
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2488
[INFO] Cache hits (repeated combinations): 6123
[INFO] Total checks: 8611
[INFO] Cache hit rate: 71.11%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 375.0
[INFO] Slippage: 32.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1672 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.6219 to 0.6278
[INFO] 
Best parameters:
[INFO] Short SMA: 126
[INFO] Long SMA: 144
[INFO] Sharpe Ratio: 0.627789
[INFO] Number of Trades: 23
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1672 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.6219 to 0.6278
[INFO] Trades range: 11.0 to 162.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0739 to 2.5536
[INFO] Scaled Long SMA range: -2.4917 to 1.8773
[INFO] Scaled Sharpe ratio range: -3.1911 to 2.4276
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 83 elements
[INFO] Kmeans Cluster 1: 83 elements
[INFO] Kmeans Cluster 2: 129 elements
[INFO] Kmeans Cluster 3: 147 elements
[INFO] Kmeans Cluster 4: 142 elements
[INFO] Kmeans Cluster 5: 88 elements
[INFO] Kmeans Cluster 6: 153 elements
[INFO] Kmeans Cluster 7: 50 elements
[INFO] Kmeans Cluster 8: 81 elements
[INFO] Kmeans Cluster 9: 184 elements
[INFO] Kmeans Cluster 10: 93 elements
[INFO] Kmeans Cluster 11: 100 elements
[INFO] Kmeans Cluster 12: 64 elements
[INFO] Kmeans Cluster 13: 75 elements
[INFO] Kmeans Cluster 14: 200 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=119.20, Long SMA=150.53, Sharpe=0.4010
[INFO] Centroid 1: Short SMA=218.58, Long SMA=240.24, Sharpe=0.0108
[INFO] Centroid 2: Short SMA=36.28, Long SMA=159.57, Sharpe=0.1825
[INFO] Centroid 3: Short SMA=105.31, Long SMA=146.56, Sharpe=0.1718
[INFO] Centroid 4: Short SMA=42.76, Long SMA=227.66, Sharpe=0.0319
[INFO] Centroid 5: Short SMA=147.52, Long SMA=175.00, Sharpe=-0.1409
[INFO] Centroid 6: Short SMA=49.22, Long SMA=92.29, Sharpe=0.1161
[INFO] Centroid 7: Short SMA=20.80, Long SMA=56.08, Sharpe=-0.3208
[INFO] Centroid 8: Short SMA=188.84, Long SMA=210.94, Sharpe=0.1962
[INFO] Centroid 9: Short SMA=36.92, Long SMA=208.57, Sharpe=0.2845
[INFO] Centroid 10: Short SMA=21.63, Long SMA=140.00, Sharpe=-0.0320
[INFO] Centroid 11: Short SMA=255.02, Long SMA=278.28, Sharpe=-0.3836
[INFO] Centroid 12: Short SMA=282.34, Long SMA=292.16, Sharpe=-0.1056
[INFO] Centroid 13: Short SMA=38.75, Long SMA=282.75, Sharpe=-0.1557
[INFO] Centroid 14: Short SMA=64.40, Long SMA=132.23, Sharpe=0.3082
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=126, Long SMA=144, Sharpe=0.6278, Trades=23
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=124, Long SMA=148, Sharpe=0.4892, Trades=17
[INFO] Kmeans Top 2: Short SMA=190, Long SMA=210, Sharpe=0.2916, Trades=15
[INFO] Kmeans Top 3: Short SMA=66, Long SMA=136, Sharpe=0.2673, Trades=15
[INFO] Kmeans Top 4: Short SMA=104, Long SMA=144, Sharpe=0.2573, Trades=15
[INFO] Kmeans Top 5: Short SMA=36, Long SMA=158, Sharpe=0.2388, Trades=19
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (119, 151)
[INFO]   Nearest: (120.0, 150.0)
[INFO]   Rounded: (219, 240)
[INFO]   Nearest: (218.0, 240.0)
[INFO]   Rounded: (36, 160)
[INFO]   Rounded: (105, 147)
[INFO]   Nearest: (106.0, 146.0)
[INFO]   Rounded: (43, 228)
[INFO]   Nearest: (42.0, 228.0)
[INFO]   Rounded: (148, 175)
[INFO]   Nearest: (148.0, 174.0)
[INFO]   Rounded: (49, 92)
[INFO]   Nearest: (50.0, 92.0)
[INFO]   Rounded: (21, 56)
[INFO]   Nearest: (20.0, 56.0)
[INFO]   Rounded: (189, 211)
[INFO]   Nearest: (188.0, 210.0)
[INFO]   Rounded: (37, 209)
[INFO]   Nearest: (36.0, 208.0)
[INFO]   Rounded: (22, 140)
[INFO]   Rounded: (255, 278)
[INFO]   Nearest: (256.0, 278.0)
[INFO]   Rounded: (282, 292)
[INFO]   Rounded: (39, 283)
[INFO]   Nearest: (38.0, 282.0)
[INFO]   Rounded: (64, 132)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 126, Long SMA: 144
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(124/148) - Original Sharpe: 0.4892, Trades: 17
[INFO] Kmeans cluster 2: SMA(190/210) - Original Sharpe: 0.2916, Trades: 15
[INFO] Kmeans cluster 3: SMA(66/136) - Original Sharpe: 0.2673, Trades: 15
[INFO] Kmeans cluster 4: SMA(104/144) - Original Sharpe: 0.2573, Trades: 15
[INFO] Kmeans cluster 5: SMA(36/158) - Original Sharpe: 0.2388, Trades: 19
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (126/144)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (124/148) - Sharpe: 0.4892
[INFO] cluster 2: (190/210) - Sharpe: 0.2916
[INFO] cluster 3: (66/136) - Sharpe: 0.2673
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     1.943138            1.943138
1    2021-11-10 2021-11-10            41     2.726433            2.726433
2    2022-01-10 2022-01-10            41    -0.979722           -0.979722
3    2022-03-10 2022-03-10            42    -1.932434           -1.934745
4    2022-05-10 2022-05-10            41     2.781394            2.491704
5    2022-07-10 2022-07-10            44    -0.902683           -1.535966
6    2022-09-10 2022-09-10            43     4.781663            5.286852
7    2022-11-10 2022-11-10            40     0.520961            0.528681
8    2023-01-10 2023-01-10            41    -1.945501           -1.945501
9    2023-03-10 2023-03-10            42    -1.386296           -2.602413
10   2023-05-10 2023-05-10            40    -1.725343           -1.674154
11   2023-07-10 2023-07-10            44     0.054587            4.610185
12   2023-09-10 2023-09-10            44    -3.556132           -3.556132
13   2023-11-10 2023-11-10            40    -1.024655           -1.517681
14   2024-01-10 2024-01-10            41     1.405934            0.117142
15   2024-03-10 2024-03-10            43     1.924896            0.609351
16   2024-05-10 2024-05-10            40     2.925387            2.925387
17   2024-07-10 2024-07-10            43     0.254368            0.254368
18   2024-09-10 2024-09-10            44     0.943102            0.943102
19   2024-11-10 2024-11-10            35     5.162860            5.162860
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-01-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |          2.8 |              2.5 |         -0.3 | False         
[INFO] 2022-07-10   |         -0.9 |             -1.5 |         -0.6 | False         
[INFO] 2022-09-10   |          4.8 |              5.3 |          0.5 | True          
[INFO] 2022-11-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -1.4 |             -2.6 |         -1.2 | False         
[INFO] 2023-05-10   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-07-10   |          0.1 |              4.6 |          4.5 | True          
[INFO] 2023-09-10   |         -3.6 |             -3.6 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -1.0 |             -1.5 |         -0.5 | False         
[INFO] 2024-01-10   |          1.4 |              0.1 |         -1.3 | False         
[INFO] 2024-03-10   |          1.9 |              0.6 |         -1.3 | False         
[INFO] 2024-05-10   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-11-10   |          5.2 |              5.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2022-11-10, 2023-01-10, 2023-05-10, 2023-09-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Kmeans cluster wins (rounded comparison): 2 of 8 periods (25.00% win rate)
[INFO] Updating Excel file with Kmeans results for KC...
[INFO] Excel file updated successfully. Added KC with Kmeans win rate 25.0% in row 27
[INFO] Added best Sharpe parameters 126/144 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 126, Long SMA: 144
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(124/148) - Original Sharpe: 0.4892
[INFO] Added cluster 2 to portfolio: SMA(190/210) - Original Sharpe: 0.2916
[INFO] Added cluster 3 to portfolio: SMA(66/136) - Original Sharpe: 0.2673
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.7688
[INFO] Kmeans Best out-of-sample Sharpe: 0.6577
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for KC...
[INFO] Excel file updated successfully. Added KC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KC
[INFO] Big Point Value: 375.0
[INFO] Slippage: 32.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1672 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.6219 to 0.6278
[INFO] 
Best parameters:
[INFO] Short SMA: 126
[INFO] Long SMA: 144
[INFO] Sharpe Ratio: 0.627789
[INFO] Number of Trades: 23
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1672 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.6219 to 0.6278
[INFO] Trades range: 11.0 to 162.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0739 to 2.5536
[INFO] Scaled Long SMA range: -2.4917 to 1.8773
[INFO] Scaled Sharpe ratio range: -3.1911 to 2.4276
[INFO] Scaled Trades range: -0.6928 to 12.8903
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1672 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6072
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 156 elements
[INFO] Cluster 1: 137 elements
[INFO] Cluster 2: 109 elements
[INFO] Cluster 3: 30 elements
[INFO] Cluster 4: 5 elements
[INFO] Cluster 5: 143 elements
[INFO] Cluster 6: 151 elements
[INFO] Cluster 7: 302 elements
[INFO] Cluster 8: 88 elements
[INFO] Cluster 9: 52 elements
[INFO] Cluster 10: 23 elements
[INFO] Cluster 11: 28 elements
[INFO] Cluster 12: 83 elements
[INFO] Cluster 13: 92 elements
[INFO] Cluster 14: 92 elements
[INFO] Cluster 15: 181 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=52, Long SMA=158, Sharpe=0.1963, Trades=17
[INFO] Cluster 1 cluster: Short SMA=204, Long SMA=222, Sharpe=-0.0077, Trades=15
[INFO] Cluster 2 cluster: Short SMA=22, Long SMA=146, Sharpe=-0.0065, Trades=21
[INFO] Cluster 3 cluster: Short SMA=138, Long SMA=140, Sharpe=0.2149, Trades=65
[INFO] Cluster 5 cluster: Short SMA=24, Long SMA=214, Sharpe=0.3429, Trades=13
[INFO] Cluster 6 cluster: Short SMA=52, Long SMA=102, Sharpe=0.1332, Trades=21
[INFO] Cluster 7 cluster: Short SMA=78, Long SMA=140, Sharpe=0.2900, Trades=15
[INFO] Cluster 8 cluster: Short SMA=146, Long SMA=180, Sharpe=-0.1613, Trades=17
[INFO] Cluster 9 cluster: Short SMA=46, Long SMA=62, Sharpe=-0.0375, Trades=35
[INFO] Cluster 10 cluster: Short SMA=20, Long SMA=38, Sharpe=-0.3947, Trades=58
[INFO] Cluster 11 cluster: Short SMA=130, Long SMA=140, Sharpe=0.3870, Trades=33
[INFO] Cluster 12 cluster: Short SMA=280, Long SMA=290, Sharpe=-0.2315, Trades=17
[INFO] Cluster 13 cluster: Short SMA=260, Long SMA=278, Sharpe=-0.2411, Trades=13
[INFO] Cluster 14 cluster: Short SMA=32, Long SMA=282, Sharpe=-0.1424, Trades=13
[INFO] Cluster 15 cluster: Short SMA=48, Long SMA=214, Sharpe=0.0939, Trades=11
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=126, Long SMA=144, Sharpe=0.6278, Trades=23
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=130, Long SMA=140, Sharpe=0.3870, Trades=33
[INFO] Top 2: Short SMA=24, Long SMA=214, Sharpe=0.3429, Trades=13
[INFO] Top 3: Short SMA=78, Long SMA=140, Sharpe=0.2900, Trades=15
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 1667 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 126, Long SMA: 144
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(130/140) - Original Sharpe: 0.3870, Trades: 33
[INFO] Hierarchical cluster 2: SMA(24/214) - Original Sharpe: 0.3429, Trades: 13
[INFO] Hierarchical cluster 3: SMA(78/140) - Original Sharpe: 0.2900, Trades: 15
[INFO] Hierarchical cluster 4: SMA(138/140) - Original Sharpe: 0.2149, Trades: 65
[INFO] Hierarchical cluster 5: SMA(52/158) - Original Sharpe: 0.1963, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (126/144)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (130/140) - Sharpe: 0.3870
[INFO] cluster 2: (24/214) - Sharpe: 0.3429
[INFO] cluster 3: (78/140) - Sharpe: 0.2900
[INFO] Loading KC data from local files...
[INFO] Found data file: A_OHLCV_@KC_minutes_1440_0420-1325.dat
[INFO] File size: 290825 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     1.943138            1.943138
1    2021-11-10 2021-11-10            41     2.726433            2.726433
2    2022-01-10 2022-01-10            41    -0.979722           -0.979722
3    2022-03-10 2022-03-10            42    -1.932434           -1.932434
4    2022-05-10 2022-05-10            41     2.781394            1.334212
5    2022-07-10 2022-07-10            44    -0.902683           -2.175052
6    2022-09-10 2022-09-10            43     4.781663            4.356320
7    2022-11-10 2022-11-10            40     0.520961            0.012661
8    2023-01-10 2023-01-10            41    -1.945501           -1.945501
9    2023-03-10 2023-03-10            42    -1.386296           -1.800994
10   2023-05-10 2023-05-10            40    -1.725343           -1.588781
11   2023-07-10 2023-07-10            44     0.054587            2.057976
12   2023-09-10 2023-09-10            44    -3.556132           -3.556132
13   2023-11-10 2023-11-10            40    -1.024655           -0.625287
14   2024-01-10 2024-01-10            41     1.405934            0.617414
15   2024-03-10 2024-03-10            43     1.924896            1.924896
16   2024-05-10 2024-05-10            40     2.925387            2.925387
17   2024-07-10 2024-07-10            43     0.254368            0.254368
18   2024-09-10 2024-09-10            44     0.943102            0.943102
19   2024-11-10 2024-11-10            35     5.162860            5.162860
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2021-11-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-01-10   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-05-10   |          2.8 |              1.3 |         -1.5 | False         
[INFO] 2022-07-10   |         -0.9 |             -2.2 |         -1.3 | False         
[INFO] 2022-09-10   |          4.8 |              4.4 |         -0.4 | False         
[INFO] 2022-11-10   |          0.5 |              0.0 |         -0.5 | False         
[INFO] 2023-01-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -1.4 |             -1.8 |         -0.4 | False         
[INFO] 2023-05-10   |         -1.7 |             -1.6 |          0.1 | True          
[INFO] 2023-07-10   |          0.1 |              2.1 |          2.0 | True          
[INFO] 2023-09-10   |         -3.6 |             -3.6 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -1.0 |             -0.6 |          0.4 | True          
[INFO] 2024-01-10   |          1.4 |              0.6 |         -0.8 | False         
[INFO] 2024-03-10   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2024-11-10   |          5.2 |              5.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2023-01-10, 2023-09-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Hierarchical cluster wins (rounded comparison): 3 of 9 periods (33.33% win rate)
[INFO] Updating Excel file with Hierarchical results for KC...
[INFO] Excel file updated successfully. Added KC with Hierarchical win rate 33.3% in row 27
[INFO] Added best Sharpe parameters 126/144 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 126, Long SMA: 144
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(130/140) - Original Sharpe: 0.3870
[INFO] Added cluster 2 to portfolio: SMA(24/214) - Original Sharpe: 0.3429
[INFO] Added cluster 3 to portfolio: SMA(78/140) - Original Sharpe: 0.2900
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.5015
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6577
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for KC...
[INFO] Excel file updated successfully. Added KC with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KC
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for KW in column D: 18.0
[INFO] Using slippage from Excel column D: 18.0
[INFO] 
Symbol: @KW
[INFO] Description: Hard Red Winter Wheat Continuous Contract [May25]
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 12.5
[INFO] Big point value: 50.0
[INFO] Data shape: (4266, 6)
[INFO] Date range: 2008-04-30 13:13:00 to 2025-04-07 13:13:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime     open    high      low    close  volume
0 2008-04-30 13:13:00  1701.25  1706.5  1690.50  1694.25  3923.0
1 2008-05-01 13:13:00  1698.00  1703.0  1679.75  1688.25  4981.0
2 2008-05-02 13:13:00  1696.75  1715.0  1692.50  1711.00  3330.0
3 2008-05-05 13:13:00  1721.25  1728.0  1698.00  1707.50  4144.0
4 2008-05-06 13:13:00  1704.00  1733.5  1704.00  1718.00  4802.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 18.33 seconds (0.31 minutes)
[INFO] Best parameters found: Short SMA = 288, Long SMA = 292
[INFO] Best fitness (Sharpe ratio): 0.591743
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 288, Long SMA = 292, Sharpe = 0.591743
[INFO] Top 2: Short SMA = 286, Long SMA = 292, Sharpe = 0.562476
[INFO] Top 3: Short SMA = 284, Long SMA = 294, Sharpe = 0.559460
[INFO] Top 4: Short SMA = 214, Long SMA = 236, Sharpe = 0.542458
[INFO] Top 5: Short SMA = 216, Long SMA = 236, Sharpe = 0.536235
[INFO] Hall of Fame size: 1692
[INFO] Number of elements in all_results: 935
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 757 had penalty fitness
[INFO] Total filtered from Hall of Fame: 757
[INFO] Hall of Fame -> all_results: 1692 -> 935
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 935 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @KW
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.20 contracts
[INFO] Maximum Position Size: 19 contracts
[INFO] Strategy Total P&L: $238,450.00
[INFO] Market Buy & Hold P&L: $-29,750.00
[INFO] Outperformance: $268,200.00
[INFO] Sharpe ratio (entire period, annualized): 0.178778
[INFO] Sharpe ratio (in-sample, annualized): 0.263154
[INFO] Sharpe ratio (out-of-sample, annualized): -0.007878
[INFO] Maximum Drawdown: $297,312.50
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $135,837.50
[INFO] Out-of-sample P&L: $-1,837.50
[INFO] 
Best parameters from GA: Short SMA = 288, Long SMA = 292, Sharpe = 0.591743
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 1692
[INFO] Cache hits (repeated combinations): 6994
[INFO] Total checks: 8686
[INFO] Cache hit rate: 80.52%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 50.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 935 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.8349 to 0.5917
[INFO] 
Best parameters:
[INFO] Short SMA: 288
[INFO] Long SMA: 292
[INFO] Sharpe Ratio: 0.591743
[INFO] Number of Trades: 21
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 935 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.8349 to 0.5917
[INFO] Trades range: 10.0 to 117.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.4141 to 1.6634
[INFO] Scaled Long SMA range: -2.7900 to 1.2104
[INFO] Scaled Sharpe ratio range: -3.1450 to 2.3709
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 66 elements
[INFO] Kmeans Cluster 1: 104 elements
[INFO] Kmeans Cluster 2: 23 elements
[INFO] Kmeans Cluster 3: 41 elements
[INFO] Kmeans Cluster 4: 58 elements
[INFO] Kmeans Cluster 5: 50 elements
[INFO] Kmeans Cluster 6: 50 elements
[INFO] Kmeans Cluster 7: 28 elements
[INFO] Kmeans Cluster 8: 55 elements
[INFO] Kmeans Cluster 9: 96 elements
[INFO] Kmeans Cluster 10: 48 elements
[INFO] Kmeans Cluster 11: 50 elements
[INFO] Kmeans Cluster 12: 26 elements
[INFO] Kmeans Cluster 13: 139 elements
[INFO] Kmeans Cluster 14: 75 elements
[INFO] Kmeans Cluster 15: 26 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=276.30, Long SMA=289.42, Sharpe=0.4189
[INFO] Centroid 1: Short SMA=164.63, Long SMA=215.88, Sharpe=-0.0682
[INFO] Centroid 2: Short SMA=40.00, Long SMA=88.00, Sharpe=-0.6066
[INFO] Centroid 3: Short SMA=28.39, Long SMA=270.93, Sharpe=-0.3572
[INFO] Centroid 4: Short SMA=139.97, Long SMA=174.69, Sharpe=-0.1159
[INFO] Centroid 5: Short SMA=72.88, Long SMA=125.40, Sharpe=-0.1341
[INFO] Centroid 6: Short SMA=231.08, Long SMA=255.96, Sharpe=0.0198
[INFO] Centroid 7: Short SMA=28.64, Long SMA=223.14, Sharpe=-0.0493
[INFO] Centroid 8: Short SMA=44.58, Long SMA=189.38, Sharpe=-0.2343
[INFO] Centroid 9: Short SMA=196.50, Long SMA=232.33, Sharpe=0.2287
[INFO] Centroid 10: Short SMA=128.96, Long SMA=157.92, Sharpe=0.0980
[INFO] Centroid 11: Short SMA=54.44, Long SMA=95.84, Sharpe=-0.3471
[INFO] Centroid 12: Short SMA=19.85, Long SMA=51.31, Sharpe=-0.1190
[INFO] Centroid 13: Short SMA=266.60, Long SMA=284.00, Sharpe=0.2366
[INFO] Centroid 14: Short SMA=36.48, Long SMA=290.91, Sharpe=-0.1669
[INFO] Centroid 15: Short SMA=37.85, Long SMA=153.85, Sharpe=-0.4581
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=288, Long SMA=292, Sharpe=0.5917, Trades=21
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=282, Long SMA=294, Sharpe=0.4590, Trades=13
[INFO] Kmeans Top 2: Short SMA=196, Long SMA=232, Sharpe=0.3031, Trades=13
[INFO] Kmeans Top 3: Short SMA=268, Long SMA=284, Sharpe=0.2203, Trades=13
[INFO] Kmeans Top 4: Short SMA=128, Long SMA=158, Sharpe=-0.0022, Trades=13
[INFO] Kmeans Top 5: Short SMA=20, Long SMA=48, Sharpe=-0.0307, Trades=43
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (276, 289)
[INFO]   Nearest: (276.0, 290.0)
[INFO]   Rounded: (165, 216)
[INFO]   Nearest: (164.0, 216.0)
[INFO]   Rounded: (40, 88)
[INFO]   Nearest: (40.0, 86.0)
[INFO]   Rounded: (28, 271)
[INFO]   Nearest: (28.0, 270.0)
[INFO]   Rounded: (140, 175)
[INFO]   Nearest: (140.0, 174.0)
[INFO]   Rounded: (73, 125)
[INFO]   Nearest: (72.0, 126.0)
[INFO]   Rounded: (231, 256)
[INFO]   Nearest: (232.0, 256.0)
[INFO]   Rounded: (29, 223)
[INFO]   Nearest: (28.0, 224.0)
[INFO]   Rounded: (45, 189)
[INFO]   Nearest: (44.0, 190.0)
[INFO]   Rounded: (196, 232)
[INFO]   Rounded: (129, 158)
[INFO]   Nearest: (128.0, 158.0)
[INFO]   Rounded: (54, 96)
[INFO]   Rounded: (20, 51)
[INFO]   Nearest: (20.0, 52.0)
[INFO]   Rounded: (267, 284)
[INFO]   Nearest: (266.0, 284.0)
[INFO]   Rounded: (36, 291)
[INFO]   Nearest: (36.0, 290.0)
[INFO]   Rounded: (38, 154)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 288, Long SMA: 292
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(282/294) - Original Sharpe: 0.4590, Trades: 13
[INFO] Kmeans cluster 2: SMA(196/232) - Original Sharpe: 0.3031, Trades: 13
[INFO] Kmeans cluster 3: SMA(268/284) - Original Sharpe: 0.2203, Trades: 13
[INFO] Kmeans cluster 4: SMA(128/158) - Original Sharpe: -0.0022, Trades: 13
[INFO] Kmeans cluster 5: SMA(20/48) - Original Sharpe: -0.0307, Trades: 43
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (288/292)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (282/294) - Sharpe: 0.4590
[INFO] cluster 2: (196/232) - Sharpe: 0.3031
[INFO] cluster 3: (268/284) - Sharpe: 0.2203
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     3.716844            3.716844
1    2021-11-10 2021-11-10            41    -0.412472           -0.412472
2    2022-01-10 2022-01-10            41     4.290205            4.290205
3    2022-03-10 2022-03-10            42     0.696473            0.696473
4    2022-05-10 2022-05-10            41    -1.906913           -1.906913
5    2022-07-10 2022-07-10            44     0.008064            0.008064
6    2022-09-10 2022-09-10            43     0.059045            0.059045
7    2022-11-10 2022-11-10            40    -2.768953           -2.526150
8    2023-01-10 2023-01-10            41    -1.377169           -1.377169
9    2023-03-10 2023-03-10            42     0.957570            1.480146
10   2023-05-10 2023-05-10            40     0.600971            0.554330
11   2023-07-10 2023-07-10            44     1.428122            1.127946
12   2023-09-10 2023-09-10            44    -0.412801            1.938551
13   2023-11-10 2023-11-10            40     0.817504            0.817504
14   2024-01-10 2024-01-10            41     1.290468            1.290468
15   2024-03-10 2024-03-10            43    -2.221917           -2.221917
16   2024-05-10 2024-05-10            40     2.247863            2.247863
17   2024-07-10 2024-07-10            43     0.009942            0.009942
18   2024-09-10 2024-09-10            44     0.461751            0.461751
19   2024-11-10 2024-11-10            35     0.788268            0.788268
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2022-01-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-03-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-10   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-11-10   |         -2.8 |             -2.5 |          0.3 | True          
[INFO] 2023-01-10   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2023-03-10   |          1.0 |              1.5 |          0.5 | True          
[INFO] 2023-05-10   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-07-10   |          1.4 |              1.1 |         -0.3 | False         
[INFO] 2023-09-10   |         -0.4 |              1.9 |          2.3 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2024-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2022-05-10, 2022-07-10, 2022-09-10, 2023-01-10, 2023-05-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 4
[INFO] Kmeans cluster wins (rounded comparison): 3 of 4 periods (75.00% win rate)
[INFO] Updating Excel file with Kmeans results for KW...
[INFO] Excel file updated successfully. Added KW with Kmeans win rate 75.0% in row 28
[INFO] Added best Sharpe parameters 288/292 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 288, Long SMA: 292
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(282/294) - Original Sharpe: 0.4590
[INFO] Added cluster 2 to portfolio: SMA(196/232) - Original Sharpe: 0.3031
[INFO] Added cluster 3 to portfolio: SMA(268/284) - Original Sharpe: 0.2203
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KW_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.7058
[INFO] Kmeans Best out-of-sample Sharpe: 0.5555
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for KW...
[INFO] Excel file updated successfully. Added KW with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KW
[INFO] Big Point Value: 50.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 935 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.8349 to 0.5917
[INFO] 
Best parameters:
[INFO] Short SMA: 288
[INFO] Long SMA: 292
[INFO] Sharpe Ratio: 0.591743
[INFO] Number of Trades: 21
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 935 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.8349 to 0.5917
[INFO] Trades range: 10.0 to 117.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.4141 to 1.6634
[INFO] Scaled Long SMA range: -2.7900 to 1.2104
[INFO] Scaled Sharpe ratio range: -3.1450 to 2.3709
[INFO] Scaled Trades range: -0.7524 to 9.2175
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 935
[INFO] Cophenetic correlation: 0.5759
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 169 elements
[INFO] Cluster 1: 102 elements
[INFO] Cluster 2: 38 elements
[INFO] Cluster 3: 59 elements
[INFO] Cluster 4: 21 elements
[INFO] Cluster 5: 100 elements
[INFO] Cluster 6: 22 elements
[INFO] Cluster 7: 4 elements
[INFO] Cluster 8: 112 elements
[INFO] Cluster 9: 35 elements
[INFO] Cluster 10: 33 elements
[INFO] Cluster 11: 62 elements
[INFO] Cluster 12: 42 elements
[INFO] Cluster 13: 21 elements
[INFO] Cluster 14: 43 elements
[INFO] Cluster 15: 38 elements
[INFO] Cluster 16: 34 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=270, Long SMA=288, Sharpe=0.3289, Trades=15
[INFO] Cluster 1 cluster: Short SMA=196, Long SMA=232, Sharpe=0.3031, Trades=13
[INFO] Cluster 2 cluster: Short SMA=124, Long SMA=146, Sharpe=0.0903, Trades=23
[INFO] Cluster 3 cluster: Short SMA=50, Long SMA=126, Sharpe=-0.3462, Trades=19
[INFO] Cluster 4 cluster: Short SMA=150, Long SMA=154, Sharpe=0.1344, Trades=39
[INFO] Cluster 5 cluster: Short SMA=34, Long SMA=292, Sharpe=-0.3687, Trades=15
[INFO] Cluster 6 cluster: Short SMA=22, Long SMA=44, Sharpe=-0.0448, Trades=51
[INFO] Cluster 8 cluster: Short SMA=150, Long SMA=208, Sharpe=-0.1500, Trades=11
[INFO] Cluster 9 cluster: Short SMA=20, Long SMA=214, Sharpe=-0.1100, Trades=17
[INFO] Cluster 10 cluster: Short SMA=278, Long SMA=280, Sharpe=0.1142, Trades=25
[INFO] Cluster 11 cluster: Short SMA=74, Long SMA=162, Sharpe=-0.0377, Trades=11
[INFO] Cluster 12 cluster: Short SMA=42, Long SMA=94, Sharpe=-0.3864, Trades=27
[INFO] Cluster 13 cluster: Short SMA=36, Long SMA=60, Sharpe=-0.3690, Trades=37
[INFO] Cluster 14 cluster: Short SMA=186, Long SMA=202, Sharpe=0.0539, Trades=21
[INFO] Cluster 15 cluster: Short SMA=236, Long SMA=256, Sharpe=0.0743, Trades=11
[INFO] Cluster 16 cluster: Short SMA=34, Long SMA=230, Sharpe=-0.3248, Trades=11
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=288, Long SMA=292, Sharpe=0.5917, Trades=21
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=270, Long SMA=288, Sharpe=0.3289, Trades=15
[INFO] Top 2: Short SMA=196, Long SMA=232, Sharpe=0.3031, Trades=13
[INFO] Top 3: Short SMA=150, Long SMA=154, Sharpe=0.1344, Trades=39
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 931 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 288, Long SMA: 292
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(270/288) - Original Sharpe: 0.3289, Trades: 15
[INFO] Hierarchical cluster 2: SMA(196/232) - Original Sharpe: 0.3031, Trades: 13
[INFO] Hierarchical cluster 3: SMA(150/154) - Original Sharpe: 0.1344, Trades: 39
[INFO] Hierarchical cluster 4: SMA(278/280) - Original Sharpe: 0.1142, Trades: 25
[INFO] Hierarchical cluster 5: SMA(124/146) - Original Sharpe: 0.0903, Trades: 23
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (288/292)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (270/288) - Sharpe: 0.3289
[INFO] cluster 2: (196/232) - Sharpe: 0.3031
[INFO] Loading KW data from local files...
[INFO] Found data file: A_OHLCV_@KW_minutes_1440_1903-1313.dat
[INFO] File size: 204917 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43     3.716844            3.716844
1    2021-11-10 2021-11-10            41    -0.412472           -0.412472
2    2022-01-10 2022-01-10            41     4.290205            4.290205
3    2022-03-10 2022-03-10            42     0.696473            0.696473
4    2022-05-10 2022-05-10            41    -1.906913           -1.906913
5    2022-07-10 2022-07-10            44     0.008064            0.008064
6    2022-09-10 2022-09-10            43     0.059045            0.059045
7    2022-11-10 2022-11-10            40    -2.768953           -2.399368
8    2023-01-10 2023-01-10            41    -1.377169            0.000000
9    2023-03-10 2023-03-10            42     0.957570            0.376990
10   2023-05-10 2023-05-10            40     0.600971            0.467977
11   2023-07-10 2023-07-10            44     1.428122            1.248651
12   2023-09-10 2023-09-10            44    -0.412801            1.808262
13   2023-11-10 2023-11-10            40     0.817504            0.817504
14   2024-01-10 2024-01-10            41     1.290468            1.290468
15   2024-03-10 2024-03-10            43    -2.221917           -2.221917
16   2024-05-10 2024-05-10            40     2.247863            2.247863
17   2024-07-10 2024-07-10            43     0.009942            0.009942
18   2024-09-10 2024-09-10            44     0.461751            0.461751
19   2024-11-10 2024-11-10            35     0.788268            0.788268
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |          3.7 |              3.7 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2022-01-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2022-03-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2022-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-10   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-11-10   |         -2.8 |             -2.4 |          0.4 | True          
[INFO] 2023-01-10   |         -1.4 |              0.0 |          1.4 | True          
[INFO] 2023-03-10   |          1.0 |              0.4 |         -0.6 | False         
[INFO] 2023-05-10   |          0.6 |              0.5 |         -0.1 | False         
[INFO] 2023-07-10   |          1.4 |              1.2 |         -0.2 | False         
[INFO] 2023-09-10   |         -0.4 |              1.8 |          2.2 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2024-03-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-05-10   |          2.2 |              2.2 |          0.0 | Excluded      
[INFO] 2024-07-10   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-09-10   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2024-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-03-10, 2022-05-10, 2022-07-10, 2022-09-10, 2023-11-10, 2024-01-10, 2024-03-10, 2024-05-10, 2024-07-10, 2024-09-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 6
[INFO] Hierarchical cluster wins (rounded comparison): 3 of 6 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for KW...
[INFO] Excel file updated successfully. Added KW with Hierarchical win rate 50.0% in row 28
[INFO] Added best Sharpe parameters 288/292 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 288, Long SMA: 292
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(270/288) - Original Sharpe: 0.3289
[INFO] Added cluster 2 to portfolio: SMA(196/232) - Original Sharpe: 0.3031
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'KW_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.6982
[INFO] Hierarchical Best out-of-sample Sharpe: 0.5555
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for KW...
[INFO] Excel file updated successfully. Added KW with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\KW
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LC in column D: 13.0
[INFO] Using slippage from Excel column D: 13.0
[INFO] 
Symbol: @LC
[INFO] Description: Live Cattle Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 400.0
[INFO] Data shape: (5083, 6)
[INFO] Date range: 2005-01-27 13:01:00 to 2025-04-07 13:01:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open     high      low    close  volume
0 2005-01-27 13:01:00  167.35  167.800  167.200  167.600    38.0
1 2005-01-28 13:01:00  167.85  168.400  167.400  167.975   201.0
2 2005-01-31 13:01:00  167.65  168.275  167.400  168.225   191.0
3 2005-02-01 13:01:00  168.75  168.750  168.175  168.650   153.0
4 2005-02-02 13:01:00  168.45  168.825  168.300  168.300    98.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 29.41 seconds (0.49 minutes)
[INFO] Best parameters found: Short SMA = 146, Long SMA = 222
[INFO] Best fitness (Sharpe ratio): 0.618331
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 146, Long SMA = 222, Sharpe = 0.618331
[INFO] Top 2: Short SMA = 20, Long SMA = 80, Sharpe = 0.609508
[INFO] Top 3: Short SMA = 148, Long SMA = 220, Sharpe = 0.606663
[INFO] Top 4: Short SMA = 146, Long SMA = 220, Sharpe = 0.599377
[INFO] Top 5: Short SMA = 214, Long SMA = 216, Sharpe = 0.574216
[INFO] Hall of Fame size: 2667
[INFO] Number of elements in all_results: 2255
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 412 had penalty fitness
[INFO] Total filtered from Hall of Fame: 412
[INFO] Hall of Fame -> all_results: 2667 -> 2255
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2255 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LC
[INFO] Big Point Value (from data): 400.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.44 contracts
[INFO] Maximum Position Size: 19 contracts
[INFO] Strategy Total P&L: $-236,060.00
[INFO] Market Buy & Hold P&L: $19,030.00
[INFO] Outperformance: $-255,090.00
[INFO] Sharpe ratio (entire period, annualized): -0.288498
[INFO] Sharpe ratio (in-sample, annualized): -0.068886
[INFO] Sharpe ratio (out-of-sample, annualized): -0.807225
[INFO] Maximum Drawdown: $241,280.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-38,620.00
[INFO] Out-of-sample P&L: $-191,620.00
[INFO] 
Best parameters from GA: Short SMA = 146, Long SMA = 222, Sharpe = 0.618331
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2667
[INFO] Cache hits (repeated combinations): 6061
[INFO] Total checks: 8728
[INFO] Cache hit rate: 69.44%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 400.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2255 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 18 to 300
[INFO] Sharpe ratio range: -0.7424 to 0.6183
[INFO] 
Best parameters:
[INFO] Short SMA: 146
[INFO] Long SMA: 222
[INFO] Sharpe Ratio: 0.618331
[INFO] Number of Trades: 17
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2255 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 18.0 to 300.0
[INFO] Sharpe ratio range: -0.7424 to 0.6183
[INFO] Trades range: 10.0 to 210.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3611 to 2.4767
[INFO] Scaled Long SMA range: -2.9052 to 1.6258
[INFO] Scaled Sharpe ratio range: -2.8690 to 2.5556
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 126 elements
[INFO] Kmeans Cluster 1: 146 elements
[INFO] Kmeans Cluster 2: 151 elements
[INFO] Kmeans Cluster 3: 73 elements
[INFO] Kmeans Cluster 4: 184 elements
[INFO] Kmeans Cluster 5: 93 elements
[INFO] Kmeans Cluster 6: 169 elements
[INFO] Kmeans Cluster 7: 158 elements
[INFO] Kmeans Cluster 8: 115 elements
[INFO] Kmeans Cluster 9: 100 elements
[INFO] Kmeans Cluster 10: 206 elements
[INFO] Kmeans Cluster 11: 58 elements
[INFO] Kmeans Cluster 12: 162 elements
[INFO] Kmeans Cluster 13: 117 elements
[INFO] Kmeans Cluster 14: 124 elements
[INFO] Kmeans Cluster 15: 114 elements
[INFO] Kmeans Cluster 16: 159 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=161.63, Long SMA=218.43, Sharpe=0.4149
[INFO] Centroid 1: Short SMA=37.60, Long SMA=246.03, Sharpe=0.0233
[INFO] Centroid 2: Short SMA=46.69, Long SMA=175.38, Sharpe=-0.2449
[INFO] Centroid 3: Short SMA=201.37, Long SMA=237.56, Sharpe=-0.0961
[INFO] Centroid 4: Short SMA=239.78, Long SMA=272.53, Sharpe=-0.4716
[INFO] Centroid 5: Short SMA=33.44, Long SMA=61.85, Sharpe=0.1241
[INFO] Centroid 6: Short SMA=23.49, Long SMA=202.78, Sharpe=-0.0475
[INFO] Centroid 7: Short SMA=147.14, Long SMA=181.52, Sharpe=0.2557
[INFO] Centroid 8: Short SMA=60.38, Long SMA=286.19, Sharpe=-0.2158
[INFO] Centroid 9: Short SMA=97.03, Long SMA=148.83, Sharpe=-0.3358
[INFO] Centroid 10: Short SMA=183.20, Long SMA=218.69, Sharpe=0.1438
[INFO] Centroid 11: Short SMA=277.76, Long SMA=286.52, Sharpe=-0.2051
[INFO] Centroid 12: Short SMA=141.49, Long SMA=177.32, Sharpe=-0.0483
[INFO] Centroid 13: Short SMA=58.96, Long SMA=110.65, Sharpe=-0.0819
[INFO] Centroid 14: Short SMA=27.34, Long SMA=78.24, Sharpe=0.3600
[INFO] Centroid 15: Short SMA=114.68, Long SMA=243.96, Sharpe=0.1169
[INFO] Centroid 16: Short SMA=87.94, Long SMA=211.67, Sharpe=-0.1233
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=146, Long SMA=222, Sharpe=0.6183, Trades=17
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=26, Long SMA=80, Sharpe=0.5017, Trades=22
[INFO] Kmeans Top 2: Short SMA=154, Long SMA=222, Sharpe=0.3589, Trades=13
[INFO] Kmeans Top 3: Short SMA=150, Long SMA=182, Sharpe=0.3062, Trades=21
[INFO] Kmeans Top 4: Short SMA=184, Long SMA=218, Sharpe=0.2257, Trades=19
[INFO] Kmeans Top 5: Short SMA=30, Long SMA=56, Sharpe=0.1995, Trades=35
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (162, 218)
[INFO]   Rounded: (38, 246)
[INFO]   Rounded: (47, 175)
[INFO]   Nearest: (46.0, 176.0)
[INFO]   Rounded: (201, 238)
[INFO]   Nearest: (202.0, 238.0)
[INFO]   Rounded: (240, 273)
[INFO]   Nearest: (240.0, 272.0)
[INFO]   Rounded: (33, 62)
[INFO]   Nearest: (34.0, 62.0)
[INFO]   Rounded: (23, 203)
[INFO]   Nearest: (24.0, 202.0)
[INFO]   Rounded: (147, 182)
[INFO]   Nearest: (148.0, 182.0)
[INFO]   Rounded: (60, 286)
[INFO]   Rounded: (97, 149)
[INFO]   Nearest: (98.0, 148.0)
[INFO]   Rounded: (183, 219)
[INFO]   Nearest: (184.0, 218.0)
[INFO]   Rounded: (278, 287)
[INFO]   Nearest: (278.0, 286.0)
[INFO]   Rounded: (141, 177)
[INFO]   Nearest: (142.0, 178.0)
[INFO]   Rounded: (59, 111)
[INFO]   Nearest: (58.0, 110.0)
[INFO]   Rounded: (27, 78)
[INFO]   Nearest: (28.0, 78.0)
[INFO]   Rounded: (115, 244)
[INFO]   Nearest: (114.0, 244.0)
[INFO]   Rounded: (88, 212)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 146, Long SMA: 222
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(26/80) - Original Sharpe: 0.5017, Trades: 22
[INFO] Kmeans cluster 2: SMA(154/222) - Original Sharpe: 0.3589, Trades: 13
[INFO] Kmeans cluster 3: SMA(150/182) - Original Sharpe: 0.3062, Trades: 21
[INFO] Kmeans cluster 4: SMA(184/218) - Original Sharpe: 0.2257, Trades: 19
[INFO] Kmeans cluster 5: SMA(30/56) - Original Sharpe: 0.1995, Trades: 35
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (146/222)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (26/80) - Sharpe: 0.5017
[INFO] cluster 2: (154/222) - Sharpe: 0.3589
[INFO] cluster 3: (150/182) - Sharpe: 0.3062
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.063439           -1.402009
1    2021-11-10 2021-11-10            41    -1.314198           -1.716433
2    2022-01-10 2022-01-10            41    -1.538577           -1.497511
3    2022-03-10 2022-03-10            42    -0.325669            1.031527
4    2022-05-10 2022-05-10            41     0.167451            0.167451
5    2022-07-10 2022-07-10            44     0.646726            1.566453
6    2022-09-10 2022-09-10            43    -0.837964           -0.853697
7    2022-11-10 2022-11-10            40    -0.155620            1.541934
8    2023-01-10 2023-01-10            41     1.733004            1.733004
9    2023-03-10 2023-03-10            42     1.762416            1.762416
10   2023-05-10 2023-05-10            40     4.337990            4.337990
11   2023-07-10 2023-07-10            44     1.358879            1.358879
12   2023-09-10 2023-09-10            44    -2.443328           -1.692257
13   2023-11-10 2023-11-10            40    -0.939135           -0.939135
14   2024-01-10 2024-01-10            41     4.199481            3.310826
15   2024-03-10 2024-03-10            43     1.581299            0.151388
16   2024-05-10 2024-05-10            40    -2.345527           -2.711415
17   2024-07-10 2024-07-10            43    -3.145789           -2.915979
18   2024-09-10 2024-09-10            44     1.583600           -0.581186
19   2024-11-10 2024-11-10            35     2.423431            2.423431
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.1 |             -1.4 |         -0.3 | False         
[INFO] 2021-11-10   |         -1.3 |             -1.7 |         -0.4 | False         
[INFO] 2022-01-10   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -0.3 |              1.0 |          1.3 | True          
[INFO] 2022-05-10   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2022-07-10   |          0.6 |              1.6 |          1.0 | True          
[INFO] 2022-09-10   |         -0.8 |             -0.9 |         -0.1 | False         
[INFO] 2022-11-10   |         -0.2 |              1.5 |          1.7 | True          
[INFO] 2023-01-10   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-10   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2023-05-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2023-07-10   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-09-10   |         -2.4 |             -1.7 |          0.7 | True          
[INFO] 2023-11-10   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-01-10   |          4.2 |              3.3 |         -0.9 | False         
[INFO] 2024-03-10   |          1.6 |              0.2 |         -1.4 | False         
[INFO] 2024-05-10   |         -2.3 |             -2.7 |         -0.4 | False         
[INFO] 2024-07-10   |         -3.1 |             -2.9 |          0.2 | True          
[INFO] 2024-09-10   |          1.6 |             -0.6 |         -2.2 | False         
[INFO] 2024-11-10   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-10, 2022-05-10, 2023-01-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-11-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 5 of 12 periods (41.67% win rate)
[INFO] Updating Excel file with Kmeans results for LC...
[INFO] Excel file updated successfully. Added LC with Kmeans win rate 41.7% in row 29
[INFO] Added best Sharpe parameters 146/222 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 146, Long SMA: 222
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(26/80) - Original Sharpe: 0.5017
[INFO] Added cluster 2 to portfolio: SMA(154/222) - Original Sharpe: 0.3589
[INFO] Added cluster 3 to portfolio: SMA(150/182) - Original Sharpe: 0.3062
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LC_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3269
[INFO] Kmeans Best out-of-sample Sharpe: 0.2112
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for LC...
[INFO] Excel file updated successfully. Added LC with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LC
[INFO] Big Point Value: 400.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2255 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 18 to 300
[INFO] Sharpe ratio range: -0.7424 to 0.6183
[INFO] 
Best parameters:
[INFO] Short SMA: 146
[INFO] Long SMA: 222
[INFO] Sharpe Ratio: 0.618331
[INFO] Number of Trades: 17
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2255 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 18.0 to 300.0
[INFO] Sharpe ratio range: -0.7424 to 0.6183
[INFO] Trades range: 10.0 to 210.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3611 to 2.4767
[INFO] Scaled Long SMA range: -2.9052 to 1.6258
[INFO] Scaled Sharpe ratio range: -2.8690 to 2.5556
[INFO] Scaled Trades range: -0.7974 to 14.5049
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2255 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6022
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 212 elements
[INFO] Cluster 1: 164 elements
[INFO] Cluster 2: 202 elements
[INFO] Cluster 3: 222 elements
[INFO] Cluster 4: 244 elements
[INFO] Cluster 5: 195 elements
[INFO] Cluster 6: 85 elements
[INFO] Cluster 7: 142 elements
[INFO] Cluster 8: 128 elements
[INFO] Cluster 9: 16 elements
[INFO] Cluster 10: 205 elements
[INFO] Cluster 11: 45 elements
[INFO] Cluster 12: 96 elements
[INFO] Cluster 13: 207 elements
[INFO] Cluster 14: 48 elements
[INFO] Cluster 15: 3 elements
[INFO] Cluster 16: 41 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=150, Long SMA=202, Sharpe=0.3335, Trades=15
[INFO] Cluster 1 cluster: Short SMA=56, Long SMA=104, Sharpe=0.0468, Trades=18
[INFO] Cluster 2 cluster: Short SMA=98, Long SMA=246, Sharpe=0.1888, Trades=13
[INFO] Cluster 3 cluster: Short SMA=60, Long SMA=164, Sharpe=-0.2546, Trades=13
[INFO] Cluster 4 cluster: Short SMA=24, Long SMA=220, Sharpe=0.0334, Trades=17
[INFO] Cluster 5 cluster: Short SMA=242, Long SMA=274, Sharpe=-0.5199, Trades=14
[INFO] Cluster 6 cluster: Short SMA=184, Long SMA=188, Sharpe=-0.2335, Trades=49
[INFO] Cluster 7 cluster: Short SMA=154, Long SMA=190, Sharpe=0.1201, Trades=21
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=76, Sharpe=0.3389, Trades=26
[INFO] Cluster 10 cluster: Short SMA=172, Long SMA=222, Sharpe=0.1232, Trades=19
[INFO] Cluster 11 cluster: Short SMA=282, Long SMA=286, Sharpe=-0.3742, Trades=37
[INFO] Cluster 12 cluster: Short SMA=48, Long SMA=288, Sharpe=-0.3592, Trades=16
[INFO] Cluster 13 cluster: Short SMA=90, Long SMA=204, Sharpe=-0.1611, Trades=11
[INFO] Cluster 14 cluster: Short SMA=208, Long SMA=244, Sharpe=-0.2122, Trades=15
[INFO] Cluster 16 cluster: Short SMA=32, Long SMA=46, Sharpe=0.2096, Trades=53
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=146, Long SMA=222, Sharpe=0.6183, Trades=17
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=26, Long SMA=76, Sharpe=0.3389, Trades=26
[INFO] Top 2: Short SMA=150, Long SMA=202, Sharpe=0.3335, Trades=15
[INFO] Top 3: Short SMA=32, Long SMA=46, Sharpe=0.2096, Trades=53
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 2236 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 146, Long SMA: 222
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(26/76) - Original Sharpe: 0.3389, Trades: 26
[INFO] Hierarchical cluster 2: SMA(150/202) - Original Sharpe: 0.3335, Trades: 15
[INFO] Hierarchical cluster 3: SMA(32/46) - Original Sharpe: 0.2096, Trades: 53
[INFO] Hierarchical cluster 4: SMA(98/246) - Original Sharpe: 0.1888, Trades: 13
[INFO] Hierarchical cluster 5: SMA(172/222) - Original Sharpe: 0.1232, Trades: 19
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (146/222)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (26/76) - Sharpe: 0.3389
[INFO] cluster 2: (150/202) - Sharpe: 0.3335
[INFO] cluster 3: (32/46) - Sharpe: 0.2096
[INFO] Loading LC data from local files...
[INFO] Found data file: A_OHLCV_@LC_minutes_1440_0838-1301.dat
[INFO] File size: 244122 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -1.063439           -1.276650
1    2021-11-10 2021-11-10            41    -1.314198            0.489782
2    2022-01-10 2022-01-10            41    -1.538577           -2.601592
3    2022-03-10 2022-03-10            42    -0.325669            2.005941
4    2022-05-10 2022-05-10            41     0.167451           -1.124850
5    2022-07-10 2022-07-10            44     0.646726            1.607632
6    2022-09-10 2022-09-10            43    -0.837964           -0.318117
7    2022-11-10 2022-11-10            40    -0.155620            1.741396
8    2023-01-10 2023-01-10            41     1.733004            1.733004
9    2023-03-10 2023-03-10            42     1.762416            1.762416
10   2023-05-10 2023-05-10            40     4.337990            4.337990
11   2023-07-10 2023-07-10            44     1.358879            0.560481
12   2023-09-10 2023-09-10            44    -2.443328           -1.107477
13   2023-11-10 2023-11-10            40    -0.939135            0.939135
14   2024-01-10 2024-01-10            41     4.199481            0.227500
15   2024-03-10 2024-03-10            43     1.581299           -1.411854
16   2024-05-10 2024-05-10            40    -2.345527           -1.537199
17   2024-07-10 2024-07-10            43    -3.145789           -1.960814
18   2024-09-10 2024-09-10            44     1.583600           -3.431280
19   2024-11-10 2024-11-10            35     2.423431            3.078689
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -1.1 |             -1.3 |         -0.2 | False         
[INFO] 2021-11-10   |         -1.3 |              0.5 |          1.8 | True          
[INFO] 2022-01-10   |         -1.5 |             -2.6 |         -1.1 | False         
[INFO] 2022-03-10   |         -0.3 |              2.0 |          2.3 | True          
[INFO] 2022-05-10   |          0.2 |             -1.1 |         -1.3 | False         
[INFO] 2022-07-10   |          0.6 |              1.6 |          1.0 | True          
[INFO] 2022-09-10   |         -0.8 |             -0.3 |          0.5 | True          
[INFO] 2022-11-10   |         -0.2 |              1.7 |          1.9 | True          
[INFO] 2023-01-10   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-10   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2023-05-10   |          4.3 |              4.3 |          0.0 | Excluded      
[INFO] 2023-07-10   |          1.4 |              0.6 |         -0.8 | False         
[INFO] 2023-09-10   |         -2.4 |             -1.1 |          1.3 | True          
[INFO] 2023-11-10   |         -0.9 |              0.9 |          1.8 | True          
[INFO] 2024-01-10   |          4.2 |              0.2 |         -4.0 | False         
[INFO] 2024-03-10   |          1.6 |             -1.4 |         -3.0 | False         
[INFO] 2024-05-10   |         -2.3 |             -1.5 |          0.8 | True          
[INFO] 2024-07-10   |         -3.1 |             -2.0 |          1.1 | True          
[INFO] 2024-09-10   |          1.6 |             -3.4 |         -5.0 | False         
[INFO] 2024-11-10   |          2.4 |              3.1 |          0.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-01-10, 2023-03-10, 2023-05-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 17 periods (58.82% win rate)
[INFO] Updating Excel file with Hierarchical results for LC...
[INFO] Excel file updated successfully. Added LC with Hierarchical win rate 58.8% in row 29
[INFO] Added best Sharpe parameters 146/222 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 146, Long SMA: 222
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(26/76) - Original Sharpe: 0.3389
[INFO] Added cluster 2 to portfolio: SMA(150/202) - Original Sharpe: 0.3335
[INFO] Added cluster 3 to portfolio: SMA(32/46) - Original Sharpe: 0.2096
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LC_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2432
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2112
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for LC...
[INFO] Excel file updated successfully. Added LC with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LC
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LH in column D: 17.0
[INFO] Using slippage from Excel column D: 17.0
[INFO] 
Symbol: @LH
[INFO] Description: Lean Hogs Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 400.0
[INFO] Data shape: (5120, 6)
[INFO] Date range: 2004-10-11 13:01:00 to 2025-04-07 13:01:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime     open     high      low    close  volume
0 2004-10-11 13:01:00  193.105  193.105  193.105  193.105     1.0
1 2004-10-21 13:01:00  193.105  193.205  193.055  193.205    30.0
2 2004-10-22 13:01:00  193.155  193.405  192.855  193.005    68.0
3 2004-10-25 13:01:00  191.480  192.205  191.480  191.705   100.0
4 2004-10-26 13:01:00  192.630  193.055  192.580  192.580    70.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 22.92 seconds (0.38 minutes)
[INFO] Best parameters found: Short SMA = 20, Long SMA = 32
[INFO] Best fitness (Sharpe ratio): 1.091503
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 20, Long SMA = 32, Sharpe = 1.091503
[INFO] Top 2: Short SMA = 20, Long SMA = 34, Sharpe = 1.018216
[INFO] Top 3: Short SMA = 22, Long SMA = 30, Sharpe = 1.008217
[INFO] Top 4: Short SMA = 24, Long SMA = 28, Sharpe = 0.992413
[INFO] Top 5: Short SMA = 18, Long SMA = 32, Sharpe = 0.984775
[INFO] Hall of Fame size: 2571
[INFO] Number of elements in all_results: 2028
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 543 had penalty fitness
[INFO] Total filtered from Hall of Fame: 543
[INFO] Hall of Fame -> all_results: 2571 -> 2028
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2028 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LH
[INFO] Big Point Value (from data): 400.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.56 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $61,830.00
[INFO] Market Buy & Hold P&L: $-13,970.00
[INFO] Outperformance: $75,800.00
[INFO] Sharpe ratio (entire period, annualized): 0.054787
[INFO] Sharpe ratio (in-sample, annualized): 0.061993
[INFO] Sharpe ratio (out-of-sample, annualized): 0.037987
[INFO] Maximum Drawdown: $258,760.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $35,770.00
[INFO] Out-of-sample P&L: $9,420.00
[INFO] 
Best parameters from GA: Short SMA = 20, Long SMA = 32, Sharpe = 1.091503
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2571
[INFO] Cache hits (repeated combinations): 6119
[INFO] Total checks: 8690
[INFO] Cache hit rate: 70.41%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 400.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2028 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 20 to 300
[INFO] Sharpe ratio range: -0.7971 to 1.0915
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 32
[INFO] Sharpe Ratio: 1.091503
[INFO] Number of Trades: 65
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2028 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 20.0 to 300.0
[INFO] Sharpe ratio range: -0.7971 to 1.0915
[INFO] Trades range: 10.0 to 165.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1916 to 2.5289
[INFO] Scaled Long SMA range: -2.5845 to 1.7506
[INFO] Scaled Sharpe ratio range: -2.8360 to 2.5529
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 13
[INFO] Using 13 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=13...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 211 elements
[INFO] Kmeans Cluster 1: 113 elements
[INFO] Kmeans Cluster 2: 136 elements
[INFO] Kmeans Cluster 3: 163 elements
[INFO] Kmeans Cluster 4: 181 elements
[INFO] Kmeans Cluster 5: 102 elements
[INFO] Kmeans Cluster 6: 286 elements
[INFO] Kmeans Cluster 7: 104 elements
[INFO] Kmeans Cluster 8: 148 elements
[INFO] Kmeans Cluster 9: 221 elements
[INFO] Kmeans Cluster 10: 135 elements
[INFO] Kmeans Cluster 11: 90 elements
[INFO] Kmeans Cluster 12: 138 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=132.01, Long SMA=204.75, Sharpe=0.5798
[INFO] Centroid 1: Short SMA=67.22, Long SMA=101.35, Sharpe=-0.2641
[INFO] Centroid 2: Short SMA=16.40, Long SMA=154.06, Sharpe=0.3303
[INFO] Centroid 3: Short SMA=231.35, Long SMA=262.00, Sharpe=-0.2130
[INFO] Centroid 4: Short SMA=24.66, Long SMA=208.93, Sharpe=0.1523
[INFO] Centroid 5: Short SMA=268.29, Long SMA=289.04, Sharpe=-0.5098
[INFO] Centroid 6: Short SMA=125.85, Long SMA=159.05, Sharpe=0.5437
[INFO] Centroid 7: Short SMA=21.02, Long SMA=76.37, Sharpe=0.2147
[INFO] Centroid 8: Short SMA=54.73, Long SMA=163.55, Sharpe=-0.2272
[INFO] Centroid 9: Short SMA=169.83, Long SMA=210.35, Sharpe=0.2870
[INFO] Centroid 10: Short SMA=81.20, Long SMA=212.24, Sharpe=0.2859
[INFO] Centroid 11: Short SMA=19.36, Long SMA=37.27, Sharpe=0.6910
[INFO] Centroid 12: Short SMA=26.42, Long SMA=270.72, Sharpe=0.0875
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=32, Sharpe=1.0915, Trades=65
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=20, Long SMA=38, Sharpe=0.8175, Trades=50
[INFO] Kmeans Top 2: Short SMA=132, Long SMA=206, Sharpe=0.6484, Trades=10
[INFO] Kmeans Top 3: Short SMA=128, Long SMA=160, Sharpe=0.4182, Trades=16
[INFO] Kmeans Top 4: Short SMA=18, Long SMA=154, Sharpe=0.3473, Trades=15
[INFO] Kmeans Top 5: Short SMA=174, Long SMA=210, Sharpe=0.2316, Trades=16
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12}
[INFO]   Rounded: (132, 205)
[INFO]   Nearest: (132.0, 204.0)
[INFO]   Rounded: (67, 101)
[INFO]   Nearest: (68.0, 102.0)
[INFO]   Rounded: (16, 154)
[INFO]   Rounded: (231, 262)
[INFO]   Nearest: (232.0, 262.0)
[INFO]   Rounded: (25, 209)
[INFO]   Nearest: (24.0, 208.0)
[INFO]   Rounded: (268, 289)
[INFO]   Nearest: (268.0, 290.0)
[INFO]   Rounded: (126, 159)
[INFO]   Nearest: (126.0, 160.0)
[INFO]   Rounded: (21, 76)
[INFO]   Nearest: (22.0, 76.0)
[INFO]   Rounded: (55, 164)
[INFO]   Nearest: (54.0, 164.0)
[INFO]   Rounded: (170, 210)
[INFO]   Rounded: (81, 212)
[INFO]   Nearest: (82.0, 212.0)
[INFO]   Rounded: (19, 37)
[INFO]   Nearest: (20.0, 38.0)
[INFO]   Rounded: (26, 271)
[INFO]   Nearest: (26.0, 270.0)
[INFO] Successfully plotted 13 out of 13 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 32
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(20/38) - Original Sharpe: 0.8175, Trades: 50
[INFO] Kmeans cluster 2: SMA(132/206) - Original Sharpe: 0.6484, Trades: 10
[INFO] Kmeans cluster 3: SMA(128/160) - Original Sharpe: 0.4182, Trades: 16
[INFO] Kmeans cluster 4: SMA(18/154) - Original Sharpe: 0.3473, Trades: 15
[INFO] Kmeans cluster 5: SMA(174/210) - Original Sharpe: 0.2316, Trades: 16
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/32)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (20/38) - Sharpe: 0.8175
[INFO] cluster 2: (132/206) - Sharpe: 0.6484
[INFO] cluster 3: (128/160) - Sharpe: 0.4182
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -4.736305           -1.112549
1    2021-11-10 2021-11-10            41    -2.319258           -0.772960
2    2022-01-10 2022-01-10            41     3.633237           -3.633237
3    2022-03-10 2022-03-10            42     2.875093           -4.705543
4    2022-05-10 2022-05-10            41    -2.444707            1.173249
5    2022-07-10 2022-07-10            44    -0.429290            0.482906
6    2022-09-10 2022-09-10            43    -1.794548           -1.617883
7    2022-11-10 2022-11-10            40     1.185150           -1.962293
8    2023-01-10 2023-01-10            41     1.233131           -0.377776
9    2023-03-10 2023-03-10            42     0.538717            0.874634
10   2023-05-10 2023-05-10            40    -0.185962           -1.483471
11   2023-07-10 2023-07-10            44    -1.863091           -0.267219
12   2023-09-10 2023-09-10            44    -0.060196           -0.708703
13   2023-11-10 2023-11-10            40    -2.165690           -1.156968
14   2024-01-10 2024-01-10            41     1.763493            1.928310
15   2024-03-10 2024-03-10            43    -3.469850           -1.230488
16   2024-05-10 2024-05-10            40     3.837640            1.294009
17   2024-07-10 2024-07-10            43    -1.646846            0.808709
18   2024-09-10 2024-09-10            44     3.096245           -1.541880
19   2024-11-10 2024-11-10            35    -1.558146           -1.763288
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -4.7 |             -1.1 |          3.6 | True          
[INFO] 2021-11-10   |         -2.3 |             -0.8 |          1.5 | True          
[INFO] 2022-01-10   |          3.6 |             -3.6 |         -7.2 | False         
[INFO] 2022-03-10   |          2.9 |             -4.7 |         -7.6 | False         
[INFO] 2022-05-10   |         -2.4 |              1.2 |          3.6 | True          
[INFO] 2022-07-10   |         -0.4 |              0.5 |          0.9 | True          
[INFO] 2022-09-10   |         -1.8 |             -1.6 |          0.2 | True          
[INFO] 2022-11-10   |          1.2 |             -2.0 |         -3.2 | False         
[INFO] 2023-01-10   |          1.2 |             -0.4 |         -1.6 | False         
[INFO] 2023-03-10   |          0.5 |              0.9 |          0.4 | True          
[INFO] 2023-05-10   |         -0.2 |             -1.5 |         -1.3 | False         
[INFO] 2023-07-10   |         -1.9 |             -0.3 |          1.6 | True          
[INFO] 2023-09-10   |         -0.1 |             -0.7 |         -0.6 | False         
[INFO] 2023-11-10   |         -2.2 |             -1.2 |          1.0 | True          
[INFO] 2024-01-10   |          1.8 |              1.9 |          0.1 | True          
[INFO] 2024-03-10   |         -3.5 |             -1.2 |          2.3 | True          
[INFO] 2024-05-10   |          3.8 |              1.3 |         -2.5 | False         
[INFO] 2024-07-10   |         -1.6 |              0.8 |          2.4 | True          
[INFO] 2024-09-10   |          3.1 |             -1.5 |         -4.6 | False         
[INFO] 2024-11-10   |         -1.6 |             -1.8 |         -0.2 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 11 of 20 periods (55.00% win rate)
[INFO] Updating Excel file with Kmeans results for LH...
[INFO] Excel file updated successfully. Added LH with Kmeans win rate 55.0% in row 30
[INFO] Added best Sharpe parameters 20/32 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 32
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(20/38) - Original Sharpe: 0.8175
[INFO] Added cluster 2 to portfolio: SMA(132/206) - Original Sharpe: 0.6484
[INFO] Added cluster 3 to portfolio: SMA(128/160) - Original Sharpe: 0.4182
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LH_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.5950
[INFO] Kmeans Best out-of-sample Sharpe: -0.2634
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for LH...
[INFO] Excel file updated successfully. Added LH with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LH
[INFO] Big Point Value: 400.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2028 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 20 to 300
[INFO] Sharpe ratio range: -0.7971 to 1.0915
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 32
[INFO] Sharpe Ratio: 1.091503
[INFO] Number of Trades: 65
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2028 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 20.0 to 300.0
[INFO] Sharpe ratio range: -0.7971 to 1.0915
[INFO] Trades range: 10.0 to 165.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1916 to 2.5289
[INFO] Scaled Long SMA range: -2.5845 to 1.7506
[INFO] Scaled Sharpe ratio range: -2.8360 to 2.5529
[INFO] Scaled Trades range: -0.6927 to 10.2520
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2028 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6918
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 18
[INFO] Using 18 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 18 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 172 elements
[INFO] Cluster 1: 84 elements
[INFO] Cluster 2: 108 elements
[INFO] Cluster 3: 179 elements
[INFO] Cluster 4: 138 elements
[INFO] Cluster 5: 7 elements
[INFO] Cluster 6: 70 elements
[INFO] Cluster 7: 21 elements
[INFO] Cluster 8: 158 elements
[INFO] Cluster 9: 236 elements
[INFO] Cluster 10: 134 elements
[INFO] Cluster 11: 90 elements
[INFO] Cluster 12: 96 elements
[INFO] Cluster 13: 143 elements
[INFO] Cluster 14: 167 elements
[INFO] Cluster 15: 57 elements
[INFO] Cluster 16: 21 elements
[INFO] Cluster 17: 147 elements
[INFO] Using 17 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=180, Long SMA=206, Sharpe=0.4251, Trades=16
[INFO] Cluster 1 cluster: Short SMA=18, Long SMA=78, Sharpe=0.0269, Trades=30
[INFO] Cluster 2 cluster: Short SMA=62, Long SMA=96, Sharpe=-0.5883, Trades=29
[INFO] Cluster 3 cluster: Short SMA=54, Long SMA=166, Sharpe=-0.4460, Trades=14
[INFO] Cluster 4 cluster: Short SMA=18, Long SMA=152, Sharpe=0.3949, Trades=17
[INFO] Cluster 6 cluster: Short SMA=20, Long SMA=38, Sharpe=0.8175, Trades=50
[INFO] Cluster 7 cluster: Short SMA=26, Long SMA=30, Sharpe=0.8751, Trades=94
[INFO] Cluster 8 cluster: Short SMA=68, Long SMA=218, Sharpe=0.3536, Trades=12
[INFO] Cluster 9 cluster: Short SMA=126, Long SMA=164, Sharpe=0.4164, Trades=14
[INFO] Cluster 10 cluster: Short SMA=136, Long SMA=222, Sharpe=0.5009, Trades=10
[INFO] Cluster 11 cluster: Short SMA=20, Long SMA=276, Sharpe=0.1633, Trades=17
[INFO] Cluster 12 cluster: Short SMA=268, Long SMA=292, Sharpe=-0.3178, Trades=15
[INFO] Cluster 13 cluster: Short SMA=232, Long SMA=260, Sharpe=-0.0906, Trades=15
[INFO] Cluster 14 cluster: Short SMA=20, Long SMA=212, Sharpe=0.2678, Trades=16
[INFO] Cluster 15 cluster: Short SMA=138, Long SMA=146, Sharpe=0.4888, Trades=26
[INFO] Cluster 16 cluster: Short SMA=266, Long SMA=270, Sharpe=-0.4756, Trades=35
[INFO] Cluster 17 cluster: Short SMA=130, Long SMA=206, Sharpe=0.6787, Trades=10
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=32, Sharpe=1.0915, Trades=65
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=26, Long SMA=30, Sharpe=0.8751, Trades=94
[INFO] Top 2: Short SMA=20, Long SMA=38, Sharpe=0.8175, Trades=50
[INFO] Top 3: Short SMA=130, Long SMA=206, Sharpe=0.6787, Trades=10
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 17 valid clusters with clusters
[INFO] Filtering to 2021 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 32
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(26/30) - Original Sharpe: 0.8751, Trades: 94
[INFO] Hierarchical cluster 2: SMA(20/38) - Original Sharpe: 0.8175, Trades: 50
[INFO] Hierarchical cluster 3: SMA(130/206) - Original Sharpe: 0.6787, Trades: 10
[INFO] Hierarchical cluster 4: SMA(136/222) - Original Sharpe: 0.5009, Trades: 10
[INFO] Hierarchical cluster 5: SMA(138/146) - Original Sharpe: 0.4888, Trades: 26
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/32)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (26/30) - Sharpe: 0.8751
[INFO] cluster 2: (20/38) - Sharpe: 0.8175
[INFO] cluster 3: (130/206) - Sharpe: 0.6787
[INFO] Loading LH data from local files...
[INFO] Found data file: A_OHLCV_@LH_minutes_1440_0838-1301.dat
[INFO] File size: 245896 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -4.736305           -2.640759
1    2021-11-10 2021-11-10            41    -2.319258           -2.188710
2    2022-01-10 2022-01-10            41     3.633237            3.013255
3    2022-03-10 2022-03-10            42     2.875093            3.482199
4    2022-05-10 2022-05-10            41    -2.444707           -0.626783
5    2022-07-10 2022-07-10            44    -0.429290            0.068538
6    2022-09-10 2022-09-10            43    -1.794548            0.164455
7    2022-11-10 2022-11-10            40     1.185150           -2.163283
8    2023-01-10 2023-01-10            41     1.233131            0.429765
9    2023-03-10 2023-03-10            42     0.538717           -0.361904
10   2023-05-10 2023-05-10            40    -0.185962           -0.958257
11   2023-07-10 2023-07-10            44    -1.863091           -1.313913
12   2023-09-10 2023-09-10            44    -0.060196           -1.890076
13   2023-11-10 2023-11-10            40    -2.165690            0.906324
14   2024-01-10 2024-01-10            41     1.763493            2.253550
15   2024-03-10 2024-03-10            43    -3.469850           -0.692559
16   2024-05-10 2024-05-10            40     3.837640            5.279243
17   2024-07-10 2024-07-10            43    -1.646846            0.585129
18   2024-09-10 2024-09-10            44     3.096245            2.338236
19   2024-11-10 2024-11-10            35    -1.558146           -0.565322
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -4.7 |             -2.6 |          2.1 | True          
[INFO] 2021-11-10   |         -2.3 |             -2.2 |          0.1 | True          
[INFO] 2022-01-10   |          3.6 |              3.0 |         -0.6 | False         
[INFO] 2022-03-10   |          2.9 |              3.5 |          0.6 | True          
[INFO] 2022-05-10   |         -2.4 |             -0.6 |          1.8 | True          
[INFO] 2022-07-10   |         -0.4 |              0.1 |          0.5 | True          
[INFO] 2022-09-10   |         -1.8 |              0.2 |          2.0 | True          
[INFO] 2022-11-10   |          1.2 |             -2.2 |         -3.4 | False         
[INFO] 2023-01-10   |          1.2 |              0.4 |         -0.8 | False         
[INFO] 2023-03-10   |          0.5 |             -0.4 |         -0.9 | False         
[INFO] 2023-05-10   |         -0.2 |             -1.0 |         -0.8 | False         
[INFO] 2023-07-10   |         -1.9 |             -1.3 |          0.6 | True          
[INFO] 2023-09-10   |         -0.1 |             -1.9 |         -1.8 | False         
[INFO] 2023-11-10   |         -2.2 |              0.9 |          3.1 | True          
[INFO] 2024-01-10   |          1.8 |              2.3 |          0.5 | True          
[INFO] 2024-03-10   |         -3.5 |             -0.7 |          2.8 | True          
[INFO] 2024-05-10   |          3.8 |              5.3 |          1.5 | True          
[INFO] 2024-07-10   |         -1.6 |              0.6 |          2.2 | True          
[INFO] 2024-09-10   |          3.1 |              2.3 |         -0.8 | False         
[INFO] 2024-11-10   |         -1.6 |             -0.6 |          1.0 | True          
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Hierarchical cluster wins (rounded comparison): 13 of 20 periods (65.00% win rate)
[INFO] Updating Excel file with Hierarchical results for LH...
[INFO] Excel file updated successfully. Added LH with Hierarchical win rate 65.0% in row 30
[INFO] Added best Sharpe parameters 20/32 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 32
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(26/30) - Original Sharpe: 0.8751
[INFO] Added cluster 2 to portfolio: SMA(20/38) - Original Sharpe: 0.8175
[INFO] Added cluster 3 to portfolio: SMA(130/206) - Original Sharpe: 0.6787
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LH_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0300
[INFO] Hierarchical Best out-of-sample Sharpe: -0.2634
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for LH...
[INFO] Excel file updated successfully. Added LH with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LH
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LJ in column D: 23.0
[INFO] Using slippage from Excel column D: 23.0
[INFO] 
Symbol: @LJ=124XC
[INFO] Description: Long Gilt Future Custom Continuous Contract
[INFO] Exchange: ICE
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 1000.0
[INFO] Data shape: (2623, 6)
[INFO] Date range: 2014-11-13 16:35:00 to 2025-04-07 17:35:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2014-11-13 16:35:00  94.64  94.64  94.64  94.64     1.0
1 2014-11-14 16:35:00  95.05  95.05  94.81  94.95    40.0
2 2014-11-17 16:35:00  95.50  95.60  95.21  95.26   145.0
3 2014-11-18 16:35:00  95.43  95.43  95.20  95.31     7.0
4 2014-11-19 16:35:00  95.42  95.42  94.89  95.08   969.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 27.28 seconds (0.45 minutes)
[INFO] Best parameters found: Short SMA = 172, Long SMA = 190
[INFO] Best fitness (Sharpe ratio): 0.861463
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 172, Long SMA = 190, Sharpe = 0.861463
[INFO] Top 2: Short SMA = 172, Long SMA = 186, Sharpe = 0.854026
[INFO] Top 3: Short SMA = 172, Long SMA = 188, Sharpe = 0.847914
[INFO] Top 4: Short SMA = 170, Long SMA = 190, Sharpe = 0.837331
[INFO] Top 5: Short SMA = 154, Long SMA = 158, Sharpe = 0.832948
[INFO] Hall of Fame size: 2533
[INFO] Number of elements in all_results: 1467
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 1066 had penalty fitness
[INFO] Total filtered from Hall of Fame: 1066
[INFO] Hall of Fame -> all_results: 2533 -> 1467
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1467 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 2555, Evaluation data length: 2555
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LJ=124XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.10 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $-3,900.00
[INFO] Market Buy & Hold P&L: $-2,180.00
[INFO] Outperformance: $-1,720.00
[INFO] Sharpe ratio (entire period, annualized): -0.005389
[INFO] Sharpe ratio (in-sample, annualized): -0.488922
[INFO] Sharpe ratio (out-of-sample, annualized): 1.042257
[INFO] Maximum Drawdown: $335,640.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 1
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 1
[INFO] In-sample P&L: $-241,760.00
[INFO] Out-of-sample P&L: $237,860.00
[INFO] 
Best parameters from GA: Short SMA = 172, Long SMA = 190, Sharpe = 0.861463
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2533
[INFO] Cache hits (repeated combinations): 6108
[INFO] Total checks: 8641
[INFO] Cache hit rate: 70.69%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 23.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1467 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.4913 to 0.8615
[INFO] 
Best parameters:
[INFO] Short SMA: 172
[INFO] Long SMA: 190
[INFO] Sharpe Ratio: 0.861463
[INFO] Number of Trades: 20
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1467 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.4913 to 0.8615
[INFO] Trades range: 10.0 to 158.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.7864 to 1.7842
[INFO] Scaled Long SMA range: -2.9028 to 1.5509
[INFO] Scaled Sharpe ratio range: -2.6469 to 2.3458
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 113 elements
[INFO] Kmeans Cluster 1: 77 elements
[INFO] Kmeans Cluster 2: 179 elements
[INFO] Kmeans Cluster 3: 40 elements
[INFO] Kmeans Cluster 4: 72 elements
[INFO] Kmeans Cluster 5: 73 elements
[INFO] Kmeans Cluster 6: 111 elements
[INFO] Kmeans Cluster 7: 38 elements
[INFO] Kmeans Cluster 8: 58 elements
[INFO] Kmeans Cluster 9: 41 elements
[INFO] Kmeans Cluster 10: 53 elements
[INFO] Kmeans Cluster 11: 102 elements
[INFO] Kmeans Cluster 12: 192 elements
[INFO] Kmeans Cluster 13: 109 elements
[INFO] Kmeans Cluster 14: 72 elements
[INFO] Kmeans Cluster 15: 137 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=230.10, Long SMA=266.82, Sharpe=0.0980
[INFO] Centroid 1: Short SMA=103.35, Long SMA=159.64, Sharpe=0.1815
[INFO] Centroid 2: Short SMA=156.72, Long SMA=188.35, Sharpe=0.5519
[INFO] Centroid 3: Short SMA=41.15, Long SMA=73.00, Sharpe=-0.2610
[INFO] Centroid 4: Short SMA=81.72, Long SMA=113.75, Sharpe=-0.0915
[INFO] Centroid 5: Short SMA=203.04, Long SMA=241.12, Sharpe=-0.1603
[INFO] Centroid 6: Short SMA=131.98, Long SMA=171.41, Sharpe=0.4313
[INFO] Centroid 7: Short SMA=24.32, Long SMA=257.68, Sharpe=0.2441
[INFO] Centroid 8: Short SMA=24.21, Long SMA=198.00, Sharpe=0.0716
[INFO] Centroid 9: Short SMA=185.27, Long SMA=222.29, Sharpe=0.1057
[INFO] Centroid 10: Short SMA=26.83, Long SMA=64.94, Sharpe=0.0420
[INFO] Centroid 11: Short SMA=247.20, Long SMA=268.45, Sharpe=0.2867
[INFO] Centroid 12: Short SMA=264.60, Long SMA=291.19, Sharpe=0.1729
[INFO] Centroid 13: Short SMA=39.85, Long SMA=159.54, Sharpe=-0.1069
[INFO] Centroid 14: Short SMA=181.17, Long SMA=209.36, Sharpe=0.3085
[INFO] Centroid 15: Short SMA=163.17, Long SMA=179.94, Sharpe=0.6973
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=172, Long SMA=190, Sharpe=0.8615, Trades=20
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=160, Long SMA=174, Sharpe=0.6443, Trades=22
[INFO] Kmeans Top 2: Short SMA=156, Long SMA=190, Sharpe=0.5708, Trades=14
[INFO] Kmeans Top 3: Short SMA=130, Long SMA=172, Sharpe=0.4104, Trades=12
[INFO] Kmeans Top 4: Short SMA=248, Long SMA=270, Sharpe=0.3295, Trades=15
[INFO] Kmeans Top 5: Short SMA=182, Long SMA=210, Sharpe=0.3216, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (230, 267)
[INFO]   Nearest: (230.0, 266.0)
[INFO]   Rounded: (103, 160)
[INFO]   Nearest: (104.0, 160.0)
[INFO]   Rounded: (157, 188)
[INFO]   Nearest: (156.0, 188.0)
[INFO]   Rounded: (41, 73)
[INFO]   Nearest: (42.0, 72.0)
[INFO]   Rounded: (82, 114)
[INFO]   Rounded: (203, 241)
[INFO]   Nearest: (204.0, 242.0)
[INFO]   Rounded: (132, 171)
[INFO]   Nearest: (132.0, 172.0)
[INFO]   Rounded: (24, 258)
[INFO]   Rounded: (24, 198)
[INFO]   Rounded: (185, 222)
[INFO]   Nearest: (186.0, 222.0)
[INFO]   Rounded: (27, 65)
[INFO]   Nearest: (26.0, 64.0)
[INFO]   Rounded: (247, 268)
[INFO]   Nearest: (248.0, 268.0)
[INFO]   Rounded: (265, 291)
[INFO]   Nearest: (264.0, 292.0)
[INFO]   Rounded: (40, 160)
[INFO]   Rounded: (181, 209)
[INFO]   Nearest: (182.0, 210.0)
[INFO]   Rounded: (163, 180)
[INFO]   Nearest: (164.0, 180.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 172, Long SMA: 190
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(160/174) - Original Sharpe: 0.6443, Trades: 22
[INFO] Kmeans cluster 2: SMA(156/190) - Original Sharpe: 0.5708, Trades: 14
[INFO] Kmeans cluster 3: SMA(130/172) - Original Sharpe: 0.4104, Trades: 12
[INFO] Kmeans cluster 4: SMA(248/270) - Original Sharpe: 0.3295, Trades: 15
[INFO] Kmeans cluster 5: SMA(182/210) - Original Sharpe: 0.3216, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2555
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (172/190)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (160/174) - Sharpe: 0.6443
[INFO] cluster 2: (156/190) - Sharpe: 0.5708
[INFO] cluster 3: (130/172) - Sharpe: 0.4104
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Out-of-sample period starts on: 2021-12-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-14 2021-12-14            41    -6.476923           -6.306713
1    2022-02-14 2022-02-14            43     1.142795            0.082297
2    2022-04-14 2022-04-14            38     3.803073            3.803073
3    2022-06-14 2022-06-14            44    -1.477996           -1.477996
4    2022-08-14 2022-08-14            42     5.820882            5.820882
5    2022-10-14 2022-10-14            43    -3.029340           -3.029340
6    2022-12-14 2022-12-14            41     0.007038            0.007038
7    2023-02-14 2023-02-14            41    -0.235977           -0.235977
8    2023-04-14 2023-04-14            40     2.608255           -1.820973
9    2023-06-14 2023-06-14            43     2.317082            2.145928
10   2023-08-14 2023-08-14            44    -0.537988           -0.537988
11   2023-10-14 2023-10-14            43    -2.449401           -2.449401
12   2023-12-14 2023-12-14            41     1.911555            0.840255
13   2024-02-14 2024-02-14            41     0.151095            0.157740
14   2024-04-14 2024-04-14            42     0.082220            0.082220
15   2024-06-14 2024-06-14            43     1.909439           -0.153379
16   2024-08-14 2024-08-14            42     1.064357            2.616997
17   2024-10-14 2024-10-14            45     0.185180            2.581344
18   2024-12-14 2024-12-14            10     6.740598          -11.244451
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-14   |         -6.5 |             -6.3 |          0.2 | True          
[INFO] 2022-02-14   |          1.1 |              0.1 |         -1.0 | False         
[INFO] 2022-04-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-06-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-08-14   |          5.8 |              5.8 |          0.0 | Excluded      
[INFO] 2022-10-14   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-12-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-02-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-04-14   |          2.6 |             -1.8 |         -4.4 | False         
[INFO] 2023-06-14   |          2.3 |              2.1 |         -0.2 | False         
[INFO] 2023-08-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2023-10-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2023-12-14   |          1.9 |              0.8 |         -1.1 | False         
[INFO] 2024-02-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-04-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-06-14   |          1.9 |             -0.2 |         -2.1 | False         
[INFO] 2024-08-14   |          1.1 |              2.6 |          1.5 | True          
[INFO] 2024-10-14   |          0.2 |              2.6 |          2.4 | True          
[INFO] 2024-12-14   |          6.7 |            -11.2 |        -17.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-14, 2022-06-14, 2022-08-14, 2022-10-14, 2022-12-14, 2023-02-14, 2023-08-14, 2023-10-14, 2024-02-14, 2024-04-14
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 9
[INFO] Kmeans cluster wins (rounded comparison): 3 of 9 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for LJ...
[INFO] Excel file updated successfully. Added LJ with Kmeans win rate 33.3% in row 31
[INFO] Added best Sharpe parameters 172/190 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 172, Long SMA: 190
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(160/174) - Original Sharpe: 0.6443
[INFO] Added cluster 2 to portfolio: SMA(156/190) - Original Sharpe: 0.5708
[INFO] Added cluster 3 to portfolio: SMA(130/172) - Original Sharpe: 0.4104
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LJ_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1864
[INFO] Kmeans Best out-of-sample Sharpe: 0.5231
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for LJ...
[INFO] Excel file updated successfully. Added LJ with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LJ
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 23.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1467 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.4913 to 0.8615
[INFO] 
Best parameters:
[INFO] Short SMA: 172
[INFO] Long SMA: 190
[INFO] Sharpe Ratio: 0.861463
[INFO] Number of Trades: 20
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1467 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.4913 to 0.8615
[INFO] Trades range: 10.0 to 158.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.7864 to 1.7842
[INFO] Scaled Long SMA range: -2.9028 to 1.5509
[INFO] Scaled Sharpe ratio range: -2.6469 to 2.3458
[INFO] Scaled Trades range: -0.7476 to 13.4981
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1467 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6380
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 348 elements
[INFO] Cluster 1: 96 elements
[INFO] Cluster 2: 50 elements
[INFO] Cluster 3: 85 elements
[INFO] Cluster 4: 22 elements
[INFO] Cluster 5: 220 elements
[INFO] Cluster 6: 58 elements
[INFO] Cluster 7: 104 elements
[INFO] Cluster 8: 80 elements
[INFO] Cluster 9: 84 elements
[INFO] Cluster 10: 1 elements
[INFO] Cluster 11: 127 elements
[INFO] Cluster 12: 128 elements
[INFO] Cluster 13: 42 elements
[INFO] Cluster 14: 22 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=248, Long SMA=280, Sharpe=0.3687, Trades=13
[INFO] Cluster 1 cluster: Short SMA=26, Long SMA=218, Sharpe=-0.0297, Trades=16
[INFO] Cluster 2 cluster: Short SMA=52, Long SMA=66, Sharpe=0.0969, Trades=35
[INFO] Cluster 3 cluster: Short SMA=54, Long SMA=102, Sharpe=-0.1608, Trades=19
[INFO] Cluster 4 cluster: Short SMA=18, Long SMA=40, Sharpe=-0.1676, Trades=60
[INFO] Cluster 5 cluster: Short SMA=148, Long SMA=186, Sharpe=0.7431, Trades=12
[INFO] Cluster 6 cluster: Short SMA=270, Long SMA=274, Sharpe=0.1744, Trades=23
[INFO] Cluster 7 cluster: Short SMA=178, Long SMA=214, Sharpe=0.2320, Trades=12
[INFO] Cluster 8 cluster: Short SMA=202, Long SMA=242, Sharpe=-0.2539, Trades=11
[INFO] Cluster 9 cluster: Short SMA=106, Long SMA=158, Sharpe=0.2498, Trades=12
[INFO] Cluster 11 cluster: Short SMA=40, Long SMA=160, Sharpe=-0.0540, Trades=13
[INFO] Cluster 12 cluster: Short SMA=160, Long SMA=176, Sharpe=0.4558, Trades=22
[INFO] Cluster 13 cluster: Short SMA=172, Long SMA=176, Sharpe=0.4457, Trades=34
[INFO] Cluster 14 cluster: Short SMA=192, Long SMA=196, Sharpe=0.2449, Trades=34
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=172, Long SMA=190, Sharpe=0.8615, Trades=20
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=148, Long SMA=186, Sharpe=0.7431, Trades=12
[INFO] Top 2: Short SMA=160, Long SMA=176, Sharpe=0.4558, Trades=22
[INFO] Top 3: Short SMA=172, Long SMA=176, Sharpe=0.4457, Trades=34
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 1466 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 172, Long SMA: 190
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(148/186) - Original Sharpe: 0.7431, Trades: 12
[INFO] Hierarchical cluster 2: SMA(160/176) - Original Sharpe: 0.4558, Trades: 22
[INFO] Hierarchical cluster 3: SMA(172/176) - Original Sharpe: 0.4457, Trades: 34
[INFO] Hierarchical cluster 4: SMA(248/280) - Original Sharpe: 0.3687, Trades: 13
[INFO] Hierarchical cluster 5: SMA(106/158) - Original Sharpe: 0.2498, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2555
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (172/190)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (148/186) - Sharpe: 0.7431
[INFO] cluster 2: (160/176) - Sharpe: 0.4558
[INFO] cluster 3: (172/176) - Sharpe: 0.4457
[INFO] Loading LJ data from local files...
[INFO] Found data file: A_OHLCV_@LJ=124XC_minutes_1440_0905-1735.dat
[INFO] File size: 126041 bytes
[INFO] Out-of-sample period starts on: 2021-12-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-14 2021-12-14            41    -6.476923           -5.603630
1    2022-02-14 2022-02-14            43     1.142795            0.167541
2    2022-04-14 2022-04-14            38     3.803073            3.803073
3    2022-06-14 2022-06-14            44    -1.477996           -1.477996
4    2022-08-14 2022-08-14            42     5.820882            5.820882
5    2022-10-14 2022-10-14            43    -3.029340           -3.029340
6    2022-12-14 2022-12-14            41     0.007038            0.007038
7    2023-02-14 2023-02-14            41    -0.235977           -0.235977
8    2023-04-14 2023-04-14            40     2.608255           -0.709103
9    2023-06-14 2023-06-14            43     2.317082            1.074205
10   2023-08-14 2023-08-14            44    -0.537988           -0.537988
11   2023-10-14 2023-10-14            43    -2.449401           -2.449401
12   2023-12-14 2023-12-14            41     1.911555           -0.210707
13   2024-02-14 2024-02-14            41     0.151095            0.578639
14   2024-04-14 2024-04-14            42     0.082220            0.082220
15   2024-06-14 2024-06-14            43     1.909439            0.726471
16   2024-08-14 2024-08-14            42     1.064357            2.531037
17   2024-10-14 2024-10-14            45     0.185180           -1.588544
18   2024-12-14 2024-12-14            10     6.740598           -2.734705
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-14   |         -6.5 |             -5.6 |          0.9 | True          
[INFO] 2022-02-14   |          1.1 |              0.2 |         -0.9 | False         
[INFO] 2022-04-14   |          3.8 |              3.8 |          0.0 | Excluded      
[INFO] 2022-06-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2022-08-14   |          5.8 |              5.8 |          0.0 | Excluded      
[INFO] 2022-10-14   |         -3.0 |             -3.0 |          0.0 | Excluded      
[INFO] 2022-12-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2023-02-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-04-14   |          2.6 |             -0.7 |         -3.3 | False         
[INFO] 2023-06-14   |          2.3 |              1.1 |         -1.2 | False         
[INFO] 2023-08-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2023-10-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2023-12-14   |          1.9 |             -0.2 |         -2.1 | False         
[INFO] 2024-02-14   |          0.2 |              0.6 |          0.4 | True          
[INFO] 2024-04-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-06-14   |          1.9 |              0.7 |         -1.2 | False         
[INFO] 2024-08-14   |          1.1 |              2.5 |          1.4 | True          
[INFO] 2024-10-14   |          0.2 |             -1.6 |         -1.8 | False         
[INFO] 2024-12-14   |          6.7 |             -2.7 |         -9.4 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-14, 2022-06-14, 2022-08-14, 2022-10-14, 2022-12-14, 2023-02-14, 2023-08-14, 2023-10-14, 2024-04-14
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Hierarchical cluster wins (rounded comparison): 3 of 10 periods (30.00% win rate)
[INFO] Updating Excel file with Hierarchical results for LJ...
[INFO] Excel file updated successfully. Added LJ with Hierarchical win rate 30.0% in row 31
[INFO] Added best Sharpe parameters 172/190 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 172, Long SMA: 190
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(148/186) - Original Sharpe: 0.7431
[INFO] Added cluster 2 to portfolio: SMA(160/176) - Original Sharpe: 0.4558
[INFO] Added cluster 3 to portfolio: SMA(172/176) - Original Sharpe: 0.4457
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LJ_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0753
[INFO] Hierarchical Best out-of-sample Sharpe: 0.5231
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for LJ...
[INFO] Excel file updated successfully. Added LJ with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LJ
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for LZ in column D: 15.0
[INFO] Using slippage from Excel column D: 15.0
[INFO] 
Symbol: @LZ=104XC
[INFO] Description: FTSE 100 Index Futures Custom Continuous Contract
[INFO] Exchange: ICE
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.0
[INFO] Big point value: 10.0
[INFO] Data shape: (2612, 6)
[INFO] Date range: 2014-12-04 19:52:00 to 2025-04-07 20:52:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close   volume
0 2014-12-04 19:52:00  5308.0  5327.5  5284.0  5311.5    609.0
1 2014-12-05 19:52:00  5325.0  5357.5  5323.5  5352.5    659.0
2 2014-12-08 19:52:00  5340.5  5340.5  5245.0  5254.5   1844.0
3 2014-12-09 19:52:00  5258.5  5258.5  5126.0  5151.5   1998.0
4 2014-12-10 19:52:00  5150.5  5171.5  5084.5  5087.0  14732.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 24.98 seconds (0.42 minutes)
[INFO] Best parameters found: Short SMA = 156, Long SMA = 158
[INFO] Best fitness (Sharpe ratio): 0.626081
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 156, Long SMA = 158, Sharpe = 0.626081
[INFO] Top 2: Short SMA = 152, Long SMA = 160, Sharpe = 0.586260
[INFO] Top 3: Short SMA = 150, Long SMA = 164, Sharpe = 0.575198
[INFO] Top 4: Short SMA = 158, Long SMA = 160, Sharpe = 0.565307
[INFO] Top 5: Short SMA = 156, Long SMA = 166, Sharpe = 0.541563
[INFO] Hall of Fame size: 2515
[INFO] Number of elements in all_results: 1473
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 1042 had penalty fitness
[INFO] Total filtered from Hall of Fame: 1042
[INFO] Hall of Fame -> all_results: 2515 -> 1473
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1473 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 2544, Evaluation data length: 2544
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @LZ=104XC
[INFO] Big Point Value (from data): 10.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 7.62 contracts
[INFO] Maximum Position Size: 14 contracts
[INFO] Strategy Total P&L: $-112,930.00
[INFO] Market Buy & Hold P&L: $28,760.00
[INFO] Outperformance: $-141,690.00
[INFO] Sharpe ratio (entire period, annualized): -0.156634
[INFO] Sharpe ratio (in-sample, annualized): -0.163660
[INFO] Sharpe ratio (out-of-sample, annualized): -0.139318
[INFO] Maximum Drawdown: $225,385.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 1
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 1
[INFO] In-sample P&L: $-84,090.00
[INFO] Out-of-sample P&L: $-28,840.00
[INFO] 
Best parameters from GA: Short SMA = 156, Long SMA = 158, Sharpe = 0.626081
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2515
[INFO] Cache hits (repeated combinations): 6128
[INFO] Total checks: 8643
[INFO] Cache hit rate: 70.90%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 10.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1473 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.8038 to 0.6261
[INFO] 
Best parameters:
[INFO] Short SMA: 156
[INFO] Long SMA: 158
[INFO] Sharpe Ratio: 0.626081
[INFO] Number of Trades: 50
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1473 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.8038 to 0.6261
[INFO] Trades range: 10.0 to 155.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.4369 to 1.9657
[INFO] Scaled Long SMA range: -2.7485 to 1.7937
[INFO] Scaled Sharpe ratio range: -3.1464 to 3.1463
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 104 elements
[INFO] Kmeans Cluster 1: 93 elements
[INFO] Kmeans Cluster 2: 66 elements
[INFO] Kmeans Cluster 3: 114 elements
[INFO] Kmeans Cluster 4: 145 elements
[INFO] Kmeans Cluster 5: 200 elements
[INFO] Kmeans Cluster 6: 144 elements
[INFO] Kmeans Cluster 7: 99 elements
[INFO] Kmeans Cluster 8: 76 elements
[INFO] Kmeans Cluster 9: 34 elements
[INFO] Kmeans Cluster 10: 91 elements
[INFO] Kmeans Cluster 11: 84 elements
[INFO] Kmeans Cluster 12: 80 elements
[INFO] Kmeans Cluster 13: 53 elements
[INFO] Kmeans Cluster 14: 90 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=146.06, Long SMA=178.23, Sharpe=0.1528
[INFO] Centroid 1: Short SMA=198.65, Long SMA=226.77, Sharpe=-0.1776
[INFO] Centroid 2: Short SMA=24.24, Long SMA=120.33, Sharpe=0.0318
[INFO] Centroid 3: Short SMA=94.51, Long SMA=156.82, Sharpe=-0.3426
[INFO] Centroid 4: Short SMA=20.99, Long SMA=168.30, Sharpe=0.1443
[INFO] Centroid 5: Short SMA=264.11, Long SMA=284.06, Sharpe=-0.2030
[INFO] Centroid 6: Short SMA=218.25, Long SMA=253.61, Sharpe=-0.0596
[INFO] Centroid 7: Short SMA=179.33, Long SMA=200.97, Sharpe=0.0055
[INFO] Centroid 8: Short SMA=46.05, Long SMA=82.24, Sharpe=-0.2013
[INFO] Centroid 9: Short SMA=23.47, Long SMA=54.29, Sharpe=-0.4498
[INFO] Centroid 10: Short SMA=126.53, Long SMA=171.05, Sharpe=-0.0990
[INFO] Centroid 11: Short SMA=60.26, Long SMA=166.31, Sharpe=-0.2271
[INFO] Centroid 12: Short SMA=90.73, Long SMA=129.15, Sharpe=-0.5093
[INFO] Centroid 13: Short SMA=22.08, Long SMA=258.34, Sharpe=-0.0259
[INFO] Centroid 14: Short SMA=149.89, Long SMA=171.76, Sharpe=0.3908
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=156, Long SMA=158, Sharpe=0.6261, Trades=50
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=150, Long SMA=172, Sharpe=0.3565, Trades=16
[INFO] Kmeans Top 2: Short SMA=154, Long SMA=178, Sharpe=0.2344, Trades=12
[INFO] Kmeans Top 3: Short SMA=22, Long SMA=166, Sharpe=0.1678, Trades=10
[INFO] Kmeans Top 4: Short SMA=24, Long SMA=258, Sharpe=0.0836, Trades=10
[INFO] Kmeans Top 5: Short SMA=22, Long SMA=118, Sharpe=0.0643, Trades=18
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (146, 178)
[INFO]   Rounded: (199, 227)
[INFO]   Nearest: (198.0, 226.0)
[INFO]   Rounded: (24, 120)
[INFO]   Rounded: (95, 157)
[INFO]   Nearest: (94.0, 156.0)
[INFO]   Rounded: (21, 168)
[INFO]   Nearest: (20.0, 168.0)
[INFO]   Rounded: (264, 284)
[INFO]   Rounded: (218, 254)
[INFO]   Rounded: (179, 201)
[INFO]   Nearest: (180.0, 200.0)
[INFO]   Rounded: (46, 82)
[INFO]   Rounded: (23, 54)
[INFO]   Nearest: (24.0, 54.0)
[INFO]   Rounded: (127, 171)
[INFO]   Nearest: (126.0, 172.0)
[INFO]   Rounded: (60, 166)
[INFO]   Rounded: (91, 129)
[INFO]   Nearest: (90.0, 130.0)
[INFO]   Rounded: (22, 258)
[INFO]   Rounded: (150, 172)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 156, Long SMA: 158
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(150/172) - Original Sharpe: 0.3565, Trades: 16
[INFO] Kmeans cluster 2: SMA(154/178) - Original Sharpe: 0.2344, Trades: 12
[INFO] Kmeans cluster 3: SMA(22/166) - Original Sharpe: 0.1678, Trades: 10
[INFO] Kmeans cluster 4: SMA(24/258) - Original Sharpe: 0.0836, Trades: 10
[INFO] Kmeans cluster 5: SMA(22/118) - Original Sharpe: 0.0643, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2544
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (156/158)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (150/172) - Sharpe: 0.3565
[INFO] cluster 2: (154/178) - Sharpe: 0.2344
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Out-of-sample period starts on: 2021-12-17
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-17 2021-12-17            41     2.102424            2.102424
1    2022-02-17 2022-02-17            41    -0.193263           -0.193263
2    2022-04-17 2022-04-17            40    -2.414653           -2.414653
3    2022-06-17 2022-06-17            43     3.471248            3.471248
4    2022-08-17 2022-08-17            41     5.752319            1.205818
5    2022-10-17 2022-10-17            45     0.507784            3.931840
6    2022-12-17 2022-12-17            41     1.439696           -1.251995
7    2023-02-17 2023-02-17            39    -5.196104           -1.698496
8    2023-04-17 2023-04-17            42    -1.914640           -1.914640
9    2023-06-17 2023-06-17            43    -1.864618           -1.864618
10   2023-08-17 2023-08-17            42    -3.026053           -0.156006
11   2023-10-17 2023-10-17            44     2.645057            0.447216
12   2023-12-17 2023-12-17            42     2.127559            1.320577
13   2024-02-17 2024-02-17            40    -5.080096           -4.414056
14   2024-04-17 2024-04-17            41    -1.461984            2.231963
15   2024-06-17 2024-06-17            45     0.717903            0.717903
16   2024-08-17 2024-08-17            42     0.001423            0.001423
17   2024-10-17 2024-10-17            43    -0.391047           -1.160801
18   2024-12-17 2024-12-17             9     7.439225           -8.110093
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-17   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2022-02-17   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-04-17   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2022-06-17   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-08-17   |          5.8 |              1.2 |         -4.6 | False         
[INFO] 2022-10-17   |          0.5 |              3.9 |          3.4 | True          
[INFO] 2022-12-17   |          1.4 |             -1.3 |         -2.7 | False         
[INFO] 2023-02-17   |         -5.2 |             -1.7 |          3.5 | True          
[INFO] 2023-04-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-06-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-08-17   |         -3.0 |             -0.2 |          2.8 | True          
[INFO] 2023-10-17   |          2.6 |              0.4 |         -2.2 | False         
[INFO] 2023-12-17   |          2.1 |              1.3 |         -0.8 | False         
[INFO] 2024-02-17   |         -5.1 |             -4.4 |          0.7 | True          
[INFO] 2024-04-17   |         -1.5 |              2.2 |          3.7 | True          
[INFO] 2024-06-17   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-08-17   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-10-17   |         -0.4 |             -1.2 |         -0.8 | False         
[INFO] 2024-12-17   |          7.4 |             -8.1 |        -15.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-12-17, 2022-02-17, 2022-04-17, 2022-06-17, 2023-04-17, 2023-06-17, 2024-06-17, 2024-08-17
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Kmeans cluster wins (rounded comparison): 5 of 11 periods (45.45% win rate)
[INFO] Updating Excel file with Kmeans results for LZ...
[INFO] Excel file updated successfully. Added LZ with Kmeans win rate 45.5% in row 32
[INFO] Added best Sharpe parameters 156/158 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 156, Long SMA: 158
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(150/172) - Original Sharpe: 0.3565
[INFO] Added cluster 2 to portfolio: SMA(154/178) - Original Sharpe: 0.2344
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LZ_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1369
[INFO] Kmeans Best out-of-sample Sharpe: -0.1947
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for LZ...
[INFO] Excel file updated successfully. Added LZ with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LZ
[INFO] Big Point Value: 10.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1473 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.8038 to 0.6261
[INFO] 
Best parameters:
[INFO] Short SMA: 156
[INFO] Long SMA: 158
[INFO] Sharpe Ratio: 0.626081
[INFO] Number of Trades: 50
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1473 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.8038 to 0.6261
[INFO] Trades range: 10.0 to 155.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.4369 to 1.9657
[INFO] Scaled Long SMA range: -2.7485 to 1.7937
[INFO] Scaled Sharpe ratio range: -3.1464 to 3.1463
[INFO] Scaled Trades range: -0.6004 to 12.4093
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1473 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5216
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 18
[INFO] Using 18 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 18 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 219 elements
[INFO] Cluster 1: 174 elements
[INFO] Cluster 2: 52 elements
[INFO] Cluster 3: 26 elements
[INFO] Cluster 4: 175 elements
[INFO] Cluster 5: 104 elements
[INFO] Cluster 6: 39 elements
[INFO] Cluster 7: 14 elements
[INFO] Cluster 8: 199 elements
[INFO] Cluster 9: 74 elements
[INFO] Cluster 10: 62 elements
[INFO] Cluster 11: 109 elements
[INFO] Cluster 12: 96 elements
[INFO] Cluster 13: 5 elements
[INFO] Cluster 14: 43 elements
[INFO] Cluster 15: 45 elements
[INFO] Cluster 16: 3 elements
[INFO] Cluster 17: 34 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=212, Long SMA=248, Sharpe=-0.0373, Trades=10
[INFO] Cluster 1 cluster: Short SMA=80, Long SMA=166, Sharpe=-0.3389, Trades=16
[INFO] Cluster 2 cluster: Short SMA=152, Long SMA=164, Sharpe=0.4926, Trades=22
[INFO] Cluster 3 cluster: Short SMA=42, Long SMA=52, Sharpe=-0.3984, Trades=52
[INFO] Cluster 4 cluster: Short SMA=22, Long SMA=162, Sharpe=0.2259, Trades=12
[INFO] Cluster 5 cluster: Short SMA=90, Long SMA=148, Sharpe=-0.4776, Trades=14
[INFO] Cluster 6 cluster: Short SMA=28, Long SMA=60, Sharpe=-0.3584, Trades=38
[INFO] Cluster 8 cluster: Short SMA=266, Long SMA=284, Sharpe=-0.1687, Trades=10
[INFO] Cluster 9 cluster: Short SMA=142, Long SMA=160, Sharpe=-0.0077, Trades=22
[INFO] Cluster 10 cluster: Short SMA=26, Long SMA=116, Sharpe=0.0576, Trades=18
[INFO] Cluster 11 cluster: Short SMA=162, Long SMA=196, Sharpe=-0.0397, Trades=12
[INFO] Cluster 12 cluster: Short SMA=150, Long SMA=184, Sharpe=0.3983, Trades=12
[INFO] Cluster 14 cluster: Short SMA=78, Long SMA=106, Sharpe=-0.3288, Trades=18
[INFO] Cluster 15 cluster: Short SMA=24, Long SMA=266, Sharpe=0.1180, Trades=12
[INFO] Cluster 17 cluster: Short SMA=214, Long SMA=220, Sharpe=0.0048, Trades=22
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=156, Long SMA=158, Sharpe=0.6261, Trades=50
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=152, Long SMA=164, Sharpe=0.4926, Trades=22
[INFO] Top 2: Short SMA=150, Long SMA=184, Sharpe=0.3983, Trades=12
[INFO] Top 3: Short SMA=22, Long SMA=162, Sharpe=0.2259, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 1451 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 156, Long SMA: 158
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(152/164) - Original Sharpe: 0.4926, Trades: 22
[INFO] Hierarchical cluster 2: SMA(150/184) - Original Sharpe: 0.3983, Trades: 12
[INFO] Hierarchical cluster 3: SMA(22/162) - Original Sharpe: 0.2259, Trades: 12
[INFO] Hierarchical cluster 4: SMA(24/266) - Original Sharpe: 0.1180, Trades: 12
[INFO] Hierarchical cluster 5: SMA(26/116) - Original Sharpe: 0.0576, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2544
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (156/158)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (152/164) - Sharpe: 0.4926
[INFO] cluster 2: (150/184) - Sharpe: 0.3983
[INFO] cluster 3: (22/162) - Sharpe: 0.2259
[INFO] Loading LZ data from local files...
[INFO] Found data file: A_OHLCV_@LZ=104XC_minutes_1440_0205-2052.dat
[INFO] File size: 125519 bytes
[INFO] Out-of-sample period starts on: 2021-12-17
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-12-17 2021-12-17            41     2.102424            2.102424
1    2022-02-17 2022-02-17            41    -0.193263           -0.193263
2    2022-04-17 2022-04-17            40    -2.414653           -2.414653
3    2022-06-17 2022-06-17            43     3.471248            3.645970
4    2022-08-17 2022-08-17            41     5.752319            0.605043
5    2022-10-17 2022-10-17            45     0.507784            1.583862
6    2022-12-17 2022-12-17            41     1.439696            2.062698
7    2023-02-17 2023-02-17            39    -5.196104           -2.636413
8    2023-04-17 2023-04-17            42    -1.914640           -1.914640
9    2023-06-17 2023-06-17            43    -1.864618           -2.331134
10   2023-08-17 2023-08-17            42    -3.026053           -1.297754
11   2023-10-17 2023-10-17            44     2.645057            0.973394
12   2023-12-17 2023-12-17            42     2.127559           -2.307464
13   2024-02-17 2024-02-17            40    -5.080096           -3.858296
14   2024-04-17 2024-04-17            41    -1.461984            1.068506
15   2024-06-17 2024-06-17            45     0.717903            0.717903
16   2024-08-17 2024-08-17            42     0.001423            0.001423
17   2024-10-17 2024-10-17            43    -0.391047           -1.977131
18   2024-12-17 2024-12-17             9     7.439225            3.751295
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-12-17   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2022-02-17   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-04-17   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2022-06-17   |          3.5 |              3.6 |          0.1 | True          
[INFO] 2022-08-17   |          5.8 |              0.6 |         -5.2 | False         
[INFO] 2022-10-17   |          0.5 |              1.6 |          1.1 | True          
[INFO] 2022-12-17   |          1.4 |              2.1 |          0.7 | True          
[INFO] 2023-02-17   |         -5.2 |             -2.6 |          2.6 | True          
[INFO] 2023-04-17   |         -1.9 |             -1.9 |          0.0 | Excluded      
[INFO] 2023-06-17   |         -1.9 |             -2.3 |         -0.4 | False         
[INFO] 2023-08-17   |         -3.0 |             -1.3 |          1.7 | True          
[INFO] 2023-10-17   |          2.6 |              1.0 |         -1.6 | False         
[INFO] 2023-12-17   |          2.1 |             -2.3 |         -4.4 | False         
[INFO] 2024-02-17   |         -5.1 |             -3.9 |          1.2 | True          
[INFO] 2024-04-17   |         -1.5 |              1.1 |          2.6 | True          
[INFO] 2024-06-17   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-08-17   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2024-10-17   |         -0.4 |             -2.0 |         -1.6 | False         
[INFO] 2024-12-17   |          7.4 |              3.8 |         -3.6 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-12-17, 2022-02-17, 2022-04-17, 2023-04-17, 2024-06-17, 2024-08-17
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 13 periods (53.85% win rate)
[INFO] Updating Excel file with Hierarchical results for LZ...
[INFO] Excel file updated successfully. Added LZ with Hierarchical win rate 53.8% in row 32
[INFO] Added best Sharpe parameters 156/158 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 156, Long SMA: 158
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(152/164) - Original Sharpe: 0.4926
[INFO] Added cluster 2 to portfolio: SMA(150/184) - Original Sharpe: 0.3983
[INFO] Added cluster 3 to portfolio: SMA(22/162) - Original Sharpe: 0.2259
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'LZ_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.3557
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1947
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for LZ...
[INFO] Excel file updated successfully. Added LZ with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\LZ
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for MME in column D: 10.0
[INFO] Using slippage from Excel column D: 10.0
[INFO] 
Symbol: @MME=103XC
[INFO] Description: MSCI Emerging Markets Mini Idx Custom Continuous Contract
[INFO] Exchange: ICEUS
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.0
[INFO] Big point value: 50.0
[INFO] Data shape: (3946, 6)
[INFO] Date range: 2009-12-10 15:53:00 to 2025-04-07 15:53:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime      open      high       low     close  volume
0 2009-12-10 15:53:00  9794.102  9798.102  9792.102  9792.102     9.0
1 2009-12-11 15:53:00  9829.102  9855.102  9829.102  9848.102    79.0
2 2009-12-14 15:53:00  9898.102  9937.102  9867.102  9925.102   511.0
3 2009-12-15 15:53:00  9839.102  9926.102  9839.102  9854.102   260.0
4 2009-12-16 15:53:00  9922.102  9955.102  9866.102  9874.102   318.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 22.39 seconds (0.37 minutes)
[INFO] Best parameters found: Short SMA = 42, Long SMA = 46
[INFO] Best fitness (Sharpe ratio): 0.770410
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 42, Long SMA = 46, Sharpe = 0.770410
[INFO] Top 2: Short SMA = 20, Long SMA = 22, Sharpe = 0.769411
[INFO] Top 3: Short SMA = 214, Long SMA = 244, Sharpe = 0.762874
[INFO] Top 4: Short SMA = 26, Long SMA = 48, Sharpe = 0.759915
[INFO] Top 5: Short SMA = 26, Long SMA = 46, Sharpe = 0.710649
[INFO] Hall of Fame size: 2262
[INFO] Number of elements in all_results: 1938
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 324 had penalty fitness
[INFO] Total filtered from Hall of Fame: 324
[INFO] Hall of Fame -> all_results: 2262 -> 1938
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1938 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3108, Evaluation data length: 2841
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @MME=103XC
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.01 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $34,770.00
[INFO] Market Buy & Hold P&L: $4,740.00
[INFO] Outperformance: $30,030.00
[INFO] Sharpe ratio (entire period, annualized): -0.034838
[INFO] Sharpe ratio (in-sample, annualized): -0.203676
[INFO] Sharpe ratio (out-of-sample, annualized): 0.386392
[INFO] Maximum Drawdown: $307,770.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-119,190.00
[INFO] Out-of-sample P&L: $90,620.00
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 46, Sharpe = 0.770410
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2262
[INFO] Cache hits (repeated combinations): 6409
[INFO] Total checks: 8671
[INFO] Cache hit rate: 73.91%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 50.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1938 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.7900 to 0.7704
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.770410
[INFO] Number of Trades: 72
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1938 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.7900 to 0.7704
[INFO] Trades range: 11.0 to 217.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2530 to 1.9788
[INFO] Scaled Long SMA range: -2.8271 to 1.2261
[INFO] Scaled Sharpe ratio range: -3.4688 to 2.7210
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 84 elements
[INFO] Kmeans Cluster 1: 157 elements
[INFO] Kmeans Cluster 2: 233 elements
[INFO] Kmeans Cluster 3: 99 elements
[INFO] Kmeans Cluster 4: 133 elements
[INFO] Kmeans Cluster 5: 96 elements
[INFO] Kmeans Cluster 6: 104 elements
[INFO] Kmeans Cluster 7: 89 elements
[INFO] Kmeans Cluster 8: 125 elements
[INFO] Kmeans Cluster 9: 86 elements
[INFO] Kmeans Cluster 10: 130 elements
[INFO] Kmeans Cluster 11: 111 elements
[INFO] Kmeans Cluster 12: 73 elements
[INFO] Kmeans Cluster 13: 146 elements
[INFO] Kmeans Cluster 14: 64 elements
[INFO] Kmeans Cluster 15: 135 elements
[INFO] Kmeans Cluster 16: 73 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=70.74, Long SMA=114.67, Sharpe=-0.1202
[INFO] Centroid 1: Short SMA=247.62, Long SMA=276.28, Sharpe=0.1741
[INFO] Centroid 2: Short SMA=25.20, Long SMA=251.63, Sharpe=0.1168
[INFO] Centroid 3: Short SMA=23.05, Long SMA=55.98, Sharpe=0.5470
[INFO] Centroid 4: Short SMA=259.16, Long SMA=288.62, Sharpe=-0.0077
[INFO] Centroid 5: Short SMA=180.60, Long SMA=231.69, Sharpe=-0.0777
[INFO] Centroid 6: Short SMA=87.29, Long SMA=235.52, Sharpe=-0.2870
[INFO] Centroid 7: Short SMA=27.82, Long SMA=122.31, Sharpe=0.1779
[INFO] Centroid 8: Short SMA=41.54, Long SMA=185.94, Sharpe=-0.0396
[INFO] Centroid 9: Short SMA=114.84, Long SMA=162.88, Sharpe=-0.4279
[INFO] Centroid 10: Short SMA=129.65, Long SMA=251.08, Sharpe=0.0644
[INFO] Centroid 11: Short SMA=221.96, Long SMA=242.07, Sharpe=0.5352
[INFO] Centroid 12: Short SMA=32.79, Long SMA=57.26, Sharpe=0.3343
[INFO] Centroid 13: Short SMA=45.89, Long SMA=269.21, Sharpe=-0.0462
[INFO] Centroid 14: Short SMA=191.66, Long SMA=214.28, Sharpe=0.1211
[INFO] Centroid 15: Short SMA=227.47, Long SMA=252.10, Sharpe=0.3470
[INFO] Centroid 16: Short SMA=148.71, Long SMA=188.44, Sharpe=-0.1518
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=46, Sharpe=0.7704, Trades=72
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=222, Long SMA=242, Sharpe=0.5816, Trades=19
[INFO] Kmeans Top 2: Short SMA=20, Long SMA=56, Sharpe=0.5204, Trades=32
[INFO] Kmeans Top 3: Short SMA=230, Long SMA=252, Sharpe=0.4286, Trades=15
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=56, Sharpe=0.3991, Trades=28
[INFO] Kmeans Top 5: Short SMA=242, Long SMA=276, Sharpe=0.2836, Trades=13
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (71, 115)
[INFO]   Nearest: (70.0, 114.0)
[INFO]   Rounded: (248, 276)
[INFO]   Rounded: (25, 252)
[INFO]   Nearest: (26.0, 252.0)
[INFO]   Rounded: (23, 56)
[INFO]   Nearest: (24.0, 56.0)
[INFO]   Rounded: (259, 289)
[INFO]   Nearest: (260.0, 288.0)
[INFO]   Rounded: (181, 232)
[INFO]   Nearest: (180.0, 232.0)
[INFO]   Rounded: (87, 236)
[INFO]   Nearest: (88.0, 236.0)
[INFO]   Rounded: (28, 122)
[INFO]   Rounded: (42, 186)
[INFO]   Rounded: (115, 163)
[INFO]   Nearest: (114.0, 162.0)
[INFO]   Rounded: (130, 251)
[INFO]   Nearest: (130.0, 252.0)
[INFO]   Rounded: (222, 242)
[INFO]   Rounded: (33, 57)
[INFO]   Nearest: (32.0, 58.0)
[INFO]   Rounded: (46, 269)
[INFO]   Nearest: (46.0, 270.0)
[INFO]   Rounded: (192, 214)
[INFO]   Rounded: (227, 252)
[INFO]   Nearest: (228.0, 252.0)
[INFO]   Rounded: (149, 188)
[INFO]   Nearest: (148.0, 188.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(222/242) - Original Sharpe: 0.5816, Trades: 19
[INFO] Kmeans cluster 2: SMA(20/56) - Original Sharpe: 0.5204, Trades: 32
[INFO] Kmeans cluster 3: SMA(230/252) - Original Sharpe: 0.4286, Trades: 15
[INFO] Kmeans cluster 4: SMA(36/56) - Original Sharpe: 0.3991, Trades: 28
[INFO] Kmeans cluster 5: SMA(242/276) - Original Sharpe: 0.2836, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (222/242) - Sharpe: 0.5816
[INFO] cluster 2: (20/56) - Sharpe: 0.5204
[INFO] cluster 3: (230/252) - Sharpe: 0.4286
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.361742            0.148354
1    2021-11-14 2021-11-14            43    -1.602839           -3.079977
2    2022-01-14 2022-01-14            41     4.130644            4.600418
3    2022-03-14 2022-03-14            44     1.862130            1.111719
4    2022-05-14 2022-05-14            43    -1.126816            0.878780
5    2022-07-14 2022-07-14            44     1.988272           -0.044889
6    2022-09-14 2022-09-14            43    -0.246838            0.693882
7    2022-11-14 2022-11-14            43     3.722936           -1.521999
8    2023-01-14 2023-01-14            41    -3.722520            2.363713
9    2023-03-14 2023-03-14            44    -1.448805           -0.993496
10   2023-05-14 2023-05-14            44    -0.138874           -2.756888
11   2023-07-14 2023-07-14            44    -1.008814           -1.164123
12   2023-09-14 2023-09-14            43     1.221874           -1.221874
13   2023-11-14 2023-11-14            42    -0.797839           -0.000869
14   2024-01-14 2024-01-14            43     0.255477           -0.999028
15   2024-03-14 2024-03-14            42     0.482175           -1.581543
16   2024-05-14 2024-05-14            44     0.027624            0.206386
17   2024-07-14 2024-07-14            45     2.029233           -3.096824
18   2024-09-14 2024-09-14            43    -1.061167           -0.470491
19   2024-11-14 2024-11-14            33     1.867323           -2.128275
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |              0.1 |          0.5 | True          
[INFO] 2021-11-14   |         -1.6 |             -3.1 |         -1.5 | False         
[INFO] 2022-01-14   |          4.1 |              4.6 |          0.5 | True          
[INFO] 2022-03-14   |          1.9 |              1.1 |         -0.8 | False         
[INFO] 2022-05-14   |         -1.1 |              0.9 |          2.0 | True          
[INFO] 2022-07-14   |          2.0 |             -0.0 |         -2.0 | False         
[INFO] 2022-09-14   |         -0.2 |              0.7 |          0.9 | True          
[INFO] 2022-11-14   |          3.7 |             -1.5 |         -5.2 | False         
[INFO] 2023-01-14   |         -3.7 |              2.4 |          6.1 | True          
[INFO] 2023-03-14   |         -1.4 |             -1.0 |          0.4 | True          
[INFO] 2023-05-14   |         -0.1 |             -2.8 |         -2.7 | False         
[INFO] 2023-07-14   |         -1.0 |             -1.2 |         -0.2 | False         
[INFO] 2023-09-14   |          1.2 |             -1.2 |         -2.4 | False         
[INFO] 2023-11-14   |         -0.8 |             -0.0 |          0.8 | True          
[INFO] 2024-01-14   |          0.3 |             -1.0 |         -1.3 | False         
[INFO] 2024-03-14   |          0.5 |             -1.6 |         -2.1 | False         
[INFO] 2024-05-14   |          0.0 |              0.2 |          0.2 | True          
[INFO] 2024-07-14   |          2.0 |             -3.1 |         -5.1 | False         
[INFO] 2024-09-14   |         -1.1 |             -0.5 |          0.6 | True          
[INFO] 2024-11-14   |          1.9 |             -2.1 |         -4.0 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 9 of 20 periods (45.00% win rate)
[INFO] Updating Excel file with Kmeans results for MME...
[INFO] Excel file updated successfully. Added MME with Kmeans win rate 45.0% in row 33
[INFO] Added best Sharpe parameters 42/46 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 46
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(222/242) - Original Sharpe: 0.5816
[INFO] Added cluster 2 to portfolio: SMA(20/56) - Original Sharpe: 0.5204
[INFO] Added cluster 3 to portfolio: SMA(230/252) - Original Sharpe: 0.4286
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MME_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.2564
[INFO] Kmeans Best out-of-sample Sharpe: 0.2991
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for MME...
[INFO] Excel file updated successfully. Added MME with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MME
[INFO] Big Point Value: 50.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1938 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.7900 to 0.7704
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 46
[INFO] Sharpe Ratio: 0.770410
[INFO] Number of Trades: 72
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1938 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.7900 to 0.7704
[INFO] Trades range: 11.0 to 217.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.2530 to 1.9788
[INFO] Scaled Long SMA range: -2.8271 to 1.2261
[INFO] Scaled Sharpe ratio range: -3.4688 to 2.7210
[INFO] Scaled Trades range: -0.6367 to 14.6313
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1938 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5518
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 418 elements
[INFO] Cluster 1: 129 elements
[INFO] Cluster 2: 159 elements
[INFO] Cluster 3: 215 elements
[INFO] Cluster 4: 134 elements
[INFO] Cluster 5: 22 elements
[INFO] Cluster 6: 38 elements
[INFO] Cluster 7: 134 elements
[INFO] Cluster 8: 117 elements
[INFO] Cluster 9: 3 elements
[INFO] Cluster 10: 110 elements
[INFO] Cluster 11: 34 elements
[INFO] Cluster 12: 82 elements
[INFO] Cluster 13: 162 elements
[INFO] Cluster 14: 44 elements
[INFO] Cluster 15: 137 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=32, Long SMA=250, Sharpe=0.1197, Trades=14
[INFO] Cluster 1 cluster: Short SMA=60, Long SMA=150, Sharpe=-0.1025, Trades=15
[INFO] Cluster 2 cluster: Short SMA=26, Long SMA=118, Sharpe=0.1376, Trades=21
[INFO] Cluster 3 cluster: Short SMA=256, Long SMA=286, Sharpe=0.0984, Trades=17
[INFO] Cluster 4 cluster: Short SMA=172, Long SMA=218, Sharpe=0.1114, Trades=13
[INFO] Cluster 5 cluster: Short SMA=42, Long SMA=46, Sharpe=0.7704, Trades=72
[INFO] Cluster 6 cluster: Short SMA=230, Long SMA=234, Sharpe=0.4738, Trades=43
[INFO] Cluster 7 cluster: Short SMA=90, Long SMA=232, Sharpe=-0.2035, Trades=13
[INFO] Cluster 8 cluster: Short SMA=20, Long SMA=52, Sharpe=0.4844, Trades=34
[INFO] Cluster 10 cluster: Short SMA=220, Long SMA=240, Sharpe=0.5861, Trades=19
[INFO] Cluster 11 cluster: Short SMA=140, Long SMA=152, Sharpe=-0.1739, Trades=36
[INFO] Cluster 12 cluster: Short SMA=238, Long SMA=246, Sharpe=0.2720, Trades=29
[INFO] Cluster 13 cluster: Short SMA=134, Long SMA=242, Sharpe=0.1825, Trades=11
[INFO] Cluster 14 cluster: Short SMA=108, Long SMA=166, Sharpe=-0.7208, Trades=15
[INFO] Cluster 15 cluster: Short SMA=232, Long SMA=258, Sharpe=0.2803, Trades=15
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=46, Sharpe=0.7704, Trades=72
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=42, Long SMA=46, Sharpe=0.7704, Trades=72
[INFO] Top 2: Short SMA=220, Long SMA=240, Sharpe=0.5861, Trades=19
[INFO] Top 3: Short SMA=20, Long SMA=52, Sharpe=0.4844, Trades=34
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 1935 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 46
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(42/46) - Original Sharpe: 0.7704, Trades: 72
[INFO] Hierarchical cluster 2: SMA(220/240) - Original Sharpe: 0.5861, Trades: 19
[INFO] Hierarchical cluster 3: SMA(20/52) - Original Sharpe: 0.4844, Trades: 34
[INFO] Hierarchical cluster 4: SMA(230/234) - Original Sharpe: 0.4738, Trades: 43
[INFO] Hierarchical cluster 5: SMA(232/258) - Original Sharpe: 0.2803, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/46)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (42/46) - Sharpe: 0.7704
[INFO] cluster 2: (220/240) - Sharpe: 0.5861
[INFO] cluster 3: (20/52) - Sharpe: 0.4844
[INFO] Loading MME data from local files...
[INFO] Found data file: A_OHLCV_@MME=103XC_minutes_1440_2003-1553.dat
[INFO] File size: 189573 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.361742           -0.401243
1    2021-11-14 2021-11-14            43    -1.602839           -3.438813
2    2022-01-14 2022-01-14            41     4.130644            5.908561
3    2022-03-14 2022-03-14            44     1.862130            1.398742
4    2022-05-14 2022-05-14            43    -1.126816            0.239903
5    2022-07-14 2022-07-14            44     1.988272           -0.381925
6    2022-09-14 2022-09-14            43    -0.246838            0.386915
7    2022-11-14 2022-11-14            43     3.722936            3.265685
8    2023-01-14 2023-01-14            41    -3.722520           -3.083362
9    2023-03-14 2023-03-14            44    -1.448805           -2.233258
10   2023-05-14 2023-05-14            44    -0.138874           -2.060694
11   2023-07-14 2023-07-14            44    -1.008814           -4.311508
12   2023-09-14 2023-09-14            43     1.221874            1.221874
13   2023-11-14 2023-11-14            42    -0.797839           -0.261895
14   2024-01-14 2024-01-14            43     0.255477            0.701760
15   2024-03-14 2024-03-14            42     0.482175           -2.151243
16   2024-05-14 2024-05-14            44     0.027624            2.675700
17   2024-07-14 2024-07-14            45     2.029233           -1.839832
18   2024-09-14 2024-09-14            43    -1.061167           -0.443072
19   2024-11-14 2024-11-14            33     1.867323            1.867323
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.6 |             -3.4 |         -1.8 | False         
[INFO] 2022-01-14   |          4.1 |              5.9 |          1.8 | True          
[INFO] 2022-03-14   |          1.9 |              1.4 |         -0.5 | False         
[INFO] 2022-05-14   |         -1.1 |              0.2 |          1.3 | True          
[INFO] 2022-07-14   |          2.0 |             -0.4 |         -2.4 | False         
[INFO] 2022-09-14   |         -0.2 |              0.4 |          0.6 | True          
[INFO] 2022-11-14   |          3.7 |              3.3 |         -0.4 | False         
[INFO] 2023-01-14   |         -3.7 |             -3.1 |          0.6 | True          
[INFO] 2023-03-14   |         -1.4 |             -2.2 |         -0.8 | False         
[INFO] 2023-05-14   |         -0.1 |             -2.1 |         -2.0 | False         
[INFO] 2023-07-14   |         -1.0 |             -4.3 |         -3.3 | False         
[INFO] 2023-09-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -0.8 |             -0.3 |          0.5 | True          
[INFO] 2024-01-14   |          0.3 |              0.7 |          0.4 | True          
[INFO] 2024-03-14   |          0.5 |             -2.2 |         -2.7 | False         
[INFO] 2024-05-14   |          0.0 |              2.7 |          2.7 | True          
[INFO] 2024-07-14   |          2.0 |             -1.8 |         -3.8 | False         
[INFO] 2024-09-14   |         -1.1 |             -0.4 |          0.7 | True          
[INFO] 2024-11-14   |          1.9 |              1.9 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2023-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 17 periods (47.06% win rate)
[INFO] Updating Excel file with Hierarchical results for MME...
[INFO] Excel file updated successfully. Added MME with Hierarchical win rate 47.1% in row 33
[INFO] Added best Sharpe parameters 42/46 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 46
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(42/46) - Original Sharpe: 0.7704
[INFO] Added cluster 2 to portfolio: SMA(220/240) - Original Sharpe: 0.5861
[INFO] Added cluster 3 to portfolio: SMA(20/52) - Original Sharpe: 0.4844
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MME_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2853
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2991
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for MME...
[INFO] Excel file updated successfully. Added MME with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MME
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for MP1 in column D: 8.5
[INFO] Using slippage from Excel column D: 8.5
[INFO] 
Symbol: @MP1
[INFO] Description: Mexican Peso Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.0
[INFO] Big point value: 500000.0
[INFO] Data shape: (6149, 6)
[INFO] Date range: 2001-05-02 15:50:00 to 2025-04-07 15:50:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime     open     high      low    close  volume
0 2001-05-02 15:50:00  0.02978  0.02978  0.02893  0.02925    62.0
1 2001-05-07 15:50:00  0.03001  0.03043  0.02975  0.03043    72.0
2 2001-05-08 15:50:00  0.03065  0.03065  0.03023  0.03026     0.0
3 2001-05-09 15:50:00  0.03028  0.03048  0.03028  0.03043   184.0
4 2001-05-10 15:50:00  0.03063  0.03083  0.03063  0.03083    25.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 21.25 seconds (0.35 minutes)
[INFO] Best parameters found: Short SMA = 280, Long SMA = 296
[INFO] Best fitness (Sharpe ratio): 0.472932
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 280, Long SMA = 296, Sharpe = 0.472932
[INFO] Top 2: Short SMA = 126, Long SMA = 192, Sharpe = 0.453996
[INFO] Top 3: Short SMA = 296, Long SMA = 298, Sharpe = 0.445841
[INFO] Top 4: Short SMA = 288, Long SMA = 290, Sharpe = 0.440298
[INFO] Top 5: Short SMA = 122, Long SMA = 194, Sharpe = 0.433626
[INFO] Hall of Fame size: 1729
[INFO] Number of elements in all_results: 1231
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 498 had penalty fitness
[INFO] Total filtered from Hall of Fame: 498
[INFO] Hall of Fame -> all_results: 1729 -> 1231
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1231 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @MP1
[INFO] Big Point Value (from data): 500000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 21.52 contracts
[INFO] Maximum Position Size: 40 contracts
[INFO] Strategy Total P&L: $58,160.00
[INFO] Market Buy & Hold P&L: $-645.00
[INFO] Outperformance: $58,805.00
[INFO] Sharpe ratio (entire period, annualized): 0.084333
[INFO] Sharpe ratio (in-sample, annualized): 0.284852
[INFO] Sharpe ratio (out-of-sample, annualized): -0.379411
[INFO] Maximum Drawdown: $360,795.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $146,200.00
[INFO] Out-of-sample P&L: $-84,200.00
[INFO] 
Best parameters from GA: Short SMA = 280, Long SMA = 296, Sharpe = 0.472932
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 1729
[INFO] Cache hits (repeated combinations): 6882
[INFO] Total checks: 8611
[INFO] Cache hit rate: 79.92%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 500000.0
[INFO] Slippage: 8.5
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1231 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.7356 to 0.4729
[INFO] 
Best parameters:
[INFO] Short SMA: 280
[INFO] Long SMA: 296
[INFO] Sharpe Ratio: 0.472932
[INFO] Number of Trades: 21
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1231 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.7356 to 0.4729
[INFO] Trades range: 10.0 to 123.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5230 to 1.7744
[INFO] Scaled Long SMA range: -2.9014 to 1.3254
[INFO] Scaled Sharpe ratio range: -2.6348 to 2.4248
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 19
[INFO] Using 19 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=19...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 55 elements
[INFO] Kmeans Cluster 1: 102 elements
[INFO] Kmeans Cluster 2: 70 elements
[INFO] Kmeans Cluster 3: 72 elements
[INFO] Kmeans Cluster 4: 39 elements
[INFO] Kmeans Cluster 5: 79 elements
[INFO] Kmeans Cluster 6: 41 elements
[INFO] Kmeans Cluster 7: 85 elements
[INFO] Kmeans Cluster 8: 39 elements
[INFO] Kmeans Cluster 9: 68 elements
[INFO] Kmeans Cluster 10: 28 elements
[INFO] Kmeans Cluster 11: 63 elements
[INFO] Kmeans Cluster 12: 43 elements
[INFO] Kmeans Cluster 13: 104 elements
[INFO] Kmeans Cluster 14: 103 elements
[INFO] Kmeans Cluster 15: 62 elements
[INFO] Kmeans Cluster 16: 87 elements
[INFO] Kmeans Cluster 17: 46 elements
[INFO] Kmeans Cluster 18: 45 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=45.71, Long SMA=171.93, Sharpe=-0.1993
[INFO] Centroid 1: Short SMA=221.20, Long SMA=275.06, Sharpe=-0.4001
[INFO] Centroid 2: Short SMA=84.97, Long SMA=139.49, Sharpe=-0.0950
[INFO] Centroid 3: Short SMA=283.22, Long SMA=294.75, Sharpe=0.2791
[INFO] Centroid 4: Short SMA=17.18, Long SMA=168.87, Sharpe=0.1742
[INFO] Centroid 5: Short SMA=258.30, Long SMA=287.85, Sharpe=-0.0559
[INFO] Centroid 6: Short SMA=133.02, Long SMA=216.34, Sharpe=-0.0443
[INFO] Centroid 7: Short SMA=175.25, Long SMA=220.33, Sharpe=-0.3246
[INFO] Centroid 8: Short SMA=38.72, Long SMA=86.51, Sharpe=-0.1800
[INFO] Centroid 9: Short SMA=29.29, Long SMA=220.65, Sharpe=-0.0344
[INFO] Centroid 10: Short SMA=14.21, Long SMA=287.29, Sharpe=0.0791
[INFO] Centroid 11: Short SMA=127.97, Long SMA=185.24, Sharpe=0.3106
[INFO] Centroid 12: Short SMA=23.77, Long SMA=58.60, Sharpe=0.0624
[INFO] Centroid 13: Short SMA=134.81, Long SMA=174.60, Sharpe=0.1326
[INFO] Centroid 14: Short SMA=252.25, Long SMA=280.10, Sharpe=-0.2187
[INFO] Centroid 15: Short SMA=90.71, Long SMA=247.58, Sharpe=-0.2152
[INFO] Centroid 16: Short SMA=201.31, Long SMA=233.38, Sharpe=-0.4870
[INFO] Centroid 17: Short SMA=82.43, Long SMA=186.09, Sharpe=-0.0061
[INFO] Centroid 18: Short SMA=73.42, Long SMA=105.24, Sharpe=-0.3514
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=280, Long SMA=296, Sharpe=0.4729, Trades=21
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=128, Long SMA=188, Sharpe=0.3798, Trades=11
[INFO] Kmeans Top 2: Short SMA=284, Long SMA=294, Sharpe=0.3334, Trades=30
[INFO] Kmeans Top 3: Short SMA=18, Long SMA=56, Sharpe=0.2163, Trades=41
[INFO] Kmeans Top 4: Short SMA=20, Long SMA=172, Sharpe=0.1964, Trades=17
[INFO] Kmeans Top 5: Short SMA=12, Long SMA=292, Sharpe=0.0653, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18}
[INFO]   Rounded: (46, 172)
[INFO]   Rounded: (221, 275)
[INFO]   Nearest: (222.0, 276.0)
[INFO]   Rounded: (85, 139)
[INFO]   Nearest: (84.0, 140.0)
[INFO]   Rounded: (283, 295)
[INFO]   Nearest: (284.0, 294.0)
[INFO]   Rounded: (17, 169)
[INFO]   Nearest: (18.0, 168.0)
[INFO]   Rounded: (258, 288)
[INFO]   Rounded: (133, 216)
[INFO]   Nearest: (134.0, 216.0)
[INFO]   Rounded: (175, 220)
[INFO]   Nearest: (176.0, 220.0)
[INFO]   Rounded: (39, 87)
[INFO]   Nearest: (38.0, 86.0)
[INFO]   Rounded: (29, 221)
[INFO]   Nearest: (30.0, 220.0)
[INFO]   Rounded: (14, 287)
[INFO]   Nearest: (14.0, 288.0)
[INFO]   Rounded: (128, 185)
[INFO]   Nearest: (128.0, 186.0)
[INFO]   Rounded: (24, 59)
[INFO]   Nearest: (24.0, 60.0)
[INFO]   Rounded: (135, 175)
[INFO]   Nearest: (134.0, 174.0)
[INFO]   Rounded: (252, 280)
[INFO]   Rounded: (91, 248)
[INFO]   Nearest: (90.0, 248.0)
[INFO]   Rounded: (201, 233)
[INFO]   Nearest: (202.0, 234.0)
[INFO]   Rounded: (82, 186)
[INFO]   Rounded: (73, 105)
[INFO]   Nearest: (74.0, 106.0)
[INFO] Successfully plotted 19 out of 19 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 280, Long SMA: 296
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(128/188) - Original Sharpe: 0.3798, Trades: 11
[INFO] Kmeans cluster 2: SMA(284/294) - Original Sharpe: 0.3334, Trades: 30
[INFO] Kmeans cluster 3: SMA(18/56) - Original Sharpe: 0.2163, Trades: 41
[INFO] Kmeans cluster 4: SMA(20/172) - Original Sharpe: 0.1964, Trades: 17
[INFO] Kmeans cluster 5: SMA(12/292) - Original Sharpe: 0.0653, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (280/296)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (128/188) - Sharpe: 0.3798
[INFO] cluster 2: (284/294) - Sharpe: 0.3334
[INFO] cluster 3: (18/56) - Sharpe: 0.2163
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.716042           -2.998862
1    2021-11-14 2021-11-14            43     0.712436           -1.763424
2    2022-01-14 2022-01-14            41     0.273468            0.615751
3    2022-03-14 2022-03-14            44     2.756615           -1.361100
4    2022-05-14 2022-05-14            43    -1.026268           -0.827222
5    2022-07-14 2022-07-14            44     2.174461            0.676307
6    2022-09-14 2022-09-14            43     2.833979            2.833979
7    2022-11-14 2022-11-14            43     2.849639            2.849639
8    2023-01-14 2023-01-14            41     0.249214            0.249214
9    2023-03-14 2023-03-14            44     4.663682            4.663682
10   2023-05-14 2023-05-14            44     3.615384            3.615384
11   2023-07-14 2023-07-14            44    -0.398216           -0.398216
12   2023-09-14 2023-09-14            43    -1.304784           -1.230519
13   2023-11-14 2023-11-14            42     3.397164            2.708785
14   2024-01-14 2024-01-14            43     2.512948            2.512948
15   2024-03-14 2024-03-14            42    -0.165280           -0.461332
16   2024-05-14 2024-05-14            44    -1.994953           -2.469702
17   2024-07-14 2024-07-14            45    -2.901414           -3.794471
18   2024-09-14 2024-09-14            43    -3.750913            1.420815
19   2024-11-14 2024-11-14            33     4.998268            1.833648
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |             -3.0 |         -1.3 | False         
[INFO] 2021-11-14   |          0.7 |             -1.8 |         -2.5 | False         
[INFO] 2022-01-14   |          0.3 |              0.6 |          0.3 | True          
[INFO] 2022-03-14   |          2.8 |             -1.4 |         -4.2 | False         
[INFO] 2022-05-14   |         -1.0 |             -0.8 |          0.2 | True          
[INFO] 2022-07-14   |          2.2 |              0.7 |         -1.5 | False         
[INFO] 2022-09-14   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2023-01-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          4.7 |              4.7 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -1.3 |             -1.2 |          0.1 | True          
[INFO] 2023-11-14   |          3.4 |              2.7 |         -0.7 | False         
[INFO] 2024-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.2 |             -0.5 |         -0.3 | False         
[INFO] 2024-05-14   |         -2.0 |             -2.5 |         -0.5 | False         
[INFO] 2024-07-14   |         -2.9 |             -3.8 |         -0.9 | False         
[INFO] 2024-09-14   |         -3.8 |              1.4 |          5.2 | True          
[INFO] 2024-11-14   |          5.0 |              1.8 |         -3.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-09-14, 2022-11-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2024-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 4 of 13 periods (30.77% win rate)
[INFO] Updating Excel file with Kmeans results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Kmeans win rate 30.8% in row 34
[INFO] Added best Sharpe parameters 280/296 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 280, Long SMA: 296
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(128/188) - Original Sharpe: 0.3798
[INFO] Added cluster 2 to portfolio: SMA(284/294) - Original Sharpe: 0.3334
[INFO] Added cluster 3 to portfolio: SMA(18/56) - Original Sharpe: 0.2163
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MP1_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.5190
[INFO] Kmeans Best out-of-sample Sharpe: 0.5866
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MP1
[INFO] Big Point Value: 500000.0
[INFO] Slippage: 8.5
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1231 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.7356 to 0.4729
[INFO] 
Best parameters:
[INFO] Short SMA: 280
[INFO] Long SMA: 296
[INFO] Sharpe Ratio: 0.472932
[INFO] Number of Trades: 21
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1231 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.7356 to 0.4729
[INFO] Trades range: 10.0 to 123.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5230 to 1.7744
[INFO] Scaled Long SMA range: -2.9014 to 1.3254
[INFO] Scaled Sharpe ratio range: -2.6348 to 2.4248
[INFO] Scaled Trades range: -0.7455 to 6.8405
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1231 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6031
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 94 elements
[INFO] Cluster 1: 25 elements
[INFO] Cluster 2: 174 elements
[INFO] Cluster 3: 144 elements
[INFO] Cluster 4: 42 elements
[INFO] Cluster 5: 160 elements
[INFO] Cluster 6: 92 elements
[INFO] Cluster 7: 100 elements
[INFO] Cluster 8: 100 elements
[INFO] Cluster 9: 18 elements
[INFO] Cluster 10: 34 elements
[INFO] Cluster 11: 4 elements
[INFO] Cluster 12: 25 elements
[INFO] Cluster 13: 69 elements
[INFO] Cluster 14: 31 elements
[INFO] Cluster 15: 55 elements
[INFO] Cluster 16: 64 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=54, Long SMA=102, Sharpe=-0.4631, Trades=20
[INFO] Cluster 1 cluster: Short SMA=200, Long SMA=202, Sharpe=-0.4015, Trades=73
[INFO] Cluster 2 cluster: Short SMA=56, Long SMA=206, Sharpe=-0.1738, Trades=13
[INFO] Cluster 3 cluster: Short SMA=254, Long SMA=288, Sharpe=-0.1947, Trades=13
[INFO] Cluster 4 cluster: Short SMA=244, Long SMA=250, Sharpe=-0.1109, Trades=40
[INFO] Cluster 5 cluster: Short SMA=210, Long SMA=266, Sharpe=-0.4350, Trades=12
[INFO] Cluster 6 cluster: Short SMA=130, Long SMA=194, Sharpe=0.3218, Trades=11
[INFO] Cluster 7 cluster: Short SMA=64, Long SMA=152, Sharpe=-0.0735, Trades=14
[INFO] Cluster 8 cluster: Short SMA=110, Long SMA=248, Sharpe=-0.1611, Trades=11
[INFO] Cluster 10 cluster: Short SMA=28, Long SMA=46, Sharpe=0.2578, Trades=52
[INFO] Cluster 12 cluster: Short SMA=12, Long SMA=292, Sharpe=0.0653, Trades=15
[INFO] Cluster 13 cluster: Short SMA=136, Long SMA=166, Sharpe=0.1501, Trades=25
[INFO] Cluster 14 cluster: Short SMA=14, Long SMA=162, Sharpe=0.1931, Trades=20
[INFO] Cluster 15 cluster: Short SMA=196, Long SMA=212, Sharpe=-0.4340, Trades=25
[INFO] Cluster 16 cluster: Short SMA=280, Long SMA=294, Sharpe=0.3256, Trades=29
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=280, Long SMA=296, Sharpe=0.4729, Trades=21
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=280, Long SMA=294, Sharpe=0.3256, Trades=29
[INFO] Top 2: Short SMA=130, Long SMA=194, Sharpe=0.3218, Trades=11
[INFO] Top 3: Short SMA=28, Long SMA=46, Sharpe=0.2578, Trades=52
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 1209 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 280, Long SMA: 296
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(280/294) - Original Sharpe: 0.3256, Trades: 29
[INFO] Hierarchical cluster 2: SMA(130/194) - Original Sharpe: 0.3218, Trades: 11
[INFO] Hierarchical cluster 3: SMA(28/46) - Original Sharpe: 0.2578, Trades: 52
[INFO] Hierarchical cluster 4: SMA(14/162) - Original Sharpe: 0.1931, Trades: 20
[INFO] Hierarchical cluster 5: SMA(136/166) - Original Sharpe: 0.1501, Trades: 25
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (280/296)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (280/294) - Sharpe: 0.3256
[INFO] cluster 2: (130/194) - Sharpe: 0.3218
[INFO] cluster 3: (28/46) - Sharpe: 0.2578
[INFO] Loading MP1 data from local files...
[INFO] Found data file: A_OHLCV_@MP1_minutes_1440_1710-1550.dat
[INFO] File size: 295292 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.716042           -2.541878
1    2021-11-14 2021-11-14            43     0.712436           -2.398797
2    2022-01-14 2022-01-14            41     0.273468            0.400245
3    2022-03-14 2022-03-14            44     2.756615            1.135182
4    2022-05-14 2022-05-14            43    -1.026268           -1.414851
5    2022-07-14 2022-07-14            44     2.174461            1.474378
6    2022-09-14 2022-09-14            43     2.833979            2.833979
7    2022-11-14 2022-11-14            43     2.849639            2.678455
8    2023-01-14 2023-01-14            41     0.249214            0.249214
9    2023-03-14 2023-03-14            44     4.663682            4.663682
10   2023-05-14 2023-05-14            44     3.615384            3.615384
11   2023-07-14 2023-07-14            44    -0.398216           -1.214694
12   2023-09-14 2023-09-14            43    -1.304784           -1.304784
13   2023-11-14 2023-11-14            42     3.397164            2.627514
14   2024-01-14 2024-01-14            43     2.512948            2.304055
15   2024-03-14 2024-03-14            42    -0.165280           -0.148290
16   2024-05-14 2024-05-14            44    -1.994953           -1.994953
17   2024-07-14 2024-07-14            45    -2.901414           -1.434614
18   2024-09-14 2024-09-14            43    -3.750913            0.033948
19   2024-11-14 2024-11-14            33     4.998268            2.038273
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |             -2.5 |         -0.8 | False         
[INFO] 2021-11-14   |          0.7 |             -2.4 |         -3.1 | False         
[INFO] 2022-01-14   |          0.3 |              0.4 |          0.1 | True          
[INFO] 2022-03-14   |          2.8 |              1.1 |         -1.7 | False         
[INFO] 2022-05-14   |         -1.0 |             -1.4 |         -0.4 | False         
[INFO] 2022-07-14   |          2.2 |              1.5 |         -0.7 | False         
[INFO] 2022-09-14   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.8 |              2.7 |         -0.1 | False         
[INFO] 2023-01-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          4.7 |              4.7 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.4 |             -1.2 |         -0.8 | False         
[INFO] 2023-09-14   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              2.6 |         -0.8 | False         
[INFO] 2024-01-14   |          2.5 |              2.3 |         -0.2 | False         
[INFO] 2024-03-14   |         -0.2 |             -0.1 |          0.1 | True          
[INFO] 2024-05-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.9 |             -1.4 |          1.5 | True          
[INFO] 2024-09-14   |         -3.8 |              0.0 |          3.8 | True          
[INFO] 2024-11-14   |          5.0 |              2.0 |         -3.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-09-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-09-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 14 periods (28.57% win rate)
[INFO] Updating Excel file with Hierarchical results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Hierarchical win rate 28.6% in row 34
[INFO] Added best Sharpe parameters 280/296 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 280, Long SMA: 296
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(280/294) - Original Sharpe: 0.3256
[INFO] Added cluster 2 to portfolio: SMA(130/194) - Original Sharpe: 0.3218
[INFO] Added cluster 3 to portfolio: SMA(28/46) - Original Sharpe: 0.2578
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'MP1_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.7273
[INFO] Hierarchical Best out-of-sample Sharpe: 0.5866
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for MP1...
[INFO] Excel file updated successfully. Added MP1 with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\MP1
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NE1 in column D: 9.0
[INFO] Using slippage from Excel column D: 9.0
[INFO] 
Symbol: @NE1
[INFO] Description: New Zealand Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.000000000000001
[INFO] Big point value: 100000.0
[INFO] Data shape: (2974, 6)
[INFO] Date range: 2013-10-01 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close   volume
0 2013-10-01 15:57:00  0.7605  0.7625  0.7594  0.7617   3071.0
1 2013-10-02 15:57:00  0.7611  0.7674  0.7534  0.7671  16429.0
2 2013-10-03 15:57:00  0.7659  0.7687  0.7618  0.7638  10418.0
3 2013-10-04 15:57:00  0.7633  0.7695  0.7623  0.7661   9952.0
4 2013-10-07 15:57:00  0.7660  0.7679  0.7614  0.7650   8102.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 64
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 25.10 seconds (0.42 minutes)
[INFO] Best parameters found: Short SMA = 256, Long SMA = 258
[INFO] Best fitness (Sharpe ratio): 0.563594
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 256, Long SMA = 258, Sharpe = 0.563594
[INFO] Top 2: Short SMA = 254, Long SMA = 258, Sharpe = 0.537624
[INFO] Top 3: Short SMA = 252, Long SMA = 258, Sharpe = 0.508085
[INFO] Top 4: Short SMA = 168, Long SMA = 172, Sharpe = 0.496272
[INFO] Top 5: Short SMA = 252, Long SMA = 260, Sharpe = 0.489416
[INFO] Hall of Fame size: 1856
[INFO] Number of elements in all_results: 1573
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 283 had penalty fitness
[INFO] Total filtered from Hall of Fame: 283
[INFO] Hall of Fame -> all_results: 1856 -> 1573
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1573 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 2906, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NE1
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.80 contracts
[INFO] Maximum Position Size: 16 contracts
[INFO] Strategy Total P&L: $238,490.00
[INFO] Market Buy & Hold P&L: $-19,895.00
[INFO] Outperformance: $258,385.00
[INFO] Sharpe ratio (entire period, annualized): 0.328244
[INFO] Sharpe ratio (in-sample, annualized): 0.134848
[INFO] Sharpe ratio (out-of-sample, annualized): 0.787982
[INFO] Maximum Drawdown: $153,300.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $69,015.00
[INFO] Out-of-sample P&L: $169,665.00
[INFO] 
Best parameters from GA: Short SMA = 256, Long SMA = 258, Sharpe = 0.563594
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 1856
[INFO] Cache hits (repeated combinations): 6767
[INFO] Total checks: 8623
[INFO] Cache hit rate: 78.48%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1573 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.7375 to 0.5636
[INFO] 
Best parameters:
[INFO] Short SMA: 256
[INFO] Long SMA: 258
[INFO] Sharpe Ratio: 0.563594
[INFO] Number of Trades: 43
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1573 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.7375 to 0.5636
[INFO] Trades range: 10.0 to 189.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.7771 to 1.6792
[INFO] Scaled Long SMA range: -3.4799 to 1.0898
[INFO] Scaled Sharpe ratio range: -2.8105 to 2.1542
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 13
[INFO] Using 13 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=13...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 237 elements
[INFO] Kmeans Cluster 1: 128 elements
[INFO] Kmeans Cluster 2: 88 elements
[INFO] Kmeans Cluster 3: 136 elements
[INFO] Kmeans Cluster 4: 81 elements
[INFO] Kmeans Cluster 5: 117 elements
[INFO] Kmeans Cluster 6: 103 elements
[INFO] Kmeans Cluster 7: 66 elements
[INFO] Kmeans Cluster 8: 169 elements
[INFO] Kmeans Cluster 9: 72 elements
[INFO] Kmeans Cluster 10: 106 elements
[INFO] Kmeans Cluster 11: 73 elements
[INFO] Kmeans Cluster 12: 197 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=255.64, Long SMA=281.18, Sharpe=0.3463
[INFO] Centroid 1: Short SMA=74.02, Long SMA=248.77, Sharpe=-0.1572
[INFO] Centroid 2: Short SMA=67.09, Long SMA=113.36, Sharpe=-0.3427
[INFO] Centroid 3: Short SMA=168.26, Long SMA=219.99, Sharpe=-0.0708
[INFO] Centroid 4: Short SMA=24.54, Long SMA=269.95, Sharpe=0.0417
[INFO] Centroid 5: Short SMA=60.48, Long SMA=186.75, Sharpe=-0.4940
[INFO] Centroid 6: Short SMA=213.38, Long SMA=270.19, Sharpe=-0.0145
[INFO] Centroid 7: Short SMA=27.61, Long SMA=71.42, Sharpe=-0.0116
[INFO] Centroid 8: Short SMA=142.24, Long SMA=264.66, Sharpe=0.2148
[INFO] Centroid 9: Short SMA=120.72, Long SMA=168.31, Sharpe=-0.2594
[INFO] Centroid 10: Short SMA=219.34, Long SMA=250.00, Sharpe=-0.2421
[INFO] Centroid 11: Short SMA=149.42, Long SMA=179.84, Sharpe=0.0330
[INFO] Centroid 12: Short SMA=254.10, Long SMA=286.82, Sharpe=0.1961
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=256, Long SMA=258, Sharpe=0.5636, Trades=43
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=252, Long SMA=280, Sharpe=0.3379, Trades=17
[INFO] Kmeans Top 2: Short SMA=140, Long SMA=264, Sharpe=0.2073, Trades=11
[INFO] Kmeans Top 3: Short SMA=254, Long SMA=286, Sharpe=0.1085, Trades=17
[INFO] Kmeans Top 4: Short SMA=26, Long SMA=70, Sharpe=0.0607, Trades=32
[INFO] Kmeans Top 5: Short SMA=150, Long SMA=176, Sharpe=0.0359, Trades=14
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12}
[INFO]   Rounded: (256, 281)
[INFO]   Nearest: (256.0, 282.0)
[INFO]   Rounded: (74, 249)
[INFO]   Nearest: (74.0, 248.0)
[INFO]   Rounded: (67, 113)
[INFO]   Nearest: (68.0, 114.0)
[INFO]   Rounded: (168, 220)
[INFO]   Rounded: (25, 270)
[INFO]   Nearest: (24.0, 270.0)
[INFO]   Rounded: (60, 187)
[INFO]   Nearest: (60.0, 186.0)
[INFO]   Rounded: (213, 270)
[INFO]   Nearest: (214.0, 270.0)
[INFO]   Rounded: (28, 71)
[INFO]   Nearest: (28.0, 72.0)
[INFO]   Rounded: (142, 265)
[INFO]   Nearest: (142.0, 264.0)
[INFO]   Rounded: (121, 168)
[INFO]   Nearest: (120.0, 168.0)
[INFO]   Rounded: (219, 250)
[INFO]   Nearest: (220.0, 250.0)
[INFO]   Rounded: (149, 180)
[INFO]   Nearest: (150.0, 180.0)
[INFO]   Rounded: (254, 287)
[INFO]   Nearest: (254.0, 286.0)
[INFO] Successfully plotted 13 out of 13 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 256, Long SMA: 258
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 64
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(252/280) - Original Sharpe: 0.3379, Trades: 17
[INFO] Kmeans cluster 2: SMA(140/264) - Original Sharpe: 0.2073, Trades: 11
[INFO] Kmeans cluster 3: SMA(254/286) - Original Sharpe: 0.1085, Trades: 17
[INFO] Kmeans cluster 4: SMA(26/70) - Original Sharpe: 0.0607, Trades: 32
[INFO] Kmeans cluster 5: SMA(150/176) - Original Sharpe: 0.0359, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (256/258)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (252/280) - Sharpe: 0.3379
[INFO] cluster 2: (140/264) - Sharpe: 0.2073
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.711854            0.487396
1    2021-11-14 2021-11-14            43    -3.233762           -1.095649
2    2022-01-14 2022-01-14            41     0.749001            0.749001
3    2022-03-14 2022-03-14            44     5.053538            3.657765
4    2022-05-14 2022-05-14            43     1.252080            1.252080
5    2022-07-14 2022-07-14            44     0.795112            0.795112
6    2022-09-14 2022-09-14            43    -0.063770           -0.063770
7    2022-11-14 2022-11-14            43    -1.653258           -1.653258
8    2023-01-14 2023-01-14            41     1.658465            1.658465
9    2023-03-14 2023-03-14            44     0.152591            0.457308
10   2023-05-14 2023-05-14            44     2.609347            0.000000
11   2023-07-14 2023-07-14            44     5.142236           -0.161595
12   2023-09-14 2023-09-14            43    -0.439515            2.700360
13   2023-11-14 2023-11-14            42    -3.296246           -1.132108
14   2024-01-14 2024-01-14            43     1.808739            0.911910
15   2024-03-14 2024-03-14            42     1.804454            1.769457
16   2024-05-14 2024-05-14            44     1.781218            0.000000
17   2024-07-14 2024-07-14            45     2.985026            0.080762
18   2024-09-14 2024-09-14            43    -2.631803           -0.921226
19   2024-11-14 2024-11-14            33     2.695822            4.081437
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.7 |              0.5 |          1.2 | True          
[INFO] 2021-11-14   |         -3.2 |             -1.1 |          2.1 | True          
[INFO] 2022-01-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          5.1 |              3.7 |         -1.4 | False         
[INFO] 2022-05-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.2 |              0.5 |          0.3 | True          
[INFO] 2023-05-14   |          2.6 |              0.0 |         -2.6 | False         
[INFO] 2023-07-14   |          5.1 |             -0.2 |         -5.3 | False         
[INFO] 2023-09-14   |         -0.4 |              2.7 |          3.1 | True          
[INFO] 2023-11-14   |         -3.3 |             -1.1 |          2.2 | True          
[INFO] 2024-01-14   |          1.8 |              0.9 |         -0.9 | False         
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.8 |              0.0 |         -1.8 | False         
[INFO] 2024-07-14   |          3.0 |              0.1 |         -2.9 | False         
[INFO] 2024-09-14   |         -2.6 |             -0.9 |          1.7 | True          
[INFO] 2024-11-14   |          2.7 |              4.1 |          1.4 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 7 of 13 periods (53.85% win rate)
[INFO] Updating Excel file with Kmeans results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Kmeans win rate 53.8% in row 35
[INFO] Added best Sharpe parameters 256/258 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 256, Long SMA: 258
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(252/280) - Original Sharpe: 0.3379
[INFO] Added cluster 2 to portfolio: SMA(140/264) - Original Sharpe: 0.2073
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NE1_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.7040
[INFO] Kmeans Best out-of-sample Sharpe: 0.8147
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NE1
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 9.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1573 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.7375 to 0.5636
[INFO] 
Best parameters:
[INFO] Short SMA: 256
[INFO] Long SMA: 258
[INFO] Sharpe Ratio: 0.563594
[INFO] Number of Trades: 43
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1573 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.7375 to 0.5636
[INFO] Trades range: 10.0 to 189.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.7771 to 1.6792
[INFO] Scaled Long SMA range: -3.4799 to 1.0898
[INFO] Scaled Sharpe ratio range: -2.8105 to 2.1542
[INFO] Scaled Trades range: -0.7095 to 15.4172
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1573 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6518
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 20
[INFO] Using 20 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 20 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 28 elements
[INFO] Cluster 1: 133 elements
[INFO] Cluster 2: 82 elements
[INFO] Cluster 3: 109 elements
[INFO] Cluster 4: 251 elements
[INFO] Cluster 5: 102 elements
[INFO] Cluster 6: 7 elements
[INFO] Cluster 7: 149 elements
[INFO] Cluster 8: 125 elements
[INFO] Cluster 9: 123 elements
[INFO] Cluster 10: 82 elements
[INFO] Cluster 11: 15 elements
[INFO] Cluster 12: 1 elements
[INFO] Cluster 13: 69 elements
[INFO] Cluster 14: 22 elements
[INFO] Cluster 15: 24 elements
[INFO] Cluster 16: 33 elements
[INFO] Cluster 17: 90 elements
[INFO] Cluster 18: 19 elements
[INFO] Cluster 19: 109 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=200, Long SMA=204, Sharpe=-0.0069, Trades=35
[INFO] Cluster 1 cluster: Short SMA=132, Long SMA=236, Sharpe=0.0711, Trades=11
[INFO] Cluster 2 cluster: Short SMA=94, Long SMA=132, Sharpe=-0.3202, Trades=16
[INFO] Cluster 3 cluster: Short SMA=28, Long SMA=266, Sharpe=-0.0658, Trades=12
[INFO] Cluster 4 cluster: Short SMA=252, Long SMA=282, Sharpe=0.3327, Trades=17
[INFO] Cluster 5 cluster: Short SMA=148, Long SMA=186, Sharpe=-0.0843, Trades=14
[INFO] Cluster 7 cluster: Short SMA=142, Long SMA=266, Sharpe=0.2741, Trades=11
[INFO] Cluster 8 cluster: Short SMA=208, Long SMA=236, Sharpe=-0.2169, Trades=15
[INFO] Cluster 9 cluster: Short SMA=60, Long SMA=184, Sharpe=-0.5437, Trades=14
[INFO] Cluster 10 cluster: Short SMA=270, Long SMA=280, Sharpe=0.1685, Trades=27
[INFO] Cluster 13 cluster: Short SMA=84, Long SMA=228, Sharpe=-0.2895, Trades=12
[INFO] Cluster 14 cluster: Short SMA=92, Long SMA=104, Sharpe=-0.5164, Trades=32
[INFO] Cluster 15 cluster: Short SMA=28, Long SMA=62, Sharpe=0.1317, Trades=35
[INFO] Cluster 16 cluster: Short SMA=26, Long SMA=98, Sharpe=-0.1666, Trades=24
[INFO] Cluster 17 cluster: Short SMA=210, Long SMA=276, Sharpe=-0.1984, Trades=13
[INFO] Cluster 19 cluster: Short SMA=238, Long SMA=292, Sharpe=0.2077, Trades=13
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=256, Long SMA=258, Sharpe=0.5636, Trades=43
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=252, Long SMA=282, Sharpe=0.3327, Trades=17
[INFO] Top 2: Short SMA=142, Long SMA=266, Sharpe=0.2741, Trades=11
[INFO] Top 3: Short SMA=238, Long SMA=292, Sharpe=0.2077, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 1531 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 256, Long SMA: 258
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 64
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(252/282) - Original Sharpe: 0.3327, Trades: 17
[INFO] Hierarchical cluster 2: SMA(142/266) - Original Sharpe: 0.2741, Trades: 11
[INFO] Hierarchical cluster 3: SMA(238/292) - Original Sharpe: 0.2077, Trades: 13
[INFO] Hierarchical cluster 4: SMA(270/280) - Original Sharpe: 0.1685, Trades: 27
[INFO] Hierarchical cluster 5: SMA(28/62) - Original Sharpe: 0.1317, Trades: 35
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (256/258)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (252/282) - Sharpe: 0.3327
[INFO] cluster 2: (142/266) - Sharpe: 0.2741
[INFO] cluster 3: (238/292) - Sharpe: 0.2077
[INFO] Loading NE1 data from local files...
[INFO] Found data file: A_OHLCV_@NE1_minutes_1440_1703-1557.dat
[INFO] File size: 142891 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.711854           -0.353226
1    2021-11-14 2021-11-14            43    -3.233762           -1.867982
2    2022-01-14 2022-01-14            41     0.749001            0.749001
3    2022-03-14 2022-03-14            44     5.053538            3.657765
4    2022-05-14 2022-05-14            43     1.252080            1.252080
5    2022-07-14 2022-07-14            44     0.795112            0.795112
6    2022-09-14 2022-09-14            43    -0.063770           -0.063770
7    2022-11-14 2022-11-14            43    -1.653258           -1.653258
8    2023-01-14 2023-01-14            41     1.658465            1.658465
9    2023-03-14 2023-03-14            44     0.152591           -0.097403
10   2023-05-14 2023-05-14            44     2.609347           -1.646162
11   2023-07-14 2023-07-14            44     5.142236            4.458699
12   2023-09-14 2023-09-14            43    -0.439515            0.119635
13   2023-11-14 2023-11-14            42    -3.296246            1.027264
14   2024-01-14 2024-01-14            43     1.808739            0.911910
15   2024-03-14 2024-03-14            42     1.804454            1.804454
16   2024-05-14 2024-05-14            44     1.781218           -1.778013
17   2024-07-14 2024-07-14            45     2.985026           -0.045784
18   2024-09-14 2024-09-14            43    -2.631803           -1.744982
19   2024-11-14 2024-11-14            33     2.695822            4.254693
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.7 |             -0.4 |          0.3 | True          
[INFO] 2021-11-14   |         -3.2 |             -1.9 |          1.3 | True          
[INFO] 2022-01-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2022-03-14   |          5.1 |              3.7 |         -1.4 | False         
[INFO] 2022-05-14   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.2 |             -0.1 |         -0.3 | False         
[INFO] 2023-05-14   |          2.6 |             -1.6 |         -4.2 | False         
[INFO] 2023-07-14   |          5.1 |              4.5 |         -0.6 | False         
[INFO] 2023-09-14   |         -0.4 |              0.1 |          0.5 | True          
[INFO] 2023-11-14   |         -3.3 |              1.0 |          4.3 | True          
[INFO] 2024-01-14   |          1.8 |              0.9 |         -0.9 | False         
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.8 |             -1.8 |         -3.6 | False         
[INFO] 2024-07-14   |          3.0 |             -0.0 |         -3.0 | False         
[INFO] 2024-09-14   |         -2.6 |             -1.7 |          0.9 | True          
[INFO] 2024-11-14   |          2.7 |              4.3 |          1.6 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 13 periods (46.15% win rate)
[INFO] Updating Excel file with Hierarchical results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Hierarchical win rate 46.2% in row 35
[INFO] Added best Sharpe parameters 256/258 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 256, Long SMA: 258
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(252/282) - Original Sharpe: 0.3327
[INFO] Added cluster 2 to portfolio: SMA(142/266) - Original Sharpe: 0.2741
[INFO] Added cluster 3 to portfolio: SMA(238/292) - Original Sharpe: 0.2077
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NE1_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.5620
[INFO] Hierarchical Best out-of-sample Sharpe: 0.8147
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for NE1...
[INFO] Excel file updated successfully. Added NE1 with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NE1
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NG in column D: 15.0
[INFO] Using slippage from Excel column D: 15.0
[INFO] 
Symbol: @NG
[INFO] Description: Natural Gas Continuous Contract [May25]
[INFO] Exchange: NYMEX
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 10000.0
[INFO] Data shape: (6121, 6)
[INFO] Date range: 2001-05-02 16:55:00 to 2025-04-07 16:55:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-02 16:55:00  31.458  31.461  31.329  31.353   629.0
1 2001-05-03 16:55:00  31.338  31.338  31.294  31.298   670.0
2 2001-05-07 16:55:00  31.328  31.328  31.109  31.128   272.0
3 2001-05-08 16:55:00  31.108  31.198  31.089  31.163  1101.0
4 2001-05-09 16:55:00  31.185  31.185  31.080  31.113  1064.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 28.74 seconds (0.48 minutes)
[INFO] Best parameters found: Short SMA = 66, Long SMA = 188
[INFO] Best fitness (Sharpe ratio): 0.835698
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 66, Long SMA = 188, Sharpe = 0.835698
[INFO] Top 2: Short SMA = 66, Long SMA = 190, Sharpe = 0.827318
[INFO] Top 3: Short SMA = 80, Long SMA = 154, Sharpe = 0.817725
[INFO] Top 4: Short SMA = 68, Long SMA = 110, Sharpe = 0.817622
[INFO] Top 5: Short SMA = 66, Long SMA = 186, Sharpe = 0.810161
[INFO] Hall of Fame size: 2580
[INFO] Number of elements in all_results: 1746
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 834 had penalty fitness
[INFO] Total filtered from Hall of Fame: 834
[INFO] Hall of Fame -> all_results: 2580 -> 1746
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1746 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3106, Evaluation data length: 2839
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NG
[INFO] Big Point Value (from data): 10000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.73 contracts
[INFO] Maximum Position Size: 13 contracts
[INFO] Strategy Total P&L: $98,050.00
[INFO] Market Buy & Hold P&L: $-82,800.00
[INFO] Outperformance: $180,850.00
[INFO] Sharpe ratio (entire period, annualized): 0.173039
[INFO] Sharpe ratio (in-sample, annualized): 0.141053
[INFO] Sharpe ratio (out-of-sample, annualized): 0.239180
[INFO] Maximum Drawdown: $294,730.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $80,630.00
[INFO] Out-of-sample P&L: $67,090.00
[INFO] 
Best parameters from GA: Short SMA = 66, Long SMA = 188, Sharpe = 0.835698
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2580
[INFO] Cache hits (repeated combinations): 6037
[INFO] Total checks: 8617
[INFO] Cache hit rate: 70.06%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 10000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1746 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.5760 to 0.8357
[INFO] 
Best parameters:
[INFO] Short SMA: 66
[INFO] Long SMA: 188
[INFO] Sharpe Ratio: 0.835698
[INFO] Number of Trades: 11
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1746 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.5760 to 0.8357
[INFO] Trades range: 10.0 to 192.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1485 to 2.6916
[INFO] Scaled Long SMA range: -2.4204 to 2.1320
[INFO] Scaled Sharpe ratio range: -2.9709 to 1.5218
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 200 elements
[INFO] Kmeans Cluster 1: 87 elements
[INFO] Kmeans Cluster 2: 116 elements
[INFO] Kmeans Cluster 3: 73 elements
[INFO] Kmeans Cluster 4: 84 elements
[INFO] Kmeans Cluster 5: 152 elements
[INFO] Kmeans Cluster 6: 86 elements
[INFO] Kmeans Cluster 7: 128 elements
[INFO] Kmeans Cluster 8: 30 elements
[INFO] Kmeans Cluster 9: 63 elements
[INFO] Kmeans Cluster 10: 124 elements
[INFO] Kmeans Cluster 11: 88 elements
[INFO] Kmeans Cluster 12: 93 elements
[INFO] Kmeans Cluster 13: 154 elements
[INFO] Kmeans Cluster 14: 208 elements
[INFO] Kmeans Cluster 15: 60 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=78.87, Long SMA=156.76, Sharpe=0.6787
[INFO] Centroid 1: Short SMA=235.91, Long SMA=256.80, Sharpe=-0.1587
[INFO] Centroid 2: Short SMA=19.53, Long SMA=152.28, Sharpe=0.2613
[INFO] Centroid 3: Short SMA=165.64, Long SMA=189.26, Sharpe=-0.0419
[INFO] Centroid 4: Short SMA=24.26, Long SMA=261.31, Sharpe=0.3542
[INFO] Centroid 5: Short SMA=44.86, Long SMA=153.62, Sharpe=0.5446
[INFO] Centroid 6: Short SMA=137.35, Long SMA=167.40, Sharpe=0.3468
[INFO] Centroid 7: Short SMA=268.08, Long SMA=289.48, Sharpe=-0.3170
[INFO] Centroid 8: Short SMA=118.60, Long SMA=129.73, Sharpe=0.1738
[INFO] Centroid 9: Short SMA=21.75, Long SMA=64.98, Sharpe=-0.0040
[INFO] Centroid 10: Short SMA=53.95, Long SMA=84.40, Sharpe=0.4524
[INFO] Centroid 11: Short SMA=80.30, Long SMA=196.73, Sharpe=0.3706
[INFO] Centroid 12: Short SMA=102.60, Long SMA=135.70, Sharpe=0.4541
[INFO] Centroid 13: Short SMA=51.82, Long SMA=189.68, Sharpe=0.6309
[INFO] Centroid 14: Short SMA=64.39, Long SMA=112.20, Sharpe=0.6246
[INFO] Centroid 15: Short SMA=210.20, Long SMA=227.07, Sharpe=0.1707
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=66, Long SMA=188, Sharpe=0.8357, Trades=11
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=78, Long SMA=156, Sharpe=0.7361, Trades=11
[INFO] Kmeans Top 2: Short SMA=52, Long SMA=188, Sharpe=0.6847, Trades=11
[INFO] Kmeans Top 3: Short SMA=44, Long SMA=154, Sharpe=0.5892, Trades=16
[INFO] Kmeans Top 4: Short SMA=52, Long SMA=82, Sharpe=0.5754, Trades=24
[INFO] Kmeans Top 5: Short SMA=66, Long SMA=112, Sharpe=0.5145, Trades=24
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (79, 157)
[INFO]   Nearest: (78.0, 156.0)
[INFO]   Rounded: (236, 257)
[INFO]   Nearest: (236.0, 256.0)
[INFO]   Rounded: (20, 152)
[INFO]   Rounded: (166, 189)
[INFO]   Nearest: (166.0, 190.0)
[INFO]   Rounded: (24, 261)
[INFO]   Nearest: (24.0, 262.0)
[INFO]   Rounded: (45, 154)
[INFO]   Nearest: (44.0, 154.0)
[INFO]   Rounded: (137, 167)
[INFO]   Nearest: (138.0, 168.0)
[INFO]   Rounded: (268, 289)
[INFO]   Nearest: (268.0, 290.0)
[INFO]   Rounded: (119, 130)
[INFO]   Nearest: (118.0, 130.0)
[INFO]   Rounded: (22, 65)
[INFO]   Nearest: (22.0, 64.0)
[INFO]   Rounded: (54, 84)
[INFO]   Rounded: (80, 197)
[INFO]   Nearest: (80.0, 196.0)
[INFO]   Rounded: (103, 136)
[INFO]   Nearest: (102.0, 136.0)
[INFO]   Rounded: (52, 190)
[INFO]   Rounded: (64, 112)
[INFO]   Rounded: (210, 227)
[INFO]   Nearest: (212.0, 228.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 66, Long SMA: 188
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(78/156) - Original Sharpe: 0.7361, Trades: 11
[INFO] Kmeans cluster 2: SMA(52/188) - Original Sharpe: 0.6847, Trades: 11
[INFO] Kmeans cluster 3: SMA(44/154) - Original Sharpe: 0.5892, Trades: 16
[INFO] Kmeans cluster 4: SMA(52/82) - Original Sharpe: 0.5754, Trades: 24
[INFO] Kmeans cluster 5: SMA(66/112) - Original Sharpe: 0.5145, Trades: 24
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (66/188)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (78/156) - Sharpe: 0.7361
[INFO] cluster 2: (52/188) - Sharpe: 0.6847
[INFO] cluster 3: (44/154) - Sharpe: 0.5892
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.445674           -0.445674
1    2021-11-14 2021-11-14            43    -0.585467           -1.961629
2    2022-01-14 2022-01-14            41     0.447660           -1.952659
3    2022-03-14 2022-03-14            44     0.194099            0.933769
4    2022-05-14 2022-05-14            43    -0.023760           -0.023760
5    2022-07-14 2022-07-14            44     1.564437            1.564437
6    2022-09-14 2022-09-14            43    -3.522290           -3.502027
7    2022-11-14 2022-11-14            43     4.639040            3.472189
8    2023-01-14 2023-01-14            41     1.369071            1.369071
9    2023-03-14 2023-03-14            43     2.324517            2.324517
10   2023-05-14 2023-05-14            44    -0.121506           -0.121506
11   2023-07-14 2023-07-14            44    -0.338260           -0.338260
12   2023-09-14 2023-09-14            43    -0.836213           -3.275084
13   2023-11-14 2023-11-14            42    -0.553935           -4.227138
14   2024-01-14 2024-01-14            43     5.971629            5.971629
15   2024-03-14 2024-03-14            42    -1.552883           -1.552883
16   2024-05-14 2024-05-14            44     0.570071           -0.247280
17   2024-07-14 2024-07-14            45     0.804710            0.263265
18   2024-09-14 2024-09-14            43     0.410531            0.410531
19   2024-11-14 2024-11-14            33    -2.575162           -2.575162
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -0.6 |             -2.0 |         -1.4 | False         
[INFO] 2022-01-14   |          0.4 |             -2.0 |         -2.4 | False         
[INFO] 2022-03-14   |          0.2 |              0.9 |          0.7 | True          
[INFO] 2022-05-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.6 |              1.6 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -3.5 |             -3.5 |          0.0 | Excluded      
[INFO] 2022-11-14   |          4.6 |              3.5 |         -1.1 | False         
[INFO] 2023-01-14   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.3 |             -0.3 |          0.0 | Excluded      
[INFO] 2023-09-14   |         -0.8 |             -3.3 |         -2.5 | False         
[INFO] 2023-11-14   |         -0.6 |             -4.2 |         -3.6 | False         
[INFO] 2024-01-14   |          6.0 |              6.0 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2024-05-14   |          0.6 |             -0.2 |         -0.8 | False         
[INFO] 2024-07-14   |          0.8 |              0.3 |         -0.5 | False         
[INFO] 2024-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2024-01-14, 2024-03-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Kmeans cluster wins (rounded comparison): 1 of 8 periods (12.50% win rate)
[INFO] Updating Excel file with Kmeans results for NG...
[INFO] Excel file updated successfully. Added NG with Kmeans win rate 12.5% in row 36
[INFO] Added best Sharpe parameters 66/188 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 66, Long SMA: 188
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(78/156) - Original Sharpe: 0.7361
[INFO] Added cluster 2 to portfolio: SMA(52/188) - Original Sharpe: 0.6847
[INFO] Added cluster 3 to portfolio: SMA(44/154) - Original Sharpe: 0.5892
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NG_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1431
[INFO] Kmeans Best out-of-sample Sharpe: 0.2645
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for NG...
[INFO] Excel file updated successfully. Added NG with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NG
[INFO] Big Point Value: 10000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1746 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.5760 to 0.8357
[INFO] 
Best parameters:
[INFO] Short SMA: 66
[INFO] Long SMA: 188
[INFO] Sharpe Ratio: 0.835698
[INFO] Number of Trades: 11
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1746 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.5760 to 0.8357
[INFO] Trades range: 10.0 to 192.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1485 to 2.6916
[INFO] Scaled Long SMA range: -2.4204 to 2.1320
[INFO] Scaled Sharpe ratio range: -2.9709 to 1.5218
[INFO] Scaled Trades range: -0.7393 to 12.8208
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1746 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.7573
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 35 elements
[INFO] Cluster 1: 373 elements
[INFO] Cluster 2: 230 elements
[INFO] Cluster 3: 241 elements
[INFO] Cluster 4: 95 elements
[INFO] Cluster 5: 84 elements
[INFO] Cluster 6: 64 elements
[INFO] Cluster 7: 98 elements
[INFO] Cluster 8: 103 elements
[INFO] Cluster 9: 96 elements
[INFO] Cluster 10: 28 elements
[INFO] Cluster 11: 47 elements
[INFO] Cluster 12: 112 elements
[INFO] Cluster 13: 2 elements
[INFO] Cluster 14: 52 elements
[INFO] Cluster 15: 67 elements
[INFO] Cluster 16: 19 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=68, Long SMA=72, Sharpe=0.4523, Trades=68
[INFO] Cluster 1 cluster: Short SMA=78, Long SMA=152, Sharpe=0.7482, Trades=12
[INFO] Cluster 2 cluster: Short SMA=46, Long SMA=172, Sharpe=0.6051, Trades=15
[INFO] Cluster 3 cluster: Short SMA=60, Long SMA=106, Sharpe=0.5049, Trades=22
[INFO] Cluster 4 cluster: Short SMA=166, Long SMA=192, Sharpe=-0.0887, Trades=11
[INFO] Cluster 5 cluster: Short SMA=30, Long SMA=258, Sharpe=0.4684, Trades=10
[INFO] Cluster 6 cluster: Short SMA=82, Long SMA=92, Sharpe=0.4592, Trades=44
[INFO] Cluster 7 cluster: Short SMA=132, Long SMA=160, Sharpe=0.4435, Trades=15
[INFO] Cluster 8 cluster: Short SMA=232, Long SMA=256, Sharpe=0.1719, Trades=12
[INFO] Cluster 9 cluster: Short SMA=18, Long SMA=168, Sharpe=0.1463, Trades=22
[INFO] Cluster 10 cluster: Short SMA=200, Long SMA=204, Sharpe=0.0956, Trades=30
[INFO] Cluster 11 cluster: Short SMA=16, Long SMA=62, Sharpe=0.0438, Trades=48
[INFO] Cluster 12 cluster: Short SMA=266, Long SMA=290, Sharpe=-0.1809, Trades=12
[INFO] Cluster 14 cluster: Short SMA=22, Long SMA=120, Sharpe=0.1271, Trades=28
[INFO] Cluster 15 cluster: Short SMA=86, Long SMA=198, Sharpe=0.4039, Trades=11
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=66, Long SMA=188, Sharpe=0.8357, Trades=11
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=78, Long SMA=152, Sharpe=0.7482, Trades=12
[INFO] Top 2: Short SMA=46, Long SMA=172, Sharpe=0.6051, Trades=15
[INFO] Top 3: Short SMA=60, Long SMA=106, Sharpe=0.5049, Trades=22
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 1725 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 66, Long SMA: 188
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(78/152) - Original Sharpe: 0.7482, Trades: 12
[INFO] Hierarchical cluster 2: SMA(46/172) - Original Sharpe: 0.6051, Trades: 15
[INFO] Hierarchical cluster 3: SMA(60/106) - Original Sharpe: 0.5049, Trades: 22
[INFO] Hierarchical cluster 4: SMA(30/258) - Original Sharpe: 0.4684, Trades: 10
[INFO] Hierarchical cluster 5: SMA(82/92) - Original Sharpe: 0.4592, Trades: 44
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (66/188)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (78/152) - Sharpe: 0.7482
[INFO] cluster 2: (46/172) - Sharpe: 0.6051
[INFO] cluster 3: (60/106) - Sharpe: 0.5049
[INFO] Loading NG data from local files...
[INFO] Found data file: A_OHLCV_@NG_minutes_1440_1802-1655.dat
[INFO] File size: 293948 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.445674           -0.445674
1    2021-11-14 2021-11-14            43    -0.585467           -2.362419
2    2022-01-14 2022-01-14            41     0.447660           -2.408183
3    2022-03-14 2022-03-14            44     0.194099            0.366818
4    2022-05-14 2022-05-14            43    -0.023760           -0.023760
5    2022-07-14 2022-07-14            44     1.564437            2.374457
6    2022-09-14 2022-09-14            43    -3.522290           -4.290428
7    2022-11-14 2022-11-14            43     4.639040            3.472189
8    2023-01-14 2023-01-14            41     1.369071            1.369071
9    2023-03-14 2023-03-14            43     2.324517            2.324517
10   2023-05-14 2023-05-14            44    -0.121506           -0.121506
11   2023-07-14 2023-07-14            44    -0.338260           -1.224377
12   2023-09-14 2023-09-14            43    -0.836213           -1.550949
13   2023-11-14 2023-11-14            42    -0.553935           -3.955407
14   2024-01-14 2024-01-14            43     5.971629            5.971629
15   2024-03-14 2024-03-14            42    -1.552883           -1.552883
16   2024-05-14 2024-05-14            44     0.570071           -0.994944
17   2024-07-14 2024-07-14            45     0.804710            0.603359
18   2024-09-14 2024-09-14            43     0.410531            0.410531
19   2024-11-14 2024-11-14            33    -2.575162           -2.575162
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -0.6 |             -2.4 |         -1.8 | False         
[INFO] 2022-01-14   |          0.4 |             -2.4 |         -2.8 | False         
[INFO] 2022-03-14   |          0.2 |              0.4 |          0.2 | True          
[INFO] 2022-05-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.6 |              2.4 |          0.8 | True          
[INFO] 2022-09-14   |         -3.5 |             -4.3 |         -0.8 | False         
[INFO] 2022-11-14   |          4.6 |              3.5 |         -1.1 | False         
[INFO] 2023-01-14   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2023-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -0.3 |             -1.2 |         -0.9 | False         
[INFO] 2023-09-14   |         -0.8 |             -1.6 |         -0.8 | False         
[INFO] 2023-11-14   |         -0.6 |             -4.0 |         -3.4 | False         
[INFO] 2024-01-14   |          6.0 |              6.0 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.6 |             -1.6 |          0.0 | Excluded      
[INFO] 2024-05-14   |          0.6 |             -1.0 |         -1.6 | False         
[INFO] 2024-07-14   |          0.8 |              0.6 |         -0.2 | False         
[INFO] 2024-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2022-05-14, 2023-01-14, 2023-03-14, 2023-05-14, 2024-01-14, 2024-03-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Hierarchical cluster wins (rounded comparison): 2 of 11 periods (18.18% win rate)
[INFO] Updating Excel file with Hierarchical results for NG...
[INFO] Excel file updated successfully. Added NG with Hierarchical win rate 18.2% in row 36
[INFO] Added best Sharpe parameters 66/188 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 66, Long SMA: 188
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(78/152) - Original Sharpe: 0.7482
[INFO] Added cluster 2 to portfolio: SMA(46/172) - Original Sharpe: 0.6051
[INFO] Added cluster 3 to portfolio: SMA(60/106) - Original Sharpe: 0.5049
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NG_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1653
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2645
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for NG...
[INFO] Excel file updated successfully. Added NG with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NG
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NK in column D: 35.0
[INFO] Using slippage from Excel column D: 35.0
[INFO] 
Symbol: @NK
[INFO] Description: Nikkei 225 USD Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 25.0
[INFO] Big point value: 5.0
[INFO] Data shape: (4833, 6)
[INFO] Date range: 2006-07-24 15:50:00 to 2025-04-07 15:50:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime     open     high      low    close   volume
0 2006-07-24 15:50:00  13875.0  14080.0  13840.0  14020.0   9882.0
1 2006-07-25 15:50:00  14090.0  14275.0  14060.0  14190.0   9925.0
2 2006-07-26 15:50:00  13980.0  14080.0  13960.0  14015.0   8605.0
3 2006-07-27 15:50:00  14205.0  14355.0  14185.0  14245.0  11110.0
4 2006-07-28 15:50:00  14360.0  14555.0  14335.0  14510.0  10231.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 23.04 seconds (0.38 minutes)
[INFO] Best parameters found: Short SMA = 20, Long SMA = 22
[INFO] Best fitness (Sharpe ratio): 0.860889
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 20, Long SMA = 22, Sharpe = 0.860889
[INFO] Top 2: Short SMA = 168, Long SMA = 194, Sharpe = 0.728497
[INFO] Top 3: Short SMA = 156, Long SMA = 198, Sharpe = 0.719455
[INFO] Top 4: Short SMA = 168, Long SMA = 196, Sharpe = 0.712386
[INFO] Top 5: Short SMA = 154, Long SMA = 200, Sharpe = 0.710990
[INFO] Hall of Fame size: 2388
[INFO] Number of elements in all_results: 2063
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 325 had penalty fitness
[INFO] Total filtered from Hall of Fame: 325
[INFO] Hall of Fame -> all_results: 2388 -> 2063
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2063 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NK
[INFO] Big Point Value (from data): 5.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.91 contracts
[INFO] Maximum Position Size: 8 contracts
[INFO] Strategy Total P&L: $-548,150.00
[INFO] Market Buy & Hold P&L: $123,500.00
[INFO] Outperformance: $-671,650.00
[INFO] Sharpe ratio (entire period, annualized): -0.474834
[INFO] Sharpe ratio (in-sample, annualized): -0.459038
[INFO] Sharpe ratio (out-of-sample, annualized): -0.510066
[INFO] Maximum Drawdown: $528,175.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-288,475.00
[INFO] Out-of-sample P&L: $-144,050.00
[INFO] 
Best parameters from GA: Short SMA = 20, Long SMA = 22, Sharpe = 0.860889
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2388
[INFO] Cache hits (repeated combinations): 6278
[INFO] Total checks: 8666
[INFO] Cache hit rate: 72.44%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 5.0
[INFO] Slippage: 35.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2063 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.6321 to 0.8609
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 22
[INFO] Sharpe Ratio: 0.860889
[INFO] Number of Trades: 175
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2063 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.6321 to 0.8609
[INFO] Trades range: 10.0 to 175.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.7600 to 2.3288
[INFO] Scaled Long SMA range: -3.5588 to 1.6646
[INFO] Scaled Sharpe ratio range: -3.0142 to 3.2717
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 166 elements
[INFO] Kmeans Cluster 1: 145 elements
[INFO] Kmeans Cluster 2: 173 elements
[INFO] Kmeans Cluster 3: 48 elements
[INFO] Kmeans Cluster 4: 119 elements
[INFO] Kmeans Cluster 5: 144 elements
[INFO] Kmeans Cluster 6: 112 elements
[INFO] Kmeans Cluster 7: 64 elements
[INFO] Kmeans Cluster 8: 136 elements
[INFO] Kmeans Cluster 9: 163 elements
[INFO] Kmeans Cluster 10: 162 elements
[INFO] Kmeans Cluster 11: 104 elements
[INFO] Kmeans Cluster 12: 133 elements
[INFO] Kmeans Cluster 13: 65 elements
[INFO] Kmeans Cluster 14: 153 elements
[INFO] Kmeans Cluster 15: 176 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=25.20, Long SMA=198.12, Sharpe=-0.1193
[INFO] Centroid 1: Short SMA=161.86, Long SMA=181.45, Sharpe=0.3301
[INFO] Centroid 2: Short SMA=167.23, Long SMA=254.45, Sharpe=0.0110
[INFO] Centroid 3: Short SMA=24.96, Long SMA=52.25, Sharpe=0.0056
[INFO] Centroid 4: Short SMA=75.80, Long SMA=137.46, Sharpe=-0.0473
[INFO] Centroid 5: Short SMA=143.14, Long SMA=223.57, Sharpe=0.3438
[INFO] Centroid 6: Short SMA=272.86, Long SMA=289.20, Sharpe=-0.2080
[INFO] Centroid 7: Short SMA=51.22, Long SMA=93.41, Sharpe=-0.3135
[INFO] Centroid 8: Short SMA=125.51, Long SMA=175.53, Sharpe=0.0382
[INFO] Centroid 9: Short SMA=216.63, Long SMA=277.51, Sharpe=-0.0600
[INFO] Centroid 10: Short SMA=159.17, Long SMA=199.64, Sharpe=0.5743
[INFO] Centroid 11: Short SMA=48.71, Long SMA=274.90, Sharpe=0.1487
[INFO] Centroid 12: Short SMA=104.39, Long SMA=210.78, Sharpe=0.2142
[INFO] Centroid 13: Short SMA=225.29, Long SMA=249.38, Sharpe=-0.2666
[INFO] Centroid 14: Short SMA=69.80, Long SMA=196.42, Sharpe=0.0213
[INFO] Centroid 15: Short SMA=185.73, Long SMA=222.44, Sharpe=0.1356
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=22, Sharpe=0.8609, Trades=175
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=160, Long SMA=200, Sharpe=0.6472, Trades=12
[INFO] Kmeans Top 2: Short SMA=144, Long SMA=224, Sharpe=0.3805, Trades=10
[INFO] Kmeans Top 3: Short SMA=160, Long SMA=180, Sharpe=0.3268, Trades=15
[INFO] Kmeans Top 4: Short SMA=106, Long SMA=208, Sharpe=0.1899, Trades=10
[INFO] Kmeans Top 5: Short SMA=20, Long SMA=50, Sharpe=0.1727, Trades=44
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (25, 198)
[INFO]   Nearest: (26.0, 198.0)
[INFO]   Rounded: (162, 181)
[INFO]   Nearest: (162.0, 182.0)
[INFO]   Rounded: (167, 254)
[INFO]   Nearest: (168.0, 254.0)
[INFO]   Rounded: (25, 52)
[INFO]   Nearest: (24.0, 52.0)
[INFO]   Rounded: (76, 137)
[INFO]   Nearest: (76.0, 138.0)
[INFO]   Rounded: (143, 224)
[INFO]   Nearest: (144.0, 224.0)
[INFO]   Rounded: (273, 289)
[INFO]   Nearest: (272.0, 290.0)
[INFO]   Rounded: (51, 93)
[INFO]   Nearest: (52.0, 94.0)
[INFO]   Rounded: (126, 176)
[INFO]   Rounded: (217, 278)
[INFO]   Nearest: (216.0, 278.0)
[INFO]   Rounded: (159, 200)
[INFO]   Nearest: (160.0, 200.0)
[INFO]   Rounded: (49, 275)
[INFO]   Nearest: (48.0, 274.0)
[INFO]   Rounded: (104, 211)
[INFO]   Nearest: (104.0, 210.0)
[INFO]   Rounded: (225, 249)
[INFO]   Nearest: (226.0, 250.0)
[INFO]   Rounded: (70, 196)
[INFO]   Rounded: (186, 222)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 22
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(160/200) - Original Sharpe: 0.6472, Trades: 12
[INFO] Kmeans cluster 2: SMA(144/224) - Original Sharpe: 0.3805, Trades: 10
[INFO] Kmeans cluster 3: SMA(160/180) - Original Sharpe: 0.3268, Trades: 15
[INFO] Kmeans cluster 4: SMA(106/208) - Original Sharpe: 0.1899, Trades: 10
[INFO] Kmeans cluster 5: SMA(20/50) - Original Sharpe: 0.1727, Trades: 44
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/22)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (160/200) - Sharpe: 0.6472
[INFO] cluster 2: (144/224) - Sharpe: 0.3805
[INFO] cluster 3: (160/180) - Sharpe: 0.3268
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -3.504421           -4.018915
1    2021-11-14 2021-11-14            43    -3.098247            1.075513
2    2022-01-14 2022-01-14            41     1.372559            0.282571
3    2022-03-14 2022-03-14            44    -1.165984            2.159329
4    2022-05-14 2022-05-14            43    -1.900497            0.242755
5    2022-07-14 2022-07-14            44     2.319224           -1.151355
6    2022-09-14 2022-09-14            43     2.556621            5.147697
7    2022-11-14 2022-11-14            43    -0.052453           -3.046947
8    2023-01-14 2023-01-14            41    -4.424461            2.464212
9    2023-03-14 2023-03-14            44     3.997800           -1.105531
10   2023-05-14 2023-05-14            44     3.172571            3.089546
11   2023-07-14 2023-07-14            44     0.164211            0.071497
12   2023-09-14 2023-09-14            43    -0.266138            0.098898
13   2023-11-14 2023-11-14            42     0.656100            3.424369
14   2024-01-14 2024-01-14            43     2.638804            2.638804
15   2024-03-14 2024-03-14            42    -0.568643           -0.255646
16   2024-05-14 2024-05-14            44    -0.714126            2.633261
17   2024-07-14 2024-07-14            45    -1.907394           -2.110069
18   2024-09-14 2024-09-14            43    -1.733867            2.385094
19   2024-11-14 2024-11-14            33     2.409760           -1.452006
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -3.5 |             -4.0 |         -0.5 | False         
[INFO] 2021-11-14   |         -3.1 |              1.1 |          4.2 | True          
[INFO] 2022-01-14   |          1.4 |              0.3 |         -1.1 | False         
[INFO] 2022-03-14   |         -1.2 |              2.2 |          3.4 | True          
[INFO] 2022-05-14   |         -1.9 |              0.2 |          2.1 | True          
[INFO] 2022-07-14   |          2.3 |             -1.2 |         -3.5 | False         
[INFO] 2022-09-14   |          2.6 |              5.1 |          2.5 | True          
[INFO] 2022-11-14   |         -0.1 |             -3.0 |         -2.9 | False         
[INFO] 2023-01-14   |         -4.4 |              2.5 |          6.9 | True          
[INFO] 2023-03-14   |          4.0 |             -1.1 |         -5.1 | False         
[INFO] 2023-05-14   |          3.2 |              3.1 |         -0.1 | False         
[INFO] 2023-07-14   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2023-09-14   |         -0.3 |              0.1 |          0.4 | True          
[INFO] 2023-11-14   |          0.7 |              3.4 |          2.7 | True          
[INFO] 2024-01-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.6 |             -0.3 |          0.3 | True          
[INFO] 2024-05-14   |         -0.7 |              2.6 |          3.3 | True          
[INFO] 2024-07-14   |         -1.9 |             -2.1 |         -0.2 | False         
[INFO] 2024-09-14   |         -1.7 |              2.4 |          4.1 | True          
[INFO] 2024-11-14   |          2.4 |             -1.5 |         -3.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 10 of 19 periods (52.63% win rate)
[INFO] Updating Excel file with Kmeans results for NK...
[INFO] Excel file updated successfully. Added NK with Kmeans win rate 52.6% in row 37
[INFO] Added best Sharpe parameters 20/22 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 22
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(160/200) - Original Sharpe: 0.6472
[INFO] Added cluster 2 to portfolio: SMA(144/224) - Original Sharpe: 0.3805
[INFO] Added cluster 3 to portfolio: SMA(160/180) - Original Sharpe: 0.3268
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NK_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.6713
[INFO] Kmeans Best out-of-sample Sharpe: -0.0843
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NK...
[INFO] Excel file updated successfully. Added NK with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NK
[INFO] Big Point Value: 5.0
[INFO] Slippage: 35.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2063 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.6321 to 0.8609
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 22
[INFO] Sharpe Ratio: 0.860889
[INFO] Number of Trades: 175
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2063 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.6321 to 0.8609
[INFO] Trades range: 10.0 to 175.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.7600 to 2.3288
[INFO] Scaled Long SMA range: -3.5588 to 1.6646
[INFO] Scaled Sharpe ratio range: -3.0142 to 3.2717
[INFO] Scaled Trades range: -0.5732 to 13.6797
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2063 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5099
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 48 elements
[INFO] Cluster 1: 247 elements
[INFO] Cluster 2: 50 elements
[INFO] Cluster 3: 130 elements
[INFO] Cluster 4: 248 elements
[INFO] Cluster 5: 7 elements
[INFO] Cluster 6: 338 elements
[INFO] Cluster 7: 106 elements
[INFO] Cluster 8: 63 elements
[INFO] Cluster 9: 224 elements
[INFO] Cluster 10: 49 elements
[INFO] Cluster 11: 127 elements
[INFO] Cluster 12: 138 elements
[INFO] Cluster 13: 189 elements
[INFO] Cluster 14: 99 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=230, Long SMA=234, Sharpe=-0.0774, Trades=32
[INFO] Cluster 1 cluster: Short SMA=152, Long SMA=208, Sharpe=0.4468, Trades=10
[INFO] Cluster 2 cluster: Short SMA=32, Long SMA=50, Sharpe=-0.1970, Trades=52
[INFO] Cluster 3 cluster: Short SMA=96, Long SMA=144, Sharpe=-0.0657, Trades=15
[INFO] Cluster 4 cluster: Short SMA=108, Long SMA=202, Sharpe=0.1667, Trades=10
[INFO] Cluster 6 cluster: Short SMA=170, Long SMA=240, Sharpe=0.0093, Trades=10
[INFO] Cluster 7 cluster: Short SMA=44, Long SMA=280, Sharpe=0.0841, Trades=11
[INFO] Cluster 8 cluster: Short SMA=42, Long SMA=94, Sharpe=-0.0787, Trades=23
[INFO] Cluster 9 cluster: Short SMA=218, Long SMA=270, Sharpe=-0.2500, Trades=11
[INFO] Cluster 10 cluster: Short SMA=158, Long SMA=164, Sharpe=0.1681, Trades=33
[INFO] Cluster 11 cluster: Short SMA=20, Long SMA=198, Sharpe=-0.0783, Trades=22
[INFO] Cluster 12 cluster: Short SMA=160, Long SMA=200, Sharpe=0.6472, Trades=12
[INFO] Cluster 13 cluster: Short SMA=60, Long SMA=190, Sharpe=0.0600, Trades=13
[INFO] Cluster 14 cluster: Short SMA=270, Long SMA=286, Sharpe=-0.1439, Trades=19
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=22, Sharpe=0.8609, Trades=175
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=160, Long SMA=200, Sharpe=0.6472, Trades=12
[INFO] Top 2: Short SMA=152, Long SMA=208, Sharpe=0.4468, Trades=10
[INFO] Top 3: Short SMA=158, Long SMA=164, Sharpe=0.1681, Trades=33
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 2056 points from valid clusters
[INFO] Warning: Max Sharpe point at (20.0, 22.0) not found in heatmap coordinates
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 22
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(160/200) - Original Sharpe: 0.6472, Trades: 12
[INFO] Hierarchical cluster 2: SMA(152/208) - Original Sharpe: 0.4468, Trades: 10
[INFO] Hierarchical cluster 3: SMA(158/164) - Original Sharpe: 0.1681, Trades: 33
[INFO] Hierarchical cluster 4: SMA(108/202) - Original Sharpe: 0.1667, Trades: 10
[INFO] Hierarchical cluster 5: SMA(44/280) - Original Sharpe: 0.0841, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/22)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (160/200) - Sharpe: 0.6472
[INFO] cluster 2: (152/208) - Sharpe: 0.4468
[INFO] Loading NK data from local files...
[INFO] Found data file: A_OHLCV_@NK_minutes_1440_1710-1550.dat
[INFO] File size: 232125 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -3.504421           -3.218041
1    2021-11-14 2021-11-14            43    -3.098247            1.510190
2    2022-01-14 2022-01-14            41     1.372559            2.130379
3    2022-03-14 2022-03-14            44    -1.165984           -0.022221
4    2022-05-14 2022-05-14            43    -1.900497            0.242755
5    2022-07-14 2022-07-14            44     2.319224           -1.151355
6    2022-09-14 2022-09-14            43     2.556621            4.334039
7    2022-11-14 2022-11-14            43    -0.052453           -3.439611
8    2023-01-14 2023-01-14            41    -4.424461            2.464212
9    2023-03-14 2023-03-14            44     3.997800           -1.253230
10   2023-05-14 2023-05-14            44     3.172571            2.684950
11   2023-07-14 2023-07-14            44     0.164211            0.071497
12   2023-09-14 2023-09-14            43    -0.266138            0.098898
13   2023-11-14 2023-11-14            42     0.656100            3.424369
14   2024-01-14 2024-01-14            43     2.638804            2.638804
15   2024-03-14 2024-03-14            42    -0.568643           -0.255646
16   2024-05-14 2024-05-14            44    -0.714126            2.633261
17   2024-07-14 2024-07-14            45    -1.907394           -2.110069
18   2024-09-14 2024-09-14            43    -1.733867            2.243998
19   2024-11-14 2024-11-14            33     2.409760           -0.392176
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -3.5 |             -3.2 |          0.3 | True          
[INFO] 2021-11-14   |         -3.1 |              1.5 |          4.6 | True          
[INFO] 2022-01-14   |          1.4 |              2.1 |          0.7 | True          
[INFO] 2022-03-14   |         -1.2 |             -0.0 |          1.2 | True          
[INFO] 2022-05-14   |         -1.9 |              0.2 |          2.1 | True          
[INFO] 2022-07-14   |          2.3 |             -1.2 |         -3.5 | False         
[INFO] 2022-09-14   |          2.6 |              4.3 |          1.7 | True          
[INFO] 2022-11-14   |         -0.1 |             -3.4 |         -3.3 | False         
[INFO] 2023-01-14   |         -4.4 |              2.5 |          6.9 | True          
[INFO] 2023-03-14   |          4.0 |             -1.3 |         -5.3 | False         
[INFO] 2023-05-14   |          3.2 |              2.7 |         -0.5 | False         
[INFO] 2023-07-14   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2023-09-14   |         -0.3 |              0.1 |          0.4 | True          
[INFO] 2023-11-14   |          0.7 |              3.4 |          2.7 | True          
[INFO] 2024-01-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -0.6 |             -0.3 |          0.3 | True          
[INFO] 2024-05-14   |         -0.7 |              2.6 |          3.3 | True          
[INFO] 2024-07-14   |         -1.9 |             -2.1 |         -0.2 | False         
[INFO] 2024-09-14   |         -1.7 |              2.2 |          3.9 | True          
[INFO] 2024-11-14   |          2.4 |             -0.4 |         -2.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 12 of 19 periods (63.16% win rate)
[INFO] Updating Excel file with Hierarchical results for NK...
[INFO] Excel file updated successfully. Added NK with Hierarchical win rate 63.2% in row 37
[INFO] Added best Sharpe parameters 20/22 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 22
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(160/200) - Original Sharpe: 0.6472
[INFO] Added cluster 2 to portfolio: SMA(152/208) - Original Sharpe: 0.4468
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NK_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.5616
[INFO] Hierarchical Best out-of-sample Sharpe: -0.0843
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NK...
[INFO] Excel file updated successfully. Added NK with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NK
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for NQ in column D: 11.0
[INFO] Using slippage from Excel column D: 11.0
[INFO] 
Symbol: @NQ
[INFO] Description: E-Mini NASDAQ-100 Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.0
[INFO] Big point value: 20.0
[INFO] Data shape: (6512, 6)
[INFO] Date range: 2000-01-03 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime     open     high      low    close   volume
0 2000-01-03 15:57:00  6521.25  6690.25  6476.25  6632.75  11054.0
1 2000-01-04 15:57:00  6630.25  6637.75  6320.25  6355.25  10703.0
2 2000-01-05 15:57:00  6315.25  6413.25  6190.25  6303.25  11285.0
3 2000-01-06 15:57:00  6260.25  6348.25  6077.75  6110.75  11066.0
4 2000-01-07 15:57:00  6065.25  6369.75  6063.25  6357.25  10057.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 17.23 seconds (0.29 minutes)
[INFO] Best parameters found: Short SMA = 220, Long SMA = 234
[INFO] Best fitness (Sharpe ratio): 1.061151
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 220, Long SMA = 234, Sharpe = 1.061151
[INFO] Top 2: Short SMA = 222, Long SMA = 232, Sharpe = 1.021746
[INFO] Top 3: Short SMA = 220, Long SMA = 232, Sharpe = 1.018711
[INFO] Top 4: Short SMA = 222, Long SMA = 226, Sharpe = 0.998002
[INFO] Top 5: Short SMA = 222, Long SMA = 234, Sharpe = 0.991354
[INFO] Hall of Fame size: 2013
[INFO] Number of elements in all_results: 615
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 1398 had penalty fitness
[INFO] Total filtered from Hall of Fame: 1398
[INFO] Hall of Fame -> all_results: 2013 -> 615
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 615 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @NQ
[INFO] Big Point Value (from data): 20.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.56 contracts
[INFO] Maximum Position Size: 11 contracts
[INFO] Strategy Total P&L: $-932,780.00
[INFO] Market Buy & Hold P&L: $312,105.00
[INFO] Outperformance: $-1,244,885.00
[INFO] Sharpe ratio (entire period, annualized): -0.781526
[INFO] Sharpe ratio (in-sample, annualized): -0.942508
[INFO] Sharpe ratio (out-of-sample, annualized): -0.482799
[INFO] Maximum Drawdown: $864,060.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-627,955.00
[INFO] Out-of-sample P&L: $-167,955.00
[INFO] 
Best parameters from GA: Short SMA = 220, Long SMA = 234, Sharpe = 1.061151
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2013
[INFO] Cache hits (repeated combinations): 6668
[INFO] Total checks: 8681
[INFO] Cache hit rate: 76.81%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 20.0
[INFO] Slippage: 11.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 615 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.0689 to 1.0612
[INFO] 
Best parameters:
[INFO] Short SMA: 220
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.061151
[INFO] Number of Trades: 10
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 615 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.0689 to 1.0612
[INFO] Trades range: 10.0 to 130.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0642 to 1.7414
[INFO] Scaled Long SMA range: -2.2756 to 1.2997
[INFO] Scaled Sharpe ratio range: -3.3227 to 2.3358
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 18
[INFO] Using 18 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=18...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 58 elements
[INFO] Kmeans Cluster 1: 35 elements
[INFO] Kmeans Cluster 2: 15 elements
[INFO] Kmeans Cluster 3: 38 elements
[INFO] Kmeans Cluster 4: 14 elements
[INFO] Kmeans Cluster 5: 35 elements
[INFO] Kmeans Cluster 6: 19 elements
[INFO] Kmeans Cluster 7: 22 elements
[INFO] Kmeans Cluster 8: 39 elements
[INFO] Kmeans Cluster 9: 71 elements
[INFO] Kmeans Cluster 10: 45 elements
[INFO] Kmeans Cluster 11: 59 elements
[INFO] Kmeans Cluster 12: 31 elements
[INFO] Kmeans Cluster 13: 28 elements
[INFO] Kmeans Cluster 14: 16 elements
[INFO] Kmeans Cluster 15: 40 elements
[INFO] Kmeans Cluster 16: 27 elements
[INFO] Kmeans Cluster 17: 23 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=261.55, Long SMA=269.97, Sharpe=0.7566
[INFO] Centroid 1: Short SMA=24.51, Long SMA=157.03, Sharpe=0.5861
[INFO] Centroid 3: Short SMA=33.47, Long SMA=287.05, Sharpe=0.6332
[INFO] Centroid 5: Short SMA=138.06, Long SMA=155.66, Sharpe=0.6100
[INFO] Centroid 7: Short SMA=33.45, Long SMA=81.82, Sharpe=0.3663
[INFO] Centroid 8: Short SMA=45.08, Long SMA=110.21, Sharpe=0.5270
[INFO] Centroid 9: Short SMA=280.37, Long SMA=289.66, Sharpe=0.6477
[INFO] Centroid 10: Short SMA=230.31, Long SMA=238.67, Sharpe=0.8685
[INFO] Centroid 11: Short SMA=20.85, Long SMA=239.76, Sharpe=0.5794
[INFO] Centroid 12: Short SMA=28.19, Long SMA=53.35, Sharpe=0.1767
[INFO] Centroid 13: Short SMA=107.14, Long SMA=140.00, Sharpe=0.7522
[INFO] Centroid 15: Short SMA=32.95, Long SMA=193.25, Sharpe=0.5230
[INFO] Centroid 16: Short SMA=160.59, Long SMA=177.63, Sharpe=0.7576
[INFO] Centroid 17: Short SMA=14.26, Long SMA=289.13, Sharpe=0.4666
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=220, Long SMA=234, Sharpe=1.0612, Trades=10
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=234, Long SMA=242, Sharpe=0.9161, Trades=14
[INFO] Kmeans Top 2: Short SMA=154, Long SMA=166, Sharpe=0.8316, Trades=14
[INFO] Kmeans Top 3: Short SMA=258, Long SMA=268, Sharpe=0.7595, Trades=19
[INFO] Kmeans Top 4: Short SMA=106, Long SMA=140, Sharpe=0.7297, Trades=10
[INFO] Kmeans Top 5: Short SMA=28, Long SMA=288, Sharpe=0.6470, Trades=11
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 3, 5, 7, 8, 9, 10, 11, 12, 13, 15, 16, 17}
[INFO]   Rounded: (262, 270)
[INFO]   Rounded: (25, 157)
[INFO]   Nearest: (24.0, 158.0)
[INFO]   Rounded: (33, 287)
[INFO]   Nearest: (34.0, 288.0)
[INFO]   Rounded: (138, 156)
[INFO]   Rounded: (33, 82)
[INFO]   Nearest: (34.0, 82.0)
[INFO]   Rounded: (45, 110)
[INFO]   Nearest: (46.0, 110.0)
[INFO]   Rounded: (280, 290)
[INFO]   Rounded: (230, 239)
[INFO]   Nearest: (230.0, 238.0)
[INFO]   Rounded: (21, 240)
[INFO]   Nearest: (20.0, 240.0)
[INFO]   Rounded: (28, 53)
[INFO]   Nearest: (28.0, 54.0)
[INFO]   Rounded: (107, 140)
[INFO]   Nearest: (108.0, 140.0)
[INFO]   Rounded: (33, 193)
[INFO]   Nearest: (32.0, 194.0)
[INFO]   Rounded: (161, 178)
[INFO]   Nearest: (160.0, 178.0)
[INFO]   Rounded: (14, 289)
[INFO]   Nearest: (14.0, 290.0)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 220, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(234/242) - Original Sharpe: 0.9161, Trades: 14
[INFO] Kmeans cluster 2: SMA(154/166) - Original Sharpe: 0.8316, Trades: 14
[INFO] Kmeans cluster 3: SMA(258/268) - Original Sharpe: 0.7595, Trades: 19
[INFO] Kmeans cluster 4: SMA(106/140) - Original Sharpe: 0.7297, Trades: 10
[INFO] Kmeans cluster 5: SMA(28/288) - Original Sharpe: 0.6470, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (220/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (234/242) - Sharpe: 0.9161
[INFO] cluster 2: (154/166) - Sharpe: 0.8316
[INFO] cluster 3: (258/268) - Sharpe: 0.7595
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     1.806484            1.806484
1    2021-11-14 2021-11-14            43    -0.977041           -0.977041
2    2022-01-14 2022-01-14            41    -2.947949           -2.947949
3    2022-03-14 2022-03-14            44    -1.115967            1.704226
4    2022-05-14 2022-05-14            43     1.416434            0.524019
5    2022-07-14 2022-07-14            44     0.287301            0.287301
6    2022-09-14 2022-09-14            43     0.419792            0.419792
7    2022-11-14 2022-11-14            43     0.548831            0.548831
8    2023-01-14 2023-01-14            41    -0.831080           -1.500187
9    2023-03-14 2023-03-14            44    -3.343776           -3.264827
10   2023-05-14 2023-05-14            44     0.669823            3.011949
11   2023-07-14 2023-07-14            44    -0.267217           -0.836967
12   2023-09-14 2023-09-14            43    -0.029656           -0.029656
13   2023-11-14 2023-11-14            42     3.419744            3.419744
14   2024-01-14 2024-01-14            43     2.462763            2.462763
15   2024-03-14 2024-03-14            42    -1.004018           -1.004018
16   2024-05-14 2024-05-14            44     4.245445            4.245445
17   2024-07-14 2024-07-14            45    -2.152848           -2.152848
18   2024-09-14 2024-09-14            43     2.552179            2.552179
19   2024-11-14 2024-11-14            33    -1.170159           -1.170159
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.9 |             -2.9 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.1 |              1.7 |          2.8 | True          
[INFO] 2022-05-14   |          1.4 |              0.5 |         -0.9 | False         
[INFO] 2022-07-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.8 |             -1.5 |         -0.7 | False         
[INFO] 2023-03-14   |         -3.3 |             -3.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |          0.7 |              3.0 |          2.3 | True          
[INFO] 2023-07-14   |         -0.3 |             -0.8 |         -0.5 | False         
[INFO] 2023-09-14   |         -0.0 |             -0.0 |          0.0 | Excluded      
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-03-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 5
[INFO] Kmeans cluster wins (rounded comparison): 2 of 5 periods (40.00% win rate)
[INFO] Updating Excel file with Kmeans results for NQ...
[INFO] Excel file updated successfully. Added NQ with Kmeans win rate 40.0% in row 38
[INFO] Added best Sharpe parameters 220/234 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 220, Long SMA: 234
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(234/242) - Original Sharpe: 0.9161
[INFO] Added cluster 2 to portfolio: SMA(154/166) - Original Sharpe: 0.8316
[INFO] Added cluster 3 to portfolio: SMA(258/268) - Original Sharpe: 0.7595
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NQ_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2364
[INFO] Kmeans Best out-of-sample Sharpe: 0.1321
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for NQ...
[INFO] Excel file updated successfully. Added NQ with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NQ
[INFO] Big Point Value: 20.0
[INFO] Slippage: 11.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 615 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.0689 to 1.0612
[INFO] 
Best parameters:
[INFO] Short SMA: 220
[INFO] Long SMA: 234
[INFO] Sharpe Ratio: 1.061151
[INFO] Number of Trades: 10
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 615 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.0689 to 1.0612
[INFO] Trades range: 10.0 to 130.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0642 to 1.7414
[INFO] Scaled Long SMA range: -2.2756 to 1.2997
[INFO] Scaled Sharpe ratio range: -3.3227 to 2.3358
[INFO] Scaled Trades range: -0.6983 to 9.4843
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 615
[INFO] Cophenetic correlation: 0.7558
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 85 elements
[INFO] Cluster 1: 85 elements
[INFO] Cluster 2: 9 elements
[INFO] Cluster 3: 46 elements
[INFO] Cluster 4: 43 elements
[INFO] Cluster 5: 32 elements
[INFO] Cluster 6: 60 elements
[INFO] Cluster 7: 60 elements
[INFO] Cluster 8: 33 elements
[INFO] Cluster 9: 33 elements
[INFO] Cluster 10: 1 elements
[INFO] Cluster 11: 15 elements
[INFO] Cluster 12: 15 elements
[INFO] Cluster 13: 23 elements
[INFO] Cluster 14: 35 elements
[INFO] Cluster 15: 40 elements
[INFO] Using 12 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=24, Long SMA=252, Sharpe=0.6339, Trades=10
[INFO] Cluster 1 cluster: Short SMA=24, Long SMA=182, Sharpe=0.4988, Trades=10
[INFO] Cluster 3 cluster: Short SMA=258, Long SMA=266, Sharpe=0.7872, Trades=18
[INFO] Cluster 4 cluster: Short SMA=144, Long SMA=160, Sharpe=0.5989, Trades=12
[INFO] Cluster 5 cluster: Short SMA=46, Long SMA=76, Sharpe=0.2299, Trades=28
[INFO] Cluster 6 cluster: Short SMA=230, Long SMA=240, Sharpe=0.8541, Trades=14
[INFO] Cluster 7 cluster: Short SMA=48, Long SMA=106, Sharpe=0.5581, Trades=12
[INFO] Cluster 8 cluster: Short SMA=32, Long SMA=50, Sharpe=0.1888, Trades=40
[INFO] Cluster 9 cluster: Short SMA=276, Long SMA=290, Sharpe=0.7131, Trades=13
[INFO] Cluster 13 cluster: Short SMA=14, Long SMA=292, Sharpe=0.4580, Trades=15
[INFO] Cluster 14 cluster: Short SMA=116, Long SMA=150, Sharpe=0.7037, Trades=10
[INFO] Cluster 15 cluster: Short SMA=282, Long SMA=288, Sharpe=0.6378, Trades=21
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=220, Long SMA=234, Sharpe=1.0612, Trades=10
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=230, Long SMA=240, Sharpe=0.8541, Trades=14
[INFO] Top 2: Short SMA=258, Long SMA=266, Sharpe=0.7872, Trades=18
[INFO] Top 3: Short SMA=276, Long SMA=290, Sharpe=0.7131, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 12 valid clusters with clusters
[INFO] Filtering to 575 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 220, Long SMA: 234
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(230/240) - Original Sharpe: 0.8541, Trades: 14
[INFO] Hierarchical cluster 2: SMA(258/266) - Original Sharpe: 0.7872, Trades: 18
[INFO] Hierarchical cluster 3: SMA(276/290) - Original Sharpe: 0.7131, Trades: 13
[INFO] Hierarchical cluster 4: SMA(116/150) - Original Sharpe: 0.7037, Trades: 10
[INFO] Hierarchical cluster 5: SMA(282/288) - Original Sharpe: 0.6378, Trades: 21
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (220/234)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (230/240) - Sharpe: 0.8541
[INFO] cluster 2: (258/266) - Sharpe: 0.7872
[INFO] cluster 3: (276/290) - Sharpe: 0.7131
[INFO] Loading NQ data from local files...
[INFO] Found data file: A_OHLCV_@NQ_minutes_1440_1703-1557.dat
[INFO] File size: 312720 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     1.806484            1.806484
1    2021-11-14 2021-11-14            43    -0.977041           -0.977041
2    2022-01-14 2022-01-14            41    -2.947949           -2.947949
3    2022-03-14 2022-03-14            44    -1.115967           -1.115967
4    2022-05-14 2022-05-14            43     1.416434           -0.001190
5    2022-07-14 2022-07-14            44     0.287301            1.204504
6    2022-09-14 2022-09-14            43     0.419792            0.419792
7    2022-11-14 2022-11-14            43     0.548831            0.548831
8    2023-01-14 2023-01-14            41    -0.831080           -0.831080
9    2023-03-14 2023-03-14            44    -3.343776           -3.446699
10   2023-05-14 2023-05-14            44     0.669823           -2.010652
11   2023-07-14 2023-07-14            44    -0.267217            0.252085
12   2023-09-14 2023-09-14            43    -0.029656            1.047723
13   2023-11-14 2023-11-14            42     3.419744            3.419744
14   2024-01-14 2024-01-14            43     2.462763            2.462763
15   2024-03-14 2024-03-14            42    -1.004018           -1.004018
16   2024-05-14 2024-05-14            44     4.245445            4.245445
17   2024-07-14 2024-07-14            45    -2.152848           -2.152848
18   2024-09-14 2024-09-14            43     2.552179            2.552179
19   2024-11-14 2024-11-14            33    -1.170159           -1.170159
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2021-11-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -2.9 |             -2.9 |          0.0 | Excluded      
[INFO] 2022-03-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.4 |             -0.0 |         -1.4 | False         
[INFO] 2022-07-14   |          0.3 |              1.2 |          0.9 | True          
[INFO] 2022-09-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -3.3 |             -3.4 |         -0.1 | False         
[INFO] 2023-05-14   |          0.7 |             -2.0 |         -2.7 | False         
[INFO] 2023-07-14   |         -0.3 |              0.3 |          0.6 | True          
[INFO] 2023-09-14   |         -0.0 |              1.0 |          1.0 | True          
[INFO] 2023-11-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2024-05-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -1.2 |             -1.2 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14, 2024-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 6
[INFO] Hierarchical cluster wins (rounded comparison): 3 of 6 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for NQ...
[INFO] Excel file updated successfully. Added NQ with Hierarchical win rate 50.0% in row 38
[INFO] Added best Sharpe parameters 220/234 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 220, Long SMA: 234
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(230/240) - Original Sharpe: 0.8541
[INFO] Added cluster 2 to portfolio: SMA(258/266) - Original Sharpe: 0.7872
[INFO] Added cluster 3 to portfolio: SMA(276/290) - Original Sharpe: 0.7131
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'NQ_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1376
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1321
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for NQ...
[INFO] Excel file updated successfully. Added NQ with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\NQ
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for PA in column D: 80.0
[INFO] Using slippage from Excel column D: 80.0
[INFO] 
Symbol: @PA=13INC
[INFO] Description: Palladium Custom Continuous Contract
[INFO] Exchange: NYMEX
[INFO] Interval: minutes 1440
[INFO] Tick size: 50.0
[INFO] Big point value: 100.0
[INFO] Data shape: (5559, 6)
[INFO] Date range: 2001-05-09 16:50:00 to 2025-04-07 16:50:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-09 16:50:00  894.10  894.10  894.10  894.10     1.0
1 2001-05-14 16:50:00  874.10  874.10  874.10  874.10     5.0
2 2001-05-15 16:50:00  850.95  850.95  850.95  850.95     1.0
3 2001-06-05 16:50:00  854.50  854.50  854.50  854.50     4.0
4 2001-06-06 16:50:00  838.60  838.60  838.60  838.60     1.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 23.76 seconds (0.40 minutes)
[INFO] Best parameters found: Short SMA = 112, Long SMA = 174
[INFO] Best fitness (Sharpe ratio): 0.926948
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 112, Long SMA = 174, Sharpe = 0.926948
[INFO] Top 2: Short SMA = 110, Long SMA = 168, Sharpe = 0.856357
[INFO] Top 3: Short SMA = 50, Long SMA = 172, Sharpe = 0.852970
[INFO] Top 4: Short SMA = 50, Long SMA = 174, Sharpe = 0.852001
[INFO] Top 5: Short SMA = 106, Long SMA = 172, Sharpe = 0.849062
[INFO] Hall of Fame size: 2747
[INFO] Number of elements in all_results: 1560
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 1187 had penalty fitness
[INFO] Total filtered from Hall of Fame: 1187
[INFO] Hall of Fame -> all_results: 2747 -> 1560
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1560 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3106, Evaluation data length: 2839
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @PA=13INC
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 2.59 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $-165,160.00
[INFO] Market Buy & Hold P&L: $9,530.00
[INFO] Outperformance: $-174,690.00
[INFO] Sharpe ratio (entire period, annualized): -0.209053
[INFO] Sharpe ratio (in-sample, annualized): -0.572358
[INFO] Sharpe ratio (out-of-sample, annualized): 0.545925
[INFO] Maximum Drawdown: $593,380.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-369,085.00
[INFO] Out-of-sample P&L: $169,150.00
[INFO] 
Best parameters from GA: Short SMA = 112, Long SMA = 174, Sharpe = 0.926948
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2747
[INFO] Cache hits (repeated combinations): 5903
[INFO] Total checks: 8650
[INFO] Cache hit rate: 68.24%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 100.0
[INFO] Slippage: 80.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1560 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.4419 to 0.9269
[INFO] 
Best parameters:
[INFO] Short SMA: 112
[INFO] Long SMA: 174
[INFO] Sharpe Ratio: 0.926948
[INFO] Number of Trades: 10
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1560 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.4419 to 0.9269
[INFO] Trades range: 10.0 to 216.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0503 to 2.5689
[INFO] Scaled Long SMA range: -2.6073 to 2.0590
[INFO] Scaled Sharpe ratio range: -3.9594 to 2.0067
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 60 elements
[INFO] Kmeans Cluster 1: 123 elements
[INFO] Kmeans Cluster 2: 157 elements
[INFO] Kmeans Cluster 3: 78 elements
[INFO] Kmeans Cluster 4: 95 elements
[INFO] Kmeans Cluster 5: 83 elements
[INFO] Kmeans Cluster 6: 45 elements
[INFO] Kmeans Cluster 7: 121 elements
[INFO] Kmeans Cluster 8: 65 elements
[INFO] Kmeans Cluster 9: 109 elements
[INFO] Kmeans Cluster 10: 128 elements
[INFO] Kmeans Cluster 11: 158 elements
[INFO] Kmeans Cluster 12: 55 elements
[INFO] Kmeans Cluster 13: 62 elements
[INFO] Kmeans Cluster 14: 76 elements
[INFO] Kmeans Cluster 15: 66 elements
[INFO] Kmeans Cluster 16: 79 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=20.80, Long SMA=136.47, Sharpe=0.2602
[INFO] Centroid 1: Short SMA=272.62, Long SMA=287.22, Sharpe=0.2203
[INFO] Centroid 2: Short SMA=54.87, Long SMA=173.12, Sharpe=0.7130
[INFO] Centroid 3: Short SMA=30.69, Long SMA=91.41, Sharpe=0.0516
[INFO] Centroid 4: Short SMA=143.22, Long SMA=196.11, Sharpe=0.4923
[INFO] Centroid 5: Short SMA=20.60, Long SMA=257.66, Sharpe=0.6942
[INFO] Centroid 6: Short SMA=15.82, Long SMA=51.33, Sharpe=-0.2226
[INFO] Centroid 7: Short SMA=44.98, Long SMA=205.52, Sharpe=0.5848
[INFO] Centroid 8: Short SMA=184.80, Long SMA=207.02, Sharpe=0.3294
[INFO] Centroid 9: Short SMA=68.64, Long SMA=113.49, Sharpe=0.4726
[INFO] Centroid 10: Short SMA=105.50, Long SMA=149.33, Sharpe=0.7234
[INFO] Centroid 11: Short SMA=38.67, Long SMA=149.90, Sharpe=0.5887
[INFO] Centroid 12: Short SMA=146.44, Long SMA=161.78, Sharpe=0.3477
[INFO] Centroid 13: Short SMA=46.55, Long SMA=73.32, Sharpe=0.2902
[INFO] Centroid 14: Short SMA=238.92, Long SMA=253.24, Sharpe=0.4670
[INFO] Centroid 15: Short SMA=16.12, Long SMA=194.91, Sharpe=0.4174
[INFO] Centroid 16: Short SMA=119.62, Long SMA=151.01, Sharpe=0.5731
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=112, Long SMA=174, Sharpe=0.9269, Trades=10
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=52, Long SMA=170, Sharpe=0.7763, Trades=11
[INFO] Kmeans Top 2: Short SMA=106, Long SMA=154, Sharpe=0.7490, Trades=12
[INFO] Kmeans Top 3: Short SMA=20, Long SMA=252, Sharpe=0.6419, Trades=10
[INFO] Kmeans Top 4: Short SMA=124, Long SMA=154, Sharpe=0.6355, Trades=14
[INFO] Kmeans Top 5: Short SMA=40, Long SMA=150, Sharpe=0.5977, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (21, 136)
[INFO]   Nearest: (20.0, 136.0)
[INFO]   Rounded: (273, 287)
[INFO]   Nearest: (272.0, 288.0)
[INFO]   Rounded: (55, 173)
[INFO]   Nearest: (54.0, 174.0)
[INFO]   Rounded: (31, 91)
[INFO]   Nearest: (30.0, 92.0)
[INFO]   Rounded: (143, 196)
[INFO]   Nearest: (144.0, 196.0)
[INFO]   Rounded: (21, 258)
[INFO]   Nearest: (20.0, 258.0)
[INFO]   Rounded: (16, 51)
[INFO]   Nearest: (16.0, 52.0)
[INFO]   Rounded: (45, 206)
[INFO]   Nearest: (44.0, 206.0)
[INFO]   Rounded: (185, 207)
[INFO]   Nearest: (184.0, 208.0)
[INFO]   Rounded: (69, 113)
[INFO]   Nearest: (68.0, 114.0)
[INFO]   Rounded: (106, 149)
[INFO]   Nearest: (106.0, 150.0)
[INFO]   Rounded: (39, 150)
[INFO]   Nearest: (38.0, 150.0)
[INFO]   Rounded: (146, 162)
[INFO]   Rounded: (47, 73)
[INFO]   Nearest: (46.0, 74.0)
[INFO]   Rounded: (239, 253)
[INFO]   Nearest: (238.0, 254.0)
[INFO]   Rounded: (16, 195)
[INFO]   Nearest: (16.0, 194.0)
[INFO]   Rounded: (120, 151)
[INFO]   Nearest: (120.0, 152.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 112, Long SMA: 174
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(52/170) - Original Sharpe: 0.7763, Trades: 11
[INFO] Kmeans cluster 2: SMA(106/154) - Original Sharpe: 0.7490, Trades: 12
[INFO] Kmeans cluster 3: SMA(20/252) - Original Sharpe: 0.6419, Trades: 10
[INFO] Kmeans cluster 4: SMA(124/154) - Original Sharpe: 0.6355, Trades: 14
[INFO] Kmeans cluster 5: SMA(40/150) - Original Sharpe: 0.5977, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (112/174)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (52/170) - Sharpe: 0.7763
[INFO] cluster 2: (106/154) - Sharpe: 0.7490
[INFO] cluster 3: (20/252) - Sharpe: 0.6419
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.848635           -0.993331
1    2021-11-14 2021-11-14            43     1.505824            1.505824
2    2022-01-14 2022-01-14            41    -4.150479           -6.590683
3    2022-03-14 2022-03-14            44    -0.356482           -2.296223
4    2022-05-14 2022-05-14            43     0.314844           -0.269513
5    2022-07-14 2022-07-14            44     2.699252           -0.863241
6    2022-09-14 2022-09-14            43     0.350844           -0.883231
7    2022-11-14 2022-11-14            43     3.719452            2.241950
8    2023-01-14 2023-01-14            41     2.654910            3.406412
9    2023-03-14 2023-03-14            43    -1.548584           -1.548584
10   2023-05-14 2023-05-14            44     3.059517            3.059517
11   2023-07-14 2023-07-14            44     0.609800            0.609800
12   2023-09-14 2023-09-14            43     4.868598            4.868598
13   2023-11-14 2023-11-14            42     0.159231            0.159231
14   2024-01-14 2024-01-14            43    -1.143094           -1.143094
15   2024-03-14 2024-03-14            42     1.807282            1.807282
16   2024-05-14 2024-05-14            44     0.086225            0.086225
17   2024-07-14 2024-07-14            45    -1.430493           -1.978415
18   2024-09-14 2024-09-14            43     1.688514           -0.292585
19   2024-11-14 2024-11-14            33    -3.034107            0.739386
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.8 |             -1.0 |          1.8 | True          
[INFO] 2021-11-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -4.2 |             -6.6 |         -2.4 | False         
[INFO] 2022-03-14   |         -0.4 |             -2.3 |         -1.9 | False         
[INFO] 2022-05-14   |          0.3 |             -0.3 |         -0.6 | False         
[INFO] 2022-07-14   |          2.7 |             -0.9 |         -3.6 | False         
[INFO] 2022-09-14   |          0.4 |             -0.9 |         -1.3 | False         
[INFO] 2022-11-14   |          3.7 |              2.2 |         -1.5 | False         
[INFO] 2023-01-14   |          2.7 |              3.4 |          0.7 | True          
[INFO] 2023-03-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          4.9 |              4.9 |          0.0 | Excluded      
[INFO] 2023-11-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -1.4 |             -2.0 |         -0.6 | False         
[INFO] 2024-09-14   |          1.7 |             -0.3 |         -2.0 | False         
[INFO] 2024-11-14   |         -3.0 |              0.7 |          3.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Kmeans cluster wins (rounded comparison): 3 of 11 periods (27.27% win rate)
[INFO] Updating Excel file with Kmeans results for PA...
[INFO] Excel file updated successfully. Added PA with Kmeans win rate 27.3% in row 39
[INFO] Added best Sharpe parameters 112/174 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 112, Long SMA: 174
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(52/170) - Original Sharpe: 0.7763
[INFO] Added cluster 2 to portfolio: SMA(106/154) - Original Sharpe: 0.7490
[INFO] Added cluster 3 to portfolio: SMA(20/252) - Original Sharpe: 0.6419
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'PA_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1700
[INFO] Kmeans Best out-of-sample Sharpe: 0.2816
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for PA...
[INFO] Excel file updated successfully. Added PA with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PA
[INFO] Big Point Value: 100.0
[INFO] Slippage: 80.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1560 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.4419 to 0.9269
[INFO] 
Best parameters:
[INFO] Short SMA: 112
[INFO] Long SMA: 174
[INFO] Sharpe Ratio: 0.926948
[INFO] Number of Trades: 10
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1560 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.4419 to 0.9269
[INFO] Trades range: 10.0 to 216.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0503 to 2.5689
[INFO] Scaled Long SMA range: -2.6073 to 2.0590
[INFO] Scaled Sharpe ratio range: -3.9594 to 2.0067
[INFO] Scaled Trades range: -0.6313 to 12.8181
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1560 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.7148
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 19
[INFO] Using 19 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 19 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 97 elements
[INFO] Cluster 1: 192 elements
[INFO] Cluster 2: 76 elements
[INFO] Cluster 3: 42 elements
[INFO] Cluster 4: 140 elements
[INFO] Cluster 5: 80 elements
[INFO] Cluster 6: 73 elements
[INFO] Cluster 7: 9 elements
[INFO] Cluster 8: 84 elements
[INFO] Cluster 9: 124 elements
[INFO] Cluster 10: 45 elements
[INFO] Cluster 11: 80 elements
[INFO] Cluster 12: 196 elements
[INFO] Cluster 13: 4 elements
[INFO] Cluster 14: 39 elements
[INFO] Cluster 15: 108 elements
[INFO] Cluster 16: 29 elements
[INFO] Cluster 17: 13 elements
[INFO] Cluster 18: 129 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=36, Long SMA=116, Sharpe=0.4134, Trades=20
[INFO] Cluster 1 cluster: Short SMA=40, Long SMA=148, Sharpe=0.5890, Trades=12
[INFO] Cluster 2 cluster: Short SMA=174, Long SMA=208, Sharpe=0.3209, Trades=11
[INFO] Cluster 3 cluster: Short SMA=136, Long SMA=142, Sharpe=0.5773, Trades=40
[INFO] Cluster 4 cluster: Short SMA=48, Long SMA=208, Sharpe=0.5995, Trades=13
[INFO] Cluster 5 cluster: Short SMA=34, Long SMA=98, Sharpe=0.1067, Trades=28
[INFO] Cluster 6 cluster: Short SMA=98, Long SMA=120, Sharpe=0.4842, Trades=26
[INFO] Cluster 8 cluster: Short SMA=238, Long SMA=252, Sharpe=0.4690, Trades=16
[INFO] Cluster 9 cluster: Short SMA=274, Long SMA=288, Sharpe=0.2116, Trades=13
[INFO] Cluster 10 cluster: Short SMA=18, Long SMA=56, Sharpe=0.0126, Trades=44
[INFO] Cluster 11 cluster: Short SMA=20, Long SMA=252, Sharpe=0.6419, Trades=10
[INFO] Cluster 12 cluster: Short SMA=50, Long SMA=168, Sharpe=0.7980, Trades=11
[INFO] Cluster 14 cluster: Short SMA=14, Long SMA=206, Sharpe=0.3910, Trades=18
[INFO] Cluster 15 cluster: Short SMA=108, Long SMA=156, Sharpe=0.6805, Trades=12
[INFO] Cluster 16 cluster: Short SMA=48, Long SMA=62, Sharpe=0.2687, Trades=43
[INFO] Cluster 18 cluster: Short SMA=142, Long SMA=174, Sharpe=0.3346, Trades=13
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=112, Long SMA=174, Sharpe=0.9269, Trades=10
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=50, Long SMA=168, Sharpe=0.7980, Trades=11
[INFO] Top 2: Short SMA=108, Long SMA=156, Sharpe=0.6805, Trades=12
[INFO] Top 3: Short SMA=20, Long SMA=252, Sharpe=0.6419, Trades=10
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 1534 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 112, Long SMA: 174
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(50/168) - Original Sharpe: 0.7980, Trades: 11
[INFO] Hierarchical cluster 2: SMA(108/156) - Original Sharpe: 0.6805, Trades: 12
[INFO] Hierarchical cluster 3: SMA(20/252) - Original Sharpe: 0.6419, Trades: 10
[INFO] Hierarchical cluster 4: SMA(48/208) - Original Sharpe: 0.5995, Trades: 13
[INFO] Hierarchical cluster 5: SMA(40/148) - Original Sharpe: 0.5890, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (112/174)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (50/168) - Sharpe: 0.7980
[INFO] cluster 2: (108/156) - Sharpe: 0.6805
[INFO] cluster 3: (20/252) - Sharpe: 0.6419
[INFO] Loading PA data from local files...
[INFO] Found data file: A_OHLCV_@PA=13INC_minutes_1440_1805-1650.dat
[INFO] File size: 266975 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.848635           -1.646265
1    2021-11-14 2021-11-14            43     1.505824            1.505824
2    2022-01-14 2022-01-14            41    -4.150479           -5.537291
3    2022-03-14 2022-03-14            44    -0.356482           -2.470627
4    2022-05-14 2022-05-14            43     0.314844           -0.458489
5    2022-07-14 2022-07-14            44     2.699252           -0.314344
6    2022-09-14 2022-09-14            43     0.350844           -0.883231
7    2022-11-14 2022-11-14            43     3.719452            2.691703
8    2023-01-14 2023-01-14            41     2.654910            3.406412
9    2023-03-14 2023-03-14            43    -1.548584           -1.548584
10   2023-05-14 2023-05-14            44     3.059517            3.059517
11   2023-07-14 2023-07-14            44     0.609800            0.609800
12   2023-09-14 2023-09-14            43     4.868598            4.868598
13   2023-11-14 2023-11-14            42     0.159231            0.159231
14   2024-01-14 2024-01-14            43    -1.143094           -1.143094
15   2024-03-14 2024-03-14            42     1.807282            1.807282
16   2024-05-14 2024-05-14            44     0.086225            0.086225
17   2024-07-14 2024-07-14            45    -1.430493           -1.430493
18   2024-09-14 2024-09-14            43     1.688514            0.359471
19   2024-11-14 2024-11-14            33    -3.034107            0.739386
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.8 |             -1.6 |          1.2 | True          
[INFO] 2021-11-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -4.2 |             -5.5 |         -1.3 | False         
[INFO] 2022-03-14   |         -0.4 |             -2.5 |         -2.1 | False         
[INFO] 2022-05-14   |          0.3 |             -0.5 |         -0.8 | False         
[INFO] 2022-07-14   |          2.7 |             -0.3 |         -3.0 | False         
[INFO] 2022-09-14   |          0.4 |             -0.9 |         -1.3 | False         
[INFO] 2022-11-14   |          3.7 |              2.7 |         -1.0 | False         
[INFO] 2023-01-14   |          2.7 |              3.4 |          0.7 | True          
[INFO] 2023-03-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          4.9 |              4.9 |          0.0 | Excluded      
[INFO] 2023-11-14   |          0.2 |              0.2 |          0.0 | Excluded      
[INFO] 2024-01-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-03-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2024-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -1.4 |             -1.4 |          0.0 | Excluded      
[INFO] 2024-09-14   |          1.7 |              0.4 |         -1.3 | False         
[INFO] 2024-11-14   |         -3.0 |              0.7 |          3.7 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Hierarchical cluster wins (rounded comparison): 3 of 10 periods (30.00% win rate)
[INFO] Updating Excel file with Hierarchical results for PA...
[INFO] Excel file updated successfully. Added PA with Hierarchical win rate 30.0% in row 39
[INFO] Added best Sharpe parameters 112/174 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 112, Long SMA: 174
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(50/168) - Original Sharpe: 0.7980
[INFO] Added cluster 2 to portfolio: SMA(108/156) - Original Sharpe: 0.6805
[INFO] Added cluster 3 to portfolio: SMA(20/252) - Original Sharpe: 0.6419
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'PA_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.0551
[INFO] Hierarchical Best out-of-sample Sharpe: 0.2816
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for PA...
[INFO] Excel file updated successfully. Added PA with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PA
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for PL in column D: 20.0
[INFO] Using slippage from Excel column D: 20.0
[INFO] 
Symbol: @PL
[INFO] Description: Platinum Continuous Contract [Jul25]
[INFO] Exchange: NYMEX
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.0
[INFO] Big point value: 50.0
[INFO] Data shape: (6008, 6)
[INFO] Date range: 2001-05-02 16:55:00 to 2025-04-07 16:55:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2001-05-02 16:55:00  840.7  850.2  840.7  850.2    10.0
1 2001-05-09 16:55:00  840.7  840.7  840.7  840.7     8.0
2 2001-05-16 16:55:00  851.1  851.1  851.1  851.1     3.0
3 2001-05-21 16:55:00  854.7  859.2  854.7  859.2    20.0
4 2001-05-23 16:55:00  848.3  848.3  848.3  848.3     1.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 25.81 seconds (0.43 minutes)
[INFO] Best parameters found: Short SMA = 120, Long SMA = 122
[INFO] Best fitness (Sharpe ratio): 0.452770
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 120, Long SMA = 122, Sharpe = 0.452770
[INFO] Top 2: Short SMA = 120, Long SMA = 144, Sharpe = 0.432755
[INFO] Top 3: Short SMA = 130, Long SMA = 142, Sharpe = 0.352039
[INFO] Top 4: Short SMA = 128, Long SMA = 142, Sharpe = 0.346214
[INFO] Top 5: Short SMA = 126, Long SMA = 142, Sharpe = 0.343803
[INFO] Hall of Fame size: 2233
[INFO] Number of elements in all_results: 1898
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 335 had penalty fitness
[INFO] Total filtered from Hall of Fame: 335
[INFO] Hall of Fame -> all_results: 2233 -> 1898
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1898 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3106, Evaluation data length: 2839
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @PL
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 6.07 contracts
[INFO] Maximum Position Size: 11 contracts
[INFO] Strategy Total P&L: $320,885.00
[INFO] Market Buy & Hold P&L: $-30,695.00
[INFO] Outperformance: $351,580.00
[INFO] Sharpe ratio (entire period, annualized): 0.308761
[INFO] Sharpe ratio (in-sample, annualized): 0.417632
[INFO] Sharpe ratio (out-of-sample, annualized): 0.059291
[INFO] Maximum Drawdown: $123,140.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $217,005.00
[INFO] Out-of-sample P&L: $13,450.00
[INFO] 
Best parameters from GA: Short SMA = 120, Long SMA = 122, Sharpe = 0.452770
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2233
[INFO] Cache hits (repeated combinations): 6410
[INFO] Total checks: 8643
[INFO] Cache hit rate: 74.16%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 50.0
[INFO] Slippage: 20.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1898 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.9282 to 0.4528
[INFO] 
Best parameters:
[INFO] Short SMA: 120
[INFO] Long SMA: 122
[INFO] Sharpe Ratio: 0.452770
[INFO] Number of Trades: 71
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1898 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.9282 to 0.4528
[INFO] Trades range: 10.0 to 192.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.4356 to 1.8904
[INFO] Scaled Long SMA range: -2.9502 to 1.2010
[INFO] Scaled Sharpe ratio range: -3.1313 to 2.8462
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 19
[INFO] Using 19 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=19...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 79 elements
[INFO] Kmeans Cluster 1: 130 elements
[INFO] Kmeans Cluster 2: 60 elements
[INFO] Kmeans Cluster 3: 97 elements
[INFO] Kmeans Cluster 4: 183 elements
[INFO] Kmeans Cluster 5: 62 elements
[INFO] Kmeans Cluster 6: 116 elements
[INFO] Kmeans Cluster 7: 115 elements
[INFO] Kmeans Cluster 8: 56 elements
[INFO] Kmeans Cluster 9: 69 elements
[INFO] Kmeans Cluster 10: 134 elements
[INFO] Kmeans Cluster 11: 86 elements
[INFO] Kmeans Cluster 12: 71 elements
[INFO] Kmeans Cluster 13: 80 elements
[INFO] Kmeans Cluster 14: 176 elements
[INFO] Kmeans Cluster 15: 121 elements
[INFO] Kmeans Cluster 16: 120 elements
[INFO] Kmeans Cluster 17: 79 elements
[INFO] Kmeans Cluster 18: 64 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=114.15, Long SMA=269.97, Sharpe=-0.0315
[INFO] Centroid 1: Short SMA=227.40, Long SMA=252.18, Sharpe=-0.2198
[INFO] Centroid 2: Short SMA=25.20, Long SMA=64.33, Sharpe=0.0405
[INFO] Centroid 3: Short SMA=36.89, Long SMA=277.84, Sharpe=-0.5647
[INFO] Centroid 4: Short SMA=252.77, Long SMA=285.38, Sharpe=0.0942
[INFO] Centroid 5: Short SMA=34.39, Long SMA=70.65, Sharpe=-0.1921
[INFO] Centroid 6: Short SMA=65.55, Long SMA=147.52, Sharpe=-0.2782
[INFO] Centroid 7: Short SMA=126.90, Long SMA=160.99, Sharpe=-0.0258
[INFO] Centroid 8: Short SMA=179.79, Long SMA=213.25, Sharpe=-0.6937
[INFO] Centroid 9: Short SMA=279.16, Long SMA=293.42, Sharpe=-0.2718
[INFO] Centroid 10: Short SMA=127.96, Long SMA=198.99, Sharpe=-0.1684
[INFO] Centroid 11: Short SMA=77.95, Long SMA=218.40, Sharpe=-0.4521
[INFO] Centroid 12: Short SMA=32.42, Long SMA=216.45, Sharpe=-0.2337
[INFO] Centroid 13: Short SMA=64.85, Long SMA=120.27, Sharpe=-0.5038
[INFO] Centroid 14: Short SMA=238.57, Long SMA=278.45, Sharpe=-0.0683
[INFO] Centroid 15: Short SMA=49.06, Long SMA=283.02, Sharpe=-0.3792
[INFO] Centroid 16: Short SMA=186.68, Long SMA=238.48, Sharpe=-0.4300
[INFO] Centroid 17: Short SMA=23.59, Long SMA=160.03, Sharpe=-0.0431
[INFO] Centroid 18: Short SMA=121.91, Long SMA=143.22, Sharpe=0.2108
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=120, Long SMA=122, Sharpe=0.4528, Trades=71
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=120, Long SMA=142, Sharpe=0.1830, Trades=29
[INFO] Kmeans Top 2: Short SMA=256, Long SMA=286, Sharpe=0.1131, Trades=21
[INFO] Kmeans Top 3: Short SMA=114, Long SMA=278, Sharpe=0.0145, Trades=11
[INFO] Kmeans Top 4: Short SMA=18, Long SMA=56, Sharpe=0.0100, Trades=40
[INFO] Kmeans Top 5: Short SMA=22, Long SMA=162, Sharpe=-0.0294, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18}
[INFO]   Rounded: (114, 270)
[INFO]   Rounded: (227, 252)
[INFO]   Nearest: (228.0, 252.0)
[INFO]   Rounded: (25, 64)
[INFO]   Nearest: (26.0, 64.0)
[INFO]   Rounded: (37, 278)
[INFO]   Nearest: (36.0, 278.0)
[INFO]   Rounded: (253, 285)
[INFO]   Nearest: (252.0, 286.0)
[INFO]   Rounded: (34, 71)
[INFO]   Nearest: (34.0, 70.0)
[INFO]   Rounded: (66, 148)
[INFO]   Rounded: (127, 161)
[INFO]   Nearest: (126.0, 160.0)
[INFO]   Rounded: (180, 213)
[INFO]   Nearest: (180.0, 214.0)
[INFO]   Rounded: (279, 293)
[INFO]   Nearest: (280.0, 294.0)
[INFO]   Rounded: (128, 199)
[INFO]   Nearest: (128.0, 198.0)
[INFO]   Rounded: (78, 218)
[INFO]   Rounded: (32, 216)
[INFO]   Rounded: (65, 120)
[INFO]   Nearest: (64.0, 120.0)
[INFO]   Rounded: (239, 278)
[INFO]   Nearest: (238.0, 278.0)
[INFO]   Rounded: (49, 283)
[INFO]   Nearest: (50.0, 284.0)
[INFO]   Rounded: (187, 238)
[INFO]   Nearest: (186.0, 238.0)
[INFO]   Rounded: (24, 160)
[INFO]   Rounded: (122, 143)
[INFO]   Nearest: (122.0, 144.0)
[INFO] Successfully plotted 19 out of 19 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 120, Long SMA: 122
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] File size: 288521 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(120/142) - Original Sharpe: 0.1830, Trades: 29
[INFO] Kmeans cluster 2: SMA(256/286) - Original Sharpe: 0.1131, Trades: 21
[INFO] Kmeans cluster 3: SMA(114/278) - Original Sharpe: 0.0145, Trades: 11
[INFO] Kmeans cluster 4: SMA(18/56) - Original Sharpe: 0.0100, Trades: 40
[INFO] Kmeans cluster 5: SMA(22/162) - Original Sharpe: -0.0294, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (120/122)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 120, Long SMA: 122
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] Error: No Kmeans cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PL
[INFO] Big Point Value: 50.0
[INFO] Slippage: 20.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1898 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.9282 to 0.4528
[INFO] 
Best parameters:
[INFO] Short SMA: 120
[INFO] Long SMA: 122
[INFO] Sharpe Ratio: 0.452770
[INFO] Number of Trades: 71
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1898 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.9282 to 0.4528
[INFO] Trades range: 10.0 to 192.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.4356 to 1.8904
[INFO] Scaled Long SMA range: -2.9502 to 1.2010
[INFO] Scaled Sharpe ratio range: -3.1313 to 2.8462
[INFO] Scaled Trades range: -0.9070 to 12.0789
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1898 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.4957
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 296 elements
[INFO] Cluster 1: 144 elements
[INFO] Cluster 2: 285 elements
[INFO] Cluster 3: 80 elements
[INFO] Cluster 4: 177 elements
[INFO] Cluster 5: 183 elements
[INFO] Cluster 6: 194 elements
[INFO] Cluster 7: 109 elements
[INFO] Cluster 8: 4 elements
[INFO] Cluster 9: 110 elements
[INFO] Cluster 10: 83 elements
[INFO] Cluster 11: 83 elements
[INFO] Cluster 12: 72 elements
[INFO] Cluster 13: 78 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=250, Long SMA=286, Sharpe=0.0592, Trades=19
[INFO] Cluster 1 cluster: Short SMA=26, Long SMA=132, Sharpe=-0.0406, Trades=22
[INFO] Cluster 2 cluster: Short SMA=52, Long SMA=272, Sharpe=-0.4717, Trades=16
[INFO] Cluster 3 cluster: Short SMA=32, Long SMA=52, Sharpe=-0.1749, Trades=46
[INFO] Cluster 4 cluster: Short SMA=228, Long SMA=266, Sharpe=-0.2066, Trades=21
[INFO] Cluster 5 cluster: Short SMA=62, Long SMA=142, Sharpe=-0.4241, Trades=18
[INFO] Cluster 6 cluster: Short SMA=120, Long SMA=190, Sharpe=-0.0744, Trades=14
[INFO] Cluster 7 cluster: Short SMA=194, Long SMA=250, Sharpe=-0.4863, Trades=15
[INFO] Cluster 9 cluster: Short SMA=126, Long SMA=152, Sharpe=0.0949, Trades=27
[INFO] Cluster 10 cluster: Short SMA=262, Long SMA=266, Sharpe=-0.2294, Trades=49
[INFO] Cluster 11 cluster: Short SMA=116, Long SMA=272, Sharpe=-0.0381, Trades=11
[INFO] Cluster 12 cluster: Short SMA=32, Long SMA=216, Sharpe=-0.3674, Trades=18
[INFO] Cluster 13 cluster: Short SMA=182, Long SMA=220, Sharpe=-0.6845, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=120, Long SMA=122, Sharpe=0.4528, Trades=71
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=126, Long SMA=152, Sharpe=0.0949, Trades=27
[INFO] Top 2: Short SMA=250, Long SMA=286, Sharpe=0.0592, Trades=19
[INFO] Top 3: Short SMA=116, Long SMA=272, Sharpe=-0.0381, Trades=11
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 1894 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 120, Long SMA: 122
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading PL data from local files...
[INFO] Found data file: A_OHLCV_@PL_minutes_1440_1802-1655.dat
[INFO] File size: 288521 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(126/152) - Original Sharpe: 0.0949, Trades: 27
[INFO] Hierarchical cluster 2: SMA(250/286) - Original Sharpe: 0.0592, Trades: 19
[INFO] Hierarchical cluster 3: SMA(116/272) - Original Sharpe: -0.0381, Trades: 11
[INFO] Hierarchical cluster 4: SMA(26/132) - Original Sharpe: -0.0406, Trades: 22
[INFO] Hierarchical cluster 5: SMA(120/190) - Original Sharpe: -0.0744, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (120/122)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 120, Long SMA: 122
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\PL
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for RB in column D: 22.0
[INFO] Using slippage from Excel column D: 22.0
[INFO] 
Symbol: @RB
[INFO] Description: NYHarborBlendstock RBOB Continuous Contract [May25]
[INFO] Exchange: NYMEX
[INFO] Interval: minutes 1440
[INFO] Tick size: 4.2
[INFO] Big point value: 42000.0
[INFO] Data shape: (6098, 6)
[INFO] Date range: 2001-05-14 16:55:00 to 2025-04-07 16:55:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-14 16:55:00 -2.7636 -2.7571 -2.8091 -2.8026   110.0
1 2001-05-15 16:55:00 -2.8056 -2.7886 -2.8091 -2.8091   690.0
2 2001-05-16 16:55:00 -2.8043 -2.8011 -2.8326 -2.8286   265.0
3 2001-05-17 16:55:00 -2.8306 -2.7881 -2.8356 -2.7881   328.0
4 2001-05-18 16:55:00 -2.7896 -2.7783 -2.7896 -2.7856   195.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 41.11 seconds (0.69 minutes)
[INFO] Best parameters found: Short SMA = 42, Long SMA = 50
[INFO] Best fitness (Sharpe ratio): 0.800794
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 42, Long SMA = 50, Sharpe = 0.800794
[INFO] Top 2: Short SMA = 46, Long SMA = 50, Sharpe = 0.772582
[INFO] Top 3: Short SMA = 44, Long SMA = 50, Sharpe = 0.758025
[INFO] Top 4: Short SMA = 42, Long SMA = 94, Sharpe = 0.756524
[INFO] Top 5: Short SMA = 44, Long SMA = 52, Sharpe = 0.747586
[INFO] Hall of Fame size: 2308
[INFO] Number of elements in all_results: 2069
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 239 had penalty fitness
[INFO] Total filtered from Hall of Fame: 239
[INFO] Hall of Fame -> all_results: 2308 -> 2069
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2069 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3105, Evaluation data length: 2838
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @RB
[INFO] Big Point Value (from data): 42000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.08 contracts
[INFO] Maximum Position Size: 5 contracts
[INFO] Strategy Total P&L: $-148,957.20
[INFO] Market Buy & Hold P&L: $61,933.20
[INFO] Outperformance: $-210,890.40
[INFO] Sharpe ratio (entire period, annualized): -0.177856
[INFO] Sharpe ratio (in-sample, annualized): -0.012681
[INFO] Sharpe ratio (out-of-sample, annualized): -0.538879
[INFO] Maximum Drawdown: $457,149.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-7,564.20
[INFO] Out-of-sample P&L: $-147,159.60
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 50, Sharpe = 0.800794
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2308
[INFO] Cache hits (repeated combinations): 6297
[INFO] Total checks: 8605
[INFO] Cache hit rate: 73.18%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2069 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -1.0352 to 0.8008
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.800794
[INFO] Number of Trades: 68
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2069 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -1.0352 to 0.8008
[INFO] Trades range: 11.0 to 198.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0771 to 2.5469
[INFO] Scaled Long SMA range: -2.2567 to 1.5913
[INFO] Scaled Sharpe ratio range: -2.9503 to 2.3073
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 14
[INFO] Using 14 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=14...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 129 elements
[INFO] Kmeans Cluster 1: 95 elements
[INFO] Kmeans Cluster 2: 60 elements
[INFO] Kmeans Cluster 3: 96 elements
[INFO] Kmeans Cluster 4: 225 elements
[INFO] Kmeans Cluster 5: 193 elements
[INFO] Kmeans Cluster 6: 121 elements
[INFO] Kmeans Cluster 7: 169 elements
[INFO] Kmeans Cluster 8: 134 elements
[INFO] Kmeans Cluster 9: 193 elements
[INFO] Kmeans Cluster 10: 189 elements
[INFO] Kmeans Cluster 11: 87 elements
[INFO] Kmeans Cluster 12: 243 elements
[INFO] Kmeans Cluster 13: 135 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=46.99, Long SMA=153.91, Sharpe=-0.0542
[INFO] Centroid 1: Short SMA=21.45, Long SMA=47.85, Sharpe=0.2262
[INFO] Centroid 2: Short SMA=191.37, Long SMA=275.00, Sharpe=-0.4671
[INFO] Centroid 3: Short SMA=243.79, Long SMA=282.94, Sharpe=-0.8150
[INFO] Centroid 4: Short SMA=33.32, Long SMA=255.46, Sharpe=0.0842
[INFO] Centroid 5: Short SMA=162.65, Long SMA=212.85, Sharpe=0.0855
[INFO] Centroid 6: Short SMA=66.33, Long SMA=103.54, Sharpe=0.1732
[INFO] Centroid 7: Short SMA=28.00, Long SMA=114.84, Sharpe=0.3575
[INFO] Centroid 8: Short SMA=91.22, Long SMA=211.72, Sharpe=-0.2573
[INFO] Centroid 9: Short SMA=32.36, Long SMA=204.85, Sharpe=-0.0458
[INFO] Centroid 10: Short SMA=197.33, Long SMA=238.42, Sharpe=-0.1381
[INFO] Centroid 11: Short SMA=272.92, Long SMA=286.23, Sharpe=-0.4854
[INFO] Centroid 12: Short SMA=36.92, Long SMA=77.17, Sharpe=0.5300
[INFO] Centroid 13: Short SMA=108.73, Long SMA=154.18, Sharpe=-0.3883
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=50, Sharpe=0.8008, Trades=68
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=38, Long SMA=78, Sharpe=0.6914, Trades=24
[INFO] Kmeans Top 2: Short SMA=30, Long SMA=116, Sharpe=0.4070, Trades=16
[INFO] Kmeans Top 3: Short SMA=20, Long SMA=48, Sharpe=0.2545, Trades=47
[INFO] Kmeans Top 4: Short SMA=160, Long SMA=216, Sharpe=0.1881, Trades=15
[INFO] Kmeans Top 5: Short SMA=62, Long SMA=102, Sharpe=0.1298, Trades=19
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}
[INFO]   Rounded: (47, 154)
[INFO]   Nearest: (46.0, 154.0)
[INFO]   Rounded: (21, 48)
[INFO]   Nearest: (22.0, 48.0)
[INFO]   Rounded: (191, 275)
[INFO]   Nearest: (192.0, 274.0)
[INFO]   Rounded: (244, 283)
[INFO]   Nearest: (244.0, 282.0)
[INFO]   Rounded: (33, 255)
[INFO]   Nearest: (34.0, 256.0)
[INFO]   Rounded: (163, 213)
[INFO]   Nearest: (162.0, 212.0)
[INFO]   Rounded: (66, 104)
[INFO]   Rounded: (28, 115)
[INFO]   Nearest: (28.0, 114.0)
[INFO]   Rounded: (91, 212)
[INFO]   Nearest: (92.0, 212.0)
[INFO]   Rounded: (32, 205)
[INFO]   Nearest: (32.0, 204.0)
[INFO]   Rounded: (197, 238)
[INFO]   Nearest: (198.0, 238.0)
[INFO]   Rounded: (273, 286)
[INFO]   Nearest: (272.0, 286.0)
[INFO]   Rounded: (37, 77)
[INFO]   Nearest: (36.0, 78.0)
[INFO]   Rounded: (109, 154)
[INFO]   Nearest: (108.0, 154.0)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(38/78) - Original Sharpe: 0.6914, Trades: 24
[INFO] Kmeans cluster 2: SMA(30/116) - Original Sharpe: 0.4070, Trades: 16
[INFO] Kmeans cluster 3: SMA(20/48) - Original Sharpe: 0.2545, Trades: 47
[INFO] Kmeans cluster 4: SMA(160/216) - Original Sharpe: 0.1881, Trades: 15
[INFO] Kmeans cluster 5: SMA(62/102) - Original Sharpe: 0.1298, Trades: 19
[INFO] Trimmed warm-up period. Evaluation data length: 2838
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/78) - Sharpe: 0.6914
[INFO] cluster 2: (30/116) - Sharpe: 0.4070
[INFO] cluster 3: (20/48) - Sharpe: 0.2545
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.735456            2.433836
1    2021-11-14 2021-11-14            43    -2.165624           -1.469483
2    2022-01-14 2022-01-14            41     1.793648            3.057166
3    2022-03-14 2022-03-14            44    -0.267645            2.625333
4    2022-05-14 2022-05-14            43    -1.664283           -1.407125
5    2022-07-14 2022-07-14            44     2.545316            1.198839
6    2022-09-14 2022-09-14            43    -1.824873           -2.229762
7    2022-11-14 2022-11-14            43    -2.147754           -4.719865
8    2023-01-14 2023-01-14            41     0.173521            0.053448
9    2023-03-14 2023-03-14            43    -5.761990           -4.139109
10   2023-05-14 2023-05-14            44     1.051850            1.257162
11   2023-07-14 2023-07-14            44     2.639646            2.639646
12   2023-09-14 2023-09-14            43     0.320827           -3.306869
13   2023-11-14 2023-11-14            42     0.697919            0.891761
14   2024-01-14 2024-01-14            43     0.380540           -0.637708
15   2024-03-14 2024-03-14            42    -1.088742           -1.207407
16   2024-05-14 2024-05-14            44    -0.468733           -3.930308
17   2024-07-14 2024-07-14            45     0.730155            1.751675
18   2024-09-14 2024-09-14            43    -2.244826           -1.245391
19   2024-11-14 2024-11-14            33     0.455012           -1.313306
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |              2.4 |          4.1 | True          
[INFO] 2021-11-14   |         -2.2 |             -1.5 |          0.7 | True          
[INFO] 2022-01-14   |          1.8 |              3.1 |          1.3 | True          
[INFO] 2022-03-14   |         -0.3 |              2.6 |          2.9 | True          
[INFO] 2022-05-14   |         -1.7 |             -1.4 |          0.3 | True          
[INFO] 2022-07-14   |          2.5 |              1.2 |         -1.3 | False         
[INFO] 2022-09-14   |         -1.8 |             -2.2 |         -0.4 | False         
[INFO] 2022-11-14   |         -2.1 |             -4.7 |         -2.6 | False         
[INFO] 2023-01-14   |          0.2 |              0.1 |         -0.1 | False         
[INFO] 2023-03-14   |         -5.8 |             -4.1 |          1.7 | True          
[INFO] 2023-05-14   |          1.1 |              1.3 |          0.2 | True          
[INFO] 2023-07-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          0.3 |             -3.3 |         -3.6 | False         
[INFO] 2023-11-14   |          0.7 |              0.9 |          0.2 | True          
[INFO] 2024-01-14   |          0.4 |             -0.6 |         -1.0 | False         
[INFO] 2024-03-14   |         -1.1 |             -1.2 |         -0.1 | False         
[INFO] 2024-05-14   |         -0.5 |             -3.9 |         -3.4 | False         
[INFO] 2024-07-14   |          0.7 |              1.8 |          1.1 | True          
[INFO] 2024-09-14   |         -2.2 |             -1.2 |          1.0 | True          
[INFO] 2024-11-14   |          0.5 |             -1.3 |         -1.8 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 10 of 19 periods (52.63% win rate)
[INFO] Updating Excel file with Kmeans results for RB...
[INFO] Excel file updated successfully. Added RB with Kmeans win rate 52.6% in row 40
[INFO] Added best Sharpe parameters 42/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/78) - Original Sharpe: 0.6914
[INFO] Added cluster 2 to portfolio: SMA(30/116) - Original Sharpe: 0.4070
[INFO] Added cluster 3 to portfolio: SMA(20/48) - Original Sharpe: 0.2545
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RB_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1168
[INFO] Kmeans Best out-of-sample Sharpe: -0.4045
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for RB...
[INFO] Excel file updated successfully. Added RB with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RB
[INFO] Big Point Value: 42000.0
[INFO] Slippage: 22.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2069 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -1.0352 to 0.8008
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.800794
[INFO] Number of Trades: 68
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2069 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -1.0352 to 0.8008
[INFO] Trades range: 11.0 to 198.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0771 to 2.5469
[INFO] Scaled Long SMA range: -2.2567 to 1.5913
[INFO] Scaled Sharpe ratio range: -2.9503 to 2.3073
[INFO] Scaled Trades range: -0.7956 to 12.7438
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2069 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5802
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 211 elements
[INFO] Cluster 1: 120 elements
[INFO] Cluster 2: 236 elements
[INFO] Cluster 3: 156 elements
[INFO] Cluster 4: 244 elements
[INFO] Cluster 5: 163 elements
[INFO] Cluster 6: 196 elements
[INFO] Cluster 7: 188 elements
[INFO] Cluster 8: 41 elements
[INFO] Cluster 9: 21 elements
[INFO] Cluster 10: 34 elements
[INFO] Cluster 11: 83 elements
[INFO] Cluster 12: 123 elements
[INFO] Cluster 13: 82 elements
[INFO] Cluster 14: 21 elements
[INFO] Cluster 15: 1 elements
[INFO] Cluster 16: 149 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=98, Long SMA=160, Sharpe=-0.3228, Trades=15
[INFO] Cluster 1 cluster: Short SMA=230, Long SMA=284, Sharpe=-0.8336, Trades=15
[INFO] Cluster 2 cluster: Short SMA=192, Long SMA=240, Sharpe=-0.1411, Trades=17
[INFO] Cluster 3 cluster: Short SMA=26, Long SMA=56, Sharpe=0.5217, Trades=42
[INFO] Cluster 4 cluster: Short SMA=34, Long SMA=94, Sharpe=0.5351, Trades=22
[INFO] Cluster 5 cluster: Short SMA=50, Long SMA=112, Sharpe=0.2404, Trades=19
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=214, Sharpe=-0.1027, Trades=16
[INFO] Cluster 7 cluster: Short SMA=40, Long SMA=250, Sharpe=0.1953, Trades=11
[INFO] Cluster 8 cluster: Short SMA=202, Long SMA=206, Sharpe=0.2184, Trades=37
[INFO] Cluster 9 cluster: Short SMA=40, Long SMA=44, Sharpe=0.4687, Trades=90
[INFO] Cluster 10 cluster: Short SMA=32, Long SMA=42, Sharpe=0.0833, Trades=64
[INFO] Cluster 11 cluster: Short SMA=272, Long SMA=290, Sharpe=-0.3933, Trades=21
[INFO] Cluster 12 cluster: Short SMA=158, Long SMA=208, Sharpe=-0.0324, Trades=14
[INFO] Cluster 13 cluster: Short SMA=94, Long SMA=224, Sharpe=-0.2276, Trades=15
[INFO] Cluster 14 cluster: Short SMA=280, Long SMA=282, Sharpe=-0.3595, Trades=51
[INFO] Cluster 16 cluster: Short SMA=42, Long SMA=160, Sharpe=-0.1137, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=50, Sharpe=0.8008, Trades=68
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=34, Long SMA=94, Sharpe=0.5351, Trades=22
[INFO] Top 2: Short SMA=26, Long SMA=56, Sharpe=0.5217, Trades=42
[INFO] Top 3: Short SMA=40, Long SMA=44, Sharpe=0.4687, Trades=90
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 2068 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(34/94) - Original Sharpe: 0.5351, Trades: 22
[INFO] Hierarchical cluster 2: SMA(26/56) - Original Sharpe: 0.5217, Trades: 42
[INFO] Hierarchical cluster 3: SMA(40/44) - Original Sharpe: 0.4687, Trades: 90
[INFO] Hierarchical cluster 4: SMA(50/112) - Original Sharpe: 0.2404, Trades: 19
[INFO] Hierarchical cluster 5: SMA(202/206) - Original Sharpe: 0.2184, Trades: 37
[INFO] Trimmed warm-up period. Evaluation data length: 2838
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/94) - Sharpe: 0.5351
[INFO] cluster 2: (26/56) - Sharpe: 0.5217
[INFO] cluster 3: (40/44) - Sharpe: 0.4687
[INFO] Loading RB data from local files...
[INFO] Found data file: A_OHLCV_@RB_minutes_1440_1802-1655.dat
[INFO] File size: 292856 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.735456            1.788389
1    2021-11-14 2021-11-14            43    -2.165624           -2.291651
2    2022-01-14 2022-01-14            41     1.793648            3.211558
3    2022-03-14 2022-03-14            44    -0.267645            2.765096
4    2022-05-14 2022-05-14            43    -1.664283           -1.664283
5    2022-07-14 2022-07-14            44     2.545316            0.445840
6    2022-09-14 2022-09-14            43    -1.824873           -2.491193
7    2022-11-14 2022-11-14            43    -2.147754           -3.977439
8    2023-01-14 2023-01-14            41     0.173521           -2.136213
9    2023-03-14 2023-03-14            43    -5.761990           -4.590295
10   2023-05-14 2023-05-14            44     1.051850            2.027251
11   2023-07-14 2023-07-14            44     2.639646            2.639646
12   2023-09-14 2023-09-14            43     0.320827           -3.811163
13   2023-11-14 2023-11-14            42     0.697919            0.543929
14   2024-01-14 2024-01-14            43     0.380540            0.511001
15   2024-03-14 2024-03-14            42    -1.088742           -1.088742
16   2024-05-14 2024-05-14            44    -0.468733           -1.978626
17   2024-07-14 2024-07-14            45     0.730155            2.883588
18   2024-09-14 2024-09-14            43    -2.244826           -1.254431
19   2024-11-14 2024-11-14            33     0.455012            0.708112
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.7 |              1.8 |          3.5 | True          
[INFO] 2021-11-14   |         -2.2 |             -2.3 |         -0.1 | False         
[INFO] 2022-01-14   |          1.8 |              3.2 |          1.4 | True          
[INFO] 2022-03-14   |         -0.3 |              2.8 |          3.1 | True          
[INFO] 2022-05-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.5 |              0.4 |         -2.1 | False         
[INFO] 2022-09-14   |         -1.8 |             -2.5 |         -0.7 | False         
[INFO] 2022-11-14   |         -2.1 |             -4.0 |         -1.9 | False         
[INFO] 2023-01-14   |          0.2 |             -2.1 |         -2.3 | False         
[INFO] 2023-03-14   |         -5.8 |             -4.6 |          1.2 | True          
[INFO] 2023-05-14   |          1.1 |              2.0 |          0.9 | True          
[INFO] 2023-07-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-09-14   |          0.3 |             -3.8 |         -4.1 | False         
[INFO] 2023-11-14   |          0.7 |              0.5 |         -0.2 | False         
[INFO] 2024-01-14   |          0.4 |              0.5 |          0.1 | True          
[INFO] 2024-03-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -0.5 |             -2.0 |         -1.5 | False         
[INFO] 2024-07-14   |          0.7 |              2.9 |          2.2 | True          
[INFO] 2024-09-14   |         -2.2 |             -1.3 |          0.9 | True          
[INFO] 2024-11-14   |          0.5 |              0.7 |          0.2 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2023-07-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 9 of 17 periods (52.94% win rate)
[INFO] Updating Excel file with Hierarchical results for RB...
[INFO] Excel file updated successfully. Added RB with Hierarchical win rate 52.9% in row 40
[INFO] Added best Sharpe parameters 42/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/94) - Original Sharpe: 0.5351
[INFO] Added cluster 2 to portfolio: SMA(26/56) - Original Sharpe: 0.5217
[INFO] Added cluster 3 to portfolio: SMA(40/44) - Original Sharpe: 0.4687
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RB_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2155
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4045
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for RB...
[INFO] Excel file updated successfully. Added RB with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RB
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for RTY in column D: 12.0
[INFO] Using slippage from Excel column D: 12.0
[INFO] 
Symbol: @RTY
[INFO] Description: Emini Russell 2000 Idx Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.0
[INFO] Big point value: 50.0
[INFO] Data shape: (6049, 6)
[INFO] Date range: 2001-10-25 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2001-10-25 15:57:00  577.1  587.5  577.1  587.5   611.0
1 2001-10-26 15:57:00  596.1  596.1  586.0  587.7   643.0
2 2001-10-29 15:57:00  586.9  588.5  577.8  577.8   582.0
3 2001-10-30 15:57:00  576.0  576.5  569.2  571.5   603.0
4 2001-10-31 15:57:00  576.5  580.5  574.0  576.5   981.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 24.88 seconds (0.41 minutes)
[INFO] Best parameters found: Short SMA = 122, Long SMA = 142
[INFO] Best fitness (Sharpe ratio): 0.356940
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 122, Long SMA = 142, Sharpe = 0.356940
[INFO] Top 2: Short SMA = 208, Long SMA = 234, Sharpe = 0.329957
[INFO] Top 3: Short SMA = 120, Long SMA = 146, Sharpe = 0.323707
[INFO] Top 4: Short SMA = 120, Long SMA = 144, Sharpe = 0.308582
[INFO] Top 5: Short SMA = 122, Long SMA = 144, Sharpe = 0.299656
[INFO] Hall of Fame size: 2531
[INFO] Number of elements in all_results: 1942
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 589 had penalty fitness
[INFO] Total filtered from Hall of Fame: 589
[INFO] Hall of Fame -> all_results: 2531 -> 1942
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1942 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @RTY
[INFO] Big Point Value (from data): 50.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.21 contracts
[INFO] Maximum Position Size: 11 contracts
[INFO] Strategy Total P&L: $-199,165.00
[INFO] Market Buy & Hold P&L: $47,790.00
[INFO] Outperformance: $-246,955.00
[INFO] Sharpe ratio (entire period, annualized): -0.112891
[INFO] Sharpe ratio (in-sample, annualized): -0.245328
[INFO] Sharpe ratio (out-of-sample, annualized): 0.186755
[INFO] Maximum Drawdown: $252,295.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-141,995.00
[INFO] Out-of-sample P&L: $47,775.00
[INFO] 
Best parameters from GA: Short SMA = 122, Long SMA = 142, Sharpe = 0.356940
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2531
[INFO] Cache hits (repeated combinations): 6019
[INFO] Total checks: 8550
[INFO] Cache hit rate: 70.40%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 50.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1942 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -1.0342 to 0.3569
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 142
[INFO] Sharpe Ratio: 0.356940
[INFO] Number of Trades: 18
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1942 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -1.0342 to 0.3569
[INFO] Trades range: 10.0 to 204.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3244 to 2.4597
[INFO] Scaled Long SMA range: -3.0045 to 1.8285
[INFO] Scaled Sharpe ratio range: -3.9322 to 2.6620
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 14
[INFO] Using 14 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=14...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 70 elements
[INFO] Kmeans Cluster 1: 211 elements
[INFO] Kmeans Cluster 2: 174 elements
[INFO] Kmeans Cluster 3: 92 elements
[INFO] Kmeans Cluster 4: 92 elements
[INFO] Kmeans Cluster 5: 148 elements
[INFO] Kmeans Cluster 6: 152 elements
[INFO] Kmeans Cluster 7: 109 elements
[INFO] Kmeans Cluster 8: 174 elements
[INFO] Kmeans Cluster 9: 169 elements
[INFO] Kmeans Cluster 10: 178 elements
[INFO] Kmeans Cluster 11: 91 elements
[INFO] Kmeans Cluster 12: 113 elements
[INFO] Kmeans Cluster 13: 169 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=26.74, Long SMA=56.69, Sharpe=-0.3187
[INFO] Centroid 1: Short SMA=67.19, Long SMA=232.17, Sharpe=-0.1949
[INFO] Centroid 2: Short SMA=35.43, Long SMA=142.77, Sharpe=-0.0428
[INFO] Centroid 3: Short SMA=255.13, Long SMA=281.46, Sharpe=-0.4536
[INFO] Centroid 4: Short SMA=213.37, Long SMA=231.43, Sharpe=0.0916
[INFO] Centroid 5: Short SMA=117.09, Long SMA=152.08, Sharpe=0.0865
[INFO] Centroid 6: Short SMA=23.24, Long SMA=234.64, Sharpe=-0.0317
[INFO] Centroid 7: Short SMA=257.36, Long SMA=277.01, Sharpe=-0.7344
[INFO] Centroid 8: Short SMA=190.29, Long SMA=227.00, Sharpe=-0.2151
[INFO] Centroid 9: Short SMA=95.04, Long SMA=139.46, Sharpe=-0.1825
[INFO] Centroid 10: Short SMA=130.94, Long SMA=218.19, Sharpe=-0.3241
[INFO] Centroid 11: Short SMA=143.82, Long SMA=185.76, Sharpe=-0.4485
[INFO] Centroid 12: Short SMA=43.06, Long SMA=91.33, Sharpe=-0.1663
[INFO] Centroid 13: Short SMA=62.17, Long SMA=186.12, Sharpe=-0.2108
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=142, Sharpe=0.3569, Trades=18
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=214, Long SMA=232, Sharpe=0.2575, Trades=16
[INFO] Kmeans Top 2: Short SMA=118, Long SMA=152, Sharpe=0.1290, Trades=14
[INFO] Kmeans Top 3: Short SMA=22, Long SMA=232, Sharpe=-0.0859, Trades=14
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=142, Sharpe=-0.1173, Trades=15
[INFO] Kmeans Top 5: Short SMA=60, Long SMA=188, Sharpe=-0.1270, Trades=10
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}
[INFO]   Rounded: (27, 57)
[INFO]   Nearest: (26.0, 56.0)
[INFO]   Rounded: (67, 232)
[INFO]   Nearest: (68.0, 232.0)
[INFO]   Rounded: (35, 143)
[INFO]   Nearest: (36.0, 142.0)
[INFO]   Rounded: (255, 281)
[INFO]   Nearest: (256.0, 282.0)
[INFO]   Rounded: (213, 231)
[INFO]   Nearest: (214.0, 232.0)
[INFO]   Rounded: (117, 152)
[INFO]   Nearest: (118.0, 152.0)
[INFO]   Rounded: (23, 235)
[INFO]   Nearest: (24.0, 234.0)
[INFO]   Rounded: (257, 277)
[INFO]   Nearest: (258.0, 278.0)
[INFO]   Rounded: (190, 227)
[INFO]   Nearest: (190.0, 226.0)
[INFO]   Rounded: (95, 139)
[INFO]   Nearest: (96.0, 140.0)
[INFO]   Rounded: (131, 218)
[INFO]   Nearest: (130.0, 218.0)
[INFO]   Rounded: (144, 186)
[INFO]   Rounded: (43, 91)
[INFO]   Nearest: (44.0, 92.0)
[INFO]   Rounded: (62, 186)
[INFO] Successfully plotted 14 out of 14 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 142
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(214/232) - Original Sharpe: 0.2575, Trades: 16
[INFO] Kmeans cluster 2: SMA(118/152) - Original Sharpe: 0.1290, Trades: 14
[INFO] Kmeans cluster 3: SMA(22/232) - Original Sharpe: -0.0859, Trades: 14
[INFO] Kmeans cluster 4: SMA(36/142) - Original Sharpe: -0.1173, Trades: 15
[INFO] Kmeans cluster 5: SMA(60/188) - Original Sharpe: -0.1270, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/142)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (214/232) - Sharpe: 0.2575
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.951309            1.984401
1    2021-11-14 2021-11-14            43    -3.779143           -2.480238
2    2022-01-14 2022-01-14            41    -1.606093            1.495295
3    2022-03-14 2022-03-14            44     2.272090            2.272090
4    2022-05-14 2022-05-14            43     1.217919            1.217919
5    2022-07-14 2022-07-14            44    -0.981609           -0.981609
6    2022-09-14 2022-09-14            43    -0.503510           -0.503510
7    2022-11-14 2022-11-14            43     2.546707            0.047994
8    2023-01-14 2023-01-14            41     2.799352            2.462331
9    2023-03-14 2023-03-14            44    -0.771622           -2.321245
10   2023-05-14 2023-05-14            44    -1.092872           -2.291416
11   2023-07-14 2023-07-14            44     2.002487           -3.740779
12   2023-09-14 2023-09-14            43    -2.691940            4.573870
13   2023-11-14 2023-11-14            42     1.074911           -0.561653
14   2024-01-14 2024-01-14            43    -1.539506            0.563821
15   2024-03-14 2024-03-14            42    -0.907679           -0.907679
16   2024-05-14 2024-05-14            44     1.119288            3.970205
17   2024-07-14 2024-07-14            45    -0.484134            0.435707
18   2024-09-14 2024-09-14            43     1.944401            2.219115
19   2024-11-14 2024-11-14            33    -2.760739           -2.760739
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |              2.0 |          3.0 | True          
[INFO] 2021-11-14   |         -3.8 |             -2.5 |          1.3 | True          
[INFO] 2022-01-14   |         -1.6 |              1.5 |          3.1 | True          
[INFO] 2022-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.5 |              0.0 |         -2.5 | False         
[INFO] 2023-01-14   |          2.8 |              2.5 |         -0.3 | False         
[INFO] 2023-03-14   |         -0.8 |             -2.3 |         -1.5 | False         
[INFO] 2023-05-14   |         -1.1 |             -2.3 |         -1.2 | False         
[INFO] 2023-07-14   |          2.0 |             -3.7 |         -5.7 | False         
[INFO] 2023-09-14   |         -2.7 |              4.6 |          7.3 | True          
[INFO] 2023-11-14   |          1.1 |             -0.6 |         -1.7 | False         
[INFO] 2024-01-14   |         -1.5 |              0.6 |          2.1 | True          
[INFO] 2024-03-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.1 |              4.0 |          2.9 | True          
[INFO] 2024-07-14   |         -0.5 |              0.4 |          0.9 | True          
[INFO] 2024-09-14   |          1.9 |              2.2 |          0.3 | True          
[INFO] 2024-11-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2024-03-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 8 of 14 periods (57.14% win rate)
[INFO] Updating Excel file with Kmeans results for RTY...
[INFO] Excel file updated successfully. Added RTY with Kmeans win rate 57.1% in row 41
[INFO] Added best Sharpe parameters 122/142 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 142
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(214/232) - Original Sharpe: 0.2575
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RTY_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.3164
[INFO] Kmeans Best out-of-sample Sharpe: -0.1847
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for RTY...
[INFO] Excel file updated successfully. Added RTY with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RTY
[INFO] Big Point Value: 50.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1942 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -1.0342 to 0.3569
[INFO] 
Best parameters:
[INFO] Short SMA: 122
[INFO] Long SMA: 142
[INFO] Sharpe Ratio: 0.356940
[INFO] Number of Trades: 18
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1942 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -1.0342 to 0.3569
[INFO] Trades range: 10.0 to 204.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3244 to 2.4597
[INFO] Scaled Long SMA range: -3.0045 to 1.8285
[INFO] Scaled Sharpe ratio range: -3.9322 to 2.6620
[INFO] Scaled Trades range: -0.6221 to 13.7581
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1942 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.7244
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 138 elements
[INFO] Cluster 1: 321 elements
[INFO] Cluster 2: 147 elements
[INFO] Cluster 3: 67 elements
[INFO] Cluster 4: 272 elements
[INFO] Cluster 5: 45 elements
[INFO] Cluster 6: 43 elements
[INFO] Cluster 7: 139 elements
[INFO] Cluster 8: 212 elements
[INFO] Cluster 9: 230 elements
[INFO] Cluster 10: 1 elements
[INFO] Cluster 11: 87 elements
[INFO] Cluster 12: 127 elements
[INFO] Cluster 13: 113 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=246, Long SMA=276, Sharpe=-0.6812, Trades=11
[INFO] Cluster 1 cluster: Short SMA=34, Long SMA=230, Sharpe=-0.1517, Trades=10
[INFO] Cluster 2 cluster: Short SMA=64, Long SMA=96, Sharpe=-0.3424, Trades=27
[INFO] Cluster 3 cluster: Short SMA=280, Long SMA=286, Sharpe=-0.6103, Trades=33
[INFO] Cluster 4 cluster: Short SMA=90, Long SMA=204, Sharpe=-0.1403, Trades=10
[INFO] Cluster 5 cluster: Short SMA=26, Long SMA=44, Sharpe=-0.2191, Trades=64
[INFO] Cluster 6 cluster: Short SMA=208, Long SMA=212, Sharpe=-0.2377, Trades=34
[INFO] Cluster 7 cluster: Short SMA=118, Long SMA=148, Sharpe=0.2796, Trades=14
[INFO] Cluster 8 cluster: Short SMA=142, Long SMA=214, Sharpe=-0.2783, Trades=10
[INFO] Cluster 9 cluster: Short SMA=68, Long SMA=142, Sharpe=0.0760, Trades=12
[INFO] Cluster 11 cluster: Short SMA=214, Long SMA=232, Sharpe=0.2575, Trades=16
[INFO] Cluster 12 cluster: Short SMA=188, Long SMA=228, Sharpe=-0.2470, Trades=10
[INFO] Cluster 13 cluster: Short SMA=20, Long SMA=140, Sharpe=-0.0965, Trades=25
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=122, Long SMA=142, Sharpe=0.3569, Trades=18
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=118, Long SMA=148, Sharpe=0.2796, Trades=14
[INFO] Top 2: Short SMA=214, Long SMA=232, Sharpe=0.2575, Trades=16
[INFO] Top 3: Short SMA=68, Long SMA=142, Sharpe=0.0760, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 1941 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 122, Long SMA: 142
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(118/148) - Original Sharpe: 0.2796, Trades: 14
[INFO] Hierarchical cluster 2: SMA(214/232) - Original Sharpe: 0.2575, Trades: 16
[INFO] Hierarchical cluster 3: SMA(68/142) - Original Sharpe: 0.0760, Trades: 12
[INFO] Hierarchical cluster 4: SMA(20/140) - Original Sharpe: -0.0965, Trades: 25
[INFO] Hierarchical cluster 5: SMA(90/204) - Original Sharpe: -0.1403, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (122/142)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (118/148) - Sharpe: 0.2796
[INFO] cluster 2: (214/232) - Sharpe: 0.2575
[INFO] Loading RTY data from local files...
[INFO] Found data file: A_OHLCV_@RTY_minutes_1440_1703-1557.dat
[INFO] File size: 290502 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -0.951309            1.947760
1    2021-11-14 2021-11-14            43    -3.779143           -2.892084
2    2022-01-14 2022-01-14            41    -1.606093            0.670813
3    2022-03-14 2022-03-14            44     2.272090            2.272090
4    2022-05-14 2022-05-14            43     1.217919            1.217919
5    2022-07-14 2022-07-14            44    -0.981609           -0.981609
6    2022-09-14 2022-09-14            43    -0.503510           -0.503510
7    2022-11-14 2022-11-14            43     2.546707            1.917129
8    2023-01-14 2023-01-14            41     2.799352            2.828442
9    2023-03-14 2023-03-14            44    -0.771622           -1.907497
10   2023-05-14 2023-05-14            44    -1.092872           -2.787420
11   2023-07-14 2023-07-14            44     2.002487           -1.810407
12   2023-09-14 2023-09-14            43    -2.691940            1.497119
13   2023-11-14 2023-11-14            42     1.074911            0.503980
14   2024-01-14 2024-01-14            43    -1.539506           -2.017009
15   2024-03-14 2024-03-14            42    -0.907679           -0.907679
16   2024-05-14 2024-05-14            44     1.119288            3.664145
17   2024-07-14 2024-07-14            45    -0.484134            0.435707
18   2024-09-14 2024-09-14            43     1.944401            2.157997
19   2024-11-14 2024-11-14            33    -2.760739           -2.760739
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.0 |              1.9 |          2.9 | True          
[INFO] 2021-11-14   |         -3.8 |             -2.9 |          0.9 | True          
[INFO] 2022-01-14   |         -1.6 |              0.7 |          2.3 | True          
[INFO] 2022-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |         -1.0 |             -1.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |         -0.5 |             -0.5 |          0.0 | Excluded      
[INFO] 2022-11-14   |          2.5 |              1.9 |         -0.6 | False         
[INFO] 2023-01-14   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -0.8 |             -1.9 |         -1.1 | False         
[INFO] 2023-05-14   |         -1.1 |             -2.8 |         -1.7 | False         
[INFO] 2023-07-14   |          2.0 |             -1.8 |         -3.8 | False         
[INFO] 2023-09-14   |         -2.7 |              1.5 |          4.2 | True          
[INFO] 2023-11-14   |          1.1 |              0.5 |         -0.6 | False         
[INFO] 2024-01-14   |         -1.5 |             -2.0 |         -0.5 | False         
[INFO] 2024-03-14   |         -0.9 |             -0.9 |          0.0 | Excluded      
[INFO] 2024-05-14   |          1.1 |              3.7 |          2.6 | True          
[INFO] 2024-07-14   |         -0.5 |              0.4 |          0.9 | True          
[INFO] 2024-09-14   |          1.9 |              2.2 |          0.3 | True          
[INFO] 2024-11-14   |         -2.8 |             -2.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-01-14, 2024-03-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 7 of 13 periods (53.85% win rate)
[INFO] Updating Excel file with Hierarchical results for RTY...
[INFO] Excel file updated successfully. Added RTY with Hierarchical win rate 53.8% in row 41
[INFO] Added best Sharpe parameters 122/142 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 122, Long SMA: 142
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(118/148) - Original Sharpe: 0.2796
[INFO] Added cluster 2 to portfolio: SMA(214/232) - Original Sharpe: 0.2575
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'RTY_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2332
[INFO] Hierarchical Best out-of-sample Sharpe: -0.1847
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for RTY...
[INFO] Excel file updated successfully. Added RTY with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\RTY
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for S in column D: 15.0
[INFO] Using slippage from Excel column D: 15.0
[INFO] 
Symbol: @SB
[INFO] Description: Sugar No. 11 Continuous Contract [May25]
[INFO] Exchange: ICEUS
[INFO] Interval: minutes 1440
[INFO] Tick size: 11.200000000000001
[INFO] Big point value: 1120.0
[INFO] Data shape: (6057, 6)
[INFO] Date range: 2001-02-12 12:56:00 to 2025-04-07 12:56:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2001-02-12 12:56:00  12.74  12.86  12.62  12.75     0.0
1 2001-02-13 12:56:00  12.82  12.90  12.69  12.71     0.0
2 2001-02-14 12:56:00  12.69  12.76  12.62  12.75     0.0
3 2001-02-15 12:56:00  12.55  12.83  12.49  12.76     0.0
4 2001-02-16 12:56:00  12.64  12.70  12.53  12.63     0.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 26.01 seconds (0.43 minutes)
[INFO] Best parameters found: Short SMA = 180, Long SMA = 184
[INFO] Best fitness (Sharpe ratio): 0.926274
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 180, Long SMA = 184, Sharpe = 0.926274
[INFO] Top 2: Short SMA = 182, Long SMA = 184, Sharpe = 0.895176
[INFO] Top 3: Short SMA = 180, Long SMA = 182, Sharpe = 0.843308
[INFO] Top 4: Short SMA = 182, Long SMA = 186, Sharpe = 0.785092
[INFO] Top 5: Short SMA = 172, Long SMA = 176, Sharpe = 0.778673
[INFO] Hall of Fame size: 2566
[INFO] Number of elements in all_results: 1081
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 1485 had penalty fitness
[INFO] Total filtered from Hall of Fame: 1485
[INFO] Hall of Fame -> all_results: 2566 -> 1081
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1081 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SB
[INFO] Big Point Value (from data): 1120.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 14.27 contracts
[INFO] Maximum Position Size: 30 contracts
[INFO] Strategy Total P&L: $81,905.60
[INFO] Market Buy & Hold P&L: $-3,248.00
[INFO] Outperformance: $85,153.60
[INFO] Sharpe ratio (entire period, annualized): 0.033321
[INFO] Sharpe ratio (in-sample, annualized): 0.170618
[INFO] Sharpe ratio (out-of-sample, annualized): -0.293014
[INFO] Maximum Drawdown: $322,985.60
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $87,315.20
[INFO] Out-of-sample P&L: $-63,089.60
[INFO] 
Best parameters from GA: Short SMA = 180, Long SMA = 184, Sharpe = 0.926274
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2566
[INFO] Cache hits (repeated combinations): 6087
[INFO] Total checks: 8653
[INFO] Cache hit rate: 70.35%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1081 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.3066 to 0.9263
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.926274
[INFO] Number of Trades: 37
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1081 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.3066 to 0.9263
[INFO] Trades range: 10.0 to 155.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1532 to 2.4231
[INFO] Scaled Long SMA range: -2.3691 to 2.1627
[INFO] Scaled Sharpe ratio range: -3.4824 to 3.2425
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 44 elements
[INFO] Kmeans Cluster 1: 48 elements
[INFO] Kmeans Cluster 2: 69 elements
[INFO] Kmeans Cluster 3: 93 elements
[INFO] Kmeans Cluster 4: 59 elements
[INFO] Kmeans Cluster 5: 26 elements
[INFO] Kmeans Cluster 6: 87 elements
[INFO] Kmeans Cluster 7: 123 elements
[INFO] Kmeans Cluster 8: 101 elements
[INFO] Kmeans Cluster 9: 58 elements
[INFO] Kmeans Cluster 10: 67 elements
[INFO] Kmeans Cluster 11: 51 elements
[INFO] Kmeans Cluster 12: 90 elements
[INFO] Kmeans Cluster 13: 42 elements
[INFO] Kmeans Cluster 14: 71 elements
[INFO] Kmeans Cluster 15: 36 elements
[INFO] Kmeans Cluster 16: 16 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=25.86, Long SMA=257.77, Sharpe=0.3270
[INFO] Centroid 1: Short SMA=31.50, Long SMA=66.96, Sharpe=0.3263
[INFO] Centroid 2: Short SMA=278.72, Long SMA=286.99, Sharpe=0.2569
[INFO] Centroid 3: Short SMA=125.20, Long SMA=165.61, Sharpe=0.2126
[INFO] Centroid 4: Short SMA=168.71, Long SMA=189.36, Sharpe=0.4785
[INFO] Centroid 5: Short SMA=36.92, Long SMA=57.00, Sharpe=0.1046
[INFO] Centroid 6: Short SMA=23.95, Long SMA=201.17, Sharpe=0.3667
[INFO] Centroid 7: Short SMA=44.86, Long SMA=106.86, Sharpe=0.4580
[INFO] Centroid 8: Short SMA=69.94, Long SMA=139.28, Sharpe=0.3275
[INFO] Centroid 9: Short SMA=208.10, Long SMA=222.17, Sharpe=0.3305
[INFO] Centroid 10: Short SMA=39.46, Long SMA=179.64, Sharpe=0.5463
[INFO] Centroid 11: Short SMA=127.33, Long SMA=147.29, Sharpe=0.0213
[INFO] Centroid 12: Short SMA=170.42, Long SMA=188.78, Sharpe=0.6580
[INFO] Centroid 13: Short SMA=234.76, Long SMA=243.38, Sharpe=0.0680
[INFO] Centroid 14: Short SMA=67.58, Long SMA=109.21, Sharpe=0.1929
[INFO] Centroid 15: Short SMA=17.30, Long SMA=157.68, Sharpe=0.2383
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9263, Trades=37
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=170, Long SMA=190, Sharpe=0.6084, Trades=13
[INFO] Kmeans Top 2: Short SMA=42, Long SMA=106, Sharpe=0.5292, Trades=15
[INFO] Kmeans Top 3: Short SMA=168, Long SMA=186, Sharpe=0.5126, Trades=13
[INFO] Kmeans Top 4: Short SMA=28, Long SMA=62, Sharpe=0.4604, Trades=29
[INFO] Kmeans Top 5: Short SMA=36, Long SMA=164, Sharpe=0.4452, Trades=11
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (26, 258)
[INFO]   Rounded: (32, 67)
[INFO]   Nearest: (32.0, 66.0)
[INFO]   Rounded: (279, 287)
[INFO]   Nearest: (278.0, 286.0)
[INFO]   Rounded: (125, 166)
[INFO]   Nearest: (126.0, 166.0)
[INFO]   Rounded: (169, 189)
[INFO]   Nearest: (168.0, 190.0)
[INFO]   Rounded: (37, 57)
[INFO]   Nearest: (36.0, 56.0)
[INFO]   Rounded: (24, 201)
[INFO]   Nearest: (24.0, 202.0)
[INFO]   Rounded: (45, 107)
[INFO]   Nearest: (44.0, 106.0)
[INFO]   Rounded: (70, 139)
[INFO]   Nearest: (70.0, 140.0)
[INFO]   Rounded: (208, 222)
[INFO]   Rounded: (39, 180)
[INFO]   Nearest: (40.0, 180.0)
[INFO]   Rounded: (127, 147)
[INFO]   Nearest: (128.0, 148.0)
[INFO]   Rounded: (170, 189)
[INFO]   Nearest: (170.0, 188.0)
[INFO]   Rounded: (235, 243)
[INFO]   Nearest: (234.0, 244.0)
[INFO]   Rounded: (68, 109)
[INFO]   Nearest: (68.0, 110.0)
[INFO]   Rounded: (17, 158)
[INFO]   Nearest: (18.0, 158.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(170/190) - Original Sharpe: 0.6084, Trades: 13
[INFO] Kmeans cluster 2: SMA(42/106) - Original Sharpe: 0.5292, Trades: 15
[INFO] Kmeans cluster 3: SMA(168/186) - Original Sharpe: 0.5126, Trades: 13
[INFO] Kmeans cluster 4: SMA(28/62) - Original Sharpe: 0.4604, Trades: 29
[INFO] Kmeans cluster 5: SMA(36/164) - Original Sharpe: 0.4452, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (170/190) - Sharpe: 0.6084
[INFO] cluster 2: (42/106) - Sharpe: 0.5292
[INFO] cluster 3: (168/186) - Sharpe: 0.5126
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.319624
2    2022-01-10 2022-01-10            41     2.600539            2.600539
3    2022-03-10 2022-03-10            42     0.191454            3.257306
4    2022-05-10 2022-05-10            41    -0.735414           -0.735414
5    2022-07-10 2022-07-10            44     4.954980            1.971573
6    2022-09-10 2022-09-10            43     2.825703            4.674814
7    2022-11-10 2022-11-10            40     1.572256            1.255421
8    2023-01-10 2023-01-10            41     3.123023            0.884594
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            1.520423
12   2023-09-10 2023-09-10            44     1.003709            0.881626
13   2023-11-10 2023-11-10            40    -4.602392           -5.577870
14   2024-01-10 2024-01-10            41     1.471174            0.614676
15   2024-03-10 2024-03-10            43    -0.286079            1.583435
16   2024-05-10 2024-05-10            40    -2.453105           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.736674
18   2024-09-10 2024-09-10            44     3.195301           -4.782382
19   2024-11-10 2024-11-10            35     3.533315            3.533315
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.3 |          0.2 | True          
[INFO] 2022-01-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2022-03-10   |          0.2 |              3.3 |          3.1 | True          
[INFO] 2022-05-10   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2022-07-10   |          5.0 |              2.0 |         -3.0 | False         
[INFO] 2022-09-10   |          2.8 |              4.7 |          1.9 | True          
[INFO] 2022-11-10   |          1.6 |              1.3 |         -0.3 | False         
[INFO] 2023-01-10   |          3.1 |              0.9 |         -2.2 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              1.5 |         -1.5 | False         
[INFO] 2023-09-10   |          1.0 |              0.9 |         -0.1 | False         
[INFO] 2023-11-10   |         -4.6 |             -5.6 |         -1.0 | False         
[INFO] 2024-01-10   |          1.5 |              0.6 |         -0.9 | False         
[INFO] 2024-03-10   |         -0.3 |              1.6 |          1.9 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -4.8 |         -8.0 | False         
[INFO] 2024-11-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2022-01-10, 2022-05-10, 2023-03-10, 2023-05-10, 2024-07-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 5 of 13 periods (38.46% win rate)
[INFO] Updating Excel file with Kmeans results for S...
[INFO] Excel file updated successfully. Added S with Kmeans win rate 38.5% in row 42
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(170/190) - Original Sharpe: 0.6084
[INFO] Added cluster 2 to portfolio: SMA(42/106) - Original Sharpe: 0.5292
[INFO] Added cluster 3 to portfolio: SMA(168/186) - Original Sharpe: 0.5126
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'S_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2882
[INFO] Kmeans Best out-of-sample Sharpe: 0.9709
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for S...
[INFO] Excel file updated successfully. Added S with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\S
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1081 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.3066 to 0.9263
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.926274
[INFO] Number of Trades: 37
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1081 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.3066 to 0.9263
[INFO] Trades range: 10.0 to 155.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1532 to 2.4231
[INFO] Scaled Long SMA range: -2.3691 to 2.1627
[INFO] Scaled Sharpe ratio range: -3.4824 to 3.2425
[INFO] Scaled Trades range: -0.7791 to 10.8165
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1081 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6020
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 157 elements
[INFO] Cluster 1: 63 elements
[INFO] Cluster 2: 217 elements
[INFO] Cluster 3: 57 elements
[INFO] Cluster 4: 100 elements
[INFO] Cluster 5: 115 elements
[INFO] Cluster 6: 35 elements
[INFO] Cluster 7: 31 elements
[INFO] Cluster 8: 24 elements
[INFO] Cluster 9: 56 elements
[INFO] Cluster 10: 1 elements
[INFO] Cluster 11: 35 elements
[INFO] Cluster 12: 66 elements
[INFO] Cluster 13: 45 elements
[INFO] Cluster 14: 79 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=24, Long SMA=206, Sharpe=0.3717, Trades=15
[INFO] Cluster 1 cluster: Short SMA=202, Long SMA=218, Sharpe=0.2619, Trades=13
[INFO] Cluster 2 cluster: Short SMA=44, Long SMA=114, Sharpe=0.3472, Trades=15
[INFO] Cluster 3 cluster: Short SMA=240, Long SMA=244, Sharpe=0.0503, Trades=21
[INFO] Cluster 4 cluster: Short SMA=166, Long SMA=190, Sharpe=0.6539, Trades=13
[INFO] Cluster 5 cluster: Short SMA=124, Long SMA=164, Sharpe=0.2048, Trades=11
[INFO] Cluster 6 cluster: Short SMA=32, Long SMA=54, Sharpe=0.3924, Trades=43
[INFO] Cluster 7 cluster: Short SMA=134, Long SMA=140, Sharpe=0.1041, Trades=38
[INFO] Cluster 8 cluster: Short SMA=20, Long SMA=36, Sharpe=-0.0201, Trades=65
[INFO] Cluster 9 cluster: Short SMA=54, Long SMA=168, Sharpe=0.7366, Trades=10
[INFO] Cluster 11 cluster: Short SMA=178, Long SMA=184, Sharpe=0.7386, Trades=27
[INFO] Cluster 12 cluster: Short SMA=280, Long SMA=288, Sharpe=0.2517, Trades=13
[INFO] Cluster 13 cluster: Short SMA=50, Long SMA=68, Sharpe=0.2344, Trades=35
[INFO] Cluster 14 cluster: Short SMA=78, Long SMA=122, Sharpe=0.1562, Trades=16
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9263, Trades=37
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=178, Long SMA=184, Sharpe=0.7386, Trades=27
[INFO] Top 2: Short SMA=54, Long SMA=168, Sharpe=0.7366, Trades=10
[INFO] Top 3: Short SMA=166, Long SMA=190, Sharpe=0.6539, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 1080 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(178/184) - Original Sharpe: 0.7386, Trades: 27
[INFO] Hierarchical cluster 2: SMA(54/168) - Original Sharpe: 0.7366, Trades: 10
[INFO] Hierarchical cluster 3: SMA(166/190) - Original Sharpe: 0.6539, Trades: 13
[INFO] Hierarchical cluster 4: SMA(32/54) - Original Sharpe: 0.3924, Trades: 43
[INFO] Hierarchical cluster 5: SMA(24/206) - Original Sharpe: 0.3717, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (178/184) - Sharpe: 0.7386
[INFO] cluster 2: (54/168) - Sharpe: 0.7366
[INFO] cluster 3: (166/190) - Sharpe: 0.6539
[INFO] Loading S data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.457400
2    2022-01-10 2022-01-10            41     2.600539            3.102635
3    2022-03-10 2022-03-10            42     0.191454            1.870510
4    2022-05-10 2022-05-10            41    -0.735414           -0.753654
5    2022-07-10 2022-07-10            44     4.954980            0.654084
6    2022-09-10 2022-09-10            43     2.825703            2.825703
7    2022-11-10 2022-11-10            40     1.572256            0.725255
8    2023-01-10 2023-01-10            41     3.123023            2.142062
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.978898
12   2023-09-10 2023-09-10            44     1.003709            1.003709
13   2023-11-10 2023-11-10            40    -4.602392           -4.908594
14   2024-01-10 2024-01-10            41     1.471174           -0.352220
15   2024-03-10 2024-03-10            43    -0.286079            0.328211
16   2024-05-10 2024-05-10            40    -2.453105           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.736674
18   2024-09-10 2024-09-10            44     3.195301           -1.383407
19   2024-11-10 2024-11-10            35     3.533315            3.533315
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |              3.1 |          0.5 | True          
[INFO] 2022-03-10   |          0.2 |              1.9 |          1.7 | True          
[INFO] 2022-05-10   |         -0.7 |             -0.8 |         -0.1 | False         
[INFO] 2022-07-10   |          5.0 |              0.7 |         -4.3 | False         
[INFO] 2022-09-10   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-10   |          1.6 |              0.7 |         -0.9 | False         
[INFO] 2023-01-10   |          3.1 |              2.1 |         -1.0 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-10   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -4.6 |             -4.9 |         -0.3 | False         
[INFO] 2024-01-10   |          1.5 |             -0.4 |         -1.9 | False         
[INFO] 2024-03-10   |         -0.3 |              0.3 |          0.6 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -1.4 |         -4.6 | False         
[INFO] 2024-11-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-09-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2024-07-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 11
[INFO] Hierarchical cluster wins (rounded comparison): 4 of 11 periods (36.36% win rate)
[INFO] Updating Excel file with Hierarchical results for S...
[INFO] Excel file updated successfully. Added S with Hierarchical win rate 36.4% in row 42
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(178/184) - Original Sharpe: 0.7386
[INFO] Added cluster 2 to portfolio: SMA(54/168) - Original Sharpe: 0.7366
[INFO] Added cluster 3 to portfolio: SMA(166/190) - Original Sharpe: 0.6539
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'S_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2835
[INFO] Hierarchical Best out-of-sample Sharpe: 0.9709
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for S...
[INFO] Excel file updated successfully. Added S with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\S
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SB in column D: 14.0
[INFO] Using slippage from Excel column D: 14.0
[INFO] 
Symbol: @SB
[INFO] Description: Sugar No. 11 Continuous Contract [May25]
[INFO] Exchange: ICEUS
[INFO] Interval: minutes 1440
[INFO] Tick size: 11.200000000000001
[INFO] Big point value: 1120.0
[INFO] Data shape: (6057, 6)
[INFO] Date range: 2001-02-12 12:56:00 to 2025-04-07 12:56:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2001-02-12 12:56:00  12.74  12.86  12.62  12.75     0.0
1 2001-02-13 12:56:00  12.82  12.90  12.69  12.71     0.0
2 2001-02-14 12:56:00  12.69  12.76  12.62  12.75     0.0
3 2001-02-15 12:56:00  12.55  12.83  12.49  12.76     0.0
4 2001-02-16 12:56:00  12.64  12.70  12.53  12.63     0.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 33.63 seconds (0.56 minutes)
[INFO] Best parameters found: Short SMA = 180, Long SMA = 184
[INFO] Best fitness (Sharpe ratio): 0.927384
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 180, Long SMA = 184, Sharpe = 0.927384
[INFO] Top 2: Short SMA = 182, Long SMA = 184, Sharpe = 0.896678
[INFO] Top 3: Short SMA = 180, Long SMA = 182, Sharpe = 0.844740
[INFO] Top 4: Short SMA = 182, Long SMA = 186, Sharpe = 0.786236
[INFO] Top 5: Short SMA = 172, Long SMA = 176, Sharpe = 0.779657
[INFO] Hall of Fame size: 2596
[INFO] Number of elements in all_results: 1089
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 1507 had penalty fitness
[INFO] Total filtered from Hall of Fame: 1507
[INFO] Hall of Fame -> all_results: 2596 -> 1089
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1089 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SB
[INFO] Big Point Value (from data): 1120.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 14.27 contracts
[INFO] Maximum Position Size: 30 contracts
[INFO] Strategy Total P&L: $81,905.60
[INFO] Market Buy & Hold P&L: $-3,248.00
[INFO] Outperformance: $85,153.60
[INFO] Sharpe ratio (entire period, annualized): 0.033321
[INFO] Sharpe ratio (in-sample, annualized): 0.170618
[INFO] Sharpe ratio (out-of-sample, annualized): -0.293014
[INFO] Maximum Drawdown: $322,985.60
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $87,315.20
[INFO] Out-of-sample P&L: $-63,089.60
[INFO] 
Best parameters from GA: Short SMA = 180, Long SMA = 184, Sharpe = 0.927384
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2596
[INFO] Cache hits (repeated combinations): 6059
[INFO] Total checks: 8655
[INFO] Cache hit rate: 70.01%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1089 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.3047 to 0.9274
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.927384
[INFO] Number of Trades: 37
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1089 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.3047 to 0.9274
[INFO] Trades range: 10.0 to 155.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1570 to 2.4314
[INFO] Scaled Long SMA range: -2.3668 to 2.1769
[INFO] Scaled Sharpe ratio range: -3.4389 to 3.1912
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 101 elements
[INFO] Kmeans Cluster 1: 111 elements
[INFO] Kmeans Cluster 2: 72 elements
[INFO] Kmeans Cluster 3: 47 elements
[INFO] Kmeans Cluster 4: 46 elements
[INFO] Kmeans Cluster 5: 89 elements
[INFO] Kmeans Cluster 6: 115 elements
[INFO] Kmeans Cluster 7: 41 elements
[INFO] Kmeans Cluster 8: 52 elements
[INFO] Kmeans Cluster 9: 54 elements
[INFO] Kmeans Cluster 10: 98 elements
[INFO] Kmeans Cluster 11: 17 elements
[INFO] Kmeans Cluster 12: 57 elements
[INFO] Kmeans Cluster 13: 45 elements
[INFO] Kmeans Cluster 14: 75 elements
[INFO] Kmeans Cluster 15: 69 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=170.46, Long SMA=188.14, Sharpe=0.6543
[INFO] Centroid 1: Short SMA=64.04, Long SMA=138.83, Sharpe=0.3243
[INFO] Centroid 2: Short SMA=278.31, Long SMA=286.44, Sharpe=0.2519
[INFO] Centroid 3: Short SMA=40.09, Long SMA=66.26, Sharpe=0.1537
[INFO] Centroid 4: Short SMA=27.30, Long SMA=256.30, Sharpe=0.3477
[INFO] Centroid 5: Short SMA=126.72, Long SMA=166.07, Sharpe=0.1999
[INFO] Centroid 6: Short SMA=47.48, Long SMA=107.55, Sharpe=0.4615
[INFO] Centroid 7: Short SMA=230.49, Long SMA=239.37, Sharpe=0.0713
[INFO] Centroid 8: Short SMA=208.92, Long SMA=223.54, Sharpe=0.3413
[INFO] Centroid 9: Short SMA=29.37, Long SMA=75.19, Sharpe=0.3460
[INFO] Centroid 10: Short SMA=21.43, Long SMA=194.47, Sharpe=0.3323
[INFO] Centroid 12: Short SMA=169.75, Long SMA=188.49, Sharpe=0.4715
[INFO] Centroid 13: Short SMA=127.24, Long SMA=147.56, Sharpe=0.0070
[INFO] Centroid 14: Short SMA=39.60, Long SMA=181.47, Sharpe=0.5403
[INFO] Centroid 15: Short SMA=73.42, Long SMA=120.23, Sharpe=0.1795
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9274, Trades=37
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=170, Long SMA=190, Sharpe=0.6088, Trades=13
[INFO] Kmeans Top 2: Short SMA=168, Long SMA=186, Sharpe=0.5130, Trades=13
[INFO] Kmeans Top 3: Short SMA=44, Long SMA=108, Sharpe=0.5017, Trades=15
[INFO] Kmeans Top 4: Short SMA=34, Long SMA=190, Sharpe=0.4731, Trades=11
[INFO] Kmeans Top 5: Short SMA=28, Long SMA=76, Sharpe=0.4111, Trades=23
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 13, 14, 15}
[INFO]   Rounded: (170, 188)
[INFO]   Rounded: (64, 139)
[INFO]   Nearest: (64.0, 138.0)
[INFO]   Rounded: (278, 286)
[INFO]   Rounded: (40, 66)
[INFO]   Rounded: (27, 256)
[INFO]   Nearest: (28.0, 256.0)
[INFO]   Rounded: (127, 166)
[INFO]   Nearest: (126.0, 166.0)
[INFO]   Rounded: (47, 108)
[INFO]   Nearest: (48.0, 108.0)
[INFO]   Rounded: (230, 239)
[INFO]   Nearest: (230.0, 240.0)
[INFO]   Rounded: (209, 224)
[INFO]   Nearest: (208.0, 224.0)
[INFO]   Rounded: (29, 75)
[INFO]   Nearest: (30.0, 76.0)
[INFO]   Rounded: (21, 194)
[INFO]   Nearest: (22.0, 194.0)
[INFO]   Rounded: (170, 188)
[INFO]   Rounded: (127, 148)
[INFO]   Nearest: (128.0, 148.0)
[INFO]   Rounded: (40, 181)
[INFO]   Nearest: (40.0, 182.0)
[INFO]   Rounded: (73, 120)
[INFO]   Nearest: (74.0, 120.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(170/190) - Original Sharpe: 0.6088, Trades: 13
[INFO] Kmeans cluster 2: SMA(168/186) - Original Sharpe: 0.5130, Trades: 13
[INFO] Kmeans cluster 3: SMA(44/108) - Original Sharpe: 0.5017, Trades: 15
[INFO] Kmeans cluster 4: SMA(34/190) - Original Sharpe: 0.4731, Trades: 11
[INFO] Kmeans cluster 5: SMA(28/76) - Original Sharpe: 0.4111, Trades: 23
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (170/190) - Sharpe: 0.6088
[INFO] cluster 2: (168/186) - Sharpe: 0.5130
[INFO] cluster 3: (44/108) - Sharpe: 0.5017
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -1.429527
2    2022-01-10 2022-01-10            41     2.600539            2.600539
3    2022-03-10 2022-03-10            42     0.192786            3.238756
4    2022-05-10 2022-05-10            41    -0.735414           -0.735414
5    2022-07-10 2022-07-10            44     4.961128            1.752907
6    2022-09-10 2022-09-10            43     2.825703            4.243935
7    2022-11-10 2022-11-10            40     1.576583            1.256985
8    2023-01-10 2023-01-10            41     3.128890            0.886660
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            1.117653
12   2023-09-10 2023-09-10            44     1.003709            0.881887
13   2023-11-10 2023-11-10            40    -4.602392           -5.577722
14   2024-01-10 2024-01-10            41     1.473702            0.615742
15   2024-03-10 2024-03-10            43    -0.280949            1.588251
16   2024-05-10 2024-05-10            40    -2.452361           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.736674
18   2024-09-10 2024-09-10            44     3.198404           -4.597435
19   2024-11-10 2024-11-10            35     3.533315            3.533315
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -1.4 |          1.1 | True          
[INFO] 2022-01-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2022-03-10   |          0.2 |              3.2 |          3.0 | True          
[INFO] 2022-05-10   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2022-07-10   |          5.0 |              1.8 |         -3.2 | False         
[INFO] 2022-09-10   |          2.8 |              4.2 |          1.4 | True          
[INFO] 2022-11-10   |          1.6 |              1.3 |         -0.3 | False         
[INFO] 2023-01-10   |          3.1 |              0.9 |         -2.2 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              1.1 |         -1.9 | False         
[INFO] 2023-09-10   |          1.0 |              0.9 |         -0.1 | False         
[INFO] 2023-11-10   |         -4.6 |             -5.6 |         -1.0 | False         
[INFO] 2024-01-10   |          1.5 |              0.6 |         -0.9 | False         
[INFO] 2024-03-10   |         -0.3 |              1.6 |          1.9 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -4.6 |         -7.8 | False         
[INFO] 2024-11-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2022-01-10, 2022-05-10, 2023-03-10, 2023-05-10, 2024-07-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 5 of 13 periods (38.46% win rate)
[INFO] Updating Excel file with Kmeans results for SB...
[INFO] Excel file updated successfully. Added SB with Kmeans win rate 38.5% in row 43
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(170/190) - Original Sharpe: 0.6088
[INFO] Added cluster 2 to portfolio: SMA(168/186) - Original Sharpe: 0.5130
[INFO] Added cluster 3 to portfolio: SMA(44/108) - Original Sharpe: 0.5017
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SB_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2592
[INFO] Kmeans Best out-of-sample Sharpe: 0.9724
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for SB...
[INFO] Excel file updated successfully. Added SB with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SB
[INFO] Big Point Value: 1120.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1089 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.3047 to 0.9274
[INFO] 
Best parameters:
[INFO] Short SMA: 180
[INFO] Long SMA: 184
[INFO] Sharpe Ratio: 0.927384
[INFO] Number of Trades: 37
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1089 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.3047 to 0.9274
[INFO] Trades range: 10.0 to 155.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1570 to 2.4314
[INFO] Scaled Long SMA range: -2.3668 to 2.1769
[INFO] Scaled Sharpe ratio range: -3.4389 to 3.1912
[INFO] Scaled Trades range: -0.7858 to 10.6867
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1089 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5970
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 56 elements
[INFO] Cluster 1: 31 elements
[INFO] Cluster 2: 239 elements
[INFO] Cluster 3: 71 elements
[INFO] Cluster 4: 24 elements
[INFO] Cluster 5: 44 elements
[INFO] Cluster 6: 138 elements
[INFO] Cluster 7: 68 elements
[INFO] Cluster 8: 59 elements
[INFO] Cluster 9: 131 elements
[INFO] Cluster 10: 43 elements
[INFO] Cluster 11: 98 elements
[INFO] Cluster 12: 1 elements
[INFO] Cluster 13: 66 elements
[INFO] Cluster 14: 20 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=244, Long SMA=250, Sharpe=0.0910, Trades=19
[INFO] Cluster 1 cluster: Short SMA=24, Long SMA=36, Sharpe=-0.0268, Trades=67
[INFO] Cluster 2 cluster: Short SMA=46, Long SMA=118, Sharpe=0.4634, Trades=15
[INFO] Cluster 3 cluster: Short SMA=42, Long SMA=64, Sharpe=0.0827, Trades=35
[INFO] Cluster 4 cluster: Short SMA=162, Long SMA=166, Sharpe=0.3079, Trades=37
[INFO] Cluster 5 cluster: Short SMA=178, Long SMA=184, Sharpe=0.7393, Trades=27
[INFO] Cluster 6 cluster: Short SMA=24, Long SMA=208, Sharpe=0.4290, Trades=15
[INFO] Cluster 7 cluster: Short SMA=58, Long SMA=118, Sharpe=0.1161, Trades=18
[INFO] Cluster 8 cluster: Short SMA=52, Long SMA=166, Sharpe=0.6121, Trades=10
[INFO] Cluster 9 cluster: Short SMA=122, Long SMA=166, Sharpe=0.2441, Trades=11
[INFO] Cluster 10 cluster: Short SMA=210, Long SMA=224, Sharpe=0.3054, Trades=13
[INFO] Cluster 11 cluster: Short SMA=166, Long SMA=190, Sharpe=0.6542, Trades=13
[INFO] Cluster 13 cluster: Short SMA=280, Long SMA=288, Sharpe=0.2520, Trades=13
[INFO] Cluster 14 cluster: Short SMA=136, Long SMA=142, Sharpe=-0.0346, Trades=30
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=180, Long SMA=184, Sharpe=0.9274, Trades=37
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=178, Long SMA=184, Sharpe=0.7393, Trades=27
[INFO] Top 2: Short SMA=166, Long SMA=190, Sharpe=0.6542, Trades=13
[INFO] Top 3: Short SMA=52, Long SMA=166, Sharpe=0.6121, Trades=10
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 1088 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 180, Long SMA: 184
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(178/184) - Original Sharpe: 0.7393, Trades: 27
[INFO] Hierarchical cluster 2: SMA(166/190) - Original Sharpe: 0.6542, Trades: 13
[INFO] Hierarchical cluster 3: SMA(52/166) - Original Sharpe: 0.6121, Trades: 10
[INFO] Hierarchical cluster 4: SMA(46/118) - Original Sharpe: 0.4634, Trades: 15
[INFO] Hierarchical cluster 5: SMA(24/208) - Original Sharpe: 0.4290, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (180/184)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (178/184) - Sharpe: 0.7393
[INFO] cluster 2: (166/190) - Sharpe: 0.6542
[INFO] cluster 3: (52/166) - Sharpe: 0.6121
[INFO] Loading SB data from local files...
[INFO] Found data file: A_OHLCV_@SB_minutes_1440_0333-1256.dat
[INFO] File size: 290877 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.102803           -0.102803
1    2021-11-10 2021-11-10            41    -2.457400           -2.457400
2    2022-01-10 2022-01-10            41     2.600539            2.568277
3    2022-03-10 2022-03-10            42     0.192786            0.609144
4    2022-05-10 2022-05-10            41    -0.735414           -0.752442
5    2022-07-10 2022-07-10            44     4.961128            0.658055
6    2022-09-10 2022-09-10            43     2.825703            2.825703
7    2022-11-10 2022-11-10            40     1.576583            0.174643
8    2023-01-10 2023-01-10            41     3.128890            2.144242
9    2023-03-10 2023-03-10            42     5.693583            5.693583
10   2023-05-10 2023-05-10            40    -2.170280           -2.170280
11   2023-07-10 2023-07-10            44     2.978898            2.978898
12   2023-09-10 2023-09-10            44     1.003709            1.003709
13   2023-11-10 2023-11-10            40    -4.602392           -4.912356
14   2024-01-10 2024-01-10            41     1.473702           -0.350489
15   2024-03-10 2024-03-10            43    -0.280949            0.332958
16   2024-05-10 2024-05-10            40    -2.452361           -0.154510
17   2024-07-10 2024-07-10            43     0.736674            0.736674
18   2024-09-10 2024-09-10            44     3.198404           -1.249069
19   2024-11-10 2024-11-10            35     3.533315            3.533315
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.1 |             -0.1 |          0.0 | Excluded      
[INFO] 2021-11-10   |         -2.5 |             -2.5 |          0.0 | Excluded      
[INFO] 2022-01-10   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2022-03-10   |          0.2 |              0.6 |          0.4 | True          
[INFO] 2022-05-10   |         -0.7 |             -0.8 |         -0.1 | False         
[INFO] 2022-07-10   |          5.0 |              0.7 |         -4.3 | False         
[INFO] 2022-09-10   |          2.8 |              2.8 |          0.0 | Excluded      
[INFO] 2022-11-10   |          1.6 |              0.2 |         -1.4 | False         
[INFO] 2023-01-10   |          3.1 |              2.1 |         -1.0 | False         
[INFO] 2023-03-10   |          5.7 |              5.7 |          0.0 | Excluded      
[INFO] 2023-05-10   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2023-07-10   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-10   |          1.0 |              1.0 |          0.0 | Excluded      
[INFO] 2023-11-10   |         -4.6 |             -4.9 |         -0.3 | False         
[INFO] 2024-01-10   |          1.5 |             -0.4 |         -1.9 | False         
[INFO] 2024-03-10   |         -0.3 |              0.3 |          0.6 | True          
[INFO] 2024-05-10   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-07-10   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2024-09-10   |          3.2 |             -1.2 |         -4.4 | False         
[INFO] 2024-11-10   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2021-11-10, 2022-01-10, 2022-09-10, 2023-03-10, 2023-05-10, 2023-07-10, 2023-09-10, 2024-07-10, 2024-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 10
[INFO] Hierarchical cluster wins (rounded comparison): 3 of 10 periods (30.00% win rate)
[INFO] Updating Excel file with Hierarchical results for SB...
[INFO] Excel file updated successfully. Added SB with Hierarchical win rate 30.0% in row 43
[INFO] Added best Sharpe parameters 180/184 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 180, Long SMA: 184
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(178/184) - Original Sharpe: 0.7393
[INFO] Added cluster 2 to portfolio: SMA(166/190) - Original Sharpe: 0.6542
[INFO] Added cluster 3 to portfolio: SMA(52/166) - Original Sharpe: 0.6121
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SB_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2309
[INFO] Hierarchical Best out-of-sample Sharpe: 0.9724
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for SB...
[INFO] Excel file updated successfully. Added SB with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SB
[INFO] Loading SF data from local files...
[INFO] Found data file: A_OHLCV_@SF_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SF in column D: 13.0
[INFO] Using slippage from Excel column D: 13.0
[INFO] 
Symbol: @SF
[INFO] Description: Swiss Franc Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 6.250000000000001
[INFO] Big point value: 125000.0
[INFO] Data shape: (6176, 6)
[INFO] Date range: 2001-05-02 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-02 15:57:00  0.9830  0.9833  0.9793  0.9821     0.0
1 2001-05-03 15:57:00  0.9827  0.9842  0.9827  0.9835    25.0
2 2001-05-07 15:57:00  0.9809  0.9819  0.9798  0.9805   766.0
3 2001-05-08 15:57:00  0.9802  0.9809  0.9755  0.9770     4.0
4 2001-05-09 15:57:00  0.9763  0.9778  0.9758  0.9775   897.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 25.25 seconds (0.42 minutes)
[INFO] Best parameters found: Short SMA = 192, Long SMA = 194
[INFO] Best fitness (Sharpe ratio): 0.202683
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 192, Long SMA = 194, Sharpe = 0.202683
[INFO] Top 2: Short SMA = 186, Long SMA = 204, Sharpe = 0.190330
[INFO] Top 3: Short SMA = 186, Long SMA = 206, Sharpe = 0.177948
[INFO] Top 4: Short SMA = 184, Long SMA = 208, Sharpe = 0.167000
[INFO] Top 5: Short SMA = 190, Long SMA = 202, Sharpe = 0.158744
[INFO] Hall of Fame size: 2302
[INFO] Number of elements in all_results: 2221
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 81 had penalty fitness
[INFO] Total filtered from Hall of Fame: 81
[INFO] Hall of Fame -> all_results: 2302 -> 2221
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2221 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SF
[INFO] Big Point Value (from data): 125000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 7.05 contracts
[INFO] Maximum Position Size: 12 contracts
[INFO] Strategy Total P&L: $123,275.00
[INFO] Market Buy & Hold P&L: $-34,818.75
[INFO] Outperformance: $158,093.75
[INFO] Sharpe ratio (entire period, annualized): 0.159952
[INFO] Sharpe ratio (in-sample, annualized): 0.094356
[INFO] Sharpe ratio (out-of-sample, annualized): 0.357829
[INFO] Maximum Drawdown: $160,875.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $65,462.50
[INFO] Out-of-sample P&L: $83,725.00
[INFO] 
Best parameters from GA: Short SMA = 192, Long SMA = 194, Sharpe = 0.202683
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2302
[INFO] Cache hits (repeated combinations): 6294
[INFO] Total checks: 8596
[INFO] Cache hit rate: 73.22%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2221 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] 
Best parameters:
[INFO] Short SMA: 192
[INFO] Long SMA: 194
[INFO] Sharpe Ratio: 0.202683
[INFO] Number of Trades: 79
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2221 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] Trades range: 10.0 to 171.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.8390 to 2.3334
[INFO] Scaled Long SMA range: -3.5778 to 1.4331
[INFO] Scaled Sharpe ratio range: -3.6579 to 3.0095
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 20
[INFO] Using 20 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=20...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 112 elements
[INFO] Kmeans Cluster 1: 91 elements
[INFO] Kmeans Cluster 2: 122 elements
[INFO] Kmeans Cluster 3: 136 elements
[INFO] Kmeans Cluster 4: 105 elements
[INFO] Kmeans Cluster 5: 68 elements
[INFO] Kmeans Cluster 6: 81 elements
[INFO] Kmeans Cluster 7: 67 elements
[INFO] Kmeans Cluster 8: 127 elements
[INFO] Kmeans Cluster 9: 88 elements
[INFO] Kmeans Cluster 10: 82 elements
[INFO] Kmeans Cluster 11: 103 elements
[INFO] Kmeans Cluster 12: 200 elements
[INFO] Kmeans Cluster 13: 139 elements
[INFO] Kmeans Cluster 14: 106 elements
[INFO] Kmeans Cluster 15: 198 elements
[INFO] Kmeans Cluster 16: 45 elements
[INFO] Kmeans Cluster 17: 147 elements
[INFO] Kmeans Cluster 18: 65 elements
[INFO] Kmeans Cluster 19: 139 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=190.55, Long SMA=242.38, Sharpe=-0.3227
[INFO] Centroid 1: Short SMA=149.05, Long SMA=172.81, Sharpe=-0.2929
[INFO] Centroid 2: Short SMA=81.79, Long SMA=141.82, Sharpe=-0.2651
[INFO] Centroid 3: Short SMA=98.79, Long SMA=277.79, Sharpe=-0.1942
[INFO] Centroid 4: Short SMA=180.32, Long SMA=202.86, Sharpe=0.0382
[INFO] Centroid 5: Short SMA=268.12, Long SMA=291.47, Sharpe=-0.1512
[INFO] Centroid 6: Short SMA=25.21, Long SMA=214.27, Sharpe=-0.5469
[INFO] Centroid 7: Short SMA=38.96, Long SMA=99.49, Sharpe=-0.4477
[INFO] Centroid 8: Short SMA=180.85, Long SMA=226.11, Sharpe=-0.1716
[INFO] Centroid 9: Short SMA=52.48, Long SMA=275.05, Sharpe=-0.3401
[INFO] Centroid 10: Short SMA=192.02, Long SMA=290.07, Sharpe=-0.3811
[INFO] Centroid 11: Short SMA=113.71, Long SMA=149.51, Sharpe=-0.0715
[INFO] Centroid 12: Short SMA=115.64, Long SMA=206.55, Sharpe=-0.1549
[INFO] Centroid 13: Short SMA=84.24, Long SMA=217.84, Sharpe=-0.2711
[INFO] Centroid 14: Short SMA=44.42, Long SMA=198.32, Sharpe=-0.4130
[INFO] Centroid 15: Short SMA=154.48, Long SMA=215.38, Sharpe=-0.0661
[INFO] Centroid 16: Short SMA=33.73, Long SMA=64.27, Sharpe=-0.2546
[INFO] Centroid 17: Short SMA=180.60, Long SMA=273.93, Sharpe=-0.2244
[INFO] Centroid 18: Short SMA=226.74, Long SMA=256.71, Sharpe=-0.5257
[INFO] Centroid 19: Short SMA=259.11, Long SMA=283.48, Sharpe=-0.3015
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=192, Long SMA=194, Sharpe=0.2027, Trades=79
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=182, Long SMA=204, Sharpe=0.0982, Trades=21
[INFO] Kmeans Top 2: Short SMA=152, Long SMA=214, Sharpe=-0.0713, Trades=13
[INFO] Kmeans Top 3: Short SMA=116, Long SMA=154, Sharpe=-0.0877, Trades=16
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=62, Sharpe=-0.1044, Trades=44
[INFO] Kmeans Top 5: Short SMA=280, Long SMA=294, Sharpe=-0.1182, Trades=26
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19}
[INFO]   Rounded: (191, 242)
[INFO]   Nearest: (190.0, 242.0)
[INFO]   Rounded: (149, 173)
[INFO]   Nearest: (150.0, 172.0)
[INFO]   Rounded: (82, 142)
[INFO]   Rounded: (99, 278)
[INFO]   Nearest: (98.0, 278.0)
[INFO]   Rounded: (180, 203)
[INFO]   Nearest: (180.0, 202.0)
[INFO]   Rounded: (268, 291)
[INFO]   Nearest: (268.0, 292.0)
[INFO]   Rounded: (25, 214)
[INFO]   Nearest: (26.0, 214.0)
[INFO]   Rounded: (39, 99)
[INFO]   Nearest: (38.0, 100.0)
[INFO]   Rounded: (181, 226)
[INFO]   Nearest: (180.0, 226.0)
[INFO]   Rounded: (52, 275)
[INFO]   Nearest: (52.0, 276.0)
[INFO]   Rounded: (192, 290)
[INFO]   Rounded: (114, 150)
[INFO]   Rounded: (116, 207)
[INFO]   Nearest: (116.0, 206.0)
[INFO]   Rounded: (84, 218)
[INFO]   Rounded: (44, 198)
[INFO]   Rounded: (154, 215)
[INFO]   Nearest: (154.0, 216.0)
[INFO]   Rounded: (34, 64)
[INFO]   Nearest: (34.0, 66.0)
[INFO]   Rounded: (181, 274)
[INFO]   Nearest: (180.0, 274.0)
[INFO]   Rounded: (227, 257)
[INFO]   Nearest: (226.0, 256.0)
[INFO]   Rounded: (259, 283)
[INFO]   Nearest: (260.0, 284.0)
[INFO] Successfully plotted 20 out of 20 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 192, Long SMA: 194
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SF data from local files...
[INFO] Found data file: A_OHLCV_@SF_minutes_1440_1703-1557.dat
[INFO] File size: 296586 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(182/204) - Original Sharpe: 0.0982, Trades: 21
[INFO] Kmeans cluster 2: SMA(152/214) - Original Sharpe: -0.0713, Trades: 13
[INFO] Kmeans cluster 3: SMA(116/154) - Original Sharpe: -0.0877, Trades: 16
[INFO] Kmeans cluster 4: SMA(36/62) - Original Sharpe: -0.1044, Trades: 44
[INFO] Kmeans cluster 5: SMA(280/294) - Original Sharpe: -0.1182, Trades: 26
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (192/194)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 192, Long SMA: 194
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] Error: No Kmeans cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SF
[INFO] Big Point Value: 125000.0
[INFO] Slippage: 13.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2221 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] 
Best parameters:
[INFO] Short SMA: 192
[INFO] Long SMA: 194
[INFO] Sharpe Ratio: 0.202683
[INFO] Number of Trades: 79
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2221 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.7835 to 0.2027
[INFO] Trades range: 10.0 to 171.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.8390 to 2.3334
[INFO] Scaled Long SMA range: -3.5778 to 1.4331
[INFO] Scaled Sharpe ratio range: -3.6579 to 3.0095
[INFO] Scaled Trades range: -0.7726 to 11.9654
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2221 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6102
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 136 elements
[INFO] Cluster 1: 202 elements
[INFO] Cluster 2: 206 elements
[INFO] Cluster 3: 363 elements
[INFO] Cluster 4: 283 elements
[INFO] Cluster 5: 56 elements
[INFO] Cluster 6: 276 elements
[INFO] Cluster 7: 83 elements
[INFO] Cluster 8: 93 elements
[INFO] Cluster 9: 147 elements
[INFO] Cluster 10: 118 elements
[INFO] Cluster 11: 102 elements
[INFO] Cluster 12: 6 elements
[INFO] Cluster 13: 37 elements
[INFO] Cluster 14: 94 elements
[INFO] Cluster 15: 19 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=48, Long SMA=220, Sharpe=-0.5045, Trades=17
[INFO] Cluster 1 cluster: Short SMA=100, Long SMA=158, Sharpe=-0.2012, Trades=16
[INFO] Cluster 2 cluster: Short SMA=96, Long SMA=278, Sharpe=-0.1638, Trades=12
[INFO] Cluster 3 cluster: Short SMA=188, Long SMA=268, Sharpe=-0.2458, Trades=12
[INFO] Cluster 4 cluster: Short SMA=102, Long SMA=210, Sharpe=-0.2044, Trades=15
[INFO] Cluster 5 cluster: Short SMA=176, Long SMA=180, Sharpe=0.0444, Trades=57
[INFO] Cluster 6 cluster: Short SMA=160, Long SMA=220, Sharpe=-0.0630, Trades=13
[INFO] Cluster 7 cluster: Short SMA=34, Long SMA=108, Sharpe=-0.4200, Trades=25
[INFO] Cluster 8 cluster: Short SMA=278, Long SMA=288, Sharpe=-0.2379, Trades=30
[INFO] Cluster 9 cluster: Short SMA=228, Long SMA=272, Sharpe=-0.3799, Trades=16
[INFO] Cluster 10 cluster: Short SMA=180, Long SMA=202, Sharpe=0.0662, Trades=23
[INFO] Cluster 11 cluster: Short SMA=116, Long SMA=158, Sharpe=-0.0358, Trades=16
[INFO] Cluster 13 cluster: Short SMA=28, Long SMA=48, Sharpe=-0.3650, Trades=55
[INFO] Cluster 14 cluster: Short SMA=26, Long SMA=204, Sharpe=-0.5831, Trades=30
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=192, Long SMA=194, Sharpe=0.2027, Trades=79
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=180, Long SMA=202, Sharpe=0.0662, Trades=23
[INFO] Top 2: Short SMA=176, Long SMA=180, Sharpe=0.0444, Trades=57
[INFO] Top 3: Short SMA=116, Long SMA=158, Sharpe=-0.0358, Trades=16
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 2196 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 192, Long SMA: 194
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SF data from local files...
[INFO] Found data file: A_OHLCV_@SF_minutes_1440_1703-1557.dat
[INFO] File size: 296586 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(180/202) - Original Sharpe: 0.0662, Trades: 23
[INFO] Hierarchical cluster 2: SMA(176/180) - Original Sharpe: 0.0444, Trades: 57
[INFO] Hierarchical cluster 3: SMA(116/158) - Original Sharpe: -0.0358, Trades: 16
[INFO] Hierarchical cluster 4: SMA(160/220) - Original Sharpe: -0.0630, Trades: 13
[INFO] Hierarchical cluster 5: SMA(96/278) - Original Sharpe: -0.1638, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (192/194)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 192, Long SMA: 194
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SF
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SI in column D: 27.0
[INFO] Using slippage from Excel column D: 27.0
[INFO] 
Symbol: @SI
[INFO] Description: Silver Continuous Contract [May25]
[INFO] Exchange: COMEX
[INFO] Interval: minutes 1440
[INFO] Tick size: 25.0
[INFO] Big point value: 5000.0
[INFO] Data shape: (6126, 6)
[INFO] Date range: 2001-05-02 16:55:00 to 2025-04-07 16:55:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-02 16:55:00  14.356  14.366  14.356  14.356    38.0
1 2001-05-03 16:55:00  14.361  14.361  14.356  14.356    17.0
2 2001-05-07 16:55:00  14.321  14.321  14.316  14.316    16.0
3 2001-05-08 16:55:00  14.291  14.301  14.286  14.296    27.0
4 2001-05-09 16:55:00  14.291  14.381  14.291  14.376    55.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 25.90 seconds (0.43 minutes)
[INFO] Best parameters found: Short SMA = 48, Long SMA = 50
[INFO] Best fitness (Sharpe ratio): 0.669797
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 48, Long SMA = 50, Sharpe = 0.669797
[INFO] Top 2: Short SMA = 42, Long SMA = 58, Sharpe = 0.543368
[INFO] Top 3: Short SMA = 44, Long SMA = 56, Sharpe = 0.520009
[INFO] Top 4: Short SMA = 234, Long SMA = 258, Sharpe = 0.441199
[INFO] Top 5: Short SMA = 236, Long SMA = 254, Sharpe = 0.434113
[INFO] Hall of Fame size: 2357
[INFO] Number of elements in all_results: 1571
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 786 had penalty fitness
[INFO] Total filtered from Hall of Fame: 786
[INFO] Hall of Fame -> all_results: 2357 -> 1571
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1571 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3106, Evaluation data length: 2839
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SI
[INFO] Big Point Value (from data): 5000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.38 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $92,635.00
[INFO] Market Buy & Hold P&L: $17,375.00
[INFO] Outperformance: $75,260.00
[INFO] Sharpe ratio (entire period, annualized): -0.068510
[INFO] Sharpe ratio (in-sample, annualized): -0.002947
[INFO] Sharpe ratio (out-of-sample, annualized): -0.206301
[INFO] Maximum Drawdown: $282,850.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-1,795.00
[INFO] Out-of-sample P&L: $-59,890.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.669797
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2357
[INFO] Cache hits (repeated combinations): 6260
[INFO] Total checks: 8617
[INFO] Cache hit rate: 72.65%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 5000.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1571 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.7506 to 0.6698
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.669797
[INFO] Number of Trades: 112
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1571 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.7506 to 0.6698
[INFO] Trades range: 10.0 to 167.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3821 to 1.8279
[INFO] Scaled Long SMA range: -2.7558 to 1.3886
[INFO] Scaled Sharpe ratio range: -3.2769 to 2.9519
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 127 elements
[INFO] Kmeans Cluster 1: 88 elements
[INFO] Kmeans Cluster 2: 134 elements
[INFO] Kmeans Cluster 3: 85 elements
[INFO] Kmeans Cluster 4: 60 elements
[INFO] Kmeans Cluster 5: 106 elements
[INFO] Kmeans Cluster 6: 90 elements
[INFO] Kmeans Cluster 7: 62 elements
[INFO] Kmeans Cluster 8: 118 elements
[INFO] Kmeans Cluster 9: 46 elements
[INFO] Kmeans Cluster 10: 55 elements
[INFO] Kmeans Cluster 11: 46 elements
[INFO] Kmeans Cluster 12: 183 elements
[INFO] Kmeans Cluster 13: 97 elements
[INFO] Kmeans Cluster 14: 80 elements
[INFO] Kmeans Cluster 15: 118 elements
[INFO] Kmeans Cluster 16: 76 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=35.70, Long SMA=241.87, Sharpe=0.1845
[INFO] Centroid 1: Short SMA=81.57, Long SMA=149.61, Sharpe=-0.2364
[INFO] Centroid 2: Short SMA=198.60, Long SMA=235.54, Sharpe=0.2585
[INFO] Centroid 3: Short SMA=165.48, Long SMA=203.74, Sharpe=-0.0241
[INFO] Centroid 4: Short SMA=33.63, Long SMA=53.83, Sharpe=0.1973
[INFO] Centroid 5: Short SMA=272.15, Long SMA=286.96, Sharpe=-0.2505
[INFO] Centroid 6: Short SMA=42.18, Long SMA=98.40, Sharpe=-0.4343
[INFO] Centroid 7: Short SMA=76.26, Long SMA=134.29, Sharpe=-0.0592
[INFO] Centroid 8: Short SMA=233.12, Long SMA=272.22, Sharpe=0.0020
[INFO] Centroid 9: Short SMA=26.04, Long SMA=53.70, Sharpe=-0.0916
[INFO] Centroid 10: Short SMA=127.93, Long SMA=177.60, Sharpe=-0.4804
[INFO] Centroid 11: Short SMA=42.13, Long SMA=148.13, Sharpe=0.2106
[INFO] Centroid 12: Short SMA=216.96, Long SMA=245.77, Sharpe=0.1290
[INFO] Centroid 13: Short SMA=234.58, Long SMA=258.10, Sharpe=0.2843
[INFO] Centroid 14: Short SMA=22.45, Long SMA=273.03, Sharpe=0.0356
[INFO] Centroid 15: Short SMA=38.69, Long SMA=199.19, Sharpe=-0.0022
[INFO] Centroid 16: Short SMA=161.03, Long SMA=195.26, Sharpe=-0.2113
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.6698, Trades=112
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=234, Long SMA=258, Sharpe=0.4412, Trades=13
[INFO] Kmeans Top 2: Short SMA=36, Long SMA=52, Sharpe=0.3005, Trades=50
[INFO] Kmeans Top 3: Short SMA=196, Long SMA=238, Sharpe=0.2813, Trades=13
[INFO] Kmeans Top 4: Short SMA=36, Long SMA=242, Sharpe=0.2187, Trades=12
[INFO] Kmeans Top 5: Short SMA=42, Long SMA=148, Sharpe=0.2168, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (36, 242)
[INFO]   Rounded: (82, 150)
[INFO]   Rounded: (199, 236)
[INFO]   Nearest: (198.0, 236.0)
[INFO]   Rounded: (165, 204)
[INFO]   Nearest: (166.0, 204.0)
[INFO]   Rounded: (34, 54)
[INFO]   Rounded: (272, 287)
[INFO]   Nearest: (272.0, 286.0)
[INFO]   Rounded: (42, 98)
[INFO]   Rounded: (76, 134)
[INFO]   Rounded: (233, 272)
[INFO]   Nearest: (234.0, 272.0)
[INFO]   Rounded: (26, 54)
[INFO]   Rounded: (128, 178)
[INFO]   Rounded: (42, 148)
[INFO]   Rounded: (217, 246)
[INFO]   Nearest: (216.0, 246.0)
[INFO]   Rounded: (235, 258)
[INFO]   Nearest: (234.0, 258.0)
[INFO]   Rounded: (22, 273)
[INFO]   Nearest: (22.0, 274.0)
[INFO]   Rounded: (39, 199)
[INFO]   Nearest: (38.0, 200.0)
[INFO]   Rounded: (161, 195)
[INFO]   Nearest: (162.0, 196.0)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(234/258) - Original Sharpe: 0.4412, Trades: 13
[INFO] Kmeans cluster 2: SMA(36/52) - Original Sharpe: 0.3005, Trades: 50
[INFO] Kmeans cluster 3: SMA(196/238) - Original Sharpe: 0.2813, Trades: 13
[INFO] Kmeans cluster 4: SMA(36/242) - Original Sharpe: 0.2187, Trades: 12
[INFO] Kmeans cluster 5: SMA(42/148) - Original Sharpe: 0.2168, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (234/258) - Sharpe: 0.4412
[INFO] cluster 2: (36/52) - Sharpe: 0.3005
[INFO] cluster 3: (196/238) - Sharpe: 0.2813
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.846146           -1.240540
1    2021-11-14 2021-11-14            43     1.283193           -2.764041
2    2022-01-14 2022-01-14            41     2.565750           -0.820312
3    2022-03-14 2022-03-14            44    -3.404503            4.036081
4    2022-05-14 2022-05-14            43     2.893818            2.893818
5    2022-07-14 2022-07-14            44     0.011366            0.583721
6    2022-09-14 2022-09-14            43     3.966370           -1.778849
7    2022-11-14 2022-11-14            43     1.499239           -1.955034
8    2023-01-14 2023-01-14            41    -2.431921            0.279144
9    2023-03-14 2023-03-14            43    -5.362105           -5.591160
10   2023-05-14 2023-05-14            44    -0.525137            1.501272
11   2023-07-14 2023-07-14            44    -4.645863           -1.720262
12   2023-09-14 2023-09-14            43     1.669521            0.110046
13   2023-11-14 2023-11-14            42    -3.736541           -5.100687
14   2024-01-14 2024-01-14            43    -2.734966           -3.119409
15   2024-03-14 2024-03-14            42     2.485153           -2.336469
16   2024-05-14 2024-05-14            44     1.052155           -1.033012
17   2024-07-14 2024-07-14            45    -2.506040           -1.087391
18   2024-09-14 2024-09-14            43    -1.009444           -0.786393
19   2024-11-14 2024-11-14            33     1.294467            0.859313
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.8 |             -1.2 |          0.6 | True          
[INFO] 2021-11-14   |          1.3 |             -2.8 |         -4.1 | False         
[INFO] 2022-01-14   |          2.6 |             -0.8 |         -3.4 | False         
[INFO] 2022-03-14   |         -3.4 |              4.0 |          7.4 | True          
[INFO] 2022-05-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.0 |              0.6 |          0.6 | True          
[INFO] 2022-09-14   |          4.0 |             -1.8 |         -5.8 | False         
[INFO] 2022-11-14   |          1.5 |             -2.0 |         -3.5 | False         
[INFO] 2023-01-14   |         -2.4 |              0.3 |          2.7 | True          
[INFO] 2023-03-14   |         -5.4 |             -5.6 |         -0.2 | False         
[INFO] 2023-05-14   |         -0.5 |              1.5 |          2.0 | True          
[INFO] 2023-07-14   |         -4.6 |             -1.7 |          2.9 | True          
[INFO] 2023-09-14   |          1.7 |              0.1 |         -1.6 | False         
[INFO] 2023-11-14   |         -3.7 |             -5.1 |         -1.4 | False         
[INFO] 2024-01-14   |         -2.7 |             -3.1 |         -0.4 | False         
[INFO] 2024-03-14   |          2.5 |             -2.3 |         -4.8 | False         
[INFO] 2024-05-14   |          1.1 |             -1.0 |         -2.1 | False         
[INFO] 2024-07-14   |         -2.5 |             -1.1 |          1.4 | True          
[INFO] 2024-09-14   |         -1.0 |             -0.8 |          0.2 | True          
[INFO] 2024-11-14   |          1.3 |              0.9 |         -0.4 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 8 of 19 periods (42.11% win rate)
[INFO] Updating Excel file with Kmeans results for SI...
[INFO] Excel file updated successfully. Added SI with Kmeans win rate 42.1% in row 44
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(234/258) - Original Sharpe: 0.4412
[INFO] Added cluster 2 to portfolio: SMA(36/52) - Original Sharpe: 0.3005
[INFO] Added cluster 3 to portfolio: SMA(196/238) - Original Sharpe: 0.2813
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SI_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.8099
[INFO] Kmeans Best out-of-sample Sharpe: -0.4083
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for SI...
[INFO] Excel file updated successfully. Added SI with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SI
[INFO] Big Point Value: 5000.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1571 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.7506 to 0.6698
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.669797
[INFO] Number of Trades: 112
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1571 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.7506 to 0.6698
[INFO] Trades range: 10.0 to 167.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3821 to 1.8279
[INFO] Scaled Long SMA range: -2.7558 to 1.3886
[INFO] Scaled Sharpe ratio range: -3.2769 to 2.9519
[INFO] Scaled Trades range: -0.7918 to 10.2997
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1571 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5594
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 12
[INFO] Using 12 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 12 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 288 elements
[INFO] Cluster 1: 141 elements
[INFO] Cluster 2: 97 elements
[INFO] Cluster 3: 105 elements
[INFO] Cluster 4: 107 elements
[INFO] Cluster 5: 283 elements
[INFO] Cluster 6: 87 elements
[INFO] Cluster 7: 27 elements
[INFO] Cluster 8: 9 elements
[INFO] Cluster 9: 104 elements
[INFO] Cluster 10: 230 elements
[INFO] Cluster 11: 93 elements
[INFO] Using 11 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=34, Long SMA=240, Sharpe=0.2150, Trades=12
[INFO] Cluster 1 cluster: Short SMA=174, Long SMA=208, Sharpe=-0.2909, Trades=17
[INFO] Cluster 2 cluster: Short SMA=44, Long SMA=100, Sharpe=-0.4081, Trades=30
[INFO] Cluster 3 cluster: Short SMA=44, Long SMA=156, Sharpe=0.1674, Trades=18
[INFO] Cluster 4 cluster: Short SMA=114, Long SMA=176, Sharpe=-0.6208, Trades=20
[INFO] Cluster 5 cluster: Short SMA=216, Long SMA=242, Sharpe=0.2267, Trades=13
[INFO] Cluster 6 cluster: Short SMA=30, Long SMA=50, Sharpe=0.0210, Trades=50
[INFO] Cluster 7 cluster: Short SMA=202, Long SMA=206, Sharpe=0.1419, Trades=47
[INFO] Cluster 9 cluster: Short SMA=274, Long SMA=288, Sharpe=-0.1710, Trades=12
[INFO] Cluster 10 cluster: Short SMA=224, Long SMA=262, Sharpe=0.1709, Trades=13
[INFO] Cluster 11 cluster: Short SMA=84, Long SMA=136, Sharpe=-0.2288, Trades=23
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.6698, Trades=112
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=216, Long SMA=242, Sharpe=0.2267, Trades=13
[INFO] Top 2: Short SMA=34, Long SMA=240, Sharpe=0.2150, Trades=12
[INFO] Top 3: Short SMA=224, Long SMA=262, Sharpe=0.1709, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 11 valid clusters with clusters
[INFO] Filtering to 1562 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(216/242) - Original Sharpe: 0.2267, Trades: 13
[INFO] Hierarchical cluster 2: SMA(34/240) - Original Sharpe: 0.2150, Trades: 12
[INFO] Hierarchical cluster 3: SMA(224/262) - Original Sharpe: 0.1709, Trades: 13
[INFO] Hierarchical cluster 4: SMA(44/156) - Original Sharpe: 0.1674, Trades: 18
[INFO] Hierarchical cluster 5: SMA(202/206) - Original Sharpe: 0.1419, Trades: 47
[INFO] Trimmed warm-up period. Evaluation data length: 2839
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (216/242) - Sharpe: 0.2267
[INFO] cluster 2: (34/240) - Sharpe: 0.2150
[INFO] Loading SI data from local files...
[INFO] Found data file: A_OHLCV_@SI_minutes_1440_1802-1655.dat
[INFO] File size: 294183 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.846146           -2.700420
1    2021-11-14 2021-11-14            43     1.283193            2.964470
2    2022-01-14 2022-01-14            41     2.565750           -2.762371
3    2022-03-14 2022-03-14            44    -3.404503            1.130732
4    2022-05-14 2022-05-14            43     2.893818            2.893818
5    2022-07-14 2022-07-14            44     0.011366            0.011366
6    2022-09-14 2022-09-14            43     3.966370           -1.875590
7    2022-11-14 2022-11-14            43     1.499239           -1.475957
8    2023-01-14 2023-01-14            41    -2.431921            0.000000
9    2023-03-14 2023-03-14            43    -5.362105           -3.123493
10   2023-05-14 2023-05-14            44    -0.525137            1.080461
11   2023-07-14 2023-07-14            44    -4.645863           -2.567759
12   2023-09-14 2023-09-14            43     1.669521            1.960879
13   2023-11-14 2023-11-14            42    -3.736541           -3.265008
14   2024-01-14 2024-01-14            43    -2.734966           -2.940461
15   2024-03-14 2024-03-14            42     2.485153           -2.654573
16   2024-05-14 2024-05-14            44     1.052155            3.018988
17   2024-07-14 2024-07-14            45    -2.506040           -0.245055
18   2024-09-14 2024-09-14            43    -1.009444           -0.349255
19   2024-11-14 2024-11-14            33     1.294467           -1.444151
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.8 |             -2.7 |         -0.9 | False         
[INFO] 2021-11-14   |          1.3 |              3.0 |          1.7 | True          
[INFO] 2022-01-14   |          2.6 |             -2.8 |         -5.4 | False         
[INFO] 2022-03-14   |         -3.4 |              1.1 |          4.5 | True          
[INFO] 2022-05-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-09-14   |          4.0 |             -1.9 |         -5.9 | False         
[INFO] 2022-11-14   |          1.5 |             -1.5 |         -3.0 | False         
[INFO] 2023-01-14   |         -2.4 |              0.0 |          2.4 | True          
[INFO] 2023-03-14   |         -5.4 |             -3.1 |          2.3 | True          
[INFO] 2023-05-14   |         -0.5 |              1.1 |          1.6 | True          
[INFO] 2023-07-14   |         -4.6 |             -2.6 |          2.0 | True          
[INFO] 2023-09-14   |          1.7 |              2.0 |          0.3 | True          
[INFO] 2023-11-14   |         -3.7 |             -3.3 |          0.4 | True          
[INFO] 2024-01-14   |         -2.7 |             -2.9 |         -0.2 | False         
[INFO] 2024-03-14   |          2.5 |             -2.7 |         -5.2 | False         
[INFO] 2024-05-14   |          1.1 |              3.0 |          1.9 | True          
[INFO] 2024-07-14   |         -2.5 |             -0.2 |          2.3 | True          
[INFO] 2024-09-14   |         -1.0 |             -0.3 |          0.7 | True          
[INFO] 2024-11-14   |          1.3 |             -1.4 |         -2.7 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-05-14, 2022-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 18
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 18 periods (61.11% win rate)
[INFO] Updating Excel file with Hierarchical results for SI...
[INFO] Excel file updated successfully. Added SI with Hierarchical win rate 61.1% in row 44
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(216/242) - Original Sharpe: 0.2267
[INFO] Added cluster 2 to portfolio: SMA(34/240) - Original Sharpe: 0.2150
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SI_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.5704
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4083
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for SI...
[INFO] Excel file updated successfully. Added SI with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SI
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for SM in column D: 14.0
[INFO] Using slippage from Excel column D: 14.0
[INFO] 
Symbol: @SM
[INFO] Description: Soybean Meal Continuous Contract [May25]
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 100.0
[INFO] Data shape: (5864, 6)
[INFO] Date range: 2001-06-29 13:13:00 to 2025-04-07 13:13:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2001-06-29 13:13:00 -428.3 -428.3 -428.4 -428.4     9.0
1 2001-07-02 13:13:00 -422.0 -419.3 -422.0 -420.5   140.0
2 2001-07-03 13:13:00 -416.5 -416.5 -418.9 -418.9    61.0
3 2001-07-05 13:13:00 -417.4 -417.4 -418.5 -418.5    81.0
4 2001-07-06 13:13:00 -417.5 -417.5 -417.5 -417.5    52.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 23.95 seconds (0.40 minutes)
[INFO] Best parameters found: Short SMA = 70, Long SMA = 74
[INFO] Best fitness (Sharpe ratio): 0.679896
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 70, Long SMA = 74, Sharpe = 0.679896
[INFO] Top 2: Short SMA = 12, Long SMA = 20, Sharpe = 0.616068
[INFO] Top 3: Short SMA = 14, Long SMA = 22, Sharpe = 0.590241
[INFO] Top 4: Short SMA = 66, Long SMA = 78, Sharpe = 0.558535
[INFO] Top 5: Short SMA = 14, Long SMA = 24, Sharpe = 0.553192
[INFO] Hall of Fame size: 2489
[INFO] Number of elements in all_results: 2232
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 257 had penalty fitness
[INFO] Total filtered from Hall of Fame: 257
[INFO] Hall of Fame -> all_results: 2489 -> 2232
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2232 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @SM
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.37 contracts
[INFO] Maximum Position Size: 19 contracts
[INFO] Strategy Total P&L: $-287,350.00
[INFO] Market Buy & Hold P&L: $10,810.00
[INFO] Outperformance: $-298,160.00
[INFO] Sharpe ratio (entire period, annualized): -0.268895
[INFO] Sharpe ratio (in-sample, annualized): -0.145506
[INFO] Sharpe ratio (out-of-sample, annualized): -0.548829
[INFO] Maximum Drawdown: $292,000.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-76,470.00
[INFO] Out-of-sample P&L: $-127,120.00
[INFO] 
Best parameters from GA: Short SMA = 70, Long SMA = 74, Sharpe = 0.679896
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2489
[INFO] Cache hits (repeated combinations): 6126
[INFO] Total checks: 8615
[INFO] Cache hit rate: 71.11%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2232 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -1.3335 to 0.6799
[INFO] 
Best parameters:
[INFO] Short SMA: 70
[INFO] Long SMA: 74
[INFO] Sharpe Ratio: 0.679896
[INFO] Number of Trades: 63
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2232 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -1.3335 to 0.6799
[INFO] Trades range: 10.0 to 225.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0244 to 2.7133
[INFO] Scaled Long SMA range: -2.2472 to 1.5193
[INFO] Scaled Sharpe ratio range: -3.0526 to 2.7472
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 75 elements
[INFO] Kmeans Cluster 1: 257 elements
[INFO] Kmeans Cluster 2: 90 elements
[INFO] Kmeans Cluster 3: 144 elements
[INFO] Kmeans Cluster 4: 117 elements
[INFO] Kmeans Cluster 5: 92 elements
[INFO] Kmeans Cluster 6: 304 elements
[INFO] Kmeans Cluster 7: 172 elements
[INFO] Kmeans Cluster 8: 114 elements
[INFO] Kmeans Cluster 9: 66 elements
[INFO] Kmeans Cluster 10: 122 elements
[INFO] Kmeans Cluster 11: 51 elements
[INFO] Kmeans Cluster 12: 186 elements
[INFO] Kmeans Cluster 13: 122 elements
[INFO] Kmeans Cluster 14: 226 elements
[INFO] Kmeans Cluster 15: 94 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=77.17, Long SMA=286.88, Sharpe=-0.8955
[INFO] Centroid 1: Short SMA=37.08, Long SMA=176.71, Sharpe=-0.2677
[INFO] Centroid 2: Short SMA=111.60, Long SMA=249.53, Sharpe=-0.5855
[INFO] Centroid 3: Short SMA=56.40, Long SMA=85.10, Sharpe=0.2812
[INFO] Centroid 4: Short SMA=225.79, Long SMA=245.95, Sharpe=-0.2003
[INFO] Centroid 5: Short SMA=273.96, Long SMA=291.93, Sharpe=-1.0259
[INFO] Centroid 6: Short SMA=39.05, Long SMA=232.22, Sharpe=-0.3085
[INFO] Centroid 7: Short SMA=167.50, Long SMA=229.78, Sharpe=-0.3259
[INFO] Centroid 8: Short SMA=102.68, Long SMA=164.40, Sharpe=-0.5147
[INFO] Centroid 9: Short SMA=245.24, Long SMA=276.55, Sharpe=-0.5764
[INFO] Centroid 10: Short SMA=14.52, Long SMA=47.07, Sharpe=0.3006
[INFO] Centroid 11: Short SMA=132.78, Long SMA=160.35, Sharpe=-0.9691
[INFO] Centroid 12: Short SMA=56.85, Long SMA=118.67, Sharpe=-0.1709
[INFO] Centroid 13: Short SMA=29.02, Long SMA=274.95, Sharpe=-0.4823
[INFO] Centroid 14: Short SMA=28.93, Long SMA=84.65, Sharpe=0.0537
[INFO] Centroid 15: Short SMA=166.21, Long SMA=202.72, Sharpe=-0.0780
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=70, Long SMA=74, Sharpe=0.6799, Trades=63
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=14, Long SMA=44, Sharpe=0.4056, Trades=49
[INFO] Kmeans Top 2: Short SMA=58, Long SMA=84, Sharpe=0.2890, Trades=21
[INFO] Kmeans Top 3: Short SMA=28, Long SMA=84, Sharpe=0.0653, Trades=27
[INFO] Kmeans Top 4: Short SMA=166, Long SMA=202, Sharpe=0.0108, Trades=15
[INFO] Kmeans Top 5: Short SMA=58, Long SMA=118, Sharpe=-0.0267, Trades=17
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (77, 287)
[INFO]   Nearest: (78.0, 286.0)
[INFO]   Rounded: (37, 177)
[INFO]   Nearest: (38.0, 176.0)
[INFO]   Rounded: (112, 250)
[INFO]   Rounded: (56, 85)
[INFO]   Nearest: (56.0, 86.0)
[INFO]   Rounded: (226, 246)
[INFO]   Nearest: (224.0, 246.0)
[INFO]   Rounded: (274, 292)
[INFO]   Rounded: (39, 232)
[INFO]   Nearest: (40.0, 232.0)
[INFO]   Rounded: (168, 230)
[INFO]   Rounded: (103, 164)
[INFO]   Nearest: (102.0, 164.0)
[INFO]   Rounded: (245, 277)
[INFO]   Nearest: (246.0, 276.0)
[INFO]   Rounded: (15, 47)
[INFO]   Nearest: (14.0, 48.0)
[INFO]   Rounded: (133, 160)
[INFO]   Nearest: (132.0, 160.0)
[INFO]   Rounded: (57, 119)
[INFO]   Nearest: (56.0, 118.0)
[INFO]   Rounded: (29, 275)
[INFO]   Nearest: (30.0, 274.0)
[INFO]   Rounded: (29, 85)
[INFO]   Nearest: (28.0, 84.0)
[INFO]   Rounded: (166, 203)
[INFO]   Nearest: (166.0, 202.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 70, Long SMA: 74
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(14/44) - Original Sharpe: 0.4056, Trades: 49
[INFO] Kmeans cluster 2: SMA(58/84) - Original Sharpe: 0.2890, Trades: 21
[INFO] Kmeans cluster 3: SMA(28/84) - Original Sharpe: 0.0653, Trades: 27
[INFO] Kmeans cluster 4: SMA(166/202) - Original Sharpe: 0.0108, Trades: 15
[INFO] Kmeans cluster 5: SMA(58/118) - Original Sharpe: -0.0267, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (70/74)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 2 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (14/44) - Sharpe: 0.4056
[INFO] cluster 2: (58/84) - Sharpe: 0.2890
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.297409           -0.303085
1    2021-11-10 2021-11-10            41     0.579196            5.466972
2    2022-01-10 2022-01-10            41     2.725389            2.725389
3    2022-03-10 2022-03-10            42    -4.090683           -0.582141
4    2022-05-10 2022-05-10            41    -3.216020           -1.466966
5    2022-07-10 2022-07-10            44    -0.228249            0.762643
6    2022-09-10 2022-09-10            43     0.723663           -0.519746
7    2022-11-10 2022-11-10            40    -1.624676            0.986060
8    2023-01-10 2023-01-10            41     1.963421            1.963421
9    2023-03-10 2023-03-10            42    -4.781168           -3.657735
10   2023-05-10 2023-05-10            40     1.697903            0.037417
11   2023-07-10 2023-07-10            44    -0.986722           -4.430955
12   2023-09-10 2023-09-10            44    -0.465397           -3.665272
13   2023-11-10 2023-11-10            40    -3.397712           -1.401856
14   2024-01-10 2024-01-10            41     0.698756            0.363957
15   2024-03-10 2024-03-10            43    -2.269644            0.064066
16   2024-05-10 2024-05-10            40    -2.839898           -1.208075
17   2024-07-10 2024-07-10            43    -2.557415           -0.826141
18   2024-09-10 2024-09-10            44    -1.365575            5.067302
19   2024-11-10 2024-11-10            35    -0.851426           -1.420406
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.3 |             -0.3 |          0.0 | Excluded      
[INFO] 2021-11-10   |          0.6 |              5.5 |          4.9 | True          
[INFO] 2022-01-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -4.1 |             -0.6 |          3.5 | True          
[INFO] 2022-05-10   |         -3.2 |             -1.5 |          1.7 | True          
[INFO] 2022-07-10   |         -0.2 |              0.8 |          1.0 | True          
[INFO] 2022-09-10   |          0.7 |             -0.5 |         -1.2 | False         
[INFO] 2022-11-10   |         -1.6 |              1.0 |          2.6 | True          
[INFO] 2023-01-10   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -4.8 |             -3.7 |          1.1 | True          
[INFO] 2023-05-10   |          1.7 |              0.0 |         -1.7 | False         
[INFO] 2023-07-10   |         -1.0 |             -4.4 |         -3.4 | False         
[INFO] 2023-09-10   |         -0.5 |             -3.7 |         -3.2 | False         
[INFO] 2023-11-10   |         -3.4 |             -1.4 |          2.0 | True          
[INFO] 2024-01-10   |          0.7 |              0.4 |         -0.3 | False         
[INFO] 2024-03-10   |         -2.3 |              0.1 |          2.4 | True          
[INFO] 2024-05-10   |         -2.8 |             -1.2 |          1.6 | True          
[INFO] 2024-07-10   |         -2.6 |             -0.8 |          1.8 | True          
[INFO] 2024-09-10   |         -1.4 |              5.1 |          6.5 | True          
[INFO] 2024-11-10   |         -0.9 |             -1.4 |         -0.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2022-01-10, 2023-01-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Kmeans cluster wins (rounded comparison): 11 of 17 periods (64.71% win rate)
[INFO] Updating Excel file with Kmeans results for SM...
[INFO] Excel file updated successfully. Added SM with Kmeans win rate 64.7% in row 45
[INFO] Added best Sharpe parameters 70/74 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 70, Long SMA: 74
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(14/44) - Original Sharpe: 0.4056
[INFO] Added cluster 2 to portfolio: SMA(58/84) - Original Sharpe: 0.2890
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SM_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0798
[INFO] Kmeans Best out-of-sample Sharpe: -0.8993
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for SM...
[INFO] Excel file updated successfully. Added SM with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SM
[INFO] Big Point Value: 100.0
[INFO] Slippage: 14.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2232 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -1.3335 to 0.6799
[INFO] 
Best parameters:
[INFO] Short SMA: 70
[INFO] Long SMA: 74
[INFO] Sharpe Ratio: 0.679896
[INFO] Number of Trades: 63
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2232 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -1.3335 to 0.6799
[INFO] Trades range: 10.0 to 225.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.0244 to 2.7133
[INFO] Scaled Long SMA range: -2.2472 to 1.5193
[INFO] Scaled Sharpe ratio range: -3.0526 to 2.7472
[INFO] Scaled Trades range: -0.7255 to 12.4160
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2232 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5134
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 186 elements
[INFO] Cluster 1: 162 elements
[INFO] Cluster 2: 177 elements
[INFO] Cluster 3: 80 elements
[INFO] Cluster 4: 212 elements
[INFO] Cluster 5: 120 elements
[INFO] Cluster 6: 277 elements
[INFO] Cluster 7: 183 elements
[INFO] Cluster 8: 30 elements
[INFO] Cluster 9: 122 elements
[INFO] Cluster 10: 251 elements
[INFO] Cluster 11: 38 elements
[INFO] Cluster 12: 98 elements
[INFO] Cluster 13: 165 elements
[INFO] Cluster 14: 41 elements
[INFO] Cluster 15: 6 elements
[INFO] Cluster 16: 84 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=228, Long SMA=254, Sharpe=-0.1016, Trades=12
[INFO] Cluster 1 cluster: Short SMA=20, Long SMA=62, Sharpe=0.0573, Trades=35
[INFO] Cluster 2 cluster: Short SMA=14, Long SMA=170, Sharpe=-0.1996, Trades=23
[INFO] Cluster 3 cluster: Short SMA=140, Long SMA=164, Sharpe=-0.9872, Trades=19
[INFO] Cluster 4 cluster: Short SMA=164, Long SMA=220, Sharpe=-0.1461, Trades=13
[INFO] Cluster 5 cluster: Short SMA=114, Long SMA=240, Sharpe=-0.6224, Trades=11
[INFO] Cluster 6 cluster: Short SMA=54, Long SMA=226, Sharpe=-0.2882, Trades=11
[INFO] Cluster 7 cluster: Short SMA=64, Long SMA=162, Sharpe=-0.2029, Trades=13
[INFO] Cluster 8 cluster: Short SMA=20, Long SMA=26, Sharpe=0.1829, Trades=93
[INFO] Cluster 9 cluster: Short SMA=70, Long SMA=116, Sharpe=-0.1141, Trades=19
[INFO] Cluster 10 cluster: Short SMA=44, Long SMA=92, Sharpe=0.2559, Trades=19
[INFO] Cluster 11 cluster: Short SMA=218, Long SMA=224, Sharpe=-0.0771, Trades=38
[INFO] Cluster 12 cluster: Short SMA=274, Long SMA=290, Sharpe=-0.9468, Trades=19
[INFO] Cluster 13 cluster: Short SMA=14, Long SMA=256, Sharpe=-0.4020, Trades=23
[INFO] Cluster 14 cluster: Short SMA=24, Long SMA=36, Sharpe=-0.0430, Trades=63
[INFO] Cluster 16 cluster: Short SMA=74, Long SMA=286, Sharpe=-0.8959, Trades=14
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=70, Long SMA=74, Sharpe=0.6799, Trades=63
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=44, Long SMA=92, Sharpe=0.2559, Trades=19
[INFO] Top 2: Short SMA=20, Long SMA=26, Sharpe=0.1829, Trades=93
[INFO] Top 3: Short SMA=20, Long SMA=62, Sharpe=0.0573, Trades=35
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 2226 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 70, Long SMA: 74
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(44/92) - Original Sharpe: 0.2559, Trades: 19
[INFO] Hierarchical cluster 2: SMA(20/26) - Original Sharpe: 0.1829, Trades: 93
[INFO] Hierarchical cluster 3: SMA(20/62) - Original Sharpe: 0.0573, Trades: 35
[INFO] Hierarchical cluster 4: SMA(24/36) - Original Sharpe: -0.0430, Trades: 63
[INFO] Hierarchical cluster 5: SMA(218/224) - Original Sharpe: -0.0771, Trades: 38
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (70/74)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 1 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (44/92) - Sharpe: 0.2559
[INFO] Loading SM data from local files...
[INFO] Found data file: A_OHLCV_@SM_minutes_1440_1903-1313.dat
[INFO] File size: 281612 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -0.297409           -0.297409
1    2021-11-10 2021-11-10            41     0.579196            1.611311
2    2022-01-10 2022-01-10            41     2.725389            2.725389
3    2022-03-10 2022-03-10            42    -4.090683           -4.090683
4    2022-05-10 2022-05-10            41    -3.216020            0.404707
5    2022-07-10 2022-07-10            44    -0.228249           -0.886550
6    2022-09-10 2022-09-10            43     0.723663            0.393718
7    2022-11-10 2022-11-10            40    -1.624676           -2.561372
8    2023-01-10 2023-01-10            41     1.963421            1.963421
9    2023-03-10 2023-03-10            42    -4.781168           -2.649956
10   2023-05-10 2023-05-10            40     1.697903            0.316314
11   2023-07-10 2023-07-10            44    -0.986722           -3.278121
12   2023-09-10 2023-09-10            44    -0.465397           -4.404824
13   2023-11-10 2023-11-10            40    -3.397712           -3.397712
14   2024-01-10 2024-01-10            41     0.698756           -0.416127
15   2024-03-10 2024-03-10            43    -2.269644           -2.269644
16   2024-05-10 2024-05-10            40    -2.839898           -1.868322
17   2024-07-10 2024-07-10            43    -2.557415           -0.376535
18   2024-09-10 2024-09-10            44    -1.365575           -0.275757
19   2024-11-10 2024-11-10            35    -0.851426           -2.918084
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -0.3 |             -0.3 |          0.0 | Excluded      
[INFO] 2021-11-10   |          0.6 |              1.6 |          1.0 | True          
[INFO] 2022-01-10   |          2.7 |              2.7 |          0.0 | Excluded      
[INFO] 2022-03-10   |         -4.1 |             -4.1 |          0.0 | Excluded      
[INFO] 2022-05-10   |         -3.2 |              0.4 |          3.6 | True          
[INFO] 2022-07-10   |         -0.2 |             -0.9 |         -0.7 | False         
[INFO] 2022-09-10   |          0.7 |              0.4 |         -0.3 | False         
[INFO] 2022-11-10   |         -1.6 |             -2.6 |         -1.0 | False         
[INFO] 2023-01-10   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2023-03-10   |         -4.8 |             -2.6 |          2.2 | True          
[INFO] 2023-05-10   |          1.7 |              0.3 |         -1.4 | False         
[INFO] 2023-07-10   |         -1.0 |             -3.3 |         -2.3 | False         
[INFO] 2023-09-10   |         -0.5 |             -4.4 |         -3.9 | False         
[INFO] 2023-11-10   |         -3.4 |             -3.4 |          0.0 | Excluded      
[INFO] 2024-01-10   |          0.7 |             -0.4 |         -1.1 | False         
[INFO] 2024-03-10   |         -2.3 |             -2.3 |          0.0 | Excluded      
[INFO] 2024-05-10   |         -2.8 |             -1.9 |          0.9 | True          
[INFO] 2024-07-10   |         -2.6 |             -0.4 |          2.2 | True          
[INFO] 2024-09-10   |         -1.4 |             -0.3 |          1.1 | True          
[INFO] 2024-11-10   |         -0.9 |             -2.9 |         -2.0 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-10, 2022-01-10, 2022-03-10, 2023-01-10, 2023-11-10, 2024-03-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 6 of 14 periods (42.86% win rate)
[INFO] Updating Excel file with Hierarchical results for SM...
[INFO] Excel file updated successfully. Added SM with Hierarchical win rate 42.9% in row 45
[INFO] Added best Sharpe parameters 70/74 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 70, Long SMA: 74
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(44/92) - Original Sharpe: 0.2559
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'SM_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -1.0355
[INFO] Hierarchical Best out-of-sample Sharpe: -0.8993
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for SM...
[INFO] Excel file updated successfully. Added SM with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\SM
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for TEN in column D: 18.0
[INFO] Using slippage from Excel column D: 18.0
[INFO] 
Symbol: @TEN=117XC
[INFO] Description: Ultra 10-Year T-Note Custom Continuous Contract
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 15.625
[INFO] Big point value: 1000.0
[INFO] Data shape: (2386, 6)
[INFO] Date range: 2016-01-11 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime        open        high         low       close   volume
0 2016-01-11 15:57:00  130.625000  130.625000  129.468750  129.468750   1220.0
1 2016-01-12 15:57:00  129.625000  130.593750  129.187500  130.328125   6105.0
2 2016-01-13 15:57:00  130.187500  131.078125  129.812500  130.515625  20466.0
3 2016-01-14 15:57:00  130.546875  131.046875  130.140625  130.468750  22288.0
4 2016-01-15 15:57:00  130.453125  131.781250  130.406250  131.218750  26633.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 26.13 seconds (0.44 minutes)
[INFO] Best parameters found: Short SMA = 58, Long SMA = 76
[INFO] Best fitness (Sharpe ratio): 1.262627
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 58, Long SMA = 76, Sharpe = 1.262627
[INFO] Top 2: Short SMA = 60, Long SMA = 76, Sharpe = 1.214396
[INFO] Top 3: Short SMA = 60, Long SMA = 74, Sharpe = 1.189668
[INFO] Top 4: Short SMA = 58, Long SMA = 74, Sharpe = 1.175081
[INFO] Top 5: Short SMA = 58, Long SMA = 78, Sharpe = 1.169937
[INFO] Hall of Fame size: 2441
[INFO] Number of elements in all_results: 1523
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 918 had penalty fitness
[INFO] Total filtered from Hall of Fame: 918
[INFO] Hall of Fame -> all_results: 2441 -> 1523
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1523 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 2318, Evaluation data length: 2318
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @TEN=117XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 8.08 contracts
[INFO] Maximum Position Size: 15 contracts
[INFO] Strategy Total P&L: $145,046.88
[INFO] Market Buy & Hold P&L: $-18,312.50
[INFO] Outperformance: $163,359.38
[INFO] Sharpe ratio (entire period, annualized): 0.226538
[INFO] Sharpe ratio (in-sample, annualized): 0.000695
[INFO] Sharpe ratio (out-of-sample, annualized): 0.760333
[INFO] Maximum Drawdown: $302,125.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 1
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 1
[INFO] In-sample P&L: $312.50
[INFO] Out-of-sample P&L: $144,734.38
[INFO] 
Best parameters from GA: Short SMA = 58, Long SMA = 76, Sharpe = 1.262627
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2441
[INFO] Cache hits (repeated combinations): 6178
[INFO] Total checks: 8619
[INFO] Cache hit rate: 71.68%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1523 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.4871 to 1.2626
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 76
[INFO] Sharpe Ratio: 1.262627
[INFO] Number of Trades: 23
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1523 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.4871 to 1.2626
[INFO] Trades range: 10.0 to 159.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.8247 to 2.7459
[INFO] Scaled Long SMA range: -1.7128 to 2.0361
[INFO] Scaled Sharpe ratio range: -2.5177 to 2.2568
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 152 elements
[INFO] Kmeans Cluster 1: 79 elements
[INFO] Kmeans Cluster 2: 96 elements
[INFO] Kmeans Cluster 3: 24 elements
[INFO] Kmeans Cluster 4: 89 elements
[INFO] Kmeans Cluster 5: 187 elements
[INFO] Kmeans Cluster 6: 125 elements
[INFO] Kmeans Cluster 7: 57 elements
[INFO] Kmeans Cluster 8: 60 elements
[INFO] Kmeans Cluster 9: 126 elements
[INFO] Kmeans Cluster 10: 138 elements
[INFO] Kmeans Cluster 11: 31 elements
[INFO] Kmeans Cluster 12: 69 elements
[INFO] Kmeans Cluster 13: 161 elements
[INFO] Kmeans Cluster 14: 97 elements
[INFO] Kmeans Cluster 15: 32 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=32.37, Long SMA=56.39, Sharpe=0.8083
[INFO] Centroid 1: Short SMA=231.52, Long SMA=250.86, Sharpe=-0.0495
[INFO] Centroid 2: Short SMA=21.75, Long SMA=199.15, Sharpe=0.4999
[INFO] Centroid 3: Short SMA=129.33, Long SMA=148.92, Sharpe=-0.1582
[INFO] Centroid 4: Short SMA=22.04, Long SMA=260.67, Sharpe=0.4174
[INFO] Centroid 5: Short SMA=32.15, Long SMA=91.42, Sharpe=0.7943
[INFO] Centroid 6: Short SMA=273.66, Long SMA=286.08, Sharpe=0.0320
[INFO] Centroid 7: Short SMA=144.04, Long SMA=176.07, Sharpe=0.2458
[INFO] Centroid 8: Short SMA=67.47, Long SMA=117.13, Sharpe=0.2041
[INFO] Centroid 9: Short SMA=41.31, Long SMA=168.64, Sharpe=0.2466
[INFO] Centroid 10: Short SMA=28.01, Long SMA=133.24, Sharpe=0.4283
[INFO] Centroid 11: Short SMA=17.35, Long SMA=35.35, Sharpe=0.3817
[INFO] Centroid 12: Short SMA=64.03, Long SMA=90.90, Sharpe=0.5654
[INFO] Centroid 13: Short SMA=35.14, Long SMA=65.52, Sharpe=0.9865
[INFO] Centroid 14: Short SMA=80.74, Long SMA=141.42, Sharpe=-0.1245
[INFO] Centroid 15: Short SMA=193.44, Long SMA=204.50, Sharpe=-0.1147
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=76, Sharpe=1.2626, Trades=23
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=30, Long SMA=62, Sharpe=0.9163, Trades=27
[INFO] Kmeans Top 2: Short SMA=32, Long SMA=56, Sharpe=0.8992, Trades=29
[INFO] Kmeans Top 3: Short SMA=30, Long SMA=92, Sharpe=0.8609, Trades=17
[INFO] Kmeans Top 4: Short SMA=66, Long SMA=90, Sharpe=0.6753, Trades=21
[INFO] Kmeans Top 5: Short SMA=22, Long SMA=200, Sharpe=0.5319, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (32, 56)
[INFO]   Rounded: (232, 251)
[INFO]   Nearest: (232.0, 250.0)
[INFO]   Rounded: (22, 199)
[INFO]   Nearest: (22.0, 200.0)
[INFO]   Rounded: (129, 149)
[INFO]   Nearest: (128.0, 148.0)
[INFO]   Rounded: (22, 261)
[INFO]   Nearest: (22.0, 260.0)
[INFO]   Rounded: (32, 91)
[INFO]   Nearest: (32.0, 92.0)
[INFO]   Rounded: (274, 286)
[INFO]   Rounded: (144, 176)
[INFO]   Rounded: (67, 117)
[INFO]   Nearest: (68.0, 118.0)
[INFO]   Rounded: (41, 169)
[INFO]   Nearest: (42.0, 168.0)
[INFO]   Rounded: (28, 133)
[INFO]   Nearest: (28.0, 134.0)
[INFO]   Rounded: (17, 35)
[INFO]   Nearest: (18.0, 36.0)
[INFO]   Rounded: (64, 91)
[INFO]   Nearest: (64.0, 90.0)
[INFO]   Rounded: (35, 66)
[INFO]   Nearest: (36.0, 66.0)
[INFO]   Rounded: (81, 141)
[INFO]   Nearest: (80.0, 142.0)
[INFO]   Rounded: (193, 204)
[INFO]   Nearest: (194.0, 204.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 76
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(30/62) - Original Sharpe: 0.9163, Trades: 27
[INFO] Kmeans cluster 2: SMA(32/56) - Original Sharpe: 0.8992, Trades: 29
[INFO] Kmeans cluster 3: SMA(30/92) - Original Sharpe: 0.8609, Trades: 17
[INFO] Kmeans cluster 4: SMA(66/90) - Original Sharpe: 0.6753, Trades: 21
[INFO] Kmeans cluster 5: SMA(22/200) - Original Sharpe: 0.5319, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2318
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/76)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (30/62) - Sharpe: 0.9163
[INFO] cluster 2: (32/56) - Sharpe: 0.8992
[INFO] cluster 3: (30/92) - Sharpe: 0.8609
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Out-of-sample period starts on: 2022-04-25
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2022-04-25 2022-04-25            45     0.869705            0.869705
1    2022-06-25 2022-06-25            43    -0.666869           -5.028593
2    2022-08-25 2022-08-25            43    -1.133345            2.878683
3    2022-10-25 2022-10-25            44    -2.239033           -4.736048
4    2022-12-25 2022-12-25            43    -3.070652           -1.067068
5    2023-02-25 2023-02-25            41    -3.791965           -2.964385
6    2023-04-25 2023-04-25            44    -2.516428           -1.855638
7    2023-06-25 2023-06-25            44     2.949798            2.949798
8    2023-08-25 2023-08-25            43     3.401253            3.401253
9    2023-10-25 2023-10-25            43    -4.105859           -1.131664
10   2023-12-25 2023-12-25            43    -3.479188           -2.602399
11   2024-02-25 2024-02-25            42     2.392603            3.813771
12   2024-04-25 2024-04-25            43    -2.501372           -2.244924
13   2024-06-25 2024-06-25            44     2.619489            3.391634
14   2024-08-25 2024-08-25            44    -3.660489           -3.038881
15   2024-10-25 2024-10-25            43     0.789016            2.508785
16   2024-12-25 2024-12-25             4    -0.779051           -0.779051
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2022-04-25   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2022-06-25   |         -0.7 |             -5.0 |         -4.3 | False         
[INFO] 2022-08-25   |         -1.1 |              2.9 |          4.0 | True          
[INFO] 2022-10-25   |         -2.2 |             -4.7 |         -2.5 | False         
[INFO] 2022-12-25   |         -3.1 |             -1.1 |          2.0 | True          
[INFO] 2023-02-25   |         -3.8 |             -3.0 |          0.8 | True          
[INFO] 2023-04-25   |         -2.5 |             -1.9 |          0.6 | True          
[INFO] 2023-06-25   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-08-25   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-10-25   |         -4.1 |             -1.1 |          3.0 | True          
[INFO] 2023-12-25   |         -3.5 |             -2.6 |          0.9 | True          
[INFO] 2024-02-25   |          2.4 |              3.8 |          1.4 | True          
[INFO] 2024-04-25   |         -2.5 |             -2.2 |          0.3 | True          
[INFO] 2024-06-25   |          2.6 |              3.4 |          0.8 | True          
[INFO] 2024-08-25   |         -3.7 |             -3.0 |          0.7 | True          
[INFO] 2024-10-25   |          0.8 |              2.5 |          1.7 | True          
[INFO] 2024-12-25   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-25, 2023-06-25, 2023-08-25, 2024-12-25
[INFO] 
Total periods before exclusion: 17
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 11 of 13 periods (84.62% win rate)
[INFO] Updating Excel file with Kmeans results for TEN...
[INFO] Excel file updated successfully. Added TEN with Kmeans win rate 84.6% in row 46
[INFO] Added best Sharpe parameters 58/76 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 76
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(30/62) - Original Sharpe: 0.9163
[INFO] Added cluster 2 to portfolio: SMA(32/56) - Original Sharpe: 0.8992
[INFO] Added cluster 3 to portfolio: SMA(30/92) - Original Sharpe: 0.8609
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TEN_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1217
[INFO] Kmeans Best out-of-sample Sharpe: -0.8139
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for TEN...
[INFO] Excel file updated successfully. Added TEN with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TEN
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1523 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.4871 to 1.2626
[INFO] 
Best parameters:
[INFO] Short SMA: 58
[INFO] Long SMA: 76
[INFO] Sharpe Ratio: 1.262627
[INFO] Number of Trades: 23
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1523 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.4871 to 1.2626
[INFO] Trades range: 10.0 to 159.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.8247 to 2.7459
[INFO] Scaled Long SMA range: -1.7128 to 2.0361
[INFO] Scaled Sharpe ratio range: -2.5177 to 2.2568
[INFO] Scaled Trades range: -0.7768 to 10.7591
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1523 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6389
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 258 elements
[INFO] Cluster 1: 161 elements
[INFO] Cluster 2: 122 elements
[INFO] Cluster 3: 4 elements
[INFO] Cluster 4: 35 elements
[INFO] Cluster 5: 172 elements
[INFO] Cluster 6: 16 elements
[INFO] Cluster 7: 182 elements
[INFO] Cluster 8: 124 elements
[INFO] Cluster 9: 87 elements
[INFO] Cluster 10: 60 elements
[INFO] Cluster 11: 114 elements
[INFO] Cluster 12: 124 elements
[INFO] Cluster 13: 64 elements
[INFO] Using 12 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=30, Long SMA=64, Sharpe=0.8694, Trades=25
[INFO] Cluster 1 cluster: Short SMA=20, Long SMA=236, Sharpe=0.4570, Trades=11
[INFO] Cluster 2 cluster: Short SMA=228, Long SMA=244, Sharpe=0.0689, Trades=14
[INFO] Cluster 4 cluster: Short SMA=38, Long SMA=44, Sharpe=1.1089, Trades=57
[INFO] Cluster 5 cluster: Short SMA=54, Long SMA=158, Sharpe=-0.0039, Trades=13
[INFO] Cluster 7 cluster: Short SMA=30, Long SMA=92, Sharpe=0.8609, Trades=17
[INFO] Cluster 8 cluster: Short SMA=46, Long SMA=116, Sharpe=0.4222, Trades=13
[INFO] Cluster 9 cluster: Short SMA=84, Long SMA=140, Sharpe=-0.2706, Trades=13
[INFO] Cluster 10 cluster: Short SMA=142, Long SMA=174, Sharpe=0.2378, Trades=15
[INFO] Cluster 11 cluster: Short SMA=274, Long SMA=288, Sharpe=0.0093, Trades=12
[INFO] Cluster 12 cluster: Short SMA=20, Long SMA=154, Sharpe=0.3373, Trades=15
[INFO] Cluster 13 cluster: Short SMA=34, Long SMA=46, Sharpe=0.8646, Trades=43
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=58, Long SMA=76, Sharpe=1.2626, Trades=23
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=38, Long SMA=44, Sharpe=1.1089, Trades=57
[INFO] Top 2: Short SMA=30, Long SMA=64, Sharpe=0.8694, Trades=25
[INFO] Top 3: Short SMA=34, Long SMA=46, Sharpe=0.8646, Trades=43
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 12 valid clusters with clusters
[INFO] Filtering to 1503 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 58, Long SMA: 76
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 0
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(38/44) - Original Sharpe: 1.1089, Trades: 57
[INFO] Hierarchical cluster 2: SMA(30/64) - Original Sharpe: 0.8694, Trades: 25
[INFO] Hierarchical cluster 3: SMA(34/46) - Original Sharpe: 0.8646, Trades: 43
[INFO] Hierarchical cluster 4: SMA(30/92) - Original Sharpe: 0.8609, Trades: 17
[INFO] Hierarchical cluster 5: SMA(20/236) - Original Sharpe: 0.4570, Trades: 11
[INFO] Trimmed warm-up period. Evaluation data length: 2318
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (58/76)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (38/44) - Sharpe: 1.1089
[INFO] cluster 2: (30/64) - Sharpe: 0.8694
[INFO] cluster 3: (34/46) - Sharpe: 0.8646
[INFO] Loading TEN data from local files...
[INFO] Found data file: A_OHLCV_@TEN=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 114682 bytes
[INFO] Out-of-sample period starts on: 2022-04-25
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2022-04-25 2022-04-25            45     0.869705            0.869705
1    2022-06-25 2022-06-25            43    -0.666869           -4.813578
2    2022-08-25 2022-08-25            43    -1.133345            2.871142
3    2022-10-25 2022-10-25            44    -2.239033           -4.560034
4    2022-12-25 2022-12-25            43    -3.070652            1.069058
5    2023-02-25 2023-02-25            41    -3.791965           -3.515558
6    2023-04-25 2023-04-25            44    -2.516428           -1.052692
7    2023-06-25 2023-06-25            44     2.949798            2.949798
8    2023-08-25 2023-08-25            43     3.401253            3.401253
9    2023-10-25 2023-10-25            43    -4.105859           -0.768050
10   2023-12-25 2023-12-25            43    -3.479188           -2.799862
11   2024-02-25 2024-02-25            42     2.392603            2.815433
12   2024-04-25 2024-04-25            43    -2.501372           -1.563696
13   2024-06-25 2024-06-25            44     2.619489            2.456146
14   2024-08-25 2024-08-25            44    -3.660489           -2.050803
15   2024-10-25 2024-10-25            43     0.789016            2.691949
16   2024-12-25 2024-12-25             4    -0.779051           -0.779051
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2022-04-25   |          0.9 |              0.9 |          0.0 | Excluded      
[INFO] 2022-06-25   |         -0.7 |             -4.8 |         -4.1 | False         
[INFO] 2022-08-25   |         -1.1 |              2.9 |          4.0 | True          
[INFO] 2022-10-25   |         -2.2 |             -4.6 |         -2.4 | False         
[INFO] 2022-12-25   |         -3.1 |              1.1 |          4.2 | True          
[INFO] 2023-02-25   |         -3.8 |             -3.5 |          0.3 | True          
[INFO] 2023-04-25   |         -2.5 |             -1.1 |          1.4 | True          
[INFO] 2023-06-25   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2023-08-25   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-10-25   |         -4.1 |             -0.8 |          3.3 | True          
[INFO] 2023-12-25   |         -3.5 |             -2.8 |          0.7 | True          
[INFO] 2024-02-25   |          2.4 |              2.8 |          0.4 | True          
[INFO] 2024-04-25   |         -2.5 |             -1.6 |          0.9 | True          
[INFO] 2024-06-25   |          2.6 |              2.5 |         -0.1 | False         
[INFO] 2024-08-25   |         -3.7 |             -2.1 |          1.6 | True          
[INFO] 2024-10-25   |          0.8 |              2.7 |          1.9 | True          
[INFO] 2024-12-25   |         -0.8 |             -0.8 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-04-25, 2023-06-25, 2023-08-25, 2024-12-25
[INFO] 
Total periods before exclusion: 17
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 10 of 13 periods (76.92% win rate)
[INFO] Updating Excel file with Hierarchical results for TEN...
[INFO] Excel file updated successfully. Added TEN with Hierarchical win rate 76.9% in row 46
[INFO] Added best Sharpe parameters 58/76 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 58, Long SMA: 76
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(38/44) - Original Sharpe: 1.1089
[INFO] Added cluster 2 to portfolio: SMA(30/64) - Original Sharpe: 0.8694
[INFO] Added cluster 3 to portfolio: SMA(34/46) - Original Sharpe: 0.8646
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TEN_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.0794
[INFO] Hierarchical Best out-of-sample Sharpe: -0.8139
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for TEN...
[INFO] Excel file updated successfully. Added TEN with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TEN
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for TY in column D: 18.0
[INFO] Using slippage from Excel column D: 18.0
[INFO] 
Symbol: @TY
[INFO] Description: 10 Yr U.S. Treasury Notes Continuous Contract [Jun25]
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 15.625
[INFO] Big point value: 1000.0
[INFO] Data shape: (6118, 6)
[INFO] Date range: 2001-05-14 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime       open       high        low      close    volume
0 2001-05-14 15:57:00  44.859375  44.968750  44.609375  44.875000  270726.0
1 2001-05-15 15:57:00  44.937500  45.015625  44.296875  44.406250  234515.0
2 2001-05-16 15:57:00  44.390625  44.937500  44.390625  44.703125  273066.0
3 2001-05-17 15:57:00  44.687500  45.015625  44.203125  45.000000  328186.0
4 2001-05-18 15:57:00  44.984375  45.203125  44.750000  44.906250  222530.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 28.26 seconds (0.47 minutes)
[INFO] Best parameters found: Short SMA = 56, Long SMA = 82
[INFO] Best fitness (Sharpe ratio): 1.031512
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 56, Long SMA = 82, Sharpe = 1.031512
[INFO] Top 2: Short SMA = 54, Long SMA = 84, Sharpe = 0.950353
[INFO] Top 3: Short SMA = 56, Long SMA = 84, Sharpe = 0.934949
[INFO] Top 4: Short SMA = 60, Long SMA = 78, Sharpe = 0.919580
[INFO] Top 5: Short SMA = 56, Long SMA = 80, Sharpe = 0.885579
[INFO] Hall of Fame size: 2530
[INFO] Number of elements in all_results: 1773
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 757 had penalty fitness
[INFO] Total filtered from Hall of Fame: 757
[INFO] Hall of Fame -> all_results: 2530 -> 1773
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1773 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3108, Evaluation data length: 2841
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @TY
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 11.36 contracts
[INFO] Maximum Position Size: 20 contracts
[INFO] Strategy Total P&L: $57,875.00
[INFO] Market Buy & Hold P&L: $-4,734.38
[INFO] Outperformance: $62,609.38
[INFO] Sharpe ratio (entire period, annualized): 0.024770
[INFO] Sharpe ratio (in-sample, annualized): -0.449370
[INFO] Sharpe ratio (out-of-sample, annualized): 1.103275
[INFO] Maximum Drawdown: $319,453.12
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-236,453.12
[INFO] Out-of-sample P&L: $255,234.38
[INFO] 
Best parameters from GA: Short SMA = 56, Long SMA = 82, Sharpe = 1.031512
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2530
[INFO] Cache hits (repeated combinations): 6153
[INFO] Total checks: 8683
[INFO] Cache hit rate: 70.86%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1773 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] 
Best parameters:
[INFO] Short SMA: 56
[INFO] Long SMA: 82
[INFO] Sharpe Ratio: 1.031512
[INFO] Number of Trades: 22
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1773 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] Trades range: 10.0 to 164.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9453 to 2.8746
[INFO] Scaled Long SMA range: -2.0107 to 2.0734
[INFO] Scaled Sharpe ratio range: -3.2020 to 2.7926
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 19
[INFO] Using 19 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=19...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 79 elements
[INFO] Kmeans Cluster 1: 165 elements
[INFO] Kmeans Cluster 2: 91 elements
[INFO] Kmeans Cluster 3: 198 elements
[INFO] Kmeans Cluster 4: 89 elements
[INFO] Kmeans Cluster 5: 110 elements
[INFO] Kmeans Cluster 6: 66 elements
[INFO] Kmeans Cluster 7: 53 elements
[INFO] Kmeans Cluster 8: 103 elements
[INFO] Kmeans Cluster 9: 59 elements
[INFO] Kmeans Cluster 10: 106 elements
[INFO] Kmeans Cluster 11: 75 elements
[INFO] Kmeans Cluster 12: 115 elements
[INFO] Kmeans Cluster 13: 117 elements
[INFO] Kmeans Cluster 14: 114 elements
[INFO] Kmeans Cluster 15: 34 elements
[INFO] Kmeans Cluster 16: 28 elements
[INFO] Kmeans Cluster 17: 100 elements
[INFO] Kmeans Cluster 18: 71 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=22.86, Long SMA=270.25, Sharpe=0.2647
[INFO] Centroid 1: Short SMA=30.65, Long SMA=163.27, Sharpe=0.3916
[INFO] Centroid 2: Short SMA=208.75, Long SMA=235.69, Sharpe=-0.0963
[INFO] Centroid 3: Short SMA=34.20, Long SMA=79.91, Sharpe=0.5779
[INFO] Centroid 4: Short SMA=84.45, Long SMA=116.18, Sharpe=0.1842
[INFO] Centroid 5: Short SMA=272.44, Long SMA=284.87, Sharpe=-0.0842
[INFO] Centroid 6: Short SMA=140.73, Long SMA=181.00, Sharpe=0.2850
[INFO] Centroid 7: Short SMA=28.04, Long SMA=57.70, Sharpe=0.3793
[INFO] Centroid 8: Short SMA=87.79, Long SMA=147.81, Sharpe=0.0260
[INFO] Centroid 9: Short SMA=178.98, Long SMA=203.49, Sharpe=0.0183
[INFO] Centroid 10: Short SMA=22.47, Long SMA=119.12, Sharpe=0.5236
[INFO] Centroid 11: Short SMA=141.79, Long SMA=168.16, Sharpe=0.5017
[INFO] Centroid 12: Short SMA=43.52, Long SMA=84.11, Sharpe=0.7471
[INFO] Centroid 13: Short SMA=34.53, Long SMA=223.56, Sharpe=0.3783
[INFO] Centroid 14: Short SMA=61.21, Long SMA=101.11, Sharpe=0.3865
[INFO] Centroid 15: Short SMA=22.00, Long SMA=42.47, Sharpe=0.0966
[INFO] Centroid 16: Short SMA=230.36, Long SMA=251.43, Sharpe=-0.3251
[INFO] Centroid 17: Short SMA=59.52, Long SMA=168.58, Sharpe=0.2253
[INFO] Centroid 18: Short SMA=21.15, Long SMA=198.31, Sharpe=0.5149
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=56, Long SMA=82, Sharpe=1.0315, Trades=22
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=48, Long SMA=84, Sharpe=0.7369, Trades=18
[INFO] Kmeans Top 2: Short SMA=32, Long SMA=80, Sharpe=0.6094, Trades=21
[INFO] Kmeans Top 3: Short SMA=22, Long SMA=198, Sharpe=0.5821, Trades=15
[INFO] Kmeans Top 4: Short SMA=140, Long SMA=168, Sharpe=0.5791, Trades=18
[INFO] Kmeans Top 5: Short SMA=20, Long SMA=116, Sharpe=0.4430, Trades=17
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18}
[INFO]   Rounded: (23, 270)
[INFO]   Nearest: (22.0, 270.0)
[INFO]   Rounded: (31, 163)
[INFO]   Nearest: (30.0, 164.0)
[INFO]   Rounded: (209, 236)
[INFO]   Nearest: (208.0, 236.0)
[INFO]   Rounded: (34, 80)
[INFO]   Rounded: (84, 116)
[INFO]   Rounded: (272, 285)
[INFO]   Nearest: (272.0, 284.0)
[INFO]   Rounded: (141, 181)
[INFO]   Nearest: (140.0, 180.0)
[INFO]   Rounded: (28, 58)
[INFO]   Rounded: (88, 148)
[INFO]   Rounded: (179, 203)
[INFO]   Nearest: (178.0, 204.0)
[INFO]   Rounded: (22, 119)
[INFO]   Nearest: (22.0, 120.0)
[INFO]   Rounded: (142, 168)
[INFO]   Rounded: (44, 84)
[INFO]   Rounded: (35, 224)
[INFO]   Nearest: (34.0, 224.0)
[INFO]   Rounded: (61, 101)
[INFO]   Nearest: (62.0, 102.0)
[INFO]   Rounded: (22, 42)
[INFO]   Rounded: (230, 251)
[INFO]   Nearest: (230.0, 252.0)
[INFO]   Rounded: (60, 169)
[INFO]   Nearest: (60.0, 168.0)
[INFO]   Rounded: (21, 198)
[INFO]   Nearest: (22.0, 198.0)
[INFO] Successfully plotted 19 out of 19 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 56, Long SMA: 82
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(48/84) - Original Sharpe: 0.7369, Trades: 18
[INFO] Kmeans cluster 2: SMA(32/80) - Original Sharpe: 0.6094, Trades: 21
[INFO] Kmeans cluster 3: SMA(22/198) - Original Sharpe: 0.5821, Trades: 15
[INFO] Kmeans cluster 4: SMA(140/168) - Original Sharpe: 0.5791, Trades: 18
[INFO] Kmeans cluster 5: SMA(20/116) - Original Sharpe: 0.4430, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (56/82)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (48/84) - Sharpe: 0.7369
[INFO] cluster 2: (32/80) - Sharpe: 0.6094
[INFO] cluster 3: (22/198) - Sharpe: 0.5821
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.704271           -1.368819
1    2021-11-14 2021-11-14            43     0.838842            0.838842
2    2022-01-14 2022-01-14            41     1.984191            1.984191
3    2022-03-14 2022-03-14            44     4.120920            4.120920
4    2022-05-14 2022-05-14            43     0.411261            0.411261
5    2022-07-14 2022-07-14            44     0.308673           -1.368738
6    2022-09-14 2022-09-14            43    -1.526198            1.274544
7    2022-11-14 2022-11-14            43    -1.104580           -0.725118
8    2023-01-14 2023-01-14            41    -5.413014           -5.245675
9    2023-03-14 2023-03-14            44    -1.314612           -1.291551
10   2023-05-14 2023-05-14            44    -1.913035           -2.155956
11   2023-07-14 2023-07-14            44     3.093754            3.093754
12   2023-09-14 2023-09-14            43     2.065825            2.065825
13   2023-11-14 2023-11-14            42    -3.774049           -2.567103
14   2024-01-14 2024-01-14            43    -1.733531           -2.323376
15   2024-03-14 2024-03-14            42     0.586636            2.123587
16   2024-05-14 2024-05-14            44    -1.885239           -1.247066
17   2024-07-14 2024-07-14            45     3.577993            3.519069
18   2024-09-14 2024-09-14            43    -4.939107           -4.706847
19   2024-11-14 2024-11-14            33     1.144905            1.144905
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.7 |             -1.4 |          1.3 | True          
[INFO] 2021-11-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-01-14   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2022-03-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.3 |             -1.4 |         -1.7 | False         
[INFO] 2022-09-14   |         -1.5 |              1.3 |          2.8 | True          
[INFO] 2022-11-14   |         -1.1 |             -0.7 |          0.4 | True          
[INFO] 2023-01-14   |         -5.4 |             -5.2 |          0.2 | True          
[INFO] 2023-03-14   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |         -1.9 |             -2.2 |         -0.3 | False         
[INFO] 2023-07-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.8 |             -2.6 |          1.2 | True          
[INFO] 2024-01-14   |         -1.7 |             -2.3 |         -0.6 | False         
[INFO] 2024-03-14   |          0.6 |              2.1 |          1.5 | True          
[INFO] 2024-05-14   |         -1.9 |             -1.2 |          0.7 | True          
[INFO] 2024-07-14   |          3.6 |              3.5 |         -0.1 | False         
[INFO] 2024-09-14   |         -4.9 |             -4.7 |          0.2 | True          
[INFO] 2024-11-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-01-14, 2022-03-14, 2022-05-14, 2023-03-14, 2023-07-14, 2023-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 8 of 12 periods (66.67% win rate)
[INFO] Updating Excel file with Kmeans results for TY...
[INFO] Excel file updated successfully. Added TY with Kmeans win rate 66.7% in row 47
[INFO] Added best Sharpe parameters 56/82 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 56, Long SMA: 82
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(48/84) - Original Sharpe: 0.7369
[INFO] Added cluster 2 to portfolio: SMA(32/80) - Original Sharpe: 0.6094
[INFO] Added cluster 3 to portfolio: SMA(22/198) - Original Sharpe: 0.5821
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TY_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.0978
[INFO] Kmeans Best out-of-sample Sharpe: -0.4431
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for TY...
[INFO] Excel file updated successfully. Added TY with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TY
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 18.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1773 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] 
Best parameters:
[INFO] Short SMA: 56
[INFO] Long SMA: 82
[INFO] Sharpe Ratio: 1.031512
[INFO] Number of Trades: 22
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1773 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.5037 to 1.0315
[INFO] Trades range: 10.0 to 164.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9453 to 2.8746
[INFO] Scaled Long SMA range: -2.0107 to 2.0734
[INFO] Scaled Sharpe ratio range: -3.2020 to 2.7926
[INFO] Scaled Trades range: -0.7580 to 11.4172
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1773 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.7233
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 75 elements
[INFO] Cluster 1: 323 elements
[INFO] Cluster 2: 156 elements
[INFO] Cluster 3: 159 elements
[INFO] Cluster 4: 113 elements
[INFO] Cluster 5: 217 elements
[INFO] Cluster 6: 193 elements
[INFO] Cluster 7: 114 elements
[INFO] Cluster 8: 102 elements
[INFO] Cluster 9: 3 elements
[INFO] Cluster 10: 23 elements
[INFO] Cluster 11: 78 elements
[INFO] Cluster 12: 31 elements
[INFO] Cluster 13: 128 elements
[INFO] Cluster 14: 58 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=36, Long SMA=50, Sharpe=0.4211, Trades=53
[INFO] Cluster 1 cluster: Short SMA=32, Long SMA=88, Sharpe=0.6464, Trades=20
[INFO] Cluster 2 cluster: Short SMA=202, Long SMA=228, Sharpe=-0.2252, Trades=10
[INFO] Cluster 3 cluster: Short SMA=70, Long SMA=164, Sharpe=0.0262, Trades=12
[INFO] Cluster 4 cluster: Short SMA=90, Long SMA=118, Sharpe=0.1994, Trades=20
[INFO] Cluster 5 cluster: Short SMA=30, Long SMA=158, Sharpe=0.4373, Trades=15
[INFO] Cluster 6 cluster: Short SMA=32, Long SMA=214, Sharpe=0.4635, Trades=11
[INFO] Cluster 7 cluster: Short SMA=142, Long SMA=174, Sharpe=0.5171, Trades=16
[INFO] Cluster 8 cluster: Short SMA=274, Long SMA=288, Sharpe=0.0125, Trades=12
[INFO] Cluster 10 cluster: Short SMA=54, Long SMA=56, Sharpe=-0.0113, Trades=88
[INFO] Cluster 11 cluster: Short SMA=20, Long SMA=272, Sharpe=0.3380, Trades=14
[INFO] Cluster 12 cluster: Short SMA=226, Long SMA=230, Sharpe=-0.0072, Trades=28
[INFO] Cluster 13 cluster: Short SMA=54, Long SMA=106, Sharpe=0.4000, Trades=18
[INFO] Cluster 14 cluster: Short SMA=34, Long SMA=58, Sharpe=0.6190, Trades=37
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=56, Long SMA=82, Sharpe=1.0315, Trades=22
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=32, Long SMA=88, Sharpe=0.6464, Trades=20
[INFO] Top 2: Short SMA=34, Long SMA=58, Sharpe=0.6190, Trades=37
[INFO] Top 3: Short SMA=142, Long SMA=174, Sharpe=0.5171, Trades=16
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 1770 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 56, Long SMA: 82
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(32/88) - Original Sharpe: 0.6464, Trades: 20
[INFO] Hierarchical cluster 2: SMA(34/58) - Original Sharpe: 0.6190, Trades: 37
[INFO] Hierarchical cluster 3: SMA(142/174) - Original Sharpe: 0.5171, Trades: 16
[INFO] Hierarchical cluster 4: SMA(32/214) - Original Sharpe: 0.4635, Trades: 11
[INFO] Hierarchical cluster 5: SMA(30/158) - Original Sharpe: 0.4373, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (56/82)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (32/88) - Sharpe: 0.6464
[INFO] cluster 2: (34/58) - Sharpe: 0.6190
[INFO] cluster 3: (142/174) - Sharpe: 0.5171
[INFO] Loading TY data from local files...
[INFO] Found data file: A_OHLCV_@TY_minutes_1440_1703-1557.dat
[INFO] File size: 293817 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -2.704271            1.676336
1    2021-11-14 2021-11-14            43     0.838842           -2.696211
2    2022-01-14 2022-01-14            41     1.984191            0.892270
3    2022-03-14 2022-03-14            44     4.120920            4.120920
4    2022-05-14 2022-05-14            43     0.411261            0.411261
5    2022-07-14 2022-07-14            44     0.308673           -2.333851
6    2022-09-14 2022-09-14            43    -1.526198            1.692498
7    2022-11-14 2022-11-14            43    -1.104580           -1.527284
8    2023-01-14 2023-01-14            41    -5.413014           -5.256161
9    2023-03-14 2023-03-14            44    -1.314612           -0.673944
10   2023-05-14 2023-05-14            44    -1.913035           -4.714524
11   2023-07-14 2023-07-14            44     3.093754            3.093754
12   2023-09-14 2023-09-14            43     2.065825            2.065825
13   2023-11-14 2023-11-14            42    -3.774049           -2.417564
14   2024-01-14 2024-01-14            43    -1.733531           -1.969086
15   2024-03-14 2024-03-14            42     0.586636            2.893123
16   2024-05-14 2024-05-14            44    -1.885239           -0.011161
17   2024-07-14 2024-07-14            45     3.577993            3.577993
18   2024-09-14 2024-09-14            43    -4.939107           -4.079205
19   2024-11-14 2024-11-14            33     1.144905            1.144905
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.7 |              1.7 |          4.4 | True          
[INFO] 2021-11-14   |          0.8 |             -2.7 |         -3.5 | False         
[INFO] 2022-01-14   |          2.0 |              0.9 |         -1.1 | False         
[INFO] 2022-03-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-07-14   |          0.3 |             -2.3 |         -2.6 | False         
[INFO] 2022-09-14   |         -1.5 |              1.7 |          3.2 | True          
[INFO] 2022-11-14   |         -1.1 |             -1.5 |         -0.4 | False         
[INFO] 2023-01-14   |         -5.4 |             -5.3 |          0.1 | True          
[INFO] 2023-03-14   |         -1.3 |             -0.7 |          0.6 | True          
[INFO] 2023-05-14   |         -1.9 |             -4.7 |         -2.8 | False         
[INFO] 2023-07-14   |          3.1 |              3.1 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.1 |              2.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.8 |             -2.4 |          1.4 | True          
[INFO] 2024-01-14   |         -1.7 |             -2.0 |         -0.3 | False         
[INFO] 2024-03-14   |          0.6 |              2.9 |          2.3 | True          
[INFO] 2024-05-14   |         -1.9 |             -0.0 |          1.9 | True          
[INFO] 2024-07-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2024-09-14   |         -4.9 |             -4.1 |          0.8 | True          
[INFO] 2024-11-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14, 2024-07-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 14 periods (57.14% win rate)
[INFO] Updating Excel file with Hierarchical results for TY...
[INFO] Excel file updated successfully. Added TY with Hierarchical win rate 57.1% in row 47
[INFO] Added best Sharpe parameters 56/82 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 56, Long SMA: 82
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(32/88) - Original Sharpe: 0.6464
[INFO] Added cluster 2 to portfolio: SMA(34/58) - Original Sharpe: 0.6190
[INFO] Added cluster 3 to portfolio: SMA(142/174) - Original Sharpe: 0.5171
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TY_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1502
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4431
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for TY...
[INFO] Excel file updated successfully. Added TY with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TY
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for TU in column D: 10.0
[INFO] Using slippage from Excel column D: 10.0
[INFO] 
Symbol: @TU
[INFO] Description: 2 Year U.S. Treasury Notes Continuous Contract [Jun25]
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 7.8125
[INFO] Big point value: 2000.0
[INFO] Data shape: (6091, 6)
[INFO] Date range: 2001-05-07 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime       open       high        low      close  volume
0 2001-05-07 15:57:00  87.867188  87.976562  87.867188  87.976562    11.0
1 2001-05-09 15:57:00  87.945312  88.007812  87.937500  87.968750   240.0
2 2001-05-10 15:57:00  88.062500  88.062500  87.812500  87.812500  1234.0
3 2001-05-11 15:57:00  87.867188  87.906250  87.828125  87.828125   241.0
4 2001-05-14 15:57:00  87.484375  87.531250  87.468750  87.531250    64.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 16.14 seconds (0.27 minutes)
[INFO] Best parameters found: Short SMA = 274, Long SMA = 284
[INFO] Best fitness (Sharpe ratio): 0.774149
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 274, Long SMA = 284, Sharpe = 0.774149
[INFO] Top 2: Short SMA = 272, Long SMA = 288, Sharpe = 0.749716
[INFO] Top 3: Short SMA = 274, Long SMA = 282, Sharpe = 0.731433
[INFO] Top 4: Short SMA = 272, Long SMA = 284, Sharpe = 0.731390
[INFO] Top 5: Short SMA = 276, Long SMA = 278, Sharpe = 0.728317
[INFO] Hall of Fame size: 1768
[INFO] Number of elements in all_results: 908
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 860 had penalty fitness
[INFO] Total filtered from Hall of Fame: 860
[INFO] Hall of Fame -> all_results: 1768 -> 908
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 908 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3108, Evaluation data length: 2841
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @TU
[INFO] Big Point Value (from data): 2000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 36.04 contracts
[INFO] Maximum Position Size: 152 contracts
[INFO] Strategy Total P&L: $207,578.12
[INFO] Market Buy & Hold P&L: $-12,695.31
[INFO] Outperformance: $220,273.44
[INFO] Sharpe ratio (entire period, annualized): 0.257695
[INFO] Sharpe ratio (in-sample, annualized): -0.289956
[INFO] Sharpe ratio (out-of-sample, annualized): 1.406827
[INFO] Maximum Drawdown: $257,929.69
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-150,523.44
[INFO] Out-of-sample P&L: $348,632.81
[INFO] 
Best parameters from GA: Short SMA = 274, Long SMA = 284, Sharpe = 0.774149
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 1768
[INFO] Cache hits (repeated combinations): 6845
[INFO] Total checks: 8613
[INFO] Cache hit rate: 79.47%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 2000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 908 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.7458 to 0.7741
[INFO] 
Best parameters:
[INFO] Short SMA: 274
[INFO] Long SMA: 284
[INFO] Sharpe Ratio: 0.774149
[INFO] Number of Trades: 16
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 908 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.7458 to 0.7741
[INFO] Trades range: 10.0 to 150.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3529 to 1.5655
[INFO] Scaled Long SMA range: -2.5956 to 1.2641
[INFO] Scaled Sharpe ratio range: -4.4227 to 2.4204
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 22
[INFO] Using 22 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=22...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 52 elements
[INFO] Kmeans Cluster 1: 81 elements
[INFO] Kmeans Cluster 2: 46 elements
[INFO] Kmeans Cluster 3: 16 elements
[INFO] Kmeans Cluster 4: 44 elements
[INFO] Kmeans Cluster 5: 30 elements
[INFO] Kmeans Cluster 6: 31 elements
[INFO] Kmeans Cluster 7: 14 elements
[INFO] Kmeans Cluster 8: 44 elements
[INFO] Kmeans Cluster 9: 57 elements
[INFO] Kmeans Cluster 10: 50 elements
[INFO] Kmeans Cluster 11: 45 elements
[INFO] Kmeans Cluster 12: 42 elements
[INFO] Kmeans Cluster 13: 43 elements
[INFO] Kmeans Cluster 14: 75 elements
[INFO] Kmeans Cluster 15: 23 elements
[INFO] Kmeans Cluster 16: 52 elements
[INFO] Kmeans Cluster 17: 15 elements
[INFO] Kmeans Cluster 18: 41 elements
[INFO] Kmeans Cluster 19: 22 elements
[INFO] Kmeans Cluster 20: 55 elements
[INFO] Kmeans Cluster 21: 30 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=127.62, Long SMA=176.23, Sharpe=0.1734
[INFO] Centroid 1: Short SMA=257.43, Long SMA=278.99, Sharpe=0.3618
[INFO] Centroid 2: Short SMA=28.30, Long SMA=163.52, Sharpe=0.2071
[INFO] Centroid 4: Short SMA=274.09, Long SMA=283.27, Sharpe=0.6443
[INFO] Centroid 5: Short SMA=30.20, Long SMA=290.73, Sharpe=0.1879
[INFO] Centroid 6: Short SMA=34.90, Long SMA=103.35, Sharpe=0.0908
[INFO] Centroid 8: Short SMA=28.95, Long SMA=217.18, Sharpe=0.2965
[INFO] Centroid 9: Short SMA=209.54, Long SMA=231.58, Sharpe=0.4370
[INFO] Centroid 10: Short SMA=100.72, Long SMA=145.20, Sharpe=0.0300
[INFO] Centroid 11: Short SMA=284.04, Long SMA=296.80, Sharpe=0.2326
[INFO] Centroid 12: Short SMA=60.48, Long SMA=115.33, Sharpe=0.2313
[INFO] Centroid 13: Short SMA=23.35, Long SMA=279.72, Sharpe=0.3171
[INFO] Centroid 14: Short SMA=263.95, Long SMA=284.67, Sharpe=0.4587
[INFO] Centroid 15: Short SMA=145.39, Long SMA=166.43, Sharpe=0.4045
[INFO] Centroid 16: Short SMA=71.38, Long SMA=182.85, Sharpe=0.0562
[INFO] Centroid 18: Short SMA=239.22, Long SMA=254.00, Sharpe=0.2281
[INFO] Centroid 19: Short SMA=26.82, Long SMA=60.36, Sharpe=-0.2888
[INFO] Centroid 20: Short SMA=185.20, Long SMA=211.49, Sharpe=0.2567
[INFO] Centroid 21: Short SMA=66.27, Long SMA=100.20, Sharpe=-0.1286
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=16
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=16
[INFO] Kmeans Top 2: Short SMA=264, Long SMA=286, Sharpe=0.5099, Trades=12
[INFO] Kmeans Top 3: Short SMA=214, Long SMA=234, Sharpe=0.4585, Trades=16
[INFO] Kmeans Top 4: Short SMA=150, Long SMA=168, Sharpe=0.4001, Trades=23
[INFO] Kmeans Top 5: Short SMA=258, Long SMA=280, Sharpe=0.3379, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 4, 5, 6, 8, 9, 10, 11, 12, 13, 14, 15, 16, 18, 19, 20, 21}
[INFO]   Rounded: (128, 176)
[INFO]   Rounded: (257, 279)
[INFO]   Nearest: (258.0, 278.0)
[INFO]   Rounded: (28, 164)
[INFO]   Rounded: (274, 283)
[INFO]   Nearest: (274.0, 284.0)
[INFO]   Rounded: (30, 291)
[INFO]   Nearest: (30.0, 290.0)
[INFO]   Rounded: (35, 103)
[INFO]   Nearest: (34.0, 104.0)
[INFO]   Rounded: (29, 217)
[INFO]   Nearest: (28.0, 218.0)
[INFO]   Rounded: (210, 232)
[INFO]   Rounded: (101, 145)
[INFO]   Nearest: (100.0, 146.0)
[INFO]   Rounded: (284, 297)
[INFO]   Nearest: (284.0, 296.0)
[INFO]   Rounded: (60, 115)
[INFO]   Nearest: (60.0, 116.0)
[INFO]   Rounded: (23, 280)
[INFO]   Nearest: (24.0, 280.0)
[INFO]   Rounded: (264, 285)
[INFO]   Nearest: (264.0, 284.0)
[INFO]   Rounded: (145, 166)
[INFO]   Nearest: (146.0, 166.0)
[INFO]   Rounded: (71, 183)
[INFO]   Nearest: (72.0, 182.0)
[INFO]   Rounded: (239, 254)
[INFO]   Nearest: (240.0, 254.0)
[INFO]   Rounded: (27, 60)
[INFO]   Nearest: (26.0, 60.0)
[INFO]   Rounded: (185, 211)
[INFO]   Nearest: (186.0, 212.0)
[INFO]   Rounded: (66, 100)
[INFO] Successfully plotted 19 out of 19 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 274, Long SMA: 284
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(274/284) - Original Sharpe: 0.7741, Trades: 16
[INFO] Kmeans cluster 2: SMA(264/286) - Original Sharpe: 0.5099, Trades: 12
[INFO] Kmeans cluster 3: SMA(214/234) - Original Sharpe: 0.4585, Trades: 16
[INFO] Kmeans cluster 4: SMA(150/168) - Original Sharpe: 0.4001, Trades: 23
[INFO] Kmeans cluster 5: SMA(258/280) - Original Sharpe: 0.3379, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (274/284)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (274/284) - Sharpe: 0.7741
[INFO] cluster 2: (264/286) - Sharpe: 0.5099
[INFO] cluster 3: (214/234) - Sharpe: 0.4585
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     5.346901            4.093967
1    2021-11-14 2021-11-14            43     1.829328            1.829328
2    2022-01-14 2022-01-14            41     4.222575            4.222575
3    2022-03-14 2022-03-14            44     3.242182            3.242182
4    2022-05-14 2022-05-14            43     1.473801            1.473801
5    2022-07-14 2022-07-14            44     2.919931            2.919931
6    2022-09-14 2022-09-14            43     2.385425            2.385425
7    2022-11-14 2022-11-14            43    -0.436907           -0.436907
8    2023-01-14 2023-01-14            41    -0.202608           -0.202608
9    2023-03-14 2023-03-14            44     0.324596            0.324596
10   2023-05-14 2023-05-14            44     3.890567            3.890567
11   2023-07-14 2023-07-14            44     3.021284            3.021284
12   2023-09-14 2023-09-14            43     1.135707            1.135707
13   2023-11-14 2023-11-14            42    -3.433823           -3.433823
14   2024-01-14 2024-01-14            43     3.467114            3.467114
15   2024-03-14 2024-03-14            42     2.327772            2.327772
16   2024-05-14 2024-05-14            44    -2.234806           -2.234806
17   2024-07-14 2024-07-14            45    -3.677302           -4.119138
18   2024-09-14 2024-09-14            43     0.511850            0.481404
19   2024-11-14 2024-11-14            33    -2.294343            0.475568
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          5.3 |              4.1 |         -1.2 | False         
[INFO] 2021-11-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2022-01-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.2 |              3.2 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2023-07-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.4 |             -3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -3.7 |             -4.1 |         -0.4 | False         
[INFO] 2024-09-14   |          0.5 |              0.5 |          0.0 | Excluded      
[INFO] 2024-11-14   |         -2.3 |              0.5 |          2.8 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 3
[INFO] Kmeans cluster wins (rounded comparison): 1 of 3 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for TU...
[INFO] Excel file updated successfully. Added TU with Kmeans win rate 33.3% in row 48
[INFO] Added best Sharpe parameters 274/284 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 274, Long SMA: 284
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(274/284) - Original Sharpe: 0.7741
[INFO] Added cluster 2 to portfolio: SMA(264/286) - Original Sharpe: 0.5099
[INFO] Added cluster 3 to portfolio: SMA(214/234) - Original Sharpe: 0.4585
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TU_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 1.1939
[INFO] Kmeans Best out-of-sample Sharpe: 1.1058
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for TU...
[INFO] Excel file updated successfully. Added TU with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TU
[INFO] Big Point Value: 2000.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 908 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.7458 to 0.7741
[INFO] 
Best parameters:
[INFO] Short SMA: 274
[INFO] Long SMA: 284
[INFO] Sharpe Ratio: 0.774149
[INFO] Number of Trades: 16
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 908 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.7458 to 0.7741
[INFO] Trades range: 10.0 to 150.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3529 to 1.5655
[INFO] Scaled Long SMA range: -2.5956 to 1.2641
[INFO] Scaled Sharpe ratio range: -4.4227 to 2.4204
[INFO] Scaled Trades range: -0.6392 to 8.4092
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 908
[INFO] Cophenetic correlation: 0.5820
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 19
[INFO] Using 19 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 19 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 31 elements
[INFO] Cluster 1: 31 elements
[INFO] Cluster 2: 57 elements
[INFO] Cluster 3: 75 elements
[INFO] Cluster 4: 92 elements
[INFO] Cluster 5: 27 elements
[INFO] Cluster 6: 6 elements
[INFO] Cluster 7: 15 elements
[INFO] Cluster 8: 23 elements
[INFO] Cluster 9: 12 elements
[INFO] Cluster 10: 92 elements
[INFO] Cluster 11: 28 elements
[INFO] Cluster 12: 46 elements
[INFO] Cluster 13: 115 elements
[INFO] Cluster 14: 45 elements
[INFO] Cluster 15: 52 elements
[INFO] Cluster 16: 28 elements
[INFO] Cluster 17: 68 elements
[INFO] Cluster 18: 65 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=26, Long SMA=46, Sharpe=-0.4963, Trades=55
[INFO] Cluster 1 cluster: Short SMA=60, Long SMA=74, Sharpe=0.2949, Trades=43
[INFO] Cluster 2 cluster: Short SMA=98, Long SMA=140, Sharpe=0.0906, Trades=13
[INFO] Cluster 3 cluster: Short SMA=278, Long SMA=294, Sharpe=0.3216, Trades=14
[INFO] Cluster 4 cluster: Short SMA=196, Long SMA=224, Sharpe=0.3052, Trades=14
[INFO] Cluster 5 cluster: Short SMA=276, Long SMA=280, Sharpe=0.6194, Trades=30
[INFO] Cluster 8 cluster: Short SMA=150, Long SMA=168, Sharpe=0.4001, Trades=23
[INFO] Cluster 10 cluster: Short SMA=44, Long SMA=144, Sharpe=0.1515, Trades=11
[INFO] Cluster 11 cluster: Short SMA=218, Long SMA=222, Sharpe=0.3238, Trades=44
[INFO] Cluster 12 cluster: Short SMA=136, Long SMA=172, Sharpe=0.2038, Trades=15
[INFO] Cluster 13 cluster: Short SMA=260, Long SMA=282, Sharpe=0.4584, Trades=12
[INFO] Cluster 14 cluster: Short SMA=30, Long SMA=218, Sharpe=0.2045, Trades=15
[INFO] Cluster 15 cluster: Short SMA=272, Long SMA=286, Sharpe=0.6628, Trades=14
[INFO] Cluster 16 cluster: Short SMA=28, Long SMA=104, Sharpe=0.0241, Trades=24
[INFO] Cluster 17 cluster: Short SMA=24, Long SMA=286, Sharpe=0.1585, Trades=10
[INFO] Cluster 18 cluster: Short SMA=76, Long SMA=180, Sharpe=0.0960, Trades=11
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=274, Long SMA=284, Sharpe=0.7741, Trades=16
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=272, Long SMA=286, Sharpe=0.6628, Trades=14
[INFO] Top 2: Short SMA=276, Long SMA=280, Sharpe=0.6194, Trades=30
[INFO] Top 3: Short SMA=260, Long SMA=282, Sharpe=0.4584, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 875 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 274, Long SMA: 284
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(272/286) - Original Sharpe: 0.6628, Trades: 14
[INFO] Hierarchical cluster 2: SMA(276/280) - Original Sharpe: 0.6194, Trades: 30
[INFO] Hierarchical cluster 3: SMA(260/282) - Original Sharpe: 0.4584, Trades: 12
[INFO] Hierarchical cluster 4: SMA(150/168) - Original Sharpe: 0.4001, Trades: 23
[INFO] Hierarchical cluster 5: SMA(218/222) - Original Sharpe: 0.3238, Trades: 44
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (274/284)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (272/286) - Sharpe: 0.6628
[INFO] cluster 2: (276/280) - Sharpe: 0.6194
[INFO] cluster 3: (260/282) - Sharpe: 0.4584
[INFO] Loading TU data from local files...
[INFO] Found data file: A_OHLCV_@TU_minutes_1440_1703-1557.dat
[INFO] File size: 292522 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     5.346901            5.346901
1    2021-11-14 2021-11-14            43     1.829328            1.829328
2    2022-01-14 2022-01-14            41     4.222575            4.222575
3    2022-03-14 2022-03-14            44     3.242182            3.242182
4    2022-05-14 2022-05-14            43     1.473801            1.473801
5    2022-07-14 2022-07-14            44     2.919931            2.919931
6    2022-09-14 2022-09-14            43     2.385425            2.385425
7    2022-11-14 2022-11-14            43    -0.436907           -0.436907
8    2023-01-14 2023-01-14            41    -0.202608           -0.202608
9    2023-03-14 2023-03-14            44     0.324596            0.324596
10   2023-05-14 2023-05-14            44     3.890567            3.890567
11   2023-07-14 2023-07-14            44     3.021284            3.021284
12   2023-09-14 2023-09-14            43     1.135707            1.135707
13   2023-11-14 2023-11-14            42    -3.433823           -3.433823
14   2024-01-14 2024-01-14            43     3.467114            3.467114
15   2024-03-14 2024-03-14            42     2.327772            2.327772
16   2024-05-14 2024-05-14            44    -2.234806           -2.234806
17   2024-07-14 2024-07-14            45    -3.677302           -3.677302
18   2024-09-14 2024-09-14            43     0.511850           -1.486117
19   2024-11-14 2024-11-14            33    -2.294343           -0.179758
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          5.3 |              5.3 |          0.0 | Excluded      
[INFO] 2021-11-14   |          1.8 |              1.8 |          0.0 | Excluded      
[INFO] 2022-01-14   |          4.2 |              4.2 |          0.0 | Excluded      
[INFO] 2022-03-14   |          3.2 |              3.2 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2022-09-14   |          2.4 |              2.4 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.4 |             -0.4 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2023-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2023-05-14   |          3.9 |              3.9 |          0.0 | Excluded      
[INFO] 2023-07-14   |          3.0 |              3.0 |          0.0 | Excluded      
[INFO] 2023-09-14   |          1.1 |              1.1 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.4 |             -3.4 |          0.0 | Excluded      
[INFO] 2024-01-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2024-03-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -2.2 |             -2.2 |          0.0 | Excluded      
[INFO] 2024-07-14   |         -3.7 |             -3.7 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.5 |             -1.5 |         -2.0 | False         
[INFO] 2024-11-14   |         -2.3 |             -0.2 |          2.1 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-03-14, 2023-05-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-01-14, 2024-03-14, 2024-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 2
[INFO] Hierarchical cluster wins (rounded comparison): 1 of 2 periods (50.00% win rate)
[INFO] Updating Excel file with Hierarchical results for TU...
[INFO] Excel file updated successfully. Added TU with Hierarchical win rate 50.0% in row 48
[INFO] Added best Sharpe parameters 274/284 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 274, Long SMA: 284
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(272/286) - Original Sharpe: 0.6628
[INFO] Added cluster 2 to portfolio: SMA(276/280) - Original Sharpe: 0.6194
[INFO] Added cluster 3 to portfolio: SMA(260/282) - Original Sharpe: 0.4584
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'TU_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 1.1074
[INFO] Hierarchical Best out-of-sample Sharpe: 1.1058
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for TU...
[INFO] Excel file updated successfully. Added TU with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\TU
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for UB in column D: 34.0
[INFO] Using slippage from Excel column D: 34.0
[INFO] 
Symbol: @UB=117XC
[INFO] Description: Ultra T-Bond Custom Continuous Contract
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 31.25
[INFO] Big point value: 1000.0
[INFO] Data shape: (3934, 6)
[INFO] Date range: 2010-01-11 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime      open       high       low      close  volume
0 2010-01-11 15:57:00  97.34375   97.75000  96.78125   97.18750  2943.0
1 2010-01-12 15:57:00  98.34375   99.31250  98.12500   99.28125  5858.0
2 2010-01-13 15:57:00  98.96875   99.09375  97.43750   97.43750  3660.0
3 2010-01-14 15:57:00  97.62500   99.62500  97.62500   99.09375  6679.0
4 2010-01-15 15:57:00  99.31250  100.50000  99.31250  100.06250  4259.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 31.20 seconds (0.52 minutes)
[INFO] Best parameters found: Short SMA = 68, Long SMA = 72
[INFO] Best fitness (Sharpe ratio): 0.920294
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 68, Long SMA = 72, Sharpe = 0.920294
[INFO] Top 2: Short SMA = 70, Long SMA = 72, Sharpe = 0.887514
[INFO] Top 3: Short SMA = 52, Long SMA = 70, Sharpe = 0.872458
[INFO] Top 4: Short SMA = 68, Long SMA = 94, Sharpe = 0.869518
[INFO] Top 5: Short SMA = 74, Long SMA = 76, Sharpe = 0.867244
[INFO] Hall of Fame size: 2428
[INFO] Number of elements in all_results: 1890
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 538 had penalty fitness
[INFO] Total filtered from Hall of Fame: 538
[INFO] Hall of Fame -> all_results: 2428 -> 1890
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1890 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3108, Evaluation data length: 2841
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @UB=117XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.63 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $-19,812.50
[INFO] Market Buy & Hold P&L: $-15,562.50
[INFO] Outperformance: $-4,250.00
[INFO] Sharpe ratio (entire period, annualized): -0.081422
[INFO] Sharpe ratio (in-sample, annualized): -0.549758
[INFO] Sharpe ratio (out-of-sample, annualized): 1.021615
[INFO] Maximum Drawdown: $406,031.25
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-326,031.25
[INFO] Out-of-sample P&L: $257,187.50
[INFO] 
Best parameters from GA: Short SMA = 68, Long SMA = 72, Sharpe = 0.920294
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2428
[INFO] Cache hits (repeated combinations): 6167
[INFO] Total checks: 8595
[INFO] Cache hit rate: 71.75%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1890 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.5324 to 0.9203
[INFO] 
Best parameters:
[INFO] Short SMA: 68
[INFO] Long SMA: 72
[INFO] Sharpe Ratio: 0.920294
[INFO] Number of Trades: 60
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1890 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.5324 to 0.9203
[INFO] Trades range: 10.0 to 202.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9830 to 2.7251
[INFO] Scaled Long SMA range: -1.9748 to 1.7514
[INFO] Scaled Sharpe ratio range: -2.4070 to 2.0520
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 120 elements
[INFO] Kmeans Cluster 1: 138 elements
[INFO] Kmeans Cluster 2: 165 elements
[INFO] Kmeans Cluster 3: 78 elements
[INFO] Kmeans Cluster 4: 121 elements
[INFO] Kmeans Cluster 5: 161 elements
[INFO] Kmeans Cluster 6: 102 elements
[INFO] Kmeans Cluster 7: 155 elements
[INFO] Kmeans Cluster 8: 54 elements
[INFO] Kmeans Cluster 9: 142 elements
[INFO] Kmeans Cluster 10: 89 elements
[INFO] Kmeans Cluster 11: 131 elements
[INFO] Kmeans Cluster 12: 126 elements
[INFO] Kmeans Cluster 13: 162 elements
[INFO] Kmeans Cluster 14: 113 elements
[INFO] Kmeans Cluster 15: 33 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=27.74, Long SMA=61.06, Sharpe=0.5357
[INFO] Centroid 1: Short SMA=268.26, Long SMA=283.70, Sharpe=-0.2328
[INFO] Centroid 2: Short SMA=72.39, Long SMA=184.62, Sharpe=0.1392
[INFO] Centroid 3: Short SMA=149.79, Long SMA=177.90, Sharpe=0.2437
[INFO] Centroid 4: Short SMA=44.63, Long SMA=286.99, Sharpe=-0.0645
[INFO] Centroid 5: Short SMA=57.38, Long SMA=83.08, Sharpe=0.7228
[INFO] Centroid 6: Short SMA=70.86, Long SMA=123.88, Sharpe=0.2499
[INFO] Centroid 7: Short SMA=29.91, Long SMA=148.53, Sharpe=0.4409
[INFO] Centroid 8: Short SMA=22.67, Long SMA=256.30, Sharpe=0.1973
[INFO] Centroid 9: Short SMA=57.04, Long SMA=100.41, Sharpe=0.5250
[INFO] Centroid 10: Short SMA=194.13, Long SMA=220.90, Sharpe=-0.0579
[INFO] Centroid 11: Short SMA=212.67, Long SMA=265.05, Sharpe=-0.2948
[INFO] Centroid 12: Short SMA=23.39, Long SMA=198.68, Sharpe=0.3901
[INFO] Centroid 13: Short SMA=22.35, Long SMA=95.59, Sharpe=0.6336
[INFO] Centroid 14: Short SMA=98.57, Long SMA=140.74, Sharpe=-0.0043
[INFO] Centroid 15: Short SMA=18.61, Long SMA=34.61, Sharpe=0.2145
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=68, Long SMA=72, Sharpe=0.9203, Trades=60
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=58, Long SMA=84, Sharpe=0.7996, Trades=26
[INFO] Kmeans Top 2: Short SMA=28, Long SMA=150, Sharpe=0.6437, Trades=15
[INFO] Kmeans Top 3: Short SMA=50, Long SMA=104, Sharpe=0.6407, Trades=20
[INFO] Kmeans Top 4: Short SMA=22, Long SMA=98, Sharpe=0.5998, Trades=23
[INFO] Kmeans Top 5: Short SMA=26, Long SMA=60, Sharpe=0.5643, Trades=30
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (28, 61)
[INFO]   Nearest: (28.0, 62.0)
[INFO]   Rounded: (268, 284)
[INFO]   Rounded: (72, 185)
[INFO]   Nearest: (72.0, 184.0)
[INFO]   Rounded: (150, 178)
[INFO]   Rounded: (45, 287)
[INFO]   Nearest: (44.0, 286.0)
[INFO]   Rounded: (57, 83)
[INFO]   Nearest: (58.0, 84.0)
[INFO]   Rounded: (71, 124)
[INFO]   Nearest: (70.0, 124.0)
[INFO]   Rounded: (30, 149)
[INFO]   Nearest: (30.0, 148.0)
[INFO]   Rounded: (23, 256)
[INFO]   Nearest: (22.0, 256.0)
[INFO]   Rounded: (57, 100)
[INFO]   Nearest: (58.0, 100.0)
[INFO]   Rounded: (194, 221)
[INFO]   Nearest: (194.0, 220.0)
[INFO]   Rounded: (213, 265)
[INFO]   Nearest: (212.0, 266.0)
[INFO]   Rounded: (23, 199)
[INFO]   Nearest: (24.0, 198.0)
[INFO]   Rounded: (22, 96)
[INFO]   Rounded: (99, 141)
[INFO]   Nearest: (98.0, 140.0)
[INFO]   Rounded: (19, 35)
[INFO]   Nearest: (18.0, 34.0)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 68, Long SMA: 72
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(58/84) - Original Sharpe: 0.7996, Trades: 26
[INFO] Kmeans cluster 2: SMA(28/150) - Original Sharpe: 0.6437, Trades: 15
[INFO] Kmeans cluster 3: SMA(50/104) - Original Sharpe: 0.6407, Trades: 20
[INFO] Kmeans cluster 4: SMA(22/98) - Original Sharpe: 0.5998, Trades: 23
[INFO] Kmeans cluster 5: SMA(26/60) - Original Sharpe: 0.5643, Trades: 30
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (68/72)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (58/84) - Sharpe: 0.7996
[INFO] cluster 2: (28/150) - Sharpe: 0.6437
[INFO] cluster 3: (50/104) - Sharpe: 0.6407
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -3.091780           -0.939667
1    2021-11-14 2021-11-14            43     0.686256           -2.062789
2    2022-01-14 2022-01-14            41     0.272481            0.587782
3    2022-03-14 2022-03-14            44     4.626773            4.626773
4    2022-05-14 2022-05-14            43     0.064197            0.064197
5    2022-07-14 2022-07-14            44     2.941542            2.151092
6    2022-09-14 2022-09-14            43    -0.010015            2.628638
7    2022-11-14 2022-11-14            43    -2.397546           -2.397546
8    2023-01-14 2023-01-14            41    -0.385884           -1.548500
9    2023-03-14 2023-03-14            44    -1.129434            1.689057
10   2023-05-14 2023-05-14            44     2.665246           -1.159496
11   2023-07-14 2023-07-14            44     3.431170            3.431170
12   2023-09-14 2023-09-14            43     2.602377            2.602377
13   2023-11-14 2023-11-14            42    -4.835599           -5.456467
14   2024-01-14 2024-01-14            43    -1.084920           -1.084920
15   2024-03-14 2024-03-14            42     0.678303           -0.616098
16   2024-05-14 2024-05-14            44    -1.255123           -1.255123
17   2024-07-14 2024-07-14            45     2.338417            1.922915
18   2024-09-14 2024-09-14            43    -3.189272           -3.710823
19   2024-11-14 2024-11-14            33     1.699993            1.699993
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -3.1 |             -0.9 |          2.2 | True          
[INFO] 2021-11-14   |          0.7 |             -2.1 |         -2.8 | False         
[INFO] 2022-01-14   |          0.3 |              0.6 |          0.3 | True          
[INFO] 2022-03-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.9 |              2.2 |         -0.7 | False         
[INFO] 2022-09-14   |         -0.0 |              2.6 |          2.6 | True          
[INFO] 2022-11-14   |         -2.4 |             -2.4 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -0.4 |             -1.5 |         -1.1 | False         
[INFO] 2023-03-14   |         -1.1 |              1.7 |          2.8 | True          
[INFO] 2023-05-14   |          2.7 |             -1.2 |         -3.9 | False         
[INFO] 2023-07-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -4.8 |             -5.5 |         -0.7 | False         
[INFO] 2024-01-14   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 2024-03-14   |          0.7 |             -0.6 |         -1.3 | False         
[INFO] 2024-05-14   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2024-07-14   |          2.3 |              1.9 |         -0.4 | False         
[INFO] 2024-09-14   |         -3.2 |             -3.7 |         -0.5 | False         
[INFO] 2024-11-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2022-11-14, 2023-07-14, 2023-09-14, 2024-01-14, 2024-05-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 4 of 12 periods (33.33% win rate)
[INFO] Updating Excel file with Kmeans results for UB...
[INFO] Excel file updated successfully. Added UB with Kmeans win rate 33.3% in row 49
[INFO] Added best Sharpe parameters 68/72 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 68, Long SMA: 72
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(58/84) - Original Sharpe: 0.7996
[INFO] Added cluster 2 to portfolio: SMA(28/150) - Original Sharpe: 0.6437
[INFO] Added cluster 3 to portfolio: SMA(50/104) - Original Sharpe: 0.6407
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'UB_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1405
[INFO] Kmeans Best out-of-sample Sharpe: 0.1516
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for UB...
[INFO] Excel file updated successfully. Added UB with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\UB
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1890 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.5324 to 0.9203
[INFO] 
Best parameters:
[INFO] Short SMA: 68
[INFO] Long SMA: 72
[INFO] Sharpe Ratio: 0.920294
[INFO] Number of Trades: 60
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1890 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.5324 to 0.9203
[INFO] Trades range: 10.0 to 202.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9830 to 2.7251
[INFO] Scaled Long SMA range: -1.9748 to 1.7514
[INFO] Scaled Sharpe ratio range: -2.4070 to 2.0520
[INFO] Scaled Trades range: -0.7620 to 12.5730
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1890 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5934
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 414 elements
[INFO] Cluster 1: 219 elements
[INFO] Cluster 2: 142 elements
[INFO] Cluster 3: 247 elements
[INFO] Cluster 4: 77 elements
[INFO] Cluster 5: 70 elements
[INFO] Cluster 6: 113 elements
[INFO] Cluster 7: 44 elements
[INFO] Cluster 8: 202 elements
[INFO] Cluster 9: 3 elements
[INFO] Cluster 10: 82 elements
[INFO] Cluster 11: 135 elements
[INFO] Cluster 12: 16 elements
[INFO] Cluster 13: 48 elements
[INFO] Cluster 14: 78 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=38, Long SMA=94, Sharpe=0.6750, Trades=23
[INFO] Cluster 1 cluster: Short SMA=234, Long SMA=274, Sharpe=-0.2709, Trades=14
[INFO] Cluster 2 cluster: Short SMA=40, Long SMA=62, Sharpe=0.7207, Trades=35
[INFO] Cluster 3 cluster: Short SMA=74, Long SMA=176, Sharpe=0.0770, Trades=11
[INFO] Cluster 4 cluster: Short SMA=98, Long SMA=118, Sharpe=0.1586, Trades=23
[INFO] Cluster 5 cluster: Short SMA=270, Long SMA=274, Sharpe=-0.1563, Trades=28
[INFO] Cluster 6 cluster: Short SMA=60, Long SMA=128, Sharpe=0.2247, Trades=17
[INFO] Cluster 7 cluster: Short SMA=30, Long SMA=40, Sharpe=0.3500, Trades=70
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=168, Sharpe=0.2542, Trades=17
[INFO] Cluster 10 cluster: Short SMA=20, Long SMA=236, Sharpe=0.3925, Trades=15
[INFO] Cluster 11 cluster: Short SMA=44, Long SMA=284, Sharpe=0.0508, Trades=10
[INFO] Cluster 13 cluster: Short SMA=146, Long SMA=176, Sharpe=0.2904, Trades=14
[INFO] Cluster 14 cluster: Short SMA=188, Long SMA=214, Sharpe=0.0581, Trades=12
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=68, Long SMA=72, Sharpe=0.9203, Trades=60
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=40, Long SMA=62, Sharpe=0.7207, Trades=35
[INFO] Top 2: Short SMA=38, Long SMA=94, Sharpe=0.6750, Trades=23
[INFO] Top 3: Short SMA=20, Long SMA=236, Sharpe=0.3925, Trades=15
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 1871 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 68, Long SMA: 72
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(40/62) - Original Sharpe: 0.7207, Trades: 35
[INFO] Hierarchical cluster 2: SMA(38/94) - Original Sharpe: 0.6750, Trades: 23
[INFO] Hierarchical cluster 3: SMA(20/236) - Original Sharpe: 0.3925, Trades: 15
[INFO] Hierarchical cluster 4: SMA(30/40) - Original Sharpe: 0.3500, Trades: 70
[INFO] Hierarchical cluster 5: SMA(146/176) - Original Sharpe: 0.2904, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (68/72)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (40/62) - Sharpe: 0.7207
[INFO] cluster 2: (38/94) - Sharpe: 0.6750
[INFO] cluster 3: (20/236) - Sharpe: 0.3925
[INFO] Loading UB data from local files...
[INFO] Found data file: A_OHLCV_@UB=117XC_minutes_1440_1703-1557.dat
[INFO] File size: 188977 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -3.091780           -2.356008
1    2021-11-14 2021-11-14            43     0.686256           -3.136574
2    2022-01-14 2022-01-14            41     0.272481            1.002254
3    2022-03-14 2022-03-14            44     4.626773            4.626773
4    2022-05-14 2022-05-14            43     0.064197            0.064197
5    2022-07-14 2022-07-14            44     2.941542            0.982382
6    2022-09-14 2022-09-14            43    -0.010015            2.628638
7    2022-11-14 2022-11-14            43    -2.397546           -2.483832
8    2023-01-14 2023-01-14            41    -0.385884           -2.335223
9    2023-03-14 2023-03-14            44    -1.129434            0.636456
10   2023-05-14 2023-05-14            44     2.665246           -0.675082
11   2023-07-14 2023-07-14            44     3.431170            3.431170
12   2023-09-14 2023-09-14            43     2.602377            2.602377
13   2023-11-14 2023-11-14            42    -4.835599           -4.974110
14   2024-01-14 2024-01-14            43    -1.084920           -3.445449
15   2024-03-14 2024-03-14            42     0.678303            1.805051
16   2024-05-14 2024-05-14            44    -1.255123           -0.654904
17   2024-07-14 2024-07-14            45     2.338417            2.416951
18   2024-09-14 2024-09-14            43    -3.189272           -2.926819
19   2024-11-14 2024-11-14            33     1.699993            1.699993
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -3.1 |             -2.4 |          0.7 | True          
[INFO] 2021-11-14   |          0.7 |             -3.1 |         -3.8 | False         
[INFO] 2022-01-14   |          0.3 |              1.0 |          0.7 | True          
[INFO] 2022-03-14   |          4.6 |              4.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.9 |              1.0 |         -1.9 | False         
[INFO] 2022-09-14   |         -0.0 |              2.6 |          2.6 | True          
[INFO] 2022-11-14   |         -2.4 |             -2.5 |         -0.1 | False         
[INFO] 2023-01-14   |         -0.4 |             -2.3 |         -1.9 | False         
[INFO] 2023-03-14   |         -1.1 |              0.6 |          1.7 | True          
[INFO] 2023-05-14   |          2.7 |             -0.7 |         -3.4 | False         
[INFO] 2023-07-14   |          3.4 |              3.4 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -4.8 |             -5.0 |         -0.2 | False         
[INFO] 2024-01-14   |         -1.1 |             -3.4 |         -2.3 | False         
[INFO] 2024-03-14   |          0.7 |              1.8 |          1.1 | True          
[INFO] 2024-05-14   |         -1.3 |             -0.7 |          0.6 | True          
[INFO] 2024-07-14   |          2.3 |              2.4 |          0.1 | True          
[INFO] 2024-09-14   |         -3.2 |             -2.9 |          0.3 | True          
[INFO] 2024-11-14   |          1.7 |              1.7 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14, 2024-11-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 15
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 15 periods (53.33% win rate)
[INFO] Updating Excel file with Hierarchical results for UB...
[INFO] Excel file updated successfully. Added UB with Hierarchical win rate 53.3% in row 49
[INFO] Added best Sharpe parameters 68/72 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 68, Long SMA: 72
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(40/62) - Original Sharpe: 0.7207
[INFO] Added cluster 2 to portfolio: SMA(38/94) - Original Sharpe: 0.6750
[INFO] Added cluster 3 to portfolio: SMA(20/236) - Original Sharpe: 0.3925
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'UB_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.2818
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1516
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for UB...
[INFO] Excel file updated successfully. Added UB with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\UB
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for ULS in column D: 27.0
[INFO] Using slippage from Excel column D: 27.0
[INFO] 
Symbol: @ULS=116XC
[INFO] Description: Low Sulphur Gasoil Custom Continuous Contract
[INFO] Exchange: ICE
[INFO] Interval: minutes 1440
[INFO] Tick size: 25.0
[INFO] Big point value: 100.0
[INFO] Data shape: (2758, 6)
[INFO] Date range: 2011-09-19 16:50:00 to 2025-04-07 16:50:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2011-09-19 16:50:00  384.00  384.00  351.50  351.50    14.0
1 2011-09-20 16:50:00  361.75  365.75  361.00  365.75    33.0
2 2011-09-21 16:50:00  367.75  367.75  367.75  367.75     1.0
3 2011-11-11 16:50:00  413.25  413.25  412.75  413.00    25.0
4 2011-12-02 16:50:00  379.75  381.00  379.75  381.00    21.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 2
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 33.55 seconds (0.56 minutes)
[INFO] Best parameters found: Short SMA = 166, Long SMA = 168
[INFO] Best fitness (Sharpe ratio): 1.113971
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 166, Long SMA = 168, Sharpe = 1.113971
[INFO] Top 2: Short SMA = 164, Long SMA = 170, Sharpe = 1.094472
[INFO] Top 3: Short SMA = 180, Long SMA = 214, Sharpe = 1.073968
[INFO] Top 4: Short SMA = 166, Long SMA = 172, Sharpe = 1.069776
[INFO] Top 5: Short SMA = 174, Long SMA = 212, Sharpe = 1.066760
[INFO] Hall of Fame size: 2504
[INFO] Number of elements in all_results: 1377
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 1127 had penalty fitness
[INFO] Total filtered from Hall of Fame: 1127
[INFO] Hall of Fame -> all_results: 2504 -> 1377
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1377 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 2683, Evaluation data length: 2681
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @ULS=116XC
[INFO] Big Point Value (from data): 100.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 4.30 contracts
[INFO] Maximum Position Size: 8 contracts
[INFO] Strategy Total P&L: $-24,675.00
[INFO] Market Buy & Hold P&L: $27,400.00
[INFO] Outperformance: $-52,075.00
[INFO] Sharpe ratio (entire period, annualized): -0.029510
[INFO] Sharpe ratio (in-sample, annualized): 0.242351
[INFO] Sharpe ratio (out-of-sample, annualized): -0.547606
[INFO] Maximum Drawdown: $400,575.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $132,250.00
[INFO] Out-of-sample P&L: $-156,925.00
[INFO] 
Best parameters from GA: Short SMA = 166, Long SMA = 168, Sharpe = 1.113971
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2504
[INFO] Cache hits (repeated combinations): 6083
[INFO] Total checks: 8587
[INFO] Cache hit rate: 70.84%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 100.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1377 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.2802 to 1.1140
[INFO] 
Best parameters:
[INFO] Short SMA: 166
[INFO] Long SMA: 168
[INFO] Sharpe Ratio: 1.113971
[INFO] Number of Trades: 30
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1377 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.2802 to 1.1140
[INFO] Trades range: 11.0 to 134.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5017 to 2.1478
[INFO] Scaled Long SMA range: -3.1277 to 1.9458
[INFO] Scaled Sharpe ratio range: -3.0653 to 1.8952
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 16
[INFO] Using 16 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=16...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 113 elements
[INFO] Kmeans Cluster 1: 76 elements
[INFO] Kmeans Cluster 2: 56 elements
[INFO] Kmeans Cluster 3: 36 elements
[INFO] Kmeans Cluster 4: 81 elements
[INFO] Kmeans Cluster 5: 44 elements
[INFO] Kmeans Cluster 6: 69 elements
[INFO] Kmeans Cluster 7: 34 elements
[INFO] Kmeans Cluster 8: 129 elements
[INFO] Kmeans Cluster 9: 71 elements
[INFO] Kmeans Cluster 10: 139 elements
[INFO] Kmeans Cluster 11: 100 elements
[INFO] Kmeans Cluster 12: 147 elements
[INFO] Kmeans Cluster 13: 106 elements
[INFO] Kmeans Cluster 14: 42 elements
[INFO] Kmeans Cluster 15: 134 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=233.86, Long SMA=251.72, Sharpe=0.6519
[INFO] Centroid 1: Short SMA=24.26, Long SMA=172.13, Sharpe=0.4720
[INFO] Centroid 2: Short SMA=118.32, Long SMA=182.07, Sharpe=0.6412
[INFO] Centroid 3: Short SMA=60.06, Long SMA=76.17, Sharpe=0.2053
[INFO] Centroid 4: Short SMA=104.22, Long SMA=134.72, Sharpe=0.0274
[INFO] Centroid 5: Short SMA=21.23, Long SMA=47.14, Sharpe=0.6957
[INFO] Centroid 6: Short SMA=29.62, Long SMA=266.32, Sharpe=0.4763
[INFO] Centroid 7: Short SMA=284.47, Long SMA=290.82, Sharpe=0.1718
[INFO] Centroid 8: Short SMA=149.63, Long SMA=176.59, Sharpe=0.9020
[INFO] Centroid 9: Short SMA=34.03, Long SMA=109.86, Sharpe=0.3297
[INFO] Centroid 10: Short SMA=173.84, Long SMA=210.83, Sharpe=0.9470
[INFO] Centroid 11: Short SMA=83.06, Long SMA=169.68, Sharpe=0.2541
[INFO] Centroid 12: Short SMA=198.05, Long SMA=224.65, Sharpe=0.7842
[INFO] Centroid 13: Short SMA=23.40, Long SMA=222.92, Sharpe=0.4064
[INFO] Centroid 14: Short SMA=256.14, Long SMA=268.81, Sharpe=0.4648
[INFO] Centroid 15: Short SMA=166.50, Long SMA=192.41, Sharpe=0.7579
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=166, Long SMA=168, Sharpe=1.1140, Trades=30
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=172, Long SMA=210, Sharpe=1.0272, Trades=11
[INFO] Kmeans Top 2: Short SMA=150, Long SMA=176, Sharpe=0.8555, Trades=13
[INFO] Kmeans Top 3: Short SMA=198, Long SMA=222, Sharpe=0.8100, Trades=13
[INFO] Kmeans Top 4: Short SMA=168, Long SMA=190, Sharpe=0.7536, Trades=15
[INFO] Kmeans Top 5: Short SMA=230, Long SMA=250, Sharpe=0.6849, Trades=15
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}
[INFO]   Rounded: (234, 252)
[INFO]   Rounded: (24, 172)
[INFO]   Rounded: (118, 182)
[INFO]   Rounded: (60, 76)
[INFO]   Rounded: (104, 135)
[INFO]   Nearest: (104.0, 134.0)
[INFO]   Rounded: (21, 47)
[INFO]   Nearest: (22.0, 48.0)
[INFO]   Rounded: (30, 266)
[INFO]   Rounded: (284, 291)
[INFO]   Nearest: (284.0, 290.0)
[INFO]   Rounded: (150, 177)
[INFO]   Nearest: (150.0, 176.0)
[INFO]   Rounded: (34, 110)
[INFO]   Rounded: (174, 211)
[INFO]   Nearest: (174.0, 210.0)
[INFO]   Rounded: (83, 170)
[INFO]   Nearest: (84.0, 170.0)
[INFO]   Rounded: (198, 225)
[INFO]   Nearest: (198.0, 224.0)
[INFO]   Rounded: (23, 223)
[INFO]   Nearest: (24.0, 222.0)
[INFO]   Rounded: (256, 269)
[INFO]   Nearest: (256.0, 268.0)
[INFO]   Rounded: (166, 192)
[INFO] Successfully plotted 16 out of 16 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 166, Long SMA: 168
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 2
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(172/210) - Original Sharpe: 1.0272, Trades: 11
[INFO] Kmeans cluster 2: SMA(150/176) - Original Sharpe: 0.8555, Trades: 13
[INFO] Kmeans cluster 3: SMA(198/222) - Original Sharpe: 0.8100, Trades: 13
[INFO] Kmeans cluster 4: SMA(168/190) - Original Sharpe: 0.7536, Trades: 15
[INFO] Kmeans cluster 5: SMA(230/250) - Original Sharpe: 0.6849, Trades: 15
[INFO] Trimmed warm-up period. Evaluation data length: 2681
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (166/168)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (172/210) - Sharpe: 1.0272
[INFO] cluster 2: (150/176) - Sharpe: 0.8555
[INFO] cluster 3: (198/222) - Sharpe: 0.8100
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Out-of-sample period starts on: 2021-11-19
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-11-19 2021-11-19            43     1.280342            1.280342
1    2022-01-19 2022-01-19            43     2.581626            2.581626
2    2022-03-19 2022-03-19            42     0.329627            0.329627
3    2022-05-19 2022-05-19            43     1.402034            1.402034
4    2022-07-19 2022-07-19            44    -1.324002           -1.324002
5    2022-09-19 2022-09-19            45     1.312950            1.385705
6    2022-11-19 2022-11-19            41    -0.638271           -0.331231
7    2023-01-19 2023-01-19            42     3.607885           -1.353101
8    2023-03-19 2023-03-19            43     3.055470            1.814126
9    2023-05-19 2023-05-19            43    -2.250970           -2.086250
10   2023-07-19 2023-07-19            44    -5.185486           -4.566868
11   2023-09-19 2023-09-19            44    -2.773541           -0.646890
12   2023-11-19 2023-11-19            42     0.667456            0.390523
13   2024-01-19 2024-01-19            42     2.912396            2.912396
14   2024-03-19 2024-03-19            43    -2.656666           -1.699759
15   2024-05-19 2024-05-19            44    -6.949862           -1.016785
16   2024-07-19 2024-07-19            44    -3.716464           -3.890420
17   2024-09-19 2024-09-19            43    -1.541732           -0.673080
18   2024-11-19 2024-11-19            30    -1.144354           -1.144354
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-11-19   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-01-19   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2022-03-19   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-05-19   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-07-19   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2022-09-19   |          1.3 |              1.4 |          0.1 | True          
[INFO] 2022-11-19   |         -0.6 |             -0.3 |          0.3 | True          
[INFO] 2023-01-19   |          3.6 |             -1.4 |         -5.0 | False         
[INFO] 2023-03-19   |          3.1 |              1.8 |         -1.3 | False         
[INFO] 2023-05-19   |         -2.3 |             -2.1 |          0.2 | True          
[INFO] 2023-07-19   |         -5.2 |             -4.6 |          0.6 | True          
[INFO] 2023-09-19   |         -2.8 |             -0.6 |          2.2 | True          
[INFO] 2023-11-19   |          0.7 |              0.4 |         -0.3 | False         
[INFO] 2024-01-19   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-03-19   |         -2.7 |             -1.7 |          1.0 | True          
[INFO] 2024-05-19   |         -6.9 |             -1.0 |          5.9 | True          
[INFO] 2024-07-19   |         -3.7 |             -3.9 |         -0.2 | False         
[INFO] 2024-09-19   |         -1.5 |             -0.7 |          0.8 | True          
[INFO] 2024-11-19   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-19, 2022-01-19, 2022-03-19, 2022-05-19, 2022-07-19, 2024-01-19, 2024-11-19
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Kmeans cluster wins (rounded comparison): 8 of 12 periods (66.67% win rate)
[INFO] Updating Excel file with Kmeans results for ULS...
[INFO] Excel file updated successfully. Added ULS with Kmeans win rate 66.7% in row 50
[INFO] Added best Sharpe parameters 166/168 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 166, Long SMA: 168
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(172/210) - Original Sharpe: 1.0272
[INFO] Added cluster 2 to portfolio: SMA(150/176) - Original Sharpe: 0.8555
[INFO] Added cluster 3 to portfolio: SMA(198/222) - Original Sharpe: 0.8100
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ULS_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.1356
[INFO] Kmeans Best out-of-sample Sharpe: -0.2111
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for ULS...
[INFO] Excel file updated successfully. Added ULS with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ULS
[INFO] Big Point Value: 100.0
[INFO] Slippage: 27.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1377 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.2802 to 1.1140
[INFO] 
Best parameters:
[INFO] Short SMA: 166
[INFO] Long SMA: 168
[INFO] Sharpe Ratio: 1.113971
[INFO] Number of Trades: 30
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1377 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.2802 to 1.1140
[INFO] Trades range: 11.0 to 134.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5017 to 2.1478
[INFO] Scaled Long SMA range: -3.1277 to 1.9458
[INFO] Scaled Sharpe ratio range: -3.0653 to 1.8952
[INFO] Scaled Trades range: -0.5888 to 12.3984
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1377 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6443
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 20
[INFO] Using 20 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 20 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 141 elements
[INFO] Cluster 1: 84 elements
[INFO] Cluster 2: 103 elements
[INFO] Cluster 3: 8 elements
[INFO] Cluster 4: 70 elements
[INFO] Cluster 5: 18 elements
[INFO] Cluster 6: 111 elements
[INFO] Cluster 7: 78 elements
[INFO] Cluster 8: 165 elements
[INFO] Cluster 9: 17 elements
[INFO] Cluster 10: 113 elements
[INFO] Cluster 11: 20 elements
[INFO] Cluster 12: 18 elements
[INFO] Cluster 13: 60 elements
[INFO] Cluster 14: 19 elements
[INFO] Cluster 15: 1 elements
[INFO] Cluster 16: 94 elements
[INFO] Cluster 17: 104 elements
[INFO] Cluster 18: 119 elements
[INFO] Cluster 19: 34 elements
[INFO] Using 14 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=242, Long SMA=258, Sharpe=0.6361, Trades=13
[INFO] Cluster 1 cluster: Short SMA=36, Long SMA=108, Sharpe=0.4582, Trades=19
[INFO] Cluster 2 cluster: Short SMA=16, Long SMA=218, Sharpe=0.3259, Trades=15
[INFO] Cluster 4 cluster: Short SMA=98, Long SMA=130, Sharpe=0.1276, Trades=17
[INFO] Cluster 6 cluster: Short SMA=136, Long SMA=192, Sharpe=0.7659, Trades=13
[INFO] Cluster 7 cluster: Short SMA=38, Long SMA=260, Sharpe=0.2987, Trades=13
[INFO] Cluster 8 cluster: Short SMA=198, Long SMA=226, Sharpe=0.8798, Trades=13
[INFO] Cluster 10 cluster: Short SMA=78, Long SMA=170, Sharpe=0.2308, Trades=13
[INFO] Cluster 11 cluster: Short SMA=180, Long SMA=182, Sharpe=0.7634, Trades=29
[INFO] Cluster 13 cluster: Short SMA=18, Long SMA=172, Sharpe=0.4279, Trades=15
[INFO] Cluster 16 cluster: Short SMA=154, Long SMA=176, Sharpe=0.8770, Trades=15
[INFO] Cluster 17 cluster: Short SMA=176, Long SMA=188, Sharpe=0.7488, Trades=17
[INFO] Cluster 18 cluster: Short SMA=172, Long SMA=210, Sharpe=1.0272, Trades=11
[INFO] Cluster 19 cluster: Short SMA=284, Long SMA=290, Sharpe=0.1155, Trades=11
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=166, Long SMA=168, Sharpe=1.1140, Trades=30
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=172, Long SMA=210, Sharpe=1.0272, Trades=11
[INFO] Top 2: Short SMA=198, Long SMA=226, Sharpe=0.8798, Trades=13
[INFO] Top 3: Short SMA=154, Long SMA=176, Sharpe=0.8770, Trades=15
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 14 valid clusters with clusters
[INFO] Filtering to 1296 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 166, Long SMA: 168
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 2
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(172/210) - Original Sharpe: 1.0272, Trades: 11
[INFO] Hierarchical cluster 2: SMA(198/226) - Original Sharpe: 0.8798, Trades: 13
[INFO] Hierarchical cluster 3: SMA(154/176) - Original Sharpe: 0.8770, Trades: 15
[INFO] Hierarchical cluster 4: SMA(136/192) - Original Sharpe: 0.7659, Trades: 13
[INFO] Hierarchical cluster 5: SMA(180/182) - Original Sharpe: 0.7634, Trades: 29
[INFO] Trimmed warm-up period. Evaluation data length: 2681
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (166/168)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (172/210) - Sharpe: 1.0272
[INFO] cluster 2: (198/226) - Sharpe: 0.8798
[INFO] cluster 3: (154/176) - Sharpe: 0.8770
[INFO] Loading ULS data from local files...
[INFO] Found data file: A_OHLCV_@ULS=116XC_minutes_1440_2005-1650.dat
[INFO] File size: 132524 bytes
[INFO] Out-of-sample period starts on: 2021-11-19
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-11-19 2021-11-19            43     1.280342            1.280342
1    2022-01-19 2022-01-19            43     2.581626            2.581626
2    2022-03-19 2022-03-19            42     0.329627            0.329627
3    2022-05-19 2022-05-19            43     1.402034            1.402034
4    2022-07-19 2022-07-19            44    -1.324002           -1.324002
5    2022-09-19 2022-09-19            45     1.312950            1.385705
6    2022-11-19 2022-11-19            41    -0.638271           -0.041833
7    2023-01-19 2023-01-19            42     3.607885           -1.285235
8    2023-03-19 2023-03-19            43     3.055470            1.660938
9    2023-05-19 2023-05-19            43    -2.250970           -2.086250
10   2023-07-19 2023-07-19            44    -5.185486           -4.566868
11   2023-09-19 2023-09-19            44    -2.773541           -0.191044
12   2023-11-19 2023-11-19            42     0.667456            0.102555
13   2024-01-19 2024-01-19            42     2.912396            2.912396
14   2024-03-19 2024-03-19            43    -2.656666           -2.915926
15   2024-05-19 2024-05-19            44    -6.949862           -0.183030
16   2024-07-19 2024-07-19            44    -3.716464           -3.335121
17   2024-09-19 2024-09-19            43    -1.541732           -1.014473
18   2024-11-19 2024-11-19            30    -1.144354           -1.144354
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-11-19   |          1.3 |              1.3 |          0.0 | Excluded      
[INFO] 2022-01-19   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2022-03-19   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2022-05-19   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-07-19   |         -1.3 |             -1.3 |          0.0 | Excluded      
[INFO] 2022-09-19   |          1.3 |              1.4 |          0.1 | True          
[INFO] 2022-11-19   |         -0.6 |             -0.0 |          0.6 | True          
[INFO] 2023-01-19   |          3.6 |             -1.3 |         -4.9 | False         
[INFO] 2023-03-19   |          3.1 |              1.7 |         -1.4 | False         
[INFO] 2023-05-19   |         -2.3 |             -2.1 |          0.2 | True          
[INFO] 2023-07-19   |         -5.2 |             -4.6 |          0.6 | True          
[INFO] 2023-09-19   |         -2.8 |             -0.2 |          2.6 | True          
[INFO] 2023-11-19   |          0.7 |              0.1 |         -0.6 | False         
[INFO] 2024-01-19   |          2.9 |              2.9 |          0.0 | Excluded      
[INFO] 2024-03-19   |         -2.7 |             -2.9 |         -0.2 | False         
[INFO] 2024-05-19   |         -6.9 |             -0.2 |          6.7 | True          
[INFO] 2024-07-19   |         -3.7 |             -3.3 |          0.4 | True          
[INFO] 2024-09-19   |         -1.5 |             -1.0 |          0.5 | True          
[INFO] 2024-11-19   |         -1.1 |             -1.1 |          0.0 | Excluded      
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-19, 2022-01-19, 2022-03-19, 2022-05-19, 2022-07-19, 2024-01-19, 2024-11-19
[INFO] 
Total periods before exclusion: 19
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Hierarchical cluster wins (rounded comparison): 8 of 12 periods (66.67% win rate)
[INFO] Updating Excel file with Hierarchical results for ULS...
[INFO] Excel file updated successfully. Added ULS with Hierarchical win rate 66.7% in row 50
[INFO] Added best Sharpe parameters 166/168 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 166, Long SMA: 168
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(172/210) - Original Sharpe: 1.0272
[INFO] Added cluster 2 to portfolio: SMA(198/226) - Original Sharpe: 0.8798
[INFO] Added cluster 3 to portfolio: SMA(154/176) - Original Sharpe: 0.8770
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'ULS_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1296
[INFO] Hierarchical Best out-of-sample Sharpe: -0.2111
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for ULS...
[INFO] Excel file updated successfully. Added ULS with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\ULS
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for US in column D: 34.0
[INFO] Using slippage from Excel column D: 34.0
[INFO] 
Symbol: @US
[INFO] Description: 30 Yr U.S.Treasury Bonds Continuous Contract [Jun25]
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 31.25
[INFO] Big point value: 1000.0
[INFO] Data shape: (6118, 6)
[INFO] Date range: 2001-05-14 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime      open      high       low     close    volume
0 2001-05-14 15:57:00  38.09375  38.21875  37.81250  38.06250  403937.0
1 2001-05-15 15:57:00  38.09375  38.28125  37.21875  37.37500  548742.0
2 2001-05-16 15:57:00  37.40625  38.46875  37.40625  37.90625  689833.0
3 2001-05-17 15:57:00  37.93750  38.84375  37.65625  38.84375  706336.0
4 2001-05-18 15:57:00  38.87500  39.25000  38.56250  38.81250  410112.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 28.76 seconds (0.48 minutes)
[INFO] Best parameters found: Short SMA = 62, Long SMA = 94
[INFO] Best fitness (Sharpe ratio): 1.040882
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 62, Long SMA = 94, Sharpe = 1.040882
[INFO] Top 2: Short SMA = 62, Long SMA = 96, Sharpe = 0.980153
[INFO] Top 3: Short SMA = 60, Long SMA = 96, Sharpe = 0.973254
[INFO] Top 4: Short SMA = 64, Long SMA = 94, Sharpe = 0.965902
[INFO] Top 5: Short SMA = 42, Long SMA = 76, Sharpe = 0.965011
[INFO] Hall of Fame size: 2503
[INFO] Number of elements in all_results: 1917
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 586 had penalty fitness
[INFO] Total filtered from Hall of Fame: 586
[INFO] Hall of Fame -> all_results: 2503 -> 1917
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1917 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3108, Evaluation data length: 2841
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @US
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 5.13 contracts
[INFO] Maximum Position Size: 9 contracts
[INFO] Strategy Total P&L: $-42,406.25
[INFO] Market Buy & Hold P&L: $2,093.75
[INFO] Outperformance: $-44,500.00
[INFO] Sharpe ratio (entire period, annualized): -0.113079
[INFO] Sharpe ratio (in-sample, annualized): -0.575828
[INFO] Sharpe ratio (out-of-sample, annualized): 0.961430
[INFO] Maximum Drawdown: $411,250.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $-322,000.00
[INFO] Out-of-sample P&L: $231,468.75
[INFO] 
Best parameters from GA: Short SMA = 62, Long SMA = 94, Sharpe = 1.040882
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2503
[INFO] Cache hits (repeated combinations): 6099
[INFO] Total checks: 8602
[INFO] Cache hit rate: 70.90%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1917 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.4606 to 1.0409
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 94
[INFO] Sharpe Ratio: 1.040882
[INFO] Number of Trades: 26
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1917 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.4606 to 1.0409
[INFO] Trades range: 10.0 to 204.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9740 to 2.9834
[INFO] Scaled Long SMA range: -1.9999 to 1.7939
[INFO] Scaled Sharpe ratio range: -2.5513 to 2.3013
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 154 elements
[INFO] Kmeans Cluster 1: 104 elements
[INFO] Kmeans Cluster 2: 67 elements
[INFO] Kmeans Cluster 3: 112 elements
[INFO] Kmeans Cluster 4: 112 elements
[INFO] Kmeans Cluster 5: 111 elements
[INFO] Kmeans Cluster 6: 174 elements
[INFO] Kmeans Cluster 7: 118 elements
[INFO] Kmeans Cluster 8: 131 elements
[INFO] Kmeans Cluster 9: 197 elements
[INFO] Kmeans Cluster 10: 213 elements
[INFO] Kmeans Cluster 11: 131 elements
[INFO] Kmeans Cluster 12: 103 elements
[INFO] Kmeans Cluster 13: 83 elements
[INFO] Kmeans Cluster 14: 107 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=40.70, Long SMA=250.32, Sharpe=0.2007
[INFO] Centroid 1: Short SMA=65.02, Long SMA=94.85, Sharpe=0.6060
[INFO] Centroid 2: Short SMA=279.19, Long SMA=292.12, Sharpe=-0.3006
[INFO] Centroid 3: Short SMA=149.98, Long SMA=185.18, Sharpe=0.3010
[INFO] Centroid 4: Short SMA=185.96, Long SMA=227.70, Sharpe=0.0599
[INFO] Centroid 5: Short SMA=26.92, Long SMA=53.72, Sharpe=0.4556
[INFO] Centroid 6: Short SMA=27.63, Long SMA=159.61, Sharpe=0.4835
[INFO] Centroid 7: Short SMA=103.83, Long SMA=137.19, Sharpe=-0.0109
[INFO] Centroid 8: Short SMA=68.82, Long SMA=169.50, Sharpe=0.1880
[INFO] Centroid 9: Short SMA=52.58, Long SMA=84.58, Sharpe=0.8021
[INFO] Centroid 10: Short SMA=22.84, Long SMA=91.15, Sharpe=0.6461
[INFO] Centroid 11: Short SMA=54.49, Long SMA=278.02, Sharpe=0.0386
[INFO] Centroid 12: Short SMA=60.68, Long SMA=121.77, Sharpe=0.4076
[INFO] Centroid 13: Short SMA=23.64, Long SMA=217.16, Sharpe=0.4072
[INFO] Centroid 14: Short SMA=243.40, Long SMA=264.71, Sharpe=-0.1686
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=94, Sharpe=1.0409, Trades=26
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=54, Long SMA=86, Sharpe=0.8389, Trades=24
[INFO] Kmeans Top 2: Short SMA=68, Long SMA=100, Sharpe=0.6849, Trades=22
[INFO] Kmeans Top 3: Short SMA=22, Long SMA=94, Sharpe=0.6432, Trades=21
[INFO] Kmeans Top 4: Short SMA=26, Long SMA=160, Sharpe=0.4994, Trades=15
[INFO] Kmeans Top 5: Short SMA=30, Long SMA=56, Sharpe=0.4929, Trades=35
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (41, 250)
[INFO]   Nearest: (40.0, 250.0)
[INFO]   Rounded: (65, 95)
[INFO]   Nearest: (66.0, 94.0)
[INFO]   Rounded: (279, 292)
[INFO]   Nearest: (280.0, 292.0)
[INFO]   Rounded: (150, 185)
[INFO]   Nearest: (150.0, 186.0)
[INFO]   Rounded: (186, 228)
[INFO]   Rounded: (27, 54)
[INFO]   Nearest: (26.0, 54.0)
[INFO]   Rounded: (28, 160)
[INFO]   Rounded: (104, 137)
[INFO]   Nearest: (104.0, 138.0)
[INFO]   Rounded: (69, 169)
[INFO]   Nearest: (68.0, 170.0)
[INFO]   Rounded: (53, 85)
[INFO]   Nearest: (52.0, 84.0)
[INFO]   Rounded: (23, 91)
[INFO]   Nearest: (22.0, 92.0)
[INFO]   Rounded: (54, 278)
[INFO]   Rounded: (61, 122)
[INFO]   Nearest: (60.0, 122.0)
[INFO]   Rounded: (24, 217)
[INFO]   Nearest: (24.0, 218.0)
[INFO]   Rounded: (243, 265)
[INFO]   Nearest: (244.0, 264.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 94
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(54/86) - Original Sharpe: 0.8389, Trades: 24
[INFO] Kmeans cluster 2: SMA(68/100) - Original Sharpe: 0.6849, Trades: 22
[INFO] Kmeans cluster 3: SMA(22/94) - Original Sharpe: 0.6432, Trades: 21
[INFO] Kmeans cluster 4: SMA(26/160) - Original Sharpe: 0.4994, Trades: 15
[INFO] Kmeans cluster 5: SMA(30/56) - Original Sharpe: 0.4929, Trades: 35
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/94)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (54/86) - Sharpe: 0.8389
[INFO] cluster 2: (68/100) - Sharpe: 0.6849
[INFO] cluster 3: (22/94) - Sharpe: 0.6432
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.475522           -2.049324
1    2021-11-14 2021-11-14            43     1.219983           -1.927167
2    2022-01-14 2022-01-14            41    -0.358176           -0.640670
3    2022-03-14 2022-03-14            44     4.804528            4.804528
4    2022-05-14 2022-05-14            43    -0.181247           -0.181247
5    2022-07-14 2022-07-14            44     1.120787           -2.238363
6    2022-09-14 2022-09-14            43    -1.028981           -0.015401
7    2022-11-14 2022-11-14            43    -2.298651           -3.174545
8    2023-01-14 2023-01-14            41    -0.223635           -5.023135
9    2023-03-14 2023-03-14            44     0.355798           -2.596942
10   2023-05-14 2023-05-14            44     1.277535           -5.174307
11   2023-07-14 2023-07-14            44     3.299199            3.299199
12   2023-09-14 2023-09-14            43     2.565820            2.565820
13   2023-11-14 2023-11-14            42    -2.979453           -4.570927
14   2024-01-14 2024-01-14            43    -1.306968           -0.597252
15   2024-03-14 2024-03-14            42     0.596356            0.701398
16   2024-05-14 2024-05-14            44    -1.478112           -1.523351
17   2024-07-14 2024-07-14            45     3.789391            3.412311
18   2024-09-14 2024-09-14            43    -5.219166           -5.194760
19   2024-11-14 2024-11-14            33     2.330861            3.217263
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.5 |             -2.0 |         -0.5 | False         
[INFO] 2021-11-14   |          1.2 |             -1.9 |         -3.1 | False         
[INFO] 2022-01-14   |         -0.4 |             -0.6 |         -0.2 | False         
[INFO] 2022-03-14   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |             -2.2 |         -3.3 | False         
[INFO] 2022-09-14   |         -1.0 |             -0.0 |          1.0 | True          
[INFO] 2022-11-14   |         -2.3 |             -3.2 |         -0.9 | False         
[INFO] 2023-01-14   |         -0.2 |             -5.0 |         -4.8 | False         
[INFO] 2023-03-14   |          0.4 |             -2.6 |         -3.0 | False         
[INFO] 2023-05-14   |          1.3 |             -5.2 |         -6.5 | False         
[INFO] 2023-07-14   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.0 |             -4.6 |         -1.6 | False         
[INFO] 2024-01-14   |         -1.3 |             -0.6 |          0.7 | True          
[INFO] 2024-03-14   |          0.6 |              0.7 |          0.1 | True          
[INFO] 2024-05-14   |         -1.5 |             -1.5 |          0.0 | Excluded      
[INFO] 2024-07-14   |          3.8 |              3.4 |         -0.4 | False         
[INFO] 2024-09-14   |         -5.2 |             -5.2 |          0.0 | Excluded      
[INFO] 2024-11-14   |          2.3 |              3.2 |          0.9 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14, 2024-05-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 14
[INFO] Kmeans cluster wins (rounded comparison): 4 of 14 periods (28.57% win rate)
[INFO] Updating Excel file with Kmeans results for US...
[INFO] Excel file updated successfully. Added US with Kmeans win rate 28.6% in row 51
[INFO] Added best Sharpe parameters 62/94 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 94
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(54/86) - Original Sharpe: 0.8389
[INFO] Added cluster 2 to portfolio: SMA(68/100) - Original Sharpe: 0.6849
[INFO] Added cluster 3 to portfolio: SMA(22/94) - Original Sharpe: 0.6432
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'US_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.3799
[INFO] Kmeans Best out-of-sample Sharpe: 0.1936
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for US...
[INFO] Excel file updated successfully. Added US with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\US
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 34.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1917 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 16 to 300
[INFO] Sharpe ratio range: -0.4606 to 1.0409
[INFO] 
Best parameters:
[INFO] Short SMA: 62
[INFO] Long SMA: 94
[INFO] Sharpe Ratio: 1.040882
[INFO] Number of Trades: 26
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1917 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 16.0 to 300.0
[INFO] Sharpe ratio range: -0.4606 to 1.0409
[INFO] Trades range: 10.0 to 204.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9740 to 2.9834
[INFO] Scaled Long SMA range: -1.9999 to 1.7939
[INFO] Scaled Sharpe ratio range: -2.5513 to 2.3013
[INFO] Scaled Trades range: -0.7440 to 13.6287
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1917 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5949
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 112 elements
[INFO] Cluster 1: 353 elements
[INFO] Cluster 2: 171 elements
[INFO] Cluster 3: 38 elements
[INFO] Cluster 4: 274 elements
[INFO] Cluster 5: 256 elements
[INFO] Cluster 6: 21 elements
[INFO] Cluster 7: 132 elements
[INFO] Cluster 8: 210 elements
[INFO] Cluster 9: 104 elements
[INFO] Cluster 10: 106 elements
[INFO] Cluster 11: 100 elements
[INFO] Cluster 12: 38 elements
[INFO] Cluster 13: 2 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=192, Long SMA=220, Sharpe=-0.0142, Trades=12
[INFO] Cluster 1 cluster: Short SMA=40, Long SMA=96, Sharpe=0.7798, Trades=21
[INFO] Cluster 2 cluster: Short SMA=264, Long SMA=276, Sharpe=-0.0011, Trades=16
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=40, Sharpe=0.3553, Trades=73
[INFO] Cluster 4 cluster: Short SMA=38, Long SMA=152, Sharpe=0.5535, Trades=15
[INFO] Cluster 5 cluster: Short SMA=54, Long SMA=262, Sharpe=0.1186, Trades=11
[INFO] Cluster 6 cluster: Short SMA=102, Long SMA=108, Sharpe=0.0040, Trades=37
[INFO] Cluster 7 cluster: Short SMA=68, Long SMA=172, Sharpe=0.2373, Trades=13
[INFO] Cluster 8 cluster: Short SMA=38, Long SMA=66, Sharpe=0.4149, Trades=29
[INFO] Cluster 9 cluster: Short SMA=102, Long SMA=140, Sharpe=0.0349, Trades=19
[INFO] Cluster 10 cluster: Short SMA=28, Long SMA=230, Sharpe=0.2573, Trades=13
[INFO] Cluster 11 cluster: Short SMA=154, Long SMA=184, Sharpe=0.2752, Trades=12
[INFO] Cluster 12 cluster: Short SMA=56, Long SMA=62, Sharpe=0.7735, Trades=55
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=62, Long SMA=94, Sharpe=1.0409, Trades=26
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=40, Long SMA=96, Sharpe=0.7798, Trades=21
[INFO] Top 2: Short SMA=56, Long SMA=62, Sharpe=0.7735, Trades=55
[INFO] Top 3: Short SMA=38, Long SMA=152, Sharpe=0.5535, Trades=15
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 1915 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 62, Long SMA: 94
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(40/96) - Original Sharpe: 0.7798, Trades: 21
[INFO] Hierarchical cluster 2: SMA(56/62) - Original Sharpe: 0.7735, Trades: 55
[INFO] Hierarchical cluster 3: SMA(38/152) - Original Sharpe: 0.5535, Trades: 15
[INFO] Hierarchical cluster 4: SMA(38/66) - Original Sharpe: 0.4149, Trades: 29
[INFO] Hierarchical cluster 5: SMA(34/40) - Original Sharpe: 0.3553, Trades: 73
[INFO] Trimmed warm-up period. Evaluation data length: 2841
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (62/94)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (40/96) - Sharpe: 0.7798
[INFO] cluster 2: (56/62) - Sharpe: 0.7735
[INFO] cluster 3: (38/152) - Sharpe: 0.5535
[INFO] Loading US data from local files...
[INFO] Found data file: A_OHLCV_@US_minutes_1440_1703-1557.dat
[INFO] File size: 293816 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.475522           -3.372215
1    2021-11-14 2021-11-14            43     1.219983           -4.181686
2    2022-01-14 2022-01-14            41    -0.358176           -0.116227
3    2022-03-14 2022-03-14            44     4.804528            4.804528
4    2022-05-14 2022-05-14            43    -0.181247           -0.181247
5    2022-07-14 2022-07-14            44     1.120787           -1.217850
6    2022-09-14 2022-09-14            43    -1.028981            1.566263
7    2022-11-14 2022-11-14            43    -2.298651           -0.541496
8    2023-01-14 2023-01-14            41    -0.223635           -4.617133
9    2023-03-14 2023-03-14            44     0.355798           -2.779478
10   2023-05-14 2023-05-14            44     1.277535           -1.484868
11   2023-07-14 2023-07-14            44     3.299199            3.299199
12   2023-09-14 2023-09-14            43     2.565820            2.565820
13   2023-11-14 2023-11-14            42    -2.979453           -4.724559
14   2024-01-14 2024-01-14            43    -1.306968           -0.967354
15   2024-03-14 2024-03-14            42     0.596356           -0.101843
16   2024-05-14 2024-05-14            44    -1.478112           -0.332602
17   2024-07-14 2024-07-14            45     3.789391            3.723431
18   2024-09-14 2024-09-14            43    -5.219166           -5.735675
19   2024-11-14 2024-11-14            33     2.330861            2.032426
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.5 |             -3.4 |         -1.9 | False         
[INFO] 2021-11-14   |          1.2 |             -4.2 |         -5.4 | False         
[INFO] 2022-01-14   |         -0.4 |             -0.1 |          0.3 | True          
[INFO] 2022-03-14   |          4.8 |              4.8 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -0.2 |             -0.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          1.1 |             -1.2 |         -2.3 | False         
[INFO] 2022-09-14   |         -1.0 |              1.6 |          2.6 | True          
[INFO] 2022-11-14   |         -2.3 |             -0.5 |          1.8 | True          
[INFO] 2023-01-14   |         -0.2 |             -4.6 |         -4.4 | False         
[INFO] 2023-03-14   |          0.4 |             -2.8 |         -3.2 | False         
[INFO] 2023-05-14   |          1.3 |             -1.5 |         -2.8 | False         
[INFO] 2023-07-14   |          3.3 |              3.3 |          0.0 | Excluded      
[INFO] 2023-09-14   |          2.6 |              2.6 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -3.0 |             -4.7 |         -1.7 | False         
[INFO] 2024-01-14   |         -1.3 |             -1.0 |          0.3 | True          
[INFO] 2024-03-14   |          0.6 |             -0.1 |         -0.7 | False         
[INFO] 2024-05-14   |         -1.5 |             -0.3 |          1.2 | True          
[INFO] 2024-07-14   |          3.8 |              3.7 |         -0.1 | False         
[INFO] 2024-09-14   |         -5.2 |             -5.7 |         -0.5 | False         
[INFO] 2024-11-14   |          2.3 |              2.0 |         -0.3 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-03-14, 2022-05-14, 2023-07-14, 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 16
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 16 periods (31.25% win rate)
[INFO] Updating Excel file with Hierarchical results for US...
[INFO] Excel file updated successfully. Added US with Hierarchical win rate 31.2% in row 51
[INFO] Added best Sharpe parameters 62/94 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 62, Long SMA: 94
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(40/96) - Original Sharpe: 0.7798
[INFO] Added cluster 2 to portfolio: SMA(56/62) - Original Sharpe: 0.7735
[INFO] Added cluster 3 to portfolio: SMA(38/152) - Original Sharpe: 0.5535
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'US_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1923
[INFO] Hierarchical Best out-of-sample Sharpe: 0.1936
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for US...
[INFO] Excel file updated successfully. Added US with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\US
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for VX in column D: 52.0
[INFO] Using slippage from Excel column D: 52.0
[INFO] 
Symbol: @VX
[INFO] Description: CBOE Volatility Index Continuous Contract [Apr25]
[INFO] Exchange: CBOEF
[INFO] Interval: minutes 1440
[INFO] Tick size: 50.0
[INFO] Big point value: 1000.0
[INFO] Data shape: (3881, 6)
[INFO] Date range: 2010-01-04 15:11:00 to 2025-04-07 15:11:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2010-01-04 15:11:00  206.67  206.77  206.37  206.47  1756.0
1 2010-01-05 15:11:00  206.32  206.57  205.97  205.97  2689.0
2 2010-01-06 15:11:00  205.82  205.82  205.17  205.27   815.0
3 2010-01-07 15:11:00  205.17  205.42  204.72  204.87   683.0
4 2010-01-08 15:11:00  204.82  204.87  204.27  204.42   670.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 23.48 seconds (0.39 minutes)
[INFO] Best parameters found: Short SMA = 20, Long SMA = 24
[INFO] Best fitness (Sharpe ratio): 0.395811
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 20, Long SMA = 24, Sharpe = 0.395811
[INFO] Top 2: Short SMA = 20, Long SMA = 36, Sharpe = 0.376587
[INFO] Top 3: Short SMA = 18, Long SMA = 36, Sharpe = 0.372733
[INFO] Top 4: Short SMA = 42, Long SMA = 46, Sharpe = 0.285923
[INFO] Top 5: Short SMA = 238, Long SMA = 242, Sharpe = 0.258230
[INFO] Hall of Fame size: 2182
[INFO] Number of elements in all_results: 2093
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 89 had penalty fitness
[INFO] Total filtered from Hall of Fame: 89
[INFO] Hall of Fame -> all_results: 2182 -> 2093
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2093 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3072, Evaluation data length: 2811
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @VX
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 6.89 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $361,700.00
[INFO] Market Buy & Hold P&L: $-118,870.00
[INFO] Outperformance: $480,570.00
[INFO] Sharpe ratio (entire period, annualized): 0.230896
[INFO] Sharpe ratio (in-sample, annualized): 0.091099
[INFO] Sharpe ratio (out-of-sample, annualized): 0.642281
[INFO] Maximum Drawdown: $342,010.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $82,700.00
[INFO] Out-of-sample P&L: $200,190.00
[INFO] 
Best parameters from GA: Short SMA = 20, Long SMA = 24, Sharpe = 0.395811
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2182
[INFO] Cache hits (repeated combinations): 6428
[INFO] Total checks: 8610
[INFO] Cache hit rate: 74.66%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 52.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2093 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.5684 to 0.3958
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 24
[INFO] Sharpe Ratio: 0.395811
[INFO] Number of Trades: 89
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2093 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.5684 to 0.3958
[INFO] Trades range: 10.0 to 143.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5981 to 1.9419
[INFO] Scaled Long SMA range: -3.3799 to 1.1511
[INFO] Scaled Sharpe ratio range: -1.9924 to 3.2378
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 197 elements
[INFO] Kmeans Cluster 1: 79 elements
[INFO] Kmeans Cluster 2: 167 elements
[INFO] Kmeans Cluster 3: 138 elements
[INFO] Kmeans Cluster 4: 115 elements
[INFO] Kmeans Cluster 5: 37 elements
[INFO] Kmeans Cluster 6: 232 elements
[INFO] Kmeans Cluster 7: 119 elements
[INFO] Kmeans Cluster 8: 184 elements
[INFO] Kmeans Cluster 9: 218 elements
[INFO] Kmeans Cluster 10: 167 elements
[INFO] Kmeans Cluster 11: 157 elements
[INFO] Kmeans Cluster 12: 126 elements
[INFO] Kmeans Cluster 13: 86 elements
[INFO] Kmeans Cluster 14: 71 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=192.79, Long SMA=267.51, Sharpe=0.0142
[INFO] Centroid 1: Short SMA=47.82, Long SMA=128.58, Sharpe=-0.1558
[INFO] Centroid 2: Short SMA=140.53, Long SMA=259.87, Sharpe=-0.3365
[INFO] Centroid 3: Short SMA=267.35, Long SMA=288.10, Sharpe=-0.2492
[INFO] Centroid 4: Short SMA=18.43, Long SMA=264.61, Sharpe=-0.1645
[INFO] Centroid 5: Short SMA=25.73, Long SMA=60.05, Sharpe=0.1349
[INFO] Centroid 6: Short SMA=93.08, Long SMA=240.93, Sharpe=-0.4522
[INFO] Centroid 7: Short SMA=235.66, Long SMA=249.39, Sharpe=0.1495
[INFO] Centroid 8: Short SMA=199.66, Long SMA=238.66, Sharpe=-0.1015
[INFO] Centroid 9: Short SMA=229.98, Long SMA=277.15, Sharpe=-0.0713
[INFO] Centroid 10: Short SMA=162.00, Long SMA=197.43, Sharpe=-0.3975
[INFO] Centroid 11: Short SMA=48.32, Long SMA=261.97, Sharpe=-0.3615
[INFO] Centroid 12: Short SMA=94.37, Long SMA=144.97, Sharpe=-0.3139
[INFO] Centroid 13: Short SMA=31.16, Long SMA=63.51, Sharpe=-0.0726
[INFO] Centroid 14: Short SMA=31.07, Long SMA=192.06, Sharpe=-0.2323
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=24, Sharpe=0.3958, Trades=89
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=236, Long SMA=250, Sharpe=0.1560, Trades=14
[INFO] Kmeans Top 2: Short SMA=28, Long SMA=56, Sharpe=0.0431, Trades=26
[INFO] Kmeans Top 3: Short SMA=192, Long SMA=266, Sharpe=-0.0195, Trades=10
[INFO] Kmeans Top 4: Short SMA=200, Long SMA=238, Sharpe=-0.0587, Trades=10
[INFO] Kmeans Top 5: Short SMA=28, Long SMA=62, Sharpe=-0.0643, Trades=28
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (193, 268)
[INFO]   Nearest: (192.0, 268.0)
[INFO]   Rounded: (48, 129)
[INFO]   Nearest: (48.0, 128.0)
[INFO]   Rounded: (141, 260)
[INFO]   Nearest: (140.0, 260.0)
[INFO]   Rounded: (267, 288)
[INFO]   Nearest: (268.0, 288.0)
[INFO]   Rounded: (18, 265)
[INFO]   Nearest: (18.0, 264.0)
[INFO]   Rounded: (26, 60)
[INFO]   Rounded: (93, 241)
[INFO]   Nearest: (94.0, 240.0)
[INFO]   Rounded: (236, 249)
[INFO]   Nearest: (236.0, 250.0)
[INFO]   Rounded: (200, 239)
[INFO]   Nearest: (200.0, 238.0)
[INFO]   Rounded: (230, 277)
[INFO]   Nearest: (230.0, 278.0)
[INFO]   Rounded: (162, 197)
[INFO]   Nearest: (162.0, 198.0)
[INFO]   Rounded: (48, 262)
[INFO]   Rounded: (94, 145)
[INFO]   Nearest: (94.0, 144.0)
[INFO]   Rounded: (31, 64)
[INFO]   Nearest: (32.0, 62.0)
[INFO]   Rounded: (31, 192)
[INFO]   Nearest: (32.0, 192.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 24
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] File size: 186438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(236/250) - Original Sharpe: 0.1560, Trades: 14
[INFO] Kmeans cluster 2: SMA(28/56) - Original Sharpe: 0.0431, Trades: 26
[INFO] Kmeans cluster 3: SMA(192/266) - Original Sharpe: -0.0195, Trades: 10
[INFO] Kmeans cluster 4: SMA(200/238) - Original Sharpe: -0.0587, Trades: 10
[INFO] Kmeans cluster 5: SMA(28/62) - Original Sharpe: -0.0643, Trades: 28
[INFO] Trimmed warm-up period. Evaluation data length: 2811
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/24)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 24
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] No Kmeans clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] Error: No Kmeans cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\VX
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 52.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2093 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.5684 to 0.3958
[INFO] 
Best parameters:
[INFO] Short SMA: 20
[INFO] Long SMA: 24
[INFO] Sharpe Ratio: 0.395811
[INFO] Number of Trades: 89
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2093 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.5684 to 0.3958
[INFO] Trades range: 10.0 to 143.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.5981 to 1.9419
[INFO] Scaled Long SMA range: -3.3799 to 1.1511
[INFO] Scaled Sharpe ratio range: -1.9924 to 3.2378
[INFO] Scaled Trades range: -0.4578 to 15.3155
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2093 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.5861
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 17
[INFO] Using 17 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 17 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 55 elements
[INFO] Cluster 1: 45 elements
[INFO] Cluster 2: 146 elements
[INFO] Cluster 3: 213 elements
[INFO] Cluster 4: 160 elements
[INFO] Cluster 5: 237 elements
[INFO] Cluster 6: 327 elements
[INFO] Cluster 7: 119 elements
[INFO] Cluster 8: 174 elements
[INFO] Cluster 9: 48 elements
[INFO] Cluster 10: 107 elements
[INFO] Cluster 11: 100 elements
[INFO] Cluster 12: 7 elements
[INFO] Cluster 13: 91 elements
[INFO] Cluster 14: 2 elements
[INFO] Cluster 15: 63 elements
[INFO] Cluster 16: 199 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=22, Long SMA=44, Sharpe=-0.0284, Trades=42
[INFO] Cluster 1 cluster: Short SMA=266, Long SMA=268, Sharpe=-0.1703, Trades=30
[INFO] Cluster 2 cluster: Short SMA=96, Long SMA=142, Sharpe=-0.2944, Trades=14
[INFO] Cluster 3 cluster: Short SMA=42, Long SMA=242, Sharpe=-0.3296, Trades=12
[INFO] Cluster 4 cluster: Short SMA=146, Long SMA=248, Sharpe=-0.3784, Trades=10
[INFO] Cluster 5 cluster: Short SMA=94, Long SMA=254, Sharpe=-0.4698, Trades=10
[INFO] Cluster 6 cluster: Short SMA=198, Long SMA=258, Sharpe=-0.0541, Trades=10
[INFO] Cluster 7 cluster: Short SMA=234, Long SMA=250, Sharpe=0.1637, Trades=14
[INFO] Cluster 8 cluster: Short SMA=152, Long SMA=198, Sharpe=-0.3418, Trades=12
[INFO] Cluster 9 cluster: Short SMA=30, Long SMA=70, Sharpe=-0.0682, Trades=24
[INFO] Cluster 10 cluster: Short SMA=268, Long SMA=288, Sharpe=-0.2292, Trades=12
[INFO] Cluster 11 cluster: Short SMA=20, Long SMA=258, Sharpe=-0.1354, Trades=16
[INFO] Cluster 13 cluster: Short SMA=30, Long SMA=132, Sharpe=-0.1388, Trades=16
[INFO] Cluster 15 cluster: Short SMA=194, Long SMA=224, Sharpe=-0.2058, Trades=10
[INFO] Cluster 16 cluster: Short SMA=230, Long SMA=280, Sharpe=-0.0730, Trades=10
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=20, Long SMA=24, Sharpe=0.3958, Trades=89
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=234, Long SMA=250, Sharpe=0.1637, Trades=14
[INFO] Top 2: Short SMA=22, Long SMA=44, Sharpe=-0.0284, Trades=42
[INFO] Top 3: Short SMA=198, Long SMA=258, Sharpe=-0.0541, Trades=10
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 2084 points from valid clusters
[INFO] Warning: Max Sharpe point at (20.0, 24.0) not found in heatmap coordinates
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 20, Long SMA: 24
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading VX data from local files...
[INFO] Found data file: A_OHLCV_@VX_minutes_1440_0831-1511.dat
[INFO] File size: 186438 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(234/250) - Original Sharpe: 0.1637, Trades: 14
[INFO] Hierarchical cluster 2: SMA(22/44) - Original Sharpe: -0.0284, Trades: 42
[INFO] Hierarchical cluster 3: SMA(198/258) - Original Sharpe: -0.0541, Trades: 10
[INFO] Hierarchical cluster 4: SMA(30/70) - Original Sharpe: -0.0682, Trades: 24
[INFO] Hierarchical cluster 5: SMA(230/280) - Original Sharpe: -0.0730, Trades: 10
[INFO] Trimmed warm-up period. Evaluation data length: 2811
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (20/24)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Comparison cannot be performed.
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 20, Long SMA: 24
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] No Hierarchical clusters have a Sharpe ratio >= 0.2. Using only the Best strategy for comparison.
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] Error: No Hierarchical cluster strategies found to create portfolio
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\VX
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for W in column D: 15.0
[INFO] Using slippage from Excel column D: 15.0
[INFO] 
Symbol: @WBS=107XC
[INFO] Description: WTI Crude Custom Continuous Contract
[INFO] Exchange: ICE
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 1000.0
[INFO] Data shape: (4290, 6)
[INFO] Date range: 2008-08-25 16:50:00 to 2025-04-07 16:50:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close   volume
0 2008-08-25 16:50:00  167.33  168.84  166.40  168.05  24079.0
1 2008-08-26 16:50:00  168.13  170.63  165.21  168.99  53425.0
2 2008-08-27 16:50:00  168.87  172.35  168.85  171.04  39408.0
3 2008-08-28 16:50:00  171.10  173.23  166.80  168.37  48079.0
4 2008-08-29 16:50:00  169.06  171.49  167.74  168.29  33153.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 33.04 seconds (0.55 minutes)
[INFO] Best parameters found: Short SMA = 42, Long SMA = 48
[INFO] Best fitness (Sharpe ratio): 0.871740
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 42, Long SMA = 48, Sharpe = 0.871740
[INFO] Top 2: Short SMA = 38, Long SMA = 60, Sharpe = 0.847350
[INFO] Top 3: Short SMA = 38, Long SMA = 58, Sharpe = 0.823684
[INFO] Top 4: Short SMA = 42, Long SMA = 50, Sharpe = 0.800912
[INFO] Top 5: Short SMA = 38, Long SMA = 48, Sharpe = 0.795196
[INFO] Hall of Fame size: 2606
[INFO] Number of elements in all_results: 2451
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 155 had penalty fitness
[INFO] Total filtered from Hall of Fame: 155
[INFO] Hall of Fame -> all_results: 2606 -> 2451
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2451 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3107, Evaluation data length: 2840
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @WBS=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.86 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $114,220.00
[INFO] Market Buy & Hold P&L: $-29,470.00
[INFO] Outperformance: $143,690.00
[INFO] Sharpe ratio (entire period, annualized): 0.145179
[INFO] Sharpe ratio (in-sample, annualized): 0.378576
[INFO] Sharpe ratio (out-of-sample, annualized): -0.372591
[INFO] Maximum Drawdown: $324,110.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $225,760.00
[INFO] Out-of-sample P&L: $-100,130.00
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 48, Sharpe = 0.871740
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2606
[INFO] Cache hits (repeated combinations): 6089
[INFO] Total checks: 8695
[INFO] Cache hit rate: 70.03%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2451 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.5339 to 0.8717
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 48
[INFO] Sharpe Ratio: 0.871740
[INFO] Number of Trades: 60
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2451 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.5339 to 0.8717
[INFO] Trades range: 10.0 to 178.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1694 to 2.4148
[INFO] Scaled Long SMA range: -2.4756 to 1.3982
[INFO] Scaled Sharpe ratio range: -3.5940 to 3.1255
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 109 elements
[INFO] Kmeans Cluster 1: 182 elements
[INFO] Kmeans Cluster 2: 303 elements
[INFO] Kmeans Cluster 3: 137 elements
[INFO] Kmeans Cluster 4: 197 elements
[INFO] Kmeans Cluster 5: 88 elements
[INFO] Kmeans Cluster 6: 138 elements
[INFO] Kmeans Cluster 7: 84 elements
[INFO] Kmeans Cluster 8: 229 elements
[INFO] Kmeans Cluster 9: 162 elements
[INFO] Kmeans Cluster 10: 147 elements
[INFO] Kmeans Cluster 11: 104 elements
[INFO] Kmeans Cluster 12: 146 elements
[INFO] Kmeans Cluster 13: 243 elements
[INFO] Kmeans Cluster 14: 182 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=267.03, Long SMA=291.83, Sharpe=-0.2251
[INFO] Centroid 1: Short SMA=43.65, Long SMA=235.90, Sharpe=0.1430
[INFO] Centroid 2: Short SMA=195.79, Long SMA=250.09, Sharpe=0.2150
[INFO] Centroid 3: Short SMA=27.91, Long SMA=54.09, Sharpe=0.6411
[INFO] Centroid 4: Short SMA=29.04, Long SMA=66.55, Sharpe=0.4026
[INFO] Centroid 5: Short SMA=96.16, Long SMA=140.98, Sharpe=-0.2076
[INFO] Centroid 6: Short SMA=133.07, Long SMA=265.13, Sharpe=0.0647
[INFO] Centroid 7: Short SMA=139.88, Long SMA=171.67, Sharpe=0.0133
[INFO] Centroid 8: Short SMA=37.14, Long SMA=202.23, Sharpe=0.2703
[INFO] Centroid 9: Short SMA=24.47, Long SMA=268.28, Sharpe=0.3672
[INFO] Centroid 10: Short SMA=223.03, Long SMA=277.67, Sharpe=0.0162
[INFO] Centroid 11: Short SMA=190.21, Long SMA=215.56, Sharpe=0.4384
[INFO] Centroid 12: Short SMA=36.37, Long SMA=165.78, Sharpe=0.1283
[INFO] Centroid 13: Short SMA=135.87, Long SMA=204.23, Sharpe=0.2883
[INFO] Centroid 14: Short SMA=38.24, Long SMA=115.38, Sharpe=0.2767
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=48, Sharpe=0.8717, Trades=60
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=32, Long SMA=54, Sharpe=0.6066, Trades=40
[INFO] Kmeans Top 2: Short SMA=32, Long SMA=66, Sharpe=0.4824, Trades=34
[INFO] Kmeans Top 3: Short SMA=198, Long SMA=214, Sharpe=0.4139, Trades=20
[INFO] Kmeans Top 4: Short SMA=200, Long SMA=252, Sharpe=0.3244, Trades=12
[INFO] Kmeans Top 5: Short SMA=38, Long SMA=116, Sharpe=0.3150, Trades=17
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (267, 292)
[INFO]   Nearest: (268.0, 292.0)
[INFO]   Rounded: (44, 236)
[INFO]   Rounded: (196, 250)
[INFO]   Rounded: (28, 54)
[INFO]   Rounded: (29, 67)
[INFO]   Nearest: (30.0, 66.0)
[INFO]   Rounded: (96, 141)
[INFO]   Nearest: (96.0, 140.0)
[INFO]   Rounded: (133, 265)
[INFO]   Nearest: (134.0, 266.0)
[INFO]   Rounded: (140, 172)
[INFO]   Rounded: (37, 202)
[INFO]   Nearest: (38.0, 202.0)
[INFO]   Rounded: (24, 268)
[INFO]   Rounded: (223, 278)
[INFO]   Nearest: (224.0, 278.0)
[INFO]   Rounded: (190, 216)
[INFO]   Rounded: (36, 166)
[INFO]   Rounded: (136, 204)
[INFO]   Rounded: (38, 115)
[INFO]   Nearest: (38.0, 116.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 48
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(32/54) - Original Sharpe: 0.6066, Trades: 40
[INFO] Kmeans cluster 2: SMA(32/66) - Original Sharpe: 0.4824, Trades: 34
[INFO] Kmeans cluster 3: SMA(198/214) - Original Sharpe: 0.4139, Trades: 20
[INFO] Kmeans cluster 4: SMA(200/252) - Original Sharpe: 0.3244, Trades: 12
[INFO] Kmeans cluster 5: SMA(38/116) - Original Sharpe: 0.3150, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/48)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (32/54) - Sharpe: 0.6066
[INFO] cluster 2: (32/66) - Sharpe: 0.4824
[INFO] cluster 3: (198/214) - Sharpe: 0.4139
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.757978            1.449577
1    2021-11-14 2021-11-14            44    -3.311527           -2.550121
2    2022-01-14 2022-01-14            41     1.622963            2.774095
3    2022-03-14 2022-03-14            44     0.095352           -0.503463
4    2022-05-14 2022-05-14            43    -2.906948           -1.270080
5    2022-07-14 2022-07-14            44     1.646765            2.304120
6    2022-09-14 2022-09-14            43    -1.432176            0.450531
7    2022-11-14 2022-11-14            43    -3.886773           -4.805723
8    2023-01-14 2023-01-14            41    -2.644499            3.336960
9    2023-03-14 2023-03-14            43    -1.046856            0.983141
10   2023-05-14 2023-05-14            44    -2.267997           -1.025441
11   2023-07-14 2023-07-14            44     2.698953            2.099622
12   2023-09-14 2023-09-14            43    -1.782159           -1.379331
13   2023-11-14 2023-11-14            42     1.458682            1.566323
14   2024-01-14 2024-01-14            43     1.502443            1.400779
15   2024-03-14 2024-03-14            42     0.280722            0.280722
16   2024-05-14 2024-05-14            44    -3.342810           -2.187751
17   2024-07-14 2024-07-14            45    -0.830865           -0.714571
18   2024-09-14 2024-09-14            43    -1.952172           -0.667914
19   2024-11-14 2024-11-14            33     0.263080           -0.630452
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.8 |              1.4 |          3.2 | True          
[INFO] 2021-11-14   |         -3.3 |             -2.6 |          0.7 | True          
[INFO] 2022-01-14   |          1.6 |              2.8 |          1.2 | True          
[INFO] 2022-03-14   |          0.1 |             -0.5 |         -0.6 | False         
[INFO] 2022-05-14   |         -2.9 |             -1.3 |          1.6 | True          
[INFO] 2022-07-14   |          1.6 |              2.3 |          0.7 | True          
[INFO] 2022-09-14   |         -1.4 |              0.5 |          1.9 | True          
[INFO] 2022-11-14   |         -3.9 |             -4.8 |         -0.9 | False         
[INFO] 2023-01-14   |         -2.6 |              3.3 |          5.9 | True          
[INFO] 2023-03-14   |         -1.0 |              1.0 |          2.0 | True          
[INFO] 2023-05-14   |         -2.3 |             -1.0 |          1.3 | True          
[INFO] 2023-07-14   |          2.7 |              2.1 |         -0.6 | False         
[INFO] 2023-09-14   |         -1.8 |             -1.4 |          0.4 | True          
[INFO] 2023-11-14   |          1.5 |              1.6 |          0.1 | True          
[INFO] 2024-01-14   |          1.5 |              1.4 |         -0.1 | False         
[INFO] 2024-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -3.3 |             -2.2 |          1.1 | True          
[INFO] 2024-07-14   |         -0.8 |             -0.7 |          0.1 | True          
[INFO] 2024-09-14   |         -2.0 |             -0.7 |          1.3 | True          
[INFO] 2024-11-14   |          0.3 |             -0.6 |         -0.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 14 of 19 periods (73.68% win rate)
[INFO] Updating Excel file with Kmeans results for W...
[INFO] Excel file updated successfully. Added W with Kmeans win rate 73.7% in row 52
[INFO] Added best Sharpe parameters 42/48 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 48
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(32/54) - Original Sharpe: 0.6066
[INFO] Added cluster 2 to portfolio: SMA(32/66) - Original Sharpe: 0.4824
[INFO] Added cluster 3 to portfolio: SMA(198/214) - Original Sharpe: 0.4139
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'W_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0252
[INFO] Kmeans Best out-of-sample Sharpe: -0.8739
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for W...
[INFO] Excel file updated successfully. Added W with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\W
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 15.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2451 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.5339 to 0.8717
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 48
[INFO] Sharpe Ratio: 0.871740
[INFO] Number of Trades: 60
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2451 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.5339 to 0.8717
[INFO] Trades range: 10.0 to 178.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1694 to 2.4148
[INFO] Scaled Long SMA range: -2.4756 to 1.3982
[INFO] Scaled Sharpe ratio range: -3.5940 to 3.1255
[INFO] Scaled Trades range: -0.7246 to 11.0636
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2451 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6666
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 16
[INFO] Using 16 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 16 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 243 elements
[INFO] Cluster 1: 346 elements
[INFO] Cluster 2: 196 elements
[INFO] Cluster 3: 41 elements
[INFO] Cluster 4: 130 elements
[INFO] Cluster 5: 110 elements
[INFO] Cluster 6: 108 elements
[INFO] Cluster 7: 277 elements
[INFO] Cluster 8: 182 elements
[INFO] Cluster 9: 284 elements
[INFO] Cluster 10: 6 elements
[INFO] Cluster 11: 228 elements
[INFO] Cluster 12: 66 elements
[INFO] Cluster 13: 74 elements
[INFO] Cluster 14: 67 elements
[INFO] Cluster 15: 93 elements
[INFO] Using 15 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=194, Long SMA=278, Sharpe=0.1331, Trades=11
[INFO] Cluster 1 cluster: Short SMA=38, Long SMA=196, Sharpe=0.3768, Trades=17
[INFO] Cluster 2 cluster: Short SMA=66, Long SMA=246, Sharpe=0.1232, Trades=12
[INFO] Cluster 3 cluster: Short SMA=28, Long SMA=32, Sharpe=0.3654, Trades=83
[INFO] Cluster 4 cluster: Short SMA=28, Long SMA=60, Sharpe=0.5651, Trades=40
[INFO] Cluster 5 cluster: Short SMA=272, Long SMA=290, Sharpe=-0.2732, Trades=17
[INFO] Cluster 6 cluster: Short SMA=90, Long SMA=152, Sharpe=-0.1742, Trades=15
[INFO] Cluster 7 cluster: Short SMA=146, Long SMA=206, Sharpe=0.2260, Trades=14
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=266, Sharpe=0.2393, Trades=13
[INFO] Cluster 9 cluster: Short SMA=200, Long SMA=254, Sharpe=0.3225, Trades=12
[INFO] Cluster 11 cluster: Short SMA=38, Long SMA=122, Sharpe=0.3485, Trades=19
[INFO] Cluster 12 cluster: Short SMA=26, Long SMA=46, Sharpe=0.3972, Trades=49
[INFO] Cluster 13 cluster: Short SMA=150, Long SMA=162, Sharpe=0.0427, Trades=26
[INFO] Cluster 14 cluster: Short SMA=200, Long SMA=212, Sharpe=0.4898, Trades=20
[INFO] Cluster 15 cluster: Short SMA=22, Long SMA=84, Sharpe=0.3998, Trades=24
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=48, Sharpe=0.8717, Trades=60
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=28, Long SMA=60, Sharpe=0.5651, Trades=40
[INFO] Top 2: Short SMA=200, Long SMA=212, Sharpe=0.4898, Trades=20
[INFO] Top 3: Short SMA=22, Long SMA=84, Sharpe=0.3998, Trades=24
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 15 valid clusters with clusters
[INFO] Filtering to 2445 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 48
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(28/60) - Original Sharpe: 0.5651, Trades: 40
[INFO] Hierarchical cluster 2: SMA(200/212) - Original Sharpe: 0.4898, Trades: 20
[INFO] Hierarchical cluster 3: SMA(22/84) - Original Sharpe: 0.3998, Trades: 24
[INFO] Hierarchical cluster 4: SMA(26/46) - Original Sharpe: 0.3972, Trades: 49
[INFO] Hierarchical cluster 5: SMA(38/196) - Original Sharpe: 0.3768, Trades: 17
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/48)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (28/60) - Sharpe: 0.5651
[INFO] cluster 2: (200/212) - Sharpe: 0.4898
[INFO] cluster 3: (22/84) - Sharpe: 0.3998
[INFO] Loading W data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.757978            2.646485
1    2021-11-14 2021-11-14            44    -3.311527           -2.550121
2    2022-01-14 2022-01-14            41     1.622963            2.809055
3    2022-03-14 2022-03-14            44     0.095352            0.418359
4    2022-05-14 2022-05-14            43    -2.906948           -1.047199
5    2022-07-14 2022-07-14            44     1.646765            3.076752
6    2022-09-14 2022-09-14            43    -1.432176           -1.628094
7    2022-11-14 2022-11-14            43    -3.886773           -3.898820
8    2023-01-14 2023-01-14            41    -2.644499            1.668051
9    2023-03-14 2023-03-14            43    -1.046856           -0.498347
10   2023-05-14 2023-05-14            44    -2.267997           -1.470113
11   2023-07-14 2023-07-14            44     2.698953            2.817052
12   2023-09-14 2023-09-14            43    -1.782159           -2.037096
13   2023-11-14 2023-11-14            42     1.458682            1.451903
14   2024-01-14 2024-01-14            43     1.502443            0.743578
15   2024-03-14 2024-03-14            42     0.280722            0.280722
16   2024-05-14 2024-05-14            44    -3.342810           -1.842432
17   2024-07-14 2024-07-14            45    -0.830865           -1.242788
18   2024-09-14 2024-09-14            43    -1.952172           -1.795182
19   2024-11-14 2024-11-14            33     0.263080           -3.311933
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -1.8 |              2.6 |          4.4 | True          
[INFO] 2021-11-14   |         -3.3 |             -2.6 |          0.7 | True          
[INFO] 2022-01-14   |          1.6 |              2.8 |          1.2 | True          
[INFO] 2022-03-14   |          0.1 |              0.4 |          0.3 | True          
[INFO] 2022-05-14   |         -2.9 |             -1.0 |          1.9 | True          
[INFO] 2022-07-14   |          1.6 |              3.1 |          1.5 | True          
[INFO] 2022-09-14   |         -1.4 |             -1.6 |         -0.2 | False         
[INFO] 2022-11-14   |         -3.9 |             -3.9 |          0.0 | Excluded      
[INFO] 2023-01-14   |         -2.6 |              1.7 |          4.3 | True          
[INFO] 2023-03-14   |         -1.0 |             -0.5 |          0.5 | True          
[INFO] 2023-05-14   |         -2.3 |             -1.5 |          0.8 | True          
[INFO] 2023-07-14   |          2.7 |              2.8 |          0.1 | True          
[INFO] 2023-09-14   |         -1.8 |             -2.0 |         -0.2 | False         
[INFO] 2023-11-14   |          1.5 |              1.5 |          0.0 | Excluded      
[INFO] 2024-01-14   |          1.5 |              0.7 |         -0.8 | False         
[INFO] 2024-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -3.3 |             -1.8 |          1.5 | True          
[INFO] 2024-07-14   |         -0.8 |             -1.2 |         -0.4 | False         
[INFO] 2024-09-14   |         -2.0 |             -1.8 |          0.2 | True          
[INFO] 2024-11-14   |          0.3 |             -3.3 |         -3.6 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-11-14, 2023-11-14, 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 17
[INFO] Hierarchical cluster wins (rounded comparison): 12 of 17 periods (70.59% win rate)
[INFO] Updating Excel file with Hierarchical results for W...
[INFO] Excel file updated successfully. Added W with Hierarchical win rate 70.6% in row 52
[INFO] Added best Sharpe parameters 42/48 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 48
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(28/60) - Original Sharpe: 0.5651
[INFO] Added cluster 2 to portfolio: SMA(200/212) - Original Sharpe: 0.4898
[INFO] Added cluster 3 to portfolio: SMA(22/84) - Original Sharpe: 0.3998
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'W_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1213
[INFO] Hierarchical Best out-of-sample Sharpe: -0.8739
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for W...
[INFO] Excel file updated successfully. Added W with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\W
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for WBS in column D: 17.0
[INFO] Using slippage from Excel column D: 17.0
[INFO] 
Symbol: @WBS=107XC
[INFO] Description: WTI Crude Custom Continuous Contract
[INFO] Exchange: ICE
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 1000.0
[INFO] Data shape: (4290, 6)
[INFO] Date range: 2008-08-25 16:50:00 to 2025-04-07 16:50:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close   volume
0 2008-08-25 16:50:00  167.33  168.84  166.40  168.05  24079.0
1 2008-08-26 16:50:00  168.13  170.63  165.21  168.99  53425.0
2 2008-08-27 16:50:00  168.87  172.35  168.85  171.04  39408.0
3 2008-08-28 16:50:00  171.10  173.23  166.80  168.37  48079.0
4 2008-08-29 16:50:00  169.06  171.49  167.74  168.29  33153.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 24.76 seconds (0.41 minutes)
[INFO] Best parameters found: Short SMA = 48, Long SMA = 50
[INFO] Best fitness (Sharpe ratio): 0.885528
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 48, Long SMA = 50, Sharpe = 0.885528
[INFO] Top 2: Short SMA = 42, Long SMA = 48, Sharpe = 0.870900
[INFO] Top 3: Short SMA = 38, Long SMA = 58, Sharpe = 0.823086
[INFO] Top 4: Short SMA = 42, Long SMA = 50, Sharpe = 0.800168
[INFO] Top 5: Short SMA = 36, Long SMA = 38, Sharpe = 0.794649
[INFO] Hall of Fame size: 2604
[INFO] Number of elements in all_results: 2453
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 151 had penalty fitness
[INFO] Total filtered from Hall of Fame: 151
[INFO] Hall of Fame -> all_results: 2604 -> 2453
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2453 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3107, Evaluation data length: 2840
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @WBS=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.86 contracts
[INFO] Maximum Position Size: 7 contracts
[INFO] Strategy Total P&L: $114,220.00
[INFO] Market Buy & Hold P&L: $-29,470.00
[INFO] Outperformance: $143,690.00
[INFO] Sharpe ratio (entire period, annualized): 0.145179
[INFO] Sharpe ratio (in-sample, annualized): 0.378576
[INFO] Sharpe ratio (out-of-sample, annualized): -0.372591
[INFO] Maximum Drawdown: $324,110.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 0
[INFO] Out-of-sample period trades: 0
[INFO] Total trades: 0
[INFO] In-sample P&L: $225,760.00
[INFO] Out-of-sample P&L: $-100,130.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 50, Sharpe = 0.885528
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2604
[INFO] Cache hits (repeated combinations): 6133
[INFO] Total checks: 8737
[INFO] Cache hit rate: 70.20%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2453 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5343 to 0.8855
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.885528
[INFO] Number of Trades: 108
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2453 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5343 to 0.8855
[INFO] Trades range: 10.0 to 220.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1675 to 2.4159
[INFO] Scaled Long SMA range: -2.5091 to 1.3948
[INFO] Scaled Sharpe ratio range: -3.6095 to 3.1962
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 175 elements
[INFO] Kmeans Cluster 1: 149 elements
[INFO] Kmeans Cluster 2: 176 elements
[INFO] Kmeans Cluster 3: 231 elements
[INFO] Kmeans Cluster 4: 257 elements
[INFO] Kmeans Cluster 5: 109 elements
[INFO] Kmeans Cluster 6: 114 elements
[INFO] Kmeans Cluster 7: 143 elements
[INFO] Kmeans Cluster 8: 108 elements
[INFO] Kmeans Cluster 9: 298 elements
[INFO] Kmeans Cluster 10: 186 elements
[INFO] Kmeans Cluster 11: 112 elements
[INFO] Kmeans Cluster 12: 136 elements
[INFO] Kmeans Cluster 13: 216 elements
[INFO] Kmeans Cluster 14: 43 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=24.97, Long SMA=267.91, Sharpe=0.3613
[INFO] Centroid 1: Short SMA=222.46, Long SMA=275.11, Sharpe=0.0146
[INFO] Centroid 2: Short SMA=27.33, Long SMA=59.65, Sharpe=0.4297
[INFO] Centroid 3: Short SMA=36.02, Long SMA=201.90, Sharpe=0.2718
[INFO] Centroid 4: Short SMA=135.56, Long SMA=203.84, Sharpe=0.2730
[INFO] Centroid 5: Short SMA=118.42, Long SMA=161.63, Sharpe=-0.0629
[INFO] Centroid 6: Short SMA=187.60, Long SMA=213.70, Sharpe=0.4323
[INFO] Centroid 7: Short SMA=37.87, Long SMA=160.04, Sharpe=0.1417
[INFO] Centroid 8: Short SMA=267.56, Long SMA=291.76, Sharpe=-0.2261
[INFO] Centroid 9: Short SMA=196.87, Long SMA=250.19, Sharpe=0.2164
[INFO] Centroid 10: Short SMA=44.67, Long SMA=235.31, Sharpe=0.1385
[INFO] Centroid 11: Short SMA=29.84, Long SMA=53.93, Sharpe=0.6632
[INFO] Centroid 12: Short SMA=134.04, Long SMA=265.68, Sharpe=0.0614
[INFO] Centroid 13: Short SMA=36.77, Long SMA=109.20, Sharpe=0.2985
[INFO] Centroid 14: Short SMA=96.00, Long SMA=131.16, Sharpe=-0.3034
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8855, Trades=108
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=34, Long SMA=52, Sharpe=0.7111, Trades=44
[INFO] Kmeans Top 2: Short SMA=26, Long SMA=58, Sharpe=0.5397, Trades=40
[INFO] Kmeans Top 3: Short SMA=196, Long SMA=214, Sharpe=0.4398, Trades=20
[INFO] Kmeans Top 4: Short SMA=38, Long SMA=110, Sharpe=0.3736, Trades=17
[INFO] Kmeans Top 5: Short SMA=200, Long SMA=252, Sharpe=0.3242, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (25, 268)
[INFO]   Nearest: (24.0, 268.0)
[INFO]   Rounded: (222, 275)
[INFO]   Nearest: (222.0, 276.0)
[INFO]   Rounded: (27, 60)
[INFO]   Nearest: (28.0, 60.0)
[INFO]   Rounded: (36, 202)
[INFO]   Rounded: (136, 204)
[INFO]   Rounded: (118, 162)
[INFO]   Rounded: (188, 214)
[INFO]   Rounded: (38, 160)
[INFO]   Rounded: (268, 292)
[INFO]   Rounded: (197, 250)
[INFO]   Nearest: (196.0, 250.0)
[INFO]   Rounded: (45, 235)
[INFO]   Nearest: (44.0, 236.0)
[INFO]   Rounded: (30, 54)
[INFO]   Rounded: (134, 266)
[INFO]   Rounded: (37, 109)
[INFO]   Nearest: (36.0, 110.0)
[INFO]   Rounded: (96, 131)
[INFO]   Nearest: (96.0, 132.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(34/52) - Original Sharpe: 0.7111, Trades: 44
[INFO] Kmeans cluster 2: SMA(26/58) - Original Sharpe: 0.5397, Trades: 40
[INFO] Kmeans cluster 3: SMA(196/214) - Original Sharpe: 0.4398, Trades: 20
[INFO] Kmeans cluster 4: SMA(38/110) - Original Sharpe: 0.3736, Trades: 17
[INFO] Kmeans cluster 5: SMA(200/252) - Original Sharpe: 0.3242, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/52) - Sharpe: 0.7111
[INFO] cluster 2: (26/58) - Sharpe: 0.5397
[INFO] cluster 3: (196/214) - Sharpe: 0.4398
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.969108            1.754602
1    2021-11-14 2021-11-14            44    -3.439143           -2.578396
2    2022-01-14 2022-01-14            41     1.435275            2.877573
3    2022-03-14 2022-03-14            44    -2.274282           -0.503553
4    2022-05-14 2022-05-14            43    -2.490349           -1.250586
5    2022-07-14 2022-07-14            44     1.424645            2.820712
6    2022-09-14 2022-09-14            43     0.423005           -0.400085
7    2022-11-14 2022-11-14            43    -1.044126           -3.927062
8    2023-01-14 2023-01-14            41     3.087546            1.427096
9    2023-03-14 2023-03-14            43    -2.851713            0.203607
10   2023-05-14 2023-05-14            44    -0.359960           -1.741991
11   2023-07-14 2023-07-14            44     5.881769            4.220873
12   2023-09-14 2023-09-14            43    -1.305448           -0.862329
13   2023-11-14 2023-11-14            42     1.295824            1.041148
14   2024-01-14 2024-01-14            43    -0.582717            2.606665
15   2024-03-14 2024-03-14            42     0.280722            0.280722
16   2024-05-14 2024-05-14            44    -5.331792           -3.257951
17   2024-07-14 2024-07-14            45     0.232453            0.860889
18   2024-09-14 2024-09-14            43    -1.780293           -1.169932
19   2024-11-14 2024-11-14            33    -0.454091           -1.932640
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              1.8 |          3.8 | True          
[INFO] 2021-11-14   |         -3.4 |             -2.6 |          0.8 | True          
[INFO] 2022-01-14   |          1.4 |              2.9 |          1.5 | True          
[INFO] 2022-03-14   |         -2.3 |             -0.5 |          1.8 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.3 |          1.2 | True          
[INFO] 2022-07-14   |          1.4 |              2.8 |          1.4 | True          
[INFO] 2022-09-14   |          0.4 |             -0.4 |         -0.8 | False         
[INFO] 2022-11-14   |         -1.0 |             -3.9 |         -2.9 | False         
[INFO] 2023-01-14   |          3.1 |              1.4 |         -1.7 | False         
[INFO] 2023-03-14   |         -2.9 |              0.2 |          3.1 | True          
[INFO] 2023-05-14   |         -0.4 |             -1.7 |         -1.3 | False         
[INFO] 2023-07-14   |          5.9 |              4.2 |         -1.7 | False         
[INFO] 2023-09-14   |         -1.3 |             -0.9 |          0.4 | True          
[INFO] 2023-11-14   |          1.3 |              1.0 |         -0.3 | False         
[INFO] 2024-01-14   |         -0.6 |              2.6 |          3.2 | True          
[INFO] 2024-03-14   |          0.3 |              0.3 |          0.0 | Excluded      
[INFO] 2024-05-14   |         -5.3 |             -3.3 |          2.0 | True          
[INFO] 2024-07-14   |          0.2 |              0.9 |          0.7 | True          
[INFO] 2024-09-14   |         -1.8 |             -1.2 |          0.6 | True          
[INFO] 2024-11-14   |         -0.5 |             -1.9 |         -1.4 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2024-03-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 12 of 19 periods (63.16% win rate)
[INFO] Updating Excel file with Kmeans results for WBS...
[INFO] Excel file updated successfully. Added WBS with Kmeans win rate 63.2% in row 53
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/52) - Original Sharpe: 0.7111
[INFO] Added cluster 2 to portfolio: SMA(26/58) - Original Sharpe: 0.5397
[INFO] Added cluster 3 to portfolio: SMA(196/214) - Original Sharpe: 0.4398
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'WBS_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0287
[INFO] Kmeans Best out-of-sample Sharpe: -0.5515
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for WBS...
[INFO] Excel file updated successfully. Added WBS with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\WBS
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 17.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2453 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.5343 to 0.8855
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 50
[INFO] Sharpe Ratio: 0.885528
[INFO] Number of Trades: 108
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2453 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.5343 to 0.8855
[INFO] Trades range: 10.0 to 220.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1675 to 2.4159
[INFO] Scaled Long SMA range: -2.5091 to 1.3948
[INFO] Scaled Sharpe ratio range: -3.6095 to 3.1962
[INFO] Scaled Trades range: -0.7098 to 13.7118
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2453 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6028
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 18
[INFO] Using 18 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 18 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 268 elements
[INFO] Cluster 1: 227 elements
[INFO] Cluster 2: 75 elements
[INFO] Cluster 3: 236 elements
[INFO] Cluster 4: 217 elements
[INFO] Cluster 5: 26 elements
[INFO] Cluster 6: 218 elements
[INFO] Cluster 7: 96 elements
[INFO] Cluster 8: 140 elements
[INFO] Cluster 9: 110 elements
[INFO] Cluster 10: 255 elements
[INFO] Cluster 11: 136 elements
[INFO] Cluster 12: 2 elements
[INFO] Cluster 13: 93 elements
[INFO] Cluster 14: 70 elements
[INFO] Cluster 15: 52 elements
[INFO] Cluster 16: 156 elements
[INFO] Cluster 17: 76 elements
[INFO] Using 17 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=150, Long SMA=242, Sharpe=0.1563, Trades=14
[INFO] Cluster 1 cluster: Short SMA=38, Long SMA=146, Sharpe=0.3122, Trades=15
[INFO] Cluster 2 cluster: Short SMA=38, Long SMA=52, Sharpe=0.6604, Trades=48
[INFO] Cluster 3 cluster: Short SMA=32, Long SMA=200, Sharpe=0.2223, Trades=17
[INFO] Cluster 4 cluster: Short SMA=26, Long SMA=262, Sharpe=0.2823, Trades=13
[INFO] Cluster 5 cluster: Short SMA=36, Long SMA=38, Sharpe=0.7946, Trades=95
[INFO] Cluster 6 cluster: Short SMA=128, Long SMA=204, Sharpe=0.2926, Trades=12
[INFO] Cluster 7 cluster: Short SMA=96, Long SMA=144, Sharpe=-0.1586, Trades=15
[INFO] Cluster 8 cluster: Short SMA=32, Long SMA=96, Sharpe=0.3324, Trades=24
[INFO] Cluster 9 cluster: Short SMA=272, Long SMA=290, Sharpe=-0.2735, Trades=17
[INFO] Cluster 10 cluster: Short SMA=202, Long SMA=250, Sharpe=0.2587, Trades=12
[INFO] Cluster 11 cluster: Short SMA=48, Long SMA=236, Sharpe=0.1619, Trades=13
[INFO] Cluster 13 cluster: Short SMA=26, Long SMA=46, Sharpe=0.3965, Trades=49
[INFO] Cluster 14 cluster: Short SMA=150, Long SMA=162, Sharpe=0.0424, Trades=26
[INFO] Cluster 15 cluster: Short SMA=200, Long SMA=212, Sharpe=0.4895, Trades=20
[INFO] Cluster 16 cluster: Short SMA=222, Long SMA=278, Sharpe=0.0341, Trades=13
[INFO] Cluster 17 cluster: Short SMA=24, Long SMA=62, Sharpe=0.4508, Trades=36
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=50, Sharpe=0.8855, Trades=108
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=36, Long SMA=38, Sharpe=0.7946, Trades=95
[INFO] Top 2: Short SMA=38, Long SMA=52, Sharpe=0.6604, Trades=48
[INFO] Top 3: Short SMA=200, Long SMA=212, Sharpe=0.4895, Trades=20
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 17 valid clusters with clusters
[INFO] Filtering to 2451 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 50
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(36/38) - Original Sharpe: 0.7946, Trades: 95
[INFO] Hierarchical cluster 2: SMA(38/52) - Original Sharpe: 0.6604, Trades: 48
[INFO] Hierarchical cluster 3: SMA(200/212) - Original Sharpe: 0.4895, Trades: 20
[INFO] Hierarchical cluster 4: SMA(24/62) - Original Sharpe: 0.4508, Trades: 36
[INFO] Hierarchical cluster 5: SMA(26/46) - Original Sharpe: 0.3965, Trades: 49
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/50)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (36/38) - Sharpe: 0.7946
[INFO] cluster 2: (38/52) - Sharpe: 0.6604
[INFO] cluster 3: (200/212) - Sharpe: 0.4895
[INFO] Loading WBS data from local files...
[INFO] Found data file: A_OHLCV_@WBS=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206051 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44    -1.969108            1.400595
1    2021-11-14 2021-11-14            44    -3.439143           -2.970272
2    2022-01-14 2022-01-14            41     1.435275            2.994401
3    2022-03-14 2022-03-14            44    -2.274282           -1.002056
4    2022-05-14 2022-05-14            43    -2.490349           -1.471827
5    2022-07-14 2022-07-14            44     1.424645            1.412291
6    2022-09-14 2022-09-14            43     0.423005            0.099234
7    2022-11-14 2022-11-14            43    -1.044126           -4.388384
8    2023-01-14 2023-01-14            41     3.087546            5.153330
9    2023-03-14 2023-03-14            43    -2.851713            0.309247
10   2023-05-14 2023-05-14            44    -0.359960           -1.309052
11   2023-07-14 2023-07-14            44     5.881769            3.005073
12   2023-09-14 2023-09-14            43    -1.305448           -1.399386
13   2023-11-14 2023-11-14            42     1.295824            2.840427
14   2024-01-14 2024-01-14            43    -0.582717            1.323998
15   2024-03-14 2024-03-14            42     0.280722            0.181817
16   2024-05-14 2024-05-14            44    -5.331792           -2.794800
17   2024-07-14 2024-07-14            45     0.232453           -1.234037
18   2024-09-14 2024-09-14            43    -1.780293           -3.289811
19   2024-11-14 2024-11-14            33    -0.454091            0.489976
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |         -2.0 |              1.4 |          3.4 | True          
[INFO] 2021-11-14   |         -3.4 |             -3.0 |          0.4 | True          
[INFO] 2022-01-14   |          1.4 |              3.0 |          1.6 | True          
[INFO] 2022-03-14   |         -2.3 |             -1.0 |          1.3 | True          
[INFO] 2022-05-14   |         -2.5 |             -1.5 |          1.0 | True          
[INFO] 2022-07-14   |          1.4 |              1.4 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.4 |              0.1 |         -0.3 | False         
[INFO] 2022-11-14   |         -1.0 |             -4.4 |         -3.4 | False         
[INFO] 2023-01-14   |          3.1 |              5.2 |          2.1 | True          
[INFO] 2023-03-14   |         -2.9 |              0.3 |          3.2 | True          
[INFO] 2023-05-14   |         -0.4 |             -1.3 |         -0.9 | False         
[INFO] 2023-07-14   |          5.9 |              3.0 |         -2.9 | False         
[INFO] 2023-09-14   |         -1.3 |             -1.4 |         -0.1 | False         
[INFO] 2023-11-14   |          1.3 |              2.8 |          1.5 | True          
[INFO] 2024-01-14   |         -0.6 |              1.3 |          1.9 | True          
[INFO] 2024-03-14   |          0.3 |              0.2 |         -0.1 | False         
[INFO] 2024-05-14   |         -5.3 |             -2.8 |          2.5 | True          
[INFO] 2024-07-14   |          0.2 |             -1.2 |         -1.4 | False         
[INFO] 2024-09-14   |         -1.8 |             -3.3 |         -1.5 | False         
[INFO] 2024-11-14   |         -0.5 |              0.5 |          1.0 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 11 of 19 periods (57.89% win rate)
[INFO] Updating Excel file with Hierarchical results for WBS...
[INFO] Excel file updated successfully. Added WBS with Hierarchical win rate 57.9% in row 53
[INFO] Added best Sharpe parameters 48/50 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 50
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(36/38) - Original Sharpe: 0.7946
[INFO] Added cluster 2 to portfolio: SMA(38/52) - Original Sharpe: 0.6604
[INFO] Added cluster 3 to portfolio: SMA(200/212) - Original Sharpe: 0.4895
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'WBS_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.1514
[INFO] Hierarchical Best out-of-sample Sharpe: -0.5515
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for WBS...
[INFO] Excel file updated successfully. Added WBS with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\WBS
