[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for AD in column D: 8.0
[INFO] Using slippage from Excel column D: 8.0
[INFO] 
Symbol: @AD
[INFO] Description: Australian Dollar Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.000000000000001
[INFO] Big point value: 100000.0
[INFO] Data shape: (6168, 6)
[INFO] Date range: 2001-05-14 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-14 15:57:00  0.1839  0.1839  0.1797  0.1832   375.0
1 2001-05-15 15:57:00  0.1826  0.1852  0.1796  0.1851   309.0
2 2001-05-16 15:57:00  0.1854  0.1876  0.1827  0.1874   376.0
3 2001-05-17 15:57:00  0.1881  0.1929  0.1877  0.1917   715.0
4 2001-05-18 15:57:00  0.1916  0.1937  0.1882  0.1931   331.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 30.26 seconds (0.50 minutes)
[INFO] Best parameters found: Short SMA = 106, Long SMA = 160
[INFO] Best fitness (Sharpe ratio): 0.627696
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 106, Long SMA = 160, Sharpe = 0.627696
[INFO] Top 2: Short SMA = 98, Long SMA = 174, Sharpe = 0.623336
[INFO] Top 3: Short SMA = 102, Long SMA = 160, Sharpe = 0.617233
[INFO] Top 4: Short SMA = 104, Long SMA = 158, Sharpe = 0.613865
[INFO] Top 5: Short SMA = 106, Long SMA = 156, Sharpe = 0.613627
[INFO] Hall of Fame size: 2449
[INFO] Number of elements in all_results: 1799
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 650 had penalty fitness
[INFO] Total filtered from Hall of Fame: 650
[INFO] Hall of Fame -> all_results: 2449 -> 1799
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1799 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @AD
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.51 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $555,481.00
[INFO] Market Buy & Hold P&L: $-24,520.00
[INFO] Outperformance: $580,001.00
[INFO] Sharpe ratio (entire period, annualized): 0.632989
[INFO] Sharpe ratio (in-sample, annualized): 0.627696
[INFO] Sharpe ratio (out-of-sample, annualized): 0.644916
[INFO] Maximum Drawdown: $102,820.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 14
[INFO] Out-of-sample period trades: 8
[INFO] Total trades: 22
[INFO] In-sample P&L: $318,183.00
[INFO] Out-of-sample P&L: $140,738.00
[INFO] 
Best parameters from GA: Short SMA = 106, Long SMA = 160, Sharpe = 0.627696
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2449
[INFO] Cache hits (repeated combinations): 6143
[INFO] Total checks: 8592
[INFO] Cache hit rate: 71.50%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1799 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.5543 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 14
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1799 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.5543 to 0.6277
[INFO] Trades range: 10.0 to 186.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3657 to 2.5879
[INFO] Scaled Long SMA range: -2.9553 to 2.0914
[INFO] Scaled Sharpe ratio range: -2.9730 to 2.0253
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 100 elements
[INFO] Kmeans Cluster 1: 115 elements
[INFO] Kmeans Cluster 2: 119 elements
[INFO] Kmeans Cluster 3: 95 elements
[INFO] Kmeans Cluster 4: 166 elements
[INFO] Kmeans Cluster 5: 75 elements
[INFO] Kmeans Cluster 6: 61 elements
[INFO] Kmeans Cluster 7: 91 elements
[INFO] Kmeans Cluster 8: 46 elements
[INFO] Kmeans Cluster 9: 93 elements
[INFO] Kmeans Cluster 10: 104 elements
[INFO] Kmeans Cluster 11: 140 elements
[INFO] Kmeans Cluster 12: 95 elements
[INFO] Kmeans Cluster 13: 71 elements
[INFO] Kmeans Cluster 14: 191 elements
[INFO] Kmeans Cluster 15: 95 elements
[INFO] Kmeans Cluster 16: 142 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=86.28, Long SMA=189.42, Sharpe=0.3134
[INFO] Centroid 1: Short SMA=44.17, Long SMA=160.30, Sharpe=0.1039
[INFO] Centroid 2: Short SMA=219.46, Long SMA=247.41, Sharpe=-0.0209
[INFO] Centroid 3: Short SMA=30.80, Long SMA=267.37, Sharpe=0.0808
[INFO] Centroid 4: Short SMA=139.00, Long SMA=181.28, Sharpe=0.2822
[INFO] Centroid 5: Short SMA=27.71, Long SMA=60.85, Sharpe=0.1374
[INFO] Centroid 6: Short SMA=75.64, Long SMA=99.87, Sharpe=-0.3541
[INFO] Centroid 7: Short SMA=15.45, Long SMA=180.70, Sharpe=0.2902
[INFO] Centroid 8: Short SMA=189.30, Long SMA=211.74, Sharpe=-0.2002
[INFO] Centroid 9: Short SMA=43.35, Long SMA=171.46, Sharpe=-0.1017
[INFO] Centroid 10: Short SMA=104.29, Long SMA=144.44, Sharpe=0.3033
[INFO] Centroid 11: Short SMA=270.04, Long SMA=285.24, Sharpe=-0.0778
[INFO] Centroid 12: Short SMA=51.47, Long SMA=224.38, Sharpe=-0.0139
[INFO] Centroid 13: Short SMA=158.06, Long SMA=201.10, Sharpe=0.0909
[INFO] Centroid 14: Short SMA=99.29, Long SMA=167.07, Sharpe=0.4995
[INFO] Centroid 15: Short SMA=76.42, Long SMA=121.83, Sharpe=-0.0840
[INFO] Centroid 16: Short SMA=136.00, Long SMA=164.21, Sharpe=0.4413
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=14
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=100, Long SMA=166, Sharpe=0.6029, Trades=12
[INFO] Kmeans Top 2: Short SMA=138, Long SMA=164, Sharpe=0.5070, Trades=16
[INFO] Kmeans Top 3: Short SMA=102, Long SMA=144, Sharpe=0.3692, Trades=19
[INFO] Kmeans Top 4: Short SMA=86, Long SMA=188, Sharpe=0.3167, Trades=10
[INFO] Kmeans Top 5: Short SMA=14, Long SMA=178, Sharpe=0.2858, Trades=18
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (86, 189)
[INFO]   Nearest: (86.0, 190.0)
[INFO]   Rounded: (44, 160)
[INFO]   Rounded: (219, 247)
[INFO]   Nearest: (220.0, 248.0)
[INFO]   Rounded: (31, 267)
[INFO]   Nearest: (30.0, 268.0)
[INFO]   Rounded: (139, 181)
[INFO]   Nearest: (140.0, 182.0)
[INFO]   Rounded: (28, 61)
[INFO]   Nearest: (28.0, 60.0)
[INFO]   Rounded: (76, 100)
[INFO]   Rounded: (15, 181)
[INFO]   Nearest: (16.0, 180.0)
[INFO]   Rounded: (189, 212)
[INFO]   Nearest: (190.0, 212.0)
[INFO]   Rounded: (43, 171)
[INFO]   Nearest: (44.0, 172.0)
[INFO]   Rounded: (104, 144)
[INFO]   Rounded: (270, 285)
[INFO]   Nearest: (270.0, 286.0)
[INFO]   Rounded: (51, 224)
[INFO]   Nearest: (52.0, 224.0)
[INFO]   Rounded: (158, 201)
[INFO]   Nearest: (158.0, 202.0)
[INFO]   Rounded: (99, 167)
[INFO]   Nearest: (100.0, 168.0)
[INFO]   Rounded: (76, 122)
[INFO]   Rounded: (136, 164)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(100/166) - Original Sharpe: 0.6029, Trades: 12
[INFO] Kmeans cluster 2: SMA(138/164) - Original Sharpe: 0.5070, Trades: 16
[INFO] Kmeans cluster 3: SMA(102/144) - Original Sharpe: 0.3692, Trades: 19
[INFO] Kmeans cluster 4: SMA(86/188) - Original Sharpe: 0.3167, Trades: 10
[INFO] Kmeans cluster 5: SMA(14/178) - Original Sharpe: 0.2858, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (100/166) - Sharpe: 0.6029
[INFO] cluster 2: (138/164) - Sharpe: 0.5070
[INFO] cluster 3: (102/144) - Sharpe: 0.3692
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            0.551202
1    2021-11-14 2021-11-14            43     0.620829            0.620829
2    2022-01-14 2022-01-14            41     0.058063            0.058063
3    2022-03-14 2022-03-14            44     1.979608            1.979608
4    2022-05-14 2022-05-14            43    -1.220633           -2.292817
5    2022-07-14 2022-07-14            44     0.448047            0.403557
6    2022-09-14 2022-09-14            43     0.790083            0.790083
7    2022-11-14 2022-11-14            43    -1.736792           -1.736792
8    2023-01-14 2023-01-14            41     2.493082            2.458579
9    2023-03-14 2023-03-14            44    -0.132668           -0.967044
10   2023-05-14 2023-05-14            44     0.580825           -2.270132
11   2023-07-14 2023-07-14            44     4.541233            4.541233
12   2023-09-14 2023-09-14            43     0.691612            0.691612
13   2023-11-14 2023-11-14            42    -2.563801           -2.563801
14   2024-01-14 2024-01-14            43     4.073536            3.035601
15   2024-03-14 2024-03-14            42    -0.424007           -0.014811
16   2024-05-14 2024-05-14            44    -1.116674           -2.276461
17   2024-07-14 2024-07-14            45     3.495207            1.170378
18   2024-09-14 2024-09-14            43    -2.003748           -2.003748
19   2024-11-14 2024-11-14            33     3.170976            3.586260
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -1.2 |             -2.3 |         -1.1 | False         
[INFO] 2022-07-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -0.1 |             -1.0 |         -0.9 | False         
[INFO] 2023-05-14   |          0.6 |             -2.3 |         -2.9 | False         
[INFO] 2023-07-14   |          4.5 |              4.5 |          0.0 | Excluded      
[INFO] 2023-09-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2024-01-14   |          4.1 |              3.0 |         -1.1 | False         
[INFO] 2024-03-14   |         -0.4 |             -0.0 |          0.4 | True          
[INFO] 2024-05-14   |         -1.1 |             -2.3 |         -1.2 | False         
[INFO] 2024-07-14   |          3.5 |              1.2 |         -2.3 | False         
[INFO] 2024-09-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-11-14   |          3.2 |              3.6 |          0.4 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Kmeans cluster wins (rounded comparison): 2 of 8 periods (25.00% win rate)
[INFO] Updating Excel file with Kmeans results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans win rate 25.0% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(100/166) - Original Sharpe: 0.6029
[INFO] Added cluster 2 to portfolio: SMA(138/164) - Original Sharpe: 0.5070
[INFO] Added cluster 3 to portfolio: SMA(102/144) - Original Sharpe: 0.3692
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2655
[INFO] Kmeans Best out-of-sample Sharpe: 0.6449
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1799 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.5543 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 14
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1799 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.5543 to 0.6277
[INFO] Trades range: 10.0 to 186.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3657 to 2.5879
[INFO] Scaled Long SMA range: -2.9553 to 2.0914
[INFO] Scaled Sharpe ratio range: -2.9730 to 2.0253
[INFO] Scaled Trades range: -0.6748 to 14.8572
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1799 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6290
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 161 elements
[INFO] Cluster 1: 206 elements
[INFO] Cluster 2: 208 elements
[INFO] Cluster 3: 155 elements
[INFO] Cluster 4: 362 elements
[INFO] Cluster 5: 65 elements
[INFO] Cluster 6: 133 elements
[INFO] Cluster 7: 59 elements
[INFO] Cluster 8: 13 elements
[INFO] Cluster 9: 43 elements
[INFO] Cluster 10: 34 elements
[INFO] Cluster 11: 138 elements
[INFO] Cluster 12: 111 elements
[INFO] Cluster 13: 1 elements
[INFO] Cluster 14: 110 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=28, Long SMA=188, Sharpe=0.1167, Trades=14
[INFO] Cluster 1 cluster: Short SMA=138, Long SMA=190, Sharpe=0.3020, Trades=12
[INFO] Cluster 2 cluster: Short SMA=42, Long SMA=166, Sharpe=-0.1907, Trades=14
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=256, Sharpe=-0.1094, Trades=12
[INFO] Cluster 4 cluster: Short SMA=102, Long SMA=168, Sharpe=0.4730, Trades=12
[INFO] Cluster 5 cluster: Short SMA=28, Long SMA=56, Sharpe=0.0188, Trades=44
[INFO] Cluster 6 cluster: Short SMA=208, Long SMA=236, Sharpe=-0.0220, Trades=13
[INFO] Cluster 7 cluster: Short SMA=88, Long SMA=100, Sharpe=-0.2965, Trades=35
[INFO] Cluster 9 cluster: Short SMA=240, Long SMA=244, Sharpe=0.0672, Trades=33
[INFO] Cluster 10 cluster: Short SMA=150, Long SMA=154, Sharpe=0.4153, Trades=38
[INFO] Cluster 11 cluster: Short SMA=266, Long SMA=284, Sharpe=-0.0245, Trades=15
[INFO] Cluster 12 cluster: Short SMA=84, Long SMA=128, Sharpe=0.0477, Trades=19
[INFO] Cluster 14 cluster: Short SMA=132, Long SMA=154, Sharpe=0.2187, Trades=18
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=14
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=102, Long SMA=168, Sharpe=0.4730, Trades=12
[INFO] Top 2: Short SMA=150, Long SMA=154, Sharpe=0.4153, Trades=38
[INFO] Top 3: Short SMA=138, Long SMA=190, Sharpe=0.3020, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 1785 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(102/168) - Original Sharpe: 0.4730, Trades: 12
[INFO] Hierarchical cluster 2: SMA(150/154) - Original Sharpe: 0.4153, Trades: 38
[INFO] Hierarchical cluster 3: SMA(138/190) - Original Sharpe: 0.3020, Trades: 12
[INFO] Hierarchical cluster 4: SMA(132/154) - Original Sharpe: 0.2187, Trades: 18
[INFO] Hierarchical cluster 5: SMA(28/188) - Original Sharpe: 0.1167, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (102/168) - Sharpe: 0.4730
[INFO] cluster 2: (150/154) - Sharpe: 0.4153
[INFO] cluster 3: (138/190) - Sharpe: 0.3020
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            0.551202
1    2021-11-14 2021-11-14            43     0.620829            0.620829
2    2022-01-14 2022-01-14            41     0.058063            0.058063
3    2022-03-14 2022-03-14            44     1.979608            1.491246
4    2022-05-14 2022-05-14            43    -1.220633            0.783922
5    2022-07-14 2022-07-14            44     0.448047            0.722602
6    2022-09-14 2022-09-14            43     0.790083            0.790083
7    2022-11-14 2022-11-14            43    -1.736792           -1.736792
8    2023-01-14 2023-01-14            41     2.493082            2.493082
9    2023-03-14 2023-03-14            44    -0.132668           -0.292013
10   2023-05-14 2023-05-14            44     0.580825            1.148770
11   2023-07-14 2023-07-14            44     4.541233            2.808763
12   2023-09-14 2023-09-14            43     0.691612            0.691612
13   2023-11-14 2023-11-14            42    -2.563801           -3.100356
14   2024-01-14 2024-01-14            43     4.073536            1.681490
15   2024-03-14 2024-03-14            42    -0.424007            0.619271
16   2024-05-14 2024-05-14            44    -1.116674            0.726240
17   2024-07-14 2024-07-14            45     3.495207           -0.064369
18   2024-09-14 2024-09-14            43    -2.003748           -2.391713
19   2024-11-14 2024-11-14            33     3.170976           -0.956787
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          2.0 |              1.5 |         -0.5 | False         
[INFO] 2022-05-14   |         -1.2 |              0.8 |          2.0 | True          
[INFO] 2022-07-14   |          0.4 |              0.7 |          0.3 | True          
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -0.1 |             -0.3 |         -0.2 | False         
[INFO] 2023-05-14   |          0.6 |              1.1 |          0.5 | True          
[INFO] 2023-07-14   |          4.5 |              2.8 |         -1.7 | False         
[INFO] 2023-09-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -2.6 |             -3.1 |         -0.5 | False         
[INFO] 2024-01-14   |          4.1 |              1.7 |         -2.4 | False         
[INFO] 2024-03-14   |         -0.4 |              0.6 |          1.0 | True          
[INFO] 2024-05-14   |         -1.1 |              0.7 |          1.8 | True          
[INFO] 2024-07-14   |          3.5 |             -0.1 |         -3.6 | False         
[INFO] 2024-09-14   |         -2.0 |             -2.4 |         -0.4 | False         
[INFO] 2024-11-14   |          3.2 |             -1.0 |         -4.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 13 periods (38.46% win rate)
[INFO] Updating Excel file with Hierarchical results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical win rate 38.5% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(102/168) - Original Sharpe: 0.4730
[INFO] Added cluster 2 to portfolio: SMA(150/154) - Original Sharpe: 0.4153
[INFO] Added cluster 3 to portfolio: SMA(138/190) - Original Sharpe: 0.3020
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3075
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6449
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BO in column D: 10.0
[INFO] Using slippage from Excel column D: 10.0
[INFO] 
Symbol: @BO
[INFO] Description: Soybean Oil Continuous Contract [May25]
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 6.0
[INFO] Big point value: 600.0
[INFO] Data shape: (5846, 6)
[INFO] Date range: 2001-05-14 13:13:00 to 2025-04-07 13:13:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2001-05-14 13:13:00  22.96  22.96  22.96  22.96    10.0
1 2001-05-15 13:13:00  23.01  23.01  23.00  23.00    23.0
2 2001-05-16 13:13:00  22.91  22.91  22.91  22.91     5.0
3 2001-05-17 13:13:00  22.85  22.85  22.85  22.85     2.0
4 2001-05-18 13:13:00  23.06  23.15  23.06  23.15     7.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BO in column D: 10.0
[INFO] Using slippage from Excel column D: 10.0
[INFO] 
Symbol: @BO
[INFO] Description: Soybean Oil Continuous Contract [May25]
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 6.0
[INFO] Big point value: 600.0
[INFO] Data shape: (5846, 6)
[INFO] Date range: 2001-05-14 13:13:00 to 2025-04-07 13:13:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2001-05-14 13:13:00  22.96  22.96  22.96  22.96    10.0
1 2001-05-15 13:13:00  23.01  23.01  23.00  23.00    23.0
2 2001-05-16 13:13:00  22.91  22.91  22.91  22.91     5.0
3 2001-05-17 13:13:00  22.85  22.85  22.85  22.85     2.0
4 2001-05-18 13:13:00  23.06  23.15  23.06  23.15     7.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 27.68 seconds (0.46 minutes)
[INFO] Best parameters found: Short SMA = 48, Long SMA = 54
[INFO] Best fitness (Sharpe ratio): 1.148397
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 48, Long SMA = 54, Sharpe = 1.148397
[INFO] Top 2: Short SMA = 48, Long SMA = 66, Sharpe = 1.130687
[INFO] Top 3: Short SMA = 50, Long SMA = 54, Sharpe = 1.129939
[INFO] Top 4: Short SMA = 48, Long SMA = 56, Sharpe = 1.122568
[INFO] Top 5: Short SMA = 48, Long SMA = 64, Sharpe = 1.101316
[INFO] Hall of Fame size: 2318
[INFO] Number of elements in all_results: 1671
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 647 had penalty fitness
[INFO] Total filtered from Hall of Fame: 647
[INFO] Hall of Fame -> all_results: 2318 -> 1671
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1671 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BO
[INFO] Big Point Value (from data): 600.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 13.60 contracts
[INFO] Maximum Position Size: 31 contracts
[INFO] Strategy Total P&L: $553,098.00
[INFO] Market Buy & Hold P&L: $8,556.00
[INFO] Outperformance: $544,542.00
[INFO] Sharpe ratio (entire period, annualized): 0.651163
[INFO] Sharpe ratio (in-sample, annualized): 1.148397
[INFO] Sharpe ratio (out-of-sample, annualized): -0.439751
[INFO] Maximum Drawdown: $162,660.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 63
[INFO] Out-of-sample period trades: 26
[INFO] Total trades: 89
[INFO] In-sample P&L: $556,682.00
[INFO] Out-of-sample P&L: $-96,936.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 54, Sharpe = 1.148397
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2318
[INFO] Cache hits (repeated combinations): 6379
[INFO] Total checks: 8697
[INFO] Cache hit rate: 73.35%
[INFO] 
Analysis complete!
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BO in column D: 10.0
[INFO] Using slippage from Excel column D: 10.0
[INFO] 
Symbol: @BO
[INFO] Description: Soybean Oil Continuous Contract [May25]
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 6.0
[INFO] Big point value: 600.0
[INFO] Data shape: (5846, 6)
[INFO] Date range: 2001-05-14 13:13:00 to 2025-04-07 13:13:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2001-05-14 13:13:00  22.96  22.96  22.96  22.96    10.0
1 2001-05-15 13:13:00  23.01  23.01  23.00  23.00    23.0
2 2001-05-16 13:13:00  22.91  22.91  22.91  22.91     5.0
3 2001-05-17 13:13:00  22.85  22.85  22.85  22.85     2.0
4 2001-05-18 13:13:00  23.06  23.15  23.06  23.15     7.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 35.40 seconds (0.59 minutes)
[INFO] Best parameters found: Short SMA = 48, Long SMA = 54
[INFO] Best fitness (Sharpe ratio): 1.148397
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 48, Long SMA = 54, Sharpe = 1.148397
[INFO] Top 2: Short SMA = 48, Long SMA = 66, Sharpe = 1.130687
[INFO] Top 3: Short SMA = 50, Long SMA = 54, Sharpe = 1.129939
[INFO] Top 4: Short SMA = 48, Long SMA = 56, Sharpe = 1.122568
[INFO] Top 5: Short SMA = 48, Long SMA = 64, Sharpe = 1.101316
[INFO] Hall of Fame size: 2318
[INFO] Number of elements in all_results: 1671
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 647 had penalty fitness
[INFO] Total filtered from Hall of Fame: 647
[INFO] Hall of Fame -> all_results: 2318 -> 1671
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1671 unique strategies)
[INFO] Saved PnL series of top 334 strategies (top 20%) to pnl_temp.pkl
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BO
[INFO] Big Point Value (from data): 600.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 13.60 contracts
[INFO] Maximum Position Size: 31 contracts
[INFO] Strategy Total P&L: $553,098.00
[INFO] Market Buy & Hold P&L: $8,556.00
[INFO] Outperformance: $544,542.00
[INFO] Sharpe ratio (entire period, annualized): 0.651163
[INFO] Sharpe ratio (in-sample, annualized): 1.148397
[INFO] Sharpe ratio (out-of-sample, annualized): -0.439751
[INFO] Maximum Drawdown: $162,660.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 63
[INFO] Out-of-sample period trades: 26
[INFO] Total trades: 89
[INFO] In-sample P&L: $556,682.00
[INFO] Out-of-sample P&L: $-96,936.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 54, Sharpe = 1.148397
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2318
[INFO] Cache hits (repeated combinations): 6379
[INFO] Total checks: 8697
[INFO] Cache hit rate: 73.35%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1671 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 20 to 300
[INFO] Sharpe ratio range: -0.4907 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 63
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1671 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 20.0 to 300.0
[INFO] Sharpe ratio range: -0.4907 to 1.1484
[INFO] Trades range: 11.0 to 168.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9945 to 2.1141
[INFO] Scaled Long SMA range: -2.0891 to 1.4323
[INFO] Scaled Sharpe ratio range: -2.3533 to 3.0251
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 20
[INFO] Using 20 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=20...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 125 elements
[INFO] Kmeans Cluster 1: 61 elements
[INFO] Kmeans Cluster 2: 43 elements
[INFO] Kmeans Cluster 3: 51 elements
[INFO] Kmeans Cluster 4: 59 elements
[INFO] Kmeans Cluster 5: 125 elements
[INFO] Kmeans Cluster 6: 143 elements
[INFO] Kmeans Cluster 7: 83 elements
[INFO] Kmeans Cluster 8: 103 elements
[INFO] Kmeans Cluster 9: 117 elements
[INFO] Kmeans Cluster 10: 103 elements
[INFO] Kmeans Cluster 11: 111 elements
[INFO] Kmeans Cluster 12: 68 elements
[INFO] Kmeans Cluster 13: 71 elements
[INFO] Kmeans Cluster 14: 58 elements
[INFO] Kmeans Cluster 15: 81 elements
[INFO] Kmeans Cluster 16: 49 elements
[INFO] Kmeans Cluster 17: 16 elements
[INFO] Kmeans Cluster 18: 85 elements
[INFO] Kmeans Cluster 19: 119 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=53.87, Long SMA=206.78, Sharpe=-0.1186
[INFO] Centroid 1: Short SMA=196.56, Long SMA=217.93, Sharpe=0.1643
[INFO] Centroid 2: Short SMA=50.37, Long SMA=85.35, Sharpe=0.2621
[INFO] Centroid 3: Short SMA=45.37, Long SMA=62.94, Sharpe=0.9442
[INFO] Centroid 4: Short SMA=278.90, Long SMA=295.43, Sharpe=-0.1868
[INFO] Centroid 5: Short SMA=36.51, Long SMA=237.02, Sharpe=0.1596
[INFO] Centroid 6: Short SMA=245.86, Long SMA=273.71, Sharpe=0.3423
[INFO] Centroid 7: Short SMA=74.87, Long SMA=116.10, Sharpe=-0.0358
[INFO] Centroid 8: Short SMA=28.58, Long SMA=106.72, Sharpe=0.4499
[INFO] Centroid 9: Short SMA=20.55, Long SMA=269.68, Sharpe=0.3057
[INFO] Centroid 10: Short SMA=31.96, Long SMA=182.62, Sharpe=0.0548
[INFO] Centroid 11: Short SMA=255.20, Long SMA=283.11, Sharpe=0.1109
[INFO] Centroid 12: Short SMA=27.88, Long SMA=58.21, Sharpe=0.5636
[INFO] Centroid 13: Short SMA=121.21, Long SMA=162.03, Sharpe=-0.1307
[INFO] Centroid 14: Short SMA=144.28, Long SMA=192.41, Sharpe=0.0091
[INFO] Centroid 15: Short SMA=233.41, Long SMA=255.28, Sharpe=0.5682
[INFO] Centroid 16: Short SMA=65.88, Long SMA=174.33, Sharpe=-0.3223
[INFO] Centroid 18: Short SMA=34.38, Long SMA=143.76, Sharpe=0.2498
[INFO] Centroid 19: Short SMA=32.67, Long SMA=65.14, Sharpe=0.7454
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=54, Sharpe=1.1484, Trades=63
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=46, Long SMA=62, Sharpe=0.9485, Trades=39
[INFO] Kmeans Top 2: Short SMA=234, Long SMA=250, Sharpe=0.7420, Trades=19
[INFO] Kmeans Top 3: Short SMA=32, Long SMA=64, Sharpe=0.7292, Trades=24
[INFO] Kmeans Top 4: Short SMA=26, Long SMA=54, Sharpe=0.6297, Trades=30
[INFO] Kmeans Top 5: Short SMA=30, Long SMA=106, Sharpe=0.4133, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 18, 19}
[INFO]   Rounded: (54, 207)
[INFO]   Nearest: (54.0, 206.0)
[INFO]   Rounded: (197, 218)
[INFO]   Nearest: (196.0, 218.0)
[INFO]   Rounded: (50, 85)
[INFO]   Nearest: (50.0, 86.0)
[INFO]   Rounded: (45, 63)
[INFO]   Nearest: (46.0, 62.0)
[INFO]   Rounded: (279, 295)
[INFO]   Nearest: (278.0, 296.0)
[INFO]   Rounded: (37, 237)
[INFO]   Nearest: (36.0, 238.0)
[INFO]   Rounded: (246, 274)
[INFO]   Rounded: (75, 116)
[INFO]   Nearest: (74.0, 116.0)
[INFO]   Rounded: (29, 107)
[INFO]   Nearest: (28.0, 106.0)
[INFO]   Rounded: (21, 270)
[INFO]   Nearest: (20.0, 270.0)
[INFO]   Rounded: (32, 183)
[INFO]   Nearest: (32.0, 182.0)
[INFO]   Rounded: (255, 283)
[INFO]   Nearest: (256.0, 284.0)
[INFO]   Rounded: (28, 58)
[INFO]   Rounded: (121, 162)
[INFO]   Nearest: (122.0, 162.0)
[INFO]   Rounded: (144, 192)
[INFO]   Rounded: (233, 255)
[INFO]   Nearest: (234.0, 256.0)
[INFO]   Rounded: (66, 174)
[INFO]   Rounded: (34, 144)
[INFO]   Rounded: (33, 65)
[INFO]   Nearest: (32.0, 66.0)
[INFO] Successfully plotted 19 out of 19 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 54
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(46/62) - Original Sharpe: 0.9485, Trades: 39
[INFO] Kmeans cluster 2: SMA(234/250) - Original Sharpe: 0.7420, Trades: 19
[INFO] Kmeans cluster 3: SMA(32/64) - Original Sharpe: 0.7292, Trades: 24
[INFO] Kmeans cluster 4: SMA(26/54) - Original Sharpe: 0.6297, Trades: 30
[INFO] Kmeans cluster 5: SMA(30/106) - Original Sharpe: 0.4133, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/54)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (46/62) - Sharpe: 0.9485
[INFO] cluster 2: (234/250) - Sharpe: 0.7420
[INFO] cluster 3: (32/64) - Sharpe: 0.7292
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -3.408887           -3.100510
1    2021-11-10 2021-11-10            41    -4.249630           -2.670534
2    2022-01-10 2022-01-10            41     1.218137            2.166758
3    2022-03-10 2022-03-10            42     2.126254            2.442535
4    2022-05-10 2022-05-10            41    -5.000926           -4.489848
5    2022-07-10 2022-07-10            44    -0.790260           -0.019992
6    2022-09-10 2022-09-10            43     1.268514            3.602145
7    2022-11-10 2022-11-10            40    -2.869549           -1.881657
8    2023-01-10 2023-01-10            41     1.869806            2.198292
9    2023-03-10 2023-03-10            42     1.878823            1.736344
10   2023-05-10 2023-05-10            40    -1.601658           -2.041194
11   2023-07-10 2023-07-10            44     0.545769            1.118295
12   2023-09-10 2023-09-10            44     0.229410            1.064243
13   2023-11-10 2023-11-10            40     0.831968            0.831968
14   2024-01-10 2024-01-10            41     1.354455            2.139975
15   2024-03-10 2024-03-10            43    -1.598528           -3.397769
16   2024-05-10 2024-05-10            40     1.637085            0.320277
17   2024-07-10 2024-07-10            43    -1.484568           -0.601320
18   2024-09-10 2024-09-10            44     1.814989           -0.540454
19   2024-11-10 2024-11-10            35    -2.317816           -5.214923
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -3.4 |             -3.1 |          0.3 | True          
[INFO] 2021-11-10   |         -4.2 |             -2.7 |          1.5 | True          
[INFO] 2022-01-10   |          1.2 |              2.2 |          1.0 | True          
[INFO] 2022-03-10   |          2.1 |              2.4 |          0.3 | True          
[INFO] 2022-05-10   |         -5.0 |             -4.5 |          0.5 | True          
[INFO] 2022-07-10   |         -0.8 |             -0.0 |          0.8 | True          
[INFO] 2022-09-10   |          1.3 |              3.6 |          2.3 | True          
[INFO] 2022-11-10   |         -2.9 |             -1.9 |          1.0 | True          
[INFO] 2023-01-10   |          1.9 |              2.2 |          0.3 | True          
[INFO] 2023-03-10   |          1.9 |              1.7 |         -0.2 | False         
[INFO] 2023-05-10   |         -1.6 |             -2.0 |         -0.4 | False         
[INFO] 2023-07-10   |          0.5 |              1.1 |          0.6 | True          
[INFO] 2023-09-10   |          0.2 |              1.1 |          0.9 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.4 |              2.1 |          0.7 | True          
[INFO] 2024-03-10   |         -1.6 |             -3.4 |         -1.8 | False         
[INFO] 2024-05-10   |          1.6 |              0.3 |         -1.3 | False         
[INFO] 2024-07-10   |         -1.5 |             -0.6 |          0.9 | True          
[INFO] 2024-09-10   |          1.8 |             -0.5 |         -2.3 | False         
[INFO] 2024-11-10   |         -2.3 |             -5.2 |         -2.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 13 of 19 periods (68.42% win rate)
[INFO] Updating Excel file with Kmeans results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans win rate 68.4% in row 4
[INFO] Added best Sharpe parameters 48/54 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 54
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(46/62) - Original Sharpe: 0.9485
[INFO] Added cluster 2 to portfolio: SMA(234/250) - Original Sharpe: 0.7420
[INFO] Added cluster 3 to portfolio: SMA(32/64) - Original Sharpe: 0.7292
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BO_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0190
[INFO] Kmeans Best out-of-sample Sharpe: -0.4398
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BO
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BO in column D: 10.0
[INFO] Using slippage from Excel column D: 10.0
[INFO] 
Symbol: @BO
[INFO] Description: Soybean Oil Continuous Contract [May25]
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 6.0
[INFO] Big point value: 600.0
[INFO] Data shape: (5846, 6)
[INFO] Date range: 2001-05-14 13:13:00 to 2025-04-07 13:13:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2001-05-14 13:13:00  22.96  22.96  22.96  22.96    10.0
1 2001-05-15 13:13:00  23.01  23.01  23.00  23.00    23.0
2 2001-05-16 13:13:00  22.91  22.91  22.91  22.91     5.0
3 2001-05-17 13:13:00  22.85  22.85  22.85  22.85     2.0
4 2001-05-18 13:13:00  23.06  23.15  23.06  23.15     7.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
