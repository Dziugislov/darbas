[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for AD in column D: 8.0
[INFO] Using slippage from Excel column D: 8.0
[INFO] 
Symbol: @AD
[INFO] Description: Australian Dollar Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 5.000000000000001
[INFO] Big point value: 100000.0
[INFO] Data shape: (6168, 6)
[INFO] Date range: 2001-05-14 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-14 15:57:00  0.1839  0.1839  0.1797  0.1832   375.0
1 2001-05-15 15:57:00  0.1826  0.1852  0.1796  0.1851   309.0
2 2001-05-16 15:57:00  0.1854  0.1876  0.1827  0.1874   376.0
3 2001-05-17 15:57:00  0.1881  0.1929  0.1877  0.1917   715.0
4 2001-05-18 15:57:00  0.1916  0.1937  0.1882  0.1931   331.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 41.91 seconds (0.70 minutes)
[INFO] Best parameters found: Short SMA = 106, Long SMA = 160
[INFO] Best fitness (Sharpe ratio): 0.627696
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 106, Long SMA = 160, Sharpe = 0.627696
[INFO] Top 2: Short SMA = 98, Long SMA = 174, Sharpe = 0.623336
[INFO] Top 3: Short SMA = 102, Long SMA = 160, Sharpe = 0.617233
[INFO] Top 4: Short SMA = 104, Long SMA = 158, Sharpe = 0.613865
[INFO] Top 5: Short SMA = 106, Long SMA = 156, Sharpe = 0.613627
[INFO] Hall of Fame size: 2449
[INFO] Number of elements in all_results: 1799
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 650 had penalty fitness
[INFO] Total filtered from Hall of Fame: 650
[INFO] Hall of Fame -> all_results: 2449 -> 1799
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1799 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @AD
[INFO] Big Point Value (from data): 100000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.51 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $555,481.00
[INFO] Market Buy & Hold P&L: $-24,520.00
[INFO] Outperformance: $580,001.00
[INFO] Sharpe ratio (entire period, annualized): 0.632989
[INFO] Sharpe ratio (in-sample, annualized): 0.627696
[INFO] Sharpe ratio (out-of-sample, annualized): 0.644916
[INFO] Maximum Drawdown: $102,820.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 14
[INFO] Out-of-sample period trades: 8
[INFO] Total trades: 22
[INFO] In-sample P&L: $318,183.00
[INFO] Out-of-sample P&L: $140,738.00
[INFO] 
Best parameters from GA: Short SMA = 106, Long SMA = 160, Sharpe = 0.627696
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2449
[INFO] Cache hits (repeated combinations): 6143
[INFO] Total checks: 8592
[INFO] Cache hit rate: 71.50%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1799 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.5543 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 14
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1799 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.5543 to 0.6277
[INFO] Trades range: 10.0 to 186.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3657 to 2.5879
[INFO] Scaled Long SMA range: -2.9553 to 2.0914
[INFO] Scaled Sharpe ratio range: -2.9730 to 2.0253
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 17
[INFO] Using 17 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=17...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 100 elements
[INFO] Kmeans Cluster 1: 115 elements
[INFO] Kmeans Cluster 2: 119 elements
[INFO] Kmeans Cluster 3: 95 elements
[INFO] Kmeans Cluster 4: 166 elements
[INFO] Kmeans Cluster 5: 75 elements
[INFO] Kmeans Cluster 6: 61 elements
[INFO] Kmeans Cluster 7: 91 elements
[INFO] Kmeans Cluster 8: 46 elements
[INFO] Kmeans Cluster 9: 93 elements
[INFO] Kmeans Cluster 10: 104 elements
[INFO] Kmeans Cluster 11: 140 elements
[INFO] Kmeans Cluster 12: 95 elements
[INFO] Kmeans Cluster 13: 71 elements
[INFO] Kmeans Cluster 14: 191 elements
[INFO] Kmeans Cluster 15: 95 elements
[INFO] Kmeans Cluster 16: 142 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=86.28, Long SMA=189.42, Sharpe=0.3134
[INFO] Centroid 1: Short SMA=44.17, Long SMA=160.30, Sharpe=0.1039
[INFO] Centroid 2: Short SMA=219.46, Long SMA=247.41, Sharpe=-0.0209
[INFO] Centroid 3: Short SMA=30.80, Long SMA=267.37, Sharpe=0.0808
[INFO] Centroid 4: Short SMA=139.00, Long SMA=181.28, Sharpe=0.2822
[INFO] Centroid 5: Short SMA=27.71, Long SMA=60.85, Sharpe=0.1374
[INFO] Centroid 6: Short SMA=75.64, Long SMA=99.87, Sharpe=-0.3541
[INFO] Centroid 7: Short SMA=15.45, Long SMA=180.70, Sharpe=0.2902
[INFO] Centroid 8: Short SMA=189.30, Long SMA=211.74, Sharpe=-0.2002
[INFO] Centroid 9: Short SMA=43.35, Long SMA=171.46, Sharpe=-0.1017
[INFO] Centroid 10: Short SMA=104.29, Long SMA=144.44, Sharpe=0.3033
[INFO] Centroid 11: Short SMA=270.04, Long SMA=285.24, Sharpe=-0.0778
[INFO] Centroid 12: Short SMA=51.47, Long SMA=224.38, Sharpe=-0.0139
[INFO] Centroid 13: Short SMA=158.06, Long SMA=201.10, Sharpe=0.0909
[INFO] Centroid 14: Short SMA=99.29, Long SMA=167.07, Sharpe=0.4995
[INFO] Centroid 15: Short SMA=76.42, Long SMA=121.83, Sharpe=-0.0840
[INFO] Centroid 16: Short SMA=136.00, Long SMA=164.21, Sharpe=0.4413
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=14
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=100, Long SMA=166, Sharpe=0.6029, Trades=12
[INFO] Kmeans Top 2: Short SMA=138, Long SMA=164, Sharpe=0.5070, Trades=16
[INFO] Kmeans Top 3: Short SMA=102, Long SMA=144, Sharpe=0.3692, Trades=19
[INFO] Kmeans Top 4: Short SMA=86, Long SMA=188, Sharpe=0.3167, Trades=10
[INFO] Kmeans Top 5: Short SMA=14, Long SMA=178, Sharpe=0.2858, Trades=18
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
[INFO]   Rounded: (86, 189)
[INFO]   Nearest: (86.0, 190.0)
[INFO]   Rounded: (44, 160)
[INFO]   Rounded: (219, 247)
[INFO]   Nearest: (220.0, 248.0)
[INFO]   Rounded: (31, 267)
[INFO]   Nearest: (30.0, 268.0)
[INFO]   Rounded: (139, 181)
[INFO]   Nearest: (140.0, 182.0)
[INFO]   Rounded: (28, 61)
[INFO]   Nearest: (28.0, 60.0)
[INFO]   Rounded: (76, 100)
[INFO]   Rounded: (15, 181)
[INFO]   Nearest: (16.0, 180.0)
[INFO]   Rounded: (189, 212)
[INFO]   Nearest: (190.0, 212.0)
[INFO]   Rounded: (43, 171)
[INFO]   Nearest: (44.0, 172.0)
[INFO]   Rounded: (104, 144)
[INFO]   Rounded: (270, 285)
[INFO]   Nearest: (270.0, 286.0)
[INFO]   Rounded: (51, 224)
[INFO]   Nearest: (52.0, 224.0)
[INFO]   Rounded: (158, 201)
[INFO]   Nearest: (158.0, 202.0)
[INFO]   Rounded: (99, 167)
[INFO]   Nearest: (100.0, 168.0)
[INFO]   Rounded: (76, 122)
[INFO]   Rounded: (136, 164)
[INFO] Successfully plotted 17 out of 17 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(100/166) - Original Sharpe: 0.6029, Trades: 12
[INFO] Kmeans cluster 2: SMA(138/164) - Original Sharpe: 0.5070, Trades: 16
[INFO] Kmeans cluster 3: SMA(102/144) - Original Sharpe: 0.3692, Trades: 19
[INFO] Kmeans cluster 4: SMA(86/188) - Original Sharpe: 0.3167, Trades: 10
[INFO] Kmeans cluster 5: SMA(14/178) - Original Sharpe: 0.2858, Trades: 18
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (100/166) - Sharpe: 0.6029
[INFO] cluster 2: (138/164) - Sharpe: 0.5070
[INFO] cluster 3: (102/144) - Sharpe: 0.3692
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            0.551202
1    2021-11-14 2021-11-14            43     0.620829            0.620829
2    2022-01-14 2022-01-14            41     0.058063            0.058063
3    2022-03-14 2022-03-14            44     1.979608            1.979608
4    2022-05-14 2022-05-14            43    -1.220633           -2.292817
5    2022-07-14 2022-07-14            44     0.448047            0.403557
6    2022-09-14 2022-09-14            43     0.790083            0.790083
7    2022-11-14 2022-11-14            43    -1.736792           -1.736792
8    2023-01-14 2023-01-14            41     2.493082            2.458579
9    2023-03-14 2023-03-14            44    -0.132668           -0.967044
10   2023-05-14 2023-05-14            44     0.580825           -2.270132
11   2023-07-14 2023-07-14            44     4.541233            4.541233
12   2023-09-14 2023-09-14            43     0.691612            0.691612
13   2023-11-14 2023-11-14            42    -2.563801           -2.563801
14   2024-01-14 2024-01-14            43     4.073536            3.035601
15   2024-03-14 2024-03-14            42    -0.424007           -0.014811
16   2024-05-14 2024-05-14            44    -1.116674           -2.276461
17   2024-07-14 2024-07-14            45     3.495207            1.170378
18   2024-09-14 2024-09-14            43    -2.003748           -2.003748
19   2024-11-14 2024-11-14            33     3.170976            3.586260
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          2.0 |              2.0 |          0.0 | Excluded      
[INFO] 2022-05-14   |         -1.2 |             -2.3 |         -1.1 | False         
[INFO] 2022-07-14   |          0.4 |              0.4 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -0.1 |             -1.0 |         -0.9 | False         
[INFO] 2023-05-14   |          0.6 |             -2.3 |         -2.9 | False         
[INFO] 2023-07-14   |          4.5 |              4.5 |          0.0 | Excluded      
[INFO] 2023-09-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2024-01-14   |          4.1 |              3.0 |         -1.1 | False         
[INFO] 2024-03-14   |         -0.4 |             -0.0 |          0.4 | True          
[INFO] 2024-05-14   |         -1.1 |             -2.3 |         -1.2 | False         
[INFO] 2024-07-14   |          3.5 |              1.2 |         -2.3 | False         
[INFO] 2024-09-14   |         -2.0 |             -2.0 |          0.0 | Excluded      
[INFO] 2024-11-14   |          3.2 |              3.6 |          0.4 | True          
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-03-14, 2022-07-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-07-14, 2023-09-14, 2023-11-14, 2024-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 8
[INFO] Kmeans cluster wins (rounded comparison): 2 of 8 periods (25.00% win rate)
[INFO] Updating Excel file with Kmeans results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans win rate 25.0% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(100/166) - Original Sharpe: 0.6029
[INFO] Added cluster 2 to portfolio: SMA(138/164) - Original Sharpe: 0.5070
[INFO] Added cluster 3 to portfolio: SMA(102/144) - Original Sharpe: 0.3692
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2655
[INFO] Kmeans Best out-of-sample Sharpe: 0.6449
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Big Point Value: 100000.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1799 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 22 to 300
[INFO] Sharpe ratio range: -0.5543 to 0.6277
[INFO] 
Best parameters:
[INFO] Short SMA: 106
[INFO] Long SMA: 160
[INFO] Sharpe Ratio: 0.627696
[INFO] Number of Trades: 14
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1799 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 22.0 to 300.0
[INFO] Sharpe ratio range: -0.5543 to 0.6277
[INFO] Trades range: 10.0 to 186.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.3657 to 2.5879
[INFO] Scaled Long SMA range: -2.9553 to 2.0914
[INFO] Scaled Sharpe ratio range: -2.9730 to 2.0253
[INFO] Scaled Trades range: -0.6748 to 14.8572
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1799 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6290
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 15
[INFO] Using 15 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 15 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 161 elements
[INFO] Cluster 1: 206 elements
[INFO] Cluster 2: 208 elements
[INFO] Cluster 3: 155 elements
[INFO] Cluster 4: 362 elements
[INFO] Cluster 5: 65 elements
[INFO] Cluster 6: 133 elements
[INFO] Cluster 7: 59 elements
[INFO] Cluster 8: 13 elements
[INFO] Cluster 9: 43 elements
[INFO] Cluster 10: 34 elements
[INFO] Cluster 11: 138 elements
[INFO] Cluster 12: 111 elements
[INFO] Cluster 13: 1 elements
[INFO] Cluster 14: 110 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=28, Long SMA=188, Sharpe=0.1167, Trades=14
[INFO] Cluster 1 cluster: Short SMA=138, Long SMA=190, Sharpe=0.3020, Trades=12
[INFO] Cluster 2 cluster: Short SMA=42, Long SMA=166, Sharpe=-0.1907, Trades=14
[INFO] Cluster 3 cluster: Short SMA=34, Long SMA=256, Sharpe=-0.1094, Trades=12
[INFO] Cluster 4 cluster: Short SMA=102, Long SMA=168, Sharpe=0.4730, Trades=12
[INFO] Cluster 5 cluster: Short SMA=28, Long SMA=56, Sharpe=0.0188, Trades=44
[INFO] Cluster 6 cluster: Short SMA=208, Long SMA=236, Sharpe=-0.0220, Trades=13
[INFO] Cluster 7 cluster: Short SMA=88, Long SMA=100, Sharpe=-0.2965, Trades=35
[INFO] Cluster 9 cluster: Short SMA=240, Long SMA=244, Sharpe=0.0672, Trades=33
[INFO] Cluster 10 cluster: Short SMA=150, Long SMA=154, Sharpe=0.4153, Trades=38
[INFO] Cluster 11 cluster: Short SMA=266, Long SMA=284, Sharpe=-0.0245, Trades=15
[INFO] Cluster 12 cluster: Short SMA=84, Long SMA=128, Sharpe=0.0477, Trades=19
[INFO] Cluster 14 cluster: Short SMA=132, Long SMA=154, Sharpe=0.2187, Trades=18
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=106, Long SMA=160, Sharpe=0.6277, Trades=14
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=102, Long SMA=168, Sharpe=0.4730, Trades=12
[INFO] Top 2: Short SMA=150, Long SMA=154, Sharpe=0.4153, Trades=38
[INFO] Top 3: Short SMA=138, Long SMA=190, Sharpe=0.3020, Trades=12
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 1785 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 106, Long SMA: 160
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(102/168) - Original Sharpe: 0.4730, Trades: 12
[INFO] Hierarchical cluster 2: SMA(150/154) - Original Sharpe: 0.4153, Trades: 38
[INFO] Hierarchical cluster 3: SMA(138/190) - Original Sharpe: 0.3020, Trades: 12
[INFO] Hierarchical cluster 4: SMA(132/154) - Original Sharpe: 0.2187, Trades: 18
[INFO] Hierarchical cluster 5: SMA(28/188) - Original Sharpe: 0.1167, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (106/160)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (102/168) - Sharpe: 0.4730
[INFO] cluster 2: (150/154) - Sharpe: 0.4153
[INFO] cluster 3: (138/190) - Sharpe: 0.3020
[INFO] Loading AD data from local files...
[INFO] Found data file: A_OHLCV_@AD_minutes_1440_1703-1557.dat
[INFO] File size: 296208 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.551202            0.551202
1    2021-11-14 2021-11-14            43     0.620829            0.620829
2    2022-01-14 2022-01-14            41     0.058063            0.058063
3    2022-03-14 2022-03-14            44     1.979608            1.491246
4    2022-05-14 2022-05-14            43    -1.220633            0.783922
5    2022-07-14 2022-07-14            44     0.448047            0.722602
6    2022-09-14 2022-09-14            43     0.790083            0.790083
7    2022-11-14 2022-11-14            43    -1.736792           -1.736792
8    2023-01-14 2023-01-14            41     2.493082            2.493082
9    2023-03-14 2023-03-14            44    -0.132668           -0.292013
10   2023-05-14 2023-05-14            44     0.580825            1.148770
11   2023-07-14 2023-07-14            44     4.541233            2.808763
12   2023-09-14 2023-09-14            43     0.691612            0.691612
13   2023-11-14 2023-11-14            42    -2.563801           -3.100356
14   2024-01-14 2024-01-14            43     4.073536            1.681490
15   2024-03-14 2024-03-14            42    -0.424007            0.619271
16   2024-05-14 2024-05-14            44    -1.116674            0.726240
17   2024-07-14 2024-07-14            45     3.495207           -0.064369
18   2024-09-14 2024-09-14            43    -2.003748           -2.391713
19   2024-11-14 2024-11-14            33     3.170976           -0.956787
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2021-11-14   |          0.6 |              0.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |          0.1 |              0.1 |          0.0 | Excluded      
[INFO] 2022-03-14   |          2.0 |              1.5 |         -0.5 | False         
[INFO] 2022-05-14   |         -1.2 |              0.8 |          2.0 | True          
[INFO] 2022-07-14   |          0.4 |              0.7 |          0.3 | True          
[INFO] 2022-09-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -1.7 |             -1.7 |          0.0 | Excluded      
[INFO] 2023-01-14   |          2.5 |              2.5 |          0.0 | Excluded      
[INFO] 2023-03-14   |         -0.1 |             -0.3 |         -0.2 | False         
[INFO] 2023-05-14   |          0.6 |              1.1 |          0.5 | True          
[INFO] 2023-07-14   |          4.5 |              2.8 |         -1.7 | False         
[INFO] 2023-09-14   |          0.7 |              0.7 |          0.0 | Excluded      
[INFO] 2023-11-14   |         -2.6 |             -3.1 |         -0.5 | False         
[INFO] 2024-01-14   |          4.1 |              1.7 |         -2.4 | False         
[INFO] 2024-03-14   |         -0.4 |              0.6 |          1.0 | True          
[INFO] 2024-05-14   |         -1.1 |              0.7 |          1.8 | True          
[INFO] 2024-07-14   |          3.5 |             -0.1 |         -3.6 | False         
[INFO] 2024-09-14   |         -2.0 |             -2.4 |         -0.4 | False         
[INFO] 2024-11-14   |          3.2 |             -1.0 |         -4.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-09-14, 2021-11-14, 2022-01-14, 2022-09-14, 2022-11-14, 2023-01-14, 2023-09-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 13 periods (38.46% win rate)
[INFO] Updating Excel file with Hierarchical results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical win rate 38.5% in row 3
[INFO] Added best Sharpe parameters 106/160 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 106, Long SMA: 160
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(102/168) - Original Sharpe: 0.4730
[INFO] Added cluster 2 to portfolio: SMA(150/154) - Original Sharpe: 0.4153
[INFO] Added cluster 3 to portfolio: SMA(138/190) - Original Sharpe: 0.3020
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'AD_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3075
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6449
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for AD...
[INFO] Excel file updated successfully. Added AD with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\AD
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BO in column D: 10.0
[INFO] Using slippage from Excel column D: 10.0
[INFO] 
Symbol: @BO
[INFO] Description: Soybean Oil Continuous Contract [May25]
[INFO] Exchange: CBOT
[INFO] Interval: minutes 1440
[INFO] Tick size: 6.0
[INFO] Big point value: 600.0
[INFO] Data shape: (5846, 6)
[INFO] Date range: 2001-05-14 13:13:00 to 2025-04-07 13:13:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime   open   high    low  close  volume
0 2001-05-14 13:13:00  22.96  22.96  22.96  22.96    10.0
1 2001-05-15 13:13:00  23.01  23.01  23.00  23.00    23.0
2 2001-05-16 13:13:00  22.91  22.91  22.91  22.91     5.0
3 2001-05-17 13:13:00  22.85  22.85  22.85  22.85     2.0
4 2001-05-18 13:13:00  23.06  23.15  23.06  23.15     7.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 36.58 seconds (0.61 minutes)
[INFO] Best parameters found: Short SMA = 48, Long SMA = 54
[INFO] Best fitness (Sharpe ratio): 1.148397
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 48, Long SMA = 54, Sharpe = 1.148397
[INFO] Top 2: Short SMA = 48, Long SMA = 66, Sharpe = 1.130687
[INFO] Top 3: Short SMA = 50, Long SMA = 54, Sharpe = 1.129939
[INFO] Top 4: Short SMA = 48, Long SMA = 56, Sharpe = 1.122568
[INFO] Top 5: Short SMA = 48, Long SMA = 64, Sharpe = 1.101316
[INFO] Hall of Fame size: 2318
[INFO] Number of elements in all_results: 1671
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 647 had penalty fitness
[INFO] Total filtered from Hall of Fame: 647
[INFO] Hall of Fame -> all_results: 2318 -> 1671
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1671 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3031, Evaluation data length: 2770
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BO
[INFO] Big Point Value (from data): 600.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 13.60 contracts
[INFO] Maximum Position Size: 31 contracts
[INFO] Strategy Total P&L: $553,098.00
[INFO] Market Buy & Hold P&L: $8,556.00
[INFO] Outperformance: $544,542.00
[INFO] Sharpe ratio (entire period, annualized): 0.651163
[INFO] Sharpe ratio (in-sample, annualized): 1.148397
[INFO] Sharpe ratio (out-of-sample, annualized): -0.439751
[INFO] Maximum Drawdown: $162,660.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 63
[INFO] Out-of-sample period trades: 26
[INFO] Total trades: 89
[INFO] In-sample P&L: $556,682.00
[INFO] Out-of-sample P&L: $-96,936.00
[INFO] 
Best parameters from GA: Short SMA = 48, Long SMA = 54, Sharpe = 1.148397
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2318
[INFO] Cache hits (repeated combinations): 6379
[INFO] Total checks: 8697
[INFO] Cache hit rate: 73.35%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1671 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 20 to 300
[INFO] Sharpe ratio range: -0.4907 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 63
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1671 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 20.0 to 300.0
[INFO] Sharpe ratio range: -0.4907 to 1.1484
[INFO] Trades range: 11.0 to 168.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9945 to 2.1141
[INFO] Scaled Long SMA range: -2.0891 to 1.4323
[INFO] Scaled Sharpe ratio range: -2.3533 to 3.0251
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 20
[INFO] Using 20 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=20...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 125 elements
[INFO] Kmeans Cluster 1: 61 elements
[INFO] Kmeans Cluster 2: 43 elements
[INFO] Kmeans Cluster 3: 51 elements
[INFO] Kmeans Cluster 4: 59 elements
[INFO] Kmeans Cluster 5: 125 elements
[INFO] Kmeans Cluster 6: 143 elements
[INFO] Kmeans Cluster 7: 83 elements
[INFO] Kmeans Cluster 8: 103 elements
[INFO] Kmeans Cluster 9: 117 elements
[INFO] Kmeans Cluster 10: 103 elements
[INFO] Kmeans Cluster 11: 111 elements
[INFO] Kmeans Cluster 12: 68 elements
[INFO] Kmeans Cluster 13: 71 elements
[INFO] Kmeans Cluster 14: 58 elements
[INFO] Kmeans Cluster 15: 81 elements
[INFO] Kmeans Cluster 16: 49 elements
[INFO] Kmeans Cluster 17: 16 elements
[INFO] Kmeans Cluster 18: 85 elements
[INFO] Kmeans Cluster 19: 119 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=53.87, Long SMA=206.78, Sharpe=-0.1186
[INFO] Centroid 1: Short SMA=196.56, Long SMA=217.93, Sharpe=0.1643
[INFO] Centroid 2: Short SMA=50.37, Long SMA=85.35, Sharpe=0.2621
[INFO] Centroid 3: Short SMA=45.37, Long SMA=62.94, Sharpe=0.9442
[INFO] Centroid 4: Short SMA=278.90, Long SMA=295.43, Sharpe=-0.1868
[INFO] Centroid 5: Short SMA=36.51, Long SMA=237.02, Sharpe=0.1596
[INFO] Centroid 6: Short SMA=245.86, Long SMA=273.71, Sharpe=0.3423
[INFO] Centroid 7: Short SMA=74.87, Long SMA=116.10, Sharpe=-0.0358
[INFO] Centroid 8: Short SMA=28.58, Long SMA=106.72, Sharpe=0.4499
[INFO] Centroid 9: Short SMA=20.55, Long SMA=269.68, Sharpe=0.3057
[INFO] Centroid 10: Short SMA=31.96, Long SMA=182.62, Sharpe=0.0548
[INFO] Centroid 11: Short SMA=255.20, Long SMA=283.11, Sharpe=0.1109
[INFO] Centroid 12: Short SMA=27.88, Long SMA=58.21, Sharpe=0.5636
[INFO] Centroid 13: Short SMA=121.21, Long SMA=162.03, Sharpe=-0.1307
[INFO] Centroid 14: Short SMA=144.28, Long SMA=192.41, Sharpe=0.0091
[INFO] Centroid 15: Short SMA=233.41, Long SMA=255.28, Sharpe=0.5682
[INFO] Centroid 16: Short SMA=65.88, Long SMA=174.33, Sharpe=-0.3223
[INFO] Centroid 18: Short SMA=34.38, Long SMA=143.76, Sharpe=0.2498
[INFO] Centroid 19: Short SMA=32.67, Long SMA=65.14, Sharpe=0.7454
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=54, Sharpe=1.1484, Trades=63
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=46, Long SMA=62, Sharpe=0.9485, Trades=39
[INFO] Kmeans Top 2: Short SMA=234, Long SMA=250, Sharpe=0.7420, Trades=19
[INFO] Kmeans Top 3: Short SMA=32, Long SMA=64, Sharpe=0.7292, Trades=24
[INFO] Kmeans Top 4: Short SMA=26, Long SMA=54, Sharpe=0.6297, Trades=30
[INFO] Kmeans Top 5: Short SMA=30, Long SMA=106, Sharpe=0.4133, Trades=20
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 18, 19}
[INFO]   Rounded: (54, 207)
[INFO]   Nearest: (54.0, 206.0)
[INFO]   Rounded: (197, 218)
[INFO]   Nearest: (196.0, 218.0)
[INFO]   Rounded: (50, 85)
[INFO]   Nearest: (50.0, 86.0)
[INFO]   Rounded: (45, 63)
[INFO]   Nearest: (46.0, 62.0)
[INFO]   Rounded: (279, 295)
[INFO]   Nearest: (278.0, 296.0)
[INFO]   Rounded: (37, 237)
[INFO]   Nearest: (36.0, 238.0)
[INFO]   Rounded: (246, 274)
[INFO]   Rounded: (75, 116)
[INFO]   Nearest: (74.0, 116.0)
[INFO]   Rounded: (29, 107)
[INFO]   Nearest: (28.0, 106.0)
[INFO]   Rounded: (21, 270)
[INFO]   Nearest: (20.0, 270.0)
[INFO]   Rounded: (32, 183)
[INFO]   Nearest: (32.0, 182.0)
[INFO]   Rounded: (255, 283)
[INFO]   Nearest: (256.0, 284.0)
[INFO]   Rounded: (28, 58)
[INFO]   Rounded: (121, 162)
[INFO]   Nearest: (122.0, 162.0)
[INFO]   Rounded: (144, 192)
[INFO]   Rounded: (233, 255)
[INFO]   Nearest: (234.0, 256.0)
[INFO]   Rounded: (66, 174)
[INFO]   Rounded: (34, 144)
[INFO]   Rounded: (33, 65)
[INFO]   Nearest: (32.0, 66.0)
[INFO] Successfully plotted 19 out of 19 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 54
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(46/62) - Original Sharpe: 0.9485, Trades: 39
[INFO] Kmeans cluster 2: SMA(234/250) - Original Sharpe: 0.7420, Trades: 19
[INFO] Kmeans cluster 3: SMA(32/64) - Original Sharpe: 0.7292, Trades: 24
[INFO] Kmeans cluster 4: SMA(26/54) - Original Sharpe: 0.6297, Trades: 30
[INFO] Kmeans cluster 5: SMA(30/106) - Original Sharpe: 0.4133, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/54)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (46/62) - Sharpe: 0.9485
[INFO] cluster 2: (234/250) - Sharpe: 0.7420
[INFO] cluster 3: (32/64) - Sharpe: 0.7292
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -3.408887           -3.100510
1    2021-11-10 2021-11-10            41    -4.249630           -2.670534
2    2022-01-10 2022-01-10            41     1.218137            2.166758
3    2022-03-10 2022-03-10            42     2.126254            2.442535
4    2022-05-10 2022-05-10            41    -5.000926           -4.489848
5    2022-07-10 2022-07-10            44    -0.790260           -0.019992
6    2022-09-10 2022-09-10            43     1.268514            3.602145
7    2022-11-10 2022-11-10            40    -2.869549           -1.881657
8    2023-01-10 2023-01-10            41     1.869806            2.198292
9    2023-03-10 2023-03-10            42     1.878823            1.736344
10   2023-05-10 2023-05-10            40    -1.601658           -2.041194
11   2023-07-10 2023-07-10            44     0.545769            1.118295
12   2023-09-10 2023-09-10            44     0.229410            1.064243
13   2023-11-10 2023-11-10            40     0.831968            0.831968
14   2024-01-10 2024-01-10            41     1.354455            2.139975
15   2024-03-10 2024-03-10            43    -1.598528           -3.397769
16   2024-05-10 2024-05-10            40     1.637085            0.320277
17   2024-07-10 2024-07-10            43    -1.484568           -0.601320
18   2024-09-10 2024-09-10            44     1.814989           -0.540454
19   2024-11-10 2024-11-10            35    -2.317816           -5.214923
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -3.4 |             -3.1 |          0.3 | True          
[INFO] 2021-11-10   |         -4.2 |             -2.7 |          1.5 | True          
[INFO] 2022-01-10   |          1.2 |              2.2 |          1.0 | True          
[INFO] 2022-03-10   |          2.1 |              2.4 |          0.3 | True          
[INFO] 2022-05-10   |         -5.0 |             -4.5 |          0.5 | True          
[INFO] 2022-07-10   |         -0.8 |             -0.0 |          0.8 | True          
[INFO] 2022-09-10   |          1.3 |              3.6 |          2.3 | True          
[INFO] 2022-11-10   |         -2.9 |             -1.9 |          1.0 | True          
[INFO] 2023-01-10   |          1.9 |              2.2 |          0.3 | True          
[INFO] 2023-03-10   |          1.9 |              1.7 |         -0.2 | False         
[INFO] 2023-05-10   |         -1.6 |             -2.0 |         -0.4 | False         
[INFO] 2023-07-10   |          0.5 |              1.1 |          0.6 | True          
[INFO] 2023-09-10   |          0.2 |              1.1 |          0.9 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.4 |              2.1 |          0.7 | True          
[INFO] 2024-03-10   |         -1.6 |             -3.4 |         -1.8 | False         
[INFO] 2024-05-10   |          1.6 |              0.3 |         -1.3 | False         
[INFO] 2024-07-10   |         -1.5 |             -0.6 |          0.9 | True          
[INFO] 2024-09-10   |          1.8 |             -0.5 |         -2.3 | False         
[INFO] 2024-11-10   |         -2.3 |             -5.2 |         -2.9 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Kmeans cluster wins (rounded comparison): 13 of 19 periods (68.42% win rate)
[INFO] Updating Excel file with Kmeans results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans win rate 68.4% in row 4
[INFO] Added best Sharpe parameters 48/54 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 54
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(46/62) - Original Sharpe: 0.9485
[INFO] Added cluster 2 to portfolio: SMA(234/250) - Original Sharpe: 0.7420
[INFO] Added cluster 3 to portfolio: SMA(32/64) - Original Sharpe: 0.7292
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BO_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.0190
[INFO] Kmeans Best out-of-sample Sharpe: -0.4398
[INFO] Kmeans Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Kmeans OOS comparison results for BO...
[INFO] Excel file updated successfully. Added BO with Kmeans portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BO
[INFO] Big Point Value: 600.0
[INFO] Slippage: 10.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1671 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 20 to 300
[INFO] Sharpe ratio range: -0.4907 to 1.1484
[INFO] 
Best parameters:
[INFO] Short SMA: 48
[INFO] Long SMA: 54
[INFO] Sharpe Ratio: 1.148397
[INFO] Number of Trades: 63
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1671 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 20.0 to 300.0
[INFO] Sharpe ratio range: -0.4907 to 1.1484
[INFO] Trades range: 11.0 to 168.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.9945 to 2.1141
[INFO] Scaled Long SMA range: -2.0891 to 1.4323
[INFO] Scaled Sharpe ratio range: -2.3533 to 3.0251
[INFO] Scaled Trades range: -0.7692 to 10.8451
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1671 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6625
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 18
[INFO] Using 18 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 18 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 254 elements
[INFO] Cluster 1: 187 elements
[INFO] Cluster 2: 33 elements
[INFO] Cluster 3: 54 elements
[INFO] Cluster 4: 130 elements
[INFO] Cluster 5: 43 elements
[INFO] Cluster 6: 21 elements
[INFO] Cluster 7: 19 elements
[INFO] Cluster 8: 122 elements
[INFO] Cluster 9: 110 elements
[INFO] Cluster 10: 123 elements
[INFO] Cluster 11: 31 elements
[INFO] Cluster 12: 139 elements
[INFO] Cluster 13: 2 elements
[INFO] Cluster 14: 92 elements
[INFO] Cluster 15: 140 elements
[INFO] Cluster 16: 40 elements
[INFO] Cluster 17: 131 elements
[INFO] Using 16 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=28, Long SMA=248, Sharpe=0.2647, Trades=15
[INFO] Cluster 1 cluster: Short SMA=258, Long SMA=284, Sharpe=0.2937, Trades=17
[INFO] Cluster 2 cluster: Short SMA=102, Long SMA=108, Sharpe=-0.1272, Trades=37
[INFO] Cluster 3 cluster: Short SMA=238, Long SMA=242, Sharpe=0.6394, Trades=43
[INFO] Cluster 4 cluster: Short SMA=148, Long SMA=196, Sharpe=0.0653, Trades=11
[INFO] Cluster 5 cluster: Short SMA=286, Long SMA=294, Sharpe=-0.4068, Trades=29
[INFO] Cluster 6 cluster: Short SMA=22, Long SMA=40, Sharpe=0.0963, Trades=54
[INFO] Cluster 8 cluster: Short SMA=234, Long SMA=270, Sharpe=0.3562, Trades=13
[INFO] Cluster 9 cluster: Short SMA=32, Long SMA=100, Sharpe=0.5158, Trades=20
[INFO] Cluster 10 cluster: Short SMA=48, Long SMA=158, Sharpe=0.0265, Trades=15
[INFO] Cluster 11 cluster: Short SMA=44, Long SMA=52, Sharpe=0.7789, Trades=55
[INFO] Cluster 12 cluster: Short SMA=34, Long SMA=64, Sharpe=0.7807, Trades=26
[INFO] Cluster 14 cluster: Short SMA=102, Long SMA=156, Sharpe=-0.0833, Trades=17
[INFO] Cluster 15 cluster: Short SMA=38, Long SMA=138, Sharpe=0.2607, Trades=15
[INFO] Cluster 16 cluster: Short SMA=22, Long SMA=50, Sharpe=0.6365, Trades=38
[INFO] Cluster 17 cluster: Short SMA=50, Long SMA=206, Sharpe=-0.1833, Trades=15
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=48, Long SMA=54, Sharpe=1.1484, Trades=63
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=34, Long SMA=64, Sharpe=0.7807, Trades=26
[INFO] Top 2: Short SMA=44, Long SMA=52, Sharpe=0.7789, Trades=55
[INFO] Top 3: Short SMA=238, Long SMA=242, Sharpe=0.6394, Trades=43
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 16 valid clusters with clusters
[INFO] Filtering to 1650 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 48, Long SMA: 54
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 261
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(34/64) - Original Sharpe: 0.7807, Trades: 26
[INFO] Hierarchical cluster 2: SMA(44/52) - Original Sharpe: 0.7789, Trades: 55
[INFO] Hierarchical cluster 3: SMA(238/242) - Original Sharpe: 0.6394, Trades: 43
[INFO] Hierarchical cluster 4: SMA(22/50) - Original Sharpe: 0.6365, Trades: 38
[INFO] Hierarchical cluster 5: SMA(32/100) - Original Sharpe: 0.5158, Trades: 20
[INFO] Trimmed warm-up period. Evaluation data length: 2770
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (48/54)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (34/64) - Sharpe: 0.7807
[INFO] cluster 2: (44/52) - Sharpe: 0.7789
[INFO] cluster 3: (238/242) - Sharpe: 0.6394
[INFO] Loading BO data from local files...
[INFO] Found data file: A_OHLCV_@BO_minutes_1440_1903-1313.dat
[INFO] File size: 280747 bytes
[INFO] Out-of-sample period starts on: 2021-09-10
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-10 2021-09-10            43    -3.408887           -2.767082
1    2021-11-10 2021-11-10            41    -4.249630           -2.856660
2    2022-01-10 2022-01-10            41     1.218137            1.875978
3    2022-03-10 2022-03-10            42     2.126254            2.656914
4    2022-05-10 2022-05-10            41    -5.000926           -3.769739
5    2022-07-10 2022-07-10            44    -0.790260           -0.024129
6    2022-09-10 2022-09-10            43     1.268514            2.470050
7    2022-11-10 2022-11-10            40    -2.869549           -2.126029
8    2023-01-10 2023-01-10            41     1.869806            1.635813
9    2023-03-10 2023-03-10            42     1.878823            1.515088
10   2023-05-10 2023-05-10            40    -1.601658           -2.108776
11   2023-07-10 2023-07-10            44     0.545769            1.266508
12   2023-09-10 2023-09-10            44     0.229410            2.389284
13   2023-11-10 2023-11-10            40     0.831968            0.831968
14   2024-01-10 2024-01-10            41     1.354455            1.628179
15   2024-03-10 2024-03-10            43    -1.598528           -4.287248
16   2024-05-10 2024-05-10            40     1.637085           -1.684666
17   2024-07-10 2024-07-10            43    -1.484568            0.603529
18   2024-09-10 2024-09-10            44     1.814989           -1.105884
19   2024-11-10 2024-11-10            35    -2.317816           -4.596442
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-10   |         -3.4 |             -2.8 |          0.6 | True          
[INFO] 2021-11-10   |         -4.2 |             -2.9 |          1.3 | True          
[INFO] 2022-01-10   |          1.2 |              1.9 |          0.7 | True          
[INFO] 2022-03-10   |          2.1 |              2.7 |          0.6 | True          
[INFO] 2022-05-10   |         -5.0 |             -3.8 |          1.2 | True          
[INFO] 2022-07-10   |         -0.8 |             -0.0 |          0.8 | True          
[INFO] 2022-09-10   |          1.3 |              2.5 |          1.2 | True          
[INFO] 2022-11-10   |         -2.9 |             -2.1 |          0.8 | True          
[INFO] 2023-01-10   |          1.9 |              1.6 |         -0.3 | False         
[INFO] 2023-03-10   |          1.9 |              1.5 |         -0.4 | False         
[INFO] 2023-05-10   |         -1.6 |             -2.1 |         -0.5 | False         
[INFO] 2023-07-10   |          0.5 |              1.3 |          0.8 | True          
[INFO] 2023-09-10   |          0.2 |              2.4 |          2.2 | True          
[INFO] 2023-11-10   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-01-10   |          1.4 |              1.6 |          0.2 | True          
[INFO] 2024-03-10   |         -1.6 |             -4.3 |         -2.7 | False         
[INFO] 2024-05-10   |          1.6 |             -1.7 |         -3.3 | False         
[INFO] 2024-07-10   |         -1.5 |              0.6 |          2.1 | True          
[INFO] 2024-09-10   |          1.8 |             -1.1 |         -2.9 | False         
[INFO] 2024-11-10   |         -2.3 |             -4.6 |         -2.3 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2023-11-10
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 12 of 19 periods (63.16% win rate)
[INFO] Updating Excel file with Hierarchical results for BO...
[INFO] Excel file updated successfully. Added BO with Hierarchical win rate 63.2% in row 4
[INFO] Added best Sharpe parameters 48/54 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 48, Long SMA: 54
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(34/64) - Original Sharpe: 0.7807
[INFO] Added cluster 2 to portfolio: SMA(44/52) - Original Sharpe: 0.7789
[INFO] Added cluster 3 to portfolio: SMA(238/242) - Original Sharpe: 0.6394
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BO_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: -0.2238
[INFO] Hierarchical Best out-of-sample Sharpe: -0.4398
[INFO] Hierarchical Portfolio outperforms Best in OOS: True
[INFO] Updating Excel file with Hierarchical OOS comparison results for BO...
[INFO] Excel file updated successfully. Added BO with Hierarchical portfolio comparison True in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BO
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BP in column D: 8.0
[INFO] Using slippage from Excel column D: 8.0
[INFO] 
Symbol: @BP
[INFO] Description: British Pound Continuous Contract [Jun25]
[INFO] Exchange: CME
[INFO] Interval: minutes 1440
[INFO] Tick size: 6.25
[INFO] Big point value: 62500.0
[INFO] Data shape: (6172, 6)
[INFO] Date range: 2001-05-14 15:57:00 to 2025-04-07 15:57:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high     low   close  volume
0 2001-05-14 15:57:00  1.2614  1.2638  1.2590  1.2636   688.0
1 2001-05-15 15:57:00  1.2618  1.2682  1.2600  1.2680  1481.0
2 2001-05-16 15:57:00  1.2672  1.2750  1.2642  1.2712  3327.0
3 2001-05-17 15:57:00  1.2744  1.2764  1.2704  1.2764  1313.0
4 2001-05-18 15:57:00  1.2762  1.2830  1.2698  1.2828  2100.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 40.84 seconds (0.68 minutes)
[INFO] Best parameters found: Short SMA = 42, Long SMA = 58
[INFO] Best fitness (Sharpe ratio): 0.774978
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 42, Long SMA = 58, Sharpe = 0.774978
[INFO] Top 2: Short SMA = 38, Long SMA = 60, Sharpe = 0.717867
[INFO] Top 3: Short SMA = 16, Long SMA = 114, Sharpe = 0.690853
[INFO] Top 4: Short SMA = 36, Long SMA = 62, Sharpe = 0.679847
[INFO] Top 5: Short SMA = 26, Long SMA = 76, Sharpe = 0.671828
[INFO] Hall of Fame size: 2450
[INFO] Number of elements in all_results: 1761
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 689 had penalty fitness
[INFO] Total filtered from Hall of Fame: 689
[INFO] Hall of Fame -> all_results: 2450 -> 1761
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 1761 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3109, Evaluation data length: 2842
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BP
[INFO] Big Point Value (from data): 62500.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 9.80 contracts
[INFO] Maximum Position Size: 17 contracts
[INFO] Strategy Total P&L: $603,751.00
[INFO] Market Buy & Hold P&L: $-29,593.75
[INFO] Outperformance: $633,344.75
[INFO] Sharpe ratio (entire period, annualized): 0.716232
[INFO] Sharpe ratio (in-sample, annualized): 0.774978
[INFO] Sharpe ratio (out-of-sample, annualized): 0.572860
[INFO] Maximum Drawdown: $88,641.75
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 39
[INFO] Out-of-sample period trades: 16
[INFO] Total trades: 55
[INFO] In-sample P&L: $424,013.75
[INFO] Out-of-sample P&L: $128,250.00
[INFO] 
Best parameters from GA: Short SMA = 42, Long SMA = 58, Sharpe = 0.774978
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2450
[INFO] Cache hits (repeated combinations): 6208
[INFO] Total checks: 8658
[INFO] Cache hit rate: 71.70%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 62500.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1761 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.5321 to 0.7750
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 58
[INFO] Sharpe Ratio: 0.774978
[INFO] Number of Trades: 39
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1761 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.5321 to 0.7750
[INFO] Trades range: 10.0 to 242.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.8850 to 2.8740
[INFO] Scaled Long SMA range: -2.0962 to 1.9674
[INFO] Scaled Sharpe ratio range: -3.0776 to 2.9035
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 15
[INFO] Using 15 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=15...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 81 elements
[INFO] Kmeans Cluster 1: 143 elements
[INFO] Kmeans Cluster 2: 199 elements
[INFO] Kmeans Cluster 3: 116 elements
[INFO] Kmeans Cluster 4: 102 elements
[INFO] Kmeans Cluster 5: 169 elements
[INFO] Kmeans Cluster 6: 147 elements
[INFO] Kmeans Cluster 7: 133 elements
[INFO] Kmeans Cluster 8: 53 elements
[INFO] Kmeans Cluster 9: 102 elements
[INFO] Kmeans Cluster 10: 51 elements
[INFO] Kmeans Cluster 11: 87 elements
[INFO] Kmeans Cluster 12: 184 elements
[INFO] Kmeans Cluster 13: 71 elements
[INFO] Kmeans Cluster 14: 123 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=202.89, Long SMA=218.94, Sharpe=0.1791
[INFO] Centroid 1: Short SMA=35.94, Long SMA=75.97, Sharpe=0.3933
[INFO] Centroid 2: Short SMA=52.74, Long SMA=214.65, Sharpe=0.0234
[INFO] Centroid 3: Short SMA=73.12, Long SMA=112.28, Sharpe=0.1672
[INFO] Centroid 4: Short SMA=270.82, Long SMA=284.82, Sharpe=-0.0377
[INFO] Centroid 5: Short SMA=22.76, Long SMA=241.01, Sharpe=0.2094
[INFO] Centroid 6: Short SMA=68.69, Long SMA=123.01, Sharpe=-0.0366
[INFO] Centroid 7: Short SMA=30.05, Long SMA=172.99, Sharpe=0.1465
[INFO] Centroid 8: Short SMA=66.15, Long SMA=97.74, Sharpe=-0.2333
[INFO] Centroid 9: Short SMA=20.35, Long SMA=49.35, Sharpe=0.1036
[INFO] Centroid 10: Short SMA=145.45, Long SMA=171.61, Sharpe=-0.2025
[INFO] Centroid 11: Short SMA=21.59, Long SMA=137.36, Sharpe=0.3389
[INFO] Centroid 12: Short SMA=26.51, Long SMA=96.11, Sharpe=0.5430
[INFO] Centroid 13: Short SMA=249.44, Long SMA=267.41, Sharpe=-0.1662
[INFO] Centroid 14: Short SMA=109.22, Long SMA=176.16, Sharpe=0.0114
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=58, Sharpe=0.7750, Trades=39
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=24, Long SMA=100, Sharpe=0.5612, Trades=17
[INFO] Kmeans Top 2: Short SMA=36, Long SMA=76, Sharpe=0.4568, Trades=29
[INFO] Kmeans Top 3: Short SMA=20, Long SMA=136, Sharpe=0.3881, Trades=13
[INFO] Kmeans Top 4: Short SMA=32, Long SMA=172, Sharpe=0.2010, Trades=13
[INFO] Kmeans Top 5: Short SMA=22, Long SMA=238, Sharpe=0.1056, Trades=12
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}
[INFO]   Rounded: (203, 219)
[INFO]   Nearest: (202.0, 218.0)
[INFO]   Rounded: (36, 76)
[INFO]   Rounded: (53, 215)
[INFO]   Nearest: (52.0, 214.0)
[INFO]   Rounded: (73, 112)
[INFO]   Nearest: (74.0, 112.0)
[INFO]   Rounded: (271, 285)
[INFO]   Nearest: (270.0, 284.0)
[INFO]   Rounded: (23, 241)
[INFO]   Nearest: (22.0, 242.0)
[INFO]   Rounded: (69, 123)
[INFO]   Nearest: (68.0, 124.0)
[INFO]   Rounded: (30, 173)
[INFO]   Nearest: (30.0, 172.0)
[INFO]   Rounded: (66, 98)
[INFO]   Rounded: (20, 49)
[INFO]   Nearest: (20.0, 50.0)
[INFO]   Rounded: (145, 172)
[INFO]   Nearest: (146.0, 172.0)
[INFO]   Rounded: (22, 137)
[INFO]   Nearest: (22.0, 138.0)
[INFO]   Rounded: (27, 96)
[INFO]   Nearest: (26.0, 96.0)
[INFO]   Rounded: (249, 267)
[INFO]   Nearest: (250.0, 268.0)
[INFO]   Rounded: (109, 176)
[INFO]   Nearest: (110.0, 176.0)
[INFO] Successfully plotted 15 out of 15 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 58
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(24/100) - Original Sharpe: 0.5612, Trades: 17
[INFO] Kmeans cluster 2: SMA(36/76) - Original Sharpe: 0.4568, Trades: 29
[INFO] Kmeans cluster 3: SMA(20/136) - Original Sharpe: 0.3881, Trades: 13
[INFO] Kmeans cluster 4: SMA(32/172) - Original Sharpe: 0.2010, Trades: 13
[INFO] Kmeans cluster 5: SMA(22/238) - Original Sharpe: 0.1056, Trades: 12
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/58)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (24/100) - Sharpe: 0.5612
[INFO] cluster 2: (36/76) - Sharpe: 0.4568
[INFO] cluster 3: (20/136) - Sharpe: 0.3881
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.987883            2.470739
1    2021-11-14 2021-11-14            43    -2.596797           -2.596797
2    2022-01-14 2022-01-14            41    -0.015731            0.624405
3    2022-03-14 2022-03-14            44     3.605243            3.630872
4    2022-05-14 2022-05-14            43     1.166814            1.166814
5    2022-07-14 2022-07-14            44     2.275295            2.275295
6    2022-09-14 2022-09-14            43     0.019017            0.019017
7    2022-11-14 2022-11-14            43    -0.093903           -0.806569
8    2023-01-14 2023-01-14            41     1.898865           -1.512001
9    2023-03-14 2023-03-14            44    -0.658221           -0.833429
10   2023-05-14 2023-05-14            44     4.055520            4.055520
11   2023-07-14 2023-07-14            44    -5.179654           -5.074293
12   2023-09-14 2023-09-14            43     1.327473            0.903637
13   2023-11-14 2023-11-14            42    -1.340773           -0.527585
14   2024-01-14 2024-01-14            43    -2.266886           -0.091221
15   2024-03-14 2024-03-14            42     2.522025           -3.575690
16   2024-05-14 2024-05-14            44    -0.336600           -0.082816
17   2024-07-14 2024-07-14            45     0.798888            0.798888
18   2024-09-14 2024-09-14            43     0.601562           -1.307698
19   2024-11-14 2024-11-14            33     1.741863            1.491099
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              2.5 |          1.5 | True          
[INFO] 2021-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -0.0 |              0.6 |          0.6 | True          
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.1 |             -0.8 |         -0.7 | False         
[INFO] 2023-01-14   |          1.9 |             -1.5 |         -3.4 | False         
[INFO] 2023-03-14   |         -0.7 |             -0.8 |         -0.1 | False         
[INFO] 2023-05-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -5.2 |             -5.1 |          0.1 | True          
[INFO] 2023-09-14   |          1.3 |              0.9 |         -0.4 | False         
[INFO] 2023-11-14   |         -1.3 |             -0.5 |          0.8 | True          
[INFO] 2024-01-14   |         -2.3 |             -0.1 |          2.2 | True          
[INFO] 2024-03-14   |          2.5 |             -3.6 |         -6.1 | False         
[INFO] 2024-05-14   |         -0.3 |             -0.1 |          0.2 | True          
[INFO] 2024-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.6 |             -1.3 |         -1.9 | False         
[INFO] 2024-11-14   |          1.7 |              1.5 |         -0.2 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 13
[INFO] Kmeans cluster wins (rounded comparison): 6 of 13 periods (46.15% win rate)
[INFO] Updating Excel file with Kmeans results for BP...
[INFO] Excel file updated successfully. Added BP with Kmeans win rate 46.2% in row 5
[INFO] Added best Sharpe parameters 42/58 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 58
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(24/100) - Original Sharpe: 0.5612
[INFO] Added cluster 2 to portfolio: SMA(36/76) - Original Sharpe: 0.4568
[INFO] Added cluster 3 to portfolio: SMA(20/136) - Original Sharpe: 0.3881
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BP_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: 0.2802
[INFO] Kmeans Best out-of-sample Sharpe: 0.5729
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for BP...
[INFO] Excel file updated successfully. Added BP with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BP
[INFO] Big Point Value: 62500.0
[INFO] Slippage: 8.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 1761 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 14 to 300
[INFO] Sharpe ratio range: -0.5321 to 0.7750
[INFO] 
Best parameters:
[INFO] Short SMA: 42
[INFO] Long SMA: 58
[INFO] Sharpe Ratio: 0.774978
[INFO] Number of Trades: 39
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 1761 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 14.0 to 300.0
[INFO] Sharpe ratio range: -0.5321 to 0.7750
[INFO] Trades range: 10.0 to 242.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -0.8850 to 2.8740
[INFO] Scaled Long SMA range: -2.0962 to 1.9674
[INFO] Scaled Sharpe ratio range: -3.0776 to 2.9035
[INFO] Scaled Trades range: -0.6308 to 14.7709
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 1761 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6266
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 129 elements
[INFO] Cluster 1: 184 elements
[INFO] Cluster 2: 153 elements
[INFO] Cluster 3: 170 elements
[INFO] Cluster 4: 294 elements
[INFO] Cluster 5: 44 elements
[INFO] Cluster 6: 96 elements
[INFO] Cluster 7: 140 elements
[INFO] Cluster 8: 80 elements
[INFO] Cluster 9: 16 elements
[INFO] Cluster 10: 238 elements
[INFO] Cluster 11: 2 elements
[INFO] Cluster 12: 73 elements
[INFO] Cluster 13: 142 elements
[INFO] Using 12 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=36, Long SMA=66, Sharpe=0.4870, Trades=30
[INFO] Cluster 1 cluster: Short SMA=66, Long SMA=116, Sharpe=-0.2499, Trades=13
[INFO] Cluster 2 cluster: Short SMA=126, Long SMA=170, Sharpe=-0.0660, Trades=10
[INFO] Cluster 3 cluster: Short SMA=268, Long SMA=282, Sharpe=-0.1746, Trades=15
[INFO] Cluster 4 cluster: Short SMA=26, Long SMA=226, Sharpe=-0.0003, Trades=12
[INFO] Cluster 5 cluster: Short SMA=28, Long SMA=44, Sharpe=-0.0661, Trades=53
[INFO] Cluster 6 cluster: Short SMA=26, Long SMA=58, Sharpe=0.1090, Trades=39
[INFO] Cluster 7 cluster: Short SMA=26, Long SMA=126, Sharpe=0.3174, Trades=13
[INFO] Cluster 8 cluster: Short SMA=206, Long SMA=220, Sharpe=0.0237, Trades=14
[INFO] Cluster 10 cluster: Short SMA=58, Long SMA=196, Sharpe=0.0016, Trades=11
[INFO] Cluster 12 cluster: Short SMA=56, Long SMA=108, Sharpe=0.0758, Trades=13
[INFO] Cluster 13 cluster: Short SMA=22, Long SMA=102, Sharpe=0.5188, Trades=17
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=42, Long SMA=58, Sharpe=0.7750, Trades=39
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=22, Long SMA=102, Sharpe=0.5188, Trades=17
[INFO] Top 2: Short SMA=36, Long SMA=66, Sharpe=0.4870, Trades=30
[INFO] Top 3: Short SMA=26, Long SMA=126, Sharpe=0.3174, Trades=13
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 12 valid clusters with clusters
[INFO] Filtering to 1743 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 42, Long SMA: 58
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(22/102) - Original Sharpe: 0.5188, Trades: 17
[INFO] Hierarchical cluster 2: SMA(36/66) - Original Sharpe: 0.4870, Trades: 30
[INFO] Hierarchical cluster 3: SMA(26/126) - Original Sharpe: 0.3174, Trades: 13
[INFO] Hierarchical cluster 4: SMA(26/58) - Original Sharpe: 0.1090, Trades: 39
[INFO] Hierarchical cluster 5: SMA(56/108) - Original Sharpe: 0.0758, Trades: 13
[INFO] Trimmed warm-up period. Evaluation data length: 2842
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (42/58)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (22/102) - Sharpe: 0.5188
[INFO] cluster 2: (36/66) - Sharpe: 0.4870
[INFO] cluster 3: (26/126) - Sharpe: 0.3174
[INFO] Loading BP data from local files...
[INFO] Found data file: A_OHLCV_@BP_minutes_1440_1703-1557.dat
[INFO] File size: 296396 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     0.987883            2.470739
1    2021-11-14 2021-11-14            43    -2.596797           -2.596797
2    2022-01-14 2022-01-14            41    -0.015731            2.657312
3    2022-03-14 2022-03-14            44     3.605243            3.605243
4    2022-05-14 2022-05-14            43     1.166814            1.166814
5    2022-07-14 2022-07-14            44     2.275295            2.275295
6    2022-09-14 2022-09-14            43     0.019017            0.019017
7    2022-11-14 2022-11-14            43    -0.093903           -0.364579
8    2023-01-14 2023-01-14            41     1.898865           -0.887742
9    2023-03-14 2023-03-14            44    -0.658221           -0.667218
10   2023-05-14 2023-05-14            44     4.055520            4.055520
11   2023-07-14 2023-07-14            44    -5.179654           -4.566425
12   2023-09-14 2023-09-14            43     1.327473            0.903637
13   2023-11-14 2023-11-14            42    -1.340773           -2.323421
14   2024-01-14 2024-01-14            43    -2.266886           -0.228408
15   2024-03-14 2024-03-14            42     2.522025           -3.754745
16   2024-05-14 2024-05-14            44    -0.336600            0.393737
17   2024-07-14 2024-07-14            45     0.798888            0.798888
18   2024-09-14 2024-09-14            43     0.601562           -0.713558
19   2024-11-14 2024-11-14            33     1.741863            1.183272
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          1.0 |              2.5 |          1.5 | True          
[INFO] 2021-11-14   |         -2.6 |             -2.6 |          0.0 | Excluded      
[INFO] 2022-01-14   |         -0.0 |              2.7 |          2.7 | True          
[INFO] 2022-03-14   |          3.6 |              3.6 |          0.0 | Excluded      
[INFO] 2022-05-14   |          1.2 |              1.2 |          0.0 | Excluded      
[INFO] 2022-07-14   |          2.3 |              2.3 |          0.0 | Excluded      
[INFO] 2022-09-14   |          0.0 |              0.0 |          0.0 | Excluded      
[INFO] 2022-11-14   |         -0.1 |             -0.4 |         -0.3 | False         
[INFO] 2023-01-14   |          1.9 |             -0.9 |         -2.8 | False         
[INFO] 2023-03-14   |         -0.7 |             -0.7 |          0.0 | Excluded      
[INFO] 2023-05-14   |          4.1 |              4.1 |          0.0 | Excluded      
[INFO] 2023-07-14   |         -5.2 |             -4.6 |          0.6 | True          
[INFO] 2023-09-14   |          1.3 |              0.9 |         -0.4 | False         
[INFO] 2023-11-14   |         -1.3 |             -2.3 |         -1.0 | False         
[INFO] 2024-01-14   |         -2.3 |             -0.2 |          2.1 | True          
[INFO] 2024-03-14   |          2.5 |             -3.8 |         -6.3 | False         
[INFO] 2024-05-14   |         -0.3 |              0.4 |          0.7 | True          
[INFO] 2024-07-14   |          0.8 |              0.8 |          0.0 | Excluded      
[INFO] 2024-09-14   |          0.6 |             -0.7 |         -1.3 | False         
[INFO] 2024-11-14   |          1.7 |              1.2 |         -0.5 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2021-11-14, 2022-03-14, 2022-05-14, 2022-07-14, 2022-09-14, 2023-03-14, 2023-05-14, 2024-07-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 12
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 12 periods (41.67% win rate)
[INFO] Updating Excel file with Hierarchical results for BP...
[INFO] Excel file updated successfully. Added BP with Hierarchical win rate 41.7% in row 5
[INFO] Added best Sharpe parameters 42/58 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 42, Long SMA: 58
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(22/102) - Original Sharpe: 0.5188
[INFO] Added cluster 2 to portfolio: SMA(36/66) - Original Sharpe: 0.4870
[INFO] Added cluster 3 to portfolio: SMA(26/126) - Original Sharpe: 0.3174
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BP_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.3308
[INFO] Hierarchical Best out-of-sample Sharpe: 0.5729
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for BP...
[INFO] Excel file updated successfully. Added BP with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BP
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] 
Contents of sessions_slippages.xlsx:
[INFO]   symbol symbol.1    session  slippage
0   @MP1      MP1  1710-1550       8.5
1   @NE1      NE1  1703-1557       9.0
2   @RTY      RTY  1703-1557      12.0
3    @SB       SB  0333-1256      14.0
4    @CT       CT  2102-1417      16.0
[INFO] Columns: ['symbol', 'symbol.1', 'session', 'slippage']
[INFO] Found slippage for BRN in column D: 12.0
[INFO] Using slippage from Excel column D: 12.0
[INFO] 
Symbol: @BRN=107XC
[INFO] Description: Brent Crude Oil Custom Continuous Contract
[INFO] Exchange: ICE
[INFO] Interval: minutes 1440
[INFO] Tick size: 10.0
[INFO] Big point value: 1000.0
[INFO] Data shape: (4305, 6)
[INFO] Date range: 2008-08-04 16:50:00 to 2025-04-07 16:50:00
[INFO] 
First few rows of OHLCV data:
[INFO]              datetime    open    high    low   close   volume
0 2008-08-04 16:50:00  105.59  105.90  99.40  100.91  51914.0
1 2008-08-05 16:50:00   99.15  100.57  97.60   97.82  41121.0
2 2008-08-06 16:50:00   97.69   99.21  96.05   97.19  19682.0
3 2008-08-07 16:50:00   97.61   99.74  96.38   97.97  20263.0
4 2008-08-08 16:50:00   97.69   98.23  93.43   93.43  23829.0
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
Starting genetic algorithm optimization...
[INFO] Population size: 900, Generations: 10
[INFO] Using genetic algorithm parameters from input.py
[INFO] 
Genetic algorithm optimization completed in 34.34 seconds (0.57 minutes)
[INFO] Best parameters found: Short SMA = 10, Long SMA = 26
[INFO] Best fitness (Sharpe ratio): 1.115955
[INFO] 
--- TOP GENETIC ALGORITHM RESULTS ---
[INFO] Top 1: Short SMA = 10, Long SMA = 26, Sharpe = 1.115955
[INFO] Top 2: Short SMA = 14, Long SMA = 26, Sharpe = 1.040637
[INFO] Top 3: Short SMA = 10, Long SMA = 24, Sharpe = 1.013595
[INFO] Top 4: Short SMA = 12, Long SMA = 22, Sharpe = 1.010803
[INFO] Top 5: Short SMA = 16, Long SMA = 26, Sharpe = 1.010220
[INFO] Hall of Fame size: 2389
[INFO] Number of elements in all_results: 2132
[INFO] Hall of Fame filtering: 0 had invalid SMA order, 257 had penalty fitness
[INFO] Total filtered from Hall of Fame: 257
[INFO] Hall of Fame -> all_results: 2389 -> 2132
[INFO] Saved GA optimization results to optimized_strategies.pkl (sorted by short_SMA, 2132 unique strategies)
[INFO] 
Applying best strategy parameters...
[INFO] Strategy application completed.
[INFO] Trimming warm-up period for final evaluation and visualization...
[INFO] Original data length: 3107, Evaluation data length: 2840
[INFO] Visualization completed.
[INFO] Performance metrics calculation completed.
[INFO] 
--- PERFORMANCE SUMMARY OF GA-OPTIMIZED SMA STRATEGY ---
[INFO] Symbol: @BRN=107XC
[INFO] Big Point Value (from data): 1000.0
[INFO] ATR Period for Position Sizing: 30 days
[INFO] Capital Allocation: $6,000
[INFO] Average Position Size: 3.82 contracts
[INFO] Maximum Position Size: 6 contracts
[INFO] Strategy Total P&L: $738,554.00
[INFO] Market Buy & Hold P&L: $-13,990.00
[INFO] Outperformance: $752,544.00
[INFO] Sharpe ratio (entire period, annualized): 0.960879
[INFO] Sharpe ratio (in-sample, annualized): 1.115955
[INFO] Sharpe ratio (out-of-sample, annualized): 0.618723
[INFO] Maximum Drawdown: $146,756.00
[INFO] 
--- TRADE COUNT SUMMARY ---
[INFO] In-sample period trades: 66
[INFO] Out-of-sample period trades: 40
[INFO] Total trades: 106
[INFO] In-sample P&L: $658,590.00
[INFO] Out-of-sample P&L: $165,200.00
[INFO] 
Best parameters from GA: Short SMA = 10, Long SMA = 26, Sharpe = 1.115955
[INFO] 
Evaluation Statistics:
[INFO] Unique evaluations: 2389
[INFO] Cache hits (repeated combinations): 6252
[INFO] Total checks: 8641
[INFO] Cache hit rate: 72.35%
[INFO] 
Analysis complete!
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting ATR-based SMA strategy analysis...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2132 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8070 to 1.1160
[INFO] 
Best parameters:
[INFO] Short SMA: 10
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 1.115955
[INFO] Number of Trades: 66
[INFO] 
Proceeding with Kmeans cluster analysis...
[INFO] 
----- Kmeans ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2132 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8070 to 1.1160
[INFO] Trades range: 10.0 to 222.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1523 to 2.1716
[INFO] Scaled Long SMA range: -2.5534 to 1.3353
[INFO] Scaled Sharpe ratio range: -4.3511 to 3.3233
[INFO] 
Determining optimal number of Kmeans clusters using elbow method...
[INFO] 
Calculating Kmeans elbow curve...
[INFO] Optimal number of Kmeans clusters from elbow method: 12
[INFO] Using 12 Kmeans clusters based on elbow method (threshold=5)
[INFO] Performing Kmeans clustering with k=12...
[INFO] 
Kmeans Cluster sizes:
[INFO] Kmeans Cluster 0: 164 elements
[INFO] Kmeans Cluster 1: 271 elements
[INFO] Kmeans Cluster 2: 146 elements
[INFO] Kmeans Cluster 3: 111 elements
[INFO] Kmeans Cluster 4: 134 elements
[INFO] Kmeans Cluster 5: 165 elements
[INFO] Kmeans Cluster 6: 167 elements
[INFO] Kmeans Cluster 7: 115 elements
[INFO] Kmeans Cluster 8: 240 elements
[INFO] Kmeans Cluster 9: 230 elements
[INFO] Kmeans Cluster 10: 261 elements
[INFO] Kmeans Cluster 11: 128 elements
[INFO] Computing Kmeans clusters...
[INFO] 
Kmeans Cluster Centroids (in original space):
[INFO] Centroid 0: Short SMA=200.38, Long SMA=246.09, Sharpe=0.3529
[INFO] Centroid 1: Short SMA=26.55, Long SMA=204.21, Sharpe=0.3733
[INFO] Centroid 2: Short SMA=24.32, Long SMA=46.51, Sharpe=0.6957
[INFO] Centroid 3: Short SMA=151.77, Long SMA=198.43, Sharpe=0.1930
[INFO] Centroid 4: Short SMA=257.16, Long SMA=287.09, Sharpe=-0.0269
[INFO] Centroid 5: Short SMA=28.64, Long SMA=78.23, Sharpe=0.4405
[INFO] Centroid 6: Short SMA=87.25, Long SMA=208.69, Sharpe=-0.0147
[INFO] Centroid 7: Short SMA=95.79, Long SMA=138.07, Sharpe=-0.2687
[INFO] Centroid 8: Short SMA=29.13, Long SMA=266.37, Sharpe=0.3725
[INFO] Centroid 9: Short SMA=181.06, Long SMA=212.45, Sharpe=0.5463
[INFO] Centroid 10: Short SMA=216.28, Long SMA=276.61, Sharpe=0.1703
[INFO] Centroid 11: Short SMA=30.31, Long SMA=133.94, Sharpe=0.2079
[INFO] 
----- Kmeans CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=10, Long SMA=26, Sharpe=1.1160, Trades=66
[INFO] 
Top 5 Kmeans clusters (by Sharpe ratio):
[INFO] Kmeans Top 1: Short SMA=182, Long SMA=214, Sharpe=0.5974, Trades=14
[INFO] Kmeans Top 2: Short SMA=26, Long SMA=46, Sharpe=0.5494, Trades=49
[INFO] Kmeans Top 3: Short SMA=32, Long SMA=84, Sharpe=0.5195, Trades=27
[INFO] Kmeans Top 4: Short SMA=26, Long SMA=266, Sharpe=0.4705, Trades=12
[INFO] Kmeans Top 5: Short SMA=26, Long SMA=210, Sharpe=0.3790, Trades=14
[INFO] Creating Kmeans cluster visualization...
[INFO] Plotting centroids from valid Kmeans clusters...
[INFO] Filtering centroids to only include valid Kmeans clusters: {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11}
[INFO]   Rounded: (200, 246)
[INFO]   Rounded: (27, 204)
[INFO]   Nearest: (26.0, 204.0)
[INFO]   Rounded: (24, 47)
[INFO]   Nearest: (24.0, 46.0)
[INFO]   Rounded: (152, 198)
[INFO]   Rounded: (257, 287)
[INFO]   Nearest: (258.0, 288.0)
[INFO]   Rounded: (29, 78)
[INFO]   Nearest: (28.0, 78.0)
[INFO]   Rounded: (87, 209)
[INFO]   Nearest: (88.0, 208.0)
[INFO]   Rounded: (96, 138)
[INFO]   Rounded: (29, 266)
[INFO]   Nearest: (30.0, 266.0)
[INFO]   Rounded: (181, 212)
[INFO]   Nearest: (182.0, 212.0)
[INFO]   Rounded: (216, 277)
[INFO]   Nearest: (216.0, 276.0)
[INFO]   Rounded: (30, 134)
[INFO] Successfully plotted 12 out of 12 centroids
[INFO] 
Plotting Kmeans strategy performance...
[INFO] 
----- Kmeans PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 10, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Kmeans clusters (IN ORIGINAL ORDER):
[INFO] Kmeans cluster 1: SMA(182/214) - Original Sharpe: 0.5974, Trades: 14
[INFO] Kmeans cluster 2: SMA(26/46) - Original Sharpe: 0.5494, Trades: 49
[INFO] Kmeans cluster 3: SMA(32/84) - Original Sharpe: 0.5195, Trades: 27
[INFO] Kmeans cluster 4: SMA(26/266) - Original Sharpe: 0.4705, Trades: 12
[INFO] Kmeans cluster 5: SMA(26/210) - Original Sharpe: 0.3790, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing Kmeans bimonthly out-of-sample comparison...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (10/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Kmeans clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (182/214) - Sharpe: 0.5974
[INFO] cluster 2: (26/46) - Sharpe: 0.5494
[INFO] cluster 3: (32/84) - Sharpe: 0.5195
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     4.800806            1.927524
1    2021-11-14 2021-11-14            44     2.049644           -3.292411
2    2022-01-14 2022-01-14            41     3.528418            3.290890
3    2022-03-14 2022-03-14            44     0.138982           -0.143350
4    2022-05-14 2022-05-14            43     1.388289           -0.718144
5    2022-07-14 2022-07-14            44    -3.155014            1.549405
6    2022-09-14 2022-09-14            43    -0.180219            0.211465
7    2022-11-14 2022-11-14            43    -1.334805           -3.001429
8    2023-01-14 2023-01-14            41    -0.581478            1.797610
9    2023-03-14 2023-03-14            43    -0.524319            0.350377
10   2023-05-14 2023-05-14            44    -1.200228           -1.707234
11   2023-07-14 2023-07-14            44     0.362193            1.210281
12   2023-09-14 2023-09-14            43    -2.369631           -1.463814
13   2023-11-14 2023-11-14            42     1.581330            0.747007
14   2024-01-14 2024-01-14            43     1.622963            0.687434
15   2024-03-14 2024-03-14            42     4.138827            0.424545
16   2024-05-14 2024-05-14            44    -0.527309           -4.461610
17   2024-07-14 2024-07-14            45     1.437611            1.114702
18   2024-09-14 2024-09-14            43    -0.271801           -0.632335
19   2024-11-14 2024-11-14            33     1.096941           -3.480074
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          4.8 |              1.9 |         -2.9 | False         
[INFO] 2021-11-14   |          2.0 |             -3.3 |         -5.3 | False         
[INFO] 2022-01-14   |          3.5 |              3.3 |         -0.2 | False         
[INFO] 2022-03-14   |          0.1 |             -0.1 |         -0.2 | False         
[INFO] 2022-05-14   |          1.4 |             -0.7 |         -2.1 | False         
[INFO] 2022-07-14   |         -3.2 |              1.5 |          4.7 | True          
[INFO] 2022-09-14   |         -0.2 |              0.2 |          0.4 | True          
[INFO] 2022-11-14   |         -1.3 |             -3.0 |         -1.7 | False         
[INFO] 2023-01-14   |         -0.6 |              1.8 |          2.4 | True          
[INFO] 2023-03-14   |         -0.5 |              0.4 |          0.9 | True          
[INFO] 2023-05-14   |         -1.2 |             -1.7 |         -0.5 | False         
[INFO] 2023-07-14   |          0.4 |              1.2 |          0.8 | True          
[INFO] 2023-09-14   |         -2.4 |             -1.5 |          0.9 | True          
[INFO] 2023-11-14   |          1.6 |              0.7 |         -0.9 | False         
[INFO] 2024-01-14   |          1.6 |              0.7 |         -0.9 | False         
[INFO] 2024-03-14   |          4.1 |              0.4 |         -3.7 | False         
[INFO] 2024-05-14   |         -0.5 |             -4.5 |         -4.0 | False         
[INFO] 2024-07-14   |          1.4 |              1.1 |         -0.3 | False         
[INFO] 2024-09-14   |         -0.3 |             -0.6 |         -0.3 | False         
[INFO] 2024-11-14   |          1.1 |             -3.5 |         -4.6 | False         
[INFO] 
No periods were excluded due to identical Sharpe ratios.
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 20
[INFO] Kmeans cluster wins (rounded comparison): 6 of 20 periods (30.00% win rate)
[INFO] Updating Excel file with Kmeans results for BRN...
[INFO] Excel file updated successfully. Added BRN with Kmeans win rate 30.0% in row 6
[INFO] Added best Sharpe parameters 10/26 in column M
[INFO] 
Performing Kmeans full out-of-sample performance analysis...
[INFO] 
----- Kmeans FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 10, Long SMA: 26
[INFO] Creating portfolio from top 3 Kmeans clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(182/214) - Original Sharpe: 0.5974
[INFO] Added cluster 2 to portfolio: SMA(26/46) - Original Sharpe: 0.5494
[INFO] Added cluster 3 to portfolio: SMA(32/84) - Original Sharpe: 0.5195
[INFO] Calculating Kmeans portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Kmeans Daily_PnL_cluster 1 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 2 to portfolio
[INFO] Added Kmeans Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BRN_Kmeans_Full_OOS_Performance_Analysis.png'
[INFO] Kmeans Portfolio out-of-sample Sharpe: -0.1746
[INFO] Kmeans Best out-of-sample Sharpe: 0.6187
[INFO] Kmeans Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Kmeans OOS comparison results for BRN...
[INFO] Excel file updated successfully. Added BRN with Kmeans portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BRN
[INFO] Big Point Value: 1000.0
[INFO] Slippage: 12.0
[INFO] Capital for Position Sizing: 6,000
[INFO] ATR Period: 30
[INFO] Starting SMA strategy analysis with hierarchical clustering...
[INFO] Loading simulation results from optimized_strategies.pkl...
[INFO] Loaded 2132 simulation results
[INFO] Short SMA range: 10 to 298
[INFO] Long SMA range: 12 to 300
[INFO] Sharpe ratio range: -0.8070 to 1.1160
[INFO] 
Best parameters:
[INFO] Short SMA: 10
[INFO] Long SMA: 26
[INFO] Sharpe Ratio: 1.115955
[INFO] Number of Trades: 66
[INFO] 
Proceeding with hierarchical cluster analysis...
[INFO] 
----- HIERARCHICAL CLUSTER ANALYSIS -----
[INFO] Loading data from optimized_strategies.pkl...
[INFO] Filtered data to 2132 points with 10-2000 trades
[INFO] Short SMA range: 10.0 to 298.0
[INFO] Long SMA range: 12.0 to 300.0
[INFO] Sharpe ratio range: -0.8070 to 1.1160
[INFO] Trades range: 10.0 to 222.0
[INFO] 
Scaled data information:
[INFO] Scaled Short SMA range: -1.1523 to 2.1716
[INFO] Scaled Long SMA range: -2.5534 to 1.3353
[INFO] Scaled Sharpe ratio range: -4.3511 to 3.3233
[INFO] Scaled Trades range: -0.7109 to 13.3382
[INFO] 
Creating dendrogram to visualize hierarchical structure...
[INFO] Using a random sample of 1000 points for dendrogram creation (out of 2132 total points)
[INFO] 
Dendrogram using ward linkage method:
[INFO] Number of data points: 1000
[INFO] Cophenetic correlation: 0.6611
[INFO] 
Determining optimal number of clusters using elbow method...
[INFO] 
Calculating elbow curve...
[INFO] Optimal number of clusters from elbow method: 14
[INFO] Using 14 clusters based on elbow method (threshold=5%)
[INFO] Performing hierarchical clustering with 14 clusters using ward linkage...
[INFO] 
Cluster sizes:
[INFO] Cluster 0: 290 elements
[INFO] Cluster 1: 344 elements
[INFO] Cluster 2: 149 elements
[INFO] Cluster 3: 23 elements
[INFO] Cluster 4: 127 elements
[INFO] Cluster 5: 339 elements
[INFO] Cluster 6: 7 elements
[INFO] Cluster 7: 198 elements
[INFO] Cluster 8: 141 elements
[INFO] Cluster 9: 127 elements
[INFO] Cluster 10: 185 elements
[INFO] Cluster 11: 76 elements
[INFO] Cluster 12: 92 elements
[INFO] Cluster 13: 34 elements
[INFO] Using 13 clusters with at least 20 elements
[INFO] Computing clusters for each cluster...
[INFO] Cluster 0 cluster: Short SMA=184, Long SMA=226, Sharpe=0.4652, Trades=14
[INFO] Cluster 1 cluster: Short SMA=208, Long SMA=272, Sharpe=0.2212, Trades=13
[INFO] Cluster 2 cluster: Short SMA=96, Long SMA=144, Sharpe=-0.0596, Trades=16
[INFO] Cluster 3 cluster: Short SMA=32, Long SMA=36, Sharpe=0.1658, Trades=79
[INFO] Cluster 4 cluster: Short SMA=274, Long SMA=288, Sharpe=0.2205, Trades=19
[INFO] Cluster 5 cluster: Short SMA=26, Long SMA=210, Sharpe=0.3790, Trades=14
[INFO] Cluster 7 cluster: Short SMA=92, Long SMA=214, Sharpe=-0.1262, Trades=10
[INFO] Cluster 8 cluster: Short SMA=26, Long SMA=92, Sharpe=0.3790, Trades=27
[INFO] Cluster 9 cluster: Short SMA=26, Long SMA=48, Sharpe=0.4872, Trades=43
[INFO] Cluster 10 cluster: Short SMA=28, Long SMA=274, Sharpe=0.5739, Trades=13
[INFO] Cluster 11 cluster: Short SMA=20, Long SMA=134, Sharpe=0.1504, Trades=26
[INFO] Cluster 12 cluster: Short SMA=176, Long SMA=192, Sharpe=0.2467, Trades=22
[INFO] Cluster 13 cluster: Short SMA=14, Long SMA=32, Sharpe=0.7781, Trades=56
[INFO] 
----- HIERARCHICAL CLUSTERING RESULTS -----
[INFO] Max Sharpe point: Short SMA=10, Long SMA=26, Sharpe=1.1160, Trades=66
[INFO] 
Top 5 Medoids (by Sharpe ratio):
[INFO] Top 1: Short SMA=14, Long SMA=32, Sharpe=0.7781, Trades=56
[INFO] Top 2: Short SMA=28, Long SMA=274, Sharpe=0.5739, Trades=13
[INFO] Top 3: Short SMA=26, Long SMA=48, Sharpe=0.4872, Trades=43
[INFO] Creating hierarchical cluster visualization...
[INFO] Using 13 valid clusters with clusters
[INFO] Filtering to 2125 points from valid clusters
[INFO] 
Plotting strategy performance...
[INFO] 
----- Hierarchical PLOTTING STRATEGY PERFORMANCE -----
[INFO] Using Short SMA: 10, Long SMA: 26
[INFO] Trading with ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Including top 5 clusters
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Warm-up: loaded 2012-12-17 -> 2025-01-01  (+380 d); analysis starts at idx 267
[INFO] 
USING THESE Hierarchical clusters (IN ORIGINAL ORDER):
[INFO] Hierarchical cluster 1: SMA(14/32) - Original Sharpe: 0.7781, Trades: 56
[INFO] Hierarchical cluster 2: SMA(28/274) - Original Sharpe: 0.5739, Trades: 13
[INFO] Hierarchical cluster 3: SMA(26/48) - Original Sharpe: 0.4872, Trades: 43
[INFO] Hierarchical cluster 4: SMA(184/226) - Original Sharpe: 0.4652, Trades: 14
[INFO] Hierarchical cluster 5: SMA(26/210) - Original Sharpe: 0.3790, Trades: 14
[INFO] Trimmed warm-up period. Evaluation data length: 2840
[INFO] 
Performing bimonthly out-of-sample comparison with hierarchical clustering...
[INFO] 
----- BIMONTHLY OUT-OF-SAMPLE COMPARISON -----
[INFO] Best Sharpe: (10/26)
[INFO] Using ATR-based position sizing (Capital: $6,000, ATR Period: 30)
[INFO] Creating portfolio of 3 Hierarchical clusters with Sharpe ratio >= 0.2:
[INFO] cluster 1: (14/32) - Sharpe: 0.7781
[INFO] cluster 2: (28/274) - Sharpe: 0.5739
[INFO] cluster 3: (26/48) - Sharpe: 0.4872
[INFO] Loading BRN data from local files...
[INFO] Found data file: A_OHLCV_@BRN=107XC_minutes_1440_2005-1650.dat
[INFO] File size: 206777 bytes
[INFO] Out-of-sample period starts on: 2021-09-14
[INFO]    period_label       date  trading_days  Best_sharpe  Avg_cluster_sharpe
0    2021-09-14 2021-09-14            44     4.800806            3.035654
1    2021-11-14 2021-11-14            44     2.049644           -2.276892
2    2022-01-14 2022-01-14            41     3.528418            3.528418
3    2022-03-14 2022-03-14            44     0.138982           -0.382395
4    2022-05-14 2022-05-14            43     1.388289           -0.285036
5    2022-07-14 2022-07-14            44    -3.155014            0.126332
6    2022-09-14 2022-09-14            43    -0.180219            0.336997
7    2022-11-14 2022-11-14            43    -1.334805           -3.000978
8    2023-01-14 2023-01-14            41    -0.581478            1.000158
9    2023-03-14 2023-03-14            43    -0.524319           -1.893804
10   2023-05-14 2023-05-14            44    -1.200228           -1.836571
11   2023-07-14 2023-07-14            44     0.362193            5.513327
12   2023-09-14 2023-09-14            43    -2.369631           -1.567864
13   2023-11-14 2023-11-14            42     1.581330            0.199639
14   2024-01-14 2024-01-14            43     1.622963            0.291204
15   2024-03-14 2024-03-14            42     4.138827            0.495613
16   2024-05-14 2024-05-14            44    -0.527309           -2.023833
17   2024-07-14 2024-07-14            45     1.437611           -0.253610
18   2024-09-14 2024-09-14            43    -0.271801           -2.744379
19   2024-11-14 2024-11-14            33     1.096941           -0.999665
[INFO] 
Detailed Sharpe ratio comparison by period:
[INFO] Period       |  Best Sharpe | {ANALYSIS_METHOD} Portfolio |   Difference | {ANALYSIS_METHOD} Portfolio Wins
[INFO] --------------------------------------------------------------------------------
[INFO] 2021-09-14   |          4.8 |              3.0 |         -1.8 | False         
[INFO] 2021-11-14   |          2.0 |             -2.3 |         -4.3 | False         
[INFO] 2022-01-14   |          3.5 |              3.5 |          0.0 | Excluded      
[INFO] 2022-03-14   |          0.1 |             -0.4 |         -0.5 | False         
[INFO] 2022-05-14   |          1.4 |             -0.3 |         -1.7 | False         
[INFO] 2022-07-14   |         -3.2 |              0.1 |          3.3 | True          
[INFO] 2022-09-14   |         -0.2 |              0.3 |          0.5 | True          
[INFO] 2022-11-14   |         -1.3 |             -3.0 |         -1.7 | False         
[INFO] 2023-01-14   |         -0.6 |              1.0 |          1.6 | True          
[INFO] 2023-03-14   |         -0.5 |             -1.9 |         -1.4 | False         
[INFO] 2023-05-14   |         -1.2 |             -1.8 |         -0.6 | False         
[INFO] 2023-07-14   |          0.4 |              5.5 |          5.1 | True          
[INFO] 2023-09-14   |         -2.4 |             -1.6 |          0.8 | True          
[INFO] 2023-11-14   |          1.6 |              0.2 |         -1.4 | False         
[INFO] 2024-01-14   |          1.6 |              0.3 |         -1.3 | False         
[INFO] 2024-03-14   |          4.1 |              0.5 |         -3.6 | False         
[INFO] 2024-05-14   |         -0.5 |             -2.0 |         -1.5 | False         
[INFO] 2024-07-14   |          1.4 |             -0.3 |         -1.7 | False         
[INFO] 2024-09-14   |         -0.3 |             -2.7 |         -2.4 | False         
[INFO] 2024-11-14   |          1.1 |             -1.0 |         -2.1 | False         
[INFO] 
Excluded periods (identical Sharpe ratios): 2022-01-14
[INFO] 
Total periods before exclusion: 20
[INFO] Bimonthly periods analyzed (after excluding ties): 19
[INFO] Hierarchical cluster wins (rounded comparison): 5 of 19 periods (26.32% win rate)
[INFO] Updating Excel file with Hierarchical results for BRN...
[INFO] Excel file updated successfully. Added BRN with Hierarchical win rate 26.3% in row 6
[INFO] Added best Sharpe parameters 10/26 in column M
[INFO] 
Performing full out-of-sample performance analysis (Hierarchical)...
[INFO] 
----- Hierarchical FULL OUT-OF-SAMPLE PERFORMANCE ANALYSIS -----
[INFO] Using Best Strategy: Short SMA: 10, Long SMA: 26
[INFO] Creating portfolio from top 3 Hierarchical clusters with Sharpe >= 0.2
[INFO] Added cluster 1 to portfolio: SMA(14/32) - Original Sharpe: 0.7781
[INFO] Added cluster 2 to portfolio: SMA(28/274) - Original Sharpe: 0.5739
[INFO] Added cluster 3 to portfolio: SMA(26/48) - Original Sharpe: 0.4872
[INFO] Calculating Hierarchical portfolio PnL as average of cluster strategies...
[INFO] 
Available columns that might contain Daily PnL data:
[INFO]   - Daily_PnL_Best
[INFO]   - Daily_PnL_cluster 1
[INFO]   - Daily_PnL_cluster 2
[INFO]   - Daily_PnL_cluster 3
[INFO]   - Daily_PnL_cluster 4
[INFO]   - Daily_PnL_cluster 5
[INFO] Added Hierarchical Daily_PnL_cluster 1 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 2 to portfolio
[INFO] Added Hierarchical Daily_PnL_cluster 3 to portfolio
[INFO] Full out-of-sample performance analysis plot saved to 'BRN_Hierarchical_Full_OOS_Performance_Analysis.png'
[INFO] Hierarchical Portfolio out-of-sample Sharpe: 0.1049
[INFO] Hierarchical Best out-of-sample Sharpe: 0.6187
[INFO] Hierarchical Portfolio outperforms Best in OOS: False
[INFO] Updating Excel file with Hierarchical OOS comparison results for BRN...
[INFO] Excel file updated successfully. Added BRN with Hierarchical portfolio comparison False in column T
[INFO] 
Analysis complete! All plots and result files have been saved to the output directory.
[INFO] Output directory: .\output2\BRN
